[{"content":"è„šæœ¬ä¼ å‚è¯¦è§£ï¼šæ‰“é€ é«˜æ•ˆæ™ºèƒ½çš„Bashè„šæœ¬å·¥å…· ğŸ“š è®© Bash è„šæœ¬â€œå¬æ‡‚â€äººè¯ï¼šäº¤äº’å‹å¥½ \u0026amp; ä¸€é”®è‡ªåŠ¨åŒ–å…¼å¾—ï¼\nğŸ“š å¯¼èˆªç›®å½• âœ¨ ä¸€ã€æ— å‚äº¤äº’è„šæœ¬ ğŸ”§ äºŒã€å¯ä¼ å‚è„šæœ¬æ”¹é€  ğŸ“Š ä¸‰ã€ä½¿ç”¨å¯¹æ¯”ï¼šä¸€è¡Œå‘½ä»¤ vs å¤šæ¬¡äº¤äº’ ğŸš€ å››ã€é«˜æ•ˆå·¥å…·ç®± ğŸ“„ äº”ã€mobu_script.sh å®Œæ•´ç¤ºä¾‹ ğŸ¯ å…­ã€å®é™…ä½¿ç”¨ç¤ºä¾‹ ğŸ’¡ ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ ä¸€ã€âœ¨ æ— å‚äº¤äº’è„šæœ¬ ä»¥ä¸‹ç¤ºä¾‹ä»…æ”¯æŒäº¤äº’å¼èœå•ï¼Œæ¯æ¬¡éƒ½è¦æ•²é”®ç›˜é€‰ 1/2ï¼Œæ•ˆç‡åä½ã€‚\nğŸ‘‡ å¤åˆ¶å³å¯è¿è¡Œä½“éªŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/bin/bash linux_git_menu() { while true; do clear echo -e \u0026#34;\u0026gt;\u0026gt;\u0026gt; Git ç®¡ç†\u0026#34; echo -e \u0026#34;1. æ¨é€æ›´æ–°\u0026#34; echo -e \u0026#34;2. æ‹‰å–æ›´æ–°\u0026#34; read -r -e -p \u0026#34;è¯·è¾“å…¥ä½ çš„é€‰æ‹©: \u0026#34; choice case $choice in 1) echo \u0026#34;âœ… æ‰§è¡Œæ¨é€æ›´æ–°...\u0026#34;; break ;; 2) echo \u0026#34;âœ… æ‰§è¡Œæ‹‰å–æ›´æ–°...\u0026#34;; break ;; *) echo \u0026#34;âŒ æ— æ•ˆé€‰æ‹©\u0026#34; ;; esac done } linux_git_menu ğŸ” ç‰¹ç‚¹å°ç»“\nâœ… é›¶å­¦ä¹ æˆæœ¬ï¼Œæ–°æ‰‹å‹å¥½ âŒ æ— æ³•è„šæœ¬åŒ–/å®šæ—¶ä»»åŠ¡ âŒ å¤šä»“åº“æ‰¹é‡æ“ä½œç—›è‹¦ äºŒã€ğŸ”§ å¯ä¼ å‚è„šæœ¬æ”¹é€  åªéœ€ 3 è¡Œæ ¸å¿ƒæ”¹åŠ¨ï¼Œç«‹åˆ»è·å¾—â€œäº¤äº’ + ä¼ å‚â€åŒæ¨¡å¼ï¼š\næ”¹é€ ç‚¹ ä»£ç  ä½œç”¨ â‘  æ¥æ”¶å‚æ•° local fast_jump=\u0026quot;$1\u0026quot; å‡½æ•°å†…æ‹¿åˆ°å¤–éƒ¨å‚æ•° â‘¡ å‚æ•°èµ‹å€¼ choice=\u0026quot;$fast_jump\u0026quot; è·³è¿‡ readï¼Œç›´æ¥è¿›å…¥åˆ†æ”¯ â‘¢ é˜²æ­»å¾ªç¯ fast_jump=\u0026quot;\u0026quot; ç”¨å®Œå³å¼ƒï¼Œç¡®ä¿ while åªè·‘ä¸€åœˆ ä¼ å‚è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash linux_git_menu() { + local fast_jump=\u0026#34;$1\u0026#34; # â‘  æ¥æ”¶å¤–éƒ¨å‚æ•° while true; do + [[ -z \u0026#34;$fast_jump\u0026#34; ]] \u0026amp;\u0026amp; clear # äº¤äº’æ¨¡å¼æ‰æ¸…å±ï¼ˆä¸éœ€è¦æ¸…å±å¯åˆ é™¤æ­¤è¡Œï¼‰ + if [[ -z \u0026#34;$fast_jump\u0026#34; ]]; then echo -e \u0026#34;\u0026gt;\u0026gt;\u0026gt; Git ç®¡ç†\u0026#34; echo -e \u0026#34;1. æ¨é€æ›´æ–°\u0026#34; echo -e \u0026#34;2. æ‹‰å–æ›´æ–°\u0026#34; read -r -e -p \u0026#34;è¯·è¾“å…¥ä½ çš„é€‰æ‹©: \u0026#34; choice + else + choice=\u0026#34;$fast_jump\u0026#34; # â‘¡ ç›´æ¥èµ‹å€¼ + fast_jump=\u0026#34;\u0026#34; # â‘¢ é˜²æ­¢æ­»å¾ªç¯ + fi case $choice in 1) echo \u0026#34;âœ… æ‰§è¡Œæ¨é€æ›´æ–°...\u0026#34;; break ;; 2) echo \u0026#34;âœ… æ‰§è¡Œæ‹‰å–æ›´æ–°...\u0026#34;; break ;; *) echo \u0026#34;âŒ æ— æ•ˆé€‰æ‹©\u0026#34; ;; esac done } - linux_git_menu + linux_git_menu \u0026#34;$1\u0026#34; # â‘£ æŠŠè„šæœ¬å‚æ•°é€ä¼  ğŸŒŸ æ”¹é€ åäº®ç‚¹\næ”¯æŒæ•°å­— + è‹±æ–‡åŒé€šé“ï¼š1 æˆ– push å‡å¯ æ—§äº¤äº’ä½“éªŒ 100% ä¿ç•™ï¼Œå‘ä¸‹å…¼å®¹ å¯æ— ç¼æ¥å…¥ CI/CDã€å®šæ—¶ä»»åŠ¡ã€æ‰¹é‡è„šæœ¬ ä¸‰ã€ğŸ“Š ä½¿ç”¨å¯¹æ¯”ï¼šä¸€è¡Œå‘½ä»¤ vs å¤šæ¬¡äº¤äº’ åœºæ™¯ æ—§è„šæœ¬ æ–°è„šæœ¬ï¼ˆä¼ å‚ï¼‰ äº¤äº’èœå• bash demo_old.sh bash demo_new.sh ä¸€é”®æ¨é€ âŒ ä¸å¯è¡Œ bash demo_new.sh push ä¸€é”®æ‹‰å– âŒ ä¸å¯è¡Œ bash demo_new.sh pull æ‰¹é‡æ“ä½œ âŒ æ‰‹å·¥é€ä¸ªç‚¹ âœ… for r in repo/*; do m push; done å››ã€ğŸš€ é«˜æ•ˆå·¥å…·ç®± æŠŠé•¿å‘½ä»¤æµ“ç¼©æˆ 1 ä¸ªå­—æ¯ï¼Œæ‰‹æ„Ÿé£èµ·ï¼\n1 2 3 chmod +x /root/mobu_script.sh # æ¨èç›´æ¥æ”¾åˆ° $PATH å¹¶å»æ‰åç¼€ï¼Œä¾‹ï¼š sudo ln -s /root/mobu_script.sh /usr/local/bin/m äº”ã€ğŸ“„ mobu_script.sh å®Œæ•´ç¤ºä¾‹ å­å‘½ä»¤åˆ†å‘ç‰ˆï¼Œæ”¯æŒ m git pushã€m pullã€m help ç­‰å†™æ³•ï¼Œæ‹¿æ¥å³ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #!/bin/bash linux_git_menu() { local fast_jump=${1:-} while true; do [[ -z \u0026#34;$fast_jump\u0026#34; ]] \u0026amp;\u0026amp; clear if [[ -z \u0026#34;$fast_jump\u0026#34; ]]; then echo -e \u0026#34;\u0026gt;\u0026gt;\u0026gt; Git ç®¡ç†\u0026#34; echo -e \u0026#34;1. æ¨é€æ›´æ–° ğŸ“¤\u0026#34; echo -e \u0026#34;2. æ‹‰å–æ›´æ–° ğŸ“¥\u0026#34; echo -e \u0026#34;0. é€€å‡º ğŸšª\u0026#34; read -r -p \u0026#34;è¯·è¾“å…¥ä½ çš„é€‰æ‹©: \u0026#34; choice else choice=$fast_jump fast_jump=\u0026#34;\u0026#34; fi case $choice in 1|push) git_push; break ;; 2|pull) git_pull; break ;; 0|q|quit|exit) echo \u0026#34;ğŸ‘‹ å†è§\u0026#34;; return 0 ;; *) echo \u0026#34;âŒ æ— æ•ˆé€‰æ‹©ï¼Œè¯·è¾“å…¥ 1/pushã€2/pull æˆ– 0/quit\u0026#34; ;; esac done } # ä½¿ç”¨è¯´æ˜å‡½æ•° m_info() { echo \u0026#34;ç”¨æ³•:\u0026#34; echo \u0026#34;ä¸€é”®æ¨é€ m push\u0026#34; echo \u0026#34;ä¸€é”®æ‹‰å– m pull\u0026#34; echo \u0026#34;Gitå­å‘½ä»¤ m git push | m git pull\u0026#34; # Gitå­å‘½ä»¤ echo \u0026#34;å¸®åŠ©ä¿¡æ¯ m help | m --help| m -h\u0026#34; } # ä¸»é€»è¾‘ï¼šå‚æ•°åˆ†å‘ if [ $# -eq 0 ]; then # æ— å‚æ•°ï¼šè¿›å…¥äº¤äº’å¼èœå• linux_git_menu else case $1 in git) # å¤„ç† git å­å‘½ä»¤ï¼šm git push æˆ– m git pull linux_git_menu \u0026#34;${@:2}\u0026#34; # ${@:2} è¡¨ç¤ºä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹çš„æ‰€æœ‰å‚æ•° ;; push) # ç›´æ¥æ¨é€ï¼šm push linux_git_menu \u0026#34;push\u0026#34; ;; pull) # ç›´æ¥æ‹‰å–ï¼šm pull linux_git_menu \u0026#34;pull\u0026#34; ;; help|--help|-h) # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ m_info ;; *) # æœªçŸ¥å‘½ä»¤ï¼Œæ˜¾ç¤ºå¸®åŠ© echo \u0026#34;æœªçŸ¥å‘½ä»¤: $1\u0026#34; m_info ;; esac fi å…­ã€ğŸ¯ å®é™…ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 1. äº¤äº’å¼ $ m \u0026gt;\u0026gt;\u0026gt; Git ç®¡ç† 1. æ¨é€æ›´æ–° ğŸ“¤ 2. æ‹‰å–æ›´æ–° ğŸ“¥ è¯·è¾“å…¥ä½ çš„é€‰æ‹©: 1 âœ… æ‰§è¡Œæ¨é€æ›´æ–°... # 2. ä¸€é”®æ¨é€ $ m push âœ… å·²æ¨é€è‡³ origin/main # 3. Git å­å‘½ä»¤ $ m git pull âœ… å·²æ‹‰å–æœ€æ–°ä»£ç  # 4. æŸ¥çœ‹å¸®åŠ© $ m help ç”¨æ³•: ... ä¸ƒã€ğŸ’¡ æ€»ç»“ä¸æœ€ä½³å®è·µ åŸåˆ™ è½åœ°æŠ€å·§ å‘åå…¼å®¹ æ–°å¢åŠŸèƒ½ä¸åˆ æ—§äº¤äº’ï¼Œè€ç”¨æˆ·é›¶æ„ŸçŸ¥ ä»£ç å¤ç”¨ é€šç”¨é€»è¾‘å°è£…å‡½æ•°ï¼Œå‡å°‘é‡å¤ é”™è¯¯å¤„ç† æ— æ•ˆå‚æ•°ç»™å‡º ğŸš© é«˜äº®æç¤º + å¸®åŠ©æ–‡æ¡ˆ é¢œè‰²è¾“å‡º æˆåŠŸ=ç»¿è‰² âœ…ï¼Œé”™è¯¯=çº¢è‰² âŒï¼Œè­¦å‘Š=é»„è‰² âš ï¸ æ—¥å¿—è¿½è¸ª å¯è¿½åŠ  exec \u0026gt;\u0026gt;~/mobu.log 2\u0026gt;\u0026amp;1 è®°å½•å…¨ä¼šè¯ ğŸŒˆ ä¸€å¥è¯ï¼šè®©è„šæœ¬æ—¢â€œå¥½çœ‹â€åˆâ€œå¥½ç”¨â€ï¼ŒæŠŠé‡å¤åŠ³åŠ¨å‡åˆ°æœ€ä½ï¼ŒæŠŠæ•ˆç‡æ‹‰æ»¡ï¼\n","date":"2025-12-04T08:58:15+08:00","image":"https://file.meimolihan.eu.org/img/shell-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4f74dbe5/","title":"è„šæœ¬ä¼ å‚è¯¦è§£ï¼šæ‰“é€ é«˜æ•ˆæ™ºèƒ½çš„Bashè„šæœ¬å·¥å…· ğŸ“š"},{"content":"Docker éƒ¨ç½² fndesk æ¡Œé¢å›¾æ ‡ç®¡ç†å·¥å…· ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² fndesk 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ fndesk 1. è®¿é—® Web ç•Œé¢ ğŸŒ 2. åŠŸèƒ½ç‰¹æ€§ä»‹ç» ğŸ” ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ åŠŸèƒ½å¼ºå¤§çš„æ¡Œé¢åº”ç”¨ä¸­å¿ƒ ğŸ¯ é¡¹ç›®ç®€ä»‹ fndesk æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ¡Œé¢åº”ç”¨ä¸­å¿ƒï¼ŒåŸºäºç°ä»£åŒ–çš„ Web æŠ€æœ¯æ ˆå¼€å‘ï¼Œæä¾›ä¸°å¯Œçš„åº”ç”¨ç®¡ç†å’Œå›¾æ ‡èµ„æºåŠŸèƒ½ã€‚è¯¥é¡¹ç›®é›†æˆäº†é«˜æ¸…å›¾æ ‡åº“ã€åº”ç”¨ç®¡ç†ã€ä¸ªæ€§åŒ–è®¾ç½®ç­‰ç‰¹æ€§ï¼Œä¸ºç”¨æˆ·æä¾›ç»Ÿä¸€çš„åº”ç”¨è®¿é—®å…¥å£å’Œç¾è§‚çš„ç•Œé¢ä½“éªŒã€‚\nğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/IMGZCQ/fndesk ğŸ“¦ Docker é•œåƒï¼šimgzcq/fndesk:latest ğŸ”§ æŠ€æœ¯æ ˆï¼šåŸºäºç°ä»£åŒ–çš„ Web æ¡†æ¶å¼€å‘ï¼Œæ”¯æŒå®¹å™¨åŒ–éƒ¨ç½² ğŸ¯ ä¸»è¦åŠŸèƒ½ï¼šåº”ç”¨ç®¡ç†ã€å›¾æ ‡èµ„æºã€ä¸ªæ€§åŒ–æ¡Œé¢ã€å¤šåª’ä½“æ”¯æŒ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ğŸ¨ ç•Œé¢ç¾è§‚ ç°ä»£åŒ–çš„ UI è®¾è®¡ï¼Œå“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒä¸»é¢˜å®šåˆ¶ ğŸ“± åº”ç”¨ç®¡ç† ç»Ÿä¸€çš„åº”ç”¨ä¸­å¿ƒï¼Œæ”¯æŒåº”ç”¨åˆ†ç±»ã€æœç´¢å’Œå¿«æ·å¯åŠ¨ ğŸ–¼ï¸ å›¾æ ‡èµ„æº å†…ç½®é«˜æ¸…å›¾æ ‡åº“ï¼Œæ”¯æŒå¤šç§å›¾æ ‡æ ¼å¼å’Œé£æ ¼ ğŸ”§ ä¸ªæ€§åŒ–è®¾ç½® ä¸°å¯Œçš„ä¸ªæ€§åŒ–é€‰é¡¹ï¼Œæ”¯æŒå¸ƒå±€ã€ä¸»é¢˜ã€å£çº¸ç­‰è‡ªå®šä¹‰ ğŸŒ å¤šç«¯é€‚é… æ”¯æŒæ¡Œé¢ç«¯ã€ç§»åŠ¨ç«¯è®¿é—®ï¼Œè·¨å¹³å°å…¼å®¹ ğŸ“º å¤šåª’ä½“æ”¯æŒ é›†æˆå½±è§†ä¸ªæ€§åŒ–åŠŸèƒ½ï¼Œæ”¯æŒå¤šåª’ä½“å†…å®¹ç®¡ç† âš¡ é«˜æ€§èƒ½ ä¼˜åŒ–çš„åŠ è½½é€Ÿåº¦ï¼Œæµç•…çš„ç”¨æˆ·ä½“éªŒ ğŸ”’ å®‰å…¨å¯é  å®‰å…¨çš„å®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ•°æ®æŒä¹…åŒ–ä¿éšœ ğŸ³ ä¸€ã€Docker éƒ¨ç½² fndesk 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åˆ›å»ºéƒ¨ç½²ç›®å½•å¹¶è¿›å…¥ mkdir -p /vol1/1000/compose/fndesk \u0026amp;\u0026amp; cd $_ # åˆ›å»º docker-compose.yml æ–‡ä»¶ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: fndesk: # Composeé¡¹ç›®åç§° container_name: fndesk # dockerå®¹å™¨åç§° image: imgzcq/fndesk:latest # é•œåƒåç§° ports: - 9990:9990 # HTTPç«¯å£ - 9991:9991 # HTTPSç«¯å£ volumes: - /usr/trim/www:/fnw # Webæ–‡ä»¶ç›®å½•ï¼ˆé‡è¦ï¼šä¸èƒ½ä¿®æ”¹ï¼‰ - /usr/trim/share/.restore:/res # æ¢å¤æ•°æ®ç›®å½•ï¼ˆé‡è¦ï¼šä¸èƒ½ä¿®æ”¹ï¼‰ - /usr/local/apps/@appcenter/trim.media:/trim.media # å½±è§†ä¸ªæ€§åŒ–ç›®å½• - ./deskdata:/deskdata # æ¡Œé¢æ•°æ®ç›®å½•ï¼ˆå¯è‡ªå®šä¹‰å·¦è¾¹è·¯å¾„ï¼‰ environment: - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® restart: always # å®¹å™¨è‡ªåŠ¨é‡å¯ networks: - fndesk-network networks: fndesk-network: driver: bridge EOF ğŸ“ é…ç½®è¯´æ˜ï¼š\né•œåƒç‰ˆæœ¬ï¼šä½¿ç”¨å®˜æ–¹æœ€æ–°ç‰ˆé•œåƒ imgzcq/fndesk:latest å®¹å™¨åç§°ï¼šå‘½åä¸º fndeskï¼Œä¾¿äºè¯†åˆ«å’Œç®¡ç† ç«¯å£æ˜ å°„ï¼šHTTP(9990) å’Œ HTTPS(9991) åŒç«¯å£æ”¯æŒ æ•°æ®æŒä¹…åŒ–ï¼šå¤šä¸ªå…³é”®ç›®å½•æŒ‚è½½ç¡®ä¿æ•°æ®å®‰å…¨ /fnwï¼šWeb åº”ç”¨æ–‡ä»¶ç›®å½•ï¼ˆæ ¸å¿ƒç›®å½•ï¼Œä¸å¯æ›´æ”¹ï¼‰ /resï¼šç³»ç»Ÿæ¢å¤æ•°æ®ç›®å½•ï¼ˆé‡è¦æ•°æ®ï¼Œä¸å¯æ›´æ”¹ï¼‰ /trim.mediaï¼šå½±è§†ä¸ªæ€§åŒ–æ•°æ®ç›®å½•ï¼ˆv0.73+ ç‰ˆæœ¬å¿…éœ€ï¼‰ /deskdataï¼šç”¨æˆ·æ¡Œé¢æ•°æ®ç›®å½•ï¼ˆå¯è‡ªå®šä¹‰å®¿ä¸»æœºè·¯å¾„ï¼‰ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 2 3 4 5 6 7 8 # æ‹‰å–æœ€æ–°é•œåƒå¹¶å¯åŠ¨æœåŠ¡ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— docker-compose logs -f âœ… éªŒè¯éƒ¨ç½²ï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€ docker ps | grep fndesk # æµ‹è¯•æœåŠ¡å¯è¾¾æ€§ curl http://localhost:9990 # æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€ docker inspect fndesk | grep Status ğŸš€ äºŒã€ä½¿ç”¨ fndesk 1. è®¿é—® Web ç•Œé¢ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® fndesk æ¡Œé¢åº”ç”¨ä¸­å¿ƒï¼š\nğŸŒ æœ¬åœ°è®¿é—®ï¼šhttp://localhost:9990 ğŸ” HTTPS è®¿é—®ï¼šhttps://localhost:9991 ğŸ”— å±€åŸŸç½‘è®¿é—®ï¼šhttp://æœåŠ¡å™¨IP:9990 ğŸŒ åŸŸåè®¿é—®ï¼šhttps://fndesk.yourdomain.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ ğŸ–¥ï¸ ç•Œé¢åŠŸèƒ½åŒºåŸŸï¼š\né¡¶éƒ¨å¯¼èˆªæ ï¼šåº”ç”¨æœç´¢ã€ç”¨æˆ·è®¾ç½®ã€ç³»ç»Ÿé€šçŸ¥ ä¾§è¾¹åº”ç”¨æ ï¼šåº”ç”¨åˆ†ç±»ã€å¿«æ·æ–¹å¼ã€ç³»ç»Ÿå·¥å…· ä¸»æ¡Œé¢åŒºï¼šåº”ç”¨å›¾æ ‡ç½‘æ ¼ã€å°éƒ¨ä»¶ã€ä¸ªæ€§åŒ–å†…å®¹ åº•éƒ¨çŠ¶æ€æ ï¼šç³»ç»ŸçŠ¶æ€ã€å¿«æ·æ“ä½œã€å¤šåª’ä½“æ§åˆ¶ 2. åŠŸèƒ½ç‰¹æ€§ä»‹ç» ğŸ” åŠŸèƒ½æ¨¡å— è¯¦ç»†æè¿° ä½¿ç”¨åœºæ™¯ ğŸ“± åº”ç”¨ä¸­å¿ƒ ç»Ÿä¸€çš„åº”ç”¨ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒåº”ç”¨åˆ†ç±»ã€æœç´¢ã€å®‰è£… å¿«é€ŸæŸ¥æ‰¾å’Œå¯åŠ¨åº”ç”¨ç¨‹åº ğŸ¨ ä¸ªæ€§åŒ–è®¾ç½® ä¸»é¢˜åˆ‡æ¢ã€å£çº¸è®¾ç½®ã€å¸ƒå±€è°ƒæ•´ å®šåˆ¶ä¸ªæ€§åŒ–æ¡Œé¢ç¯å¢ƒ ğŸ–¼ï¸ å›¾æ ‡ç®¡ç† é«˜æ¸…å›¾æ ‡åº“ï¼Œæ”¯æŒå›¾æ ‡é¢„è§ˆã€ä¸‹è½½ã€æ›¿æ¢ ç¾åŒ–åº”ç”¨å›¾æ ‡å’Œç•Œé¢å…ƒç´  ğŸ“º å½±è§†ä¸­å¿ƒ å¤šåª’ä½“å†…å®¹ç®¡ç†ï¼Œå½±è§†èµ„æºä¸ªæ€§åŒ–æ¨è å¨±ä¹å’Œåª’ä½“æ¶ˆè´¹ ğŸ”§ ç³»ç»Ÿå·¥å…· ç³»ç»ŸçŠ¶æ€ç›‘æ§ã€æ–‡ä»¶ç®¡ç†ã€è®¾ç½®é…ç½® ç³»ç»Ÿç»´æŠ¤å’Œç®¡ç† ğŸ“Š å°éƒ¨ä»¶ å¤©æ°”ã€æ—¥å†ã€ç³»ç»Ÿç›‘æ§ç­‰æ¡Œé¢å°éƒ¨ä»¶ å®æ—¶ä¿¡æ¯å±•ç¤º ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š\nä½¿ç”¨æœç´¢åŠŸèƒ½å¿«é€Ÿå®šä½åº”ç”¨å’ŒåŠŸèƒ½ åˆç†åˆ†ç±»åº”ç”¨ï¼Œæé«˜ä½¿ç”¨æ•ˆç‡ å®šæœŸå¤‡ä»½æ¡Œé¢é…ç½®å’Œæ•°æ® åˆ©ç”¨ä¸ªæ€§åŒ–è®¾ç½®æ‰“é€ ä¸“å±å·¥ä½œç¯å¢ƒ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://fndesk.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 # åˆ›å»º Nginx é…ç½®æ–‡ä»¶ cat \u0026gt; /etc/nginx/conf.d/fndesk.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; http2 on; server_name fndesk.yourdomain.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; # TLS å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å“åº”å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options SAMEORIGIN always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # åå‘ä»£ç†é…ç½® location / { proxy_pass http://localhost:9990; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 60s; proxy_send_timeout 60s; proxy_read_timeout 60s; # ç¼“å†²åŒºè®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 4k; # ç¦ç”¨ç¼“å­˜ï¼Œç¡®ä¿å®æ—¶å†…å®¹æ›´æ–° proxy_no_cache 1; proxy_cache_bypass 1; } # é™æ€èµ„æºç¼“å­˜ä¼˜åŒ– location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ { proxy_pass http://localhost:9990; expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; add_header Vary \u0026#34;Accept-Encoding\u0026#34;; } # API æ¥å£ä¸ç¼“å­˜ location ~* /api/ { proxy_pass http://localhost:9990; proxy_no_cache 1; proxy_cache_bypass 1; add_header Cache-Control \u0026#34;no-cache, no-store, must-revalidate\u0026#34;; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } # HTTP é‡å®šå‘åˆ° HTTPS server { listen 80; listen [::]:80; server_name fndesk.yourdomain.com; return 301 https://$server_name$request_uri; } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡è½½ Nginx é…ç½® sudo systemctl reload nginx # æŸ¥çœ‹ Nginx çŠ¶æ€ sudo systemctl status nginx # æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼ˆå¦‚å¯ç”¨ï¼‰ sudo ufw status sudo ufw allow 80 sudo ufw allow 443 ğŸ”§ é…ç½®è¦ç‚¹ï¼š\næ›¿æ¢ server_name ä¸ºä½ çš„å®é™…åŸŸå ç¡®ä¿è¯ä¹¦è·¯å¾„æ­£ç¡®ï¼ˆæ¨èä½¿ç”¨ Let\u0026rsquo;s Encryptï¼‰ æ ¹æ®å®é™…ç½‘ç»œç¯å¢ƒè°ƒæ•´è¶…æ—¶æ—¶é—´ é™æ€èµ„æºç¼“å­˜æå‡è®¿é—®æ€§èƒ½ API æ¥å£ç¦ç”¨ç¼“å­˜ç¡®ä¿æ•°æ®å®æ—¶æ€§ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/fndesk # ğŸ“Š æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # â¸ï¸ åœæ­¢æœåŠ¡ docker-compose down # ğŸ”„ æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # ğŸš€ å¯åŠ¨æœåŠ¡ docker-compose up -d # ğŸ“ æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # ğŸ” å®æ—¶è·Ÿè¸ªæ—¥å¿— docker-compose logs -f # ğŸ› ï¸ å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f # ğŸ’¾ å¤‡ä»½é‡è¦æ•°æ® tar -czf fndesk-backup-$(date +%Y%m%d).tar.gz ./deskdata cp docker-compose.yml docker-compose.backup.yml 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker ps -a # ğŸƒ æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # â¹ï¸ åœæ­¢å®¹å™¨ docker stop fndesk # â–¶ï¸ å¯åŠ¨å®¹å™¨ docker start fndesk # ğŸ”„ é‡å¯å®¹å™¨ docker restart fndesk # ğŸ—‘ï¸ åˆ é™¤å®¹å™¨ docker rm fndesk # ğŸ”¨ è¿›å…¥å®¹å™¨Shell docker exec -it fndesk sh # ğŸ’» åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec fndesk ls -la /fnw # ğŸ“Š æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats fndesk # ğŸ” æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect fndesk # ğŸ“ å®¹å™¨æ—¥å¿—ç®¡ç† docker logs fndesk # æŸ¥çœ‹æ—¥å¿— docker logs -f fndesk # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 fndesk # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t fndesk # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— docker logs --since 1h fndesk # æŸ¥çœ‹æœ€è¿‘1å°æ—¶æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ğŸ“· åˆ—å‡ºæ‰€æœ‰é•œåƒ docker images # ğŸ—‘ï¸ åˆ é™¤æŒ‡å®šé•œåƒ docker rmi imgzcq/fndesk:latest # ğŸ§¹ æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -f # ğŸ—‚ï¸ æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ docker image prune -a -f # ğŸ“¥ æ‹‰å–ç‰¹å®šç‰ˆæœ¬é•œåƒ docker pull imgzcq/fndesk:1.0.0 # ğŸ·ï¸ ç»™é•œåƒæ‰“æ ‡ç­¾ docker tag imgzcq/fndesk:latest myregistry/fndesk:latest # ğŸ“¤ æ¨é€é•œåƒåˆ°ç§æœ‰ä»“åº“ docker push myregistry/fndesk:latest ğŸŒŸ åŠŸèƒ½å¼ºå¤§çš„æ¡Œé¢åº”ç”¨ä¸­å¿ƒ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† fndesk æ¡Œé¢åº”ç”¨ä¸­å¿ƒï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¯ ç»Ÿä¸€ç®¡ç† é›†ä¸­ç®¡ç†æ‰€æœ‰åº”ç”¨ç¨‹åºï¼Œæä¾›ç»Ÿä¸€è®¿é—®å…¥å£\nğŸ¨ ä¸ªæ€§åŒ–å®šåˆ¶ æ ¹æ®å–œå¥½å®šåˆ¶æ¡Œé¢ä¸»é¢˜ã€å¸ƒå±€å’Œå¤–è§‚\nğŸ–¼ï¸ ä¸°å¯Œèµ„æº è®¿é—®å†…ç½®çš„é«˜æ¸…å›¾æ ‡åº“å’Œåº”ç”¨èµ„æº\nğŸ“º å¤šåª’ä½“ä½“éªŒ äº«å—å½±è§†ä¸ªæ€§åŒ–åŠŸèƒ½å’Œå¤šåª’ä½“å†…å®¹\nâš¡ é«˜æ•ˆè®¿é—® åŸºäºå®¹å™¨åŒ–æ¶æ„ï¼Œå¿«é€Ÿå“åº”çš„ç”¨æˆ·ä½“éªŒ\nğŸ”’ å®‰å…¨å¯é  é€šè¿‡ HTTPS åŠ å¯†è®¿é—®ï¼Œæ•°æ®æŒä¹…åŒ–ä¿éšœ\nfndesk ä¸ºä½ æä¾›äº†å…¨æ–¹ä½çš„æ¡Œé¢åº”ç”¨ç®¡ç†ä½“éªŒï¼Œæ— è®ºæ˜¯ï¼š\nğŸ  ä¸ªäººä½¿ç”¨ï¼šæ‰“é€ ä¸ªæ€§åŒ–çš„å®¶åº­æ¡Œé¢ç¯å¢ƒ ğŸ’¼ åŠå…¬åœºæ™¯ï¼šç»Ÿä¸€çš„å·¥ä½œåº”ç”¨å…¥å£å’Œç®¡ç† ğŸ® å¨±ä¹ä¸­å¿ƒï¼šå¤šåª’ä½“å†…å®¹å’Œåº”ç”¨çš„é›†ä¸­ç®¡ç† ğŸ”§ å¼€å‘ç¯å¢ƒï¼šå¼€å‘å·¥å…·å’Œåº”ç”¨çš„å¿«æ·è®¿é—® ğŸ“Š ä¿¡æ¯å±•ç¤ºï¼šæ¡Œé¢å°éƒ¨ä»¶å’Œå®æ—¶ä¿¡æ¯ç›‘æ§ ğŸš€ å¼€å§‹ä½¿ç”¨å»ºè®®ï¼š\nåˆæ¬¡é…ç½®ï¼šè®¿é—®ç³»ç»Ÿè®¾ç½®ï¼Œå®ŒæˆåŸºç¡€é…ç½® åº”ç”¨æ•´ç†ï¼šåˆç†åˆ†ç±»åº”ç”¨ï¼Œæé«˜ä½¿ç”¨æ•ˆç‡ ä¸ªæ€§åŒ–è®¾ç½®ï¼šæ ¹æ®å–œå¥½è°ƒæ•´ä¸»é¢˜å’Œå¸ƒå±€ æ•°æ®å¤‡ä»½ï¼šå®šæœŸå¤‡ä»½æ¡Œé¢é…ç½®å’Œé‡è¦æ•°æ® ç‰ˆæœ¬æ›´æ–°ï¼šå…³æ³¨é¡¹ç›®æ›´æ–°ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ ä»ç°åœ¨å¼€å§‹ï¼Œè®© fndesk æˆä¸ºä½ çš„æ•°å­—ç”Ÿæ´»æ§åˆ¶ä¸­å¿ƒï¼Œæå‡å·¥ä½œæ•ˆç‡ï¼Œäº«å—ä¸ªæ€§åŒ–çš„æ¡Œé¢ä½“éªŒï¼ğŸ‰\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®å…³æ³¨ fndesk å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½å’Œä¼˜åŒ–ã€‚\nğŸ› é—®é¢˜åé¦ˆï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nğŸ¤ ç¤¾åŒºè´¡çŒ®ï¼šæ¬¢è¿æäº¤ Pull Requestï¼Œå…±åŒå®Œå–„è¿™ä¸ªä¼˜ç§€çš„æ¡Œé¢åº”ç”¨ä¸­å¿ƒé¡¹ç›®ã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œæ¡Œé¢ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼ğŸ‰\n","date":"2025-11-28T08:27:04+08:00","image":"https://file.meimolihan.eu.org/img/docker-fndesk-01.webp","permalink":"https://blog.meimolihan.eu.org/p/28d98a6d/","title":"Docker éƒ¨ç½² Fndesk æ¡Œé¢å›¾æ ‡ç®¡ç†å·¥å…· ğŸ³"},{"content":"iptables é˜²ç«å¢™é…ç½®ä¸ç®¡ç† æœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„ iptables é˜²ç«å¢™é…ç½®æŒ‡å—ï¼Œæ¶µç›–å¤šç³»ç»Ÿæ”¯æŒã€è§„åˆ™æ¸…ç†ã€æŒä¹…åŒ–é…ç½®ç­‰æ ¸å¿ƒæ“ä½œã€‚ğŸš€\nğŸ“š ç›®å½•å¯¼èˆª ğŸ”§ iptables ç®€ä»‹ä¸æ ¸å¿ƒåŠŸèƒ½ ğŸ§¹ æ¸…ç† iptables è§„åˆ™ ğŸ§ Debian/Ubuntu ç³»ç»Ÿé…ç½® ğŸ”´ CentOS/RHEL ç³»ç»Ÿé…ç½® ğŸ” è§„åˆ™æŸ¥çœ‹ä¸ç®¡ç† ğŸ’¡ å®ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ ğŸ”§ iptables ç®€ä»‹ä¸æ ¸å¿ƒåŠŸèƒ½ iptables æ˜¯ Linux ç³»ç»Ÿä¸­æœ€å¼ºå¤§çš„é˜²ç«å¢™å·¥å…·ï¼Œå…·æœ‰å®Œæ•´çš„ç½‘ç»œåŒ…è¿‡æ»¤èƒ½åŠ›ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ å››è¡¨äº”é“¾æ¶æ„ ğŸ“Šï¼šåŒ…å« filterã€natã€mangleã€raw å››ä¸ªè¡¨å’Œ INPUTã€OUTPUTã€FORWARD ç­‰äº”ä¸ªå†…ç½®é“¾ çŠ¶æ€è·Ÿè¸ª ğŸ”„ï¼šæ”¯æŒè¿æ¥çŠ¶æ€æ£€æµ‹ï¼ˆNEWã€ESTABLISHEDã€RELATEDã€INVALIDï¼‰ çµæ´»çš„ç­–ç•¥æ§åˆ¶ ğŸ›¡ï¸ï¼šå¯åŸºäºåè®®ã€ç«¯å£ã€IPåœ°å€ã€ç½‘ç»œæ¥å£ç­‰è¿›è¡Œç²¾ç»†æ§åˆ¶ ç½‘ç»œåœ°å€è½¬æ¢ ğŸ”„ï¼šæ”¯æŒ SNATã€DNAT ç­‰ç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ ğŸ”§ ä¸»è¦åŠŸèƒ½ åŒ…è¿‡æ»¤ ğŸ“¦ï¼šæ ¹æ®è§„åˆ™å†³å®šæ•°æ®åŒ…çš„é€šè¿‡æˆ–æ‹’ç» ç½‘ç»œåœ°å€è½¬æ¢ ğŸŒï¼šå®ç°ç§æœ‰ç½‘ç»œä¸å…¬ç½‘çš„åœ°å€è½¬æ¢ æµé‡æ•´å½¢ âš¡ï¼šå¯¹æ•°æ®åŒ…è¿›è¡Œä¿®æ”¹å’Œæ ‡è®° è¿æ¥è·Ÿè¸ª ğŸ”ï¼šç›‘æ§ç½‘ç»œè¿æ¥çŠ¶æ€ ğŸ§¹ æ¸…ç† iptables è§„åˆ™ å½“éœ€è¦é‡ç½®é˜²ç«å¢™é…ç½®æ—¶ï¼Œåº”æŒ‰ä»¥ä¸‹å®‰å…¨æµç¨‹æ“ä½œï¼Œé¿å…è¢«é”åœ¨ç³»ç»Ÿå¤–ã€‚\nğŸš¨ å®‰å…¨æ¸…ç†æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. ğŸ“Œ é¦–å…ˆå°†é»˜è®¤ç­–ç•¥æ”¹ä¸º ACCEPTï¼Œé˜²æ­¢è§„åˆ™æ¸…ç©ºåè¿æ¥è¢«æ–­å¼€ iptables -P INPUT ACCEPT \u0026amp;\u0026amp; iptables -P FORWARD ACCEPT \u0026amp;\u0026amp; iptables -P OUTPUT ACCEPT # 2. ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è¡¨ä¸­çš„è§„åˆ™é“¾ iptables -t filter -F \u0026amp;\u0026amp; iptables -t nat -F \u0026amp;\u0026amp; iptables -t mangle -F \u0026amp;\u0026amp; iptables -t raw -F # 3. ğŸ”„ åˆ é™¤æ‰€æœ‰ç”¨æˆ·è‡ªå®šä¹‰é“¾ï¼ˆéœ€è¦å…ˆç¡®ä¿é“¾æ²¡æœ‰è¢«å¼•ç”¨ï¼‰ iptables -t filter -X \u0026amp;\u0026amp; iptables -t nat -X \u0026amp;\u0026amp; iptables -t mangle -X \u0026amp;\u0026amp; iptables -t raw -X # 4. ğŸ“Š é‡ç½®æ‰€æœ‰è®¡æ•°å™¨å½’é›¶ iptables -t filter -Z \u0026amp;\u0026amp; iptables -t nat -Z \u0026amp;\u0026amp; iptables -t mangle -Z \u0026amp;\u0026amp; iptables -t raw -Z # 5. ğŸ‘€ éªŒè¯è§„åˆ™å·²æ¸…ç©º iptables -L -n -v ğŸ’¡ æ¸…ç†è¯´æ˜ é¡ºåºå¾ˆé‡è¦ âš ï¸ï¼šå¿…é¡»å…ˆä¿®æ”¹é»˜è®¤ç­–ç•¥å†æ¸…ç©ºè§„åˆ™ï¼Œé¿å…è¢«é”åœ¨ç³»ç»Ÿå¤– å¤šè¡¨æ“ä½œ ğŸ“‹ï¼šiptables æœ‰ filterã€natã€mangleã€raw å››ä¸ªè¡¨ï¼Œéƒ½éœ€è¦æ¸…ç† è‡ªå®šä¹‰é“¾ ğŸ”—ï¼šè‡ªå®šä¹‰é“¾éœ€è¦å…ˆæ¸…ç©ºè§„åˆ™å†åˆ é™¤ è®¡æ•°å™¨å½’é›¶ ğŸ“ˆï¼š-Z å‚æ•°ç”¨äºé‡ç½®åŒ…å’Œå­—èŠ‚è®¡æ•°å™¨ ğŸ§ Debian/Ubuntu ç³»ç»Ÿé…ç½® åœ¨ Debian/Ubuntu ç³»ç»Ÿä¸Šé…ç½® iptables çš„å®Œæ•´æµç¨‹ï¼š\nğŸ”„ ç³»ç»Ÿç¯å¢ƒå‡†å¤‡ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹å½“å‰é˜²ç«å¢™çŠ¶æ€ iptables -L # ğŸ—‘ï¸ ç§»é™¤å…¶ä»–é˜²ç«å¢™å·¥å…· apt purge -y ufw apt purge -y iptables-persistent # ğŸ“¦ å®‰è£… iptables æŒä¹…åŒ–å·¥å…· apt update -y \u0026amp;\u0026amp; apt install -y iptables-persistent nano ğŸ“ é…ç½®æ–‡ä»¶ç¼–è¾‘ ç¼–è¾‘ iptables è§„åˆ™é…ç½®æ–‡ä»¶ï¼š\n1 nano /etc/iptables/rules.v4 é…ç½®æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 *filter # ğŸ¯ å®šä¹‰é»˜è®¤ç­–ç•¥ :INPUT DROP [0:0] :FORWARD DROP [0:0] :OUTPUT ACCEPT [0:0] # ğŸ”„ å…è®¸å·²å»ºç«‹çš„å’Œç›¸å…³çš„è¿æ¥ -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # ğŸ” å…è®¸ SSH è¿æ¥ï¼ˆé‡è¦ï¼ï¼‰ -A INPUT -p tcp --dport 22 -j ACCEPT # ğŸ–¥ï¸ å…è®¸æœ¬åœ°å›ç¯æ¥å£é€šä¿¡ -A INPUT -i lo -j ACCEPT -A FORWARD -i lo -j ACCEPT # ğŸ’¾ æäº¤è§„åˆ™ COMMIT ğŸš€ åŠ è½½ä¸å¯ç”¨è§„åˆ™ 1 2 3 4 5 6 7 8 9 # ğŸ“¥ åŠ è½½è§„åˆ™æ–‡ä»¶ iptables-restore \u0026lt; /etc/iptables/rules.v4 # ğŸ”„ å¯ç”¨æŒä¹…åŒ–æœåŠ¡ systemctl enable netfilter-persistent systemctl restart netfilter-persistent # ğŸ‘€ éªŒè¯è§„åˆ™ iptables -L ğŸ“‹ Debian/Ubuntu é…ç½®è¯´æ˜ ç»„ä»¶ ä½œç”¨ é‡è¦æ€§ iptables-persistent è§„åˆ™æŒä¹…åŒ– ğŸ”´ å…³é”® /etc/iptables/rules.v4 IPv4 è§„åˆ™æ–‡ä»¶ ğŸ”´ å…³é”® netfilter-persistent æŒä¹…åŒ–æœåŠ¡ ğŸŸ¡ é‡è¦ ğŸ”´ CentOS/RHEL ç³»ç»Ÿé…ç½® åœ¨ CentOS/RHEL ç³»ç»Ÿä¸Šé…ç½® iptables çš„å®Œæ•´æµç¨‹ï¼š\nğŸ”„ ç³»ç»Ÿç¯å¢ƒå‡†å¤‡ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å½“å‰é˜²ç«å¢™çŠ¶æ€ iptables -L # ğŸ—‘ï¸ ç§»é™¤ firewalldï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ yum remove -y firewalld # ğŸ“¦ å®‰è£… iptables-services yum update -y \u0026amp;\u0026amp; yum install -y iptables-services # ğŸš€ å¯ç”¨å¹¶å¯åŠ¨ iptables æœåŠ¡ systemctl enable iptables systemctl start iptables ğŸ›¡ï¸ åŸºç¡€å®‰å…¨è§„åˆ™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ğŸ§¹ æ¸…é™¤ç°æœ‰è§„åˆ™ iptables -F # 1. ğŸ” å…è®¸ SSH è¿æ¥ï¼ˆé‡è¦ï¼é¿å…é”æ­»ï¼‰ iptables -A INPUT -p tcp --dport 22 -j ACCEPT # 2. ğŸ”„ å…è®¸æœ¬åœ°å›ç¯æ¥å£é€šä¿¡ iptables -A INPUT -i lo -j ACCEPT iptables -A FORWARD -i lo -j ACCEPT # 3. ğŸ¤ å…è®¸å·²å»ºç«‹çš„å’Œç›¸å…³çš„è¿æ¥ iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # 4. ğŸš« è®¾ç½®é»˜è®¤ç­–ç•¥ä¸ºæ‹’ç» iptables -P INPUT DROP iptables -P FORWARD DROP # ğŸ’¾ ä¿å­˜é…ç½®å¹¶é‡å¯æœåŠ¡ service iptables save systemctl restart iptables ğŸ“ CentOS é…ç½®è¯´æ˜ è§„åˆ™ ä½œç”¨ é‡è¦æ€§ -p tcp --dport 22 -j ACCEPT å…è®¸ SSH è¿æ¥ ğŸ”´ å…³é”®ï¼Œé¿å…è¢«é” -i lo -j ACCEPT å…è®¸æœ¬åœ°å›ç¯ ğŸŸ¡ é‡è¦ï¼Œç³»ç»Ÿå†…éƒ¨é€šä¿¡ -m state --state ESTABLISHED,RELATED å…è®¸ç›¸å…³è¿æ¥ ğŸŸ¢ å¿…è¦ï¼Œæ­£å¸¸ç½‘ç»œé€šä¿¡ service iptables save ä¿å­˜è§„åˆ™ ğŸ”´ å…³é”®ï¼Œç¡®ä¿é‡å¯åç”Ÿæ•ˆ ğŸ”„ ç³»ç»ŸæœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status iptables # é‡å¯æœåŠ¡ systemctl restart iptables # åœæ­¢æœåŠ¡ systemctl stop iptables # ç¦ç”¨æœåŠ¡ systemctl disable iptables ğŸ” è§„åˆ™æŸ¥çœ‹ä¸ç®¡ç† ğŸ‘€ è§„åˆ™æŸ¥çœ‹å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰è§„åˆ™ï¼ˆç®€è¦ï¼‰ iptables -L # ğŸ“Š æŸ¥çœ‹è§„åˆ™å¸¦æ•°å­—æ ¼å¼ï¼ˆæ˜¾ç¤ºç«¯å£å·ï¼‰ iptables -L -n # ğŸ” è¯¦ç»†æŸ¥çœ‹ï¼ˆæ˜¾ç¤ºè®¡æ•°å™¨ã€æ¥å£ç­‰ï¼‰ iptables -L -n -v # ğŸ“ˆ æŸ¥çœ‹ç‰¹å®šè¡¨çš„è§„åˆ™ iptables -t nat -L -n iptables -t mangle -L -n # ğŸ”¢ ä»¥æ•°å­—æ ¼å¼æ˜¾ç¤ºè§„åˆ™ï¼ˆå¸¦è¡Œå·ï¼‰ iptables -L -n --line-numbers ğŸ› ï¸ å¸¸ç”¨ç®¡ç†æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 # â• æ·»åŠ è§„åˆ™ç¤ºä¾‹ iptables -A INPUT -p tcp --dport 80 -j ACCEPT # å…è®¸ HTTP iptables -A INPUT -p tcp --dport 443 -j ACCEPT # å…è®¸ HTTPS # âœï¸ æ’å…¥è§„åˆ™åˆ°æŒ‡å®šä½ç½® iptables -I INPUT 1 -p tcp --dport 3306 -j ACCEPT # åœ¨ç¬¬ä¸€æ¡æ’å…¥ # âŒ åˆ é™¤è§„åˆ™ iptables -D INPUT 2 # åˆ é™¤ INPUT é“¾ç¬¬äºŒæ¡è§„åˆ™ iptables -D INPUT -p tcp --dport 80 -j ACCEPT # æŒ‰è§„åˆ™å†…å®¹åˆ é™¤ # ğŸ“ ä¿®æ”¹ç­–ç•¥ iptables -P OUTPUT ACCEPT # ä¿®æ”¹ OUTPUT é“¾é»˜è®¤ç­–ç•¥ ğŸ“Š è§„åˆ™æ–‡ä»¶ä½ç½® ç³»ç»Ÿ è§„åˆ™æ–‡ä»¶ä½ç½® ä¿å­˜å‘½ä»¤ Debian/Ubuntu /etc/iptables/rules.v4 è‡ªåŠ¨ä¿å­˜ CentOS/RHEL /etc/sysconfig/iptables service iptables save ğŸ’¡ å®ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ ğŸ” å®‰å…¨é…ç½®å»ºè®® è¿œç¨‹æ“ä½œå®‰å…¨æªæ–½ âš ï¸\n1 2 3 # è®¾ç½®å®šæ—¶æ¢å¤ï¼Œé˜²æ­¢é…ç½®é”™è¯¯è¢«é” (sleep 300; iptables -F; iptables -P INPUT ACCEPT) \u0026amp; echo \u0026#34;é˜²ç«å¢™æ¢å¤å®šæ—¶å™¨å·²å¯åŠ¨ï¼Œ5åˆ†é’Ÿåè‡ªåŠ¨é‡ç½®\u0026#34; é‡è¦æœåŠ¡ä¿éšœ ğŸ›¡ï¸\n1 2 3 4 5 # ç¡®ä¿å…³é”®æœåŠ¡ä¸å—å½±å“ iptables -A INPUT -p tcp --dport 22 -j ACCEPT # SSH iptables -A INPUT -p udp --dport 53 -j ACCEPT # DNS iptables -A INPUT -p tcp --dport 80 -j ACCEPT # HTTP iptables -A INPUT -p tcp --dport 443 -j ACCEPT # HTTPS é˜²å¾¡æ€§é…ç½® ğŸ›¡ï¸\n1 2 3 4 5 6 7 8 # é™åˆ¶æš´åŠ›ç ´è§£ iptables -A INPUT -p tcp --dport 22 -m limit --limit 5/min -j ACCEPT # é˜²æ­¢æ´ªæ°´æ”»å‡» iptables -A INPUT -p tcp --dport 80 -m limit --limit 100/min -j ACCEPT # é˜»æ­¢æ— æ•ˆæ•°æ®åŒ… iptables -A INPUT -m state --state INVALID -j DROP ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥ è¿æ¥è¢«æ‹’ç» ğŸ”´\næ£€æŸ¥é»˜è®¤ç­–ç•¥æ˜¯å¦ä¸º DROP ç¡®è®¤ç›¸å…³ç«¯å£çš„ ACCEPT è§„åˆ™å·²æ·»åŠ  éªŒè¯è§„åˆ™é¡ºåºæ˜¯å¦æ­£ç¡® æ£€æŸ¥è¿æ¥è·Ÿè¸ªçŠ¶æ€ è§„åˆ™ä¸ç”Ÿæ•ˆ ğŸŸ¡\næ£€æŸ¥è§„åˆ™è¯­æ³•æ˜¯å¦æ­£ç¡® ç¡®è®¤è§„åˆ™å·²ä¿å­˜ éªŒè¯æœåŠ¡å·²é‡å¯ æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼šjournalctl -u iptables æˆ– dmesg | grep iptables æœåŠ¡æ— æ³•å¯åŠ¨ ğŸ”´\næ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ éªŒè¯æ–‡ä»¶æƒé™ ğŸ“‹ æœ€ä½³å®è·µæ€»ç»“ âœ… æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼šæ–°è§„åˆ™å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ âœ… å¤‡ä»½é…ç½®ï¼šé‡è¦ä¿®æ”¹å‰å¤‡ä»½å½“å‰é…ç½® âœ… æ³¨é‡Šè¯´æ˜ï¼šå¤æ‚è§„åˆ™æ·»åŠ æ³¨é‡Šè¯´æ˜ âœ… å®šæœŸå®¡è®¡ï¼šå®šæœŸæ£€æŸ¥é˜²ç«å¢™è§„åˆ™ âœ… æœ€å°æƒé™ï¼šéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£ âœ… ç‰ˆæœ¬æ§åˆ¶ï¼šå¯¹è§„åˆ™æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬ç®¡ç† âœ… ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥é˜²ç«å¢™æ—¥å¿— ğŸŒ å¤šç³»ç»Ÿå·®å¼‚æ€»ç»“ ç‰¹æ€§ Debian/Ubuntu CentOS/RHEL æŒä¹…åŒ–å·¥å…· iptables-persistent iptables-services è§„åˆ™æ–‡ä»¶ /etc/iptables/rules.v4 /etc/sysconfig/iptables æœåŠ¡ç®¡ç† netfilter-persistent iptables é»˜è®¤çŠ¶æ€ é€šå¸¸æ— é»˜è®¤è§„åˆ™ å¯èƒ½æœ‰é»˜è®¤è§„åˆ™ ğŸ“Œ æ¸©é¦¨æç¤ºï¼šiptables æ˜¯å¼ºå¤§çš„ç½‘ç»œå·¥å…·ï¼Œé…ç½®æ—¶è¯·åŠ¡å¿…è°¨æ…ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ“ä½œæ—¶å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå¹¶ç¡®ä¿æœ‰åº”æ€¥æ¢å¤æ–¹æ¡ˆã€‚å»ºè®®ä½¿ç”¨ç®¡ç†å£æˆ–å¸¦å¤–ç®¡ç†è¿›è¡Œé˜²ç«å¢™é…ç½®æ“ä½œã€‚ğŸ”§ğŸ›¡ï¸\nğŸš€ è¿›é˜¶å»ºè®®ï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ç»“åˆè„šæœ¬è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œå¹¶å»ºç«‹å®Œæ•´çš„å˜æ›´ç®¡ç†å’Œå›æ»šæµç¨‹ã€‚\n","date":"2025-11-21T20:16:38+08:00","image":"https://file.meimolihan.eu.org/img/iptables-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1eb0fbfa/","title":"Iptables é˜²ç«å¢™é…ç½®ä¸ç®¡ç†"},{"content":"Docker éƒ¨ç½² hd-icons é«˜æ¸…å›¾æ ‡åº“ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² hd-Icons 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ hd-Icons 1. è®¿é—® Web ç•Œé¢ ğŸŒ 2. å›¾æ ‡æœç´¢ä¸ä¸‹è½½ ğŸ” ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ é«˜æ¸…å›¾æ ‡ï¼Œè®¾è®¡æ— å¿§ ğŸ¯ é¡¹ç›®ç®€ä»‹ hd-icons æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„é«˜æ¸…å›¾æ ‡åº“é¡¹ç›®ï¼Œè‡´åŠ›äºä¸ºå¼€å‘è€…å’Œè®¾è®¡å¸ˆæä¾›é«˜è´¨é‡ã€å¤šæ ·åŒ–çš„å›¾æ ‡èµ„æºã€‚è¯¥é¡¹ç›®åŸºäºç°ä»£åŒ–çš„ Web æŠ€æœ¯æ ˆæ„å»ºï¼Œæ”¯æŒ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œè®©å›¾æ ‡ç®¡ç†å’Œä½¿ç”¨å˜å¾—æ›´åŠ ç®€å•é«˜æ•ˆã€‚\nğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/xushier/HD-Icons ğŸ–¼ï¸ é¡¹ç›®ç‰¹è‰²ï¼šæä¾›æµ·é‡é«˜æ¸…å›¾æ ‡ï¼Œæ¶µç›–å¤šç§é£æ ¼å’Œåˆ†ç±» âš¡ æŠ€æœ¯æ¶æ„ï¼šé‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¿«é€Ÿæœç´¢å’Œé¢„è§ˆ ğŸ”§ éƒ¨ç½²æ–¹å¼ï¼šæ”¯æŒ Docker ä¸€é”®éƒ¨ç½²ï¼Œç®€åŒ–è¿ç»´æµç¨‹ æ— è®ºä½ æ˜¯å‰ç«¯å¼€å‘è€…éœ€è¦ç•Œé¢å›¾æ ‡ï¼Œè¿˜æ˜¯è®¾è®¡å¸ˆå¯»æ‰¾çµæ„Ÿç´ æï¼Œhd-icons éƒ½èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œè®©ä½ çš„é¡¹ç›®ç•Œé¢æ›´åŠ ä¸“ä¸šå’Œç¾è§‚ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ¨ å›¾æ ‡èµ„æºä¸°å¯Œ æµ·é‡å›¾æ ‡åº“ï¼šæ”¶å½•æ•°åƒä¸ªé«˜è´¨é‡å›¾æ ‡ï¼Œæ¶µç›–å¤šç§è®¾è®¡é£æ ¼ å¤šæ ¼å¼æ”¯æŒï¼šæä¾› SVGã€PNG ç­‰å¤šç§æ ¼å¼ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ åˆ†ç±»æ¸…æ™°ï¼šæŒ‰åŠŸèƒ½ã€é£æ ¼ã€è¡Œä¸šç­‰å¤šç»´åº¦åˆ†ç±»ï¼Œå¿«é€Ÿå®šä½æ‰€éœ€å›¾æ ‡ ğŸ” æ™ºèƒ½æœç´¢ä½“éªŒ å…³é”®è¯æœç´¢ï¼šæ”¯æŒä¸­è‹±æ–‡å…³é”®è¯å¿«é€Ÿæœç´¢ï¼Œç²¾å‡†åŒ¹é… æ¨¡ç³Šæœç´¢ï¼šæ™ºèƒ½å®¹é”™ï¼Œå³ä½¿æ‹¼å†™é”™è¯¯ä¹Ÿèƒ½æ‰¾åˆ°ç›¸å…³å›¾æ ‡ åˆ†ç±»ç­›é€‰ï¼šæŒ‰é¢œè‰²ã€é£æ ¼ã€å°ºå¯¸ç­‰å¤šæ¡ä»¶ç­›é€‰ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡ âš¡ é«˜æ€§èƒ½æ¶æ„ å¿«é€Ÿå“åº”ï¼šä¼˜åŒ–çš„æœç´¢ç®—æ³•ï¼Œæ¯«ç§’çº§å›¾æ ‡æ£€ç´¢ ç¼“å­˜æœºåˆ¶ï¼šæ™ºèƒ½ç¼“å­˜çƒ­é—¨å›¾æ ‡ï¼Œæå‡è®¿é—®é€Ÿåº¦ CDN å°±ç»ªï¼šæ”¯æŒ CDN åŠ é€Ÿï¼Œå…¨çƒè®¿é—®æ— å‹åŠ› ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² ä¸€é”®éƒ¨ç½²ï¼šDocker Compose ç®€åŒ–éƒ¨ç½²æµç¨‹ ç¯å¢ƒéš”ç¦»ï¼šç‹¬ç«‹çš„å®¹å™¨ç¯å¢ƒï¼Œé¿å…ä¾èµ–å†²çª æ˜“äºæ‰©å±•ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œåº”å¯¹é«˜å¹¶å‘åœºæ™¯ ğŸ¯ å¼€å‘è€…å‹å¥½ API æ”¯æŒï¼šæä¾› RESTful APIï¼Œæ–¹ä¾¿é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿ æ–‡æ¡£å®Œå–„ï¼šè¯¦ç»†çš„éƒ¨ç½²å’Œä½¿ç”¨æ–‡æ¡£ï¼Œé™ä½å­¦ä¹ æˆæœ¬ æŒç»­æ›´æ–°ï¼šå®šæœŸæ›´æ–°å›¾æ ‡åº“ï¼Œä¿æŒå†…å®¹æ–°é²œåº¦ ğŸ”’ å®‰å…¨å¯é  æƒé™æ§åˆ¶ï¼šæ”¯æŒè®¿é—®æƒé™ç®¡ç†ï¼Œä¿æŠ¤å›¾æ ‡èµ„æº æ•°æ®å¤‡ä»½ï¼šå®Œå–„çš„å¤‡ä»½æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ ç›‘æ§å‘Šè­¦ï¼šé›†æˆç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶æŒæ¡æœåŠ¡çŠ¶æ€ ğŸ³ ä¸€ã€Docker éƒ¨ç½² hd-Icons 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºéƒ¨ç½²ç›®å½•å¹¶è¿›å…¥ mkdir -p /vol1/1000/compose/hd-Icons \u0026amp;\u0026amp; cd $_ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: hd-icons: image: xushier/hd-icons:latest container_name: hd-Icons restart: always ports: - \u0026#34;50560:50560\u0026#34; volumes: - ./icons:/app/icons environment: - TITLE=å¢¨ä¸å‡¡å›¾æ ‡åº“ EOF ğŸ“ é…ç½®è¯´æ˜ï¼š\né•œåƒç‰ˆæœ¬ï¼šä½¿ç”¨å®˜æ–¹æœ€æ–°ç‰ˆé•œåƒ xushier/hd-icons:latest å®¹å™¨åç§°ï¼šå‘½åä¸º hd-Iconsï¼Œä¾¿äºè¯†åˆ«å’Œç®¡ç† ç«¯å£æ˜ å°„ï¼šå°†å®¹å™¨å†… 50560 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºç›¸åŒç«¯å£ æ•°æ®æŒä¹…åŒ–ï¼šæŒ‚è½½ ./icons ç›®å½•åˆ°å®¹å™¨å†…ï¼Œç¡®ä¿å›¾æ ‡æ•°æ®ä¸ä¸¢å¤± ç¯å¢ƒå˜é‡ï¼šè®¾ç½®ç«™ç‚¹æ ‡é¢˜ä¸º\u0026quot;å¢¨ä¸å‡¡å›¾æ ‡åº“\u0026quot; 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 2 3 4 5 6 7 8 # æ‹‰å–æœ€æ–°é•œåƒå¹¶å¯åŠ¨æœåŠ¡ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— docker-compose logs -f âœ… éªŒè¯éƒ¨ç½²ï¼š\n1 2 3 4 5 # æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€ docker ps | grep hd-Icons # æµ‹è¯•æœåŠ¡å¯è¾¾æ€§ curl http://localhost:50560 ğŸš€ äºŒã€ä½¿ç”¨ hd-Icons 1. è®¿é—® Web ç•Œé¢ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® hd-icons å›¾æ ‡åº“ï¼š\nğŸŒ æœ¬åœ°è®¿é—®ï¼šhttp://localhost:50560 ğŸ”— å±€åŸŸç½‘è®¿é—®ï¼šhttp://æœåŠ¡å™¨IP:50560 ğŸŒ åŸŸåè®¿é—®ï¼šhttps://icons.yourdomain.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ ğŸ–¥ï¸ ç•Œé¢åŠŸèƒ½åŒºåŸŸï¼š\né¡¶éƒ¨å¯¼èˆªï¼šæœç´¢æ¡†ã€åˆ†ç±»ç­›é€‰ã€ç”¨æˆ·è®¾ç½® ä¾§è¾¹æ ï¼šå›¾æ ‡åˆ†ç±»ã€æ ‡ç­¾ç­›é€‰ã€æ”¶è—å¤¹ ä¸»å†…å®¹åŒºï¼šå›¾æ ‡ç½‘æ ¼å±•ç¤ºã€é¢„è§ˆé¢æ¿ 2. å›¾æ ‡æœç´¢ä¸ä¸‹è½½ ğŸ” æ“ä½œ è¯´æ˜ ç¤ºä¾‹ ğŸ” å…³é”®è¯æœç´¢ åœ¨æœç´¢æ¡†è¾“å…¥å›¾æ ‡ç›¸å…³å…³é”®è¯ \u0026ldquo;æœç´¢\u0026rdquo;ã€\u0026ldquo;ç”¨æˆ·\u0026rdquo;ã€\u0026ldquo;è®¾ç½®\u0026rdquo;ã€\u0026ldquo;ç®­å¤´\u0026quot;ç­‰ ğŸ·ï¸ åˆ†ç±»æµè§ˆ æŒ‰åŠŸèƒ½åˆ†ç±»æµè§ˆå›¾æ ‡ ç•Œé¢å›¾æ ‡ã€æ“ä½œå›¾æ ‡ã€æ–‡ä»¶å›¾æ ‡ç­‰ ğŸ¨ é£æ ¼ç­›é€‰ æŒ‰è®¾è®¡é£æ ¼ç­›é€‰ çº¿æ€§å›¾æ ‡ã€é¢æ€§å›¾æ ‡ã€å¤šè‰²å›¾æ ‡ç­‰ ğŸ“¥ å›¾æ ‡ä¸‹è½½ ä¸‹è½½æ‰€éœ€æ ¼å¼çš„å›¾æ ‡ SVGã€PNGï¼ˆå¤šç§å°ºå¯¸ï¼‰ â­ æ”¶è—åŠŸèƒ½ æ”¶è—å¸¸ç”¨å›¾æ ‡ åˆ›å»ºä¸ªäººæ”¶è—å¤¹ï¼Œå¿«é€Ÿè®¿é—® ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š\nä½¿ç”¨è‹±æ–‡å…³é”®è¯æœç´¢é€šå¸¸æ›´å‡†ç¡® å¤šå°è¯•åŒä¹‰è¯ï¼Œå¦‚\u0026quot;delete\u0026quot;å’Œ\u0026quot;remove\u0026rdquo; åˆ©ç”¨åˆ†ç±»ç­›é€‰å¿«é€Ÿç¼©å°æœç´¢èŒƒå›´ æ‰¹é‡ä¸‹è½½æ—¶é€‰æ‹©ç»Ÿä¸€é£æ ¼ä¿æŒä¸€è‡´æ€§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://icons.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 # åˆ›å»º Nginx é…ç½®æ–‡ä»¶ç›®å½• mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/hd-icons.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; http2 on; server_name icons.yourdomain.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; # TLS å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å“åº”å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options SAMEORIGIN always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # åå‘ä»£ç†é…ç½® location / { proxy_pass http://localhost:50560; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒï¼ˆå¦‚éœ€è¦ï¼‰ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 60s; proxy_send_timeout 60s; proxy_read_timeout 60s; # ç¼“å†²åŒºè®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 4k; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { proxy_pass http://localhost:50560; expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡è½½ Nginx é…ç½® sudo systemctl reload nginx # æŸ¥çœ‹ Nginx çŠ¶æ€ sudo systemctl status nginx ğŸ”§ é…ç½®è¦ç‚¹ï¼š\næ›¿æ¢ server_name ä¸ºä½ çš„å®é™…åŸŸå ç¡®ä¿è¯ä¹¦è·¯å¾„æ­£ç¡®ï¼ˆæˆ–ä½¿ç”¨ Let\u0026rsquo;s Encryptï¼‰ æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´è¶…æ—¶æ—¶é—´ é™æ€èµ„æºç¼“å­˜æå‡è®¿é—®é€Ÿåº¦ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/hd-Icons # ğŸ“Š æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # â¸ï¸ åœæ­¢æœåŠ¡ docker-compose down # ğŸ”„ æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # ğŸš€ å¯åŠ¨æœåŠ¡ docker-compose up -d # ğŸ“ æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # ğŸ” å®æ—¶è·Ÿè¸ªæ—¥å¿— docker-compose logs -f # ğŸ› ï¸ å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f # ğŸ’¾ å¤‡ä»½æ•°æ® tar -czf hd-icons-backup-$(date +%Y%m%d).tar.gz ./icons 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker ps -a # ğŸƒ æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # â¹ï¸ åœæ­¢å®¹å™¨ docker stop hd-Icons # â–¶ï¸ å¯åŠ¨å®¹å™¨ docker start hd-Icons # ğŸ”„ é‡å¯å®¹å™¨ docker restart hd-Icons # ğŸ—‘ï¸ åˆ é™¤å®¹å™¨ docker rm hd-Icons # ğŸ”¨ è¿›å…¥å®¹å™¨Shell docker exec -it hd-Icons sh # ğŸ’» åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec hd-Icons ls -la /app # ğŸ“Š æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats hd-Icons # ğŸ” æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect hd-Icons ## ğŸ“ å®¹å™¨æ—¥å¿—ç®¡ç† docker logs hd-Icons # æŸ¥çœ‹æ—¥å¿— docker logs -f hd-Icons # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 hd-Icons # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t hd-Icons # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— docker logs --since 1h hd-Icons # æŸ¥çœ‹æœ€è¿‘1å°æ—¶æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ğŸ“· åˆ—å‡ºæ‰€æœ‰é•œåƒ docker images # ğŸ—‘ï¸ åˆ é™¤æŒ‡å®šé•œåƒ docker rmi xushier/hd-icons:latest # ğŸ§¹ æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -f # ğŸ—‚ï¸ æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ docker image prune -a -f # ğŸ“¥ æ‹‰å–ç‰¹å®šç‰ˆæœ¬é•œåƒ docker pull xushier/hd-icons:1.0.0 # ğŸ·ï¸ ç»™é•œåƒæ‰“æ ‡ç­¾ docker tag xushier/hd-icons:latest myregistry/hd-icons:latest ğŸŒŸ é«˜æ¸…å›¾æ ‡ï¼Œè®¾è®¡æ— å¿§ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† hd-icons é«˜æ¸…å›¾æ ‡åº“ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¨ ä¸°å¯Œèµ„æº è®¿é—®æµ·é‡é«˜è´¨é‡å›¾æ ‡ï¼Œæ¶µç›–å¤šç§è®¾è®¡é£æ ¼å’Œä¸šåŠ¡åœºæ™¯\nğŸ” æ™ºèƒ½æœç´¢ å¿«é€Ÿå®šä½æ‰€éœ€å›¾æ ‡ï¼Œæ”¯æŒå…³é”®è¯ã€åˆ†ç±»ã€é£æ ¼å¤šç»´åº¦ç­›é€‰\nğŸ“¥ ä¾¿æ·ä¸‹è½½ ä¸€é”®ä¸‹è½½å¤šç§æ ¼å¼å›¾æ ‡ï¼Œæ»¡è¶³ä¸åŒé¡¹ç›®éœ€æ±‚\nâš¡ é«˜æ•ˆç®¡ç† åŸºäºå®¹å™¨åŒ–æ¶æ„ï¼Œè½»æ¾ç»´æŠ¤å’Œæ‰©å±•å›¾æ ‡æœåŠ¡\nğŸŒ å…¨çƒè®¿é—® é€šè¿‡åå‘ä»£ç†é…ç½®ï¼Œå®ç°å®‰å…¨å¿«é€Ÿçš„è¿œç¨‹è®¿é—®\nå›¾æ ‡æ˜¯ç•Œé¢è®¾è®¡çš„çµé­‚ï¼Œå¥½çš„å›¾æ ‡èƒ½å¤Ÿæå‡ç”¨æˆ·ä½“éªŒå’Œäº§å“è´¨æ„Ÿã€‚hd-icons ä¸ºä½ æä¾›äº†å¼ºå¤§çš„å›¾æ ‡èµ„æºæ”¯æŒï¼Œæ— è®ºæ˜¯ï¼š\nğŸ¯ äº§å“å¼€å‘ï¼šä¸º Webã€ç§»åŠ¨ç«¯åº”ç”¨æä¾›ç»Ÿä¸€é£æ ¼çš„å›¾æ ‡ ğŸ¨ è®¾è®¡åˆ›ä½œï¼šå¯»æ‰¾è®¾è®¡çµæ„Ÿå’Œç´ æå‚è€ƒ ğŸš€ é¡¹ç›®åŸå‹ï¼šå¿«é€Ÿæ­å»ºç¾è§‚çš„ç•Œé¢åŸå‹ ğŸ“Š æŠ¥è¡¨ä»ªè¡¨ç›˜ï¼šä¸ºæ•°æ®å¯è§†åŒ–æä¾›æ¸…æ™°çš„å›¾æ ‡å…ƒç´  ä»ç°åœ¨å¼€å§‹ï¼Œè®© hd-icons æˆä¸ºä½ çš„è®¾è®¡åŠ©æ‰‹ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œåˆ›é€ æ›´ç¾è§‚çš„æ•°å­—äº§å“ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®å…³æ³¨ hd-icons å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°å›¾æ ‡å’ŒåŠŸèƒ½ä¼˜åŒ–ã€‚\nğŸ› é—®é¢˜åé¦ˆï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nğŸ¤ ç¤¾åŒºè´¡çŒ®ï¼šæ¬¢è¿æäº¤ Pull Requestï¼Œå…±åŒå®Œå–„è¿™ä¸ªä¼˜ç§€çš„å›¾æ ‡åº“é¡¹ç›®ã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè®¾è®¡å‡ºå½©ï¼ğŸ‰\n","date":"2025-11-15T08:36:35+08:00","image":"https://file.meimolihan.eu.org/img/hd-icons-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b4b5678e/","title":"Docker éƒ¨ç½² Hd Icons é«˜æ¸…å›¾æ ‡åº“ ğŸ³"},{"content":"Docker éƒ¨ç½² Panhub ç½‘ç›˜æœç´¢ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Panhub 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Panhub 1. è®¿é—® Web ç•Œé¢ ğŸŒ 2. åŸºæœ¬æœç´¢æ“ä½œ ğŸ” ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæœç´¢ï¼Œèµ„æºæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/wu529778790/panhub.shenzjd.com Panhub æ˜¯ä¸€ä¸ªåŸºäº Cloudflare Workers çš„é«˜æ€§èƒ½ç½‘ç›˜èµ„æºæœç´¢æœåŠ¡ï¼Œæ”¯æŒ Telegram é¢‘é“æœç´¢å’Œè‡ªå®šä¹‰æ’ä»¶æœç´¢ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸ªäººæˆ–å›¢é˜Ÿä½¿ç”¨çš„æ–‡ä»¶æœç´¢æœåŠ¡ã€‚ğŸŒŸ\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ” é«˜æ€§èƒ½æœç´¢ åŸºäº Cloudflare Workers æ¶æ„ï¼Œå…¨çƒ CDN åŠ é€Ÿ æ¯«ç§’çº§å“åº”é€Ÿåº¦ï¼Œå…¨çƒç”¨æˆ·å¿«é€Ÿè®¿é—® ğŸ“ å¤šç½‘ç›˜æ”¯æŒ æ”¯æŒç™¾åº¦ç½‘ç›˜ã€é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ã€å¤©ç¿¼äº‘ç›˜ç­‰ä¸»æµç½‘ç›˜ ç»Ÿä¸€è®¿é—®å¤šä¸ªç½‘ç›˜èµ„æºï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶æŒ‰ç±»å‹åˆ†ç±» ğŸ§  æ™ºèƒ½æ’åº åŸºäºæ’ä»¶ç­‰çº§ã€æ—¶é—´æ–°é²œåº¦å’Œä¼˜å…ˆå…³é”®è¯çš„å¤šç»´åº¦ç»¼åˆæ’åºç®—æ³• è®©ä¼˜è´¨ã€æ–°é²œä¸”ç¬¦åˆéœ€æ±‚çš„èµ„æºä¼˜å…ˆå±•ç¤º ğŸ”Œ æ’ä»¶ç³»ç»Ÿ æ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•æœç´¢æ¥æºï¼Œé‡‡ç”¨å¼‚æ­¥æœç´¢æ¨¡å¼ çµæ´»æ‰©å±•æœç´¢æºï¼Œè§£å†³æŸäº›æœç´¢æºå“åº”æ—¶é—´é•¿çš„é—®é¢˜ ğŸ’¾ ç¼“å­˜æœºåˆ¶ è¿ç”¨é«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥ æå‡é‡å¤æŸ¥è¯¢é€Ÿåº¦å’Œå¹¶å‘æ€§èƒ½ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker é›†æˆï¼Œä¸€é”®å¯åŠ¨ å¼€ç®±å³ç”¨ï¼Œéƒ¨ç½²ç®€å•å¿«æ· ğŸŒ å…¨çƒåŠ é€Ÿ åŸºäº Cloudflare å…¨çƒç½‘ç»œ æ— è®ºç”¨æˆ·åœ¨å“ªé‡Œéƒ½èƒ½è·å¾—å¿«é€Ÿä½“éªŒ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Panhub 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 mkdir -p /vol1/1000/compose/panhub \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: panhub: image: wu529778790/panhub.shenzjd.com:latest container_name: panhub restart: always ports: - 3020:3000 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Panhub 1. è®¿é—® Web ç•Œé¢ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š\næœ¬åœ°è®¿é—®: http://localhost:3020 åŸŸåè®¿é—®: https://panhub.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åŸºæœ¬æœç´¢æ“ä½œ ğŸ” æ“ä½œ è¯´æ˜ ç¤ºä¾‹ ğŸ” å…³é”®è¯æœç´¢ åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æƒ³è¦æŸ¥æ‰¾çš„èµ„æºå…³é”®è¯ \u0026ldquo;ç”µå½±åç§°\u0026rdquo;ã€\u0026ldquo;è½¯ä»¶åç§°\u0026rdquo;ã€\u0026ldquo;æ•™ç¨‹\u0026quot;ç­‰ ğŸ“ ç»“æœç­›é€‰ æŒ‰ç½‘ç›˜ç±»å‹ç­›é€‰æœç´¢ç»“æœ ç™¾åº¦ç½‘ç›˜ã€é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ç­‰ ğŸ”— é“¾æ¥è®¿é—® ç‚¹å‡»æœç´¢ç»“æœä¸­çš„é“¾æ¥è®¿é—®èµ„æº è‡ªåŠ¨æ˜¾ç¤ºæå–ç ï¼ˆå¦‚æœ‰ï¼‰ ğŸ“Š çŠ¶æ€æŸ¥çœ‹ æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œæœç´¢æ€§èƒ½ é€šè¿‡ç•Œé¢ç›‘æ§æœç´¢å“åº”æƒ…å†µ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://panhub.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/panhub.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; http2 on; server_name panhub.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; # TLS å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å“åº”å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options SAMEORIGIN always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # åå‘ä»£ç†é…ç½® location / { proxy_pass http://localhost:3020; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/panhub # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop panhub # åœæ­¢å®¹å™¨ docker start panhub # å¯åŠ¨å®¹å™¨ docker restart panhub # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm panhub # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f panhub # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it panhub sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it panhub bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it panhub sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec panhub ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect panhub # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats panhub # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs panhub # æŸ¥çœ‹æ—¥å¿— docker logs -f panhub # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 panhub # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t panhub # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi wu529778790/panhub.shenzjd.com:latest # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæœç´¢ï¼Œèµ„æºæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Panhub ç½‘ç›˜æœç´¢æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ” é«˜æ•ˆæ£€ç´¢ å¿«é€Ÿå®šä½å…¨ç½‘ç›˜èµ„æºï¼Œæ™ºèƒ½æ’åºè®©ä¼˜è´¨å†…å®¹ä¼˜å…ˆå‘ˆç°\nğŸŒ å¤šæºèšåˆ ä¸€ç«™å¼æœç´¢å¤šä¸ªä¸»æµç½‘ç›˜ï¼Œé¿å…å¹³å°é—´æ¥å›åˆ‡æ¢çš„ç¹ç\nâš¡ æé€Ÿå“åº” åŸºäº Cloudflare Workers æ¶æ„ï¼Œäº«å—æ¯«ç§’çº§çš„æœç´¢ä½“éªŒ\nğŸŒ å…¨çƒåŠ é€Ÿ æ— è®ºèº«å¤„ä½•åœ°ï¼Œéƒ½èƒ½è·å¾—å¿«é€Ÿç¨³å®šçš„æœç´¢æœåŠ¡\næœç´¢ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ä¿¡æ¯èµ„æºç›¸ä¼´çš„å‘ç°æ—…ç¨‹ã€‚æ„¿ Panhub æˆä¸ºä½ é«˜æ•ˆçš„æœç´¢åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡èµ„æºå¯»æ‰¾å’Œä¿¡æ¯è·å–çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ™ºèƒ½æœç´¢ï¼Œèµ„æºæ— å¿§â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„èµ„æºå‘ç°å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Panhub å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æœç´¢é¡ºåˆ©ï¼Œèµ„æºä¸°å¯Œï¼ğŸ‰\n","date":"2025-10-24T11:33:06+08:00","image":"https://file.meimolihan.eu.org/img/docker-panhub-01.webp","permalink":"https://blog.meimolihan.eu.org/p/10c1018f/","title":"Docker éƒ¨ç½² Panhub ç½‘ç›˜æœç´¢ ğŸ³"},{"content":"Docker ç”¨æˆ·ç»„ç®¡ç†æŒ‡å— ğŸ³ ğŸ“Œ é€‚ç”¨äº Debian/Ubuntu ç­‰ä½¿ç”¨ sudo çš„ç³»ç»Ÿï¼›å…¶ä»–å‘è¡Œç‰ˆå°† usermod/deluser æ¢æˆå¯¹åº”å‘½ä»¤å³å¯ã€‚\nğŸ“š å¯¼èˆªç›®å½• ğŸ¯ å¼•è¨€ä¸æ¦‚è¿° âœ¨ Docker ç”¨æˆ·ç»„çš„ç‰¹ç‚¹ä¸é‡è¦æ€§ ğŸ”§ å‡†å¤‡å·¥ä½œä¸å‰ææ¡ä»¶ ğŸ“ Docker ç”¨æˆ·ç»„ç®¡ç†æ“ä½œæŒ‡å— ğŸ‘€ æŸ¥çœ‹å½“å‰ docker ç»„å†…ç”¨æˆ· â• æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ ğŸ”„ ç«‹å³ç”Ÿæ•ˆç»„æƒé™ â– æ’¤é”€ç”¨æˆ· Docker æƒé™ âœ… éªŒè¯ä¸æµ‹è¯• âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ ğŸ¯ å¼•è¨€ä¸æ¦‚è¿° Docker ç”¨æˆ·ç»„ç®¡ç†æ˜¯ Linux ç³»ç»Ÿä¸­é…ç½® Docker æƒé™çš„é‡è¦ç¯èŠ‚ã€‚é€šè¿‡åˆç†çš„ç”¨æˆ·ç»„é…ç½®ï¼Œå¯ä»¥å®ç° Docker å‘½ä»¤çš„å… sudo æ‰§è¡Œï¼ŒåŒæ—¶ç¡®ä¿ç³»ç»Ÿå®‰å…¨æ€§ã€‚\nâœ¨ Docker ç”¨æˆ·ç»„çš„ç‰¹ç‚¹ä¸é‡è¦æ€§ ğŸ” æ ¸å¿ƒç‰¹ç‚¹ æƒé™ä¾¿åˆ©æ€§ ğŸš€ï¼šå…å»æ¯æ¬¡æ‰§è¡Œ Docker å‘½ä»¤éƒ½éœ€è¦è¾“å…¥ sudo çš„ç¹ç ç”¨æˆ·éš”ç¦» ğŸ‘¥ï¼šç²¾ç¡®æ§åˆ¶å“ªäº›ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Docker æœåŠ¡ ç³»ç»Ÿå®‰å…¨ ğŸ›¡ï¸ï¼šé¿å…è¿‡åº¦ä½¿ç”¨ root æƒé™å¸¦æ¥çš„å®‰å…¨é£é™© ğŸ’¡ åŠŸèƒ½ä¼˜åŠ¿ å¿«é€Ÿéƒ¨ç½²ï¼šç®€åŒ–å¼€å‘ç¯å¢ƒçš„é…ç½®æµç¨‹ å›¢é˜Ÿåä½œï¼šæ–¹ä¾¿åœ¨å¤šç”¨æˆ·ç¯å¢ƒä¸­ç®¡ç† Docker è®¿é—®æƒé™ æƒé™æ§åˆ¶ï¼šç»†ç²’åº¦çš„ç”¨æˆ·æƒé™ç®¡ç†æœºåˆ¶ ğŸ”§ å‡†å¤‡å·¥ä½œä¸å‰ææ¡ä»¶ åœ¨å¼€å§‹æ“ä½œå‰ï¼Œè¯·ç¡®ä¿ï¼š\nâœ… Docker å·²æ­£ç¡®å®‰è£…å¹¶è¿è¡Œ âœ… æ‚¨æ‹¥æœ‰ sudo æƒé™æˆ– root è®¿é—®æƒé™ âœ… äº†è§£è¦ç®¡ç†çš„ç›®æ ‡ç”¨æˆ·å ğŸ“ Docker ç”¨æˆ·ç»„ç®¡ç†æ“ä½œæŒ‡å— ğŸ‘€ æŸ¥çœ‹å½“å‰ docker ç»„å†…ç”¨æˆ· 1 getent group docker è¾“å‡ºç¤ºä¾‹ä¸è§£è¯»ï¼š\n1 docker:x:994:alice,bob dockerï¼šç»„åç§° xï¼šå¯†ç å ä½ç¬¦ï¼ˆå®é™…å¯†ç å­˜å‚¨åœ¨ /etc/gshadowï¼‰ 994ï¼šç»„IDï¼ˆGIDï¼‰ alice,bobï¼šå½“å‰ç»„æˆå‘˜ï¼ˆæ‹¥æœ‰ Docker å… sudo æƒé™ï¼‰ â• æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ å°†å½“å‰ç™»å½•ç”¨æˆ·åŠ å…¥ docker ç»„ï¼š\n1 sudo usermod -aG docker $USER å‚æ•°è¯´æ˜ï¼š\n-aï¼šè¿½åŠ åˆ°ç°æœ‰ç»„ï¼Œä¸è¦†ç›–å…¶ä»–ç»„æˆå‘˜èº«ä»½ -Gï¼šæŒ‡å®šè¦åŠ å…¥çš„é™„åŠ ç»„ å†æ¬¡ç¡®è®¤æ·»åŠ ç»“æœï¼š\n1 getent group docker æ­¤æ—¶åº”èƒ½çœ‹åˆ° $USER å·²è¿½åŠ åˆ°åˆ—è¡¨æœ«å°¾ã€‚\nğŸ”„ ç«‹å³ç”Ÿæ•ˆç»„æƒé™ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ newgrp å‘½ä»¤\n1 newgrp docker ğŸ’¡ è¯¥å‘½ä»¤ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„å­ shellï¼Œç»§æ‰¿æ›´æ–°åçš„ç»„ä¿¡æ¯ã€‚\næ–¹æ³•äºŒï¼šé‡æ–°ç™»å½•ç³»ç»Ÿ\n1 2 3 # å¦‚æœä½¿ç”¨ SSHï¼Œé‡æ–°è¿æ¥ä¸€æ¬¡å³å¯ exit # é‡æ–°ç™»å½• â– æ’¤é”€ç”¨æˆ· Docker æƒé™ æ–¹æ³•ä¸€ï¼šDebian/Ubuntu ä¸“ç”¨\n1 sudo deluser $USER docker æ–¹æ³•äºŒï¼šé€šç”¨æ–¹æ³•ï¼ˆæ¨èï¼‰\n1 sudo gpasswd -d $USER docker æƒé™ç”Ÿæ•ˆï¼š æ‰§è¡Œå®Œåéœ€è¦é‡æ–°ç™»å½•æˆ–ä½¿ç”¨ newgrp - è¿”å›åŸç»„ï¼Œæƒé™å³å¤±æ•ˆã€‚\nâœ… éªŒè¯ä¸æµ‹è¯• æ£€æŸ¥å½“å‰ç”¨æˆ·æ‰€å±ç»„ï¼š\n1 groups æµ‹è¯• Docker æƒé™ï¼š\n1 2 docker ps docker version è‹¥æ— éœ€ sudo å³å¯æ‰§è¡Œï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚\nâš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ ğŸ”’ å®‰å…¨è­¦å‘Š ğŸš¨ åŠ å…¥ docker ç»„ â‰ˆ æˆäºˆ root æƒé™ï¼Œè¯·è°¨æ…æ“ä½œ ğŸš¨ ä»…å‘å¯ä¿¡ç”¨æˆ·æˆäºˆ Docker ç»„æƒé™ ğŸš¨ å®šæœŸå®¡è®¡ docker ç»„æˆå‘˜ ğŸ’¼ ç”Ÿäº§ç¯å¢ƒå»ºè®® Rootless Mode ğŸ”ï¼š\n1 dockerd-rootless-setuptool.sh install ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹ æä¾›æ›´å¥½çš„å®‰å…¨éš”ç¦» Sudoers ç²¾ç»†æ§åˆ¶ ğŸ“‹ï¼š\n1 2 # åœ¨ /etc/sudoers.d/docker ä¸­æ·»åŠ ç‰¹å®šå‘½ä»¤æˆæƒ username ALL=(root) NOPASSWD: /usr/bin/docker å®šæœŸå®¡è®¡ ğŸ”ï¼š\n1 2 3 4 # å®šæœŸæ£€æŸ¥ docker ç»„æˆå‘˜ getent group docker # æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€ systemctl status docker ğŸ’¡ æ€»ç»“ï¼šDocker ç”¨æˆ·ç»„ç®¡ç†æ˜¯å¹³è¡¡ä¾¿åˆ©æ€§ä¸å®‰å…¨æ€§çš„é‡è¦ç¯èŠ‚ã€‚é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†æŒ‡å—ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç† Docker æƒé™ï¼ŒåŒæ—¶ç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚è®°å¾—å®šæœŸå®¡æŸ¥æƒé™è®¾ç½®ï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼\n","date":"2025-10-19T18:11:37+08:00","image":"https://file.meimolihan.eu.org/img/docker-user.webp","permalink":"https://blog.meimolihan.eu.org/p/ef21f747/","title":"Docker ç”¨æˆ·ç»„ç®¡ç†æŒ‡å— ğŸ³"},{"content":"Linux ç—…æ¯’æ’æŸ¥æŒ‡å— ğŸ” æœ¬æŒ‡å—æ˜¯ä¸€ä»½å…¨é¢ä¸”å®ç”¨çš„Linuxç—…æ¯’æ’æŸ¥å®æˆ˜æ‰‹å†Œï¼Œä»æœ€åˆçš„ç—‡çŠ¶è¯†åˆ«åˆ°æœ€ç»ˆçš„æ¸…é™¤ä¿®å¤ï¼Œæä¾›äº†å®Œæ•´çš„æ’æŸ¥æµç¨‹å’Œå…·ä½“çš„æ“ä½œå‘½ä»¤ã€‚æ— è®ºä½ æ˜¯é­é‡äº†æŒ–çŸ¿ç—…æ¯’ã€å‹’ç´¢è½¯ä»¶ï¼Œè¿˜æ˜¯å…¶ä»–ç±»å‹çš„æ¶æ„ç¨‹åºï¼Œéƒ½èƒ½é€šè¿‡æœ¬æŒ‡å—æä¾›çš„ç³»ç»ŸåŒ–æ–¹æ³•å¿«é€Ÿå®šä½é—®é¢˜å¹¶æœ‰æ•ˆè§£å†³ã€‚ å¯¼èˆªç›®å½• ğŸ“š âš¡ ä¸€ã€æŸ¥çœ‹å¼•èµ·CPUé£™é«˜çš„è¿›ç¨‹ ğŸ‘» äºŒã€æ£€æŸ¥éšè—è¿›ç¨‹ ğŸ“ ä¸‰ã€å®šä½ç—…æ¯’æ–‡ä»¶ â° å››ã€æ£€æŸ¥ç³»ç»Ÿè®¡åˆ’ä»»åŠ¡ ğŸŒ äº”ã€ç½‘ç»œè¿æ¥æ£€æŸ¥ ğŸ“Š å…­ã€ç³»ç»Ÿæ—¥å¿—åˆ†æ ğŸ“‚ ä¸ƒã€æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ ğŸ§¹ å…«ã€æ¸…é™¤å’Œä¿®å¤ ğŸ›¡ï¸ ä¹ã€é¢„é˜²æªæ–½ ä¸€ã€âš¡ æŸ¥çœ‹å¼•èµ·CPUé£™é«˜çš„è¿›ç¨‹ ğŸ“Š ä½¿ç”¨ top å‘½ä»¤ 1 top ç‰¹ç‚¹ï¼šæŒ‰ P é”®æŒ‰ CPU ä½¿ç”¨ç‡æ’åºï¼Œå®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºå ç”¨æƒ…å†µ âœ¨\nğŸ–¥ï¸ ä½¿ç”¨ htopï¼ˆæ›´ç›´è§‚ï¼‰ 1 2 3 # å¦‚æœæœªå®‰è£…ï¼Œå…ˆå®‰è£… apt install htop htop ä¼˜åŠ¿ï¼šå½©è‰²ç•Œé¢ï¼Œæ›´ç›´è§‚çš„è¿›ç¨‹æ ‘å±•ç¤ºï¼Œæ”¯æŒé¼ æ ‡æ“ä½œ ğŸ¯\nğŸ” ä½¿ç”¨ ps å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ… 1 2 3 4 5 # æŒ‰CPUä½¿ç”¨ç‡æ’åº ps aux --sort=-%cpu | head -10 # æŒ‰å†…å­˜ä½¿ç”¨ç‡æ’åº ps aux --sort=-%mem | head -10 åŠŸèƒ½ï¼šç²¾ç¡®è·å–èµ„æºå ç”¨æœ€é«˜çš„å‰10ä¸ªè¿›ç¨‹ ğŸ“ˆ\näºŒã€ğŸ‘» æ£€æŸ¥éšè—è¿›ç¨‹ ğŸ› ï¸ å®‰è£…å’Œä½¿ç”¨ unhide å·¥å…· 1 2 3 4 5 6 7 8 # å®‰è£… unhide apt install -y unhide # å¿«é€Ÿæ‰«æéšè—è¿›ç¨‹ unhide quick # å…¨é¢æ‰«æï¼ˆæ›´è€—æ—¶ï¼‰ unhide brute ç‰¹ç‚¹ï¼šä¸“ä¸šæ£€æµ‹éšè—è¿›ç¨‹å’Œrootkitå·¥å…· ğŸ”§\nğŸ” å…¶ä»–æ£€æµ‹éšè—è¿›ç¨‹çš„æ–¹æ³• 1 2 3 4 # æ£€æŸ¥è¿›ç¨‹ä¸æ–‡ä»¶ç³»ç»Ÿçš„å·®å¼‚ ps -ef | awk \u0026#39;{print $2}\u0026#39; | sort -n \u0026gt; /tmp/ps_pids find /proc -maxdepth 1 -type d -name \u0026#39;[0-9]*\u0026#39; | awk -F\u0026#39;/\u0026#39; \u0026#39;{print $3}\u0026#39; | sort -n \u0026gt; /tmp/proc_pids diff /tmp/ps_pids /tmp/proc_pids åŸç†ï¼šé€šè¿‡å¯¹æ¯”è¿›ç¨‹åˆ—è¡¨å’Œ/procç›®å½•å‘ç°éšè—è¿›ç¨‹ ğŸ•µï¸\nä¸‰ã€ğŸ“ å®šä½ç—…æ¯’æ–‡ä»¶ ğŸ¯ é€šè¿‡è¿›ç¨‹IDå®šä½å¯æ‰§è¡Œæ–‡ä»¶ 1 2 3 4 5 # æŸ¥çœ‹è¿›ç¨‹å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ ll /proc/\u0026lt;PID\u0026gt;/exe # ç¤ºä¾‹ ll /proc/6113/exe ğŸ“ æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯ 1 2 3 4 5 # æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ ps -ef | grep \u0026lt;PID\u0026gt; # ç¤ºä¾‹è¾“å‡º # root 4136 1 98 13:50 ? 00:00:23 /bin/bash /var/tmp/.sys/cpu.sh ğŸ“‚ æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ 1 2 3 4 5 # æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ lsof -p \u0026lt;PID\u0026gt; # æŸ¥çœ‹è¿›ç¨‹çš„å·¥ä½œç›®å½• ll /proc/\u0026lt;PID\u0026gt;/cwd ğŸ”§ æ£€æŸ¥è¿›ç¨‹ç¯å¢ƒå˜é‡ 1 cat /proc/\u0026lt;PID\u0026gt;/environ | tr \u0026#39;\\0\u0026#39; \u0026#39;\\n\u0026#39; åŠŸèƒ½ï¼šæŸ¥çœ‹è¿›ç¨‹è¿è¡Œæ—¶çš„ç¯å¢ƒé…ç½®ï¼Œå‘ç°å¼‚å¸¸å˜é‡ âš™ï¸\nå››ã€â° æ£€æŸ¥ç³»ç»Ÿè®¡åˆ’ä»»åŠ¡ ğŸ‘¤ æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 # æŸ¥çœ‹å½“å‰ç”¨æˆ·è®¡åˆ’ä»»åŠ¡ crontab -l # æŸ¥çœ‹rootç”¨æˆ·è®¡åˆ’ä»»åŠ¡ï¼ˆéœ€è¦rootæƒé™ï¼‰ crontab -u root -l ğŸ“ æ£€æŸ¥ç³»ç»Ÿè®¡åˆ’ä»»åŠ¡ç›®å½• 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ç³»ç»Ÿè®¡åˆ’ä»»åŠ¡ç›®å½• ls -la /etc/cron.d/ ls -la /etc/cron.hourly/ ls -la /etc/cron.daily/ ls -la /etc/cron.weekly/ ls -la /etc/cron.monthly/ # æŸ¥çœ‹ /etc/crontab æ–‡ä»¶ cat /etc/crontab ğŸ” æ£€æŸ¥å…¶ä»–å¸¸è§çš„æŒä¹…åŒ–ä½ç½® 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ç³»ç»ŸæœåŠ¡ systemctl list-units --type=service # æ£€æŸ¥å¼€æœºå¯åŠ¨é¡¹ ls -la /etc/rc.local ls -la /etc/init.d/ # æ£€æŸ¥profileæ–‡ä»¶ cat /etc/profile cat ~/.bashrc é‡è¦æ€§ï¼šç—…æ¯’å¸¸åœ¨è¿™äº›ä½ç½®è®¾ç½®æŒä¹…åŒ–æœºåˆ¶ ğŸ”„\näº”ã€ğŸŒ ç½‘ç»œè¿æ¥æ£€æŸ¥ ğŸ” æŸ¥çœ‹å¼‚å¸¸ç½‘ç»œè¿æ¥ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œè¿æ¥ netstat -tunlp # ä½¿ç”¨sså‘½ä»¤ï¼ˆæ›´ç°ä»£ï¼‰ ss -tunlp # æŸ¥çœ‹å¯ç–‘çš„å¯¹å¤–è¿æ¥ netstat -anp | grep ESTABLISHED ğŸ“¡ æ£€æŸ¥è¿›ç¨‹ç½‘ç»œè¿æ¥ 1 2 3 4 5 # æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„ç½‘ç»œè¿æ¥ lsof -i -P -n | grep \u0026lt;PID\u0026gt; # æˆ–è€…ä½¿ç”¨ netstat -tunlp | grep \u0026lt;PID\u0026gt; åŠŸèƒ½ï¼šå‘ç°å¼‚å¸¸å¤–è¿è¡Œä¸ºï¼Œè¯†åˆ«C\u0026amp;CæœåŠ¡å™¨é€šä¿¡ ğŸŒ\nå…­ã€ğŸ“Š ç³»ç»Ÿæ—¥å¿—åˆ†æ ğŸ“ æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— tail -f /var/log/syslog tail -f /var/log/messages # æŸ¥çœ‹è®¤è¯æ—¥å¿— tail -f /var/log/auth.log # ä½¿ç”¨journalctlï¼ˆsystemdç³»ç»Ÿï¼‰ journalctl -f ç‰¹ç‚¹ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿæ´»åŠ¨ï¼Œå‘ç°å¼‚å¸¸ç™»å½•å’Œæ‰§è¡Œè®°å½• ğŸ”\nä¸ƒã€ğŸ“‚ æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ ğŸ” æŸ¥æ‰¾å¯ç–‘æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 # æŸ¥æ‰¾è¿‘æœŸä¿®æ”¹çš„æ–‡ä»¶ find / -mtime -7 -type f 2\u0026gt;/dev/null # æŸ¥æ‰¾éšè—æ–‡ä»¶å’Œç›®å½• find / -name \u0026#34;.*\u0026#34; -type f 2\u0026gt;/dev/null find / -name \u0026#34;.*\u0026#34; -type d 2\u0026gt;/dev/null # æŸ¥æ‰¾å¯ç–‘çš„è„šæœ¬æ–‡ä»¶ find / -name \u0026#34;*.sh\u0026#34; -o -name \u0026#34;*.pl\u0026#34; -o -name \u0026#34;*.py\u0026#34; 2\u0026gt;/dev/null æŠ€å·§ï¼šé‡ç‚¹å…³æ³¨/tmpã€/var/tmpç­‰ä¸´æ—¶ç›®å½• ğŸ¯\nå…«ã€ğŸ§¹ æ¸…é™¤å’Œä¿®å¤ ğŸš« ç»ˆæ­¢æ¶æ„è¿›ç¨‹ 1 2 3 4 5 # ç»ˆæ­¢è¿›ç¨‹ kill -9 \u0026lt;PID\u0026gt; # å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ pkill -9 -f \u0026#34;process_name\u0026#34; ğŸ—‘ï¸ åˆ é™¤æ¶æ„æ–‡ä»¶ 1 2 3 4 5 6 # åˆ é™¤ç—…æ¯’æ–‡ä»¶ rm -f /path/to/malicious/file # å¦‚æœæ˜¯åªè¯»æ–‡ä»¶ï¼Œå…ˆå–æ¶ˆåªè¯»å±æ€§ chattr -i /path/to/malicious/file rm -f /path/to/malicious/file ğŸ“‹ æ¸…ç†è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 # ç¼–è¾‘è®¡åˆ’ä»»åŠ¡å¹¶åˆ é™¤æ¶æ„æ¡ç›® crontab -e # æˆ–è€…ç›´æ¥åˆ é™¤æ‰€æœ‰è®¡åˆ’ä»»åŠ¡ crontab -r ä¹ã€ğŸ›¡ï¸ é¢„é˜²æªæ–½ ğŸ”’ ç³»ç»Ÿå®‰å…¨åŠ å›º 1 2 3 4 5 6 7 8 9 # ä¿æŒç³»ç»Ÿæ›´æ–° apt update \u0026amp;\u0026amp; apt upgrade # å®‰è£…å®‰å…¨å·¥å…· apt install -y fail2ban rkhunter chkrootkit # å®šæœŸæ‰«æ rkhunter --check chkrootkit æ¨èå·¥å…·ï¼š\nfail2ban ğŸš« - é˜²æ­¢æš´åŠ›ç ´è§£ rkhunter ğŸ” - Rootkitæ£€æµ‹ chkrootkit ğŸ›¡ï¸ - ç³»ç»Ÿå®Œæ•´æ€§æ£€æŸ¥ ğŸ“ˆ ç›‘æ§ç³»ç»Ÿèµ„æº 1 2 3 4 # å®‰è£…ç›‘æ§å·¥å…· apt install -y nmon iotop iftop # è®¾ç½®èµ„æºç›‘æ§å‘Šè­¦ ç›‘æ§é‡ç‚¹ï¼šCPUå¼‚å¸¸ã€å†…å­˜æ³„æ¼ã€å¼‚å¸¸ç½‘ç»œæµé‡ ğŸ“Š\nğŸ’¡ æ€»ç»“ é€šè¿‡ä»¥ä¸Šç³»ç»Ÿçš„æ’æŸ¥æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‘ç°å’Œå¤„ç†Linuxç³»ç»Ÿä¸­çš„ç—…æ¯’å’Œæ¶æ„ç¨‹åº âœ¨ã€‚å»ºè®®å®šæœŸè¿›è¡Œç³»ç»Ÿå®‰å…¨æ£€æŸ¥ï¼Œå¹¶ä¿æŒç³»ç»Ÿå’Œå®‰å…¨å·¥å…·çš„æ›´æ–°ï¼Œæ„å»ºå¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤ä½“ç³» ğŸ›¡ï¸ã€‚\næœ€ä½³å®è·µï¼š\nå®šæœŸå¤‡ä»½é‡è¦æ•°æ® ğŸ’¾ å®æ–½æœ€å°æƒé™åŸåˆ™ ğŸ” å¯ç”¨ç³»ç»Ÿå®¡è®¡åŠŸèƒ½ ğŸ“ å»ºç«‹å®‰å…¨ç›‘æ§å‘Šè­¦ ğŸš¨ è®°ä½ï¼šé¢„é˜²èƒœäºæ²»ç–—ï¼å»ºç«‹å®Œå–„çš„å®‰å…¨é˜²æŠ¤ä½“ç³»æ˜¯é¿å…ç—…æ¯’å…¥ä¾µçš„æœ€ä½³ç­–ç•¥ ğŸ¯ã€‚\n","date":"2025-10-15T09:29:38+08:00","image":"https://file.meimolihan.eu.org/img/linux-virus-01.webp","permalink":"https://blog.meimolihan.eu.org/p/30d9ab8f/","title":"Linux ç—…æ¯’æ’æŸ¥æŒ‡å— ğŸ”"},{"content":"DigitalPlat å…è´¹åŸŸåå¹¶æ‰˜ç®¡åˆ° CloudFlare ğŸ“– å¯¼èˆªç›®å½• ğŸ“– æ–¹æ¡ˆæ¦‚è§ˆ ğŸ“ ç”³è¯·æµç¨‹ ğŸ” æ£€æŸ¥å¹¶æ³¨å†ŒåŸŸå ğŸ‘¤ æ³¨å†Œ DigitalPlat è´¦å· â˜ï¸ æ‰˜ç®¡åˆ° CloudFlare ğŸ”„ è‡ªåŠ¨ç»­æœŸ \u0026amp; æé†’éƒ¨ç½² âš™ï¸ åˆ›å»º CloudFlare Worker ğŸ—‚ï¸ åˆ›å»º KV å‘½åç©ºé—´ ğŸ”— ç»‘å®š KV å¹¶è®¾ç½®å®šæ—¶è§¦å‘ ğŸ“Š è®¿é—®ç®¡ç†é¢æ¿ ğŸ“¢ Telegram æé†’é…ç½® â“ å¸¸è§é—®é¢˜ é›¶åº¦è§£è¯´è§†é¢‘æ•™ç¨‹ ğŸ“– ä¸€ã€æ–¹æ¡ˆæ¦‚è§ˆ âœ¨ æ ¸å¿ƒä¼˜åŠ¿ï¼š\nğŸ†“ å®Œå…¨å…è´¹ï¼šæ— éœ€æ”¯ä»˜ä»»ä½•è´¹ç”¨å³å¯è·å¾—ä¸“å±åŸŸå ğŸŒ ä¼˜è´¨åç¼€ï¼šä½¿ç”¨ .dpdns.org åç¼€ï¼Œç”±éç›ˆåˆ©ç»„ç»‡ DigitalPlat æä¾› ğŸ”„ é•¿æœŸç¨³å®šï¼šæ¯ 180 å¤©æ‰‹åŠ¨ç»­æœŸä¸€æ¬¡ï¼Œç¡®ä¿åŸŸåæŒç»­ä½¿ç”¨ âš¡ é«˜æ€§èƒ½ï¼šå¯æ‰˜ç®¡è‡³ CloudFlareï¼Œäº«å—å…¨çƒ CDN åŠ é€Ÿ ğŸ“± æ™ºèƒ½æé†’ï¼šæ”¯æŒé‚®ä»¶ã€Telegramã€å¾®ä¿¡ç­‰å¤šç§åˆ°æœŸæé†’æ–¹å¼ ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹ï¼š\nDNS è§£æé€Ÿåº¦å¿«ï¼Œç¨³å®šæ€§é«˜ æ”¯æŒ SSL è¯ä¹¦ï¼Œç¡®ä¿ç½‘ç«™å®‰å…¨ å¯ä¸ CloudFlare å…¶ä»–æœåŠ¡æ— ç¼é›†æˆ ğŸ“ äºŒã€ç”³è¯·æµç¨‹ ğŸ” 1. æ£€æŸ¥å¹¶æ³¨å†ŒåŸŸå ğŸ“Œ æ“ä½œæ­¥éª¤ï¼š\næ‰“å¼€ç”³è¯·é¡µé¢ï¼š https://digitalplat.org åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å¿ƒä»ªçš„åŸŸåï¼Œä¾‹å¦‚ lingdu8.dpdns.org ç³»ç»Ÿä¼šç«‹å³æ˜¾ç¤ºåŸŸåæ˜¯å¦å¯ç”¨ å¦‚æœæ˜¾ç¤º\u0026quot;å¯ç”¨\u0026quot;ï¼Œç‚¹å‡»æ³¨å†ŒæŒ‰é’®ç»§ç»­ ğŸ’¡ å‘½åå»ºè®®ï¼š\né€‰æ‹©ç®€çŸ­æ˜“è®°çš„åç§° é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ å»ºè®®ä¸ä¸ªäººå“ç‰Œæˆ–é¡¹ç›®ç›¸å…³ ğŸ‘¤ 2. æ³¨å†Œ DigitalPlat è´¦å· ğŸ“‹ æ³¨å†Œä¿¡æ¯ï¼š\nğŸ”— æ³¨å†Œåœ°å€ï¼š https://dash.domain.digitalplat.org/auth/register ğŸ”‘ ç™»å½•åœ°å€ï¼š https://dash.domain.digitalplat.org/auth/login âš ï¸ é‡è¦æé†’ï¼š\nåŠ¡å¿…ä½¿ç”¨å¸¸ç”¨ä¸”å¯é çš„ç”µå­é‚®ç®± å»ºè®®ä½¿ç”¨ Gmailã€Outlook ç­‰å›½é™…é‚®ç®±æœåŠ¡ å¦¥å–„ä¿å­˜ç™»å½•å‡­è¯ï¼Œå®šæœŸæ£€æŸ¥é‚®ç®±ä»¥å…é”™è¿‡ç»­æœŸé€šçŸ¥ â˜ï¸ 3. æ‰˜ç®¡åˆ° CloudFlare ğŸš€ æ‰˜ç®¡æ­¥éª¤ï¼š\nè®¿é—® CloudFlare å®˜ç½‘ ç‚¹å‡»\u0026quot;æ·»åŠ ç«™ç‚¹\u0026quot;ï¼Œè¾“å…¥ä½ çš„å…è´¹åŸŸå é€‰æ‹©å…è´¹è®¡åˆ’ï¼ˆè¶³å¤Ÿä¸ªäººä½¿ç”¨ï¼‰ CloudFlare ä¼šæ˜¾ç¤ºéœ€è¦ä¿®æ”¹çš„ NS è®°å½• å›åˆ° DigitalPlat é¢æ¿ï¼Œå°† NS è®°å½•ä¿®æ”¹ä¸º CloudFlare æä¾›çš„åœ°å€ ğŸ¯ CloudFlare ä¼˜åŠ¿ï¼š\nğŸŒ å…¨çƒ CDN åŠ é€Ÿï¼Œæå‡è®¿é—®é€Ÿåº¦ ğŸ”’ å…è´¹ SSL è¯ä¹¦ï¼Œä¿éšœç½‘ç«™å®‰å…¨ ğŸ“Š è¯¦ç»†çš„è®¿é—®ç»Ÿè®¡å’Œåˆ†æ ğŸ›¡ï¸ DDoS æ”»å‡»é˜²æŠ¤ ğŸ”„ ä¸‰ã€è‡ªåŠ¨ç»­æœŸ \u0026amp; æé†’éƒ¨ç½²ï¼ˆSubsTrackerï¼‰ ğŸ“Œ SubsTracker ç®€ä»‹ï¼š SubsTracker æ˜¯ä¸€ä¸ªå¼€æºçš„é¡¹ç›®è®¢é˜…ç®¡ç†å·¥å…·ï¼Œä¸“é—¨ç”¨äºè·Ÿè¸ªå„ç§æœåŠ¡çš„åˆ°æœŸæ—¶é—´ï¼Œæ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼Œå®Œç¾è§£å†³å…è´¹åŸŸåç»­æœŸæé†’çš„éœ€æ±‚ã€‚\nâš™ï¸ 1. åˆ›å»º CloudFlare Worker ğŸ”§ éƒ¨ç½²æ­¥éª¤ï¼š\nç™»å½• CloudFlare æ§åˆ¶å° è¿›å…¥ Workers \u0026amp; Pages é¡µé¢ ç‚¹å‡» åˆ›å»ºåº”ç”¨ç¨‹åº â†’ åˆ›å»º Worker ä¸º Worker å‘½åï¼ˆå¦‚ substrackerï¼‰ åˆ é™¤é»˜è®¤ä»£ç ï¼Œç²˜è´´ä» GitHub è·å–çš„ SubsTracker ä»£ç  ç‚¹å‡» éƒ¨ç½² å®Œæˆåˆ›å»º ğŸ”— é¡¹ç›®åœ°å€ï¼š https://github.com/wangwangit/SubsTracker ğŸ—‚ï¸ 2. åˆ›å»º KV å‘½åç©ºé—´ ğŸ“ åˆ›å»ºæµç¨‹ï¼š\nåœ¨ CloudFlare æ§åˆ¶å°è¿›å…¥ Workers \u0026amp; Pages é€‰æ‹© KV ç‚¹å‡» åˆ›å»ºå‘½åç©ºé—´ å¿…é¡»å¡«å†™åç§°ï¼šSUBSCRIPTIONS_KV ç‚¹å‡» åˆ›å»º å®Œæˆ ğŸ’¡ é‡è¦æç¤ºï¼š\nå‘½åç©ºé—´åç§°å¿…é¡»å®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ†å¤§å°å†™ è¿™æ˜¯å­˜å‚¨è®¢é˜…æ•°æ®çš„å…³é”®ç»„ä»¶ ğŸ”— 3. ç»‘å®š KV å¹¶è®¾ç½®å®šæ—¶è§¦å‘ ğŸ¯ é…ç½®æ­¥éª¤ï¼š\nç»‘å®š KVï¼š\nè¿›å…¥å·²åˆ›å»ºçš„ Worker ç‚¹å‡» è®¾ç½® â†’ å˜é‡ åœ¨ KV å‘½åç©ºé—´ç»‘å®š éƒ¨åˆ†ç‚¹å‡» æ·»åŠ ç»‘å®š å˜é‡åç§°å¡«å†™ï¼šSUBSCRIPTIONS_KV é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ KV å‘½åç©ºé—´ è®¾ç½®å®šæ—¶è§¦å‘ï¼š\nåœ¨ Worker è®¾ç½®ä¸­æ‰¾åˆ° è§¦å‘å™¨ ç‚¹å‡» æ·»åŠ  Cron è§¦å‘å™¨ è¾“å…¥ Cron è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š 0 9 * * * â†’ æ¯å¤©ä¸Šåˆ 9 ç‚¹æ£€æŸ¥ 0 9 * * 1 â†’ æ¯å‘¨ä¸€ä¸Šåˆ 9 ç‚¹æ£€æŸ¥ ä¿å­˜è®¾ç½® ğŸ“Š 4. è®¿é—®ç®¡ç†é¢æ¿ ğŸŒ è®¿é—®æ–¹å¼ï¼š\nWorker éƒ¨ç½²æˆåŠŸåï¼Œä¼šè·å¾—ä¸€ä¸ª *.workers.dev çš„è®¿é—®åœ°å€ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥åœ°å€ ä½¿ç”¨é»˜è®¤è´¦å·å¯†ç ç™»å½•ï¼š ğŸ‘¤ ç”¨æˆ·åï¼šadmin ğŸ”‘ å¯†ç ï¼špassword ğŸ”’ å®‰å…¨å»ºè®®ï¼š\nç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  å¯ä»¥å°†è‡ªå·±çš„å…è´¹åŸŸåé€šè¿‡ CNAME è®°å½•æŒ‡å‘ Worker åœ°å€ è¿™æ ·æ—¢æ–¹ä¾¿è®°å¿†ï¼Œåˆæå‡ä¸“ä¸šæ€§ ğŸ“¢ å››ã€Telegram æé†’é…ç½® ğŸ¤– é…ç½®æµç¨‹ï¼š\né…ç½®é¡¹ è·å–æ–¹å¼ è¯´æ˜ Bot Token åœ¨ Telegram ä¸­æœç´¢ @BotFather â†’ /newbot â†’ æŒ‰æç¤ºåˆ›å»º è¿™æ˜¯æœºå™¨äººçš„å”¯ä¸€èº«ä»½æ ‡è¯† Chat ID åˆ›å»ºé¢‘é“/ç¾¤ç»„ â†’ è½¬å‘ä»»æ„æ¶ˆæ¯åˆ° @VersaToolsBot ç³»ç»Ÿä¼šè‡ªåŠ¨å›å¤ Chat ID ğŸ“‹ è¯¦ç»†æ­¥éª¤ï¼š\nåˆ›å»º Telegram Botï¼š\næ‰“å¼€ Telegramï¼Œæœç´¢ @BotFather å‘é€ /newbot å‘½ä»¤ æŒ‰æç¤ºè®¾ç½®æœºå™¨äººåç§°å’Œç”¨æˆ·å æˆåŠŸåä¼šè·å¾— Bot Token è·å– Chat IDï¼š\nåˆ›å»ºä¸€ä¸ª Telegram é¢‘é“æˆ–ç¾¤ç»„ å°† @VersaToolsBot æ·»åŠ ä¸ºæˆå‘˜ åœ¨é¢‘é“ä¸­å‘é€ä»»æ„æ¶ˆæ¯ å°†è¿™æ¡æ¶ˆæ¯è½¬å‘ç»™ @VersaToolsBot å®ƒä¼šå›å¤ä½ çš„ Chat ID é…ç½® SubsTrackerï¼š\nç™»å½• SubsTracker ç®¡ç†é¢æ¿ è¿›å…¥é€šçŸ¥è®¾ç½®é¡µé¢ å¡«å…¥è·å–åˆ°çš„ Bot Token å’Œ Chat ID ä¿å­˜è®¾ç½®å¹¶æµ‹è¯•é€šçŸ¥ ğŸ’¡ æ‰©å±•åŠŸèƒ½ï¼š\né™¤äº† Telegramï¼ŒSubsTracker è¿˜æ”¯æŒï¼š ğŸ“§ é‚®ä»¶æé†’ ğŸ’¬ å¾®ä¿¡æé†’ ğŸ”” å¤šç§å…¶ä»–é€šçŸ¥æ–¹å¼ å¯ä»¥åŒæ—¶å¯ç”¨å¤šç§é€šçŸ¥æ¸ é“ï¼Œç¡®ä¿ä¸ä¼šé”™è¿‡ç»­æœŸæé†’ â“ äº”ã€å¸¸è§é—®é¢˜ ğŸ¤” åŸŸåè¢«ä»–äººæŠ¢æ³¨æ€ä¹ˆåŠï¼Ÿ ç›®å‰ .dpdns.org åŸŸåé‡‡ç”¨å…ˆåˆ°å…ˆå¾—çš„æ³¨å†ŒåŸåˆ™ã€‚å¦‚æœå¿ƒä»ªçš„åŸŸåå·²è¢«æ³¨å†Œï¼Œå¯ä»¥ï¼š\nå°è¯•æ·»åŠ æ•°å­—æˆ–å­—æ¯å˜ä½“ ä½¿ç”¨å…¶ä»–æœ‰æ„ä¹‰çš„è¯æ±‡ç»„åˆ å®šæœŸå…³æ³¨æ˜¯å¦æœ‰åŸŸåè¿‡æœŸé‡Šæ”¾ â° å¿˜è®°ç»­æœŸä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿ åŸŸåè¶…è¿‡ 180 å¤© æœªç»­æœŸä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ é‡Šæ”¾åä»–äººå¯ä»¥é‡æ–°æ³¨å†Œè¯¥åŸŸå ä½†ä½ å¯ä»¥éšæ—¶æ³¨å†Œå…¶ä»–å¯ç”¨çš„åŸŸå å»ºè®®è®¾ç½®å¤šé‡æé†’ï¼Œé¿å…å¿˜è®°ç»­æœŸ ğŸŒ èƒ½å¦ä½¿ç”¨å…¶ä»– DNS æœåŠ¡å•†ï¼Ÿ å®Œå…¨å¯ä»¥ï¼ DigitalPlat æ”¯æŒè‡ªå®šä¹‰ DNSï¼š\nåœ¨ DigitalPlat é¢æ¿ä¸­ä¿®æ”¹ NS è®°å½• æŒ‡å‘ä½ å–œæ¬¢çš„ DNS æœåŠ¡å•†ï¼ˆå¦‚é˜¿é‡Œäº‘ã€DNSPod ç­‰ï¼‰ åœ¨å¯¹åº”çš„ DNS æœåŠ¡å•†å¤„å®ŒæˆåŸŸåè§£æé…ç½® ğŸ”§ SubsTracker é…ç½®å¤±è´¥æ€ä¹ˆåŠï¼Ÿ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼š\nKV å‘½åç©ºé—´ç»‘å®šå¤±è´¥ï¼š\næ£€æŸ¥åç§°æ˜¯å¦å®Œå…¨ä¸º SUBSCRIPTIONS_KV ç¡®è®¤ KV å‘½åç©ºé—´å·²æˆåŠŸåˆ›å»º å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œï¼š\næ£€æŸ¥ Cron è¡¨è¾¾å¼æ ¼å¼æ˜¯å¦æ­£ç¡® ç¡®è®¤ Worker éƒ¨ç½²çŠ¶æ€æ­£å¸¸ é€šçŸ¥æ”¶ä¸åˆ°ï¼š\næ£€æŸ¥ Token å’Œ Chat ID æ˜¯å¦æ­£ç¡® ç¡®è®¤ Bot å·²åŠ å…¥é¢‘é“/ç¾¤ç»„ éªŒè¯ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ ğŸ’« æ¸©é¦¨æç¤ºï¼šå…è´¹åŸŸåè™½ç„¶æˆæœ¬ä¸ºé›¶ï¼Œä½†éœ€è¦å®šæœŸç»´æŠ¤ã€‚å»ºè®®è®¾ç½®æ—¥å†æé†’ï¼Œå¹¶åœ¨å¤šä¸ªè®¾å¤‡ä¸Šå®‰è£…é€šçŸ¥åº”ç”¨ï¼Œç¡®ä¿ç»­æœŸä¸‡æ— ä¸€å¤±ï¼\n","date":"2025-10-15T01:04:28+08:00","image":"https://file.meimolihan.eu.org/img/digitalplat-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2caf5c46/","title":"DigitalPlat å…è´¹åŸŸåå¹¶æ‰˜ç®¡åˆ° CloudFlare"},{"content":"Nginx è§£å†³ç«¯å£å ç”¨é—®é¢˜ 80ç«¯å£æ˜¯HTTPæœåŠ¡çš„æ ‡å‡†ç«¯å£ï¼Œå½“å¤šä¸ªWebæœåŠ¡å™¨ï¼ˆå¦‚Nginxã€Apacheï¼‰åŒæ—¶è¿è¡Œæ—¶ï¼Œä¼šäº§ç”Ÿç«¯å£å†²çªï¼Œå¯¼è‡´æœåŠ¡æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚\nğŸ“š å¯¼èˆªç›®å½• ğŸ” é—®é¢˜è¯Šæ–­ï¼šæ‰¾å‡ºç«¯å£å ç”¨å…ƒå‡¶ ğŸ› ï¸ è§£å†³æ–¹æ¡ˆä¸€ï¼šä¿®æ”¹Nginxç›‘å¬ç«¯å£ ğŸ“Š è§£å†³æ–¹æ¡ˆäºŒï¼šå¸è½½å†²çªæœåŠ¡Apache2 âœ… éªŒè¯ä¸ç¡®è®¤ï¼šç¡®ä¿é—®é¢˜è§£å†³ ğŸ’¡ è¿›é˜¶æŠ€å·§ä¸é¢„é˜²æªæ–½ ğŸ“ æ€»ç»“ä¸æœ€ä½³å®è·µ ğŸ” é—®é¢˜è¯Šæ–­ï¼šæ‰¾å‡ºç«¯å£å ç”¨å…ƒå‡¶ ğŸ”§ ä½¿ç”¨sså‘½ä»¤æ£€æµ‹ç«¯å£å ç”¨ 1 sudo ss -tulnp | grep :80 å‘½ä»¤è§£æï¼š\nssï¼šæ¯”netstatæ›´å¼ºå¤§çš„socketç»Ÿè®¡å·¥å…· -tï¼šæ˜¾ç¤ºTCPè¿æ¥ -uï¼šæ˜¾ç¤ºUDPè¿æ¥ -lï¼šä»…æ˜¾ç¤ºç›‘å¬çŠ¶æ€çš„è¿æ¥ -nï¼šä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºç«¯å£ -pï¼šæ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ ğŸ“‹ è¾“å‡ºç¤ºä¾‹åˆ†æï¼š\n1 2 root@debian:~# sudo ss -tulnp | grep :80 tcp LISTEN 0 511 *:80 *:* users:((\u0026#34;apache2\u0026#34;,pid=788,fd=4),(\u0026#34;apache2\u0026#34;,pid=787,fd=4),(\u0026#34;apache2\u0026#34;,pid=784,fd=4)) âœ¨ è§£è¯»å…³é”®ä¿¡æ¯ï¼š\n*:80ï¼šè¡¨ç¤ºåœ¨æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Šç›‘å¬80ç«¯å£ apache2ï¼šå ç”¨ç«¯å£çš„è¿›ç¨‹åç§° pid=788,787,784ï¼šç›¸å…³çš„è¿›ç¨‹ID è¿™è¡¨æ˜Apache2æœåŠ¡æ­£åœ¨è¿è¡Œå¹¶å ç”¨äº†80ç«¯å£ ğŸ› ï¸ è§£å†³æ–¹æ¡ˆä¸€ï¼šä¿®æ”¹Nginxç›‘å¬ç«¯å£ ğŸ¯ æ–¹æ³•ç‰¹ç‚¹ âœ… éä¾µå…¥å¼ï¼šæ— éœ€åœæ­¢å…¶ä»–æœåŠ¡ âœ… çµæ´»æ€§é«˜ï¼šå¯è‡ªå®šä¹‰ä»»æ„å¯ç”¨ç«¯å£ âœ… é£é™©è¾ƒä½ï¼šä¸å½±å“ç°æœ‰æœåŠ¡è¿è¡Œ ğŸ” æ­¥éª¤1ï¼šå®šä½Nginxé…ç½®æ–‡ä»¶ 1 2 3 4 5 # æŸ¥çœ‹Nginxä¸»é…ç½®åŒ…å«çš„ç›®å½• grep -E \u0026#39;include.*conf\u0026#39; /etc/nginx/nginx.conf # å¿«é€Ÿæœç´¢æ‰€æœ‰ç›‘å¬80ç«¯å£çš„é…ç½® grep -R \u0026#39;listen.*80\u0026#39; /etc/nginx/ ğŸ” æœç´¢ç»“æœç¤ºä¾‹ï¼š\n1 2 /etc/nginx/conf.d/default.conf: listen 80; /etc/nginx/conf.d/default.conf: # proxy the PHP scripts to Apache listening on 127.0.0.1:80 ğŸ“ æ­¥éª¤2ï¼šä¿®æ”¹ç›‘å¬ç«¯å£ 1 sudo nano /etc/nginx/conf.d/default.conf ğŸ“‹ ä¿®æ”¹å†…å®¹ï¼š\n1 2 3 4 5 # æ‰¾åˆ°è¿™ä¸€è¡Œï¼š listen 80; # ä¿®æ”¹ä¸ºï¼ˆä¾‹å¦‚8080ç«¯å£ï¼‰ï¼š listen 8080; ğŸ’¡ ä¿å­˜æŠ€å·§ï¼š\nCtrl+O â†’ Enter â†’ Ctrl+X å®Œæˆä¿å­˜é€€å‡º ğŸ”„ æ­¥éª¤3ï¼šé‡å¯NginxæœåŠ¡ 1 2 sudo systemctl restart nginx sudo systemctl status nginx ğŸ“Š è§£å†³æ–¹æ¡ˆäºŒï¼šå¸è½½å†²çªæœåŠ¡Apache2 âš ï¸ é€‚ç”¨åœºæ™¯ ğŸš« ä¸å†éœ€è¦Apache2æœåŠ¡ ğŸ”„ å¸Œæœ›å½»åº•é‡Šæ”¾80ç«¯å£ ğŸ¯ ç¡®å®šNginxå°†ä½œä¸ºä¸»è¦WebæœåŠ¡å™¨ ğŸ› ï¸ å®Œæ•´å¸è½½æµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 # åœæ­¢Apache2æœåŠ¡ sudo systemctl stop apache2 # å½»åº•å¸è½½Apache2åŠç›¸å…³åŒ… sudo apt purge -y apache2* libapache2* # æ¸…ç†æ®‹ç•™ä¾èµ–åŒ… sudo apt autoremove -y # å¯é€‰ï¼šæ¸…ç†é…ç½®æ–‡ä»¶ sudo apt autoclean ğŸ“Œ å‘½ä»¤è¯´æ˜ï¼š\npurgeï¼šå½»åº•åˆ é™¤è½¯ä»¶åŒ…åŠé…ç½®æ–‡ä»¶ autoremoveï¼šè‡ªåŠ¨ç§»é™¤ä¸å†éœ€è¦çš„ä¾èµ–åŒ… autocleanï¼šæ¸…ç†å·²ä¸‹è½½çš„æ—§ç‰ˆæœ¬è½¯ä»¶åŒ… âœ… éªŒè¯ä¸ç¡®è®¤ï¼šç¡®ä¿é—®é¢˜è§£å†³ ğŸ” éªŒè¯ç«¯å£å ç”¨æƒ…å†µ 1 2 3 4 5 # æ£€æŸ¥80ç«¯å£æ˜¯å¦å·²é‡Šæ”¾ sudo ss -tulnp | grep :80 # æ£€æŸ¥Nginxæ˜¯å¦åœ¨æ–°ç«¯å£è¿è¡Œ sudo ss -tulnp | grep nginx ğŸ§ª æµ‹è¯•NginxæœåŠ¡çŠ¶æ€ 1 2 3 4 5 6 7 8 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # æµ‹è¯•é…ç½®è¯­æ³• sudo nginx -t # é‡æ–°åŠ è½½é…ç½®ï¼ˆå¦‚æœåªæ˜¯ä¿®æ”¹é…ç½®ï¼‰ sudo systemctl reload nginx ğŸŒ æµè§ˆå™¨è®¿é—®æµ‹è¯• è®¿é—® http://ä½ çš„æœåŠ¡å™¨IP:8080 ç¡®è®¤Nginxæ­£å¸¸è¿è¡Œã€‚\nğŸ’¡ è¿›é˜¶æŠ€å·§ä¸é¢„é˜²æªæ–½ ğŸ”§ ç«¯å£å†²çªé¢„é˜²æ–¹æ¡ˆ æ–¹æ¡ˆ1ï¼šæœåŠ¡è‡ªåŠ¨æ£€æµ‹è„šæœ¬ 1 2 3 4 5 6 7 8 #!/bin/bash PORT=80 if sudo ss -tuln | grep \u0026#34;:${PORT} \u0026#34; \u0026gt; /dev/null; then echo \u0026#34;âš ï¸ ç«¯å£ ${PORT} å·²è¢«å ç”¨ï¼Œæ­£åœ¨æ£€æŸ¥è¿›ç¨‹...\u0026#34; sudo ss -tulnp | grep \u0026#34;:${PORT}\u0026#34; else echo \u0026#34;âœ… ç«¯å£ ${PORT} å¯ç”¨\u0026#34; fi æ–¹æ¡ˆ2ï¼šå¤šç«¯å£ç›‘å¬é…ç½® 1 2 3 4 5 6 server { listen 80; listen 8080; server_name example.com; # å…¶ä»–é…ç½®... } ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®® Nginxå·¥ä½œè¿›ç¨‹ä¼˜åŒ– 1 2 3 # åœ¨ /etc/nginx/nginx.conf ä¸­è°ƒæ•´ worker_processes auto; # è‡ªåŠ¨æ ¹æ®CPUæ ¸å¿ƒæ•°è®¾ç½® worker_connections 1024; # æ¯ä¸ªå·¥ä½œè¿›ç¨‹è¿æ¥æ•° ç«¯å£èŒƒå›´æ‰©å±• 1 2 # æŸ¥çœ‹ç³»ç»Ÿå¯ç”¨ç«¯å£èŒƒå›´ sysctl net.ipv4.ip_local_port_range ğŸ“Š ç›‘æ§ä¸æ—¥å¿—åˆ†æ å®æ—¶ç›‘æ§è¿æ¥çŠ¶æ€ 1 2 3 4 5 # ç›‘æ§Nginxè¿æ¥ sudo watch -n 1 \u0026#39;ss -tulnp | grep nginx\u0026#39; # æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log ğŸ“ æ€»ç»“ä¸æœ€ä½³å®è·µ ğŸ¯ é—®é¢˜è§£å†³è·¯å¾„æ€»ç»“ ğŸ” è¯Šæ–­é˜¶æ®µï¼šä½¿ç”¨sså‘½ä»¤å‡†ç¡®è¯†åˆ«ç«¯å£å ç”¨æƒ…å†µ ğŸ› ï¸ æ–¹æ¡ˆé€‰æ‹©ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©ä¿®æ”¹ç«¯å£æˆ–å¸è½½å†²çªæœåŠ¡ âœ… éªŒè¯ç¡®è®¤ï¼šå¤šç»´åº¦éªŒè¯é—®é¢˜æ˜¯å¦å½»åº•è§£å†³ ğŸ’¼ æœ€ä½³å®è·µå»ºè®® ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®® ğŸ“Œ ç«¯å£è§„åˆ’ï¼šæå‰è§„åˆ’æœåŠ¡ç«¯å£ï¼Œé¿å…å†²çª ğŸ”„ å˜æ›´ç®¡ç†ï¼šä»»ä½•é…ç½®ä¿®æ”¹å‰åšå¥½å¤‡ä»½ ğŸ“ æ–‡æ¡£è®°å½•ï¼šè®°å½•æ‰€æœ‰ç«¯å£åˆ†é…å’ŒæœåŠ¡é…ç½® ğŸ›¡ï¸ å®‰å…¨åŠ å›ºæªæ–½ 1 2 3 # é™åˆ¶ç«¯å£è®¿é—®æƒé™ï¼ˆç¤ºä¾‹ï¼‰ sudo ufw allow 80/tcp comment \u0026#39;HTTP Service\u0026#39; sudo ufw allow 8080/tcp comment \u0026#39;Alternative HTTP Port\u0026#39; ğŸ”„ è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 #!/bin/bash # è‡ªåŠ¨æ£€æµ‹å¹¶è§£å†³ç«¯å£å†²çª check_and_fix_port_conflict() { local port=$1 local service=$2 if sudo ss -tuln | grep \u0026#34;:${port} \u0026#34; \u0026gt; /dev/null; then echo \u0026#34;æ£€æµ‹åˆ°ç«¯å£ ${port} å†²çªï¼Œæ­£åœ¨é‡å¯ ${service}...\u0026#34; sudo systemctl restart $service fi } ğŸŒŸ æ ¸å¿ƒè¦ç‚¹å›é¡¾ âœ¨ è¯Šæ–­å·¥å…·ï¼šç†Ÿç»ƒæŒæ¡sså‘½ä»¤è¿›è¡Œç«¯å£è¯Šæ–­ ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„è§£å†³ç­–ç•¥ ğŸ“Š éªŒè¯æ–¹æ³•ï¼šå¤šè§’åº¦éªŒè¯ç¡®ä¿é—®é¢˜å½»åº•è§£å†³ ğŸ”® é¢„é˜²æªæ–½ï¼šå»ºç«‹å®Œå–„çš„ç«¯å£ç®¡ç†å’Œç›‘æ§æœºåˆ¶ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç†Ÿç»ƒè¯Šæ–­å’Œè§£å†³Nginxç«¯å£å ç”¨é—®é¢˜ï¼Œå¹¶å»ºç«‹æœ‰æ•ˆçš„é¢„é˜²æœºåˆ¶ï¼Œç¡®ä¿WebæœåŠ¡çš„ç¨³å®šè¿è¡Œã€‚ğŸ‰\n","date":"2025-10-12T20:03:48+08:00","image":"https://file.meimolihan.eu.org/img/nginx-02.webp","permalink":"https://blog.meimolihan.eu.org/p/6badf3c6/","title":"Nginx è§£å†³ç«¯å£å ç”¨é—®é¢˜"},{"content":"Git å®‰è£…ä¸å¸è½½å®Œæ•´æŒ‡å— ğŸš€ Git æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”± Linux ä¹‹çˆ¶ Linus Torvalds å¼€å‘ï¼Œç°å·²æˆä¸ºå…¨çƒå¼€å‘è€…å¿…å¤‡çš„å·¥å…·ä¹‹ä¸€ âœ¨\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸš€ Git ç®€ä»‹ä¸æ ¸å¿ƒåŠŸèƒ½ ğŸ§ ä¸€ã€Linux å‘è¡Œç‰ˆå®‰è£…ä¸å¸è½½ ğŸªŸ äºŒã€Windows æ‰‹åŠ¨å®‰è£… Git ğŸ”§ ä¸‰ã€Windows ä½¿ç”¨ Winget å®‰è£… Git ğŸ“¦ å››ã€Windows ä½¿ç”¨ Scoop å®‰è£… Git âœ… äº”ã€éªŒè¯å®‰è£…ä¸åŸºç¡€é…ç½® âŒ å…­ã€å¸¸è§é—®é¢˜è§£å†³ ğŸ’¡ ä¸ƒã€è¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸš€ Git ç®€ä»‹ä¸æ ¸å¿ƒåŠŸèƒ½ ğŸ”¥ Git çš„æ ¸å¿ƒä¼˜åŠ¿ ğŸ“Š ç‰ˆæœ¬æ§åˆ¶ï¼šå®Œæ•´è®°å½•æ¯æ¬¡ä»£ç å˜æ›´ï¼Œæ”¯æŒå›æ»šåˆ°ä»»æ„å†å²ç‰ˆæœ¬ ğŸ‘¥ å›¢é˜Ÿåä½œï¼šå¤šäººå¹¶è¡Œå¼€å‘ï¼Œè‡ªåŠ¨åˆå¹¶ä»£ç å˜æ›´ ğŸ’¾ åˆ†å¸ƒå¼æ¶æ„ï¼šæ¯ä¸ªå¼€å‘è€…éƒ½æ‹¥æœ‰å®Œæ•´çš„ä»£ç ä»“åº“å‰¯æœ¬ âš¡ é«˜æ•ˆæ€§èƒ½ï¼šå¿«é€Ÿå¤„ç†å¤§å‹é¡¹ç›®å’Œå¤§é‡å†å²è®°å½• ğŸ”’ æ•°æ®å®Œæ•´æ€§ï¼šä½¿ç”¨ SHA-1 å“ˆå¸Œç¡®ä¿ä»£ç å®Œæ•´æ€§ ğŸ¯ é€‚ç”¨åœºæ™¯ ä¸ªäººé¡¹ç›®ç‰ˆæœ¬ç®¡ç† ğŸ“ å›¢é˜Ÿåä½œå¼€å‘ ğŸ‘¨â€ğŸ’»ğŸ‘©â€ğŸ’» å¼€æºé¡¹ç›®è´¡çŒ® ğŸŒŸ ä»£ç å¤‡ä»½ä¸æ¢å¤ ğŸ’¾ ä¸€ã€ğŸ§ Linux å‘è¡Œç‰ˆå®‰è£…ä¸å¸è½½ ğŸ¯ Ubuntu/Debian ç³»ç»Ÿ ğŸ“¥ å®‰è£… Gitï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ ğŸ”„ sudo apt update # å®‰è£… Git æ ¸å¿ƒåŒ… sudo apt install git # å®‰è£… Git å®Œæ•´å¥—ä»¶ï¼ˆæ¨èï¼‰ sudo apt install git-all # éªŒè¯å®‰è£…ç‰ˆæœ¬ git --version ğŸ—‘ï¸ å¸è½½ Gitï¼š\n1 2 3 4 5 6 7 8 9 # å®Œå…¨å¸è½½ Git åŠç›¸å…³ä¾èµ– sudo apt remove git sudo apt autoremove # å½»åº•æ¸…é™¤é…ç½®æ–‡ä»¶ sudo apt purge git # æ¸…ç†æ®‹ç•™é…ç½® rm -rf ~/.gitconfig ~/.config/git ğŸ”´ CentOS/RHEL/Fedora ç³»ç»Ÿ ğŸ“¥ å®‰è£… Gitï¼š\n1 2 3 4 5 6 7 8 9 10 11 # CentOS/RHELï¼ˆæ—§ç‰ˆæœ¬ï¼‰ sudo yum install git # CentOS 8+/RHEL 8+ ä½¿ç”¨ dnf sudo dnf install git # Fedora ç³»ç»Ÿ sudo dnf install git # å®‰è£…å¼€å‘å·¥å…·ç»„ï¼ˆåŒ…å«å®Œæ•´ Gitï¼‰ sudo dnf groupinstall \u0026#34;Development Tools\u0026#34; ğŸ—‘ï¸ å¸è½½ Gitï¼š\n1 2 3 4 5 # CentOS/RHEL sudo yum remove git # ä½¿ç”¨ dnf çš„ç³»ç»Ÿ sudo dnf remove git ğŸ¨ Arch Linux/Manjaro ğŸ“¥ å®‰è£… Gitï¼š\n1 2 3 4 5 # ä½¿ç”¨ pacman å®‰è£… sudo pacman -S git # å®‰è£… Git æ‰©å±•å·¥å…· sudo pacman -S git-extras ğŸ—‘ï¸ å¸è½½ Gitï¼š\n1 2 3 4 5 # å¸è½½ Git sudo pacman -R git # å½»åº•å¸è½½åŠç›¸å…³é…ç½® sudo pacman -Rns git äºŒã€ğŸªŸ Windows æ‰‹åŠ¨å®‰è£… Git ğŸ“¥ ä¸‹è½½ Git ğŸŒ è®¿é—® Git å®˜æ–¹ä¸‹è½½é¡µé¢ ğŸ’¾ ä¸‹è½½ Windows ç‰ˆæœ¬å®‰è£…ç¨‹åºï¼ˆæ¨è 64-bit ç‰ˆæœ¬ï¼‰ ğŸš€ è¿è¡Œä¸‹è½½çš„ .exe æ–‡ä»¶å¼€å§‹å®‰è£… ğŸ”§ è¯¦ç»†å®‰è£…æ­¥éª¤ 1. è®¸å¯è¯åè®® ğŸ“„ ä»”ç»†é˜…è¯» GNU é€šç”¨å…¬å…±è®¸å¯è¯ ç‚¹å‡» \u0026ldquo;Next\u0026rdquo; åŒæ„åè®®å†…å®¹ 2. å®‰è£…è·¯å¾„é€‰æ‹© ğŸ“ é»˜è®¤è·¯å¾„ï¼šC:\\Program Files\\Git å¯è‡ªå®šä¹‰è·¯å¾„ï¼Œé¿å…ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦ 3. ç»„ä»¶é€‰æ‹© ğŸ› ï¸ 1 2 3 4 5 âœ… Git Bash - Linux é£æ ¼å‘½ä»¤è¡Œç¯å¢ƒ âœ… Git GUI - å›¾å½¢åŒ–ç•Œé¢å·¥å…· âœ… Git LFS - å¤§æ–‡ä»¶æ”¯æŒ âœ… Associate .git* - å…³è” Git é…ç½®æ–‡ä»¶ âœ… Add Git to PATH - æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ 4. å¼€å§‹èœå•æ–‡ä»¶å¤¹ ğŸ“‚ ä¿æŒé»˜è®¤æˆ–è‡ªå®šä¹‰æ–‡ä»¶å¤¹åç§° å»ºè®®ä½¿ç”¨ \u0026ldquo;Git\u0026rdquo; ä½œä¸ºæ–‡ä»¶å¤¹å 5. é»˜è®¤ç¼–è¾‘å™¨é€‰æ‹© âœï¸ Vimï¼ˆé»˜è®¤ï¼Œé€‚åˆé«˜çº§ç”¨æˆ·ï¼‰ Nanoï¼ˆæ–°æ‰‹å‹å¥½ï¼‰ Visual Studio Code Notepad++ 6. PATH ç¯å¢ƒé…ç½® ğŸ”§ 1 2 3 ğŸ”¹ Use Git from Git Bash onlyï¼ˆä»…é™ Git Bashï¼‰ ğŸ”¹ Use Git from the Windows Command Promptï¼ˆæ¨èï¼‰ ğŸ”¹ Use Git and optional Unix tools from Windows Command Prompt 7. SSH å¯æ‰§è¡Œæ–‡ä»¶ ğŸ” Use OpenSSHï¼ˆé»˜è®¤ï¼‰ Use external OpenSSHï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ 8. HTTPS ä¼ è¾“åç«¯ ğŸŒ Use the OpenSSL library Use the native Windows Secure Channel library 9. è¡Œç»“æŸç¬¦é…ç½® â†µ 1 2 3 ğŸ”¹ Checkout Windows-style, commit Unix-styleï¼ˆæ¨èï¼‰ ğŸ”¹ Checkout as-is, commit as-is ğŸ”¹ Checkout Windows-style, commit Windows-style 10. ç»ˆç«¯æ¨¡æ‹Ÿå™¨ ğŸ’» Use MinTTYï¼ˆæ¨èï¼ŒåŠŸèƒ½æ›´å®Œæ•´ï¼‰ Use Windows\u0026rsquo; default console window 11. é¢å¤–åŠŸèƒ½é€‰é¡¹ âš¡ 1 2 3 âœ… Enable file system caching âœ… Enable Git Credential Manager âœ… Enable symbolic links ğŸ—‘ï¸ æ‰‹åŠ¨å¸è½½ Git æ§åˆ¶é¢æ¿å¸è½½ï¼š\næ‰“å¼€ \u0026ldquo;æ§åˆ¶é¢æ¿\u0026rdquo; â†’ \u0026ldquo;ç¨‹åºå’ŒåŠŸèƒ½\u0026rdquo; æ‰¾åˆ° \u0026ldquo;Git\u0026rdquo; ç¨‹åº â†’ ç‚¹å‡» \u0026ldquo;å¸è½½\u0026rdquo; å‘½ä»¤è¡Œå¸è½½ï¼š\n1 2 3 4 5 # æŸ¥æ‰¾ Git å®‰è£…ä¿¡æ¯ wmic product where \u0026#34;name like \u0026#39;%Git%\u0026#39;\u0026#34; get name,version # å¸è½½ Gitï¼ˆç®¡ç†å‘˜æƒé™ï¼‰ wmic product where \u0026#34;name=\u0026#39;Git\u0026#39;\u0026#34; call uninstall /nointeractive æ¸…ç†æ®‹ç•™æ–‡ä»¶ï¼š\n1 2 3 4 5 6 # åˆ é™¤ç”¨æˆ·é…ç½® rmdir /s %USERPROFILE%\\.config\\git rmdir /s %USERPROFILE%\\.gitconfig # åˆ é™¤å…¨å±€é…ç½®ï¼ˆå¦‚å­˜åœ¨ï¼‰ rmdir /s \u0026#34;C:\\Program Files\\Git\u0026#34; ä¸‰ã€ğŸ”§ Windows ä½¿ç”¨ Winget å®‰è£… Git ğŸ” æ£€æŸ¥ Winget å¯ç”¨æ€§ 1 2 3 4 5 # æ£€æŸ¥ Winget ç‰ˆæœ¬ winget --version # å¦‚æœæœªæ‰¾åˆ°å‘½ä»¤ï¼Œéœ€è¦å®‰è£… App Installer # ä» Microsoft Store æœç´¢ \u0026#34;App Installer\u0026#34; å¹¶å®‰è£… ğŸ“¥ ä½¿ç”¨ Winget å®‰è£… Git 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æœç´¢ Git ç›¸å…³åŒ… winget search git # æŸ¥çœ‹ Git åŒ…è¯¦ç»†ä¿¡æ¯ winget show Git.Git # å®‰è£…æœ€æ–°ç‰ˆ Git winget install Git.Git # å®‰è£…ç‰¹å®šç‰ˆæœ¬ winget install Git.Git -v 2.42.0 # é™é»˜å®‰è£…ï¼ˆæ— äº¤äº’ï¼‰ winget install Git.Git --silent # æŒ‡å®šå®‰è£…ä½ç½® winget install Git.Git -l \u0026#34;D:\\Development\\Git\u0026#34; ğŸ”„ æ›´æ–°ä¸å¸è½½ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥å¯æ›´æ–°è½¯ä»¶ winget upgrade # æ›´æ–° Git winget upgrade Git.Git # å¸è½½ Git winget uninstall Git.Git # å¼ºåˆ¶å¸è½½ winget uninstall Git.Git --force ğŸ¯ Winget ä¼˜åŠ¿ âš¡ å¿«é€Ÿå®‰è£…ï¼šä¸€é”®å®Œæˆä¸‹è½½å’Œé…ç½® ğŸ”„ è‡ªåŠ¨æ›´æ–°ï¼šè½»æ¾ä¿æŒæœ€æ–°ç‰ˆæœ¬ ğŸ“¦ å®˜æ–¹æºï¼šç›´æ¥ä»å®˜æ–¹ä»“åº“è·å– ğŸ›¡ï¸ å®‰å…¨å¯é ï¼šå¾®è½¯éªŒè¯çš„æ•°å­—ç­¾å å››ã€ğŸ“¦ Windows ä½¿ç”¨ Scoop å®‰è£… Git ğŸš€ Scoop å®‰è£…æŒ‡å— å‰ææ¡ä»¶æ£€æŸ¥ âœ…ï¼š\nWindows 7 SP1+ / Windows Server 2008+ PowerShell 5+ï¼ˆæ¨è PowerShell 7ï¼‰ .NET Framework 4.5+ å®‰è£…æ­¥éª¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # 1. è®¾ç½® PowerShell æ‰§è¡Œç­–ç•¥ Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser # 2. å®‰è£… Scoop irm get.scoop.sh | iex # 3. å¦‚æœç½‘ç»œé—®é¢˜ï¼Œä½¿ç”¨å›½å†…é•œåƒ irm https://gitee.com/glsnames/scoop-installer/raw/master/bin/install.ps1 | iex # 4. éªŒè¯å®‰è£… scoop --version ğŸ“¥ ä½¿ç”¨ Scoop å®‰è£… Git 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ·»åŠ å¸¸ç”¨ä»“åº“ scoop bucket add main scoop bucket add extras scoop bucket add versions # å®‰è£…åŸºç¡€ Git scoop install git # å®‰è£…å®Œæ•´ç‰ˆ Gitï¼ˆæ¨èï¼‰ scoop install git-with-openssh # æˆ–å®‰è£…ç‰¹å®šç‰ˆæœ¬ scoop install git@2.42.0 ğŸ› ï¸ Scoop ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹å·²å®‰è£…è½¯ä»¶ scoop list # æ›´æ–° Scoop å’Œæ‰€æœ‰è½¯ä»¶ scoop update * scoop update git # å¸è½½ Git scoop uninstall git # æ¸…ç†ç¼“å­˜å’Œæ—§ç‰ˆæœ¬ scoop cache rm git scoop cleanup git # æŸ¥çœ‹è½¯ä»¶ä¿¡æ¯ scoop info git ğŸŒŸ Scoop ç‰¹è‰²åŠŸèƒ½ ğŸ  ç”¨æˆ·çº§å®‰è£…ï¼šæ— éœ€ç®¡ç†å‘˜æƒé™ ğŸ”— ç¯å¢ƒè‡ªåŠ¨é…ç½®ï¼šè‡ªåŠ¨è®¾ç½® PATH å˜é‡ ğŸ“Š ä¾èµ–ç®¡ç†ï¼šè‡ªåŠ¨å¤„ç†è½¯ä»¶ä¾èµ– ğŸ”„ ç‰ˆæœ¬åˆ‡æ¢ï¼šè½»æ¾åˆ‡æ¢ä¸åŒç‰ˆæœ¬ ğŸ§¹ å¹²å‡€å¸è½½ï¼šå½»åº•æ¸…ç†æ‰€æœ‰æ–‡ä»¶ äº”ã€âœ… éªŒè¯å®‰è£…ä¸åŸºç¡€é…ç½® ğŸ” å®‰è£…éªŒè¯æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 # 1. æ£€æŸ¥ Git ç‰ˆæœ¬ git --version # 2. éªŒè¯ Git å¯æ‰§è¡Œæ–‡ä»¶ä½ç½® which git # Linux/Mac where git # Windows # 3. æ£€æŸ¥ Git å¸®åŠ©ç³»ç»Ÿ git --help # 4. éªŒè¯æ ¸å¿ƒåŠŸèƒ½ git status git config --list âš™ï¸ é¦–æ¬¡ä½¿ç”¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # è®¾ç½®ç”¨æˆ·ä¿¡æ¯ï¼ˆå…¨å±€é…ç½®ï¼‰ git config --global user.name \u0026#34;ä½ çš„ç”¨æˆ·å\u0026#34; git config --global user.email \u0026#34;your-email@example.com\u0026#34; # è®¾ç½®é»˜è®¤ç¼–è¾‘å™¨ git config --global core.editor \u0026#34;code --wait\u0026#34; # VS Code git config --global core.editor \u0026#34;vim\u0026#34; # Vim git config --global core.editor \u0026#34;notepad++.exe -multiInst -nosession\u0026#34; # Notepad++ # é…ç½®è¡Œç»“æŸç¬¦ï¼ˆè·¨å¹³å°åä½œï¼‰ git config --global core.autocrlf true # Windows git config --global core.autocrlf input # Linux/Mac # å¯ç”¨é¢œè‰²è¾“å‡º git config --global color.ui auto # è®¾ç½®é»˜è®¤åˆ†æ”¯åç§° git config --global init.defaultBranch main ğŸ¨ ä¸ªæ€§åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºå¸¸ç”¨å‘½ä»¤åˆ«å git config --global alias.co checkout git config --global alias.br branch git config --global alias.ci commit git config --global alias.st status git config --global alias.unstage \u0026#39;reset HEAD --\u0026#39; git config --global alias.last \u0026#39;log -1 HEAD\u0026#39; # è®¾ç½®æ¨é€è¡Œä¸º git config --global push.default simple # å¯ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆæå‡æ€§èƒ½ï¼‰ git config --global core.preloadindex true git config --global core.fscache true # é…ç½®å·®å¼‚å·¥å…· git config --global diff.tool vscode git config --global difftool.vscode.cmd \u0026#34;code --wait --diff $LOCAL $REMOTE\u0026#34; å…­ã€âŒ å¸¸è§é—®é¢˜è§£å†³ 1. ğŸš« å‘½ä»¤æœªæ‰¾åˆ°é”™è¯¯ é—®é¢˜ç°è±¡ï¼š\n1 2 bash: git: command not found \u0026#39;git\u0026#39; is not recognized as an internal or external command è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 # Windows æ£€æŸ¥ PATH echo $env:PATH # Linux/Mac æ£€æŸ¥ PATH echo $PATH # é‡æ–°åŠ è½½é…ç½® source ~/.bashrc # Bash source ~/.zshrc # Zsh 2. ğŸ” SSL è¯ä¹¦é—®é¢˜ é—®é¢˜ç°è±¡ï¼š\n1 SSL certificate problem: unable to get local issuer certificate è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 # ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰ git config --global http.sslVerify false # æ°¸ä¹…è§£å†³æ–¹æ¡ˆ - å®‰è£…è¯ä¹¦ # Windows: å®‰è£… Git æ—¶é€‰æ‹© \u0026#34;Use the OpenSSL library\u0026#34; # Linux: sudo apt-get install ca-certificates # é…ç½® Git ä½¿ç”¨ç³»ç»Ÿè¯ä¹¦ git config --global http.sslCAInfo /etc/ssl/certs/ca-certificates.crt 3. â è¡Œç»“æŸç¬¦è­¦å‘Š é—®é¢˜ç°è±¡ï¼š\n1 2 warning: LF will be replaced by CRLF in filename. The file will have its original line endings in your working directory. è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # Windows å¼€å‘è€…é…ç½® git config --global core.autocrlf true # Linux/Mac å¼€å‘è€…é…ç½® git config --global core.autocrlf input # ç¦ç”¨æ¢è¡Œç¬¦è½¬æ¢ git config --global core.autocrlf false # åˆ·æ–° Git ç´¢å¼• git rm --cached -r . git reset --hard 4. ğŸ”’ æƒé™è¢«æ‹’ç»é”™è¯¯ é—®é¢˜ç°è±¡ï¼š\n1 2 Permission denied (publickey). Could not read from remote repository. è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç”Ÿæˆ SSH å¯†é’¥ ssh-keygen -t ed25519 -C \u0026#34;your-email@example.com\u0026#34; # æˆ–è€…ä½¿ç”¨ RSA ssh-keygen -t rsa -b 4096 -C \u0026#34;your-email@example.com\u0026#34; # å¯åŠ¨ SSH ä»£ç† eval \u0026#34;$(ssh-agent -s)\u0026#34; # æ·»åŠ ç§é’¥åˆ°ä»£ç† ssh-add ~/.ssh/id_ed25519 # å¤åˆ¶å…¬é’¥åˆ°å‰ªè´´æ¿ cat ~/.ssh/id_ed25519.pub | clip # Windows cat ~/.ssh/id_ed25519.pub | pbcopy # Mac 5. ğŸ’¾ ç¼“å­˜å’Œç´¢å¼•é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ¸…ç† Git ç¼“å­˜ git rm -r --cached . # é‡ç½® Git ç´¢å¼• git reset # æ¸…ç†æœªè·Ÿè¸ªæ–‡ä»¶ git clean -fd # ä¿®å¤æŸåçš„ä»“åº“ git fsck --full git reflog expire --expire=now --all git gc --prune=now --aggressive ä¸ƒã€ğŸ’¡ è¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸ¯ å®‰è£…æ–¹å¼é€‰æ‹©æŒ‡å— å®‰è£…æ–¹å¼ é€‚ç”¨åœºæ™¯ ä¼˜ç‚¹ ç¼ºç‚¹ æ‰‹åŠ¨å®‰è£… ğŸ¢ ä¼ä¸šç¯å¢ƒã€ç”Ÿäº§æœåŠ¡å™¨ å®Œå…¨æ§åˆ¶ã€ç¨³å®šå¯é  é…ç½®å¤æ‚ã€æ›´æ–°éº»çƒ¦ Winget ğŸ  ä¸ªäººä½¿ç”¨ã€å¿«é€Ÿéƒ¨ç½² å¾®è½¯å®˜æ–¹ã€ä¸€é”®å®‰è£… ç‰ˆæœ¬å¯èƒ½æ»å Scoop ğŸ’» å¼€å‘ç¯å¢ƒã€å¤šç‰ˆæœ¬ç®¡ç† ç”¨æˆ·çº§å®‰è£…ã€å¹²å‡€å¸è½½ éœ€è¦ PowerShell ğŸ”§ æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # å¤§æ–‡ä»¶ä»“åº“ä¼˜åŒ– git config --global core.compression 9 git config --global core.deltaBaseCacheLimit 2g git config --global pack.deltaCacheSize 1g # å†…å­˜ä¼˜åŒ– git config --global core.packedGitLimit 512m git config --global core.packedGitWindowSize 512m # ç½‘ç»œä¼˜åŒ– git config --global http.postBuffer 524288000 git config --global https.postBuffer 524288000 ğŸ“Š å¤šç‰ˆæœ¬ Git ç®¡ç† 1 2 3 4 5 6 7 # ä½¿ç”¨ Git ç‰ˆæœ¬ç®¡ç†å™¨ï¼ˆLinux/Macï¼‰ # å®‰è£… git-up curl -L https://raw.github.com/aanand/git-up/master/install.sh | sh # æˆ–ä½¿ç”¨è‡ªåˆ¶è½¯ä»¶ç®¡ç†å¤šä¸ªç‰ˆæœ¬ brew install git brew install git@2.33 ğŸ›¡ï¸ å®‰å…¨é…ç½®å»ºè®® 1 2 3 4 5 6 7 8 9 10 # ç¦ç”¨ä¸å®‰å…¨çš„ HTTP åè®® git config --global http.sslVerify true git config --global http.sslBackend schannel # è®¾ç½®å‡­è¯ç¼“å­˜è¶…æ—¶ git config --global credential.helper \u0026#39;cache --timeout=3600\u0026#39; # å¯ç”¨ GPG ç­¾åæäº¤ git config --global commit.gpgsign true git config --global user.signingkey YOUR_GPG_KEY_ID ğŸ”„ å¤‡ä»½ä¸è¿ç§» 1 2 3 4 5 6 7 8 9 10 # å¤‡ä»½ Git é…ç½® cp ~/.gitconfig ~/.gitconfig.backup cp -r ~/.ssh ~/.ssh.backup # å¯¼å‡ºå·²å®‰è£…çš„ Git æ‰©å±•åˆ—è¡¨ scoop export \u0026gt; scoop-packages.txt winget export --output winget-packages.json # å…‹éš†ä»“åº“æ—¶ä¼˜åŒ–å¤§æ–‡ä»¶ä¸‹è½½ git clone --filter=blob:none https://github.com/user/repo.git ğŸ‰ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æŒæ¡äº†åœ¨å„ç§æ“ä½œç³»ç»Ÿä¸Šå®‰è£…å’Œå¸è½½ Git çš„å®Œæ•´æµç¨‹ã€‚æ— è®ºæ‚¨æ˜¯ï¼š\nğŸ§ Linux ç”¨æˆ·ï¼šé€šè¿‡åŒ…ç®¡ç†å™¨è½»æ¾å®‰è£… ğŸªŸ Windows ç”¨æˆ·ï¼šå¯é€‰æ‹©æ‰‹åŠ¨ã€Winget æˆ– Scoop å¤šç§æ–¹å¼ ğŸ”§ å¼€å‘äººå‘˜ï¼šä½¿ç”¨ Scoop ç®¡ç†å¤šä¸ªå¼€å‘å·¥å…· ğŸ¢ ä¼ä¸šç”¨æˆ·ï¼šæ‰‹åŠ¨å®‰è£…ç¡®ä¿ç¨³å®šæ€§ é€‰æ‹©æœ€é€‚åˆæ‚¨éœ€æ±‚çš„å®‰è£…æ–¹å¼ï¼Œå¼€å§‹äº«å— Git å¸¦æ¥çš„é«˜æ•ˆç‰ˆæœ¬æ§åˆ¶ä½“éªŒï¼è®°å¾—å®šæœŸæ›´æ–° Git ä»¥è·å–æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨ä¿®å¤ã€‚ğŸš€\nä¸‹ä¸€æ­¥å»ºè®®ï¼š\nğŸ“š å­¦ä¹  Git åŸºç¡€å‘½ä»¤ ğŸ”— é…ç½® SSH å¯†é’¥è¿æ¥åˆ°è¿œç¨‹ä»“åº“ ğŸ‘¥ äº†è§£å›¢é˜Ÿåä½œå·¥ä½œæµ ğŸ› ï¸ æ¢ç´¢ Git å›¾å½¢åŒ–å·¥å…· ","date":"2025-10-05T00:08:22+08:00","image":"https://file.meimolihan.eu.org/img/git-Install-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b9d8aebf/","title":"Git å®‰è£…ä¸å¸è½½å®Œæ•´æŒ‡å— ğŸš€"},{"content":"iStoreOS å®‰è£…å¹¶é…ç½® AdGuard Home æŒ‡å— ğŸ“± æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»åœ¨ iStoreOS ç³»ç»Ÿä¸­å®‰è£…å’Œé…ç½® AdGuard Home çš„å®Œæ•´æµç¨‹ã€‚AdGuard Home æ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘ç»œçº§å¹¿å‘Šæ‹¦æˆªå’Œéšç§ä¿æŠ¤å·¥å…·ã€‚\nmonksy åšä¸»è§†é¢‘ ğŸ“š ç›®å½•å¯¼èˆª ğŸš€ ç®€ä»‹ ğŸ“¥ ä¸€ã€ä¸‹è½½å¹¶å®‰è£… AdGuard Home âš™ï¸ äºŒã€AdGuard Home åˆå§‹åŒ– ğŸ”§ ä¸‰ã€AdGuard Home é…ç½® ğŸ’¡ å››ã€ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ ğŸ—‘ï¸ äº”ã€å¸è½½ AdGuard Home ğŸ¯ æ€»ç»“ ğŸš€ ç®€ä»‹ æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»åœ¨ iStoreOS ç³»ç»Ÿä¸­å®‰è£…å’Œé…ç½® AdGuard Home çš„å®Œæ•´æµç¨‹ã€‚AdGuard Home æ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘ç»œçº§å¹¿å‘Šæ‹¦æˆªå’Œéšç§ä¿æŠ¤å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nâœ¨ æ ¸å¿ƒåŠŸèƒ½äº®ç‚¹ï¼š\nğŸ›¡ï¸ å…¨ç½‘å¹¿å‘Šæ‹¦æˆª - ä¿æŠ¤æ‰€æœ‰è¿æ¥åˆ°ç½‘ç»œçš„è®¾å¤‡ ğŸ”’ éšç§ä¿æŠ¤ - é˜»æ­¢è·Ÿè¸ªå™¨å’Œæ¶æ„ç½‘ç«™ âš¡ DNSåŠ é€Ÿ - æå‡ç½‘ç»œè®¿é—®é€Ÿåº¦ ğŸ“Š æ•°æ®ç»Ÿè®¡ - è¯¦ç»†çš„ä¸Šç½‘è¡Œä¸ºåˆ†æ ğŸ¯ å®¶é•¿æ§åˆ¶ - å†…å®¹è¿‡æ»¤å’Œæ—¶é—´ç®¡ç† ä¸€ã€ğŸ“¥ ä¸‹è½½å¹¶å®‰è£… AdGuard Home 1. è·å–å®‰è£…åŒ… å®˜æ–¹ä¸‹è½½åœ°å€ï¼š GitHub Releasesé¡µé¢ ğŸ’¡ å»ºè®®é€‰æ‹©ä¸æ‚¨è®¾å¤‡æ¶æ„åŒ¹é…çš„ç‰ˆæœ¬ 2. å®‰è£…æ­¥éª¤ ç™»å½• iStoreOS ç®¡ç†ç•Œé¢ è¿›å…¥ã€Œè½¯ä»¶åŒ…ç®¡ç†ã€ ä¸Šä¼ ä¸‹è½½çš„ AdGuard Home å®‰è£…åŒ… ç‚¹å‡»ã€Œå®‰è£…ã€å¹¶ç­‰å¾…å®Œæˆ äºŒã€âš™ï¸ AdGuard Home åˆå§‹åŒ– 1. å¯åŠ¨ AdGuard Home ğŸ”§ å¯åŠ¨æ³¨æ„äº‹é¡¹ï¼š\nç¡®ä¿è·¯ç”±å™¨æœ‰ç¨³å®šçš„ç½‘ç»œè¿æ¥ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®æ˜¯å¦å…è®¸ç›¸å…³ç«¯å£ 2. ä¿®æ”¹ iStoreOS DNS æœåŠ¡ç«¯å£ ğŸ“ é‡è¦æ­¥éª¤ï¼š\nå°†é»˜è®¤çš„ DNS æœåŠ¡ç«¯å£ä» 53 æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼ˆå¦‚ 5353ï¼‰ è¿™ä¸€æ­¥æ˜¯ä¸ºäº†é¿å…ç«¯å£å†²çª 3. AdGuard Home åˆå§‹åŒ–è®¾ç½® è®¿é—®åœ°å€ï¼šhttp://iStoreOS-IPåœ°å€:3000 ç½‘é¡µç®¡ç†ç•Œé¢ç«¯å£ï¼š3000 DNS æœåŠ¡ç«¯å£ï¼š53ï¼ˆé»˜è®¤ï¼‰ ğŸ¯ å…¶ä»–è®¾ç½®ä¿æŒé»˜è®¤å³å¯å®ŒæˆåŸºç¡€é…ç½® ä¸‰ã€ğŸ”§ AdGuard Home é…ç½® 1. ä¸Šæ¸¸ DNS æœåŠ¡å™¨é…ç½® 1 2 3 4 5 223.5.5.5 119.29.29.29 https://dns.alidns.com/dns-query https://doh.pub/dns-query https://dns.cloudflare.com/dns-query ğŸŒ DNSæœåŠ¡å™¨è¯´æ˜ï¼š\n223.5.5.5 - é˜¿é‡Œå…¬å…±DNSï¼Œå“åº”é€Ÿåº¦å¿« 119.29.29.29 - è…¾è®¯å…¬å…±DNSï¼Œç¨³å®šæ€§å¥½ DoH æœåŠ¡å™¨ - æä¾›åŠ å¯†çš„DNSæŸ¥è¯¢ï¼Œå¢å¼ºéšç§ä¿æŠ¤ 2. DNS é»‘åå•é…ç½® ğŸ›¡ï¸ é»‘åå•åŠŸèƒ½ç‰¹ç‚¹ï¼š\næ‹¦æˆªå¹¿å‘ŠåŸŸåå’Œè·Ÿè¸ªå™¨ é˜»æ­¢æ¶æ„è½¯ä»¶å’Œé’“é±¼ç½‘ç«™ æ”¯æŒè‡ªå®šä¹‰è§„åˆ™æ·»åŠ  å¯å¯¼å…¥ç¬¬ä¸‰æ–¹è¿‡æ»¤åˆ—è¡¨ å››ã€ğŸ’¡ ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®® å®šæœŸæ›´æ–°è¿‡æ»¤è§„åˆ™ - ä¿æŒå¹¿å‘Šæ‹¦æˆªæ•ˆæœ ç›‘æ§ç³»ç»Ÿèµ„æº - ç¡®ä¿è·¯ç”±å™¨æ€§èƒ½è¶³å¤Ÿ å¤‡ä»½é…ç½® - é˜²æ­¢æ„å¤–è®¾ç½®ä¸¢å¤± âš ï¸ å¸¸è§é—®é¢˜è§£å†³ æ— æ³•è®¿é—®ç®¡ç†ç•Œé¢ï¼šæ£€æŸ¥ç«¯å£è®¾ç½®å’Œé˜²ç«å¢™è§„åˆ™ DNSè§£æå¤±è´¥ï¼šéªŒè¯ä¸Šæ¸¸DNSæœåŠ¡å™¨å¯ç”¨æ€§ å¹¿å‘Šæ‹¦æˆªå¤±æ•ˆï¼šæ›´æ–°è¿‡æ»¤è§„åˆ™åˆ—è¡¨ ğŸ—‘ï¸ äº”ã€å¸è½½ AdGuard Home ç™»å½• iStoreOS ç®¡ç†ç•Œé¢ â†’ é¡¶éƒ¨èœå•ã€Œç³»ç»Ÿã€â†’ã€Œè½¯ä»¶åŒ…ã€ã€‚\nåœ¨ã€Œå·²å®‰è£…ã€æ ‡ç­¾é¡µæœç´¢å…³é”®è¯ adguard æˆ– AdGuardHomeã€‚\næ‰¾åˆ°å¯¹åº”åŒ…ï¼ˆåç§°é€šå¸¸æ˜¯ adguardhome æˆ– luci-app-adguardhomeï¼‰ï¼Œç‚¹å‡»å³ä¾§ã€Œç§»é™¤ã€ã€‚\nç­‰å¾…é¡µé¢æç¤ºå¸è½½å®Œæˆï¼Œé‡å¯ä¸€æ¬¡è·¯ç”±å™¨ï¼ˆå¯é€‰ï¼Œä½†å¯ç¡®ä¿ç«¯å£ã€DNS é…ç½®å®Œå…¨é‡Šæ”¾ï¼‰ã€‚\nå¸è½½åæ£€æŸ¥\nã€ŒæœåŠ¡ã€èœå•é‡Œå·²çœ‹ä¸åˆ° AdGuard Home å…¥å£ï¼› è·¯ç”±å™¨ 53/3000/8080 ç­‰ç«¯å£ä¸å†è¢«ç›‘å¬ï¼š\nSSH è¿è¡Œ netstat -lnp | grep -E ':53|:3000|:8080' æ— è¿”å›å³å¯ï¼› å¦‚ä¹‹å‰æŠŠ iStoreOS çš„ DNS ç«¯å£æ”¹æˆäº† 5353ï¼Œå¯å›åˆ°ã€Œç½‘ç»œâ†’DHCP/DNSâ†’é«˜çº§è®¾ç½®ã€æŠŠã€ŒDNS æœåŠ¡å™¨ç«¯å£ã€é‡æ–°å¡«å› 53 å¹¶ä¿å­˜ï¼Œæ¢å¤è·¯ç”±å™¨è‡ªèº« DNSã€‚ ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æˆåŠŸåœ¨ iStoreOS ä¸Šéƒ¨ç½²äº† AdGuard Homeï¼Œè·å¾—äº†ï¼š\nâœ… å®Œæ•´çš„å¹¿å‘Šæ‹¦æˆªèƒ½åŠ›\nâœ… å¢å¼ºçš„ç½‘ç»œéšç§ä¿æŠ¤\nâœ… è¯¦ç»†çš„ç½‘ç»œä½¿ç”¨ç»Ÿè®¡\nâœ… çµæ´»çš„è‡ªå®šä¹‰é…ç½®é€‰é¡¹\nğŸ”„ å»ºè®®å®šæœŸæ£€æŸ¥æ›´æ–°å’Œç»´æŠ¤é…ç½®ï¼Œä»¥è·å¾—æœ€ä½³çš„ç½‘ç»œä½“éªŒå’Œå®‰å…¨æ€§ã€‚\n","date":"2025-10-03T00:07:12+08:00","image":"https://file.meimolihan.eu.org/img/adguard_home-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9b761874/","title":"IStoreOS å®‰è£…å¹¶é…ç½® AdGuard Home æŒ‡å— ğŸ“±"},{"content":"ä¸ªäººè®¡åˆ’ä»»åŠ¡å®æˆ˜ ğŸ“… æœ¬æ–‡ä¸ºæ‚¨è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Linuxç³»ç»Ÿä¸­ä½¿ç”¨Cronè®¡åˆ’ä»»åŠ¡ï¼Œå®ç°å®šæ—¶è‡ªåŠ¨åŒ–è¿ç»´ï¼Œæ¶µç›–FnOSå’ŒDebianç³»ç»Ÿçš„å®æˆ˜é…ç½®æ¡ˆä¾‹ã€‚\nğŸ“– æ–‡ç« å¯¼èˆªç›®å½• âš™ï¸ ä¸€ã€FnOS è®¡åˆ’ä»»åŠ¡é…ç½® ğŸ§ äºŒã€Debian è®¡åˆ’ä»»åŠ¡é…ç½® ğŸ” ä¸‰ã€Cron ä»»åŠ¡ç®¡ç†æ“ä½œ ğŸ§ª å››ã€æµ‹è¯•è®¡åˆ’ä»»åŠ¡ âš ï¸ äº”ã€å¸¸è§é”™è¯¯ä¸é¿å‘æŒ‡å— ä¸€ã€âš™ï¸ FnOS è®¡åˆ’ä»»åŠ¡é…ç½® ä»¥ä¸‹æ˜¯é’ˆå¯¹FnOSç³»ç»Ÿçš„å®ç”¨è®¡åˆ’ä»»åŠ¡é…ç½®ï¼Œé‡‡ç”¨è¦†ç›–å¼å†™å…¥æ–¹å¼ï¼Œç¡®ä¿é…ç½®å‡†ç¡®æ— è¯¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 cat \u0026gt; /var/spool/cron/crontabs/$USER \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ######## æˆ‘çš„è®¡åˆ’ä»»åŠ¡ ######## ## æ·»åŠ æ›´æ–° hosts æ–‡ä»¶å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹ååˆ†æ‰§è¡Œ ## âœ¨ åŠŸèƒ½ï¼šè‡ªåŠ¨æ›´æ–°DNSè§£æï¼Œè§£å†³ç½‘ç»œè®¿é—®é—®é¢˜ 10 1 * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/hosts/DnsParse.py | python3 - \u0026gt;\u0026gt; /var/log/DnsParse.log 2\u0026gt;\u0026amp;1 ## hosts æ–‡ä»¶åŒæ­¥åˆ° emby \u0026amp; nastools ï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹äºŒååˆ†æ‰§è¡Œ ## ğŸ”„ åŠŸèƒ½ï¼šå¤šæœåŠ¡é…ç½®åŒæ­¥ï¼Œä¿æŒç¯å¢ƒä¸€è‡´æ€§ 20 1 * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- -f /etc/hosts /vol1/1000/compose/emby/config/hosts /vol1/1000/compose/nastools/config/hosts ######## æˆ‘çš„è®¡åˆ’ä»»åŠ¡ ######## EOF é…ç½®è¯´æ˜ï¼š\nğŸ• æ—¶é—´å®‰æ’ï¼šå‡Œæ™¨1ç‚¹æ‰§è¡Œï¼Œé¿å¼€ä¸šåŠ¡é«˜å³°æ—¶æ®µ ğŸ“Š æ—¥å¿—è®°å½•ï¼šæ‰€æœ‰æ“ä½œéƒ½è®°å½•åˆ°æŒ‡å®šæ—¥å¿—æ–‡ä»¶ï¼Œä¾¿äºç›‘æ§å’Œæ’æŸ¥ ğŸ”— è¿œç¨‹è„šæœ¬ï¼šç›´æ¥æ‰§è¡Œäº‘ç«¯è„šæœ¬ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†å’Œæ›´æ–° äºŒã€ğŸ§ Debian è®¡åˆ’ä»»åŠ¡é…ç½® é’ˆå¯¹Debianç³»ç»Ÿçš„ä¸“é¡¹è®¡åˆ’ä»»åŠ¡ï¼Œç‰¹åˆ«å…³æ³¨SSLè¯ä¹¦ç®¡ç†å’Œé…ç½®æ–‡ä»¶å¤‡ä»½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 cat \u0026gt; /var/spool/cron/crontabs/$USER \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ######## æˆ‘çš„è®¡åˆ’ä»»åŠ¡ ######## # æ¯å¤©å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œä¸€æ¬¡è¯ä¹¦å¼ºåˆ¶åŒæ­¥è„šæœ¬ # ğŸ” åŠŸèƒ½ï¼šä¿éšœç½‘ç«™SSLè¯ä¹¦åŠæ—¶æ›´æ–°ï¼Œé¿å…è¯ä¹¦è¿‡æœŸé£é™© 0 3 * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/ssl/allinssl_nginx_cert_daily.sh | /bin/bash \u0026gt;\u0026gt; /var/log/nginx/cert_update.log 2\u0026gt;\u0026amp;1 # åŒæ­¥ `nginx \u0026amp; html` ç›®å½•ï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹ååˆ†æ‰§è¡Œ # ğŸ’¾ åŠŸèƒ½ï¼šå…³é”®é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± 10 1 * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- /etc/nginx/ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æµ‹è¯•/nginx/ 15 1 * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- /var/www/html/ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æµ‹è¯•/html/ ######## æˆ‘çš„è®¡åˆ’ä»»åŠ¡ ######## EOF å®‰å…¨æé†’ï¼š\nğŸ›¡ï¸ è¯ä¹¦å®‰å…¨ï¼šSSLè¯ä¹¦è‡ªåŠ¨æ›´æ–°ç¡®ä¿ç½‘ç«™å®‰å…¨è®¿é—® ğŸ“¦ æ•°æ®å¤‡ä»½ï¼šNginxé…ç½®å’Œç½‘ç«™æ–‡ä»¶å®šæœŸå¤‡ä»½ï¼Œç¾éš¾æ¢å¤æœ‰ä¿éšœ ğŸ—‚ï¸ è·¯å¾„è§„èŒƒï¼šå¤‡ä»½åˆ°äº‘ç›˜ç›®å½•ï¼Œå®ç°å¼‚åœ°å­˜å‚¨ ä¸‰ã€ğŸ” Cron ä»»åŠ¡ç®¡ç†æ“ä½œ æŒæ¡Cronä»»åŠ¡çš„åŸºæœ¬ç®¡ç†å‘½ä»¤æ˜¯è¿ç»´å¿…å¤‡æŠ€èƒ½ã€‚\n1. åˆ—å‡ºå½“å‰ç”¨æˆ·çš„Cronä»»åŠ¡ 1 crontab -l ğŸ“‹ åŠŸèƒ½ï¼šæŸ¥çœ‹å·²é…ç½®çš„æ‰€æœ‰å®šæ—¶ä»»åŠ¡\n2. ç¼–è¾‘Cronä»»åŠ¡ 1 crontab -e âœï¸ åŠŸèƒ½ï¼šè¿›å…¥äº¤äº’å¼ç¼–è¾‘æ¨¡å¼ï¼Œä¿®æ”¹æˆ–æ·»åŠ æ–°ä»»åŠ¡\n3. åˆ é™¤æ‰€æœ‰Cronä»»åŠ¡ 1 crontab -r ğŸ—‘ï¸ åŠŸèƒ½ï¼šæ¸…ç©ºå½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¡åˆ’ä»»åŠ¡ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰\nå››ã€ğŸ§ª æµ‹è¯•è®¡åˆ’ä»»åŠ¡ 1. ä¸´æ—¶æµ‹è¯•ç‰ˆï¼ˆæ¯åˆ†é’Ÿï¼‰ï¼š 1 * * * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- /etc/nginx/ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æµ‹è¯•/nginx/ 2. ç”¨ watch æ¯ç§’çœ‹æ—¥å¿—ï¼ˆå¯è§†åŒ–ï¼‰ 1 2 # å¦ä¸€ä¸ªç»ˆç«¯ watch -n 1 \u0026#39;tail -n 30 /var/log/nginx/cert_update.log\u0026#39; äº”ã€âš ï¸ å¸¸è§é”™è¯¯ä¸é¿å‘æŒ‡å— åœ¨Croné…ç½®è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›å¸¸è§é”™è¯¯éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚\nâŒ é”™è¯¯ç¤ºèŒƒï¼šä½¿ç”¨ä¸æ”¯æŒçš„è¿›ç¨‹æ›¿æ¢è¯­æ³• 1 2 # é”™è¯¯å†™æ³•ï¼šcroné»˜è®¤ä½¿ç”¨/bin/shï¼Œä¸æ”¯æŒ \u0026lt;(...) è¿›ç¨‹æ›¿æ¢ 20 1 * * * bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) -f /etc/hosts /vol1/1000/compose/emby/config/hosts /vol1/1000/compose/nastools/config/hosts âœ… æ­£ç¡®å†™æ³•ï¼šä½¿ç”¨ç®¡é“æ–¹å¼ 1 2 # æ­£ç¡®å†™æ³•ï¼šå…¼å®¹æ€§æ›´å¥½ï¼Œæ”¯æŒæ‰€æœ‰shellç¯å¢ƒ 20 1 * * * /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- -f /etc/hosts /vol1/1000/compose/emby/config/hosts /vol1/1000/compose/nastools/config/hosts è¯­æ³•ä¿®æ­£å¯¹æ¯”ï¼š\nbash \u0026lt;(curl -sL URL) â†’ /usr/bin/curl -sL URL | /bin/bash ğŸš åŸå› ï¼šCroné»˜è®¤ä½¿ç”¨/bin/shï¼Œä¸æ”¯æŒbashçš„è¿›ç¨‹æ›¿æ¢ç‰¹æ€§ ğŸ”§ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ç®¡é“æ–¹å¼ç¡®ä¿è·¨ç¯å¢ƒå…¼å®¹ æ€»ç»“ï¼šé€šè¿‡åˆç†é…ç½®Cronè®¡åˆ’ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥æ„å»ºä¸€ä¸ªç¨³å®šå¯é çš„è‡ªåŠ¨åŒ–è¿ç»´ä½“ç³»ã€‚è®°ä½ï¼šå¥½çš„è‡ªåŠ¨åŒ–ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œè€Œæ˜¯æŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼ğŸš€\n","date":"2025-09-29T21:08:00+08:00","image":"https://file.meimolihan.eu.org/img/linux-cron-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dd097c18/","title":"ä¸ªäººè®¡åˆ’ä»»åŠ¡å®æˆ˜ ğŸ“…"},{"content":"FnOS æ ¸æ˜¾è°ƒç”¨å¤±è´¥è§£å†³æ–¹æ¡ˆ ğŸ–¥ï¸ åœ¨ Proxmox VE è™šæ‹ŸåŒ–ç¯å¢ƒä¸­éƒ¨ç½²çš„ FnOS ç³»ç»Ÿï¼Œè™½ç„¶æˆåŠŸå®‰è£…äº† i915-sriov-dkms é©±åŠ¨ï¼ˆé€šè¿‡åº”ç”¨å•†åº—å®‰è£…ï¼‰ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­å‘ç° FnOS å½±è§†åº”ç”¨æ— æ³•æ­£å¸¸è°ƒç”¨æ ¸æ˜¾ç¡¬ä»¶åŠ é€Ÿï¼ğŸ˜«\nğŸ“š å¯¼èˆªç›®å½• ğŸ”§ ä¸€ã€è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ ğŸ“¥ äºŒã€ä¸‹è½½ç¼ºå¤±å›ºä»¶ ğŸ”„ ä¸‰ã€æ›´æ–°initramfsé•œåƒ ğŸ’¡ å››ã€éªŒè¯ä¸æ€»ç»“ ä¸€ã€ğŸ”§ è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ é€šè¿‡åˆ†æç³»ç»Ÿæ—¥å¿—å’Œé©±åŠ¨çŠ¶æ€ï¼Œå‘ç°é—®é¢˜æ ¹æºåœ¨äº initramfs é•œåƒæœªåŒ…å«å¿…è¦çš„ Intel æ ¸æ˜¾å›ºä»¶ã€‚è§£å†³æ–¹æ¡ˆåˆ†ä¸ºä¸¤ä¸ªå…³é”®æ­¥éª¤ï¼š\nğŸ“¥ ä¸‹è½½ç¼ºå¤±çš„ Intel i915 å›ºä»¶æ–‡ä»¶ ğŸ”„ æ›´æ–°æ‰€æœ‰å†…æ ¸çš„ initramfs é•œåƒ æ•´ä¸ªæµç¨‹ç®€å•é«˜æ•ˆï¼Œåªéœ€å‡ ä¸ªå‘½ä»¤å³å¯å®Œæˆï¼âœ¨\näºŒã€ğŸ“¥ ä¸‹è½½ç¼ºå¤±å›ºä»¶ åœ¨æ›´æ–° initramfs æ—¶ï¼Œç³»ç»Ÿæç¤ºç¼ºå°‘å…³é”®çš„ Intel i915 å›ºä»¶æ–‡ä»¶ï¼š\n1 2 3 # åˆå§‹æ›´æ–°æ—¶å‡ºç°çš„è­¦å‘Šä¿¡æ¯ W: Possible missing firmware /lib/firmware/i915/bxtg_dmc.bin for module i915 W: Possible missing firmware /lib/firmware/i915/skl_guc.bin for module i915 ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨ä¸‹è½½ç¼ºå¤±æ–‡ä»¶ 1 2 3 # ä¸‹è½½å¹¶æ”¾ç½®ç¼ºå¤±çš„å›ºä»¶æ–‡ä»¶ sudo wget http://share.geekxw.top/fnos/bmg_dmc.bin -O /lib/firmware/i915/bmg_dmc.bin sudo wget http://share.geekxw.top/fnos/xe2lpd_dmc.bin -O /lib/firmware/i915/xe2lpd_dmc.bin ğŸ“ å›ºä»¶è¯´æ˜ bmg_dmc.binï¼šIntel Broxton/M ç³»åˆ—æ ¸æ˜¾çš„æ˜¾ç¤ºå¾®æ§åˆ¶å™¨å›ºä»¶ xe2lpd_dmc.binï¼šIntel Xe/LPD æ¶æ„çš„ç”µæºç®¡ç†å›ºä»¶ è¿™äº›å›ºä»¶å¯¹æ ¸æ˜¾çš„æ­£å¸¸å·¥ä½œå’Œç”µæºç®¡ç†è‡³å…³é‡è¦ï¼âš¡ ä¸‰ã€ğŸ”„ æ›´æ–°initramfsé•œåƒ ğŸ¯ ä»€ä¹ˆæ˜¯initramfsï¼Ÿ initramfsï¼ˆåˆå§‹RAMæ–‡ä»¶ç³»ç»Ÿï¼‰æ˜¯ä¸€ä¸ªä¸´æ—¶çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨Linuxå†…æ ¸å¯åŠ¨æ—¶åŠ è½½ï¼ŒåŒ…å«å¯åŠ¨è¿‡ç¨‹ä¸­å¿…éœ€çš„é©±åŠ¨ã€å·¥å…·å’Œé…ç½®æ–‡ä»¶ã€‚\nğŸ“‹ æ›´æ–°æ­¥éª¤ 1 2 # æ›´æ–°æ‰€æœ‰å·²å®‰è£…å†…æ ¸çš„initramfsé•œåƒ sudo update-initramfs -u -k all âœ… æˆåŠŸè¾“å‡ºç¤ºä¾‹ 1 2 root@FnOS:~# update-initramfs -u -k all update-initramfs: Generating /boot/initrd.img-6.12.18-trim ğŸ” æ­¥éª¤è¯´æ˜ -u å‚æ•°è¡¨ç¤ºæ›´æ–°ç°æœ‰initramfs -k all è¡¨ç¤ºå¯¹æ‰€æœ‰å·²å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬æ‰§è¡Œæ­¤æ“ä½œ å®Œæˆåï¼Œç³»ç»Ÿé‡å¯æ—¶ä¼šè‡ªåŠ¨åŠ è½½æ–°çš„initramfsï¼ŒåŒ…å«å®Œæ•´çš„æ ¸æ˜¾é©±åŠ¨æ”¯æŒ å››ã€ğŸ’¡ éªŒè¯ä¸æ€»ç»“ ğŸ§ª éªŒè¯æ–¹æ³• æ›´æ–°å®Œæˆåï¼Œå»ºè®®ï¼š\né‡å¯ç³»ç»Ÿï¼šsudo reboot æ£€æŸ¥é©±åŠ¨çŠ¶æ€ï¼šlsmod | grep i915 éªŒè¯æ ¸æ˜¾è¯†åˆ«ï¼šlspci | grep VGA æµ‹è¯•è§†é¢‘æ’­æ”¾ï¼šåœ¨FnOSå½±è§†åº”ç”¨ä¸­æ’­æ”¾é«˜æ¸…è§†é¢‘ ğŸ‰ é¢„æœŸæ•ˆæœ âœ… FnOSå½±è§†åº”ç”¨æ­£å¸¸è°ƒç”¨æ ¸æ˜¾ç¡¬ä»¶åŠ é€Ÿ âœ… è§†é¢‘æ’­æ”¾æµç•…ï¼ŒCPUå ç”¨ç‡æ˜¾è‘—é™ä½ âœ… ç³»ç»Ÿæ•´ä½“å›¾å½¢æ€§èƒ½æå‡ ğŸ“Œ é‡è¦æé†’ å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ›´æ–°ï¼Œç¡®ä¿é©±åŠ¨å’Œå›ºä»¶ä¸ºæœ€æ–°ç‰ˆæœ¬ å¦‚é‡é—®é¢˜ï¼Œå¯æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼šdmesg | grep i915 ä¸åŒç¡¬ä»¶å¹³å°å¯èƒ½éœ€è¦é¢å¤–çš„å›ºä»¶æ–‡ä»¶ ğŸš€ æ‰©å±•é˜…è¯»ï¼šå¯¹äºæ›´å¤æ‚çš„è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¿˜å¯ä»¥è€ƒè™‘åœ¨Proxmox VEå±‚é¢é…ç½®GPUç›´é€šæˆ–vGPUæ–¹æ¡ˆï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼\n","date":"2025-09-28T23:37:33+08:00","image":"https://file.meimolihan.eu.org/img/i915-sriov-dkms-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3fc77f22/","title":"FnOS æ ¸æ˜¾è°ƒç”¨å¤±è´¥è§£å†³æ–¹æ¡ˆ ğŸ–¥ï¸"},{"content":"Rsync ä¸€é”®å¤šç›®æ ‡å¢é‡åŒæ­¥è„šæœ¬ ğŸ” æ”¯æŒæ–‡ä»¶â†’å¤šæ–‡ä»¶ã€ç›®å½•â†’å¤šç›®å½•åŒæ¨¡å¼ï¼Œå½©è‰²ç»ˆç«¯ã€å®æ—¶è¿›åº¦ã€è‡ªåŠ¨æ—¥å¿—è½®è½¬ã€è€—æ—¶ç»Ÿè®¡ï¼Œä¸€æ¡å‘½ä»¤è§£å†³æ‰€æœ‰æœ¬åœ°åŒæ­¥åœºæ™¯ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ âš™ï¸ è„šæœ¬æ¶æ„è§£æ ğŸ“¦ å®‰è£…ä¸ä¾èµ– ğŸš€ ä½¿ç”¨æŒ‡å— ğŸ“ ç›®å½•åŒæ­¥ï¼ˆä¸åŠ  -fï¼‰ ğŸ“„ æ–‡ä»¶åŒæ­¥ï¼ˆåŠ  -fï¼‰ ğŸ” è„šæœ¬åŠŸèƒ½è¯¦è§£ ğŸ• è‡ªåŠ¨åŒ–ç¤ºä¾‹ï¼ˆcronï¼‰ ğŸ”§ å¸¸ç”¨é€‰é¡¹ç»„åˆ ğŸ—‚ï¸ æ—¥å¿—ç³»ç»Ÿè¯¦è§£ âš ï¸ æ•…éšœæ’æŸ¥æŒ‡å— ğŸ¯ æ€»ç»“ä¸æŠ€å·§ ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ ğŸ¯ åŒæ¨¡å¼æ™ºèƒ½è¯†åˆ« ç›®å½•æ¨¡å¼ï¼šè‡ªåŠ¨æ·»åŠ å°¾éšæ–œæ ï¼Œä½¿ç”¨ --delete ä¿æŒä¸€è‡´æ€§ æ–‡ä»¶æ¨¡å¼ï¼šç²¾ç¡®åŒæ­¥å•ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„ ğŸ”§ è‡ªåŠ¨åŒ–è¿ç»´ ä¾èµ–è‡ªæ£€ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£… rsync è½¯ä»¶åŒ… ç›®å½•è‡ªå»ºï¼šç›®æ ‡è·¯å¾„ä¸å­˜åœ¨æ—¶è‡ªåŠ¨ mkdir -p æ—¥å¿—è½®è½¬ï¼šå†…ç½® 15 å¤©å‹ç¼©è½®è½¬ç­–ç•¥ ğŸ“Š å®æ—¶ç›‘æ§åé¦ˆ å½©è‰²è¿›åº¦ï¼šç»ˆç«¯å®æ—¶æ˜¾ç¤ºä¼ è¾“è¿›åº¦ å®Œæˆåº¦ä¼°ç®—ï¼šç›®å½•åŒæ­¥åè®¡ç®—ç©ºé—´å æ¯” è€—æ—¶ç»Ÿè®¡ï¼šç²¾ç¡®åˆ°ç§’çš„ä»»åŠ¡æ‰§è¡Œæ—¶é—´ ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶ ä¸¥æ ¼æ¨¡å¼ï¼šset -euo pipefail ç¡®ä¿è„šæœ¬å¥å£®æ€§ çŠ¶æ€æ£€æŸ¥ï¼šæ¯ä¸ªåŒæ­¥ç›®æ ‡ç‹¬ç«‹éªŒè¯ é”™è¯¯éš”ç¦»ï¼šå•ç›®æ ‡å¤±è´¥ä¸å½±å“å…¶ä»–ä»»åŠ¡ âš™ï¸ è„šæœ¬æ¶æ„è§£æ 1 2 # è„šæœ¬æ‰§è¡Œæµç¨‹ 1. å‚æ•°è§£æ â†’ 2. ç¯å¢ƒæ£€æŸ¥ â†’ 3. ä¾èµ–å®‰è£… â†’ 4. åŒæ­¥æ‰§è¡Œ â†’ 5. ç»“æœç»Ÿè®¡ æ ¸å¿ƒå‡½æ•°è¯´æ˜ï¼š\nlog(): åŒé€šé“æ—¥å¿—ï¼ˆç»ˆç«¯å½©è‰² + æ–‡ä»¶çº¯æ–‡æœ¬ï¼‰ sync_and_check(): æ ¸å¿ƒåŒæ­¥é€»è¾‘ï¼ŒåŒºåˆ†æ–‡ä»¶/ç›®å½•æ¨¡å¼ è‡ªåŠ¨è·¯å¾„å¤„ç†ï¼šæ™ºèƒ½å¤„ç†å°¾éšæ–œæ é—®é¢˜ ğŸ“¦ å®‰è£…ä¸ä¾èµ– å¿«é€Ÿå®‰è£… 1 2 3 4 5 6 # 1. ä¸‹è½½è„šæœ¬åˆ°ç³»ç»Ÿè·¯å¾„ sudo curl -o /usr/local/bin/rsync.sh https://raw.githubusercontent.com/your-repo/rsync.sh/main/rsync.sh sudo chmod 755 /usr/local/bin/rsync.sh # 2. éªŒè¯å®‰è£… rsync.sh --version ğŸš€ ä½¿ç”¨æŒ‡å— ğŸ“ ç›®å½•åŒæ­¥æ¨¡å¼ ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) /æºç›®å½• /ç›®æ ‡ç›®å½•1 /ç›®æ ‡ç›®å½•2 å…³é”®å‚æ•°è¯´æ˜ï¼š\n-a: å½’æ¡£æ¨¡å¼ï¼ˆä¿ç•™æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰ -v: è¯¦ç»†è¾“å‡º -h: äººç±»å¯è¯»æ ¼å¼ -z: å‹ç¼©ä¼ è¾“ -p: ä¿ç•™æƒé™ --delete: åˆ é™¤ç›®æ ‡ä¸­æºä¸å­˜åœ¨çš„æ–‡ä»¶ ğŸ“„ æ–‡ä»¶åŒæ­¥æ¨¡å¼ ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) -f /æºæ–‡ä»¶ /ç›®æ ‡æ–‡ä»¶1 /ç›®æ ‡æ–‡ä»¶2 ä¸ç›®å½•æ¨¡å¼å·®å¼‚ï¼š\nä¸ä½¿ç”¨ --delete é€‰é¡¹ ä¸æ·»åŠ å°¾éšæ–œæ  ä¸è®¡ç®—å®Œæˆåº¦ç™¾åˆ†æ¯” ğŸ” è„šæœ¬åŠŸèƒ½è¯¦è§£ é¢œè‰²ç¼–ç ç³»ç»Ÿ 1 2 3 4 5 6 7 RED=\u0026#39;\\033[0;31m\u0026#39; # é”™è¯¯ä¿¡æ¯ GREEN=\u0026#39;\\033[0;32m\u0026#39; # æˆåŠŸä¿¡æ¯ YELLOW=\u0026#39;\\033[1;33m\u0026#39; # è­¦å‘Šä¿¡æ¯ BLUE=\u0026#39;\\033[0;34m\u0026#39; # æµç¨‹ä¿¡æ¯ PURPLE=\u0026#39;\\033[0;35m\u0026#39; # åŒæ­¥å¼€å§‹ CYAN=\u0026#39;\\033[0;36m\u0026#39; # çŠ¶æ€ä¿¡æ¯ WHITE=\u0026#39;\\033[1;37m\u0026#39; # ç»Ÿè®¡ä¿¡æ¯ å®Œæˆåº¦è®¡ç®—é€»è¾‘ 1 2 3 4 5 6 # è®¡ç®—æºå’Œç›®æ ‡ç›®å½•å¤§å° src_size=$(du -sb \u0026#34;$source_path\u0026#34; | awk \u0026#39;{print $1}\u0026#39;) tgt_size=$(du -sb \u0026#34;$tgt\u0026#34; | awk \u0026#39;{print $1}\u0026#39;) # è®¡ç®—å®Œæˆåº¦ç™¾åˆ†æ¯” comp=$(awk -v s=$src_size -v t=$tgt_size \u0026#39;BEGIN{printf \u0026#34;%.2f\u0026#34;,(t/s)*100}\u0026#39;) æ™ºèƒ½è·¯å¾„å¤„ç† 1 2 3 4 5 6 7 8 # è‡ªåŠ¨å»é™¤æºè·¯å¾„å°¾éšæ–œæ  source_path=\u0026#34;${1%/}\u0026#34; # ç›®å½•æ¨¡å¼è‡ªåŠ¨æ·»åŠ æ–œæ  rsync -avhzp --progress --delete \u0026#34;$source_path/\u0026#34; \u0026#34;$tgt/\u0026#34; # æ–‡ä»¶æ¨¡å¼ä¿æŒåŸæ · rsync -avh --progress \u0026#34;$source_path\u0026#34; \u0026#34;$tgt\u0026#34; ğŸ• è‡ªåŠ¨åŒ–ç¤ºä¾‹ï¼ˆcronï¼‰ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # ç¼–è¾‘ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ sudo crontab -e # æ¯å¤©å‡Œæ™¨2ç‚¹åŒæ­¥ç½‘ç«™æ•°æ®ï¼ˆç›®å½•æ¨¡å¼ï¼‰ 0 2 * * * bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) /var/www/html /backup/www_daily \u0026gt;\u0026gt; /var/log/rsync/www.log 2\u0026gt;\u0026amp;1 # æ¯å°æ—¶åŒæ­¥é…ç½®æ–‡ä»¶ï¼ˆæ–‡ä»¶æ¨¡å¼ï¼‰ 0 * * * * bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) -f /etc/nginx/nginx.conf /backup/nginx/nginx.conf.$(date +\\%H) # æ¯å‘¨æ—¥å…¨é‡å¤‡ä»½ï¼ˆå¤šç›®æ ‡ï¼‰ 0 3 * * 0 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) /important_data /nas/backup /external_drive/backup --exclude=\u0026#39;temp/\u0026#39; ğŸ”§ å¸¸ç”¨é€‰é¡¹ç»„åˆ æ€§èƒ½ä¼˜åŒ–ç»„åˆ 1 2 3 4 5 6 7 8 9 10 11 12 # å¤§æ–‡ä»¶ä¼ è¾“ä¼˜åŒ– rsync.sh /large_files /target1 /target2 \\ --partial \\ --progress \\ --bwlimit=100m \\ --timeout=300 # æµ·é‡å°æ–‡ä»¶ä¼˜åŒ– rsync.sh /many_small_files /target1 /target2 \\ -W \\ --inplace \\ --no-compress å®‰å…¨åŒæ­¥ç»„åˆ 1 2 3 4 5 6 7 8 9 10 11 12 # é‡è¦æ•°æ®å®‰å…¨åŒæ­¥ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) /critical_data /backup1 /backup2 \\ --checksum \\ --ignore-times \\ --backup \\ --backup-dir=/backups/old # è·¨ç½‘ç»œåŠ å¯†åŒæ­¥ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) /sensitive_data /remote_backup \\ -e \u0026#34;ssh -p 2222 -i /path/to/key\u0026#34; \\ --compress \\ --timeout=60 ğŸ—‚ï¸ æ—¥å¿—ç³»ç»Ÿè¯¦è§£ æ—¥å¿—æ ¼å¼è§„èŒƒ 1 2 3 4 [2025-09-26 14:30:25] INFO: æ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨... [2025-09-26 14:30:25] SUCCESS: âœ“ æºç›®å½•å­˜åœ¨ï¼š/home/data [2025-09-26 14:30:26] INFO: æ£€æŸ¥ rsync æ˜¯å¦å®‰è£…... [2025-09-26 14:30:26] SUCCESS: âœ“ rsync å·²å°±ç»ª è½®è½¬é…ç½®è¯¦æƒ… 1 2 3 4 5 6 7 8 9 10 11 # è‡ªåŠ¨ç”Ÿæˆçš„è½®è½¬é…ç½® /var/log/rsync/*.log { daily # æ¯å¤©è½®è½¬ rotate 4 # ä¿ç•™4ä¸ªå¤‡ä»½ maxage 15 # æœ€å¤§ä¿å­˜15å¤© compress # å‹ç¼©æ—§æ—¥å¿— delaycompress # å»¶è¿Ÿå‹ç¼© missingok # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™ notifempty # ç©ºæ–‡ä»¶ä¸è½®è½¬ copytruncate # å¤åˆ¶æˆªæ–­ï¼Œç¡®ä¿æ—¥å¿—ä¸ä¸¢å¤± } æ—¥å¿—åˆ†ææŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹åŒæ­¥ç»Ÿè®¡ grep \u0026#34;å®Œæˆåº¦çº¦\u0026#34; /var/log/rsync/rsync.log # åˆ†æåŒæ­¥è€—æ—¶ grep \u0026#34;æ€»ç”¨æ—¶\u0026#34; /var/log/rsync/rsync.log # æ£€æŸ¥é”™è¯¯ä¿¡æ¯ grep -i \u0026#34;å¤±è´¥\\|error\\|failed\u0026#34; /var/log/rsync/rsync.log # æŒ‰æ—¶é—´ç­›é€‰æ—¥å¿— sed -n \u0026#39;/2025-09-26 10:00:00/,/2025-09-26 11:00:00/p\u0026#39; /var/log/rsync/rsync.log âš ï¸ æ•…éšœæ’æŸ¥æŒ‡å— å¸¸è§é”™è¯¯ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # rsync è¿”å›ä»£ç å«ä¹‰ 0: æˆåŠŸ 1: è¯­æ³•æˆ–ä½¿ç”¨é”™è¯¯ 2: åè®®ä¸å…¼å®¹ 3: æ–‡ä»¶é€‰æ‹©é”™è¯¯ 4: ä¸æ”¯æŒçš„æ“ä½œ 5: åè®®å¯åŠ¨å¤±è´¥ 6: å®ˆæŠ¤è¿›ç¨‹æ“ä½œå¤±è´¥ 10: socket I/O é”™è¯¯ 11: æ–‡ä»¶ I/O é”™è¯¯ 12: åè®®æ•°æ®æµé”™è¯¯ 13: æƒé™é”™è¯¯ 14: æ£€æŸ¥å’Œä¸åŒ¹é… 20: æ”¶åˆ° SIGUSR1 æˆ– SIGINT 21: ç­‰å¾…å­è¿›ç¨‹æ—¶å‡ºç°é”™è¯¯ 22: é”™è¯¯åˆ†é…å†…å­˜ 23: éƒ¨åˆ†ä¼ è¾“ 24: æ–‡ä»¶æœªå®Œå…¨ä¼ è¾“ 25: ä¼ è¾“æå‰ç»“æŸ è°ƒè¯•æ¨¡å¼å¯ç”¨ 1 2 3 4 5 6 7 8 9 10 # æ‰‹åŠ¨å¯ç”¨è¯¦ç»†è°ƒè¯• bash -x /usr/local/bin/rsync.sh /source /target1 # ä¸´æ—¶ä¿®æ”¹è„šæœ¬æ·»åŠ è°ƒè¯•ä¿¡æ¯ # åœ¨è„šæœ¬å¼€å¤´æ·»åŠ ï¼šset -x # æ£€æŸ¥ç¯å¢ƒå˜é‡ env | grep -i rsync echo $PATH which rsync æ€§èƒ½é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç£ç›˜IO iostat -x 1 # ç›‘æ§ç½‘ç»œå¸¦å®½ iftop -i eth0 # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ top -p $(pgrep rsync) # åˆ†æå¤§æ–‡ä»¶ find /source -type f -size +100M -exec ls -lh {} \\; ğŸ¯ æ€»ç»“ä¸æŠ€å·§ æœ€ä½³å®è·µå»ºè®® æµ‹è¯•å…ˆè¡Œï¼šé¦–æ¬¡ä½¿ç”¨æ·»åŠ  --dry-run å‚æ•°é¢„è§ˆ å¾ªåºæ¸è¿›ï¼šå…ˆå•ç›®æ ‡æµ‹è¯•ï¼Œå†æ‰©å±•å¤šç›®æ ‡ ç›‘æ§èµ„æºï¼šå¤§æ–‡ä»¶åŒæ­¥æ—¶ç›‘æ§ç³»ç»Ÿè´Ÿè½½ å¤‡ä»½é…ç½®ï¼šé‡è¦åŒæ­¥ä»»åŠ¡ä¿å­˜ä¸ºè„šæœ¬æ–‡ä»¶ é«˜çº§ä½¿ç”¨æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ‰¹é‡åŒæ­¥è„šæœ¬æ¨¡æ¿ #!/bin/bash SOURCE_DIRS=(\u0026#34;/data/www\u0026#34; \u0026#34;/data/db\u0026#34; \u0026#34;/data/logs\u0026#34;) TARGETS=(\u0026#34;/backup/primary\u0026#34; \u0026#34;/backup/secondary\u0026#34;) for source in \u0026#34;${SOURCE_DIRS[@]}\u0026#34;; do rsync.sh \u0026#34;$source\u0026#34; \u0026#34;${TARGETS[@]}\u0026#34; --exclude=\u0026#39;tmp/\u0026#39; --bwlimit=50m done # æ¡ä»¶åŒæ­¥ï¼ˆä»…åŒæ­¥å˜åŒ–ï¼‰ if [[ $(find /data -mmin -60 | wc -l) -gt 0 ]]; then rsync.sh /data /backup/data fi ç‰ˆæœ¬æ›´æ–°è®°å½• v1.2 (2025-09-26): æ–°å¢æ–‡ä»¶æ¨¡å¼(-f)ï¼Œå¢å¼ºé”™è¯¯å¤„ç† v1.1: å¢åŠ è¿›åº¦æ˜¾ç¤ºï¼Œå®Œå–„æ—¥å¿—è½®è½¬ v1.0: åŸºç¡€ç›®å½•åŒæ­¥åŠŸèƒ½ ğŸ’« ç»“è¯­ rsync.sh v1.2 é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ¶æ„å’Œä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¸ºç³»ç»Ÿç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜æä¾›äº†é«˜æ•ˆå¯é çš„æ–‡ä»¶åŒæ­¥è§£å†³æ–¹æ¡ˆã€‚æ— è®ºæ˜¯ç®€å•çš„æ—¥å¸¸å¤‡ä»½è¿˜æ˜¯å¤æ‚çš„å¤šç›®æ ‡éƒ¨ç½²ï¼Œè¿™ä¸ªå·¥å…·éƒ½èƒ½æ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡ã€‚\nè®°ä½æ ¸å¿ƒåŸåˆ™ï¼šğŸ“ ç›®å½•å» -fï¼ŒğŸ“„ æ–‡ä»¶åŠ  -fï¼ŒğŸ›£ï¸ è·¯å¾„è‡ªç„¶å†™ï¼ŒğŸ”§ è„šæœ¬æ™ºèƒ½è¡¥ï¼\nè„šæœ¬æŒç»­ç»´æŠ¤ä¸­ï¼Œæ¬¢è¿åé¦ˆä½¿ç”¨ä½“éªŒå’ŒåŠŸèƒ½å»ºè®®ï¼\n","date":"2025-09-27T17:15:35+08:00","image":"https://file.meimolihan.eu.org/img/rsync-02.webp","permalink":"https://blog.meimolihan.eu.org/p/39297029/","title":"Rsync ä¸€é”®å¤šç›®æ ‡å¢é‡åŒæ­¥è„šæœ¬ ğŸ”"},{"content":"Hugo + Stack ä¸»é¢˜è‡ªå®šä¹‰ Widget æŒ‡å— âœ¨ æœ¬æ–‡æ‘˜æŠ„è‡ªï¼š è±ç‰¹é›·-letere å¹¶è¡¥å……ç›¸å…³å†…å®¹ï¼Œåœ¨æ­¤æ„Ÿè°¢å¤§ä½¬çš„åˆ†äº«\nğŸ“š å¯¼èˆªç›®å½• ğŸš€ æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿ ğŸ› ï¸ å®ç°æ–¹æ³•è¯¦è§£ â° ä¸€ã€æ—¶é’Ÿç»„ä»¶ ğŸ“¢ äºŒã€å…¬å‘Šæ  ğŸ“Š ä¸‰ã€ç«™ç‚¹ç»Ÿè®¡ä¿¡æ¯ ğŸ¯ æ€»ç»“ä¸åº”ç”¨åœºæ™¯ ğŸš€ æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿ Hugo Stack ä¸»é¢˜çš„è‡ªå®šä¹‰ Widget åŠŸèƒ½ä¸ºåšå®¢ä¾§è¾¹æ æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š\nâœ¨ æ ¸å¿ƒä¼˜åŠ¿ ğŸ”„ æ— ç¼é›†æˆï¼šä¸ Stack ä¸»é¢˜å®Œç¾èåˆï¼Œæ— éœ€ä¿®æ”¹ä¸»é¢˜æºç  ğŸ¨ é«˜åº¦è‡ªå®šä¹‰ï¼šæ”¯æŒ HTMLã€CSSã€JavaScript å…¨æ ˆå¼€å‘ ğŸ“± å“åº”å¼è®¾è®¡ï¼šè‡ªåŠ¨é€‚é…æ¡Œé¢å’Œç§»åŠ¨ç«¯å¸ƒå±€ âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Œä¸å½±å“é¡µé¢æ•´ä½“æ€§èƒ½ ğŸ”§ æŠ€æœ¯ç‰¹æ€§ åŸºäº Hugo çš„æ¨¡æ¿ç³»ç»Ÿï¼Œä½¿ç”¨ partials æœºåˆ¶ æ”¯æŒç°ä»£å‰ç«¯æŠ€æœ¯æ ˆï¼ˆVue/React ç»„ä»¶éœ€ç¼–è¯‘åä½¿ç”¨ï¼‰ æ ·å¼éš”ç¦»ï¼Œé¿å…ä¸ä¸»é¢˜æ ·å¼å†²çª ğŸ› ï¸ å®ç°æ–¹æ³•è¯¦è§£ ğŸ“ æ–‡ä»¶ç»“æ„è§„åˆ’ åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„æ¥ç»„ç»‡è‡ªå®šä¹‰ Widgetï¼š\n1 2 3 4 5 6 7 layouts/ â””â”€â”€ partials/ â””â”€â”€ widget/ â”œâ”€â”€ clock.html # æ—¶é’Ÿç»„ä»¶ â”œâ”€â”€ weather.html # å¤©æ°”ç»„ä»¶ â”œâ”€â”€ recent-posts.html # æœ€æ–°æ–‡ç«  â””â”€â”€ custom-stats.html # ç»Ÿè®¡ä¿¡æ¯ ğŸ“ åŸºç¡€æ¨¡æ¿ç»“æ„ æ¯ä¸ª Widget åº”éµå¾ªä»¥ä¸‹æ ‡å‡†ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 \u0026lt;!-- ç»„ä»¶å®¹å™¨ --\u0026gt; \u0026lt;div class=\u0026#34;custom-widget widget-{{.Name}}\u0026#34;\u0026gt; \u0026lt;!-- HTML å†…å®¹åŒºåŸŸ --\u0026gt; \u0026lt;div class=\u0026#34;widget-content\u0026#34;\u0026gt; \u0026lt;!-- ä½ çš„ç»„ä»¶å†…å®¹ --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- ç»„ä»¶æ ·å¼ --\u0026gt; \u0026lt;style\u0026gt; .widget-{{.Name}} { /* ç»„ä»¶æ ·å¼ */ margin: 1rem 0; padding: 1rem; background: var(--card-background); border-radius: 8px; box-shadow: var(--shadow-l1); } \u0026lt;/style\u0026gt; \u0026lt;!-- ç»„ä»¶è„šæœ¬ --\u0026gt; \u0026lt;script\u0026gt; document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, function() { // ç»„ä»¶äº¤äº’é€»è¾‘ console.log(\u0026#39;{{.Name}} widget loaded\u0026#39;); }); \u0026lt;/script\u0026gt; âš™ï¸ é…ç½®æ–‡ä»¶æ³¨å†Œ åœ¨ hugo.yaml ä¸­æ³¨å†Œ Widgetï¼š\n1 2 3 4 5 6 widgets: homepage: - type: clock # æ—¶é’Ÿå°éƒ¨ä»¶ - type: search # æœç´¢å°éƒ¨ä»¶ - type: notification # å…¬å‘Šæ  - type: archives # å½’æ¡£å°éƒ¨ä»¶ ä¸€ã€â° æ—¶é’Ÿç»„ä»¶ ğŸ¯ é¡¹ç›®èƒŒæ™¯ åŸºäºå¼€æºé¡¹ç›® pure-css3-clock åˆ›å»ºä¸€ä¸ªç²¾ç¾çš„ CSS3 æ—¶é’Ÿ Widgetã€‚\nğŸ“‹ å®ç°æ­¥éª¤ æ­¥éª¤ 1ï¼šåˆ›å»ºç»„ä»¶æ–‡ä»¶ 1 2 # åˆ›å»º Widget æ–‡ä»¶ touch layouts/partials/widget/clock.html æ­¥éª¤ 2ï¼šä¿®æ”¹åçš„ clock.html æ­¥éª¤ 3ï¼šé…ç½®æ³¨å†Œ åœ¨ hugo.yaml ä¸­æ·»åŠ ï¼š\n1 2 3 4 5 6 widgets: homepage: - type: clock # æ—¶é’Ÿå°éƒ¨ä»¶ - type: search # æœç´¢å°éƒ¨ä»¶ - type: notification # å…¬å‘Šæ  - type: archives # å½’æ¡£å°éƒ¨ä»¶ äºŒã€ğŸ“¢ å…¬å‘Šæ  ğŸ“‹ å®ç°æ­¥éª¤ æ­¥éª¤ 1ï¼šåˆ›å»ºç»„ä»¶æ–‡ä»¶ 1 2 # åˆ›å»º Widget æ–‡ä»¶ touch layouts/partials/widget/notification.html æ­¥éª¤ 2ï¼šä¿®æ”¹åçš„ notification.html æ­¥éª¤ 3ï¼šé…ç½®æ³¨å†Œ åœ¨ hugo.yaml ä¸­æ·»åŠ ï¼š\n1 2 3 4 5 6 widgets: homepage: - type: clock # æ—¶é’Ÿå°éƒ¨ä»¶ - type: search # æœç´¢å°éƒ¨ä»¶ - type: notification # å…¬å‘Šæ  - type: archives # å½’æ¡£å°éƒ¨ä»¶ ä¸‰ã€ğŸ“Š ç«™ç‚¹ç»Ÿè®¡ä¿¡æ¯ä¸ i18n âœ¨ åŠŸèƒ½ï¼šåœ¨é¡µè„šæ˜¾ç¤ºåšå®¢è¿è¡Œæ—¶é—´ã€æ–‡ç« ç»Ÿè®¡å’Œè®¿é—®é‡æ•°æ®ï¼Œæ”¯æŒå¤šè¯­è¨€ ğŸ“Œ å±•ç¤ºæ ¼å¼ï¼š æœ¬ç«™ç¨³å®šè¿è¡Œï¼š x å¤© å…±å‘è¡¨æ–‡ç« æ•°ï¼š x ç¯‡ æœ¬ç«™æ€»è®¿é—®é‡ï¼š x æ¬¡ ğŸ“‹ å®ç°æ­¥éª¤ æ­¥éª¤ 1ï¼šåˆ›å»ºç»„ä»¶æ–‡ä»¶ ğŸ“Œ ä½ç½®ï¼šåˆ›å»º./layouts/partials/widget/information.html æ–‡ä»¶å†…æ·»åŠ å¦‚ä¸‹ä»£ç : æ­¥éª¤ 2ï¼šä¿®æ”¹åçš„ information.html æ­¥éª¤ 3ï¼šé…ç½®æ³¨å†Œ åœ¨ hugo.yaml ä¸­æ·»åŠ ï¼š\n1 2 3 4 5 6 7 widgets: homepage: - type: clock # æ—¶é’Ÿå°éƒ¨ä»¶ - type: search # æœç´¢å°éƒ¨ä»¶ - type: notification # å…¬å‘Šæ  - type: information # ç«™ç‚¹ä¿¡æ¯ - type: archives # å½’æ¡£å°éƒ¨ä»¶ æ­¥éª¤ 4ï¼šé…ç½® i18n ğŸ“Œ ä½ç½®ï¼šåœ¨ä¸»é¢˜ç›®å½•/i18n/zh-cn.yaml ä¸‹æ‰¾åˆ°å¯¹åº”è¯­è¨€çš„æ–‡ä»¶ï¼Œåœ¨å±æ€§ footer ä¸‹æ·»åŠ ç›¸åº”å­—æ®µï¼Œç»“æœå¦‚ä¸‹: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 footer: # æœ¬ç«™ç¨³å®šè¿è¡Œï¼šxå¤© runtime1: other: æœ¬ç«™ç¨³å®šè¿è¡Œï¼š runtime2: other: å¤© # å…±å‘è¡¨æ–‡ç« æ•°ï¼šx ç¯‡ count1: other: å…±å‘è¡¨æ–‡ç« æ•°ï¼š count2: other: ç¯‡ # æœ¬ç«™æ€»è®¿é—®é‡ï¼šXæ¬¡ pv1: other: æœ¬ç«™æ€»è®¿é—®é‡ï¼š pv2: other: æ¬¡ æ­¥éª¤ 5ï¼šCSS ç¾åŒ– ğŸ“Œ ä½ç½®ï¼šä¿®æ”¹./assets/scss/custom.scss(æ–‡ä»¶ä¸å­˜åœ¨åˆ™è‡ªå·±åˆ›å»º)ï¼Œå°†ä»¥ä¸‹ä»£ç å¤åˆ¶è¿›å»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 .count_info { border: 1px solid #ddd; border-radius: 25px; font-weight: bold; padding-left: 30px !important; /* è°ƒæ•´å†…å®¹ä¸å®¹å™¨å·¦ä¾§è¾¹ç¼˜çš„è·ç¦» */ transition: transform 0.2s ease; } .count_info:hover { transform: scale(1.06); /* é¼ æ ‡æ‚¬åœ-å¡ç‰‡æ”¾å¤§ */ } .number-highlight { color: var(--hover-text-color); /* æ•°å€¼é¢œè‰²ä¿®æ”¹ */ font-weight: 600; } [data-scheme=\u0026#34;dark\u0026#34;] .count_info { border: 1px solid #39393900; padding: 12px; border-radius: 20px; background: #3f3f3f; color: #fff; } ğŸ¯ æ€»ç»“ä¸åº”ç”¨åœºæ™¯ ğŸŒŸ æˆåŠŸæ¡ˆä¾‹å±•ç¤º é€šè¿‡è‡ªå®šä¹‰ Widgetï¼Œä½ å¯ä»¥å®ç°å¤šç§å®ç”¨åŠŸèƒ½ï¼š\nğŸ“Š æ•°æ®å±•ç¤ºç±»\nç½‘ç«™ç»Ÿè®¡ä¿¡æ¯ GitHub è´¡çŒ®å›¾ æœ€æ–°é¡¹ç›®åŠ¨æ€ ğŸ¯ äº¤äº’åŠŸèƒ½ç±»\næœç´¢æ¡†å¢å¼º ä¸»é¢˜åˆ‡æ¢å™¨ éŸ³ä¹æ’­æ”¾å™¨ ğŸ“± ç¤¾äº¤åª’ä½“é›†æˆ\næœ€æ–°æ¨æ–‡å±•ç¤º GitHub æ´»åŠ¨æµ ç¤¾äº¤åª’ä½“é“¾æ¥ ğŸš€ æœ€ä½³å®è·µæ€»ç»“ ğŸ“ ä»£ç ç»„ç»‡ï¼šä¿æŒ HTMLã€CSSã€JavaScript åˆ†ç¦»å’Œæ¨¡å—åŒ– ğŸ¯ ç”¨æˆ·ä½“éªŒï¼šç¡®ä¿ Widget åŠ è½½å¿«é€Ÿä¸”ä¸å½±å“ä¸»è¦å†…å®¹ ğŸ”§ ç»´æŠ¤æ€§ï¼šæ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£ ğŸ“± å…¼å®¹æ€§ï¼šæµ‹è¯•ä¸åŒæµè§ˆå™¨å’Œè®¾å¤‡ä¸Šçš„è¡¨ç° ğŸ”® æ‰©å±•å¯èƒ½æ€§ è‡ªå®šä¹‰ Widget çš„æ½œåŠ›æ— é™ï¼Œä½ å¯ä»¥ï¼š\né›†æˆç¬¬ä¸‰æ–¹ API æœåŠ¡ åˆ›å»ºå¤æ‚çš„äº¤äº’å¼å›¾è¡¨ å®ç°å®æ—¶æ•°æ®æ›´æ–° æ„å»ºè¿·ä½ åº”ç”¨ï¼ˆå¦‚è®¡ç®—å™¨ã€å€’è®¡æ—¶ç­‰ï¼‰ ğŸ’« å¼€å§‹åˆ›ä½œå§ï¼ åˆ©ç”¨ Hugo Stack ä¸»é¢˜çš„å¼ºå¤§æ‰©å±•æ€§ï¼Œå°†ä½ çš„åˆ›æ„è½¬åŒ–ä¸ºç‹¬ç‰¹çš„ä¾§è¾¹æ ç»„ä»¶ï¼Œè®©åšå®¢æ›´åŠ ä¸ªæ€§åŒ–å’ŒåŠŸèƒ½ä¸°å¯Œã€‚\nğŸ“Œ æç¤ºï¼šåœ¨å®é™…éƒ¨ç½²å‰ï¼Œå»ºè®®åœ¨æœ¬åœ°å……åˆ†æµ‹è¯• Widget çš„åŠŸèƒ½å’Œæ€§èƒ½è¡¨ç°ï¼Œç¡®ä¿ä¸ºç”¨æˆ·æä¾›æµç•…çš„æµè§ˆä½“éªŒã€‚\n","date":"2025-09-26T11:35:53+08:00","image":"https://file.meimolihan.eu.org/img/stack-widget-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f8f9e642/","title":"Hugo + Stack ä¸»é¢˜è‡ªå®šä¹‰ Widget æŒ‡å— âœ¨"},{"content":"Windows ç³»ç»Ÿæ¿€æ´»æŒ‡å— âœ¨ ğŸ“‹ å¯¼èˆªç›®å½• ğŸ“š ç³»ç»Ÿæ¿€æ´»æ¦‚è¿° ğŸ”§ æ–¹æ³•ä¸€ï¼šMicrosoft Activation Scriptsè‡ªåŠ¨æ¿€æ´» ğŸ’» æ–¹æ³•äºŒï¼šKMSæœåŠ¡å™¨æ‰‹åŠ¨æ¿€æ´» ğŸ” æ¿€æ´»çŠ¶æ€æŸ¥è¯¢ä¸éªŒè¯ âš ï¸ æ³¨æ„äº‹é¡¹ä¸é£é™©æç¤º ğŸ“š ç³»ç»Ÿæ¿€æ´»æ¦‚è¿° Windowsç³»ç»Ÿæ¿€æ´»æ˜¯éªŒè¯æ“ä½œç³»ç»Ÿåˆæ³•æ€§çš„å¿…è¦æ­¥éª¤ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿäº«å—å®Œæ•´çš„åŠŸèƒ½å’Œå®‰å…¨æ›´æ–°ã€‚æœªæ¿€æ´»çš„ç³»ç»Ÿä¼šé¢ä¸´åŠŸèƒ½é™åˆ¶å’Œæ°´å°æç¤ºï¼Œå½±å“æ­£å¸¸ä½¿ç”¨ä½“éªŒã€‚\nä¸»è¦æ¿€æ´»æ–¹å¼ï¼š\nğŸ”‘ æ•°å­—è®¸å¯è¯æ¿€æ´» - ç»‘å®šç¡¬ä»¶IDçš„æ°¸ä¹…æ¿€æ´» ğŸŒ KMSæ¿€æ´» - é€šè¿‡å¯†é’¥ç®¡ç†æœåŠ¡çš„æ‰¹é‡æ¿€æ´» ğŸ“ ç”µè¯æ¿€æ´» - ç¦»çº¿æƒ…å†µä¸‹çš„å¤‡ç”¨æ–¹æ¡ˆ ğŸ”§ æ–¹æ³•ä¸€ï¼šMicrosoft Activation Scriptsè‡ªåŠ¨æ¿€æ´» é¡¹ç›®ä»‹ç» Microsoft Activation Scripts (MAS) æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæä¾›ç®€å•å¯é çš„Windowså’ŒOfficeæ¿€æ´»è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§æ¿€æ´»æ–¹å¼ã€‚\nä¸»è¦ç‰¹ç‚¹ï¼š\nâœ… å®Œå…¨å…è´¹ - æ— éœ€ä»˜è´¹è´­ä¹°æ¿€æ´»å·¥å…· ğŸ”’ å®‰å…¨å¯é  - å¼€æºä»£ç é€æ˜ï¼Œæ— æ¶æ„è½¯ä»¶ ğŸš€ ä¸€é”®æ“ä½œ - ç®€åŒ–å¤æ‚çš„æ¿€æ´»æµç¨‹ ğŸ“± å¤šç‰ˆæœ¬æ”¯æŒ - å…¼å®¹Windows 7-11åŠå„ç‰ˆæœ¬Office ä½¿ç”¨æ­¥éª¤ 1 2 3 4 5 # 1. æ‰§è¡Œæ¿€æ´»å‘½ä»¤ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ irm https://get.activated.win | iex # 2. éªŒè¯æ¿€æ´»çŠ¶æ€ slmgr.vbs -xpr æ‰§è¡Œæµç¨‹è¯´æ˜ï¼š\nä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShell è¾“å…¥æ¿€æ´»å‘½ä»¤åæŒ‰Enter è„šæœ¬è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿå¹¶é€‰æ‹©æœ€ä¼˜æ¿€æ´»æ–¹æ¡ˆ ç­‰å¾…æ¿€æ´»å®Œæˆæç¤º ğŸ’» æ–¹æ³•äºŒï¼šKMSæœåŠ¡å™¨æ‰‹åŠ¨æ¿€æ´» KMSæ¿€æ´»åŸç† KMSï¼ˆKey Management Serviceï¼‰æ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„æ‰¹é‡æ¿€æ´»æœåŠ¡ï¼Œé€šè¿‡è¿æ¥ç‰¹å®šçš„KMSæœåŠ¡å™¨å®ç°180å¤©å‘¨æœŸçš„æ¿€æ´»ã€‚\nè¯¦ç»†æ“ä½œæ­¥éª¤ 1 2 3 4 5 6 7 8 # ç¬¬ä¸€æ­¥ï¼šå®‰è£…äº§å“å¯†é’¥ slmgr /ipk W269N-WFGWX-YVC9B-4J6C9-T83GX # ç¬¬äºŒæ­¥ï¼šè®¾ç½®KMSæœåŠ¡å™¨åœ°å€ slmgr /skms kms.03k.org # ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œæ¿€æ´» slmgr /ato å¯†é’¥è¯´æ˜ï¼š\nğŸ¢ ä¼ä¸šç‰ˆå¯†é’¥ï¼šW269N-WFGWX-YVC9B-4J6C9-T83GX ğŸ”„ å®šæœŸç»­æœŸï¼šéœ€æ¯180å¤©é‡æ–°è¿æ¥KMSæœåŠ¡å™¨ ğŸŒ æœåŠ¡å™¨é€‰æ‹©ï¼šå¯ä½¿ç”¨å¤šä¸ªå…¬å…±KMSæœåŠ¡å™¨å¤‡ç”¨ ğŸ” æ¿€æ´»çŠ¶æ€æŸ¥è¯¢ä¸éªŒè¯ æ¿€æ´»çŠ¶æ€æ£€æŸ¥å‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹è¯¦ç»†æ¿€æ´»ä¿¡æ¯ slmgr -dlv # æ£€æŸ¥æ¿€æ´»å‰©ä½™æ—¶é—´ slmgr.vbs -xpr # æŸ¥çœ‹å®‰è£…çš„äº§å“å¯†é’¥ slmgr -dli éªŒè¯æŒ‡æ ‡è¯´æ˜ âœ… è®¸å¯è¯çŠ¶æ€ï¼šæ˜¾ç¤º\u0026quot;å·²æˆæƒ\u0026quot;æˆ–\u0026quot;Licensed\u0026quot; ğŸ“… åˆ°æœŸæ—¶é—´ï¼šKMSæ¿€æ´»æ˜¾ç¤ºå‰©ä½™å¤©æ•° ğŸ”¢ å¯†é’¥ç±»å‹ï¼šåŒºåˆ†é›¶å”®ç‰ˆã€æ‰¹é‡ç‰ˆç­‰ ğŸŒ æ¿€æ´»æ–¹å¼ï¼šæ•°å­—è®¸å¯ã€KMSã€MAKç­‰ âš ï¸ æ³¨æ„äº‹é¡¹ä¸é£é™©æç¤º å®‰å…¨å»ºè®® ğŸ” æƒé™ç®¡ç†ï¼šå§‹ç»ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæ¿€æ´»å‘½ä»¤ ğŸ“ å¤‡ä»½æ•°æ®ï¼šæ¿€æ´»å‰é‡è¦æ•°æ®å¤‡ä»½ ğŸ”„ ç³»ç»Ÿè¿˜åŸç‚¹ï¼šåˆ›å»ºç³»ç»Ÿè¿˜åŸç‚¹ä»¥é˜²ä¸‡ä¸€ ğŸŒ ç½‘ç»œç¯å¢ƒï¼šç¡®ä¿ç¨³å®šçš„ç½‘ç»œè¿æ¥ å¸¸è§é—®é¢˜å¤„ç† âŒ æ¿€æ´»å¤±è´¥ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½® âš ï¸ å®‰å…¨è½¯ä»¶æ‹¦æˆªï¼šæš‚æ—¶å…³é—­æ€æ¯’è½¯ä»¶ ğŸ”„ å‘½ä»¤æ— æ•ˆï¼šç¡®è®¤PowerShellç‰ˆæœ¬å…¼å®¹æ€§ ğŸ“› å¯†é’¥æ— æ•ˆï¼šå°è¯•æ›´æ¢å…¶ä»–å¯ç”¨å¯†é’¥ æ³•å¾‹é£é™©æç¤º âš–ï¸ é‡è¦å£°æ˜ï¼šè¯·ç¡®ä¿åœ¨åˆæ³•æˆæƒçš„ç³»ç»Ÿä¸Šä½¿ç”¨æ¿€æ´»å·¥å…·ï¼Œéµå®ˆå½“åœ°æ³•å¾‹æ³•è§„å’Œå¾®è½¯è½¯ä»¶è®¸å¯æ¡æ¬¾ã€‚æœ¬æŒ‡å—ä»…æä¾›æŠ€æœ¯å‚è€ƒï¼Œä¸é¼“åŠ±ç›—ç‰ˆè¡Œä¸ºã€‚\nğŸ“ æŠ€æœ¯æ”¯æŒï¼šå¦‚é‡æ¿€æ´»é—®é¢˜ï¼Œå»ºè®®æŸ¥é˜…é¡¹ç›®å®˜æ–¹æ–‡æ¡£æˆ–ç›¸å…³æŠ€æœ¯è®ºå›è·å–æœ€æ–°è§£å†³æ–¹æ¡ˆã€‚\n","date":"2025-09-26T09:36:56+08:00","image":"https://file.meimolihan.eu.org/img/win-activate-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9d96ac26/","title":"Windows ç³»ç»Ÿæ¿€æ´»æŒ‡å— âœ¨"},{"content":"Linux ç³»ç»Ÿåˆå§‹åŒ–é…ç½®å®Œå…¨æŒ‡å— ğŸš€ æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„ Linux ç³»ç»Ÿåˆå§‹åŒ–é…ç½®æ–¹æ¡ˆï¼Œæ¶µç›–ä»åŸºç¡€è½¯ä»¶å®‰è£…åˆ°é«˜çº§æœåŠ¡é…ç½®çš„å„ä¸ªæ–¹é¢ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›è„šæœ¬å’Œé…ç½®ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ“¦ ä¸€ã€å®‰è£…å¸¸ç”¨è½¯ä»¶ + æ›´æ–°å¹¶æ¸…ç†ç³»ç»Ÿ ğŸ”§ äºŒã€Linux å¼€å¯ SSH è„šæœ¬ ğŸ³ ä¸‰ã€Linux å®‰è£… Docker è„šæœ¬ ğŸ“¦ å››ã€Linux å®‰è£… docker-compose ğŸ’¾ äº”ã€Linux é…ç½® samba æœåŠ¡ ğŸ–¥ï¸ 1. ä½œä¸º samba æœåŠ¡ç«¯ ğŸ’» 2. ä½œä¸º samba å®¢æˆ·ç«¯ ğŸ”‘ å…­ã€Git SSH é…ç½®æµç¨‹ ğŸ± 1. Gitee SSH é…ç½®æµç¨‹ ğŸ± 2. GitHub SSH é…ç½®æµç¨‹ ğŸ’« æ€»ç»“ ä¸€ã€ğŸ“¦ å®‰è£…å¸¸ç”¨è½¯ä»¶ + æ›´æ–°å¹¶æ¸…ç†ç³»ç»Ÿ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸš€ ä¸€é”®å¼å®‰è£…ï¼šé€šè¿‡å•æ¡å‘½ä»¤å®Œæˆå¸¸ç”¨è½¯ä»¶çš„å®‰è£…å’Œç³»ç»Ÿæ›´æ–° ğŸ›¡ï¸ å®‰å…¨å‡çº§ï¼šå…¨é¢å‡çº§ç³»ç»Ÿè¡¥ä¸ï¼Œæå‡å®‰å…¨æ€§ ğŸ§¹ æ™ºèƒ½æ¸…ç†ï¼šè‡ªåŠ¨ç§»é™¤æ— ç”¨åŒ…ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ ğŸ“¦ ç²¾é€‰è½¯ä»¶é›†ï¼šåŒ…å«å¼€å‘ã€è¿ç»´ã€æ–‡ä»¶ç®¡ç†ç­‰æ ¸å¿ƒå·¥å…· 1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/init/init.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/init/init.sh) ğŸ”§ åŒ…å«çš„è½¯ä»¶åŒ…è¯´æ˜ï¼š\næ–‡æœ¬ç¼–è¾‘ï¼šnano - ç®€å•æ˜“ç”¨çš„å‘½ä»¤è¡Œæ–‡æœ¬ç¼–è¾‘å™¨ ç‰ˆæœ¬æ§åˆ¶ï¼šgit - åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ æ–‡ä»¶åŒæ­¥ï¼šrsync - é«˜æ•ˆçš„æ–‡ä»¶åŒæ­¥å·¥å…· å‹ç¼©è§£å‹ï¼šzip, unrar-free - æ–‡ä»¶å‹ç¼©å’Œè§£å‹å·¥å…· è¿œç¨‹è®¿é—®ï¼šopenssh-server - SSH æœåŠ¡ç«¯ï¼Œæ”¯æŒè¿œç¨‹è¿æ¥ ç½‘ç»œå·¥å…·ï¼šwget - æ–‡ä»¶ä¸‹è½½å·¥å…· æ–‡ä»¶ç®¡ç†ï¼štree - ç›®å½•æ ‘çŠ¶æ˜¾ç¤ºå·¥å…· æ–‡ä»¶å…±äº«ï¼šsamba, nfs-kernel-server, nfs-common - ç½‘ç»œæ–‡ä»¶å…±äº«æœåŠ¡ äºŒã€ğŸ”§ Linux å¼€å¯ SSH è„šæœ¬ ğŸŒŸ è„šæœ¬ç‰¹è‰²ï¼š\nâœ… å¤šå‘è¡Œç‰ˆæ”¯æŒï¼šå…¼å®¹ä¸»æµ Linux å‘è¡Œç‰ˆï¼ˆDebian, Ubuntu, CentOS, RHEL, Fedora, OpenSUSE, Arch Linuxï¼‰ ğŸ”’ å®‰å…¨é…ç½®ï¼šè‡ªåŠ¨ä¼˜åŒ– SSH å®‰å…¨è®¾ç½® âš¡ å¿«é€Ÿéƒ¨ç½²ï¼šä¸€é”®å®Œæˆ SSH æœåŠ¡å®‰è£…å’Œé…ç½® ğŸ“Š çŠ¶æ€ç›‘æ§ï¼šå®æ—¶æ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œè¿æ¥ä¿¡æ¯ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/ssh/setup-ssh.sh) ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§ï¼š\nè‡ªåŠ¨é…ç½®é˜²ç«å¢™è§„åˆ™ ç¦ç”¨ root ç›´æ¥ç™»å½•ï¼ˆå¯é€‰ï¼‰ è®¾ç½®å¯†é’¥è®¤è¯ä¼˜å…ˆ é…ç½®ç™»å½•è¶…æ—¶å’Œå°è¯•æ¬¡æ•°é™åˆ¶ ä¸‰ã€ğŸ³ Linux å®‰è£… Docker è„šæœ¬ ğŸ¯ åŠŸèƒ½äº®ç‚¹ï¼š\nğŸ”„ è‡ªåŠ¨æ£€æµ‹ï¼šæ™ºèƒ½è¯†åˆ«ç³»ç»Ÿç‰ˆæœ¬å’Œæ¶æ„ ğŸ“¦ å®Œæ•´å®‰è£…ï¼šåŒ…å« Docker Engineã€CLIã€Containerd ç­‰ç»„ä»¶ ğŸ”§ ä¼˜åŒ–é…ç½®ï¼šè‡ªåŠ¨è®¾ç½®é•œåƒåŠ é€Ÿå™¨å’Œå­˜å‚¨é©±åŠ¨ ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼šå®‰è£…åç«‹å³å¯åŠ¨å¹¶å¯ç”¨æœåŠ¡ 1 2 3 4 bash \u0026lt;(curl -sL kejilion.sh) docker install # æˆ– bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/docker/install-docker.sh) ğŸ’¡ Docker ä¼˜åŠ¿ï¼š\nğŸ—ï¸ å®¹å™¨åŒ–éƒ¨ç½²ï¼šåº”ç”¨éš”ç¦»ï¼Œç¯å¢ƒä¸€è‡´æ€§ âš¡ å¿«é€Ÿå¯åŠ¨ï¼šç§’çº§å¯åŠ¨å’Œåœæ­¢ ğŸ“¦ é•œåƒç®¡ç†ï¼šä¾¿æ·çš„åº”ç”¨æ‰“åŒ…å’Œåˆ†å‘ ğŸ”„ ç‰ˆæœ¬æ§åˆ¶ï¼šæ”¯æŒé•œåƒç‰ˆæœ¬ç®¡ç†å’Œå›æ»š å››ã€ğŸ“¦ Linux å®‰è£… docker-compose ğŸš€ ä¸»è¦ç‰¹æ€§ï¼š\nğŸ¯ ç²¾å‡†ç‰ˆæœ¬ï¼šæŒ‡å®šç¨³å®šç‰ˆæœ¬å®‰è£…ï¼Œç¡®ä¿å…¼å®¹æ€§ ğŸ”’ æƒé™é…ç½®ï¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„æ‰§è¡Œæƒé™ âœ… éªŒè¯å®‰è£…ï¼šå®‰è£…åç«‹å³éªŒè¯ç‰ˆæœ¬ä¿¡æ¯ 1 2 3 wget -c -O /usr/bin/docker-compose https://github.com/docker/compose/releases/download/v2.39.4/docker-compose-linux-x86_64 \u0026amp;\u0026amp; \\ chmod 755 /usr/bin/docker-compose \u0026amp;\u0026amp; \\ docker-compose version ğŸ”— èµ„æºä¿¡æ¯ï¼š\nGitHub é¡¹ç›®åœ°å€ï¼š https://github.com/docker/compose/releases ğŸ’ª docker-compose ä¼˜åŠ¿ï¼š\nğŸ“ YAML é…ç½®ï¼šä½¿ç”¨ç®€å•çš„ YAML æ–‡ä»¶å®šä¹‰å¤šå®¹å™¨åº”ç”¨ ğŸ”„ ä¸€é”®éƒ¨ç½²ï¼šå•å‘½ä»¤å¯åŠ¨/åœæ­¢æ•´ä¸ªåº”ç”¨æ ˆ ğŸŒ æœåŠ¡ç¼–æ’ï¼šè½»æ¾ç®¡ç†å¤šä¸ªå…³è”çš„å®¹å™¨æœåŠ¡ ğŸ“Š çŠ¶æ€ç®¡ç†ï¼šå®æ—¶æŸ¥çœ‹å„æœåŠ¡çŠ¶æ€å’Œæ—¥å¿— äº”ã€ğŸ’¾ é…ç½® samba æœåŠ¡ ğŸ–¥ï¸ ä½œä¸º samba æœåŠ¡ç«¯ ğŸª åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸŒ è·¨å¹³å°å…±äº«ï¼šæ”¯æŒ Windowsã€Linuxã€macOS å®¢æˆ·ç«¯è®¿é—® ğŸ‘¥ ç”¨æˆ·ç®¡ç†ï¼šçµæ´»çš„æƒé™æ§åˆ¶å’Œç”¨æˆ·è®¤è¯ ğŸ“ å¤šå…±äº«ç›®å½•ï¼šæ”¯æŒé…ç½®å¤šä¸ªå…±äº«æ–‡ä»¶å¤¹ ğŸ”’ å®‰å…¨é…ç½®ï¼šæ”¯æŒåŠ å¯†ä¼ è¾“å’Œè®¿é—®æ§åˆ¶ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/samba/samba_setup.sh) âœ… æ”¯æŒçš„ç³»ç»Ÿ: Ubuntu, Debian, CentOS, RHEL, Fedora\nğŸ’» ä½œä¸º samba å®¢æˆ·ç«¯ ğŸ”— è¿æ¥ç‰¹æ€§ï¼š\nğŸ”„ è‡ªåŠ¨æŒ‚è½½ï¼šæ”¯æŒå¼€æœºè‡ªåŠ¨æŒ‚è½½è¿œç¨‹å…±äº« ğŸ“‹ èº«ä»½éªŒè¯ï¼šæ”¯æŒç”¨æˆ·åå¯†ç è®¤è¯ ğŸ’¾ æŒä¹…è¿æ¥ï¼šé…ç½®ç¨³å®šçš„ç½‘ç»œæ–‡ä»¶å…±äº« âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šè‡ªåŠ¨è®¾ç½®åˆé€‚çš„ç¼“å­˜å’Œè¶…æ—¶å‚æ•° 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/samba/samba_mount.sh) å…­ã€ğŸ”‘ Git SSH é…ç½®æµç¨‹ 1. ğŸ± Gitee SSH é…ç½®æµç¨‹ ğŸŒ å›½å†…ä¼˜åŒ–ï¼š\nâš¡ å¿«é€Ÿè®¿é—®ï¼šé’ˆå¯¹å›½å†…ç½‘ç»œç¯å¢ƒä¼˜åŒ– ğŸ”’ åŒé‡å¤‡ä»½ï¼šæä¾›ä¸¤ä¸ªé•œåƒæºç¡®ä¿å¯ç”¨æ€§ ğŸ“§ è‡ªåŠ¨é…ç½®ï¼šä¸€é”®å®Œæˆå¯†é’¥ç”Ÿæˆå’Œå¹³å°é…ç½® 1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/git-ssh/gitee-ssh-init.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git-ssh/gitee-ssh-init.sh) 2. ğŸ™ GitHub SSH é…ç½®æµç¨‹ ğŸŒ å›½é™…å¹³å°ï¼š\nğŸ” å®‰å…¨è®¤è¯ï¼šä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ç”Ÿæˆå¯†é’¥å¯¹ âš™ï¸ è‡ªåŠ¨é…ç½®ï¼šè‡ªåŠ¨æ·»åŠ å…¬é’¥åˆ° GitHub è´¦æˆ· âœ… è¿æ¥æµ‹è¯•ï¼šè‡ªåŠ¨éªŒè¯ SSH è¿æ¥çŠ¶æ€ 1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/git-ssh/github-ssh-init.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git-ssh/github-ssh-init.sh) âœ… æ”¯æŒçš„ç³»ç»Ÿ: Linux, Windows, macOS\nğŸ¯ SSH å¯†é’¥ä¼˜åŠ¿ï¼š\nğŸ” æ›´é«˜å®‰å…¨æ€§ï¼šæ¯”å¯†ç è®¤è¯æ›´å®‰å…¨ âš¡ ä¾¿æ·ç™»å½•ï¼šæ— éœ€æ¯æ¬¡è¾“å…¥å¯†ç  ğŸ”„ å¤šå¹³å°åŒæ­¥ï¼šä¸€å¥—å¯†é’¥ç®¡ç†å¤šä¸ªä»£ç å¹³å° ğŸ›¡ï¸ è®¿é—®æ§åˆ¶ï¼šç²¾ç»†çš„æƒé™ç®¡ç†èƒ½åŠ› ğŸ’« æ€»ç»“ æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„ Linux ç³»ç»Ÿåˆå§‹åŒ–é…ç½®æ–¹æ¡ˆï¼Œæ¶µç›–ä»åŸºç¡€è½¯ä»¶å®‰è£…åˆ°é«˜çº§æœåŠ¡é…ç½®çš„å„ä¸ªæ–¹é¢ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›è„šæœ¬å’Œé…ç½®ï¼Œæ‚¨å¯ä»¥ï¼š\nğŸš€ å¿«é€Ÿæ­å»ºï¼šåœ¨å‡ åˆ†é’Ÿå†…å®Œæˆä¸“ä¸šçš„å¼€å‘ç¯å¢ƒé…ç½® ğŸ”’ å®‰å…¨ä¿éšœï¼šæ‰€æœ‰é…ç½®éƒ½ç»è¿‡å®‰å…¨ä¼˜åŒ– ğŸŒ å…¨é¢è¦†ç›–ï¼šæ»¡è¶³æ—¥å¸¸å¼€å‘å’Œè¿ç»´çš„å„ç±»éœ€æ±‚ ğŸ“š æ˜“äºç»´æŠ¤ï¼šè„šæœ¬åŒ–é…ç½®ä¾¿äºé‡å¤ä½¿ç”¨å’Œç‰ˆæœ¬ç®¡ç† å»ºè®®æŒ‰ç…§é¡ºåºæ‰§è¡Œå„ä¸ªæ­¥éª¤ï¼Œç¡®ä¿ç³»ç»Ÿé…ç½®çš„å®Œæ•´æ€§å’Œç¨³å®šæ€§ã€‚æ¯ä¸ªè„šæœ¬éƒ½ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œæ”¯æŒä¸»æµçš„ Linux å‘è¡Œç‰ˆï¼Œæ˜¯ Linux ç³»ç»Ÿç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ï¼\n","date":"2025-09-25T16:14:52+08:00","image":"https://file.meimolihan.eu.org/img/linux-system-01.webp","permalink":"https://blog.meimolihan.eu.org/p/18f92360/","title":"Linux ç³»ç»Ÿåˆå§‹åŒ–é…ç½®å®Œå…¨æŒ‡å— ğŸš€"},{"content":"Git SSH å¯†é’¥è‡ªåŠ¨é…ç½®è„šæœ¬ä½¿ç”¨æŒ‡å— ğŸš€ ç›®å½•å¯¼èˆª ğŸ“š âœ¨ ç®€ä»‹ ğŸŒŸ åŠŸèƒ½ç‰¹ç‚¹ ğŸ“‹ ä¸€ã€ä½¿ç”¨æ–¹æ³• ğŸ± 1. Gitee SSH é…ç½®æµç¨‹ ğŸ± 2. GitHub SSH é…ç½®æµç¨‹ ğŸ” äºŒã€è„šæœ¬è¯¦è§£ âš™ï¸ ä¸‰ã€é…ç½®è¯´æ˜ ğŸ› ï¸ å››ã€æ•…éšœæ’é™¤ ç®€ä»‹ âœ¨ æœ¬ä»“åº“æä¾›ä¸¤ä¸ªé«˜æ•ˆè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä¸“é—¨ç”¨äºå¿«é€Ÿé…ç½® Gitee å’Œ GitHub çš„ SSH å¯†é’¥è¿æ¥ã€‚è¿™äº›è„šæœ¬é‡‡ç”¨å…¨è‡ªåŠ¨æ™ºèƒ½åŒ–æµç¨‹ï¼Œç”¨æˆ·åªéœ€è¿›è¡Œç®€å•äº¤äº’å³å¯å®Œæˆä» Git ç¯å¢ƒæ£€æµ‹åˆ° SSH è¿æ¥æµ‹è¯•çš„å®Œæ•´é…ç½®æµç¨‹ã€‚\nğŸ¯ è§£å†³ç—›ç‚¹ ä¼ ç»Ÿé…ç½®å¤æ‚ï¼šæ‰‹åŠ¨é…ç½® SSH å¯†é’¥éœ€è¦å¤šä¸ªæ­¥éª¤ï¼Œå®¹æ˜“å‡ºé”™ å¹³å°å·®å¼‚å¤„ç†ï¼šä¸åŒä»£ç æ‰˜ç®¡å¹³å°ï¼ˆGitee/GitHubï¼‰é…ç½®è¦æ±‚ä¸åŒ ç³»ç»Ÿå…¼å®¹æ€§ï¼šä¸åŒæ“ä½œç³»ç»Ÿå’Œå‘è¡Œç‰ˆçš„ç¯å¢ƒå·®å¼‚ ğŸ“Š æ ¸å¿ƒä»·å€¼ é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå°†åŸæœ¬éœ€è¦ 10-15 åˆ†é’Ÿçš„æ‰‹åŠ¨é…ç½®è¿‡ç¨‹ç¼©çŸ­è‡³ 2-3 åˆ†é’Ÿï¼Œå¤§å¹…æå‡å¼€å‘ç¯å¢ƒ setup æ•ˆç‡ï¼\nåŠŸèƒ½ç‰¹ç‚¹ ğŸŒŸ ğŸ”§ å…¨è‡ªåŠ¨åŒ–ä½“éªŒ æ™ºèƒ½ç¯å¢ƒæ£€æµ‹ï¼šè‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿç±»å‹å’ŒåŒ…ç®¡ç†å™¨ ä¸€é”®å¼å®‰è£…ï¼šä» Git å®‰è£…åˆ° SSH é…ç½®å…¨ç¨‹è‡ªåŠ¨åŒ– äº¤äº’å¼å¼•å¯¼ï¼šå…³é”®æ­¥éª¤ç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼Œé¿å…è¯¯æ“ä½œ ğŸŒ å¤šå¹³å°å…¼å®¹ å¹³å° æ”¯æŒæƒ…å†µ ç‰¹è‰²åŠŸèƒ½ Linux âœ… å…¨é¢æ”¯æŒ è‡ªåŠ¨è¯†åˆ«å‘è¡Œç‰ˆï¼ˆDebian/Ubuntu/CentOS/RHEL/openSUSEï¼‰ macOS âœ… å®Œç¾è¿è¡Œ åŸç”Ÿç»ˆç«¯æ”¯æŒï¼ŒHomebrew ç¯å¢ƒå…¼å®¹ Windows âœ… Git Bash å®Œæ•´çš„ Linux-like ç¯å¢ƒä½“éªŒ ğŸ›¡ï¸ å®‰å…¨å¯é  å¼ºåŠ å¯†æ ‡å‡†ï¼šä½¿ç”¨ 4096 ä½ RSA åŠ å¯†ç®—æ³• å¯†é’¥éš”ç¦»ï¼šä¸ºæ¯ä¸ªå¹³å°ç”Ÿæˆç‹¬ç«‹çš„å¯†é’¥å¯¹ æƒé™æ§åˆ¶ï¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ï¼ˆ700/600ï¼‰ ğŸ’¡ ç”¨æˆ·å‹å¥½è®¾è®¡ å½©è‰²ç»ˆç«¯è¾“å‡ºï¼šä¸åŒä¿¡æ¯çº§åˆ«ä½¿ç”¨ä¸åŒé¢œè‰²æ ‡è¯† è¿›åº¦æç¤ºï¼šæ¸…æ™°çš„æ­¥éª¤ç¼–å·å’ŒçŠ¶æ€åé¦ˆ é”™è¯¯å¤„ç†ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œå‹å¥½é”™è¯¯æç¤º ä¸€ã€ä½¿ç”¨æ–¹æ³• ğŸ“‹ 1. ğŸ± Gitee SSH é…ç½®æµç¨‹ 1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/git-ssh/gitee-ssh-init.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git-ssh/gitee-ssh-init.sh) 2. ğŸ± GitHub SSH é…ç½®æµç¨‹ 1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/git-ssh/github-ssh-init.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git-ssh/github-ssh-init.sh) ğŸ”„ è¯¦ç»†æ‰§è¡Œæµç¨‹ æ­¥éª¤ 1: ç¯å¢ƒæ£€æµ‹ä¸å‡†å¤‡ ğŸ› ï¸ âœ… æ£€æµ‹ç³»ç»Ÿç±»å‹å’ŒåŒ…ç®¡ç†å™¨ âœ… è‡ªåŠ¨å®‰è£… Gitï¼ˆå¦‚æœªå®‰è£…ï¼‰ âœ… éªŒè¯ Git ç‰ˆæœ¬å…¼å®¹æ€§ æ­¥éª¤ 2: Git å…¨å±€é…ç½® âš™ï¸ 1 2 3 # è‡ªåŠ¨è®¾ç½®çš„ç”¨æˆ·é…ç½® git config --global user.name \u0026#34;æ‚¨çš„ç”¨æˆ·å\u0026#34; git config --global user.email \u0026#34;æ‚¨çš„é‚®ç®±\u0026#34; æ­¥éª¤ 3: SSH å¯†é’¥ç”Ÿæˆ ğŸ”‘ âœ… ç”Ÿæˆ 4096 ä½ RSA å¯†é’¥å¯¹ âœ… ä½¿ç”¨é‚®ç®±ä½œä¸ºå¯†é’¥æ³¨é‡Šæ ‡è¯† âœ… å¯†é’¥æ–‡ä»¶è‡ªåŠ¨å‘½åå’Œå­˜å‚¨ æ­¥éª¤ 4: å…¬é’¥æ·»åŠ æŒ‡å¯¼ ğŸ‘¨â€ğŸ’» 1 2 3 4 5 ================================================== æ‚¨çš„ SSH å…¬é’¥å¦‚ä¸‹ï¼ˆè¯·å®Œæ•´å¤åˆ¶ï¼‰ï¼š ssh-rsa AAAAB3NzaC1yc2E... meimolihan@gmail.com ================================================== è¯·æ‰“å¼€ Gitee æ·»åŠ é¡µé¢ï¼šhttps://gitee.com/profile/sshkeys æ­¥éª¤ 5: è‡ªåŠ¨é…ç½®å†™å…¥ ğŸ“ âœ… åˆ›å»º ~/.ssh/config æ–‡ä»¶ âœ… æ·»åŠ å¹³å°ç‰¹å®šçš„ SSH é…ç½® âœ… æ›´æ–° known_hosts æ–‡ä»¶ æ­¥éª¤ 6: è¿æ¥æµ‹è¯•éªŒè¯ âœ… 1 2 3 4 5 # æµ‹è¯• Gitee è¿æ¥ ssh -T git@gitee.com # æµ‹è¯• GitHub è¿æ¥ ssh -T git@github.com â±ï¸ æ—¶é—´é¢„ä¼° é¦–æ¬¡è¿è¡Œï¼šçº¦ 2-3 åˆ†é’Ÿï¼ˆåŒ…å«ç”¨æˆ·äº¤äº’æ—¶é—´ï¼‰ åç»­è¿è¡Œï¼šçº¦ 30 ç§’ï¼ˆå¤ç”¨ç°æœ‰é…ç½®ï¼‰ äºŒã€è„šæœ¬è¯¦è§£ ğŸ” ğŸ—ï¸ æ¶æ„è®¾è®¡ æ¨¡å—åŒ–å‡½æ•°è®¾è®¡ 1 2 3 4 5 6 7 8 # ä¸»è¦åŠŸèƒ½æ¨¡å— install_git_if_needed() # ç¯å¢ƒæ£€æµ‹ä¸å®‰è£… step_git_config() # Git é…ç½®è®¾ç½® step_gen_key() # å¯†é’¥ç”Ÿæˆç®¡ç† step_show_pub_and_wait() # ç”¨æˆ·äº¤äº’å¼•å¯¼ step_ssh_config() # SSH é…ç½®å†™å…¥ step_known_hosts() # ä¸»æœºå¯†é’¥ç®¡ç† step_test() # è¿æ¥æµ‹è¯•éªŒè¯ é”™è¯¯å¤„ç†æœºåˆ¶ 1 2 3 4 set -euo pipefail # ä¸¥æ ¼é”™è¯¯å¤„ç†æ¨¡å¼ # -e: å‘½ä»¤å¤±è´¥ç«‹å³é€€å‡º # -u: ä½¿ç”¨æœªå®šä¹‰å˜é‡æ—¶æŠ¥é”™ # -o pipefail: ç®¡é“å‘½ä»¤å¤±è´¥æ•´ä½“å¤±è´¥ ğŸ”„ æ™ºèƒ½é€‚é…é€»è¾‘ å¤šç³»ç»ŸåŒ…ç®¡ç†å™¨æ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 install_git_if_needed() { if [ -f /etc/debian_version ]; then # Debian/Ubuntu ç³»ç»Ÿ sudo apt-get update -qq \u0026amp;\u0026amp; sudo apt-get install -y git elif [ -f /etc/redhat-release ]; then # CentOS/RHEL ç³»ç»Ÿ if command -v dnf \u0026amp;\u0026gt;/dev/null; then sudo dnf -y install git # æ–°ç‰ˆæœ¬ä½¿ç”¨ dnf else sudo yum -y install git # è€ç‰ˆæœ¬ä½¿ç”¨ yum fi elif [ -f /etc/SuSE-release ] || [ -f /etc/SUSE-brand ]; then # openSUSE ç³»ç»Ÿ sudo zypper -n install git else log_error \u0026#34;æœªè¯†åˆ«çš„ Linux å‘è¡Œç‰ˆ\u0026#34; exit 1 fi } ğŸ“Š å¹³å°ç‰¹æ€§å¯¹æ¯” åŠŸèƒ½ç‰¹æ€§ Gitee è„šæœ¬ GitHub è„šæœ¬ å·®å¼‚è¯´æ˜ è¿æ¥ç«¯å£ æ ‡å‡† 22 ç«¯å£ 22 + 443 ç«¯å£ GitHub æ”¯æŒ HTTPS ç«¯å£å¤‡ç”¨ ä¸»æœºéªŒè¯ gitee.com ssh.github.com GitHub ä½¿ç”¨ä¸“ç”¨ SSH ç«¯ç‚¹ æ¬¢è¿æ¶ˆæ¯ Gitee ä¸ªæ€§åŒ–æ¬¢è¿è¯­ GitHub å®˜æ–¹æ¬¢è¿ä¿¡æ¯ å¹³å°ç‰¹å®šçš„è¿æ¥æˆåŠŸæç¤º é…ç½®ä¼˜åŒ– æ ‡å‡† SSH é…ç½® å¤šç«¯å£å¤‡ç”¨é…ç½® GitHub é’ˆå¯¹ç½‘ç»œç¯å¢ƒçš„ä¼˜åŒ– ä¸‰ã€é…ç½®è¯´æ˜ âš™ï¸ ğŸ›ï¸ è‡ªå®šä¹‰å˜é‡è°ƒæ•´ åŸºç¡€èº«ä»½é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # ğŸ“ åœ¨è„šæœ¬å¼€å¤´ä¿®æ”¹è¿™äº›å˜é‡å³å¯ä¸ªæ€§åŒ–é…ç½® # Gitee ä¸“ç”¨é…ç½® GITEE_USER=\u0026#34;meimolihan\u0026#34; # æ‚¨çš„ Gitee ç”¨æˆ·å GITEE_EMAIL=\u0026#34;meimolihan@gmail.com\u0026#34; # æ‚¨çš„ Gitee éªŒè¯é‚®ç®± KEY_COMMENT=\u0026#34;$GITEE_EMAIL\u0026#34; # å¯†é’¥æ³¨é‡Šï¼ˆå»ºè®®ä½¿ç”¨é‚®ç®±ï¼‰ # GitHub ä¸“ç”¨é…ç½® GITHUB_USER=\u0026#34;meimolihan\u0026#34; # æ‚¨çš„ GitHub ç”¨æˆ·å GITHUB_EMAIL=\u0026#34;meimolihan@gmail.com\u0026#34; # æ‚¨çš„ GitHub éªŒè¯é‚®ç®± KEY_COMMENT=\u0026#34;$GITHUB_EMAIL\u0026#34; # å¯†é’¥æ³¨é‡Šæ ‡è¯† æ–‡ä»¶è·¯å¾„é…ç½® 1 2 3 # ğŸ” å¯†é’¥æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆä¸€èˆ¬æ— éœ€ä¿®æ”¹ï¼‰ KEY_FILE=\u0026#34;$HOME/.ssh/id_rsa_gitee\u0026#34; # Gitee å¯†é’¥è·¯å¾„ KEY_FILE=\u0026#34;$HOME/.ssh/id_rsa_github\u0026#34; # GitHub å¯†é’¥è·¯å¾„ ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„ 1 2 3 4 5 6 7 ~/.ssh/ â”œâ”€â”€ ğŸ—ï¸ id_rsa_gitee # Gitee ç§é’¥ï¼ˆæƒé™ 600ï¼‰ â”œâ”€â”€ ğŸ”“ id_rsa_gitee.pub # Gitee å…¬é’¥ï¼ˆæƒé™ 644ï¼‰ â”œâ”€â”€ ğŸ—ï¸ id_rsa_github # GitHub ç§é’¥ï¼ˆæƒé™ 600ï¼‰ â”œâ”€â”€ ğŸ”“ id_rsa_github.pub # GitHub å…¬é’¥ï¼ˆæƒé™ 644ï¼‰ â”œâ”€â”€ âš™ï¸ config # SSH ä¸»é…ç½®æ–‡ä»¶ï¼ˆæƒé™ 600ï¼‰ â””â”€â”€ ğŸŒ known_hosts # å¯ä¿¡ä¸»æœºåˆ—è¡¨ï¼ˆæƒé™ 644ï¼‰ ğŸ”§ SSH é…ç½®è¯¦è§£ ä¼˜åŒ–åçš„ config æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Gitee é…ç½®æ®µ Host gitee.com User git Hostname gitee.com IdentityFile ~/.ssh/id_rsa_gitee # æŒ‡å®šä¸“ç”¨å¯†é’¥ IdentitiesOnly yes # åªä½¿ç”¨æŒ‡å®šå¯†é’¥ PreferredAuthentications publickey # ä¼˜å…ˆå…¬é’¥è®¤è¯ # GitHub é…ç½®æ®µï¼ˆåŒ…å«ç«¯å£å¤‡ç”¨ï¼‰ Host github.com User git Hostname ssh.github.com # GitHub SSH ä¸“ç”¨ç«¯ç‚¹ Port 443 # HTTPS å¤‡ç”¨ç«¯å£ IdentityFile ~/.ssh/id_rsa_github IdentitiesOnly yes PreferredAuthentications publickey å››ã€æ•…éšœæ’é™¤ ğŸ› ï¸ ğŸ” å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨ é—®é¢˜ç°è±¡ å¯èƒ½åŸå›  è§£å†³æ–¹æ¡ˆ âŒ è„šæœ¬æ‰§è¡Œæƒé™é”™è¯¯ æ–‡ä»¶æœªè®¾ç½®æ‰§è¡Œæƒé™ chmod +x script-name.sh âŒ Git å®‰è£…å¤±è´¥ ç½‘ç»œé—®é¢˜æˆ–é•œåƒæºé”™è¯¯ æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæ›´æ¢é•œåƒæº âŒ å¯†é’¥ç”Ÿæˆå¤±è´¥ .ssh ç›®å½•æƒé™é—®é¢˜ chmod 700 ~/.ssh âŒ SSH è¿æ¥è¶…æ—¶ é˜²ç«å¢™æˆ–ç½‘ç»œé™åˆ¶ æ£€æŸ¥ 22/443 ç«¯å£æ˜¯å¦å¼€æ”¾ âŒ è®¤è¯è¢«æ‹’ç» å…¬é’¥æœªæ­£ç¡®æ·»åŠ  é‡æ–°å¤åˆ¶å®Œæ•´å…¬é’¥åˆ°å¹³å° ğŸ› è¯¦ç»†æ’é”™æŒ‡å— 1. æƒé™é—®é¢˜ä¿®å¤ ğŸ” 1 2 3 4 5 # å®Œæ•´çš„æƒé™ä¿®å¤å‘½ä»¤åºåˆ— chmod 700 ~/.ssh # SSH ç›®å½•æƒé™ chmod 600 ~/.ssh/config # é…ç½®æ–‡ä»¶æƒé™ chmod 600 ~/.ssh/id_rsa_* # æ‰€æœ‰ç§é’¥æ–‡ä»¶æƒé™ chmod 644 ~/.ssh/*.pub ~/.ssh/known_hosts # å…¬é’¥å’Œå·²çŸ¥ä¸»æœºæ–‡ä»¶æƒé™ 2. è¿æ¥æµ‹è¯•ä¸è¯Šæ–­ ğŸŒ 1 2 3 4 5 6 7 # è¯¦ç»†è¿æ¥æµ‹è¯•ï¼ˆæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼‰ ssh -T -v git@gitee.com # æµ‹è¯• Gitee è¿æ¥å¹¶æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— ssh -T -v git@github.com # æµ‹è¯• GitHub è¿æ¥å¹¶æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— # é…ç½®éªŒè¯å‘½ä»¤ ssh -G gitee.com # æ˜¾ç¤ºæœ€ç»ˆä½¿ç”¨çš„ SSH é…ç½® ssh-keygen -l -f ~/.ssh/id_rsa_gitee # éªŒè¯å¯†é’¥æŒ‡çº¹ 3. è„šæœ¬è°ƒè¯•æŠ€å·§ ğŸ”§ 1 2 3 4 5 6 7 8 # è¯­æ³•æ£€æŸ¥ bash -n gitee-ssh-init.sh # è¯¦ç»†æ‰§è¡Œè·Ÿè¸ª bash -x gitee-ssh-init.sh # è¾“å‡ºé‡å®šå‘ï¼ˆç”¨äºæ—¥å¿—åˆ†æï¼‰ ./gitee-ssh-init.sh \u0026gt; setup.log 2\u0026gt;\u0026amp;1 ğŸ’¡ é«˜çº§æŠ€å·§ å¤šå¹³å°å¯†é’¥ç®¡ç† 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰å¯†é’¥çš„æŒ‡çº¹ä¿¡æ¯ for key in ~/.ssh/id_rsa_*; do if [[ -f \u0026#34;$key\u0026#34; \u0026amp;\u0026amp; ! \u0026#34;$key\u0026#34; == *.pub ]]; then echo \u0026#34;å¯†é’¥: $(basename $key)\u0026#34; ssh-keygen -l -f \u0026#34;$key\u0026#34; echo \u0026#34;---\u0026#34; fi done é…ç½®å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 # å¤‡ä»½ SSH é…ç½® cp -r ~/.ssh ~/.ssh_backup_$(date +%Y%m%d) # æ¢å¤ SSH é…ç½®ï¼ˆè°¨æ…æ“ä½œï¼‰ # cp -r ~/.ssh_backup_20241201/* ~/.ssh/ ğŸ¯ æœ€ä½³å®è·µå»ºè®® âœ… å®‰å…¨å»ºè®® å®šæœŸæ›´æ¢å¯†é’¥ï¼šå»ºè®®æ¯ 6-12 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ SSH å¯†é’¥ ä½¿ç”¨å¼ºå¯†ç ï¼šè™½ç„¶è„šæœ¬ç”Ÿæˆæ— å¯†ç å¯†é’¥ï¼Œä½†ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®å¯†é’¥å¯†ç  å¤šå› ç´ è®¤è¯ï¼šåœ¨å¹³å°ç«¯å¯ç”¨ 2FA å¢å¼ºå®‰å…¨æ€§ âœ… ç»´æŠ¤å»ºè®® ç‰ˆæœ¬æ§åˆ¶ï¼šå°†è‡ªå®šä¹‰é…ç½®çš„è„šæœ¬ç‰ˆæœ¬è¿›è¡Œ git ç®¡ç† æ–‡æ¡£æ›´æ–°ï¼šéšç€å¹³å°æ”¿ç­–å˜åŒ–åŠæ—¶æ›´æ–°è„šæœ¬å’Œæ–‡æ¡£ æµ‹è¯•éªŒè¯ï¼šåœ¨é‡è¦å˜æ›´å‰åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è„šæœ¬åŠŸèƒ½ ğŸ“… æœ€åæ›´æ–°: 2024å¹´1æœˆ\nğŸ‘¨â€ğŸ’» ä½œè€…: meimolihan\nğŸ“§ è”ç³»æ–¹å¼: meimolihan@gmail.com ğŸ› é—®é¢˜åé¦ˆ: æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ”¹è¿›è„šæœ¬åŠŸèƒ½\n","date":"2025-09-25T14:33:49+08:00","image":"https://file.meimolihan.eu.org/img/git-ssh-01.webp","permalink":"https://blog.meimolihan.eu.org/p/7587f6d7/","title":"Git SSH å¯†é’¥è‡ªåŠ¨é…ç½®è„šæœ¬ä½¿ç”¨æŒ‡å— ğŸš€"},{"content":"Docker éƒ¨ç½² Windows 11 ğŸ–¥ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ’¾ ä¸€ã€é•œåƒä¸‹è½½ ğŸ³ äºŒã€Docker éƒ¨ç½² Windows 11 ğŸ“ 1. åˆ›å»ºé…ç½®ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸš€ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸ® ä¸‰ã€ä½¿ç”¨æŒ‡å— ğŸŒ å››ã€Nginx åå‘ä»£ç†é…ç½® ğŸ”§ 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”„ 2. æµ‹è¯•å¹¶é‡è½½ Nginx âš™ï¸ äº”ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ ğŸ³ 1. Docker Compose å‘½ä»¤ ğŸ“¦ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“€ 3. Docker é•œåƒç®¡ç† â“ å…­ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ âœ¨ ä¸ƒã€æŠ€æœ¯äº®ç‚¹ä¸æ€»ç»“ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/dockur/windows ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/dockurr/windows Docker éƒ¨ç½² Windows 11 æ˜¯ä¸€é¡¹åˆ›æ–°çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œé€šè¿‡åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œå®Œæ•´çš„ Windows 11 æ“ä½œç³»ç»Ÿï¼Œå®ç°äº†ä¼ ç»Ÿè™šæ‹ŸåŒ–ä¸å®¹å™¨åŒ–æŠ€æœ¯çš„å®Œç¾ç»“åˆã€‚âœ¨ è¿™ä¸€æ–¹æ¡ˆæ‰“ç ´äº†å®¹å™¨åªèƒ½è¿è¡Œè½»é‡çº§åº”ç”¨çš„å±€é™ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ä¸Šä½“éªŒå®Œæ•´çš„ Windows æ¡Œé¢ç¯å¢ƒã€‚\nğŸ” æŠ€æœ¯èƒŒæ™¯ åŸºäº KVM è™šæ‹ŸåŒ–æŠ€æœ¯å’Œ Docker å®¹å™¨åŒ–å¹³å°çš„æ·±åº¦æ•´åˆï¼Œåˆ©ç”¨ dockurr/windows é•œåƒæä¾›å®Œæ•´çš„ Windows 11 è¿è¡Œç¯å¢ƒã€‚è¿™ç§æ–¹æ¡ˆæ—¢ä¿ç•™äº†å®¹å™¨çš„è½»é‡çº§ç‰¹æ€§ï¼Œåˆå…·å¤‡äº†è™šæ‹Ÿæœºçš„å®Œæ•´åŠŸèƒ½ã€‚\nğŸ¯ é€‚ç”¨åœºæ™¯ ğŸ¢ ä¼ä¸šå¼€å‘æµ‹è¯•ï¼šä¸ºå›¢é˜Ÿæä¾›ä¸€è‡´çš„ Windows å¼€å‘ç¯å¢ƒ ğŸ“ æ•™è‚²åŸ¹è®­ï¼šå¿«é€Ÿåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„å­¦ä¹ ç¯å¢ƒ ğŸ”¬ è½¯ä»¶å…¼å®¹æ€§æµ‹è¯•ï¼šæµ‹è¯•è½¯ä»¶åœ¨ä¸åŒ Windows ç¯å¢ƒä¸‹çš„è¡¨ç° ğŸ›¡ï¸ å®‰å…¨éš”ç¦»ï¼šè¿è¡Œä¸ç¡®å®šå®‰å…¨æ€§çš„ Windows åº”ç”¨ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸŒˆ å…¨é¢å…¼å®¹æ€§ å®Œæ•´ Windows ä½“éªŒï¼šæä¾›ä¸ç‰©ç†æœºå‡ ä¹æ— å¼‚çš„ Windows 11 æ¡Œé¢ç¯å¢ƒ ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒï¼šåŸºäº KVM å®ç°æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¡¨ç° å¤šæ¶æ„æ”¯æŒï¼šæ”¯æŒ x86_64 å’Œ ARM64 æ¶æ„å¹³å° é©±åŠ¨å…¼å®¹ï¼šå†…ç½® VirtIO é©±åŠ¨ï¼Œç¡®ä¿ç¡¬ä»¶è®¾å¤‡æ­£å¸¸å·¥ä½œ âš¡ é«˜æ€§èƒ½ä¼˜åŒ– èµ„æºå¼¹æ€§é…ç½®ï¼šå¯çµæ´»è°ƒæ•´ CPU æ ¸å¿ƒæ•°ã€å†…å­˜å¤§å°å’Œç£ç›˜ç©ºé—´ å¿«é€Ÿå¯åŠ¨ï¼šå®¹å™¨åŒ–éƒ¨ç½²å®ç°ç§’çº§å¯åŠ¨å’Œåœæ­¢ é«˜æ•ˆå­˜å‚¨ï¼šæ”¯æŒå·æ˜ å°„ï¼Œæ•°æ®æŒä¹…åŒ–å­˜å‚¨ åŠ¨æ€èµ„æºè°ƒæ•´ï¼šè¿è¡Œæ—¶å¯æ ¹æ®éœ€æ±‚åŠ¨æ€è°ƒæ•´èµ„æºé…ç½® ğŸ”’ å®‰å…¨å¯é  éš”ç¦»ç¯å¢ƒï¼šDocker å®¹å™¨æä¾›è¿›ç¨‹çº§éš”ç¦»ï¼Œä¿éšœä¸»æœºå®‰å…¨ ç½‘ç»œéš”ç¦»ï¼šå¯é…ç½®ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ å¿«ç…§å¤‡ä»½ï¼šåŸºäº Docker é•œåƒçš„å¿«é€Ÿå¤‡ä»½å’Œæ¢å¤ æƒé™æ§åˆ¶ï¼šç²¾ç»†çš„æƒé™ç®¡ç†ï¼Œé¿å…è¶Šæƒè®¿é—® ğŸ¯ ä¾¿æ·ç®¡ç† ä¸€é”®éƒ¨ç½²ï¼šDocker Compose å®ç°å¿«é€Ÿéƒ¨ç½² è¿œç¨‹è®¿é—®ï¼šæ”¯æŒ RDPï¼ˆ3389ç«¯å£ï¼‰è¿œç¨‹æ¡Œé¢è¿æ¥ Web ç•Œé¢ï¼šå†…ç½® Web æ§åˆ¶å°ï¼Œæ–¹ä¾¿ç®¡ç†æ“ä½œ è‡ªåŠ¨åŒ–è¿ç»´ï¼šæ”¯æŒè‡ªåŠ¨åŒ–è„šæœ¬å’Œ CI/CD é›†æˆ ğŸ’¾ ä¸€ã€é•œåƒä¸‹è½½ ğŸ“¥ ä¸‹è½½ virtio é©±åŠ¨ 1 wget -c https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.285-1/virtio-win-0.1.285.iso ğŸ“¥ ä¸‹è½½ Windows é•œåƒ 1 2 # ä¸å¿˜åˆå¿ƒç¾åŒ–ç‰ˆ wget -c https://nginx.mobufan.eu.org:666/file/iso/Windows11_24H2_26100.3624_X64.iso ğŸ” ä¸‹è½½è¯´æ˜ VirtIO é©±åŠ¨ï¼šç”¨äºä¼˜åŒ–è™šæ‹ŸåŒ–æ€§èƒ½ï¼Œæä¾›æ›´å¥½çš„ç¡¬ä»¶å…¼å®¹æ€§ Windows é•œåƒï¼šå»ºè®®é€‰æ‹©å®˜æ–¹åŸç‰ˆé•œåƒä»¥ç¡®ä¿ç¨³å®šæ€§ ä¸‹è½½éªŒè¯ï¼šä¸‹è½½å®ŒæˆåéªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼Œé¿å…å®‰è£…å¤±è´¥ ğŸ³ äºŒã€Docker éƒ¨ç½² Windows 11 ğŸ“ 1. åˆ›å»ºé…ç½®ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -p /vol1/1000/compose/windows \u0026amp;\u0026amp; cd $_ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: windows: image: dockurr/windows:latest container_name: windows environment: VERSION: \u0026#34;11\u0026#34; # Windows 11 ç‰ˆæœ¬ MANUAL: \u0026#34;Y\u0026#34; # æ‰‹åŠ¨æ‰§è¡Œå®‰è£…æ¨¡å¼ DISK_SIZE: \u0026#34;16G\u0026#34; # è™šæ‹Ÿç¡¬ç›˜å¤§å°ï¼ˆå»ºè®®è‡³å°‘16Gï¼‰ RAM_SIZE: \u0026#34;4G\u0026#34; # å†…å­˜åˆ†é…ï¼ˆæ ¹æ®ä¸»æœºé…ç½®è°ƒæ•´ï¼‰ CPU_CORES: \u0026#34;2\u0026#34; # CPUæ ¸å¿ƒæ•°ï¼ˆå»ºè®®2æ ¸ä»¥ä¸Šï¼‰ devices: - /dev/kvm # KVM è™šæ‹ŸåŒ–è®¾å¤‡ - /dev/net/tun # ç½‘ç»œéš§é“è®¾å¤‡ cap_add: - NET_ADMIN # ç½‘ç»œç®¡ç†æƒé™ ports: - 8006:8006 # Web æ§åˆ¶å°ç«¯å£ - 3389:3389/tcp # RDP è¿œç¨‹æ¡Œé¢ TCP - 3389:3389/udp # RDP è¿œç¨‹æ¡Œé¢ UDP volumes: - ./windows:/storage # æ•°æ®æŒä¹…åŒ–ç›®å½• - /vol1/1000/FnOS/Windows11_24H2_26100.3624_X64.iso:/boot.iso # Windows å®‰è£…é•œåƒï¼ˆå®‰è£…åå–æ¶ˆæŒ‚è½½ï¼‰ - ./virtio-win-0.1.271.iso:/drivers.iso - # VirtIO é©±åŠ¨é•œåƒï¼ˆå®‰è£…åå–æ¶ˆæŒ‚è½½ï¼‰ restart: always # è‡ªåŠ¨é‡å¯ç­–ç•¥ stop_grace_period: 2m # åœæ­¢è¶…æ—¶æ—¶é—´ EOF ğŸ“ é…ç½®æ–‡ä»¶è¯¦è§£ é…ç½®é¡¹ è¯´æ˜ å»ºè®®å€¼ VERSION Windows ç‰ˆæœ¬ \u0026ldquo;11\u0026rdquo; DISK_SIZE è™šæ‹Ÿç¡¬ç›˜å¤§å° \u0026ldquo;16G\u0026rdquo;ï¼ˆæœ€å°å»ºè®®ï¼‰ RAM_SIZE å†…å­˜åˆ†é… \u0026ldquo;4G\u0026rdquo;ï¼ˆæ ¹æ®ä¸»æœºé…ç½®è°ƒæ•´ï¼‰ CPU_CORES CPUæ ¸å¿ƒæ•° \u0026ldquo;2\u0026rdquo;ï¼ˆå»ºè®®2æ ¸ä»¥ä¸Šï¼‰ âš ï¸ æ³¨æ„äº‹é¡¹ é•œåƒè·¯å¾„ï¼šç¡®ä¿ Windows 11 ISO é•œåƒæ–‡ä»¶è·¯å¾„æ­£ç¡® èµ„æºåˆ†é…ï¼šæ ¹æ®å®é™…ç¡¬ä»¶èµ„æºè°ƒæ•´å†…å­˜å’ŒCPUé…ç½® é©±åŠ¨æ”¯æŒï¼šVirtIO é©±åŠ¨æä¾›æ›´å¥½çš„è™šæ‹ŸåŒ–æ€§èƒ½ ğŸš€ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ 1 2 3 4 5 6 7 8 # æ‹‰å–é•œåƒå¹¶å¯åŠ¨æœåŠ¡ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— docker-compose logs -f âœ… å¯åŠ¨éªŒè¯ 1 2 3 4 5 6 7 8 # æ£€æŸ¥å®¹å™¨çŠ¶æ€ docker ps | grep windows # éªŒè¯ç«¯å£ç›‘å¬ netstat -tulpn | grep -E \u0026#39;(8006|3389)\u0026#39; # æµ‹è¯• Web è®¿é—® curl -I http://localhost:8006 ğŸ‰ å¯åŠ¨æˆåŠŸæç¤ºï¼šæœåŠ¡å¯åŠ¨åï¼Œå¯é€šè¿‡ http://æœåŠ¡å™¨IP:8006 è®¿é—® Web æ§åˆ¶å°ã€‚\nğŸ® ä¸‰ã€ä½¿ç”¨æŒ‡å— 1. ğŸ–¥ï¸ é¦–æ¬¡å®‰è£…é…ç½® è®¿é—® Web æ§åˆ¶å°ï¼šæµè§ˆå™¨æ‰“å¼€ http://ä½ çš„æœåŠ¡å™¨IP:8006 å¯åŠ¨å®‰è£…ç¨‹åºï¼šæŒ‰ç…§å±å¹•æç¤ºè¿›è¡Œ Windows 11 å®‰è£… åŠ è½½ VirtIO é©±åŠ¨ï¼šåœ¨å®‰è£…è¿‡ç¨‹ä¸­åŠ è½½ VirtIO é©±åŠ¨ä»¥ç¡®ä¿ç¡¬ä»¶å…¼å®¹æ€§ åŠ è½½é©±åŠ¨ç¨‹åº\u0026ndash;\u0026gt; virtio-win-0.1.271 \u0026ndash;\u0026gt; amd64 \u0026ndash;\u0026gt; w11 \u0026ndash;\u0026gt; ä¸‹ä¸€æ­¥ å®Œæˆç³»ç»Ÿé…ç½®ï¼šè®¾ç½®ç”¨æˆ·åã€å¯†ç ç­‰åŸºæœ¬ä¿¡æ¯ 2. ğŸ”— è¿œç¨‹æ¡Œé¢è¿æ¥ 1 2 3 4 # ä½¿ç”¨ Windows è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢è¿æ¥ # æœåŠ¡å™¨ï¼šä½ çš„æœåŠ¡å™¨IP:3389 # ç”¨æˆ·åï¼šå®‰è£…æ—¶è®¾ç½®çš„ç”¨æˆ·å # å¯†ç ï¼šå®‰è£…æ—¶è®¾ç½®çš„å¯†ç  3. ğŸ’¾ æ–‡ä»¶å…±äº«é…ç½® 1 2 3 # åœ¨ Docker Compose æ–‡ä»¶ä¸­æ·»åŠ å…±äº«æ–‡ä»¶å¤¹ volumes: - /host/path/to/share:/storage/shared 4. ğŸŒ ç½‘ç»œé…ç½®ä¼˜åŒ– 1 2 3 4 # å¦‚éœ€æ›´å¥½çš„ç½‘ç»œæ€§èƒ½ï¼Œå¯æ·»åŠ ä»¥ä¸‹é…ç½® sysctls: - net.ipv4.ip_forward=1 network_mode: \u0026#34;bridge\u0026#34; 5. âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®® å†…å­˜ä¼˜åŒ–ï¼šæ ¹æ®åº”ç”¨éœ€æ±‚åˆç†åˆ†é…å†…å­˜ CPU åˆ†é…ï¼šé¿å…è¿‡åº¦åˆ†é… CPU èµ„æº å­˜å‚¨ä¼˜åŒ–ï¼šä½¿ç”¨ SSD å­˜å‚¨æå‡ IO æ€§èƒ½ ç½‘ç»œä¼˜åŒ–ï¼šé…ç½®åˆé€‚çš„ç½‘ç»œæ¨¡å¼ ğŸŒ å››ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://win.example.com:666 ğŸ”§ 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/windows.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name win.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨è®¾ç½® add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8006; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒï¼ˆç”¨äºæ§åˆ¶å°äº¤äº’ï¼‰ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 60s; proxy_send_timeout 60s; proxy_read_timeout 60s; } # é”™è¯¯é¡µé¢é…ç½® error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF ğŸ”„ 2. æµ‹è¯•å¹¶é‡è½½ Nginx 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡è½½ Nginx é…ç½® sudo systemctl reload nginx # æŸ¥çœ‹ Nginx çŠ¶æ€ sudo systemctl status nginx ğŸ”’ SSL è¯ä¹¦é…ç½® 1 2 3 4 5 # åˆ›å»ºè¯ä¹¦ç›®å½• sudo mkdir -p /etc/nginx/keyfile # æ”¾ç½®è¯ä¹¦æ–‡ä»¶ï¼ˆéœ€è¦æå‰å‡†å¤‡å¥½ï¼‰ # cert.pem å’Œ key.pem éœ€è¦æ”¾åœ¨ä¸Šè¿°ç›®å½• âš™ï¸ äº”ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ ğŸ³ 1. Docker Compose å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/windows # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒï¼ˆç‰ˆæœ¬æ›´æ–°æ—¶ä½¿ç”¨ï¼‰ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # å®æ—¶è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f ğŸ“¦ 2. Docker å®¹å™¨å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop windows docker start windows docker restart windows # åˆ é™¤å®¹å™¨ docker rm windows # è¿›å…¥å®¹å™¨ Shellï¼ˆè°ƒè¯•ç”¨ï¼‰ docker exec -it windows sh # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs windows docker logs -f windows # å®æ—¶æ—¥å¿— docker logs --tail 100 windows # æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿— # ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ docker stats windows # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect windows # å®¹å™¨èµ„æºé™åˆ¶æ£€æŸ¥ docker stats --no-stream windows ğŸ“€ 3. Docker é•œåƒç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æœ¬åœ°é•œåƒ docker images # åˆ é™¤ç‰¹å®šé•œåƒ docker rmi dockurr/windows:latest # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ docker image prune -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒå’Œæ„å»ºç¼“å­˜ docker image prune -a -f # æŸ¥çœ‹é•œåƒå±‚æ¬¡ç»“æ„ docker history dockurr/windows:latest ğŸ”„ æ—¥å¸¸ç»´æŠ¤è„šæœ¬ 1 2 3 4 #!/bin/bash # å¤‡ä»½è„šæœ¬ç¤ºä¾‹ docker commit windows windows-backup-$(date +%Y%m%d) docker save -o windows-backup-$(date +%Y%m%d).tar windows-backup-$(date +%Y%m%d) â“ å…­ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ 1. â— KVM è™šæ‹ŸåŒ–æ”¯æŒé—®é¢˜ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ KVM æ˜¯å¦å¯ç”¨ egrep -c \u0026#39;(vmx|svm)\u0026#39; /proc/cpuinfo # åŠ è½½ KVM æ¨¡å— sudo modprobe kvm sudo modprobe kvm_intel # Intel CPU sudo modprobe kvm_amd # AMD CPU # éªŒè¯ KVM å¯ç”¨æ€§ lsmod | grep kvm 2. ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®® 1 2 3 4 5 6 7 8 9 # åœ¨ Docker Compose ä¸­æ·»åŠ èµ„æºé™åˆ¶ deploy: resources: limits: cpus: \u0026#39;4.0\u0026#39; memory: 8G reservations: cpus: \u0026#39;2.0\u0026#39; memory: 4G 3. ğŸŒ ç½‘ç»œè¿æ¥é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ç«¯å£å ç”¨ netstat -tulpn | grep :8006 netstat -tulpn | grep :3389 # é˜²ç«å¢™é…ç½® sudo ufw allow 8006 sudo ufw allow 3389 # æ£€æŸ¥å®¹å™¨ç½‘ç»œ docker exec windows ip addr 4. ğŸ’¾ ç£ç›˜ç©ºé—´ä¸è¶³ 1 2 3 4 5 # æ‰©å±•è™šæ‹Ÿç£ç›˜ï¼ˆéœ€åœ¨å®¹å™¨åœæ­¢æ—¶æ“ä½œï¼‰ qemu-img resize windows/disk.qcow2 +10G # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ docker system df 5. âš ï¸ å…¶ä»–å¸¸è§é—®é¢˜ å®‰è£…å¤±è´¥ï¼šæ£€æŸ¥ ISO é•œåƒå®Œæ•´æ€§å’Œ VirtIO é©±åŠ¨æ˜¯å¦æ­£ç¡®åŠ è½½ æ€§èƒ½ä½ä¸‹ï¼šè°ƒæ•´èµ„æºé…ç½®ï¼Œç¡®ä¿è¶³å¤Ÿçš„ CPU å’Œå†…å­˜ ç½‘ç»œå»¶è¿Ÿï¼šä¼˜åŒ–ç½‘ç»œé…ç½®ï¼Œè€ƒè™‘ä½¿ç”¨ host ç½‘ç»œæ¨¡å¼ âœ¨ ä¸ƒã€æŠ€æœ¯äº®ç‚¹ä¸æ€»ç»“ ğŸ‰ é¡¹ç›®ä¼˜åŠ¿ ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼šä¼ ç»Ÿè™šæ‹Ÿæœºéƒ¨ç½²éœ€è¦æ•°å°æ—¶ï¼Œè€Œ Docker åŒ–éƒ¨ç½²ä»…éœ€å‡ åˆ†é’Ÿ ğŸ“¦ ç¯å¢ƒä¸€è‡´æ€§ï¼šç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´ ğŸ”§ çµæ´»é…ç½®ï¼šå¯æ ¹æ®éœ€æ±‚å¿«é€Ÿè°ƒæ•´ç¡¬ä»¶èµ„æºé…ç½® ğŸ’¾ æ•°æ®æŒä¹…åŒ–ï¼šé‡è¦æ•°æ®é€šè¿‡å·æ˜ å°„å®ç°æŒä¹…åŒ–å­˜å‚¨ ğŸŒ è·¨å¹³å°æ”¯æŒï¼šå¯åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ä¸Šè¿è¡Œ ğŸ”® åº”ç”¨åœºæ™¯ å¼€å‘æµ‹è¯•ï¼šä¸ºè½¯ä»¶å¼€å‘æä¾›ä¸€è‡´çš„ Windows æµ‹è¯•ç¯å¢ƒ æ•™è‚²åŸ¹è®­ï¼šå¿«é€Ÿåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„ Windows å­¦ä¹ ç¯å¢ƒ ä¸´æ—¶éœ€æ±‚ï¼šä¸´æ—¶éœ€è¦ä½¿ç”¨ Windows ç‰¹å®šè½¯ä»¶çš„åœºåˆ éš”ç¦»ç¯å¢ƒï¼šéœ€è¦è¿è¡Œä¸ç¡®å®šå®‰å…¨æ€§çš„ Windows åº”ç”¨ ğŸ“ˆ æœªæ¥å±•æœ› éšç€å®¹å™¨æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒWindows å®¹å™¨åŒ–éƒ¨ç½²å°†æ›´åŠ æˆç†Ÿï¼Œæ€§èƒ½è¿›ä¸€æ­¥æå‡ï¼Œä½¿ç”¨ä½“éªŒå°†è¶Šæ¥è¶Šæ¥è¿‘ç‰©ç†æœºã€‚è¿™ç§æŠ€æœ¯æ–¹æ¡ˆä¸ºæ··åˆäº‘ç¯å¢ƒä¸‹çš„åº”ç”¨éƒ¨ç½²æä¾›äº†æ–°çš„æ€è·¯å’Œå¯èƒ½æ€§ã€‚\nğŸ’¡ ä½¿ç”¨å»ºè®® èµ„æºè§„åˆ’ï¼šæ ¹æ®å®é™…éœ€æ±‚åˆç†åˆ†é…èµ„æºï¼Œé¿å…è¿‡åº¦é…ç½® å®šæœŸå¤‡ä»½ï¼šé‡è¦æ•°æ®å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤± å®‰å…¨æ›´æ–°ï¼šåŠæ—¶æ›´æ–°ç³»ç»Ÿå’Œå®‰å…¨è¡¥ä¸ ç›‘æ§è¿ç»´ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ âœ¨ æ¸©é¦¨æç¤ºï¼šæœ¬æ–‡æ¡£ä¼šéšç€æŠ€æœ¯å‘å±•æŒç»­æ›´æ–°ï¼Œå»ºè®®æ”¶è—å¹¶å®šæœŸæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï¼\nä¼˜åŒ–æ€»ç»“ æˆ‘å·²æŒ‰ç…§æ‚¨çš„è¦æ±‚å®Œæˆäº†æ–‡ç« çš„å…¨é¢ä¼˜åŒ–ï¼š\nâœ… å®Œæˆçš„å†…å®¹ å†…å®¹ç”ŸåŠ¨åŒ–ï¼šå¢åŠ äº†ä¸°å¯Œçš„emojiå’Œç”ŸåŠ¨çš„æè¿° ç»“æ„ä¼˜åŒ–ï¼šåˆ›å»ºäº†å®Œæ•´çš„å¯¼èˆªç›®å½•å’Œé”šç‚¹ç³»ç»Ÿ å†…å®¹å®Œå–„ï¼šè¡¥å……äº†è¯¦ç»†çš„åŠŸèƒ½ä»‹ç»å’ŒæŠ€æœ¯è¯´æ˜ é”™è¯¯ä¿®æ­£ï¼šæ£€æŸ¥å¹¶ä¿®æ­£äº†åŸæ–‡ä¸­çš„é—®é¢˜ æ ¼å¼è§„èŒƒï¼šä¸¥æ ¼æŒ‰ç…§Markdownå’Œåšå®¢é”šç‚¹æ ¼å¼è¦æ±‚ ğŸ¯ ä¸»è¦æ”¹è¿› é‡æ–°ç»„ç»‡äº†ç« èŠ‚ç»“æ„ï¼Œé€»è¾‘æ›´æ¸…æ™° å¢åŠ äº†è¯¦ç»†çš„æŠ€æœ¯è¯´æ˜å’Œä½¿ç”¨æŒ‡å— è¡¥å……äº†ç»´æŠ¤å‘½ä»¤å’Œæ•…éšœæ’é™¤æ–¹æ¡ˆ ä¼˜åŒ–äº†é˜…è¯»ä½“éªŒï¼Œå¢åŠ äº†è¡¨æ ¼å’Œä»£ç å— ç¡®ä¿äº†æ‰€æœ‰é”šç‚¹é“¾æ¥æ­£å¸¸å·¥ä½œ æ–‡ç« ç°åœ¨æ›´åŠ ä¸“ä¸šã€æ˜“è¯»ï¼Œä¸”ç¬¦åˆæŠ€æœ¯åšå®¢çš„å‘å¸ƒæ ‡å‡†ã€‚\n","date":"2025-09-24T16:20:40+08:00","image":"https://file.meimolihan.eu.org/img/windows-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0144d0fb/","title":"Docker éƒ¨ç½² Windows 11 ğŸ–¥ï¸"},{"content":"Linux å¼€æœºæ£€æŸ¥è„šæœ¬å®‰è£…å·¥å…· ğŸš€ è¿™æ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨ä¸‹è½½å’Œå®‰è£… Linux ç³»ç»Ÿæ£€æŸ¥è„šæœ¬çš„ Bash å·¥å…·ã€‚å®ƒä¼šä» Gitee ä»£ç ä»“åº“ä¸‹è½½ linux-check.sh è„šæœ¬ï¼Œå¹¶åˆ›å»ºä¾¿æ·çš„æ‰§è¡Œæ–¹å¼ã€‚\nğŸ“š å¯¼èˆªç›®å½• âœ¨ ä¸»è¦åŠŸèƒ½ ğŸ–¥ï¸ æ”¯æŒçš„ç³»ç»Ÿ ğŸ¯ ä½¿ç”¨æ–¹æ³• ğŸ’¡ å®‰è£…åçš„ä½¿ç”¨æ–¹å¼ ğŸ“‚ æ–‡ä»¶ä½ç½® ğŸ—‘ï¸ å¸è½½æ–¹æ³• ğŸ”’ å®‰å…¨æç¤º âœ¨ ä¸»è¦åŠŸèƒ½ ğŸ“¥ æ™ºèƒ½ä¸‹è½½ç®¡ç†: è‡ªåŠ¨ä» Gitee ä»“åº“ä¸‹è½½æœ€æ–°çš„ linux-check.sh è„šæœ¬ï¼Œæ”¯æŒç½‘ç»œé‡è¯•æœºåˆ¶ ğŸ“ ç³»ç»Ÿçº§å®‰è£…: å°†è„šæœ¬å®‰å…¨å®‰è£…åˆ° /etc/profile.d/ ç³»ç»Ÿç›®å½•ï¼Œç¡®ä¿å…¨å±€å¯ç”¨ ğŸ”— ä¾¿æ·å¿«æ·æ–¹å¼: åˆ›å»ºç»Ÿä¸€çš„å¿«æ·å‘½ä»¤ mï¼Œç®€åŒ–æ—¥å¸¸ä½¿ç”¨ä½“éªŒ âš™ï¸ è‡ªåŠ¨åŒ–é…ç½®: è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ï¼ˆ755ï¼‰ï¼Œç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ ğŸš€ ä¸€é”®æ‰§è¡Œ: å®‰è£…å®Œæˆåå¯é€‰æ‹©ç«‹å³è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼Œæ‰€è§å³æ‰€å¾— ğŸ”„ æ›´æ–°æ”¯æŒ: å†…ç½®ç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶ï¼Œä¾¿äºåç»­æ›´æ–°ç»´æŠ¤ ğŸ–¥ï¸ æ”¯æŒçš„ç³»ç»Ÿ ç›®å‰å·²åœ¨ä»¥ä¸‹ä¸»æµ Linux å‘è¡Œç‰ˆä¸Šå…¨é¢æµ‹è¯•é€šè¿‡ï¼š\nğŸ”§ æœåŠ¡å™¨ç¯å¢ƒ ğŸ§ Debian - ç¨³å®šå¯é çš„æœåŠ¡å™¨å‘è¡Œç‰ˆï¼Œå®Œç¾å…¼å®¹ 9.x åŠä»¥ä¸Šç‰ˆæœ¬ ğŸ›¡ï¸ PVE (Proxmox VE) - ä¸“ä¸šçš„è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œé’ˆå¯¹è™šæ‹ŸåŒ–ç‰¹æ€§ä¼˜åŒ– ğŸŒ± Ubuntu - æµè¡Œçš„æœåŠ¡å™¨å’Œæ¡Œé¢ç³»ç»Ÿï¼Œæ”¯æŒ LTS ç‰ˆæœ¬ ğŸ’» ç‰¹å®šç³»ç»Ÿ ğŸ¯ FNOS - ç‰¹å®šå®šåˆ¶ç³»ç»Ÿï¼Œé’ˆå¯¹å®šåˆ¶åŒ–ç¯å¢ƒé€‚é… ğŸ”’ CentOS - ä¼ä¸šçº§å‘è¡Œç‰ˆï¼ˆ7.x åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ ğŸ“¦ Alpine - è½»é‡çº§å®¹å™¨å‹å¥½ç³»ç»Ÿ ğŸª iStoreOS - æ™ºèƒ½è·¯ç”±æ“ä½œç³»ç»Ÿï¼ŒåŸºäº OpenWRT æ·±åº¦å®šåˆ¶ï¼Œå®Œç¾é€‚é…å®¶åº­å’Œå°å‹ä¼ä¸šç½‘ç»œç¯å¢ƒ ğŸ¯ ä½¿ç”¨æ–¹æ³• æœ€ç®€å•çš„å®‰è£…æ–¹å¼ï¼Œä¸€é”®å®Œæˆæ‰€æœ‰é…ç½®ï¼š\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/install/check.sh) æ‰§è¡Œæµç¨‹è¯´æ˜ï¼š\nğŸŒ è‡ªåŠ¨æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€ ğŸ“¥ ä» Gitee ä»“åº“ä¸‹è½½æœ€æ–°ç‰ˆæ£€æŸ¥è„šæœ¬ ğŸ”’ éªŒè¯è„šæœ¬å®Œæ•´æ€§ ğŸ“ å®‰è£…åˆ°ç³»ç»Ÿç›®å½• ğŸ”— åˆ›å»ºå¿«æ·æ–¹å¼ ğŸš€ å¯é€‰ç«‹å³æ‰§è¡Œæ£€æŸ¥ ğŸ’¡ å®‰è£…åçš„ä½¿ç”¨æ–¹å¼ å®‰è£…å®Œæˆåï¼Œç³»ç»Ÿå°†æä¾›å¤šç§ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼ï¼š\nğŸ“ å¿«æ·é”®è¿è¡Œ 1 m ğŸ•’ å®šæ—¶ä»»åŠ¡é›†æˆ 1 2 # æ·»åŠ åˆ° crontab å®šæœŸæ£€æŸ¥ 0 2 * * * /usr/local/bin/m --silent \u0026gt; /var/log/system-check.log ğŸ“‚ æ–‡ä»¶ä½ç½® ğŸ—‚ï¸ æ ¸å¿ƒæ–‡ä»¶ ğŸ“„ ä¸»è„šæœ¬æ–‡ä»¶: /etc/profile.d/linux-check.sh\nç³»ç»Ÿçº§å®‰è£…ï¼Œæ‰€æœ‰ç”¨æˆ·å¯è®¿é—® éšç³»ç»Ÿå¯åŠ¨è‡ªåŠ¨åŠ è½½ç¯å¢ƒ ğŸ”— å¿«æ·å‘½ä»¤: /usr/local/bin/m\nå…¨å±€å¿«æ·æ–¹å¼ï¼Œä»»æ„ç›®å½•ç›´æ¥æ‰§è¡Œ ç¬¦å·é“¾æ¥ï¼Œç¡®ä¿ä¸ä¸»è„šæœ¬åŒæ­¥æ›´æ–° ğŸ“Š æ—¥å¿—ä¸æ•°æ® ğŸ“‹ æ£€æŸ¥æŠ¥å‘Š: è¿è¡Œæ—¶ç”Ÿæˆä¸´æ—¶æŠ¥å‘Šæ–‡ä»¶ ğŸ”§ é…ç½®æ–‡ä»¶: æ”¯æŒè‡ªå®šä¹‰æ£€æŸ¥é¡¹é…ç½®ï¼ˆå¦‚æœ‰ï¼‰ ğŸ—‘ï¸ å¸è½½æ–¹æ³• ğŸ”„ å®Œæ•´å¸è½½ 1 2 3 4 5 # åˆ é™¤å®‰è£…çš„æ–‡ä»¶ sudo rm -f /etc/profile.d/linux-check.sh /usr/local/bin/m # éªŒè¯å¸è½½ç»“æœ which m \u0026amp;\u0026amp; echo \u0026#34;å¸è½½å¤±è´¥\u0026#34; || echo \u0026#34;å¸è½½æˆåŠŸ\u0026#34; ğŸ§¹ æ¸…ç†ç›¸å…³æ–‡ä»¶ 1 2 3 4 5 # æ¸…ç†å¯èƒ½ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ sudo rm -f /tmp/linux-check-*.log # æ£€æŸ¥å¹¶æ¸…ç†æ®‹ç•™é…ç½® ls -la /etc/profile.d/ | grep linux-check ğŸ”’ å®‰å…¨æç¤º ğŸ” å®‰å…¨å»ºè®® æºç å®¡æŸ¥: å»ºè®®åœ¨å®‰è£…å‰æ£€æŸ¥è„šæœ¬å†…å®¹\n1 2 # è¾“å…¥ q é€€å‡º curl -sL gitee.com/meimolihan/script/raw/master/sh/check.sh | less ç¯å¢ƒéš”ç¦»: åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯\næƒé™æœ€å°åŒ–: ä½¿ç”¨æœ€å°å¿…è¦æƒé™åŸåˆ™è¿è¡Œè„šæœ¬\nğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§ ğŸ”’ å®‰å…¨ä¸‹è½½: é€šè¿‡ HTTPS åŠ å¯†ä¸‹è½½ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡» ğŸ“œ æƒé™æ§åˆ¶: ä¸¥æ ¼çš„æ–‡ä»¶æƒé™è®¾ç½®ï¼ˆ755ï¼‰ ğŸ” é€æ˜æ“ä½œ: æ‰€æœ‰æ“ä½œå‡æœ‰æ˜ç¡®æç¤ºï¼Œæ— é™é»˜æ‰§è¡Œ ğŸš¨ é£é™©æç¤º è¯·å‹¿åœ¨é«˜åº¦æ•æ„Ÿçš„ç¯å¢ƒä¸­ç›´æ¥è¿è¡ŒæœªçŸ¥è„šæœ¬ å»ºè®®æ ¹æ®å®é™…éœ€æ±‚å®šåˆ¶æ£€æŸ¥å†…å®¹ å®šæœŸæ›´æ–°ä»¥è·å–å®‰å…¨è¡¥ä¸å’Œæ–°åŠŸèƒ½ ğŸ‰ äº«å—ä¾¿æ·çš„ Linux ç³»ç»Ÿæ£€æŸ¥ä½“éªŒï¼å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿åé¦ˆå’Œæ”¹è¿›å»ºè®®ï¼\n","date":"2025-09-22T21:28:55+08:00","image":"https://file.meimolihan.eu.org/img/linux-check-01.webp","permalink":"https://blog.meimolihan.eu.org/p/537ea33b/","title":"Linux å¼€æœºæ£€æŸ¥è„šæœ¬å®‰è£…å·¥å…· ğŸš€"},{"content":"Hexo + Fomalhaut ä¸»é¢˜ä¿®æ”¹ä¸ä¼˜åŒ–æŒ‡å— ğŸ“ æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å¯¹ Fomalhaut ä¸»é¢˜è¿›è¡Œä¸ªæ€§åŒ–ä¿®æ”¹ä¸ä¼˜åŒ–ï¼ŒåŒ…æ‹¬å£çº¸æ›´æ¢ã€æ ·å¼è°ƒæ•´ã€åŠŸèƒ½é…ç½®ç­‰ï¼ŒåŠ©ä½ æ‰“é€ ç‹¬ä¸€æ— äºŒçš„åšå®¢å¤–è§‚ï¼âœ¨\nå¯¼èˆªç›®å½• ğŸ“š ğŸ–¼ï¸ ä¸€ã€ä¿®æ”¹æ—¥å¤œæ¨¡å¼å£çº¸ ğŸ¨ äºŒã€è°ƒæ•´ä¸ªäººä¿¡æ¯å¡ç‰‡èƒŒæ™¯ ğŸ§² ä¸‰ã€å°å†°åˆ†ç±»ç£è´´æ ·å¼ ğŸŒŠ å››ã€éšè—æ³¢æµªæ¨¡å¼ ğŸ“¢ äº”ã€å…¬å‘Šæ è®¾ç½® ğŸ¨ å…­ã€ä¸»é¢˜å˜é‡å¯¹æ¥ ğŸ’¡ ä¸ƒã€å¸¸ç”¨ CSS æŠ€å·§ ğŸ”¤ å…«ã€å­—ä½“ä¿®æ”¹æŒ‡å— ğŸ®ä¹ã€ç¯ç¬¼å¼€å…³ ä¸€ã€ğŸ–¼ï¸ ä¿®æ”¹æ—¥å¤œæ¨¡å¼å£çº¸ Fomalhaut ä¸»é¢˜æ”¯æŒä¸ºæ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ†åˆ«è®¾ç½®ä¸åŒçš„å£çº¸ï¼Œè®©ä½ çš„åšå®¢åœ¨ä¸åŒæ—¶é—´å±•ç°ä¸åŒé£æ ¼ï¼\nä¿®æ”¹æ–¹æ³•ï¼š\næ‰¾åˆ°æ–‡ä»¶ï¼š[BlogRoot]/themes/butterfly/source/css/_custom/custom.css æœç´¢ä»¥ä¸‹CSSå˜é‡è¿›è¡Œä¿®æ”¹ï¼š 1 2 3 4 5 6 :root { --default-bg: url(https://file.meimolihan.eu.org/hexo/default-bg.png); /* ç”µè„‘æ—¥é—´å£çº¸ */ --darkmode-bg: url(https://file.meimolihan.eu.org/hexo/darkmode-bg.webp); /* ç”µè„‘å¤œé—´å£çº¸ */ --mobileday-bg: url(https://file.meimolihan.eu.org/hexo/mobileday-bg.png); /* æ‰‹æœºæ—¥é—´å£çº¸ */ --mobilenight-bg: url(https://file.meimolihan.eu.org/hexo/mobilenight-bg.webp); /* æ‰‹æœºå¤œé—´å£çº¸ */ } ğŸ’¡ æç¤ºï¼šå»ºè®®ä½¿ç”¨é«˜è´¨é‡å›¾ç‰‡ï¼ˆæ¨èåˆ†è¾¨ç‡ï¼š1920Ã—1080ï¼‰ï¼Œå¹¶ç¡®ä¿å›¾ç‰‡URLå¯æ­£å¸¸è®¿é—®ã€‚\näºŒã€ğŸ¨ è°ƒæ•´ä¸ªäººä¿¡æ¯å¡ç‰‡èƒŒæ™¯ ä¸ªæ€§åŒ–ä½ çš„åšä¸»ä¿¡æ¯å¡ç‰‡ï¼Œè®©å®ƒä¸æ•´ä½“ä¸»é¢˜é£æ ¼æ›´åŒ¹é…ï¼\nä¿®æ”¹æ–¹æ³•ï¼š\nåŒæ ·åœ¨ custom.css æ–‡ä»¶ä¸­æœç´¢ï¼š 1 2 3 .author-content { background-image: url(\u0026#39;ä½ çš„å¡ç‰‡èƒŒæ™¯å›¾URL\u0026#39;); } âœ¨ ç‰¹ç‚¹ï¼šæ”¯æŒæ¸å˜è‰²ã€é™æ€å›¾ç‰‡å’ŒåŠ¨æ€GIFï¼Œè®©ä½ çš„åç‰‡æ›´åŠ ç”ŸåŠ¨ï¼\nä¸‰ã€ğŸ§² å°å†°åˆ†ç±»ç£è´´æ ·å¼ å°å†°åˆ†ç±»ç£è´´æ˜¯Fomalhautçš„ç‰¹è‰²åŠŸèƒ½ä¹‹ä¸€ï¼Œå¯ä»¥è®©åˆ†ç±»ç›®å½•ä»¥ç£è´´å½¢å¼å±•ç¤ºï¼Œæ›´åŠ ç¾è§‚å®ç”¨ã€‚\nä¿®æ”¹æ–¹æ³•ï¼š\nåœ¨ custom.css ä¸­æœç´¢ .magnet_item è°ƒæ•´ä»¥ä¸‹æ ·å¼å±æ€§ï¼š 1 2 3 4 5 6 7 8 9 10 11 .magnet_item { background: var(--theme-color); /* èƒŒæ™¯è‰² */ border-radius: 12px; /* åœ†è§’å¤§å° */ box-shadow: 0 3px 8px var(--shadow-color); /* é˜´å½±æ•ˆæœ */ transition: all 0.3s ease; /* æ‚¬åœåŠ¨ç”» */ } .magnet_item:hover { transform: translateY(-5px); /* æ‚¬åœæ•ˆæœ */ box-shadow: 0 8px 16px var(--shadow-color-hover); } å››ã€ğŸŒŠ éšè—æ³¢æµªæ¨¡å¼ å¦‚æœä½ è§‰å¾—æ³¢æµªæ•ˆæœå½±å“é˜…è¯»ä½“éªŒï¼Œå¯ä»¥è½»æ¾éšè—å®ƒã€‚\nä¿®æ”¹æ–¹æ³•ï¼š\nåœ¨ custom.css ä¸­æœç´¢ .main-hero-waves-area æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 1 2 3 .main-hero-waves-area { display: none !important; } âš ï¸ æ³¨æ„ï¼šéšè—æ³¢æµªæ•ˆæœåï¼Œé¦–é¡µåº•éƒ¨ä¼šå˜å¾—ç®€æ´ï¼Œä½†ä¹Ÿä¼šå¤±å»åŠ¨æ€æ•ˆæœã€‚\näº”ã€ğŸ“¢ å…¬å‘Šæ è®¾ç½® å…¬å‘Šæ æ˜¯å‘è®¿å®¢å±•ç¤ºé‡è¦ä¿¡æ¯çš„ç†æƒ³ä½ç½®ï¼Œå¦‚æ›´æ–°æ—¥å¿—ã€æ´»åŠ¨é€šçŸ¥ç­‰ã€‚\né…ç½®æ–¹æ³•ï¼š\næ‰“å¼€ [BlogRoot]/_config.butterfly.yml æœç´¢ card_announcement ä¿®æ”¹é…ç½®ï¼š 1 2 3 card_announcement: enable: true content: \u0026#34;ğŸ‰ æ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢ï¼è¿™é‡Œè®°å½•æˆ‘çš„å­¦ä¹ ç¬”è®°å’Œç”Ÿæ´»æ„Ÿæ‚Ÿï½\u0026#34; ğŸ”§ åŠŸèƒ½ï¼šæ”¯æŒHTMLæ ¼å¼ï¼Œå¯ä»¥æ·»åŠ é“¾æ¥ã€è¡¨æƒ…ç­‰ä¸°å¯Œå†…å®¹ã€‚\nå…­ã€ğŸ¨ ä¸»é¢˜å˜é‡å¯¹æ¥ Fomalhaut ä¸»é¢˜ä½¿ç”¨CSSå˜é‡ç»Ÿä¸€ç®¡ç†æ ·å¼ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰ä¸»é¢˜è‰²å½©ã€‚\nå¸¸ç”¨å˜é‡å¯¹æ¥ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 /* èƒŒæ™¯è‰²æ¥å…¥ */ [data-theme=\u0026#34;light\u0026#34;] .test { background: var(--trans-light); /* æ—¥é—´æ¨¡å¼ æ¥å…¥èƒŒæ™¯è‰² */ } [data-theme=\u0026#34;dark\u0026#34;] .test{ background: var(--trans-dark); /* å¤œé—´æ¨¡å¼ æ¥å…¥èƒŒæ™¯è‰² */ } /* æ‚¬åœå…ƒç´ èƒŒæ™¯æ¥å…¥ */ .test:hover { background-color: var(--theme-color); /* èƒŒæ™¯æ¥å…¥ä¸»é¢˜è‰² */ } /* æ‚¬åœå­—ä½“é¢œè‰² */ .test:hover { color: var(--theme-color) !important; /* å­—ä½“æ¥å…¥ä¸»é¢˜è‰² */ } /* é¼ æ ‡æ‚¬åœè¾¹æ¡†é˜´å½±æ•ˆæœ */ .test:hover { box-shadow: 0 0 3px var(--theme-color) !important; /* é¼ æ ‡æ‚¬åœè¾¹æ¡†é˜´å½±æ•ˆæœ æ¥å…¥ä¸»é¢˜è‰² */ } /* è¾¹æ¡†è£…é¥°çº¿ï¼ˆFomalhautç™½è‰²è£…é¥°çº¿ï¼‰ */ .test:hover { border: var(--border-style); /* è¾¹æ¡†è£…é¥°çº¿ï¼ˆFomalhautç™½è‰²è£…é¥°çº¿ï¼‰ */ } ä¸ƒã€ğŸ’¡ å¸¸ç”¨ CSS æŠ€å·§ è¿™é‡Œæ”¶é›†äº†ä¸€äº›å®ç”¨çš„CSSä»£ç ç‰‡æ®µï¼Œæ–¹ä¾¿å¿«é€Ÿä¿®æ”¹æ ·å¼ï¼š\næ–‡å­—æ ·å¼è°ƒæ•´ï¼š\n1 2 3 4 5 .test { font-size: 18px; /* å­—ä½“å¤§å° */ font-weight: bold; /* å­—ä½“åŠ ç²— */ color: #000000; /* æ–‡å­—é¢œè‰² */ } å…ƒç´ ä½ç½®è°ƒæ•´ï¼š\n1 2 3 4 5 6 7 8 9 10 .test { height: 20px !important; /* è°ƒæ•´é«˜åº¦ */ width: 20px !important; /* è°ƒæ•´å®½åº¦ */ margin-bottom: 10px !important; /* å‘ä¸Šç§»åŠ¨10px */ margin-top: 10px !important; /* å‘ä¸‹ç§»åŠ¨10px */ margin-right: 10px !important; /* å‘å·¦ç§»åŠ¨10px */ margin-left: 10px !important; /* å‘å³ç§»åŠ¨10px */ vertical-align: middle; /* é»˜è®¤å±…ä¸­å¯¹é½ */ vertical-align: -0.3em; /* ä¸Šä¸‹ç§»åŠ¨ */ } å…«ã€ğŸ”¤ å­—ä½“ä¿®æ”¹æŒ‡å— Fomalhaut ä¸»é¢˜æ”¯æŒè‡ªå®šä¹‰å­—ä½“ï¼Œè®©ä½ çš„åšå®¢æ‹¥æœ‰ç‹¬ç‰¹çš„æ’ç‰ˆé£æ ¼ã€‚\nå­—ä½“èµ„æºæ¨è å­—ä½“å¤©ä¸‹ï¼š https://www.fonts.net.cn/ ï¼ˆä¸°å¯Œçš„ä¸­æ–‡å­—ä½“èµ„æºï¼‰ è°·æ­Œå­—ä½“ï¼š https://fonts.google.com/ ï¼ˆå…è´¹çš„è‹±æ–‡å­—ä½“åº“ï¼‰ æ ¼å¼è½¬æ¢å·¥å…·ï¼š TTF åˆ° WOFF2è½¬æ¢å™¨ ï¼ˆä¼˜åŒ–ç½‘ç»œå­—ä½“åŠ è½½ï¼‰ å­—ä½“æ›´æ¢æ­¥éª¤ 1. ä¸‹è½½å¹¶æ›¿æ¢å­—ä½“æ–‡ä»¶ ä»¥ã€Œæ¨ä»»ä¸œç«¹çŸ³ä½“ã€ä¸ºä¾‹ï¼š\nä¿®æ”¹ [BlogRoot]/themes/butterfly/source/css/_custom/custom.cssï¼š\n1 2 3 4 5 6 @font-face { font-family: ZhuZiAWan; - src: url(https://data-static.netdun.net/Fomalhaut/fonts/ZhuZiAWan2.woff2); + src: url(https://cdn.meimolihan.eu.org/hexo/fonts/Heavy.woff2); font-display: swap; } 2. å¼•å…¥å­—ä½“åˆ°æ ·å¼\n1 2 3 .test { font-family: var(--global-font); /* å¼•å…¥å­—ä½“ */ } 3. å­—ä½“æ¥å…¥ä¸»é¢˜è‰²\n1 2 3 .test { color: var(--theme-color) !important; /* å­—ä½“æ¥å…¥ä¸»é¢˜è‰² */ } 4. æ›´æ–°å­—ä½“åˆ‡æ¢æ§åˆ¶å° ä¿®æ”¹ [BlogRoot]/source/js/fomal.jsï¼š\n1 2 - \u0026lt;a class=\u0026#34;swf\u0026#34; id=\u0026#34;swf_ZhuZiAWan\u0026#34; href=\u0026#34;javascript:;\u0026#34; rel=\u0026#34;noopener external nofollow\u0026#34; style=\u0026#34;font-family:\u0026#39;ZhuZiAWan\u0026#39;!important;color:black\u0026#34; onclick=\u0026#34;setFont(\u0026#39;ZhuZiAWan\u0026#39;)\u0026#34;\u0026gt;ç­‘ç´«Aä¸¸æ ‡å‡†ä½“2.0\u0026lt;/a\u0026gt; + \u0026lt;a class=\u0026#34;swf\u0026#34; id=\u0026#34;swf_ZhuZiAWan\u0026#34; href=\u0026#34;javascript:;\u0026#34; rel=\u0026#34;noopener external nofollow\u0026#34; style=\u0026#34;font-family:\u0026#39;ZhuZiAWan\u0026#39;!important;color:black\u0026#34; onclick=\u0026#34;setFont(\u0026#39;ZhuZiAWan\u0026#39;)\u0026#34;\u0026gt;æ¨ä»»ä¸œç«¹çŸ³ä½“\u0026lt;/a\u0026gt; ğŸ“Œ æç¤ºï¼šä¿®æ”¹åè®°å¾—æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œæ‰èƒ½çœ‹åˆ°å­—ä½“å˜åŒ–æ•ˆæœï¼\nä¹ã€ğŸ®ç¯ç¬¼å¼€å…³ ç¯ç¬¼å¼€å…³ï¼š./_config.butterfly.yml 1 2 lantern: enable: true ä¿®æ”¹æ–‡å­—ï¼š./themes/butterfly/source/css/_custom/lantern.css å¸Œæœ›æœ¬ç¯‡æŒ‡å—èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°å®šåˆ¶Fomalhautä¸»é¢˜ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨ä¸»é¢˜Gitä»“åº“æäº¤Issueæˆ–è®¨è®ºï¼ğŸš€\n","date":"2025-09-22T14:12:41+08:00","image":"https://file.meimolihan.eu.org/img/hexo-fomalhaut-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5314d104/","title":"Hexo + Fomalhaut ä¸»é¢˜ä¿®æ”¹ä¸ä¼˜åŒ–æŒ‡å— ğŸ“"},{"content":"Hugo + Stack ä¸»é¢˜ç¾åŒ–æŒ‡å— ğŸ¨ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Hugo Stack ä¸»é¢˜çš„ç¾åŒ–é…ç½®æ–¹æ³•ï¼ŒåŒ…å«å…¨å±€æ ·å¼è°ƒæ•´ã€æ–‡ç« å†…å®¹ä¼˜åŒ–ã€ä¾§è¾¹æ ç¾åŒ–åŠå…¶ä»–åŠŸèƒ½å¢å¼ºï¼ŒåŠ©ä½ æ‰“é€ ä¸ªæ€§åŒ–åšå®¢ã€‚\nğŸ“‘ å¯¼èˆªç›®å½• ğŸŒ ä¸€ã€å…¨å±€é…ç½® ğŸ¨ 1. é¡µé¢åŸºæœ¬é…è‰² ğŸ“ 2. å…¨å±€å¸ƒå±€è°ƒæ•´ ğŸ“ äºŒã€æ–‡ç« å†…å®¹ç¾åŒ– âœ¨ 1. æ–‡ç« å†…å®¹åŸºæœ¬ç¾åŒ– ğŸ’¬ 2. MD å¼•ç”¨å—æ ·å¼ ğŸ–¼ï¸ 3. ä½¿å›¾åºŠé“¾æ¥çš„å›¾ç‰‡å±…ä¸­ ğŸ“Š 4. ç»Ÿè®¡ç«™ç‚¹æ–‡ç« æ•°é‡å’Œå­—æ•° ğŸ  5. é¦–é¡µæ–‡ç« æ ·å¼ ğŸ–¼ï¸ 6. æ–‡ç« å†…éƒ¨å›¾ç‰‡æ ·å¼ ğŸ’» 7. MacOS é£æ ¼ä»£ç å— ğŸ”§ 8. ä¿®æ”¹ä»£ç å—æ ·å¼ ğŸ¯ 9. ä»£ç å—é«˜äº® ğŸš« 10. å…³é—­ä»£ç å—è¯­è¨€æ˜¾ç¤º ğŸ”— 11. å¤–éƒ¨é“¾æ¥åé¢æ˜¾ç¤ºå›¾æ ‡ ğŸ“‹ 12. è¯­è¨€å’Œå¤åˆ¶æŒ‰é’® ğŸ“‘ 13. æ–‡ç« ç›®å½•æŠ˜å \u0026amp;å±•å¼€ ğŸ§‘â€ğŸ’» 14. ä»£ç å—è¿‡é•¿æŠ˜å \u0026amp;å±•å¼€ ğŸ“Œ ä¸‰ã€ä¾§è¾¹æ ç¾åŒ– ğŸ“ 1. é¡µé¢å·¦å³è¾¹æ å®½åº¦ ğŸ­ 2. å³ä¾§å¯¼èˆªæ åŠ¨ç”» ğŸ¨ 3. å·¦ä¾§å¯¼èˆªæ ç¾åŒ– âœ¨ 4. å·¦ä¾§å¯¼èˆªæ åŠ¨ç”» ğŸ¤ 5. ç¤¾äº¤ social ğŸŒ“ 6. æ˜äº®æ¨¡å¼è°ƒæ•´ä½ç½® âš™ï¸ 7. æ‰‹åŠ¨ä¿®æ”¹å·¦å³ä¾§è¾¹æ è®¾ç½®æ ·å¼ ğŸ”„ 8. å¤´åƒæ—‹è½¬ ğŸ“‚ 9. å‹æƒ…é“¾æ¥+åˆ†ç±»+æ ‡ç­¾+å½’æ¡£ã€ä¸‰æ æ˜¾ç¤ºã€‘ ğŸ“¦ 10. ç¼©å°å½’æ¡£é¡µçš„åˆ†ç±»å¡ç‰‡å°ºå¯¸ ğŸ“‹ 11. è°ƒæ•´ TOC ç›®å½•é—´è· ğŸ” 12. é¼ æ ‡æ‚¬åœè¶…é“¾æ¥çš„æ˜¾ç¤º ğŸ”§ å››ã€å…¶å®ƒå°éƒ¨ä»¶ ğŸ“ˆ 1. æ·»åŠ ç«™ç‚¹ç»Ÿè®¡ä¿¡æ¯ä¸ i18n ğŸ—ºï¸ 2. æ·»åŠ è®¿å®¢åœ°å›¾ ğŸ–±ï¸ 3. é¼ æ ‡æ ·å¼ ğŸ‰ 4. é¦–é¡µæ¬¢è¿æ¨ªå¹… ğŸ—‘ï¸ 5. åˆ é™¤\u0026quot;ä½¿ç”¨ Hugo æ„å»º ä¸»é¢˜Stackç”±Jimmyè®¾è®¡\u0026quot;ç­‰å­—æ · â¬†ï¸ 6. æ·»åŠ ã€è¿”å›é¡¶éƒ¨ã€‘æŒ‰é’® ğŸ’¬ äº”ã€Hugo æ¥å…¥è¯„è®º ğŸŒ€ å…­ã€Hugo é¢„åŠ è½½åŠ¨ç”» ğŸ–¼ï¸ ä¸ƒã€Hugo å›¾ç‰‡ç¯ç®± âœ¨ å…«ã€å¼•å…¥åŠ¨æ€èƒŒæ™¯ ğŸ“Š ä¹ã€æ–‡ç« æµè§ˆæ•°ç»Ÿè®¡ ğŸ’ƒ åã€åšå®¢å¼•å…¥çœ‹æ¿å¨˜ ğŸ”¤ åä¸€ã€ä¿®æ”¹åšå®¢å­—ä½“ ğŸŸ åäºŒã€ åšå®¢å¼•å…¥é£é±¼é¡µè„š ğŸ“‹ åä¸‰ã€ å¤åˆ¶å¼¹çª— ä¸€ã€ğŸŒ å…¨å±€é…ç½® 1. ğŸ¨ é¡µé¢åŸºæœ¬é…è‰² âœ¨ åŠŸèƒ½ï¼šè‡ªå®šä¹‰åšå®¢å…¨å±€é…è‰²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ˜äº®/æš—é»‘æ¨¡å¼ä¸‹çš„ä»£ç å—æ ·å¼ã€åœ†è§’å¤§å°ç­‰ ğŸ“Œ ä½ç½®ï¼šåœ¨ /assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // ---------------é¡µé¢åŸºæœ¬é…è‰²--------------- :root { // å…¨å±€é¡¶éƒ¨è¾¹è· --main-top-padding: 30px; // å…¨å±€å¡ç‰‡åœ†è§’ --card-border-radius: 25px; // æ ‡ç­¾äº‘å¡ç‰‡åœ†è§’ --tag-border-radius: 8px; // å¡ç‰‡é—´è· --section-separation: 40px; // å…¨å±€å­—ä½“å¤§å° --article-font-size: 1.8rem; // è¡Œå†…ä»£ç èƒŒæ™¯è‰² --code-background-color: #f8f8f8; // è¡Œå†…ä»£ç å‰æ™¯è‰² --code-text-color: #e96900; // æš—è‰²æ¨¡å¼ä¸‹æ ·å¼ \u0026amp;[data-scheme=\u0026#34;dark\u0026#34;] { // è¡Œå†…ä»£ç èƒŒæ™¯è‰² --code-background-color: #ff6d1b17; // è¡Œå†…ä»£ç å‰æ™¯è‰² --code-text-color: #e96900; } } 2. ğŸ“ å…¨å±€å¸ƒå±€è°ƒæ•´ âœ¨ åŠŸèƒ½ï¼šè°ƒæ•´æ•´ä½“é¡µé¢å¸ƒå±€ç»“æ„ï¼ŒåŒ…æ‹¬ä¸‰æ å®½åº¦æ¯”ä¾‹ã€ä¸‹æ‹‰èœå•æ ·å¼ç­‰ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 //--------------------------------------------------- // å…¨å±€é¡µé¢å¸ƒå±€é—´è·è°ƒæ•´ .main-container { min-height: 100vh; align-items: flex-start; padding: 0 15px; gap: var(--section-separation); padding-top: var(--main-top-padding); @include respond(md) { padding: 0 37px; } } //-------------------------------------------------- //é¡µé¢ä¸‰æ å®½åº¦è°ƒæ•´ .container { margin-left: auto; margin-right: auto; .left-sidebar { order: -3; max-width: var(--left-sidebar-max-width); } .right-sidebar { order: -1; max-width: var(--right-sidebar-max-width); /// Display right sidebar when min-width: lg @include respond(lg) { display: flex; } } \u0026amp;.extended { @include respond(md) { max-width: 1024px; --left-sidebar-max-width: 25%; --right-sidebar-max-width: 22% !important; } @include respond(lg) { max-width: 1280px; --left-sidebar-max-width: 20%; --right-sidebar-max-width: 30%; } @include respond(xl) { max-width: 1453px; //1536px; --left-sidebar-max-width: 15%; --right-sidebar-max-width: 25%; } } \u0026amp;.compact { @include respond(md) { --left-sidebar-max-width: 25%; max-width: 768px; } @include respond(lg) { max-width: 1024px; --left-sidebar-max-width: 20%; } @include respond(xl) { max-width: 1280px; } } } //------------------------------------------------------- //å…¨å±€é¡µé¢å°å›¾ç‰‡æ ·å¼å¾®è°ƒ .article-list--compact article .article-image img { width: var(--image-size); height: var(--image-size); object-fit: cover; border-radius: 17%; } // -------------------------------- // ä¸‹æ‹‰èœå•æ”¹åœ†è§’æ ·å¼ .menu { padding-left: 0; list-style: none; flex-direction: column; overflow-x: hidden; // overflow-y: scroll; flex-grow: 1; font-size: 1.6rem; background-color: var(--card-background); // box-shadow: var(--shadow-l2); // æ‰‹æœºç«¯ä¸‹æ‹‰èœå•ä¼šæœ‰è«åå°æ–¹å— box-shadow: none; display: none; margin: 0; //æ”¹ä¸º0 border-radius: 10px; //åŠ ä¸ªåœ†è§’ padding: 30px 30px; @include respond(xl) { padding: 15px 0; } \u0026amp;, .menu-bottom-section { gap: 30px; @include respond(xl) { gap: 25px; } } \u0026amp;.show { display: flex; } @include respond(md) { align-items: flex-end; display: flex; background-color: transparent; padding: 0; box-shadow: none; margin: 0; } li { position: relative; vertical-align: middle; padding: 0; @include respond(md) { width: 100%; } svg { stroke-width: 1.33; width: 20px; height: 20px; } a { height: 100%; display: inline-flex; align-items: center; color: var(--body-text-color); gap: var(--menu-icon-separation); } span { flex: 1; } \u0026amp;.current { a { color: var(--accent-color); font-weight: bold; } } } } /*æ‰‹æœºæ¨¡å¼ä¸‹çš„èœå•æ»šåŠ¨æ¡ç¾åŒ–*/ .menu::-webkit-scrollbar { display: none; //é˜²æ­¢å¤§å±å¹•æ—¶å‡ºç°æ»šåŠ¨æ¡ } .sidebar header .site-name { margin: 8px; font-size: 2rem; //å­—ä½“å¤§å° } äºŒã€ğŸ“ æ–‡ç« å†…å®¹ç¾åŒ– 1. âœ¨ æ–‡ç« å†…å®¹åŸºæœ¬ç¾åŒ– âœ¨ åŠŸèƒ½ï¼šä¼˜åŒ–æ–‡ç« å†…ä»£ç å—ã€å›¾ç‰‡ã€å¼•ç”¨ç­‰å…ƒç´ çš„æ˜¾ç¤ºæ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 //------------------------------------------------ // æ–‡ç« å†…å®¹å¼•ç”¨å—æ ·å¼ .article-content { blockquote { border-left: 6px solid #358b9a1f !important; background: #3a97431f; } } // --------------------------------------- // ä»£ç å—åŸºç¡€æ ·å¼ä¿®æ”¹ .highlight { max-width: 102% !important; background-color: var(--pre-background-color); padding: var(--card-padding); position: relative; border-radius: 20px; margin-left: -7px !important; margin-right: -12px; box-shadow: var(--shadow-l1) !important; \u0026amp;:hover { .copyCodeButton { opacity: 1; } } // keep Codeblocks LTR [dir=\u0026#34;rtl\u0026#34;] \u0026amp; { direction: ltr; } pre { margin: initial; padding: 0; margin: 0; width: auto; } } //---------------------------------------------- // lightæ¨¡å¼ä¸‹çš„ä»£ç å—æ ·å¼è°ƒæ•´ [data-scheme=\u0026#34;light\u0026#34;] .article-content .highlight { background-color: #fff9f3; } [data-scheme=\u0026#34;light\u0026#34;] .chroma { color: #ff6f00; background-color: #fff9f3cc; } //--------------------------------------------------- // æ–‡ç« å†…å®¹å›¾ç‰‡åœ†è§’ .article-page .main-article .article-content { img { max-width: 96% !important; height: auto !important; border-radius: 8px; } } //------------------------------------------- // è®¾ç½®é€‰ä¸­å­—ä½“çš„åŒºåŸŸèƒŒæ™¯é¢œè‰² ::selection { color: #fff; background: #001572; } a { text-decoration: none; color: var(--accent-color); \u0026amp;:hover { color: var(--accent-color-darker); } .link { font-weight: 800; /* å­—ä½“ç²—ç»†ä¸º700ï¼ˆåŠ ç²—ï¼‰ */ padding: 0 2px; /* å†…è¾¹è·ä¸ºå·¦å³å„2px */ text-decoration: none; /* å–æ¶ˆé»˜è®¤çš„ä¸‹åˆ’çº¿ */ cursor: pointer; /* é¼ æ ‡æŒ‡é’ˆä¸ºæŒ‡é’ˆæ ·å¼ */ /* è¶…é“¾æ¥é»˜è®¤é¢œè‰²ï¼ˆæ˜äº®æ¨¡å¼ï¼‰ */ color: #000000; /* æ˜äº®æ¨¡å¼ä¸‹é“¾æ¥å­—ä½“ä¸ºé»‘è‰²#000000 */ \u0026amp;:hover { text-decoration: underline; } } @media (prefers-color-scheme: dark) { .link { /* è¶…é“¾æ¥é»˜è®¤é¢œè‰²ï¼ˆæš—è‰²æ¨¡å¼ï¼‰ */ color: #FFFFFF; /* æš—è‰²æ¨¡å¼ä¸‹é“¾æ¥å­—ä½“ä¸ºç™½è‰²#FFFFFF */ } } } //------------------------------------------------- //æ–‡ç« å°é¢é«˜åº¦æ›´æ”¹ .article-list article .article-image img { width: 100%; height: 150px; // è®¾ç½®å›¾ç‰‡çš„é«˜åº¦ä¸º 150px object-fit: cover; @include respond(md) { height: 200px; } @include respond(xl) { height: 305px; } } //------------------------------------------------------ // ä¿®å¤å¼•ç”¨å—å†…å®¹çª„é¡µé¢æ˜¾ç¤ºé—®é¢˜ a { word-break: break-all; } code { word-break: break-all; } 2. ğŸ’¬ MD å¼•ç”¨å—æ ·å¼ âœ¨ åŠŸèƒ½ï¼šä¸ºMarkdownå¼•ç”¨å—æ·»åŠ ç‰¹æ®Šæ ·å¼ï¼Œå¢å¼ºè§†è§‰æ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 // æ–‡ç« å†…å®¹å¼•ç”¨å—æ ·å¼ .article-content { blockquote { border-left: 6px solid #004b28 !important; background: #366e33; } } 3. ğŸ–¼ï¸ ä½¿å›¾åºŠé“¾æ¥çš„å›¾ç‰‡å±…ä¸­ âœ¨ åŠŸèƒ½ï¼šè®©å¤–éƒ¨å›¾åºŠçš„å›¾ç‰‡ä¹Ÿèƒ½åƒæœ¬åœ°å›¾ç‰‡ä¸€æ ·å±…ä¸­æ˜¾ç¤º ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/partials/layout/article.scss Line 256 å¤„ï¼ˆåŒçº§ä»»æ„ä½ç½®ï¼‰å¢åŠ ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 // å›¾åºŠé“¾æ¥çš„å›¾ç‰‡å±…ä¸­ p \u0026gt; img { display: block; margin: 0 auto; max-width: 100%; height: auto; } 4. ğŸ“Š ç»Ÿè®¡ç«™ç‚¹æ–‡ç« æ•°é‡å’Œå­—æ•° âœ¨ åŠŸèƒ½ï¼šåœ¨é¡µè„šæ˜¾ç¤ºåšå®¢æ€»æ–‡ç« æ•°å’Œæ€»å­—æ•°ç»Ÿè®¡ ğŸ“Œ ä½ç½®ï¼šåœ¨./layout/partials/footer/footer.html çš„ \u0026lt;section class=\u0026quot;powerby\u0026quot;\u0026gt; é‡Œè¾¹ï¼ŒåŠ å…¥ä»£ç ï¼š 1 2 3 4 5 6 7 {{ $articleCount := len .Site.RegularPages }} {{ $totalWordCount := 0 }} {{ range .Site.Pages }} {{ $totalWordCount = add $totalWordCount .WordCount }} {{ end }} \u0026lt;p\u0026gt;å‘å¸ƒäº† {{ $articleCount }} ç¯‡æ–‡ç«  | å…± {{$totalWordCount}} å­—\u0026lt;/p\u0026gt; 5. ğŸ  é¦–é¡µæ–‡ç« æ ·å¼ âœ¨ åŠŸèƒ½ï¼šç¾åŒ–é¦–é¡µæ–‡ç« åˆ—è¡¨çš„æ˜¾ç¤ºæ•ˆæœï¼ŒåŒ…æ‹¬å›¾ç‰‡åœ†è§’å’Œæ‚¬åœåŠ¨ç”» ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss åŠ å…¥ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 /*ä¸»é¡µæ–‡ç« å›¾ç‰‡æ ·å¼*/ $image-scale: 1.2; .article-list article .article-image img { width: 100%; height: 150px; object-fit: cover; //ä¸åŒæ˜¾ç¤ºå™¨ï¼ˆæ‰‹æœºï¼Œå°å±å¹•ç”µè„‘ï¼Œå¤§å±å¹•ç”µè„‘ï¼‰æ˜¾ç¤ºçš„å›¾ç‰‡é«˜åº¦å¤§å° @include respond(sm) { height: 305px; } @include respond(md) { height: 305px; } @include respond(xl) { height: 325px; } } /*ä¸»é¡µæ–‡ç« å›¾ç‰‡åœ†è§’*/ .article-list article { --card-border-radius: 24px; } /*æ–‡ç« æ ‡ç­¾åœ†è§’*/ .article-category a, .article-tags a { border-radius: 11px; } /*é¼ æ ‡ç§»åŠ¨åˆ°æ–‡ç« å›¾ç‰‡æ”¾å¤§*/ .article-list article .article-image { position: relative; overflow: hidden; //ä¸æ˜¾ç¤ºè¶…å‡ºçš„éƒ¨åˆ† } .article-list article .article-image img:hover { transform: scale($image-scale); //æ”¾å¤§å°ºå¯¸ } .article-list article .article-image img { transition: transform 0.85s ease-in-out;//æŒç»­æ—¶é—´ } 6. ğŸ–¼ï¸ æ–‡ç« å†…éƒ¨å›¾ç‰‡æ ·å¼ âœ¨ åŠŸèƒ½ï¼šä¼˜åŒ–æ–‡ç« å†…éƒ¨ç›¸å…³æ–‡ç« åŒºåŸŸçš„å›¾ç‰‡æ˜¾ç¤ºæ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss åŠ å…¥ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 /*æ–‡ç« å†…éƒ¨-é¡µè„š-ç›¸å…³æ–‡ç« å›¾ç‰‡åœ†è§’*/ .article-list--compact article .article-image img { border-radius: 17%; } /*æ–‡ç« å†…éƒ¨-é¡µè„š-ç›¸å…³æ–‡ç« å›¾ç‰‡æ”¾å¤§åŠ¨ç”»*/ .article-list--compact article \u0026gt; a { transition: .6s ease; } .article-list--compact article \u0026gt; a:hover { transform: scale(1.03, 1.03); overflow: visible; } 7. ğŸ’» MacOS é£æ ¼ä»£ç å— âœ¨ åŠŸèƒ½ï¼šä¸ºä»£ç å—æ·»åŠ MacOSé£æ ¼é¡¶éƒ¨æ ï¼Œå¢å¼ºè§†è§‰ç¾æ„Ÿ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // MacOS é£æ ¼ä»£ç å— .article-content { .highlight:before { content: \u0026#39;\u0026#39;; display: block; background: url(/code-header.svg); height: 32px; width: 100%; background-size: 57px; background-repeat: no-repeat; margin-bottom: 5px; background-position: -1px 2px; } } // lightæ¨¡å¼ä¸‹çš„ä»£ç å—æ ·å¼è°ƒæ•´ [data-scheme=\u0026#34;light\u0026#34;] .article-content .highlight { background-color: #fdf4eb; } [data-scheme=\u0026#34;light\u0026#34;] .chroma { color: #ff6f00; background-color: #fcf0e4cc; } ğŸ“Œ ä½ç½®ï¼šåœ¨ ./static æ–‡ä»¶å¤¹ä¸‹æ–°å»º code-header.svgå†™å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 \u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; version=\u0026#34;1.1\u0026#34; x=\u0026#34;0px\u0026#34; y=\u0026#34;0px\u0026#34; width=\u0026#34;470px\u0026#34; height=\u0026#34;130px\u0026#34;\u0026gt; \u0026lt;ellipse cx=\u0026#34;65\u0026#34; cy=\u0026#34;65\u0026#34; rx=\u0026#34;50\u0026#34; ry=\u0026#34;52\u0026#34; stroke=\u0026#34;rgb(220,60,54)\u0026#34; stroke-width=\u0026#34;2\u0026#34; fill=\u0026#34;rgb(237,108,96)\u0026#34;/\u0026gt; \u0026lt;ellipse cx=\u0026#34;225\u0026#34; cy=\u0026#34;65\u0026#34; rx=\u0026#34;50\u0026#34; ry=\u0026#34;52\u0026#34; stroke=\u0026#34;rgb(218,151,33)\u0026#34; stroke-width=\u0026#34;2\u0026#34; fill=\u0026#34;rgb(247,193,81)\u0026#34;/\u0026gt; \u0026lt;ellipse cx=\u0026#34;385\u0026#34; cy=\u0026#34;65\u0026#34; rx=\u0026#34;50\u0026#34; ry=\u0026#34;52\u0026#34; stroke=\u0026#34;rgb(27,161,37)\u0026#34; stroke-width=\u0026#34;2\u0026#34; fill=\u0026#34;rgb(100,200,86)\u0026#34;/\u0026gt; \u0026lt;/svg\u0026gt; 8. ğŸ”§ ä¿®æ”¹ä»£ç å—æ ·å¼ âœ¨ åŠŸèƒ½ï¼šè°ƒæ•´ä»£ç å—çš„è¾¹è·ã€åœ†è§’å’Œå¤åˆ¶æŒ‰é’®ä½ç½® ğŸ“Œ ä½ç½®ï¼šä¿®æ”¹ .\\assets\\scss\\partials\\layout\\article.scss,åœ¨æ–‡ä»¶å°¾æ·»åŠ ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // --------------------ä»£ç å—æ ·å¼------------------------ // * ä¿®æ”¹è¾¹è· // * èƒŒæ™¯æ¡†æ·»åŠ åœ†è§’ // * è°ƒæ•´ copy æŒ‰é’®ä½ç½® .highlight { margin-left: 0; margin-right: 0; width: calc(100%); border-radius: var(--card-border-radius); } .copyCodeButton { top: 6px; right: 6px; } 9. ğŸ¯ ä»£ç å—é«˜äº® âœ¨ åŠŸèƒ½ï¼šé…ç½®ä»£ç è¯­æ³•é«˜äº®æ ·å¼ï¼Œæ”¯æŒè¡Œå·æ˜¾ç¤º ğŸ“Œ ä½ç½®ï¼šåœ¨ hugo.yaml ä¸­ï¼Œæ·»åŠ  highlight å‚æ•°ï¼š 1 2 3 4 5 6 7 8 9 10 markup: highlight: noClasses: false codeFences: true guessSyntax: true lineNoStart: 1 lineNos: true lineNumbersInTable: true tabWidth: 4 style: github-dark 10. ğŸš« å…³é—­ä»£ç å—è¯­è¨€æ˜¾ç¤º âœ¨ åŠŸèƒ½ï¼šéšè—ä»£ç å—é¡¶éƒ¨çš„è¯­è¨€æ ‡è¯† ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 // å…³é—­ä»£ç å—è¯­è¨€æ˜¾ç¤º .languageCodeButton { display: none; } 11. ğŸ”— å¤–éƒ¨é“¾æ¥åé¢æ˜¾ç¤ºå›¾æ ‡ âœ¨ åŠŸèƒ½ï¼šä¸ºå¤–éƒ¨é“¾æ¥æ·»åŠ å›¾æ ‡æ ‡è¯†ï¼Œæç¤ºç”¨æˆ·è¿™æ˜¯å¤–éƒ¨é“¾æ¥ ğŸ“Œ ä½ç½®ï¼šåˆ›å»º./layouts/_default/_markup/render-link.htmlæ–‡ä»¶ä¹‹åå¢åŠ å¦‚ä¸‹ä»£ç : 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;a class=\u0026#34;link\u0026#34; href=\u0026#34;{{ .Destination | safeURL }}\u0026#34; {{ with .Title }} title=\u0026#34;{{ . }}\u0026#34; {{ end }} {{ if strings.HasPrefix .Destination \u0026#34;http\u0026#34; }} target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34; {{ end }}\u0026gt; \u0026lt;span style=\u0026#34;display: inline-flex; align-items: center; gap: 0.5em;\u0026#34;\u0026gt; {{ .Text | safeHTML }} {{ if strings.HasPrefix .Destination \u0026#34;http\u0026#34; }} \u0026lt;svg width=\u0026#34;.7em\u0026#34; height=\u0026#34;.7em\u0026#34; viewBox=\u0026#34;0 0 21 21\u0026#34; xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34;\u0026gt; \u0026lt;path d=\u0026#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z\u0026#34; fill=\u0026#34;currentColor\u0026#34; /\u0026gt; \u0026lt;path d=\u0026#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z\u0026#34; fill=\u0026#34;currentColor\u0026#34; /\u0026gt; \u0026lt;/svg\u0026gt; {{ end }} \u0026lt;/span\u0026gt; \u0026lt;/a\u0026gt; 12. ğŸ“‹ è¯­è¨€å’Œå¤åˆ¶æŒ‰é’® âœ¨ åŠŸèƒ½ï¼šæ”¹è¿›ä»£ç å—çš„è¯­è¨€æ ‡è¯†å’Œå¤åˆ¶æŒ‰é’®çš„æ˜¾ç¤ºæ–¹å¼ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/ts/main.ts ä¸­ï¼Œç¬¬ 66 è¡Œå¼€å§‹ï¼Œæ”¹æˆä»¥ä¸‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 const highlights = document.querySelectorAll(\u0026#34;.article-content div.highlight\u0026#34;); const copyText = `ğŸ“„æ‹·è´`, copiedText = `å·²æ‹·è´!`; highlights.forEach((highlight) =\u0026gt; { const copyButton = document.createElement(\u0026#34;button\u0026#34;); copyButton.innerHTML = copyText; copyButton.classList.add(\u0026#34;copyCodeButton\u0026#34;); highlight.appendChild(copyButton); const codeBlock = highlight.querySelector(\u0026#34;code[data-lang]\u0026#34;); // è·å–è¯­è¨€ const lang = codeBlock.getAttribute(\u0026#34;data-lang\u0026#34;); if (!codeBlock) return; copyButton.addEventListener(\u0026#34;click\u0026#34;, () =\u0026gt; { navigator.clipboard .writeText(codeBlock.textContent) .then(() =\u0026gt; { copyButton.textContent = copiedText; setTimeout(() =\u0026gt; { copyButton.textContent = copyText; }, 1000); }) .catch((err) =\u0026gt; { alert(err); console.log(\u0026#34;Something went wrong\u0026#34;, err); }); }); // Add language code button const languageButton = document.createElement(\u0026#34;button\u0026#34;); languageButton.innerHTML = lang.toUpperCase() + \u0026#34;\u0026amp;nbsp;\u0026amp;nbsp;\u0026#34;; languageButton.classList.add(\u0026#34;languageCodeButton\u0026#34;); highlight.appendChild(languageButton); }); new StackColorScheme(document.getElementById(\u0026#34;dark-mode-toggle\u0026#34;)); ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç è°ƒæ•´æŒ‰é’®ä½ç½®ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 /* å¤åˆ¶æŒ‰é’®æ ·å¼è°ƒæ•´ */ .article-content .copyCodeButton { position: absolute; top: 10px; right: 18px; border-radius: 12px; color: #ffffff; background: #3d3c3c; border: 1px solid #333; padding: 5px 10px; font-weight: 500; text-shadow: 0 0 1px rgba(255, 255, 255, 0.5); } /* æ³¨é‡Šè¯­è¨€ä»£ç æ¡† */ /* .article-content .languageCodeButton { position: absolute; top: 9px; right: 100px; border-radius: 12px; color: #000; background: #ffff00; border: 1px solid #333; padding: 5px 10px; font-family: lato; font-size: 1.5rem; text-shadow: 0 0 1px rgba(255, 255, 255, 0.5); } */ .article-content .copyCodeButton:hover { background: #ffa500; border-color: #000; } 13. ğŸ“‘æ–‡ç« ç›®å½•æŠ˜å \u0026amp;å±•å¼€ å°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°layouts/partials/footer/custom.htmlæ–‡ä»¶ä¸­(æ–‡ä»¶ä¸å­˜åœ¨åˆ™è‡ªè¡Œåˆ›å»º) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 \u0026lt;style\u0026gt; #TableOfContents \u0026gt; ul, ol { ul, ol { display: none; } .open { display: block; } } \u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; function initTocHide() { // åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ç« ç›®å½• let toc = document.querySelector(\u0026#34;.widget--toc\u0026#34;); if (!toc) { return; } // ç›‘å¬æ»šåŠ¨ window.addEventListener(\u0026#39;scroll\u0026#39;, function() { //æ¸…é™¤classå€¼ let openUl = document.querySelectorAll(\u0026#34;.open\u0026#34;); if (openUl.length \u0026gt; 0) { openUl.forEach((ul) =\u0026gt; { ul.classList.remove(\u0026#34;open\u0026#34;) }) } // è·å–active-class let currentLi = document.querySelector(\u0026#34;.active-class\u0026#34;); if (!currentLi) { return } // å±•ç¤ºå­ul if (currentLi.children.length \u0026gt; 1) { currentLi.children[1].classList.add(\u0026#34;open\u0026#34;) } // å±•ç¤ºçˆ¶ul let ul = currentLi.parentElement; do { ul.classList.add(\u0026#34;open\u0026#34;); ul = ul.parentElement.parentElement } while (ul !== undefined \u0026amp;\u0026amp; (ul.localName === \u0026#39;ul\u0026#39; || ul.localName === \u0026#39;ol\u0026#39;)) }); } initTocHide() \u0026lt;/script\u0026gt; 14. ğŸ§‘â€ğŸ’» ä»£ç å—è¿‡é•¿æŠ˜å \u0026amp;å±•å¼€ åˆ›å»º layouts/partials/footer/code-block.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  ä¿®æ”¹åçš„ code-block.html åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ code-block.html 1 {{ partial \u0026#34;footer/code-block.html\u0026#34; . }} ä¸‰ã€ğŸ“Œ ä¾§è¾¹æ ç¾åŒ– 1. ğŸ“ é¡µé¢å·¦å³è¾¹æ å®½åº¦ âœ¨ åŠŸèƒ½ï¼šè°ƒæ•´å·¦å³ä¾§è¾¹æ çš„å®½åº¦æ¯”ä¾‹ï¼Œä¼˜åŒ–é˜…è¯»ä½“éªŒ ğŸ“Œ ä½ç½®ï¼šåœ¨ /themes/hugo-theme-stack/assets/scss/grid.scss çš„ç¬¬ 29ã€30 è¡Œï¼Œä¿®æ”¹ä¸º: 1 2 --left-sidebar-max-width: 14%; --right-sidebar-max-width: 22%; 2. ğŸ­ å³ä¾§å¯¼èˆªæ åŠ¨ç”» âœ¨ åŠŸèƒ½ï¼šä¸ºå³ä¾§è¾¹æ å…ƒç´ æ·»åŠ æ‚¬åœåŠ¨ç”»æ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 //------------------------------------------------------ //å½’æ¡£å°å›¾æ ‡æ”¾å¤§åŠ¨ç”» .widget.archives .widget-archive--list { transition: transform .3s ease; } .widget.archives .widget-archive--list:hover { transform: scale(1.05, 1.05); } //------------------------------------------------------ //å³ä¾§æ ‡ç­¾æ”¾å¤§åŠ¨ç”» .tagCloud .tagCloud-tags a { border-radius: 10px; font-size: 1.4rem; transition: transform .3s ease; } .tagCloud .tagCloud-tags a:hover { transform: scale(1.1, 1.1); } 3. ğŸ¨ å·¦ä¾§å¯¼èˆªæ ç¾åŒ– âœ¨ åŠŸèƒ½ï¼šç¾åŒ–å·¦ä¾§è¾¹æ çš„å¤´åƒã€ç¤¾äº¤å›¾æ ‡ç­‰å…ƒç´  ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss åŠ å…¥ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /*--------------------å·¦ä¾§å¯¼èˆªæ ---------------*/ .left-sidebar { --sidebar-avatar-size: 115px; //å·¦ä¾§å¤´åƒå¤§å° --sidebar-element-separation: 15px; //å¤´åƒä¸‹æ–¹é—´è· --emoji-size: 40px; //emojiå®¹å™¨å¤§å° --emoji-font-size: 25px; //emojiå­—ä½“å¤§å° } /*ç¤¾äº¤èœå•å±…ä¸­*/ .social-menu svg { gap: 15px; justify-content: center; width: 30px; height: 30px; //ç¤¾äº¤èœå•å¤§å° stroke: var(--body-text-color); stroke-width: 1.33; } 4. âœ¨ å·¦ä¾§å¯¼èˆªæ åŠ¨ç”» âœ¨ åŠŸèƒ½ï¼šä¸ºå·¦ä¾§èœå•é¡¹æ·»åŠ æ‚¬åœåŠ¨ç”»æ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 //------------------------------------------------------ /******* å·¦ä¾§æ é€‰é¡¹åŠ¨ç”» ******/ #main-menu { overflow: visible } #main-menu .current { transform: scale(1.1) } #main-menu\u0026gt;li:not(.current) a { transition: transform .2s ease-in-out } #main-menu\u0026gt;li:not(.current) a:hover { transform: scale(1.1) } #dark-mode-toggle { transition: transform .2s ease-in-out } #dark-mode-toggle:hover { transform: scale(1.1) } #dark-mode-toggle:hover svg { transform: rotate(180deg) } .menu-social { overflow: visible } .menu-social li { transition: transform .8s ease-in-out } .menu-social li:hover { transform: scale(1.3)rotate(360deg) } /* å½’æ¡£å’Œé“¾æ¥å¡ç‰‡åŠ¨ç”» */ .article-list--compact { overflow: visible; } .article-list--compact article { transition: transform 0.6s ease; -webkit-font-smoothing: antialiased; will-change: transform; \u0026amp;:hover { transform: scale(1.05,1.05); z-index: 4; } } /* åˆ†ç±»é¡µé¢åŠ¨ç”» */ .article-list--tile article { transition: 0.6s ease; } .article-list--tile article:hover { transform: scale(1.05, 1.05); will-change: transform; } 5. ğŸ¤ ç¤¾äº¤ social âœ¨ åŠŸèƒ½ï¼šè‡ªå®šä¹‰ç¤¾äº¤å›¾æ ‡å¹¶æ·»åŠ æ—‹è½¬åŠ¨ç”»æ•ˆæœ ğŸ“Œ è¯´æ˜ï¼šè‡ªå®šä¹‰å›¾æ ‡ï¼Œiconfont ä¸‹è½½ï¼Œé¢œè‰² #2c3e50ï¼Œå¤§å° 24ï¼Œæ ¼å¼ svgã€‚ä¸‹è½½åæ”¾åˆ° .\\assets\\icons ğŸ“Œ è¯´æ˜ï¼šæœ¬ä¸»é¢˜è‡ªå¸¦äº†ä¸€äº›æ¥è‡ªã€ Tabler Icons ã€‘çš„ SVG å›¾æ ‡ã€‚æ‚¨å¯ä»¥åœ¨ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°å®ƒä»¬ .\\assets\\icons ğŸ’¡ æç¤ºï¼šå°†ä¸‹è½½çš„ img ä¸­çš„ svg çš„æ‰€æœ‰ #2c3e50 æ”¹æˆ currentColorï¼Œå¦åˆ™åˆ‡æ¢ä¸ºé»‘è‰²æ¨¡å¼ï¼Œå›¾æ ‡é¢œè‰²ä¸èƒ½è‡ªåŠ¨åˆ‡æ¢ï¼Œå› ä¸ºä¼˜å…ˆä½¿ç”¨å†…éƒ¨å®šä¹‰çš„ color ğŸ“Œ ä½ç½®ï¼šä¿®æ”¹ hugo ä¸»é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä¸‹é¢çš„å†…å®¹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 menu: main: [] # ä¸»èœå• social: - identifier: bilibili # æ ‡è¯†ç¬¦ name: Bilibili # æ˜¾ç¤ºåç§° url: https://space.bilibili.com/35158479 # é“¾æ¥åœ°å€ weight: 100 # é¡¹ç›®çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ params: icon: brand-bilibili # å›¾æ ‡åç§° newTab: true # æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æ­¤é“¾æ¥ - identifier: github # æ ‡è¯†ç¬¦ name: GitHub # æ˜¾ç¤ºåç§° url: https://github.com/meimolihan # é“¾æ¥åœ°å€ weight: 200 # é¡¹ç›®çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ params: icon: brand-github # å›¾æ ‡åç§° newTab: true # æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æ­¤é“¾æ¥ - identifier: rss # æ ‡è¯†ç¬¦ name: RSS # æ˜¾ç¤ºåç§° url: https://meimolihan.github.io/index.xml # é“¾æ¥åœ°å€ weight: 300 # é¡¹ç›®çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ params: icon: brand-rss # å›¾æ ‡åç§° newTab: true # æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æ­¤é“¾æ¥ ğŸ“Œ ä½ç½®ï¼šå›¾æ ‡360åº¦æ—‹è½¬åŠ¨ç”».\\assets\\scss\\custom.scssè¿½åŠ ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 .icon-tabler-brand-bilibili { transition: transform 1s ease-in-out; } /* é¼ æ ‡æ‚¬åœæ—¶è®© SVG å›¾æ ‡æ—‹è½¬ 360 åº¦ */ .icon-tabler-brand-bilibili:hover { transform: rotate(360deg); } .icon-tabler-brand-github { transition: transform 1s ease-in-out; } /* é¼ æ ‡æ‚¬åœæ—¶è®© SVG å›¾æ ‡æ—‹è½¬ 360 åº¦ */ .icon-tabler-brand-github:hover { transform: rotate(360deg); .icon-tabler-rss { transition: transform 1s ease-in-out; } /* é¼ æ ‡æ‚¬åœæ—¶è®© SVG å›¾æ ‡æ—‹è½¬ 360 åº¦ */ .icon-tabler-rss:hover { transform: rotate(360deg); } 6. ğŸŒ“ æ˜äº®æ¨¡å¼è°ƒæ•´ä½ç½® âœ¨ åŠŸèƒ½ï¼šè°ƒæ•´æ˜æš—æ¨¡å¼åˆ‡æ¢æŒ‰é’®çš„ä½ç½® ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 // æ˜æš—æ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼Œè°ƒæ•´ä½ç½® #dark-mode-toggle { margin-bottom: 100px; // æ˜æš—æ¨¡å¼ï¼Œä¸Šä¸‹é«˜åº¦ // margin-left: 10px; // æ˜æš—æ¨¡å¼ï¼Œå·¦å³è°ƒèŠ‚ gap: 30px; // æ˜æš—æ¨¡å¼ï¼Œæ¨ªå‘å®½åº¦ } 7. âš™ï¸ æ‰‹åŠ¨ä¿®æ”¹å·¦å³ä¾§è¾¹æ è®¾ç½®æ ·å¼ âœ¨ åŠŸèƒ½ï¼šæ‰‹åŠ¨ç²¾ç¡®æ§åˆ¶å·¦å³ä¾§è¾¹æ çš„å®½åº¦æ¯”ä¾‹ ğŸ“Œ ä½ç½®ï¼šåœ¨ /assets/scss/grid.scss ä¸­ä¿®æ”¹ left-sidebar å’Œ right-sidebar çš„æè¿°ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // ä¸ºå·¦å³ä¾§è¾¹æ è®¾ç½®æ ·å¼ï¼Œå°†å·¦ä¾§è¾¹æ çš„æ’åˆ—é¡ºåºè®¾ä¸º -3 å¹¶å°†æœ€å¤§å®½åº¦è®¾ä¸ºçˆ¶å®¹å™¨çš„ 10%ï¼Œå³ä¾§è¾¹æ æ’åˆ—é¡ºåºè®¾ä¸º -1 ä¸”æœ€å¤§å®½åº¦ä¸ºçˆ¶å®¹å™¨çš„ 20%ï¼ŒåŒæ—¶åˆ©ç”¨è‡ªå®šä¹‰å“åº”å¼æ··åˆå™¨ï¼Œä½¿å³ä¾§è¾¹æ åœ¨å±å¹•è¾¾åˆ°ç‰¹å®šå¤§å°ºå¯¸ï¼ˆå¯¹åº” lgï¼‰æ—¶ä»¥å¼¹æ€§å¸ƒå±€æ˜¾ç¤ºã€‚ .left-sidebar { order: -3; // max-width: var(--left-sidebar-max-width); max-width: 10%; } .right-sidebar { order: -1; // max-width: var(--right-sidebar-max-width); max-width: 20%; /// Display right sidebar when min-width: lg @include respond(lg) { display: flex; } } æŠŠæ­£æ–‡çš„å æ¯”æ”¹åˆ°äº† 70%, åŸæ¥çš„åªæœ‰ 50% å·¦å³\n8. ğŸ”„ å¤´åƒæ—‹è½¬ âœ¨ åŠŸèƒ½ï¼šä¸ºåšå®¢å¤´åƒæ·»åŠ æ—‹è½¬åŠ¨ç”»æ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 // ----------å¤´åƒæ—‹è½¬åŠ¨ç”»-------------- .sidebar header .site-avatar .site-logo { transition: transform 1.65s ease-in-out; // æ—‹è½¬æ—¶é—´ } .sidebar header .site-avatar .site-logo:hover { transform: rotate(360deg); // æ—‹è½¬è§’åº¦ä¸º360åº¦ } 9. ğŸ“‚ å‹æƒ…é“¾æ¥+åˆ†ç±»+æ ‡ç­¾+å½’æ¡£ã€ä¸‰æ æ˜¾ç¤ºã€‘ âœ¨ åŠŸèƒ½ï¼šå°†å‹æƒ…é“¾æ¥ã€åˆ†ç±»ã€æ ‡ç­¾å’Œå½’æ¡£ä»¥ä¸‰æ ç½‘æ ¼å¸ƒå±€æ˜¾ç¤º ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 //------------------------------------------------------ // å‹æƒ…é“¾æ¥+åˆ†ç±»+æ ‡ç­¾+å½’æ¡£ã€ä¸‰æ æ˜¾ç¤ºã€‘ @media (min-width: 1024px) { .article-list--compact { display: grid; // ç›®å‰æ˜¯ä¸‰åˆ—ï¼Œå¦‚éœ€äºŒåˆ—ï¼Œåˆ™åé¢å‡å»ä¸€ä¸ª1frï¼Œä»¥æ­¤ç±»æ¨ grid-template-columns: 1fr 1fr 1fr; background: none; box-shadow: none; gap: 1rem; article { background: var(--card-background); border: none; box-shadow: var(--shadow-l2); margin-bottom: 8px; margin-right: 8px; border-radius: 16px; } } } 10. ğŸ“¦ ç¼©å°å½’æ¡£é¡µçš„åˆ†ç±»å¡ç‰‡å°ºå¯¸ âœ¨ åŠŸèƒ½ï¼šè°ƒæ•´å½’æ¡£é¡µé¢åˆ†ç±»å¡ç‰‡çš„å°ºå¯¸ï¼Œä½¿å…¶æ›´åŠ ç´§å‡‘ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/partials/layout/list.scssä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š(å¹¶ä¿®æ”¹) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 //---------------ç¼©å°å½’æ¡£é¡µçš„åˆ†ç±»å¡ç‰‡å°ºå¯¸--------------- .subsection-list { overflow-x: auto; .article-list--tile { display: flex; padding-bottom: 0px; article { width: 230px; height: 120px; margin-right: 5px; flex-shrink: 0; .article-title { margin: 0; font-size: 1.8rem; } .article-details { padding: 20px; } } } } 11. ğŸ“‹ è°ƒæ•´ TOC ç›®å½•é—´è· âœ¨ åŠŸèƒ½ï¼šä¼˜åŒ–ç›®å½•æ˜¾ç¤ºçš„é—´è·å’Œæ ·å¼ï¼Œæé«˜å¯è¯»æ€§ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // ----------------è°ƒæ•´ TOC ç›®å½•é—´è·------------------ // ä¸»è¦è§£å†³äº†å‡ ä¸ªé—®é¢˜ï¼š // ç›®å½•å¤ªé«˜äº†ï¼Œä½¿å¾—ä¹‹å‰æ·»åŠ çš„è¿”å›é¡¶éƒ¨æŒ‰é’®å¯èƒ½ä¼šè¢«é¡¶å‡ºå±å¹•ï¼› // ç›®å½•é¡¹å‰é¢çš„å°é»‘ç‚¹ä¸å¤ªå¥½çœ‹ï¼Œéšå»ï¼› // ç›®å½•é¡¹ä¹‹é—´çš„è·ç¦»ä¸å¤Ÿç´§å‡‘ã€‚ .widget--toc { background-color: var(--card-background); border-radius: var(--card-border-radius); box-shadow: var(--shadow-l2); //ä¿®æ”¹é˜´å½±æ ·å¼ display: flex; flex-direction: column; color: var(--card-text-color-main); overflow: hidden; display:inline-block; //æ ¹æ®å†…å®¹è°ƒæ•´å®½åº¦ #TableOfContents { max-height: 65vh; ol, ul { list-style-type: none; } li { margin: 10px 10px; \u0026amp; \u0026gt; ol, \u0026amp; \u0026gt; ul { margin-top: 10px; padding-left: 10px; margin-bottom: -5px; \u0026amp; \u0026gt; li:last-child { margin-bottom: 0; } } } \u0026amp; \u0026gt; ul { padding: 0 1em; } li { margin: 5px 20px; //ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡Œé—´è·ï¼Œç¬¬äºŒä¸ªæ˜¯å¡ç‰‡å‘¨è¾¹çš„å®½åº¦ padding: 6px; //æ§åˆ¶å†…è¾¹è· \u0026amp; \u0026gt; ol, \u0026amp; \u0026gt; ul { margin-top: 10px; padding-left: 10px; margin-bottom: -5px; \u0026amp; \u0026gt; li:last-child { margin-bottom: 0; } } } } } 12. ğŸ” é¼ æ ‡æ‚¬åœè¶…é“¾æ¥çš„æ˜¾ç¤º âœ¨ åŠŸèƒ½ï¼šä¸ºè¶…é“¾æ¥æ·»åŠ æ‚¬åœé«˜äº®æ•ˆæœï¼Œå¢å¼ºäº¤äº’ä½“éªŒ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // ---------------------é¼ æ ‡æ‚¬åœï¼Œè¶…é“¾æ¥çš„æ˜¾ç¤º------------------- a { text-decoration: none; color: var(--accent-color); \u0026amp;:hover { color: var(--accent-color-darker); } \u0026amp;.link { // é¼ æ ‡æœªæ‚¬åœæ—¶ï¼Œè¶…é“¾æ¥æ˜¾ç¤º2pxçš„é«˜äº® box-shadow: 0px -2px 0px rgba(var(--link-background-color), var(--link-background-opacity-hover)) inset; transition: all 0.3s ease; \u0026amp;:hover { // é¼ æ ‡æ‚¬åœï¼Œé«˜äº®ä¸º18px box-shadow: 0px -18px 0px rgba(var(--link-background-color), var(--link-background-opacity-hover)) inset; } } } å››ã€ğŸ”§ å…¶å®ƒå°éƒ¨ä»¶ 1. ğŸ“ˆ æ·»åŠ ç«™ç‚¹ç»Ÿè®¡ä¿¡æ¯ä¸ i18n âœ¨ åŠŸèƒ½ï¼šåœ¨é¡µè„šæ˜¾ç¤ºåšå®¢è¿è¡Œæ—¶é—´ã€æ–‡ç« ç»Ÿè®¡å’Œè®¿é—®é‡æ•°æ®ï¼Œæ”¯æŒå¤šè¯­è¨€\nğŸ“Œ å±•ç¤ºæ ¼å¼ï¼š\næœ¬åšå®¢å·²ç¨³å®šè¿è¡Œ x å¤© y å°æ—¶ z åˆ†é’Ÿ å…±å‘è¡¨ x ç¯‡æ–‡ç« ãƒ»æ€»è®¡ y k å­— æœ¬ç«™æ€»è®¿é—®é‡ x æ¬¡ ğŸ“Œ ä½ç½®ï¼šåœ¨æ ¹ç›®å½•./layouts/partials/footer/footer.html æ–‡ä»¶å†…æ·»åŠ å¦‚ä¸‹ä»£ç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 \u0026lt;section class=\u0026#34;count_info\u0026#34;\u0026gt; \u0026lt;div\u0026gt; {{ T \u0026#34;footer.runtime1\u0026#34; }} \u0026lt;span id=\u0026#34;ds\u0026#34; class=\u0026#34;running-days number-highlight\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; {{ T \u0026#34;footer.runtime2\u0026#34; }} \u0026lt;span id=\u0026#34;hs\u0026#34; class=\u0026#34;running-days number-highlight\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; {{ T \u0026#34;footer.runtime3\u0026#34; }} \u0026lt;span id=\u0026#34;ms\u0026#34; class=\u0026#34;running-days number-highlight\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; {{ T \u0026#34;footer.runtime4\u0026#34; }} \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; {{$scratch := newScratch}} {{ range (where .Site.Pages \u0026#34;Kind\u0026#34; \u0026#34;page\u0026#34; )}} {{$scratch.Add \u0026#34;total\u0026#34; .WordCount}} {{ end }} {{ T \u0026#34;footer.count1\u0026#34; }} \u0026lt;span class=\u0026#34;number-highlight\u0026#34;\u0026gt;{{ len (where .Site.RegularPages \u0026#34;Section\u0026#34; \u0026#34;post\u0026#34;) }}\u0026lt;/span\u0026gt; {{ T \u0026#34;footer.count2\u0026#34; }} \u0026lt;span class=\u0026#34;number-highlight\u0026#34;\u0026gt;{{ div ($scratch.Get \u0026#34;total\u0026#34;) 1000.0 | lang.FormatNumber 2 }}\u0026lt;/span\u0026gt; k {{ T \u0026#34;footer.count3\u0026#34; }} \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; \u0026lt;span id=\u0026#34;busuanzi_container_site_pv\u0026#34;\u0026gt; {{ T \u0026#34;footer.pv1\u0026#34; }} \u0026lt;span id=\u0026#34;busuanzi_value_site_pv\u0026#34; class=\u0026#34;number-highlight\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; {{ T \u0026#34;footer.pv2\u0026#34; }} \u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;!-- Add blog running time --\u0026gt; \u0026lt;script\u0026gt; let s1 = \u0026#39;2025-01-01\u0026#39;; //website start date s1 = new Date(s1.replace(/-/g, \u0026#34;/\u0026#34;)); let s2 = new Date(); let timeDifference = s2.getTime() - s1.getTime(); let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24)); let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); let minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60)); // è·å–å…ƒç´ å¹¶è®¾ç½®å†…å®¹å’Œç±»å const ds = document.getElementById(\u0026#39;ds\u0026#39;); const hs = document.getElementById(\u0026#39;hs\u0026#39;); const ms = document.getElementById(\u0026#39;ms\u0026#39;); ds.innerHTML = days; hs.innerHTML = hours; ms.innerHTML = minutes; // ç¡®ä¿è¿è¡Œæ—¶é—´çš„æ•°å­—ä¹Ÿæœ‰é«˜äº®æ ·å¼ï¼ˆè™½ç„¶æ¨¡æ¿ä¸­å·²ç»æ·»åŠ äº†ç±»åï¼Œè¿™é‡Œå†æ¬¡ç¡®è®¤ï¼‰ ds.classList.add(\u0026#39;number-highlight\u0026#39;); hs.classList.add(\u0026#39;number-highlight\u0026#39;); ms.classList.add(\u0026#39;number-highlight\u0026#39;); // ä¸ºä¸è’œå­è®¿é—®é‡æ•°æ®ä¹Ÿæ·»åŠ é«˜äº®ï¼ˆå½“æ•°æ®åŠ è½½åï¼‰ const busuanziValue = document.getElementById(\u0026#39;busuanzi_value_site_pv\u0026#39;); if (busuanziValue) { busuanziValue.classList.add(\u0026#39;number-highlight\u0026#39;); } \u0026lt;/script\u0026gt; ğŸ“Œ ä½ç½®ï¼šåœ¨ä¸»é¢˜ç›®å½•/i18n/zh-cn.yaml ä¸‹æ‰¾åˆ°å¯¹åº”è¯­è¨€çš„æ–‡ä»¶ï¼Œåœ¨å±æ€§ footer ä¸‹æ·»åŠ ç›¸åº”å­—æ®µï¼Œç»“æœå¦‚ä¸‹: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 footer: # æœ¬åšå®¢å·²ç¨³å®šè¿è¡Œ1å¤©2å°æ—¶3åˆ†é’Ÿ runtime1: other: æœ¬ç«™ç¨³å®šè¿è¡Œï¼š runtime2: other: å¤© runtime3: other: å°æ—¶ runtime4: other: åˆ†é’Ÿ # å…±å‘è¡¨xç¯‡æ–‡ç« ï¼Œæ€»è®¡y kå­— count1: other: å…±å‘è¡¨æ–‡ç« æ•°ï¼š count2: other: ç¯‡ Â· æ€»è®¡ count3: other: å­— # æœ¬ç«™æ€»è®¿é—®é‡Xæ¬¡ pv1: other: æœ¬ç«™æ€»è®¿é—®é‡ï¼š pv2: other: æ¬¡ ä¿®æ”¹æ•°å€¼é¢œè‰² ğŸ“Œ ä½ç½®ï¼šæ‰¾åˆ° ./assets/scss/custom.scss åœ¨æ–‡ä»¶é‡Œé¢è¿½åŠ  ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /******** ä¿®æ”¹-é¡µè„šè®¿é—®é‡-æ ·å¼ ********/ .count_info { border: 1px solid #ddd; border-radius: 25px; transform: translateY(-66px); /* å‘ä¸ŠæŠ¬ 66px */ } [data-scheme=\u0026#34;dark\u0026#34;] .count_info { border: 1px solid #39393900; padding: 12px; border-radius: 20px; background: #3f3f3f; color: #fff; transform: translateY(-66px); /* dark æ¨¡å¼åŒæ ·æŠ¬é«˜ */ } .number-highlight { color: var(--hover-text-color); /* æ•°å€¼é¢œè‰²ä¿®æ”¹ */ font-weight: 600; } 2. ğŸ—ºï¸ æ·»åŠ è®¿å®¢åœ°å›¾ âœ¨ åŠŸèƒ½ï¼šåœ¨å³ä¾§è¾¹æ æ·»åŠ è®¿å®¢åœ°å›¾ï¼Œå¯è§†åŒ–æ˜¾ç¤ºè®¿é—®æ¥æº ğŸ“Œ ä½ç½®ï¼šåœ¨æ ¹ç›®å½•./layouts/partials/sidebar/right.html æ·»åŠ åå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 {{- $scope := default \u0026#34;homepage\u0026#34; .Scope -}} {{- $context := .Context -}} {{- with (index .Context.Site.Params.widgets $scope) -}} \u0026lt;aside class=\u0026#34;sidebar right-sidebar sticky\u0026#34;\u0026gt; {{ range $widget := . }} {{ if templates.Exists (printf \u0026#34;partials/widget/%s.html\u0026#34; .type) }} {{ partial (printf \u0026#34;widget/%s\u0026#34; .type) (dict \u0026#34;Context\u0026#34; $context \u0026#34;Params\u0026#34; .params) }} {{ else }} {{ warnf \u0026#34;Widget %s not found\u0026#34; .type }} {{ end }} {{ end }} \u0026lt;div style=\u0026#34;height: 30%;width: 30%\u0026#34;\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; id=\u0026#34;clstr_globe\u0026#34; src=\u0026#34;//clustrmaps.com/globe.js?d=xxxxx\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/aside\u0026gt; {{ end }} 3. ğŸ–±ï¸ é¼ æ ‡æ ·å¼ âœ¨ åŠŸèƒ½ï¼šè‡ªå®šä¹‰é¼ æ ‡æŒ‡é’ˆæ ·å¼ï¼Œå¢å¼ºåšå®¢ä¸ªæ€§åŒ– ğŸ“Œ è¯´æ˜ï¼šå‡†å¤‡å¥½é¼ æ ‡æ ·å¼å›¾ç‰‡(é»˜è®¤ï¼ŒæŒ‡é’ˆï¼Œæ–‡æœ¬â€¦)ï¼Œå›¾ç‰‡å¤§å°å»ºè®®æ§åˆ¶åœ¨ 32px å·¦å³ï¼Œå°†.pngå›¾ç‰‡æ”¾å…¥static/mouseæ–‡ä»¶å¤¹ä¸‹(æ–‡ä»¶å¤¹è‡ªå·±åˆ›å»º)\nä¿®æ”¹å¯¹åº”çš„å›¾ç‰‡åå³å¯ ğŸ“Œ ä½ç½®ï¼šä¿®æ”¹./assets/scss/custom.scss(æ–‡ä»¶ä¸å­˜åœ¨åˆ™è‡ªå·±åˆ›å»º)ï¼Œå°†ä»¥ä¸‹ä»£ç å¤åˆ¶è¿›å»ï¼Œæ ¹æ®ä¸»é¢˜æŒ‰å®é™…æƒ…å†µå¡«å†™å¯¹åº”çš„cssé€‰æ‹©å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // ã€Stackä¸»é¢˜é¼ æ ‡æ ·å¼å†™æ³•ã€‘ // defaultå…‰æ ‡å›¾ç‰‡ body, html, .article-content img { cursor: url(../mouse/default.png), auto !important; } // pointerå…‰æ ‡å›¾ç‰‡ a:hover, button:hover, .copyCodeButton:hover, #dark-mode-toggle { cursor: url(../mouse/pointer.png), auto; } // textå…‰æ ‡å›¾ç‰‡ input:hover, .site-description, .article-subtitle, .article-content span, .article-content li, .article-content p { cursor: url(../mouse/text.png), auto; } /*ä¸»é¡µå¸ƒå±€é—´è·è°ƒæ•´*/ .main-container { gap: 50px; //æ–‡ç« å®½åº¦ @include respond(md) { padding: 0 30px; gap: 40px; //ä¸­ç­‰å±å¹•æ—¶çš„æ–‡ç« å®½åº¦ } } .related-contents { overflow-x: visible; //æ˜¾ç¤ºéšè—çš„å›¾æ ‡ padding-bottom: 15px; } 4. ğŸ‰ é¦–é¡µæ¬¢è¿æ¨ªå¹… âœ¨ åŠŸèƒ½ï¼šåœ¨é¦–é¡µé¡¶éƒ¨æ·»åŠ åŠ¨æ€æ¬¢è¿æ¨ªå¹…ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒ ğŸ“Œ ä½ç½®ï¼šåœ¨ ./layouts/index.htmlçš„ \u0026lt;section class=\u0026quot;article-list\u0026quot;\u0026gt; å‰æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!-- é¦–é¡µæ¬¢è¿å­—å¹… --\u0026gt; \u0026lt;div class=\u0026#34;welcome\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size: 2rem; text-align: center; font-weight: bold\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;shake\u0026#34;\u0026gt;ğŸ‘‹\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text1\u0026#34; \u0026gt; Welcome\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text2\u0026#34;\u0026gt; To \u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text3\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;Xa\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;jump-text4\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;l\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;jump-text5\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;a\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;jump-text6\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;o\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;jump-text7\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;k\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026#34;jump-text8\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;\u0026#39;s\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;jump-text9\u0026#34; style=\u0026#34;color:#e99312\u0026#34;\u0026gt;Blog\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- é¦–é¡µæ¬¢è¿å­—å¹… --\u0026gt; ğŸ“Œ ä½ç½®ï¼šåœ¨ ./assets/scss/custom.scss ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 // ----------------é¦–é¡µæ¬¢è¿æ¿å—æ ·å¼---------------- .welcome { color: var(--card-text-color-main); background: var(--card-background); box-shadow: var(--shadow-l2); border-radius: 30px; display: inline-block; } // ğŸ‘‹emojiå®ç°æ‘†åŠ¨æ•ˆæœ .shake { display: inline-block; animation: shake 1s; animation-duration: 1s; animation-timing-function: ease; animation-delay: 0s; animation-iteration-count: 1; animation-direction: normal; animation-fill-mode: none; animation-play-state: running; animation-name: shake; animation-timeline: auto; animation-range-start: normal; animation-range-end: normal; animation-delay: 2s; @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(45deg) scale(1.2); } 50% { transform: rotate(0) scale(1.2); } 75% { transform: rotate(45deg) scale(1.2); } 100% { transform: rotate(0); } } } // å®ç°å­—ç¬¦è·³åŠ¨åŠ¨ç”» .jump-text1 { display: inline-block; animation: jump 0.5s 1; } .jump-text2 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.1s; } .jump-text3 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.2s; } .jump-text4 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.3s; } .jump-text5 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.4s; } .jump-text6 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.5s; } .jump-text7 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.6s; } .jump-text8 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.7s; } .jump-text9 { display: inline-block; animation: jump 0.5s 1; animation-delay: 0.9s; } @keyframes jump { 0% { transform: translateY(0); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0); } } 5. ğŸ—‘ï¸ åˆ é™¤\u0026quot;ä½¿ç”¨ Hugo æ„å»º ä¸»é¢˜Stackç”±Jimmyè®¾è®¡\u0026quot;ç­‰å­—æ · âœ¨ åŠŸèƒ½ï¼šç§»é™¤é¡µè„šé»˜è®¤çš„ç‰ˆæƒä¿¡æ¯ï¼Œæ›¿æ¢ä¸ºè‡ªå®šä¹‰å†…å®¹ ğŸ“Œ ä½ç½®ï¼šåˆ é™¤æ‰./layout/partials/footer/footer.html åŸå…ˆçš„ä»£ç ï¼Œæ³¨æ„æ˜¯ é‡Œè¾¹çš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 {{- $ThemeVersion := \u0026#34;3.29.0\u0026#34; -}} \u0026lt;footer class=\u0026#34;site-footer\u0026#34;\u0026gt; \u0026lt;section class=\u0026#34;copyright\u0026#34;\u0026gt; \u0026amp;copy; {{ if and (.Site.Params.footer.since) (ne .Site.Params.footer.since (int (now.Format \u0026#34;2006\u0026#34;))) }} {{ .Site.Params.footer.since }} - {{ end }} {{ now.Format \u0026#34;2006\u0026#34; }} {{ default .Site.Title .Site.Copyright }} \u0026lt;/section\u0026gt; \u0026lt;!------------- ä»¥ä¸‹çš„åˆ é™¤æ‰ -------------\u0026gt; \u0026lt;section class=\u0026#34;powerby\u0026#34;\u0026gt; {{ with .Site.Params.footer.customText }} {{ . | safeHTML }} \u0026lt;br/\u0026gt; {{ end }} {{- $Generator := `\u0026lt;a href=\u0026#34;https://gohugo.io/\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt;Hugo\u0026lt;/a\u0026gt;` -}} {{- $Theme := printf `\u0026lt;b\u0026gt;\u0026lt;a href=\u0026#34;https://github.com/CaiJimmy/hugo-theme-stack\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34; data-version=\u0026#34;%s\u0026#34;\u0026gt;Stack\u0026lt;/a\u0026gt;\u0026lt;/b\u0026gt;` $ThemeVersion -}} {{- $DesignedBy := `\u0026lt;a href=\u0026#34;https://jimmycai.com\u0026#34; target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener\u0026#34;\u0026gt;Jimmy\u0026lt;/a\u0026gt;` -}} {{ T \u0026#34;footer.builtWith\u0026#34; (dict \u0026#34;Generator\u0026#34; $Generator) | safeHTML }} \u0026lt;br /\u0026gt; {{ T \u0026#34;footer.designedBy\u0026#34; (dict \u0026#34;Theme\u0026#34; $Theme \u0026#34;DesignedBy\u0026#34; $DesignedBy) | safeHTML }} {{ $articleCount := len .Site.RegularPages }} {{ $totalWordCount := 0 }} {{ range .Site.Pages }} {{ $totalWordCount = add $totalWordCount .WordCount }} {{ end }} \u0026lt;p\u0026gt;å‘å¸ƒäº† {{ $articleCount }} ç¯‡æ–‡ç«  | å…± {{$totalWordCount}} å­—\u0026lt;/p\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;!------------- ä»¥ä¸Šçš„åˆ é™¤æ‰ -------------\u0026gt; \u0026lt;/footer\u0026gt; 6. â¬†ï¸ æ·»åŠ ã€è¿”å›é¡¶éƒ¨ã€‘æŒ‰é’® âœ¨ åŠŸèƒ½ï¼šæ·»åŠ å¹³æ»‘æ»šåŠ¨è¿”å›é¡¶éƒ¨çš„æŒ‰é’®ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ“Œ æ­¥éª¤ï¼š è¿”å›é¡¶éƒ¨å›¾ç‰‡ï¼Œå¤åˆ¶ä»¥ä¸‹ä»£ç ä¿å­˜ä¸º backTop.svg æ–‡ä»¶,æ”¾åˆ° ./assets/icons/æ–‡ä»¶å¤¹ä¸‹(ä¸å­˜åœ¨åˆ™è‡ªè¡Œåˆ›å»º) 1 2 3 4 5 6 7 8 \u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;30\u0026#34; height=\u0026#34;30\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;#707070\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-arrow-up\u0026#34;\u0026gt; \u0026lt;path stroke=\u0026#34;none\u0026#34; d=\u0026#34;M0 0h24v24H0z\u0026#34; fill=\u0026#34;none\u0026#34;/\u0026gt; \u0026lt;path d=\u0026#34;M16 12l-4 -4l-4 4\u0026#34;/\u0026gt; \u0026lt;path d=\u0026#34;M12 16v-8\u0026#34;/\u0026gt; \u0026lt;path d=\u0026#34;M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z\u0026#34;/\u0026gt; \u0026lt;/svg\u0026gt; åˆ›å»º layouts/partials/footer/return.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç \nä¿®æ”¹åçš„ return.html åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ return.html\n1 {{ partial \u0026#34;footer/return.html\u0026#34; . }} è§£å†³ PJAX åˆ·æ–°é—®é¢˜ ğŸ“Œ ä½ç½®ï¼šç¼–è¾‘.\\layouts\\partials\\footer\\pjax.htmlæ–‡ä»¶ ã€‚pjax:complete äº‹ä»¶ä¸‹ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 // é‡æ–°åˆå§‹åŒ–è¿”å›é¡¶éƒ¨æŒ‰é’® topbar.hide(); initScrollTop(); äº”ã€ğŸ’¬ Hugo æ¥å…¥è¯„è®º 1ã€GitHub æ‰“å¼€è¯„è®º âœ¨ åŠŸèƒ½ï¼šå¯ç”¨GitHub Discussionsä½œä¸ºåšå®¢è¯„è®ºç³»ç»Ÿ ğŸ“Œ æ­¥éª¤ï¼šé¦–å…ˆè¿›å…¥ã€ GitHub ã€‘ï¼Œhugo åšå®¢é¡¹ç›®ä¸»é¡µ\u0026ndash;\u0026raquo;é¡¹ç›®è®¾ç½®\u0026ndash;\u0026raquo;æ‰¾åˆ°Discussions Loading 2ã€giscus é…ç½® âœ¨ åŠŸèƒ½ï¼šå®‰è£…å¹¶é…ç½®giscusè¯„è®ºç³»ç»Ÿ ğŸ“Œ æ­¥éª¤ï¼šåœ¨ github ä¸Šå®‰è£… ã€ giscus APP ã€‘ 3ã€GitHub åšå®¢é¡¹ç›®æ¥å…¥ giscus âœ¨ åŠŸèƒ½ï¼šå°†giscusä¸GitHubåšå®¢é¡¹ç›®è¿æ¥ ğŸ“Œ æ­¥éª¤ï¼š éšç€å®˜ç½‘çš„è¯´æ˜ä¸€æ­¥æ­¥é…ç½®ä¸‹å»ã€‚é…ç½®å®Œæˆåä¾¿å¯åœ¨ å¯ç”¨ giscus ä¸‹æ‰¾åˆ°éœ€è¦çš„ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script src=\u0026#34;https://giscus.app/client.js\u0026#34; data-repo=\u0026#34;meimolihan/meimolihan.github.io\u0026#34; data-repo-id=\u0026#34;R_kgDONpRkKg\u0026#34; data-category=\u0026#34;Announcements\u0026#34; data-category-id=\u0026#34;DIC_kwDONpRkKs4CmwSa\u0026#34; data-mapping=\u0026#34;pathname\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;bottom\u0026#34; data-theme=\u0026#34;dark\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; 4ã€ä¿®æ”¹ hugo ä¸»é…ç½®æ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šåœ¨Hugoé…ç½®ä¸­å¯ç”¨giscusè¯„è®ºç³»ç»Ÿ ğŸ“Œ ä½ç½®ï¼šæˆ‘ä½¿ç”¨çš„æ˜¯Hugoçš„stackä¸»é¢˜ï¼Œéœ€è¦åœ¨ config.yaml ä¸­è®¾ç½® 1 2 3 comments: enabled: true provider: giscus 5ã€å¼•å…¥ giscus-jsæ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šå°†giscus JavaScriptæ–‡ä»¶å¼•å…¥åˆ°ä¸»é¢˜ä¸­ ğŸ“Œ æ­¥éª¤ï¼šå°†stackä¸»é¢˜./themes/hugo-theme-stack/layouts/partials/comments/provider/giscus.htmlæ–‡ä»¶æ‹·è´è‡³./layouts/partials/comments/provider/ç›®å½•ä¸‹ (éœ€æ–°å»º) ç„¶åå°†giscus-jsä»£ç æ”¾åˆ°ä¸‹é¢çš„ä½ç½®ï¼š 6ã€æ–‡ç«  index.md æ‰“å¼€è¯„è®º âœ¨ åŠŸèƒ½ï¼šæ§åˆ¶æ¯ç¯‡æ–‡ç« æ˜¯å¦å¼€å¯è¯„è®ºåŠŸèƒ½ ğŸ“Œ ä½ç½®ï¼šfalse å…³é—­è¯„è®ºï¼Œtrue æ˜¾ç¤ºè¯„è®ºã€‚ 1 comments: true 7ã€å¼•å…¥ Pjax åçš„è¯„è®ºä¿®å¤ ä¿®æ”¹layouts/partials/comments/include.htmlï¼Œæ·»åŠ ä¸€ä¸ªå…ƒç´ æ ‡è¯†ï¼Œæ–¹ä¾¿åˆ¤æ–­æ–‡ç« æ˜¯å¦å¼€å¯äº†è¯„è®º 1 2 3 4 {{ if .Site.Params.comments.enabled }} ... \u0026lt;div class=\u0026#34;comment\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; {{ end }} åˆ›å»º layouts/partials/footer/giscusPjax.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 {{- with .Site.Params.comments.giscus -}} \u0026lt;div class=\u0026#34;js-Pjax\u0026#34;\u0026gt; \u0026lt;script\u0026gt; (function () { let comment = document.querySelector(\u0026#34;.comment\u0026#34;); if (!comment) { return } let script = document.createElement(\u0026#39;script\u0026#39;); script.src = \u0026#39;https://giscus.app/client.js\u0026#39;; script.crossOrigin = \u0026#39;anonymous\u0026#39;; script.setAttribute(\u0026#39;data-repo\u0026#39;,\u0026#34;meimolihan/meimolihan.github.io\u0026#34;); script.setAttribute(\u0026#39;data-repo-id\u0026#39;,\u0026#34;R_kgDONpRkKg\u0026#34;); script.setAttribute(\u0026#39;data-category\u0026#39;,\u0026#34;Announcements\u0026#34;); script.setAttribute(\u0026#39;data-category-id\u0026#39;,\u0026#34;DIC_kwDONpRkKs4CmwSa\u0026#34;); script.setAttribute(\u0026#39;data-mapping\u0026#39;,\u0026#34;pathname\u0026#34;); script.setAttribute(\u0026#39;data-strict\u0026#39;, 0 ); script.setAttribute(\u0026#39;data-reactions-enabled\u0026#39;, 1 ); script.setAttribute(\u0026#39;data-emit-metadata\u0026#39;, 0 ); script.setAttribute(\u0026#39;data-input-position\u0026#39;,\u0026#34;top\u0026#34;); script.setAttribute(\u0026#39;data-theme\u0026#39;,\u0026#34;light\u0026#34;); script.setAttribute(\u0026#39;data-lang\u0026#39;,\u0026#34;zh-CN\u0026#34;); script.setAttribute(\u0026#39;data-loading\u0026#39;, \u0026#39;lazy\u0026#39;) script.async = true; document.querySelector(\u0026#39;.site-footer\u0026#39;).before(script) })(document); \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt; {{- end -}} åœ¨layouts/partials/footer/custom.htmlï¼Œå¼•å…¥ giscusPjax.html 1 {{ partial \u0026#34;footer/giscusPjax.html\u0026#34; . }} é…ç½®å®Œæˆï¼Œhugo server -Då¯åŠ¨hugoï¼Œåœ¨æœ¬åœ°å°±å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚ å…­ã€ğŸŒ€ Hugo é¢„åŠ è½½åŠ¨ç”» 1ã€æ–°å¢ç»„ä»¶ âœ¨ åŠŸèƒ½ï¼šæ·»åŠ é¡µé¢åŠ è½½æ—¶çš„é¢„åŠ è½½åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ“Œ ä½ç½®ï¼šå°ç»„ä»¶æ”¾åœ¨layouts/partials/widget/preload.html æ–‡ä»¶é‡Œï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯è‡ªå·±åˆ›å»ºçš„ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 {{ if .Site.Params.enablePreloadingAnim }} \u0026lt;div id=\u0026#34;loading-box\u0026#34;\u0026gt; \u0026lt;!-- é¡µé¢åŠ è½½å®Œæˆä¹‹åå¸·å¹•æ‹‰å¼€çš„æ•ˆæœ --\u0026gt; \u0026lt;div class=\u0026#34;loading-left-bg\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;loading-right-bg\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;!-- æ—‹è½¬ç›’å­åŠ¨æ•ˆ --\u0026gt; \u0026lt;div class=\u0026#34;spinner-box\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;configure-border-1\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;configure-core\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;configure-border-2\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;configure-core\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;loading-word\u0026#34;\u0026gt;åŠ è½½ä¸­...\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- é¡µé¢åŠ è½½åŠ¨ç”» --\u0026gt; \u0026lt;script\u0026gt; // ç¡®ä¿ jQuery å·²åŠ è½½ if (typeof $ !== \u0026#39;function\u0026#39;) { console.error(\u0026#34;jQuery is not loaded. Please ensure jQuery is included in your project.\u0026#34;); } // ä½¿ç”¨ window.onload ç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆåéšè—åŠ¨ç”» window.addEventListener(\u0026#34;load\u0026#34;, function () { const loadingBox = document.getElementById(\u0026#39;loading-box\u0026#39;); if (loadingBox) { // å»¶æ—¶ä¸€æ®µæ—¶é—´ä»¥ç¡®ä¿åŠ¨ç”»æœ‰è¶³å¤Ÿçš„æ—¶é—´å±•ç¤º setTimeout(function () { loadingBox.classList.add(\u0026#34;loaded\u0026#34;); console.log(\u0026#34;Preloader hidden after all resources are loaded.\u0026#34;); }, 500); // å»¶æ—¶ 0.5 ç§’ï¼ˆå¯æ ¹æ®éœ€è¦è°ƒæ•´ï¼‰ } else { console.error(\u0026#34;Preloader element not found!\u0026#34;); } }); // å¦‚æœéœ€è¦æ˜¾ç¤ºåŠ è½½è¿›åº¦ï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹é€»è¾‘ï¼ˆå¯é€‰ï¼‰ let loadedResources = 0; const totalResources = document.images.length + document.styleSheets.length; function checkResourceLoad() { loadedResources++; const progress = Math.round((loadedResources / totalResources) * 100); const loadingWord = document.querySelector(\u0026#39;.loading-word\u0026#39;); if (loadingWord) { loadingWord.textContent = `åŠ è½½ä¸­... ${progress}%`; } if (loadedResources \u0026gt;= totalResources) { window.dispatchEvent(new Event(\u0026#39;load\u0026#39;)); // æ‰‹åŠ¨è§¦å‘ load äº‹ä»¶ } } // ç›‘å¬å›¾ç‰‡åŠ è½½ document.images.forEach(img =\u0026gt; { img.addEventListener(\u0026#39;load\u0026#39;, checkResourceLoad); img.addEventListener(\u0026#39;error\u0026#39;, checkResourceLoad); }); // ç›‘å¬æ ·å¼è¡¨åŠ è½½ document.styleSheets.forEach(sheet =\u0026gt; { checkResourceLoad(); }); \u0026lt;/script\u0026gt; {{ end }} 2ã€ç»„ä»¶æ ·å¼ âœ¨ åŠŸèƒ½ï¼šå®šä¹‰é¢„åŠ è½½åŠ¨ç”»çš„æ ·å¼å’ŒåŠ¨ç”»æ•ˆæœ ğŸ“Œ ä½ç½®ï¼šæ‰¾åˆ° ./assets/scss/custom.scss åœ¨æ–‡ä»¶é‡Œé¢è¿½åŠ  ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 #loading-box .loading-left-bg, #loading-box .loading-right-bg { position: fixed; z-index: 1000; width: 50%; height: 100%; // æˆ‘åœ¨è¿™é‡Œå°æ”¹äº†ä¸€ä¸‹é¢œè‰²ï¼Œ background-color: #b1c0c7; transition: all 0.5s; } #loading-box .loading-right-bg { right: 0; } #loading-box\u0026gt;.spinner-box { position: fixed; z-index: 1001; display: flex; justify-content: center; align-items: center; width: 100%; height: 100vh; } #loading-box .spinner-box .configure-border-1 { position: absolute; padding: 3px; width: 115px; height: 115px; background: #ffab91; animation: configure-clockwise 3s ease-in-out 0s infinite alternate; } #loading-box .spinner-box .configure-border-2 { left: -115px; padding: 3px; width: 115px; height: 115px; background: rgb(63, 249, 220); transform: rotate(45deg); animation: configure-xclockwise 3s ease-in-out 0s infinite alternate; } #loading-box .spinner-box .loading-word { position: absolute; color: #ffffff; // æˆ‘åœ¨è¿™é‡Œå°æ”¹äº†ä¸€ä¸‹æ–‡å­—å¤§å°å’Œå­—ä½“ï¼Œæ³¨æ„ï¼ font-size: 1.8rem; font-family: \u0026#39;Zhi Mang Xing\u0026#39;, cursive; } #loading-box .spinner-box .configure-core { width: 100%; height: 100%; background-color: #37474f; } div.loaded div.loading-left-bg { transform: translate(-100%, 0); } div.loaded div.loading-right-bg { transform: translate(100%, 0); } div.loaded div.spinner-box { // ä½ å¯ä»¥æŠŠè¿™ä¸ªæ³¨é‡Šæ‰ï¼Œè¿™æ ·å°±èƒ½ä¸€ç›´çœ‹é‚£ä¸ªåŠ¨ç”»çš„æ•ˆæœäº†ï¼ display: none !important; } @keyframes configure-clockwise { 0% { transform: rotate(0); } 25% { transform: rotate(90deg); } 50% { transform: rotate(180deg); } 75% { transform: rotate(270deg); } 100% { transform: rotate(360deg); } } @keyframes configure-xclockwise { 0% { transform: rotate(45deg); } 25% { transform: rotate(-45deg); } 50% { transform: rotate(-135deg); } 75% { transform: rotate(-225deg); } 100% { transform: rotate(-315deg); } } 3ã€é…ç½®æ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶é¢„åŠ è½½åŠ¨ç”»çš„å¼€å¯ä¸å…³é—­ ğŸ“Œ ä½ç½®ï¼šhugoé…ç½®æ–‡ä»¶params æ ç›®åº•ä¸‹ï¼ŒåŠ ä¸Š enablePreloadingAnim: true 1 2 params: enablePreloadingAnim: true # å¼€å±åŠ¨ç”»ï¼Œfalseä¸ºå…³é—­ï¼Œtrueä¸ºå¼€å¯ ä¸ƒã€ğŸ–¼ï¸ Hugo å›¾ç‰‡ç¯ç®± âœ¨ åŠŸèƒ½ï¼šä½¿ç”¨ Fancybox å®ç°å›¾ç‰‡ç¯ç®±/æ”¾å¤§åŠŸèƒ½ ğŸ“Œ è¯´æ˜ï¼šHugo è‡ªå¸¦çš„å›¾ç‰‡æ¸²æŸ“æ˜¯æ²¡æœ‰ç¯ç®±æ•ˆæœçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±æ·»åŠ ã€‚ç¯ç®±æ•ˆæœå°±æ˜¯ç‚¹å‡»å›¾ç‰‡åï¼Œå›¾ç‰‡ä¼šæ”¾å¤§æ˜¾ç¤ºã€‚ ä¿®æ”¹ Hugo é…ç½®æ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šåœ¨é…ç½®ä¸­å¯ç”¨å›¾ç‰‡ç¯ç®±åŠŸèƒ½ ğŸ“Œ ä½ç½®ï¼šä¿®æ”¹ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ config.toml æˆ–è€… config.yaml æ–‡ä»¶ï¼Œæˆ‘çš„é…ç½®æ–‡ä»¶ä¸º yaml æ ¼å¼ï¼Œtoml éœ€è¦è‡ªè¡Œè°ƒæ•´æ ¼å¼ï¼Œåœ¨ paramså‚æ•°ä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 params: fancybox: true # å›¾ç‰‡ç¯ç®±ï¼Œfalseä¸ºå…³é—­ï¼Œtrueä¸ºå¼€å¯ åˆ›å»º render-image.html æ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šåˆ›å»ºå›¾ç‰‡æ¸²æŸ“æ¨¡æ¿ï¼Œæ”¯æŒç¯ç®±æ•ˆæœ ğŸ“Œ ä½ç½®ï¼šåœ¨ä½ çš„ Hugo æ ¹ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸‹è·¯å¾„å’Œæ–‡ä»¶ï¼š./layouts/_default/_markup/render-image.html ç¼–è¾‘ render-image.html æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 4 5 6 7 {{if .Page.Site.Params.fancybox }} \u0026lt;div class=\u0026#34;post-img-view\u0026#34;\u0026gt; \u0026lt;a data-fancybox=\u0026#34;gallery\u0026#34; href=\u0026#34;{{ .Destination | safeURL }}\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;{{ .Destination | safeURL }}\u0026#34; alt=\u0026#34;{{ .Text }}\u0026#34; {{ with .Title}} title=\u0026#34;{{ . }}\u0026#34;{{ end }} /\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; {{ end }} å¤åˆ¶ custom.html æ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šå¼•å…¥Fancyboxæ‰€éœ€çš„CSSå’ŒJavaScriptæ–‡ä»¶ ğŸ“Œ ä½ç½®ï¼šä»ä½ ä¸»é¢˜ç›®å½• ./themes/stack/layouts/partials/footer/custom.htmlå¤åˆ¶åˆ° Hugoåœ¨ä½ æ ¹ç›®å½• layouts/partials/footer/custom.html ,æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 4 5 {{if .Page.Site.Params.fancybox }} \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css\u0026#34; /\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; {{ end }} æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥ hugo server -D çœ‹çœ‹æ•ˆæœäº†ã€‚\nå…«ã€âœ¨ å¼•å…¥åŠ¨æ€èƒŒæ™¯ âœ¨ åŠŸèƒ½ï¼šä¸ºåšå®¢æ·»åŠ åŠ¨æ€ç²’å­èƒŒæ™¯æ•ˆæœï¼Œå¢å¼ºè§†è§‰å¸å¼•åŠ› ğŸ“Œ æ¥æºï¼š è±ç‰¹é›·-letere ğŸ“Œ æ–‡æ¡£ï¼šã€ particles.jsæ–‡æ¡£ ã€‘ 1. å‰å¾€ã€é…ç½®é¡µé¢ã€‘é…ç½®å‚æ•° âœ¨ åŠŸèƒ½ï¼šè‡ªå®šä¹‰ç²’å­æ•ˆæœå‚æ•° ğŸ“Œ æ­¥éª¤ï¼šå‰å¾€ã€ é…ç½®é¡µé¢ ã€‘é…ç½®å‚æ•°ï¼Œå‚æ•°æŒ‰è‡ªå·±å–œå¥½å³å¯ï¼Œå”¯ä¸€æ³¨æ„è¦ä¿®æ”¹çš„å‚æ•°æ˜¯ detect_onï¼Œè¦æ”¹æˆ window 2. ä¸‹è½½é…ç½®æ–‡ä»¶ï¼Œä»¥åŠ particles.js æ‰€éœ€è¦çš„jsæ–‡ä»¶ âœ¨ åŠŸèƒ½ï¼šè·å–ç²’å­æ•ˆæœæ‰€éœ€çš„é…ç½®æ–‡ä»¶ ğŸ“Œ æ­¥éª¤ï¼šä¸‹è½½ã€ particlesjs-config.json ã€‘(Ctrl + S ä¿å­˜)ï¼Œæœ¬åšå®¢çš„åŠ¨æ€èƒŒæ™¯jsoné…ç½®ï¼Œæœ‰éœ€æ±‚çš„å¯ç›´æ¥ä¸‹è½½ 3. æŠŠä¸‹è½½å¥½çš„æ–‡ä»¶ï¼Œè§£å‹å¹¶å°†ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°assets/backgroundæ–‡ä»¶å¤¹ä¸‹ âœ¨ åŠŸèƒ½ï¼šæ”¾ç½®ç²’å­æ•ˆæœæ‰€éœ€æ–‡ä»¶ ğŸ“Œ æ–‡ä»¶ï¼š particlesjs-config.json particles.min.js 4. åœ¨layouts/partials/footer/custom.htmlä¸­ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  âœ¨ åŠŸèƒ½ï¼šåœ¨é¡µé¢ä¸­å¼•å…¥å¹¶åˆå§‹åŒ–ç²’å­æ•ˆæœ ğŸ“Œ ä½ç½®ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;div id=\u0026#34;particles-js\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script src={{ (resources.Get \u0026#34;background/particles.min.js\u0026#34;).Permalink }}\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; particlesJS.load(\u0026#39;particles-js\u0026#39;, {{ (resources.Get \u0026#34;background/particlesjs-config.json\u0026#34;).Permalink }}, function() { console.log(\u0026#39;particles.js loaded - callback\u0026#39;); }); \u0026lt;/script\u0026gt; \u0026lt;style\u0026gt; #particles-js { position: fixed; top: 0; left: 0; width: 100%; z-index: -1; } \u0026lt;/style\u0026gt; ä¹ã€ğŸ“Š åšå®¢æ–‡ç« æµè§ˆæ•°ç»Ÿè®¡ âœ¨ åŠŸèƒ½ï¼šå¼•å…¥ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œæ¥ç»™åšå®¢æ–‡ç« ç»Ÿè®¡æµè§ˆæ•° ğŸ“Œ å‰è¨€ï¼š åšå®¢æ–‡ç« ç»Ÿè®¡ç»„ä»¶ä¸ªäººæ‰¾åˆ°äº†ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ ä¸è’œå­ ï¼Œä»¥åŠ vercount ä¸è’œå­æ¯”è¾ƒè€ï¼Œä½†å¾ˆç¨³å®šï¼Œåˆ°ç°åœ¨ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œæ²¡æœ‰åœæœ vercountåˆ™æ¯”è¾ƒæ–°ï¼Œå¹¶åšäº†ä¸€äº›ä»£ç ä¼˜åŒ– ä¸¤ç§ä½¿ç”¨éƒ½åŸºæœ¬ä¸€æ ·ï¼Œå·®åˆ«ä¸å¤§ï¼Œçœ‹è‡ªå·±å–œå¥½ï¼Œä¸‹é¢çš„æ•™ç¨‹æ˜¯ä»¥vercountæ¥ä¸¾ä¾‹ï¼Œç”¨ä¸è’œå­çš„è¯ï¼Œå°±æŠŠå¯¹åº”çš„è„šæœ¬å’Œå…ƒç´ æ ‡ç­¾æ›¿æ¢ä¸€ä¸‹å°±å¥½ 1 åŸºæœ¬å¼•å…¥ ï¼ˆ1ï¼‰ä¿®æ”¹layouts/partials/footer/custom.htmlï¼ˆä¸å­˜åœ¨åˆ™è‡ªè¡Œåˆ›å»ºï¼‰ï¼Œå¼•å…¥è„šæœ¬ 1 \u0026lt;!-- vercountçš„è„šæœ¬ï¼›è‹¥ç”¨ä¸è’œå­ï¼Œåˆ™æ›´æ¢æˆä¸è’œå­çš„è„šæœ¬å°±å¥½ --\u0026gt; \u0026lt;script defer src=\u0026#34;https://cn.vercount.one/js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ï¼ˆ2ï¼‰å‡†å¤‡ä¸€å¼  æµè§ˆé‡ çš„icon(Ctrl+Sä¿å­˜)ï¼Œæ”¾åˆ°assets/iconsæ–‡ä»¶å¤¹ä¸‹\nï¼ˆ3ï¼‰ä¿®æ”¹layouts/article/components/details.htmlï¼Œåœ¨åˆé€‚çš„ä½ç½®ä¸‹åŠ å…¥ä»¥ä¸‹ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;div class=\u0026#34;article-details\u0026#34;\u0026gt; ... \u0026lt;footer class=\u0026#34;article-time\u0026#34;\u0026gt; ... \u0026lt;!-- æµè§ˆé‡ç»Ÿè®¡ --\u0026gt; \u0026lt;div id=\u0026#34;viewCount\u0026#34;\u0026gt; {{ partial \u0026#34;helper/icon\u0026#34; \u0026#34;eye\u0026#34; }} \u0026lt;time class=\u0026#34;article-time--reading\u0026#34;\u0026gt; \u0026lt;!-- vercountç»Ÿè®¡å½“å‰é¡µé¢æµè§ˆæ•°çš„æ ‡ç­¾ï¼›è‹¥ç”¨ä¸è’œå­ï¼Œæ›´æ¢æˆä¸è’œå­å¯¹åº”çš„æ ‡ç­¾å°±å¥½ --\u0026gt; \u0026lt;span id=\u0026#34;vercount_value_page_pv\u0026#34;\u0026gt;loading... \u0026lt;/span\u0026gt;æ¬¡ \u0026lt;/time\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/footer\u0026gt; ... \u0026lt;/div\u0026gt; ï¼ˆ4ï¼‰è¿™æ ·æ–‡ç« è¯¦æƒ…çš„å¼€å¤´å°±æ˜¾ç¤ºæµè§ˆæ•°äº† 2 é—®é¢˜ä¿®å¤ é—®é¢˜æè¿°ï¼š åšå®¢é¦–é¡µçš„æ–‡ç« åˆ—è¡¨æ˜¾ç¤ºäº†æµè§ˆæ•°ï¼Œä¸”åªæœ‰ç¬¬ä¸€ç¯‡æ–‡ç« æ‰æœ‰æµè§ˆæ•°ï¼Œå¹¶ä¸”æµè§ˆæ•°çš„æ•°å­—ä¸æ­£ç¡® ]( https://letere-gzj.github.io/hugo-stack/p/hugo/view-count/ ç»Ÿè®¡ä¿®å¤1.png)\näº§ç”ŸåŸå› ï¼š\nlayouts/partials/article/components/details.htmlæ­¤htmlæ–‡ä»¶ä¹Ÿè¢«ç”¨åœ¨äº†åšå®¢é¦–é¡µçš„æ–‡ç« åˆ—è¡¨ï¼Œæ‰€ä»¥ä¹Ÿè§¦å‘äº†vercountè¯»å–å½“å‰é¡µé¢çš„æµè§ˆæ•° å› ä¸ºè¯»å–çš„æ•°æ®æ˜¯å½“å‰é¡µé¢çš„æµè§ˆæ•°ï¼Œä¹Ÿå°±æ˜¯é¦–é¡µçš„æµè§ˆæ•°ï¼Œå¹¶éæ–‡ç« çš„æµè§ˆæ•°ï¼Œæ‰€ä»¥æ•°æ®åªåŠ è½½ä¸€æ¬¡ï¼Œä¸”ä¸å‡†ç¡® è§£å†³æ€è·¯ï¼š\nç”±äºvercountå¹¶æœªæä¾›åªæŸ¥è¯¢æ–‡ç« æµè§ˆæ•°çš„æ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ç« æµè§ˆæ•°+1ï¼Œå¹¶ä¸”è¿”å›æµè§ˆæ•°çš„æ¥å£ï¼Œæ‰€ä»¥æ— æ³•å®ç°é¦–é¡µå¯¹æ¯ç¯‡æ–‡ç« çš„æµè§ˆæ•°çš„å•ç‹¬æŸ¥è¯¢ æ—¢ç„¶æ— æ³•å®ç°é¦–é¡µå±•ç¤ºæ¯ç¯‡æ–‡ç« çš„å•ç‹¬æµè§ˆæ•°ï¼Œé‚£å°±ç›´æ¥éšè—å°±å¥½äº†ï¼Œç­‰ç‚¹å…¥æ–‡ç« æ‰çœ‹åˆ°å…·ä½“çš„æµè§ˆæ•° å…·ä½“æ“ä½œï¼š\nï¼ˆ1ï¼‰ä¿®æ”¹layouts/partials/footer/custom.htmlï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;script\u0026gt; function showHideView() { // åˆ¤æ–­æ˜¯å¦å­˜åœ¨vercountæ ‡ç­¾ let viewCounts = document.querySelectorAll(\u0026#34;#viewCount\u0026#34;); if (viewCounts) { // åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ç« é¡µ let article = document.querySelector(\u0026#34;.article-page\u0026#34;); if (!article) { viewCounts.forEach(ele =\u0026gt; { ele.style.display = \u0026#39;none\u0026#39;; }); } } } showHideView(); \u0026lt;/script\u0026gt; 3ã€å¼•å…¥ Pjax åæµè§ˆæ•°ä¿®å¤ åˆ›å»º layouts/partials/footer/vercountPjax.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;div class=\u0026#34;js-Pjax\u0026#34;\u0026gt; \u0026lt;script\u0026gt; (function() { let script = document.createElement(\u0026#39;script\u0026#39;); script.defer = true; script.src = \u0026#34;https://cn.vercount.one/js\u0026#34;; let footer = document.querySelector(\u0026#34;footer\u0026#34;) if (footer) { showHideView() footer.appendChild(script); } })(document) function showHideView() { let viewCounts = document.querySelectorAll(\u0026#34;#viewCount\u0026#34;); if (viewCounts) { const style = document.querySelector(\u0026#34;.article-page\u0026#34;) ? \u0026#39;\u0026#39; : \u0026#39;none\u0026#39;; viewCounts.forEach(ele =\u0026gt; { ele.style.display = style; } ) } } \u0026lt;/script\u0026gt; \u0026lt;/div\u0026gt; åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ vercountPjax.html 1 {{ partial \u0026#34;footer/vercountPjax.html\u0026#34; . }} å¦‚æœå«Œéº»çƒ¦ï¼Œæµè§ˆæ•°ç»Ÿè®¡å¯ä»¥å’Œæ›´æ–°æ—¶é—´ä¸€æ ·ï¼Œæ”¾åˆ°æ–‡ç« æœ«å°¾å°±å¥½ï¼Œå°±ä¸ä¼šæ˜¾ç¤ºåˆ°é¦–é¡µä¸Šäº† å…·ä½“ä¿®æ”¹layouts/partials/article/footer.htmlå°±å¥½ï¼Œçœ‹ä¸ªäººå–œå¥½å§ åã€ğŸ’ƒ åšå®¢å¼•å…¥çœ‹æ¿å¨˜ åˆ›å»º layouts/partials/footer/live2d-v3.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  ä¿®æ”¹åçš„ live2d-v3.html åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ live2d-v3.html 1 {{ partial \u0026#34;footer/live2d-v3.html\u0026#34; . }} åä¸€ã€ğŸ”¤ ä¿®æ”¹åšå®¢å­—ä½“ 1. ä¸‹è½½å­—ä½“ å­—ä½“å¤©ä¸‹ï¼š https://www.fonts.net.cn/font-32027849465.html è°·æ­Œå­—ä½“ï¼š http://www.googlefonts.net/chinese æŠŠå­—ä½“æ–‡ä»¶æ”¾å…¥assets/fontä¸‹(æ–‡ä»¶å¤¹è‡ªå·±åˆ›å»º) å­—ä½“æ ¼å¼ç¤ºä¾‹ï¼šZhuZiAWan-2.ttc æˆ– ZhuZiAWan-2.ttf 2. å¼•å…¥å­—ä½“ åˆ›å»º layouts/partials/footer/font.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 \u0026lt;style\u0026gt; @font-face { font-family: \u0026#39;å­—ä½“å\u0026#39;; src: url({{ (resources.Get \u0026#34;font/å­—ä½“æ–‡ä»¶å\u0026#34;).Permalink }}) format(\u0026#39;truetype\u0026#39;); } :root { --base-font-family: \u0026#39;å­—ä½“å\u0026#39;; --code-font-family: \u0026#39;å­—ä½“å\u0026#39;; } \u0026lt;/style\u0026gt; åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ font.html 1 {{ partial \u0026#34;footer/font.html\u0026#34; . }} åäºŒã€ğŸŸ åšå®¢å¼•å…¥é£é±¼é¡µè„š åˆ›å»º layouts/partials/footer/fish.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  ä¿®æ”¹åçš„ fish.html åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ fish.html 1 {{ partial \u0026#34;footer/fish.html\u0026#34; . }} åä¸‰ã€ğŸ“‹ å¤åˆ¶å¼¹çª— åˆ›å»º layouts/partials/footer/copy.html ï¼Œå¼•å…¥ä»¥ä¸‹ä»£ç  ä¿®æ”¹åçš„ fish.html åœ¨ layouts/partials/footer/custom.html ä¸­å¼•å…¥ copy.html 1 {{ partial \u0026#34;footer/copy.html\u0026#34; . }} ","date":"2025-09-17T16:31:57+08:00","image":"https://file.meimolihan.eu.org/img/hugo-stack-01.webp","permalink":"https://blog.meimolihan.eu.org/p/51052943/","title":"Hugo + Stack ä¸»é¢˜ç¾åŒ–æŒ‡å— ğŸ¨"},{"content":"Halo to Hugo æ–‡ç« è¿ç§»å·¥å…· ğŸ“¦ ğŸš€ ä¸€æ¬¾ä¸“ä¸ºåšå®¢è¿ç§»è®¾è®¡çš„æ™ºèƒ½å·¥å…·ï¼Œå¯å°† Halo æ–‡ç« çš„ Front Matter æ ¼å¼å®Œç¾è½¬æ¢ä¸º Hugo å…¼å®¹æ ¼å¼ï¼Œè®©æ‚¨çš„åšå®¢è¿ç§»è¿‡ç¨‹æ›´åŠ é¡ºç•…é«˜æ•ˆï¼\nğŸ’¡ åŸºäºä¼˜ç§€å¼€æºé¡¹ç›®äºŒæ¬¡å¼€å‘ï¼Œæºè‡ªï¼š https://github.com/ayuayue/hexo2hugo ğŸ“‹ å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ“š ä½¿ç”¨æŒ‡å— ğŸ”§ æŠ€æœ¯ç»†èŠ‚ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ› å¸¸è§é—®é¢˜ ğŸ’» å¼€å‘æŒ‡å— âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ”„ æ ¼å¼è½¬æ¢ï¼šè‡ªåŠ¨å°† Halo çš„ Front Matter è½¬æ¢ä¸º Hugo å…¼å®¹æ ¼å¼ ğŸ“… æ—¥æœŸå¤„ç†ï¼šæ™ºèƒ½è½¬æ¢æ—¥æœŸæ ¼å¼å¹¶æ·»åŠ æ—¶åŒºä¿¡æ¯ ğŸ·ï¸ æ ‡ç­¾åˆ†ç±»ï¼šå®Œç¾å¤„ç† tags å’Œ categories å­—æ®µ ğŸ›¡ï¸ å®‰å…¨ç¬¬ä¸€ï¼šåˆ›å»ºç‹¬ç«‹è¾“å‡ºç›®å½•ï¼Œä¸ä¿®æ”¹åŸå§‹æ–‡ä»¶ ğŸ“ å†…å®¹ä¿ç•™ï¼šä¿æŒæ–‡ç« æ­£æ–‡å†…å®¹å®Œå…¨ä¸å˜ âš™ï¸ çµæ´»æ‰©å±•ï¼šæ”¯æŒè‡ªå®šä¹‰æ·»åŠ å…¶ä»– Front Matter å­—æ®µ ğŸ“š ä½¿ç”¨æŒ‡å— ğŸš€ å¿«é€Ÿå¼€å§‹ 1 2 3 # å…‹éš†é¡¹ç›®åˆ°æœ¬åœ° git clone git@github.com:meimolihan/halo_to_hugo.git cd halo_to_hugo è¯¦ç»†æ­¥éª¤ å‡†å¤‡æµ‹è¯•ç¯å¢ƒ ğŸ“‚\n1 2 3 # åˆ›å»ºæµ‹è¯•ç›®å½•å¹¶å¤åˆ¶ä¸€äº›æ–‡ç«  mkdir test cp ~/your-halo-blog/content/posts/*.md test/ æ‰§è¡Œè½¬æ¢ âš¡\n1 2 # è¿è¡Œè½¬æ¢å·¥å…· go run main.go test éªŒè¯ç»“æœ âœ…\n1 2 3 4 5 # æŸ¥çœ‹è½¬æ¢åçš„æ–‡ä»¶ ls -la newPost$(date +%s)/ # æ£€æŸ¥å•ä¸ªæ–‡ä»¶å†…å®¹ head -n 20 newPost1701319905/your-post.md åº”ç”¨åˆ°æ­£å¼ç¯å¢ƒ ğŸš€\n1 2 3 4 5 6 7 8 9 # å°†è½¬æ¢åçš„æ–‡ç« ç§»åŠ¨åˆ°Hugoç›®å½• mv newPost1701319905/* ~/your-hugo-site/content/posts/ # é’ˆå¯¹æ­£å¼ç›®å½•æ‰§è¡Œ go run main.go ~/your-hugo-site/content/posts/ # è¿è¡ŒHugoæµ‹è¯•ç”Ÿæˆ cd ~/your-hugo-site hugo server -D ğŸ¯ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² å®Œæ•´è¿ç§»æµç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. å¤‡ä»½åŸå§‹æ•°æ®ï¼ˆé‡è¦ï¼ï¼‰ tar -czf halo-backup-$(date +%Y%m%d).tar.gz ~/your-halo-blog/ # 2. æ‰§è¡Œè½¬æ¢ go run main.go ~/your-halo-blog/content/posts/ # 3. éƒ¨ç½²åˆ°Hugo mv newPost1701319905/* ~/your-hugo-site/content/posts/ # 4. ç”Ÿæˆé™æ€ç«™ç‚¹ cd ~/your-hugo-site hugo --minify # 5. éªŒè¯ç”Ÿæˆç»“æœ ls -la public/ å¢é‡è¿ç§»ç­–ç•¥\n1 2 3 # åªå¤„ç†æ–°å¢æˆ–ä¿®æ”¹çš„æ–‡ç«  find ~/your-halo-blog/content/posts/ -name \u0026#34;*.md\u0026#34; -newer last_migration.txt | xargs -I {} cp {} ./incremental_posts/ go run main.go ./incremental_posts/ ğŸ”§ æŠ€æœ¯ç»†èŠ‚ æ”¯æŒçš„ Front Matter è½¬æ¢ Halo å­—æ®µ Hugo å­—æ®µ è½¬æ¢è¯´æ˜ title title æ·»åŠ å¼•å·åŒ…è£¹ date date è½¬æ¢ä¸º ISO8601 æ ¼å¼å¹¶æ·»åŠ æ—¶åŒº excerpt description ç›´æ¥æ˜ å°„ cover image ç›´æ¥æ˜ å°„ tags tags æ”¯æŒå­—ç¬¦ä¸²å’Œåˆ—è¡¨ä¸¤ç§æ ¼å¼ categories categories æ”¯æŒå­—ç¬¦ä¸²å’Œåˆ—è¡¨ä¸¤ç§æ ¼å¼ permalink slug æå–æœ€åéƒ¨åˆ†ä½œä¸ºslug è½¬æ¢ç¤ºä¾‹ è½¬æ¢å‰ (Haloæ ¼å¼):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 --- title: Halo to Hugo è¿ç§»å·¥å…· id: 770a1b63-4737-4e87-a0d8-b8b38a3f7b6a date: 2025-08-26 16:39:39 auther: admin cover: https://example.com/image.webp excerpt: Halo to Hugo è¿ç§»å·¥å…·ï¼šæ— ç¼è½¬æ¢æ–‡ç«  Front Matter permalink: /archives/5uaPaEJk categories: - Halo - Hugo tags: - blog --- è½¬æ¢å (Hugoæ ¼å¼):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 --- title: \u0026#34;Halo to Hugo è¿ç§»å·¥å…·\u0026#34; date: 2025-08-26T16:39:39+08:00 description: \u0026#34;Halo to Hugo è¿ç§»å·¥å…·ï¼šæ— ç¼è½¬æ¢æ–‡ç«  Front Matter\u0026#34; draft: false weight: 0 image: \u0026#34;https://example.com/image.webp\u0026#34; categories: - Halo - Hugo tags: - blog slug: \u0026#34;5uaPaEJk\u0026#34; --- ğŸ“ æ–‡ä»¶ç»“æ„å¤„ç† å¯é€‰æ“ä½œï¼šHugo æ ‡å‡†ç›®å½•ç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. ä¸ºæ¯ç¯‡æ–‡ç« åˆ›å»ºç‹¬ç«‹ç›®å½• for %F in (\u0026#34;*.md\u0026#34;) do @md \u0026#34;%~nF\u0026#34; 2\u0026gt;nul \u0026amp; move /Y \u0026#34;%F\u0026#34; \u0026#34;%~nF\\\u0026#34; # 2. ç»Ÿä¸€é‡å‘½åä¸º index.mdï¼ˆHugoæ ‡å‡†ï¼‰ for /r %F in (*.md) do @if /i not \u0026#34;%~nF\u0026#34;==\u0026#34;index\u0026#34; ren \u0026#34;%F\u0026#34; \u0026#34;index.md\u0026#34; # æœ€ç»ˆç»“æ„ç¤ºä¾‹ï¼š # content/ # â””â”€â”€ posts/ # â”œâ”€â”€ post-1/ # â”‚ â””â”€â”€ index.md # â”œâ”€â”€ post-2/ # â”‚ â””â”€â”€ index.md # â””â”€â”€ post-3/ # â””â”€â”€ index.md âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ’¾ æ•°æ®å®‰å…¨ç¬¬ä¸€ é‡è¦æé†’ï¼šå§‹ç»ˆåœ¨æ“ä½œå‰å¤‡ä»½åŸå§‹æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ æµ‹è¯•å…ˆè¡Œï¼šå…ˆåœ¨æµ‹è¯•ç›®å½•éªŒè¯è½¬æ¢ç»“æœï¼Œç¡®è®¤æ— è¯¯åå†åº”ç”¨åˆ°æ­£å¼ç¯å¢ƒ åˆ†æ‰¹å¤„ç†ï¼šå¯¹äºå¤§é‡æ–‡ç« ï¼Œå»ºè®®åˆ†æ‰¹è¿ç§»ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ ğŸ” è½¬æ¢å‰æ£€æŸ¥ æ–‡ä»¶ç¼–ç ï¼šç¡®ä¿åŸå§‹æ–‡ä»¶ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œé¿å…ä¹±ç é—®é¢˜ æ ¼å¼è§„èŒƒï¼šç¡®è®¤ Halo æ–‡ç« ä½¿ç”¨æ ‡å‡† YAML Front Matter æ ¼å¼ ç‰¹æ®Šå­—ç¬¦ï¼šæ£€æŸ¥æ ‡é¢˜å’Œæè¿°ä¸­æ˜¯å¦åŒ…å«éœ€è¦è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦ å›¾ç‰‡èµ„æºï¼šéªŒè¯å°é¢å›¾é“¾æ¥æ˜¯å¦æœ‰æ•ˆï¼Œæ˜¯å¦éœ€è¦è¿ç§»å›¾åºŠ ğŸ› ï¸ è‡ªå®šä¹‰é…ç½® æ—¶åŒºè®¾ç½®ï¼šå¦‚éœ€ä¿®æ”¹é»˜è®¤æ—¶åŒºï¼Œå¯è°ƒæ•´æºç ä¸­çš„ Asia/Shanghai å­—æ®µæ‰©å±•ï¼šå¦‚éœ€è½¬æ¢å…¶ä»– Front Matter å­—æ®µï¼Œå¯è‡ªè¡Œä¿®æ”¹è½¬æ¢é€»è¾‘ è¾“å‡ºæ ¼å¼ï¼šæ”¯æŒè°ƒæ•´æ—¥æœŸæ ¼å¼ã€ç¼©è¿›ç­‰è¾“å‡ºå‚æ•° ğŸ“ è¿ç§»åéªŒè¯ å†…å®¹å®Œæ•´æ€§ï¼šéšæœºæŠ½æŸ¥å¤šç¯‡æ–‡ç« ï¼Œç¡®è®¤æ­£æ–‡å†…å®¹æ— ä¸¢å¤± Front Matterï¼šæ£€æŸ¥æ‰€æœ‰å¿…è¦å­—æ®µæ˜¯å¦æ­£ç¡®è½¬æ¢ é“¾æ¥æœ‰æ•ˆæ€§ï¼šæµ‹è¯•æ–‡ç« æ°¸ä¹…é“¾æ¥æ˜¯å¦æ­£å¸¸è·³è½¬ åˆ†ç±»æ ‡ç­¾ï¼šç¡®è®¤åˆ†ç±»ä½“ç³»å’Œæ ‡ç­¾äº‘æ˜¾ç¤ºæ­£å¸¸ ğŸ› å¸¸è§é—®é¢˜ ğŸ”§ è½¬æ¢ç›¸å…³é—®é¢˜ Q: è½¬æ¢åæ–‡ç« å†…å®¹å‡ºç°ä¹±ç æ€ä¹ˆåŠï¼Ÿ\nA: è¿™é€šå¸¸æ˜¯ç”±äºæ–‡ä»¶ç¼–ç é—®é¢˜å¯¼è‡´çš„ã€‚è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š\n1 2 3 4 5 # æ£€æŸ¥æ–‡ä»¶ç¼–ç  file -i your-post.md # è½¬æ¢ç¼–ç ä¸º UTF-8 iconv -f GBK -t UTF-8 your-post.md \u0026gt; your-post-utf8.md Q: æŸäº›ç‰¹æ®Šå­—æ®µæ²¡æœ‰è½¬æ¢æ€ä¹ˆåŠï¼Ÿ\nA: å·¥å…·ç›®å‰æ”¯æŒå¸¸è§å­—æ®µè½¬æ¢ã€‚å¦‚éœ€æ·»åŠ è‡ªå®šä¹‰å­—æ®µï¼Œå¯ä»¥ï¼š\nä¿®æ”¹ convertFrontMatter å‡½æ•° æ·»åŠ å¯¹åº”çš„å­—æ®µæ˜ å°„é€»è¾‘ é‡æ–°ç¼–è¯‘å·¥å…· Q: è½¬æ¢åçš„æ—¥æœŸæ—¶åŒºä¸æ­£ç¡®æ€ä¹ˆåŠï¼Ÿ\nA: ä¿®æ”¹æºç ä¸­çš„æ—¶åŒºè®¾ç½®ï¼š\n1 2 3 4 // æ‰¾åˆ°è¿™è¡Œä»£ç ï¼Œä¿®æ”¹ä¸ºæ‚¨çš„æ—¶åŒº location, _ := time.LoadLocation(\u0026#34;Asia/Shanghai\u0026#34;) // ä¾‹å¦‚æ”¹ä¸ºï¼š location, _ := time.LoadLocation(\u0026#34;America/New_York\u0026#34;) ğŸš€ ä½¿ç”¨ç›¸å…³é—®é¢˜ Q: å·¥å…·æç¤º \u0026ldquo;ç›®å½•ä¸å­˜åœ¨\u0026rdquo; é”™è¯¯ï¼Ÿ\nA: è¯·æ£€æŸ¥ï¼š\nç›®å½•è·¯å¾„æ˜¯å¦æ­£ç¡® æ˜¯å¦å…·æœ‰è¯¥ç›®å½•çš„è¯»å–æƒé™ è·¯å¾„ä¸­æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ Q: è½¬æ¢è¿‡ç¨‹ä¸­ç¨‹åºå´©æºƒæ€ä¹ˆåŠï¼Ÿ\nA: è¿™å¯èƒ½æ˜¯ç”±äºæŸç¯‡æ–‡ç« æ ¼å¼å¼‚å¸¸å¯¼è‡´çš„ï¼š\næŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå®šä½é—®é¢˜æ–‡ä»¶ æ‰‹åŠ¨ä¿®å¤è¯¥æ–‡ä»¶çš„ Front Matter æ ¼å¼ é‡æ–°è¿è¡Œè½¬æ¢å·¥å…· Q: å¦‚ä½•åªè½¬æ¢éƒ¨åˆ†æ–‡ç« ï¼Ÿ\nA: å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š\n1 2 3 4 # åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œå¤åˆ¶éœ€è¦è½¬æ¢çš„æ–‡ç«  mkdir temp_posts cp /path/to/specific/posts/*.md temp_posts/ go run main.go temp_posts ğŸ“Š Hugo é›†æˆé—®é¢˜ Q: è¿ç§»å Hugo ç”Ÿæˆå¤±è´¥ï¼Ÿ\nA: æ£€æŸ¥å¯èƒ½çš„ Front Matter é—®é¢˜ï¼š\n1 2 3 4 5 # ä½¿ç”¨ Hugo æ£€æŸ¥è¯­æ³• hugo --verbose # æ£€æŸ¥å…·ä½“çš„é”™è¯¯ä¿¡æ¯ hugo server 2\u0026gt;\u0026amp;1 | grep -i error Q: åˆ†ç±»å’Œæ ‡ç­¾åœ¨ Hugo ä¸­æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ\nA: ç¡®è®¤ Hugo é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç±»è®¾ç½®ï¼š\n1 2 3 4 # config.toml ä¸­çš„ç›¸å…³é…ç½® [taxonomies] category = \u0026#34;categories\u0026#34; tag = \u0026#34;tags\u0026#34; ğŸ’» å¼€å‘æŒ‡å— ğŸ—ï¸ é¡¹ç›®ç»“æ„æ¦‚è§ˆ 1 2 3 4 5 6 7 halo_to_hugo/ â”œâ”€â”€ main.go # ä¸»ç¨‹åºå…¥å£ â”œâ”€â”€ go.mod # æ¨¡å—å®šä¹‰ â”œâ”€â”€ README.md # é¡¹ç›®è¯´æ˜ â””â”€â”€ examples/ # ç¤ºä¾‹æ–‡ä»¶ â”œâ”€â”€ input/ # è¾“å…¥ç¤ºä¾‹ â””â”€â”€ output/ # è¾“å‡ºç¤ºä¾‹ ğŸ”§ æ ¸å¿ƒå‡½æ•°è§£æ ä¸»è½¬æ¢å‡½æ•° convertFrontMatter\n1 2 // ä¸»è¦è´Ÿè´£ Front Matter çš„è§£æå’Œè½¬æ¢ // æ”¯æŒå­—æ®µæ˜ å°„ã€æ—¥æœŸå¤„ç†ã€æ ‡ç­¾æ ‡å‡†åŒ–ç­‰ æ—¥æœŸå¤„ç†å‡½æ•° convertDate\n1 2 3 // åŠŸèƒ½ï¼šå¤šç§æ—¥æœŸæ ¼å¼è§£æå’Œæ—¶åŒºå¤„ç† // è¾“å…¥ï¼šåŸå§‹æ—¥æœŸå­—ç¬¦ä¸² // è¾“å‡ºï¼šISO8601 æ ¼å¼çš„æ—¥æœŸå­—ç¬¦ä¸² æ ‡ç­¾å¤„ç†å‡½æ•° convertToStringSlice\n1 2 3 // åŠŸèƒ½ï¼šç»Ÿä¸€ tags/categories å­—æ®µæ ¼å¼ // æ”¯æŒï¼šå­—ç¬¦ä¸²é€—å·åˆ†éš” â†’ åˆ—è¡¨è½¬æ¢ // æ”¯æŒï¼šå·²æœ‰åˆ—è¡¨æ ¼å¼çš„æ ‡å‡†åŒ– ğŸ¯ æ‰©å±•å¼€å‘æŒ‡å— æ·»åŠ æ–°å­—æ®µè½¬æ¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 func convertFrontMatter(original map[string]interface{}) map[string]interface{} { newFrontMatter := make(map[string]interface{}) // ç°æœ‰è½¬æ¢é€»è¾‘... // æ·»åŠ è‡ªå®šä¹‰å­—æ®µè½¬æ¢ if customField, exists := original[\u0026#34;custom_field\u0026#34;]; exists { newFrontMatter[\u0026#34;hugo_custom_field\u0026#34;] = customField } return newFrontMatter } ä¿®æ”¹è¾“å‡ºæ ¼å¼ï¼š\n1 2 3 4 5 // è°ƒæ•´æ—¥æœŸè¾“å‡ºæ ¼å¼ func formatDate(t time.Time) string { // è‡ªå®šä¹‰æ ¼å¼ return t.Format(\u0026#34;2006-01-02 15:04:05 -0700\u0026#34;) } ğŸ¤ è´¡çŒ®æŒ‡å— æ¬¢è¿æäº¤ Pull Request å’Œ Issueï¼å‚ä¸å¼€å‘æ—¶è¯·æ³¨æ„ï¼š\nä»£ç è§„èŒƒï¼šéµå¾ª Go è¯­è¨€æ ‡å‡†ä»£ç æ ¼å¼ æµ‹è¯•è¦†ç›–ï¼šæ–°å¢åŠŸèƒ½è¯·æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹ æ–‡æ¡£æ›´æ–°ï¼šä¿®æ”¹åŠŸèƒ½æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£è¯´æ˜ å…¼å®¹æ€§ï¼šç¡®ä¿æ”¹åŠ¨ä¸å½±å“ç°æœ‰çš„è½¬æ¢é€»è¾‘ ğŸ” è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 # å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡º go run main.go -verbose test_posts # è°ƒè¯•å•ç¯‡æ–‡ç«  go run main.go -debug single_post.md # æ€§èƒ½åˆ†æ go run main.go -profile test_posts ğŸ‰ è¿ç§»æ„‰å¿«ï¼ å¸Œæœ›è¿™ä¸ªå·¥å…·èƒ½è®©æ‚¨çš„åšå®¢è¿ç§»è¿‡ç¨‹æ›´åŠ é¡ºåˆ©ï¼\nğŸ“® å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ GitHub é¡¹ç›®ä¸­æå‡º Issue æˆ– Pull Requestï¼\nâ­ å¦‚æœè§‰å¾—å·¥å…·å¥½ç”¨ï¼Œåˆ«å¿˜äº†ç»™é¡¹ç›®ç‚¹ä¸ª Star æ”¯æŒä¸€ä¸‹ï¼\n","date":"2025-09-17T16:13:52+08:00","image":"https://file.meimolihan.eu.org/img/halo-to-hugo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0be9da75/","title":"Halo to Hugo æ–‡ç« è¿ç§»å·¥å…· ğŸ“¦"},{"content":"Linux å­ç›®å½•åˆ†ç¦»å¤‡ä»½ä¸è§£å‹ \u0026amp; äº¤äº’å¼ğŸ“¦ æœ¬æ–‡æ¡£æä¾›ä¸€ç³»åˆ—ç”¨äºæ–‡ä»¶å‹ç¼©ä¸è§£å‹çš„ Bash è„šæœ¬ï¼Œæ”¯æŒ ZIP å’Œ TAR.GZ æ ¼å¼ï¼Œå¯è‡ªåŠ¨åŒ–å¤„ç†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸å­ç›®å½•ã€‚æ‰€æœ‰è„šæœ¬å‡é€šè¿‡è¿œç¨‹é“¾æ¥ä¸€é”®æ‰§è¡Œï¼Œæ–¹ä¾¿å¿«æ·ï¼\nğŸ“š å¯¼èˆªç›®å½• ğŸ“¦ ZIP æ ¼å¼å¤„ç† å‹ç¼©ä¸ºZIPæ–‡ä»¶ è§£å‹ZIPæ–‡ä»¶ ğŸ“¦ TAR.GZ æ ¼å¼å¤„ç† å‹ç¼©ä¸ºTAR.GZæ–‡ä»¶ è§£å‹TAR.GZæ–‡ä»¶ ğŸ’¡ ä½¿ç”¨æ³¨æ„äº‹é¡¹ ğŸ”§ è‡ªå®šä¹‰ä¸æ‰©å±• ğŸ“¦ ZIP æ ¼å¼å¤„ç† æœ¬èŠ‚ä»‹ç»ä¸ ZIP æ ¼å¼ç›¸å…³çš„å‹ç¼©ä¸è§£å‹æ“ä½œã€‚\nğŸ“¦ å‹ç¼©ä¸ºZIPæ–‡ä»¶ æ­¤åŠŸèƒ½ç”¨äºéå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ï¼Œå¹¶å°†æ¯ä¸ªå­ç›®å½•å•ç‹¬å‹ç¼©ä¸ºä¸€ä¸ªåŒåçš„ .zip æ–‡ä»¶ã€‚é€‚åˆç”¨äºæ‰¹é‡å¤‡ä»½æˆ–æ•´ç†é¡¹ç›®ç›®å½•ã€‚\nâœ¨ ç‰¹ç‚¹ï¼š\nğŸ”„ è‡ªåŠ¨åŒ–éå†ï¼šæ— éœ€æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ï¼Œè‡ªåŠ¨å¤„ç†æ‰€æœ‰å­ç›®å½•ã€‚ ğŸ—‚ï¸ ä¿ç•™ç»“æ„ï¼šå‹ç¼©åçš„ ZIP æ–‡ä»¶å®Œæ•´ä¿ç•™åŸå§‹ç›®å½•ç»“æ„ã€‚ ğŸŒ è¿œç¨‹è„šæœ¬ï¼šç›´æ¥é€šè¿‡ curl ä¸‹è½½å¹¶æ‰§è¡Œï¼Œæ— éœ€æœ¬åœ°ä¿å­˜è„šæœ¬ã€‚ ğŸ“ ä½¿ç”¨å‘½ä»¤ï¼š\n1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/zip/backup_zip.sh) æˆ–ä½¿ç”¨å›½å†…é•œåƒï¼ˆè‹¥è®¿é—® GitHub å—é™ï¼‰ï¼š 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/zip/backup_zip.sh) ğŸ”“ è§£å‹ZIPæ–‡ä»¶ æ­¤åŠŸèƒ½ç”¨äºéå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ .zip æ–‡ä»¶ï¼Œå¹¶å°†æ¯ä¸ª ZIP æ–‡ä»¶è§£å‹åˆ°å½“å‰ç›®å½•ä¸‹ã€‚é€‚ç”¨äºæ‰¹é‡æ¢å¤å¤‡ä»½æˆ–æå–å¤šä¸ªå‹ç¼©åŒ…ã€‚\nâœ¨ ç‰¹ç‚¹ï¼š\nğŸ”„ æ‰¹é‡å¤„ç†ï¼šè‡ªåŠ¨è¯†åˆ«æ‰€æœ‰ ZIP æ–‡ä»¶ï¼Œæ— éœ€é€ä¸ªè§£å‹ã€‚ ğŸ“‚ è§£å‹åˆ°å½“å‰ç›®å½•ï¼šæ‰€æœ‰æ–‡ä»¶æå–åˆ°å½“å‰æ–‡ä»¶å¤¹ï¼Œä¿æŒè·¯å¾„æ¸…æ™°ã€‚ âš¡ ä¸€é”®æ‰§è¡Œï¼šç®€åŒ–é‡å¤æ€§æ“ä½œï¼Œæé«˜æ•ˆç‡ã€‚ ğŸ“ ä½¿ç”¨å‘½ä»¤ï¼š\n1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/zip/unzip.sh) æˆ–ä½¿ç”¨å›½å†…é•œåƒï¼š 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/zip/unzip.sh) ğŸ“¦ TAR.GZ æ ¼å¼å¤„ç† æœ¬èŠ‚ä»‹ç»ä¸ TAR.GZ æ ¼å¼ç›¸å…³çš„å‹ç¼©ä¸è§£å‹æ“ä½œã€‚\nğŸ“¦ å‹ç¼©ä¸ºTAR.GZæ–‡ä»¶ æ­¤åŠŸèƒ½ç”¨äºéå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ï¼Œå¹¶å°†æ¯ä¸ªå­ç›®å½•å‹ç¼©ä¸ºä¸€ä¸ªåŒåçš„ .tar.gz æ–‡ä»¶ã€‚TAR.GZ æ ¼å¼åœ¨ Linux ç¯å¢ƒä¸­å¹¿æ³›ä½¿ç”¨ï¼Œå…·æœ‰è¾ƒå¥½çš„å‹ç¼©æ•ˆç‡å’Œå…¼å®¹æ€§ã€‚\nâœ¨ ç‰¹ç‚¹ï¼š\nğŸ§ Linux å‹å¥½ï¼šTAR.GZ æ˜¯ Linux ç³»ç»Ÿå¸¸è§çš„å‹ç¼©æ ¼å¼ã€‚ ğŸ“¦ é«˜å‹ç¼©æ¯”ï¼šç›¸æ¯” ZIPï¼ŒTAR.GZ é€šå¸¸èƒ½æä¾›æ›´é«˜çš„å‹ç¼©ç‡ã€‚ ğŸ”— è¿œç¨‹æ‰§è¡Œï¼šç›´æ¥é€šè¿‡ç½‘ç»œè„šæœ¬æ‰§è¡Œï¼Œæ— éœ€æœ¬åœ°å®‰è£…ã€‚ ğŸ“ ä½¿ç”¨å‘½ä»¤ï¼š\n1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/gz/backup_gz.sh) æˆ–ä½¿ç”¨å›½å†…é•œåƒï¼š 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/gz/backup_gz.sh) ğŸ”“ è§£å‹TAR.GZæ–‡ä»¶ æ­¤åŠŸèƒ½ç”¨äºéå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ .tar.gz æ–‡ä»¶ï¼Œå¹¶å°†æ¯ä¸ªæ–‡ä»¶è§£å‹åˆ°å½“å‰ç›®å½•ä¸‹ã€‚é€‚ç”¨äºä» TAR.GZ å¤‡ä»½ä¸­æ¢å¤æ•°æ®æˆ–æå–å‹ç¼©å†…å®¹ã€‚\nâœ¨ ç‰¹ç‚¹ï¼š\nğŸ” è‡ªåŠ¨è¯†åˆ«ï¼šè‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰ TAR.GZ æ–‡ä»¶å¹¶è¿›è¡Œå¤„ç†ã€‚ ğŸ—ƒï¸ ä¿ç•™æƒé™ï¼šè§£å‹æ—¶ä¿ç•™åŸå§‹æ–‡ä»¶æƒé™å’Œå±æ€§ï¼ˆé€‚ç”¨äº Linux ç³»ç»Ÿï¼‰ã€‚ ğŸš€ å¿«é€Ÿæ‰§è¡Œï¼šä¸€æ¡å‘½ä»¤å³å¯å®Œæˆæ‰€æœ‰è§£å‹æ“ä½œã€‚ ğŸ“ ä½¿ç”¨å‘½ä»¤ï¼š\n1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/gz/untar.sh) æˆ–ä½¿ç”¨å›½å†…é•œåƒï¼š 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/gz/untar.sh) ğŸ’¡ ä½¿ç”¨æ³¨æ„äº‹é¡¹ ğŸŒ ç½‘ç»œä¾èµ–ï¼šè¿™äº›è„šæœ¬éœ€è¦é€šè¿‡ curl ä¸‹è½½ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²è¿æ¥äº’è”ç½‘ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¿é—® script.meimolihan.eu.org æˆ– gitee.comã€‚ ğŸ” å®‰å…¨æé†’ï¼šæ‰§è¡Œè¿œç¨‹è„šæœ¬å‰ï¼Œè¯·ç¡®ä¿æ‚¨ä¿¡ä»»è„šæœ¬æ¥æºã€‚å»ºè®®å…ˆæ£€æŸ¥è„šæœ¬å†…å®¹ï¼ˆå¯é€šè¿‡ curl ä¸‹è½½åæŸ¥çœ‹ï¼‰ï¼Œå†æ‰§è¡Œã€‚ ğŸ“ ç›®å½•ç»“æ„ï¼šå‹ç¼©è„šæœ¬ä¼šéå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•ç”Ÿæˆä¸€ä¸ªå‹ç¼©æ–‡ä»¶ã€‚è¯·ç¡®ä¿å½“å‰ç›®å½•ä¸‹æ²¡æœ‰æ— å…³å­ç›®å½•ï¼Œä»¥å…äº§ç”Ÿå¤šä½™æ–‡ä»¶ã€‚ âš™ï¸ ç³»ç»Ÿå…¼å®¹ï¼šè¿™äº›è„šæœ¬ä¸»è¦åœ¨ Linux æˆ– macOS ç¯å¢ƒä¸­æµ‹è¯•é€šè¿‡ï¼ŒWindows ç”¨æˆ·å¯èƒ½éœ€è¦ä½¿ç”¨ WSL æˆ–ç±»ä¼¼ç¯å¢ƒã€‚ âš ï¸ è¦†ç›–é£é™©ï¼šè§£å‹æ—¶ï¼Œå¦‚æœå½“å‰ç›®å½•å·²å­˜åœ¨åŒåæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œå¯èƒ½ä¼šè¢«è¦†ç›–ï¼Œè¯·æå‰åšå¥½å¤‡ä»½ã€‚ ğŸ”§ è‡ªå®šä¹‰ä¸æ‰©å±• å¦‚æœæ‚¨éœ€è¦ä¿®æ”¹è„šæœ¬ä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ï¼ˆå¦‚æ’é™¤æŸäº›ç›®å½•ã€æ·»åŠ å‹ç¼©å¯†ç ç­‰ï¼‰ï¼Œå¯ä»¥å…ˆå°†è„šæœ¬ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åè¿›è¡Œç¼–è¾‘ï¼š\n1 2 3 4 5 6 7 8 # ä¸‹è½½è„šæœ¬åˆ°æœ¬åœ° curl -sL script.meimolihan.eu.org/sh/zip/backup-zip.sh \u0026gt; my-backup-script.sh # ç¼–è¾‘è„šæœ¬ nano my-backup-script.sh # æˆäºˆæ‰§è¡Œæƒé™ chmod +x my-backup-script.sh # è¿è¡Œæœ¬åœ°è„šæœ¬ ./my-backup-script.sh ğŸ¯ å¸¸è§è‡ªå®šä¹‰åœºæ™¯ï¼š\næ·»åŠ å‹ç¼©å¯†ç ï¼ˆZIP æ ¼å¼æ”¯æŒï¼‰ã€‚ æ’é™¤ç‰¹å®šç›®å½•æˆ–æ–‡ä»¶ï¼ˆå¦‚ node_modulesã€.git ç­‰ï¼‰ã€‚ ä¿®æ”¹å‹ç¼©çº§åˆ«ï¼ˆZIP å’Œ TAR.GZ å‡æ”¯æŒï¼‰ã€‚ å°†å‹ç¼©æ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨æˆ–äº‘å­˜å‚¨ã€‚ å¸Œæœ›è¿™äº›è„šæœ¬èƒ½å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ç®¡ç†æ–‡ä»¶ï¼å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆã€‚ğŸš€\n","date":"2025-09-15T13:10:46+08:00","image":"https://file.meimolihan.eu.org/img/zip-gz-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d0d434b9/","title":"Linux å­ç›®å½•åˆ†ç¦»å¤‡ä»½ä¸è§£å‹ \u0026 äº¤äº’å¼ğŸ“¦"},{"content":"Linux å®Œæ•´ç›®å½•å¤‡ä»½ä¸è§£å‹è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ“‚ æœ¬æ–‡è¯¦ç»†ä»‹ç»é€šç”¨è‡ªåŠ¨å¤‡ä»½è„šæœ¬çš„åŠŸèƒ½ã€ä½¿ç”¨æ–¹æ³•åŠæ¢å¤æŒ‡å—ï¼Œå¸®åŠ©æ‚¨è½»æ¾ç®¡ç†é‡è¦æ•°æ®çš„å®‰å…¨ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ“¦ è„šæœ¬æ¦‚è¿° âœ¨ ä¸€ã€å¤‡ä»½è„šæœ¬åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ“¦ äºŒã€è§£å‹å‘½ä»¤åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ”§ ä¸‰ã€ä½¿ç”¨æ–¹æ³• ğŸŒ 1. è¿œç¨‹æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ ğŸ“¦ è¿œç¨‹å‹ç¼©æ“ä½œ ğŸ“¤ æœ¬åœ°è§£å‹æ“ä½œ ğŸ’» 2. æœ¬åœ°æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ ğŸ“¦ æœ¬åœ°å‹ç¼©æ“ä½œ ğŸ“¤ æœ¬åœ°è§£å‹æ“ä½œ ğŸ” å››ã€æµ‹è¯•å‹ç¼©ä¸è§£å‹ ğŸ“ äº”ã€å¤‡ä»½åŸç†ä¸å‹ç¼©æœºåˆ¶ â° å…­ã€å®šæ—¶ä»»åŠ¡è®¾ç½® ğŸ’¡ ä¸ƒã€æ³¨æ„äº‹é¡¹ ğŸ“¦ è„šæœ¬æ¦‚è¿° é€šç”¨è‡ªåŠ¨å¤‡ä»½è„šæœ¬æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®ä¿æŠ¤å·¥å…·ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–å®Œæˆç›®å½•çš„å‹ç¼©å¤‡ä»½ã€ç‰ˆæœ¬ç®¡ç†å’Œæ—§å¤‡ä»½æ¸…ç†å·¥ä½œã€‚é€šè¿‡ç®€å•çš„å‘½ä»¤å³å¯å®ç°ä¸€é”®å¤‡ä»½ï¼Œç¡®ä¿æ‚¨çš„æ•°æ®å®‰å…¨æ— å¿§ã€‚\nä¸€ã€ âœ¨ å¤‡ä»½è„šæœ¬åŠŸèƒ½ä¸ç‰¹ç‚¹ âœ… å®Œå…¨å…äº¤äº’ï¼šé€‚åˆè‡ªåŠ¨åŒ–ä»»åŠ¡å’Œå®šæ—¶æ‰§è¡Œ âœ… æ™ºèƒ½ä¿ç•™ç­–ç•¥ï¼šè‡ªåŠ¨ä¿ç•™æŒ‡å®šæ•°é‡çš„æœ€æ–°å¤‡ä»½æ–‡ä»¶ âœ… æ—¶é—´æˆ³æ ‡è¯†ï¼šæ¯ä¸ªå¤‡ä»½æ–‡ä»¶åŒ…å«ç²¾ç¡®åˆ°ç§’çš„åˆ›å»ºæ—¶é—´ âœ… å®Œæ•´æ€§æ£€æŸ¥ï¼šè‡ªåŠ¨éªŒè¯æºç›®å½•å’Œå¤‡ä»½ç›®å½•çš„å¯ç”¨æ€§ âœ… è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼šå®æ—¶æ˜¾ç¤ºå¤‡ä»½è¿›åº¦å’Œç»“æœ âœ… ç©ºé—´ç®¡ç†ï¼šè‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ï¼Œé¿å…ç£ç›˜ç©ºé—´ä¸è¶³ äºŒã€ğŸ“¦ è§£å‹å‘½ä»¤åŠŸèƒ½ä¸ç‰¹ç‚¹ âœ… çµæ´»è§£å‹ï¼šæ”¯æŒè§£å‹åˆ°å½“å‰ç›®å½•ã€æŒ‡å®šç›®å½•ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ âœ… å†…å®¹é¢„è§ˆï¼šå¯åœ¨è§£å‹å‰æŸ¥çœ‹å½’æ¡£æ–‡ä»¶å†…å®¹ï¼Œé¿å…è¦†ç›–é‡è¦æ–‡ä»¶ âœ… é€‰æ‹©æ€§è§£å‹ï¼šæ”¯æŒä»å¤§å‹å¤‡ä»½ä¸­æå–å•ä¸ªæˆ–ç‰¹å®šç›®å½•çš„æ–‡ä»¶ âœ… æƒé™ä¿æŒï¼šå®Œæ•´ä¿ç•™æ–‡ä»¶åŸå§‹æƒé™ã€æ‰€æœ‰æƒåŠæ—¶é—´æˆ³å±æ€§ âœ… è¿›åº¦å¯è§†åŒ–ï¼šä½¿ç”¨-vå‚æ•°å¯æ˜¾ç¤ºè§£å‹è¿‡ç¨‹çš„è¯¦ç»†æ–‡ä»¶åˆ—è¡¨ âœ… é€šç”¨æ€§å¼ºï¼šæ ‡å‡†tar/gzipæ ¼å¼ï¼Œå…¼å®¹æ‰€æœ‰Linux/Unixç³»ç»ŸåŠå¸¸è§è§£å‹è½¯ä»¶ ä¸‰ã€ğŸ”§ ä½¿ç”¨æ–¹æ³• 1. è¿œç¨‹æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ åŸºæœ¬å‘½ä»¤æ ¼å¼ bash ~/universal_backup.sh \u0026lt;æºç›®å½•\u0026gt; \u0026lt;å¤‡ä»½ç›®å½•\u0026gt; [ä¿ç•™æ•°é‡] å¤‡ä»½ç›®å½•ä¸‹ä»…ä¿ç•™ æºç›®å½•å_æ—¶é—´æˆ³.tar.gz æ ¼å¼å‹ç¼©åŒ…ï¼Œæ¯åŒ…å³æºç›®å½•çš„å®Œæ•´å¤‡ä»½ã€‚ ğŸ“¦ è¿œç¨‹å‹ç¼©æ“ä½œ 1 2 3 4 5 # ä½¿ç”¨ä¸»åŸŸåæ‰§è¡Œ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/backup/universal_backup.sh) /æºç›®å½• /å¤‡ä»½ç›®å½• ä¿ç•™æ•°é‡ # æˆ–ä½¿ç”¨Giteeé•œåƒæ‰§è¡Œï¼ˆå›½å†…ç”¨æˆ·æ¨èï¼‰ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/universal_backup.sh) /æºç›®å½• /å¤‡ä»½ç›®å½• ä¿ç•™æ•°é‡ ğŸ“¤ æœ¬åœ°è§£å‹æ“ä½œ 1 2 3 4 5 # è§£å‹åˆ°å½“å‰ç›®å½• tar -xzvf /å¤‡ä»½ç›®å½•/å¤‡ä»½æ–‡ä»¶.tar.gz # è§£å‹åˆ°æŒ‡å®šç›®å½• tar -xzvf /å¤‡ä»½ç›®å½•/å¤‡ä»½æ–‡ä»¶.tar.gz -C /ç›®æ ‡ç›®å½•/ å®é™…è§£å‹ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºåŸç›®å½•ç»“æ„ï¼‰ tar -xzvf /backups/html_20231201_143022.tar.gz # è§£å‹åˆ°æŒ‡å®šç›®å½• tar -xzvf /backups/html_20231201_143022.tar.gz -C /var/www/new_html/ # åªæŸ¥çœ‹å½’æ¡£å†…å®¹è€Œä¸è§£å‹ tar -tzvf /backups/html_20231201_143022.tar.gz # è§£å‹ç‰¹å®šæ–‡ä»¶ tar -xzvf /backups/html_20231201_143022.tar.gz path/to/specific/file è§£å‹å‚æ•°è¯¦è§£ -xï¼šä»å½’æ¡£ä¸­è§£å‹æ–‡ä»¶ -zï¼šä½¿ç”¨gzipè§£å‹ç¼© -vï¼šæ˜¾ç¤ºè¯¦ç»†å¤„ç†è¿‡ç¨‹ -fï¼šæŒ‡å®šå½’æ¡£æ–‡ä»¶å -Cï¼šæŒ‡å®šè§£å‹ç›®æ ‡ç›®å½• ğŸ’» 2. æœ¬åœ°æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ ğŸ“¦ æœ¬åœ°å‹ç¼©æ“ä½œ åŸºæœ¬å‘½ä»¤æ ¼å¼ bash ~/universal_backup.sh \u0026lt;æºç›®å½•\u0026gt; \u0026lt;å¤‡ä»½ç›®å½•\u0026gt; [ä¿ç•™æ•°é‡] å¤‡ä»½ç›®å½•ä¸‹ä»…ä¿ç•™ æºç›®å½•å_æ—¶é—´æˆ³.tar.gz æ ¼å¼å‹ç¼©åŒ…ï¼Œæ¯åŒ…å³æºç›®å½•çš„å®Œæ•´å¤‡ä»½ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ä¸‹è½½å¤‡ä»½è„šæœ¬ cd /mnt \u0026amp;\u0026amp; \\ wget -c https://gitee.com/meimolihan/script/raw/master/sh/backup/universal_backup.sh # èµ‹äºˆæ‰§è¡Œæƒé™ chmod +x universal_backup.sh # è§£å†³å¯èƒ½å­˜åœ¨çš„æ¢è¡Œç¬¦é—®é¢˜ï¼ˆå¦‚æœéœ€è¦ï¼‰ sudo apt install dos2unix dos2unix universal_backup.sh # åŸºæœ¬ç”¨æ³•ï¼ˆä¿ç•™3ä¸ªå¤‡ä»½ï¼‰ /mnt/universal_backup.sh /æºç›®å½• /å¤‡ä»½ç›®å½• # æŒ‡å®šä¿ç•™å¤‡ä»½æ•°é‡ /mnt/universal_backup.sh /æºç›®å½• /å¤‡ä»½ç›®å½• ä¿ç•™æ•°é‡ # å®é™…ç¤ºä¾‹ /mnt/universal_backup.sh /mnt/test1 /mnt/test2 /mnt/universal_backup.sh /mnt/test1 /mnt/test2 7 ğŸ“¤ æœ¬åœ°è§£å‹æ“ä½œ 1 2 3 4 5 # è§£å‹åˆ°å½“å‰ç›®å½• tar -xzvf /å¤‡ä»½ç›®å½•/å¤‡ä»½æ–‡ä»¶.tar.gz # è§£å‹åˆ°æŒ‡å®šç›®å½• tar -xzvf /å¤‡ä»½ç›®å½•/å¤‡ä»½æ–‡ä»¶.tar.gz -C /ç›®æ ‡ç›®å½•/ å®é™…è§£å‹ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºåŸç›®å½•ç»“æ„ï¼‰ tar -xzvf /backups/html_20231201_143022.tar.gz # è§£å‹åˆ°æŒ‡å®šç›®å½• tar -xzvf /backups/html_20231201_143022.tar.gz -C /var/www/new_html/ # åªæŸ¥çœ‹å½’æ¡£å†…å®¹è€Œä¸è§£å‹ tar -tzvf /backups/html_20231201_143022.tar.gz # è§£å‹ç‰¹å®šæ–‡ä»¶ tar -xzvf /backups/html_20231201_143022.tar.gz path/to/specific/file è§£å‹å‚æ•°è¯¦è§£ -xï¼šä»å½’æ¡£ä¸­è§£å‹æ–‡ä»¶ -zï¼šä½¿ç”¨gzipè§£å‹ç¼© -vï¼šæ˜¾ç¤ºè¯¦ç»†å¤„ç†è¿‡ç¨‹ -fï¼šæŒ‡å®šå½’æ¡£æ–‡ä»¶å -Cï¼šæŒ‡å®šè§£å‹ç›®æ ‡ç›®å½• å››ã€ğŸ” æµ‹è¯•å‹ç¼©ä¸è§£å‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•æµç¨‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬è¿›è¡Œå‹ç¼©å’Œè§£å‹æ“ä½œï¼š\nğŸ§ª 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶ 1 2 3 4 5 6 mkdir -p /mnt/{test1,test2,test3} \u0026amp;\u0026amp; \\ mkdir -p /mnt/test1/{aaa,bbb,ccc} \u0026amp;\u0026amp; \\ echo \u0026#34;æµ‹è¯•æ–‡ä»¶å†…å®¹\u0026#34; \u0026gt; /mnt/test1/aaa/test1.txt \u0026amp;\u0026amp; \\ echo \u0026#34;å¦ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶\u0026#34; \u0026gt; /mnt/test1/bbb/test2.txt \u0026amp;\u0026amp; \\ echo \u0026#34;ç¬¬ä¸‰ä¸ªæµ‹è¯•æ–‡ä»¶\u0026#34; \u0026gt; /mnt/test1/ccc/test3.txt \u0026amp;\u0026amp; \\ tree /mnt/test1 /mnt/test2 /mnt/test3 åˆå§‹æµ‹è¯•ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 root@debian13 / # tree /mnt/test1 /mnt/test2 /mnt/test3 /mnt/test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt /mnt/test2 /mnt/test3 ğŸ§ª 2. æµ‹è¯• å‹ç¼© è¿™é‡ŒæŒ‡å®šäº† ä¿ç•™æ•°é‡ 5ï¼Œé»˜è®¤æ˜¯ä¿ç•™æ•°é‡ 3ã€‚ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/universal_backup.sh) /mnt/test1 /mnt/test2 5 \u0026amp;\u0026amp; tree /mnt/test1 /mnt/test2 /mnt/test3 å®Œæˆ å‹ç¼© åçš„ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 root@debian13 / # tree /mnt/test1 /mnt/test2 /mnt/test3 /mnt/test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt /mnt/test2 â””â”€â”€ test1_20250916_193521.tar.gz /mnt/test3 ğŸ§ª 3. æµ‹è¯• è§£å‹ 1 tar -xzvf /mnt/test2/test1_*.tar.gz -C /mnt/test3/ \u0026amp;\u0026amp; tree /mnt/test1 /mnt/test2 /mnt/test3 å®Œæˆ è§£å‹ åçš„ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 root@debian13 ~ # tree /mnt/test1 /mnt/test2 /mnt/test3 /mnt/test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt /mnt/test2 â””â”€â”€ test1_20250916_193521.tar.gz /mnt/test3 â””â”€â”€ test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt ğŸ§ª 4. åˆ é™¤æµ‹è¯•æ–‡ä»¶ 1 2 rm -rf /mnt/test1 /mnt/test2 /mnt/test3 \u0026amp;\u0026amp; \\ ls /mnt è¿™ä¸ªæµ‹è¯•æµç¨‹å±•ç¤ºäº†ï¼š\nåˆ›å»ºæµ‹è¯•ç›®å½•ç»“æ„å’Œæ–‡ä»¶ ä½¿ç”¨å¤‡ä»½è„šæœ¬å°†ç›®å½•å‹ç¼©ä¸ºä¸€ä¸ªtar.gzæ–‡ä»¶ ä½¿ç”¨è§£å‹è„šæœ¬å°†è¿™äº›å‹ç¼©åŒ…è§£å‹åˆ°ç›®æ ‡ç›®å½• éªŒè¯è§£å‹ç»“æœæ˜¯å¦æ­£ç¡® é€šè¿‡è¿™ä¸ªå®Œæ•´çš„æµ‹è¯•æµç¨‹ï¼Œæ‚¨å¯ä»¥ç¡®ä¿è„šæœ¬æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”ç†è§£æ•´ä¸ªå‹ç¼©å’Œè§£å‹çš„è¿‡ç¨‹ã€‚ğŸ§ª\näº”ã€ğŸ“ å¤‡ä»½åŸç†ä¸å‹ç¼©æœºåˆ¶ å‹ç¼©æŠ€æœ¯ è„šæœ¬ä½¿ç”¨æ ‡å‡†çš„ tar å’Œ gzip å·¥å…·è¿›è¡Œå‹ç¼©ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\né«˜å‹ç¼©æ¯”ï¼šgzipå‹ç¼©ç®—æ³•åœ¨ä¿è¯é€Ÿåº¦çš„åŒæ—¶æä¾›è‰¯å¥½çš„å‹ç¼©ç‡ å¹¿æ³›å…¼å®¹ï¼štar.gzæ ¼å¼åœ¨æ‰€æœ‰Linux/Unixç³»ç»Ÿä¸Šå‡å¯ç›´æ¥å¤„ç† ä¿ç•™æƒé™ï¼šå®Œæ•´ä¿ç•™æ–‡ä»¶æƒé™ã€æ‰€æœ‰æƒå’Œæ—¶é—´æˆ³ä¿¡æ¯ å¤‡ä»½æµç¨‹ å‚æ•°éªŒè¯ï¼šæ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¤‡ä»½ç›®å½•æ˜¯å¦å¯å†™ å‹ç¼©åˆ›å»ºï¼šä½¿ç”¨ tar -czf å‘½ä»¤åˆ›å»ºgzipå‹ç¼©çš„å½’æ¡£æ–‡ä»¶ æ–‡ä»¶å‘½åï¼šé‡‡ç”¨\u0026quot;ç›®å½•å_å¹´æœˆæ—¥_æ—¶åˆ†ç§’.tar.gz\u0026quot;æ ¼å¼ æ¸…ç†ç­–ç•¥ï¼šæŒ‰æ—¶é—´æ’åºå¤‡ä»½æ–‡ä»¶ï¼Œä¿ç•™æœ€æ–°çš„Nä¸ªæ–‡ä»¶ ç»“æœæŠ¥å‘Šï¼šæ˜¾ç¤ºå¤‡ä»½å¤§å°å’Œå½“å‰ä¿ç•™çš„å¤‡ä»½åˆ—è¡¨ å…­ã€â° å®šæ—¶ä»»åŠ¡è®¾ç½® è®¾ç½®å®šæ—¶è‡ªåŠ¨å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 # ç¼–è¾‘å½“å‰ç”¨æˆ·çš„crontab crontab -e # æ·»åŠ ä»¥ä¸‹ä»»åŠ¡ç¤ºä¾‹ï¼š # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼Œä¿ç•™7ä¸ªå¤‡ä»½ 0 2 * * * /path/to/universal_backup.sh /var/www/html /backups 7 # æ¯å‘¨æ—¥å‡Œæ™¨1ç‚¹æ‰§è¡Œå¤‡ä»½ï¼Œä¿ç•™4ä¸ªå¤‡ä»½ 0 1 * * 0 /path/to/universal_backup.sh /home/user/documents /mnt/backup 4 # æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡å¤‡ä»½ 0 */6 * * * /path/to/universal_backup.sh /important/data /backups 10 æ—¥å¿—è®°å½•é…ç½® 1 2 3 4 5 # å°†è¾“å‡ºåŒæ—¶è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ 0 2 * * * /path/to/universal_backup.sh /var/www/html /backups 7 \u0026gt;\u0026gt; /var/log/backup.log 2\u0026gt;\u0026amp;1 # åªè®°å½•é”™è¯¯ä¿¡æ¯ 0 2 * * * /path/to/universal_backup.sh /var/www/html /backups 7 \u0026gt; /dev/null 2\u0026gt;\u0026gt; /var/log/backup-error.log ä¸ƒã€ğŸ’¡ æ³¨æ„äº‹é¡¹ æƒé™è¦æ±‚ï¼šè¿è¡Œè„šæœ¬çš„ç”¨æˆ·éœ€è¦å¯¹æºç›®å½•æœ‰è¯»å–æƒé™ï¼Œå¯¹å¤‡ä»½ç›®å½•æœ‰å†™å…¥æƒé™ ç£ç›˜ç©ºé—´ï¼šç¡®ä¿å¤‡ä»½ç›®å½•æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜å‚¨å¤‡ä»½æ–‡ä»¶ è·¯å¾„è§„èŒƒï¼šå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé¿å…ç›¸å¯¹è·¯å¾„å¯èƒ½å¸¦æ¥çš„é—®é¢˜ ç‰¹æ®Šå­—ç¬¦ï¼šç›®å½•åä¸­é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œä»¥å…å½±å“è„šæœ¬æ‰§è¡Œ æ–‡ä»¶ç³»ç»Ÿï¼šå¯¹äºå¤§é‡å°æ–‡ä»¶ï¼Œå‹ç¼©è¿‡ç¨‹å¯èƒ½è¾ƒæ…¢ï¼Œå»ºè®®åœ¨ç³»ç»Ÿè´Ÿè½½ä½æ—¶æ‰§è¡Œ ç½‘ç»œå¤‡ä»½ï¼šå¦‚éœ€å¤‡ä»½åˆ°è¿œç¨‹ä½ç½®ï¼Œå¯å…ˆæœ¬åœ°å¤‡ä»½å†ä½¿ç”¨rsyncåŒæ­¥ æ€§èƒ½ä¼˜åŒ–å»ºè®® å¯¹äºå¤§å‹ç›®å½•ï¼Œè€ƒè™‘ä½¿ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©ç®—æ³•ï¼ˆå¦‚pigzï¼‰ ä½¿ç”¨ioniceå’Œniceè°ƒæ•´å¤‡ä»½ä»»åŠ¡çš„IOå’ŒCPUä¼˜å…ˆçº§ å¯¹äºæ•°æ®åº“åº”ç”¨ï¼Œå»ºè®®å…ˆåœæ­¢æœåŠ¡æˆ–ä½¿ç”¨ä¸“ç”¨å¤‡ä»½å·¥å…· æ¢å¤æµ‹è¯•å»ºè®® å®šæœŸæµ‹è¯•å¤‡ä»½æ–‡ä»¶çš„æ¢å¤è¿‡ç¨‹ï¼Œç¡®ä¿ï¼š\nå¤‡ä»½æ–‡ä»¶å®Œæ•´æ— æŸ æ¢å¤åçš„æ–‡ä»¶æƒé™æ­£ç¡® é‡è¦æ•°æ®æ²¡æœ‰é—æ¼ ğŸš€ å®šæœŸå¤‡ä»½æ˜¯æ•°æ®å®‰å…¨çš„é‡è¦ä¿éšœï¼Œå»ºè®®æ‚¨è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œæ­¤è„šæœ¬ï¼Œä¸ºæ‚¨çš„é‡è¦æ•°æ®æä¾›æŒç»­çš„ä¿æŠ¤ã€‚å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹ï¼Œç¡®ä¿åœ¨éœ€è¦æ—¶èƒ½å¤Ÿå¿«é€Ÿæœ‰æ•ˆåœ°æ¢å¤æ•°æ®ã€‚\n","date":"2025-09-15T03:46:00+08:00","image":"https://file.meimolihan.eu.org/img/linux-rar-01.webp","permalink":"https://blog.meimolihan.eu.org/p/914a47df/","title":"Linux å®Œæ•´ç›®å½•å¤‡ä»½ä¸è§£å‹è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ“‚"},{"content":"Linux å­ç›®å½•åˆ†ç¦»å¤‡ä»½ä¸è§£å‹ \u0026amp; å…äº¤äº’å¼ğŸ“¦ æœ¬æ–‡ä»‹ç»ä¸¤ä¸ªå®ç”¨çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼šdirectory_backup.sh å’Œ directory_extract.shï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºç›®å½•å¤‡ä»½å’Œè§£å‹æ“ä½œã€‚è¿™äº›è„šæœ¬é‡‡ç”¨å…äº¤äº’è®¾è®¡ï¼Œéå¸¸é€‚åˆé›†æˆåˆ°è‡ªåŠ¨åŒ–è¿ç»´æµç¨‹æˆ–å®šæ—¶ä»»åŠ¡ä¸­ï¼Œèƒ½å¤Ÿæ˜¾è‘—æé«˜æ–‡ä»¶ç®¡ç†æ•ˆç‡ã€‚âœ¨\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ“š è„šæœ¬ç®€ä»‹ âš™ï¸ ä¸€ã€å¤‡ä»½è„šæœ¬åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ“¦ äºŒã€è§£å‹è„šæœ¬åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸš€ ä¸‰ã€ä½¿ç”¨æ–¹æ³• ğŸŒ 1. è¿œç¨‹æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ ğŸ“¦ è¿œç¨‹å‹ç¼©æ“ä½œ ğŸ“¤ è¿œç¨‹è§£å‹æ“ä½œ ğŸ’» 2. æœ¬åœ°æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ ğŸ“¦ æœ¬åœ°å‹ç¼©æ“ä½œ ğŸ“¤ æœ¬åœ°è§£å‹æ“ä½œ ğŸ” å››ã€æµ‹è¯•å‹ç¼©ä¸è§£å‹ ğŸ”§ äº”ã€è„šæœ¬åŠŸèƒ½æ¦‚æ‹¬ â° å…­ã€å®šæ—¶ä»»åŠ¡è®¾ç½® ğŸ’¡ ä¸ƒã€ä½¿ç”¨åœºæ™¯ä¸å»ºè®® ğŸ“š è„šæœ¬ç®€ä»‹ æœ¬æ–‡ä»‹ç»ä¸¤ä¸ªå®ç”¨çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼šdirectory_backup.sh å’Œ directory_extract.shï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºç›®å½•å¤‡ä»½å’Œè§£å‹æ“ä½œã€‚è¿™äº›è„šæœ¬é‡‡ç”¨å…äº¤äº’è®¾è®¡ï¼Œéå¸¸é€‚åˆé›†æˆåˆ°è‡ªåŠ¨åŒ–è¿ç»´æµç¨‹æˆ–å®šæ—¶ä»»åŠ¡ä¸­ï¼Œèƒ½å¤Ÿæ˜¾è‘—æé«˜æ–‡ä»¶ç®¡ç†æ•ˆç‡ã€‚âœ¨\næ— è®ºæ˜¯ç³»ç»Ÿç®¡ç†å‘˜éœ€è¦å®šæœŸå¤‡ä»½é‡è¦æ•°æ®ï¼Œè¿˜æ˜¯å¼€å‘äººå‘˜éœ€è¦å¿«é€Ÿéƒ¨ç½²ç¯å¢ƒï¼Œè¿™ä¸¤ä¸ªè„šæœ¬éƒ½èƒ½æä¾›ç®€å•è€Œå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒä»¬æ”¯æŒå¤šç§å‹ç¼©æ ¼å¼ï¼Œå…·æœ‰è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯æŠ¥å‘Šï¼Œè®©ç”¨æˆ·éšæ—¶äº†è§£æ“ä½œçŠ¶æ€ã€‚\nä¸€ã€âš™ï¸ å¤‡ä»½è„šæœ¬åŠŸèƒ½ä¸ç‰¹ç‚¹ directory_backup.sh æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç›®å½•å¤‡ä»½å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹çªå‡ºç‰¹ç‚¹ï¼š\nğŸ¯ è‡ªåŠ¨åŒ–å¤‡ä»½ï¼šä¸€é”®æŒ‡å®šå¤‡ä»½ç›®å½•ä¸‹çš„æ‰€æœ‰ééšè—å­ç›®å½•ï¼Œæ— éœ€äººå·¥å¹²é¢„ ğŸ“ æ™ºèƒ½å‹ç¼©ï¼šæ¯ä¸ªå­ç›®å½•å•ç‹¬å‹ç¼©ä¸º .tar.gz æ–‡ä»¶ï¼Œä¿æŒç»“æ„æ¸…æ™° ğŸ”„ è‡ªåŠ¨è¦†ç›–ï¼šå…äº¤äº’è®¾è®¡è‡ªåŠ¨è¦†ç›–å·²å­˜åœ¨çš„å¤‡ä»½æ–‡ä»¶ï¼Œé€‚åˆè‡ªåŠ¨åŒ–ä»»åŠ¡ â° æ—¥æœŸæ ‡è®°ï¼šå¤‡ä»½æ–‡ä»¶åæ ¼å¼ä¸º ç›®å½•å-YYYY-MM-DD-HH-MM-SS.tar.gzï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç† ğŸ‘ï¸ é€æ˜æ“ä½œï¼šæä¾›è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼Œå®æ—¶æ˜¾ç¤ºå¤‡ä»½è¿›åº¦å’Œç»“æœ ğŸš« æ™ºèƒ½è¿‡æ»¤ï¼šè‡ªåŠ¨è·³è¿‡éšè—ç›®å½•ï¼ˆä»¥.å¼€å¤´çš„ç›®å½•ï¼‰ï¼Œé¿å…ä¸å¿…è¦çš„å¤‡ä»½ è¯¥è„šæœ¬ç‰¹åˆ«é€‚åˆéœ€è¦å®šæœŸå¤‡ä»½æ•°æ®çš„åœºæ™¯ï¼Œå¦‚ç½‘ç«™æ•°æ®å¤‡ä»½ã€é…ç½®æ–‡ä»¶å¤‡ä»½æˆ–é¡¹ç›®ç‰ˆæœ¬å­˜æ¡£ç­‰ã€‚ğŸ”’\näºŒã€ğŸ“¦ è§£å‹è„šæœ¬åŠŸèƒ½ä¸ç‰¹ç‚¹ directory_extract.sh æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½è§£å‹å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š\nğŸ”“ å¤šæ ¼å¼æ”¯æŒï¼šå…¨é¢æ”¯æŒ .tar.gz, .tgz, .tar, .zip, .gz ç­‰å¤šç§å‹ç¼©æ ¼å¼ ğŸ“‚ æ‰¹é‡å¤„ç†ï¼šè‡ªåŠ¨éå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å‹ç¼©åŒ…ï¼Œä¸€æ¬¡æ€§å®Œæˆè§£å‹æ“ä½œ ğŸ—ï¸ è‡ªåŠ¨åˆ›å»ºï¼šå¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ‰€éœ€ç›®å½•ç»“æ„ ğŸ“Š è¯¦ç»†æŠ¥å‘Šï¼šæ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„è§£å‹çŠ¶æ€å’Œæœ€ç»ˆç»Ÿè®¡ç»“æœï¼Œä¸€ç›®äº†ç„¶ ğŸ›¡ï¸ é”™è¯¯å¤„ç†ï¼šå…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå•ä¸ªæ–‡ä»¶å¤±è´¥ä¸å½±å“å…¶ä»–æ“ä½œ ğŸ” æ™ºèƒ½è¯†åˆ«ï¼šæ­£ç¡®å¤„ç†å¤åˆæ‰©å±•åï¼ˆå¦‚ .tar.gzï¼‰ï¼Œé¿å…é‡å¤è§£å‹é—®é¢˜ æ— è®ºæ˜¯ä»å¤‡ä»½æ¢å¤æ•°æ®ï¼Œè¿˜æ˜¯å¤„ç†ä¸‹è½½çš„å‹ç¼©åŒ…é›†åˆï¼Œè¿™ä¸ªè„šæœ¬éƒ½èƒ½å¤§å¤§ç®€åŒ–å·¥ä½œæµç¨‹ã€‚ğŸ“¤\nä¸‰ã€ğŸš€ ä½¿ç”¨æ–¹æ³• 1. ğŸŒ è¿œç¨‹æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥é€šè¿‡è¿œç¨‹URLæ‰§è¡Œè„šæœ¬ï¼Œæ— éœ€ä¸‹è½½ï¼š\nğŸ“¦ è¿œç¨‹å‹ç¼©æ“ä½œ åŸºæœ¬å‘½ä»¤æ ¼å¼ bash ~/directory_backup.sh \u0026lt;æºç›®å½•\u0026gt; \u0026lt;å¤‡ä»½ç›®å½•\u0026gt; [ä¿ç•™æ•°é‡] å¤‡ä»½ç›®å½•ä¸‹ä»…ä¿ç•™æŒ‰ å­ç›®å½•å_æ—¶é—´æˆ³.tar.gz å‘½åçš„å‹ç¼©åŒ…ï¼Œæ¯ä¸ªå¯¹åº”æºç›®å½•ä¸‹çš„ä¸€è½® å­ç›®å½• å¤‡ä»½ã€‚ 1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/backup/directory_backup.sh) /mnt/test1 /mnt/test2/ 5 æˆ–ä½¿ç”¨Giteeé•œåƒï¼š 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/directory_backup.sh) /mnt/test1 /mnt/test2/ 5 ğŸ“¤ è¿œç¨‹è§£å‹æ“ä½œ 1 2 3 4 # åˆ‡æ¢åˆ°éœ€è¦è§£å‹æ–‡ä»¶ç›®å½•å¹¶æ‰§è¡Œè§£å‹åˆ°æŒ‡å®šç›®å½• cd /mnt/test2 \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/backup/directory_extract.sh) /mnt/test3/ \u0026amp;\u0026amp; \\ tree /mnt/test3 æˆ–ä½¿ç”¨Giteeé•œåƒï¼š 1 2 3 4 # åˆ‡æ¢åˆ°éœ€è¦è§£å‹æ–‡ä»¶ç›®å½•å¹¶æ‰§è¡Œè§£å‹åˆ°æŒ‡å®šç›®å½• cd /mnt/test2 \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/directory_extract.sh) /mnt/test3/ \u0026amp;\u0026amp; \\ tree /mnt/test3 2. ğŸ’» æœ¬åœ°æ‰§è¡Œæ–¹å¼ï¼ˆå‹ç¼©ä¸è§£å‹ï¼‰ å¦‚æœéœ€è¦é¢‘ç¹ä½¿ç”¨ï¼Œå¯ä»¥ä¸‹è½½è„šæœ¬åˆ°æœ¬åœ°ï¼š\nğŸ“¦ æœ¬åœ°å‹ç¼©æ“ä½œ åŸºæœ¬å‘½ä»¤æ ¼å¼ bash ~/directory_backup.sh \u0026lt;æºç›®å½•\u0026gt; \u0026lt;å¤‡ä»½ç›®å½•\u0026gt; [ä¿ç•™æ•°é‡] å¤‡ä»½ç›®å½•ä¸‹ä»…ä¿ç•™æŒ‰ å­ç›®å½•å_æ—¶é—´æˆ³.tar.gz å‘½åçš„å‹ç¼©åŒ…ï¼Œæ¯ä¸ªå¯¹åº”æºç›®å½•ä¸‹çš„ä¸€è½® å­ç›®å½• å¤‡ä»½ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 # ä¸‹è½½å¤‡ä»½è„šæœ¬ wget -c https://gitee.com/meimolihan/script/raw/master/sh/backup/directory_backup.sh # èµ‹äºˆæ‰§è¡Œæƒé™ chmod +x directory_backup.sh # è§£å†³å¯èƒ½å­˜åœ¨çš„æ¢è¡Œç¬¦é—®é¢˜ï¼ˆå¦‚æœéœ€è¦ï¼‰ sudo apt install dos2unix dos2unix directory_backup.sh # åˆ‡æ¢åˆ°éœ€è¦å¤‡ä»½çš„ç›®å½•å¹¶æ‰§è¡Œå¤‡ä»½åˆ°æŒ‡å®šç›®å½• bash directory_backup.sh /mnt/test1 /mnt/test2 5 \u0026amp;\u0026amp; \\ ls /mnt/test2 ğŸ“¤ æœ¬åœ°è§£å‹æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä¸‹è½½è§£å‹è„šæœ¬ wget -c https://gitee.com/meimolihan/script/raw/master/sh/backup/directory_extract.sh # èµ‹äºˆæ‰§è¡Œæƒé™ chmod +x directory_extract.sh # è§£å†³å¯èƒ½å­˜åœ¨çš„æ¢è¡Œç¬¦é—®é¢˜ï¼ˆå¦‚æœéœ€è¦ï¼‰ sudo apt install dos2unix dos2unix directory_extract.sh # æ‰§è¡Œè„šæœ¬ # åˆ‡æ¢åˆ°éœ€è¦è§£å‹æ–‡ä»¶ç›®å½•å¹¶æ‰§è¡Œè§£å‹åˆ°æŒ‡å®šç›®å½• cd /mnt/test2 \u0026amp;\u0026amp; \\ /mnt/directory_extract.sh /mnt/test3 \u0026amp;\u0026amp; \\ tree /mnt/test3 è§£å‹è„šæœ¬çš„ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œåªéœ€æ›¿æ¢ç›¸åº”çš„è„šæœ¬åç§°å’ŒURLå³å¯ã€‚\nå››ã€ğŸ” æµ‹è¯•å‹ç¼©ä¸è§£å‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•æµç¨‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬è¿›è¡Œå‹ç¼©å’Œè§£å‹æ“ä½œï¼š ğŸ§ª 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶ 1 2 3 4 5 6 mkdir -p /mnt/{test1,test2,test3} \u0026amp;\u0026amp; \\ mkdir -p /mnt/test1/{aaa,bbb,ccc} \u0026amp;\u0026amp; \\ echo \u0026#34;æµ‹è¯•æ–‡ä»¶å†…å®¹\u0026#34; \u0026gt; /mnt/test1/aaa/test1.txt \u0026amp;\u0026amp; \\ echo \u0026#34;å¦ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶\u0026#34; \u0026gt; /mnt/test1/bbb/test2.txt \u0026amp;\u0026amp; \\ echo \u0026#34;ç¬¬ä¸‰ä¸ªæµ‹è¯•æ–‡ä»¶\u0026#34; \u0026gt; /mnt/test1/ccc/test3.txt \u0026amp;\u0026amp; \\ tree /mnt/test1 /mnt/test2 /mnt/test3 åˆå§‹æµ‹è¯•ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 root@debian13 / # tree /mnt/test1 /mnt/test2 /mnt/test3 /mnt/test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt /mnt/test2 /mnt/test3 ğŸ§ª 2. æµ‹è¯• å‹ç¼© è¿™é‡ŒæŒ‡å®šäº† ä¿ç•™æ•°é‡ 5ï¼Œé»˜è®¤æ˜¯ä¿ç•™æ•°é‡ 3ã€‚ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/directory_backup.sh) /mnt/test1 /mnt/test2 5 \u0026amp;\u0026amp; tree /mnt/test1 /mnt/test2 /mnt/test3 å®Œæˆ å‹ç¼© åçš„ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 root@debian13 / # tree /mnt/test1 /mnt/test2 /mnt/test3 /mnt/test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt /mnt/test2 â”œâ”€â”€ aaa_20250916_192217.tar.gz â”œâ”€â”€ bbb_20250916_192217.tar.gz â””â”€â”€ ccc_20250916_192217.tar.gz /mnt/test3 ğŸ§ª 3. æµ‹è¯•è§£å‹ 1 2 3 cd /mnt/test2 \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/directory_extract.sh) /mnt/test3/ \u0026amp;\u0026amp; \\ tree /mnt/test1 /mnt/test2 /mnt/test3 å®Œæˆ è§£å‹ åçš„ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 root@debian13 ~ # tree /mnt/test1 /mnt/test2 /mnt/test3 /mnt/test1 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt /mnt/test2 â”œâ”€â”€ aaa_20250916_191032.tar.gz â”œâ”€â”€ bbb_20250916_191032.tar.gz â””â”€â”€ ccc_20250916_191032.tar.gz /mnt/test3 â”œâ”€â”€ aaa â”‚ â””â”€â”€ test1.txt â”œâ”€â”€ bbb â”‚ â””â”€â”€ test2.txt â””â”€â”€ ccc â””â”€â”€ test3.txt ğŸ§ª 4. åˆ é™¤æµ‹è¯•æ–‡ä»¶ 1 2 3 cd .. \u0026amp;\u0026amp; \\ rm -rf /mnt/test1 /mnt/test2 /mnt/test3 \u0026amp;\u0026amp; \\ ls /mnt è¿™ä¸ªæµ‹è¯•æµç¨‹å±•ç¤ºäº†ï¼š\nåˆ›å»ºæµ‹è¯•ç›®å½•ç»“æ„å’Œæ–‡ä»¶ ä½¿ç”¨å¤‡ä»½è„šæœ¬å°†ç›®å½•å‹ç¼©ä¸ºå¤šä¸ªtar.gzæ–‡ä»¶ ä½¿ç”¨è§£å‹è„šæœ¬å°†è¿™äº›å‹ç¼©åŒ…è§£å‹åˆ°ç›®æ ‡ç›®å½• éªŒè¯è§£å‹ç»“æœæ˜¯å¦æ­£ç¡® é€šè¿‡è¿™ä¸ªå®Œæ•´çš„æµ‹è¯•æµç¨‹ï¼Œæ‚¨å¯ä»¥ç¡®ä¿è„šæœ¬æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”ç†è§£æ•´ä¸ªå‹ç¼©å’Œè§£å‹çš„è¿‡ç¨‹ã€‚ğŸ§ª\näº”ã€ğŸ”§ è„šæœ¬åŠŸèƒ½æ¦‚æ‹¬ directory_backup.sh æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨åŒ–å¤‡ä»½å½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰ééšè—å­ç›®å½• å¤‡ä»½æ ¼å¼ï¼šæ¯ä¸ªå­ç›®å½•å‹ç¼©ä¸ºå•ç‹¬çš„ ç›®å½•å-YYYY-MM-DD.tar.gz æ–‡ä»¶ é€‚ç”¨åœºæ™¯ï¼šå®šæœŸè‡ªåŠ¨åŒ–å¤‡ä»½ã€ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ã€è„šæœ¬é›†æˆå’Œæ‰¹å¤„ç†æ“ä½œ directory_extract.sh æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨è§£å‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å‹ç¼©åŒ…åˆ°æŒ‡å®šç›®å½• æ”¯æŒæ ¼å¼ï¼š.tar.gz, .tgz, .tar, .zip, .gz é€‚ç”¨åœºæ™¯ï¼šä»å¤‡ä»½æ¢å¤æ•°æ®ã€æ‰¹é‡å¤„ç†ä¸‹è½½çš„å‹ç¼©åŒ…ã€ç¯å¢ƒéƒ¨ç½² å…­ã€â° å®šæ—¶ä»»åŠ¡è®¾ç½® è®¾ç½®å®šæ—¶è‡ªåŠ¨å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 # ç¼–è¾‘å½“å‰ç”¨æˆ·çš„crontab crontab -e # æ·»åŠ ä»¥ä¸‹ä»»åŠ¡ç¤ºä¾‹ï¼š # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼Œä¿ç•™7ä¸ªå¤‡ä»½ 0 2 * * * bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/directory_backup.sh) /mnt/test2/ /mnt/test2/ 7 # æ¯å‘¨æ—¥å‡Œæ™¨1ç‚¹æ‰§è¡Œå¤‡ä»½ï¼Œä¿ç•™4ä¸ªå¤‡ä»½ 0 1 * * 0 /path/to/universal_backup.sh /home/user/documents /mnt/backup 4 # æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡å¤‡ä»½ 0 */6 * * * /path/to/universal_backup.sh /important/data /backups 10 æ—¥å¿—è®°å½•é…ç½® 1 2 3 4 5 # å°†è¾“å‡ºåŒæ—¶è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ 0 2 * * * /path/to/universal_backup.sh /var/www/html /backups 7 \u0026gt;\u0026gt; /var/log/backup.log 2\u0026gt;\u0026amp;1 # åªè®°å½•é”™è¯¯ä¿¡æ¯ 0 2 * * * /path/to/universal_backup.sh /var/www/html /backups 7 \u0026gt; /dev/null 2\u0026gt;\u0026gt; /var/log/backup-error.log ä¸ƒã€ğŸ’¡ ä½¿ç”¨åœºæ™¯ä¸å»ºè®® å¸¸è§ä½¿ç”¨åœºæ™¯ ğŸ”„ å®šæœŸæ•°æ®å¤‡ä»½ï¼šç»“åˆcronå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸå¤‡ä»½é‡è¦æ•°æ® ğŸšš é¡¹ç›®éƒ¨ç½²ï¼šå¿«é€Ÿè§£å‹å¤šä¸ªç»„ä»¶åŒ…åˆ°æŒ‡å®šç›®å½• ğŸ“¦ æ•°æ®è¿ç§»ï¼šå°†æ•°æ®æ‰“åŒ…åè¿ç§»åˆ°æ–°æœåŠ¡å™¨æˆ–æ–°ä½ç½® ğŸ›¡ï¸ ç‰ˆæœ¬å½’æ¡£ï¼šå®šæœŸåˆ›å»ºé¡¹ç›®æˆ–æ•°æ®çš„ç‰ˆæœ¬å¿«ç…§ å®ç”¨å»ºè®® ğŸ” æƒé™ç®¡ç†ï¼šç¡®ä¿è¿è¡Œè„šæœ¬çš„ç”¨æˆ·æœ‰è¶³å¤Ÿçš„è¯»å†™æƒé™ ğŸ’¾ ç©ºé—´æ£€æŸ¥ï¼šåœ¨æ‰§è¡Œå¤‡ä»½å‰æ£€æŸ¥ç›®æ ‡ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ ğŸ“ æ—¥å¿—ç›‘æ§ï¼šå…³æ³¨è„šæœ¬è¾“å‡ºï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†é”™è¯¯ ğŸ”„ æµ‹è¯•éªŒè¯ï¼šé¦–æ¬¡ä½¿ç”¨å‰åœ¨å°èŒƒå›´æµ‹è¯•ï¼ŒéªŒè¯è„šæœ¬è¡Œä¸ºç¬¦åˆé¢„æœŸ â° å®šæ—¶ä»»åŠ¡ï¼šä½¿ç”¨cronç­‰å·¥å…·è®¾ç½®å®šæœŸè‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ä»»åŠ¡ é«˜çº§æŠ€å·§ ç»“åˆå…¶ä»–å·¥å…·ï¼ˆå¦‚rsyncï¼‰å®ç°å¢é‡å¤‡ä»½ ä½¿ç”¨è„šæœ¬è¿”å›å€¼ï¼ˆexit codeï¼‰åœ¨è‡ªåŠ¨åŒ–æµç¨‹ä¸­åˆ¤æ–­æ‰§è¡Œç»“æœ é€šè¿‡é‡å®šå‘è¾“å‡ºä¿å­˜æ‰§è¡Œæ—¥å¿—ï¼š./script.sh /backup/dir \u0026gt; backup.log 2\u0026gt;\u0026amp;1 è¿™ä¸¤ä¸ªè„šæœ¬è™½ç„¶ç®€å•ï¼Œä½†åŠŸèƒ½å¼ºå¤§ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§å¤šæ•°æ—¥å¸¸å¤‡ä»½å’Œè§£å‹éœ€æ±‚ã€‚é€šè¿‡åˆç†ä½¿ç”¨ï¼Œå¯ä»¥æ˜¾è‘—æé«˜å·¥ä½œæ•ˆç‡å¹¶å‡å°‘äººä¸ºé”™è¯¯ã€‚ğŸ¯\nå¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆï¼å¸Œæœ›è¿™äº›è„šæœ¬èƒ½ä¸ºæ‚¨çš„å·¥ä½œå¸¦æ¥ä¾¿åˆ©ã€‚ ğŸ˜Š\n","date":"2025-09-15T02:11:51+08:00","image":"https://file.meimolihan.eu.org/img/linux-rar-01.webp","permalink":"https://blog.meimolihan.eu.org/p/47c699cb/","title":"Linux å­ç›®å½•åˆ†ç¦»å¤‡ä»½ä¸è§£å‹è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ“‚"},{"content":"Docker éƒ¨ç½² Halo åšå®¢ç³»ç»Ÿ-PostgreSQL âœ¨ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Halo åšå®¢ 1. åˆ›å»ºç›®å½•å¹¶ç¼–å†™ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 3. PostgreSQL ç‰ˆæœ¬ç®¡ç†ä¸éªŒè¯ ğŸ” ğŸš€ äºŒã€ä½¿ç”¨ Halo åšå®¢ 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ¯ 2. åŠŸèƒ½ç‰¹æ€§ âœ¨ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåˆ›ä½œï¼Œè¿æ¥ä¸–ç•Œ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Halo å®˜ç½‘åœ°å€ï¼š https://www.halo.run/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/halo-dev ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/halohub/halo Halo æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¼€æºåšå®¢/CMS ç³»ç»Ÿï¼ŒåŸºäº Java å’Œ Spring Boot æ„å»ºã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„ä¸»é¢˜å’Œæ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œè®©ç”¨æˆ·å¯ä»¥è½»æ¾åˆ›å»ºå’Œç®¡ç†è‡ªå·±çš„ç½‘ç«™ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ ä¸°å¯Œçš„ä¸»é¢˜é€‰æ‹© æ”¯æŒè‡ªå®šä¹‰è®¾è®¡ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ ğŸ”Œ æ’ä»¶ç”Ÿæ€ åŠŸèƒ½æ‰©å±•çµæ´» ç¤¾åŒºæ’ä»¶ä¸°å¯Œï¼Œæ»¡è¶³å„ç§éœ€æ±‚ ğŸ“ ç¼–è¾‘å™¨ å¯Œæ–‡æœ¬å’ŒMarkdownæ”¯æŒ å¼ºå¤§çš„å†…å®¹ç¼–è¾‘ä½“éªŒ ğŸ‘¥ ç”¨æˆ·ç®¡ç† å¤šç”¨æˆ·æƒé™æ§åˆ¶ æ”¯æŒå›¢é˜Ÿåä½œå’Œæƒé™ç®¡ç† ğŸ“Š æ•°æ®ç»Ÿè®¡ è®¿é—®ç»Ÿè®¡å’Œåˆ†æ æä¾›è¯¦ç»†çš„æ•°æ®åˆ†ææŠ¥å‘Š ğŸ” SEO ä¼˜åŒ– å†…ç½®SEOåŠŸèƒ½ æå‡æœç´¢å¼•æ“æ’åå’Œå¯è§åº¦ ğŸŒ å“åº”å¼è®¾è®¡ å¤šç«¯é€‚é… åœ¨æ‰‹æœºã€å¹³æ¿å’Œç”µè„‘ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ ğŸ³ Docker éƒ¨ç½² å®¹å™¨åŒ–éƒ¨ç½² ç®€å•ä¾¿æ·ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Halo åšå®¢ 1. åˆ›å»ºç›®å½•å¹¶ç¼–å†™ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 mkdir -p /mnt/mydisk/home/halo \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: halo: image: registry.fit2cloud.com/halo/halo:2 container_name: halo restart: on-failure:3 depends_on: halodb: condition: service_healthy networks: halo_network: volumes: - ./halo2:/root/.halo2 ports: - \u0026#34;8090:8090\u0026#34; healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8090/actuator/health/readiness\u0026#34;] interval: 30s timeout: 5s retries: 5 start_period: 30s environment: # JVM å‚æ•°ï¼Œé»˜è®¤ä¸º -Xmx256m -Xms256mï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µåšè°ƒæ•´ï¼Œç½®ç©ºè¡¨ç¤ºä¸æ·»åŠ  JVM å‚æ•° - JVM_OPTS=-Xmx256m -Xms256m command: - --spring.r2dbc.url=r2dbc:pool:postgresql://halodb/halo - --spring.r2dbc.username=halo # PostgreSQL çš„å¯†ç ï¼Œè¯·ä¿è¯ä¸ä¸‹æ–¹ POSTGRES_PASSWORD çš„å˜é‡å€¼ä¸€è‡´ã€‚ - --spring.r2dbc.password=openpostgresql - --spring.sql.init.platform=postgresql # å¤–éƒ¨è®¿é—®åœ°å€ï¼Œè¯·æ ¹æ®å®é™…éœ€è¦ä¿®æ”¹ - --halo.external-url=http://localhost:8090/ halodb: image: postgres:17.6 container_name: halodb restart: on-failure:3 networks: halo_network: volumes: - ./db:/var/lib/postgresql/data healthcheck: test: [ \u0026#34;CMD\u0026#34;, \u0026#34;pg_isready\u0026#34; ] interval: 10s timeout: 5s retries: 5 environment: - POSTGRES_PASSWORD=openpostgresql - POSTGRES_USER=halo - POSTGRES_DB=halo - PGUSER=halo networks: halo_network: name: halo_network driver: bridge # Haloåšå®¢_åå°åœ°å€ï¼šhttp://10.10.10.245:8090/console EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d 3. PostgreSQL ç‰ˆæœ¬ç®¡ç†ä¸éªŒè¯ ğŸ” å¦‚éœ€ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„ PostgreSQL é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢å¯ç”¨ç‰ˆæœ¬æ ‡ç­¾ï¼š 1 2 curl -sS \u0026#34;https://registry.hub.docker.com/v2/repositories/library/postgres/tags/?page_size=100\u0026#34; \\ | jq -r \u0026#39;.results[].name\u0026#39; | grep -E \u0026#39;^[0-9]+(\\.[0-9]+)?$\u0026#39; | sort -V éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ PostgreSQL ç‰ˆæœ¬ï¼š 1 docker exec -it halodb pg_config --version ğŸš€ äºŒã€ä½¿ç”¨ Halo åšå®¢ 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:8090/console æŒ‰ç…§é¡µé¢æç¤ºå®Œæˆåˆå§‹è®¾ç½®ï¼š åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· è®¾ç½®åšå®¢åŸºæœ¬ä¿¡æ¯ é€‰æ‹©åˆå§‹ä¸»é¢˜ 2. åŠŸèƒ½ç‰¹æ€§ âœ¨ ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ: ä¸°å¯Œçš„ä¸»é¢˜é€‰æ‹©ï¼Œæ”¯æŒè‡ªå®šä¹‰ ğŸ”Œ æ’ä»¶ç”Ÿæ€: æ‰©å±•åŠŸèƒ½ï¼Œæ»¡è¶³å„ç§éœ€æ±‚ ğŸ“ ç¼–è¾‘å™¨: å¼ºå¤§çš„å¯Œæ–‡æœ¬å’ŒMarkdownç¼–è¾‘å™¨ ğŸ‘¥ ç”¨æˆ·ç®¡ç†: å¤šç”¨æˆ·æ”¯æŒï¼Œæƒé™æ§åˆ¶ ğŸ“Š æ•°æ®ç»Ÿè®¡: è®¿é—®ç»Ÿè®¡å’Œå†…å®¹åˆ†æ ğŸ” SEO ä¼˜åŒ–: å†…ç½®SEOåŠŸèƒ½ï¼Œæå‡æœç´¢å¼•æ“æ’å ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://halo.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/halo.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name halo.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8090; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/halo # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop halo halodb docker start halo halodb docker restart halo halodb # åˆ é™¤å®¹å™¨ docker rm halo halodb # è¿›å…¥å®¹å™¨Shell docker exec -it halo sh docker exec -it halo bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs halo docker logs halodb docker logs -f halo docker logs --tail 50 halodb # ç›‘æ§èµ„æºä½¿ç”¨ docker stats halo halodb # æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect halo 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi halohub/halo:2.20.12 mysql:8.3.0 docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªåˆ›ä½œï¼Œè¿æ¥ä¸–ç•Œ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Halo åšå®¢ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâœï¸ è‡ªç”±è¡¨è¾¾ ä¹¦å†™æ‰€æƒ³ã€è®°å½•ç”Ÿæ´»ã€åˆ†äº«çŸ¥è¯†ï¼Œæ‰“é€ å±äºä½ è‡ªå·±çš„å†…å®¹å¤©åœ°\nğŸ¨ ä¸ªæ€§å®šåˆ¶ å€ŸåŠ©ä¸°å¯Œçš„ä¸»é¢˜ä¸æ’ä»¶ï¼Œæ„å»ºç‹¬ä¸€æ— äºŒçš„åšå®¢é£æ ¼ä¸åŠŸèƒ½\nğŸŒ å¹¿æ³›ä¼ æ’­ é€šè¿‡å¤šç«¯é€‚é…ä¸SEOä¼˜åŒ–ï¼Œè®©ä½ çš„å†…å®¹è¢«æ›´å¤šäººå‘ç°ä¸è®¤å¯\nğŸ¤ äº’åŠ¨äº¤æµ å¼€æ”¾è¯„è®ºä¸è®¢é˜…åŠŸèƒ½ï¼Œä¸è¯»è€…å»ºç«‹æ›´æ·±åº¦çš„è¿æ¥ä¸å¯¹è¯\nåšå®¢ä¸ä»…æ˜¯è®°å½•çš„å·¥å…·ï¼Œæ›´æ˜¯æ€æƒ³çš„è½½ä½“å’Œè¿æ¥çš„æ¡¥æ¢ã€‚æ„¿ Halo æˆä¸ºä½ ç•…æ‰€æ¬²è¨€ã€å±•ç¤ºè‡ªæˆ‘çš„æœ€ä½³ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªåˆ›ä½œçš„æ—¶åˆ»å’Œåˆ†äº«çš„ç¬é—´ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå‘å¸ƒä½ çš„ç¬¬ä¸€ç¯‡åšå®¢ï¼Œå‘ä¸–ç•Œå‘å‡ºä½ çš„å£°éŸ³å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®è®¢é˜… Halo å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¸»é¢˜æ’ä»¶ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ å†™ä½œæ„‰å¿«ï¼Œåšå®¢æœ‰æˆï¼ğŸ‰\n","date":"2025-09-14T22:34:16+08:00","image":"https://file.meimolihan.eu.org/img/halo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dc1ff918/","title":"Docker éƒ¨ç½² Halo åšå®¢ç³»ç»Ÿ-PostgreSQL âœ¨"},{"content":"Halo åšå®¢å‡çº§ MySQL æ•°æ®åº“æŒ‡å— ğŸš€ ğŸ“Œ å¯¼è¯»ï¼šæœ¬æ–‡è¯¦ç»†è®°å½•å°† Halo åšå®¢çš„ MySQL æ•°æ®åº“ä» 8.3.0 ç‰ˆæœ¬å®‰å…¨å‡çº§è‡³ 9.4.0 çš„å®Œæ•´æ“ä½œæµç¨‹ã€‚åŒ…å«ç‰ˆæœ¬è·¯çº¿è§„åˆ’ã€æ•°æ®å¤‡ä»½ã€å‡çº§å‚æ•°é…ç½®ã€å¥åº·æ£€æŸ¥åŠæ”¶å°¾æ“ä½œï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒä¸‹çš„å¹³æ»‘å‡çº§ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ å‡çº§èƒŒæ™¯ä¸æ³¨æ„äº‹é¡¹ ğŸ” ç‰ˆæœ¬å‡çº§è·¯çº¿ ğŸ“¦ å‡†å¤‡å·¥ä½œï¼šæŸ¥è¯¢å¯ç”¨ç‰ˆæœ¬æ ‡ç­¾ ğŸ’¾ å…³é”®ç¬¬ä¸€æ­¥ï¼šæ•´åº“é€»è¾‘å¤‡ä»½ï¼ˆå¿…åšï¼ï¼‰ âš™ï¸ è·¨ä¸»ç‰ˆæœ¬å‡çº§ï¼ˆ8.4.2 â†’ 9.0.1ï¼‰ ğŸ“ ä¿®æ”¹ Docker é•œåƒæ ‡ç­¾ âš’ï¸ æ·»åŠ ä¸´æ—¶å‡çº§å‚æ•° ğŸš€ æ‰§è¡Œå‡çº§æ“ä½œ âœ… å‡çº§çŠ¶æ€ç¡®è®¤ ğŸ”§ æ”¶å°¾å·¥ä½œ ğŸ’¡ å¸¸è§é—®é¢˜ä¸æ€»ç»“ âœ¨ å‡çº§èƒŒæ™¯ä¸æ³¨æ„äº‹é¡¹ MySQL 8.x è‡³ 9.x å±äºè·¨ä¸»ç‰ˆæœ¬å‡çº§ï¼Œæ¶‰åŠç³»ç»Ÿè¡¨å…ƒæ•°æ®æ ¼å¼å˜æ›´ä¸”å‡çº§è¿‡ç¨‹ä¸å¯é€†ã€‚ğŸ”´ é‡è¦æç¤ºï¼šç”Ÿäº§ç¯å¢ƒå‡çº§å‰åŠ¡å¿…å®Œæˆå…¨é‡é€»è¾‘å¤‡ä»½ï¼Œé¿å…æ•°æ®ä¸¢å¤±é£é™©ã€‚\nğŸ“ å‡çº§ç‰¹ç‚¹ï¼š\nâœ¨ æ€§èƒ½æå‡ï¼šMySQL 9.x ä¼˜åŒ–äº†æŸ¥è¯¢å¤„ç†å™¨ï¼Œå¤æ‚æŸ¥è¯¢æ€§èƒ½æå‡æ˜¾è‘—ï¼› ğŸ”’ å¢å¼ºå®‰å…¨ï¼šæ–°å¢è§’è‰²ç»§æ‰¿ã€å¯†ç éªŒè¯ç­–ç•¥å¼ºåŒ–ç­‰å®‰å…¨ç‰¹æ€§ï¼› ğŸ“Š JSONåŠŸèƒ½æ‰©å±•ï¼šJSONæ•°æ®ç±»å‹æ”¯æŒæ›´å¤šå‡½æ•°å’Œè·¯å¾„è¡¨è¾¾å¼ï¼› ğŸ’¾ å…¼å®¹æ€§ä¿éšœï¼š9.0 ç‰ˆæœ¬å…¼å®¹ 8.4 çš„æ•°æ®æ–‡ä»¶æ ¼å¼ï¼› âš ï¸ å‡çº§å•å‘æ€§ï¼šå‡çº§åä¼šæ›´æ–°ç³»ç»Ÿè¡¨ç»“æ„ä»¥æ”¯æŒæ–°ç‰¹æ€§ï¼Œä¸”ä¸å¯å›é€€ï¼› ğŸ”§ å‚æ•°è¦æ±‚ï¼šä»…é¦–æ¬¡å¯åŠ¨éœ€æ·»åŠ  --upgrade=FORCE å‚æ•°ï¼Œåç»­é‡å¯æ— éœ€æ­¤æ“ä½œã€‚ ğŸ” ç‰ˆæœ¬å‡çº§è·¯çº¿ æœ¬æ¬¡å‡çº§é‡‡ç”¨æ¸è¿›å¼è·¯å¾„ï¼Œç¡®ä¿å…¼å®¹æ€§ç¨³å®šï¼š\n1 8.3.0 â†’ 8.4.0 â†’ 8.4.2 â†’ 9.0.1 â†’ 9.4.0 ğŸ’¡ æç¤ºï¼šå»ºè®®é€æ­¥å‡çº§ï¼Œé¿å…è·¨å¤šä¸ªä¸»ç‰ˆæœ¬ç›´æ¥å‡çº§ï¼Œä»¥å‡å°‘æ„å¤–é”™è¯¯ã€‚æ¯ä¸ªä¸­é—´ç‰ˆæœ¬éƒ½è§£å†³äº†ç‰¹å®šçš„å…¼å®¹æ€§é—®é¢˜ï¼Œç¡®ä¿æ•°æ®è¿ç§»çš„å¹³ç¨³æ€§ã€‚\nğŸ“¦ å‡†å¤‡å·¥ä½œï¼šæŸ¥è¯¢å¯ç”¨ç‰ˆæœ¬æ ‡ç­¾ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºæ‰€æœ‰å®˜æ–¹ MySQL é•œåƒæ ‡ç­¾ï¼ˆ8.x å’Œ 9.x ç³»åˆ—ï¼‰ï¼Œå¹¶æŒ‰ç‰ˆæœ¬å·æ’åºï¼š\n1 2 3 4 5 # æŸ¥è¯¢å®˜æ–¹ä»“åº“æ‰€æœ‰ tagï¼ˆè¿”å› JSONï¼Œç”¨ jq è¿‡æ»¤æ›´çˆ½ï¼‰ docker run --rm quay.io/skopeo/stable list-tags docker://mysql \\ | jq -r \u0026#39;.Tags[]\u0026#39; \\ | grep -E \u0026#39;^[8-9]\\.\u0026#39; \\ | sort -V ğŸ” åŠŸèƒ½è¯´æ˜ï¼šæ­¤æ­¥éª¤ç¡®ä¿ä½ è·å–åˆ°å®˜æ–¹æ”¯æŒçš„æ‰€æœ‰ç‰ˆæœ¬æ ‡ç­¾ï¼Œé¿å…ä½¿ç”¨éç¨³å®šç‰ˆæˆ–å·²åºŸå¼ƒç‰ˆæœ¬ã€‚å»ºè®®ä¼˜å…ˆé€‰æ‹©æ ‡è®°ä¸º\u0026quot;latest\u0026quot;æˆ–\u0026quot;stable\u0026quot;çš„ç‰ˆæœ¬åˆ†æ”¯ã€‚\nğŸ’¾ å…³é”®ç¬¬ä¸€æ­¥ï¼šæ•´åº“é€»è¾‘å¤‡ä»½ï¼ˆå¿…åšï¼ï¼‰ âš ï¸ è­¦å‘Šï¼šè·³è¿‡å¤‡ä»½å¯èƒ½å¯¼è‡´æ•°æ®æ— æ³•å›é€€ï¼åŠ¡å¿…æ‰§è¡Œï¼š\n1 docker exec -it halodb mysqldump --all-databases --single-transaction -uroot -p\u0026#39;o#DwN\u0026amp;JSa56\u0026#39; \u0026gt; all_$(date +%F_%H-%M).sql ğŸ“Œ å‚æ•°è¯´æ˜ï¼š\n--single-transactionï¼šç¡®ä¿å¤‡ä»½æœŸé—´æ•°æ®ä¸€è‡´æ€§ï¼Œä½¿ç”¨äº‹åŠ¡éš”ç¦»æœºåˆ¶ï¼› -uroot -p'ä½ çš„å¯†ç 'ï¼šæŒ‰å®é™…æ•°æ®åº“å¯†ç ä¿®æ”¹ï¼Œå»ºè®®ä½¿ç”¨é…ç½®æ–‡ä»¶é¿å…å¯†ç æš´éœ²ï¼› å¤‡ä»½æ–‡ä»¶å‘½ååŒ…å«æ—¶é—´æˆ³ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†ï¼› ğŸ”’ å®‰å…¨å»ºè®®ï¼šå¤‡ä»½å®Œæˆåå°†å¤‡ä»½æ–‡ä»¶ä¼ è¾“åˆ°è¿œç¨‹å­˜å‚¨æˆ–ä¸åŒç‰©ç†è®¾å¤‡ã€‚ ğŸ’¡ æ‰©å±•åŠŸèƒ½ï¼šè€ƒè™‘ä½¿ç”¨è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬ï¼Œå®šæœŸæ‰§è¡Œå¹¶ä¿ç•™å¤šä¸ªå¤‡ä»½ç‰ˆæœ¬ï¼š\n1 2 3 4 5 6 #!/bin/bash BACKUP_DIR=\u0026#34;/path/to/backup\u0026#34; mkdir -p $BACKUP_DIR docker exec halodb mysqldump --all-databases --single-transaction -uroot -p\u0026#39;password\u0026#39; | gzip \u0026gt; $BACKUP_DIR/all_$(date +%F_%H-%M).sql.gz # ä¿ç•™æœ€è¿‘7å¤©å¤‡ä»½ find $BACKUP_DIR -name \u0026#34;*.sql.gz\u0026#34; -mtime +7 -delete âš™ï¸ è·¨ä¸»ç‰ˆæœ¬å‡çº§ï¼ˆ8.4.2 â†’ 9.0.1ï¼‰ ğŸ“ ä¿®æ”¹ Docker é•œåƒæ ‡ç­¾ ç¼–è¾‘ docker-compose.ymlï¼Œå°† MySQL é•œåƒæ ‡ç­¾æ”¹ä¸ºç›®æ ‡ç‰ˆæœ¬ï¼š\n1 nano docker-compose.yml 1 2 3 4 5 # ä¿®æ”¹å‰ image: mysql:8.4.2 # ä¿®æ”¹å image: mysql:9.0.1 ğŸ“ æ³¨æ„ï¼šç¡®ä¿ä½¿ç”¨çš„é•œåƒæ ‡ç­¾å­˜åœ¨ä¸”ä¸ºå®˜æ–¹ç¨³å®šç‰ˆæœ¬ï¼Œé¿å…ä½¿ç”¨latestæ ‡ç­¾å¯èƒ½å¯¼è‡´çš„ä¸å…¼å®¹é—®é¢˜ã€‚\nâš’ï¸ æ·»åŠ ä¸´æ—¶å‡çº§å‚æ•° åœ¨ command éƒ¨åˆ†ä¸´æ—¶æ·»åŠ  --upgrade=FORCE å‚æ•°ï¼š\n1 2 3 4 5 command: - --upgrade=FORCE - --character-set-server=utf8mb4 - --collation-server=utf8mb4_general_ci - --explicit_defaults_for_timestamp=true ğŸ”§ å‚æ•°è¯¦è§£ï¼š\n--upgrade=FORCEï¼šå¼ºåˆ¶å‡çº§ç³»ç»Ÿè¡¨ç»“æ„ï¼Œå¿…éœ€å‚æ•°ï¼› --character-set-server=utf8mb4ï¼šç¡®ä¿å­—ç¬¦é›†ä¸Haloåšå®¢å…¼å®¹ï¼› --collation-server=utf8mb4_general_ciï¼šè®¾ç½®æ­£ç¡®çš„æ’åºè§„åˆ™ï¼› --explicit_defaults_for_timestamp=trueï¼šè§£å†³TIMESTAMPå­—æ®µçš„å…¼å®¹æ€§é—®é¢˜ã€‚ ğŸš€ æ‰§è¡Œå‡çº§æ“ä½œ æ‹‰å–æ–°ç‰ˆæœ¬é•œåƒï¼š\n1 docker compose pull halodb å¯åŠ¨å‡çº§ï¼š\n1 docker compose up -d halodb è§‚å¯Ÿå‡çº§æ—¥å¿—ï¼ˆè€—æ—¶çº¦ 1-3 åˆ†é’Ÿï¼‰ï¼š\n1 timeout 180 docker compose logs -f halodb âœ… æˆåŠŸæ ‡å¿—ï¼šå‡ºç° [Server] /usr/sbin/mysqld: ready for connections. Version: '9.0.1' ä¸”çŠ¶æ€è½¬ä¸º healthyã€‚\nğŸ“Š å‡çº§è¿‡ç¨‹ç›‘æ§ï¼šå‡çº§æœŸé—´MySQLä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\næ£€æŸ¥ç°æœ‰æ•°æ®æ–‡ä»¶çš„å…¼å®¹æ€§ å‡çº§ç³»ç»Ÿè¡¨ï¼ˆmysql.*ï¼‰åˆ°æ–°æ ¼å¼ æ›´æ–°æ€§èƒ½ schema å’Œ information_schema éªŒè¯æ‰€æœ‰æ•°æ®åº“å¯¹è±¡çš„å®Œæ•´æ€§ âœ… å‡çº§çŠ¶æ€ç¡®è®¤ æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼š\n1 docker compose ps halodb æ‰‹åŠ¨å¥åº·æ£€æŸ¥ï¼ˆå¦‚æœçŠ¶æ€æœªæ›´æ–°ï¼‰ï¼š\n1 2 docker exec halodb mysqladmin ping -h127.0.0.1 -uroot -p\u0026#39;o#DwN\u0026amp;JSa56\u0026#39; --silent echo $? # è¿”å› 0 è¡¨ç¤ºæ•°æ®åº“æ­£å¸¸è¿è¡Œ éªŒè¯ç‰ˆæœ¬å·ï¼š\n1 docker exec -it halodb mysql -uroot -p\u0026#39;o#DwN\u0026amp;JSa56\u0026#39; -e \u0026#34;SELECT @@version;\u0026#34; ğŸ“Œ è¾“å‡ºåº”ä¸ºï¼š9.0.1\næ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§ï¼š\n1 docker exec -it halodb mysqlcheck -uroot -p\u0026#39;o#DwN\u0026amp;JSa56\u0026#39; --all-databases ğŸ”§ æ”¶å°¾å·¥ä½œ å‡çº§å®ŒæˆååŠ¡å¿…åˆ é™¤ä¸´æ—¶å‚æ•° --upgrade=FORCEï¼Œé¿å…ä¸‹æ¬¡é‡å¯å†æ¬¡æ‰§è¡Œå‡çº§æµç¨‹ï¼š\nç¼–è¾‘ docker-compose.ymlï¼Œåˆ é™¤ --upgrade=FORCE è¡Œï¼›\né‡æ–°éƒ¨ç½²ï¼š\n1 docker compose up -d éªŒè¯å¸¸è§„å¯åŠ¨ï¼š\n1 docker compose logs halodb | grep -i \u0026#34;upgrade\u0026#34; ğŸš« ä¸åº”å‡ºç°ä»»ä½•ä¸upgradeç›¸å…³çš„æ—¥å¿—ä¿¡æ¯ã€‚\nğŸ’¡ å¸¸è§é—®é¢˜ä¸æ€»ç»“ â“ Q1ï¼šå‡çº§å¤±è´¥å¦‚ä½•å›é€€ï¼Ÿ\nAï¼šä½¿ç”¨å¤‡ä»½æ–‡ä»¶è¿˜åŸè‡³æ—§ç‰ˆæœ¬ MySQL å®¹å™¨ï¼Œæ‰§è¡Œï¼š\n1 cat all_2023-11-10_12-00.sql | docker exec -i halodb mysql -uroot -p\u0026#39;å¯†ç \u0026#39; â“ Q2ï¼šå‡çº§å Halo åšå®¢æ— æ³•è¿æ¥æ•°æ®åº“ï¼Ÿ\nAï¼šæ£€æŸ¥æ•°æ®åº“å­—ç¬¦é›†é…ç½®æ˜¯å¦ä¸ Halo è¦æ±‚ä¸€è‡´ï¼ˆé€šå¸¸ä¸º utf8mb4ï¼‰ï¼Œå¹¶éªŒè¯ç½‘ç»œè¿æ¥ã€‚åŒæ—¶æ£€æŸ¥MySQLç”¨æˆ·æƒé™æ˜¯å¦æ­£å¸¸ã€‚\nâ“ Q3ï¼šå‡çº§è¿‡ç¨‹ä¸­æ–­æ€ä¹ˆåŠï¼Ÿ\nAï¼šMySQL 9.x å…·å¤‡å‡çº§äº‹åŠ¡å®Œæ•´æ€§ï¼Œä¸­æ–­åä¼šè‡ªåŠ¨å›æ»šã€‚æ£€æŸ¥æ—¥å¿—ç¡®å®šä¸­æ–­åŸå› ï¼Œè§£å†³é—®é¢˜åé‡æ–°å¯åŠ¨å‡çº§æµç¨‹ã€‚\nâ“ Q4ï¼šå‡çº§åæ€§èƒ½ä¸‹é™æ€ä¹ˆåŠï¼Ÿ\nAï¼šè¿è¡Œ mysql_upgrade å‘½ä»¤ä¼˜åŒ–è¡¨ç»“æ„ï¼Œå¹¶é‡æ–°ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯ï¼š\n1 docker exec halodb mysql_upgrade -uroot -p\u0026#39;å¯†ç \u0026#39; ğŸ¯ æ€»ç»“ï¼š\nğŸ“‹ è·¨ä¸»ç‰ˆæœ¬å‡çº§éœ€è°¨æ…æ“ä½œï¼Œå¤‡ä»½ä¼˜å…ˆï¼› âš™ï¸ é€šè¿‡ --upgrade=FORCE å‚æ•°è§¦å‘å…ƒæ•°æ®å‡çº§ï¼› ğŸ”§ æ”¶å°¾æ—¶ç§»é™¤ä¸´æ—¶å‚æ•°ï¼Œé¿å…é‡å¤å‡çº§ï¼› ğŸ§ª å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒæ¼”ç»ƒåå†å‡çº§ç”Ÿäº§ç¯å¢ƒï¼› ğŸ“Š å‡çº§åç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼Œç¡®ä¿ç¨³å®šè¿è¡Œã€‚ ğŸ”— ç›¸å…³èµ„æºï¼š MySQL å®˜æ–¹å‡çº§æ–‡æ¡£ ğŸ’¬ é—®é¢˜åé¦ˆï¼šå¦‚é‡åˆ°æœ¬æ–‡æœªè¦†ç›–çš„é—®é¢˜ï¼Œè¯·æŸ¥çœ‹MySQLå®˜æ–¹æ—¥å¿—æˆ–ç¤¾åŒºæ”¯æŒ\n","date":"2025-09-14T18:01:31+08:00","image":"https://file.meimolihan.eu.org/img/mysql-01.webp","permalink":"https://blog.meimolihan.eu.org/p/bb8f42d6/","title":"Halo åšå®¢å‡çº§ MySQL æ•°æ®åº“æŒ‡å— ğŸš€"},{"content":"Debian13 æœåŠ¡å™¨æ–‡ä»¶å¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ“‚ æœ¬æ–‡æä¾› Debian13 æœåŠ¡å™¨æ–‡ä»¶å¤‡ä»½ä¸æ¢å¤çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–å¤šç§åŒæ­¥æ–¹æ³•ä¸è¯¦ç»†æ“ä½œæŒ‡å—ï¼ŒåŠ©æ‚¨æ„å»ºå¯é çš„æ•°æ®ä¿æŠ¤ç­–ç•¥ã€‚\nå¯¼èˆªç›®å½• ğŸ“š ğŸ“¦ ä¸€ ã€å¤‡ä»½çš„é‡è¦æ€§ä¸ç­–ç•¥ ğŸ“¦ äºŒã€å¤‡ä»½æ“ä½œæŒ‡å— ğŸ”§ 1. æœ¬åœ° rsync åŒæ­¥å¤‡ä»½ ğŸš€ 2. scp è¿œç¨‹åŒæ­¥å¤‡ä»½ âš¡ 3. rsync è¿œç¨‹åŒæ­¥å¤‡ä»½ ğŸ”„ ä¸‰ã€æ¢å¤æ“ä½œæŒ‡å— ğŸ“Œ 1. ä»æœ¬åœ°å¤‡ä»½æ¢å¤ ğŸ“Œ 2. ä»è¿œç¨‹å¤‡ä»½æ¢å¤ ğŸ“Š å››ã€ä¸‰ç§æ–¹æ³•å¯¹æ¯”åˆ†æ ğŸ’¡ äº”ã€å¤‡ä»½æœ€ä½³å®è·µ ä¸€ã€ğŸ“¦ å¤‡ä»½çš„é‡è¦æ€§ä¸ç­–ç•¥ æ•°æ®æ˜¯æœåŠ¡å™¨ä¸­æœ€å®è´µçš„èµ„äº§ï¼Œåˆç†çš„å¤‡ä»½ç­–ç•¥å¯ä»¥é˜²æ­¢ä»¥ä¸‹é£é™©ï¼š\nğŸ”´ ç¡¬ä»¶æ•…éšœï¼šç£ç›˜æŸåã€æœåŠ¡å™¨å®•æœº ğŸ”´ äººä¸ºé”™è¯¯ï¼šè¯¯åˆ é™¤ã€é”™è¯¯é…ç½® ğŸ”´ å®‰å…¨äº‹ä»¶ï¼šå‹’ç´¢è½¯ä»¶ã€é»‘å®¢æ”»å‡» ğŸ”´ è‡ªç„¶ç¾å®³ï¼šç«ç¾ã€æ´ªæ°´ç­‰ä¸å¯æŠ—åŠ› å¤‡ä»½ 3-2-1 åŸåˆ™ï¼šè‡³å°‘ä¿ç•™ 3 ä¸ªæ•°æ®å‰¯æœ¬ï¼Œä½¿ç”¨ 2 ç§ä¸åŒä»‹è´¨ï¼Œå…¶ä¸­ 1 ä»½ä¸ºå¼‚åœ°å¤‡ä»½ã€‚\näºŒã€ğŸ“¦ å¤‡ä»½æ“ä½œæŒ‡å— 1.ğŸ”§ æœ¬åœ° rsync åŒæ­¥å¤‡ä»½ rsync æ˜¯ Linux ä¸‹å¼ºå¤§çš„æ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œæ”¯æŒå¢é‡å¤‡ä»½å’Œå±æ€§ä¿ç•™ã€‚ æµ‹è¯•åŒæ­¥ï¼ˆå¹²è·‘æ¨¡å¼ï¼‰\n1 2 3 rsync -avhzL --progress --delete-delay --dry-run \\ /etc/nginx/ \\ \u0026#34;/mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/\u0026#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ğŸ“Œ åŒæ­¥ nginx ä¸»ç›®å½• rsync -avhz --progress --delete-delay --mkpath \\ /etc/nginx/ \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ #ğŸ“Œ åŒæ­¥ html ç›®å½• rsync -avzh --progress --delete-delay --mkpath \\ /var/www/html/ \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/ # ğŸ“Œ åŒæ­¥æ–‡ä»¶æœåŠ¡ç›®å½• rsync -avzh --progress --delete-delay --mkpath \\ /mnt/file/ \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ âœ¨ å‚æ•°è¯´æ˜ï¼š\n-aï¼šå½’æ¡£æ¨¡å¼ï¼Œä¿ç•™æ–‡ä»¶å±æ€§ -vï¼šè¯¦ç»†è¾“å‡º -hï¼šäººç±»å¯è¯»æ ¼å¼ -zï¼šå‹ç¼©ä¼ è¾“ --progressï¼šæ˜¾ç¤ºä¼ è¾“è¿›åº¦ --delete-delayï¼šåŒæ­¥ååˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶ --mkpathï¼šè‡ªåŠ¨åˆ›å»ºç›®æ ‡è·¯å¾„ âœ… æ•ˆæœï¼š å®Œç¾åŒæ­¥æ‰€æœ‰éšè—æ–‡ä»¶ã€‚ âœ¨ åŸå› ï¼š -a (archive) å‚æ•°åŒ…å«äº† -r (recursive)ï¼Œå®ƒä¼šé€’å½’å¤åˆ¶æºç›®å½• /etc/nginx/ ä¸‹çš„æ‰€æœ‰å†…å®¹å’Œå­ç›®å½•ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ã€‚è¿™æ˜¯ rsync çš„é»˜è®¤è¡Œä¸ºï¼Œä¹Ÿæ˜¯æœ€å¯é çš„æ–¹å¼ã€‚\n2.ğŸš€ scp è¿œç¨‹åŒæ­¥å¤‡ä»½ scp åŸºäº SSH åè®®ï¼Œé€‚åˆç®€å•çš„æ–‡ä»¶ä¼ è¾“ä»»åŠ¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ğŸ“Œ åŒæ­¥ nginx ä¸»ç›®å½• scp -P 22 -r \\ /etc/nginx/. \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ # ğŸ“Œ åŒæ­¥ html ç›®å½• scp -P 22 -r \\ /var/www/html/. \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/ # ğŸ“Œ åŒæ­¥æ–‡ä»¶æœåŠ¡ç›®å½• scp -P 22 -r \\ /mnt/file/ \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ âœ¨ å‚æ•°è¯´æ˜ï¼š\n-P 22ï¼šæŒ‡å®š SSH ç«¯å£ï¼ˆé»˜è®¤22å¯çœç•¥ï¼‰ -rï¼šé€’å½’å¤åˆ¶æ•´ä¸ªç›®å½• . ä¸ / çš„åŒºåˆ«ï¼šä½¿ç”¨ /etc/nginx/. å¯åŒ…å«éšè—æ–‡ä»¶ âœ… æ•ˆæœï¼š å¯ä»¥åŒæ­¥éšè—æ–‡ä»¶ã€‚\nâœ¨ åŸå› ï¼š å…³é”®åœ¨äºæ‚¨æºè·¯å¾„çš„å†™æ³• /etc/nginx/.ã€‚æœ«å°¾çš„ /. æ˜ç¡®å‘Šè¯‰ SCP å‘½ä»¤â€œå¤åˆ¶è¿™ä¸ªç›®å½•é‡Œé¢çš„æ‰€æœ‰å†…å®¹â€ï¼Œè€Œä¸ä»…ä»…æ˜¯ç›®å½•æœ¬èº«ã€‚è¿™ä¸ªè¯­æ³•åŒ…å«äº†æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬éšè—çš„ã€‚ âš ï¸ æ³¨æ„ï¼š å¦‚æœæ‚¨å°†å‘½ä»¤å†™æˆ /etc/nginx æˆ– /etc/nginx/ï¼ˆæ²¡æœ‰æœ€åçš„ .ï¼‰ï¼ŒSCP å°†æ— æ³•åŒæ­¥éšè—æ–‡ä»¶ã€‚æ‚¨çš„å†™æ³•æ˜¯æ­£ç¡®çš„ã€‚ 3.âš¡ rsync è¿œç¨‹åŒæ­¥å¤‡ä»½ rsync è¿œç¨‹æ¨¡å¼ç»“åˆäº†æœ¬åœ°åŒæ­¥çš„é«˜æ•ˆå’Œè¿œç¨‹æ“ä½œçš„ä¾¿åˆ©æ€§ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ğŸ“Œ åŒæ­¥ nginx ä¸»ç›®å½• rsync -avzP \\ /etc/nginx/ \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ # ğŸ“Œ åŒæ­¥ html ç›®å½• rsync -avzP \\ /var/www/html/ \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/ # ğŸ“Œ åŒæ­¥æ–‡ä»¶æœåŠ¡ç›®å½• rsync -avzP \\ /mnt/file/ \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ âœ¨ å‚æ•°è¯´æ˜ï¼š\n-Pï¼šç­‰åŒäº --partial --progressï¼ˆä¿ç•™éƒ¨åˆ†æ–‡ä»¶å¹¶æ˜¾ç¤ºè¿›åº¦ï¼‰ -zï¼šå‹ç¼©ä¼ è¾“ï¼ŒèŠ‚çœå¸¦å®½ âœ… æ•ˆæœï¼š å®Œç¾åŒæ­¥æ‰€æœ‰éšè—æ–‡ä»¶ã€‚\nâœ¨ åŸå› ï¼š å’Œæœ¬åœ° rsync ä¸€æ ·ï¼Œ-a å‚æ•°ä¿è¯äº†å®ƒä¼šé€’å½’å¤„ç†æºç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ã€‚è¿™æ˜¯åŒæ­¥éšè—æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æœ€ä½³æ–¹å¼ã€‚ ä¸‰ã€ğŸ”„ æ¢å¤æ“ä½œæŒ‡å— 1. ğŸ“Œ ä»æœ¬åœ°å¤‡ä»½æ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ¢å¤ nginx é…ç½® rsync -avzh --progress --mkpath \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ \\ /etc/nginx/ # æ¢å¤ç½‘ç«™æ–‡ä»¶ rsync -avzh --progress --mkpath \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/ \\ /var/www/html/ # æ¢å¤æ–‡ä»¶æœåŠ¡ rsync -avzh --progress --mkpath \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ \\ /mnt/file/ 2. ğŸ“Œ ä»è¿œç¨‹å¤‡ä»½æ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨ rsync ä»è¿œç¨‹æ¢å¤ nginx é…ç½® rsync -avzP \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ \\ /etc/nginx/ # ä½¿ç”¨ scp ä»è¿œç¨‹æ¢å¤ç½‘ç«™æ–‡ä»¶ scp -P 22 -r \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/. \\ /var/www/html/ # ä½¿ç”¨ rsync ä»è¿œç¨‹æ¢å¤æ–‡ä»¶æœåŠ¡ rsync -avzP \\ root@10.10.10.251:/vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ \\ /mnt/file/ âš ï¸ é‡è¦æç¤ºï¼šæ¢å¤æ“ä½œä¼šè¦†ç›–ç›®æ ‡ç›®å½•ä¸­çš„ç°æœ‰æ–‡ä»¶ï¼Œæ‰§è¡Œå‰è¯·åŠ¡å¿…ï¼š\nç¡®è®¤å¤‡ä»½æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ å¯¹å½“å‰çŠ¶æ€åšä¸€æ¬¡å¿«ç…§å¤‡ä»½ åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ¢å¤æµç¨‹ å››ã€ğŸ“Š ä¸‰ç§æ–¹æ³•å¯¹æ¯”åˆ†æ ç‰¹æ€§ç»´åº¦ ğŸ”§ æœ¬åœ° rsync åŒæ­¥ ğŸš€ scp è¿œç¨‹åŒæ­¥ âš¡ rsync è¿œç¨‹åŒæ­¥ é€Ÿåº¦æ€§èƒ½ â­â­â­â­â­\næå¿«ï¼ˆæ— ç½‘ç»œå»¶è¿Ÿï¼‰ â­â­â˜†â˜†â˜†\nè¾ƒæ…¢ï¼ˆå…¨é‡ä¼ è¾“ï¼‰ â­â­â­â­â˜†\nå¾ˆå¿«ï¼ˆå¢é‡åŒæ­¥ï¼‰ å¸¦å®½æ•ˆç‡ ä¸å ç”¨ç½‘ç»œå¸¦å®½ æ•ˆç‡ä½ï¼ˆå…¨é‡ä¼ è¾“ï¼‰ æ•ˆç‡é«˜ï¼ˆåªä¼ å·®å¼‚éƒ¨åˆ†ï¼‰ å±æ€§ä¿ç•™ å®Œç¾ä¿ç•™æ‰€æœ‰å±æ€§ é»˜è®¤ä¸ä¿ç•™æ‰€æœ‰å±æ€§ å®Œç¾ä¿ç•™æ‰€æœ‰å±æ€§ å¯é æ€§ é«˜ é«˜ï¼ˆåŸºäºSSHï¼‰ é«˜ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰ æ˜“ç”¨æ€§ ä¸­ç­‰ï¼ˆéœ€æŒ‚è½½è¿œç¨‹ç›®å½•ï¼‰ éå¸¸ç®€å•ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰ ä¸­ç­‰ï¼ˆå‘½ä»¤ç¨å¤æ‚ï¼‰ é€‚ç”¨åœºæ™¯ å·²æŒ‚è½½NASçš„æ—¥å¸¸å¤‡ä»½ ä¸´æ—¶å°‘é‡æ–‡ä»¶ä¼ è¾“ å¸¸è§„è¿œç¨‹å¼‚åœ°å¤‡ä»½ é€‰æ‹©å»ºè®®ï¼š\nğŸ  æœ¬åœ° rsyncï¼šé€‚åˆå·²å°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ°æœ¬åœ°çš„æ—¥å¸¸è‡ªåŠ¨åŒ–å¤‡ä»½ ğŸš€ scpï¼šé€‚åˆä¸´æ—¶ä¼ è¾“å°‘é‡æ–‡ä»¶ï¼Œç®€å•å¿«æ· âš¡ è¿œç¨‹ rsyncï¼šé€‚åˆè®¾ç½®å®šæœŸè¿œç¨‹å¤‡ä»½ä»»åŠ¡ï¼Œæ•ˆç‡æœ€é«˜ äº”ã€ğŸ’¡ å¤‡ä»½æœ€ä½³å®è·µ 1. è‡ªåŠ¨åŒ–å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 # æ¯æ—¥å‡Œæ™¨2ç‚¹è‡ªåŠ¨å¤‡ä»½nginxé…ç½® 0 2 * * * /usr/bin/rsync -avz --delete /etc/nginx/ /mnt/backup/nginx/ # æ¯å‘¨æ—¥å‡Œæ™¨1ç‚¹å…¨é‡å¤‡ä»½ 0 1 * * 0 /root/scripts/full-backup.sh 2. å¤šç‰ˆæœ¬å¤‡ä»½ç­–ç•¥ ä¿ç•™å¤šä¸ªæ—¶é—´ç‚¹çš„å¤‡ä»½ç‰ˆæœ¬ï¼š\nä¿ç•™æœ€è¿‘7å¤©çš„æ¯æ—¥å¤‡ä»½ ä¿ç•™æœ€è¿‘4å‘¨çš„æ¯å‘¨å¤‡ä»½ ä¿ç•™æœ€è¿‘3ä¸ªæœˆçš„æœˆåº¦å¤‡ä»½ 3. å¤‡ä»½éªŒè¯ç­–ç•¥ å®šæœŸæ£€æŸ¥å¤‡ä»½çš„æœ‰æ•ˆæ€§ï¼š\n1 2 3 4 5 # æ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§ rsync -n -avhi --delete /mnt/backup/nginx/ /etc/nginx/ | head -20 # éšæœºæ¢å¤æµ‹è¯• mkdir /tmp/backup-test \u0026amp;\u0026amp; rsync -av /mnt/backup/html/ /tmp/backup-test/ 4. å®‰å…¨åŠ å›ºæªæ–½ ğŸ” å¯¹æ•æ„Ÿæ•°æ®åŠ å¯†å¤‡ä»½ ğŸ‘® ä¸¥æ ¼æ§åˆ¶å¤‡ä»½ç›®å½•æƒé™ ğŸ“ è¯¦ç»†è®°å½•å¤‡ä»½æ—¥å¿— ğŸš¨ è®¾ç½®å¤‡ä»½å¤±è´¥å‘Šè­¦æœºåˆ¶ 5. ç›‘æ§ä¸å‘Šè­¦ è®¾ç½®ç›‘æ§é¡¹ï¼š\nå¤‡ä»½ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ å¤‡ä»½æ–‡ä»¶å¤§å°å˜åŒ– å¤‡ä»½å­˜å‚¨ç©ºé—´ä½¿ç”¨ç‡ æœ€åä¸€æ¬¡æˆåŠŸå¤‡ä»½æ—¶é—´ ğŸ’ æ ¸å¿ƒå»ºè®®ï¼šæ²¡æœ‰å®Œç¾çš„å¤‡ä»½æ–¹æ¡ˆï¼Œåªæœ‰é€‚åˆçš„å¤‡ä»½ç­–ç•¥ã€‚æœ€é‡è¦çš„æ˜¯å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹ï¼Œç¡®ä¿åœ¨éœ€è¦æ—¶èƒ½å¤Ÿå¿«é€Ÿå¯é åœ°æ¢å¤æ•°æ®ã€‚\n","date":"2025-09-14T12:12:02+08:00","image":"https://file.meimolihan.eu.org/img/debian-backup-01.webp","permalink":"https://blog.meimolihan.eu.org/p/71755175/","title":"Debian13 æœåŠ¡å™¨æ–‡ä»¶å¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ“‚"},{"content":"Nginx é…ç½®å¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ” ä¸ºç¡®ä¿æ‚¨çš„ Nginx æœåŠ¡å™¨ç¨³å®šè¿è¡Œï¼Œå®šæœŸå¤‡ä»½å’ŒæŒæ¡æ¢å¤æ–¹æ³•è‡³å…³é‡è¦ã€‚æœ¬æ–‡å…¨é¢ä»‹ç»äº†å¤šç§ Nginx å¤‡ä»½ä¸æ¢å¤ç­–ç•¥ï¼Œä»ç®€å•çš„å‹ç¼©å¤‡ä»½åˆ°é«˜æ•ˆçš„åŒæ­¥æ–¹æ¡ˆï¼ŒåŠ©æ‚¨æ„å»ºå®Œæ•´çš„æ•°æ®ä¿æŠ¤ä½“ç³»ã€‚\nğŸ“š æ–‡ç« å¯¼èˆªç›®å½• ğŸ’¡ å‰è¨€ï¼šä¸ºä½•éœ€è¦å¤‡ä»½ Nginxï¼Ÿ ğŸ“¦ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ ZIP å‹ç¼©å¤‡ä»½ âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ”§ æ“ä½œå‘½ä»¤ ğŸ—‚ï¸ æ–¹æ³•äºŒï¼šä½¿ç”¨ TAR.GZ å‹ç¼©å¤‡ä»½ âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ”§ æ“ä½œå‘½ä»¤ ğŸ”„ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Rsync åŒæ­¥å¤‡ä»½ âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ”§ æ“ä½œå‘½ä»¤ ğŸ“Š å¤‡ä»½æ–¹æ³•æ€»ç»“ä¸å¯¹æ¯” ğŸ›¡ï¸ æ¢å¤å‰çš„å‡†å¤‡å·¥ä½œ ğŸ“¤ ä»å„ç§å¤‡ä»½æ¢å¤ ä» ZIP å¤‡ä»½æ¢å¤ æ“ä½œå‘½ä»¤ ä» TAR.GZ å¤‡ä»½æ¢å¤ æ“ä½œå‘½ä»¤ ä¸åŒå‹ç¼©æ–¹å¼çš„æ¢å¤åœºæ™¯ ä» Rsync å¤‡ä»½æ¢å¤ æ“ä½œå‘½ä»¤ é‡è¦è­¦å‘Š âœ… æ¢å¤åçš„å¿…è¦æ“ä½œ ğŸš¨ æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ ğŸ¯ å®Œæ•´å¤‡ä»½ä¸æ¢å¤æµç¨‹æ€»ç»“ ğŸ’¡ å‰è¨€ï¼šä¸ºä½•éœ€è¦å¤‡ä»½ Nginxï¼Ÿ Nginx çš„é…ç½®æ˜¯å…¶æ ¸å¿ƒï¼ŒåŒ…å«äº†ç½‘ç«™åŸŸåã€åå‘ä»£ç†è§„åˆ™ã€è´Ÿè½½å‡è¡¡è®¾ç½®ã€SSL è¯ä¹¦è·¯å¾„ç­‰å…³é”®ä¿¡æ¯ã€‚ä¸€æ—¦å› ä¸ºè¯¯æ“ä½œã€æœåŠ¡å™¨ç£ç›˜æ•…éšœæˆ–è½¯ä»¶å†²çªå¯¼è‡´é…ç½®ä¸¢å¤±æˆ–æŸåï¼Œå¯èƒ½ä¼šé€ æˆæœåŠ¡é•¿æ—¶é—´ä¸­æ–­ã€‚å®šæœŸå¤‡ä»½å¯ä»¥å¸®åŠ©æ‚¨ï¼š\nå¿«é€Ÿæ¢å¤ âš¡ï¼šåœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œè¿…é€Ÿè¿˜åŸè‡³æœ€æ–°å¯ç”¨çš„çŠ¶æ€ã€‚ ç‰ˆæœ¬è¿½æº¯ ğŸ”ï¼šä¿ç•™å†å²ç‰ˆæœ¬ï¼Œä¾¿äºå¯¹æ¯”æ›´æ”¹æˆ–å›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬ã€‚ è¿ç§»ä¾¿åˆ© ğŸššï¼šåœ¨æ–°æœåŠ¡å™¨ä¸Šå¿«é€Ÿéƒ¨ç½²ç›¸åŒçš„ Nginx ç¯å¢ƒã€‚ ğŸ”” å¤‡ä»½æ ¸å¿ƒç›®æ ‡ï¼šé€šå¸¸éœ€è¦å¤‡ä»½ /etc/nginx/ ç›®å½•ï¼ˆåŒ…å«ä¸»é…ç½®æ–‡ä»¶ nginx.conf å’Œ sites-available/ ç­‰ï¼‰ä»¥åŠ /var/www/html/ æˆ–æ‚¨çš„è‡ªå®šä¹‰ç½‘ç«™æ ¹ç›®å½•ã€‚\nğŸ“¦ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ ZIP å‹ç¼©å¤‡ä»½ ZIP æ˜¯ä¸€ç§è·¨å¹³å°ã€é€šç”¨çš„å‹ç¼©æ ¼å¼ï¼Œåœ¨ Windows å’Œ Linux ç³»ç»Ÿä¸Šéƒ½èƒ½è½»æ¾æ‰“å¼€å’Œå¤„ç†ï¼Œéå¸¸é€‚åˆéœ€è¦åœ¨ä¸åŒç¯å¢ƒé—´ä¼ è¾“çš„å¤‡ä»½ã€‚\nâœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ é€šç”¨æ€§å¼º ğŸŒï¼šå‡ ä¹æ‰€æœ‰æ“ä½œç³»ç»Ÿéƒ½å†…ç½®æˆ–æ˜“äºå®‰è£…è§£å‹æ”¯æŒã€‚ å…¼å®¹æ€§å¥½ ğŸ¤ï¼šä¾¿äºåˆ†äº«ç»™å…¶ä»–å›¢é˜Ÿæˆå‘˜ï¼Œæ— éœ€æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚ å¯è®¾ç½®å¯†ç  ğŸ”’ï¼šæ”¯æŒä½¿ç”¨å¯†ç åŠ å¯†å‹ç¼©åŒ…ï¼Œä¿æŠ¤æ•æ„Ÿé…ç½®ï¼ˆå¦‚ SSL è¯ä¹¦å¯†é’¥ï¼‰ã€‚ çµæ´»æ€§é«˜ ğŸ§©ï¼šå¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯å¦é€’å½’å‹ç¼©ã€æ’é™¤ç‰¹å®šæ–‡ä»¶ç­‰ã€‚ ğŸ”§ æ“ä½œå‘½ä»¤ 1. é€’å½’å‹ç¼©ï¼ˆå¸¸è§åšæ³•ï¼‰ æ­¤å‘½ä»¤ä¼šå¤‡ä»½ /etc/nginx ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚\n1 2 3 4 5 6 # å‹ç¼©å¹¶å¸¦ä¸Šæ—¥æœŸ zip -r /mnt/backup/nginx-backup-$(date +%Y%m%d).zip /etc/nginx # è§£é‡Šï¼š # -r å‚æ•°ï¼šé€’å½’å¤„ç†ï¼Œå‹ç¼©ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ã€‚ # $(date +%Y%m%d): shell å‘½ä»¤ï¼Œç”Ÿæˆå½“å‰æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š20230915ï¼‰ï¼Œç”¨äºæ–‡ä»¶åã€‚ 2. éé€’å½’å‹ç¼©ï¼ˆä»…é¡¶çº§ç›®å½•ï¼‰ æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œå¦‚æœåªæƒ³å¤‡ä»½ /etc/nginx ç¬¬ä¸€å±‚çš„æ–‡ä»¶å’Œç›®å½•ï¼ˆä½†ä¸å‹ç¼©å®ƒä»¬é‡Œé¢çš„å†…å®¹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ find å‘½ä»¤ã€‚\n1 2 3 4 5 6 7 # éé€’å½’å‹ç¼©ï¼šä»…å¤‡ä»½ /etc/nginx ä¸‹çš„ç›´æ¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼ˆå…¶å†…å®¹ä¸å‹ç¼©ï¼‰ find /etc/nginx -maxdepth 1 -mindepth 1 -exec zip /mnt/backup/nginx-backup-$(date +%Y%m%d).zip {} + # è§£é‡Šï¼š # find ... -exec ... + : æ‰¾åˆ°æŒ‡å®šçš„æ–‡ä»¶åˆ—è¡¨å¹¶å°†å…¶ä¼ é€’ç»™ zip å‘½ä»¤ã€‚ # -maxdepth 1: åªæŸ¥æ‰¾ç¬¬ä¸€å±‚ã€‚ # -mindepth 1: æ’é™¤è·¯å¾„æœ¬èº«ï¼ˆå³æ’é™¤ `/etc/nginx/.`ï¼‰ã€‚ ğŸ—‚ï¸ æ–¹æ³•äºŒï¼šä½¿ç”¨ TAR.GZ å‹ç¼©å¤‡ä»½ TAR.GZ (.tar.gz) æ˜¯ Linux ç³»ç»Ÿä¸­æœ€å¸¸è§ã€æ•ˆç‡æœ€é«˜çš„å‹ç¼©æ ¼å¼ä¹‹ä¸€ã€‚å®ƒé€šå¸¸èƒ½æä¾›æ¯” ZIP æ›´å¥½çš„å‹ç¼©ç‡ï¼Œä¸”å®Œç¾ä¿ç•™ Linux æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒä¿¡æ¯ã€‚\nâœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ é«˜å‹ç¼©ç‡ ğŸ“¦ï¼šé€šå¸¸èƒ½ç”Ÿæˆæ¯” ZIP æ›´å°çš„æ–‡ä»¶ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ ä¿ç•™å…ƒæ•°æ® ğŸ“‹ï¼šå®Œç¾ä¿ç•™æ–‡ä»¶æƒé™ã€æ‰€æœ‰è€…å’Œæ—¶é—´æˆ³ï¼Œå¯¹äºè¿˜åŸè‡³å…³é‡è¦ã€‚ Linux åŸç”Ÿæ”¯æŒ ğŸ§ï¼šæ˜¯ Linux ç³»ç»Ÿå¤‡ä»½å’Œåˆ†å‘çš„æ ‡å‡†æ ¼å¼ã€‚ æµå¼å¤„ç† ğŸ”„ï¼šé€‚åˆåœ¨ç®¡é“ä¸­ä¸å…¶ä»–å‘½ä»¤ï¼ˆå¦‚ ssh, gpg) ç»“åˆä½¿ç”¨ã€‚ ğŸ”§ æ“ä½œå‘½ä»¤ 1. å¸¸è§„å‹ç¼©ï¼ˆä¿ç•™å®Œæ•´è·¯å¾„ï¼‰ æ­¤æ–¹æ³•ä¼šä¿ç•™å®Œæ•´çš„ç»å¯¹è·¯å¾„ç»“æ„ã€‚\n1 2 3 4 5 6 7 # å¸¸è§„å‹ç¼© tar -czf /mnt/backup/nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx # è§£é‡Šï¼š # -c: åˆ›å»ºæ–°çš„å½’æ¡£æ–‡ä»¶ã€‚ # -z: ä½¿ç”¨ gzip å‹ç¼©ã€‚ # -f: æŒ‡å®šå½’æ¡£æ–‡ä»¶åã€‚ 2. ç²¾å‡†å‹ç¼©ï¼ˆæ§åˆ¶è§£å‹ç»“æ„ï¼‰ ä½¿ç”¨ -C å‚æ•°æ”¹å˜å½“å‰ç›®å½•ï¼Œå¯ä»¥æ§åˆ¶è§£å‹åçš„ç›®å½•ç»“æ„ã€‚è¿™æ˜¯éå¸¸æ¨èçš„æŠ€å·§ï¼Œå¯ä»¥è®©è§£å‹åçš„ç›®å½•åç§°ç»Ÿä¸€ä¸º nginxï¼Œè€Œä¸æ˜¯åŒ…å«å®Œæ•´è·¯å¾„ etc/nginxã€‚\n1 2 3 4 5 6 7 # ç²¾å‡†å‹ç¼©ï¼šè§£å‹åç›´æ¥å¾—åˆ° `nginx` æ–‡ä»¶å¤¹ tar -czf /mnt/backup/nginx-backup-$(date +%Y%m%d).tar.gz -C /etc nginx # è§£é‡Šï¼š # -C /etc: å…ˆåˆ‡æ¢åˆ° /etc ç›®å½•ã€‚ # nginx: ç„¶åå‹ç¼©è¯¥ç›®å½•ä¸‹çš„ nginx æ–‡ä»¶å¤¹ã€‚ # è¿™æ ·æ“ä½œåï¼Œè§£å‹ tar.gz æ–‡ä»¶ä¼šç›´æ¥äº§ç”Ÿä¸€ä¸ªåä¸º `nginx` çš„ç›®å½•ï¼Œè€Œä¸æ˜¯ `etc/nginx/`ã€‚ ğŸ”„ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Rsync åŒæ­¥å¤‡ä»½ Rsync æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¢é‡å¤‡ä»½å’ŒåŒæ­¥å·¥å…·ã€‚å®ƒå¹¶ä¸å‹ç¼©æ–‡ä»¶ï¼Œè€Œæ˜¯é€šè¿‡æ¯”è¾ƒæºå’Œç›®æ ‡ä¹‹é—´çš„å·®å¼‚ï¼Œä»…ä¼ è¾“æ”¹å˜çš„éƒ¨åˆ†ï¼Œå› æ­¤é€Ÿåº¦æå¿«ï¼Œéå¸¸é€‚åˆé¢‘ç¹å¤‡ä»½æˆ–å¤§å‹ç½‘ç«™æ–‡ä»¶çš„åŒæ­¥ã€‚\nâœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ å¢é‡å¤‡ä»½ ğŸ“ˆï¼šä»…åŒæ­¥å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶ï¼Œæ•ˆç‡æé«˜ï¼ŒèŠ‚çœå¸¦å®½å’Œæ—¶é—´ã€‚ ä¿æŒä¸€è‡´æ€§ ğŸ”’ï¼šå¯ä»¥å®Œç¾ä¿ç•™æ‰€æœ‰çš„æ–‡ä»¶å±æ€§ï¼ˆæƒé™ã€æ—¶é—´æˆ³ã€ç¬¦å·é“¾æ¥ç­‰ï¼‰ã€‚ çµæ´»æ€§é«˜ ğŸ›ï¸ï¼šå¯ä»¥è½»æ¾å®ç°æœ¬åœ°åŒæ­¥å’Œè¿œç¨‹åŒæ­¥ã€‚ å¯è„šæœ¬åŒ– ğŸ¤–ï¼šéå¸¸é€‚åˆæ”¾å…¥ cron è®¡åˆ’ä»»åŠ¡ä¸­ï¼Œå®ç°å®šæ—¶è‡ªåŠ¨å¤‡ä»½ã€‚ ğŸ”§ æ“ä½œå‘½ä»¤ 1. æœ¬åœ°åŒæ­¥ï¼ˆå¿«é€Ÿå¢é‡ï¼‰ å°† Nginx é…ç½®åŒæ­¥åˆ°æœ¬åœ°å¦ä¸€ä¸ªç£ç›˜æˆ–åˆ†åŒºã€‚\n1 2 3 4 5 6 7 8 # æœ¬åœ°åŒæ­¥ rsync -av --delete /etc/nginx/ /mnt/backup/nginx-config/ # è§£é‡Šï¼š # -a: å½’æ¡£æ¨¡å¼ï¼Œä¿æŒæ‰€æœ‰æ–‡ä»¶å±æ€§ï¼Œå¹¶é€’å½’åŒæ­¥ã€‚ # -v: è¯¦ç»†æ¨¡å¼ï¼Œè¾“å‡ºåŒæ­¥è¿‡ç¨‹ä¿¡æ¯ã€‚ # --delete: åˆ é™¤ç›®æ ‡ç›®å½•ä¸­æºç›®å½•æ²¡æœ‰çš„æ–‡ä»¶ï¼Œç¡®ä¿ä¸¤è¾¹å®Œå…¨ä¸€è‡´ï¼ˆä½¿ç”¨å‰è¯·è°¨æ…ï¼ï¼‰ã€‚ # æ³¨æ„ï¼šæºç›®å½•è·¯å¾„åçš„å°¾éšæ–œæ  `/` å¾ˆé‡è¦ï¼Œå®ƒè¡¨ç¤ºåŒæ­¥ç›®å½•å†…çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ç›®å½•æœ¬èº«ã€‚ 2. è¿œç¨‹åŒæ­¥ï¼ˆå¼‚æœºå®¹ç¾ï¼‰ å°†æœ¬åœ° Nginx é…ç½®åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå®ç°å¼‚æœºå®¹ç¾ã€‚\n1 2 3 4 5 6 7 # è¿œç¨‹åŒæ­¥ rsync -avz -e ssh /etc/nginx/ user@remote_server_ip:/path/to/backup/nginx-config/ # è§£é‡Šï¼š # -z: åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¿›è¡Œå‹ç¼©ï¼Œæé«˜é€Ÿåº¦ã€‚ # -e ssh: ä½¿ç”¨ SSH åè®®è¿›è¡Œå®‰å…¨ä¼ è¾“ã€‚ # user@remote_server_ip: è¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œ IP åœ°å€ã€‚ ğŸ“Š å¤‡ä»½æ–¹æ³•æ€»ç»“ä¸å¯¹æ¯” æ–¹æ³• æ ¼å¼ ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ ZIP å‹ç¼© .zip é€šç”¨æ€§å¼ºï¼Œè·¨å¹³å°ï¼Œå¯åŠ å¯† Linux ä¸‹å‹ç¼©ç‡é€šå¸¸ä¸å¦‚ tar.gzï¼Œä¿ç•™å…ƒæ•°æ®ç¨é€Š éœ€è¦ä¸ Windows ç³»ç»Ÿå…±äº«å¤‡ä»½æ–‡ä»¶ TAR.GZ å‹ç¼© .tar.gz é«˜å‹ç¼©ç‡ï¼Œå®Œç¾ä¿ç•™ Linux å±æ€§ï¼Œæ ‡å‡†æ ¼å¼ Windows éœ€å®‰è£…è½¯ä»¶æ‰èƒ½è§£å‹ Linux ç³»ç»Ÿä¸‹çš„æ ‡å‡†å®Œæ•´å¤‡ä»½ï¼Œé•¿æœŸå½’æ¡£ Rsync åŒæ­¥ åŸå§‹æ–‡ä»¶ å¢é‡åŒæ­¥ï¼Œé€Ÿåº¦æå¿«ï¼Œå¯æœ¬åœ°/è¿œç¨‹ï¼Œå¯è„šæœ¬åŒ– ä¸å‹ç¼©ï¼Œå ç”¨æ›´å¤šç©ºé—´ é¢‘ç¹çš„å¿«é€Ÿå¤‡ä»½ï¼Œå¼‚åœ°å®¹ç¾ï¼Œç½‘ç«™æ–‡ä»¶åŒæ­¥ ğŸ›¡ï¸ æ¢å¤å‰çš„å‡†å¤‡å·¥ä½œ åœ¨å¼€å§‹ä»»ä½•æ¢å¤æ“ä½œä¹‹å‰ï¼Œè¯·åŠ¡å¿…å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼Œè¿™æ˜¯æ•°æ®å®‰å…¨çš„é»„é‡‘æ³•åˆ™ï¼š\nã€å¼ºçƒˆå»ºè®®ã€‘å¤‡ä»½å½“å‰çŠ¶æ€ ğŸ’¾ï¼šå³ä½¿å½“å‰çš„ Nginx é…ç½®æ˜¯æŸåçš„ï¼Œä¹Ÿå…ˆå°†å…¶æ‰“åŒ…å¤‡ä»½ï¼Œé˜²æ­¢æ¢å¤è¿‡ç¨‹ä¸­å‡ºç°æ„å¤–ï¼Œå¯¼è‡´å®Œå…¨æ— æ³•å›é€€ã€‚\n1 2 # å¤‡ä»½å½“å‰çš„ nginx é…ç½® sudo tar -czf /tmp/nginx-broken-backup-$(date +%Y%m%d).tar.gz /etc/nginx éªŒè¯å¤‡ä»½æ–‡ä»¶ ğŸ”ï¼šæ£€æŸ¥æ‚¨çš„å¤‡ä»½æ–‡ä»¶æ˜¯å¦å®Œæ•´ã€å¯ç”¨ã€‚\n1 2 3 4 5 # åˆ—å‡º ZIP å‹ç¼©åŒ…å†…å®¹ unzip -l /mnt/backup/nginx-backup-20230915.zip # åˆ—å‡º TAR.GZ å‹ç¼©åŒ…å†…å®¹ tar -tzf /mnt/backup/nginx-backup-20230915.tar.gz é€‰æ‹©æ¢å¤ç›®æ ‡ ğŸ¯ï¼šç¡®å®šæ‚¨æ˜¯è¦å®Œå…¨è¦†ç›–ç°æœ‰é…ç½®ï¼Œè¿˜æ˜¯åªæ¢å¤éƒ¨åˆ†æ–‡ä»¶ï¼ˆå¦‚æŸä¸ª server block é…ç½®ï¼‰ã€‚\nğŸ“¤ ä»å„ç§å¤‡ä»½æ¢å¤ æœ¬ç« èŠ‚è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä»ä¹‹å‰åˆ›å»ºçš„ä¸‰ç§ä¸åŒç±»å‹çš„å¤‡ä»½ä¸­è¿›è¡Œæ¢å¤ã€‚è¯·æ ¹æ®æ‚¨é‡‡ç”¨çš„å¤‡ä»½æ–¹æ³•ï¼Œé€‰æ‹©å¯¹åº”çš„æ¢å¤æŒ‡å—ã€‚\n1. ä» ZIP å¤‡ä»½æ¢å¤ ä½¿ç”¨ unzip å‘½ä»¤æ¥è§£å‹æ¢å¤ã€‚\nğŸ”§ æ“ä½œå‘½ä»¤ 1 2 3 4 5 # 1. å®‰å…¨åšæ³•ï¼šè§£å‹åˆ°å½“å‰ç›®å½•æŸ¥çœ‹å†…å®¹ï¼ˆä¼šå¾—åˆ°åŒ…å«å®Œæ•´è·¯å¾„çš„ etc/nginx/ ç›®å½•ç»“æ„ï¼‰ unzip /mnt/backup/nginx-backup-20230915.zip # 2. ç›´æ¥è¦†ç›–æ¢å¤åˆ°ç³»ç»ŸåŸå§‹è·¯å¾„ (ä½¿ç”¨ -o å‚æ•°è¦†ç›–ç°æœ‰æ–‡ä»¶ï¼Œ-d / æŒ‡å®šè§£å‹åˆ°æ ¹ç›®å½•) sudo unzip -o /mnt/backup/nginx-backup-20230915.zip -d / 2. ä» TAR.GZ å¤‡ä»½æ¢å¤ ä½¿ç”¨ tar å‘½ä»¤æ¥è§£å‹æ¢å¤ï¼Œè¿™æ˜¯ Linux ç³»ç»Ÿä¸­æœ€å¸¸ç”¨ä¸”å¯é çš„æ–¹å¼ã€‚\nğŸ”§ æ“ä½œå‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # åœºæ™¯ä¸€ï¼šæ¢å¤\u0026#34;å¸¸è§„å‹ç¼©\u0026#34;çš„å¤‡ä»½ï¼ˆå‹ç¼©æ—¶ä½¿ç”¨äº† `tar -czf backup.tar.gz /etc/nginx`ï¼Œå‹ç¼©åŒ…å†…ä¿ç•™äº†å®Œæ•´è·¯å¾„ /etc/nginx/...ï¼‰ # -C / å‚æ•°æŒ‡å®šè§£å‹åˆ°æ ¹ç›®å½•ï¼Œå‹ç¼©åŒ…é‡Œçš„ etc/nginx å°±ä¼šè¦†ç›–ç³»ç»Ÿä¸­çš„ /etc/nginx sudo tar -xzf /mnt/backup/nginx-backup-20230915.tar.gz -C / # åœºæ™¯äºŒï¼šæ¢å¤\u0026#34;ç²¾å‡†å‹ç¼©\u0026#34;çš„å¤‡ä»½ï¼ˆå‹ç¼©æ—¶ä½¿ç”¨äº† `tar -czf backup.tar.gz -C /etc nginx`ï¼Œå‹ç¼©åŒ…å†…ç›´æ¥æ˜¯ nginx/... ç›®å½•ï¼‰ # -C /etc å‚æ•°æŒ‡å®šè§£å‹åˆ° /etc ç›®å½•ï¼Œå‹ç¼©åŒ…é‡Œçš„ nginx æ–‡ä»¶å¤¹å°±ä¼šè¦†ç›– /etc/nginx sudo tar -xzf /mnt/backup/nginx-backup-20230915.tar.gz -C /etc # åœºæ™¯ä¸‰ï¼šæœ€å®‰å…¨ã€æœ€æ¨èçš„åšæ³•ï¼è§£å‹åˆ°ä¸´æ—¶ç›®å½•æ£€æŸ¥åå†æ‰‹åŠ¨å¤åˆ¶ # 1. åˆ›å»ºä¸´æ—¶ç›®å½• sudo mkdir -p /tmp/nginx-restore # 2. è§£å‹åˆ°ä¸´æ—¶ç›®å½• sudo tar -xzf /mnt/backup/nginx-backup-20230915.tar.gz -C /tmp/nginx-restore # 3. æŸ¥çœ‹è§£å‹åçš„ç»“æ„ï¼Œç¡®è®¤æ˜¯å¦æ­£ç¡® ls -la /tmp/nginx-restore/ # 4. ä½¿ç”¨ rsync åŒæ­¥åˆ°ç›®æ ‡ä½ç½®ï¼ˆè¿™æ ·å¯ä»¥å†æ¬¡ç¡®è®¤æ–‡ä»¶å˜æ›´ï¼‰ sudo rsync -av /tmp/nginx-restore/nginx/ /etc/nginx/ # å¦‚æœè§£å‹åæ˜¯ etc/nginx ç»“æ„ï¼Œåˆ™ä½¿ç”¨ï¼š # sudo rsync -av /tmp/nginx-restore/etc/nginx/ /etc/nginx/ ğŸ“‹ ä¸åŒå‹ç¼©æ–¹å¼çš„æ¢å¤åœºæ™¯ å®Œæ•´è·¯å¾„å¤‡ä»½ï¼šä½¿ç”¨ tar -czf backup.tar.gz /etc/nginx åˆ›å»ºï¼Œæ¢å¤æ—¶ä½¿ç”¨ sudo tar -xzf backup.tar.gz -C / ç²¾å‡†è·¯å¾„å¤‡ä»½ï¼šä½¿ç”¨ tar -czf backup.tar.gz -C /etc nginx åˆ›å»ºï¼Œæ¢å¤æ—¶ä½¿ç”¨ sudo tar -xzf backup.tar.gz -C /etc 3. ä» Rsync å¤‡ä»½æ¢å¤ ä» Rsync å¤‡ä»½æ¢å¤çš„æœ¬è´¨ï¼Œå°±æ˜¯å°†åŒæ­¥è¿‡ç¨‹åå‘æ“ä½œã€‚æ‚¨çš„å¤‡ä»½ç›®å½•ç°åœ¨æ˜¯\u0026quot;æº\u0026quot;ï¼Œç³»ç»Ÿçš„ /etc/nginx ç›®å½•æ˜¯\u0026quot;ç›®æ ‡\u0026quot;ã€‚\nğŸ”§ æ“ä½œå‘½ä»¤ 1 2 3 4 5 # ä»æœ¬åœ°å¤‡ä»½ç›®å½•æ¢å¤ sudo rsync -av /mnt/backup/nginx-config/ /etc/nginx/ # ä»è¿œç¨‹å¤‡ä»½æœåŠ¡å™¨æ¢å¤ sudo rsync -avz -e ssh user@remote_server_ip:/path/to/backup/nginx-config/ /etc/nginx/ âš ï¸ é‡è¦è­¦å‘Š å¦‚æœå½“åˆå¤‡ä»½æ—¶ä½¿ç”¨äº† --delete å‚æ•°ï¼Œæ¢å¤æ—¶è¯·æå…¶è°¨æ…åœ°ä½¿ç”¨å®ƒã€‚åœ¨æ¢å¤å‘½ä»¤ä¸­åŠ ä¸Š --delete ä¼šåˆ é™¤ç›®æ ‡ç›®å½•ï¼ˆå³æ‚¨çš„å½“å‰é…ç½®ï¼‰ä¸­æ‰€æœ‰æºç›®å½•ï¼ˆå³æ‚¨çš„å¤‡ä»½ï¼‰é‡Œä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚è¿™å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ å»ºè®®æµç¨‹ï¼šå…ˆä¸åŠ  --delete åŒæ­¥ï¼Œæ£€æŸ¥æ— è¯¯åï¼Œå†æ‰‹åŠ¨æ¸…ç†å¤šä½™æ–‡ä»¶ã€‚\nâœ… æ¢å¤åçš„å¿…è¦æ“ä½œ æ¢å¤æ–‡ä»¶åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œæ¥ä¸‹æ¥çš„éªŒè¯å’Œæ¿€æ´»åŒæ ·é‡è¦ã€‚\næµ‹è¯• Nginx é…ç½®è¯­æ³• âœ…ï¼šè¿™æ˜¯å¿…é¡»çš„ä¸€æ­¥ï¼ å®ƒå¯ä»¥æ£€æŸ¥æ¢å¤çš„é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œé¿å…é‡å¯å¤±è´¥å¯¼è‡´æœåŠ¡ä¸­æ–­ã€‚\n1 sudo nginx -t å¦‚æœè¾“å‡º syntax is ok å’Œ test is successfulï¼Œè¯´æ˜é…ç½®è¯­æ³•æ­£ç¡®ã€‚\né‡è½½ Nginx ğŸ”„ï¼šåœ¨è¯­æ³•æµ‹è¯•é€šè¿‡åï¼Œè®© Nginx é‡æ–°åŠ è½½é…ç½®å³å¯ï¼Œæ— éœ€å®Œå…¨é‡å¯ï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ã€‚\n1 2 3 sudo systemctl reload nginx # æˆ–è€…ä½¿ç”¨ nginx å‘½ä»¤ sudo nginx -s reload éªŒè¯æœåŠ¡çŠ¶æ€ ğŸ“Šï¼šæ£€æŸ¥ Nginx æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚\n1 sudo systemctl status nginx æµ‹è¯•ç½‘ç«™è®¿é—® ğŸŒï¼šæœ€ç»ˆé€šè¿‡æµè§ˆå™¨æˆ– curl å‘½ä»¤è®¿é—®ä½ çš„ç½‘ç«™ï¼Œç¡®è®¤æœåŠ¡å·²æŒ‰é¢„æœŸæ¢å¤ã€‚\nğŸš¨ æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ æƒé™é—®é¢˜ ğŸ”ï¼šä½¿ç”¨ sudo è¿›è¡Œæ¢å¤æ“ä½œï¼Œç¡®ä¿ä½ æœ‰è¶³å¤Ÿçš„æƒé™å†™å…¥ /etc/nginx ç­‰ç³»ç»Ÿç›®å½•ã€‚è§£å‹åæ£€æŸ¥é‡è¦æ–‡ä»¶ï¼ˆå¦‚ SSL è¯ä¹¦ç§é’¥ï¼‰çš„æƒé™æ˜¯å¦è¿‡äºå¼€æ”¾ï¼ˆå¦‚ 600 æˆ– 400ï¼‰ã€‚ \u0026ldquo;ç²¾å‡†å‹ç¼©\u0026quot;å¤‡ä»½çš„æ¢å¤ ğŸ¯ï¼šè¿™æ˜¯æœ€å®¹æ˜“å‡ºé”™çš„ç‚¹ã€‚åŠ¡å¿…å…ˆ tar -tzf æŸ¥çœ‹å‹ç¼©åŒ…å†…ç»“æ„ï¼Œå†å†³å®š -C å‚æ•°çš„ä½¿ç”¨ã€‚ Rsync çš„ --delete å‚æ•° âš ï¸ï¼šæ¢å¤æ—¶è¯·è°¨æ…ä½¿ç”¨ --deleteã€‚æœ€å¥½å…ˆä¸åŠ è¯¥å‚æ•°åŒæ­¥ï¼Œç„¶åå†æ‰‹åŠ¨æ¸…ç†å·®å¼‚æ–‡ä»¶ã€‚ æ–‡ä»¶è¦†ç›– ğŸ“ï¼šæ¢å¤æ“ä½œä¼šè¦†ç›–ç›®æ ‡è·¯å¾„ä¸‹çš„åŒåæ–‡ä»¶ï¼Œä¸”é€šå¸¸æ— æ³•æ’¤é”€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¬¬ä¸€æ­¥å¼ºè°ƒè¦å¤‡ä»½å½“å‰çŠ¶æ€ã€‚ ç¯å¢ƒå·®å¼‚ ğŸ”„ï¼šå¦‚æœæ˜¯åœ¨æ–°çš„æœåŠ¡å™¨ä¸Šæ¢å¤ï¼Œè¯·æ³¨æ„å¯èƒ½ä¸æ—§ç¯å¢ƒå­˜åœ¨å·®å¼‚ï¼ˆå¦‚ä¾èµ–çš„æ¨¡å—ã€ç‰ˆæœ¬ã€ç³»ç»Ÿè·¯å¾„ç­‰ï¼‰ã€‚ ğŸ¯ å®Œæ•´å¤‡ä»½ä¸æ¢å¤æµç¨‹æ€»ç»“ å¤‡ä»½ç­–ç•¥å»ºè®®ï¼š\nç»„åˆä½¿ç”¨ ğŸ¤ï¼šä½¿ç”¨ rsync è¿›è¡Œæ¯æ—¥çš„å¢é‡åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ŒåŒæ—¶æ¯å‘¨ä½¿ç”¨ tar -czf è¿›è¡Œä¸€æ¬¡å®Œæ•´å‹ç¼©å¤‡ä»½å¹¶å¼‚åœ°å­˜å‚¨ã€‚ è‡ªåŠ¨åŒ– ğŸ¤–ï¼šå°†å¤‡ä»½å‘½ä»¤å†™å…¥è„šæœ¬ï¼Œå¹¶é€šè¿‡ cron è®¡åˆ’ä»»åŠ¡å®ç°å®šæ—¶è‡ªåŠ¨å¤‡ä»½ã€‚ éªŒè¯å¤‡ä»½ ğŸ”ï¼šå®šæœŸæ£€æŸ¥å¤‡ä»½æ–‡ä»¶æ˜¯å¦å®Œå¥½æ— æŸï¼Œå¹¶å°è¯•åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿˜åŸï¼Œç¡®ä¿å¤‡ä»½çš„æœ‰æ•ˆæ€§ã€‚ æ¢å¤æµç¨‹ï¼šå‡†å¤‡ â†’ éªŒè¯å¤‡ä»½ â†’ æ‰§è¡Œæ¢å¤ â†’ æµ‹è¯•é…ç½® (nginx -t) â†’ é‡è½½æœåŠ¡ (reload) â†’ ä¸šåŠ¡éªŒè¯\néµå¾ªè¿™ä¸ªå®Œæ•´æµç¨‹ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°ä¿è¯ Nginx é…ç½®å¤‡ä»½ä¸æ¢å¤æ“ä½œçš„å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œç¡®ä¿æ‚¨çš„ Web æœåŠ¡æŒç»­ç¨³å®šè¿è¡Œã€‚ğŸš€\nğŸ’¡ æç¤ºï¼šå®šæœŸæ¼”ç»ƒæ¢å¤è¿‡ç¨‹è‡³å…³é‡è¦ï¼Œç¡®ä¿åœ¨çœŸæ­£éœ€è¦æ—¶æ‚¨èƒ½å¤Ÿç†Ÿç»ƒã€å¿«é€Ÿåœ°è¿›è¡Œæ“ä½œã€‚\n","date":"2025-09-14T10:11:38+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/196aa5da/","title":"Nginx é…ç½®å¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ”"},{"content":"Nginx æ ‡å‡†ç‰ˆå®‰è£…ä¸å¸è½½æŒ‡å— ğŸ“ åœ¨ Debian 13 ä¸Šå®‰è£…ã€é…ç½®ã€å‡çº§ã€å¸è½½å’Œå¤‡ä»½ Nginx çš„å®Œæ•´æµç¨‹ã€‚\nğŸ“š å¯¼èˆªç›®å½•\nğŸš€ ä¸€ã€å®‰è£…å‰å‡†å¤‡ ğŸ“¦ äºŒã€æ·»åŠ  Nginx å®˜æ–¹ä»“åº“ âš™ï¸ ä¸‰ã€è®¾ç½®ä»“åº“ä¼˜å…ˆçº§ ğŸ”§ å››ã€å®‰è£…ä¸éªŒè¯ Nginx â“ äº”ã€å…³äº GPG å¯†é’¥é—®é¢˜ ğŸ“‚ å…­ã€å®‰è£…åçš„åŸºæœ¬æ“ä½œ ğŸ”„ ä¸ƒã€å‡çº§ Nginx ğŸ—‘ï¸ å…«ã€å¸è½½ Nginx ğŸ’¾ ä¹ã€å¤‡ä»½ Nginx é…ç½® ä¸€ã€ğŸš€ å®‰è£…å‰å‡†å¤‡ åœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œç¡®ä¿å·²å®‰è£…æ‰€éœ€ä¾èµ–ï¼š 1 2 sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y \u0026amp;\u0026amp; \\ sudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring -y å¯¼å…¥ nginx å®˜æ–¹ GPG å¯†é’¥ï¼š 1 curl -fsSL https://nginx.org/keys/nginx_signing.key | sudo gpg --dearmor -o /usr/share/keyrings/nginx-archive-keyring.gpg äºŒã€ğŸ“¦ æ·»åŠ  Nginx å®˜æ–¹ APT ä»“åº“ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ  Nginx å®˜æ–¹ä¸»çº¿ç‰ˆä»“åº“ï¼ˆè·å–æœ€æ–°ç‰ˆæœ¬ï¼‰ï¼š\n1 echo \u0026#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] http://nginx.org/packages/mainline/debian/ $(lsb_release -cs) nginx\u0026#34; | sudo tee /etc/apt/sources.list.d/nginx.list âœ¨ Nginx å®˜æ–¹ä»“åº“æä¾›äº†æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œç¡®ä¿æ‚¨èƒ½è·å¾—æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨æ›´æ–°ã€‚\nä¸‰ã€âš™ï¸ è®¾ç½®ä»“åº“ä¼˜å…ˆçº§ ä¸ºç¡®ä¿ç³»ç»Ÿä¼˜å…ˆä½¿ç”¨ Nginx å®˜æ–¹ä»“åº“ï¼ˆè€Œä¸æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„è¾ƒæ—§ç‰ˆæœ¬ï¼‰ï¼Œè®¾ç½®ä¼˜å…ˆçº§é…ç½®ï¼š\n1 echo -e \u0026#34;Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n\u0026#34; | sudo tee /etc/apt/preferences.d/99nginx ğŸ”§ ä¼˜å…ˆçº§è®¾ç½®å¯é˜²æ­¢ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°æ—¶è¦†ç›–ä¸ºæ—§ç‰ˆæœ¬ï¼Œä¿æŒç‰ˆæœ¬ä¸€è‡´æ€§ã€‚\nå››ã€ğŸ”§ å®‰è£…ä¸éªŒè¯ Nginx æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… Nginxï¼š 1 2 sudo apt update \u0026amp;\u0026amp; \\ sudo apt install nginx -y éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸï¼š 1 nginx -v ğŸ“Œ å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå°†æ˜¾ç¤º Nginx 1.29.x ç‰ˆæœ¬å·ã€‚\näº”ã€â“ å…³äº GPG å¯†é’¥éªŒè¯é—®é¢˜ å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„ GPG é”™è¯¯ (/root/.gnupg: directory does not exist!) æ˜¯å› ä¸ºç³»ç»Ÿç¼ºå°‘ GPG é»˜è®¤å¯†é’¥å­˜å‚¨ç›®å½•ã€‚è¿™ä¸ä¼šå½±å“å®‰è£…ï¼Œå› ä¸ºï¼š\nå¯†é’¥å·²æˆåŠŸä¸‹è½½åˆ° /usr/share/keyrings/nginx-archive-keyring.gpg ä½¿ç”¨ signed-by å‚æ•°æ˜ç¡®æŒ‡å®šäº†å¯†é’¥ä½ç½® å¦‚éœ€ä¿®å¤ GPG ç›®å½•é—®é¢˜ï¼Œå¯æ‰§è¡Œï¼š\n1 2 mkdir -p ~/.gnupg chmod 700 ~/.gnupg âš ï¸ è¿™ä¸æ˜¯å¿…é¡»æ“ä½œï¼Œä¸å½±å“ Nginx æ­£å¸¸å®‰è£…å’Œä½¿ç”¨ã€‚\nå…­ã€ğŸ“‚ å®‰è£…åçš„åŸºæœ¬æ“ä½œ æ£€æŸ¥ç«¯å£å ç”¨\n1 sudo ss -tulnp | grep -E \u0026#39;:80|:443\u0026#39; å¦‚æœæœ‰å…¶ä»–æœåŠ¡ï¼ˆå¦‚ Apacheã€å¦ä¸€ä¸ª Nginx å®ä¾‹ã€æˆ–æŸä¸ªå ç”¨ç«¯å£çš„ç¨‹åºï¼‰æ­£åœ¨è¿è¡Œï¼Œè¯·å…ˆåœæ­¢å®ƒä»¬ï¼š 1 2 sudo systemctl stop apache2 \u0026amp;\u0026amp; \\ sudo systemctl stop nginx å¯åŠ¨ Nginx æœåŠ¡ï¼š\n1 sudo systemctl start nginx è®¾ç½®å¼€æœºè‡ªå¯ï¼š\n1 sudo systemctl enable nginx æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š\n1 sudo systemctl status nginx æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•ï¼š\n1 sudo nginx -t é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ï¼š\n1 sudo systemctl reload nginx ğŸ›¡ï¸ Nginx ä»¥å…¶é«˜æ€§èƒ½ã€é«˜å¹¶å‘èƒ½åŠ›å’Œä½å†…å­˜å ç”¨è‘—ç§°ï¼Œéå¸¸é€‚åˆä½œä¸º Web æœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨æˆ–è´Ÿè½½å‡è¡¡å™¨ã€‚\nä¸ƒã€ğŸ”„ å‡çº§ Nginx å¦‚æœæ‚¨æ˜¯æŒ‰ç…§ä¹‹å‰æŒ‡å—é€šè¿‡å®˜æ–¹ä»“åº“å®‰è£…çš„ Nginxï¼Œè¿™æ˜¯æœ€ç®€å•çš„å‡çº§æ–¹æ³•ï¼š\n1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨\n1 sudo apt update 2. æŸ¥çœ‹å¯å‡çº§ç‰ˆæœ¬\n1 apt-cache policy nginx 3. æ‰§è¡Œå‡çº§\n1 sudo apt upgrade nginx 4. æˆ–è€…å…¨é¢å‡çº§ç³»ç»Ÿï¼ˆåŒ…å« Nginxï¼‰\n1 sudo apt full-upgrade 5. éªŒè¯å‡çº§ç»“æœ\n1 nginx -v 6. é‡æ–°åŠ è½½é…ç½®ï¼ˆåº”ç”¨å˜æ›´ï¼‰\n1 sudo systemctl reload nginx ğŸ“Œ å‡çº§å‰å»ºè®®å¤‡ä»½é…ç½®ï¼Œå¹¶æ£€æŸ¥å®˜æ–¹å‘å¸ƒè¯´æ˜äº†è§£é‡å¤§å˜æ›´ã€‚\nå…«ã€ğŸ—‘ï¸ å¸è½½ Nginx å¦‚éœ€å®Œå…¨å¸è½½ Nginx åŠå…¶é…ç½®æ–‡ä»¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\nåœæ­¢ Nginx æœåŠ¡ï¼š\n1 sudo systemctl stop nginx ç¦ç”¨å¼€æœºè‡ªå¯ï¼š\n1 sudo systemctl disable nginx å¸è½½ Nginx è½¯ä»¶åŒ…ï¼š\n1 sudo apt remove --purge nginx nginx-common nginx-core -y åˆ é™¤ä»“åº“é…ç½®ï¼š\n1 2 sudo rm -f /etc/apt/sources.list.d/nginx.list sudo rm -f /etc/apt/preferences.d/99nginx æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š\n1 sudo apt update ğŸ“Œ --purge å‚æ•°ä¼šåŒæ—¶åˆ é™¤é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿å®Œå…¨å¸è½½ã€‚å¦‚éœ€ä¿ç•™é…ç½®ï¼Œå¯çœç•¥æ­¤å‚æ•°ã€‚\nä¹ã€ğŸ’¾ å¤‡ä»½ Nginx é…ç½® å®šæœŸå¤‡ä»½ Nginx é…ç½®æ˜¯è‰¯å¥½çš„è¿ç»´ä¹ æƒ¯ï¼š\n1.ğŸ”§ æœ¬åœ° rsync åŒæ­¥å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ğŸ“Œ åŒæ­¥ nginx ä¸»ç›®å½• rsync -avhz --progress --delete-delay --mkpath \\ /etc/nginx/ \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ #ğŸ“Œ åŒæ­¥ html ç›®å½• rsync -avzh --progress --delete-delay --mkpath \\ /var/www/html/ \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/ # ğŸ“Œ åŒæ­¥æ–‡ä»¶æœåŠ¡ç›®å½• rsync -avzh --progress --delete-delay --mkpath \\ /mnt/file/ \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ 2. ğŸ“Œ ä»æœ¬åœ°å¤‡ä»½æ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ¢å¤ nginx é…ç½® rsync -avzh --progress --mkpath \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/nginx/ \\ /etc/nginx/ # æ¢å¤ç½‘ç«™æ–‡ä»¶ rsync -avzh --progress --mkpath \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æ ‡å‡†ç‰ˆ/html/ \\ /var/www/html/ # æ¢å¤æ–‡ä»¶æœåŠ¡ rsync -avzh --progress --mkpath \\ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/file/ \\ /mnt/file/ ğŸ” å»ºè®®å°†å¤‡ä»½æ–‡ä»¶å­˜å‚¨åˆ°å®‰å…¨ä½ç½®ï¼Œå¦‚å¤–éƒ¨å­˜å‚¨æˆ–äº‘å­˜å‚¨æœåŠ¡ã€‚\nğŸ’¡ æç¤ºï¼šç°åœ¨æ‚¨å·²ç»æŒæ¡äº†åœ¨ Debian 13 ä¸Šå®‰è£…ã€é…ç½®ã€å‡çº§ã€å¸è½½å’Œå¤‡ä»½ Nginx çš„å®Œæ•´æµç¨‹ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶æé—®ï¼\n","date":"2025-09-14T09:12:25+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/10bf9536/","title":"Nginx æ ‡å‡†ç‰ˆå®‰è£…ä¸å¸è½½æŒ‡å—  ğŸ“"},{"content":"FnOS è™šæ‹Ÿå†…å­˜ Swap å…¨é¢è§£æ ğŸ§ æ·±å…¥ç†è§£ FnOS ä¸­ Swap è™šæ‹Ÿå†…å­˜çš„å·¥ä½œåŸç†ã€é…ç½®æ–¹æ³•å’Œä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ‚¨æ„å»ºæ›´ç¨³å®šé«˜æ•ˆçš„è®¡ç®—ç¯å¢ƒï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ ä»€ä¹ˆæ˜¯ Swap è™šæ‹Ÿå†…å­˜ï¼Ÿ ğŸ› ï¸ ä¸€ã€åˆ é™¤ Swap è™šæ‹Ÿå†…å­˜ ğŸ› ï¸ äºŒã€åˆ›å»º Swap è™šæ‹Ÿå†…å­˜ ğŸ› ï¸ æ–‡ä»¶ä¸º Swap è™šæ‹Ÿå†…å­˜ ğŸ› ï¸ åˆ†åŒºä¸º Swap è™šæ‹Ÿå†…å­˜ âš™ï¸ ä¸‰ã€é…ç½®æ°¸ä¹…ç”Ÿæ•ˆ ğŸ¯ å››ã€Swap ç­–ç•¥ä¼˜åŒ– âš–ï¸ äº”ã€å¯ç”¨ Swap çš„ä¼˜ç¼ºç‚¹ ğŸš€ å…­ã€ä¼˜åŒ– Swap æ€§èƒ½çš„ç­–ç•¥ ğŸ“Š ä¸ƒã€Swap å¤§å°è§„åˆ’å»ºè®® ğŸ”§ å…«ã€é«˜çº§é…ç½®æŠ€å·§ ğŸš¨ ä¹ã€æ•…éšœæ’é™¤ä¸æ³¨æ„äº‹é¡¹ ğŸ“ˆ åã€ç›‘æ§ä¸ç»´æŠ¤ âœ¨ ä»€ä¹ˆæ˜¯ Swap è™šæ‹Ÿå†…å­˜ï¼Ÿ Swap è™šæ‹Ÿå†…å­˜æ˜¯ Linux ç³»ç»Ÿçš„ä¸€ç§å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå½“ç‰©ç†å†…å­˜ï¼ˆRAMï¼‰ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šå°†ä¸€éƒ¨åˆ†ä¸å¸¸ç”¨çš„å†…å­˜æ•°æ®æš‚æ—¶å­˜å‚¨åˆ°ç¡¬ç›˜ä¸Šçš„ç‰¹å®šåŒºåŸŸï¼ˆSwap ç©ºé—´ï¼‰ï¼Œä»è€Œé‡Šæ”¾ç‰©ç†å†…å­˜ä¾›æ›´ç´§æ€¥çš„ä»»åŠ¡ä½¿ç”¨ã€‚\nğŸ” å·¥ä½œåŸç† å†…å­˜æ‰©å±•ï¼šå°†ç¡¬ç›˜ç©ºé—´è™šæ‹Ÿä¸ºå†…å­˜ä½¿ç”¨ æ•°æ®äº¤æ¢ï¼šå°†ä¸æ´»è·ƒçš„å†…å­˜é¡µç§»åŠ¨åˆ° Swap ç©ºé—´ åº”æ€¥ä¿æŠ¤ï¼šé˜²æ­¢å†…å­˜è€—å°½å¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–è¿›ç¨‹è¢«ç»ˆæ­¢ å†…å­˜å‹ç¼©ï¼šç°ä»£ Linux å†…æ ¸è¿˜ä½¿ç”¨ zswap è¿›è¡Œå†…å­˜å‹ç¼©ï¼Œå‡å°‘å¯¹ç£ç›˜çš„ä¾èµ– ğŸ“Š å†…å­˜å±‚æ¬¡ç»“æ„å¯¹æ¯” å­˜å‚¨ç±»å‹ è®¿é—®é€Ÿåº¦ å®¹é‡ æˆæœ¬ ç”¨é€” CPU ç¼“å­˜ 1-10ns KB-MB æé«˜ å¤„ç†å™¨ç›´æ¥è®¿é—® å†…å­˜ (RAM) 10-100ns GB é«˜ æ´»åŠ¨æ•°æ®å’Œç¨‹åº Swap ç©ºé—´ 1-10ms GB ä½ ä¸æ´»åŠ¨å†…å­˜é¡µ ç¡¬ç›˜å­˜å‚¨ 5-20ms TB æä½ é•¿æœŸæ•°æ®å­˜å‚¨ ğŸ› ï¸ ä¸€ã€åˆ é™¤ Swap è™šæ‹Ÿå†…å­˜ 1. ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ Swap 1 swapoff -a 2. æ°¸ä¹…ç§»é™¤ /etc/fstab ä¸­çš„äº¤æ¢æ¡ç›® ç¼–è¾‘ /etc/fstab æ–‡ä»¶ï¼š\n1 nano /etc/fstab æ‰¾åˆ°å¹¶åˆ é™¤æˆ–æ³¨é‡Šæ‰ï¼ˆåœ¨è¡Œé¦–æ·»åŠ  #ï¼‰Swap ç›¸å…³è¡Œï¼š\n1 /swapfile none swap sw 0 0 ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ã€‚\n3. åˆ é™¤äº¤æ¢æ–‡ä»¶ 1 rm -f /swapfile 4. åˆ é™¤äº¤æ¢åˆ†åŒºï¼ˆå¦‚æœ‰ï¼‰ 1 2 3 4 5 6 7 # æŸ¥çœ‹å½“å‰äº¤æ¢åˆ†åŒº swapon --show # ç¦ç”¨ç‰¹å®šäº¤æ¢åˆ†åŒº swapoff /dev/sdXN # ä» fstab ä¸­ç§»é™¤å¯¹åº”æ¡ç›® 5. éªŒè¯æ›´æ”¹ 1 2 free -h swapon --show è¿™ä¸¤ä¸ªå‘½ä»¤åº”è¯¥æ˜¾ç¤ºæ²¡æœ‰ä»»ä½•äº¤æ¢ç©ºé—´è¢«æ¿€æ´»ã€‚\näºŒã€åˆ›å»º Swap è™šæ‹Ÿå†…å­˜ï¼ˆé€‚ç”¨äº FnOSï¼‰ æ–¹æ³•ä¸€ã€æ–‡ä»¶ä¸º Swap è™šæ‹Ÿå†…å­˜ 1. åˆ›å»º Swap æ–‡ä»¶ 1 2 # åˆ›å»º 8GB çš„ Swap æ–‡ä»¶ï¼ˆæ ¹æ®ç³»ç»Ÿéœ€æ±‚è°ƒæ•´å¤§å°ï¼‰ dd if=/dev/zero of=/swapfile bs=1G count=8 status=progress status=progress å‚æ•°æ˜¾ç¤ºåˆ›å»ºè¿›åº¦\n2. è®¾ç½®å®‰å…¨æƒé™ 1 chmod 0600 /swapfile ç¡®ä¿åªæœ‰ root ç”¨æˆ·å¯ä»¥è®¿é—®ï¼Œæé«˜å®‰å…¨æ€§\n3. æ ¼å¼åŒ– Swap æ–‡ä»¶ 1 mkswap /swapfile å°†æ–‡ä»¶æ ‡è®°ä¸º Swap ç©ºé—´\n4. å¯ç”¨ Swap 1 swapon /swapfile ç«‹å³æ¿€æ´» Swap æ–‡ä»¶\n5. éªŒè¯ Swap çŠ¶æ€ 1 2 free -h swapon --show æŸ¥çœ‹å†…å­˜å’Œ Swap ä½¿ç”¨æƒ…å†µ\næ–¹æ³•äºŒã€åˆ†åŒºä¸º Swap è™šæ‹Ÿå†…å­˜ 1. åˆ›å»º Swap åˆ†åŒº 1 2 3 # ä½¿ç”¨ fdisk æˆ– parted åˆ›å»ºæ–°åˆ†åŒº fdisk /dev/sdX # åœ¨ fdisk ä¸­: n â†’ p â†’ åˆ†åŒºå· â†’ èµ·å§‹æ‰‡åŒº â†’ ç»“æŸæ‰‡åŒº â†’ t â†’ 82 (Linux swap) â†’ w 2. æ ¼å¼åŒ– Swap åˆ†åŒº 1 mkswap /dev/sdXN 3. å¯ç”¨ Swap åˆ†åŒº 1 swapon /dev/sdXN 4. éªŒè¯ Swap çŠ¶æ€ 1 2 free -h cat /proc/swaps âš™ï¸ ä¸‰ã€é…ç½®æ°¸ä¹…ç”Ÿæ•ˆ 1. å¤‡ä»½ fstab æ–‡ä»¶ 1 cp /etc/fstab /etc/fstab.bak 2. æ·»åŠ è‡ªåŠ¨æŒ‚è½½é…ç½® 1 2 3 4 5 6 # å¯¹äº Swap æ–‡ä»¶ echo \u0026#39;/swapfile none swap sw 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab # å¯¹äº Swap åˆ†åŒºï¼ˆæ¨èä½¿ç”¨ UUIDï¼‰ UUID=$(blkid -s UUID -o value /dev/sdXN) echo \u0026#34;UUID=$UUID none swap sw 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab 3. æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡® 1 2 3 4 5 6 7 8 9 # ç¦ç”¨æ‰€æœ‰ Swap swapoff -a # é‡æ–°å¯ç”¨æ‰€æœ‰ Swapï¼ˆæ ¹æ® fstabï¼‰ swapon -a # éªŒè¯ç»“æœ free -h swapon --show 4. æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¶ Swap åŠ è½½ 1 2 3 4 5 # æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¥å¿— dmesg | grep -i swap # æ£€æŸ¥ systemd æœåŠ¡çŠ¶æ€ systemctl status swap.target ğŸ¯ å››ã€Swap ç­–ç•¥ä¼˜åŒ–ï¼ˆSwappinessï¼‰ 1. ç†è§£ Swappiness Swappiness æ˜¯ Linux å†…æ ¸å‚æ•°ï¼Œæ§åˆ¶ç³»ç»Ÿä½¿ç”¨ Swap çš„å€¾å‘ç¨‹åº¦ï¼š\nå€¼èŒƒå›´ï¼š0-100 é»˜è®¤å€¼ï¼š60ï¼ˆå¤§å¤šæ•°å‘è¡Œç‰ˆï¼‰ ä½å€¼ (0-30)ï¼šå°½é‡é¿å…ä½¿ç”¨ Swap é«˜å€¼ (70-100)ï¼šç§¯æä½¿ç”¨ Swap 2. æŸ¥çœ‹å½“å‰ Swappiness å€¼ 1 2 3 4 cat /proc/sys/vm/swappiness # æˆ–è€… sysctl vm.swappiness 3. ä¸´æ—¶è°ƒæ•´ Swappiness 1 2 3 4 5 # æ–¹æ³• 1 sysctl vm.swappiness=20 # æ–¹æ³• 2 echo 20 \u0026gt; /proc/sys/vm/swappiness ä¸´æ—¶è°ƒæ•´é‡å¯åå¤±æ•ˆï¼Œé€‚åˆæµ‹è¯•ä¸åŒå€¼çš„æ•ˆæœ\n4. æ°¸ä¹…è°ƒæ•´ Swappiness 1 2 3 4 5 # åˆ›å»ºä¸“ç”¨é…ç½®æ–‡ä»¶ echo \u0026#39;vm.swappiness=20\u0026#39; \u0026gt; /etc/sysctl.d/99-swap.conf # ç«‹å³ç”Ÿæ•ˆ sysctl -p /etc/sysctl.d/99-swap.conf 5. Swappiness æ¨èå€¼ åœºæ™¯ æ¨èå€¼ è¯´æ˜ æ¡Œé¢ç³»ç»Ÿ 10-30 å‡å°‘å¡é¡¿ï¼Œæå‡å“åº”é€Ÿåº¦ æœåŠ¡å™¨ 10-20 ä¼˜å…ˆä½¿ç”¨ç‰©ç†å†…å­˜ æ•°æ®åº“æœåŠ¡å™¨ 1-10 æå°½é‡é¿å…ä½¿ç”¨ Swap å†…å­˜ä¸¥é‡ä¸è¶³ 60-80 ç§¯æä½¿ç”¨ Swap é¿å…å´©æºƒ FnOS ç³»ç»Ÿ 15-25 å¹³è¡¡ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§ 6. ç›¸å…³å‚æ•°è°ƒæ•´ 1 2 3 4 5 6 7 # è°ƒæ•´è™šæ‹Ÿå†…å­˜ç®¡ç†å‚æ•° echo \u0026#39;vm.vfs_cache_pressure=50\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_ratio=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_background_ratio=5\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf # åº”ç”¨é…ç½® sysctl -p âš–ï¸ äº”ã€å¯ç”¨ Swap çš„ä¼˜ç¼ºç‚¹ âœ… ä¼˜ç‚¹ å†…å­˜æ‰©å±•ï¼šç¼“è§£ç‰©ç†å†…å­˜å‹åŠ› ç³»ç»Ÿç¨³å®šï¼šé˜²æ­¢å†…å­˜è€—å°½å¯¼è‡´ç³»ç»Ÿå´©æºƒ è¿›ç¨‹ä¿æŠ¤ï¼šé¿å…é‡è¦è¿›ç¨‹è¢« OOM Killer ç»ˆæ­¢ æˆæœ¬æ•ˆç›Šï¼šç”¨å»‰ä»·ç¡¬ç›˜ç©ºé—´æ‰©å±•æ˜‚è´µçš„å†…å­˜ ä¼‘çœ æ”¯æŒï¼šç³»ç»Ÿä¼‘çœ éœ€è¦ Swap ç©ºé—´ä¿å­˜å†…å­˜çŠ¶æ€ âŒ ç¼ºç‚¹ æ€§èƒ½ä¸‹é™ï¼šç¡¬ç›˜é€Ÿåº¦è¿œä½äºå†…å­˜ ç¡¬ç›˜ç£¨æŸï¼šé¢‘ç¹äº¤æ¢æ“ä½œå¯èƒ½ç¼©çŸ­ SSD å¯¿å‘½ å“åº”å»¶è¿Ÿï¼šå†…å­˜ä¸è¶³æ—¶ç³»ç»Ÿå“åº”å˜æ…¢ ç®¡ç†å¤æ‚åº¦ï¼šéœ€è¦åˆç†é…ç½®å’Œç›‘æ§ ğŸ“Š æ€§èƒ½å½±å“åˆ†æ 1 2 3 4 5 6 7 8 # æµ‹è¯•ç£ç›˜ I/O æ€§èƒ½ï¼ˆå½±å“ Swap æ€§èƒ½çš„å…³é”®å› ç´ ï¼‰ dd if=/dev/zero of=/tmp/test bs=8k count=1000000 # ç›‘æ§ Swap I/O iostat -xm 1 # æŸ¥çœ‹å†…å­˜å’Œ Swap ä½¿ç”¨è¶‹åŠ¿ vmstat 1 ğŸš€ å…­ã€ä¼˜åŒ– Swap æ€§èƒ½çš„ç­–ç•¥ 1. ä½¿ç”¨é«˜æ€§èƒ½å­˜å‚¨ 1 2 3 4 5 6 7 # ä¼˜å…ˆä½¿ç”¨ SSD åˆ›å»º Swap dd if=/dev/zero of=/swapfile bs=1G count=8 status=progress # è®¾ç½®æ­£ç¡®æƒé™å’Œå±æ€§ chmod 0600 /swapfile mkswap /swapfile swapon /swapfile 2. ç›‘æ§ Swap ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®æ—¶ç›‘æ§ watch -n 1 \u0026#39;free -h; echo \u0026#34;Swappiness: $(cat /proc/sys/vm/swappiness)\u0026#34;\u0026#39; # æŸ¥çœ‹è¯¦ç»† Swap ä¿¡æ¯ cat /proc/swaps # ç›‘æ§ Swap I/O æ´»åŠ¨ iostat -xm 1 # æŸ¥çœ‹å“ªäº›è¿›ç¨‹ä½¿ç”¨ Swap for file in /proc/*/status; do awk \u0026#39;/VmSwap|Name/{printf $2 \u0026#34; \u0026#34; $3}END{ print \u0026#34;\u0026#34;}\u0026#39; $file done 2\u0026gt;/dev/null | sort -k 2 -n -r | head -10 ğŸ“Š ä¸ƒã€Swap å¤§å°è§„åˆ’å»ºè®® ç‰©ç†å†…å­˜å¤§å° æ¨è Swap å¤§å° è¯´æ˜ â‰¤ 2GB 2Ã— å†…å­˜ ä¼ ç»Ÿå»ºè®®ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ 2-8GB =å†…å­˜ å¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§ 8-64GB 4-16GB æœåŠ¡å™¨ç¯å¢ƒæ¨èå€¼ â‰¥ 64GB 4-8GB å¤§å†…å­˜ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºåº”æ€¥ ä¼‘çœ éœ€æ±‚ å†…å­˜å¤§å° + 10% ç³»ç»Ÿä¼‘çœ éœ€è¦è¶³å¤Ÿç©ºé—´ä¿å­˜å†…å­˜çŠ¶æ€ ğŸ’¡ FnOS ç‰¹å®šå»ºè®® å¯¹äº FnOS ç³»ç»Ÿï¼Œå»ºè®®é…ç½®ï¼š\næœ€å°: 2GB Swap æ¨è: 4-8GB Swap æœ€å¤§: ä¸è¶…è¿‡ 16GBï¼ˆé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼‰ ğŸ”¢ è®¡ç®—å…¬å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ ¹æ®å†…å­˜è®¡ç®—æ¨è Swap å¤§å° MEMORY_GB=$(free -g | awk \u0026#39;/Mem:/ {print $2}\u0026#39;) if [ $MEMORY_GB -le 2 ]; then SWAP_GB=$((MEMORY_GB * 2)) elif [ $MEMORY_GB -le 8 ]; then SWAP_GB=$MEMORY_GB elif [ $MEMORY_GB -le 64 ]; then SWAP_GB=16 else SWAP_GB=8 fi echo \u0026#34;æ¨è Swap å¤§å°: ${SWAP_GB}GB\u0026#34; ğŸ”§ å…«ã€é«˜çº§é…ç½®æŠ€å·§ 1. ä½¿ç”¨ ZRAMï¼ˆå†…å­˜å‹ç¼©ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®‰è£… zram-tools apt install zram-tools # é…ç½® ZRAMï¼ˆç¼–è¾‘ /etc/default/zramswapï¼‰ PERCENTAGE=50 PRIORITY=100 ALGORITHM=lz4 # é‡å¯æœåŠ¡ systemctl restart zramswap # æŸ¥çœ‹çŠ¶æ€ zramctl 2. è°ƒæ•´ç¼“å­˜å‹åŠ› 1 2 3 4 5 6 7 # å‡å°‘ç¼“å­˜å‹åŠ›ï¼Œé™ä½ Swap ä½¿ç”¨ echo 50 \u0026gt; /proc/sys/vm/vfs_cache_pressure echo \u0026#39;vm.vfs_cache_pressure=50\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf # è°ƒæ•´è„é¡µå†™å›ç­–ç•¥ echo \u0026#39;vm.dirty_ratio=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_background_ratio=5\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf 3. åº”æ€¥å†…å­˜ç®¡ç† 1 2 3 4 5 6 7 8 # æ‰‹åŠ¨é‡Šæ”¾ç¼“å­˜ echo 3 \u0026gt; /proc/sys/vm/drop_caches # ä»…é‡Šæ”¾é¡µç¼“å­˜ echo 1 \u0026gt; /proc/sys/vm/drop_caches # æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¯¦æƒ… cat /proc/meminfo ğŸš¨ ä¹ã€æ•…éšœæ’é™¤ä¸æ³¨æ„äº‹é¡¹ 1. Swap åˆ›å»ºå¤±è´¥ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹ df -T # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /swapfile 2. Swap æ— æ³•å¯ç”¨ 1 2 3 4 5 6 7 8 # æ£€æŸ¥æ–‡ä»¶ç³»ç»ŸæŒ‚è½½é€‰é¡¹ mount | grep \u0026#34; / \u0026#34; # é‡æ–°æ ¼å¼åŒ– mkswap -f /swapfile # æ£€æŸ¥å†…æ ¸æ—¥å¿— dmesg | grep -i swap 3. æ€§èƒ½é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ Swap ä½¿ç”¨æƒ…å†µ vmstat 1 # æ£€æŸ¥å“ªäº›è¿›ç¨‹ä½¿ç”¨ Swap for file in /proc/*/status; do awk \u0026#39;/VmSwap|Name/{printf $2 \u0026#34; \u0026#34; $3}END{ print \u0026#34;\u0026#34;}\u0026#39; $file done 2\u0026gt;/dev/null | sort -k 2 -n -r | head -10 # ç›‘æ§ç£ç›˜ I/O iotop -o 4. å®‰å…¨æ³¨æ„äº‹é¡¹ ç¡®ä¿ Swap æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆ0600ï¼‰ é¿å…å°† Swap æ–‡ä»¶æ”¾åœ¨åŠ å¯†åˆ†åŒºï¼ˆæ€§èƒ½æå·®ï¼‰ å®šæœŸç›‘æ§ Swap ä½¿ç”¨æƒ…å†µï¼Œé¿å…è¿‡åº¦ä¾èµ– åœ¨æ•æ„Ÿç¯å¢ƒä¸­è€ƒè™‘åŠ å¯† Swap å†…å®¹ ğŸ“ˆ åã€ç›‘æ§ä¸ç»´æŠ¤ 1. åˆ›å»ºç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash # swap_monitor.sh - ç›‘æ§ Swap ä½¿ç”¨æƒ…å†µ THRESHOLD=80 # è­¦å‘Šé˜ˆå€¼ç™¾åˆ†æ¯” LOG_FILE=\u0026#34;/var/log/swap_monitor.log\u0026#34; # è·å– Swap ä½¿ç”¨ç‡ swap_total=$(free | awk \u0026#39;/Swap/ {print $2}\u0026#39;) swap_used=$(free | awk \u0026#39;/Swap/ {print $3}\u0026#39;) if [ $swap_total -gt 0 ]; then swap_usage=$((swap_used * 100 / swap_total)) else swap_usage=0 fi echo \u0026#34;$(date): Swap ä½¿ç”¨ç‡: $swap_usage%\u0026#34; \u0026gt;\u0026gt; $LOG_FILE if [ $swap_usage -ge $THRESHOLD ]; then echo \u0026#34;$(date): è­¦å‘Š: Swap ä½¿ç”¨ç‡è¶…è¿‡ $THRESHOLD%!\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # è§¦å‘åº”æ€¥æªæ–½ echo 1 \u0026gt; /proc/sys/vm/drop_caches fi 2. è®¾ç½®å®šæœŸç›‘æ§ 1 2 # æ·»åŠ å®šæ—¶ä»»åŠ¡ echo \u0026#34;*/5 * * * * root /usr/local/bin/swap_monitor.sh\u0026#34; \u0026gt; /etc/cron.d/swap_monitor 3. å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 7 # æ£€æŸ¥ Swap æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§ swapon --show | grep file | awk \u0026#39;{print $1}\u0026#39; | while read swapfile; do if ! swapon -s | grep -q \u0026#34;$swapfile\u0026#34;; then mkswap -f \u0026#34;$swapfile\u0026#34; swapon \u0026#34;$swapfile\u0026#34; fi done ğŸ¯ æ€»ç»“ Swap æ˜¯ Linux ç³»ç»Ÿé‡è¦çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œåˆç†é…ç½®å¯ä»¥æå‡ç³»ç»Ÿç¨³å®šæ€§ã€‚å¯¹äº FnOS ç³»ç»Ÿï¼Œå»ºè®®ï¼š\næ ¹æ®å†…å­˜å¤§å°é…ç½®é€‚é‡ Swapï¼ˆé€šå¸¸ 4-8GBï¼‰ è®¾ç½®é€‚å½“çš„ swappiness å€¼ï¼ˆ15-25ï¼‰ ä½¿ç”¨é«˜æ€§èƒ½å­˜å‚¨åˆ›å»º Swap é…ç½®ç›‘æ§å’Œè­¦æŠ¥ï¼ŒåŠæ—¶å‘ç°å†…å­˜é—®é¢˜ å®šæœŸç»´æŠ¤ Swap ç©ºé—´ï¼Œç¡®ä¿ç³»ç»Ÿå¥åº·è¿è¡Œ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ– FnOS ä¸­çš„ Swap é…ç½®ï¼Œæ„å»ºæ›´ç¨³å®šé«˜æ•ˆçš„è®¡ç®—ç¯å¢ƒï¼\nğŸ’¡ æç¤ºï¼šåœ¨è¿›è¡Œä»»ä½•ç³»ç»Ÿé…ç½®æ›´æ”¹å‰ï¼Œè¯·ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç† FnOS ç³»ç»Ÿçš„å†…å­˜èµ„æºï¼\n","date":"2025-09-13T22:55:13+08:00","image":"https://file.meimolihan.eu.org/img/pve-swap-01.webp","permalink":"https://blog.meimolihan.eu.org/p/875ccd03/","title":"FnOS è™šæ‹Ÿå†…å­˜ Swap å…¨é¢è§£æ ğŸ§"},{"content":"Hexo + Butterfly ä¸»é¢˜ç¾åŒ–æŒ‡å— ğŸ¨ âœ¨ ç‰¹åˆ«è¯´æ˜\næ¬¢è¿è®¿é—®æœ¬ç«™ï¼æœ¬åšå®¢åŸºäº Hexo é™æ€æ¡†æ¶ + Butterfly ä¸»é¢˜æ„å»ºï¼Œå…¼å…·ç®€æ´ç¾è§‚ä¸å¼ºå¤§åŠŸèƒ½ã€‚\nğŸ“Œ æœ¬ç«™å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸æ‰¿æ‹…å› ç‰ˆæœ¬å·®å¼‚å¯¼è‡´çš„é—®é¢˜ã€‚å·²é€‚é…ç‰ˆæœ¬ï¼š\nHexo 7.3.0 Butterfly 5.3.5 ğŸ“‘ å¯¼èˆªç›®å½• ğŸ¯ ä¸€ã€é¡µè„šæ¸å˜è‰²æ•ˆæœ â¬‡ï¸ äºŒã€ç›´è¾¾åº•éƒ¨æŒ‰é’® âœ¨ ä¸‰ã€åŠ¨ç”»ç‰¹æ•ˆå¢å¼º ğŸ”– å››ã€æ ‡é¢˜å›¾æ ‡ç¾åŒ– ğŸµ äº”ã€å…¨å±€å¸åº•æ’­æ”¾å™¨ ğŸŒŠ å…­ã€æ–‡ç« é¡¶éƒ¨æ³¢æµªæ•ˆæœ ğŸ“ ä¸ƒã€æ–‡ç« æ ‡é¢˜å±…ä¸­ ğŸ§² å…«ã€é¦–é¡µåˆ†ç±»ç£è´´ ğŸŒ™ ä¹ã€å¤œé—´æ¨¡å¼åŠ¨ç”» ğŸ¨ åã€å¯¼èˆªæ å¤šå½©å›¾æ ‡ ğŸ’« åä¸€ã€é»‘å¤œéœ“è™¹ç¯æ•ˆæœ ğŸ”² åäºŒã€å…¨å±€åœ†è§’è®¾è®¡ ğŸ­ åä¸‰ã€é¡µé¢ç¾åŒ–ä¼˜åŒ– ğŸš€ åå››ã€CDNåŠ é€Ÿé…ç½® ğŸ˜º åäº”ã€æŒ‚ç»³å°çŒ«å’ªç‰¹æ•ˆ ğŸ›¡ï¸ åå…­ã€ç¦ç”¨F12ä¿æŠ¤ ğŸ‘ï¸ åä¸ƒã€å†™è½®çœ¼åŠ è½½åŠ¨ç”» â° åå…«ã€é¡µè„šå¾½æ ‡å’Œè®¡æ—¶å™¨ ğŸ–¼ï¸ åä¹ã€ä¸€å›¾æµèƒŒæ™¯è®¾è®¡ ğŸ”¤ äºŒåã€å¼•ç”¨å­—ä½“ç¾åŒ– ğŸšï¸ äºŒåä¸€ã€æ»šåŠ¨æ¡æ ·å¼ç¾åŒ– ğŸ’¡ äºŒåäºŒã€å¤´åƒå‘¼å¸ç¯æ•ˆæœ ğŸ–¼ï¸ äºŒåä¸‰ã€åšå®¢èƒŒæ™¯åˆ‡æ¢ ğŸ‘‹ äºŒåå››ã€è®¿å®¢å®šä½æ¬¢è¿ä¿¡æ¯ ğŸ¾ äºŒåäº”ã€è„šé¡µæ·»åŠ å°åŠ¨ç‰© ğŸ“œ äºŒåå…­ã€ä»Šæ—¥è¯—è¯ä¾§è¾¹æ  ğŸ“‹ äºŒåä¸ƒã€å¤åˆ¶å¼¹çª—æé†’ ğŸ“– äºŒåå…« ã€ç•™è¨€æ¿ Violet é£æ ¼ ğŸ“– äºŒåä¹ ã€æ–‡ç« ç½®é¡¶è½®æ’­å›¾ ğŸ¯ ä¸€ã€é¡µè„šæ¸å˜è‰²æ•ˆæœ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä¸ºåšå®¢é¡µè„šæ·»åŠ åŠ¨æ€æ¸å˜è‰²å½©æ•ˆæœï¼Œè‰²å½©å¹³æ»‘è¿‡æ¸¡ï¼Œæå‡è§†è§‰ä½“éªŒã€‚æ”¯æŒå¤šè‰²æ¸å˜å¾ªç¯åŠ¨ç”»ï¼Œè®©é¡µè„šåŒºåŸŸå˜å¾—ç”ŸåŠ¨æœ‰è¶£ã€‚ ğŸ”§ å®ç°æ­¥éª¤ 1. ğŸ§© åˆ›å»ºCSSæ–‡ä»¶ï¼š åˆ›å»º Hexoæ ¹ç›®å½•/source/css/é¡µè„šæ¸å˜.css æ–‡ä»¶ï¼Œå°†ä¸‹é¢ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 /* æ¸å˜è‰²æ»šåŠ¨åŠ¨ç”» */ @-webkit-keyframes Gradient { 0% { background-position: 0 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0 50%; } } @-moz-keyframes Gradient { 0% { background-position: 0 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0 50%; } } @keyframes Gradient { 0% { background-position: 0 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0 50%; } } #footer { background: linear-gradient(-45deg, #2e3740, #3b4a5e, #665c78, #7d5a52, #4a4a4a, #1e293b); background-size: 600% 600%; /* å¢åŠ èƒŒæ™¯å°ºå¯¸ä»¥é€‚åº”æ›´å¤šçš„é¢œè‰² */ -webkit-animation: Gradient 15s ease infinite; /* è°ƒæ•´åŠ¨ç”»æ—¶é•¿ä»¥æ›´å¥½åœ°å±•ç¤ºæ‰€æœ‰é¢œè‰² */ -moz-animation: Gradient 15s ease infinite; animation: Gradient 15s ease infinite; -o-user-select: none; -ms-user-select: none; -webkit-user-select: none; -moz-user-select: none; user-select: none; border-top-left-radius: 20px; border-top-right-radius: 20px; } #footer:before { background-color: rgba(0, 0, 0, 0); } 2. â• å¼•å…¥CSSæ–‡ä»¶ï¼š åœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œå¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ 1 2 3 inject: head: # å¼•å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/é¡µè„šæ¸å˜.css\u0026#34;\u0026gt; 3. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s â¬‡ï¸ äºŒã€ç›´è¾¾åº•éƒ¨æŒ‰é’® âœ¨ åŠŸèƒ½ç‰¹ç‚¹ æ·»åŠ ä¸€é”®æ»šåŠ¨è‡³é¡µé¢åº•éƒ¨çš„ä¾¿æ·æŒ‰é’®ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«é€‚åˆé•¿æ–‡ç« é¡µé¢ã€‚ ğŸ”§ å®ç°æ–¹æ³• åœ¨Hexoæ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\rightside.pugæœ€åæ·»åŠ ä»¥ä¸‹å†…å®¹ 1 2 3 // ç›´è¾¾åº•éƒ¨æŒ‰é’® button#go-down(type=\u0026#34;button\u0026#34; title=\u0026#34;ç›´è¾¾åº•éƒ¨\u0026#34; onclick=\u0026#34;btf.scrollToDest(document.body.scrollHeight, 500)\u0026#34;) i.fas.fa-arrow-down âœ¨ ä¸‰ã€åŠ¨ç”»ç‰¹æ•ˆå¢å¼º âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä½¿ç”¨ WOW.js ä¸ºé¡µé¢å…ƒç´ æ·»åŠ ä¸°å¯Œçš„å…¥åœºåŠ¨ç”»æ•ˆæœï¼Œè®©é¡µé¢åŠ è½½å’Œæ»šåŠ¨æ—¶å‘ˆç°æµç•…çš„åŠ¨ç”»ä½“éªŒã€‚ ğŸ”§ å®‰è£…é…ç½® 1 npm install hexo-butterfly-wowjs --save åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶_config.yml æˆ–è€…ä¸»é¢˜é…ç½®æ–‡ä»¶_config.butterfly.yml ä¸­æ·»åŠ ï¼š åŠ¨ç”»é¢„è§ˆç½‘ç«™ï¼š https://animate.style/ âš™ï¸ é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 # Hexo + Butterfly å¢åŠ åŠ¨ç”»ç‰¹æ•ˆ wowjs: enable: true #æ§åˆ¶åŠ¨ç”»å¼€å…³ã€‚trueæ˜¯æ‰“å¼€ï¼Œfalseæ˜¯å…³é—­ priority: 10 #è¿‡æ»¤å™¨ä¼˜å…ˆçº§ mobile: true #ç§»åŠ¨ç«¯æ˜¯å¦å¯ç”¨ï¼Œé»˜è®¤ç§»åŠ¨ç«¯ç¦ç”¨ animateitem: - class: recent-post-item # - class: recent-post-item #å¿…å¡«é¡¹ï¼Œéœ€è¦æ·»åŠ åŠ¨ç”»çš„å…ƒç´ çš„class style: animate__zoomIn # style: animate__zoomInLeft #å¿…å¡«é¡¹ï¼Œéœ€è¦æ·»åŠ çš„åŠ¨ç”» duration: 900ms #é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»æŒç»­æ—¶é—´ï¼Œå•ä½å¯ä»¥æ˜¯msä¹Ÿå¯ä»¥æ˜¯sã€‚ä¾‹å¦‚3sï¼Œ700msã€‚ delay: 800ms #é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»å¼€å§‹çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½å¯ä»¥æ˜¯msä¹Ÿå¯ä»¥æ˜¯sã€‚ä¾‹å¦‚3sï¼Œ700msã€‚ offset: 100 #é€‰å¡«é¡¹ï¼Œå¼€å§‹åŠ¨ç”»çš„è·ç¦»ï¼ˆç›¸å¯¹æµè§ˆå™¨åº•éƒ¨ï¼‰ iteration: 1 #é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»é‡å¤çš„æ¬¡æ•° # ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„åŠ¨ç”»æ•ˆæœï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ # æ–‡ç« TOCåŠ¨ç”» - class: card-widget style: animate__zoomIn duration: 2s delay: 1s # é¦–é¡µå¯¼èˆªæ  - class: menus_item style: animate__slideInRight duration: 2s delay: 1s # å¯¼èˆªæ -ç«™ç‚¹æ ‡é¢˜ - class: nav-site-title style: animate__zoomIn duration: 2s delay: 1s # å¯¼èˆªæ -æœç´¢æŒ‰é’® - class: site-page social-icon search style: animate__zoomIn duration: 2s delay: 1s # å¯¼èˆªæ -æ˜æš—æ¨¡å¼ - class: sun_moon faa-parent animated-hover style: animate__zoomIn duration: 2s delay: 1s # é¦–é¡µæ–‡ç« æ ‡é¢˜ - class: post-title style: animate__zoomIn duration: 2s delay: 1s - class: meta-firstline style: animate__zoomIn duration: 2s delay: 1s - class: meta-secondline style: animate__zoomIn duration: 2s delay: 1s # æ ‡ç­¾é¡µ - class: tag-cloud-list text-center style: animate__zoomIn duration: 2s delay: 1s # åˆ†ç±»é¡µ - class: category-lists style: animate__zoomIn duration: 2s delay: 1s # é¦–é¡µä¾§è¾¹æ åˆ†ç±» - class: card-category-list-item style: animate__backInRight duration: 2s delay: 1s # ä¾§è¾¹æ -ç½‘ç«™ä¿¡æ¯ - class: webinfo-item style: animate__backInRight duration: 2s delay: 1s # å½’æ¡£é¡µ - class: article-sort-item style: animate__fadeInRightBig duration: 2s delay: 1s # å‹é“¾é¡µ - class: flink-list style: animate__zoomIn duration: 2s delay: 1s # å…³äºé¡µ - class: container style: animate__zoomIn duration: 2s delay: 1s # aplayer æ’­æ”¾å™¨ - class: aplayer-body style: animate__slideInRight duration: 2s delay: 1s iteration: 3 # ä»£ç æ¡† - class: highlight style: animate__zoomIn duration: 900ms delay: 800ms # æ ‡ç­¾å¤–æŒ‚ - class: folding-tag style: animate__zoomIn duration: 900ms delay: 800ms # åˆ†é¡µ - class: pagination style: animate__zoomIn duration: 900ms delay: 800ms # è„šé¡µå»ºç«™æ—¶é—´ - class: copyright style: animate__zoomIn duration: 900ms delay: 800ms # è¯„è®º 1 - class: comment-head style: animate__zoomIn duration: 900ms delay: 800ms # è¯„è®º 2 - class: comment-wrap style: animate__zoomIn duration: 900ms delay: 800ms # æ–‡ç« é¡µä¹¦ç­¾ - class: tag_share style: animate__zoomIn duration: 900ms delay: 800ms # ä¸‹ä¸€ç¯‡æ–‡ç«  - class: pagination-post style: animate__zoomIn duration: 900ms delay: 800ms # ç›¸å…³æ–‡ç« æ–‡å­— - class: headline style: animate__zoomIn duration: 900ms delay: 800ms # ç›¸å…³æ–‡ç« å¡ç‰‡ - class: relatedPosts-list style: animate__zoomIn duration: 900ms delay: 800ms # æ–‡ç« å†…å®¹ - class: container post-content style: animate__zoomIn duration: 2s delay: 1s # æ–‡ç« å†…å®¹ä¸‹é¢åˆ†å‰²çº¿ - class: custom-hr style: animate__zoomIn duration: 900ms delay: 800ms - class: boardsign style: animate__zoomIn duration: 900ms delay: 800ms # ä¾§è¾¹æ -å…¬å‘Š - class: announcement_content style: animate__backInRight duration: 2s delay: 1s # ä¾§è¾¹æ -æ ‡ç­¾äº‘å†…å®¹ - class: card-tag-cloud style: animate__backInRight duration: 2s delay: 1s # ä¾§è¾¹æ -æœ€è¿‘æ–‡ç«  - class: aside-list-item style: animate__backInRight duration: 2s delay: 1s # ä¾§è¾¹æ -å¤´åƒ - class: site-data style: animate__backInRight duration: 2s delay: 1s - class: author-info-name style: animate__backInRight duration: 2s delay: 1s # é¦–é¡µæ–‡ç« å°é¢ # - class: post-bg # style: animate__fadeInRightBig # duration: 3s # delay: 2s # - class: recent-post-info # style: animate__fadeInRightBig # duration: 3s # delay: 2s # æ–‡ç« TOCç›®å½•å†…å®¹ - class: toc-item toc-level-2 style: animate__backInRight duration: 2s delay: 1s - class: item-headline style: animate__backInRight duration: 2s delay: 1s - class: toc-link style: animate__backInRight duration: 2s delay: 1s animate_css: https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css wow_js: https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js wow_init_js: https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js # animate_css: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo-butterfly-wowjs/animate.min.css # wow_js: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo-butterfly-wowjs/wow.min.js # wow_init_js: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo-butterfly-wowjs/wow_init.js ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ”– å››ã€æ ‡é¢˜å›¾æ ‡ç¾åŒ– âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä¸ºæ–‡ç« æ ‡é¢˜æ·»åŠ æ—‹è½¬é£è½¦å›¾æ ‡ï¼Œå¢å¼ºè§†è§‰å¸å¼•åŠ›ï¼Œæ”¯æŒæ‚¬åœç‰¹æ•ˆå’Œå“åº”å¼è®¾è®¡ã€‚\nğŸ¨ ç‰¹è‰²åŠŸèƒ½ ğŸŒ€ åŠ¨æ€æ—‹è½¬é£è½¦å›¾æ ‡ ğŸ¯ å¤šçº§æ ‡é¢˜ä¸åŒé¢œè‰² ğŸ“± ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ– âœ¨ æ‚¬åœæ”¾å¤§æ•ˆæœ ğŸ¨ ä¿®æ”¹ä¸»é¢˜é…ç½® æ–‡ä»¶_config.butterfly.ymlæ–‡ä»¶çš„beautifyé…ç½®é¡¹ 1 2 3 4 5 6 beautify: enable: true field: post # site/post # title-prefix-icon: \u0026#39;\\f0c1\u0026#39; åŸå†…å®¹ title-prefix-icon: \u0026#39;\\f863\u0026#39; title-prefix-icon-color: \u0026#34;#F47466\u0026#34; åˆ›å»º Hexoæ ¹ç›®å½•/source/css/custom-icon.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ ã€ fontawesome çš„ icon å›¾æ ‡ä»£å· ã€‘ ğŸ§© åˆ›å»ºCSSæ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 /* å¯¼å…¥å­—ä½“åº“ */ @import url(\u0026#39;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css\u0026#39;); /* é£â€®åŸºè½¦â€¬ç¡€æ ·å¼ */ #content-inner.layout h1::before, #content-inner.layout h2::before, #content-inner.layout h3::before, #content-inner.layout h4::before, #content-inner.layout h5::before, #content-inner.layout h6::before { content: \u0026#34;\\f863\u0026#34;; /* é£è½¦å›¾æ ‡ */ font-family: \u0026#39;Font Awesome 5 Free\u0026#39;; /* å­—ä½“åº“ */ font-weight: 900; /* å›¾æ ‡ç²—ç»† */ display: inline-block; /* ç¡®ä¿åŠ¨ç”»ç”Ÿæ•ˆ */ width: 1.2em; /* å›¾â€®å®¹æ ‡â€¬å™¨å®½åº¦ */ text-align: center; /* å›¾æ ‡å±…ä¸­ */ transition: all 0.3s ease; /* è¿‡æ¸¡åŠ¨ç”» */ -webkit-animation: ccc 4s linear infinite; animation: ccc 4s linear infinite; /* æ–°â€®å®šå¢â€¬ä½å±æ€§ */ position: absolute; left: 0; top: 50%; transform: translateY(-50%); } /* æ ‡â€®åŸºé¢˜â€¬ç¡€æ ·å¼ */ #content-inner.layout h1, #content-inner.layout h2, #content-inner.layout h3, #content-inner.layout h4, #content-inner.layout h5, #content-inner.layout h6 { position: relative; /* å®šä½åŸºå‡† */ display: block; /* æ”¹ä¸ºå—çº§å…ƒç´  */ padding-left: 1.8rem !important; /* å·¦ä¾§ç•™å‡ºâ€®æ ‡å›¾â€¬ç©ºé—´ */ margin: 15px 0; transition: transform 0.3s ease; } /* å„å±‚çº§â€®è½¦é£â€¬é¢œè‰²ä¸å®šâ€®å¾®ä½â€¬è°ƒ */ #content-inner.layout h1::before { color: #ef50a8; font-size: 1.3rem; left: -0.1rem; } #content-inner.layout h2::before { color: #fb7061; font-size: 1.1rem; left: -0.1rem; } #content-inner.layout h3::before { color: #ffbf00; font-size: 0.95rem; left: -0.1rem; } #content-inner.layout h4::before { color: #a9e000; font-size: 0.8rem; } #content-inner.layout h5::before { color: #57c850; font-size: 0.7rem; } #content-inner.layout h6::before { color: #5ec1e0; font-size: 0.66rem; } /* æ—‹è½¬åŠ¨ç”» */ @keyframes ccc { 0% { transform: translateY(-50%) rotate(0deg); } 100% { transform: translateY(-50%) rotate(-360deg); } } /* æ ‡é¢˜æ‚¬åœæ•ˆæœ */ #content-inner.layout h1:hover, #content-inner.layout h2:hover, #content-inner.layout h3:hover, #content-inner.layout h4:hover, #content-inner.layout h5:hover, #content-inner.layout h6:hover { color: #2196f3 !important; transform: scale(1.05); transition: color 0.3s ease, transform 0.3s ease; } /* é£è½¦â€®åœæ‚¬â€¬ç‰¹æ•ˆ */ #content-inner.layout h1:hover::before, #content-inner.layout h2:hover::before, #content-inner.layout h3:hover::before, #content-inner.layout h4:hover::before, #content-inner.layout h5:hover::before, #content-inner.layout h6:hover::before { filter: brightness(1.2); transform: translateY(-50%) scale(1.1) rotate(360deg); color: #2196f3 !important; transition: all 0.3s ease; -webkit-animation: ccc 2s linear infinite; animation: ccc 2s linear infinite; } /* ç§»åŠ¨ç«¯é€‚é… */ @media screen and (max-width: 768px) { #content-inner.layout h1, #content-inner.layout h2, #content-inner.layout h3, #content-inner.layout h4, #content-inner.layout h5, #content-inner.layout h6 { padding-left: 1.5rem !important; } #content-inner.layout h1::before { font-size: 1.1rem } #content-inner.layout h2::before { font-size: 1.0rem } #content-inner.layout h3::before { font-size: 0.9rem } #content-inner.layout h4::before { font-size: 0.75rem } #content-inner.layout h5::before { font-size: 0.65rem } #content-inner.layout h6::before { font-size: 0.6rem } } â• å¼•å…¥CSSæ–‡ä»¶ï¼š\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: # æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/custom-icon.css\u0026#34;\u0026gt; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸµ äº”ã€å…¨å±€å¸åº•æ’­æ”¾å™¨ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ æ·»åŠ å…¨å±€éŸ³ä¹æ’­æ”¾å™¨ï¼Œæ”¯æŒæ­Œå•ç®¡ç†ã€æ­Œè¯æ˜¾ç¤ºã€ç¾è§‚çš„æ’­æ”¾æ§åˆ¶ç•Œé¢ã€‚\nğŸ”§ å®‰è£…æ’ä»¶ 1 npm install --save hexo-tag-aplayer âš™ï¸ _config.yml é…ç½®ç¤ºä¾‹ 1 2 3 aplayer: meting: true asset_inject: false âš™ï¸ _config.butterfly.yml é…ç½®ç¤ºä¾‹ 1 2 3 aplayerInject: enable: true per_page: true ğŸµ aplayer çš„ html é…ç½®æ–‡ä»¶ åœ¨Hexoæ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\head.pugåè¿½åŠ å†…å®¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // æ·»åŠ éŸ³é¢‘æ’­æ”¾å™¨ä»£ç  link(rel=\u0026#39;stylesheet\u0026#39;, href=\u0026#39;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\u0026#39;) script(src=\u0026#39;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\u0026#39;) #aplayer script. const home = \u0026#39;https://xxx.yyyy.com/\u0026#39;; const songs = [ \u0026#39;é‡ç‹¼disco-å®çŸ³Gem\u0026#39;, \u0026#39;é™¤äº†ç”Ÿæ­»éƒ½æ˜¯æ“¦ä¼¤-ä¾¯æ³½æ¶¦\u0026#39;, ]; let audios = []; // éå†æ­Œæ›²åˆ—è¡¨ songs.forEach((item) =\u0026gt; { const songInfo = item.split(\u0026#39;-\u0026#39;); audios.push({ name: songInfo[0], artist: songInfo[1], url: home + item + \u0026#39;/song.mp3\u0026#39;, cover: home + item + \u0026#39;/cover.jpg\u0026#39;, lrc: home + item + \u0026#39;/lyric.lrc\u0026#39; }); }); const ap = new APlayer({ container: document.getElementById(\u0026#39;aplayer\u0026#39;), fixed: true, lrcType: 3, audio: audios }); è¯´æ˜ 1 2 3 4 5 6 7 å®Œæ•´æ­Œæ›²é“¾æ¥ï¼šhttps://xxx.yyyy.com/é‡ç‹¼disco-å®çŸ³Gem/lyric.lrc â”€â”€ https://xxx.yyyy.com/ â”œâ”€â”€ é‡ç‹¼disco-å®çŸ³Gem # æ­Œæ›²æ–‡ä»¶å¤¹ï¼ˆæ ¹æ®`-`å‰åæ¥åŒ¹é…æ­Œæ‰‹åå’Œæ­Œæ›²åï¼‰ â”œâ”€â”€ song.mp3 # æ­Œæ›² â”œâ”€â”€ cover.jpg # å°é¢ â””â”€â”€ lyric.lrc #æ­Œè¯ ğŸµ aplyer éŸ³ä¹æ’­æ”¾å™¨ç¾åŒ– æ·»åŠ ä»£ç åˆ° aplayer.css æ–‡ä»¶ åˆ›å»º Hexoæ ¹ç›®å½•/source/css/aplayer.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 /*aplayeræ—¥é—´æ¨¡å¼è°ƒæ•´*/ /*èƒŒæ™¯è‰²*/ .aplayer{ background: rgba(255, 255, 255, 0.60)!important; box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.07),0 1px 5px 0 rgba(0,0,0,.1); position: relative; } .aplayer.aplayer-fixed .aplayer-lrc:after,.aplayer.aplayer-fixed .aplayer-lrc:before { display: none } .aplayer.aplayer.aplayer-fixed .aplayer-body{ background:rgba(255, 255, 255, 0.60)!important; box-shadow: 0 2px 2px 0 rgba(0,0,0,.07),0 1px 5px 0 rgba(0,0,0,.1); position: fixed; } /*æ¯›ç»ç’ƒæ•ˆæœ*/ .aplayer-list{ backdrop-filter: blur(3px); } .aplayer-info{ backdrop-filter: blur(3px); } /*æ»šåŠ¨æ¡*/ .aplayer .aplayer-list ol::-webkit-scrollbar { width: 5px } .aplayer .aplayer-list ol::-webkit-scrollbar-thumb { border-radius: 3px; background-color: #b0e1ff } .aplayer .aplayer-list ol::-webkit-scrollbar-thumb:hover { background-color: #b0e1ff } /*åœ†è§’*/ .aplayer.aplayer-fixed .aplayer-list{ border-radius: 6px 6px 0 0!important; } .aplayer.aplayer-fixed .aplayer-miniswitcher{ border-radius: 0 6px 6px 0!important; } .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{ transition: 0.28s!important; border-radius: 6px!important; }\t/*é€‰ä¸­ä¸æ’­æ”¾ä¸­æ­Œæ›²æ¿€æ´»é¢œè‰²*/ .aplayer .aplayer-list ol li:hover{ background: #b0e1ff!important; } .aplayer .aplayer-list ol li.aplayer-list-light{ background: #ffdffa!important; } /*aplayeré»‘æš—æ¨¡å¼*/ [data-theme=dark] .aplayer{ background: rgba(22, 22, 22, 0.60)!important; color: rgb(255, 255, 255); box-shadow: 0 2px 2px 0 rgba(0,0,0,.07),0 1px 5px 0 rgba(0,0,0,.1); } [data-theme=dark] .aplayer.aplayer-fixed .aplayer-body{ background: rgba(22, 22, 22, 0.60)!important; color: rgb(255, 255, 255); box-shadow: 0 2px 2px 0 rgba(0,0,0,.07),0 1px 5px 0 rgba(0,0,0,.1); } [data-theme=dark] .aplayer .aplayer-info .aplayer-controller .aplayer-time .aplayer-icon path{ fill: #d4d4d4; } [data-theme=dark]\t.aplayer .aplayer-list ol li:hover{ background: #407290!important; } [data-theme=dark] .aplayer .aplayer-list ol li.aplayer-list-light{ background: #9c8098!important; } [data-theme=dark] .aplayer .aplayer-info .aplayer-controller .aplayer-time{ color: #d4d4d4; } [data-theme=dark] .aplayer .aplayer-list ol li .aplayer-list-index{ color: #d4d4d4; } [data-theme=dark] .aplayer .aplayer-list ol li .aplayer-list-author{ color: #d4d4d4; } /* aplayer æ’­æ”¾å™¨ï¼Œè‡ªåŠ¨ç¼©è¿›éšè— */ .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body { left: -66px !important; /* é»˜è®¤â€®å†µæƒ…â€¬ä¸‹ç¼©è¿›å·¦ä¾§66pxï¼Œåªç•™ä¸€ç‚¹ç®­â€®éƒ¨å¤´â€¬åˆ† */ } .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover { left: 0 !important; /* é¼ æ ‡æ‚¬åœâ€®å·¦æ˜¯â€¬ä¾§ç¼©è¿›å½’é›¶ï¼Œå®Œå…¨æ˜¾ç¤ºæŒ‰é’® */ } â• å¼•å…¥æ ·å¼æ–‡ä»¶ï¼š\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: #æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/custom-aplayer.css\u0026#34;\u0026gt; é»˜è®¤éšè—æ­Œè¯\næ·»åŠ ä»£ç åˆ° éšè—æ­Œè¯.js æ–‡ä»¶ åˆ›å»º Hexoæ ¹ç›®å½•/source/js/éšè—æ­Œè¯.js æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // APlayer é»˜è®¤å…³é—­æ­Œè¯ // åˆ›å»ºä¸€ä¸ª MutationObserver å®ä¾‹ï¼Œç”¨äºç›‘å¬ DOM çš„å˜åŒ– var observer = new MutationObserver(function (mutations) { // æŸ¥æ‰¾é¡µé¢ä¸­ class ä¸º \u0026#34;aplayer-icon-lrc\u0026#34; çš„å…ƒç´  var lrcButton = document.querySelector(\u0026#34;.aplayer-icon-lrc\u0026#34;); // å¦‚æœæ‰¾åˆ°äº† lrcButton if (lrcButton) { // å»¶è¿Ÿ1æ¯«ç§’æ‰§è¡Œç‚¹å‡»æ“ä½œ setTimeout(function () { lrcButton.click(); }, 1); // æ–­å¼€ MutationObserver å®ä¾‹ï¼Œåœæ­¢ç›‘å¬ DOM çš„å˜åŒ– observer.disconnect(); } }); // å¼€å§‹è§‚å¯Ÿ body ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŠå…¶å±æ€§å˜åŒ– observer.observe(document.body, { childList: true, subtree: true }); â• å¼•å…¥ éšè—æ­Œè¯.js æ–‡ä»¶\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œå¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: bottom: - \u0026lt;script defer data-pjax src=\u0026#34;/js/éšè—æ­Œè¯.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸŒŠ å…­ã€æ–‡ç« é¡¶éƒ¨æ³¢æµªæ•ˆæœ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ åœ¨æ–‡ç« é¡¶éƒ¨æ·»åŠ åŠ¨æ€æ³¢æµªæ•ˆæœï¼Œå¢å¼ºè§†è§‰å±‚æ¬¡æ„Ÿï¼Œæå‡é¡µé¢åŠ¨æ€ç¾æ„Ÿã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. âœï¸ ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ï¼š\nä¿®æ”¹ Hexoæ ¹ç›®å½•/themes/butterfly/layout/includes/header/index.pug å¤§æ¦‚ç¬¬ 33 è¡Œå·¦å³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 if globalPageType === \u0026#39;post\u0026#39; include ./post-info.pug + // butterflyæ–‡ç« é¡¶éƒ¨æ·»åŠ æ³¢æµªæ•ˆæœï¼Œå¼€å§‹ + section.main-hero-waves-area.waves-area + svg.waves-svg(xmlns=\u0026#39;http://www.w3.org/2000/svg\u0026#39;, xlink=\u0026#39;http://www.w3.org/1999/xlink\u0026#39;, viewBox=\u0026#39;0 24 150 28\u0026#39;, preserveAspectRatio=\u0026#39;none\u0026#39;, shape-rendering=\u0026#39;auto\u0026#39;) + defs + path#gentle-wave(d=\u0026#39;M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z\u0026#39;) + g.parallax + use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;0\u0026#39;) + use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;3\u0026#39;) + use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;5\u0026#39;) + use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;7\u0026#39;) +// butterflyæ–‡ç« é¡¶éƒ¨æ·»åŠ æ³¢æµªæ•ˆæœï¼Œç»“æŸ else if globalPageType === \u0026#39;home\u0026#39; #site-info h1#site-title=config.title ä¸ºäº†æ–¹ä¾¿å¤åˆ¶ï¼Œæä¾›ä¸€ä»½éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // butterflyæ–‡ç« é¡¶éƒ¨æ·»åŠ æ³¢æµªæ•ˆæœï¼Œå¼€å§‹ section.main-hero-waves-area.waves-area svg.waves-svg(xmlns=\u0026#39;http://www.w3.org/2000/svg\u0026#39;, xlink=\u0026#39;http://www.w3.org/1999/xlink\u0026#39;, viewBox=\u0026#39;0 24 150 28\u0026#39;, preserveAspectRatio=\u0026#39;none\u0026#39;, shape-rendering=\u0026#39;auto\u0026#39;) defs path#gentle-wave(d=\u0026#39;M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z\u0026#39;) g.parallax use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;0\u0026#39;) use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;3\u0026#39;) use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;5\u0026#39;) use(href=\u0026#39;#gentle-wave\u0026#39;, x=\u0026#39;48\u0026#39;, y=\u0026#39;7\u0026#39;) // butterflyæ–‡ç« é¡¶éƒ¨æ·»åŠ æ³¢æµªæ•ˆæœï¼Œç»“æŸ 2. â• åˆ›å»ºæ³¢æµªCSSï¼š\nåˆ›å»º Hexoæ ¹ç›®å½•/source/css/bolang.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 /* æ³¢æµªcss */ .main-hero-waves-area { width: 100%; position: absolute; left: 0; bottom: -11px; z-index: 5; /* è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œé¿å…é—ªçƒ */ transform: translate3d(0, 0, 0); will-change: transform; } .waves-area .waves-svg { width: 100%; height: 5rem; /* è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œé¿å…é—ªçƒ */ transform: translate3d(0, 0, 0); will-change: transform; } /* Animation */ .parallax \u0026gt; use { animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite; /* è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œé¿å…é—ªçƒ */ transform: translate3d(-90px, 0, 0); will-change: transform; } .parallax \u0026gt; use:nth-child(1) { animation-delay: -2s; animation-duration: 7s; fill: #f7f9febd; } .parallax \u0026gt; use:nth-child(2) { animation-delay: -3s; animation-duration: 10s; fill: #f7f9fe82; } .parallax \u0026gt; use:nth-child(3) { animation-delay: -4s; animation-duration: 13s; fill: #f7f9fe36; } .parallax \u0026gt; use:nth-child(4) { animation-delay: -5s; animation-duration: 20s; fill: #f7f9fe; } /* é»‘è‰²æ¨¡å¼èƒŒæ™¯ */ [data-theme=\u0026#34;dark\u0026#34;] .parallax \u0026gt; use:nth-child(1) { animation-delay: -2s; animation-duration: 7s; fill: #18171dc8; } [data-theme=\u0026#34;dark\u0026#34;] .parallax \u0026gt; use:nth-child(2) { animation-delay: -3s; animation-duration: 10s; fill: #18171d80; } [data-theme=\u0026#34;dark\u0026#34;] .parallax \u0026gt; use:nth-child(3) { animation-delay: -4s; animation-duration: 13s; fill: #18171d3e; } [data-theme=\u0026#34;dark\u0026#34;] .parallax \u0026gt; use:nth-child(4) { animation-delay: -5s; animation-duration: 20s; fill: #18171d; } @keyframes move-forever { 0% { transform: translate3d(-90px, 0, 0); } 100% { transform: translate3d(85px, 0, 0); } } /*Shrinking for mobile*/ @media (max-width: 768px) { .waves-area .waves-svg { height: 40px; } } 3. â• å¼•å…¥CSSæ–‡ä»¶ï¼š\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: #æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/bolang.css\u0026#34;\u0026gt; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ“ ä¸ƒã€æ–‡ç« æ ‡é¢˜å±…ä¸­ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ å°†æ–‡ç« æ ‡é¢˜åŠå…¶ç›¸å…³ä¿¡æ¯å±…ä¸­æ˜¾ç¤ºï¼Œæå‡é¡µé¢æ’ç‰ˆç¾è§‚åº¦ã€‚\nğŸ”§ å®ç°æ–¹æ³• åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\source\\css_layout\\head.styl è¯¥ä»£ç å—åœ¨ç¬¬100è¡Œå·¦å³ 1 2 3 4 5 6 #post-info position: absolute bottom: 100px //æ–‡ç« ä¿¡æ¯è·ç¦»æ–‡ç« å—çš„é«˜åº¦.æ”¹ä¸º100px padding: 0 8% width: 100% text-align: center ğŸ§² å…«ã€é¦–é¡µåˆ†ç±»ç£è´´ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä½¿ç”¨ç£è´´å¼å¸ƒå±€å±•ç¤ºåˆ†ç±»æ ‡ç­¾ï¼Œæ”¯æŒè‡ªå®šä¹‰å›¾æ ‡å’Œæ‚¬åœæ•ˆæœï¼Œå¢å¼ºé¦–é¡µè§†è§‰å¸å¼•åŠ›ã€‚\nğŸ”§ å®‰è£…æ’ä»¶ 1 npm i hexo-magnet --save å¸è½½æ’ä»¶ æ³¨æ„ï¼Œä¸€å®šè¦åŠ  --saveï¼Œä¸ç„¶æœ¬åœ°é¢„è§ˆçš„æ—¶å€™å¯èƒ½ä¸ä¼šæ˜¾ç¤ºï¼ï¼ï¼ 1 npm uninstall hexo-magnet --save --package-lock-only âš™ï¸ é…ç½®ç¤ºä¾‹ åœ¨ç½‘ç«™é…ç½®æ–‡ä»¶_config.ymlæ–°å¢ä»¥ä¸‹é¡¹ (æ³¨æ„ä¸æ˜¯ä¸»é¢˜é…ç½®æ–‡ä»¶)ï¼Œè¿™é‡Œçš„åˆ†ç±»åå­—å¿…é¡»å’Œä½ æ–‡ç« çš„åˆ†ç±»åå­—ä¸€ä¸€å¯¹åº”ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 magnet: enable: true priority: 1 enable_page: / type: categories devide: 2 display: - name: æ•™ç¨‹ display_name: å°å†°ã®é­”æ”¹æ•™ç¨‹ icon: ğŸ“š - name: æ¸¸æˆè¯„æµ‹ display_name: å°å†°ã®æ¸¸æˆè¯„æµ‹ icon: ğŸ® - name: ç”Ÿæ´»è¶£é—» display_name: å°å†°ã®ç”Ÿæ´»è¶£é—» icon: ğŸ±â€ğŸ‘“ - name: vue display_name: å°å†°ã®ç¼–ç¨‹å­¦ä¹  icon: ğŸ‘©â€ğŸ’» - name: å­¦ä¹  display_name: å°å†°ã®è¯»ä¹¦ç¬”è®° icon: ğŸ“’ - name: éšæƒ³ display_name: å°å†°ã®èƒ¡æ€ä¹±æƒ³ icon: ğŸ’¡ color_setting: text_color: black text_hover_color: white background_color: \u0026#34;#f2f2f2\u0026#34; background_hover_color: \u0026#34;#b30070\u0026#34; layout: type: id name: recent-posts index: 0 temple_html: \u0026#39;\u0026lt;div class=\u0026#34;recent-post-item\u0026#34; style=\u0026#34;width:100%;height: auto\u0026#34;\u0026gt;\u0026lt;div id=\u0026#34;catalog_magnet\u0026#34;\u0026gt;${temple_html_item}\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026#39; plus_style: \u0026#34;\u0026#34; é…ç½®é¡¹è¯´æ˜\né…ç½®é¡¹çš„å«ä¹‰ï¼š enable å‚æ•°ï¼štrue/false å«ä¹‰ï¼šæ˜¯å¦å¼€å¯æ’ä»¶ enable_page å‚æ•°ï¼š/ å«ä¹‰ï¼šè·¯ç”±åœ°å€ï¼Œå¦‚ / ä»£è¡¨ä¸»é¡µã€‚/me/ ä»£è¡¨è‡ªæˆ‘ä»‹ç»é¡µç­‰ç­‰ priority å‚æ•°ï¼š1 å«ä¹‰ï¼šæ’ä»¶çš„å æ”¾é¡ºåºï¼Œæ•°å­—è¶Šå¤§ï¼Œå æ”¾çº¦é å‰ã€‚ type å‚æ•°ï¼šcategories/tags å«ä¹‰ï¼šé€‰æ‹©ç­›é€‰åˆ†ç±»è¿˜æ˜¯æ ‡ç­¾ devide å‚æ•°ï¼š2 å«ä¹‰ï¼šè¡¨ç¤ºåˆ†éš”çš„åˆ—æ•°ï¼Œ2 è¡¨ç¤ºåˆ†ä¸ºä¸¤åˆ—å±•ç¤º display å‚æ•°ï¼š 1 2 3 - name: æ•™ç¨‹ # è¿™é‡Œæ˜¯tagsæˆ–è€…categoriesçš„åç§° display_name: å°å†°ã®é­”æ”¹æ•™ç¨‹ # è¿™é‡Œæ˜¯æ›¿æ¢çš„åç§° icon: ğŸ“š # è¿™é‡Œæ˜¯å±•ç¤ºçš„å›¾æ ‡ å«ä¹‰ï¼šé…ç½®é¡¹ï¼Œå¯è‡ªè¡Œè®¾ç½®ï¼ŒæŒ‰ç…§è®¾ç½®çš„é¡ºåºå±•ç¤º color_setting å‚æ•°ï¼š 1 2 3 4 text_color: black # æ–‡å­—é»˜è®¤é¢œè‰² text_hover_color: white # æ–‡å­—é¼ æ ‡æ‚¬æµ®é¢œè‰² background_color: \u0026#34;#f2f2f2\u0026#34; # æ–‡å­—èƒŒæ™¯é»˜è®¤é¢œè‰² background_hover_color: \u0026#34;#b30070\u0026#34; # æ–‡å­—èƒŒæ™¯æ‚¬æµ®é¢œè‰² å«ä¹‰ï¼šé¢œè‰²é…ç½®é¡¹ï¼Œå¯è‡ªè¡Œè®¾ç½® layout å‚æ•°ï¼štype; ï¼ˆclass\u0026amp;idï¼‰ å‚æ•°ï¼šname; å‚æ•°ï¼šindexï¼›ï¼ˆæ•°å­—ï¼‰ å«ä¹‰ï¼šå¦‚æœè¯´ magnet æ˜¯ä¸€å¹…ç”»ï¼Œé‚£ä¹ˆè¿™ä¸ª layout å°±æ˜¯æŒ‡å®šäº†å“ªé¢å¢™æ¥æŒ‚ç”» è€Œåœ¨ HTML çš„æ˜¯ä¸–ç•Œé‡Œæœ‰ä¸¤ç§å¢™åˆ†åˆ« type ä¸º id å’Œ classã€‚ å…¶ä¸­åœ¨å®šä¹‰ class çš„æ—¶å€™ä¼šå‡ºç°å¤šä¸ª class çš„æƒ…å†µï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ indexï¼Œç¡®å®šæ˜¯å“ªä¸€ä¸ªã€‚ æœ€åå¢™çš„åå­—å³æ˜¯ name; 1 2 3 4 5 6 7 8 \u0026lt;div name=\u0026#34;æˆ‘æ˜¯å¢™\u0026#34; id=\u0026#34;recent-posts\u0026#34;\u0026gt; \u0026lt;!-- id=\u0026gt;type recent-posts=\u0026gt;name --\u0026gt; \u0026lt;div name=\u0026#34;æˆ‘æ˜¯ç”»æ¡†\u0026#34;\u0026gt; \u0026lt;div name=\u0026#34;æˆ‘æ˜¯çº¸\u0026#34;\u0026gt; \u0026lt;!--è¿™é‡Œé€šè¿‡jsæŒ‚è½½magnetï¼Œä¹Ÿå°±æ˜¯ç”»ç”»--\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; å‚æ•°ï¼šhtml æ¨¡æ¿å­—æ®µ\nå«ä¹‰ï¼šåŒ…å«æŒ‚è½½å®¹å™¨\n1 2 3 4 5 \u0026lt;div class=\u0026#34;recent-post-item\u0026#34; style=\u0026#34;width:100%;height: auto\u0026#34;\u0026gt; \u0026lt;!--æ–‡ç« å®¹å™¨--\u0026gt; \u0026lt;div id=\u0026#34;catalog_magnet\u0026#34;\u0026gt; \u0026lt;!--æŒ‚è½½å®¹å™¨--\u0026gt; ${temple_html_item} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; plus_style å‚æ•°ï¼šâ€œâ€ å«ä¹‰ï¼šæä¾›å¯è‡ªå®šä¹‰çš„ styleï¼Œå¦‚åŠ å…¥é»‘å¤œæ¨¡å¼ã€‚ ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ä¿®å¤é»‘å¤œæ¨¡å¼\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°é»‘å¤œæ¨¡å¼çœ‹èµ·æ¥ç‰¹åˆ«çš„åˆ«æ‰­ï¼Œå› æ­¤è¿˜è¦åšä¸€ä¸‹é»‘å¤œæ¨¡å¼çš„é¢œè‰²é€‚é…ï¼Œåœ¨custom.cssæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç é€‚é…é»‘å¤œæ¨¡å¼(å…·ä½“é¢œè‰²å¯ä»¥è‡ªå·±è°ƒèŠ‚)ï¼š\n1 2 3 4 5 6 7 8 9 10 11 /* å°å†°åˆ†ç±»åˆ†ç±»ç£é“é»‘å¤œæ¨¡å¼é€‚é… */ /* ä¸€èˆ¬çŠ¶æ€ */ [data-theme=\u0026#34;dark\u0026#34;] .magnet_link_context { background: #1e1e1e; color: antiquewhite; } /* é¼ æ ‡æ‚¬æµ®çŠ¶æ€ */ [data-theme=\u0026#34;dark\u0026#34;] .magnet_link_context:hover { background: #3ecdf1; color: #f2f2f2; } ğŸŒ™ ä¹ã€å¤œé—´æ¨¡å¼åŠ¨ç”» âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä¸ºæ˜æš—æ¨¡å¼åˆ‡æ¢æ·»åŠ å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå¢å¼ºç•Œé¢äº¤äº’æ„Ÿã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â• åˆ›å»º svg æ–‡ä»¶\næ–°å»ºåšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\custom\\sun_moon.pug,è¿™éƒ¨åˆ†å…¶å®å®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªsvgæ–‡ä»¶ï¼Œé€šè¿‡jsæ“ä½œå®ƒçš„æ—‹è½¬æ˜¾éšï¼Œæ·¡å…¥æ·¡å‡ºå®ç°åŠ¨ç”»æ•ˆæœã€‚ 1 2 3 4 5 6 7 8 9 svg(aria-hidden=\u0026#39;true\u0026#39;, style=\u0026#39;position:absolute; overflow:hidden; width:0; height:0\u0026#39;) symbol#icon-sun(viewBox=\u0026#39;0 0 1024 1024\u0026#39;) path(d=\u0026#39;M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z\u0026#39;, fill=\u0026#39;#FFD878\u0026#39;, p-id=\u0026#39;8420\u0026#39;) path(d=\u0026#39;M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z\u0026#39;, fill=\u0026#39;#FFE4A9\u0026#39;, p-id=\u0026#39;8421\u0026#39;) path(d=\u0026#39;M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z\u0026#39;, fill=\u0026#39;#4D5152\u0026#39;, p-id=\u0026#39;8422\u0026#39;) path(d=\u0026#39;M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z\u0026#39;, fill=\u0026#39;#4D5152\u0026#39;, p-id=\u0026#39;8423\u0026#39;) symbol#icon-moon(viewBox=\u0026#39;0 0 1024 1024\u0026#39;) path(d=\u0026#39;M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z\u0026#39;, fill=\u0026#39;#FFB531\u0026#39;, p-id=\u0026#39;11345\u0026#39;) path(d=\u0026#39;M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z\u0026#39;, fill=\u0026#39;#030835\u0026#39;, p-id=\u0026#39;11346\u0026#39;) 2. â• åˆ›å»º stylåŠ¨ç”»æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 .Cuteen_DarkSky, .Cuteen_DarkSky:before content \u0026#39;\u0026#39; position fixed left 0 right 0 top 0 bottom 0 z-index 88888888 .Cuteen_DarkSky background linear-gradient(to top, #f8cd71 0, #5bfde9 80%) \u0026amp;:before transition 2s ease all opacity 0 background linear-gradient(to top, #30cfd0 0, #330867 100%) .DarkMode .Cuteen_DarkSky \u0026amp;:before opacity 1 .Cuteen_DarkPlanet z-index 99999999 position fixed left -50% top -50% width 200% height 200% -webkit-animation CuteenPlanetMove 2s cubic-bezier(0.7, 0, 0, 1) animation CuteenPlanetMove 2s cubic-bezier(0.7, 0, 0, 1) transform-origin center bottom @-webkit-keyframes CuteenPlanetMove { 0% { transform: rotate(0); } to { transform: rotate(360deg); } } @keyframes CuteenPlanetMove { 0% { transform: rotate(0); } to { transform: rotate(360deg); } } .Cuteen_DarkPlanet #sun position absolute border-radius 100% left 44% top 30% height 6rem width 6rem background #ffee94 box-shadow 0 0 40px #ffee94 // opacity 0 #moon position absolute border-radius 100% left 44% top 30% position absolute border-radius 100% height 6rem width 6rem box-shadow -1.8em 1.8em 0 0.2em #fff // opacity 1 // \u0026amp;:after // position absolute // left 42% // top 30% // width 6rem // height 6rem // border-radius 50% // content \u0026#39;\u0026#39; // background #ffef9e // box-shadow 0 0 30px #ffef9e .search span display none .menus_item a text-decoration none!important //æŒ‰é’®ç›¸å…³ï¼Œå¯¹ä¾§æ æŒ‰é’®åšè¿‡é­”æ”¹çš„å¯ä»¥è°ƒæ•´è¿™é‡Œçš„æ•°å€¼ .icon-V padding 5px 3. â•åˆ›å»ºJSæ–‡ä»¶\næ–°å»ºåšå®¢æ ¹ç›®å½•\\themes\\butterfly\\source\\js\\sun_moon.js,å»é™¤äº†å†—ä½™ä»£ç ï¼Œå»jquery 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 // å®šä¹‰ saveToLocal å¯¹è±¡ const saveToLocal = { set: function (key, value, expiration) { // å­˜å‚¨æ•°æ®æ—¶å°†æ•°æ®è½¬æ¢ä¸º JSON å­—ç¬¦ä¸² const data = { value: value, expiration: expiration }; localStorage.setItem(key, JSON.stringify(data)); }, get: function (key) { const storedData = localStorage.getItem(key); if (storedData) { try { const parsedData = JSON.parse(storedData); // æ£€æŸ¥æ•°æ®æ˜¯å¦è¿‡æœŸ if (parsedData.expiration \u0026amp;\u0026amp; Date.now() \u0026gt; parsedData.expiration) { localStorage.removeItem(key); return null; } return parsedData.value; } catch (error) { console.error(\u0026#39;è§£æ JSON æ•°æ®æ—¶å‡ºé”™:\u0026#39;, error); return null; } } return null; } }; function switchNightMode() { document.querySelector(\u0026#39;body\u0026#39;).insertAdjacentHTML(\u0026#39;beforeend\u0026#39;, \u0026#39;\u0026lt;div class=\u0026#34;Cuteen_DarkSky\u0026#34;\u0026gt;\u0026lt;div class=\u0026#34;Cuteen_DarkPlanet\u0026#34;\u0026gt;\u0026lt;div id=\u0026#34;sun\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div id=\u0026#34;moon\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026#39;); setTimeout(function () { if (document.querySelector(\u0026#39;body\u0026#39;).classList.contains(\u0026#39;DarkMode\u0026#39;)) { document.querySelector(\u0026#39;body\u0026#39;).classList.remove(\u0026#39;DarkMode\u0026#39;); localStorage.setItem(\u0026#39;isDark\u0026#39;, \u0026#39;0\u0026#39;); document.getElementById(\u0026#39;modeicon\u0026#39;).setAttribute(\u0026#39;xlink:href\u0026#39;, \u0026#39;#icon-moon\u0026#39;); } else { document.querySelector(\u0026#39;body\u0026#39;).classList.add(\u0026#39;DarkMode\u0026#39;); localStorage.setItem(\u0026#39;isDark\u0026#39;, \u0026#39;1\u0026#39;); document.getElementById(\u0026#39;modeicon\u0026#39;).setAttribute(\u0026#39;xlink:href\u0026#39;, \u0026#39;#icon-sun\u0026#39;); } setTimeout(function () { document.getElementsByClassName(\u0026#39;Cuteen_DarkSky\u0026#39;)[0].style.transition = \u0026#39;opacity 3s\u0026#39;; document.getElementsByClassName(\u0026#39;Cuteen_DarkSky\u0026#39;)[0].style.opacity = \u0026#39;0\u0026#39;; setTimeout(function () { document.getElementsByClassName(\u0026#39;Cuteen_DarkSky\u0026#39;)[0].remove(); }, 1000); }, 2000); }); const nowMode = document.documentElement.getAttribute(\u0026#39;data-theme\u0026#39;) === \u0026#39;dark\u0026#39; ? \u0026#39;dark\u0026#39; : \u0026#39;light\u0026#39;; if (nowMode === \u0026#39;light\u0026#39;) { // å…ˆè®¾ç½®å¤ªé˜³æœˆäº®é€æ˜åº¦ document.getElementById(\u0026#34;sun\u0026#34;).style.opacity = \u0026#34;1\u0026#34;; document.getElementById(\u0026#34;moon\u0026#34;).style.opacity = \u0026#34;0\u0026#34;; setTimeout(function () { document.getElementById(\u0026#34;sun\u0026#34;).style.opacity = \u0026#34;0\u0026#34;; document.getElementById(\u0026#34;moon\u0026#34;).style.opacity = \u0026#34;1\u0026#34;; }, 1000); activateDarkMode(); saveToLocal.set(\u0026#39;theme\u0026#39;, \u0026#39;dark\u0026#39;, 2); document.getElementById(\u0026#39;modeicon\u0026#39;).setAttribute(\u0026#39;xlink:href\u0026#39;, \u0026#39;#icon-sun\u0026#39;); } else { // å…ˆè®¾ç½®å¤ªé˜³æœˆäº®é€æ˜åº¦ document.getElementById(\u0026#34;sun\u0026#34;).style.opacity = \u0026#34;0\u0026#34;; document.getElementById(\u0026#34;moon\u0026#34;).style.opacity = \u0026#34;1\u0026#34;; setTimeout(function () { document.getElementById(\u0026#34;sun\u0026#34;).style.opacity = \u0026#34;1\u0026#34;; document.getElementById(\u0026#34;moon\u0026#34;).style.opacity = \u0026#34;0\u0026#34;; }, 1000); activateLightMode(); saveToLocal.set(\u0026#39;theme\u0026#39;, \u0026#39;light\u0026#39;, 2); document.querySelector(\u0026#39;body\u0026#39;).classList.add(\u0026#39;DarkMode\u0026#39;); document.getElementById(\u0026#39;modeicon\u0026#39;).setAttribute(\u0026#39;xlink:href\u0026#39;, \u0026#39;#icon-moon\u0026#39;); } // handle some cases typeof utterancesTheme === \u0026#39;function\u0026#39; \u0026amp;\u0026amp; utterancesTheme(); typeof FB === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; window.loadFBComment(); window.DISQUS \u0026amp;\u0026amp; document.getElementById(\u0026#39;disqus_thread\u0026#39;).children.length \u0026amp;\u0026amp; setTimeout(() =\u0026gt; window.disqusReset(), 200); } // æ·»åŠ  activateLightMode å‡½æ•°å®šä¹‰ function activateLightMode() { // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢åˆ°ç™½å¤©æ¨¡å¼çš„å…·ä½“ä»£ç  document.documentElement.setAttribute(\u0026#39;data-theme\u0026#39;, \u0026#39;light\u0026#39;); // å¯ä»¥æ·»åŠ å…¶ä»–ç™½å¤©æ¨¡å¼çš„æ ·å¼ä¿®æ”¹ä»£ç  } // æ·»åŠ  activateDarkMode å‡½æ•°å®šä¹‰ function activateDarkMode() { // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼çš„å…·ä½“ä»£ç  document.documentElement.setAttribute(\u0026#39;data-theme\u0026#39;, \u0026#39;dark\u0026#39;); // å¯ä»¥æ·»åŠ å…¶ä»–å¤œé—´æ¨¡å¼çš„æ ·å¼ä¿®æ”¹ä»£ç  4. â• å¼•å…¥åŠ¨ç”»æ–‡ä»¶ï¼š\n1 2 3 inject: bottom: - \u0026lt;script defer data-pjax src=\u0026#34;/js/sun_moon.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 5. âœï¸ ä¿®æ”¹ç›¸å…³æ–‡ä»¶\nä¿®æ”¹åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\head.pug,åœ¨æ–‡ä»¶æœ«ä½åŠ ä¸Šä¸€è¡Œ 1 2 3 4 5 6 7 8 9 10 //- global config !=partial(\u0026#39;includes/head/config\u0026#39;, {}, {cache: true}) include ./head/config_site.pug include ./head/noscript.pug !=fragment_cache(\u0026#39;injectHeadJs\u0026#39;, function(){return inject_head_js()}) !=fragment_cache(\u0026#39;injectHead\u0026#39;, function(){return injectHtml(theme.inject.head)}) + include ./custom/sun_moon.pug ä¿®æ”¹åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\rightside.pug,æŠŠåŸæœ¬çš„æ˜¼å¤œåˆ‡æ¢æŒ‰é’®æ›¿æ¢æ‰\n1 2 3 4 5 6 7 8 9 10 when \u0026#39;translate\u0026#39; if translate.enable button#translateLink(type=\u0026#34;button\u0026#34; title=_p(\u0026#39;rightside.translate_title\u0026#39;))= translate.default when \u0026#39;darkmode\u0026#39; if darkmode.enable \u0026amp;\u0026amp; darkmode.button - button#darkmode(type=\u0026#34;button\u0026#34; title=_p(\u0026#39;rightside.night_mode_title\u0026#39;)) - i.fas.fa-adjust + a.icon-V.hidden(onclick=\u0026#39;switchNightMode()\u0026#39;, title=_p(\u0026#39;rightside.night_mode_title\u0026#39;)) + svg(width=\u0026#39;25\u0026#39;, height=\u0026#39;25\u0026#39;, viewBox=\u0026#39;0 0 1024 1024\u0026#39;) + use#modeicon(xlink:href=\u0026#39;#icon-moon\u0026#39;) 6. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ¨ åã€å¯¼èˆªæ å¤šå½©å›¾æ ‡ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä½¿ç”¨é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“ä¸ºå¯¼èˆªæ æ·»åŠ å¤šå½©å›¾æ ‡ï¼Œæ”¯æŒåŠ¨æ€æ•ˆæœå’Œè‡ªå®šä¹‰æ ·å¼ã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â• å¼•å…¥iconfontå›¾æ ‡ è§ï¼š Iconfont Inject æ–°å»ºå›¾æ ‡é¡¹ç›®\nè®¿é—® é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“ ,æ³¨å†Œç™»å½•ã€‚\næœç´¢è‡ªå·±å¿ƒä»ªçš„å›¾æ ‡ï¼Œç„¶åé€‰æ‹©æ·»åŠ å…¥åº“ï¼ŒåŠ åˆ°è´­ç‰©è½¦ã€‚\né€‰æ‹©å®Œæ¯•åç‚¹å‡»å³ä¸Šè§’çš„è´­ç‰©è½¦å›¾æ ‡ï¼Œæ‰“å¼€ä¾§æ ï¼Œé€‰æ‹©æ·»åŠ åˆ°é¡¹ç›®ï¼Œå¦‚æœæ²¡æœ‰é¡¹ç›®å°±æ–°å»ºä¸€ä¸ªã€‚\nå¯ä»¥é€šè¿‡ä¸Šæ–¹é¡¶æ èœå•-\u0026gt;èµ„æºç®¡ç†-\u0026gt;æˆ‘çš„é¡¹ç›®ï¼Œæ‰¾åˆ°ä¹‹å‰æ·»åŠ çš„å›¾æ ‡é¡¹ç›®ã€‚(ç°åœ¨çš„iconfontå¯ä»¥åœ¨å›¾æ ‡åº“çš„é¡¹ç›®è®¾ç½®é‡Œç›´æ¥æ‰“å¼€å½©è‰²è®¾ç½®ï¼Œç„¶åé‡‡ç”¨fontclassçš„å¼•ç”¨æ–¹å¼å³å¯ä½¿ç”¨å¤šå½©å›¾æ ‡ã€‚ä½†æ˜¯å•ä¸€é¡¹ç›®å½©è‰²å›¾æ ‡ä¸Šé™æ˜¯40ä¸ªå›¾æ ‡ï¼Œé…Œæƒ…é‡‡ç”¨ã€‚)\nå¼•å…¥å›¾æ ‡\nçº¿ä¸Šå¼•å…¥æ–¹æ¡ˆï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­æœ€ä¾¿æ·çš„font-classæ–¹æ¡ˆã€‚è¿™ä¸€æ–¹æ¡ˆå¶å°”ä¼šå‡ºç°å›¾æ ‡åŠ è½½ä¸å‡ºçš„æƒ…å†µã€‚ä½†æ˜¯ä¾¿äºéšæ—¶å¯¹å›¾æ ‡åº“è¿›è¡Œå‡çº§ï¼Œæ¢ä¸€ä¸‹åœ¨çº¿é“¾æ¥å³å¯ï¼Œé€‚åˆæ–°æ‰‹ä½¿ç”¨ã€‚æœ€æ–°ç‰ˆæœ¬çš„iconfontæ”¯æŒç›´æ¥åœ¨é¡¹ç›®è®¾ç½®ä¸­å¼€å¯å½©è‰²å›¾æ ‡ï¼Œä»è€Œå®ç°ç›´æ¥ç”¨classæ·»åŠ å¤šå½©è‰²å›¾æ ‡ã€‚ï¼ˆæ¨èç›´æ¥ç”¨è¿™ä¸ªå³å¯ï¼‰\nåœ¨[BlogRoot]\\themes\\butterfly\\source\\css\\custom.cssä¸­å¡«å†™å¦‚ä¸‹å†…å®¹ï¼Œå¼•å…¥Unicodeå’ŒFont-classçš„çº¿ä¸Šèµ„æºï¼š 1 @import \u0026#34;//at.alicdn.com/t/font_2264842_b004iy0kk2b.css\u0026#34;; æ›´æ¨èåœ¨åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶injecté…ç½®é¡¹è¿›è¡Œå…¨å±€å¼•å…¥ï¼š\n1 2 3 4 5 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;//at.alicdn.com/t/font_2264842_b004iy0kk2b.css\u0026#34; media=\u0026#34;defer\u0026#34; onload=\u0026#34;this.media=\u0026#39;all\u0026#39;\u0026#34;\u0026gt; bottom: - \u0026lt;script async src=\u0026#34;//at.alicdn.com/t/font_2264842_b004iy0kk2b.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; åŒæ—¶å¯ä»¥åœ¨è‡ªå®šä¹‰CSSä¸­æ·»åŠ å¦‚ä¸‹æ ·å¼æ¥æ§åˆ¶å›¾æ ‡é»˜è®¤å¤§å°å’Œé¢œè‰²ç­‰å±æ€§ï¼ˆè‹¥å·²ç»åœ¨é¡¹ç›®è®¾ç½®ä¸­å‹¾é€‰äº†å½©è‰²é€‰é¡¹ï¼Œåˆ™æ— éœ€å†å®šä¹‰å›¾æ ‡é¢œè‰²ï¼‰ï¼Œå†™æ³•ä¸å­—ä½“æ ·å¼ç±»ä¼¼ï¼Œè¿™ææ€•ä¹Ÿæ˜¯å®ƒè¢«ç§°ä¸ºiconfontï¼ˆå›¾æ ‡å­—ä½“ï¼‰çš„åŸå› :\n1 2 3 4 5 6 7 8 .iconfont { font-family: \u0026#34;iconfont\u0026#34; !important; /* è¿™é‡Œå¯ä»¥è‡ªå®šä¹‰å›¾æ ‡å¤§å° */ font-size: 3em; font-style: normal; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } å¯ä»¥é€šè¿‡è‡ªå·±çš„é˜¿é‡Œå›¾æ ‡åº“çš„font-classæ–¹æ¡ˆæŸ¥è¯¢å¤åˆ¶ç›¸åº”çš„icon-xxxxã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;i class=\u0026#34;iconfont icon-rat\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-ox\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-tiger\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-rabbit\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-dragon\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-snake\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-horse\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-goat\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-monkey\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-rooster\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-dog\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;i class=\u0026#34;iconfont icon-boar\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; 2. ğŸ¨ èœå•æ å¤šè‰²åŠ¨æ€å›¾æ ‡ è¯¦è§ï¼š ç³–æœå±‹å¾®è°ƒåˆé›† ç›¸æ¯”äºé™æ€çš„å›¾æ ‡ï¼Œä¸ªäººæ›´å–œæ¬¢åŠ¨æ€çš„ï¼Œå› æ­¤ä¸€æ­¥åˆ°ä½ï¼\nå‰ç½®æ•™ç¨‹ï¼š Hexoå¼•å…¥é˜¿é‡ŒçŸ¢é‡å›¾æ ‡åº“-iconfont inject å’Œ åŸºäºButterflyçš„å¤–æŒ‚æ ‡ç­¾å¼•å…¥-Tag Plugins Plus ä¸­å…³äºåŠ¨æ€æ ‡ç­¾animaçš„å†…å®¹ã€‚è¯·ç¡®ä¿æ‚¨å·²ç»å®Œæˆäº†å‰ç½®æ•™ç¨‹ï¼Œå¹¶å®ç°äº†åœ¨æ–‡ç« ä¸­ä½¿ç”¨symbolå†™æ³•æ¥å¼•å…¥iconfontå›¾æ ‡ã€‚åŒæ—¶å¼•å…¥äº†fontawesome_animationçš„å‰ç½®ä¾èµ–ã€‚ ä¸»è¦æ£€æŸ¥æ‚¨çš„injecté…ç½®é¡¹ä¸­æ˜¯å¦æœ‰è¿™ä¸¤ä¸ªä¾èµ–\n1 2 3 4 5 6 7 inject: head: #åŠ¨ç”»æ ‡ç­¾animaçš„ä¾èµ– - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css\u0026#34; media=\u0026#34;defer\u0026#34; onload=\u0026#34;this.media=\u0026#39;all\u0026#39;\u0026#34;\u0026gt; bottom: # é˜¿é‡ŒçŸ¢é‡å›¾æ ‡,è¿™ä¸²æ˜¯æˆ‘çš„å›¾æ ‡åº“ï¼Œä½ çš„é“¾æ¥ä¼šæœ‰æ‰€ä¸åŒã€‚ - \u0026lt;script async src=\u0026#34;//at.alicdn.com/t/font_2032782_ev6ytrh30f.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; æ›¿æ¢[BlogRoot]\\themes\\butterfly\\layout\\includes\\header\\menu_item.pugä¸ºä»¥ä¸‹ä»£ç ï¼Œæœ¬æ–¹æ¡ˆé»˜è®¤ä½¿ç”¨è§‚æ„Ÿæœ€ä½³çš„æ‚¬åœçˆ¶å…ƒç´ è§¦å‘å­å…ƒç´ åŠ¨ç”»æ•ˆæœï¼Œé»˜è®¤åŠ¨ç”»ä¸ºfaa-tadaã€‚æ³¨æ„ï¼šå¯ä»¥æŠŠä¹‹å‰çš„ä»£ç æ³¨é‡Šæ‰ï¼Œå†åœ¨åé¢åŠ ä¸Šå¦‚ä¸‹ä»£ç ï¼Œä»¥ä¾¿äºå›æ»šï¼Œæ­¤ä»£ç åœ¨butterfly 4.3.1 ä¸Šå¯ä»¥è¿è¡Œå¹¶ä¿ç•™hideå­—æ®µéšè—å­èœå•çš„åŠŸèƒ½ï¼Œå…¶ä»–ç‰ˆæœ¬è‡ªè¡Œæµ‹è¯•ã€‚ä»£ç çš„æœ¬è´¨å¹¶ä¸å¤æ‚ï¼Œå°±æ˜¯æ‰«æé…ç½®æ–‡ä»¶å¯¹åº”çš„é…ç½®é¡¹ï¼Œç„¶åæ ¹æ®||çš„åˆ†å‰²æ ‡å¿—ç­›é€‰å‡ºå¯¹åº”çš„å›¾æ ‡åç§°ã€å¯¹åº”é“¾æ¥ç­‰ï¼Œä»è€Œæ¸²æŸ“å‡ºhtmlé¡µé¢ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 if theme.menu .menus_items each value, label in theme.menu if typeof value !== \u0026#39;object\u0026#39; .menus_item - const valueArray = value.split(\u0026#39;||\u0026#39;) a.site-page.faa-parent.animated-hover(href=url_for(trim(value.split(\u0026#39;||\u0026#39;)[0]))) if valueArray[1] i.fa-fw(class=trim(valueArray[1])) - var icon_value = trim(value.split(\u0026#39;||\u0026#39;)[1]) - var anima_value = value.split(\u0026#39;||\u0026#39;)[2] ? trim(value.split(\u0026#39;||\u0026#39;)[2]) : \u0026#39;faa-tada\u0026#39; if icon_value.substring(0,2)==\u0026#34;fa\u0026#34; i.fa-fw(class=icon_value + \u0026#39; \u0026#39; + anima_value) else if icon_value.substring(0,4)==\u0026#34;icon\u0026#34; svg.icon(aria-hidden=\u0026#34;true\u0026#34; class=anima_value) use(xlink:href=`#`+ icon_value) span=\u0026#39; \u0026#39;+label else .menus_item - const labelArray = label.split(\u0026#39;||\u0026#39;) - const hideClass = labelArray[3] \u0026amp;\u0026amp; trim(labelArray[3]) === \u0026#39;hide\u0026#39; ? \u0026#39;hide\u0026#39; : \u0026#39;\u0026#39; a.site-page.group.faa-parent.animated-hover(class=`${hideClass}` href=\u0026#39;javascript:void(0);\u0026#39;) if labelArray[1] - var icon_label = trim(label.split(\u0026#39;||\u0026#39;)[1]) - var anima_label = label.split(\u0026#39;||\u0026#39;)[2] ? trim(label.split(\u0026#39;||\u0026#39;)[2]) : \u0026#39;faa-tada\u0026#39; if icon_label.substring(0,2)==\u0026#34;fa\u0026#34; i.fa-fw(class=icon_label + \u0026#39; \u0026#39; + anima_label) else if icon_label.substring(0,4)==\u0026#34;icon\u0026#34; svg.icon(aria-hidden=\u0026#34;true\u0026#34; class=anima_label) use(xlink:href=`#`+ icon_label) span=\u0026#39; \u0026#39;+ trim(labelArray[0]) i.fas.fa-chevron-down ul.menus_item_child each val,lab in value - const valArray = val.split(\u0026#39;||\u0026#39;) li a.site-page.child.faa-parent.animated-hover(href=url_for(trim(val.split(\u0026#39;||\u0026#39;)[0]))) if valArray[1] - var icon_val = trim(val.split(\u0026#39;||\u0026#39;)[1]) - var anima_val = val.split(\u0026#39;||\u0026#39;)[2] ? trim(val.split(\u0026#39;||\u0026#39;)[2]) : \u0026#39;faa-tada\u0026#39; if icon_val.substring(0,2)==\u0026#34;fa\u0026#34; i.fa-fw(class=icon_val + \u0026#39; \u0026#39; + anima_val) else if icon_val.substring(0,4)==\u0026#34;icon\u0026#34; svg.icon(aria-hidden=\u0026#34;true\u0026#34; class=anima_val) use(xlink:href=`#`+ icon_val) span=\u0026#39; \u0026#39;+ lab ä»¥ä¸‹æ˜¯å¡«å†™ç¤ºä¾‹ï¼Œåœ¨[BlogRoot]\\_config.butterfly.ymlä¸­ä¿®æ”¹ã€‚icon-xxxå­—æ ·çš„ä¸ºiconfontçš„symbolå¼•å…¥æ–¹æ¡ˆçš„idå€¼ï¼Œå¯ä»¥åœ¨ä½ çš„iconfontå›¾æ ‡åº“å†…æŸ¥è¯¢ï¼Œå…¶ä¸­hideå±æ€§ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ã€‚\n1 2 3 4 5 6 7 menu: é¦–é¡µ: / || icon-home || faa-tada æ–‡ç«  || icon--article || faa-tada || hide: å½’æ¡£: /archives/ || icon-guidang1 || faa-tada æ ‡ç­¾: /tags/ || icon-sekuaibiaoqian || faa-tada åˆ†ç±»: /categories/ || icon-fenlei || faa-tada éšä¾¿é€›é€›: javascript:randomPost(); || icon-zuji1 || faa-tada è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„åŠ¨æ€å›¾æ ‡æ˜¯svg.iconçš„æ ‡ç­¾ï¼Œå› æ­¤ä¸Šé¢è°ƒèŠ‚.iconfontçš„csså¹¶ä¸ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è‡ªå®šä¹‰æ ·å¼æ–‡ä»¶custom.cssé‡ŒåŠ ä¸Šä¸€äº›æ ·å¼æ¥é™åˆ¶å›¾æ ‡çš„å¤§å°å’Œé¢œè‰²ç­‰ï¼Œå…·ä½“å¤§å°è‡ªè¡Œè°ƒèŠ‚ã€‚\n1 2 3 4 5 6 7 svg.icon { width: 1.28em; height: 1.28em; vertical-align: -0.15em; fill: currentColor; overflow: hidden; } 3. â• æ·»åŠ æŒ‰é’® ä¿®æ”¹\u0026quot;åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\header\\nav.pug\u0026quot;\n1. ä¿®æ”¹æœç´¢æŒ‰é’®å›¾æ ‡ï¼š\nå›¾æ ‡icon-a-044_sousuoä¿®æ”¹ä¸ºè‡ªå·±çš„ï¼Œwidth: 2.2em; height: 2.2em;ä¿®æ”¹å¤§å° æŠŠä»¥ä¸‹è¯­å¥åˆ é™¤æˆ–æ³¨é‡Šæ‰å³å¯ï¼Œæœç´¢ä¸¤ä¸ªå­—å°±ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥(è¿™ç§è¯­å¥ç»Ÿä¸€å†™æ³•æ˜¯ç›´æ¥åˆ é™¤+å°±å¯ä»¥ï¼Œä¸ç”¨è¡¥ç©ºæ ¼)ã€‚ 2. å¼•å…¥æ˜æš—æ¨¡å¼åˆ‡æ¢å›¾æ ‡ï¼š\nå¤ªé˜³å›¾æ ‡ï¼š``icon-sunï¼Œæœˆäº®å›¾æ ‡ï¼šicon-moonã€‚æˆ‘çš„é»˜è®¤æ˜¯é»‘æš—æ¨¡å¼ï¼Œé€‰æ‹©å¤ªé˜³å›¾æ ‡ use#modeicon(xlink:href=\u0026rsquo;#icon-shezhi\u0026rsquo;)` 3. ä¿®æ”¹èœå•æŒ‰é’®å›¾æ ‡ï¼š\nå›¾æ ‡icon-shezhiä¿®æ”¹ä¸ºè‡ªå·±çš„ï¼Œwidth: 1.6em; height: 1.6em;ä¿®æ”¹å¤§å° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #menus if theme.search.use #search-button span.site-page.social-icon.search - - i.fas.fa-search.fa-fw //- åŸä¸»é¢˜ï¼Œæœç´¢æŒ‰é’®å›¾æ ‡ - span= \u0026#39; \u0026#39; + _p(\u0026#39;search.title\u0026#39;) //- å»é™¤æœç´¢å­—æ · + a.site-page.social-icon.search.faa-parent.animated-hover(title=\u0026#34;æœç´¢\u0026#34;) + svg.faa-tada.icon(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2.9em;width:2.9em\u0026#34;) + use(xlink:href=\u0026#39;#icon-a-044_sousuo\u0026#39;) if theme.menu != partial(\u0026#39;includes/header/menu_item\u0026#39;, {}, {cache: true}) + a.sun_moon.faa-parent.animated-hover(onclick=\u0026#39;switchNightMode()\u0026#39;, title=\u0026#39;æ˜æš—æ¨¡å¼\u0026#39;, id=\u0026#39;nightmode-button\u0026#39;) + svg.faa-tada(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) + use#modeicon(xlink:href=\u0026#39;#icon-sun\u0026#39;) #toggle-menu span.site-page - - i.fas.fa-bars.fa-fw //- åŸä¸»é¢˜ï¼Œèœå•æŒ‰é’®å›¾æ ‡ + a.site-page.faa-parent.animated-hover(title=\u0026#34;èœå•\u0026#34;) + svg.faa-tada(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) + use#modeicon(xlink:href=\u0026#39;#icon-shezhi\u0026#39;) å®Œæ•´çš„ #menuséƒ¨åˆ†ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #menus if theme.search.use #search-button span.site-page.social-icon.search //- i.fas.fa-search.fa-fw //- span= \u0026#39; \u0026#39; + _p(\u0026#39;search.title\u0026#39;) //- æ›´æ¢æœç´¢æŒ‰é’®å›¾æ ‡ a.site-page.social-icon.search.faa-parent.animated-hover(title=\u0026#34;æœç´¢\u0026#34;) svg.faa-tada.icon(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2.9em;width:2.9em\u0026#34;) use(xlink:href=\u0026#39;#icon-a-044_sousuo\u0026#39;) if theme.menu != partial(\u0026#39;includes/header/menu_item\u0026#39;, {}, {cache: true}) //- å¼•å…¥æ˜æš—æ¨¡å¼åˆ‡æ¢æŒ‰é’® a.sun_moon.faa-parent.animated-hover(onclick=\u0026#39;switchNightMode()\u0026#39;, title=\u0026#39;æ˜æš—æ¨¡å¼\u0026#39;, id=\u0026#39;nightmode-button\u0026#39;) svg.faa-tada(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) use#modeicon(xlink:href=\u0026#39;#icon-sun\u0026#39;) #toggle-menu span.site-page //- i.fas.fa-bars.fa-fw //- æ›´æ¢èœå•æŒ‰é’®å›¾æ ‡ a.site-page.faa-parent.animated-hover(title=\u0026#34;èœå•\u0026#34;) svg.faa-tada(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) use#modeicon(xlink:href=\u0026#39;#icon-shezhi\u0026#39;) 4. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo cl; hexo s å¯¼èˆªæ å¼•å…¥å›¾æ ‡ ä¿®æ”¹\u0026quot;åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\header\\nav.pug\u0026quot; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 nav#nav span#blog-info a.nav-site-title(href=url_for(\u0026#39;/\u0026#39;)) if theme.nav.logo img.site-icon(src=url_for(theme.nav.logo) alt=\u0026#39;Logo\u0026#39;) if theme.nav.display_title span.site-name=config.title if globalPageType === \u0026#39;post\u0026#39; a.nav-page-title(href=url_for(\u0026#39;/\u0026#39;)) span.site-name=(page.title || config.title) #menus if theme.search.use #search-button span.site-page.social-icon.search - //- i.fas.fa-search.fa-fw + //- æ›´æ¢æœç´¢æŒ‰é’®å›¾æ ‡ + a.site-page.social-icon.search.faa-parent.animated-hover(title=\u0026#34;æœç´¢\u0026#34;) + svg.faa-tada.search(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2.9em;width:2.9em\u0026#34;) + use(xlink:href=\u0026#39;#icon-a-044_sousuo\u0026#39;) - //- span= \u0026#39; \u0026#39; + _p(\u0026#39;search.title\u0026#39;) if theme.menu != partial(\u0026#39;includes/header/menu_item\u0026#39;, {}, {cache: true}) + //- å¼•å…¥åˆ‡æ¢å£çº¸æŒ‰é’® + a.site-page.faa-parent.animated-hover(onclick=\u0026#39;toggleWinbox()\u0026#39; title=\u0026#39;åˆ‡æ¢å£çº¸\u0026#39;) + svg.faa-tada.bizhi(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2em;width:2em\u0026#34;) + use(xlink:href=\u0026#39;#icon-a-zhaopiantupianxiangce\u0026#39;) + //- å¼•å…¥æ˜æš—æ¨¡å¼åˆ‡æ¢æŒ‰é’® + a.sun_moon.faa-parent.animated-hover(onclick=\u0026#39;switchNightMode()\u0026#39;, title=\u0026#39;æ˜æš—æ¨¡å¼\u0026#39;, id=\u0026#39;nightmode-button\u0026#39;) + svg.faa-tada.mingan(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) + use#modeicon(xlink:href=\u0026#39;#icon-sun\u0026#39;) #toggle-menu span.site-page - //- i.fas.fa-bars.fa-fw + //- æ›´æ¢èœå•æŒ‰é’®å›¾æ ‡ + a.site-page.faa-parent.animated-hover(title=\u0026#34;èœå•\u0026#34;) + svg.faa-tada.chaidan(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) + use#modeicon(xlink:href=\u0026#39;#icon-shezhi\u0026#39;) 1. åŸºæœ¬ç»“æ„\n1 2 Puga.site-page.faa-parent.animated-hover(onclick=\u0026#39;toggleWinbox()\u0026#39; title=\u0026#39;åˆ‡æ¢å£çº¸\u0026#39;) svg.faa-tada.bizhi(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2em;width:2em\u0026#34;) è¿™æ˜¯ä¸€ä¸ª \u0026lt;a\u0026gt; é“¾æ¥å…ƒç´ ï¼ŒåŒ…å«ä¸€ä¸ªåµŒå¥—çš„ \u0026lt;svg\u0026gt; å›¾æ ‡ã€‚ ä½¿ç”¨äº† Pug çš„åµŒå¥—è¯­æ³•ï¼Œé€šè¿‡ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ã€‚ 2. é“¾æ¥å±æ€§\n1 a.site-page.faa-parent.animated-hover(onclick=\u0026#39;toggleWinbox()\u0026#39; title=\u0026#39;åˆ‡æ¢å£çº¸\u0026#39;) ç±»åï¼š .site-pageï¼šåŸºç¡€æ ·å¼ç±»ï¼ˆå¯èƒ½å®šä¹‰é“¾æ¥çš„å¤–è§‚ï¼‰ã€‚ .faa-parentï¼šFont Awesome Animation çš„çˆ¶å®¹å™¨ç±»ï¼ˆç”¨äºå­å…ƒç´ åŠ¨ç”»ï¼‰ã€‚ .animated-hoverï¼šè‡ªå®šä¹‰æ‚¬åœåŠ¨ç”»æ•ˆæœçš„ç±»ã€‚ äº‹ä»¶ï¼š onclick='toggleWinbox()'ï¼šç‚¹å‡»æ—¶è°ƒç”¨ JavaScript å‡½æ•° toggleWinbox()ï¼ˆå¯èƒ½æ˜¯æ§åˆ¶å¼¹çª—/å£çº¸åˆ‡æ¢çš„é€»è¾‘ï¼‰ã€‚ æç¤ºæ–‡æœ¬ï¼š title='åˆ‡æ¢å£çº¸'ï¼šé¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºçš„å·¥å…·æç¤ºï¼ˆâ€œåˆ‡æ¢å£çº¸â€ï¼‰ã€‚ 3. SVG å›¾æ ‡\n1 svg.faa-tada.bizhi(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2em;width:2em\u0026#34;) ç±»åï¼š\n.faa-tadaï¼šFont Awesome Animation çš„â€œæŠ–åŠ¨â€åŠ¨ç”»æ•ˆæœã€‚ .bizhiï¼šè‡ªå®šä¹‰ç±»ï¼ˆå¯èƒ½ç”¨äºæ ·å¼è¦†ç›–ï¼Œbizhi æ˜¯ä¸­æ–‡â€œå£çº¸â€çš„æ‹¼éŸ³ï¼‰ã€‚ æ— éšœç¢ï¼š\naria-hidden=\u0026quot;true\u0026quot;ï¼šå¯¹å±å¹•é˜…è¯»å™¨éšè—ï¼ˆå› å›¾æ ‡ä»…ä¸ºè£…é¥°ï¼‰ã€‚ å°ºå¯¸ï¼š\nstyle=\u0026quot;height:2em;width:2em\u0026quot;ï¼šå¼ºåˆ¶å®½é«˜ä¸º 2emï¼ˆç»§æ‰¿çˆ¶å…ƒç´ å­—ä½“å¤§å°ï¼‰ã€‚ 4. ç”Ÿæˆçš„å®é™… HTML\n1 2 3 HTML\u0026lt;a class=\u0026#34;site-page faa-parent animated-hover\u0026#34; onclick=\u0026#34;toggleWinbox()\u0026#34; title=\u0026#34;åˆ‡æ¢å£çº¸\u0026#34;\u0026gt; \u0026lt;svg class=\u0026#34;faa-tada bizhi\u0026#34; aria-hidden=\u0026#34;true\u0026#34; style=\u0026#34;height:2em;width:2em\u0026#34;\u0026gt;\u0026lt;/svg\u0026gt; \u0026lt;/a\u0026gt; 5. å…³é”®åŠŸèƒ½\nç‚¹å‡»äº‹ä»¶ï¼š ç‚¹å‡»åä¼šè§¦å‘ toggleWinbox()ï¼ˆå¯èƒ½æ˜¯åˆ‡æ¢å£çº¸å¼¹çª—æˆ–å£çº¸æœ¬èº«çš„å‡½æ•°ï¼‰ã€‚ åŠ¨ç”»æ•ˆæœï¼š faa-parent + faa-tada ç»„åˆä¼šè®© SVG å›¾æ ‡æŒç»­æŠ–åŠ¨ï¼ˆç±»ä¼¼ Font Awesome çš„åŠ¨ç”»æ•ˆæœï¼‰ã€‚ animated-hover å¯èƒ½æ·»åŠ äº†æ‚¬åœæ—¶çš„è¿‡æ¸¡æ•ˆæœï¼ˆå¦‚é¢œè‰²å˜åŒ–ï¼‰ã€‚ å›½é™…åŒ–ï¼š title=\u0026quot;åˆ‡æ¢å£çº¸\u0026quot; æç¤ºä¸­æ–‡ç”¨æˆ·ï¼Œä½†ä»£ç æœ¬èº«æ˜¯è¯­è¨€æ— å…³çš„ã€‚ 6. å¯èƒ½çš„ä¾èµ–åº“\nFont Awesome Animationï¼šæä¾› faa-* åŠ¨ç”»ç±»ã€‚ Winbox.jsï¼šå¦‚æœ toggleWinbox() æ˜¯æ§åˆ¶å¼¹çª—ï¼Œå¯èƒ½ç”¨åˆ°æ­¤åº“ã€‚ è‡ªå®šä¹‰ CSSï¼š.site-pageã€.bizhi ç­‰ç±»éœ€è¦é¢å¤–æ ·å¼æ–‡ä»¶æ”¯æŒã€‚ å®Œæ•´æ·»åŠ ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 nav#nav span#blog-info a.nav-site-title(href=url_for(\u0026#39;/\u0026#39;)) if theme.nav.logo img.site-icon(src=url_for(theme.nav.logo) alt=\u0026#39;Logo\u0026#39;) if theme.nav.display_title span.site-name=config.title if globalPageType === \u0026#39;post\u0026#39; a.nav-page-title(href=url_for(\u0026#39;/\u0026#39;)) span.site-name=(page.title || config.title) #menus if theme.search.use #search-button span.site-page.social-icon.search //- i.fas.fa-search.fa-fw //- æ›´æ¢æœç´¢æŒ‰é’®å›¾æ ‡ a.site-page.social-icon.search.faa-parent.animated-hover(title=\u0026#34;æœç´¢\u0026#34;) svg.faa-tada.search(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2.9em;width:2.9em\u0026#34;) use(xlink:href=\u0026#39;#icon-a-044_sousuo\u0026#39;) //- span= \u0026#39; \u0026#39; + _p(\u0026#39;search.title\u0026#39;) if theme.menu != partial(\u0026#39;includes/header/menu_item\u0026#39;, {}, {cache: true}) //- å¼•å…¥åˆ‡æ¢å£çº¸æŒ‰é’® a.site-page.faa-parent.animated-hover(onclick=\u0026#39;toggleWinbox()\u0026#39; title=\u0026#39;åˆ‡æ¢å£çº¸\u0026#39;) svg.faa-tada.bizhi(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2em;width:2em\u0026#34;) use(xlink:href=\u0026#39;#icon-a-zhaopiantupianxiangce\u0026#39;) //- å¼•å…¥æ˜æš—æ¨¡å¼åˆ‡æ¢æŒ‰é’® a.sun_moon.faa-parent.animated-hover(onclick=\u0026#39;switchNightMode()\u0026#39;, title=\u0026#39;æ˜æš—æ¨¡å¼\u0026#39;, id=\u0026#39;nightmode-button\u0026#39;) svg.faa-tada.mingan(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) use#modeicon(xlink:href=\u0026#39;#icon-sun\u0026#39;) #toggle-menu span.site-page //- i.fas.fa-bars.fa-fw //- æ›´æ¢èœå•æŒ‰é’®å›¾æ ‡ a.site-page.faa-parent.animated-hover(title=\u0026#34;èœå•\u0026#34;) svg.faa-tada.chaidan(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;width: 1.6em; height: 1.6em;\u0026#34;) use#modeicon(xlink:href=\u0026#39;#icon-shezhi\u0026#39;) ğŸ’« åä¸€ã€é»‘å¤œéœ“è™¹ç¯æ•ˆæœ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä¸ºç½‘ç«™æ ‡é¢˜å’Œå‰¯æ ‡é¢˜æ·»åŠ éœ“è™¹ç¯æ•ˆæœï¼Œåœ¨é»‘æš—æ¨¡å¼ä¸‹ç‰¹åˆ«é†’ç›®ï¼Œå¢å¼ºè§†è§‰å†²å‡»åŠ›ã€‚\nğŸ”§ å®ç°æ–¹æ³• 1. â• åˆ›å»ºéœ“è™¹ç¯æ•ˆæœCSSï¼š è¯¦è§ï¼š é»‘å¤œéœ“è™¹ç¯2.0ï¼ˆçº¯CSSå®ç°ï¼‰ åˆ›å»º Hexoæ ¹ç›®å½•/source/css/custom.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 /* æ—¥é—´æ¨¡å¼ç”Ÿæ•ˆ */ [data-theme=\u0026#34;light\u0026#34;] #site-name, [data-theme=\u0026#34;light\u0026#34;] #site-title { animation: light_15px_dark 10s linear infinite; } [data-theme=\u0026#34;light\u0026#34;] #site-subtitle { animation: light_10px_dark 10s linear infinite; } [data-theme=\u0026#34;light\u0026#34;] #post-info { animation: light_15px_light 10s linear infinite; } /* å¤œé—´æ¨¡å¼ç”Ÿæ•ˆ */ [data-theme=\u0026#34;dark\u0026#34;] #site-name, [data-theme=\u0026#34;dark\u0026#34;] #site-title { animation: light_15px_dark 10s linear infinite; } [data-theme=\u0026#34;dark\u0026#34;] #site-subtitle { animation: light_10px_dark 10s linear infinite; } [data-theme=\u0026#34;dark\u0026#34;] #post-info { animation: light_15px_light 10s linear infinite; } /* æ—¥é—´æ¨¡å¼å…³é”®å¸§æè¿° */ @keyframes light_15px_light { 0% { text-shadow: #5636ed 0 0 15px; opacity: 0.8; transform: scale(0.95); } 25% { text-shadow: #11ee5e 0 0 15px; opacity: 1; transform: scale(1); } 50% { text-shadow: #f14747 0 0 15px; opacity: 0.8; transform: scale(0.95); } 75% { text-shadow: #f1a247 0 0 15px; opacity: 1; transform: scale(1); } 100% { text-shadow: #5636ed 0 0 15px; opacity: 0.8; transform: scale(0.95); } } @keyframes light_10px_light { 0% { text-shadow: #5636ed 0 0 10px; opacity: 0.8; transform: scale(0.95); } 25% { text-shadow: #11ee5e 0 0 10px; opacity: 1; transform: scale(1); } 50% { text-shadow: #f14747 0 0 10px; opacity: 0.8; transform: scale(0.95); } 75% { text-shadow: #f1a247 0 0 10px; opacity: 1; transform: scale(1); } 100% { text-shadow: #5636ed 0 0 10px; opacity: 0.8; transform: scale(0.95); } } @keyframes light_5px_light { 0% { text-shadow: #5636ed 0 0 5px; opacity: 0.8; transform: scale(0.95); } 25% { text-shadow: #11ee5e 0 0 5px; opacity: 1; transform: scale(1); } 50% { text-shadow: #f14747 0 0 5px; opacity: 0.8; transform: scale(0.95); } 75% { text-shadow: #f1a247 0 0 5px; opacity: 1; transform: scale(1); } 100% { text-shadow: #5636ed 0 0 5px; opacity: 0.8; transform: scale(0.95); } } /* å¤œé—´æ¨¡å¼å…³é”®å¸§æè¿° */ @keyframes light_15px_dark { 0% { text-shadow: #5636ed 0 0 15px; opacity: 0.6; transform: rotate(-3deg); } 12.5% { text-shadow: #11ee5e 0 0 15px; opacity: 0.8; transform: rotate(0deg); } 25% { text-shadow: #f14747 0 0 15px; opacity: 0.6; transform: rotate(3deg); } 37.5% { text-shadow: #f1a247 0 0 15px; opacity: 0.8; transform: rotate(0deg); } 50% { text-shadow: #f1ee47 0 0 15px; opacity: 0.6; transform: rotate(-3deg); } 62.5% { text-shadow: #b347f1 0 0 15px; opacity: 0.8; transform: rotate(0deg); } 75% { text-shadow: #002afa 0 0 15px; opacity: 0.6; transform: rotate(3deg); } 87.5% { text-shadow: #ed709b 0 0 15px; opacity: 0.8; transform: rotate(0deg); } 100% { text-shadow: #5636ed 0 0 15px; opacity: 0.6; transform: rotate(-3deg); } } @keyframes light_10px_dark { 0% { text-shadow: #5636ed 0 0 10px; opacity: 0.6; transform: rotate(-3deg); } 12.5% { text-shadow: #11ee5e 0 0 10px; opacity: 0.8; transform: rotate(0deg); } 25% { text-shadow: #f14747 0 0 10px; opacity: 0.6; transform: rotate(3deg); } 37.5% { text-shadow: #f1a247 0 0 10px; opacity: 0.8; transform: rotate(0deg); } 50% { text-shadow: #f1ee47 0 0 10px; opacity: 0.6; transform: rotate(-3deg); } 62.5% { text-shadow: #b347f1 0 0 10px; opacity: 0.8; transform: rotate(0deg); } 75% { text-shadow: #002afa 0 0 10px; opacity: 0.6; transform: rotate(3deg); } 87.5% { text-shadow: #ed709b 0 0 10px; opacity: 0.8; transform: rotate(0deg); } 100% { text-shadow: #5636ed 0 0 10px; opacity: 0.6; transform: rotate(-3deg); } } @keyframes light_5px_dark { 0% { text-shadow: #5636ed 0 0 5px; opacity: 0.6; transform: rotate(-3deg); } 12.5% { text-shadow: #11ee5e 0 0 5px; opacity: 0.8; transform: rotate(0deg); } 25% { text-shadow: #f14747 0 0 5px; opacity: 0.6; transform: rotate(3deg); } 37.5% { text-shadow: #f1a247 0 0 5px; opacity: 0.8; transform: rotate(0deg); } 50% { text-shadow: #f1ee47 0 0 5px; opacity: 0.6; transform: rotate(-3deg); } 62.5% { text-shadow: #b347f1 0 0 5px; opacity: 0.8; transform: rotate(0deg); } 75% { text-shadow: #002afa 0 0 5px; opacity: 0.6; transform: rotate(3deg); } 87.5% { text-shadow: #ed709b 0 0 5px; opacity: 0.8; transform: rotate(0deg); } 100% { text-shadow: #5636ed 0 0 5px; opacity: 0.6; transform: rotate(-3deg); } } 2. â• å¼•å…¥ custom.css æ–‡ä»¶ åœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œå¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: # æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/custom.css\u0026#34;\u0026gt; 3. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s ğŸ”² åäºŒã€å…¨å±€åœ†è§’è®¾è®¡ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä¸ºé¡µé¢å…ƒç´ ç»Ÿä¸€æ·»åŠ åœ†è§’è®¾è®¡ï¼Œè¥é€ æŸ”å’Œç°ä»£çš„è§†è§‰é£æ ¼ï¼Œæå‡æ•´ä½“ç¾è§‚åº¦ã€‚\nğŸ”§ å®ç°æ–¹æ³• åˆ›å»º Hexoæ ¹ç›®å½•/source/css/å…¨å±€åœ†è§’.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 /******************** å…¨å±€åœ†è§’ ***********************/ /* é¦–é¡µæ–‡ç« å¡ç‰‡åœ†è§’ */ #recent-posts .recent-post-item { border-radius: 20px; /* æ·»åŠ åœ†è§’æ•ˆæœï¼Œæ•°å€¼å¯æŒ‰éœ€è°ƒæ•´ */ } /* æ–‡ç« é¡µç›®å½•å¡ç‰‡åœ†è§’ */ #aside-content .card-widget { border-radius: 20px; } /* æ–‡ç« æ­£æ–‡åœ†è§’ */ #post { border-radius: 20px; } /* æ–‡ç« å›¾ç‰‡åœ†è§’ */ .container img { border-radius: 20px; } /* ç›¸å…³æ–‡ç« å¡ç‰‡ */ #post .pagination-related { border-radius: 20px; border: var(--mobufan-border-style) !important; /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ } /* æ–‡ç« ç›¸å…³æ¨èå¡ç‰‡åœ†è§’ */ /*.relatedPosts \u0026gt; .relatedPosts-list \u0026gt; div {*/ /* border-radius: 20px;*/ /*}*/ /*#aside-content #card-toc .toc-content .toc-link.active {*/ /* border-radius: 5px;*/ /*}*/ /* æ–‡ç« ä¸Šä¸‹ç¯‡å¡ç‰‡åœ†è§’ */ #pagination .pagination-post { border-radius: 20px; border: var(--mobufan-border-style) !important; /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ } /* æ–‡å­—ä»£ç æ¡†åœ†è§’ */ #post .highlight { border-radius: 20px; } /*************ï¼ˆå‹é“¾+å½’æ¡£+åˆ†ç±»+ä¾¿ç­¾ï¼‰åœ†è§’ *****************/ #page { border-radius: 20px; } /* åˆ†ç±»å­é¡µé¢åœ†è§’ */ #category { border-radius: 20px; } /* æ ‡ç­¾å­é¡µé¢åœ†è§’ */ #tag { border-radius: 20px; } /* å½’æ¡£å­é¡µé¢åœ†è§’ */ div#archive { border-radius: 20px; } /* å¯¼èˆªæ å­èœå•åœ†è§’ */ .menus_item_child, .site-page.child.faa-parent.animated-hover { border-radius: 20px !important; /* ç¡®ä¿æ‚¬åœæ—¶åœ†è§’æ•ˆæœå­˜åœ¨ */ } .menus_item_child, .site-page.child.faa-parent.animated-hover:hover { border-radius: 20px !important; /* ç¡®ä¿æ‚¬åœæ—¶åœ†è§’æ•ˆæœå­˜åœ¨ */ } /* æœç´¢æ¡†åœ†è§’ */ .search-dialog { border-radius: 20px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ } /* è¯„è®ºè¾“å…¥æ¡†åœ†è§’*/ #twikoo .tk-comments .tk-submit .tk-row .tk-col .tk-input.el-textarea .el-textarea__inner { border-radius: 15px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ } /* è¯„è®ºé¢„è§ˆåœ†è§’ */ .el-button.tk-preview.el-button--default.el-button--small { border-radius: 10px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ } /* è¯„è®ºå‘é€åœ†è§’ */ .el-button.tk-send.el-button--primary.el-button--small.is-disabled { border-radius: 10px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ } /* md è¡¨æ ¼ */ .table-container .table-wrap table { border-radius: 10px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ } /* æ ‡ç­¾å¤–æŒ‚ */ #post .container.post-content .folding-tag, #post .container.post-content .folding-tag .content, #post .container.post-content .folding-tag .content, summary { border-radius: 20px !important; /* åœ†è§’ */ } â• å¼•å…¥CSSæ–‡ä»¶ï¼š åœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: # æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/å…¨å±€åœ†è§’.css\u0026#34;\u0026gt; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ­ åä¸‰ã€é¡µé¢ç¾åŒ–ä¼˜åŒ– âœ¨ åŠŸèƒ½ç‰¹ç‚¹ å…¨é¢ä¼˜åŒ–é¡µé¢æ ·å¼ï¼ŒåŒ…æ‹¬èƒŒæ™¯é€æ˜åº¦ã€è¾¹æ¡†è£…é¥°ã€ç£¨ç ‚æ•ˆæœç­‰ï¼Œæ‰“é€ ç²¾è‡´ç•Œé¢ã€‚\nğŸ”§ å®ç°æ–¹æ³• åˆ›å»ºé¡µé¢ç¾åŒ–CSSï¼š --trans-lightï¼šç™½å¤©æ¨¡å¼å¸¦é€æ˜åº¦çš„èƒŒæ™¯è‰²ï¼Œå¦‚rgba(255, 255, 255, 0.88)åº•è‰²æ˜¯çº¯ç™½è‰²ï¼Œå…¶ä¸­0.88å°±é€æ˜åº¦ï¼Œåœ¨0-1ä¹‹é—´è°ƒèŠ‚ï¼Œå€¼è¶Šå¤§è¶Šä¸é€æ˜ï¼› --trans-dark: å¤œé—´æ¨¡å¼å¸¦é€æ˜åº¦çš„èƒŒæ™¯è‰²ï¼Œå¦‚rgba(25, 25, 25, 0.88)åº•è‰²æ˜¯æŸ”å’Œé»‘è‰²ï¼Œå…¶ä¸­0.88å°±é€æ˜åº¦ï¼Œåœ¨0-1ä¹‹é—´è°ƒèŠ‚ï¼Œå€¼è¶Šå¤§è¶Šä¸é€æ˜; --border-style: è¾¹æ¡†æ ·å¼ï¼Œ1px solid rgb(169, 169, 169)æŒ‡å®½åº¦ä¸º1pxçš„ç°è‰²å®ä½“è¾¹æ¡†; --backdrop-filter: èƒŒæ™¯è¿‡æ»¤å™¨ï¼Œå¦‚blur(5px) saturate(150%)è¡¨ç¤ºé¥±å’Œåº¦ä¸º150%çš„ã€é«˜æ–¯æ¨¡ç³ŠåŠå¾„ä¸º5pxçš„è¿‡æ»¤å™¨ï¼Œè¿™æ˜¯äºšå…‹åŠ›æ•ˆæœçš„ä¸€ç§å®ç°æ–¹æ³•; å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±å–œå¥½è¿›è¡Œè°ƒèŠ‚ï¼Œä¸ç”¨æ‹˜æ³¥äºæˆ‘çš„æ ·å¼ï¼ åˆ›å»º Hexoæ ¹ç›®å½•/source/css/é¡µé¢ç¾åŒ–.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 /****************************** å®šä¹‰å…¨å±€é¢œè‰² ****************************/ :root { --mobufan-beijing: rgba(25, 25, 25, 0.2); /* æ—¥é—´æ¨¡å¼ï¼ŒèƒŒæ™¯é¢œè‰² */ --mobufan-fontcolor: #ffffff; /* æ—¥é—´æ¨¡å¼ï¼Œå­—ä½“é¢œè‰²*/ --mobufan-border: 1px solid #e0e0e0; /* è¾¹æ¡†æ ·å¼ï¼ˆç™½è‰²å®çº¿ï¼‰ */ --mobufan-shadow-border: 0 4px 12px 0 rgb(47, 255, 0), 0 1px 3px 0 rgba(0, 0, 0, 0.2); /* è¾¹æ¡†é˜´å½±æ•ˆæœæ‚¬æµ®æ„Ÿçš„ç«‹ä½“å…‰å½±æ•ˆæœ */ --mobufan-text-shadow: 0 0 5px rgba(255, 255, 255, 0.8); /* æ—¥é—´æ¨¡å¼ï¼Œæ–‡å­—é˜´å½±æ•ˆæœ */ --mobufan-border-style: 1.2px solid rgb(169, 169, 169); /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ --mobufan-backdrop-filter: blur(6px) saturate(150%); /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ --mobufan-color: #ffb800; /* æ‚¬åœæ—¶æ–‡å­—é¢œè‰²å˜ä¸ºé»„è‰² */ --mobufan-white: #ffffff; /* ç™½è‰²å­—ä½“ */ --mobufan-hangneidaima: #00fdf6; /* æ–‡ç« è¡Œå†…ä»£ç æ–‡å­—é¢œè‰² */ --mobufan-waigua: #ffffff; /* æ—¥é—´æ¨¡å¼ï¼Œå­—ä½“é¢œè‰²*/ --mobufan-jianbian: linear-gradient(to right, #00075ef2, #2c0364, #003300, #330000); /* æ¸å˜é¢œè‰²*/ /*--mobufan-lighttext: #6c757d; !* æµ…è‰²æ–‡å­—ï¼ˆç°è‰²ï¼‰ *!*/ /*--mobufan-dark: rgba(25, 25, 25, 0.2); !* å¤œé—´æ¨¡å¼èƒŒæ™¯é¢œè‰² *!*/ /*--mobufan-touming: rgba(25, 25, 25, 0); !* é€æ˜èƒŒæ™¯é¢œè‰² *!*/ } /********* æ˜äº®æ¨¡å¼é¢œè‰²é…ç½® *********/ [data-theme=\u0026#34;light\u0026#34;] { --mobufan-beijing: rgba(0 228 196 / 72%); /* æ—¥é—´æ¨¡å¼ï¼ŒèƒŒæ™¯é¢œè‰² */ /*--mobufan-beijing: linear-gradient(to right, #3a6a82, #5d7480, #1a5e80, #005a86); !* æ—¥é—´æ¨¡å¼ï¼ŒèƒŒæ™¯é¢œè‰² *!*/ --mobufan-fontcolor: #ffffff; /* æ—¥é—´æ¨¡å¼ï¼Œå­—ä½“é¢œè‰²*/ --mobufan-border: 1px solid #e0e0e0; /* è¾¹æ¡†æ ·å¼ï¼ˆæµ…ç°è‰²å®çº¿ï¼‰ */ --mobufan-shadow-border: 0 4px 12px 0 rgb(174 1 105), 0 1px 3px 0 rgba(0, 0, 0, 0.2); /* è¾¹æ¡†é˜´å½±æ•ˆæœæ‚¬æµ®æ„Ÿçš„ç«‹ä½“å…‰å½±æ•ˆæœ */ --mobufan-text-shadow: 0 0 5px rgb(183 0 110); /* æ—¥é—´æ¨¡å¼ï¼Œæ–‡å­—é˜´å½±æ•ˆæœ */ --mobufan-border-style: 1.2px solid rgb(255, 158, 0); /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ --mobufan-backdrop-filter: blur(6px) saturate(150%); /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ --mobufan-color: #ffb800; /* æ‚¬åœæ—¶è¾¹æ¡†é¢œè‰²å˜ä¸ºé»„è‰² */ --mobufan-white: #ffffff; /* ç™½è‰²å­—ä½“ */ --mobufan-hangneidaima: rgb(255, 0, 153); /* æ–‡ç« è¡Œå†…ä»£ç æ–‡å­—é¢œè‰² */ --mobufan-waigua: rgba(0, 0, 0, 0.63); /* æ—¥é—´æ¨¡å¼ï¼Œå­—ä½“é¢œè‰²*/ --mobufan-jianbian: linear-gradient(to right, #ffb4b4, #0082a9, #007057, #df5fff); /* æ¸å˜é¢œè‰²*/ /*--mobufan-lighttext: #007dd0; !* æ–‡ç« TOCå­—ä½“é¢œè‰² *!*/ /*--mobufan-dark: rgba(25, 25, 25, 0.2);*/ /*--mobufan-touming: rgba(25, 25, 25, 0); !* é€æ˜èƒŒæ™¯é¢œè‰² *!*/ } /********* æš—è‰²æ¨¡å¼é¢œè‰²é…ç½® *********/ [data-theme=\u0026#34;dark\u0026#34;] { --mobufan-beijing: rgba(25, 25, 25, 0.8); /* æ—¥é—´æ¨¡å¼èƒŒæ™¯é¢œè‰² */ --mobufan-fontcolor: #212529; /* æ—¥é—´æ¨¡å¼ï¼Œå­—ä½“é¢œè‰²*/ --mobufan-border: 1px solid #e0e0e0; /* è¾¹æ¡†æ ·å¼ï¼ˆæµ…ç°è‰²å®çº¿ï¼‰ */ --mobufan-shadow-border: 0 4px 12px 0 rgb(20 109 0 / 90%), 0 1px 3px 0 rgba(0, 0, 0, 0.2); /* è¾¹æ¡†é˜´å½±æ•ˆæœæ‚¬æµ®æ„Ÿçš„ç«‹ä½“å…‰å½±æ•ˆæœ */ --mobufan-text-shadow: 0 0 5px rgb(40 221 0); /* æ—¥é—´æ¨¡å¼ï¼Œæ–‡å­—é˜´å½±æ•ˆæœ */ --mobufan-border-style: 1.2px solid rgb(169, 169, 169); /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ --mobufan-backdrop-filter: blur(6px) saturate(150%); /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ --mobufan-color: #ffb800; /* æ‚¬åœæ—¶è¾¹æ¡†é¢œè‰²å˜ä¸ºé»„è‰² */ --mobufan-white: #ffffff; /* ç™½è‰²å­—ä½“ */ --mobufan-hangneidaima: rgb(47, 255, 0); /* æ–‡ç« è¡Œå†…ä»£ç æ–‡å­—é¢œè‰² */ --mobufan-waigua: #ffffff; /* æ—¥é—´æ¨¡å¼ï¼Œå­—ä½“é¢œè‰²*/ --mobufan-jianbian: linear-gradient(to right, #00075ef2, #2c0364, #003300, #330000); /* æ¸å˜é¢œè‰²*/ /*--mobufan-lighttext: #007dd0; !* æ–‡ç« TOCå­—ä½“é¢œè‰² *!*/ /*--mobufan-dark: rgba(25, 25, 25, 0.2);*/ /*--mobufan-touming: rgba(25, 25, 25, 0); !* é€æ˜èƒŒæ™¯é¢œè‰² *!*/ } /************************ èƒŒæ™¯é¢œè‰²+è¾¹æ¡†è£…é¥°çº¿+ç£¨ç ‚æ•ˆæœ ************************/ /*#to_comment .fas.fa-comments, !* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œè¯„è®º *!*/ /*#rightside-config-hide .icon-V.hidden, !* å³ä¸‹è§’æ˜æš—æ¨¡å¼ *!*/ #post .container.post-content .folding-tag, /* æ ‡ç­¾å¤–æŒ‚ */ #post .container.post-content .folding-tag .content, /* æ ‡ç­¾å¤–æŒ‚ */ #post .container.post-content .folding-tag .content, summary, /* æ ‡ç­¾å¤–æŒ‚ */ #rightside \u0026gt; div \u0026gt; button, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œè¯„è®º */ #rightside \u0026gt; div \u0026gt; a, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œè¯„è®º */ #pagination .page-number, /* æ–‡ç« åˆ†é¡µ2 */ #pagination .extend.next, /* æ–‡ç« åˆ†é¡µ1 */ .search-dialog, /* æœç´¢æ¡† */ #tag, /* æ ‡ç­¾å­é¡µé¢å¡ç‰‡ */ #category, /* åˆ†ç±»å­é¡µé¢å¡ç‰‡ */ #recent-posts .recent-post-item, /* é¦–é¡µæ–‡ç« å¡ç‰‡ */ #aside-content .card-widget, /* é¦–é¡µä¾§æ å¡ç‰‡ */ div#post, /* æ–‡ç« é¡µå¡ç‰‡ */ div#archive, /* å½’æ¡£é¡µå¡ç‰‡ */ /* æ™®é€šé¡µå¡ç‰‡ */ div#page { background: var(--mobufan-beijing) !important; /* èƒŒæ™¯é¢œè‰² */ backdrop-filter: var(--mobufan-backdrop-filter) !important; /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ border: var(--mobufan-border-style) !important; /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ } /* é¼ æ ‡æ‚¬åœï¼Œç½‘é¡µæ‰€æœ‰å…ƒç´ èƒŒæ™¯é€æ˜ */ /**:hover {*/ /* background-color: transparent !important;*/ /* transition: background-color 0.3s ease; !* æ·»åŠ è¿‡æ¸¡æ•ˆæœ *!*/ /*}*/ /** {*/ /* background-color: transparent !important;*/ /* transition: background-color 0.3s ease; !* æ·»åŠ è¿‡æ¸¡æ•ˆæœ *!*/ /*}*/ /********************** é¼ æ ‡æ‚¬åœï¼Œæ–‡å­—é¢œè‰² ***************************/ .aside-list-item .title:hover, /* ä¾§è¾¹æ -æœ€è¿‘æ–‡ç«  */ .card-tag-cloud a:hover { /* ä¾§è¾¹æ -æ ‡ç­¾äº‘ï¼š.card-tag-cloud a */ color: var(--mobufan-hangneidaima) !important; /* é¼ æ ‡æ‚¬åœï¼Œæ–‡å­—é¢œè‰²*/ } /*************************** å¯¼èˆªæ ç¾åŒ– ****************************/ /********** ä¸€çº§èœå•å±…ä¸­ **********/ #nav .menus_items { position: absolute !important; width: fit-content !important; left: 50% !important; transform: translateX(-50%) !important; top: 12px !important; /* å‘ä¸‹ç§»åŠ¨ */ } /********* å­èœå•æ¨ªå‘å±•ç¤º *********/ #nav .menus_items .menus_item:hover .menus_item_child { display: flex; } /* è¿™é‡Œçš„2æ˜¯ä»£è¡¨å¯¼èˆªæ çš„ç¬¬2ä¸ªå…ƒç´ ï¼Œå³æœ‰å­èœå•çš„å…ƒç´ ï¼Œå¯ä»¥æŒ‰è‡ªå·±éœ€æ±‚ä¿®æ”¹ */ .menus_items .menus_item:nth-child(2) .menus_item_child { left: -125px; } /********* å»é™¤å¯¼èˆªæ é€‰é¡¹ä¸­åº•ä¸‹çš„è“æ¡ *********/ #nav *::after{ background-color: transparent!important; } /********* è°ƒæ•´å¯¼èˆªæ ï¼ˆå›¾æ ‡å¤§å°å’Œæ–‡å­—é¢œè‰²ï¼‰*********/ .site-page svg { width: 1.8em; /* è°ƒæ•´ï¼ˆå¯¼èˆªæ å›¾æ ‡ï¼‰çš„å®½åº¦ */ height: 1.8em; /* è°ƒæ•´ï¼ˆå¯¼èˆªæ å›¾æ ‡ï¼‰çš„é«˜åº¦ */ vertical-align: middle; /* é»˜è®¤å±…ä¸­å¯¹é½ */ vertical-align: -0.3em; /* å‘ä¸Šç§»åŠ¨ */ } .site-page span { font-size: 1.38em; /* è°ƒæ•´ï¼ˆå¯¼èˆªæ æ–‡å­—ï¼‰å¤§å° */ color: var(--mobufan-white); /* è°ƒæ•´ï¼ˆå¯¼èˆªæ æ–‡å­—ï¼‰é¢œè‰² */ vertical-align: 0.01em; /* å‘ä¸Šç§»åŠ¨ */ } .site-name { font-size: 1.8em; /* è°ƒæ•´ï¼ˆç«™ç‚¹æ ‡é¢˜æ–‡å­—ï¼‰å¤§å° */ color: var(--mobufan-white); /* è°ƒæ•´ï¼ˆç«™ç‚¹æ ‡é¢˜æ–‡å­—ï¼‰é¢œè‰² */ } /* å¯¼èˆªæ æ–‡å­—åŠ ç²—å’Œé—´è·è°ƒæ•´*/ #menus \u0026gt; div.menus_items \u0026gt; div \u0026gt; a { /* è°ƒæ•´æ–‡å­—å¤§å° */ /*font-size: 14px; !* æˆ–å…¶ä»–å€¼ï¼Œå¦‚ 16pxã€1.2rem ç­‰ *!*/ letter-spacing: .1rem; font-weight: 600; padding: 0 .1em 0 0.1em; height: 30px; line-height: 30px; /* é‡ç½®è¿‡æ¸¡åŠ¨ç”»ï¼ˆå¦‚æœéœ€è¦ï¼‰ */ -webkit-transition: color 0s !important; -moz-transition: color 0s !important; -o-transition: color 0s !important; -ms-transition: color 0s !important; transition: color 0s !important; } /********* å¯¼èˆªæ èœå•é¼ æ ‡ç§»å…¥å­—ä½“æ”¾å¤§ *********/ .site-name:hover { font-size: 40px; /*å¯¼èˆªæ ï¼ˆç«™ç‚¹æ ‡é¢˜ï¼‰æ–‡å­—å›¾æ ‡*/ background: var(--mobufan-beijing) !important; /* æ—¥é—´æ¨¡å¼å¯¼èˆªæ ï¼ˆä¸»èœå•ï¼‰èƒŒæ™¯é¢œè‰² */ transition: transform 0.3s ease; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */ } /*.menus_item:hover {*/ /* font-size: 16px; !*å¯¼èˆªæ ï¼ˆä¸»èœå•ï¼‰æ–‡å­—å›¾æ ‡*!*/ /* background: var(--mobufan-beijing) !important; !* æ—¥é—´æ¨¡å¼å¯¼èˆªæ ï¼ˆä¸»èœå•ï¼‰èƒŒæ™¯é¢œè‰² *!*/ /* transition: transform 0.3s ease; !* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ *!*/ /*}*/ /********* å¯¼èˆªæ ï¼ˆä¸»èœå•ï¼‰èƒŒæ™¯é¢œè‰² *********/ #page-header.nav-fixed #nav { background: var(--mobufan-beijing) !important; /* æ—¥é—´æ¨¡å¼å¯¼èˆªæ ï¼ˆä¸»èœå•ï¼‰èƒŒæ™¯é¢œè‰² */ backdrop-filter: var(--mobufan-backdrop-filter) !important; /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ } /******************************* å¯¼èˆªæ ï¼ˆå­èœå•ï¼‰èƒŒæ™¯é¢œè‰² ****************************/ .menus_item_child, .site-page.child.faa-parent.animated-hover { background-color: var(--mobufan-beijing) !important; /* è®¾ç½®å…ƒç´ çš„èƒŒæ™¯é¢œè‰² */ /* backdrop-filter: var(--mobufan-backdrop-filter) !important; /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ */ transition: background-color 0.3s ease !important; /* æ—¥é—´æ¨¡å¼ï¼Œæ·»åŠ ï¼ˆå­èœå•ï¼‰è¿‡æ¸¡æ•ˆæœ */ } #nav .menus_items .menus_item .menus_item_child li:hover { background-color: var(--mobufan-beijing) !important; transition: background-color 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */ border: var(--mobufan-border-style) !important; /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ box-shadow: var(--mobufan-shadow-border) !important; /* æ·»åŠ é˜´å½±æ•ˆæœ */ } /* ä¸ºå¯¼èˆªèœå•ä¸­çš„å­èœå•é¡¹è®¾ç½®æ ·å¼ */ #nav .menus_items .menus_item .menus_item_child li { background-color: var(--mobufan-beijing) !important; /* è®¾ç½®å…ƒç´ çš„åœ†è§’åŠå¾„ä¸º 50pxï¼Œå®ç°åœ†å½¢æ•ˆæœ */ border-radius: 16px; /* ä¸ºæ‰€æœ‰å±æ€§çš„å˜åŒ–æ·»åŠ è¿‡æ¸¡åŠ¨ç”»ï¼ŒæŒç»­æ—¶é—´ä¸º 0.3 ç§’ */ -webkit-transition: all .3s; /* å…¼å®¹ Webkit å†…æ ¸æµè§ˆå™¨ï¼ˆå¦‚ Chromeã€Safariï¼‰ */ -moz-transition: all .3s; /* å…¼å®¹ Gecko å†…æ ¸æµè§ˆå™¨ï¼ˆå¦‚ Firefoxï¼‰ */ -o-transition: all .3s; /* å…¼å®¹ Opera æµè§ˆå™¨ */ -ms-transition: all .3s; /* å…¼å®¹ IE æµè§ˆå™¨ */ transition: all .3s; /* æ ‡å‡†è¯­æ³•ï¼Œé€‚ç”¨äºç°ä»£æµè§ˆå™¨ */ /* å°†å…ƒç´ ä»¥è¡Œå†…å—çº§å…ƒç´ çš„æ–¹å¼æ˜¾ç¤ºï¼Œå…è®¸è®¾ç½®å®½åº¦å’Œé«˜åº¦ */ display: inline-block; /* è®¾ç½®å…ƒç´ å·¦å³å¤–è¾¹è·ä¸º 2pxï¼Œå¢åŠ é—´è· */ margin: 0 2px; list-style: none; /* ç§»é™¤å¯¼èˆªèœå•å­é¡¹çš„é»˜è®¤åˆ—è¡¨æ ·å¼ */ border: var(--mobufan-border-style) !important; /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ } /* æ¸…é™¤å¯¼èˆªæ å…ƒç´ æœ€åº•å±‚èƒŒæ™¯*/ #nav .menus_items .menus_item .menus_item_child { background-color: transparent!important; } /* è®¾ç½®å¯¼èˆªèœå•å­é¡¹çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ çš„ä¸Šè¾¹æ¡†ä¸ºåœ†è§’ */ #nav .menus_items .menus_item .menus_item_child li:first-child { border-top-left-radius: 20px; border-top-right-radius: 20px; } /* è®¾ç½®å¯¼èˆªèœå•å­é¡¹çš„æœ€åä¸€ä¸ªå­å…ƒç´ çš„ä¸‹è¾¹æ¡†ä¸ºåœ†è§’ */ #nav .menus_items .menus_item .menus_item_child li:last-child { border-bottom-right-radius: 20px; border-bottom-left-radius: 20px; } /* è®¾ç½®å¯¼èˆªèœå•å­é¡¹ä¸­çš„é“¾æ¥æ ·å¼ */ #nav .menus_items .menus_item .menus_item_child li a { display: inline-block; /* å°†é“¾æ¥è®¾ç½®ä¸ºå†…è”å—å…ƒç´ ï¼Œä»¥ä¾¿è®¾ç½®å®½åº¦å’Œå†…è¾¹è· */ padding: .5625rem 1rem; /* è®¾ç½®å†…è¾¹è·ï¼Œç¡®ä¿é“¾æ¥å†…å®¹ä¸è¾¹æ¡†ä¹‹é—´çš„é—´è· */ width: 100%; /* é“¾æ¥å æ®æ•´ä¸ªçˆ¶å…ƒç´ çš„å®½åº¦ */ color: #4c4948; /* è®¾ç½®é“¾æ¥çš„æ–‡æœ¬é¢œè‰²ä¸ºæ·±ç°è‰² */ text-shadow: none !important; /* ç§»é™¤æ–‡æœ¬é˜´å½±æ•ˆæœ */ } /* å½“é¼ æ ‡æ‚¬åœåœ¨å¯¼èˆªèœå•å­é¡¹çš„é“¾æ¥ä¸Šæ—¶ï¼Œè®¾ç½®é“¾æ¥çš„æ ·å¼ */ /*#nav .menus_items .menus_item .menus_item_child li a:hover {*/ /* !* color: #fff; !important; *! !* è¢«æ³¨é‡Šæ‰çš„ä»£ç ï¼šå°†æ–‡æœ¬é¢œè‰²è®¾ç½®ä¸ºç™½è‰² *!*/ /* padding: .125rem 1.25rem; !* è°ƒæ•´å†…è¾¹è·ï¼Œé“¾æ¥ä½¿åœ¨æ‚¬åœæ—¶çœ‹èµ·æ¥æ›´ç´§å‡‘ *!*/ /* -webkit-transform: scale(1) !important; !* ä¿æŒå…ƒç´ çš„åŸå§‹å¤§å°ï¼ˆWebkitæµè§ˆå™¨ï¼‰ *!*/ /* -moz-transform: scale(1) !important; !* ä¿æŒå…ƒç´ çš„åŸå§‹å¤§å°ï¼ˆFirefoxæµè§ˆå™¨ï¼‰ *!*/ /* -o-transform: scale(1) !important; !* ä¿æŒå…ƒç´ çš„åŸå§‹å¤§å°ï¼ˆOperaæµè§ˆå™¨ï¼‰ *!*/ /* -ms-transform: scale(1) !important; !* ä¿æŒå…ƒç´ çš„åŸå§‹å¤§å°ï¼ˆIEæµè§ˆå™¨ï¼‰ *!*/ /* transform: scale(1) !important; !* ä¿æŒå…ƒç´ çš„åŸå§‹å¤§å°ï¼ˆæ ‡å‡†è¯­æ³•ï¼‰ *!*/ /* !* background: #425aef; !important; *! !* è¢«æ³¨é‡Šæ‰çš„ä»£ç ï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºè“è‰² *!*/ /* !* -webkit-box-shadow: 0 8px 12px -3px rgba(66, 89, 239, 0.137); *! !* è¢«æ³¨é‡Šæ‰çš„ä»£ç ï¼šæ·»åŠ é˜´å½±æ•ˆæœï¼ˆWebkitæµè§ˆå™¨ï¼‰ *!*/ /* !* box-shadow: 0 8px 12px -3px rgba(66, 89, 239, 0.137); *! !* è¢«æ³¨é‡Šæ‰çš„ä»£ç ï¼šæ·»åŠ é˜´å½±æ•ˆæœï¼ˆæ ‡å‡†è¯­æ³•ï¼‰ *!*/ /*}*/ /********** é¼ æ ‡æ‚¬åœèƒŒæ™¯é¢œè‰² **********/ .menus_item_child:hover, div#menus_item:hover, a.site-page.child.faa-parent.animated-hover:hover { background-color: var(--mobufan-beijing) !important; /* è®¾ç½®å…ƒç´ çš„èƒŒæ™¯é¢œè‰² */ backdrop-filter: var(--mobufan-backdrop-filter) !important; /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ transition: background-color 0.3s ease !important; /* æ·»åŠ ï¼ˆå­èœå•ï¼‰è¿‡æ¸¡æ•ˆæœ */ } /********** æ‰‹æœºç«¯èœå•æ èƒŒæ™¯ **********/ /* æ‰‹æœºç«¯èœå•æ æœ€å¤–å±‚ï¼šdiv#sidebar-menus */ div#sidebar-menus { background: var(--mobufan-beijing) !important; /* å¤œé—´æ¨¡å¼èƒŒæ™¯é¢œè‰² */ backdrop-filter: var(--mobufan-backdrop-filter); /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ border: var(--mobufan-border-style); /* è¾¹æ¡†è£…é¥°çº¿é¢œè‰² */ border-radius: 15px; /* åœ†è§’ */ } /* æ‰‹æœºç«¯èœå•æ (é¦–é¡µ+æ–‡ç« +ç¤¾äº¤+å…³äº)èƒŒæ™¯*/ .menus_items { background: var(--mobufan-beijing) !important; /* å¤œé—´æ¨¡å¼èƒŒæ™¯é¢œè‰² */ backdrop-filter: var(--mobufan-backdrop-filter); /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ border-radius: 20px !important; /* åœ†è§’ */ } /* æ‰‹æœºç«¯èœå•æ ï¼ˆå¤´åƒä¸‹é¢ï¼Œæ–‡ç« +æ ‡ç­¾+åˆ†ç±»ï¼‰*/ .site-data { font-size: 16px; /* å›¾æ ‡å¤§å° */ line-height: 40px; /* å›¾æ ‡ä¸Šä¸‹è°ƒèŠ‚ */ color: var(--mobufan-white); /* è°ƒæ•´ï¼ˆå¯¼èˆªæ æ–‡å­—ï¼‰é¢œè‰² */ background: var(--mobufan-beijing) !important; /* èƒŒæ™¯é¢œè‰² */ } /* æ‰‹æœºç«¯èœå•æ  é¼ æ ‡æ‚¬åœé€æ˜èƒŒæ™¯*/ #sidebar-menus .menus_items .menus_item a.site-page.faa-parent.animated-hover:hover { background-color: var(--mobufan-beijing) !important; } /************************ æ ‡ç­¾å¤–æŒ‚èƒŒæ™¯é¢œè‰² ************************/ #post .container.post-content .folding-tag, #post .container.post-content .folding-tag .content, #post .container.post-content .folding-tag .content, summary { background-color: var(--mobufan-beijing) !important; transition: background-color 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */ color: var(--mobufan-waigua) !important; } #post .container.post-content .folding-tag:hover { box-shadow: var(--mobufan-shadow-border) !important; /* æ·»åŠ é˜´å½±æ•ˆæœ */ } /************************ é˜…è¯»æ¨¡å¼ ************************/ /*[data-theme=\u0026#34;light\u0026#34;] .read-mode #aside-content .card-widget,*/ /*[data-theme=\u0026#34;light\u0026#34;] .read-mode div#post {*/ /* background: rgba(158, 204, 171, 0.5) !important;*/ /*}*/ /*!* å¤œé—´æ¨¡å¼ä¸‹çš„é˜…è¯»æ¨¡å¼ *!*/ /*[data-theme=\u0026#34;dark\u0026#34;] .read-mode #aside-content .card-widget,*/ /*[data-theme=\u0026#34;dark\u0026#34;] .read-mode div#post {*/ /* background: rgba(25, 25, 25, 0.2) !important;*/ /* color: #ffffff;*/ /*}*/ /*************************** å³ä¸‹è§’æŒ‰é’®ç¾åŒ– ************************/ #to_comment .fas.fa-comments, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œè¯„è®º */ #rightside \u0026gt; div \u0026gt; button, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œèœå• */ #rightside \u0026gt; div \u0026gt; a { display: block; margin-bottom: 5px; /*é—´è·*/ width: 42px; /*å·¦å³è¾¹æ¡†å¤§å°*/ height: 42px; /*ä¸Šä¸‹è¾¹æ¡†å¤§å°*/ border-radius: 26px; /*åœ†è§’å¤§å°*/ /*background-color: #ffffff; !*èƒŒæ™¯é¢œè‰²*!*/ text-align: center; font-size: 19px; /*å›¾æ ‡å¤§å°*/ line-height: 42px; /*å›¾æ ‡ä¸Šä¸‹è°ƒèŠ‚*/ color: var(--mobufan-hangneidaima); /*å›¾æ ‡é¢œè‰²*/ } /************************ é¦–é¡µæ ‡é¢˜ç¾åŒ– ************************/ /* è®¾ç½®ï¼ˆé¦–é¡µæ ‡é¢˜ï¼‰å­—ä½“å¤§å°ã€é¢œè‰²ã€è¡Œé«˜ç­‰ */ #post-info .post-title { color: var(--mobufan-white); /* é¦–é¡µæ ‡é¢˜ï¼ˆæ–‡å­—ï¼‰é¢œè‰² */ font-weight: normal; font-size: 2.0em; /* é¦–é¡µæ ‡é¢˜ï¼ˆæ–‡å­—ï¼‰å¤§å° */ line-height: 1.5; /* é¦–é¡µæ ‡é¢˜ï¼ˆä¸å‰¯æ ‡é¢˜ï¼‰é—´è·å¤§å° */ letter-spacing: 0px; /* é¦–é¡µæ ‡é¢˜ï¼ˆå­—ç¬¦ï¼‰é—´è·å¤§å° */ word-spacing: 0px; /* é¦–é¡µæ ‡é¢˜ï¼ˆå•è¯ï¼‰é—´è· */ /* ä»¥ä¸‹å±æ€§é…åˆå®ç°å¤šè¡Œæ–‡æœ¬æº¢å‡ºæ˜¾ç¤ºçœç•¥å· */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 3; overflow: hidden; text-overflow: ellipsis; } [data-theme=\u0026#34;dark\u0026#34;] #post-info .post-title { color: var(--mobufan-white); /* é¦–é¡µæ ‡é¢˜ï¼ˆæ–‡å­—ï¼‰é¢œè‰² */ } /* è®¾ç½®ï¼ˆé¦–é¡µå‰¯æ ‡é¢˜ï¼‰å­—ä½“å¤§å°ã€é¢œè‰²ã€è¡Œé«˜ç­‰ */ #post-meta .meta-firstline, #post-meta .meta-secondline { color: var(--mobufan-white); /* é¦–é¡µå‰¯æ ‡é¢˜ï¼ˆæ–‡å­—ï¼‰é¢œè‰² */ font-weight: normal; font-size: 1.2em; /* é¦–é¡µå‰¯æ ‡é¢˜ï¼ˆæ–‡å­—ï¼‰å¤§å° */ line-height: 1.5; /* é¦–é¡µå‰¯æ ‡é¢˜ï¼ˆä¸æ ‡é¢˜ï¼‰é—´è·å¤§å° */ letter-spacing: 0px; /* é¦–é¡µå‰¯æ ‡é¢˜ï¼ˆå­—ç¬¦ï¼‰é—´è·å¤§å° */ } /******************** æ–‡ç« tocç›®å½•ç¾åŒ– ********************/ /* ä¾§è¾¹æ å†…å®¹åŒºåŸŸä¸­çš„ç›®å½•å¡ç‰‡å†…å®¹æ ·å¼ */ #aside-content #card-toc .toc-content { margin: 8px 0px; /* è®¾ç½®å†…è¾¹è·å’Œå¤–è¾¹è· */ } /* ç›®å½•å¡ç‰‡å†…å®¹ ç›®å½•æ ·å¼ */ #aside-content #card-toc .toc-content .toc-link { line-height: 1.2; /* è®¾ç½®è¡Œé«˜ */ padding: 3px; /* è®¾ç½®å†…è¾¹è· */ border-left: 0px solid #88000000; /* è®¾ç½®å·¦è¾¹æ¡† */ border-radius: 19px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ font-size: 15px; /* è®¾ç½®å­—ä½“å¤§å° */ } /********* éæ´»æ€§ç›®å½•æ ·å¼ *********/ #aside-content #card-toc .toc-content .toc-link { color: var(--mobufan-white); /* æ—¥é—´æ¨¡å¼ï¼ˆç›®å½•å¡ç‰‡å†…å®¹ï¼‰æ–‡å­—é¢œè‰² */ } #aside-content #card-toc:hover .toc-content .toc-link:not(.active) span { filter: blur(0px); /* æ‚¬åœæ—¶ ç§»é™¤æ¨¡ç³Šæ•ˆæœ */ opacity: 1; /* æ‚¬åœæ—¶ è®¾ç½®å®Œå…¨ä¸é€æ˜ */ } #aside-content #card-toc .toc-content .toc-link:not(.active) span { opacity: 0.6; /* ç›®å½•å¡ç‰‡å†…å®¹è®¾ç½®(åŠé€æ˜) */ filter: blur(0.9px); /* ç›®å½•å¡ç‰‡å†…å®¹è®¾ç½®(è½»å¾®æ¨¡ç³Š)æ•ˆæœ */ transition: 0.3s; /* ç›®å½•å¡ç‰‡å†…å®¹è®¾ç½®(è¿‡æ¸¡æ•ˆæœ) */ } /********* æ´»æ€§ç›®å½•çŠ¶æ€æ ·å¼ *********/ /* é¼ æ ‡æ‚¬åœæ ·å¼ */ #aside-content #card-toc .toc-content .toc-link:not(.active) span:hover { line-height: 2.2; /* è®¾ç½®è¡Œé«˜ */ border-radius: 5px; /* æ‚¬åœæ—¶ åœ†è§’è¾¹æ¡† */ background-color: var(--mobufan-beijing); /* æ‚¬åœæ—¶ èƒŒæ™¯é¢œè‰² */ color: var(--mobufan-hangneidaima) ; /* æ‚¬åœæ—¶ æ–‡å­—é¢œè‰² */ font-weight: bold; /* è®¾ç½®å­—ä½“åŠ ç²— */ font-size: 18px; /* æ‚¬åœæ—¶ å­—ä½“å¤§å° */ } /* æµè§ˆåˆ°è¯¥ç›®å½•æ—¶çš„æ ·å¼*/ #aside-content #card-toc .toc-content .toc-link.active { line-height: 2.8; /* è®¾ç½®è¡Œé«˜ */ border-radius: 5px; /* è®¾ç½®åœ†è§’è¾¹æ¡† */ color: var(--mobufan-hangneidaima) ; /* æµè§ˆåˆ°è¯¥ç›®å½•æ—¶ æ–‡å­—é¢œè‰² */ background-color: var(--mobufan-beijing); /* æµè§ˆåˆ°è¯¥ç›®å½•æ—¶ è¾¹æ¡†èƒŒæ™¯é¢œè‰² */ font-weight: bold; /* è®¾ç½®å­—ä½“åŠ ç²— */ font-size: 22px; /* è®¾ç½®å­—ä½“å¤§å° */ } #aside-content #card-toc .toc-content .toc-item.active .toc-link { opacity: 1; /* å†…å®¹ä¸­æ´»æ€§ç›®å½•ï¼Œè®¾ç½®ä¸é€æ˜åº¦ */ border-radius: 15px; /* å†…å®¹ä¸­æ´»æ€§ç›®å½•ï¼Œè®¾ç½®åœ†è§’è¾¹æ¡† */ } /******************************** å…¨å±€è¶…é“¾æ¥é¢œè‰² *****************************/ /********* å…¨å±€è¶…é“¾æ¥é¢œè‰² *********/ #article-container a { color: var(--mobufan-hangneidaima) ; /* é»˜è®¤é¢œè‰² */ } #article-container a:hover { color: var(--mobufan-hangneidaima) ; /* æ‚¬åœé¢œè‰² */ text-decoration: underline ; /* å¼ºåˆ¶æ·»åŠ ä¸‹åˆ’çº¿ */ } /******************** é¦–é¡µæ–‡ç« æ ‡é¢˜ç¾åŒ– **********************/ /* é¦–é¡µæ–‡ç« æ ‡é¢˜å±…ä¸­æ˜¾ç¤º */ .article-title { text-align: center; /* é¦–é¡µæ–‡ç« æ ‡é¢˜å±…ä¸­æ˜¾ç¤º */ letter-spacing: 0px; /* é¦–é¡µæ–‡ç« æ ‡é¢˜ï¼ˆå­—ç¬¦ï¼‰é—´è·å¤§å° */ word-spacing: 0px; /* é¦–é¡µæ–‡ç« æ ‡é¢˜ï¼ˆå•è¯ï¼‰é—´è· */ } .article-title:hover { transform: scale(1.2); transition: transform 0.3s ease; } /*!********* æ–‡ç« å¡ç‰‡å°ºå¯¸è°ƒæ•´ *********!*/ /*#recent-posts .recent-post-item {*/ /* width: 99%; !* å®½åº¦ä¸ºçˆ¶å®¹å™¨çš„ 80% *!*/ /* height: 360vh; !* é«˜åº¦ä¸ºè§†å£é«˜åº¦çš„ 30% *!*/ /* max-width: 1600px; !* æœ€å¤§å®½åº¦é™åˆ¶ *!*/ /* max-height: 300px; !* æœ€å¤§é«˜åº¦é™åˆ¶ *!*/ /*}*/ /********************** é¼ æ ‡æ‚¬åœæ—¶å…ƒç´ ç¾åŒ– **********************/ /********** é¼ æ ‡æ‚¬åœæ—¶è¾¹æ¡†è£…é¥°çº¿ï¼ˆé¢œè‰²ï¼‰ **********/ .container img:hover, /* æ–‡ç« å›¾ç‰‡åœ†è§’ */ blockquote:hover, /* å¼•ç”¨æ ‡ç­¾ç¾åŒ– */ #rightside \u0026gt; div \u0026gt; button:hover, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œèœå• */ #to_comment .fas.fa-comments:hover, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œè¯„è®º */ .icon-V.hidden:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #go-down:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #go-up:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #hide-aside-btn:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #rightside-config:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ .aplayer.aplayer-fixed .aplayer-body:hover, /* éŸ³ä¹æ’­æ”¾å™¨ */ .tk-submit-action-icon:hover, /* è¯„è®ºè¡¨æƒ…ï¼š.tk-submit-action-icon */ .el-button.tk-send.el-button--primary.el-button--small.is-disabled:hover, /* è¯„è®ºå‘é€ */ .el-button.tk-preview.el-button--default.el-button--small:hover, /* è¯„è®ºé¢„è§ˆ */ #twikoo .tk-comments .tk-submit .tk-row .tk-col .tk-input.el-textarea .el-textarea__inner:hover, /* è¯„è®ºè¾“å…¥æ¡†ï¼š.tk-input.el-textarea */ .el-input.el-input--small.el-input-group.el-input-group--prepend:hover, /* è¯„è®ºé‚®ç®±+ç”¨æˆ·å */ #pagination .page-number:hover, /* æ–‡ç« åˆ†é¡µ2 */ #pagination .extend.next:hover, /* æ–‡ç« åˆ†é¡µ1 */ .pagination-related:hover, /* ç›¸å…³æ¨è */ #pagination .pagination-related:hover, /* ä¸‹ä¸€ç¯‡æ–‡ç«  */ .highlight:hover, /* ä»£ç æ¡† */ .search-dialog:hover, /* æœç´¢æ¡†1 */ .local-search-box--input:hover, /* æœç´¢æ¡†2 */ #tag:hover, /* æ ‡ç­¾å­é¡µé¢å¡ç‰‡ */ #category:hover, /* åˆ†ç±»å­é¡µé¢å¡ç‰‡ */ #recent-posts .recent-post-item:hover, /* é¦–é¡µæ–‡ç« å¡ç‰‡ */ #aside-content .card-widget:hover, /* é¦–é¡µä¾§æ å¡ç‰‡ */ div#post:hover, /* æ–‡ç« é¡µå¡ç‰‡ */ div#page:hover, /* æ™®é€šé¡µå¡ç‰‡*/ /* å½’æ¡£é¡µå¡ç‰‡ï¼šdiv#archive */ div#archive:hover { box-shadow: var(--mobufan-shadow-border) !important; /* æ·»åŠ é˜´å½±æ•ˆæœ */ } /********** é¼ æ ‡æ‚¬æµ®ï¼ˆå­—ä½“é˜´å½±ï¼‰æ•ˆæœ **********/ /* é¦–é¡µæ–‡ç« æ ‡é¢˜ï¼š.article-title */ .menus_item:hover, /*å¯¼èˆªæ ï¼ˆä¸»èœå•ï¼‰æ–‡å­—å›¾æ ‡*/ .site-name:hover, /* å¯¼èˆªæ èœå• */ .tag-cloud-list a:hover, /* ä¾¿ç­¾å¡ç‰‡ */ .site-data .headline:hover, /* ä¾§è¾¹æ -å¤´åƒå¡ç‰‡ */ .aside-list-item .title:hover, /* ä¾§è¾¹æ -æœ€è¿‘æ–‡ç«  */ .card-category-list-name:hover, /* ä¾§è¾¹æ -åˆ†ç±» */ .card-tag-cloud a:hover, /* ä¾§è¾¹æ -æ ‡ç­¾äº‘ */ #article-container a:hover, /* å…¨å±€è¶…é“¾æ¥ */ .article-title:hover { text-shadow: var(--mobufan-text-shadow) !important; /* ç›´æ¥å®šä¹‰é˜´å½±æ•ˆæœ */ } /********* é¼ æ ‡æ‚¬åœæ—¶ï¼ˆå…ƒç´ æ”¾å¤§ï¼‰æ•ˆæœ *********/ #rightside \u0026gt; div \u0026gt; a:hover, #rightside \u0026gt; div \u0026gt; button:hover, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œèœå• */ #to_comment .fas.fa-comments:hover, /* å³ä¸‹è§’æ˜æš—æ¨¡å¼ï¼Œè¯„è®º */ #pagination .page-number:hover, /* æ–‡ç« åˆ†é¡µæŒ‰é’®1 */ #pagination .extend.next:hover, /* æ–‡ç« åˆ†é¡µæŒ‰é’®2 */ .site-data .headline:hover, /* ä¾§è¾¹æ -å¤´åƒå¡ç‰‡ */ .aside-list-item .title:hover, /* ä¾§è¾¹æ -æœ€è¿‘æ–‡ç«  */ .card-tag-cloud a:hover, /* ä¾§è¾¹æ -æ ‡ç­¾äº‘ */ .card-category-list-name:hover, /* ä¾§è¾¹æ -åˆ†ç±» */ .icon-V.hidden:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #go-down:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #go-up:hover, /*å³ä¸‹è§’å¿«æ·èœå•*/ #hide-aside-btn:hover, /*å³ä¸‹è§’å¿«æ·èœå•,ä¸‹é¢çš„#rightside-configä¹Ÿæ˜¯*/ #rightside-config:hover { transform: scale(1.2); /* é¼ æ ‡æ‚¬åœæ—¶æ”¾å¤§æ•ˆæœ */ transition: transform 0.3s ease; } /*********************** å¼•ç”¨æ ‡ç­¾ç¾åŒ– **************************/ blockquote { border-left: 8px solid var(--mobufan-hangneidaima); /* å·¦è¾¹æ¡† */ padding: 0px 16px; /* å†…è¾¹è· */ font-size: 15px; /* å‡å°å­—ä½“å¤§å° */ margin: 18px 0px; /* å¤–è¾¹è· */ /*font-style: italic; !* æ–œä½“å­— *!*/ border-radius: 15px; /* åœ†è§’ */ background-color: var(--mobufan-beijing); /* å¤œé—´æ¨¡å¼èƒŒæ™¯é¢œè‰² */ backdrop-filter: var(--mobufan-backdrop-filter); /* ç£¨ç ‚æ•ˆæœï¼ˆæ¨¡ç³Š+é¥±å’Œåº¦ï¼‰ */ } blockquote p { margin: 1px 1; /* å‡å°‘ä¸Šä¸‹å¤–è¾¹è· */ padding: 10px 0; /* å‡å°‘ä¸Šä¸‹å†…è¾¹è· */ line-height: 2; /* å‡å°è¡Œé«˜ */ } blockquote p:first-child { margin-top: 0; /* ç¬¬ä¸€ä¸ªæ®µè½çš„é¡¶éƒ¨å¤–è¾¹è·ä¸º0 */ } blockquote p:last-child { margin-bottom: 0; /* æœ€åä¸€ä¸ªæ®µè½çš„åº•éƒ¨å¤–è¾¹è·ä¸º0 */ } /*********************** ä¿®æ”¹åˆ†ç±»å¡ç‰‡å¸ƒå±€ **************************/ li.card-archive-list-item,li.card-category-list-item { width: 100%; -webkit-box-flex: 1; -moz-box-flex: 1; -o-box-flex: 1; box-flex: 1; -webkit-flex: 0 0 48%; -ms-flex: 0 0 48%; flex: 0 0 48% } #aside-content .card-archives ul.card-archive-list\u0026gt;.card-archive-list-item a:hover,#aside-content .card-categories ul.card-category-list\u0026gt;.card-category-list-item a:hover { color: var(--mobufan-hangneidaima); /* é¼ æ ‡æ‚¬åœï¼Œæ–‡å­—é¢œè‰²*/ background-color: var(--mobufan-beijing) !important; /* é¼ æ ‡æ‚¬åœï¼Œå¡ç‰‡èƒŒæ™¯é¢œè‰²*/ border-radius: 8px; border: 1px solid var(--mobufan-shadow-border) !important; /* æ·»åŠ é˜´å½±æ•ˆæœ */ /* é¼ æ ‡æ‚¬åœï¼Œè¾¹æ¡†è½®å»“é¢œè‰²*/ } @media screen and (min-width: 1200px) { #aside-content .card-archives ul.card-archive-list\u0026gt;.card-archive-list-item a:active,#aside-content .card-categories ul.card-category-list\u0026gt;.card-category-list-item a:active { -webkit-transform:scale(.97); -moz-transform: scale(.97); -o-transform: scale(.97); -ms-transform: scale(.97); transform: scale(.97) } } #aside-content .card-archives ul.card-archive-list\u0026gt;.card-archive-list-item a,#aside-content .card-categories ul.card-category-list\u0026gt;.card-category-list-item a { border-radius: 8px; margin: 4px 0; display: -webkit-box; display: -moz-box; display: -webkit-flex; display: -ms-flexbox; display: box; display: flex; -webkit-box-orient: vertical; -moz-box-orient: vertical; -o-box-orient: vertical; -webkit-flex-direction: column; -ms-flex-direction: column; flex-direction: column; -ms-flex-line-pack: justify; -webkit-align-content: space-between; align-content: space-between; border: 1px solid #e3e8f7; } #aside-content .card-archives ul.card-archive-list\u0026gt;.card-archive-list-item a span:first-child,#aside-content .card-categories ul.card-category-list\u0026gt;.card-category-list-item a span:first-child { width: auto; -webkit-box-flex: inherit; -moz-box-flex: inherit; -o-box-flex: inherit; box-flex: inherit; -webkit-flex: inherit; -ms-flex: inherit; flex: inherit } #aside-content .card-archives ul.card-archive-list,#aside-content .card-categories ul.card-category-list { display: -webkit-box; display: -moz-box; display: -webkit-flex; display: -ms-flexbox; display: box; display: flex; -webkit-box-orient: horizontal; -moz-box-orient: horizontal; -o-box-orient: horizontal; -webkit-flex-direction: row; -ms-flex-direction: row; flex-direction: row; -webkit-box-pack: justify; -moz-box-pack: justify; -o-box-pack: justify; -ms-flex-pack: justify; -webkit-justify-content: space-between; justify-content: space-between; -webkit-box-lines: multiple; -moz-box-lines: multiple; -o-box-lines: multiple; -webkit-flex-wrap: wrap; -ms-flex-wrap: wrap; flex-wrap: wrap } /********** æœç´¢æ¡†ç¾åŒ– **********/ .local-search-box--input { height: 50px; /* æˆ–è€…ä½¿ç”¨å…¶ä»–å•ä½ï¼Œä¾‹å¦‚ height: 2.5rem; */ font-size: 18px; /* æ–‡å­—å¤§å° */ outline: none; /* å»æ‰èšç„¦æ—¶çš„é»˜è®¤è¾¹æ¡† */ transition: all 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœï¼Œä½¿å˜åŒ–æ›´å¹³æ»‘ */ } hr { display: none; /* éšè—æœç´¢æ¡†ä¸‹é¢çš„åˆ†å‰²çº¿ */ } /********** æ˜æš—æ¨¡å¼+æœç´¢æŒ‰é’®ï¼ˆå¤§å°ä¸Šä¸‹è°ƒèŠ‚ï¼‰ **********/ .site-page.social-icon.search .faa-tada.icon { height: 40px !important; /* é«˜åº¦å’Œå®½åº¦ */ /* æœç´¢æŒ‰é’® */ width: 40px !important; /* é«˜åº¦å’Œå®½åº¦ */ margin-top: 7px !important; /* å‘ä¸‹ç§»åŠ¨10px */ margin-left: 2px !important; /* å‘å³ç§»åŠ¨10px */ /* æˆ–è€… */ margin-bottom: 0px !important; /* å‘ä¸Šç§»åŠ¨10px */ margin-right: 8px !important; /* å‘å·¦ç§»åŠ¨10px */ } .sun_moon.faa-parent.animated-hover .faa-tada { height: 32px !important; /* é«˜åº¦å’Œå®½åº¦ */ /* æ˜æš—æ¨¡å¼æŒ‰é’® */ width: 32px !important; /* é«˜åº¦å’Œå®½åº¦ */ margin-top: 0px !important; /* å‘ä¸‹ç§»åŠ¨10px */ margin-left: 0px !important; /* å‘å³ç§»åŠ¨10px */ /* æˆ–è€… */ margin-bottom: 1px !important; /* å‘ä¸Šç§»åŠ¨10px */ margin-right: 4px !important; /* å‘å·¦ç§»åŠ¨10px */ } #toggle-menu .site-page .site-page.faa-parent.animated-hover .faa-tada { height: 30px !important; /* é«˜åº¦å’Œå®½åº¦ */ /* æ‰‹æœºç«¯èœå•æŒ‰é’® */ width: 30px !important; /* é«˜åº¦å’Œå®½åº¦ */ margin-top: 9px !important; /* å‘ä¸‹ç§»åŠ¨10px */ margin-left: 0px !important; /* å‘å³ç§»åŠ¨10px */ /* æˆ–è€… */ margin-bottom: 0px !important; /* å‘ä¸Šç§»åŠ¨10px */ margin-right: 0px !important; /* å‘å·¦ç§»åŠ¨10px */ } /**************************** é¡µé¢ç¾åŒ– **********************************/ ğŸ“Œ å¸¸é©»å¯¼èˆªæ  åœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­ä¿®æ”¹ä¸ºï¼š 1 2 nav: fixed: true # å›ºå®šå¯¼èˆªæ  ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸš€ åå››ã€CDNåŠ é€Ÿé…ç½® âœ¨ åŠŸèƒ½ç‰¹ç‚¹ é€šè¿‡CDNåŠ é€Ÿé™æ€èµ„æºåŠ è½½ï¼Œæå‡ç½‘ç«™è®¿é—®é€Ÿåº¦ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚\nğŸ”§ é…ç½®æ–¹æ³• ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„CDNè®¾ç½®ï¼š\nä¸»é¢˜é»˜è®¤çš„CDNæœ‰ï¼šlocalã€cdnjsã€jsdelivrã€unpkgç­‰ï¼Œä½†æ˜¯é€Ÿåº¦å¶è¯»æ¯”è¾ƒä¸€èˆ¬ï¼Œè¦æƒ³æé«˜éƒ¨åˆ†æ ‡å‡†é™æ€èµ„æºçš„å“åº”é€Ÿåº¦ï¼Œèµ°CDNæ˜¯æœ€å¥½çš„åŠæ³•ï¼Œæœ€å¥½æ˜¯åœ¨å›½å†…çš„CDNã€‚ å‚è€ƒæ•™ç¨‹ï¼š\nCSDNï¼šWebå‰ç«¯å¸¸ç”¨CDNç½‘ç«™æ±‡æ€» æ´ªå“¥ï¼šButterfly CDNé“¾æ¥æ›´æ”¹æŒ‡å—ï¼Œæ›¿æ¢jsdelivræå‡è®¿é—®é€Ÿåº¦ å®‰çŸ¥é±¼ï¼šç›®å‰å¯ç”¨cdnæ•´ç† ä¿®æ”¹æ•™ç¨‹ï¼Œæˆ‘åˆ†äº«ä¸€ä¸‹æˆ‘ç›®å‰åœ¨ç”¨çš„æ–¹æ¡ˆï¼š\nä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶_config.butterfly.ymlçš„CDNé…ç½®é¡¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 # CDN # Don\u0026#39;t modify the following settings unless you know how they work # éå¿…è¦è«‹ä¸è¦ä¿®æ”¹ CDN: # The CDN provider of internal scripts (ä¸»é¡Œå…§éƒ¨ js çš„ cdn é…ç½®) # option: local/jsdelivr/unpkg/cdnjs/custom # Dev version can only choose. ( devç‰ˆçš„ä¸»é¡Œåªèƒ½è¨­ç½®ç‚º local ) internal_provider: local # The CDN provider of third party scripts (ç¬¬ä¸‰æ–¹ js çš„ cdn é…ç½®) # option: local/jsdelivr/unpkg/cdnjs/custom # when set it to local, you need to install hexo-butterfly-extjs third_party_provider: cdnjs # Add version number to CDN, true or false version: false # Custom format # For example: https://cdn.staticfile.org/${cdnjs_name}/${version}/${min_cdnjs_file} custom_format: option: # main_css: # main: # utils: # translate: https://cdn1.tianli0.top/npm/js-heo@1.0.6/translate/tw_cn.js # local_search: # algolia_js: algolia_search_v4: https://cdn.staticfile.org/algoliasearch/4.14.3/algoliasearch-lite.umd.min.js instantsearch_v4: https://cdn.staticfile.org/instantsearch.js/4.49.2/instantsearch.production.min.js pjax: https://lib.baomitu.com/pjax/0.2.8/pjax.min.js # gitalk: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.js # gitalk_css: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/gitalk/1.7.2/gitalk.min.css # blueimp_md5: # valine: https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.16/Valine.min.js # disqusjs: https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/disqusjs/1.3.0/disqus.js # disqusjs_css: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/disqusjs/1.3.0/disqusjs.css twikoo: https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js # waline_js: https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/waline/1.5.4/Waline.min.js # waline_css: sharejs: https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js sharejs_css: https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css # mathjax: https://cdn.staticfile.org/mathjax/3.2.2/es5/mml-chtml.min.js # katex: https://lib.baomitu.com/KaTeX/latest/katex.min.css # katex_copytex: # mermaid: # canvas_ribbon: # canvas_fluttering_ribbon: # canvas_nest: lazyload: https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js instantpage: https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js typed: https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/typed.js/2.0.12/typed.min.js # pangu: fancybox_css_v4: https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css fancybox_v4: https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js # medium_zoom: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/medium-zoom/1.0.6/medium-zoom.min.js # snackbar_css: https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css # snackbar: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js # activate_power_mode: # fireworks: # click_heart: # ClickShowText: fontawesomeV6: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css # flickr_justified_gallery_js: https://cdn.staticfile.org/flickr-justified-gallery/2.1.2/fjGallery.min.js # flickr_justified_gallery_css: https://cdn.staticfile.org/flickr-justified-gallery/2.1.2/fjGallery.min.css aplayer_css: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css aplayer_js: https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js meting_js: https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js # prismjs_js: https://cdn1.tianli0.top/npm/prismjs@1.1.0/prism.js # prismjs_lineNumber_js: https://cdn1.tianli0.top/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js # prismjs_autoloader: https://cdn1.tianli0.top/npm/prismjs/plugins/autoloader/prism-autoloader.min.js ä¿®æ”¹å®Œæˆåå¯ä»¥ f12-\u0026gt;æºä»£ç -\u0026gt;ç½‘é¡µ çœ‹çœ‹æ˜¯å¦å·²ç»åŠ è½½åˆ°å¯¹åº”çš„èµ„æº\nğŸ˜º åäº”ã€æŒ‚ç»³å°çŒ«å’ªç‰¹æ•ˆ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ æ·»åŠ å¯çˆ±çš„å°çŒ«å’ªæŒ‚ç»³ç‰¹æ•ˆï¼Œéšé¡µé¢æ»šåŠ¨è€ŒåŠ¨ï¼Œå¢åŠ ç½‘ç«™è¶£å‘³æ€§ã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â• æ·»åŠ HTMLç»“æ„ åˆ¶ä½œä¸€ä¸ªç››æ”¾å†…å®¹çš„ç›’å­ï¼Œåœ¨[BlogRoot]/node_modules/hexo-theme-butterfly/layout/includes/head.pug(å¦‚æœæ˜¯git clone å®‰è£…åœ¨[BlogRoot]/themes/butterfly/layout/includes/head.pug)æœ€åä¸€è¡ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼š 1 2 //- æŒ‚ç»³å°çŒ«å’ª #myscoll 2. â• åˆ›å»ºJavaScripté€»è¾‘ å…¶å®éšä¾¿æ”¾åœ¨å“ªé‡Œéƒ½è¡Œï¼Œåªè¦èƒ½åŠ è½½å‡ºæ¥å°±è¡Œ åœ¨[BlogRoot]/node_modules/hexo-theme-butterfly/source/jsæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªcat.jsï¼Œå°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 if (document.body.clientWidth \u0026gt; 992) { function getBasicInfo() { /* çª—å£é«˜åº¦ */ var ViewH = $(window).height(); /* documenté«˜åº¦ */ var DocH = $(\u0026#34;body\u0026#34;)[0].scrollHeight; /* æ»šåŠ¨çš„é«˜åº¦ */ var ScrollTop = $(window).scrollTop(); /* å¯æ»šåŠ¨çš„é«˜åº¦ */ var S_V = DocH - ViewH; var Band_H = ScrollTop / (DocH - ViewH) * 100; return { ViewH: ViewH, DocH: DocH, ScrollTop: ScrollTop, Band_H: Band_H, S_V: S_V } }; function show(basicInfo) { if (basicInfo.ScrollTop \u0026gt; 0.001) { $(\u0026#34;.neko\u0026#34;).css(\u0026#39;display\u0026#39;, \u0026#39;block\u0026#39;); } else { $(\u0026#34;.neko\u0026#34;).css(\u0026#39;display\u0026#39;, \u0026#39;none\u0026#39;); } } (function ($) { $.fn.nekoScroll = function (option) { var defaultSetting = { top: \u0026#39;0\u0026#39;, scroWidth: 6 + \u0026#39;px\u0026#39;, z_index: 9999, zoom: 0.9, borderRadius: 5 + \u0026#39;px\u0026#39;, right: 60 + \u0026#39;px\u0026#39;, // è¿™é‡Œå¯ä»¥æ¢ä¸ºä½ å–œæ¬¢çš„å›¾ç‰‡ï¼Œä¾‹å¦‚æˆ‘å°±æ¢ä¸ºäº†é›ªäººï¼Œä½†æ˜¯è¦æŠ å›¾ nekoImg: \u0026#34;https://bu.dusays.com/2022/07/20/62d812db74be9.png\u0026#34;, hoverMsg: \u0026#34;å–µå–µå–µ~\u0026#34;, color: \u0026#34;#6f42c1\u0026#34;, during: 500, blog_body: \u0026#34;body\u0026#34;, }; var setting = $.extend(defaultSetting, option); var getThis = this.prop(\u0026#34;className\u0026#34;) !== \u0026#34;\u0026#34; ? \u0026#34;.\u0026#34; + this.prop(\u0026#34;className\u0026#34;) : this.prop(\u0026#34;id\u0026#34;) !== \u0026#34;\u0026#34; ? \u0026#34;#\u0026#34; + this.prop(\u0026#34;id\u0026#34;) : this.prop(\u0026#34;nodeName\u0026#34;); if ($(\u0026#34;.neko\u0026#34;).length == 0) { this.after(\u0026#34;\u0026lt;div class=\\\u0026#34;neko\\\u0026#34; id=\u0026#34; + setting.nekoname + \u0026#34; data-msg=\\\u0026#34;\u0026#34; + setting.hoverMsg + \u0026#34;\\\u0026#34;\u0026gt;\u0026lt;/div\u0026gt;\u0026#34;); } let basicInfo = getBasicInfo(); $(getThis) .css({ \u0026#39;position\u0026#39;: \u0026#39;fixed\u0026#39;, \u0026#39;width\u0026#39;: setting.scroWidth, \u0026#39;top\u0026#39;: setting.top, \u0026#39;height\u0026#39;: basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 + \u0026#39;px\u0026#39;, \u0026#39;z-index\u0026#39;: setting.z_index, \u0026#39;background-color\u0026#39;: setting.bgcolor, \u0026#34;border-radius\u0026#34;: setting.borderRadius, \u0026#39;right\u0026#39;: setting.right, \u0026#39;background-image\u0026#39;: \u0026#39;url(\u0026#39; + setting.scImg + \u0026#39;)\u0026#39;, \u0026#39;background-image\u0026#39;: \u0026#39;-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent)\u0026#39;, \u0026#39;border-radius\u0026#39;: \u0026#39;2em\u0026#39;, \u0026#39;background-size\u0026#39;: \u0026#39;contain\u0026#39; }); $(\u0026#34;#\u0026#34; + setting.nekoname) .css({ \u0026#39;position\u0026#39;: \u0026#39;fixed\u0026#39;, \u0026#39;top\u0026#39;: basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 - 50 + \u0026#39;px\u0026#39;, \u0026#39;z-index\u0026#39;: setting.z_index * 10, \u0026#39;right\u0026#39;: setting.right, \u0026#39;background-image\u0026#39;: \u0026#39;url(\u0026#39; + setting.nekoImg + \u0026#39;)\u0026#39;, }); show(getBasicInfo()); $(window) .scroll(function () { let basicInfo = getBasicInfo(); show(basicInfo); $(getThis) .css({ \u0026#39;position\u0026#39;: \u0026#39;fixed\u0026#39;, \u0026#39;width\u0026#39;: setting.scroWidth, \u0026#39;top\u0026#39;: setting.top, \u0026#39;height\u0026#39;: basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 + \u0026#39;px\u0026#39;, \u0026#39;z-index\u0026#39;: setting.z_index, \u0026#39;background-color\u0026#39;: setting.bgcolor, \u0026#34;border-radius\u0026#34;: setting.borderRadius, \u0026#39;right\u0026#39;: setting.right, \u0026#39;background-image\u0026#39;: \u0026#39;url(\u0026#39; + setting.scImg + \u0026#39;)\u0026#39;, \u0026#39;background-image\u0026#39;: \u0026#39;-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent)\u0026#39;, \u0026#39;border-radius\u0026#39;: \u0026#39;2em\u0026#39;, \u0026#39;background-size\u0026#39;: \u0026#39;contain\u0026#39; }); $(\u0026#34;#\u0026#34; + setting.nekoname) .css({ \u0026#39;position\u0026#39;: \u0026#39;fixed\u0026#39;, \u0026#39;top\u0026#39;: basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 - 50 + \u0026#39;px\u0026#39;, \u0026#39;z-index\u0026#39;: setting.z_index * 10, \u0026#39;right\u0026#39;: setting.right, \u0026#39;background-image\u0026#39;: \u0026#39;url(\u0026#39; + setting.nekoImg + \u0026#39;)\u0026#39;, }); if (basicInfo.ScrollTop == basicInfo.S_V) { $(\u0026#34;#\u0026#34; + setting.nekoname) .addClass(\u0026#34;showMsg\u0026#34;) } else { $(\u0026#34;#\u0026#34; + setting.nekoname) .removeClass(\u0026#34;showMsg\u0026#34;); $(\u0026#34;#\u0026#34; + setting.nekoname) .attr(\u0026#34;data-msg\u0026#34;, setting.hoverMsg); } }); this.click(function (e) { btf.scrollToDest(0, 500) }); $(\u0026#34;#\u0026#34; + setting.nekoname) .click(function () { btf.scrollToDest(0, 500) }); return this; } })(jQuery); $(document).ready(function () { //éƒ¨åˆ†è‡ªå®šä¹‰ $(\u0026#34;#myscoll\u0026#34;).nekoScroll({ bgcolor: \u0026#39;rgb(0 0 0 / .5)\u0026#39;, //èƒŒæ™¯é¢œè‰²ï¼Œæ²¡æœ‰ç»³å­èƒŒæ™¯å›¾ç‰‡æ—¶æœ‰æ•ˆ borderRadius: \u0026#39;2em\u0026#39;, zoom: 0.9 } ); //è‡ªå®šä¹‰ï¼ˆå»æ‰ä»¥ä¸‹æ³¨é‡Šï¼Œå¹¶æ³¨é‡Šæ‰å…¶ä»–çš„æŸ¥çœ‹æ•ˆæœï¼‰ /* $(\u0026#34;#myscoll\u0026#34;).nekoScroll({ nekoname:\u0026#39;neko1\u0026#39;, //nekonameï¼Œç›¸å½“äºid nekoImg:\u0026#39;img/çŒ«å’ª.png\u0026#39;, //nekoçš„èƒŒæ™¯å›¾ç‰‡ scImg:\u0026#34;img/ç»³1.png\u0026#34;, //ç»³å­çš„èƒŒæ™¯å›¾ç‰‡ bgcolor:\u0026#39;#1e90ff\u0026#39;, //èƒŒæ™¯é¢œè‰²ï¼Œæ²¡æœ‰ç»³å­èƒŒæ™¯å›¾ç‰‡æ—¶æœ‰æ•ˆ zoom:0.9, //ç»³å­é•¿åº¦çš„ç¼©æ”¾å€¼ hoverMsg:\u0026#39;ä½ å¥½~å–µ\u0026#39;, //é¼ æ ‡æµ®åŠ¨åˆ°nekoä¸Šæ–¹çš„å¯¹è¯æ¡†ä¿¡æ¯ right:\u0026#39;100px\u0026#39;, //è·ç¦»é¡µé¢å³è¾¹çš„è·ç¦» fontFamily:\u0026#39;æ¥·ä½“\u0026#39;, //å¯¹è¯æ¡†å­—ä½“ fontSize:\u0026#39;14px\u0026#39;, //å¯¹è¯æ¡†å­—ä½“çš„å¤§å° color:\u0026#39;#1e90ff\u0026#39;, //å¯¹è¯æ¡†å­—ä½“é¢œè‰² scroWidth:\u0026#39;8px\u0026#39;, //ç»³å­çš„å®½åº¦ z_index:100, //ä¸ç”¨è§£é‡Šäº†å§ during:1200, //ä»é¡¶éƒ¨åˆ°åº•éƒ¨æ»‘åŠ¨çš„æ—¶é•¿ }); */ }) } 3. â• æ·»åŠ æ ·å¼è®¾è®¡ åœ¨[BlogRoot]/node_modules/hexo-theme-butterfly/source/cssæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªcat.cssï¼Œå°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸æ–°å»º css æ–‡ä»¶ï¼Œå¤åˆ¶ä»£ç åˆ°custom.cssä¹Ÿè¡Œï¼Œæ€»ä¹‹æœ‰åœ°æ–¹å¼•å…¥å°±è¡Œã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 body::-webkit-scrollbar { width: 0; } .neko { width: 64px; height: 64px; background-image: url(\u0026#34;https://bu.dusays.com/2022/07/20/62d812db74be9.png\u0026#34;); position: absolute; right: 32px; background-repeat: no-repeat; background-size: contain; transform: translateX(50%); cursor: pointer; font-family: tzy; font-weight: 600; font-size: 16px; color: #6f42c1; display: none; } .neko::after { display: none; width: 100px; height: 100px; background-image: url(\u0026#34;https://bu.dusays.com/2022/07/20/62d812d95e6f5.png\u0026#34;); background-size: contain; z-index: 9999; position: absolute; right: 50%; text-align: center; line-height: 100px; top: -115%; } .neko.showMsg::after { content: attr(data-msg); display: block; overflow: hidden; text-overflow: ellipsis; } .neko:hover::after { content: attr(data-msg); display: block; overflow: hidden; text-overflow: ellipsis; } .neko.fontColor::after { color: #333; } /** * @description: æ»šåŠ¨æ¡æ ·å¼ è·ŸçŒ«äºŒé€‰ä¸€ */ @media screen and (max-width:992px) { ::-webkit-scrollbar { width: 8px !important; height: 8px !important } ::-webkit-scrollbar-track { border-radius: 2em; } ::-webkit-scrollbar-thumb { background-color: rgb(255 255 255 / .3); background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent); border-radius: 2em } ::-webkit-scrollbar-corner { background-color: transparent } } åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶_config.butterfly.ymlä¸­å¼•å…¥cat.jså’Œcat.cssï¼Œå½“ç„¶è¿˜æœ‰åœ¨bottomçš„æœ€å‰é¢å¼•å…¥jQueryï¼Œå› ä¸ºcat.jsçš„è¯­æ³•ä¾èµ–jQueryã€‚\n1 2 3 4 5 6 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/cat.css\u0026#34;\u0026gt; bottom: - \u0026lt;script defer src=\u0026#34;https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; - \u0026lt;script defer data-pjax src=\u0026#34;/js/cat.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 4. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s ğŸ›¡ï¸ åå…­ã€ç¦ç”¨F12ä¿æŠ¤ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ æ·»åŠ ç®€å•çš„ä¿æŠ¤æªæ–½ï¼Œé˜²æ­¢ç”¨æˆ·é€šè¿‡F12æŸ¥çœ‹æºç ï¼Œå¢å¼ºå†…å®¹å®‰å…¨æ€§ã€‚\nğŸ”§ å®ç°æ–¹æ³• æ·»åŠ ä¿æŠ¤ä»£ç åˆ°æ¨¡æ¿æ–‡ä»¶ï¼š\nä¿®æ”¹[BlogRoot]/node_modules/hexo-theme-butterfly/layout/includes/layout.pugï¼Œæ ¹æ®å›¾ä¸­ä½ç½®æ·»åŠ ä»¥ä¸‹ pug ä»£ç ï¼ˆè·Ÿ headã€bodyåŒçº§ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 script. ((function() {var callbacks = [],timeLimit = 50,open = false;setInterval(loop, 1);return {addListener: function(fn) {callbacks.push(fn);},cancleListenr: function(fn) {callbacks = callbacks.filter(function(v) {return v !== fn;});}} function loop() {var startTime = new Date();debugger;if (new Date() - startTime \u0026gt; timeLimit) {if (!open) {callbacks.forEach(function(fn) {fn.call(null);});}open = true;window.stop();alert(\u0026#39;ä½ çœŸåï¼Œè¯·å…³é—­æ§åˆ¶å°ï¼\u0026#39;);document.body.innerHTML = \u0026#34;\u0026#34;;} else {open = false;}}})()).addListener(function() {window.location.reload();}); script. function toDevtools(){ let num = 0; let devtools = new Date(); devtools.toString = function() { num++; if (num \u0026gt; 1) { alert(\u0026#39;ä½ çœŸåï¼Œè¯·å…³é—­æ§åˆ¶å°ï¼\u0026#39;) window.location.href = \u0026#34;about:blank\u0026#34; blast(); } } console.log(\u0026#39;\u0026#39;, devtools); } toDevtools(); å°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°è‡ªå®šä¹‰çš„f12.jsï¼Œéšååœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶çš„inject-\u0026gt;bottomä¸­å¼•å…¥è¯¥jsæ–‡ä»¶ 1 2 3 document.onkeydown = function (e) { if (123 == e.keyCode || (e.ctrlKey \u0026amp;\u0026amp; e.shiftKey \u0026amp;\u0026amp; (74 === e.keyCode || 73 === e.keyCode || 67 === e.keyCode)) || (e.ctrlKey \u0026amp;\u0026amp; 85 === e.keyCode)) return btf.snackbarShow(\u0026#34;ä½ çœŸåï¼Œä¸èƒ½æ‰“å¼€æ§åˆ¶å°å–”!\u0026#34;), event.keyCode = 0, event.returnValue = !1, !1 }; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s **æ³¨æ„ï¼š**å¦‚æœè‡ªå·±è°ƒè¯•é˜¶æ®µï¼Œå¯æ³¨é‡Šç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥ä¸­çš„ä»£ç ï¼Œå†è¿›è¡Œç¼–è¯‘ï¼Œå°±å¯ä»¥æ‰“å¼€æ§åˆ¶å°äº†ã€‚éƒ¨ç½²æ—¶æ”¾å¼€æ³¨é‡Šï¼Œç¼–è¯‘å¥½å†ä¸¢ä¸Šå»å°±OKäº†\nğŸ‘ï¸ åä¸ƒã€å†™è½®çœ¼åŠ è½½åŠ¨ç”» âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä½¿ç”¨å†™è½®çœ¼åŠ¨ç”»ä½œä¸ºé¡µé¢åŠ è½½æŒ‡ç¤ºå™¨ï¼Œæ›¿ä»£é»˜è®¤åŠ è½½åŠ¨ç”»ï¼Œå¢åŠ ä¸ªæ€§åŒ–å…ƒç´ ã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â• åˆ›å»ºåŠ è½½åŠ¨ç”»ç»„ä»¶ åˆ›å»ºåšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\custom\\sharingan.pug 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 div.loading div.bg div.scale div.sharingon div.ring div.to div.to div.to div.circle style. [data-scheme=\u0026#34;light\u0026#34;] { .loading { background-color: rgba(245, 245, 250, 0.8); } } [data-scheme=\u0026#34;dark\u0026#34;] { .loading { background-color: rgba(48, 48, 48, 0.8); } } .loading { position: fixed; display: flex; justify-content: center; align-items: center; top: 0; left: 0; width: 100%; height: 100%; z-index: 99; zoom: 3.0; } .sharingon { position: relative; width: 6em; height: 6em; background-color: red; border: 6px solid black; animation: rot 1s ease-in-out infinite; } .animated-stop { animation-play-state: paused; } .fadeout { animation: fadeOut 1.5s forwards; } .scaleAndFadeout { animation: scaleAndFadeOut 1.5s forwards } .ring { position: absolute; content: \u0026#34;\u0026#34;; left: 50%; top: 50%; width: 3.5em; height: 3.5em; border: 4px solid rgb(110, 13 ,13 ,0.5); transform: translate(-50%,-50%); } .sharingon, .ring, .to,.circle { border-radius: 50%; } .to,.circle { position: absolute; content: \u0026#34;\u0026#34;; width: 0.9em; height: 0.9em; background-color: black; } .to:nth-child(1) { top: -0.5em; left: 50%; transform: translate(-40%); } .to::before { content: \u0026#34;\u0026#34;; position: absolute; top: -0.5em; right: -0.2em; width: 1.1em; height: 0.9em; box-sizing: border-box; border-left: 16px solid black; border-radius: 100% 0 0; } .to:nth-child(2) { bottom: 0.5em; left: -0.35em; transform: rotate(-120deg); } .to:nth-child(3) { bottom: 0.5em; right: -0.35em; transform: rotate(120deg); } .circle { top: 50%; left: 50%; transform: translate(-50%,-50%); box-shadow: 0 0 20px 1px; width: 1em; height: 1em; } @keyframes rot { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } @keyframes scaleAndFadeOut { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } } @keyframes fadeOut { 0% { opacity: 1; } 100% { opacity: 0; } } script. function initLoading() { const startTime = Date.now(); let loading = document.querySelector(\u0026#34;.loading\u0026#34;); document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, function() { const timeDelay = Date.now() - startTime; setTimeout(() =\u0026gt; { fadeOut(); setTimeout(() =\u0026gt; { loading.style.display = \u0026#34;none\u0026#34;; }, 1500) }, timeDelay \u0026gt; 1050 ? 0 : 1050 - timeDelay) }); } function fadeOut() { let sharingon = document.querySelector(\u0026#34;.sharingon\u0026#34;); sharingon.classList.add(\u0026#34;animated-stop\u0026#34;); let scale = document.querySelector(\u0026#34;.scale\u0026#34;); scale.classList.add(\u0026#34;scaleAndFadeout\u0026#34;); let loading = document.querySelector(\u0026#34;.loading\u0026#34;); loading.classList.add(\u0026#34;fadeout\u0026#34;); } initLoading(); 2. â• å¼•ç”¨ sharingan.pug ä¿®æ”¹åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\layout\\includes\\head.pug 1 include ./custom/sharingan.pug 3. ğŸ’« é…ç½®åŠ è½½åŠ¨ç”»æ›¿æ¢ ä¿®æ”¹_config.butterfly.yml 1 2 3 4 # åŠ è½½åŠ¨ç”» preloader: enable: false # å…³é—­åŠ è½½åŠ¨ç”» source: 1 4. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s â° åå…«ã€é¡µè„šå¾½æ ‡å’Œè®¡æ—¶å™¨ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ åœ¨é¡µè„šæ·»åŠ ç½‘ç«™ä¿¡æ¯å¾½æ ‡å’Œè¿è¡Œæ—¶é—´è®¡æ—¶å™¨ï¼Œå±•ç¤ºæŠ€æœ¯æ ˆå’Œç½‘ç«™è¿è¡ŒçŠ¶æ€ã€‚\nğŸ”§ å®‰è£…æ’ä»¶ 1 npm install hexo-butterfly-footer-beautify --save âš™ï¸ é…ç½®ç¤ºä¾‹ åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶_config.butterfly.ymlä¸­æ·»åŠ é…ç½®é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # footer_beautify # é¡µè„šè®¡æ—¶å™¨ï¼š[Native JS Timer](https://akilar.top/posts/b941af/) # é¡µè„šå¾½æ ‡ï¼š[Add Github Badge](https://akilar.top/posts/e87ad7f8/) footer_beautify: enable: timer: true # è®¡æ—¶å™¨å¼€å…³ bdage: true # å¾½æ ‡å¼€å…³ priority: 5 #è¿‡æ»¤å™¨ä¼˜å…ˆæƒ enable_page: all # åº”ç”¨é¡µé¢ exclude: # - /posts/ # - /about/ layout: # æŒ‚è½½å®¹å™¨ç±»å‹ type: id name: footer-wrap index: 0 # è®¡æ—¶å™¨éƒ¨åˆ†é…ç½®é¡¹ runtime_js: /js/runtime.js runtime_css: /css/runtime.css # å¾½æ ‡éƒ¨åˆ†é…ç½®é¡¹ swiperpara: 0 #è‹¥é0ï¼Œåˆ™å¼€å¯è½®æ’­åŠŸèƒ½ï¼Œæ¯è¡Œå¾½æ ‡ä¸ªæ•° bdageitem: - link: https://hexo.io/ #å¾½æ ‡æŒ‡å‘ç½‘ç«™é“¾æ¥ shields: https://img.shields.io/badge/Frame-Hexo-blue?style=flat\u0026amp;logo=hexo #å¾½æ ‡API message: åšå®¢æ¡†æ¶ä¸ºHexo_v7.1.0 #å¾½æ ‡æç¤ºè¯­ - link: https://butterfly.js.org/ shields: https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat\u0026amp;logo=bitdefender message: ä¸»é¢˜ç‰ˆæœ¬Butterfly_v5.3.5 - link: https://www.jsdelivr.com/ shields: https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat\u0026amp;logo=jsDelivr message: æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ - link: https://github.com/ shields: https://img.shields.io/badge/Source-Github-d021d6?style=flat\u0026amp;logo=GitHub message: æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡ åˆ›å»º åšå®¢æ ¹ç›®å½•/source/js/runtime.js\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 /* é¡µè„šè®¡æ—¶å™¨ start */ var now = new Date(); function createtime() { // å½“å‰æ—¶é—´ now.setTime(now.getTime() + 1000); var start = new Date(\u0026#34;01/01/2025 00:00:00\u0026#34;); // æ—…è¡Œè€…1å·å¼€å§‹è®¡ç®—çš„æ—¶é—´ var dis = Math.trunc(23400000000 + ((now - start) / 1000) * 17); // è·ç¦»=ç§’æ•°*é€Ÿåº¦ è®°ä½è½¬æ¢æ¯«ç§’ var unit = (dis / 149600000).toFixed(6); // å¤©æ–‡å•ä½ // ç½‘ç«™è¯ç”Ÿæ—¶é—´ var grt = new Date(\u0026#34;08/09/2022 00:00:00\u0026#34;); var days = (now - grt) / 1e3 / 60 / 60 / 24, dnum = Math.floor(days), hours = (now - grt) / 1e3 / 60 / 60 - 24 * dnum, hnum = Math.floor(hours); 1 == String(hnum).length \u0026amp;\u0026amp; (hnum = \u0026#34;0\u0026#34; + hnum); var minutes = (now - grt) / 1e3 / 60 - 1440 * dnum - 60 * hnum, mnum = Math.floor(minutes); 1 == String(mnum).length \u0026amp;\u0026amp; (mnum = \u0026#34;0\u0026#34; + mnum); var seconds = (now - grt) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum, snum = Math.round(seconds); 1 == String(snum).length \u0026amp;\u0026amp; (snum = \u0026#34;0\u0026#34; + snum); let currentTimeHtml = \u0026#34;\u0026#34;; (currentTimeHtml = hnum \u0026lt; 18 \u0026amp;\u0026amp; hnum \u0026gt;= 9 ? `\u0026lt;img class=\u0026#39;boardsign\u0026#39; src=\u0026#39;https://cdn.meimolihan.eu.org/hexo/img/å¢¨ä¸å‡¡-æ¬ç –ä¸­.svg\u0026#39; title=\u0026#39;ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿå®ç°è´¢å¯Œè‡ªç”±å‘€~\u0026#39;\u0026gt;\u0026lt;br\u0026gt; \u0026lt;div style=\u0026#34;font-size:13px;font-weight:bold\u0026#34;\u0026gt;æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${dnum} å¤© ${hnum} å°æ—¶ ${mnum} åˆ† ${snum} ç§’ \u0026lt;i id=\u0026#34;heartbeat\u0026#34; class=\u0026#39;fas fa-heartbeat\u0026#39;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;br\u0026gt; æ—…è¡Œè€… 1 å·å½“å‰è·ç¦»åœ°çƒ ${dis} åƒç±³ï¼Œçº¦ä¸º ${unit} ä¸ªå¤©æ–‡å•ä½ ğŸš€\u0026lt;/div\u0026gt;` : `\u0026lt;img class=\u0026#39;boardsign\u0026#39; src=\u0026#39;https://cdn.meimolihan.eu.org/hexo/img/å¢¨ä¸å‡¡-ä¼‘é—²ä¸­.svg\u0026#39; title=\u0026#39;ä¸‹ç­äº†å°±è¯¥å¼€å¼€å¿ƒå¿ƒåœ°ç©è€~\u0026#39;\u0026gt;\u0026lt;br\u0026gt; \u0026lt;div style=\u0026#34;font-size:13px;font-weight:bold\u0026#34;\u0026gt;æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${dnum} å¤© ${hnum} å°æ—¶ ${mnum} åˆ† ${snum} ç§’ \u0026lt;i id=\u0026#34;heartbeat\u0026#34; class=\u0026#39;fas fa-heartbeat\u0026#39;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;br\u0026gt; æ—…è¡Œè€… 1 å·å½“å‰è·ç¦»åœ°çƒ ${dis} åƒç±³ï¼Œçº¦ä¸º ${unit} ä¸ªå¤©æ–‡å•ä½ ğŸš€\u0026lt;/div\u0026gt;`), document.getElementById(\u0026#34;workboard\u0026#34;) \u0026amp;\u0026amp; (document.getElementById(\u0026#34;workboard\u0026#34;).innerHTML = currentTimeHtml); } // è®¾ç½®é‡å¤æ‰§è¡Œå‡½æ•°ï¼Œå‘¨æœŸ1000ms setInterval(() =\u0026gt; { createtime(); }, 1000); /*é¡µè„šè®¡æ—¶å™¨ end */ åˆ›å»º åšå®¢æ ¹ç›®å½•/source/css/runtime.css\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 div#runtime { width: 180px; margin: auto; color: #fff; padding-inline: 5px; border-radius: 10px; background-color: rgba(0, 0, 0, 0.7); } #workboard { font-size: 12px; } [data-theme=\u0026#34;dark\u0026#34;] div#runtime { color: #28b4c8; box-shadow: 0 0 5px rgba(28, 69, 218, 0.71); animation: flashlight 1s linear infinite alternate; } #ghbdages .github-badge img { height: 20px; } @-moz-keyframes flashlight { from { box-shadow: 0 0 5px #1478d2; } to { box-shadow: 0 0 2px #1478d2; } } @-webkit-keyframes flashlight { from { box-shadow: 0 0 5px #1478d2; } to { box-shadow: 0 0 2px #1478d2; } } @-o-keyframes flashlight { from { box-shadow: 0 0 5px #1478d2; } to { box-shadow: 0 0 2px #1478d2; } } @keyframes flashlight { from { box-shadow: 0 0 5px #1478d2; } to { box-shadow: 0 0 2px #1478d2; } } ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ–¼ï¸ åä¹ã€ä¸€å›¾æµèƒŒæ™¯è®¾è®¡ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä½¿ç”¨å•å¼ å›¾ç‰‡ä½œä¸ºå…¨å±€èƒŒæ™¯ï¼Œå®ç°ç®€çº¦è€Œä¸ç®€å•çš„è§†è§‰æ•ˆæœã€‚\nğŸ”§ å®ç°æ–¹æ³• åˆ›å»ºèƒŒæ™¯æ ·å¼CSSï¼š åˆ›å»º Hexoæ ¹ç›®å½•/source/css/custom.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /* é¡µè„šä¸å¤´å›¾é€æ˜ */ #footer { background: transparent !important; } #page-header { background: transparent !important; } /* ç™½å¤©æ¨¡å¼é®ç½©é€æ˜ */ #footer::before { background: transparent !important; } #page-header::before { background: transparent !important; } /* å¤œé—´æ¨¡å¼é®ç½©é€æ˜ */ [data-theme=\u0026#34;dark\u0026#34;] #footer::before { background: transparent !important; } [data-theme=\u0026#34;dark\u0026#34;] #page-header::before { background: transparent !important; } åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ [BlogRoot]\\_config.butterfly.yml æ–‡ä»¶ä¸­çš„injecté…ç½®é¡¹çš„headå­é¡¹åŠ å…¥ä»¥ä¸‹ä»£ç ï¼Œä»£è¡¨å¼•å…¥åˆšåˆšåˆ›å»ºçš„custom.cssæ–‡ä»¶ 1 2 3 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/custom.css\u0026#34; media=\u0026#34;defer\u0026#34; onload=\u0026#34;this.media=\u0026#39;all\u0026#39;\u0026#34;\u0026gt; åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ [BlogRoot]\\_config.butterfly.yml æ–‡ä»¶ä¸­çš„ index_img å’Œ footer_bg é…ç½®é¡¹å–æ¶ˆå¤´å›¾ä¸é¡µè„šå›¾çš„åŠ è½½é¡¹é¿å…å†—ä½™åŠ è½½ 1 2 3 4 5 # The banner image of home page index_img: # Footer Background footer_bg: false åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ [BlogRoot]\\_config.butterfly.yml æ–‡ä»¶ä¸­çš„backgroundé…ç½®é¡¹è®¾ç½®èƒŒæ™¯å›¾ 1 background: /img/pc-018.webp ğŸ”¤ äºŒåã€å¼•ç”¨å­—ä½“ç¾åŒ– âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“æ›¿æ¢ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼Œæå‡æ’ç‰ˆç¾è§‚åº¦å’Œå“ç‰Œä¸€è‡´æ€§ã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. ğŸ” å‡†å¤‡å­—ä½“æ–‡ä»¶ å­—ä½“å¤©ä¸‹ï¼š https://www.fonts.net.cn/font-32027849465.html è°·æ­Œå­—ä½“ï¼š http://www.googlefonts.net/chinese TTF åˆ° WOFF2è½¬æ¢å™¨ï¼š https://products.groupdocs.app/zh/conversion/ttf-to-woff2 é¦–å…ˆå°†æ–‡ä»¶æ”¾åˆ°CSSåŒçº§ç›®å½•ä¸‹ï¼šHexoæ ¹ç›®å½•/source/css/GenJyuuGothic-Medium-2.ttf\nåˆ›å»º Hexoæ ¹ç›®å½•/source/css/å¼•ç”¨å­—ä½“.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 /* å¼•ç”¨å¤–é“¾å­—ä½“ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ */ @font-face { font-family: ZhuZiAYuanJWD; src: url(https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/fonts/ZhuZiAWan.woff2); font-display: swap; } /* å¼•ç”¨æœ¬åœ°å­—ä½“ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ */ @font-face { font-family: \u0026#39;ZhuZiAYuanJWD\u0026#39;; /*å­—ä½“åç§°ï¼Œåå­—å¯ä»¥éšä¾¿èµ·ï¼Œä½†æ˜¯æ³¨æ„è¦ä¸€è‡´ï¼Œå»ºè®®è‹±æ–‡*/ font-display: swap; src: url(\u0026#39;./GenJyuuGothic-Medium-2.ttf\u0026#39;) format(\u0026#34;truetype\u0026#34;); } body, /* å…¨å±€ä¿®æ”¹ä¸ºæ­¤å­—ä½“ */ a.title, /* æ ‡é¢˜é“¾æ¥-å¼•ç”¨å­—ä½“ */ div#menus, /* èœå•å®¹å™¨-å¼•ç”¨å­—ä½“ */ #blog-info, /* ç«™ç‚¹æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ #post-meta, /* å‘è¡¨æ—¶é—´ã€æ›´æ–°æ—¶é—´ç­‰-å¼•ç”¨å­—ä½“ */ h1#site-title, /* ç½‘ç«™ä¸»æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ h1.post-title, /* æ–‡ç« æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ #site-subtitle, /* ä¸€è¨€ç½‘ä¸€å¥è¯-å¼•ç”¨å­—ä½“ */ #aside-content, /* ä¾§è¾¹æ å†…å®¹-å¼•ç”¨å­—ä½“ */ .category-title, /* åˆ†ç±»æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ a.article-title, /* æ–‡ç« é“¾æ¥æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ .tag-cloud-title, /* æ ‡ç­¾äº‘æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ .article-sort-title, /* æ–‡ç« æ’åºæ ‡é¢˜-å¼•ç”¨å­—ä½“ */ a.blog-slider__title, /* åšå®¢è½®æ’­æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ a.category-list-link, /* åˆ†ç±»åˆ—è¡¨é“¾æ¥-å¼•ç”¨å­—ä½“ */ h1,h2,h3,h4,h5,h6, /* æ‰€æœ‰æ ‡é¢˜æ ‡ç­¾-å¼•ç”¨å­—ä½“ */ a.categoryBar-list-link, /* åˆ†ç±»æ åˆ—è¡¨é“¾æ¥-å¼•ç”¨å­—ä½“ */ a.article-sort-item-title, /* æ–‡ç« æ’åºé¡¹ç›®æ ‡é¢˜-å¼•ç”¨å­—ä½“ */ figure.highlight td.code pre, /* ä»£ç æ¡†-å¼•ç”¨å­—ä½“ */ figure.highlight td.code pre code, /* ä»£ç æ¡†ä¸­çš„ä»£ç -å¼•ç”¨å­—ä½“ */ a#site-name, span#subtitle, a.site-page, /* ç«™ç‚¹åç§°ã€å‰¯æ ‡é¢˜å’Œé¡µé¢é“¾æ¥-å¼•ç”¨å­—ä½“ */ #post .container.post-content .folding-tag .content ul li code /* æŠ˜å æ ‡ç­¾ä¸­çš„ä»£ç -å¼•ç”¨å­—ä½“ */ { font-family: \u0026#39;ZhuZiAYuanJWD\u0026#39;, sans-serif !important; /* è®¾ç½®å­—ä½“ä¸º ZhuZiAYuanJWDï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„æ— è¡¬çº¿å­—ä½“ */ } â• å¼•å…¥ å¼•ç”¨å­—ä½“.css æ–‡ä»¶\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œå¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: # æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/å¼•ç”¨å­—ä½“.css\u0026#34;\u0026gt; é…ç½®å­—ä½“ åœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­ä¿®æ”¹ä¸€ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # å…¨å±€å­—ä½“è®¾ç½® # é™¤éæ‚¨çŸ¥é“å®ƒä»¬çš„å·¥ä½œåŸç†ï¼Œå¦åˆ™ä¸è¦ä¿®æ”¹ä»¥ä¸‹è®¾ç½® font: # é»˜è®¤å­—ä½“å¤§å°ï¼ˆå…¨å±€èŒƒå›´å†…çš„å­—ä½“å¤§å°ï¼‰ global-font-size: 18px # ä»£ç å­—ä½“å¤§å°ï¼ˆç”¨äºä»£ç å—æˆ–ä»£ç ç›¸å…³çš„å†…å®¹ï¼‰ code-font-size: 18px # æ™®é€šæ–‡æœ¬çš„å­—ä½“å®¶æ—ï¼ˆå­—ä½“åç§°ï¼‰ font-family: \u0026#39;ZhuZiAYuanJWD\u0026#39; # ä»£ç å­—ä½“å®¶æ—ï¼ˆä»£ç å—æˆ–ä»£ç ç›¸å…³çš„å†…å®¹çš„å­—ä½“ï¼‰ code-font-family: \u0026#39;ZhuZiAYuanJWD\u0026#39; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸšï¸ äºŒåä¸€ã€æ»šåŠ¨æ¡æ ·å¼ç¾åŒ– âœ¨ åŠŸèƒ½ç‰¹ç‚¹ è‡ªå®šä¹‰æµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ï¼Œä½¿å…¶ä¸ç½‘ç«™è®¾è®¡é£æ ¼ä¿æŒä¸€è‡´ï¼Œæå‡ç»†èŠ‚ä½“éªŒã€‚\nğŸ”§ å®ç°æ–¹æ³• åˆ›å»º Hexoæ ¹ç›®å½•/source/css/æ»šåŠ¨æ¡æ ·å¼.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 /********************** æ»šåŠ¨æ¡æ•´ä½“æ ·å¼ ********************/ ::-webkit-scrollbar { width: 8px; /* æ»šåŠ¨æ¡å®½åº¦ */ height: 8px; /* æ»šåŠ¨æ¡é«˜åº¦ */ } /* æ»šåŠ¨æ¡è½¨é“æ ·å¼ */ ::-webkit-scrollbar-track { background-color: rgba(73, 177, 245, 0.2); /* è½¨é“èƒŒæ™¯è‰²ï¼ŒåŠé€æ˜ */ border-radius: 2em; /* è½¨é“åœ†è§’ */ } /* æ»šåŠ¨æ¡æ»‘æ ·å¼å— */ ::-webkit-scrollbar-thumb { background-color: var(--theme-color, #49b1f5); /* æ»‘å—èƒŒæ™¯è‰²ï¼Œä½¿ç”¨ä¸»é¢˜å˜é‡ï¼Œè‹¥æœªå®šä¹‰åˆ™ä½¿ç”¨é»˜è®¤å€¼ #49b1f5 */ background-image: -webkit-linear-gradient( 45deg, rgba(0, 0, 0, 0.3) 25%, /* æ¡çº¹æ•ˆæœï¼Œé»‘è‰²åŠé€æ˜ï¼Œå¢å¼ºå¯¹æ¯”åº¦ */ transparent 25%, /* é€æ˜éƒ¨åˆ† */ transparent 50%, /* é€æ˜éƒ¨åˆ† */ rgba(0, 0, 0, 0.3) 50%, /* æ¡çº¹æ•ˆæœï¼Œé»‘è‰²åŠé€æ˜ï¼Œå¢å¼ºå¯¹æ¯”åº¦ */ rgba(0, 0, 0, 0.3) 75%, /* æ¡çº¹æ•ˆæœï¼Œé»‘è‰²åŠé€æ˜ï¼Œå¢å¼ºå¯¹æ¯”åº¦ */ transparent 75%, /* é€æ˜éƒ¨åˆ† */ transparent ); /* æ»‘å—ä¸Šçš„æ¡çº¹æ•ˆæœ */ border-radius: 2em; /* æ»‘å—åœ†è§’ */ } /* æ»šåŠ¨æ¡è§’è½æ ·å¼ */ ::-webkit-scrollbar-corner { background-color: transparent; /* è§’è½èƒŒæ™¯è‰²ï¼Œé€æ˜ */ } /* é’ˆå¯¹ Mozilla æµè§ˆå™¨çš„é€‰ä¸­æ–‡æœ¬æ ·å¼ */ ::-moz-selection { color: #fff; /* é€‰ä¸­æ–‡å­—é¢œè‰² */ background-color: var(--theme-color, #49b1f5) !important; /* é€‰ä¸­èƒŒæ™¯è‰²ï¼Œä½¿ç”¨ä¸»é¢˜å˜é‡ï¼Œè‹¥æœªå®šä¹‰åˆ™ä½¿ç”¨é»˜è®¤å€¼ #49b1f5 */ } /* ä»£ç æ¡†åº•éƒ¨æ»šåŠ¨æ¡çš„ç‰¹æ®Šæ ·å¼ */ #article-container figure.highlight \u0026gt; ::-webkit-scrollbar-thumb { background-color: #49b1f5 !important; /* æ»‘å—èƒŒæ™¯è‰²ï¼Œæ·±ç°è‰² */ background-image: -webkit-linear-gradient( 45deg, rgba(0, 0, 0, 0.2) 25%, /* æ¡çº¹æ•ˆæœï¼Œé»‘è‰²ä½é€æ˜åº¦ï¼Œå¢å¼ºå¯¹æ¯”åº¦ */ transparent 25%, /* é€æ˜éƒ¨åˆ† */ transparent 50%, /* é€æ˜éƒ¨åˆ† */ rgba(0, 0, 0, 0.2) 50%, /* æ¡çº¹æ•ˆæœï¼Œé»‘è‰²ä½é€æ˜åº¦ï¼Œå¢å¼ºå¯¹æ¯”åº¦ */ rgba(0, 0, 0, 0.2) 75%, /* æ¡çº¹æ•ˆæœï¼Œé»‘è‰²ä½é€æ˜åº¦ï¼Œå¢å¼ºå¯¹æ¯”åº¦ */ transparent 75%, /* é€æ˜éƒ¨åˆ† */ transparent ) !important; /* æ»‘å—ä¸Šçš„æ¡çº¹æ•ˆæœ */ border-radius: 2em !important; /* æ»‘å—åœ†è§’ */ } â• å¼•å…¥ æ»šåŠ¨æ¡æ ·å¼.css æ–‡ä»¶\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œå¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 inject: head: # æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/æ»šåŠ¨æ¡æ ·å¼.css\u0026#34;\u0026gt; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ’¡ äºŒåäºŒã€å¤´åƒå‘¼å¸ç¯æ•ˆæœ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ä¸ºå¤´åƒæ·»åŠ å‘¼å¸ç¯æ•ˆæœï¼Œæ˜æš—äº¤æ›¿é—ªçƒï¼Œå¸å¼•è§†è§‰æ³¨æ„åŠ›ã€‚\nğŸ”§ å®ç°æ–¹æ³• åˆ›å»ºå‘¼å¸ç¯æ•ˆæœCSSï¼š åˆ›å»º Hexoæ ¹ç›®å½•/source/css/å¤´åƒå‘¼å¸ç¯.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /****************** å¤´åƒå‘¼å¸ç¯ä¼˜åŒ–ç‰ˆ ***********************/ [data-theme=\u0026#34;light\u0026#34;] .avatar-img { animation: huxi_light 3.5s ease-in-out infinite; position: relative; display: inline-block; } [data-theme=\u0026#34;dark\u0026#34;] .avatar-img { animation: huxi_dark 3.5s ease-in-out infinite; position: relative; display: inline-block; } /* æ˜äº®æ¨¡å¼ä¸‹çš„å‘¼å¸ç¯æ•ˆæœ */ @keyframes huxi_light { 0% { box-shadow: 0 0 5px 0px rgba(252, 0, 0, 0.3), 0 0 10px 0px rgba(252, 0, 0, 0.1); } 25% { box-shadow: 0 0 10px 2px rgba(252, 0, 0, 0.7), 0 0 20px 4px rgba(252, 0, 0, 0.3); } 50% { box-shadow: 0 0 15px 4px rgba(252, 0, 0, 0.8), 0 0 25px 8px rgba(252, 0, 0, 0.5); } 75% { box-shadow: 0 0 10px 2px rgba(252, 0, 0, 0.7), 0 0 20px 4px rgba(252, 0, 0, 0.3); } 100% { box-shadow: 0 0 5px 0px rgba(252, 0, 0, 0.3), 0 0 10px 0px rgba(252, 0, 0, 0.1); } } /* é»‘æš—æ¨¡å¼ä¸‹çš„å‘¼å¸ç¯æ•ˆæœ */ @keyframes huxi_dark { 0% { box-shadow: 0 0 5px 0px rgba(130, 252, 0, 0.3), 0 0 10px 0px rgba(130, 252, 0, 0.1); } 25% { box-shadow: 0 0 10px 2px rgba(130, 252, 0, 0.7), 0 0 20px 4px rgba(130, 252, 0, 0.3); } 50% { box-shadow: 0 0 15px 4px rgba(130, 252, 0, 0.9), 0 0 25px 8px rgba(130, 252, 0, 0.5); } 75% { box-shadow: 0 0 10px 2px rgba(130, 252, 0, 0.7), 0 0 20px 4px rgba(130, 252, 0, 0.3); } 100% { box-shadow: 0 0 5px 0px rgba(130, 252, 0, 0.3), 0 0 10px 0px rgba(130, 252, 0, 0.1); } } â• å¼•å…¥ å¤´åƒå‘¼å¸ç¯.css æ–‡ä»¶\nåœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œå¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 inject: head: # æ³¨å…¥è‡ªå®šä¹‰css - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/å¤´åƒå‘¼å¸ç¯.css\u0026#34;\u0026gt; ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š\n1 hexo clean; hexo g; hexo s ğŸ–¼ï¸ äºŒåä¸‰ã€åšå®¢èƒŒæ™¯åˆ‡æ¢ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ æ·»åŠ èƒŒæ™¯åˆ‡æ¢åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰åšå®¢èƒŒæ™¯å›¾ç‰‡æˆ–é¢œè‰²ï¼Œå¢å¼ºä¸ªæ€§åŒ–ä½“éªŒã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â•åˆ›å»ºåˆ‡æ¢æŒ‰é’® è‡ªè¡Œé€‰æ‹©åœ¨å“ªé‡Œæ·»åŠ ï¼Œåªéœ€è¦è°ƒç”¨toggleWinboxå‡½æ•°å°±å¯ä»¥\nå¼•å…¥åˆ°å³ä¸‹è§’æ–¹æ³• ä¿®æ”¹åšå®¢æ ¹ç›®å½•\\butterfly\\layout\\includes\\rightside.pug åœ¨ä¼—å¤šwhenä¸‹é¢æ–°å¢ï¼š\n1 2 3 4 5 6 7 when \u0026#39;comment\u0026#39; if commentsJsLoad a#to_comment(href=\u0026#34;#post-comment\u0026#34; title=_p(\u0026#34;rightside.scroll_to_comment\u0026#34;)) i.fas.fa-comments + when \u0026#39;bg\u0026#39; + button(type=\u0026#34;button\u0026#34; title=\u0026#39;åˆ‡æ¢èƒŒæ™¯\u0026#39; onclick=\u0026#34;toggleWinbox()\u0026#34;) + i.fas.fa-display ç„¶åä¿®æ”¹ï¼š\n1 2 3 4 5 #rightside - const { enable, hide, show } = theme.rightside_item_order - const hideArray = enable ? hide \u0026amp;\u0026amp; hide.split(\u0026#39;,\u0026#39;) : [\u0026#39;readmode\u0026#39;,\u0026#39;translate\u0026#39;,\u0026#39;darkmode\u0026#39;,\u0026#39;hideAside\u0026#39;] - - const showArray = enable ? show \u0026amp;\u0026amp; show.split(\u0026#39;,\u0026#39;) : [\u0026#39;toc\u0026#39;,\u0026#39;chat\u0026#39;,\u0026#39;comment\u0026#39;] + - const showArray = enable ? show \u0026amp;\u0026amp; show.split(\u0026#39;,\u0026#39;) : [\u0026#39;toc\u0026#39;,\u0026#39;chat\u0026#39;,\u0026#39;comment\u0026#39;,\u0026#39;bg\u0026#39;] ä»¥ä¸Šæ˜¯å¼•å…¥åˆ° å³ä¸‹è§’ çš„æ–¹æ³•\nå¼•å…¥åˆ°å¯¼èˆªæ  å³ä¸Šè§’ æ–¹æ³• å›¾æ ‡#icon-a-zhaopiantupianxiangceä¿®æ”¹ä¸ºè‡ªå·±çš„ 1 2 3 4 5 if theme.menu != partial(\u0026#39;includes/header/menu_item\u0026#39;, {}, {cache: true}) + a.site-page.faa-parent.animated-hover(onclick=\u0026#39;toggleWinbox()\u0026#39; title=\u0026#39;åˆ‡æ¢å£çº¸\u0026#39;) + svg.faa-tada.bizhi(aria-hidden=\u0026#34;true\u0026#34;, style=\u0026#34;height:2em;width:2em\u0026#34;) + use(xlink:href=\u0026#39;#icon-a-zhaopiantupianxiangce\u0026#39;) 2. â• åˆ›å»º åšå®¢æ ¹ç›®å½•/source/js/xxx.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 // å­˜æ•°æ® // nameï¼šå‘½å dataï¼šæ•°æ® function saveData(name, data) { localStorage.setItem(name, JSON.stringify({ \u0026#39;time\u0026#39;: Date.now(), \u0026#39;data\u0026#39;: data })) } // å–æ•°æ® // nameï¼šå‘½å timeï¼šè¿‡æœŸæ—¶é•¿,å•ä½åˆ†é’Ÿ,å¦‚ä¼ å…¥30,å³åŠ è½½æ•°æ®æ—¶å¦‚æœè¶…å‡º30åˆ†é’Ÿè¿”å›0,å¦åˆ™è¿”å›æ•°æ® function loadData(name, time) { let d = JSON.parse(localStorage.getItem(name)); // è¿‡æœŸæˆ–æœ‰é”™è¯¯è¿”å› 0 å¦åˆ™è¿”å›æ•°æ® if (d) { let t = Date.now() - d.time if (t \u0026lt; (time * 60 * 1000) \u0026amp;\u0026amp; t \u0026gt; -1) return d.data; } return 0; } // ä¸Šé¢ä¸¤ä¸ªå‡½æ•°å¦‚æœä½ æœ‰å…¶ä»–éœ€è¦å­˜å–æ•°æ®çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ // è¯»å–èƒŒæ™¯ try { let data = loadData(\u0026#39;blogbg\u0026#39;, 1440) if (data) changeBg(data, 1) else localStorage.removeItem(\u0026#39;blogbg\u0026#39;); } catch (error) { localStorage.removeItem(\u0026#39;blogbg\u0026#39;); } // åˆ‡æ¢èƒŒæ™¯å‡½æ•° // æ­¤å¤„çš„flagæ˜¯ä¸ºäº†æ¯æ¬¡è¯»å–æ—¶éƒ½é‡æ–°å­˜å‚¨ä¸€æ¬¡,å¯¼è‡´è¿‡æœŸæ—¶é—´ä¸ç¨³å®š // å¦‚æœflagä¸º0åˆ™å­˜å‚¨,å³è®¾ç½®èƒŒæ™¯. ä¸º1åˆ™ä¸å­˜å‚¨,å³æ¯æ¬¡åŠ è½½è‡ªåŠ¨è¯»å–èƒŒæ™¯. function changeBg(s, flag) { let bg = document.getElementById(\u0026#39;web_bg\u0026#39;) if (s.charAt(0) == \u0026#39;#\u0026#39;) { bg.style.backgroundColor = s bg.style.backgroundImage = \u0026#39;none\u0026#39; } else bg.style.backgroundImage = s if (!flag) { saveData(\u0026#39;blogbg\u0026#39;, s) } } // ä»¥ä¸‹ä¸º2.0æ–°å¢å†…å®¹ // åˆ›å»ºçª—å£ var winbox = \u0026#39;\u0026#39; function createWinbox() { let div = document.createElement(\u0026#39;div\u0026#39;) document.body.appendChild(div) winbox = WinBox({ id: \u0026#39;changeBgBox\u0026#39;, index: 999, title: \u0026#34;åˆ‡æ¢èƒŒæ™¯\u0026#34;, x: \u0026#34;center\u0026#34;, y: \u0026#34;center\u0026#34;, minwidth: \u0026#39;300px\u0026#39;, height: \u0026#34;60%\u0026#34;, background: \u0026#39;#49b1f5\u0026#39;, onmaximize: () =\u0026gt; { div.innerHTML = `\u0026lt;style\u0026gt;body::-webkit-scrollbar {display: none;}div#changeBgBox {width: 100% !important;}\u0026lt;/style\u0026gt;` }, onrestore: () =\u0026gt; { div.innerHTML = \u0026#39;\u0026#39; } }); winResize(); window.addEventListener(\u0026#39;resize\u0026#39;, winResize) // æ¯ä¸€ç±»æˆ‘æ”¾äº†ä¸€ä¸ªæ¼”ç¤ºï¼Œç›´æ¥å¾€ä¸‹å¤åˆ¶ç²˜è´´ aæ ‡ç­¾ å°±å¯ä»¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ å‡½æ•°é‡Œé¢çš„é“¾æ¥ å†’å·å‰é¢éœ€è¦æ·»åŠ åæ–œæ \\è¿›è¡Œè½¬ä¹‰ winbox.body.innerHTML = ` \u0026lt;div id=\u0026#34;article-container\u0026#34; style=\u0026#34;padding:10px;\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026lt;button onclick=\u0026#34;localStorage.removeItem(\u0026#39;blogbg\u0026#39;);location.reload();\u0026#34; style=\u0026#34;background:#5fcdff;display:block;width:100%;padding: 15px 0;border-radius:6px;color:white;\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa-solid fa-arrows-rotate\u0026#34;\u0026gt;\u0026lt;/i\u0026gt; ç‚¹æˆ‘æ¢å¤é»˜è®¤èƒŒæ™¯\u0026lt;/button\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;h2 id=\u0026#34;å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰\u0026#34; class=\u0026#34;headerlink\u0026#34; title=\u0026#34;å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;bgbox\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:;\u0026#34; rel=\u0026#34;noopener external nofollow\u0026#34; style=\u0026#34;background-image:url(https://img.vm.laomishuo.com/image/2021/12/2021122715170589.jpeg)\u0026#34; class=\u0026#34;pimgbox\u0026#34; onclick=\u0026#34;changeBg(\u0026#39;url(https\\://img.vm.laomishuo.com/image/2021/12/2021122715170589.jpeg)\u0026#39;)\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;h2 id=\u0026#34;å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰\u0026#34; class=\u0026#34;headerlink\u0026#34; title=\u0026#34;å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;bgbox\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:;\u0026#34; rel=\u0026#34;noopener external nofollow\u0026#34; style=\u0026#34;background-image:url(https://cn.bing.com/th?id=OHR.GBRTurtle_ZH-CN6069093254_1920x1080.jpg)\u0026#34; class=\u0026#34;imgbox\u0026#34; onclick=\u0026#34;changeBg(\u0026#39;url(https\\://cn.bing.com/th?id=OHR.GBRTurtle_ZH-CN6069093254_1920x1080.jpg)\u0026#39;)\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;h2 id=\u0026#34;æ¸å˜è‰²\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#æ¸å˜è‰²\u0026#34; class=\u0026#34;headerlink\u0026#34; title=\u0026#34;æ¸å˜è‰²\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;æ¸å˜è‰²\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;bgbox\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:;\u0026#34; rel=\u0026#34;noopener external nofollow\u0026#34; class=\u0026#34;box\u0026#34; style=\u0026#34;background: linear-gradient(to right, #eecda3, #ef629f)\u0026#34; onclick=\u0026#34;changeBg(\u0026#39;linear-gradient(to right, #eecda3, #ef629f)\u0026#39;)\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;h2 id=\u0026#34;çº¯è‰²\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#çº¯è‰²\u0026#34; class=\u0026#34;headerlink\u0026#34; title=\u0026#34;çº¯è‰²\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;çº¯è‰²\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;bgbox\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;javascript:;\u0026#34; rel=\u0026#34;noopener external nofollow\u0026#34; class=\u0026#34;box\u0026#34; style=\u0026#34;background: #7D9D9C\u0026#34; onclick=\u0026#34;changeBg(\u0026#39;#7D9D9C\u0026#39;)\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; `; } // é€‚åº”çª—å£å¤§å° function winResize() { let box = document.querySelector(\u0026#39;#changeBgBox\u0026#39;) if (!box || box.classList.contains(\u0026#39;min\u0026#39;) || box.classList.contains(\u0026#39;max\u0026#39;)) return // 2023-02-10æ›´æ–° var offsetWid = document.documentElement.clientWidth; if (offsetWid \u0026lt;= 768) { winbox.resize(offsetWid * 0.95 + \u0026#34;px\u0026#34;, \u0026#34;90%\u0026#34;).move(\u0026#34;center\u0026#34;, \u0026#34;center\u0026#34;); } else { winbox.resize(offsetWid * 0.6 + \u0026#34;px\u0026#34;, \u0026#34;70%\u0026#34;).move(\u0026#34;center\u0026#34;, \u0026#34;center\u0026#34;); } } // åˆ‡æ¢çŠ¶æ€ï¼Œçª—å£å·²åˆ›å»ºåˆ™æ§åˆ¶çª—å£æ˜¾ç¤ºå’Œéšè—ï¼Œæ²¡çª—å£åˆ™åˆ›å»ºçª—å£ function toggleWinbox() { if (document.querySelector(\u0026#39;#changeBgBox\u0026#39;)) winbox.toggleClass(\u0026#39;hide\u0026#39;); else createWinbox(); } 3. â•åˆ›å»º åšå®¢æ ¹ç›®å½•/source/css/xxx.css 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 /* ç”±äºå…¨å±ä¼šå‡ºbugï¼Œæ‰€ä»¥ç›´æ¥ç»™ä»–éšè— */ .winbox { border-radius: 12px; overflow: hidden; } .wb-full { display: none; } .wb-min { background-position: center; } [data-theme=\u0026#39;dark\u0026#39;] .wb-body, [data-theme=\u0026#39;dark\u0026#39;] #changeBgBox { background: #333 !important; } .bgbox { display: flex; flex-wrap: wrap; justify-content: space-between; } .pimgbox, .imgbox, .box { width: 166px; margin: 10px; background-size: cover } .pimgbox, .imgbox { border-radius: 10px; overflow: hidden; } .pimgbox { height: 240px; } .imgbox { height: 95px; } .box { height: 100px; } @media screen and (max-width: 768px) { /* èƒŒæ™¯ */ .pimgbox, .imgbox, .box { height: 73px; width: 135px; } .pimgbox { height: 205px; } /* 2.0æ–°å¢å†…å®¹ */ .wb-min { display: none; } #changeBgBox .wb-body::-webkit-scrollbar { display: none; } } 4. â• å¼•å…¥ xxx.jså’Œxxx.css 1 2 3 4 5 6 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/xxx.css\u0026#34;\u0026gt; bottom: - \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/gh/nextapps-de/winbox/dist/winbox.bundle.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; # å¼•å…¥ winbox - \u0026lt;script src=\u0026#34;/js/xxx.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; # è¿™ä¸ªä»£è¡¨è‡ªå®šä¹‰jsï¼Œæ”¾åœ¨æœ€ä¸‹é¢ 5. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s ğŸ‘‹ äºŒåå››ã€è®¿å®¢å®šä½æ¬¢è¿ä¿¡æ¯ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ æ ¹æ®è®¿å®¢IPåœ°å€æ˜¾ç¤ºå®šä½ä¿¡æ¯å’Œä¸ªæ€§åŒ–æ¬¢è¿è¯­ï¼Œå¢å¼ºç”¨æˆ·å‚ä¸æ„Ÿã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â• åˆ›å»ºæ¬¢è¿è„šæœ¬ï¼š ä½œè€…åšå®¢ï¼š https://blog.qjqq.cn/posts/2a52.html æ–°å»º[BlogRoot]/source/js/welcome.jsæ–‡ä»¶\nå¥¶æ€çŒ«keyç”³è¯·ï¼š https://api.nsmao.net æŸ¥çœ‹ä¸ªäººç»çº¬åº¦ï¼š https://github.com/fomalhaut1998/hexo-theme-Fomalhaut 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 // è¿›è¡Œ fetch è¯·æ±‚ fetch(\u0026#39;https://api.nsmao.net/api/ip/query?key=ä½ çš„key\u0026#39;) // ç”³è¯·åœ°å€ï¼šhttps://api.nsmao.net .then(response =\u0026gt; { if (!response.ok) { throw new Error(\u0026#39;Network response was not ok\u0026#39;); } return response.json(); }) .then(data =\u0026gt; { ipLocation = data; if (isHomePage()) { showWelcome(); } }) .catch(error =\u0026gt; console.error(\u0026#39;Error:\u0026#39;, error)); function getDistance(e1, n1, e2, n2) { const R = 6371; const { sin, cos, asin, PI, hypot } = Math; let getPoint = (e, n) =\u0026gt; { e *= PI / 180; n *= PI / 180; return { x: cos(n) * cos(e), y: cos(n) * sin(e), z: sin(n) }; }; let a = getPoint(e1, n1); let b = getPoint(e2, n2); let c = hypot(a.x - b.x, a.y - b.y, a.z - b.z); let r = asin(c / 2) * 2 * R; return Math.round(r); } function showWelcome() { if (!ipLocation || !ipLocation.data) { console.error(\u0026#39;ipLocation data is not available.\u0026#39;); return; } let dist = getDistance(116.680584,35.649829, ipLocation.data.lng, ipLocation.data.lat); // ä¿®æ”¹è‡ªå·±çš„ç»åº¦ï¼ˆ121.413921ï¼‰çº¬åº¦ï¼ˆ31.089290ï¼‰ let pos = ipLocation.data.country; let ip = ipLocation.ip; let posdesc; // æ–°å¢ipv6æ˜¾ç¤ºä¸ºæŒ‡å®šå†…å®¹ if (ip.includes(\u0026#34;:\u0026#34;)) { ip = \u0026#34;\u0026lt;br\u0026gt;å¥½å¤æ‚ï¼Œå’±çœ‹ä¸æ‡‚~(ipv6)\u0026#34;; } // ä»¥ä¸‹çš„ä»£ç éœ€è¦æ ¹æ®æ–°APIè¿”å›çš„ç»“æœè¿›è¡Œç›¸åº”çš„è°ƒæ•´ switch (ipLocation.data.country) { case \u0026#34;æ—¥æœ¬\u0026#34;: posdesc = \u0026#34;ã‚ˆã‚ã—ãï¼Œä¸€èµ·å»çœ‹æ¨±èŠ±å—\u0026#34;; break; case \u0026#34;ç¾å›½\u0026#34;: posdesc = \u0026#34;Let us live in peace!\u0026#34;; break; case \u0026#34;è‹±å›½\u0026#34;: posdesc = \u0026#34;æƒ³åŒä½ ä¸€èµ·å¤œä¹˜ä¼¦æ•¦çœ¼\u0026#34;; break; case \u0026#34;ä¿„ç½—æ–¯\u0026#34;: posdesc = \u0026#34;å¹²äº†è¿™ç“¶ä¼ç‰¹åŠ ï¼\u0026#34;; break; case \u0026#34;æ³•å›½\u0026#34;: posdesc = \u0026#34;C\u0026#39;est La Vie\u0026#34;; break; case \u0026#34;å¾·å›½\u0026#34;: posdesc = \u0026#34;Die Zeit verging im Fluge.\u0026#34;; break; case \u0026#34;æ¾³å¤§åˆ©äºš\u0026#34;: posdesc = \u0026#34;ä¸€èµ·å»å¤§å ¡ç¤å§ï¼\u0026#34;; break; case \u0026#34;åŠ æ‹¿å¤§\u0026#34;: posdesc = \u0026#34;æ‹¾èµ·ä¸€ç‰‡æ«å¶èµ äºˆä½ \u0026#34;; break; case \u0026#34;ä¸­å›½\u0026#34;: pos = ipLocation.data.prov + \u0026#34; \u0026#34; + ipLocation.data.city + \u0026#34; \u0026#34; + ipLocation.data.district; switch (ipLocation.data.prov) { case \u0026#34;åŒ—äº¬å¸‚\u0026#34;: posdesc = \u0026#34;åŒ—â€”â€”äº¬â€”â€”æ¬¢è¿ä½ ~~~\u0026#34;; break; case \u0026#34;å¤©æ´¥å¸‚\u0026#34;: posdesc = \u0026#34;è®²æ®µç›¸å£°å§\u0026#34;; break; case \u0026#34;æ²³åŒ—çœ\u0026#34;: posdesc = \u0026#34;å±±åŠ¿å·å·æˆå£å’ï¼Œå¤©ä¸‹é›„å…³é“é©¬é‡‘æˆˆç”±æ­¤å‘ï¼Œæ— é™æ±Ÿå±±\u0026#34;; break; case \u0026#34;å±±è¥¿çœ\u0026#34;: posdesc = \u0026#34;å±•å¼€åå…·é•¿ä¸‰å°ºï¼Œå·²å å±±æ²³äº”ç™¾ä½™\u0026#34;; break; case \u0026#34;å†…è’™å¤è‡ªæ²»åŒº\u0026#34;: posdesc = \u0026#34;å¤©è‹è‹ï¼Œé‡èŒ«èŒ«ï¼Œé£å¹è‰ä½è§ç‰›ç¾Š\u0026#34;; break; case \u0026#34;è¾½å®çœ\u0026#34;: posdesc = \u0026#34;æˆ‘æƒ³åƒçƒ¤é¸¡æ¶ï¼\u0026#34;; break; case \u0026#34;å‰æ—çœ\u0026#34;: posdesc = \u0026#34;çŠ¶å…ƒé˜å°±æ˜¯ä¸œåŒ—çƒ§çƒ¤ä¹‹ç‹\u0026#34;; break; case \u0026#34;é»‘é¾™æ±Ÿçœ\u0026#34;: posdesc = \u0026#34;å¾ˆå–œæ¬¢å“ˆå°”æ»¨å¤§å‰§é™¢\u0026#34;; break; case \u0026#34;ä¸Šæµ·å¸‚\u0026#34;: posdesc = \u0026#34;ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½åªæœ‰ä¸¤ä¸ªåŸå¸‚\u0026#34;; break; case \u0026#34;æ±Ÿè‹çœ\u0026#34;: switch (ipLocation.data.city) { case \u0026#34;å—äº¬å¸‚\u0026#34;: posdesc = \u0026#34;è¿™æ˜¯æˆ‘æŒºæƒ³å»çš„åŸå¸‚å•¦\u0026#34;; break; case \u0026#34;è‹å·å¸‚\u0026#34;: posdesc = \u0026#34;ä¸Šæœ‰å¤©å ‚ï¼Œä¸‹æœ‰è‹æ­\u0026#34;; break; default: posdesc = \u0026#34;æ•£è£…æ˜¯å¿…é¡»è¦æ•£è£…çš„\u0026#34;; break; } break; case \u0026#34;æµ™æ±Ÿçœ\u0026#34;: switch (ipLocation.data.city) { case \u0026#34;æ­å·å¸‚\u0026#34;: posdesc = \u0026#34;ä¸œé£æ¸ç»¿è¥¿æ¹–æŸ³ï¼Œé›å·²è¿˜äººæœªå—å½’\u0026#34;; break; default: posdesc = \u0026#34;æœ›æµ·æ¥¼æ˜ç…§æ›™éœ,æŠ¤æ±Ÿå ¤ç™½è¹‹æ™´æ²™\u0026#34;; break; } break; case \u0026#34;æ²³å—çœ\u0026#34;: switch (ipLocation.data.city) { case \u0026#34;éƒ‘å·å¸‚\u0026#34;: posdesc = \u0026#34;è±«å·ä¹‹åŸŸï¼Œå¤©åœ°ä¹‹ä¸­\u0026#34;; break; case \u0026#34;ä¿¡é˜³å¸‚\u0026#34;: posdesc = \u0026#34;å“ä¿¡é˜³æ¯›å°–ï¼Œæ‚Ÿäººé—´èŠ³å\u0026#34;; break; case \u0026#34;å—é˜³å¸‚\u0026#34;: posdesc = \u0026#34;è‡£æœ¬å¸ƒè¡£ï¼Œèº¬è€•äºå—é˜³æ­¤å—é˜³éå½¼å—é˜³ï¼\u0026#34;; break; case \u0026#34;é©»é©¬åº—å¸‚\u0026#34;: posdesc = \u0026#34;å³°å³°æœ‰å¥‡çŸ³ï¼ŒçŸ³çŸ³æŒŸä»™æ°”åµ–å²ˆå±±çš„èŠ±å¾ˆç¾å“¦ï¼\u0026#34;; break; case \u0026#34;å¼€å°å¸‚\u0026#34;: posdesc = \u0026#34;åˆšæ­£ä¸é˜¿åŒ…é’å¤©\u0026#34;; break; case \u0026#34;æ´›é˜³å¸‚\u0026#34;: posdesc = \u0026#34;æ´›é˜³ç‰¡ä¸¹ç”²å¤©ä¸‹\u0026#34;; break; default: posdesc = \u0026#34;å¯å¦å¸¦æˆ‘å“å°æ²³å—çƒ©é¢å•¦ï¼Ÿ\u0026#34;; break; } break; case \u0026#34;å®‰å¾½çœ\u0026#34;: posdesc = \u0026#34;èšŒåŸ ä½äº†ï¼ŒèŠœæ¹–èµ·é£\u0026#34;; break; case \u0026#34;ç¦å»ºçœ\u0026#34;: posdesc = \u0026#34;äº•é‚‘ç™½äº‘é—´ï¼Œå²©åŸè¿œå¸¦å±±\u0026#34;; break; case \u0026#34;æ±Ÿè¥¿çœ\u0026#34;: posdesc = \u0026#34;è½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²\u0026#34;; break; case \u0026#34;å±±ä¸œçœ\u0026#34;: posdesc = \u0026#34;é¥æœ›é½å·ä¹ç‚¹çƒŸï¼Œä¸€æ³“æµ·æ°´æ¯ä¸­æ³»\u0026#34;; break; case \u0026#34;æ¹–åŒ—çœ\u0026#34;: switch (ipLocation.data.city) { case \u0026#34;é»„å†ˆå¸‚\u0026#34;: posdesc = \u0026#34;çº¢å®‰å°†å†›å¿ï¼è¾ˆå‡ºå°†æ‰ï¼\u0026#34;; break; default: posdesc = \u0026#34;æ¥ç¢—çƒ­å¹²é¢~\u0026#34;; break; } break; case \u0026#34;æ¹–å—çœ\u0026#34;: posdesc = \u0026#34;74751ï¼Œé•¿æ²™æ–¯å¡”å…‹\u0026#34;; break; case \u0026#34;å¹¿ä¸œçœ\u0026#34;: switch (ipLocation.data.city) { case \u0026#34;å¹¿å·å¸‚\u0026#34;: posdesc = \u0026#34;çœ‹å°è›®è…°ï¼Œå–æ—©èŒ¶äº†å˜›~\u0026#34;; break; case \u0026#34;æ·±åœ³å¸‚\u0026#34;: posdesc = \u0026#34;ä»Šå¤©ä½ é€›å•†åœºäº†å˜›~\u0026#34;; break; case \u0026#34;é˜³æ±Ÿå¸‚\u0026#34;: posdesc = \u0026#34;é˜³æ˜¥åˆæ°´ï¼åšä¸»å®¶ä¹¡~ æ¬¢è¿æ¥ç©~\u0026#34;; break; default: posdesc = \u0026#34;æ¥ä¸¤æ–¤ç¦å»ºäºº~\u0026#34;; break; } break; case \u0026#34;å¹¿è¥¿å£®æ—è‡ªæ²»åŒº\u0026#34;: posdesc = \u0026#34;æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹\u0026#34;; break; case \u0026#34;æµ·å—çœ\u0026#34;: posdesc = \u0026#34;æœè§‚æ—¥å‡ºé€ç™½æµªï¼Œå¤•çœ‹äº‘èµ·æ”¶éœå…‰\u0026#34;; break; case \u0026#34;å››å·çœ\u0026#34;: posdesc = \u0026#34;åº·åº·å·å¦¹å­\u0026#34;; break; case \u0026#34;è´µå·çœ\u0026#34;: posdesc = \u0026#34;èŒ…å°ï¼Œå­¦ç”Ÿï¼Œå†å¡200\u0026#34;; break; case \u0026#34;äº‘å—çœ\u0026#34;: posdesc = \u0026#34;ç‰é¾™é£èˆäº‘ç¼ ç»•ï¼Œä¸‡ä»å†°å·ç›´è€¸å¤©\u0026#34;; break; case \u0026#34;è¥¿è—è‡ªæ²»åŒº\u0026#34;: posdesc = \u0026#34;èººåœ¨èŒ«èŒ«è‰åŸä¸Šï¼Œä»°æœ›è“å¤©\u0026#34;; break; case \u0026#34;é™•è¥¿çœ\u0026#34;: posdesc = \u0026#34;æ¥ä»½è‡Šå­é¢åŠ é¦\u0026#34;; break; case \u0026#34;ç”˜è‚ƒçœ\u0026#34;: posdesc = \u0026#34;ç¾Œç¬›ä½•é¡»æ€¨æ¨æŸ³ï¼Œæ˜¥é£ä¸åº¦ç‰é—¨å…³\u0026#34;; break; case \u0026#34;é’æµ·çœ\u0026#34;: posdesc = \u0026#34;ç‰›è‚‰å¹²å’Œè€é…¸å¥¶éƒ½å¥½å¥½åƒ\u0026#34;; break; case \u0026#34;å®å¤å›æ—è‡ªæ²»åŒº\u0026#34;: posdesc = \u0026#34;å¤§æ¼ å­¤çƒŸç›´ï¼Œé•¿æ²³è½æ—¥åœ†\u0026#34;; break; case \u0026#34;æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº\u0026#34;: posdesc = \u0026#34;é©¼é“ƒå¤é“ä¸ç»¸è·¯ï¼Œèƒ¡é©¬çŠ¹é—»å”æ±‰é£\u0026#34;; break; case \u0026#34;å°æ¹¾çœ\u0026#34;: posdesc = \u0026#34;æˆ‘åœ¨è¿™å¤´ï¼Œå¤§é™†åœ¨é‚£å¤´\u0026#34;; break; case \u0026#34;é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº\u0026#34;: posdesc = \u0026#34;æ°¸å®šè´¼æœ‰æ®‹ç•™åœ°é¬¼åšï¼Œè¿å‡»å…‰éå²ç‰\u0026#34;; break; case \u0026#34;æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº\u0026#34;: posdesc = \u0026#34;æ€§æ„Ÿè·å®˜ï¼Œåœ¨çº¿å‘ç‰Œ\u0026#34;; break; default: posdesc = \u0026#34;å¸¦æˆ‘å»ä½ çš„åŸå¸‚é€›é€›å§ï¼\u0026#34;; break; } break; default: posdesc = \u0026#34;å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§\u0026#34;; break; } // æ ¹æ®æœ¬åœ°æ—¶é—´åˆ‡æ¢æ¬¢è¿è¯­ let timeChange; let date = new Date(); if (date.getHours() \u0026gt;= 5 \u0026amp;\u0026amp; date.getHours() \u0026lt; 11) timeChange = \u0026#34;\u0026lt;span\u0026gt;ğŸŒ¤ï¸ æ—©ä¸Šå¥½ï¼ŒåŠ æ²¹åŠ æ²¹ ğŸ’ª\u0026lt;/span\u0026gt;\u0026#34;; else if (date.getHours() \u0026gt;= 11 \u0026amp;\u0026amp; date.getHours() \u0026lt; 13) timeChange = \u0026#34;\u0026lt;span\u0026gt;â˜€ï¸ ä¸­åˆå¥½ï¼Œè®°å¾—åˆä¼‘å–” ğŸ¹\u0026lt;/span\u0026gt;\u0026#34;; else if (date.getHours() \u0026gt;= 13 \u0026amp;\u0026amp; date.getHours() \u0026lt; 17) timeChange = \u0026#34;\u0026lt;span\u0026gt;ğŸ• ä¸‹åˆå¥½ï¼Œé¥®èŒ¶å…ˆå•¦ â˜•\u0026lt;/span\u0026gt;\u0026#34;; else if (date.getHours() \u0026gt;= 17 \u0026amp;\u0026amp; date.getHours() \u0026lt; 19) timeChange = \u0026#34;\u0026lt;span\u0026gt;ğŸš¶â€â™‚ï¸ å³å°†ä¸‹ç­ï¼ŒæŒ‰æ—¶åƒé¥­å–” ğŸš\u0026lt;/span\u0026gt;\u0026#34;; else if (date.getHours() \u0026gt;= 19 \u0026amp;\u0026amp; date.getHours() \u0026lt; 24) timeChange = \u0026#34;\u0026lt;span\u0026gt;ğŸŒ™ æ™šä¸Šå¥½ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ ğŸ»\u0026lt;/span\u0026gt;\u0026#34;; else if (date.getHours() \u0026gt;= 0 \u0026amp;\u0026amp; date.getHours() \u0026lt; 5) timeChange = \u0026#34;\u0026lt;span\u0026gt;ğŸ›ï¸ å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯ ğŸŒƒ\u0026lt;/span\u0026gt;\u0026#34;; // else timeChange = \u0026#34;å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯\u0026#34;; let welcomeInfoElement = document.getElementById(\u0026#34;welcome-info\u0026#34;); if (welcomeInfoElement) { welcomeInfoElement.innerHTML = ` æ¬¢è¿æ¥è‡ª \u0026lt;b style=\u0026#34;font-size: 15px; color: var(--theme-color)\u0026#34;\u0026gt;${pos}\u0026lt;/b\u0026gt; çš„æœ‹å‹ğŸ’– è·åšä¸»çº¦ï¼š\u0026lt;b style=\u0026#34;font-size: 15px; color: var(--theme-color)\u0026#34;\u0026gt;${dist.toFixed(2)}\u0026lt;/b\u0026gt; å…¬é‡Œ ğŸš— IPåœ°å€æ˜¯ï¼š\u0026lt;b style=\u0026#34;font-size: 15px; color: var(--theme-color)\u0026#34;\u0026gt;${ip}\u0026lt;/b\u0026gt; \u0026lt;span${timeChange}\u0026lt;/span\u0026gt; \u0026lt;b style=\u0026#34;font-size: 15px; color: var(--theme-color)\u0026#34;\u0026gt;${posdesc}\u0026lt;/b\u0026gt; `; } else { console.log(\u0026#34;Pjaxæ— æ³•è·å–å…ƒç´ \u0026#34;); } } // Pjaxå®Œæˆé¡µé¢åˆ‡æ¢çš„äº‹ä»¶å›è°ƒå¤„ç† function handlePjaxComplete() { if (isHomePage()) { showWelcome(); } } function isHomePage() { return window.location.pathname === \u0026#39;/\u0026#39; || window.location.pathname === \u0026#39;/index.html\u0026#39;; } // æ·»åŠ pjax:completeäº‹ä»¶ç›‘å¬ window.onload = function () { if (isHomePage()) { showWelcome(); } document.addEventListener(\u0026#34;pjax:complete\u0026#34;, handlePjaxComplete); }; 2. â•åˆ›å»º welcome.css æ–‡ä»¶ æ–°å»º [BlogRoot]/source/css/welcome.css æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 /* è®¿å®¢å®šä½æ¬¢è¿ä¿¡æ¯ */ #welcome-info { white-space: pre-wrap; background: var(--trans-light); border-radius: 18px; padding: 0px 6px; /* ä¿®æ”¹è¿™é‡Œï¼šå·¦å³å†…è¾¹è·è®¾ä¸º5px */ border: var(--border-style); } [data-theme=\u0026#34;dark\u0026#34;] #welcome-info { background: var(--trans-dark); } 3. â• å¼•å…¥ xxx.jså’Œxxx.css 1 2 3 4 5 6 7 8 9 10 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/welcome.css\u0026#34;\u0026gt; bottom: - \u0026lt;script src=\u0026#34;/js/welcome.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; # ä¸»é¢˜é…ç½®æ–‡ä»¶ card_announcement: enable: true content: \u0026lt;div id=\u0026#34;welcome-info\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; 4. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s ğŸ¾ äºŒåäº”ã€è„šé¡µæ·»åŠ å°åŠ¨ç‰© âœ¨ åŠŸèƒ½ç‰¹ç‚¹ åœ¨é¡µè„šåŒºåŸŸæ·»åŠ å¯çˆ±çš„å°åŠ¨ç‰©è£…é¥°ï¼Œå¢åŠ ç½‘ç«™è¶£å‘³æ€§å’Œäº²å’ŒåŠ›ã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. âœï¸ ä¿®æ”¹é¡µè„šæ¨¡æ¿ï¼š ä½œè€…åšå®¢ï¼š https://blog.qjqq.cn/posts/f69c.html ä¿®æ”¹[BlogRoot]/themes/solitude/layout/includes/footer.pugæ–‡ä»¶ï¼Œæ–°å¢ä»¥ä¸‹ä»£ç ï¼ˆæˆ‘æ˜¯åœ¨æœ«å°¾æ·»åŠ çš„ï¼‰\n1 2 3 4 5 6 7 #footer-animal .animal-wall img.animal( src=\u0026#34;https://cdn.meimolihan.eu.org/hexo/img/color.avif\u0026#34; alt=\u0026#34;åŠ¨ç‰©\u0026#34; onerror=\u0026#34;this.onerror=null;this.src=\u0026#39;/img/404.jpg\u0026#39;\u0026#34; ) æ–°å»º [BlogRoot]/source/css/welcome.css æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 /* è„šé¡µæ·»åŠ å°åŠ¨ç‰© */ #footer-animal { position: relative; width: 100%; margin-top: 20px; /* ä¸ä¸Šæ–¹å†…å®¹é—´éš” */ } #footer-animal .animal-wall { position: absolute; bottom: 0; width: 100%; height: 36px; max-width: none; background: #bcb0a4 url(\u0026#34;https://cdn.meimolihan.eu.org/hexo/img/photo.avif\u0026#34;) repeat center; background-size: auto 100%; box-shadow: 0 4px 7px rgba(0,0,0,.15); } #footer-animal img.animal { position: relative; display: block; width: 100%; max-width: 974px; margin: 0 auto; z-index: 2; /* ç¡®ä¿åœ¨ .animal-wall ä¸Šæ–¹ */ } /* å“åº”å¼è°ƒæ•´ */ @media screen and (max-width: 1023px) { #footer-animal .animal-wall { height: 4vw; } #footer-animal img.animal { max-width: 100%; } } /* ç¡®ä¿é¡µè„šæ•´ä½“æ ·å¼ä¸å—å½±å“ */ #footer-bar { margin-top: 0 !important; } /* å°åŠ¨ç‰©ç§»åŠ¨ */ /* å®¹å™¨ï¼šå›ºå®šåŠ¨ç”»å…ƒç´ çš„å¸ƒå±€ç©ºé—´ */ .animal-container { display: block; width: 120px; /* æ ¹æ®åŠ¨ç”»ä½ç§»èŒƒå›´è°ƒæ•´ */ height: auto; /* ç¡®ä¿é«˜åº¦è¶³å¤Ÿå®¹çº³åŠ¨ç”» */ margin: 0 auto; contain: layout paint; /* éš”ç¦»å¸ƒå±€å’Œç»˜åˆ¶å½±å“ */ perspective: 1000px; /* å¯ç”¨3Dæ¸²æŸ“ä¸Šä¸‹æ–‡ */ } /* åŠ¨ç”»å…ƒç´  */ .animal { animation: sway 3s ease-in-out infinite; display: block; max-width: 100px; margin: 0 auto; position: relative; /* è„±ç¦»æ–‡æ¡£æµï¼Œé¿å…é‡æ’ */ will-change: transform; /* æå‰ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ */ backface-visibility: hidden; /* ä¿®å¤æ¸²æŸ“é—ªçƒ */ transform: translateZ(0); /* å¼ºåˆ¶GPUåŠ é€Ÿ */ } /* å…³é”®å¸§åŠ¨ç”» */ @keyframes sway { 0%, 100% { transform: translateX(-5px) translateZ(0); /* å‡å°ä½ç§»èŒƒå›´ */ } 50% { transform: translateX(5px) translateZ(0); } } /* åœ¨ä½äº1100pxçš„å±å¹•å®½åº¦ä¸‹å…³é—­åŠ¨ç”» */ @media screen and (max-width: 1099px) { .animal { animation: none !important; /* å…³é—­åŠ¨ç”» */ } } 2. â•å¼•å…¥ welcome.css 1 2 3 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/welcome.css\u0026#34;\u0026gt; 3. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s ğŸ“œ äºŒåå…­ã€ä»Šæ—¥è¯—è¯ä¾§è¾¹æ  âœ¨ åŠŸèƒ½ç‰¹ç‚¹ åœ¨ä¾§è¾¹æ æ˜¾ç¤ºéšæœºå¤è¯—è¯ï¼Œæ¯æ—¥æ›´æ–°ï¼Œå¢æ·»æ–‡åŒ–æ°”æ¯ï¼Œæå‡åšå®¢å“å‘³ã€‚\nğŸ”§ å®ç°æ­¥éª¤ 1. â• åˆ›å»ºè¯—è¯ç»„ä»¶ï¼š å¼ æ´ªHeoï¼š https://blog.zhheo.com/p/2ed9d8dd.html ä»Šæ—¥è¯—è¯APIï¼š https://www.jinrishici.com/ åˆ›å»ºç»„ä»¶ ä¸»é¢˜æ–°å»º[BlogRoot]/themes/butterfly/layout/includes/widget/card_poem.pugå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #card-poem.card-widget #poem_sentence #poem_info #poem_dynasty span.dot \u0026lt;!-- æ’å…¥ä¸€ä¸ªå…ƒç´  --\u0026gt; #poem_author script(src=\u0026#39;https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/jinrishici.js\u0026#39;, charset=\u0026#39;utf-8\u0026#39;) script(type=\u0026#39;text/javascript\u0026#39;). jinrishici.load(function(result) { var sentence = document.querySelector(\u0026#34;#poem_sentence\u0026#34;) var author = document.querySelector(\u0026#34;#poem_author\u0026#34;) var dynasty = document.querySelector(\u0026#34;#poem_dynasty\u0026#34;) var sentenceText = result.data.content sentenceText = sentenceText.substr(0, sentenceText.length - 1); sentence.innerHTML = sentenceText dynasty.innerHTML = result.data.origin.dynasty author.innerHTML = result.data.origin.author + \u0026#39;ã€Š\u0026#39; + result.data.origin.title + \u0026#39;ã€‹\u0026#39; }); 2. ğŸ”¨ é…ç½®ä¾§è¾¹æ å¸ƒå±€ å¼•å…¥ç»„ä»¶ åœ¨ [BlogRoot]/themes/butterfly/layout/includes/widget/index.pug ä¸­ä½ éœ€è¦çš„ä½ç½®æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 !=partial(\u0026#39;includes/widget/card_poem\u0026#39;, {}, {cache: true}) å¡«å†™ç¤ºä¾‹ï¼Œå¯ä»¥åœ¨ä¿©ä¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #aside-content.aside-content //- post if is_post() - const tocStyle = page.toc_style_simple - const tocStyleVal = tocStyle === true || tocStyle === false ? tocStyle : theme.toc.style_simple if showToc \u0026amp;\u0026amp; tocStyleVal .sticky_layout include ./card_post_toc.pug else !=partial(\u0026#39;includes/widget/card_author\u0026#39;, {}, {cache: true}) + !=partial(\u0026#39;includes/widget/card_poem\u0026#39;, {}, {cache: true}) !=partial(\u0026#39;includes/widget/card_announcement\u0026#39;, {}, {cache: true}) !=partial(\u0026#39;includes/widget/card_top_self\u0026#39;, {}, {cache: true}) .sticky_layout if showToc include ./card_post_toc.pug !=partial(\u0026#39;includes/widget/card_weibo\u0026#39;, {}, {cache: true}) !=partial(\u0026#39;includes/widget/card_recent_post\u0026#39;, {}, {cache: true}) !=partial(\u0026#39;includes/widget/card_ad\u0026#39;, {}, {cache: true}) else //- page !=partial(\u0026#39;includes/widget/card_author\u0026#39;, {}, {cache: true}) + !=partial(\u0026#39;includes/widget/card_poem\u0026#39;, {}, {cache: true}) !=partial(\u0026#39;includes/widget/card_announcement\u0026#39;, {}, {cache: true}) !=partial(\u0026#39;includes/widget/card_top_self\u0026#39;, {}, {cache: true}) åˆ›å»º Hexoæ ¹ç›®å½•/source/css/custom.css æ–‡ä»¶ï¼Œå°†ä»£ç å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 #card-poem { display: flex; flex-direction: column; padding: 0.5rem!important; min-height: 130px; } div#poem_sentence { text-align: center; font-family: serif,cursive; line-height: 1.9; margin-bottom: 0.66rem; /* è¯—è¯ä¸ä½œè€… é—´è·è°ƒæ•´ */ padding: 1rem; border-radius: 15px; background: var(--trans-light); min-height: 62px; color: var(--theme-color); } [data-theme=dark] div#poem_sentence { background: var(--trans-dark); } /* æœä»£ */ div#poem_dynasty { order: 0; padding: 1px 5px 5px 6px; background: var(--trans-light); color: var(--font-color); border-radius: 8px; font-size: 15px; } [data-theme=dark] div#poem_dynasty { background: var(--trans-dark); } /* è¯—è¯ä½œè€…å’Œåå­— */ div#poem_info { display: flex; color: var(--font-color); font-size: 0.5rem; justify-content: center; flex-wrap: wrap; font-size: 11px; } div#poem_author { order: 1; padding: 6px; margin-left: 12px; background: var(--trans-light); border-radius: 8px; } [data-theme=dark] div#poem_author { background: var(--trans-dark); } /* å°ç‚¹çš„æ ·å¼ */ div#poem_info .dot { width: 6px; /* å°ç‚¹çš„å®½åº¦ */ height: 6px; /* å°ç‚¹çš„é«˜åº¦ */ background-color: var(--theme-color); /* å°ç‚¹çš„é¢œè‰²ï¼Œä½¿ç”¨ CSS å˜é‡ */ border-radius: 50%; /* å°†å°ç‚¹å˜æˆåœ†å½¢ */ position: relative; /* ä½¿ç”¨ç›¸å¯¹å®šä½ */ transform: translate(6px, 15px); /* å‘å³ç§»åŠ¨ 10 åƒç´ ï¼Œå‘ä¸‹ç§»åŠ¨ 5 åƒç´  */ } 2. â•å¼•å…¥ custom.css åœ¨ _config.butterfly.yml æ–‡ä»¶ä¸­æ‰¾åˆ° inject éƒ¨åˆ†ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 1 2 3 inject: head: - \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/custom.css\u0026#34;\u0026gt; 3. ğŸš€ æ¸…ç†å¹¶é‡å¯é¡¹ç›®ï¼š 1 hexo clean; hexo g; hexo s ğŸ“‹äºŒåä¸ƒã€å¤åˆ¶å¼¹çª—æé†’ ä¿®æ”¹ _config.butterfly.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Snackbar - Toast å¤åˆ¶æé†’é€šçŸ¥ # https://github.com/polonel/SnackBar # top-left # é€šçŸ¥ä½ç½®ï¼šå±å¹•å·¦ä¸Šè§’ï¼ˆé»˜è®¤ä½ç½®ï¼‰ # top-center\t# é€šçŸ¥ä½ç½®ï¼šå±å¹•é¡¶éƒ¨å±…ä¸­ # top-right # é€šçŸ¥ä½ç½®ï¼šå±å¹•å³ä¸Šè§’ # bottom-left # é€šçŸ¥ä½ç½®ï¼šå±å¹•å·¦ä¸‹è§’ # bottom-center\t# é€šçŸ¥ä½ç½®ï¼šå±å¹•åº•éƒ¨å±…ä¸­ # bottom-right\t# é€šçŸ¥ä½ç½®ï¼šå±å¹•å³ä¸‹è§’ snackbar: enable: true # æ˜¯å¦å¯ç”¨ Snackbar position: top-center # é€šçŸ¥ä½ç½®ï¼šå±å¹•é¡¶éƒ¨å±…ä¸­ # æµ…è‰²æ¨¡å¼å’Œæ·±è‰²æ¨¡å¼ä¸‹çš„é€šçŸ¥èƒŒæ™¯é¢œè‰² bg_light: \u0026#39;#BDB76B\u0026#39; bg_dark: \u0026#39;#BDB76B\u0026#39; âœ¨ äºŒåå…«ã€ç•™è¨€æ¿ Violet é£æ ¼ hexo-butterfly-envelope æ˜¯ä¸€æ¬¾ä¸“ä¸º Butterfly ä¸»é¢˜è®¾è®¡çš„ç•™è¨€æ¿æ’ä»¶ã€‚å®ƒä»¥å…¶ç‹¬ç‰¹çš„ä¿¡å°æŠ½æ‹‰åŠ¨ç”»å’Œä¼˜é›…çš„ç´«ç½—å…°ï¼ˆVioletï¼‰é£æ ¼è®¾è®¡è€Œå¤‡å—é’çã€‚\n1.ğŸ“¦ å®‰è£…æ’ä»¶ åœ¨åšå®¢æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æ’ä»¶ï¼š\n1 npm install hexo-butterfly-envelope --save 2. âš™ï¸ é…ç½®èœå• åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.butterfly.yml ä¸­ï¼Œä¸º menu é¡¹æ·»åŠ ã€ç•™è¨€æ¿ã€‘æ¡ç›®ï¼Œå¹¶æŒ‡å®šå…¶å›¾æ ‡ã€‚\n1 2 3 4 5 6 7 menu: é¦–é¡µ: / || icon-zhuye || faa-tada æ–‡ç«  || icon-wenzhang || faa-tada || hide: æ ‡ç­¾: /tags/ || icon-biaoqian || faa-tada åˆ†ç±»: /categories/ || icon-fenlei || faa-tada ç•™è¨€æ¿: /comments/ || fas fa-envelope # æ–°å¢æ­¤è¡Œ å…³äº: /about/ || icon-guanyu1 || faa-tada 3. ğŸ”§ é…ç½®è¯¦è§£ ä»¥ä¸‹æ‰€æœ‰é…ç½®å‡éœ€æ·»åŠ åˆ°ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.butterfly.yml ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # see https://akilar.top/posts/e2d3c450/ envelope_comment: enable: true #æ§åˆ¶å¼€å…³ custom_pic: cover: https://cdn.meimolihan.eu.org/hexo/violet/violet.webp #ä¿¡ç¬ºå¤´éƒ¨å›¾ç‰‡ line: https://cdn.meimolihan.eu.org/hexo/violet/line.png #ä¿¡ç¬ºåº•éƒ¨å›¾ç‰‡ beforeimg: https://cdn.meimolihan.eu.org/hexo/violet/before.png # ä¿¡å°å‰åŠéƒ¨åˆ† afterimg: https://cdn.meimolihan.eu.org/hexo/violet/after.png # ä¿¡å°ååŠéƒ¨åˆ† message: #ä¿¡ç¬ºæ­£æ–‡ï¼Œå¤šè¡Œæ–‡æœ¬ï¼Œå†™æ³•å¦‚ä¸‹ - æœ‰ä»€ä¹ˆæƒ³é—®çš„ï¼Ÿ - æœ‰ä»€ä¹ˆæƒ³è¯´çš„ï¼Ÿ - æœ‰ä»€ä¹ˆæƒ³åæ§½çš„ï¼Ÿ - å“ªæ€•æ˜¯æœ‰ä»€ä¹ˆæƒ³åƒçš„ï¼Œéƒ½å¯ä»¥å‘Šè¯‰æˆ‘å“¦~ bottom: è‡ªåŠ¨ä¹¦è®°äººå¶ç«­è¯šä¸ºæ‚¨æœåŠ¡ï¼ #ä»…æ”¯æŒå•è¡Œæ–‡æœ¬ height: 1050px # ä¿¡å°åˆ’å‡ºçš„é«˜åº¦ï¼Œå¯æ ¹æ®å†…å®¹å¤šå°‘è°ƒæ•´ path: comments # ã€å¯é€‰ã€‘ç•™è¨€æ¿é¡µé¢çš„è·¯å¾„åç§°ã€‚é»˜è®¤ä¸º commentsï¼Œè®¿é—®åœ°å€æ˜¯ /comments/ front_matter: # ã€å¯é€‰ã€‘ä¸ºç•™è¨€æ¿é¡µé¢è®¾ç½®å•ç‹¬çš„ Front Matter title: ç•™è¨€æ¿ comments: true # ç¡®ä¿æ­¤é¡µé¢çš„è¯„è®ºåŠŸèƒ½æ˜¯å¼€å¯çš„ 4. ğŸŒ CDN é…ç½®æ¨è ä¸ºäº†åŠ é€Ÿå›¾ç‰‡åŠ è½½ï¼Œå»ºè®®ä½¿ç”¨ CDN æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§æ¨èçš„é…ç½®æ–¹æ¡ˆã€‚\nğŸš€ jsDelivr CDN jsDelivr æ˜¯ä¸€ä¸ªå…è´¹çš„å…¬å…± CDNï¼Œé€Ÿåº¦å¿«ä¸”ç¨³å®šï¼Œéå¸¸é€‚åˆå¼€æºé¡¹ç›®ã€‚ï¼ˆæ¨èä½¿ç”¨ï¼‰\n1 2 3 4 5 custom_pic: cover: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo/violet/violet.webp line: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo/violet/line.png beforeimg: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo/violet/before.png afterimg: https://cdn.jsdelivr.net/gh/meimolihan/cdn@v1.0.0/hexo/violet/after.png ğŸ¦„ Vercel CDN å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨è‡ªå·±çš„å›¾åºŠï¼Œå¯ä»¥å°†å›¾ç‰‡éƒ¨ç½²åˆ° Vercel ç­‰å¹³å°ï¼Œè·å¾—æ›´è‡ªä¸»çš„æ§åˆ¶æƒã€‚\n1 2 3 4 5 custom_pic: cover: https://cdn.meimolihan.eu.org/hexo/violet/violet.webp #ä¿¡ç¬ºå¤´éƒ¨å›¾ç‰‡ line: https://cdn.meimolihan.eu.org/hexo/violet/line.png #ä¿¡ç¬ºåº•éƒ¨å›¾ç‰‡ beforeimg: https://cdn.meimolihan.eu.org/hexo/violet/before.png # ä¿¡å°å‰åŠéƒ¨åˆ† afterimg: https://cdn.meimolihan.eu.org/hexo/violet/after.png # ä¿¡å°ååŠéƒ¨åˆ† ğŸ¢ å®˜æ–¹ CDN æ’ä»¶ä¹Ÿæä¾›äº†ç”± npm åˆ†å‘çš„å®˜æ–¹å›¾ç‰‡é“¾æ¥ï¼Œä½œä¸ºå¤‡é€‰æ–¹æ¡ˆã€‚\n1 2 3 4 5 custom_pic: cover: https://npm.elemecdn.com/hexo-butterfly-envelope/lib/violet.jpg line: https://npm.elemecdn.com/hexo-butterfly-envelope/lib/line.png beforeimg: https://npm.elemecdn.com/hexo-butterfly-envelope/lib/before.png afterimg: https://npm.elemecdn.com/hexo-butterfly-envelope/lib/after.png äºŒåä¹ ã€ğŸ“– æ–‡ç« ç½®é¡¶è½®æ’­å›¾ ğŸš€ æç¤ºï¼šæœ¬æ’ä»¶åŸºäºButterflyä¸»é¢˜æ·±åº¦å®šåˆ¶ï¼Œå®‰è£…åæ— éœ€é¢å¤–æ ·å¼è°ƒæ•´å³å¯å®Œç¾èå…¥æ‚¨çš„åšå®¢è®¾è®¡ã€‚ ğŸ”— æ’ä»¶ä½œè€…ï¼šAkilar\nğŸŒ æ¥æºï¼š https://akilar.top/posts/8e1264d1/ ğŸ“¦ å®‰è£…æ­¥éª¤ åœ¨åšå®¢æ ¹ç›®å½•[Blogroot]ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹å®‰è£…æŒ‡ä»¤ï¼š\n1 npm install hexo-butterfly-swiper --save âš™ï¸ é…ç½®è¯´æ˜ åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlæˆ–è€…ä¸»é¢˜é…ç½®æ–‡ä»¶_config.butterfly.ymlä¸­æ·»åŠ ä»¥ä¸‹é…ç½®æ®µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # hexo-butterfly-swiper # è¯¦ç»†æ•™ç¨‹è¯·å‚è€ƒï¼šhttps://akilar.top/posts/8e1264d1/ swiper: enable: true # åŠŸèƒ½å¼€å…³ priority: 5 # è¿‡æ»¤å™¨ä¼˜å…ˆæƒ enable_page: all # åº”ç”¨é¡µé¢ timemode: date # æ—¶é—´æ˜¾ç¤ºæ¨¡å¼ï¼šdate/updated layout: # æŒ‚è½½å®¹å™¨é…ç½® type: id name: recent-posts index: 0 default_descr: å†æ€ä¹ˆçœ‹æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæè¿°å®ƒçš„å•¦ï¼ # é»˜è®¤æ–‡ç« æè¿° swiper_css: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css # swiper cssä¾èµ– swiper_js: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js # swiper jsä¾èµ– custom_css: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css # é€‚é…ä¸»é¢˜æ ·å¼è¡¥ä¸ custom_js: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js # swiperåˆå§‹åŒ–æ–¹æ³• ğŸ”§ å‚æ•°è¯¦è§£ å‚æ•° å¤‡é€‰å€¼/ç±»å‹ é‡Šä¹‰ priority number ã€å¯é€‰ã€‘è¿‡æ»¤å™¨ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ï¼Œæ‰§è¡Œè¶Šæ—©ï¼Œé»˜è®¤ä¸º10 enable true/false ã€å¿…é€‰ã€‘åŠŸèƒ½æ§åˆ¶å¼€å…³ enable_page path/all ã€å¯é€‰ã€‘å¡«å†™æƒ³è¦åº”ç”¨çš„é¡µé¢çš„ç›¸å¯¹è·¯å¾„ï¼ˆå³è·¯ç”±åœ°å€ï¼‰ã€‚å¦‚æ ¹ç›®å½•å¡«\u0026rsquo;/\u0026rsquo;ï¼Œåˆ†ç±»é¡µé¢å¡«\u0026rsquo;/categories/\u0026rsquo;ã€‚å¡«\u0026rsquo;all\u0026rsquo;åº”ç”¨äºæ‰€æœ‰é¡µé¢ timemode date/updated ã€å¯é€‰ã€‘æ—¶é—´æ˜¾ç¤ºæ¨¡å¼ï¼Œdateä¸ºåˆ›å»ºæ—¥æœŸï¼Œupdatedä¸ºæ›´æ–°æ—¥æœŸ layout.type id/class ã€å¯é€‰ã€‘æŒ‚è½½å®¹å™¨ç±»å‹ï¼Œå¡«å†™idæˆ–classï¼Œé»˜è®¤ä¸ºid layout.name text ã€å¿…é€‰ã€‘æŒ‚è½½å®¹å™¨åç§° layout.index 0å’Œæ­£æ•´æ•° ã€å¯é€‰ã€‘å½“layout.typeä¸ºclassæ—¶ä½¿ç”¨ï¼ŒæŒ‡å®šåŒçº§classä¸­çš„é¡ºä½ default_descr text ã€å¯é€‰ã€‘é»˜è®¤æ–‡ç« æè¿°æ–‡æœ¬ swiper_css url ã€å¯é€‰ã€‘è‡ªå®šä¹‰swiperçš„CSSä¾èµ–é“¾æ¥ swiper_js url ã€å¯é€‰ã€‘è‡ªå®šä¹‰swiperçš„JSä¾èµ–é“¾æ¥ custom_css url ã€å¯é€‰ã€‘ä¸»é¢˜é€‚é…æ ·å¼è¡¥ä¸ custom_js url ã€å¯é€‰ã€‘swiperåˆå§‹åŒ–æ–¹æ³•è„šæœ¬ ğŸ“ ä½¿ç”¨æ–¹æ³• åœ¨éœ€è¦ç½®é¡¶çš„æ–‡ç« çš„front-matterä¸­æ·»åŠ swiper_indexé…ç½®é¡¹ï¼š\n1 2 3 4 5 6 7 8 --- title: æ–‡ç« æ ‡é¢˜ date: åˆ›å»ºæ—¥æœŸ updated: æ›´æ–°æ—¥æœŸ cover: æ–‡ç« å°é¢ description: æ–‡ç« æè¿° swiper_index: 1 # ç½®é¡¶è½®æ’­å›¾é¡ºåºï¼Œéè´Ÿæ•´æ•°ï¼ˆ0,1,2,...ï¼‰ï¼Œæ•°å­—è¶Šå¤§è¶Šé å‰ --- ğŸ’« æ€»ç»“ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†26ç§Hexoåšå®¢ç¾åŒ–æŠ€å·§ï¼Œä»åŸºç¡€çš„æ ·å¼ä¿®æ”¹åˆ°é«˜çº§çš„äº¤äº’æ•ˆæœï¼Œå…¨æ–¹ä½æå‡åšå®¢çš„è§†è§‰ä½“éªŒå’Œç”¨æˆ·ä½“éªŒã€‚\nğŸ”§ ä½¿ç”¨å»ºè®® æŒ‰éœ€å¯ç”¨ï¼šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„åŠŸèƒ½ é€æ­¥æµ‹è¯•ï¼šæ¯æ¬¡åªæ·»åŠ ä¸€ä¸ªåŠŸèƒ½å¹¶è¿›è¡Œæµ‹è¯• å®šæœŸå¤‡ä»½ï¼šä¿®æ”¹å‰å¤‡ä»½åŸå§‹æ–‡ä»¶ è‡ªå®šä¹‰è°ƒæ•´ï¼šæ ¹æ®ä¸ªäººå–œå¥½è°ƒæ•´å‚æ•°å’Œæ ·å¼ ğŸ“š å­¦ä¹ èµ„æº Hexoå®˜æ–¹æ–‡æ¡£ Butterflyä¸»é¢˜æ–‡æ¡£ CSSåŠ¨ç”»æŒ‡å— å­—ä½“å›¾æ ‡åº“ ğŸ‰ ç¥ä½ çš„åšå®¢ç¾åŒ–ä¹‹æ—…é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºã€‚\n","date":"2025-09-13T10:40:46+08:00","image":"https://file.meimolihan.eu.org/img/hexo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/6d95982f/","title":"Hexo + Butterfly ä¸»é¢˜ç¾åŒ–æŒ‡å— ğŸ¨"},{"content":"Hexo + Butterfly åšå®¢æ­å»ºæŒ‡å— ğŸ¨ âœ¨ ç‰¹åˆ«è¯´æ˜\næ¬¢è¿è®¿é—®** æœ¬ç«™ **ï¼æœ¬åšå®¢åŸºäº Hexo é™æ€æ¡†æ¶ + Butterfly ä¸»é¢˜æ„å»ºï¼Œå…¼å…·ç®€æ´ç¾è§‚ä¸å¼ºå¤§åŠŸèƒ½ã€‚\nğŸ“Œ æœ¬ç«™å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸æ‰¿æ‹…å› ç‰ˆæœ¬å·®å¼‚å¯¼è‡´çš„é—®é¢˜ã€‚å·²é€‚é…ç‰ˆæœ¬ï¼š\nHexo 7.3.0 Butterfly 5.5.0 ğŸ“‘ å¯¼èˆªç›®å½• ğŸ› ï¸ ä¸€ã€ä¸‹è½½å®‰è£…åŸºç¡€è¿è¡Œç¨‹åº âš™ï¸ äºŒã€å®‰è£… Hexo ğŸ”§ ä¸‰ã€Hexo å¸¸ç”¨å‘½ä»¤ ğŸ¨ å››ã€å®‰è£…ä¸é…ç½® Butterfly ä¸»é¢˜ ğŸ§­ äº”ã€è®¾ç½®å¯¼èˆªèœå• âœ¨ å…­ã€åŠ¨æ€ç‰¹æ•ˆä¸åŠŸèƒ½å¢å¼º ğŸ“Š ä¸ƒã€æ•°æ®ç»Ÿè®¡ä¸æœç´¢ ğŸ–¼ï¸ å…«ã€éšæœºå°é¢å›¾ API ğŸ’« ä¹ã€å‰¯æ ‡é¢˜ä¸ä¾§è¾¹æ ä¼˜åŒ– ğŸ”— åã€æ°¸ä¹…é“¾æ¥ç”Ÿæˆ ğŸ”„ åä¸€ã€åšå®¢è¿ç§»æŒ‡å— ğŸ“¦ åäºŒã€æ’ä»¶åˆ—è¡¨ä¸å‡çº§æŒ‡å— ğŸ› ï¸ ä¸€ã€ä¸‹è½½å®‰è£…åŸºç¡€è¿è¡Œç¨‹åº æ­å»ºåšå®¢å‰ï¼Œéœ€å®‰è£…ä»¥ä¸‹åŸºç¡€å·¥å…·ï¼š\nGitï¼š ä¸‹è½½åœ°å€ ğŸ“Œ å®‰è£…æ—¶æ³¨æ„å‹¾é€‰â€œAdd Git Bash Hereâ€å’Œâ€œAdd to PATHâ€é€‰é¡¹ã€‚ Node.jsï¼š ä¸‹è½½åœ°å€ ğŸ“Œ å»ºè®®é€‰æ‹© LTS ç‰ˆæœ¬ï¼Œç¡®ä¿ç¯å¢ƒç¨³å®šæ€§ã€‚ ğŸ”„ åˆ‡æ¢æ·˜å®é•œåƒåŠ é€Ÿ 1 2 3 npm config set registry http://registry.npm.taobao.org/ # éªŒè¯æ˜¯å¦åˆ‡æ¢æˆåŠŸ npm get registry ğŸ”§ å¦‚éœ€åˆ‡æ¢å›å®˜æ–¹æºï¼š\n1 npm config set registry https://registry.npmmirror.com/ âš™ï¸ äºŒã€å®‰è£… Hexo ğŸŒ å…¨å±€å®‰è£… Hexo CLI 1 npm install -g hexo-cli ğŸ“¦ å±€éƒ¨å®‰è£…ï¼ˆå¯é€‰ï¼‰ 1 npm install hexo ğŸ”„ å‡çº§ Hexo 1 npm update hexo -g æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ 1 npm list hexo ğŸ”§ ä¸‰ã€Hexo å¸¸ç”¨å‘½ä»¤ 1. åˆå§‹åŒ–åšå®¢ 1 2 hexo init blog # åˆ›å»ºåä¸º blog çš„ç›®å½•å¹¶åˆå§‹åŒ– cd blog \u0026amp;\u0026amp; npm install # è¿›å…¥ç›®å½•å¹¶å®‰è£…ä¾èµ– 2. å¸¸ç”¨å‘½ä»¤ç»„åˆ ç»„åˆå‘½ä»¤ è¯´æ˜ hexo clean \u0026amp;\u0026amp; hexo g \u0026amp;\u0026amp; hexo s æ¸…é™¤ç¼“å­˜ â†’ ç”Ÿæˆé™æ€æ–‡ä»¶ â†’ å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼ˆæ¨èï¼‰ hexo clean \u0026amp;\u0026amp; hexo g \u0026amp;\u0026amp; hexo d æ¸…é™¤ç¼“å­˜ â†’ ç”Ÿæˆé™æ€æ–‡ä»¶ â†’ éƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“ hexo clean \u0026amp;\u0026amp; hexo g -d æ¸…é™¤ç¼“å­˜åç›´æ¥ç”Ÿæˆå¹¶éƒ¨ç½²ï¼ˆç®€åŒ–ç‰ˆï¼‰ hexo new \u0026quot;æ–‡ç« æ ‡é¢˜\u0026quot; \u0026amp;\u0026amp; hexo s åˆ›å»ºæ–°æ–‡ç« åç«‹å³å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨é¢„è§ˆ hexo clean \u0026amp;\u0026amp; hexo g \u0026amp;\u0026amp; hexo s -p 5000 æ¸…é™¤ç¼“å­˜ â†’ ç”Ÿæˆ â†’ åœ¨æŒ‡å®šç«¯å£(5000)å¯åŠ¨æœåŠ¡å™¨ ğŸ¨ å››ã€å®‰è£…ä¸é…ç½® Butterfly ä¸»é¢˜ 1. å…‹éš†ä¸»é¢˜ä»“åº“ 1 git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly 2. å®‰è£…æ¸²æŸ“å™¨ 1 npm install hexo-renderer-pug hexo-renderer-stylus --save 3. å¯ç”¨ä¸»é¢˜ ä¿®æ”¹æ ¹ç›®å½• _config.ymlï¼š\n1 theme: butterfly 4. ä¸»é¢˜é…ç½®ä¼˜åŒ– å°†ä¸»é¢˜é…ç½®æ–‡ä»¶ themes/butterfly/_config.yml ç§»åŠ¨è‡³æ ¹ç›®å½•å¹¶é‡å‘½åä¸º _config.butterfly.ymlï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ã€‚\nğŸ§­ äº”ã€è®¾ç½®å¯¼èˆªèœå• 1. é…ç½®èœå•é¡¹ ç¼–è¾‘ _config.butterfly.yml 1 2 3 4 5 6 7 8 menu: ä¸»é¡µ: / || fas fa-home æ ‡ç­¾: /tags/ || fa fa-tags åˆ†ç±»: /categories/ || fa fa-archive å½’æ¡£: /archives/ || fa fa-folder-open å‹é“¾: /link/ || fa fa-link å…³äº: /about/ || fas fa-heart ç•™è¨€æ¿: /comment/ || fa fa-paper-plane 2. åˆ›å»ºèœå•é¡µé¢ ä½¿ç”¨ Hexo é¡µé¢ç”Ÿæˆå‘½ä»¤ï¼š\n1 2 3 4 5 6 hexo new page tags # åˆ›å»ºâ€œæ ‡ç­¾â€é¡µé¢ hexo new page categories # åˆ›å»ºâ€œåˆ†ç±»â€é¡µé¢ hexo new page archives # åˆ›å»ºâ€œå½’æ¡£â€é¡µé¢ hexo new page link # åˆ›å»ºâ€œå‹é“¾â€é¡µé¢ hexo new page about # åˆ›å»ºâ€œå…³äºâ€é¡µé¢ hexo new page comment # åˆ›å»ºâ€œç•™è¨€æ¿â€é¡µé¢ 3. å‹é“¾æ•°æ®é…ç½® åœ¨ source/_data/link.yml ä¸­é…ç½®å‹é“¾ä¿¡æ¯ï¼ˆç¤ºä¾‹ï¼‰ï¼š\n1 2 3 4 5 6 7 - class_name: å‹æƒ…é“¾æ¥ class_desc: é‚£äº›äººï¼Œé‚£äº›äº‹ link_list: - name: Hexo link: https://hexo.io/zh-tw/ avatar: https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg descr: å¿«é€Ÿã€ç®€å•ä¸”å¼ºå¤§çš„ç½‘å¿—æ¡†æ¶ 4. æ–‡ç« æ¨¡æ¿ä¼˜åŒ– ç¼–è¾‘ scaffolds/post.md å¯è‡ªå®šä¹‰æ–‡ç«  Front Matterï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 --- title: {{ title }} date: {{ date }} description: {{ description }} top_img: {{ top_img }} sticky: {{ sticky }} categories: - tags: - cover: {{ cover }} updated: {{ date }} --- âœ¨ å…­ã€åŠ¨æ€ç‰¹æ•ˆä¸åŠŸèƒ½å¢å¼º 1. åŠ¨æ€å½©å¸¦æ•ˆæœ 1 2 3 canvas_fluttering_ribbon: enable: true mobile: false # ç§»åŠ¨ç«¯ç¦ç”¨ 2. é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ 1 2 3 4 fireworks: enable: false # å¯å¼€å¯çƒŸèŠ±ç‰¹æ•ˆ zIndex: 9999 mobile: false 3. é¡µé¢åŠ è½½åŠ¨ç”» 1 2 3 preloader: enable: true source: 1 # 1=å…¨å±åŠ è½½åŠ¨ç”»ï¼Œ2=è¿›åº¦æ¡ ğŸ“Š ä¸ƒã€æ•°æ®ç»Ÿè®¡ä¸æœç´¢ 1. å­—æ•°ç»Ÿè®¡æ’ä»¶ 1 npm install hexo-wordcount --save or yarn add hexo-wordcount é…ç½®ä¸»é¢˜æ–‡ä»¶ï¼š\n1 2 3 4 5 wordcount: enable: true post_wordcount: true # æ–‡ç« å­—æ•° min2read: true # é˜…è¯»æ—¶é—´ total_wordcount: true # æ€»å­—æ•°ç»Ÿè®¡ 2. æœ¬åœ°æœç´¢åŠŸèƒ½ å®‰è£…æœç´¢æ’ä»¶ 1 npm install hexo-generator-search --save åœ¨ _config.yml ä¸»é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  1 2 3 4 5 search: path: search.xml field: post format: html limit: 10000 åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®ä¸­å¯ç”¨ 1 2 3 use: local_search local_search: enable: true ğŸ–¼ï¸ å…«ã€éšæœºå°é¢å›¾ API 1. åˆ›å»ºéšæœºå›¾è„šæœ¬ åœ¨ themes/butterfly/scripts/ ä¸‹åˆ›å»º random_img.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /** * Butterfly * random cover */ \u0026#39;use strict\u0026#39; // æå–æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºå¸¸é‡ï¼Œé¿å…æ¯æ¬¡è°ƒç”¨æ—¶éƒ½é‡æ–°åˆ›å»º const IMG_TEST_REG = /\\.(png|jpe?g|gif|svg|webp)(\\?.*)?$/; // æ³¨å†Œè¿‡æ»¤å™¨ï¼Œåœ¨æ–‡ç« æ¸²æŸ“å‰å¤„ç†æ–‡ç« æ•°æ® hexo.extend.filter.register(\u0026#39;before_post_render\u0026#39;, function (data) { const { config } = this; const { post_asset_folder } = config; // å¦‚æœå¯ç”¨äº†æ–‡ç« èµ„æºæ–‡ä»¶å¤¹ if (post_asset_folder) { processImagePath(data, \u0026#39;top_img\u0026#39;); processImagePath(data, \u0026#39;cover\u0026#39;); } // å¦‚æœæ–‡ç« çš„ cover ä¸º falseï¼Œä½¿ç”¨éšæœºå°é¢ if (data.cover === false) { data.randomcover = getRandomCover(); } else { // å¦åˆ™ï¼Œä½¿ç”¨æ–‡ç« çš„ cover æˆ–è€…éšæœºå°é¢ data.cover = data.cover || getRandomCover(); } return data; }, 0); // å¤„ç†å›¾ç‰‡è·¯å¾„çš„å‡½æ•° function processImagePath(data, key) { const image = data[key]; if (image \u0026amp;\u0026amp; image.indexOf(\u0026#39;/\u0026#39;) === -1 \u0026amp;\u0026amp; IMG_TEST_REG.test(image)) { data[key] = data.path + image; } } // è·å–éšæœºå°é¢çš„å‡½æ•° function getRandomCover() { const theme = hexo.theme.config; let cover; let num; const defaultCovers = theme.cover \u0026amp;\u0026amp; theme.cover.default_cover; if (defaultCovers) { if (!Array.isArray(defaultCovers)) { cover = defaultCovers; } else { num = Math.floor(Math.random() * defaultCovers.length); cover = defaultCovers[num]; } } else { cover = theme.default_top_img || \u0026#39;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\u0026#39;; } // æ ¹æ®é…ç½®æ·»åŠ éšæœºåç¼€ if (theme.cover \u0026amp;\u0026amp; theme.cover.suffix) { const randomValue = Math.ceil(Math.random() * 10000); if (theme.cover.suffix === 1) { cover += `?${randomValue}`; } else if (theme.cover.suffix === 2) { cover += `\u0026amp;${randomValue}`; } } return cover; } 2. é…ç½®å°é¢è®¾ç½® åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®ä¸­ä¿®æ”¹ 1 2 3 4 5 6 7 8 cover: index_enable: true aside_enable: true archives_enable: true position: both suffix: 1 default_cover: - https://api.mobufan.eu.org:666 # éšæœºå›¾API ğŸ’« ä¹ã€å‰¯æ ‡é¢˜ä¸ä¾§è¾¹æ ä¼˜åŒ– 1. åŠ¨æ€å‰¯æ ‡é¢˜è®¾ç½® _config.butterfly.yml 1 2 3 4 5 6 7 subtitle: enable: true effect: true # æ‰“å­—æœºæ•ˆæœ source: 1 # è°ƒç”¨ä¸€è¨€API sub: - ä½ åœ¨æŠ±æ€¨ä»€ä¹ˆå‘¢ - ä¸ºæ˜å¤©åˆ°æ¥çš„äº‹ï¼Œè¯´äººç”Ÿåƒæ˜¯æ²¡æœ‰æ„ä¹‰ 2. ä¾§è¾¹æ é…ç½® _config.butterfly.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # -------------------------------------- # ä¾§è¾¹æ è®¾ç½® # -------------------------------------- aside: enable: true # å¯ç”¨ä¾§è¾¹æ  hide: false # é»˜è®¤ä¸éšè— button: true # æ˜¾ç¤ºéšè—ä¾§è¾¹æ çš„æŒ‰é’®ï¼ˆå³ä¸‹è§’ï¼‰ mobile: true # åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ç”¨ position: right # ä¾§è¾¹æ ä½ç½®ï¼šleft / right # é¡µé¢æ˜¾ç¤ºè®¾ç½® display: archive: true # åœ¨å½’æ¡£é¡µé¢æ˜¾ç¤º tag: true # åœ¨æ ‡ç­¾é¡µé¢æ˜¾ç¤º category: true # åœ¨åˆ†ç±»é¡µé¢æ˜¾ç¤º # ä½œè€…ä¿¡æ¯å¡ç‰‡ card_author: enable: true # æ˜¾ç¤ºä½œè€…å¡ç‰‡ description: # ä½œè€…æè¿° button: enable: true # æ˜¾ç¤ºæŒ‰é’® icon: fab fa-github # æŒ‰é’®å›¾æ ‡ text: GitHub # æŒ‰é’®æ–‡æœ¬ link: https://github.com/meimolihan # æŒ‰é’®é“¾æ¥ # å…¬å‘Šå¡ç‰‡ card_announcement: enable: true # æ˜¾ç¤ºå…¬å‘Šå¡ç‰‡ content: \u0026lt;center\u0026gt;\u0026lt;b\u0026gt;--- ä¸»åŸŸå ---\u0026lt;br\u0026gt;\u0026lt;a href=\u0026#34;https://www.meimolihan.eu.org\u0026#34; title=\u0026#34;æ­¤çº¿è·¯éƒ¨ç½²äºVercel\u0026#34; class=\u0026#34;anno_content\u0026#34;\u0026gt;\u0026lt;font color=\u0026#34;#5ea6e5\u0026#34;\u0026gt;www.meimolihan.eu.org\u0026lt;/font\u0026gt;\u0026lt;/a\u0026gt;\u0026amp;nbsp;|\u0026amp;nbsp;\u0026lt;a href=\u0026#34;https://meimolihan.eu.org\u0026#34; title=\u0026#34;æ­¤çº¿è·¯éƒ¨ç½²äºVercel\u0026#34; class=\u0026#34;anno_content\u0026#34;\u0026gt;\u0026lt;font color=\u0026#34;#5ea6e5\u0026#34;\u0026gt;meimolihan.eu.org\u0026lt;/font\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/b\u0026gt;\u0026lt;/center\u0026gt; ğŸ”— åã€æ°¸ä¹…é“¾æ¥ç”Ÿæˆ æ’ä»¶é“¾æ¥: xo-abbrlink 1. å®‰è£… abbrlink æ’ä»¶ 1 npm install hexo-abbrlink --save 2. é…ç½®æ°¸ä¹…é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 permalink_defaults: # é»˜è®¤æ°¸ä¹…é“¾æ¥æ ¼å¼ permalink: posts/:abbrlink.html # abbrlink æ–‡ç« ç¼©å†™é“¾æ¥ç”Ÿæˆé…ç½® abbrlink: alg: crc32 # ç”Ÿæˆç®—æ³•ï¼šå¯é€‰ crc16ï¼ˆé»˜è®¤ï¼‰æˆ– crc32 rep: hex # é“¾æ¥æ ¼å¼ï¼šdecï¼ˆåè¿›åˆ¶ï¼‰æˆ– hexï¼ˆåå…­è¿›åˆ¶ï¼‰ drafts: false # æ˜¯å¦å¤„ç†è‰ç¨¿æ–‡ç«  auto_category: enable: true # æ˜¯å¦è‡ªåŠ¨ä»æ–‡ä»¶è·¯å¾„ç”Ÿæˆåˆ†ç±» depth: 3 # ç”Ÿæˆåˆ†ç±»çš„æœ€å¤§ç›®å½•æ·±åº¦ over_write: false # æ˜¯å¦è¦†ç›–å·²æœ‰åˆ†ç±» auto_title: false # æ˜¯å¦æ ¹æ®è·¯å¾„è‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜ auto_date: false # æ˜¯å¦è‡ªåŠ¨å¡«å……å½“å‰æ—¥æœŸ force: false # æ˜¯å¦å¼ºåˆ¶é‡æ–°ç”Ÿæˆæ‰€æœ‰é“¾æ¥ï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰ # æ°¸ä¹…é“¾æ¥ç¾åŒ–è®¾ç½® pretty_urls: trailing_index: true # falseï¼šé“¾æ¥ä¸­ç§»é™¤ index.html trailing_html: true # falseï¼šç§»é™¤é“¾æ¥æœ«å°¾çš„ .html åç¼€ ğŸŸ¡ è­¦å‘Šï¼šè°¨æ…ä¿®æ”¹ï¼Œä¸ç„¶éƒ¨ç½²åˆ° Vercel æ–‡ç« æ— æ³•è§£æ\n3. é…ç½®è¯´æ˜ crc16 1 2 3 4 5 crc16 \u0026amp; hex http://localhost:4000/posts/66c8 crc16 \u0026amp; dec http://localhost:4000/posts/65535 crc32 1 2 3 4 5 crc32 \u0026amp; hex http://localhost:4000/posts/8ddf18fb crc32 \u0026amp; dec http://localhost:4000/posts/1690090958 ğŸ”„ åä¸€ã€åšå®¢è¿ç§»æŒ‡å— ğŸ–¥ï¸ æ–°ç”µè„‘ç¯å¢ƒé…ç½® Gitï¼š ä¸‹è½½åœ°å€ ğŸ“Œ å®‰è£…æ—¶æ³¨æ„å‹¾é€‰â€œAdd Git Bash Hereâ€å’Œâ€œAdd to PATHâ€é€‰é¡¹ã€‚ Node.jsï¼š ä¸‹è½½åœ°å€ ğŸ“Œ å»ºè®®é€‰æ‹© LTS ç‰ˆæœ¬ï¼Œç¡®ä¿ç¯å¢ƒç¨³å®šæ€§ã€‚ å…³é—­ SSL ä¸¥æ ¼æ¨¡å¼ï¼ˆè§£å†³è¯ä¹¦é—®é¢˜ï¼‰ï¼š 1 npm set strict-ssl false ğŸ“¦ è¿ç§»é¡¹ç›®æ–‡ä»¶ æ‹·è´ä»¥ä¸‹æ–‡ä»¶åˆ°æ–°é¡¹ç›®ï¼š 1 2 3 4 5 6 7 - `_config.yml` - `_config.butterfly.yml` - `themes/` - `source/` - `scaffolds/` - `package.json` - `.gitignore` ğŸ”‘ SSHå¯†é’¥é‡æ–°é…ç½® 1 2 3 4 git config --global user.name \u0026#34;YourName\u0026#34; git config --global user.email \u0026#34;your@email.com\u0026#34; ssh-keygen -t rsa -C \u0026#34;your@email.com\u0026#34; # å°†æ–°å…¬é’¥æ·»åŠ åˆ°GitHub ğŸš€ éƒ¨ç½²æµ‹è¯• 1 2 3 4 npm install hexo-cli -g npm install npm install hexo-deployer-git --save hexo clean; hexo g; hexo s ğŸ“¦ åäºŒã€æ’ä»¶åˆ—è¡¨ä¸å‡çº§æŒ‡å— ğŸ”„ å…¨å±€å®‰è£…/å‡çº§ Hexo åŠç›¸å…³å·¥å…·å¸¸ç”¨å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 1. å…¨å±€å®‰è£… Hexo å‘½ä»¤è¡Œå·¥å…·ï¼ˆhexo-cliï¼‰ npm i hexo-cli -g # 2. å…¨å±€å®‰è£… npm-checkï¼šæ£€æŸ¥è¿‡æ—¶ã€æœªä½¿ç”¨ã€å¯å‡çº§çš„ä¾èµ– npm install -g npm-check # 3. å…¨å±€å®‰è£… npm-upgradeï¼šäº¤äº’å¼æ‰¹é‡å‡çº§ä¾èµ–ç‰ˆæœ¬ npm install -g npm-upgrade # 4. è¿è¡Œ npm-checkï¼ŒæŸ¥çœ‹å½“å‰é¡¹ç›®ä¾èµ–çš„å¥åº·çŠ¶å†µ npm-check # 5. è¿è¡Œ npm-upgradeï¼Œäº¤äº’å¼é€‰æ‹©è¦å‡çº§çš„ä¾èµ– npm-upgrade # 6. å‡çº§æ‰€æœ‰**å…¨å±€**å®‰è£…çš„åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ npm update -g # 7. æ ¹æ® package.json èŒƒå›´è§„åˆ™ï¼Œå‡çº§**å½“å‰é¡¹ç›®**çš„ä¾èµ–ï¼Œå¹¶è‡ªåŠ¨ä¿®æ”¹ package.json ä¸ package-lock.json npm update --save ğŸ§© å¸¸ç”¨æ’ä»¶åˆ—è¡¨ æ’ä»¶åç§° åŠŸèƒ½æè¿° å®‰è£…å‘½ä»¤ hexo-wordcount å­—æ•°ç»Ÿè®¡ npm install hexo-wordcount --save hexo-abbrlink æ°¸ä¹…é“¾æ¥ npm install hexo-abbrlink --save hexo-generator-search æœ¬åœ°æœç´¢ npm install hexo-generator-search --save hexo-deployer-git Gitéƒ¨ç½² npm install hexo-deployer-git --save ğŸ“ æ›´å¤šæ’ä»¶è¯·å‚è€ƒåŸæ–‡ä¸­çš„å®Œæ•´æ’ä»¶è¡¨æ ¼ï¼ŒæŒ‰éœ€å®‰è£…ä½¿ç”¨ã€‚\nğŸ‰ æ­å–œï¼ æ‚¨å·²å®Œæˆ Hexo åšå®¢çš„æ­å»ºä¸ç¾åŒ–ã€‚å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚\n","date":"2025-09-13T09:55:31+08:00","image":"https://file.meimolihan.eu.org/img/hexo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d43a16b4/","title":"Hexo + Butterfly åšå®¢æ­å»ºæŒ‡å— ğŸ¨"},{"content":"Docker éƒ¨ç½² Navidrome éŸ³ä¹æœåŠ¡å™¨ ğŸµâ˜ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Navidrome 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Navidrome 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ 3. æ ¸å¿ƒåŠŸèƒ½é€Ÿè§ˆ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªéŸ³ä¹ä¹‹æ—…ï¼Œæ¢ç´¢æ— é™æ—‹å¾‹ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Navidrome å®˜ç½‘åœ°å€ï¼š https://www.navidrome.org/ ğŸŒ Navidrome å®˜æ–¹æ¼”ç¤ºï¼š https://demo.navidrome.org/app/#/login (ç”¨æˆ·å/å¯†ç : demo/demo) ğŸ“š Navidrome å®‰è£…æ–‡æ¡£ï¼š https://www.navidrome.org/docs/installation/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/navidrome/navidrome ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/deluan/navidrome Navidrome æ˜¯ä¸€ä¸ªå¼€æºçš„éŸ³ä¹æµåª’ä½“æœåŠ¡å™¨ï¼Œå…è®¸æ‚¨é€šè¿‡ç½‘é¡µæµè§ˆå™¨æˆ–å…¼å®¹çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„ä¸ªäººéŸ³ä¹åº“ã€‚å®ƒæ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼Œæä¾›ç¾è§‚çš„ç•Œé¢å’Œå¼ºå¤§çš„éŸ³ä¹ç®¡ç†åŠŸèƒ½ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ§ å¤šæ ¼å¼æ”¯æŒ æ”¯æŒ MP3ã€AACã€FLACã€OGGã€OPUS ç­‰ä¸»æµéŸ³é¢‘æ ¼å¼ å…¼å®¹å‡ ä¹æ‰€æœ‰éŸ³ä¹æ–‡ä»¶ç±»å‹ ğŸŒ è·¨å¹³å°è®¿é—® å¯é€šè¿‡ç½‘é¡µæµè§ˆå™¨æˆ–ç§»åŠ¨åº”ç”¨éšæ—¶éšåœ°è®¿é—®éŸ³ä¹åº“ éšæ—¶éšåœ°äº«å—ä¸ªäººéŸ³ä¹æ”¶è— ğŸ” æ™ºèƒ½æœç´¢ å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒæŒ‰è‰ºæœ¯å®¶ã€ä¸“è¾‘ã€æ­Œæ›²åç­‰å¿«é€ŸæŸ¥æ‰¾ å¿«é€Ÿå®šä½æƒ³å¬çš„éŸ³ä¹ ğŸ“± ç§»åŠ¨å‹å¥½ å“åº”å¼è®¾è®¡ï¼Œåœ¨æ‰‹æœºå’Œå¹³æ¿ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ ç§»åŠ¨ç«¯ä½¿ç”¨ä½“éªŒä¼˜ç§€ ğŸ¨ ä¸»é¢˜å®šåˆ¶ æ”¯æŒå¤šç§ç•Œé¢ä¸»é¢˜å’Œè‡ªå®šä¹‰é€‰é¡¹ ä¸ªæ€§åŒ–ç•Œé¢é£æ ¼ ğŸ”„ å®æ—¶åŒæ­¥ è‡ªåŠ¨æ£€æµ‹å¹¶åŒæ­¥éŸ³ä¹åº“ä¸­çš„æ–°å¢å†…å®¹ éŸ³ä¹åº“å§‹ç»ˆä¿æŒæœ€æ–° ğŸ“Š æ’­æ”¾ç»Ÿè®¡ è®°å½•æ’­æ”¾å†å²å’Œä¸ªäººæ”¶å¬ä¹ æƒ¯ äº†è§£è‡ªå·±çš„éŸ³ä¹åå¥½ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Navidrome 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -p /mnt/mydisk/home/navidrome \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: navidrome: image: deluan/navidrome:latest container_name: navidrome restart: unless-stopped network_mode: bridge environment: - ND_SCANNER_EXTRACTOR=ffmpeg - ND_ENABLETRANSCODINGCONFIG=true - ND_ENABLESHARING=true - ND_SCANSCHEDULE=1h - ND_SESSIONTIMEOUT=24h - ND_LOGLEVEL=info ports: - 4533:4533 volumes: - ./data:/data - /mnt/file/music:/music:ro EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Navidrome 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:4533 å±€åŸŸç½‘è®¿é—®ï¼š http://æœåŠ¡å™¨IP:4533 åŸŸåè®¿é—®ï¼š https://navidrome.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ é¦–æ¬¡è®¿é—®éœ€è¦åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·åå’Œå¯†ç ï¼‰ ç³»ç»Ÿä¼šè‡ªåŠ¨æ‰«æé…ç½®çš„éŸ³ä¹ç›®å½• /mnt/file/music ç­‰å¾…éŸ³ä¹åº“æ‰«æå®Œæˆï¼ˆæ ¹æ®éŸ³ä¹æ•°é‡å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰ å¼€å§‹äº«å—æ‚¨çš„ä¸ªäººéŸ³ä¹æµåª’ä½“æœåŠ¡ï¼ 3. æ ¸å¿ƒåŠŸèƒ½é€Ÿè§ˆ ğŸ¯ åŠŸèƒ½ å¿«æ·é”® / å…¥å£ è¯´æ˜ ğŸµ æ’­æ”¾æ§åˆ¶ ç©ºæ ¼é”® æ’­æ”¾/æš‚åœå½“å‰éŸ³ä¹ â­ï¸ ä¸‹ä¸€æ›² â†’ é”® æ’­æ”¾ä¸‹ä¸€é¦–æ­Œæ›² â®ï¸ ä¸Šä¸€æ›² â† é”® æ’­æ”¾ä¸Šä¸€é¦–æ­Œæ›² ğŸ” å¿«é€Ÿæœç´¢ / é”® å¿«é€Ÿæœç´¢éŸ³ä¹åº“ ğŸ“± ç§»åŠ¨ç«¯åº”ç”¨ Substreamer, play:Sub æ”¯æŒå¤šç§ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ ğŸŒ— ä¸»é¢˜åˆ‡æ¢ è®¾ç½® â†’ ç•Œé¢ åˆ‡æ¢æ˜æš—ä¸»é¢˜æ¨¡å¼ ğŸ“» éšæœºæ’­æ”¾ æ’­æ”¾æ§åˆ¶æ  éšæœºæ’­æ”¾éŸ³ä¹åº“æ­Œæ›² ğŸ”„ å•æ›²å¾ªç¯ æ’­æ”¾æ§åˆ¶æ  å•æ›²å¾ªç¯æ’­æ”¾æ¨¡å¼ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://navidrome.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/navidrome.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name navidrome.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 10M; location / { proxy_pass http://localhost:4533; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; proxy_http_version 1.1; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªéŸ³ä¹ä¹‹æ—…ï¼Œæ¢ç´¢æ— é™æ—‹å¾‹ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Navidrome éŸ³ä¹æœåŠ¡å™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸµ éšæ—¶éšåœ° ç•…å¬ä¸ªäººéŸ³ä¹æ”¶è—ï¼Œæ— è®ºèº«å¤„ä½•åœ°éƒ½èƒ½äº«å—é«˜å“è´¨éŸ³ä¹ä½“éªŒ\nğŸ§ å®Œå…¨è‡ªä¸» æŒæ§è‡ªå·±çš„éŸ³ä¹åº“ï¼Œå‘Šåˆ«å¹³å°é™åˆ¶å’Œè®¢é˜…è´¹ç”¨ï¼ŒçœŸæ­£æ‹¥æœ‰ä½ çš„éŸ³ä¹\nğŸ” éšç§å®‰å…¨ æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œæ— éœ€æ‹…å¿ƒç¬¬ä¸‰æ–¹æ”¶é›†ä½ çš„æ”¶å¬ä¹ æƒ¯å’Œåå¥½\nğŸ“± å¤šç«¯åŒæ­¥ åœ¨æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘ç­‰å„ç§è®¾å¤‡ä¸Šæ— ç¼åˆ‡æ¢ï¼Œä¿æŒæ’­æ”¾è¿›åº¦å’Œæ­Œå•åŒæ­¥\néŸ³ä¹æ˜¯å¿ƒçµçš„ä¼´ä¾£ï¼Œæ˜¯æƒ…ç»ªçš„è‰¯è¯ã€‚æ„¿ Navidrome æˆä¸ºä½ å¿ å®çš„éŸ³ä¹ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªéœ€è¦æ—‹å¾‹çš„æ—¶åˆ»ï¼Œæ— è®ºæ˜¯å·¥ä½œçš„ä¸“æ³¨ã€æ—…è¡Œçš„æƒ¬æ„è¿˜æ˜¯ç‹¬å¤„çš„å®é™ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ•´ç†æ”¶è—ï¼Œå‘ç°éŸ³ä¹â€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„ç§äººéŸ³ä¹å¤©åœ°å§ï¼ğŸ¶\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Navidrome å®˜æ–¹æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è†å¬æ„‰å¿«ï¼ŒéŸ³ä¹å¸¸ä¼´ï¼ğŸ‰\n","date":"2025-09-12T23:18:33+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-navidrome-001.webp","permalink":"https://blog.meimolihan.eu.org/p/92df94ee/","title":"Docker éƒ¨ç½² Navidrome éŸ³ä¹æœåŠ¡å™¨ ğŸµâ˜ï¸"},{"content":"Docker éƒ¨ç½²å—å¢™ WAF ğŸ›¡ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ Docker éƒ¨ç½²å—å¢™ WAF 1. Linux è‡ªåŠ¨å®‰è£… 2. Docker æ‰‹åŠ¨éƒ¨ç½² åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ä½¿ç”¨å—å¢™ WAF 1. è®¿é—® Web ç•Œé¢ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸŒ Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”§ å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ 2. Docker å®¹å™¨å‘½ä»¤ 3. Docker é•œåƒç®¡ç† ğŸŒŸ å¼€å¯å®‰å…¨é˜²æŠ¤æ–°ç¯‡ç«  ğŸ¯ é¡¹ç›®ç®€ä»‹ å—å¢™ WAF (UUsec WAF) æ˜¯ä¸€æ¬¾åŸºäº Docker å®¹å™¨åŒ–éƒ¨ç½²çš„ Web åº”ç”¨é˜²ç«å¢™ï¼Œä¸“ä¸ºç°ä»£ Web åº”ç”¨æä¾›å…¨æ–¹ä½å®‰å…¨é˜²æŠ¤ã€‚å®ƒèƒ½å¤Ÿæœ‰æ•ˆé˜²å¾¡ SQL æ³¨å…¥ã€XSS è·¨ç«™è„šæœ¬ã€CSRF æ”»å‡»ã€æ¶æ„çˆ¬è™«ç­‰å¸¸è§ Web å®‰å…¨å¨èƒï¼ŒåŒæ—¶å…·å¤‡é«˜æ€§èƒ½ã€æ˜“éƒ¨ç½²ã€å¯è§†åŒ–ç®¡ç†ç­‰ä¼˜åŠ¿ã€‚\nğŸŒ å—å¢™ WAF å®˜ç½‘åœ°å€ï¼š https://waf.uusec.com/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Safe3/uusec-waf ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ âœ¨ å…¨é¢é˜²æŠ¤ - æ”¯æŒå¤šç§ Web æ”»å‡»æ£€æµ‹å’Œé˜²å¾¡ï¼ŒåŒ…æ‹¬ OWASP Top 10 å¸¸è§æ¼æ´ ğŸš€ é«˜æ€§èƒ½ - åŸºäºæ™ºèƒ½å¼•æ“ï¼Œä½å»¶è¿Ÿã€é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä¸å½±å“ä¸šåŠ¡æ­£å¸¸è®¿é—® ğŸ”§ æ˜“äºéƒ¨ç½² - æä¾› Docker ä¸€é”®éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§ç¯å¢ƒå¿«é€Ÿå®‰è£… ğŸ“Š å¯è§†åŒ–ç®¡ç† - æä¾›å‹å¥½çš„ç®¡ç†ç•Œé¢ï¼Œå®æ—¶å±•ç¤ºå®‰å…¨æ€åŠ¿å’Œæ”»å‡»æ—¥å¿— ğŸ›¡ï¸ æ™ºèƒ½å­¦ä¹  - æ”¯æŒæ­£å¸¸æµé‡å­¦ä¹ ï¼Œé™ä½è¯¯æŠ¥ç‡ï¼Œæé«˜é˜²æŠ¤ç²¾åº¦ ğŸŒ çµæ´»æ‰©å±• - æ”¯æŒè‡ªå®šä¹‰è§„åˆ™ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»è°ƒæ•´é˜²æŠ¤ç­–ç•¥\nğŸ³ Docker éƒ¨ç½²å—å¢™ WAF å—å¢™ WAF æä¾›ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼šLinux è‡ªåŠ¨å®‰è£…å’Œ Docker æ‰‹åŠ¨éƒ¨ç½²ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹å¼ã€‚\n1. Linux è‡ªåŠ¨å®‰è£…å‘½ä»¤ ğŸ“¦ ä¸€é”®å®‰è£…ï¼š3 åˆ†é’Ÿå³å¯å®Œæˆè‡ªåŠ¨å®‰è£…ï¼Œé€‚åˆå¿«é€Ÿéƒ¨ç½²åœºæ™¯ã€‚\n1 sudo bash -c \u0026#34;$(curl -fsSL https://waf.uusec.com/installer.sh)\u0026#34; 2. Docker æ‰‹åŠ¨éƒ¨ç½² åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 # åˆ›å»ºéƒ¨ç½²ç›®å½• mkdir -p /vol1/1000/compose/uuwaf \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: uuwaf: image: uusec/waf:7.0.3 ulimits: nproc: 65535 nofile: soft: 102400 hard: 102400 container_name: uuwaf networks: - 1panel-network ports: - 880:80 - 666:443 - 4443:4443 volumes: - /etc/localtime:/etc/localtime:ro # ä¿®æ”¹ä¸ºä½¿ç”¨ç³»ç»Ÿæ—¶åŒºæ–‡ä»¶ - /etc/timezone:/etc/timezone:ro # æ·»åŠ æ—¶åŒºé…ç½®æ–‡ä»¶ - ./waf_config:/uuwaf/web/conf - ./waf_acme:/uuwaf/acme - ./waf_logs:/uuwaf/logs environment: - TZ=Asia/Shanghai # æ·»åŠ æ—¶åŒºç¯å¢ƒå˜é‡ - UUWAF_MYSQL_PASSWORD=Safe3.WAF - UUWAF_RESOLVER=resolver 127.0.0.11 valid=30s ipv6=off; depends_on: wafdb: condition: service_healthy wafdb: image: mysql:5.7.44 container_name: uuwaf-db networks: - 1panel-network volumes: - /etc/timezone:/etc/timezone:ro # ä¿®æ”¹ä¸ºä½¿ç”¨ç³»ç»Ÿæ—¶åŒºæ–‡ä»¶ - /etc/localtime:/etc/localtime:ro # ä¿®æ”¹ä¸ºä½¿ç”¨ç³»ç»Ÿæ—¶åŒºæ–‡ä»¶ - ./waf_data:/var/lib/mysql environment: - TZ=Asia/Shanghai # æ·»åŠ æ—¶åŒºç¯å¢ƒå˜é‡ - MYSQL_ROOT_PASSWORD=Safe3.WAF command: [\u0026#34;--max_connections=512\u0026#34;] healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;mysqladmin\u0026#34;, \u0026#34;-uroot\u0026#34;, \u0026#34;-pSafe3.WAF\u0026#34;, \u0026#34;ping\u0026#34;, \u0026#34;-h\u0026#34;, \u0026#34;127.0.0.1\u0026#34;, \u0026#34;--silent\u0026#34;] start_period: 3s interval: 5s timeout: 3s retries: 10 networks: 1panel-network: external: true EOF æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 2 3 4 5 6 7 8 9 10 11 # æ‹‰å–æœ€æ–°é•œåƒ docker compose pull # å¯åŠ¨å®¹å™¨ docker compose up -d # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ docker compose ps # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— docker compose logs -f ğŸš€ ä½¿ç”¨å—å¢™ WAF 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:4443 åŸŸåè®¿é—®ï¼š https://uuwaf.example.com:4443 ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ é»˜è®¤ç™»å½•ä¿¡æ¯ï¼š\nç”¨æˆ·åï¼šadmin å¯†ç ï¼š#Passw0rdï¼ˆé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹ï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ åˆå§‹åŒ–è®¾ç½® ğŸ”§\næ‰“å¼€æµè§ˆå™¨è®¿é—®ç®¡ç†ç•Œé¢ ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç  é…ç½®ç³»ç»ŸåŸºæœ¬è®¾ç½®å’Œé€šçŸ¥æ–¹å¼ æ·»åŠ é˜²æŠ¤ç«™ç‚¹ ğŸŒ\nè¿›å…¥\u0026quot;ç«™ç‚¹ç®¡ç†\u0026quot; â†’ \u0026ldquo;æ·»åŠ ç«™ç‚¹\u0026rdquo; å¡«å†™åŸŸåå’Œä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ é…ç½® SSL è¯ä¹¦ï¼ˆå¦‚éœ€è¦ï¼‰ é…ç½®é˜²æŠ¤ç­–ç•¥ ğŸ›¡ï¸\nå¯ç”¨åŸºç¡€é˜²æŠ¤è§„åˆ™é›† æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´é˜²æŠ¤ç­‰çº§ è®¾ç½®è‡ªå®šä¹‰è§„åˆ™åº”å¯¹ç‰¹å®šåœºæ™¯ ç›‘æ§ä¸ä¼˜åŒ– ğŸ“Š\næŸ¥çœ‹å®æ—¶æ”»å‡»æ—¥å¿—å’Œç»Ÿè®¡ åˆ†æå®‰å…¨äº‹ä»¶å’Œå¨èƒæƒ…æŠ¥ æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–é˜²æŠ¤è§„åˆ™ ğŸŒ Nginx åå‘ä»£ç†é…ç½® é€šè¿‡ Nginx åå‘ä»£ç†å¯ä»¥æä¾›æ›´çµæ´»çš„è®¿é—®æ–¹å¼å’Œ SSL ç»ˆç«¯å¸è½½åŠŸèƒ½ã€‚\n1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/uuwaf.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 4443 ssl http2; listen [::]:4443 ssl http2; server_name uuwaf.yourdomain.com; # SSL é…ç½® ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_session_timeout 1d; ssl_session_cache shared:MozSSL:10m; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=63072000\u0026#34; always; # ä»£ç†é…ç½® location / { proxy_pass http://127.0.0.1:4443; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } access_log /var/log/nginx/uuwaf.access.log; error_log /var/log/nginx/uuwaf.error.log; } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• nginx -t # é‡è½½ Nginx é…ç½® systemctl reload nginx # æŸ¥çœ‹ Nginx çŠ¶æ€ systemctl status nginx ğŸ”§ å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker compose ps # æŸ¥çœ‹æ—¥å¿— docker compose logs docker compose logs -f # å®æ—¶æ—¥å¿— docker compose logs uuwaf # æŒ‡å®šæœåŠ¡æ—¥å¿— # æœåŠ¡ç®¡ç† docker compose stop # åœæ­¢æœåŠ¡ docker compose start # å¯åŠ¨æœåŠ¡ docker compose restart # é‡å¯æœåŠ¡ # æ›´æ–°å’Œæ¸…ç† docker compose pull # æ‹‰å–æœ€æ–°é•œåƒ docker compose up -d # é‡æ–°åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ docker compose down # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ # æ‰§è¡Œå‘½ä»¤ docker compose exec uuwaf bash # è¿›å…¥å®¹å™¨ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å®¹å™¨ç®¡ç† docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker stop uuwaf # åœæ­¢å®¹å™¨ docker start uuwaf # å¯åŠ¨å®¹å™¨ docker restart uuwaf # é‡å¯å®¹å™¨ docker rm uuwaf # åˆ é™¤å®¹å™¨ # æ—¥å¿—ç®¡ç† docker logs uuwaf # æŸ¥çœ‹æ—¥å¿— docker logs -f uuwaf # å®æ—¶æ—¥å¿— docker logs --tail 100 uuwaf # æŸ¥çœ‹æœ€å100è¡Œ # æ‰§è¡Œå‘½ä»¤ docker exec -it uuwaf bash # è¿›å…¥å®¹å™¨ docker exec uuwaf nginx -t # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 5 6 7 8 9 10 11 # é•œåƒæŸ¥çœ‹ docker images # åˆ—å‡ºé•œåƒ docker image ls # åˆ—å‡ºé•œåƒï¼ˆè¯¦ç»†ï¼‰ # é•œåƒæ¸…ç† docker image prune # åˆ é™¤æ‚¬ç©ºé•œåƒ docker image prune -a # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨é•œåƒ # é•œåƒæ“ä½œ docker pull uusec/waf:latest # æ‹‰å–é•œåƒ docker rmi uusec/waf:latest # åˆ é™¤é•œåƒ ğŸŒŸ å¼€å¯å®‰å…¨é˜²æŠ¤æ–°ç¯‡ç«  é€šè¿‡æœ¬æ–‡æ¡£ï¼Œæ‚¨å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†å—å¢™ WAF Web åº”ç”¨é˜²ç«å¢™ï¼Œä¸ºæ‚¨çš„ Web åº”ç”¨å»ºç«‹äº†åšå®çš„å®‰å…¨é˜²çº¿ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ï¼š\nğŸ›¡ï¸ å…¨é¢é˜²æŠ¤ - æœ‰æ•ˆé˜²å¾¡ SQL æ³¨å…¥ã€XSS æ”»å‡»ç­‰å¸¸è§ Web å¨èƒ\nğŸ“Š å®æ—¶ç›‘æ§ - å¯è§†åŒ–ç•Œé¢å®æ—¶å±•ç¤ºå®‰å…¨æ€åŠ¿å’Œæ”»å‡»æ—¥å¿—\nâš¡ é«˜æ€§èƒ½ä¿éšœ - ä½å»¶è¿Ÿé«˜å¹¶å‘å¤„ç†ï¼Œä¸å½±å“ä¸šåŠ¡æ­£å¸¸è®¿é—®\nğŸ”§ çµæ´»é…ç½® - æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰é˜²æŠ¤è§„åˆ™å’Œç­–ç•¥\nğŸŒ æ˜“æ‰©å±• - æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œè½»æ¾åº”å¯¹ä¸šåŠ¡å¢é•¿\nå—å¢™ WAF å°†æˆä¸ºæ‚¨ Web åº”ç”¨çš„å¯é å®ˆæŠ¤è€…ï¼Œ7Ã—24 å°æ—¶ä¸é—´æ–­æä¾›å®‰å…¨é˜²æŠ¤ï¼Œè®©æ‚¨ä¸“æ³¨äºä¸šåŠ¡å‘å±•ï¼Œæ— éœ€æ‹…å¿ƒå®‰å…¨å¨èƒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ„å»ºå®‰å…¨å¯é çš„ Web åº”ç”¨ç¯å¢ƒï¼Œä¸ºæ‚¨çš„ç”¨æˆ·æä¾›æ›´å®‰å¿ƒçš„æœåŠ¡ä½“éªŒï¼âœ¨\nğŸ“Œ æŒç»­æ›´æ–°ï¼šå»ºè®®å®šæœŸæ£€æŸ¥ å®˜æ–¹æ–‡æ¡£ è·å–æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨æ›´æ–°\nğŸ› é—®é¢˜åé¦ˆï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯å‰å¾€ GitHub Issues åé¦ˆ\nğŸ’¬ ç¤¾åŒºæ”¯æŒï¼šåŠ å…¥å®˜æ–¹ç¤¾åŒºè·å–æŠ€æœ¯æ”¯æŒå’Œæœ€ä½³å®è·µåˆ†äº«\nç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼Œå®‰å…¨æ— å¿§ï¼ğŸ‰\n","date":"2025-09-12T14:00:20+08:00","image":"https://file.meimolihan.eu.org/img/docker-uuwaf-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2e406de0/","title":"Docker éƒ¨ç½²å—å¢™ WAF ğŸ›¡ï¸"},{"content":"é›¶æˆæœ¬ç½‘ç«™åŠ é€Ÿ Cloudflare ç¼“å­˜ä»å…¥é—¨åˆ°ç²¾é€š âœ¨ éš¾é“é™¤äº†åŠ é’±å‡çº§æœåŠ¡å™¨ï¼Œå°±æ²¡æœ‰åˆ«çš„åŠæ³•äº†å—ï¼Ÿ\nå½“ç„¶æœ‰ï¼ğŸš€\nä»Šå¤©ï¼Œæˆ‘å°†æ‰‹æŠŠæ‰‹å¸¦ä½ åˆ©ç”¨å¼ºå¤§çš„ Cloudflareï¼Œé›¶æˆæœ¬åœ°ä¸ºä½ çš„ç½‘ç«™â€œç»­å‘½â€ï¼Œè®©ä½é…æœåŠ¡å™¨ä¹Ÿèƒ½æ‹¥æœ‰é—ªç”µèˆ¬çš„å“åº”é€Ÿåº¦ã€‚æˆ‘ä»¬å°†ä»ä¸€ä¸ªæœ€ç®€å•çš„â€œæš´åŠ›â€ç¼“å­˜æ–¹æ³•å¼€å§‹ï¼Œä¸€æ­¥æ­¥å¸¦ä½ è¸©å‘ã€å¡«å‘ï¼Œæœ€ç»ˆå®ç°ä¸€å¥—æ—¢èƒ½æè‡´åŠ é€Ÿï¼Œåˆèƒ½ä¿è¯å†…å®¹å®æ—¶æ›´æ–°çš„å®Œç¾ç¼“å­˜ç­–ç•¥ã€‚\nåŸä½œè€… ï¼š Joey Blog ğŸ“š æ–‡ç« å¯¼èˆªç›®å½• ğŸ”¥ é—®é¢˜å¤ç°ï¼šæˆ‘çš„å°ç ´ç«™å¿«â€œç‚¸â€äº† âš¡ æš´åŠ›ç¼“å­˜ï¼šä¸€åˆ†é’Ÿï¼Œèµ·æ­»å›ç”Ÿï¼ âš ï¸ è¸©å‘ä¸€ï¼šè­¦å‘Šï¼ä½ çš„åå°åœ¨â€œè£¸å¥”â€ï¼ ğŸ”§ è§„åˆ™è¿›é˜¶ï¼šå­¦ä¼šâ€œåŒºåˆ«å¯¹å¾…â€ ğŸ”„ è¸©å‘äºŒï¼šæˆ‘å‘äº†æ–°æ–‡ç« ï¼Œä¸ºä»€ä¹ˆæ²¡äººçœ‹å¾—åˆ°ï¼Ÿ ğŸ¤– ç»ˆææ–¹æ¡ˆï¼šç”¨ API å’Œæ’ä»¶å®ç°â€œè‡ªåŠ¨åˆ·æ–°â€ ğŸ‰ è§è¯å¥‡è¿¹ï¼šé€Ÿåº¦ä¸æ›´æ–°å…¼å¾— ğŸ“Œ æ€»ç»“ ğŸ”¥ é—®é¢˜å¤ç°ï¼šæˆ‘çš„å°ç ´ç«™å¿«â€œç‚¸â€äº† ä¸ºäº†è®©æ•ˆæœæ›´å…·æˆå‰§æ€§ï¼Œæˆ‘ç‰¹æ„å‡†å¤‡äº†ä¸€å°ä½é…çš„è°·æ­Œäº‘æœåŠ¡å™¨ï¼Œå¹¶å°†æˆ‘çš„åšå®¢éƒ¨ç½²äº†ä¸Šå»ã€‚åœ¨æ²¡æœ‰ä»»ä½•ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„è¡¨ç°ã€‚\néšä¾¿æ‰“å¼€ä¸€ç¯‡æ–‡ç« ï¼ŒåŠ è½½é€Ÿåº¦è‚‰çœ¼å¯è§çš„æ…¢ã€‚\nè¿™æ—¶ï¼Œæˆ‘ä»¬å†ç”¨å·¥å…·æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„å¹¶å‘è®¿é—®ï¼ŒæœåŠ¡å™¨åå°çš„ CPU ç¬é—´å°±â€œæ‹‰æ»¡â€äº†ï¼Œç½‘ç«™ç›´æ¥å´©æºƒï¼Œæ— æ³•è®¿é—®ã€‚\nè¿™å°±æ˜¯æˆ‘ä»¬å³å°†è¦è§£å†³çš„å…¸å‹åœºæ™¯ã€‚\nâš¡ æš´åŠ›ç¼“å­˜ï¼šä¸€åˆ†é’Ÿï¼Œèµ·æ­»å›ç”Ÿï¼ ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯·å‡ºä»Šå¤©çš„ä¸»è§’â€”â€”Cloudflareã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ï¼šç¼“å­˜è§„åˆ™ï¼ˆCache Rulesï¼‰ã€‚\nğŸ”§ åŠŸèƒ½ç‰¹ç‚¹ï¼š å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ï¼šCloudflare æ‹¥æœ‰éå¸ƒå…¨çƒçš„æœåŠ¡å™¨ï¼Œå¯ç¼“å­˜å†…å®¹å¹¶å°±è¿‘åˆ†å‘ç»™ç”¨æˆ·ã€‚ é›¶æˆæœ¬åŠ é€Ÿï¼šå…è´¹å¥—é¤å³å¯äº«å—å¼ºå¤§çš„ç¼“å­˜åŠŸèƒ½ï¼Œå‡è½»æºæœåŠ¡å™¨å‹åŠ›ã€‚ ç®€å•æ˜“ç”¨ï¼šé€šè¿‡å¯è§†åŒ–ç•Œé¢é…ç½®è§„åˆ™ï¼Œæ— éœ€ä»£ç åŸºç¡€ã€‚ ğŸ“ æ“ä½œæ­¥éª¤ï¼š ç™»å½•ä½ çš„ Cloudflare è´¦æˆ·ï¼Œé€‰æ‹©ä½ çš„åŸŸåï¼Œè¿›å…¥ç¼“å­˜ï¼ˆCachingï¼‰ â†’ ç¼“å­˜è§„åˆ™ï¼ˆCache Rulesï¼‰ã€‚ ç‚¹å‡»åˆ›å»ºè§„åˆ™ï¼ˆCreate ruleï¼‰ã€‚ è§„åˆ™åç§°éšä¾¿å¡«ï¼Œä¾‹å¦‚â€œç¼“å­˜æ‰€æœ‰â€ã€‚ åœ¨â€œWhen incoming requests match\u0026hellip;â€éƒ¨åˆ†ï¼Œç›´æ¥ä½¿ç”¨ Cloudflare æä¾›çš„æ¨¡æ¿ï¼Œé€‰æ‹©ç¼“å­˜æ‰€æœ‰å†…å®¹ï¼ˆCache everythingï¼‰ã€‚è¿™ä¸ªæ¨¡æ¿ä¼šè‡ªåŠ¨å¸®ä½ å¡«å……å¥½æ‰€æœ‰åŠ¨æ€ã€é™æ€å†…å®¹çš„åŒ¹é…è§„åˆ™ã€‚ å¥½äº†ï¼Œéƒ¨ç½²å®Œæˆã€‚ç°åœ¨æˆ‘ä»¬å†æ¥è®¿é—®ç½‘ç«™è¯•è¯•ï¼Ÿ\nå¥‡è¿¹å‘ç”Ÿäº†ï¼ç½‘ç«™ç§’å¼€ï¼Œé¡µé¢åˆ‡æ¢å¦‚ä¸èˆ¬é¡ºæ»‘ã€‚æˆ‘ä»¬å†çœ‹ä¸€çœ¼æœåŠ¡å™¨åå°ï¼ŒCPU å ç”¨ç‡å‡ ä¹ä¸ºé›¶ï¼Œå®Œå…¨åœ¨â€œæ‘¸é±¼â€ğŸ˜´ã€‚\nåŸç†å¾ˆç®€å•ï¼šCloudflare éå¸ƒå…¨çƒçš„è¾¹ç¼˜èŠ‚ç‚¹å·²ç»å°†ä½ çš„æ•´ä¸ªç½‘ç«™å†…å®¹ç¼“å­˜äº†ä¸‹æ¥ï¼Œæ‰€æœ‰ç”¨æˆ·çš„è®¿é—®è¯·æ±‚éƒ½ç”±ç¦»ä»–ä»¬æœ€è¿‘çš„ Cloudflare èŠ‚ç‚¹ç›´æ¥å“åº”ï¼Œæ ¹æœ¬ä¸ä¼šå†â€œæ‰“æ‰°â€ä½ é‚£å°è¿œåœ¨ç¾å›½çš„ä½é…æºæœåŠ¡å™¨äº†ã€‚\nâš ï¸ è¸©å‘ä¸€ï¼šè­¦å‘Šï¼ä½ çš„åå°åœ¨â€œè£¸å¥”â€ï¼ æ­£å½“ä½ ä¸ºè¿™æƒŠäººçš„æ•ˆæœæ²¾æ²¾è‡ªå–œæ—¶ï¼Œä¸€ä¸ªå·¨å¤§çš„å®‰å…¨æ¼æ´å·²ç»æ‚„ç„¶å‡ºç°ã€‚\næˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çš„â€œæ— ç—•æ¨¡å¼â€ï¼ˆç¡®ä¿æ²¡æœ‰ä»»ä½•ç™»å½•ä¿¡æ¯ï¼‰ï¼Œç„¶åå°è¯•è®¿é—® WordPress çš„åå°åœ°å€ï¼Œä¾‹å¦‚ https://ä½ çš„åŸŸå.com/wp-admin/ã€‚\næŒ‰å¸¸ç†ï¼Œå®ƒåº”è¯¥ä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚ä½†ç°åœ¨â€¦â€¦\næ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ã€‚ç”±äºæˆ‘ä»¬â€œæš´åŠ›â€åœ°ç¼“å­˜äº†ä¸€åˆ‡ï¼Œè¿éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„åå°ç®¡ç†é¡µé¢ï¼Œä¹Ÿè¢« Cloudflare å½“æˆé™æ€é¡µé¢ç¼“å­˜èµ·æ¥ï¼Œå¹¶æ¯«æ— ä¿ç•™åœ°å±•ç¤ºç»™äº†æ‰€æœ‰è®¿å®¢ã€‚è¿™æ˜¯ä¸€ä¸ªç¾éš¾æ€§çš„å®‰å…¨é—®é¢˜ï¼\nğŸ”§ è§„åˆ™è¿›é˜¶ï¼šå­¦ä¼šâ€œåŒºåˆ«å¯¹å¾…â€ é—®é¢˜çš„åŸå› åœ¨äºæˆ‘ä»¬çš„ç¼“å­˜è§„åˆ™è¿‡äºâ€œä¸€åˆ€åˆ‡â€ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦æ•™ä¼š Cloudflare â€œåŒºåˆ«å¯¹å¾…â€ï¼Œå‘Šè¯‰å®ƒå“ªäº›å†…å®¹ç»å¯¹ä¸èƒ½ç¼“å­˜ã€‚\næˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€æ¡æ–°çš„ã€æ›´é«˜ä¼˜å…ˆçº§çš„è§„åˆ™æ¥â€œè·³è¿‡â€ç¼“å­˜ã€‚\nğŸ“ æ“ä½œæ­¥éª¤ï¼š å†æ¬¡å›åˆ°ç¼“å­˜è§„åˆ™ï¼ˆCache Rulesï¼‰ é¡µé¢ï¼Œç‚¹å‡»åˆ›å»ºè§„åˆ™ï¼ˆCreate ruleï¼‰ã€‚ å°†è¿™æ¡æ–°è§„åˆ™æ‹–åŠ¨åˆ°æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„â€œç¼“å­˜æ‰€æœ‰â€è§„åˆ™çš„ä¸Šæ–¹ï¼Œç¡®ä¿å®ƒçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚ è§„åˆ™åç§°è®¾ä¸ºâ€œè·³è¿‡åå°å’Œç™»å½•ç”¨æˆ·â€ã€‚ åœ¨â€œWhen incoming requests match\u0026hellip;â€éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç¼–è¾‘è¡¨è¾¾å¼ï¼Œä½¿ç”¨ OR é€»è¾‘ç»„åˆä¸¤ä¸ªæ¡ä»¶ï¼š æ¡ä»¶ä¸€ï¼š(http.request.uri.path contains \u0026quot;/wp-admin/\u0026quot;) â€”â€” å½“ URL è·¯å¾„åŒ…å«åå°åœ°å€æ—¶ã€‚ æ¡ä»¶äºŒï¼š(http.cookie contains \u0026quot;wp\u0026quot;) â€”â€” å½“è¯·æ±‚çš„ Cookie ä¸­åŒ…å« WordPress ç™»å½•å‡­è¯æ—¶ã€‚ åœ¨â€œThen\u0026hellip;â€éƒ¨åˆ†ï¼Œå°†ç¼“å­˜èµ„æ ¼ï¼ˆCache eligibilityï¼‰é€‰æ‹©ä¸ºç»•è¿‡ç¼“å­˜ï¼ˆBypass cacheï¼‰ã€‚ éƒ¨ç½²è§„åˆ™ã€‚ ç°åœ¨ï¼Œåå°è£¸å¥”çš„é—®é¢˜è§£å†³äº†ã€‚æœªç™»å½•ç”¨æˆ·è®¿é—®åå°ä¼šæ­£ç¡®è·³è½¬åˆ°ç™»å½•é¡µï¼Œè€Œå·²ç™»å½•çš„ç”¨æˆ·åˆ™å› ä¸º Cookie åŒ¹é…æˆåŠŸï¼Œä¹Ÿä¸ä¼šè¢«ç¼“å­˜ï¼Œå¯ä»¥æ­£å¸¸è¿›è¡Œç®¡ç†æ“ä½œã€‚\nğŸ”„ è¸©å‘äºŒï¼šæˆ‘å‘äº†æ–°æ–‡ç« ï¼Œä¸ºä»€ä¹ˆæ²¡äººçœ‹å¾—åˆ°ï¼Ÿ å®‰å…¨é—®é¢˜è§£å†³äº†ï¼Œä½†æ–°çš„é—®é¢˜åˆæ¥äº†ã€‚\nä½ åœ¨åå°å…´è‡´å‹ƒå‹ƒåœ°å‘å¸ƒäº†ä¸€ç¯‡æ–°æ–‡ç« ï¼Œä½†åœ¨é¦–é¡µä¸Šï¼Œå®ƒå´è¿Ÿè¿Ÿä¸å‡ºç°ã€‚æ— è®ºä½ æ€ä¹ˆåˆ·æ–°ï¼Œç”šè‡³â€œæ¸…ç©ºç¼“å­˜å¹¶å¼ºåˆ¶åˆ·æ–°â€ï¼Œæ–°æ–‡ç« å°±æ˜¯ä¸è§è¸ªå½±ã€‚\nåŸå› ä¹Ÿå¾ˆç®€å•ï¼šå¯¹äºæœªç™»å½•çš„è®¿å®¢ï¼ŒCloudflare ä¾ç„¶åœ¨å¿ å®åœ°æ‰§è¡Œæˆ‘ä»¬ç¬¬ä¸€æ¡â€œç¼“å­˜æ‰€æœ‰â€çš„è§„åˆ™â€”â€”ä»å®ƒçš„è¾¹ç¼˜èŠ‚ç‚¹è¿”å›é‚£ä¸ªè¢«ç¼“å­˜äº†â€œä¸€å¹´â€çš„æ—§é¦–é¡µã€‚å®ƒå¹¶ä¸çŸ¥é“ä½ çš„æºæœåŠ¡å™¨ä¸Šå†…å®¹å·²ç»æ›´æ–°äº†ã€‚\nğŸ¤– ç»ˆææ–¹æ¡ˆï¼šç”¨ API å’Œæ’ä»¶å®ç°â€œè‡ªåŠ¨åˆ·æ–°â€ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼šåœ¨å†…å®¹æ›´æ–°æ—¶ï¼Œä¸»åŠ¨é€šçŸ¥ Cloudflare â€œä½ è¯¥æ¸…ç†ä¸€ä¸‹è¿™ä¸ªé¡µé¢çš„ç¼“å­˜äº†â€ã€‚è¿™å°±è¦ç”¨åˆ° Cloudflare å¼ºå¤§çš„ APIã€‚\næ‰‹åŠ¨å» API åˆ·æ–°æ˜¾ç„¶ä¸ç°å®ã€‚å› æ­¤ï¼Œæˆ‘ç‰¹æ„ä¸ºå¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªè‡ªç ”çš„ WordPress æ’ä»¶ï¼Œå®ƒèƒ½å®Œç¾åœ°è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚\nğŸ”§ æ’ä»¶åŠŸèƒ½ç‰¹ç‚¹ï¼š è‡ªåŠ¨è§¦å‘ï¼šæ–‡ç« å‘å¸ƒ/æ›´æ–°æ—¶è‡ªåŠ¨æ¸…ç†ç›¸å…³ç¼“å­˜ã€‚ ç²¾å‡†æ¸…ç†ï¼šå¯æ¸…ç†æ–‡ç« é¡µã€é¦–é¡µã€åˆ†ç±»é¡µç­‰å¤šç±»é¡µé¢ã€‚ ç®€å•é…ç½®ï¼šåªéœ€å¡«å†™é‚®ç®±ã€API å¯†é’¥å’ŒåŸŸåã€‚ ğŸ“ é…ç½®æ–¹æ³•ï¼š å®‰è£…å¹¶å¯ç”¨æ’ä»¶åï¼Œè¿›å…¥è®¾ç½® â†’ CF Purge Cacheã€‚ ä½ éœ€è¦å¡«å†™ä¸‰é¡¹ä¿¡æ¯ï¼š Cloudflare Emailï¼šä½ çš„ç™»å½•é‚®ç®±ã€‚ Cloudflare Global API Keyï¼šä½ çš„å…¨å±€ API å¯†é’¥ã€‚ Zoneï¼šé€‰æ‹©éœ€è¦æ“ä½œçš„åŸŸåã€‚ å…¨å±€ API å¯†é’¥å¯ä»¥åœ¨ Cloudflare ä»ªè¡¨ç›˜çš„æˆ‘çš„ä¸ªäººèµ„æ–™ â†’ APIä»¤ç‰Œä¸­æ‰¾åˆ°ã€‚\nğŸ‰ è§è¯å¥‡è¿¹ï¼šé€Ÿåº¦ä¸æ›´æ–°å…¼å¾— é…ç½®å¥½æ’ä»¶åï¼Œæˆ‘ä»¬æ¥è§è¯æœ€ç»ˆçš„å®Œç¾æ•ˆæœã€‚\næˆ‘ä»¬å†æ¬¡ç¼–è¾‘åˆšæ‰å‘å¸ƒçš„æ–‡ç« ï¼Œéšä¾¿ä¿®æ”¹ç‚¹å†…å®¹ï¼Œç„¶åç‚¹å‡»â€œæ›´æ–°â€ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å†æ‰“å¼€ä¸€ä¸ªæ— ç—•çª—å£è®¿é—®é¦–é¡µï¼Œæ–°æ–‡ç« èµ«ç„¶åœ¨åˆ—ï¼Œå¹¶ä¸”æ•´ä¸ªç½‘ç«™çš„è®¿é—®é€Ÿåº¦ä¾ç„¶æ˜¯ç§’å¼€ï¼\nè‡³æ­¤ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å®ç°äº†æˆ‘ä»¬çš„ç»ˆæç›®æ ‡ï¼š\nğŸš€ æè‡´çš„æ€§èƒ½ï¼š99% çš„è®¿é—®å‹åŠ›éƒ½ç”± Cloudflare æ‰¿æ‹…ï¼Œä½ çš„æºæœåŠ¡å™¨è½»æ¾æ— æ¯”ã€‚ ğŸ”„ æ™ºèƒ½çš„æ›´æ–°ï¼šå†…å®¹ä¸€ç»ä¿®æ”¹ï¼Œç¼“å­˜è‡ªåŠ¨åˆ·æ–°ï¼Œè®¿å®¢æ°¸è¿œèƒ½çœ‹åˆ°æœ€æ–°çš„å†…å®¹ã€‚ ğŸ’° é›¶æˆæœ¬ï¼šè¿™ä¸€åˆ‡éƒ½åŸºäº Cloudflare çš„å…è´¹å¥—é¤ã€‚ ğŸ“Œ æ€»ç»“ ä»ä¸€ä¸ªæ¿’ä¸´å´©æºƒçš„æ…¢é€Ÿç½‘ç«™ï¼Œåˆ°ä¸€ä¸ªå…¼å…·æè‡´æ€§èƒ½å’ŒåŠ¨æ€æ›´æ–°çš„æµç•…ç«™ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡å‡ æ¡ç®€å•çš„ Cloudflare è§„åˆ™å’Œä¸€ä¸ªå°æ’ä»¶å°±å®Œæˆäº†èœ•å˜ã€‚è¿™å¥—æ–¹æ³•å°¤å…¶é€‚åˆä¸ªäººåšå®¢ã€ä¸­å°å‹ä¼ä¸šç½‘ç«™ç­‰é¢„ç®—æœ‰é™ä½†å¯¹æ€§èƒ½æœ‰è¿½æ±‚çš„åœºæ™¯ã€‚\nå¸Œæœ›è¿™ç¯‡ä»å…¥é—¨åˆ°å¡«å‘çš„ç»ˆææŒ‡å—èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å»è¯•è¯•å§ï¼Œè®©ä½ çš„ç½‘ç«™ä¹Ÿé£èµ·æ¥ï¼\nğŸ“¥ æ’ä»¶ä¸‹è½½åœ°å€ ","date":"2025-09-11T19:47:01+08:00","image":"https://file.meimolihan.eu.org/img/cloudflare-cache-rules-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0892fe26/","title":"é›¶æˆæœ¬ç½‘ç«™åŠ é€Ÿ Cloudflare ç¼“å­˜ä»å…¥é—¨åˆ°ç²¾é€š âœ¨"},{"content":"Google BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ç®¡ç†è„šæœ¬ ğŸš€ æœ¬æ–‡ä»‹ç»ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ç®¡ç†è„šæœ¬ï¼Œæ”¯æŒä¸€é”®å®‰è£…ã€æ›´æ–°å’Œç®¡ç† BBR v3 å†…æ ¸åŠæ‹¥å¡æ§åˆ¶é…ç½®ï¼Œå¸®åŠ©æ‚¨è½»æ¾ä¼˜åŒ–æœåŠ¡å™¨ç½‘ç»œæ€§èƒ½ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ“‹ è„šæœ¬ä¿¡æ¯ ğŸ–¥ï¸ æ”¯æŒçš„ç³»ç»Ÿ ğŸš€ ä¸»è¦åŠŸèƒ½ ğŸ“¥ ä½¿ç”¨æ–¹æ³• âš™ï¸ æŠ€æœ¯ç»†èŠ‚ ğŸ’¡ æ³¨æ„äº‹é¡¹ ğŸ”§ æ•…éšœæ’é™¤ âœ¨ è„šæœ¬ç‰¹ç‚¹ ğŸ¯ ä½¿ç”¨åœºæ™¯ ğŸ“‹ è„šæœ¬ä¿¡æ¯ è„šæœ¬åç§°: install-bbr.sh ä½œè€…: Joey æœ€æ–°ç‰ˆæœ¬: æ”¯æŒè‡ªåŠ¨æ£€æµ‹å’Œå®‰è£…æœ€æ–°ç‰ˆ BBR v3 å†…æ ¸ åé¦ˆæ¸ é“: Telegram ç¾¤ç»„ æä¾›æŠ€æœ¯äº¤æµå’Œæ”¯æŒ å¼€æºåœ°å€: è„šæœ¬åŸºäºå¼€æºé¡¹ç›®å¼€å‘ï¼ŒæŒç»­æ›´æ–°ç»´æŠ¤ ğŸ–¥ï¸ æ”¯æŒçš„ç³»ç»Ÿ ç³»ç»Ÿè¦æ±‚ ä»…æ”¯æŒåŸºäº Debian/Ubuntu çš„ç³»ç»Ÿ (åŒ…æ‹¬ Ubuntu 18.04+, Debian 10+ ç­‰ä¸»æµç‰ˆæœ¬) éœ€è¦ apt-get åŒ…ç®¡ç†å™¨ éœ€è¦ root æƒé™æ‰§è¡Œç®¡ç†æ“ä½œ æ”¯æŒçš„æ¶æ„ x86_64 (AMD64) - å¤§å¤šæ•°äº‘æœåŠ¡å™¨å’Œç‰©ç†æœº aarch64 (ARM64) - æ ‘è“æ´¾ã€ARMæœåŠ¡å™¨å’Œç§»åŠ¨è®¾å¤‡ è‡ªåŠ¨å®‰è£…çš„ä¾èµ– è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£…ä»¥ä¸‹å¿…è¦å·¥å…·ï¼š\ncurl, wget - ç”¨äºä¸‹è½½å†…æ ¸åŒ…å’Œèµ„æºæ–‡ä»¶ dpkg - ç”¨äºè½¯ä»¶åŒ…ç®¡ç†æ“ä½œ awk, sed - ç”¨äºæ–‡æœ¬å¤„ç†å’Œé…ç½®ä¿®æ”¹ sysctl - ç”¨äºå†…æ ¸å‚æ•°è°ƒæ•´ jq - ç”¨äºè§£æJSONæ•°æ®ï¼ˆè·å–ç‰ˆæœ¬ä¿¡æ¯ï¼‰ ğŸš€ ä¸»è¦åŠŸèƒ½ è„šæœ¬æä¾›ä»¥ä¸‹ä¸ƒå¤§æ“ä½œé€‰é¡¹ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ï¼š\nå®‰è£…æˆ–æ›´æ–° BBR v3 (æœ€æ–°ç‰ˆ) - è‡ªåŠ¨è·å–å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œä¿æŒç³»ç»Ÿæœ€æ–° æŒ‡å®šç‰ˆæœ¬å®‰è£… - ä»å¯ç”¨ç‰ˆæœ¬åˆ—è¡¨ä¸­é€‰æ‹©å®‰è£…ï¼Œé€‚åˆéœ€è¦ç‰¹å®šç‰ˆæœ¬çš„åœºæ™¯ æ£€æŸ¥ BBR v3 çŠ¶æ€ - éªŒè¯å½“å‰ BBR ç‰ˆæœ¬å’ŒçŠ¶æ€ï¼Œå¿«é€Ÿè¯Šæ–­é—®é¢˜ å¯ç”¨ BBR + FQ - é…ç½® BBR ä¸ FQ (Fair Queue) é˜Ÿåˆ—ç®—æ³•ï¼Œå¹³è¡¡æµé‡åˆ†é… å¯ç”¨ BBR + FQ_PIE - é…ç½® BBR ä¸ FQ_PIE é˜Ÿåˆ—ç®—æ³•ï¼Œå¢å¼ºç½‘ç»œç¨³å®šæ€§ å¯ç”¨ BBR + CAKE - é…ç½® BBR ä¸ CAKE é˜Ÿåˆ—ç®—æ³•ï¼Œæä¾›é«˜çº§æµé‡ç®¡ç†åŠŸèƒ½ å¸è½½ BBR å†…æ ¸ - å®‰å…¨ç§»é™¤ç”±æœ¬è„šæœ¬å®‰è£…çš„å†…æ ¸ï¼Œæ¢å¤åŸç³»ç»Ÿé…ç½® ğŸ“¥ ä½¿ç”¨æ–¹æ³• ä¸€é”®æ‰§è¡Œè„šæœ¬ ä½¿ç”¨ Vercel ä»“åº“:\n1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/bbr/install-bbr.sh) ä½¿ç”¨ Gitee ä»“åº“:\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/bbr/install-bbr.sh) ğŸ“ æ‰§è¡Œæµç¨‹ è¿è¡Œè„šæœ¬åä¼šæ˜¾ç¤ºå½“å‰ç³»ç»ŸçŠ¶æ€å’Œå¯é€‰æ“ä½œèœå• è¾“å…¥å¯¹åº”æ•°å­—é€‰æ‹©æ“ä½œï¼ˆ1-7ï¼‰ æ ¹æ®æç¤ºå®Œæˆç›¸åº”æ“ä½œ å¯¹äºå†…æ ¸å®‰è£…ï¼Œå®‰è£…å®Œæˆåå¯èƒ½éœ€è¦é‡å¯ç³»ç»Ÿç”Ÿæ•ˆ ğŸ”„ å®‰è£…åéªŒè¯ å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ BBR çŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥å½“å‰å¯ç”¨æ‹¥å¡æ§åˆ¶ç®—æ³• sysctl net.ipv4.tcp_congestion_control # æ£€æŸ¥é˜Ÿåˆ—è§„åˆ™ sysctl net.core.default_qdisc # æŸ¥çœ‹å½“å‰åŠ è½½çš„å†…æ ¸æ¨¡å— lsmod | grep bbr âš™ï¸ æŠ€æœ¯ç»†èŠ‚ é…ç½®æ–‡ä»¶ ç³»ç»Ÿç½‘ç»œé…ç½®ä¿å­˜åœ¨ /etc/sysctl.d/99-joeyblog.conf å†…æ ¸åŒ…æ¥è‡ª GitHub Releases: byJoey/Actions-bbr-v3 è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½åŸæœ‰é…ç½®ï¼Œä¾¿äºéœ€è¦æ—¶æ¢å¤ å¼•å¯¼æ›´æ–° è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ update-grub æ›´æ–°å¼•å¯¼é…ç½® å¯¹äº ARM ç³»ç»Ÿï¼ˆå¦‚ U-Bootï¼‰ï¼Œæä¾›ç›¸åº”æç¤ºä¿¡æ¯ æ”¯æŒå¤šå†…æ ¸å¹¶å­˜ï¼Œå¯è‡ªç”±é€‰æ‹©å¯åŠ¨å†…æ ¸ ğŸ”„ ç‰ˆæœ¬ç®¡ç† è‡ªåŠ¨æ£€æµ‹å·²å®‰è£…ç‰ˆæœ¬å’Œå¯ç”¨æ›´æ–° æ”¯æŒç‰ˆæœ¬åˆ—è¡¨æ˜¾ç¤ºå’Œé€‰æ‹©å®‰è£… è‡ªåŠ¨æ¸…ç†æ—§å†…æ ¸åŒ…ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ ğŸ’¡ æ³¨æ„äº‹é¡¹ æƒé™è¦æ±‚ - éœ€è¦ root æƒé™æ‰§è¡Œå†…æ ¸å®‰è£…å’Œé…ç½®ä¿®æ”¹æ“ä½œ é‡å¯è¦æ±‚ - å®‰è£…æ–°å†…æ ¸åéœ€è¦é‡å¯ç³»ç»Ÿæ‰èƒ½ç”Ÿæ•ˆï¼Œè„šæœ¬ä¼šæç¤ºé‡å¯ å…¼å®¹æ€§ - è„šæœ¬ä¼šè‡ªåŠ¨å¸è½½æ—§ç‰ˆæœ¬å†…æ ¸ä»¥é¿å…å†²çªï¼Œä½†å»ºè®®å¤‡ä»½é‡è¦æ•°æ® ç”Ÿäº§ç¯å¢ƒ - å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å…ˆæµ‹è¯•å†éƒ¨ç½²ï¼Œå¯åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ•ˆæœ ç½‘ç»œä¾èµ– - å®‰è£…è¿‡ç¨‹éœ€è¦è”ç½‘ä¸‹è½½å†…æ ¸åŒ…ï¼Œè¯·ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š ğŸ”§ æ•…éšœæ’é™¤ å¦‚æœè„šæœ¬æ‰§è¡Œå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ’æŸ¥æ­¥éª¤ï¼š\næ£€æŸ¥ç½‘ç»œè¿æ¥ - ç¡®ä¿æœåŠ¡å™¨å¯ä»¥æ­£å¸¸è®¿é—®äº’è”ç½‘å’ŒGitHub ç¡®è®¤ç³»ç»Ÿå…¼å®¹æ€§ - æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦ä¸ºæ”¯æŒçš„Debian/Ubuntuç‰ˆæœ¬ æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ - ä»”ç»†é˜…è¯»è„šæœ¬è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸åŒ…å«è§£å†³çº¿ç´¢ æ‰‹åŠ¨ä¸‹è½½æ‰§è¡Œ - å¦‚æœcurlç›´æ¥æ‰§è¡Œå¤±è´¥ï¼Œå¯ä»¥å°è¯•æ‰‹åŠ¨ä¸‹è½½è„šæœ¬ï¼š 1 2 3 wget https://raw.githubusercontent.com/byJoey/Actions-bbr-v3/master/install-bbr.sh chmod +x install-bbr.sh ./install-bbr.sh å¯»æ±‚å¸®åŠ© - å¯ä»¥é€šè¿‡Telegramç¾¤ç»„è”ç³»ä½œè€…æˆ–ç¤¾åŒºè·å–æ”¯æŒ âœ¨ è„šæœ¬ç‰¹ç‚¹ ğŸ”„ è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿæ¶æ„å’Œç‰ˆæœ¬ è‡ªåŠ¨å®‰è£…æ‰€éœ€ä¾èµ–é¡¹ è‡ªåŠ¨ä¸‹è½½å’ŒéªŒè¯å†…æ ¸åŒ… è‡ªåŠ¨é…ç½®ä¼˜åŒ–å‚æ•° ğŸ›¡ï¸ å®‰å…¨å¯é  ä½¿ç”¨å®˜æ–¹æºå’ŒéªŒè¯è¿‡çš„å†…æ ¸åŒ… æä¾›å¸è½½åŠŸèƒ½ï¼Œå¯å®Œæ•´æ¸…ç† é…ç½®ä¿®æ”¹å‰è‡ªåŠ¨å¤‡ä»½ é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„ï¼Œé¿å…åŠå®ŒæˆçŠ¶æ€ ğŸ“Š ç”¨æˆ·ä½“éªŒå¥½ æ¸…æ™°çš„äº¤äº’æç¤ºå’Œè¿›åº¦æ˜¾ç¤º é¢œè‰²åŒºåˆ†ä¸åŒç±»å‹ä¿¡æ¯ è¯¦ç»†çš„çŠ¶æ€æ£€æŸ¥å’ŒéªŒè¯åŠŸèƒ½ å¤šå¹³å°æ”¯æŒå’Œå®Œå–„çš„æ–‡æ¡£ ğŸ¯ ä½¿ç”¨åœºæ™¯ è¿™ä¸ªBBRç®¡ç†è„šæœ¬ç‰¹åˆ«é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nğŸŒ ç½‘ç»œä¼˜åŒ–éœ€æ±‚ æµ·å¤–æœåŠ¡å™¨åŠ é€Ÿ - å‡å°‘å›½é™…é“¾è·¯å»¶è¿Ÿå’Œä¸¢åŒ…å½±å“ è§†é¢‘æµåª’ä½“æœåŠ¡ - æä¾›æ›´ç¨³å®šçš„å¸¦å®½å’Œæ›´ä½çš„ç¼“å†² æ¸¸æˆæœåŠ¡å™¨ - é™ä½ç½‘ç»œå»¶è¿Ÿå’ŒæŠ–åŠ¨ï¼Œæå‡æ¸¸æˆä½“éªŒ å¤§æ–‡ä»¶ä¼ è¾“ - æé«˜ä¼ è¾“æ•ˆç‡å’Œé€Ÿåº¦ç¨³å®šæ€§ ğŸ–¥ï¸ æœåŠ¡å™¨ç®¡ç† æ‰¹é‡æœåŠ¡å™¨éƒ¨ç½² - ä¸€é”®æ ‡å‡†åŒ–ç½‘ç»œé…ç½® è‡ªåŠ¨åŒ–è¿ç»´ - å¯é›†æˆåˆ°è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ä¸­ æ€§èƒ½è°ƒä¼˜ - å¿«é€Ÿæµ‹è¯•ä¸åŒæ‹¥å¡ç®—æ³•æ•ˆæœ ä¸´æ—¶åŠ é€Ÿ - æ´»åŠ¨æœŸé—´ä¸´æ—¶æå‡ç½‘ç»œæ€§èƒ½ é€šè¿‡è¿™ä¸ªè„šæœ¬ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç†å’Œä¼˜åŒ–æœåŠ¡å™¨çš„ç½‘ç»œæ€§èƒ½ï¼Œäº«å— BBR v3 å¸¦æ¥çš„ç½‘ç»œåŠ é€Ÿæ•ˆæœã€‚æ— è®ºæ˜¯ä¸ªäººé¡¹ç›®è¿˜æ˜¯ä¼ä¸šåº”ç”¨ï¼Œéƒ½èƒ½ä»ä¸­è·å¾—æ˜¾è‘—çš„ç½‘ç»œæ€§èƒ½æå‡ã€‚\nğŸ’¡ æç¤ºï¼šå»ºè®®å®šæœŸæ£€æŸ¥æ›´æ–°ï¼Œä»¥è·å–æœ€æ–°ç‰ˆæœ¬çš„BBRæ”¹è¿›å’Œæ€§èƒ½ä¼˜åŒ–ã€‚\n","date":"2025-09-11T18:42:17+08:00","image":"https://file.meimolihan.eu.org/img/google-bbr-01.webp","permalink":"https://blog.meimolihan.eu.org/p/02126b03/","title":"Google BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ç®¡ç†è„šæœ¬ ğŸš€"},{"content":"Linux é…ç½® Google BBR åŠ é€ŸæŠ€æœ¯æŒ‡å— ğŸ“ˆ ğŸ“– å¯¼èˆªç›®å½• ğŸš€ BBRæŠ€æœ¯æ¦‚è¿° ğŸ“‹ å¯ç”¨å‰çš„ç³»ç»Ÿæ£€æŸ¥ ğŸ› ï¸ é£ç‰›OSå¯ç”¨BBRå®Œæ•´æ­¥éª¤ ğŸ“ æ­¥éª¤1ï¼šåŠ è½½BBRå†…æ ¸æ¨¡å— ğŸ“ æ­¥éª¤2ï¼šè®¾ç½®æ‹¥å¡æ§åˆ¶ç®—æ³• ğŸ“ æ­¥éª¤3ï¼šé…ç½®å…¬å¹³é˜Ÿåˆ—(FQ) ğŸ“ æ­¥éª¤4ï¼šåˆ›å»ºæŒä¹…åŒ–é…ç½®æ–‡ä»¶ ğŸ“ æ­¥éª¤5ï¼šåº”ç”¨æ–°é…ç½® âš™ï¸ Proxmox VEå¯ç”¨BBRå®Œæ•´æ­¥éª¤ ğŸ”§ æ­¥éª¤1ï¼šåŠ è½½BBRå†…æ ¸æ¨¡å— ğŸ”§ æ­¥éª¤2ï¼šè®¾ç½®BBRä¸ºæ‹¥å¡æ§åˆ¶ç®—æ³• ğŸ”§ æ­¥éª¤3ï¼šé…ç½®å…¬å¹³é˜Ÿåˆ—(FQ) ğŸ”§ æ­¥éª¤4ï¼šåˆ›å»ºæŒä¹…åŒ–é…ç½®æ–‡ä»¶ ğŸ”§ æ­¥éª¤5ï¼šåº”ç”¨æ–°é…ç½®å¹¶ä¼˜åŒ–é™„åŠ å‚æ•° ğŸ§ Debianç³»ç»Ÿå¯ç”¨BBR ğŸª„ æ–¹æ³•ä¸€ï¼šä¸€é”®è„šæœ¬é…ç½® ğŸ› ï¸ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨é…ç½® ğŸ§ª ç½‘ç»œæ€§èƒ½æµ‹è¯•æ–¹æ³• âš ï¸ æ³¨æ„äº‹é¡¹ä¸å›é€€æ–¹æ¡ˆ â“ å¸¸è§é—®é¢˜è§£ç­” ğŸ’ æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸš€ BBRæŠ€æœ¯æ¦‚è¿° BBRï¼ˆBottleneck Bandwidth and Round-trip propagation timeï¼‰æ˜¯Googleå¼€å‘çš„ä¸€ç§é©å‘½æ€§TCPæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œé€šè¿‡æ™ºèƒ½æµ‹é‡ç½‘ç»œè·¯å¾„çš„å¸¦å®½å®¹é‡å’Œå¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰æ¥åŠ¨æ€ä¼˜åŒ–æ•°æ®å‘é€é€Ÿç‡ã€‚ä¸ä¼ ç»Ÿç®—æ³•ç›¸æ¯”ï¼ŒBBRæä¾›äº†æ›´æ™ºèƒ½çš„ç½‘ç»œæµé‡ç®¡ç†æ–¹å¼ï¼\nâœ¨ BBRçš„æ ¸å¿ƒä¼˜åŠ¿ ğŸ“¶ æå‡ç½‘ç»œååé‡ï¼šå¹³å‡æå‡30%ä»¥ä¸Šä¼ è¾“é€Ÿåº¦ â±ï¸ é™ä½ç½‘ç»œå»¶è¿Ÿï¼šå‡å°‘20-30%çš„ç½‘ç»œå“åº”æ—¶é—´ ğŸ“‰ å‡å°‘æ•°æ®åŒ…ä¸¢å¤±ï¼šæ›´æ™ºèƒ½çš„æ‹¥å¡é¢„æµ‹æœºåˆ¶ ğŸŒ é«˜å¸¦å®½é«˜å»¶è¿Ÿä¼˜åŒ–ï¼šç‰¹åˆ«é€‚åˆç°ä»£ç½‘ç»œç¯å¢ƒ ğŸ”„ æ›´å¥½çš„å…¬å¹³æ€§ï¼šä¸å…¶ä»–BBRæµå…±äº«å¸¦å®½æ›´å…¬å¹³ ğŸ“‹ å¯ç”¨å‰çš„ç³»ç»Ÿæ£€æŸ¥ ğŸ” 1. éªŒè¯å†…æ ¸ç‰ˆæœ¬ BBRéœ€è¦Linuxå†…æ ¸4.9åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ£€æŸ¥æ‚¨çš„ç³»ç»Ÿæ˜¯å¦æ»¡è¶³è¦æ±‚ï¼š\n1 2 3 4 uname -r # é£ç‰›OS 32.5 è¾“å‡ºç¤ºä¾‹ï¼š5.15.0-xx-generic # Proxmox VE 32.254 è¾“å‡ºç¤ºä¾‹ï¼š6.2.16-xx-pve # Debian 11/12 è¾“å‡ºç¤ºä¾‹ï¼š5.10.0-xx-amd64 æˆ– 6.1.0-xx-amd64 ğŸ” 2. æ£€æŸ¥å½“å‰æ‹¥å¡æ§åˆ¶ç®—æ³• 1 2 sysctl net.ipv4.tcp_congestion_control # é»˜è®¤è¾“å‡ºå¯èƒ½ä¸ºï¼šcubic æˆ– reno ğŸ” 3. ç¡®è®¤BBRæ¨¡å—å¯ç”¨æ€§ 1 2 sudo modprobe tcp_bbr \u0026amp;\u0026amp; echo \u0026#34;âœ… BBRæ¨¡å—å¯ç”¨\u0026#34; lsmod | grep bbr ğŸ› ï¸ é£ç‰›OSå¯ç”¨BBRå®Œæ•´æ­¥éª¤ ğŸ“ æ­¥éª¤1ï¼šåŠ è½½BBRå†…æ ¸æ¨¡å— 1 sudo modprobe tcp_bbr ğŸ“ æ­¥éª¤2ï¼šè®¾ç½®æ‹¥å¡æ§åˆ¶ç®—æ³• 1 sudo sysctl -w net.ipv4.tcp_congestion_control=bbr ğŸ“ æ­¥éª¤3ï¼šé…ç½®å…¬å¹³é˜Ÿåˆ—(FQ) 1 sudo sysctl -w net.core.default_qdisc=fq ğŸ“ æ­¥éª¤4ï¼šåˆ›å»ºæŒä¹…åŒ–é…ç½®æ–‡ä»¶ 1 2 echo \u0026#34;net.ipv4.tcp_congestion_control=bbr\u0026#34; | sudo tee -a /etc/sysctl.d/99-bbr.conf echo \u0026#34;net.core.default_qdisc=fq\u0026#34; | sudo tee -a /etc/sysctl.d/99-bbr.conf ğŸ“ æ­¥éª¤5ï¼šåº”ç”¨æ–°é…ç½® 1 sudo sysctl -p /etc/sysctl.d/99-bbr.conf âš™ï¸ Proxmox VEå¯ç”¨BBRå®Œæ•´æ­¥éª¤ ğŸ”§ æ­¥éª¤1ï¼šåŠ è½½BBRå†…æ ¸æ¨¡å— 1 modprobe tcp_bbr ğŸ”§ æ­¥éª¤2ï¼šè®¾ç½®BBRä¸ºæ‹¥å¡æ§åˆ¶ç®—æ³• 1 sysctl -w net.ipv4.tcp_congestion_control=bbr ğŸ”§ æ­¥éª¤3ï¼šé…ç½®å…¬å¹³é˜Ÿåˆ—(FQ) 1 sysctl -w net.core.default_qdisc=fq ğŸ”§ æ­¥éª¤4ï¼šåˆ›å»ºæŒä¹…åŒ–é…ç½®æ–‡ä»¶ 1 2 echo \u0026#34;net.ipv4.tcp_congestion_control=bbr\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf echo \u0026#34;net.core.default_qdisc=fq\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf ğŸ”§ æ­¥éª¤5ï¼šåº”ç”¨æ–°é…ç½®å¹¶ä¼˜åŒ–é™„åŠ å‚æ•° 1 2 3 4 5 6 7 8 9 # åº”ç”¨BBRé…ç½® sysctl -p /etc/sysctl.d/99-bbr.conf # ä¼˜åŒ–ç½‘ç»œå†…å­˜å‚æ•°ï¼ˆProxmoxç‰¹åˆ«æ¨èï¼‰ echo \u0026#34;net.core.rmem_max=16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf echo \u0026#34;net.core.wmem_max=16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf echo \u0026#34;net.ipv4.tcp_rmem=4096 87380 16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf echo \u0026#34;net.ipv4.tcp_wmem=4096 65536 16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf sysctl -p /etc/sysctl.d/99-bbr.conf ğŸ§ Debianç³»ç»Ÿå¯ç”¨BBR ğŸª„ æ–¹æ³•ä¸€ï¼šä¸€é”®è„šæœ¬é…ç½® å¯¹äºåŸºäºDebiançš„ç³»ç»Ÿï¼ˆåŒ…æ‹¬Ubuntuã€é£ç‰›OSç­‰ï¼‰ï¼Œå¯ä½¿ç”¨ä¸€é”®é…ç½®è„šæœ¬ï¼š\n1 2 # ä½¿ç”¨ç§‘æŠ€Lionçš„ä¸€é”®è„šæœ¬ bash \u0026lt;(curl -sL kejilion.sh) é€‰æ‹©èœå•é€‰é¡¹ï¼š13. ç³»ç»Ÿå·¥å…· â†’ 16. è®¾ç½®BBR3åŠ é€Ÿ\nğŸ› ï¸ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. ç¼–è¾‘sysctlé…ç½®æ–‡ä»¶ sudo nano /etc/sysctl.d/99-bbr.conf # 2. æ·»åŠ ä»¥ä¸‹å†…å®¹ net.core.default_qdisc = fq net.ipv4.tcp_congestion_control = bbr net.ipv4.tcp_fastopen = 3 # 3. ä¿å­˜å¹¶åº”ç”¨é…ç½® sudo sysctl -p /etc/sysctl.d/99-bbr.conf # 4. æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ sysctl net.ipv4.tcp_congestion_control # åº”è¯¥æ˜¾ç¤º: net.ipv4.tcp_congestion_control = bbr ğŸ§ª ç½‘ç»œæ€§èƒ½æµ‹è¯•æ–¹æ³• ğŸ“Š éªŒè¯BBRæ˜¯å¦å¯ç”¨æˆåŠŸ 1 2 3 4 5 6 7 8 sysctl net.ipv4.tcp_congestion_control # åº”è¾“å‡ºï¼šnet.ipv4.tcp_congestion_control = bbr sysctl net.core.default_qdisc # åº”è¾“å‡ºï¼šnet.core.default_qdisc = fq # ä½¿ç”¨sså‘½ä»¤æ£€æŸ¥å®é™…è¿æ¥ ss -tin | grep bbr ğŸ§ª æ€§èƒ½åŸºå‡†æµ‹è¯• 1 2 3 4 5 6 7 8 # å®‰è£…iperf3ï¼ˆè‹¥æœªå®‰è£…ï¼‰ sudo apt install iperf3 -y # å»ºç«‹æµ‹è¯•æœåŠ¡å™¨ï¼ˆåœ¨å¦ä¸€å°æœºå™¨ï¼‰ iperf3 -s # åœ¨å·²å¯ç”¨BBRçš„ç³»ç»Ÿä¸Šè¿è¡Œå®¢æˆ·ç«¯æµ‹è¯• iperf3 -c \u0026lt;server_ip\u0026gt; -t 30 -P 4 ğŸ“ˆ Proxmoxç‰¹å®šæµ‹è¯• 1 2 3 4 5 6 # è™šæ‹Ÿæœºé—´ç½‘ç»œæ€§èƒ½æµ‹è¯• vm_id=100 time qm migrate $vm_id \u0026lt;target_node\u0026gt; --online --with-local-disks # å­˜å‚¨æ€§èƒ½æµ‹è¯• fio --name=test --ioengine=libaio --rw=randrw --bs=4k --numjobs=4 --size=1G --time_based --runtime=60 âš ï¸ æ³¨æ„äº‹é¡¹ä¸å›é€€æ–¹æ¡ˆ ğŸ¯ ç³»ç»Ÿå…¼å®¹æ€§è¯´æ˜ é£ç‰›OSï¼šåŸºäºUbuntuï¼Œå†…æ ¸ç‰ˆæœ¬é€šå¸¸â‰¥5.15ï¼Œå®Œå…¨æ”¯æŒBBR Proxmox VEï¼šä½¿ç”¨6.2+å†…æ ¸ï¼ŒBBRæ”¯æŒå®Œå–„ Debianç³»ç»Ÿï¼šDebian 10+ å†…æ ¸ç‰ˆæœ¬â‰¥4.19ï¼Œæ”¯æŒBBR è™šæ‹ŸåŒ–ç¯å¢ƒï¼šåœ¨VMWare/KVMä¸­æ€§èƒ½æå‡æ˜¾è‘— å®¹å™¨ç¯å¢ƒï¼šDockerå®¹å™¨å†…éœ€åœ¨ä¸»OSå¯ç”¨BBR ğŸ”™ å›é€€åˆ°é»˜è®¤è®¾ç½® å¦‚é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯æ¢å¤é»˜è®¤é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æ¢å¤é»˜è®¤æ‹¥å¡æ§åˆ¶ç®—æ³• sudo sysctl -w net.ipv4.tcp_congestion_control=cubic # æ¢å¤é»˜è®¤æ’é˜Ÿè§„åˆ™ sudo sysctl -w net.core.default_qdisc=fq_codel # åˆ é™¤BBRé…ç½®æ–‡ä»¶ sudo rm /etc/sysctl.d/99-bbr.conf # é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½® sudo sysctl -p /etc/sysctl.conf â“ å¸¸è§é—®é¢˜è§£ç­” â” BBRæ˜¯å¦ä¼šå½±å“ç³»ç»Ÿç¨³å®šæ€§ï¼Ÿ Aï¼šBBRå·²é›†æˆåœ¨ä¸»æµLinuxå†…æ ¸ä¸­ï¼Œç»è¿‡å¹¿æ³›æµ‹è¯•ï¼Œä¸å½±å“ç³»ç»Ÿç¨³å®šæ€§ã€‚\nâ” å¯ç”¨BBRéœ€è¦é‡å¯ç³»ç»Ÿå—ï¼Ÿ Aï¼šä¸éœ€è¦ç«‹å³é‡å¯ï¼Œé…ç½®ä¼šç«‹å³ç”Ÿæ•ˆä¸”å·²æŒä¹…åŒ–ï¼Œä½†å»ºè®®é‡å¯åéªŒè¯é…ç½®ã€‚\nâ” BBRv2å’ŒBBRv1æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Aï¼šBBRv2è¿›ä¸€æ­¥å‡å°‘ä¸¢åŒ…ç‡ï¼Œä½†å½“å‰ä¸»æµç³»ç»Ÿé»˜è®¤é›†æˆBBRv1ã€‚\nâ” å¦‚ä½•ç›‘æ§BBRè¿è¡Œæ•ˆæœï¼Ÿ 1 2 # å®æ—¶ç›‘æ§BBRè¿æ¥çŠ¶æ€ watch -d -n 1 \u0026#34;ss -tin | grep bbr\u0026#34; â” BBRå¯¹Proxmoxé›†ç¾¤æœ‰ä½•å½±å“ï¼Ÿ Aï¼šå»ºè®®åœ¨é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹å¯ç”¨ç›¸åŒé…ç½®ï¼Œå¯æå‡è·¨èŠ‚ç‚¹è¿ç§»å’Œå­˜å‚¨å¤åˆ¶æ€§èƒ½ã€‚\nâ” Debianç³»ç»Ÿå¯ç”¨BBRçš„æœ€ä½³æ–¹æ³•ï¼Ÿ Aï¼šå¯¹äºæ–°æ‰‹æ¨èä½¿ç”¨ä¸€é”®è„šæœ¬ï¼Œå¯¹äºæœ‰ç»éªŒçš„ç”¨æˆ·å»ºè®®æ‰‹åŠ¨é…ç½®ä»¥ä¾¿æ›´å¥½ç†è§£åŸç†ã€‚\nğŸ’ æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸš€ é£ç‰›OSä¼˜åŒ–è¡¥å…… ğŸ“¶ ç½‘ç»œç¯å¢ƒé€‚é…ï¼š\né«˜å»¶è¿Ÿç½‘ç»œï¼ˆ\u0026gt;50msï¼‰æå‡æœ€æ˜æ˜¾ ä½å¸¦å®½ç¯å¢ƒï¼ˆ\u0026lt;10Mbpsï¼‰å¯èƒ½æå‡æœ‰é™ ğŸ”„ ç»“åˆå¤šé˜Ÿåˆ—ç½‘å¡ï¼š\n1 2 3 # æ£€æŸ¥å¹¶è®¾ç½®ç½‘å¡å¤šé˜Ÿåˆ— ethtool -l eth0 ethtool -L eth0 combined 8 ğŸš€ Proxmox VEé«˜çº§ä¼˜åŒ– ğŸ”§ ä¸­æ–­å¹³è¡¡ä¼˜åŒ–ï¼š\n1 2 apt install irqbalance systemctl enable irqbalance \u0026amp;\u0026amp; systemctl start irqbalance â±ï¸ å¯ç”¨TCPæ—¶é—´æˆ³ï¼š\n1 2 echo \u0026#34;net.ipv4.tcp_timestamps=1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf sysctl -p /etc/sysctl.d/99-bbr.conf ğŸ”„ SR-IOVä¼˜åŒ–ï¼š\n1 2 # æ£€æŸ¥ç¡¬ä»¶å¸è½½æ”¯æŒ ethtool -k \u0026lt;interface\u0026gt; | grep hw-tc-offload ğŸ§ Debianç³»ç»Ÿä¼˜åŒ– ğŸ“Š å†…æ ¸å‚æ•°è°ƒä¼˜ï¼š\n1 2 3 # å¢åŠ TCPè¿æ¥æ•°é™åˆ¶ echo \u0026#34;net.core.somaxconn = 65535\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf echo \u0026#34;net.ipv4.tcp_max_syn_backlog = 65535\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.d/99-bbr.conf ğŸ”„ å®šæœŸæ›´æ–°ç³»ç»Ÿï¼š\n1 2 # ä¿æŒç³»ç»Ÿæœ€æ–°ä»¥è·å¾—æœ€ä½³BBRæ€§èƒ½ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y ğŸ“ˆ æ•ˆæœè¯„ä¼°ï¼šå¯ç”¨BBRåï¼Œæ‚¨åº”è¯¥åœ¨ä»¥ä¸‹åœºæ™¯è§‚å¯Ÿåˆ°æ€§èƒ½æå‡ï¼š\nè§†é¢‘æµåª’ä½“æ’­æ”¾æ›´æµç•… å¤§æ–‡ä»¶ä¼ è¾“é€Ÿåº¦æå‡ è¿œç¨‹è®¿é—®å“åº”æ›´å¿« è™šæ‹Ÿæœºè¿ç§»æ—¶é—´å‡å°‘ï¼ˆProxmoxï¼‰ å­˜å‚¨å¤åˆ¶åŒæ­¥åŠ é€Ÿ å»ºè®®è§‚å¯Ÿ24-48å°æ—¶å†…çš„ç³»ç»Ÿè´Ÿè½½å’Œç½‘ç»œå»¶è¿Ÿå˜åŒ–ï¼Œä½¿ç”¨ç³»ç»Ÿå†…ç½®ç›‘æ§å·¥å…·è¿›è¡Œå‰åå¯¹æ¯”è¯„ä¼°ã€‚\n","date":"2025-09-11T18:21:39+08:00","image":"https://file.meimolihan.eu.org/img/google-bbr-01.webp","permalink":"https://blog.meimolihan.eu.org/p/75d09950/","title":"Linux é…ç½® Google BBR åŠ é€ŸæŠ€æœ¯æŒ‡å— ğŸ“ˆ"},{"content":"Linux SSH æœåŠ¡ä¸€é”®é…ç½®è„šæœ¬ä½¿ç”¨æŒ‡å— ğŸš€ æœ¬æ–‡è¯¦ç»†ä»‹ç»ä¸€ä¸ªé«˜æ•ˆç®¡ç† SSH æœåŠ¡çš„ Bash è„šæœ¬ï¼šsetup-ssh.shï¼ˆSSH æœåŠ¡ç«¯é…ç½®è„šæœ¬ï¼‰ã€‚ âœ… æ”¯æŒä¸»æµ Linux å‘è¡Œç‰ˆï¼šDebian, Ubuntu, CentOS, RHEL, Fedora, OpenSUSE, Arch Linuxã€‚\nğŸ“– å¯¼èˆªç›®å½• ğŸ“Œ è„šæœ¬æ¦‚è¿° ğŸ”§ åŠŸèƒ½ç‰¹ç‚¹ ğŸš€ ä¸€ã€è„šæœ¬ä½¿ç”¨æ–¹æ³• ğŸ› ï¸ äºŒã€è¡¥å……ç›¸å…³å‘½ä»¤ ğŸ¯ ä¸‰ã€SSH ä½¿ç”¨ç¤ºä¾‹ ğŸ”‘ 1. SSH å¯†é’¥è®¤è¯é…ç½® ğŸ”„ 2. SSH ç«¯å£è½¬å‘ â“ å››ã€å¸¸è§é—®é¢˜è§£å†³ ğŸ”’ äº”ã€SSH å®‰å…¨å»ºè®® ğŸ“ å…­ã€æ€»ç»“ ğŸ“Œ è„šæœ¬æ¦‚è¿° SSHï¼ˆSecure Shellï¼‰æ˜¯ç”¨äºå®‰å…¨è¿œç¨‹ç™»å½•å’Œæ‰§è¡Œå‘½ä»¤çš„ç½‘ç»œåè®®ï¼Œæ˜¯ç®¡ç† Linux æœåŠ¡å™¨çš„æ ‡å‡†å·¥å…·ã€‚ä¸‹é¢ä»‹ç»çš„è„šæœ¬æå¤§ç®€åŒ–äº† SSH æœåŠ¡çš„é…ç½®å’Œç®¡ç†æµç¨‹ã€‚âœ¨\nğŸ”§ åŠŸèƒ½ç‰¹ç‚¹ æ­¤è„šæœ¬ç”¨äºè‡ªåŠ¨åŒ–å®‰è£…å’Œé…ç½® SSH æœåŠ¡å™¨ï¼Œä¼˜åŒ–è¿æ¥å‚æ•°å¹¶è®¾ç½®é˜²ç«å¢™è§„åˆ™ï¼Œç‰¹åˆ«é€‚åˆå¿«é€Ÿéƒ¨ç½²å’Œæ‰¹é‡é…ç½®åœºæ™¯ã€‚ğŸ¯\nâœ… è‡ªåŠ¨æ£€æµ‹ç³»ç»ŸåŒ…ç®¡ç†å™¨ï¼ˆAPT/YUM/DNF/ZYPPER/PACMANï¼‰å¹¶å®‰è£… SSH æœåŠ¡ âœ… æ”¯æŒä¸»æµ Linux å‘è¡Œç‰ˆï¼šDebian, Ubuntu, CentOS, RHEL, Fedora, OpenSUSE, Arch Linux âœ… ä¼˜åŒ– SSH è¿æ¥å‚æ•°ï¼ˆç¦ç”¨ DNS æŸ¥è¯¢ï¼Œå¯ç”¨å‹ç¼©ï¼Œä¿æŒè¿æ¥ç­‰ï¼‰ âœ… è‡ªåŠ¨é…ç½®é˜²ç«å¢™å…è®¸ SSH è¿æ¥ï¼ˆæ”¯æŒ ufw, firewalld, iptablesï¼‰ âœ… å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿æ“ä½œå®‰å…¨å¯é€† âœ… æä¾›æ¸…æ™°çš„è¿æ¥ä¿¡æ¯å’Œå®‰å…¨å»ºè®® âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•åŠŸèƒ½ ä¸€ã€ ğŸš€è„šæœ¬ä½¿ç”¨æ–¹æ³• 1. å®‰è£…åŸºç¡€è½¯ä»¶ 1 apt update -y \u0026amp;\u0026amp; apt install -y rsync sudo curl wget vim tree samba nfs-common openssh-server zip htop net-tools 2. ä¸€é”®é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/ssh/setup-ssh.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/ssh/setup-ssh.sh) # æˆ–è€…å…ˆä¸‹è½½å†æ‰§è¡Œ wget -c https://gitee.com/meimolihan/script/raw/master/sh/ssh/setup-ssh.sh chmod +x setup-ssh.sh sudo ./setup-ssh.sh 3. æŸ¥çœ‹ä¿®æ”¹ 1 grep -E \u0026#39;Port 22|PermitRootLogin|GSSAPIAuthentication|UseDNS|Compression|ClientAliveInterval|ClientAliveCountMax|TCPKeepAlive|PrintMotd|PrintLastLog|X11Forwarding\u0026#39; /etc/ssh/sshd_config å‘½ä»¤ç‰‡æ®µ ä¸€å¥è¯è§£é‡Š # the setting of \u0026ldquo;PermitRootLogin prohibit-password åˆ é™¤é‚£è¡Œçº¯æ³¨é‡Šæç¤ºã€‚ Port 22 å¼ºåˆ¶ç›‘å¬ 22 ç«¯å£ã€‚ PermitRootLogin yes å…è®¸ root ç›´æ¥å¯†ç /å¯†é’¥ç™»å½•ã€‚ GSSAPIAuthentication no å…³é—­ GSSAPIï¼ŒåŠ å¿«è¿æ¥é€Ÿåº¦ã€‚ PrintMotd no çœæ‰ç™»å½•æç¤ºï¼Œæé€Ÿã€‚ PrintLastLog no å…³é—­â€œä¸Šæ¬¡ç™»å½•â€æç¤ºã€‚ UseDNS no ç¦ç”¨åå‘ DNSï¼Œé˜²æ­¢ç™»å½•å¡æ…¢ã€‚ Compression delayed æ ¹æ®æ•°æ®æƒ…å†µå†³å®šæ˜¯å¦å¯ç”¨å‹ç¼©ã€‚ ClientAliveInterval 30 æ¯ 30 ç§’æœåŠ¡ç«¯å‘ä¸€æ¬¡å¿ƒè·³ã€‚ ClientAliveCountMax 120 è¿ç»­ 120 æ¬¡æ— å“åº”æ‰æ–­å¼€ 1 å°æ—¶ã€‚ TCPKeepAlive no ä»…ç”¨ SSH å±‚å¿ƒè·³ï¼Œé¿å…ä¼ªé€  RST å¯¼è‡´è¯¯æ–­ã€‚ X11Forwarding no å…³é—­ X11 è½¬å‘ã€‚ 4. å…¬é’¥è®¤è¯å¼€å…³å’Œå…¬é’¥æ–‡ä»¶è·¯å¾„ï¼ˆé€‰åšï¼‰ 1 2 sed -i \u0026#39;s/^#*PubkeyAuthentication.*/PubkeyAuthentication yes/\u0026#39; /etc/ssh/sshd_config sed -i \u0026#39;s/^#*AuthorizedKeysFile.*/AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2/\u0026#39; /etc/ssh/sshd_config äºŒã€ğŸ› ï¸ è¡¥å…… SSH ç›¸å…³å‘½ä»¤ é™¤äº†ä½¿ç”¨è„šæœ¬å¤–ï¼ŒæŒæ¡ä»¥ä¸‹ SSH å‘½ä»¤å°†å¸®åŠ©æ‚¨æ›´çµæ´»åœ°ç®¡ç†è¿œç¨‹è¿æ¥ã€‚ğŸ“š\nğŸ“Š æœåŠ¡å™¨ç«¯ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹ SSH æœåŠ¡çŠ¶æ€ sudo systemctl status ssh sudo systemctl status sshd # å¯åŠ¨/åœæ­¢/é‡å¯ SSH æœåŠ¡ sudo systemctl start ssh sudo systemctl stop ssh sudo systemctl restart ssh # é‡æ–°åŠ è½½ SSH é…ç½®ï¼ˆä¸ä¸­æ–­ç°æœ‰è¿æ¥ï¼‰ sudo systemctl reload ssh # æŸ¥çœ‹ SSH è¿æ¥æ—¥å¿— sudo tail -f /var/log/auth.log | grep ssh sudo journalctl -u ssh -f # æŸ¥çœ‹å½“å‰è¿æ¥çš„ SSH ç”¨æˆ· who w ps aux | grep sshd # æŸ¥çœ‹ SSH é…ç½®æ–‡ä»¶è¯­æ³• sshd -t # ç”Ÿæˆ SSH ä¸»æœºå¯†é’¥ sudo ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key sudo ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key sudo ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key ğŸ’» å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # åŸºæœ¬è¿æ¥ ssh username@hostname # æŒ‡å®šç«¯å£è¿æ¥ ssh -p 2222 username@hostname # ä½¿ç”¨ç‰¹å®šç§é’¥è¿æ¥ ssh -i ~/.ssh/mykey username@hostname # è¿œç¨‹æ‰§è¡Œå‘½ä»¤ ssh username@hostname \u0026#34;ls -la\u0026#34; # å¯ç”¨è¯¦ç»†æ¨¡å¼ï¼ˆè°ƒè¯•ç”¨ï¼‰ ssh -v username@hostname # å¯ç”¨å‹ç¼©ï¼ˆæ…¢é€Ÿç½‘ç»œæœ‰ç”¨ï¼‰ ssh -C username@hostname # X11 è½¬å‘ï¼ˆå›¾å½¢ç•Œé¢ï¼‰ ssh -X username@hostname # ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°ç«¯å£è½¬å‘ï¼‰ ssh -L 8080:localhost:80 username@hostname # ç«¯å£è½¬å‘ï¼ˆè¿œç¨‹ç«¯å£è½¬å‘ï¼‰ ssh -R 9090:localhost:90 username@hostname # SOCKS ä»£ç† ssh -D 1080 username@hostname # æ–‡ä»¶ä¼ è¾“ï¼ˆSCPï¼‰ scp file.txt username@hostname:/path/to/destination scp -r directory username@hostname:/path/to/destination # å®‰å…¨æ–‡ä»¶ä¼ è¾“ï¼ˆSFTPï¼‰ sftp username@hostname # åŒæ­¥æ–‡ä»¶ï¼ˆRSYNC over SSHï¼‰ rsync -avz -e ssh /local/path username@hostname:/remote/path ğŸ” æ•…éšœæ’æŸ¥å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æ£€æŸ¥ SSH ç«¯å£æ˜¯å¦å¼€æ”¾ nc -zv hostname 22 nmap -p 22 hostname # æµ‹è¯•è¿æ¥ï¼ˆä¸æ‰§è¡Œå‘½ä»¤ï¼‰ ssh -T username@hostname # æ£€æŸ¥å…¬é’¥æŒ‡çº¹ ssh-keygen -lf /etc/ssh/ssh_host_rsa_key.pub # è°ƒè¯• SSH å®¢æˆ·ç«¯ ssh -vvv username@hostname # è°ƒè¯• SSH æœåŠ¡å™¨ç«¯ï¼ˆä¸´æ—¶å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼‰ sudo /usr/sbin/sshd -d -p 2222 # æ£€æŸ¥ SSH é…ç½®è¯­æ³• sudo sshd -t # æŸ¥çœ‹å¤±è´¥çš„ç™»å½•å°è¯• sudo grep \u0026#34;Failed password\u0026#34; /var/log/auth.log sudo lastb # æŸ¥çœ‹æˆåŠŸçš„ç™»å½•è®°å½• sudo last ä¸‰ã€ğŸ¯ SSH ä½¿ç”¨ç¤ºä¾‹ ğŸ”‘ 1. SSH å¯†é’¥è®¤è¯é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆå®¢æˆ·ç«¯ï¼‰ ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; # æ›´å®‰å…¨çš„é€‰æ‹© # å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨ ssh-copy-id username@hostname # æˆ–è€…æ‰‹åŠ¨å¤åˆ¶ cat ~/.ssh/id_rsa.pub | ssh username@hostname \u0026#34;mkdir -p ~/.ssh \u0026amp;\u0026amp; cat \u0026gt;\u0026gt; ~/.ssh/authorized_keys\u0026#34; # è®¾ç½®æ­£ç¡®çš„æƒé™ ssh username@hostname \u0026#34;chmod 700 ~/.ssh; chmod 600 ~/.ssh/authorized_keys\u0026#34; # ç¦ç”¨å¯†ç è®¤è¯ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ # ç¼–è¾‘ /etc/ssh/sshd_config # è®¾ç½® PasswordAuthentication no # ç„¶åé‡å¯ SSH æœåŠ¡ ğŸ”„ 2. SSH ç«¯å£è½¬å‘å’Œéš§é“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æœ¬åœ°ç«¯å£è½¬å‘ï¼ˆè®¿é—®è¿œç¨‹æœåŠ¡çš„æœ¬åœ°ç«¯å£ï¼‰ ssh -L 3306:localhost:3306 username@hostname # MySQL éš§é“ ssh -L 8080:localhost:80 username@hostname # Web æœåŠ¡å™¨éš§é“ # è¿œç¨‹ç«¯å£è½¬å‘ï¼ˆè®©è¿œç¨‹è®¿é—®æœ¬åœ°æœåŠ¡ï¼‰ ssh -R 9090:localhost:3000 username@hostname # æœ¬åœ°å¼€å‘æœåŠ¡å™¨ # åŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKS ä»£ç†ï¼‰ ssh -D 1080 username@hostname # å¤šè·³ SSH è¿æ¥ï¼ˆé€šè¿‡è·³æ¿æœºï¼‰ ssh -J jumpuser@jumpserver username@targetserver # ä¿æŒè¿æ¥æ´»è·ƒï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰ # åœ¨ ~/.ssh/config ä¸­æ·»åŠ ï¼š # Host * # ServerAliveInterval 60 # ServerAliveCountMax 3 å››ã€â“ å¸¸è§é—®é¢˜è§£å†³ è¿æ¥è¢«æ‹’ç»æˆ–è¶…æ—¶ ğŸ¤”\næ£€æŸ¥ SSH æœåŠ¡æ˜¯å¦è¿è¡Œï¼šsudo systemctl status ssh ç¡®è®¤é˜²ç«å¢™å…è®¸ SSH ç«¯å£ï¼šsudo ufw status æˆ– sudo firewall-cmd --list-all éªŒè¯ç½‘ç»œè¿é€šæ€§ï¼šping hostname å’Œ telnet hostname 22 æƒé™é”™è¯¯ ğŸ”\næ£€æŸ¥ ~/.ssh ç›®å½•æƒé™ï¼šåº”ä¸º 700 æ£€æŸ¥ ~/.ssh/authorized_keys æ–‡ä»¶æƒé™ï¼šåº”ä¸º 600 ç¡®è®¤ SELinux æˆ– AppArmor æ²¡æœ‰é˜»æ­¢è®¿é—® ä¸»æœºå¯†é’¥éªŒè¯å¤±è´¥ âš ï¸\næ¸…é™¤è¿‡æœŸçš„å¯†é’¥ï¼šssh-keygen -R hostname æˆ–è€…ç¼–è¾‘ ~/.ssh/known_hosts æ‰‹åŠ¨åˆ é™¤å¯¹åº”è¡Œ è®¤è¯å¤±è´¥ ğŸ”‘\nç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å…è®¸å¯†ç è®¤è¯ï¼šPasswordAuthentication yes æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®å¤åˆ¶åˆ° authorized_keys éªŒè¯æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥ç”¨æˆ·ç™»å½•ï¼šAllowUsers è®¾ç½® è¿æ¥é€Ÿåº¦æ…¢ ğŸ¢\nç¦ç”¨ DNS åå‘æŸ¥è¯¢ï¼šåœ¨ sshd_config è®¾ç½® UseDNS no å°è¯•ä½¿ç”¨æ›´å¿«çš„åŠ å¯†ç®—æ³•ï¼šCiphers aes128-gcm@openssh.com å¯ç”¨å‹ç¼©ï¼šCompression yes äº”ã€ğŸ”’ SSH å®‰å…¨å»ºè®® ä½¿ç”¨éæ ‡å‡†ç«¯å£ ğŸšª\nä¿®æ”¹é»˜è®¤ SSH ç«¯å£ï¼ˆ22ï¼‰ä¸ºå…¶ä»–ç«¯å£ åœ¨ /etc/ssh/sshd_config ä¸­è®¾ç½®ï¼šPort 2222 ç¦ç”¨ root ç›´æ¥ç™»å½• ğŸ‘¤\nç¦æ­¢ root ç”¨æˆ·ç›´æ¥ SSH ç™»å½•ï¼š PermitRootLogin no ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•ååˆ‡æ¢ root ä½¿ç”¨å¯†é’¥è®¤è¯ ğŸ”‘\nå®Œå…¨ç¦ç”¨å¯†ç è®¤è¯ï¼šPasswordAuthentication no å¼ºåˆ¶ä½¿ç”¨å…¬é’¥è®¤è¯ï¼šPubkeyAuthentication yes é™åˆ¶ç”¨æˆ·è®¿é—® ğŸ“‹\nåªå…è®¸ç‰¹å®šç”¨æˆ·è®¿é—®ï¼š AllowUsers user1 user2 æˆ–é™åˆ¶ç”¨æˆ·ç»„ï¼šAllowGroups ssh-users ä½¿ç”¨ fail2ban é˜²æ­¢æš´åŠ›ç ´è§£ ğŸ›¡ï¸\n1 2 3 4 5 6 7 8 9 # å®‰è£… fail2ban sudo apt install fail2ban # é…ç½® SSH ä¿æŠ¤ sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local # åœ¨ [sshd] éƒ¨åˆ†è®¾ç½®ï¼š # enabled = true # port = ssh # logpath = /var/log/auth.log å®šæœŸæ›´æ–° SSH ğŸ”„\nä¿æŒ SSH è½¯ä»¶æœ€æ–°ï¼šsudo apt update \u0026amp;\u0026amp; sudo apt upgrade openssh-server å…³æ³¨ SSH å®‰å…¨å…¬å‘Šï¼ŒåŠæ—¶åº”å¯¹æ¼æ´ ä½¿ç”¨åŒå› ç´ è®¤è¯ âœ…\nç»“åˆ Google Authenticator ç­‰å·¥å…·å¢å¼ºå®‰å…¨æ€§ é…ç½® SSH ä¸ PAM é›†æˆå®ç°åŒå› ç´ è®¤è¯ å…­ã€ğŸ“ æ€»ç»“ é€šè¿‡æœ¬æ–‡ä»‹ç»çš„è„šæœ¬å’Œä¸€ç³»åˆ— SSH ç®¡ç†å‘½ä»¤ï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°ä»¥ä¸‹ç›®æ ‡ï¼šğŸ¯\nå¿«é€Ÿéƒ¨ç½²ï¼šä½¿ç”¨ setup-ssh.sh åœ¨å‡ åˆ†é’Ÿå†…å®Œæˆ SSH æœåŠ¡å™¨é…ç½®å’Œä¼˜åŒ– å®‰å…¨è¿æ¥ï¼šæŒæ¡å¯†é’¥è®¤è¯ã€ç«¯å£è½¬å‘ç­‰é«˜çº§ SSH åŠŸèƒ½ çµæ´»ç®¡ç†ï¼šä½¿ç”¨å„ç§ SSH å‘½ä»¤åº”å¯¹ä¸åŒç®¡ç†åœºæ™¯å’Œéœ€æ±‚ æ•…éšœæ’é™¤ï¼šä½¿ç”¨ä¸“ä¸šå·¥å…·è¯Šæ–­å’Œè§£å†³è¿æ¥ã€è®¤è¯ç­‰é—®é¢˜ å®‰å…¨ä¿éšœï¼šå®æ–½æœ€ä½³å®è·µï¼Œç¡®ä¿è¿œç¨‹è®¿é—®æœåŠ¡çš„å®‰å…¨æ€§ æ— è®ºæ˜¯å•å°æœåŠ¡å™¨çš„æ—¥å¸¸ç®¡ç†ï¼Œè¿˜æ˜¯å¤§è§„æ¨¡é›†ç¾¤çš„è¿œç¨‹ç»´æŠ¤ï¼ŒSSH éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒå·¥å…·ã€‚è¿™ä¸ªè„šæœ¬å’Œç›¸å…³å‘½ä»¤å°†å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ä½¿ç”¨è¿™ä¸€å·¥å…·ï¼Œæå‡å·¥ä½œæ•ˆç‡å’Œç³»ç»Ÿå®‰å…¨æ€§ã€‚ğŸ’¼\nå»ºè®®æ”¶è—æœ¬æ–‡ä½œä¸º SSH ç®¡ç†çš„å‚è€ƒæ‰‹å†Œï¼Œéšæ—¶æŸ¥é˜…ç›¸å…³å‘½ä»¤å’ŒæŠ€å·§ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºï¼ğŸ’¬\n","date":"2025-09-11T15:38:41+08:00","image":"https://file.meimolihan.eu.org/img/ssh-01.webp","permalink":"https://blog.meimolihan.eu.org/p/fdf7dadf/","title":"Linux SSH æœåŠ¡ä¸€é”®é…ç½®è„šæœ¬ä½¿ç”¨æŒ‡å— ğŸš€"},{"content":"Docker éƒ¨ç½²é›·æ±  WAF ğŸ›¡ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ Docker éƒ¨ç½²é›·æ±  WAF 1. Linux è‡ªåŠ¨å®‰è£… 2. Docker æ‰‹åŠ¨éƒ¨ç½² åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ä½¿ç”¨é›·æ±  WAF 1. è®¿é—® Web ç•Œé¢ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸŒ Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”§ å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ 2. Docker å®¹å™¨å‘½ä»¤ 3. Docker é•œåƒç®¡ç† ğŸŒŸ å¼€å¯å®‰å…¨é˜²æŠ¤æ–°ç¯‡ç«  ğŸ¯ é¡¹ç›®ç®€ä»‹ é›·æ±  WAFï¼ˆWeb Application Firewallï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„é«˜æ€§èƒ½ Web åº”ç”¨é˜²ç«å¢™ï¼Œä¸“é—¨ä¸ºç°ä»£ Web åº”ç”¨æä¾›å…¨æ–¹ä½å®‰å…¨é˜²æŠ¤ã€‚å®ƒèƒ½å¤Ÿæœ‰æ•ˆé˜²å¾¡ SQL æ³¨å…¥ã€XSS æ”»å‡»ã€æ¶æ„çˆ¬è™«ã€CC æ”»å‡»ç­‰å¸¸è§ Web æ”»å‡»ï¼ŒåŒæ—¶å…·å¤‡ä½å»¶è¿Ÿã€é«˜å¹¶å‘å’Œæ˜“æ‰©å±•çš„ç‰¹ç‚¹ã€‚\nğŸŒ é›·æ±  WAF å®˜ç½‘åœ°å€ï¼š https://waf-ce.chaitin.cn/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/chaitin/SafeLine ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ âœ¨ å…¨é¢é˜²æŠ¤ - æ”¯æŒå¤šç§ Web æ”»å‡»æ£€æµ‹å’Œé˜²å¾¡ï¼ŒåŒ…æ‹¬ OWASP Top 10 å¸¸è§æ¼æ´ ğŸš€ é«˜æ€§èƒ½ - åŸºäºæ™ºèƒ½å¼•æ“ï¼Œä½å»¶è¿Ÿã€é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä¸å½±å“ä¸šåŠ¡æ­£å¸¸è®¿é—® ğŸ”§ æ˜“äºéƒ¨ç½² - æä¾› Docker ä¸€é”®éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§ç¯å¢ƒå¿«é€Ÿå®‰è£… ğŸ“Š å¯è§†åŒ–ç®¡ç† - æä¾›å‹å¥½çš„ç®¡ç†ç•Œé¢ï¼Œå®æ—¶å±•ç¤ºå®‰å…¨æ€åŠ¿å’Œæ”»å‡»æ—¥å¿— ğŸ›¡ï¸ æ™ºèƒ½å­¦ä¹  - æ”¯æŒæ­£å¸¸æµé‡å­¦ä¹ ï¼Œé™ä½è¯¯æŠ¥ç‡ï¼Œæé«˜é˜²æŠ¤ç²¾åº¦ ğŸŒ çµæ´»æ‰©å±• - æ”¯æŒè‡ªå®šä¹‰è§„åˆ™ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»è°ƒæ•´é˜²æŠ¤ç­–ç•¥\nDocker éƒ¨ç½²é›·æ±  WAF ğŸ›¡ï¸ é›·æ±  WAF æä¾›ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼šLinux è‡ªåŠ¨å®‰è£…å’Œ Docker æ‰‹åŠ¨éƒ¨ç½²ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹å¼ã€‚\n1. Linux è‡ªåŠ¨å®‰è£…å‘½ä»¤ ğŸ“¦ ä¸€é”®å®‰è£…ï¼š3 åˆ†é’Ÿå³å¯å®Œæˆè‡ªåŠ¨å®‰è£…ï¼Œé€‚åˆå¿«é€Ÿéƒ¨ç½²åœºæ™¯ã€‚\n1 bash -c \u0026#34;$(curl -fsSLk https://waf-ce.chaitin.cn/release/latest/manager.sh)\u0026#34; 2. Docker æ‰‹åŠ¨éƒ¨ç½² åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 # åˆ›å»ºéƒ¨ç½²ç›®å½• mkdir -p /vol1/1000/compose/safeline \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; networks: safeline-ce: name: safeline-ce driver: bridge ipam: driver: default config: - gateway: ${SUBNET_PREFIX:?SUBNET_PREFIX required}.1 subnet: ${SUBNET_PREFIX}.0/24 driver_opts: com.docker.network.bridge.name: safeline-ce services: postgres: container_name: safeline-pg restart: always image: ${IMAGE_PREFIX}/safeline-postgres${ARCH_SUFFIX}:15.2 volumes: - ${SAFELINE_DIR}/resources/postgres/data:/var/lib/postgresql/data - /etc/localtime:/etc/localtime:ro environment: - POSTGRES_USER=safeline-ce - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:?postgres password required} networks: safeline-ce: ipv4_address: ${SUBNET_PREFIX}.2 command: [postgres, -c, max_connections=600] healthcheck: test: pg_isready -U safeline-ce -d safeline-ce mgt: container_name: safeline-mgt restart: always image: ${IMAGE_PREFIX}/safeline-mgt${REGION}${ARCH_SUFFIX}:${IMAGE_TAG:?image tag required} volumes: - /etc/localtime:/etc/localtime:ro - ${SAFELINE_DIR}/resources/mgt:/app/data - ${SAFELINE_DIR}/logs/nginx:/app/log/nginx:z - ${SAFELINE_DIR}/resources/sock:/app/sock - /var/run:/app/run ports: - ${MGT_PORT:-9443}:1443 healthcheck: test: curl -k -f https://localhost:1443/api/open/health environment: - MGT_PG=postgres://safeline-ce:${POSTGRES_PASSWORD}@safeline-pg/safeline-ce?sslmode=disable - MGT_PROXY=${MGT_PROXY} depends_on: - postgres - fvm logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;100m\u0026#34; max-file: \u0026#34;5\u0026#34; networks: safeline-ce: ipv4_address: ${SUBNET_PREFIX}.4 detect: container_name: safeline-detector restart: always image: ${IMAGE_PREFIX}/safeline-detector${REGION}${ARCH_SUFFIX}:${IMAGE_TAG} volumes: - ${SAFELINE_DIR}/resources/detector:/resources/detector - ${SAFELINE_DIR}/logs/detector:/logs/detector - /etc/localtime:/etc/localtime:ro environment: - LOG_DIR=/logs/detector networks: safeline-ce: ipv4_address: ${SUBNET_PREFIX}.5 tengine: container_name: safeline-tengine restart: always image: ${IMAGE_PREFIX}/safeline-tengine${REGION}${ARCH_SUFFIX}:${IMAGE_TAG} volumes: - /etc/localtime:/etc/localtime:ro - /etc/resolv.conf:/etc/resolv.conf:ro - ${SAFELINE_DIR}/resources/nginx:/etc/nginx - ${SAFELINE_DIR}/resources/detector:/resources/detector - ${SAFELINE_DIR}/resources/chaos:/resources/chaos - ${SAFELINE_DIR}/logs/nginx:/var/log/nginx:z - ${SAFELINE_DIR}/resources/cache:/usr/local/nginx/cache - ${SAFELINE_DIR}/resources/sock:/app/sock environment: - TCD_MGT_API=https://${SUBNET_PREFIX}.4:1443/api/open/publish/server - TCD_SNSERVER=${SUBNET_PREFIX}.5:8000 # deprecated - SNSERVER_ADDR=${SUBNET_PREFIX}.5:8000 - CHAOS_ADDR=${SUBNET_PREFIX}.10 ulimits: nofile: 131072 network_mode: host luigi: container_name: safeline-luigi restart: always image: ${IMAGE_PREFIX}/safeline-luigi${REGION}${ARCH_SUFFIX}:${IMAGE_TAG} environment: - MGT_IP=${SUBNET_PREFIX}.4 - LUIGI_PG=postgres://safeline-ce:${POSTGRES_PASSWORD}@safeline-pg/safeline-ce?sslmode=disable volumes: - /etc/localtime:/etc/localtime:ro - ${SAFELINE_DIR}/resources/luigi:/app/data logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;100m\u0026#34; max-file: \u0026#34;5\u0026#34; depends_on: - detect - mgt networks: safeline-ce: ipv4_address: ${SUBNET_PREFIX}.7 fvm: container_name: safeline-fvm restart: always image: ${IMAGE_PREFIX}/safeline-fvm${REGION}${ARCH_SUFFIX}:${IMAGE_TAG} volumes: - /etc/localtime:/etc/localtime:ro logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;100m\u0026#34; max-file: \u0026#34;5\u0026#34; networks: safeline-ce: ipv4_address: ${SUBNET_PREFIX}.8 chaos: container_name: safeline-chaos restart: always image: ${IMAGE_PREFIX}/safeline-chaos${REGION}${ARCH_SUFFIX}:${IMAGE_TAG} logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;100m\u0026#34; max-file: \u0026#34;10\u0026#34; environment: - DB_ADDR=postgres://safeline-ce:${POSTGRES_PASSWORD}@safeline-pg/safeline-ce?sslmode=disable volumes: - ${SAFELINE_DIR}/resources/sock:/app/sock - ${SAFELINE_DIR}/resources/chaos:/app/chaos networks: safeline-ce: ipv4_address: ${SUBNET_PREFIX}.10 EOF åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»º .env é…ç½®æ–‡ä»¶ cat \u0026gt; .env \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; SAFELINE_DIR=/vol1/1000/compose/safeline IMAGE_TAG=latest MGT_PORT=9443 POSTGRES_PASSWORD=yourpassword #-------ï¼ˆè‡ªå®šä¹‰å¯†ç ä½¿ç”¨æ•°å­—+è‹±æ–‡å¤§å°å†™ç»„åˆï¼Œå‹¿ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼‰ SUBNET_PREFIX=172.23.0 IMAGE_PREFIX=swr.cn-east-3.myhuaweicloud.com/chaitin-safeline ARCH_SUFFIX= RELEASE= REGION= MGT_PROXY=0 EOF æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 2 # ä½¿ç”¨ Docker Compose å¯åŠ¨æ‰€æœ‰æœåŠ¡ docker-compose up -d å¯åŠ¨å®Œæˆåï¼Œç³»ç»Ÿå°†è‡ªåŠ¨åˆ›å»ºä»¥ä¸‹å®¹å™¨ï¼š\nğŸ—„ï¸ safeline-pg - PostgreSQL æ•°æ®åº“ ğŸ–¥ï¸ safeline-mgt - ç®¡ç†ç•Œé¢æœåŠ¡ ğŸ” safeline-detector - æ”»å‡»æ£€æµ‹å¼•æ“ ğŸŒ safeline-tengine - Tengine Web æœåŠ¡å™¨ ğŸ“Š safeline-luigi - æ—¥å¿—å¤„ç†æœåŠ¡ âš™ï¸ safeline-fvm - è§„åˆ™ç®¡ç†æœåŠ¡ ğŸ›¡ï¸ safeline-chaos - æ ¸å¿ƒé˜²æŠ¤å¼•æ“ ğŸš€ ä½¿ç”¨é›·æ±  WAF 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:9443 åŸŸåè®¿é—®ï¼š https://safeline.example.com:666 ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ æŸ¥çœ‹å¯†ç ï¼šdocker exec safeline-mgt resetadmin 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ åˆå§‹åŒ–è®¾ç½® ğŸ”§\næ‰“å¼€æµè§ˆå™¨è®¿é—®ç®¡ç†ç•Œé¢ è®¾ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç  é…ç½®é‚®ç®±é€šçŸ¥ç­‰åŸºæœ¬è®¾ç½® æ·»åŠ é˜²æŠ¤ç«™ç‚¹ ğŸŒ\nè¿›å…¥\u0026quot;ç«™ç‚¹ç®¡ç†\u0026quot;é¡µé¢ ç‚¹å‡»\u0026quot;æ·»åŠ ç«™ç‚¹\u0026quot;æŒ‰é’® å¡«å†™éœ€è¦é˜²æŠ¤çš„åŸŸåå’Œä¸Šæ¸¸æœåŠ¡å™¨åœ°å€ é…ç½®é˜²æŠ¤è§„åˆ™ ğŸ›¡ï¸\næ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„é˜²æŠ¤è§„åˆ™ å¯å¯ç”¨æ™ºèƒ½å­¦ä¹ æ¨¡å¼ï¼Œé™ä½è¯¯æŠ¥ç‡ è®¾ç½®è‡ªå®šä¹‰è§„åˆ™åº”å¯¹ç‰¹å®šæ”»å‡» ç›‘æ§å®‰å…¨æ€åŠ¿ ğŸ“Š\næŸ¥çœ‹å®æ—¶æ”»å‡»æ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯ åˆ†ææ”»å‡»æ¥æºå’Œç±»å‹åˆ†å¸ƒ è°ƒæ•´é˜²æŠ¤ç­–ç•¥ä¼˜åŒ–æ•ˆæœ æ€§èƒ½è°ƒä¼˜ âš¡\næ ¹æ®æµé‡ç‰¹ç‚¹è°ƒæ•´æ£€æµ‹çµæ•åº¦ é…ç½®ç¼“å­˜ç­–ç•¥æå‡æ€§èƒ½ è®¾ç½®é»‘ç™½åå•ç®¡ç†è®¿é—®æ§åˆ¶ ğŸŒ Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://safeline.example.com:666 é€šè¿‡ Nginx åå‘ä»£ç†å¯ä»¥æä¾›æ›´çµæ´»çš„è®¿é—®æ–¹å¼å’Œ SSL ç»ˆç«¯å¸è½½åŠŸèƒ½ã€‚\n1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/safeline.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name safeline.example.com; # ğŸŒ æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:9443; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 2 3 4 5 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡è½½ Nginx é…ç½® sudo systemctl reload nginx ğŸ”§ å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/safeline # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿— docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¼€å¯å®‰å…¨é˜²æŠ¤æ–°ç¯‡ç«  é€šè¿‡æœ¬æ–‡æ¡£ï¼Œæ‚¨å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†é›·æ±  WAF Web åº”ç”¨é˜²ç«å¢™ï¼Œä¸ºæ‚¨çš„ Web åº”ç”¨å»ºç«‹äº†åšå®çš„å®‰å…¨é˜²çº¿ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ï¼š\nğŸ›¡ï¸ å…¨é¢é˜²æŠ¤ - æœ‰æ•ˆé˜²å¾¡ SQL æ³¨å…¥ã€XSS æ”»å‡»ç­‰å¸¸è§ Web å¨èƒ\nğŸ“Š å®æ—¶ç›‘æ§ - å¯è§†åŒ–ç•Œé¢å®æ—¶å±•ç¤ºå®‰å…¨æ€åŠ¿å’Œæ”»å‡»æ—¥å¿—\nâš¡ é«˜æ€§èƒ½ä¿éšœ - ä½å»¶è¿Ÿé«˜å¹¶å‘å¤„ç†ï¼Œä¸å½±å“ä¸šåŠ¡æ­£å¸¸è®¿é—®\nğŸ”§ çµæ´»é…ç½® - æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰é˜²æŠ¤è§„åˆ™å’Œç­–ç•¥\nğŸŒ æ˜“æ‰©å±• - æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œè½»æ¾åº”å¯¹ä¸šåŠ¡å¢é•¿\né›·æ±  WAF å°†æˆä¸ºæ‚¨ Web åº”ç”¨çš„å¯é å®ˆæŠ¤è€…ï¼Œ7Ã—24 å°æ—¶ä¸é—´æ–­æä¾›å®‰å…¨é˜²æŠ¤ï¼Œè®©æ‚¨ä¸“æ³¨äºä¸šåŠ¡å‘å±•ï¼Œæ— éœ€æ‹…å¿ƒå®‰å…¨å¨èƒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ„å»ºå®‰å…¨å¯é çš„ Web åº”ç”¨ç¯å¢ƒï¼Œä¸ºæ‚¨çš„ç”¨æˆ·æä¾›æ›´å®‰å¿ƒçš„æœåŠ¡ä½“éªŒï¼âœ¨\nğŸ“Œ æŒç»­æ›´æ–°ï¼šå»ºè®®å…³æ³¨ é›·æ±  WAF å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸å®‰å…¨å¢å¼º\nğŸ› ç¤¾åŒºæ”¯æŒï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues å‚ä¸è®¨è®º\nç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼Œå®‰å…¨æ— å¿§ï¼ğŸ‰\n","date":"2025-09-11T14:37:37+08:00","image":"https://file.meimolihan.eu.org/img/docker-safeline-01.webp","permalink":"https://blog.meimolihan.eu.org/p/647c1abd/","title":"Docker éƒ¨ç½²é›·æ±  WAF ğŸ›¡ï¸"},{"content":"Windows æˆªå›¾å·¥å…· PixPin ğŸ–¼ï¸ å¯¼èˆªç›®å½• ğŸ“Œ å·¥å…·ç®€ä»‹ âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ”§ å®‰è£…ä¸è®¾ç½® ğŸ¯ åŸºç¡€ä½¿ç”¨æ•™ç¨‹ ğŸ’¡ é«˜çº§æŠ€å·§ä¸åº”ç”¨ ğŸ“Š ä¸å…¶ä»–å·¥å…·å¯¹æ¯” ğŸš€ æ€»ç»“ä¸æ¨è ğŸ“Œ å·¥å…·ç®€ä»‹ PixPin æ˜¯ä¸€æ¬¾å…¨æ–°çš„ Windows æˆªå›¾ä¸è´´å›¾å·¥å…·ï¼Œè¢«èª‰ä¸º\u0026quot;æ–°æ—¶ä»£çš„æˆªå›¾å·¥å…·\u0026quot;ã€‚å®ƒä¸ä»…æä¾›äº†å¼ºå¤§çš„æˆªå›¾åŠŸèƒ½ï¼Œè¿˜åˆ›æ–°æ€§åœ°åŠ å…¥äº†è´´å›¾ã€OCRæ–‡å­—è¯†åˆ«å’Œé•¿æˆªå›¾ç­‰å®ç”¨ç‰¹æ€§ï¼Œå®Œå…¨å…è´¹ä¸”æ— ä»»ä½•å¹¿å‘Šå¹²æ‰°ã€‚ğŸ‰\nè¿™æ¬¾å·¥å…·ç”±å›½å†…å¼€å‘è€…ç‹¬ç«‹åˆ¶ä½œï¼Œä¸“æ³¨äºæå‡Windowsç”¨æˆ·çš„å±å¹•æ•è·ä½“éªŒã€‚æ— è®ºæ˜¯æ—¥å¸¸åŠå…¬ã€å­¦ä¹ ç¬”è®°è¿˜æ˜¯æŠ€æœ¯æ–‡æ¡£ç¼–å†™ï¼ŒPixPinéƒ½èƒ½æä¾›é«˜æ•ˆä¾¿æ·çš„è§£å†³æ–¹æ¡ˆã€‚ç›¸è¾ƒäºWindowsè‡ªå¸¦çš„æˆªå›¾å·¥å…·å’ŒSnipping Toolï¼ŒPixPinåœ¨åŠŸèƒ½æ€§å’Œæ˜“ç”¨æ€§æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚\nPixPin å®˜ç½‘åœ°å€ï¼š https://pixpin.cn/ âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ–¼ï¸ å¤šåŠŸèƒ½æˆªå›¾ åŒºåŸŸæˆªå›¾ï¼šè‡ªå®šä¹‰é€‰æ‹©æˆªå›¾åŒºåŸŸï¼Œæ”¯æŒçŸ©å½¢ã€åœ†å½¢å’Œè‡ªç”±å½¢çŠ¶é€‰æ‹© çª—å£æˆªå›¾ï¼šä¸€é”®æ•è·ç‰¹å®šåº”ç”¨ç¨‹åºçª—å£ï¼Œè‡ªåŠ¨è¯†åˆ«çª—å£è¾¹ç•Œ å…¨å±æˆªå›¾ï¼šå¿«é€Ÿæ•è·æ•´ä¸ªå±å¹•å†…å®¹ï¼Œæ”¯æŒå¤šæ˜¾ç¤ºå™¨ç¯å¢ƒ é•¿æˆªå›¾ï¼šè‡ªåŠ¨æ»šåŠ¨é¡µé¢å¹¶æ‹¼æ¥æˆé•¿å›¾ï¼Œéå¸¸é€‚åˆç½‘é¡µæˆªå›¾ ğŸ“Œ å®æ—¶è´´å›¾ è´´å›¾åŠŸèƒ½ï¼šå°†æˆªå›¾å›ºå®šåœ¨å±å¹•æœ€å‰ç«¯ï¼Œæ–¹ä¾¿å‚è€ƒæˆ–å¯¹æ¯”å†…å®¹ å¤šè´´å›¾ç®¡ç†ï¼šåŒæ—¶å›ºå®šå¤šä¸ªæˆªå›¾ï¼Œå¹¶å¯é€šè¿‡ç¼©ç•¥å›¾å¿«é€Ÿåˆ‡æ¢ é€æ˜åº¦è°ƒèŠ‚ï¼šæ ¹æ®éœ€è¦è°ƒæ•´è´´å›¾é€æ˜åº¦ï¼Œå‡å°‘å¯¹å·¥ä½œçš„å¹²æ‰° ğŸ” OCRæ–‡å­—è¯†åˆ« é«˜ç²¾åº¦è¯†åˆ«ï¼šå†…ç½®OCRå¼•æ“ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«æˆªå›¾ä¸­çš„æ–‡å­—å†…å®¹ å¤šè¯­è¨€æ”¯æŒï¼šæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šç§è¯­è¨€çš„æ–‡å­—è¯†åˆ« ä¸€é”®å¤åˆ¶ï¼šè¯†åˆ«ç»“æœå¯ç›´æ¥å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œæé«˜å·¥ä½œæ•ˆç‡ ğŸ¨ å›¾åƒç¼–è¾‘ä¸æ ‡æ³¨ ä¸°å¯Œæ ‡æ³¨å·¥å…·ï¼šæä¾›ç®­å¤´ã€æ–¹æ¡†ã€åœ†åœˆã€é©¬èµ›å…‹ã€æ–‡å­—ç­‰å¤šç§æ ‡æ³¨å·¥å…· è‡ªå®šä¹‰æ ·å¼ï¼šå¯è°ƒæ•´é¢œè‰²ã€ç²—ç»†ã€å­—ä½“ç­‰æ ·å¼å‚æ•° åºå·æ ‡æ³¨ï¼šæ”¯æŒæ·»åŠ æ•°å­—åºå·ï¼Œç‰¹åˆ«é€‚åˆåˆ¶ä½œæ•™ç¨‹æˆ–è¯´æ˜æ–‡æ¡£ âš¡ å…¶ä»–å®ç”¨åŠŸèƒ½ å¿«æ·é”®è‡ªå®šä¹‰ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½å¯è®¾ç½®ä¸ªæ€§åŒ–å¿«æ·é”®ï¼Œæ“ä½œæ›´ä¾¿æ· å†å²è®°å½•ï¼šè‡ªåŠ¨ä¿å­˜æˆªå›¾å†å²ï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾å’Œä½¿ç”¨ å¤šæ ¼å¼ä¿å­˜ï¼šæ”¯æŒPNGã€JPGã€BMPç­‰å¤šç§å›¾ç‰‡æ ¼å¼ å³æ—¶åˆ†äº«ï¼šä¸€é”®åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“æˆ–é€šä¿¡å·¥å…· ğŸ”§ å®‰è£…ä¸è®¾ç½® ä¸‹è½½ä¸å®‰è£… è®¿é—®PixPinå®˜ç½‘ https://pixpin.cn/ ç‚¹å‡»\u0026quot;ä¸‹è½½\u0026quot;æŒ‰é’®è·å–æœ€æ–°ç‰ˆæœ¬çš„å®‰è£…åŒ… è¿è¡Œå®‰è£…ç¨‹åºï¼ŒæŒ‰ç…§æŒ‡å¼•å®Œæˆå®‰è£… å¯åŠ¨PixPinï¼Œå®ƒä¼šè‡ªåŠ¨æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜ 1 2 3 wget -c https://download.pixpin.cn/PixPin_2.0.0.3.exe curl -O https://download.pixpin.cn/PixPin_2.0.0.3.exe åŸºæœ¬è®¾ç½® å¼€æœºè‡ªå¯ï¼šåœ¨è®¾ç½®ä¸­å¯ç”¨\u0026quot;å¼€æœºè‡ªåŠ¨å¯åŠ¨\u0026quot;ï¼Œç¡®ä¿éšæ—¶å¯ç”¨ å¿«æ·é”®é…ç½®ï¼šæ ¹æ®ä¸ªäººä¹ æƒ¯è®¾ç½®æˆªå›¾ã€è´´å›¾ç­‰åŠŸèƒ½çš„å¿«æ·é”® ä¿å­˜è·¯å¾„ï¼šè‡ªå®šä¹‰æˆªå›¾æ–‡ä»¶çš„é»˜è®¤ä¿å­˜ä½ç½® å›¾ç‰‡æ ¼å¼ï¼šé€‰æ‹©é»˜è®¤çš„æˆªå›¾ä¿å­˜æ ¼å¼ï¼ˆæ¨èPNGä»¥ä¿æŒé«˜è´¨é‡ï¼‰ æ€§èƒ½ä¼˜åŒ– ä½é…ç”µè„‘å¯å…³é—­ä¸€äº›åŠ¨ç”»æ•ˆæœæå‡å“åº”é€Ÿåº¦ æ ¹æ®éœ€æ±‚è°ƒæ•´å†å²è®°å½•ä¿å­˜æ•°é‡ï¼Œå¹³è¡¡ä¾¿åˆ©æ€§ä¸å­˜å‚¨ç©ºé—´ ğŸ¯ åŸºç¡€ä½¿ç”¨æ•™ç¨‹ åŸºæœ¬æˆªå›¾æ“ä½œ æŒ‰ä¸‹é»˜è®¤å¿«æ·é”® Ctrl+Shift+Xï¼ˆå¯è‡ªå®šä¹‰ï¼‰å¯åŠ¨æˆªå›¾æ¨¡å¼ ä½¿ç”¨é¼ æ ‡é€‰æ‹©éœ€è¦æˆªå–çš„åŒºåŸŸ é‡Šæ”¾é¼ æ ‡å®Œæˆæˆªå›¾ï¼Œè‡ªåŠ¨è¿›å…¥ç¼–è¾‘ç•Œé¢ ä½¿ç”¨å·¥å…·æ ä¸Šçš„å·¥å…·è¿›è¡Œæ ‡æ³¨æˆ–ç¼–è¾‘ ç‚¹å‡»ä¿å­˜ã€å¤åˆ¶æˆ–è´´å›¾æŒ‰é’®å®Œæˆæ“ä½œ è´´å›¾åŠŸèƒ½ä½¿ç”¨ å®Œæˆæˆªå›¾åï¼Œç‚¹å‡»\u0026quot;é’‰ä½\u0026quot;æŒ‰é’®ï¼ˆæˆ–ä½¿ç”¨å¿«æ·é”®ï¼‰ æˆªå›¾å°†å˜ä¸ºå§‹ç»ˆåœ¨å‰ç«¯æ˜¾ç¤ºçš„è´´å›¾ æ‹–åŠ¨è´´å›¾å¯ä»¥ç§»åŠ¨ä½ç½®ï¼Œå³ä¸‹è§’æ‰‹æŸ„å¯è°ƒæ•´å¤§å° å³é”®ç‚¹å‡»è´´å›¾å¯è®¿é—®æ›´å¤šé€‰é¡¹ï¼Œå¦‚é€æ˜åº¦è°ƒæ•´å’Œå…³é—­ OCRæ–‡å­—è¯†åˆ« æˆªå›¾åç‚¹å‡»OCRæŒ‰é’®ï¼ˆæˆ–ä½¿ç”¨å¿«æ·é”®ï¼‰ é€‰æ‹©éœ€è¦è¯†åˆ«çš„åŒºåŸŸ ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«æ–‡å­—å¹¶æ˜¾ç¤ºç»“æœ ç‚¹å‡»\u0026quot;å¤åˆ¶\u0026quot;æŒ‰é’®å°†æ–‡å­—å†…å®¹å¤åˆ¶åˆ°å‰ªè´´æ¿ ğŸ’¡ é«˜çº§æŠ€å·§ä¸åº”ç”¨ å·¥ä½œæ•ˆç‡æå‡æŠ€å·§ è‡ªå®šä¹‰å·¥ä½œæµï¼šä¸ºå¸¸ç”¨æ“ä½œè®¾ç½®ä¸ªæ€§åŒ–å¿«æ·é”®ï¼Œå‡å°‘é¼ æ ‡æ“ä½œ ç»„åˆä½¿ç”¨è´´å›¾ï¼šå°†å¤šä¸ªå‚è€ƒèµ„æ–™è´´å›¾æ’åˆ—ï¼Œæ–¹ä¾¿æ•°æ®å¯¹æ¯”æˆ–å†…å®¹å‚è€ƒ å¿«é€Ÿåˆ†äº«ï¼šæˆªå›¾åç›´æ¥åˆ†äº«åˆ°å¾®ä¿¡ã€QQç­‰åº”ç”¨ï¼Œæ— éœ€ä¿å­˜å†å‘é€ åˆ›æ„ä½¿ç”¨æ–¹æ³• ä¸´æ—¶ä¾¿ç­¾ï¼šä½¿ç”¨è´´å›¾åŠŸèƒ½åˆ›å»ºä¸´æ—¶æé†’æˆ–å¾…åŠäº‹é¡¹ æ•™å­¦è¾…åŠ©ï¼šåˆ¶ä½œå¸¦æ ‡æ³¨çš„æ•™ç¨‹å›¾ï¼Œä½¿ç”¨åºå·åŠŸèƒ½é€æ­¥è¯´æ˜ è®¾è®¡å‚è€ƒï¼šå°†è®¾è®¡ç´ æè´´å›¾ä½œä¸ºå‚è€ƒï¼Œæ–¹ä¾¿è¿›è¡Œè®¾è®¡å·¥ä½œ å¸¸è§é—®é¢˜è§£å†³ å¿«æ·é”®å†²çªï¼šå¦‚ä¸å…¶ä»–è½¯ä»¶å¿«æ·é”®å†²çªï¼Œå¯åœ¨è®¾ç½®ä¸­ä¿®æ”¹ è¯†åˆ«ç²¾åº¦é—®é¢˜ï¼šå¯¹äºå¤æ‚èƒŒæ™¯ä¸‹çš„æ–‡å­—ï¼Œå¯å…ˆè°ƒæ•´æˆªå›¾åŒºåŸŸå†è¯†åˆ« æ€§èƒ½ä¼˜åŒ–ï¼šå¦‚æœè¿è¡Œå¡é¡¿ï¼Œå¯å°è¯•å‡å°‘å†å²è®°å½•ä¿å­˜æ•°é‡ ğŸ“Š ä¸å…¶ä»–å·¥å…·å¯¹æ¯” ä¸Windowsè‡ªå¸¦å·¥å…·å¯¹æ¯” åŠŸèƒ½ PixPin Windowsæˆªå›¾å·¥å…· é•¿æˆªå›¾ âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ OCRè¯†åˆ« âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ è´´å›¾åŠŸèƒ½ âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ ç¼–è¾‘åŠŸèƒ½ ğŸ”§ ä¸°å¯Œ âš¡ åŸºç¡€ å†å²è®°å½• âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ ä¸Snipasteå¯¹æ¯” PixPinä¸SnipasteåŠŸèƒ½ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€äº›åŒºåˆ«ï¼š\nPixPinçš„OCRè¯†åˆ«åŠŸèƒ½æ›´ä¸ºå¼ºå¤§å‡†ç¡® PixPinç•Œé¢æ›´åŠ ç°ä»£åŒ–ï¼Œæ“ä½œé€»è¾‘æ›´ç¬¦åˆå›½å†…ç”¨æˆ·ä¹ æƒ¯ ä¸¤è€…éƒ½æ”¯æŒè´´å›¾åŠŸèƒ½ï¼Œä½†PixPinçš„è´´å›¾ç®¡ç†æ›´ä¸ºç›´è§‚ ä¸ä¸“ä¸šè½¯ä»¶å¯¹æ¯” ç›¸è¾ƒäºPhotoshopç­‰ä¸“ä¸šå›¾åƒå¤„ç†è½¯ä»¶ï¼ŒPixPinæ›´åŠ è½»é‡å¿«æ·ï¼Œé€‚åˆæ—¥å¸¸æˆªå›¾å’Œå¿«é€Ÿæ ‡æ³¨éœ€æ±‚ï¼Œè™½ç„¶ä¸æ˜¯å…¨åŠŸèƒ½å›¾åƒç¼–è¾‘å™¨ï¼Œä½†æ»¡è¶³äº†90%çš„æ—¥å¸¸æˆªå›¾éœ€æ±‚ã€‚\nğŸš€ æ€»ç»“ä¸æ¨è é€‚ç”¨äººç¾¤ ğŸ“Š åŠå…¬äººå‘˜ï¼šåˆ¶ä½œæ–‡æ¡£ã€æ¼”ç¤ºææ–™ ğŸ“ å­¦ç”Ÿç¾¤ä½“ï¼šæ”¶é›†èµ„æ–™ã€æ•´ç†ç¬”è®° ğŸ‘¨â€ğŸ’» å¼€å‘è€…ï¼šå½•åˆ¶æ•™ç¨‹ã€æŠ¥å‘Šbug ğŸ¨ è®¾è®¡å¸ˆï¼šæ”¶é›†çµæ„Ÿã€å‚è€ƒç´ æ æ€»ä½“è¯„ä»· PixPinæ˜¯ä¸€æ¬¾åŠŸèƒ½å…¨é¢ã€è®¾è®¡ç²¾è‰¯çš„æˆªå›¾å·¥å…·ï¼Œå®Œç¾å¡«è¡¥äº†Windowsç³»ç»Ÿè‡ªå¸¦æˆªå›¾å·¥å…·çš„ä¸è¶³ã€‚å…¶ç‹¬ç‰¹çš„è´´å›¾åŠŸèƒ½å’Œå¼ºå¤§çš„OCRè¯†åˆ«èƒ½åŠ›å¤§å¤§æå‡äº†å·¥ä½œæ•ˆç‡ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒå®Œå…¨å…è´¹ä¸”æ— å¹¿å‘Šï¼Œä½“ç°äº†å¼€å‘è€…å¯¹ç”¨æˆ·ä½“éªŒçš„é‡è§†ã€‚\næ¨èæŒ‡æ•°ï¼šâ˜…â˜…â˜…â˜…â˜… å¼ºçƒˆæ¨èæ‰€æœ‰Windowsç”¨æˆ·å°è¯•ä½¿ç”¨PixPinï¼Œå®ƒå¾ˆæœ‰å¯èƒ½æˆä¸ºä½ æ—¥å¸¸ç”Ÿæ´»ä¸­ä¸å¯æˆ–ç¼ºçš„æ•ˆç‡å·¥å…·ã€‚æ— è®ºæ˜¯åŸºç¡€æˆªå›¾éœ€æ±‚è¿˜æ˜¯é«˜çº§åº”ç”¨åœºæ™¯ï¼ŒPixPinéƒ½èƒ½æä¾›å‡ºè‰²çš„è§£å†³æ–¹æ¡ˆã€‚\nç«‹å³è®¿é—®å®˜ç½‘ä¸‹è½½ï¼š https://pixpin.cn/ ğŸš€\n","date":"2025-09-11T09:39:44+08:00","image":"https://file.meimolihan.eu.org/img/pixpin-01.webp","permalink":"https://blog.meimolihan.eu.org/p/219f0507/","title":"Windows æˆªå›¾å·¥å…· PixPin ğŸ–¼ï¸"},{"content":"Linux é…ç½® Samba æœåŠ¡ä¸€é”®è¿œç¨‹è„šæœ¬ğŸ§ æœ¬æ–‡è¯¦ç»†ä»‹ç»ä¸¤ä¸ªé«˜æ•ˆç®¡ç† Samba å…±äº«çš„ Bash è„šæœ¬ï¼šsamba_setup.shï¼ˆæœåŠ¡å™¨ç«¯é…ç½®è„šæœ¬ï¼‰å’Œ samba_mount.shï¼ˆå®¢æˆ·ç«¯æŒ‚è½½è„šæœ¬ï¼‰ï¼Œ âœ… æ”¯æŒçš„ç³»ç»Ÿ: Ubuntu, Debian, CentOS, RHEL, Fedora\nğŸ“– å¯¼èˆªç›®å½• ğŸ“Œ è„šæœ¬æ¦‚è¿° ğŸ”§ samba_setup.sh - æœåŠ¡å™¨é…ç½®è„šæœ¬ ğŸ”— samba_mount.sh - å®¢æˆ·ç«¯æŒ‚è½½è„šæœ¬ ğŸ› ï¸ è¡¥å…… Samba ç›¸å…³å‘½ä»¤ ğŸ“Š æœåŠ¡å™¨ç«¯ç®¡ç†å‘½ä»¤ ğŸ’» å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ ğŸ” æ•…éšœæ’æŸ¥å‘½ä»¤ ğŸ¯ æ‰‹åŠ¨æŒ‚è½½ Samba ç¤ºä¾‹ ğŸ“‚ 1. æ‰‹åŠ¨æŒ‚è½½ Samba å…±äº« âš™ï¸ 2. é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ â“ å¸¸è§é—®é¢˜è§£å†³ ğŸ”’ å®‰å…¨å»ºè®® ğŸ“ æ€»ç»“ ğŸ“Œ è„šæœ¬æ¦‚è¿° Samba æ˜¯åœ¨ Linux å’Œ UNIX ç³»ç»Ÿä¸Šå®ç° SMB/CIFS åè®®çš„å¼€æºè½¯ä»¶ï¼Œå…è®¸ä¸ Windows ç³»ç»Ÿè¿›è¡Œæ–‡ä»¶ä¸æ‰“å°æœºå…±äº«ã€‚ä¸‹é¢ä»‹ç»çš„ä¸¤ä¸ªè„šæœ¬æå¤§ç®€åŒ–äº† Samba çš„é…ç½®å’Œç®¡ç†æµç¨‹ã€‚âœ¨\nğŸ”§ samba_setup.sh - æœåŠ¡å™¨é…ç½®è„šæœ¬ æ­¤è„šæœ¬ç”¨äºè‡ªåŠ¨åŒ–å®‰è£…å’Œé…ç½® Samba æœåŠ¡å™¨ï¼Œåˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®ç”¨æˆ·æƒé™ï¼Œç‰¹åˆ«é€‚åˆå¿«é€Ÿéƒ¨ç½²å’Œæ‰¹é‡é…ç½®åœºæ™¯ã€‚ğŸ¯\nä¸»è¦åŠŸèƒ½ç‰¹ç‚¹ï¼š\nâœ… è‡ªåŠ¨æ£€æµ‹ç³»ç»ŸåŒ…ç®¡ç†å™¨ï¼ˆAPT/YUM/DNFï¼‰å¹¶å®‰è£… Samba âœ… åˆ›å»ºå¯è‡ªå®šä¹‰çš„å…±äº«ç›®å½•å¹¶è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶å’Œæƒé™ âœ… äº¤äº’å¼è®¾ç½® Samba ç”¨æˆ·å’Œå¯†ç ï¼Œæ”¯æŒå¯†ç å¼ºåº¦æ£€æŸ¥ âœ… æ™ºèƒ½é…ç½® Samba å…±äº«æƒé™ï¼Œæ”¯æŒåŒ¿åå’Œè®¤è¯è®¿é—®æ¨¡å¼ âœ… è‡ªåŠ¨é‡å¯ Samba æœåŠ¡å¹¶æä¾›æ¸…æ™°çš„è¿æ¥ä¿¡æ¯å±•ç¤º âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ âœ… æ”¯æŒçš„ç³»ç»Ÿ: Ubuntu, Debian, CentOS, RHEL, Fedora ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/samba/samba_setup.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/samba/samba_setup.sh) ğŸ”— samba_mount.sh - å®¢æˆ·ç«¯æŒ‚è½½è„šæœ¬ æ­¤è„šæœ¬ç”¨äºåœ¨å®¢æˆ·ç«¯æŒ‚è½½è¿œç¨‹ Samba å…±äº«ï¼Œæä¾›å‹å¥½çš„äº¤äº’ç•Œé¢ï¼Œæ”¯æŒå¤šç§æŒ‚è½½æ–¹å¼å’Œè‡ªåŠ¨å‘ç°åŠŸèƒ½ã€‚ğŸŒ\nä¸»è¦åŠŸèƒ½ç‰¹ç‚¹ï¼š\nâœ… è‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£…å¿…éœ€çš„ CIFS å·¥å…·åŒ… âœ… æ‰«æç½‘ç»œä¸­çš„ Samba å…±äº«æœåŠ¡å™¨ï¼Œæ”¯æŒæ‰‹åŠ¨è¾“å…¥IP âœ… äº¤äº’å¼é€‰æ‹©å¯ç”¨å…±äº«ï¼Œæ˜¾ç¤ºå…±äº«è¯¦ç»†ä¿¡æ¯ âœ… æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼ˆç”¨æˆ·åå¯†ç /åŒ¿åè®¿é—®ï¼‰ âœ… å¯é…ç½®æœ¬åœ°æŒ‚è½½ç‚¹å’Œå¼€æœºè‡ªåŠ¨æŒ‚è½½é€‰é¡¹ âœ… æä¾›æŒ‚è½½æµ‹è¯•å’Œé”™è¯¯è¯Šæ–­åŠŸèƒ½ âœ… æ”¯æŒçš„ç³»ç»Ÿ: Ubuntu, Debian, CentOS, RHEL, Fedora ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 3 4 5 # Vercel ä»“åº“ bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/samba/samba_mount.sh) # Gitee ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/samba/samba_mount.sh) ğŸ› ï¸ è¡¥å…… Samba ç›¸å…³å‘½ä»¤ é™¤äº†ä½¿ç”¨è„šæœ¬å¤–ï¼ŒæŒæ¡ä»¥ä¸‹ Samba å‘½ä»¤å°†å¸®åŠ©æ‚¨æ›´çµæ´»åœ°ç®¡ç†å…±äº«æœåŠ¡ã€‚ğŸ“š\nğŸ“Š æœåŠ¡å™¨ç«¯ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # æŸ¥çœ‹ Samba æœåŠ¡çŠ¶æ€ sudo systemctl status smbd sudo systemctl status nmbd # å¯åŠ¨/åœæ­¢/é‡å¯ Samba æœåŠ¡ sudo systemctl start smbd nmbd sudo systemctl stop smbd nmbd sudo systemctl restart smbd nmbd # æŸ¥çœ‹ Samba é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡® testparm # æŸ¥çœ‹å½“å‰è¿æ¥çš„ Samba å®¢æˆ·ç«¯å’Œæ–‡ä»¶ä½¿ç”¨æƒ…å†µ smbstatus # æ·»åŠ  Samba ç”¨æˆ·ï¼ˆéœ€å…ˆå­˜åœ¨ç³»ç»Ÿç”¨æˆ·ï¼‰ sudo smbpasswd -a username # åˆ é™¤ Samba ç”¨æˆ· sudo smbpasswd -x username # å¯ç”¨/ç¦ç”¨ Samba ç”¨æˆ· sudo smbpasswd -e username sudo smbpasswd -d username # æŸ¥çœ‹ Samba ç”¨æˆ·åˆ—è¡¨ pdbedit -L # ä¿®æ”¹ Samba ç”¨æˆ·å¯†ç  sudo smbpasswd username ğŸ’» å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åŒ¿åæŸ¥çœ‹æœåŠ¡å™¨å¯ç”¨å…±äº« smbclient -L //server_ip -N # æŸ¥çœ‹æœåŠ¡å™¨å¯ç”¨å…±äº« smbclient -L //server_ip -U username # äº¤äº’å¼è¿æ¥å…±äº«ï¼ˆç±»ä¼¼FTPï¼‰ smbclient //server_ip/sharename -U username # æŒ‚è½½ Samba å…±äº«ï¼ˆä¸´æ—¶æŒ‚è½½ï¼‰ sudo mount -t cifs //server_ip/sharename /mnt/share -o username=user,password=pass,vers=3.0 # ä½¿ç”¨å‡­æ®æ–‡ä»¶æŒ‚è½½ï¼ˆæ›´å®‰å…¨ï¼‰ sudo mount -t cifs //server_ip/sharename /mnt/share -o credentials=/path/to/credentials,vers=3.0 # å¸è½½å…±äº« sudo umount /mnt/share # å¼ºåˆ¶å¸è½½ï¼ˆå½“è®¾å¤‡å¿™æ—¶ï¼‰ sudo umount -f /mnt/share # æŸ¥çœ‹å·²æŒ‚è½½çš„ CIFS å…±äº« mount | grep cifs df -h | grep cifs # æ£€æŸ¥å…±äº«æ˜¯å¦å¯è®¿é—® smbclient -U username //server_ip/sharename -c \u0026#34;ls\u0026#34; ğŸ” æ•…éšœæ’æŸ¥å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping server_ip # æ£€æŸ¥ Samba ç«¯å£æ˜¯å¦å¼€æ”¾ nmap -p 139,445 server_ip # æŸ¥çœ‹ Samba è¯¦ç»†æ—¥å¿— tail -f /var/log/samba/log.smbd tail -f /var/log/samba/log.nmbd # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ tail -f /var/log/samba/* # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• testparm -s # è°ƒè¯•æ¨¡å¼å¯åŠ¨ Sambaï¼ˆå‰å°è¿è¡Œï¼‰ smbd -i -d 3 # æ£€æŸ¥å…±äº«æƒé™å’Œå¯è§æ€§ smbclient -L localhost -U username # æŸ¥çœ‹è¯¦ç»†çš„ Samba é…ç½® testparm -v ğŸ¯ æ‰‹åŠ¨æŒ‚è½½ Samba ä½¿ç”¨ç¤ºä¾‹ ğŸ“‚ 1. æ‰‹åŠ¨æŒ‚è½½ Samba å…±äº« 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• sudo mkdir -p /mnt/myshare # æŒ‚è½½å…±äº«ï¼ˆè®¤è¯è®¿é—®ï¼‰ sudo mount -t cifs //192.168.1.100/myshare /mnt/myshare -o username=myuser,password=mypass,vers=3.0 # ä½¿ç”¨å‡­æ®æ–‡ä»¶ï¼ˆæ›´å®‰å…¨ï¼‰ echo \u0026#34;username=myuser\u0026#34; \u0026gt; /root/.smbcredentials echo \u0026#34;password=mypass\u0026#34; \u0026gt;\u0026gt; /root/.smbcredentials chmod 600 /root/.smbcredentials sudo mount -t cifs //192.168.1.100/myshare /mnt/myshare -o credentials=/root/.smbcredentials,vers=3.0 # æŒ‚è½½æ—¶æŒ‡å®šæ–‡ä»¶å’Œç›®å½•æƒé™ sudo mount -t cifs //192.168.1.100/myshare /mnt/myshare -o credentials=/root/.smbcredentials,uid=1000,gid=1000,file_mode=0777,dir_mode=0777,vers=3.0 âš™ï¸ 2. é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ åˆ›å»ºå‡­æ®æ–‡ä»¶ï¼š\n1 sudo nano /root/.smbcredentials æ·»åŠ å†…å®¹ï¼š\n1 2 username=myuser password=mypass è®¾ç½®æƒé™ï¼š\n1 chmod 600 /root/.smbcredentials ç¼–è¾‘ /etc/fstab æ–‡ä»¶ï¼š\n1 sudo nano /etc/fstab æ·»åŠ ä»¥ä¸‹è¡Œï¼š\n1 //192.168.1.100/myshare /mnt/myshare cifs credentials=/root/.smbcredentials,uid=1000,gid=1000,file_mode=0777,dir_mode=0777,vers=3.0 0 0 æµ‹è¯• fstab é…ç½®ï¼š\n1 sudo mount -a å¦‚æœæ²¡æœ‰é”™è¯¯ä¿¡æ¯ï¼Œè¡¨ç¤ºé…ç½®æˆåŠŸï¼Œé‡å¯åä¼šè‡ªåŠ¨æŒ‚è½½ã€‚\nâ“ å¸¸è§é—®é¢˜è§£å†³ æŒ‚è½½å¤±è´¥ï¼šåè®®é”™è¯¯ ğŸ¤”\nå°è¯•æ·»åŠ  vers=2.0 æˆ– vers=1.0 å‚æ•°å…¼å®¹æ—§ç‰ˆæœ¬ æ£€æŸ¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ Samba ç‰ˆæœ¬ï¼šsmbd --version ç¡®è®¤æœåŠ¡å™¨æ”¯æŒçš„åè®®ç‰ˆæœ¬ï¼šåœ¨ smb.conf çš„ [global] éƒ¨åˆ†è®¾ç½® server min protocol = NT1 æƒé™é—®é¢˜ ğŸ”\nç¡®ä¿æŒ‚è½½ç‚¹ç›®å½•å­˜åœ¨ä¸”æœ‰é€‚å½“æƒé™ï¼šchmod 755 /mnt/share æ£€æŸ¥ Samba é…ç½®ä¸­çš„æƒé™è®¾ç½®ï¼šforce user å’Œ force group å‚æ•° ç¡®è®¤ SELinux æˆ– AppArmor æ²¡æœ‰é˜»æ­¢è®¿é—®ï¼šsetenforce 0ï¼ˆä¸´æ—¶ç¦ç”¨æµ‹è¯•ï¼‰ è¿æ¥è¶…æ—¶ â±ï¸\næ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ 139/TCP å’Œ 445/TCP ç«¯å£å¼€æ”¾ï¼š 1 2 sudo ufw allow samba sudo firewall-cmd --add-service=samba --permanent éªŒè¯ç½‘ç»œè¿é€šæ€§ï¼šping server_ip å’Œ telnet server_ip 445 è®¤è¯å¤±è´¥ ğŸ”‘\nç¡®è®¤ç”¨æˆ·åå’Œå¯†ç æ­£ç¡® æ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·æ˜¯å¦å·²æ·»åŠ åˆ° Sambaï¼špdbedit -L ç¡®ä¿ç”¨æˆ·æœ‰æƒé™è®¿é—®å…±äº«ï¼šæ£€æŸ¥ smb.conf ä¸­çš„ valid users è®¾ç½® å…±äº«ä¸å¯è§ ğŸ‘»\næ£€æŸ¥ smb.conf ä¸­å…±äº«çš„ browseable = yes è®¾ç½® ç¡®è®¤ç½‘ç»œå‘ç°æ­£å¸¸å·¥ä½œï¼šnmblookup -S server_ip å†™å…¥æƒé™ä¸è¶³ ğŸ“\næ£€æŸ¥å…±äº«ç›®å½•çš„ Linux æ–‡ä»¶ç³»ç»Ÿæƒé™ ç¡®è®¤ Samba é…ç½®ä¸­çš„ writable = yes æˆ– read only = no æ£€æŸ¥ create mask å’Œ directory mask è®¾ç½® ğŸ”’ å®‰å…¨å»ºè®® ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥ ğŸ’ª\nä¸º Samba ç”¨æˆ·è®¾ç½®å¤æ‚å¯†ç ï¼ˆå¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰ å®šæœŸæ›´æ¢å¯†ç ï¼Œé¿å…ä½¿ç”¨é»˜è®¤æˆ–å¸¸è§å¯†ç  æœ€å°æƒé™åŸåˆ™ ğŸ“‰\né™åˆ¶å…±äº«ç›®å½•çš„è®¿é—®æƒé™åˆ°å¿…è¦çš„æœ€å°èŒƒå›´ ä¸ºä¸åŒç”¨æˆ·ç»„åˆ›å»ºä¸åŒçš„å…±äº«å’Œæƒé™è®¾ç½® ç½‘ç»œéš”ç¦» ğŸŒ\nä½¿ç”¨é˜²ç«å¢™é™åˆ¶åªæœ‰å¯ä¿¡ç½‘ç»œå¯ä»¥è®¿é—® Samba ç«¯å£ è€ƒè™‘ä½¿ç”¨ VPN æˆ– SSH éš§é“åŠ å¯† Samba æµé‡ å®šæœŸæ›´æ–° ğŸ”„\nå®šæœŸæ›´æ–° Samba è½¯ä»¶ä»¥è·å–å®‰å…¨è¡¥ä¸ï¼šsudo apt update \u0026amp;\u0026amp; sudo apt upgrade samba è®¢é˜… Samba å®‰å…¨å…¬å‘Šï¼ŒåŠæ—¶åº”å¯¹æ¼æ´ æ—¥å¿—ç›‘æ§ ğŸ‘€\nå®šæœŸæ£€æŸ¥ Samba æ—¥å¿—ï¼š/var/log/samba/ è®¾ç½®æ—¥å¿—è½®è½¬å’Œç›‘æ§ï¼ŒåŠæ—¶å‘ç°å¯ç–‘æ´»åŠ¨ ç¦ç”¨åŒ¿åè®¿é—® ğŸš«\né™¤éå¿…è¦ï¼Œå¦åˆ™ç¦ç”¨åŒ¿åè®¿é—®ï¼šmap to guest = never ä¸ºæ‰€æœ‰å…±äº«è®¾ç½®è®¤è¯è¦æ±‚ ğŸ“ æ€»ç»“ é€šè¿‡æœ¬æ–‡ä»‹ç»çš„ä¸¤ä¸ªè„šæœ¬å’Œä¸€ç³»åˆ— Samba ç®¡ç†å‘½ä»¤ï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°ä»¥ä¸‹ç›®æ ‡ï¼šğŸ¯\nå¿«é€Ÿéƒ¨ç½²ï¼šä½¿ç”¨ samba_setup.sh åœ¨å‡ åˆ†é’Ÿå†…å®Œæˆ Samba æœåŠ¡å™¨é…ç½® ä¾¿æ·è¿æ¥ï¼šé€šè¿‡ samba_mount.sh è½»æ¾æŒ‚è½½è¿œç¨‹å…±äº«ï¼Œæ”¯æŒäº¤äº’å¼é€‰æ‹© çµæ´»ç®¡ç†ï¼šæŒæ¡å„ç§ Samba å‘½ä»¤ï¼Œåº”å¯¹ä¸åŒç®¡ç†åœºæ™¯å’Œéœ€æ±‚ æ•…éšœæ’é™¤ï¼šä½¿ç”¨ä¸“ä¸šå·¥å…·è¯Šæ–­å’Œè§£å†³è¿æ¥ã€æƒé™ç­‰é—®é¢˜ å®‰å…¨ä¿éšœï¼šå®æ–½æœ€ä½³å®è·µï¼Œç¡®ä¿æ–‡ä»¶å…±äº«æœåŠ¡çš„å®‰å…¨æ€§ æ— è®ºæ˜¯å®¶åº­ç½‘ç»œä¸­çš„ç®€å•æ–‡ä»¶å…±äº«ï¼Œè¿˜æ˜¯ä¼ä¸šç¯å¢ƒä¸­çš„è·¨å¹³å°åä½œï¼ŒSamba éƒ½æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚è¿™äº›è„šæœ¬å’Œå‘½ä»¤å°†å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ä½¿ç”¨è¿™ä¸€å·¥å…·ï¼Œæå‡å·¥ä½œæ•ˆç‡å’Œç³»ç»Ÿå¯é æ€§ã€‚ğŸ’¼\nå»ºè®®æ”¶è—æœ¬æ–‡ä½œä¸º Samba ç®¡ç†çš„å‚è€ƒæ‰‹å†Œï¼Œéšæ—¶æŸ¥é˜…ç›¸å…³å‘½ä»¤å’ŒæŠ€å·§ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºï¼ğŸ’¬\n","date":"2025-09-10T22:41:17+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c99a10c2/","title":"Linux é…ç½® Samba æœåŠ¡ä¸€é”®è¿œç¨‹è„šæœ¬ğŸ§"},{"content":"Linux SCP å‘½ä»¤ ä»æœ¬åœ°åˆ°è¿œç¨‹åŒæ­¥ ğŸ“ SCP (Secure Copy Protocol) æ˜¯åŸºäº SSH çš„å®‰å…¨æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œé€‚ç”¨äºæœ¬åœ°ä¸è¿œç¨‹ç³»ç»Ÿé—´çš„æ–‡ä»¶å¤åˆ¶ã€‚ä¸ Rsync ä¸åŒï¼ŒSCP ä¸æä¾›å¢é‡åŒæ­¥åŠŸèƒ½ï¼Œä½†ç®€å•æ˜“ç”¨ï¼Œé€‚åˆä¸€æ¬¡æ€§æ–‡ä»¶ä¼ è¾“ä»»åŠ¡ã€‚\nğŸ“š ç›®å½•å¯¼èˆª âœ¨ SCP ç®€ä»‹ä¸ç‰¹ç‚¹ ğŸ” æ ¸å¿ƒæ¦‚å¿µï¼šè·¯å¾„æ–œæ çš„ä½œç”¨ ğŸŸ¢ å¤åˆ¶ç›®å½•æœ¬èº«ï¼ˆæ¨èç”¨æ³•ï¼‰ æœ¬åœ°åˆ°è¿œç¨‹å¤åˆ¶ è¿œç¨‹åˆ°æœ¬åœ°å¤åˆ¶ ğŸ”„ å¤åˆ¶ç›®å½•å†…å®¹ æœ¬åœ°åˆ°è¿œç¨‹å¤åˆ¶ è¿œç¨‹åˆ°æœ¬åœ°å¤åˆ¶ ğŸŒ è¿œç¨‹å¤åˆ¶è¯¦è§£ ğŸ†š SCP ä¸ Rsync å¯¹æ¯”åˆ†æ ğŸ’¡ ä½¿ç”¨åœºæ™¯å»ºè®® âš ï¸ é‡è¦æé†’ âœ¨ SCP ç®€ä»‹ä¸ç‰¹ç‚¹ SCPï¼ˆSecure Copyï¼‰æ˜¯åŸºäº SSH çš„å®‰å…¨æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š\nç®€å•æ˜“ç”¨ ğŸ› ï¸ï¼šå‘½ä»¤è¯­æ³•ç›´è§‚ï¼Œå­¦ä¹ æˆæœ¬ä½ åŠ å¯†ä¼ è¾“ ğŸ”’ï¼šé€šè¿‡ SSH åè®®ä¿éšœæ•°æ®ä¼ è¾“å®‰å…¨ ä¿ç•™å±æ€§ ğŸ“ï¼šä¿ç•™æ–‡ä»¶æƒé™å’Œæ—¶é—´æˆ³ï¼ˆéƒ¨åˆ†å±æ€§ï¼‰ è·¨å¹³å°å…¼å®¹ ğŸ’»ï¼šæ‰€æœ‰æ”¯æŒ SSH çš„ç³»ç»Ÿå‡å¯ä½¿ç”¨ ğŸ” æ ¸å¿ƒæ¦‚å¿µï¼šè·¯å¾„æ–œæ çš„ä½œç”¨ SCP çš„è·¯å¾„æ–œæ è§„åˆ™ä¸ Rsync ç±»ä¼¼ä½†æ›´ä¸ºä¸¥æ ¼ï¼š\næºè·¯å¾„æ–œæ è§„åˆ™ï¼š æœ‰æ–œæ  (path/to/source/) â†’ å¤åˆ¶æºç›®å½•çš„å†…å®¹ æ— æ–œæ  (path/to/source) â†’ å¤åˆ¶æºç›®å½•æœ¬èº«åŠå…¶å†…å®¹ ç›®æ ‡è·¯å¾„æ–œæ è§„åˆ™ï¼š æœ‰æ–œæ  (path/to/destination/) â†’ ç›®æ ‡æ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„ç›®å½• æ— æ–œæ  (path/to/destination) â†’ å¯èƒ½åˆ›å»ºç›®å½•æˆ–æ–‡ä»¶ âœ¨ é‡è¦æç¤ºï¼š SCP ä¸æ”¯æŒè‡ªåŠ¨åˆ›å»ºç›®æ ‡è·¯å¾„ä¸­ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ï¼Œå¿…é¡»ç¡®ä¿ç›®æ ‡è·¯å¾„å·²å­˜åœ¨ã€‚\nğŸŸ¢ å¤åˆ¶ç›®å½•æœ¬èº« æœ¬åœ°åˆ°è¿œç¨‹å¤åˆ¶ï¼š 1 scp -r -P 22 -i ~/.ssh/Debian13_SSH /vol1/1000/compose/aipan root@10.10.10.246:/mnt/test/ è¿œç¨‹åˆ°æœ¬åœ°å¤åˆ¶ï¼š 1 scp -r -P 22 -i ~/.ssh/Debian13_SSH root@10.10.10.246:/mnt/test/aipan /vol1/1000/compose/ è¡Œä¸ºï¼š å°† aipan ç›®å½•æœ¬èº«ï¼ˆåŒ…æ‹¬å…¶æ‰€æœ‰å†…å®¹ï¼‰å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ä¸­ ä½¿ç”¨ -r é€‰é¡¹é€’å½’å¤åˆ¶æ•´ä¸ªç›®å½• ç»“æœç›®å½•ç»“æ„ï¼š 1 2 3 4 5 /mnt/test/ \u0026lt;-- å¿…é¡»å·²å­˜åœ¨ï¼ â””â”€â”€ aipan/ \u0026lt;-- åˆ›å»ºçš„ç›®å½•å‰¯æœ¬ â”œâ”€â”€ file1.txt â”œâ”€â”€ dir1/ â””â”€â”€ ... ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š å½“ä½ æƒ³è¦åœ¨ç›®æ ‡ä½ç½®åˆ›å»ºä¸€ä¸ªä¸æºç›®å½•åŒåçš„å®Œæ•´å‰¯æœ¬æ—¶ã€‚\nğŸ”„ å¤åˆ¶ç›®å½•å†…å®¹ æœ¬åœ°åˆ°è¿œç¨‹å¤åˆ¶ï¼š 1 scp -r -P 22 -i ~/.ssh/Debian13_SSH /vol1/1000/compose/aipan/* root@10.10.10.246:/mnt/test/aipan/ è¿œç¨‹åˆ°æœ¬åœ°å¤åˆ¶ï¼š 1 scp -r -P 22 -i ~/.ssh/Debian13_SSH root@10.10.10.246:/mnt/test/aipan/* /vol1/1000/compose/aipan/ è¡Œä¸ºï¼š åªå¤åˆ¶ aipan/ ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ˆæ–‡ä»¶å’Œå­ç›®å½•ï¼‰ ä½¿ç”¨é€šé…ç¬¦ * æŒ‡å®šå¤åˆ¶ç›®å½•å†…å®¹ ç»“æœç›®å½•ç»“æ„ï¼š 1 2 3 4 /mnt/test/aipan/ \u0026lt;-- å¿…é¡»å·²å­˜åœ¨ï¼ â”œâ”€â”€ file1.txt \u0026lt;-- æºç›®å½•çš„å†…å®¹ç›´æ¥æ”¾åœ¨è¿™é‡Œ â”œâ”€â”€ dir1/ â””â”€â”€ ... ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š å°†ç›®å½•å†…å®¹å¤åˆ¶åˆ°å·²å­˜åœ¨çš„ç›®æ ‡ç›®å½•ä¸­ã€‚\nğŸŒ è¿œç¨‹å¤åˆ¶è¯¦è§£ SCP å¸¸ç”¨å‚æ•°ï¼š -rï¼šé€’å½’å¤åˆ¶æ•´ä¸ªç›®å½• -P \u0026lt;port\u0026gt;ï¼šæŒ‡å®š SSH ç«¯å£ï¼ˆé»˜è®¤ä¸º 22ï¼‰ -i \u0026lt;identity_file\u0026gt;ï¼šæŒ‡å®šèº«ä»½æ–‡ä»¶ï¼ˆç§é’¥ï¼‰ -Cï¼šå¯ç”¨å‹ç¼©ï¼Œå¯èƒ½åŠ å¿«ä¼ è¾“é€Ÿåº¦ -vï¼šè¯¦ç»†æ¨¡å¼ï¼Œè¾“å‡ºè°ƒè¯•ä¿¡æ¯ ğŸ”§ é¢å¤–å»ºè®®ï¼š ä½¿ç”¨ SSH é…ç½®ç®€åŒ–å‘½ä»¤ï¼š åœ¨ ~/.ssh/config ä¸­é…ç½®æœåŠ¡å™¨ä¿¡æ¯ï¼š\n1 2 3 4 5 Host myserver HostName 10.10.10.246 User root Port 22 IdentityFile ~/.ssh/Debian13_SSH ç„¶åä½¿ç”¨ç®€åŒ–çš„å‘½ä»¤ï¼š\n1 scp -r /vol1/1000/compose/aipan myserver:/mnt/test/ é™åˆ¶å¸¦å®½ï¼ˆé€‚ç”¨äºæ…¢é€Ÿè¿æ¥ï¼‰ï¼š\n1 2 # SCP æœ¬èº«ä¸ç›´æ¥æ”¯æŒå¸¦å®½é™åˆ¶ï¼Œä½†å¯é€šè¿‡å…¶ä»–å·¥å…·é…åˆå®ç° # æˆ–è€…ä½¿ç”¨ rsync å¦‚æœ‰å¸¦å®½é™åˆ¶éœ€æ±‚ ä¿ç•™æ–‡ä»¶å±æ€§ï¼š\n1 2 # SCP ä¼šå°½é‡ä¿ç•™æƒé™å’Œæ—¶é—´æˆ³ï¼Œä½†ä¸å¦‚ rsync å…¨é¢ # å¯¹äºéœ€è¦å®Œå…¨ä¿ç•™æ‰€æœ‰å±æ€§çš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨ rsync ğŸ†š SCP ä¸ Rsync å¯¹æ¯”åˆ†æ ç‰¹æ€§ SCP Rsync ä¸»è¦ç”¨é€” å®‰å…¨æ–‡ä»¶å¤åˆ¶ é«˜æ•ˆæ–‡ä»¶åŒæ­¥ å¢é‡ä¼ è¾“ ä¸æ”¯æŒ æ”¯æŒï¼ˆä»…ä¼ è¾“å˜åŒ–éƒ¨åˆ†ï¼‰ ç›®å½•å¤„ç† ç®€å•é€’å½’å¤åˆ¶ çµæ´»ç›®å½•ç»“æ„æ§åˆ¶ å¸¦å®½æ•ˆç‡ ç›¸å¯¹è¾ƒä½ é«˜æ•ˆï¼ˆå¢é‡ä¼ è¾“+å‹ç¼©ï¼‰ å±æ€§ä¿æŒ åŸºæœ¬æƒé™å’Œæ—¶é—´æˆ³ å®Œæ•´å±æ€§ä¿æŒ åˆ é™¤åŠŸèƒ½ ä¸æ”¯æŒ æ”¯æŒåˆ é™¤ç›®æ ‡ç«¯æ–‡ä»¶ è·¯å¾„åˆ›å»º ä¸æ”¯æŒè‡ªåŠ¨åˆ›å»ºè·¯å¾„ æ”¯æŒ --mkpath é€‰é¡¹ ğŸ’¡ ä½¿ç”¨åœºæ™¯å»ºè®® 1. é€‰æ‹© SCP å½“ï¼š éœ€è¦ç®€å•å¿«é€Ÿçš„æ–‡ä»¶å¤åˆ¶ ä¼ è¾“é‡ä¸å¤§ï¼Œä¸éœ€è¦å¢é‡åŒæ­¥ ç³»ç»Ÿèµ„æºæœ‰é™ï¼Œä¸éœ€è¦ rsync çš„é«˜çº§åŠŸèƒ½ åªæ˜¯å¶å°”éœ€è¦ä¼ è¾“æ–‡ä»¶ 2. é€‰æ‹© Rsync å½“ï¼š éœ€è¦å®šæœŸåŒæ­¥å¤§é‡æ–‡ä»¶ éœ€è¦å¢é‡ä¼ è¾“èŠ‚çœå¸¦å®½å’Œæ—¶é—´ éœ€è¦ä¿æŒæ–‡ä»¶å±æ€§çš„å®Œå…¨ä¸€è‡´ éœ€è¦åŒå‘åŒæ­¥æˆ–åˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶ éœ€è¦æ›´å¤æ‚çš„è¿‡æ»¤å’Œæ’é™¤è§„åˆ™ ğŸ”§ é€šç”¨å»ºè®®ï¼š é¦–æ¬¡è¿è¡Œå‰æ£€æŸ¥ï¼š\nSCP æ²¡æœ‰ dry-run é€‰é¡¹ï¼Œå¯ä»¥å…ˆä½¿ç”¨ ls å‘½ä»¤æ£€æŸ¥æºæ–‡ä»¶å’Œç›®æ ‡è·¯å¾„ å¤§æ–‡ä»¶ä¼ è¾“ï¼š\nå¯¹äºå¤§æ–‡ä»¶ä¼ è¾“ï¼Œè€ƒè™‘ä½¿ç”¨ screen æˆ– tmux ä¿æŒä¼šè¯ï¼Œé˜²æ­¢ç½‘ç»œä¸­æ–­å¯¼è‡´ä¼ è¾“å¤±è´¥ 1 2 3 screen -S file_transfer scp -r large_directory user@remote:/path/to/destination/ # æŒ‰ Ctrl+A then D è„±ç¦»ä¼šè¯ âš ï¸ é‡è¦æé†’ è·¯å¾„å­˜åœ¨æ€§ï¼š\nSCP è¦æ±‚ç›®æ ‡è·¯å¾„çš„çˆ¶ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œæ— æ³•è‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„è·¯å¾„ åœ¨æ‰§è¡Œ SCP å‰ï¼Œè¯·ç¡®ä¿ç›®æ ‡è·¯å¾„å·²åˆ›å»º æƒé™é—®é¢˜ï¼š\nç¡®ä¿æ‚¨æœ‰æƒé™è¯»å–æºæ–‡ä»¶ ç¡®ä¿ç›®æ ‡ä½ç½®æœ‰å†™å…¥æƒé™ è¿æ¥ç¨³å®šæ€§ï¼š\nSCP ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œç½‘ç»œä¸­æ–­éœ€è¦é‡æ–°å¼€å§‹ä¼ è¾“ å¯¹äºå¤§æ–‡ä»¶ä¼ è¾“ï¼Œè€ƒè™‘ä½¿ç”¨ rsync æˆ–æ‹†åˆ†æ–‡ä»¶ è¦†ç›–é£é™©ï¼š\nSCP ä¼šé™é»˜è¦†ç›–ç›®æ ‡ç«¯åŒåæ–‡ä»¶ï¼Œæ²¡æœ‰è­¦å‘Šæç¤º ä¼ è¾“å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ® æ€§èƒ½è€ƒè™‘ï¼š\nå¯¹äºå¤§é‡å°æ–‡ä»¶ï¼ŒSCP æ€§èƒ½å¯èƒ½è¾ƒå·®ï¼Œå› ä¸ºéœ€è¦ä¸ºæ¯ä¸ªæ–‡ä»¶å»ºç«‹æ–°çš„è¿æ¥ è€ƒè™‘ä½¿ç”¨ tar æ‰“åŒ…åä¼ è¾“ï¼Œå†åœ¨ç›®æ ‡ç«¯è§£åŒ… 1 tar czf - /vol1/1000/compose/aipan | ssh -i ~/.ssh/Debian13_SSH -p 22 root@10.10.10.246 \u0026#34;tar xzf - -C /mnt/test/\u0026#34; âœ¨ æœ€ä½³å®è·µæç¤ºï¼š\nå¯¹äºé‡è¦æ•°æ®ï¼Œå§‹ç»ˆå…ˆå¤‡ä»½å†ä¼ è¾“ ä½¿ç”¨ SSH å¯†é’¥è®¤è¯ï¼Œé¿å…å¯†ç è¾“å…¥ å¯¹äºå¤§è§„æ¨¡æˆ–å®šæœŸåŒæ­¥ä»»åŠ¡ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ rsync ä¼ è¾“å®ŒæˆåéªŒè¯æ–‡ä»¶å®Œæ•´æ€§å’Œæ•°é‡ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹© SCP æˆ– Rsyncã€‚SCP æä¾›äº†ç®€å•ç›´æ¥çš„æ–‡ä»¶å¤åˆ¶åŠŸèƒ½ï¼Œè€Œ Rsync æä¾›äº†æ›´é«˜çº§çš„åŒæ­¥èƒ½åŠ›ã€‚æ ¹æ®æ‚¨çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œç¡®ä¿æ•°æ®å®‰å…¨é«˜æ•ˆä¼ è¾“ï¼\n","date":"2025-09-09T17:29:11+08:00","image":"https://file.meimolihan.eu.org/img/linux-scp-01.webp","permalink":"https://blog.meimolihan.eu.org/p/175e9d50/","title":"Linux SCP å‘½ä»¤ ä»æœ¬åœ°åˆ°è¿œç¨‹åŒæ­¥ ğŸ“"},{"content":"Linux ä¸­ SSH å¯†é’¥å¯¹åˆ›å»ºä¸åˆ†å‘æŒ‡å— ğŸ” SSHï¼ˆSecure Shellï¼‰å¯†é’¥å¯¹æ˜¯ Linux ç³»ç»Ÿä¸­å®‰å…¨è¿œç¨‹ç™»å½•å’Œæ–‡ä»¶ä¼ è¾“çš„åŸºçŸ³ã€‚é‡‡ç”¨å¯†é’¥è®¤è¯æ¯”ä¼ ç»Ÿçš„å¯†ç è®¤è¯æ›´å®‰å…¨ï¼Œä¸”ä¾¿äºè‡ªåŠ¨åŒ–ç®¡ç†ã€‚\nå¯¼èˆªç›®å½• ğŸ“š ç®€ä»‹ ğŸš€ ä¸€é”®å¯†é’¥å¯¹åˆ›å»ºä¸åˆ†å‘ âš¡ å…äº¤äº’ç”ŸæˆSSHå¯†é’¥å¯¹ ğŸ”§ å®‰è£…å¿…è¦å·¥å…· ğŸš€ å…äº¤äº’åˆ†å‘SSHå¯†é’¥å¯¹ ğŸ” è¿æ¥æµ‹è¯• ğŸ’¡ æœ€ä½³å®è·µä¸æŠ€å·§ ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ“š ç®€ä»‹ SSHå¯†é’¥å¯¹æ˜¯ç°ä»£æœåŠ¡å™¨ç®¡ç†ä¸­çš„é‡è¦å·¥å…·ï¼Œå®ƒæä¾›äº†æ¯”ä¼ ç»Ÿå¯†ç è®¤è¯æ›´å®‰å…¨ã€æ›´ä¾¿æ·çš„è¿œç¨‹è¿æ¥æ–¹å¼ã€‚âœ¨\nä¸ºä»€ä¹ˆé€‰æ‹©SSHå¯†é’¥å¯¹ï¼Ÿ ğŸ”’ å¢å¼ºå®‰å…¨æ€§ - é¿å…å¯†ç è¢«æš´åŠ›ç ´è§£ âš¡ æå‡æ•ˆç‡ - ä¸€æ¬¡é…ç½®ï¼Œé•¿æœŸå…å¯†ç™»å½• ğŸ”§ è‡ªåŠ¨åŒ–å‹å¥½ - é€‚åˆè„šæœ¬å’Œè‡ªåŠ¨åŒ–éƒ¨ç½² ğŸ›¡ï¸ é˜²æ­¢ä¸­é—´äººæ”»å‡» - åŸºäºéå¯¹ç§°åŠ å¯†æŠ€æœ¯ ğŸš€ ä¸€é”®å¯†é’¥å¯¹åˆ›å»ºä¸åˆ†å‘ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/ssh/auto_keypush.sh) 251 252 254 âš¡ å…äº¤äº’ç”ŸæˆSSHå¯†é’¥å¯¹ ğŸ”§ å®‰è£…å¿…è¦å·¥å…· ğŸš€ å…äº¤äº’åˆ†å‘SSHå¯†é’¥å¯¹ ğŸ” è¿æ¥æµ‹è¯• âš¡ å…äº¤äº’ç”ŸæˆSSHå¯†é’¥å¯¹ æ ¸å¿ƒå‘½ä»¤è¯¦è§£ 1 2 mkdir -pm 700 /root/.ssh \u0026amp;\u0026amp; \\ ssh-keygen -f /root/.ssh/id_rsa -N \u0026#39;\u0026#39; -q ğŸ¯ å‘½ä»¤åˆ†è§£è¯´æ˜ï¼š\nåˆ›å»ºSSHç›®å½•ï¼š\n1 mkdir -pm 700 /root/.ssh -pï¼šé€’å½’åˆ›å»ºæ‰€éœ€ç›®å½• -m 700ï¼šè®¾ç½®ç›®å½•æƒé™ä¸º700ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™æ‰§è¡Œï¼‰ ğŸ”’ å®‰å…¨è¦æ±‚ï¼šSSHç›®å½•å¿…é¡»ä¸¥æ ¼æƒé™æ§åˆ¶ ç”Ÿæˆå¯†é’¥å¯¹ï¼š\n1 ssh-keygen -f /root/.ssh/id_rsa -N \u0026#39;\u0026#39; -q -f /root/.ssh/id_rsaï¼šæŒ‡å®šå¯†é’¥æ–‡ä»¶è·¯å¾„å’Œåç§° -N ''ï¼šè®¾ç½®ç©ºå¯†ç ï¼ˆæ— å¯†ç ä¿æŠ¤å¯†é’¥ï¼‰ -qï¼šå®‰é™æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ id_rsa ğŸ”‘ - ç§é’¥æ–‡ä»¶ï¼ˆå¿…é¡»ä¸¥æ ¼ä¿å¯†ï¼ï¼‰ id_rsa.pub ğŸŒ - å…¬é’¥æ–‡ä»¶ï¼ˆç”¨äºåˆ†å‘åˆ°æœåŠ¡å™¨ï¼‰ ğŸ”§ å®‰è£…å¿…è¦å·¥å…· å®‰è£…sshpasså·¥å…· 1 apt update -y \u0026amp;\u0026amp; apt install -y sshpass ğŸ” å·¥å…·è¯´æ˜ï¼š\nsshpassï¼šç”¨äºåœ¨å‘½ä»¤è¡Œä¸­éäº¤äº’å¼åœ°æä¾›SSHå¯†ç  é€‚ç”¨åœºæ™¯ï¼šè‡ªåŠ¨åŒ–è„šæœ¬ã€CI/CDæµæ°´çº¿ã€æ‰¹é‡éƒ¨ç½² ğŸ“Œ å®‰è£…å‚æ•°è§£é‡Šï¼š\napt update -yï¼šæ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œ-yè‡ªåŠ¨ç¡®è®¤ apt install -y sshpassï¼šå®‰è£…sshpassï¼Œ-yè‡ªåŠ¨ç¡®è®¤å®‰è£… ğŸ”„ å…¶ä»–ç³»ç»Ÿå®‰è£…æ–¹æ³• 1 2 3 4 5 # CentOS/RHELç³»ç»Ÿ yum install -y sshpass # macOSç³»ç»Ÿ brew install hudochenkov/sshpass/sshpass ğŸš€ å…äº¤äº’åˆ†å‘SSHå¯†é’¥å¯¹ æ ¸å¿ƒåˆ†å‘å‘½ä»¤ 1 sshpass -pYourpassword ssh-copy-id -o StrictHostKeyChecking=no 10.10.10.251 ğŸ¯ å‚æ•°è¯¦ç»†è§£æï¼š\nå‚æ•° è¯´æ˜ æ³¨æ„äº‹é¡¹ -pYourpassword ç›®æ ‡æœåŠ¡å™¨å¯†ç  ğŸ”’ ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®ä½¿ç”¨å…¶ä»–å®‰å…¨æ–¹å¼ -o StrictHostKeyChecking=no è·³è¿‡ä¸»æœºå¯†é’¥éªŒè¯ âš ï¸ é¦–æ¬¡è¿æ¥æ—¶è‡ªåŠ¨æ¥å—ä¸»æœºå¯†é’¥ 10.10.10.251 ç›®æ ‡æœåŠ¡å™¨åœ°å€ å¯ä»¥æ˜¯IPæˆ–åŸŸå ğŸ”§ å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ è‡ªåŠ¨è®¤è¯ï¼šsshpassæä¾›å¯†ç ç»™ssh-copy-id å…¬é’¥ä¼ è¾“ï¼šå°†æœ¬åœ°å…¬é’¥å¤åˆ¶åˆ°ç›®æ ‡æœåŠ¡å™¨ æƒé™è®¾ç½®ï¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ é…ç½®å®Œæˆï¼šå…¬é’¥æ·»åŠ åˆ°~/.ssh/authorized_keys ğŸ“ æ›¿ä»£æ–¹æ¡ˆï¼ˆæ›´å®‰å…¨ï¼‰ 1 2 3 4 5 6 # ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆé¿å…å¯†ç åœ¨å‘½ä»¤ä¸­æ˜æ–‡ï¼‰ export SSHPASS=Yourpassword sshpass -e ssh-copy-id -o StrictHostKeyChecking=no 10.10.10.251 # ä½¿ç”¨å¯†é’¥æ–‡ä»¶ï¼ˆæ¨èï¼‰ sshpass -f password_file ssh-copy-id 10.10.10.251 ğŸ” è¿æ¥æµ‹è¯• åŸºç¡€è¿æ¥æµ‹è¯• 1 ssh root@10.10.10.251 âœ… æˆåŠŸæ ‡å¿—ï¼š\næ— éœ€è¾“å…¥å¯†ç ç›´æ¥ç™»å½• æ˜¾ç¤ºç›®æ ‡æœåŠ¡å™¨çš„å‘½ä»¤è¡Œæç¤ºç¬¦ è¿”å›é€€å‡ºä»£ç ä¸º0 ğŸ§ª å…¨é¢æµ‹è¯•æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 # 1. åŸºç¡€è¿æ¥æµ‹è¯• ssh root@10.10.10.251 \u0026#34;echo \u0026#39;SSHè¿æ¥æˆåŠŸ!\u0026#39;\u0026#34; # 2. å¸¦è¯¦ç»†æ—¥å¿—çš„æµ‹è¯• ssh -v root@10.10.10.251 exit # 3. æ‰§è¡Œè¿œç¨‹å‘½ä»¤æµ‹è¯• ssh root@10.10.10.251 \u0026#34;hostname \u0026amp;\u0026amp; date \u0026amp;\u0026amp; whoami\u0026#34; # 4. æ–‡ä»¶ä¼ è¾“æµ‹è¯• echo \u0026#34;æµ‹è¯•æ–‡ä»¶å†…å®¹\u0026#34; | ssh root@10.10.10.251 \u0026#34;cat \u0026gt; /tmp/ssh_test.txt\u0026#34; ğŸ”§ æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 # æ£€æŸ¥å…¬é’¥æ˜¯å¦æ­£ç¡®æ·»åŠ  ssh root@10.10.10.251 \u0026#34;cat ~/.ssh/authorized_keys\u0026#34; # æ£€æŸ¥æ–‡ä»¶æƒé™ ssh root@10.10.10.251 \u0026#34;ls -la ~/.ssh/\u0026#34; # æŸ¥çœ‹SSHè¿æ¥æ—¥å¿— ssh root@10.10.10.251 \u0026#34;tail -f /var/log/auth.log\u0026#34; ğŸ’¡ æœ€ä½³å®è·µä¸æŠ€å·§ ğŸ¯ è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 #!/bin/bash # *************************************************************** # File: auto_keypush.sh # Desc: å…äº¤äº’ç”Ÿæˆ SSH å¯†é’¥å¹¶æ‰¹é‡åˆ†å‘åˆ°å¤šå°ä¸»æœº # ä½¿ç”¨æ–¹æ³•: # chmod +x auto_keypush.sh # ./auto_keypush.sh 251 252 # *************************************************************** ############################ ç”¨æˆ·å¯è°ƒå˜é‡ ############################ USER=\u0026#34;root\u0026#34; # è¿œç¨‹ç™»å½•ç”¨æˆ· PASS=\u0026#34;Password\u0026#34; # è¿œç¨‹ç™»å½•å¯†ç  NET=\u0026#34;10.10.10\u0026#34; # ç½‘æ®µå‰ä¸‰æ®µ KEY_PATH=\u0026#34;/root/.ssh/id_rsa\u0026#34; # æœ¬æœºå¯†é’¥ä¿å­˜è·¯å¾„ ######################################################################## # 0. æ¬¢è¿è¯­ä¸ç”¨æ³•æç¤º cat \u0026lt;\u0026lt; EOF â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â•‘ æ¬¢è¿ä½¿ç”¨ SSH å¯†é’¥æ‰¹é‡åˆ†å‘å·¥å…· â•‘ â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â•‘ ä½œç”¨ï¼šä¸€é”®ç”Ÿæˆæœ¬åœ°å¯†é’¥å¹¶è‡ªåŠ¨åˆ†å‘åˆ°å¤šå°è¿œç¨‹ä¸»æœº â•‘ â•‘ ç”¨æ³•ï¼š./auto_keypush.sh \u0026lt;ä¸»æœºå·\u0026gt; [ä¸»æœºå·] ... â•‘ â•‘ ç¤ºä¾‹ï¼š./auto_keypush.sh 251 252 â•‘ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EOF [ $# -eq 0 ] \u0026amp;\u0026amp; { echo \u0026#34;ã€ERRORã€‘æœªæä¾›ä»»ä½•ä¸»æœºå·ï¼Œè„šæœ¬ç»ˆæ­¢ã€‚\u0026#34;; exit 1; } # 1. ç”Ÿæˆæœ¬æœºå¯†é’¥ï¼ˆå¦‚å·²å­˜åœ¨åˆ™è·³è¿‡ï¼‰ [ -f \u0026#34;$KEY_PATH\u0026#34; ] || { echo \u0026#34;ã€INFOã€‘æ­£åœ¨ç”Ÿæˆæœ¬åœ°å¯†é’¥ ...\u0026#34; mkdir -pm 700 \u0026#34;$(dirname \u0026#34;$KEY_PATH\u0026#34;)\u0026#34; ssh-keygen -f \u0026#34;$KEY_PATH\u0026#34; -N \u0026#39;\u0026#39; -q } # 2. è‡ªåŠ¨å®‰è£… sshpassï¼ˆæŒ‰ç³»ç»Ÿç±»å‹ï¼‰ if ! command -v sshpass \u0026amp;\u0026gt;/dev/null; then echo \u0026#34;ã€INFOã€‘æœªæ£€æµ‹åˆ° sshpassï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£… ...\u0026#34; if [ -f /etc/redhat-release ]; then yum makecache -y \u0026amp;\u0026amp; yum install -y sshpass elif [ -f /etc/debian_version ]; then apt update -y \u0026amp;\u0026amp; apt install -y sshpass elif [ -f /etc/alpine-release ]; then apk add --no-cache sshpass else echo \u0026#34;ã€ERRORã€‘æ— æ³•è¯†åˆ«ç³»ç»Ÿï¼Œè¯·æ‰‹åŠ¨å®‰è£… sshpass åå†æ‰§è¡Œè„šæœ¬\u0026#34; exit 1 fi fi # 3. å¾ªç¯æ¨é€å…¬é’¥ + åŠ¨æ€æ‰“å°æµ‹è¯•å‘½ä»¤ for SUFFIX in \u0026#34;$@\u0026#34;; do HOST=\u0026#34;${NET}.${SUFFIX}\u0026#34; echo \u0026#34;ã€INFOã€‘æ­£åœ¨æ¨é€å…¬é’¥åˆ° ${USER}@${HOST} ...\u0026#34; if sshpass -p\u0026#34;$PASS\u0026#34; ssh-copy-id -o StrictHostKeyChecking=no \\ -i \u0026#34;${KEY_PATH}.pub\u0026#34; \u0026#34;${USER}@${HOST}\u0026#34; \u0026amp;\u0026gt;/dev/null; then echo \u0026#34;ã€OK ã€‘${HOST} å®Œæˆ\u0026#34; # ---- åŠ¨æ€æ‰“å°æµ‹è¯•å‘½ä»¤ï¼ˆå«åˆ†å‰²çº¿ï¼‰ ---- printf \u0026#34;\\033[36m%s\\033[0m\\n\u0026#34; \u0026#34;------------------------------------------------\u0026#34; echo -e \u0026#34;\\033[32mã€TESTã€‘éªŒè¯å‘½ä»¤ï¼š ssh ${USER}@${HOST}\\033[0m\u0026#34; printf \u0026#34;\\033[36m%s\\033[0m\\n\u0026#34; \u0026#34;------------------------------------------------\u0026#34; else echo \u0026#34;ã€FAILã€‘${HOST} å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†ç æˆ–ç½‘ç»œ\u0026#34; fi done echo \u0026#34;ã€DONEã€‘å…¨éƒ¨ä»»åŠ¡ç»“æŸ\u0026#34; ğŸ”§ SSHé…ç½®ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç¼–è¾‘ ~/.ssh/config Host server-* User root Port 22 IdentityFile ~/.ssh/id_rsa ServerAliveInterval 60 ServerAliveCountMax 3 Host 10.10.10.251 HostName 10.10.10.251 User root Host 10.10.10.252 HostName 10.10.10.252 User admin ğŸ“Š æ‰¹é‡æ“ä½œæŠ€å·§ 1 2 3 4 5 # å¹¶è¡Œåˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ echo \u0026#34;10.10.10.251 10.10.10.252 10.10.10.253\u0026#34; | tr \u0026#39; \u0026#39; \u0026#39;\\n\u0026#39; | xargs -I{} -P 3 bash -c \u0026#39; echo \u0026#34;å¤„ç†: {}\u0026#34; sshpass -pYourpassword ssh-copy-id -o StrictHostKeyChecking=no root@{} \u0026#39; ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ”’ å¯†é’¥å®‰å…¨ 1 2 3 4 5 6 7 8 # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chmod 700 ~/.ssh chmod 600 ~/.ssh/id_rsa chmod 644 ~/.ssh/id_rsa.pub chmod 600 ~/.ssh/authorized_keys # å®šæœŸæ£€æŸ¥æƒé™ ls -l ~/.ssh/ ğŸš¨ ç”Ÿäº§ç¯å¢ƒå®‰å…¨å»ºè®® å¯†ç å®‰å…¨ï¼š\nâŒ é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç  âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥æ–‡ä»¶ âœ… è€ƒè™‘ä½¿ç”¨SSHä»£ç†æˆ–è¯ä¹¦è®¤è¯ æœåŠ¡å™¨é…ç½®ï¼š\n1 2 3 4 5 # ç¦ç”¨å¯†ç è®¤è¯ï¼ˆé…ç½®åï¼‰ # åœ¨ /etc/ssh/sshd_config ä¸­è®¾ç½®ï¼š PasswordAuthentication no PubkeyAuthentication yes PermitRootLogin without-password ç›‘æ§ä¸å®¡è®¡ï¼š\n1 2 3 4 5 # ç›‘æ§SSHç™»å½• tail -f /var/log/auth.log | grep ssh # æ£€æŸ¥ authorized_keys æ–‡ä»¶ find /home -name authorized_keys -exec ls -la {} \\; ğŸ”„ å¯†é’¥è½®æ¢ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 # 1. ç”Ÿæˆæ–°å¯†é’¥å¯¹ ssh-keygen -f ~/.ssh/id_rsa_new -N \u0026#39;\u0026#39; # 2. åˆ†å‘æ–°å…¬é’¥ sshpass -pPassword ssh-copy-id -i ~/.ssh/id_rsa_new.pub root@10.10.10.251 # 3. æµ‹è¯•æ–°å¯†é’¥ ssh -i ~/.ssh/id_rsa_new root@10.10.10.251 # 4. æ›¿æ¢æ—§å¯†é’¥ mv ~/.ssh/id_rsa_new ~/.ssh/id_rsa mv ~/.ssh/id_rsa_new.pub ~/.ssh/id_rsa.pub æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æŒæ¡äº†ï¼šâœ¨\nâœ… SSHå¯†é’¥å¯¹çš„åŸç†å’Œä¼˜åŠ¿ âœ… å…äº¤äº’ç”Ÿæˆå¯†é’¥å¯¹çš„è‡ªåŠ¨åŒ–æ–¹æ³• âœ… sshpasså·¥å…·çš„å®‰è£…å’Œä½¿ç”¨æŠ€å·§ âœ… å®‰å…¨çš„å…¬é’¥åˆ†å‘æµç¨‹ âœ… å…¨é¢çš„è¿æ¥æµ‹è¯•æ–¹æ¡ˆ âœ… ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µå’Œå®‰å…¨å»ºè®® ğŸ‰ ç°åœ¨æ‚¨å¯ä»¥ confidently ä½¿ç”¨SSHå¯†é’¥å¯¹æ¥å®‰å…¨é«˜æ•ˆåœ°ç®¡ç†æ‚¨çš„æœåŠ¡å™¨äº†ï¼\nğŸ’¡ æç¤ºï¼šåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ç»“åˆç½‘ç»œé˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå’Œå®šæœŸå®‰å…¨å®¡è®¡ï¼Œæ„å»ºå¤šå±‚æ¬¡çš„é˜²å¾¡ä½“ç³»ã€‚\n","date":"2025-09-09T12:17:08+08:00","image":"https://file.meimolihan.eu.org/img/ed25519-rsa-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a88b9e2e/","title":"Linux ä¸­ SSH å¯†é’¥å¯¹åˆ›å»ºä¸åˆ†å‘æŒ‡å— ğŸ”"},{"content":"å¸¸ç”¨ Rsync åŒæ­¥å‘½ä»¤è¯¦è§£ ğŸ“ Rsync ä¸­æºè·¯å¾„å’Œç›®æ ‡è·¯å¾„æœ«å°¾æ˜¯å¦æ·»åŠ æ–œæ  /ï¼Œå…¶è¡Œä¸ºå®Œå…¨ä¸åŒã€‚ç†è§£è¿™ä¸€ç‚¹å¯¹æ­£ç¡®åŒæ­¥æ•°æ®è‡³å…³é‡è¦ï¼Œæ— è®ºæ˜¯æœ¬åœ°è¿˜æ˜¯è¿œç¨‹åŒæ­¥ã€‚\nğŸ“š ç›®å½•å¯¼èˆª âœ¨ Rsync ç®€ä»‹ä¸ç‰¹ç‚¹ ğŸ” æ ¸å¿ƒæ¦‚å¿µï¼šè·¯å¾„æ–œæ çš„ä½œç”¨ ğŸŸ¢ åŒæ­¥ç›®å½•æœ¬èº«ï¼ˆæ¨èç”¨æ³•ï¼‰ æœ¬åœ°åŒæ­¥å‘½ä»¤ è¿œç¨‹åŒæ­¥å‘½ä»¤ ğŸ”„ é•œåƒåŒæ­¥å†…å®¹ï¼ˆæ ‡å‡†ç”¨æ³•ï¼‰ æœ¬åœ°åŒæ­¥å‘½ä»¤ è¿œç¨‹åŒæ­¥å‘½ä»¤ âœ¨ é•œåƒåŒæ­¥ï¼ˆè‡ªåŠ¨åˆ›å»ºè·¯å¾„ï¼‰ æœ¬åœ°åŒæ­¥å‘½ä»¤ è¿œç¨‹åŒæ­¥å‘½ä»¤ ğŸŒ è¿œç¨‹åŒæ­¥è¯¦è§£ ğŸ†š å‘½ä»¤å¯¹æ¯”åˆ†æ ğŸ’¡ ä½¿ç”¨åœºæ™¯å»ºè®® âš ï¸ é‡è¦æé†’ âœ¨ Rsync ç®€ä»‹ä¸ç‰¹ç‚¹ Rsyncï¼ˆRemote Synchronizationï¼‰æ˜¯ä¸€æ¬¾å¼ºå¤§çš„æ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œå¹¿æ³›ç”¨äºæœ¬åœ°å’Œè¿œç¨‹æ•°æ®å¤‡ä»½ä¸é•œåƒã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼š\né«˜æ•ˆä¼ è¾“ ğŸ”„ï¼šä»…åŒæ­¥å˜åŒ–çš„æ–‡ä»¶éƒ¨åˆ†ï¼Œå¤§å¹…èŠ‚çœå¸¦å®½å’Œæ—¶é—´ ä¿æŒæƒé™ ğŸ“ï¼šå®Œç¾ä¿ç•™æ–‡ä»¶å±æ€§ã€æƒé™å’Œæ—¶é—´æˆ³ çµæ´»è¿‡æ»¤ ğŸ”ï¼šæ”¯æŒæŒ‰åç§°ã€å¤§å°ç­‰æ¡ä»¶æ’é™¤æˆ–åŒ…å«æ–‡ä»¶ å¤šç§ä¼ è¾“æ¨¡å¼ ğŸŒï¼šæ”¯æŒæœ¬åœ°ã€è¿œç¨‹ï¼ˆSSHï¼‰ã€å®ˆæŠ¤è¿›ç¨‹ç­‰å¤šç§æ–¹å¼ ğŸ” æ ¸å¿ƒæ¦‚å¿µï¼šè·¯å¾„æ–œæ çš„ä½œç”¨ ç†è§£æºè·¯å¾„å’Œç›®æ ‡è·¯å¾„æœ«å°¾æ–œæ çš„åŒºåˆ«æ˜¯æŒæ¡ rsync çš„å…³é”®ï¼š\næºè·¯å¾„æ–œæ è§„åˆ™ï¼š æœ‰æ–œæ  (path/to/source/) â†’ åŒæ­¥æºç›®å½•çš„å†…å®¹ æ— æ–œæ  (path/to/source) â†’ åŒæ­¥æºç›®å½•æœ¬èº«åŠå…¶å†…å®¹ ç›®æ ‡è·¯å¾„æ–œæ è§„åˆ™ï¼š æœ‰æ–œæ  (path/to/destination/) â†’ æç¤ºç›®æ ‡æ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„ç›®å½• æ— æ–œæ  (path/to/destination) â†’ å¯èƒ½åˆ›å»ºç›®å½•æˆ–æ–‡ä»¶ âœ¨ é»„é‡‘æ³•åˆ™ï¼š\næºè·¯å¾„æœ‰æ— æ–œæ ï¼Ÿ â†’ å†³å®šåŒæ­¥ä»€ä¹ˆï¼ˆæ˜¯ç›®å½•æœ¬èº«è¿˜æ˜¯å…¶å†…å®¹ï¼‰ã€‚ ç›®æ ‡è·¯å¾„æœ‰æ— æ–œæ ï¼Ÿ â†’ æç¤ºç›®å½•æ˜¯å¦å­˜åœ¨ï¼ˆæˆ–ä½¿ç”¨ --mkpath è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚ ğŸŸ¢ åŒæ­¥ç›®å½•æœ¬èº«ï¼ˆæ¨èç”¨æ³•ï¼‰ æœ¬åœ°åŒæ­¥å‘½ä»¤ï¼š 1 rsync -avhz --progress --delete-delay /vol1/1000/compose/aipan /mnt/test/ -aï¼ˆarchiveæ¨¡å¼ï¼‰ï¼šåŒ…å«é€’å½’åŒæ­¥ã€ä¿ç•™æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼Œä¼šè‡ªåŠ¨åŒ…å«éšè—æ–‡ä»¶ -vï¼šæ˜¾ç¤ºè¯¦ç»†è¾“å‡º -hï¼šäººç±»å¯è¯»çš„æ ¼å¼è¾“å‡º -zï¼šå‹ç¼©ä¼ è¾“æ•°æ® --progressï¼šæ˜¾ç¤ºåŒæ­¥è¿›åº¦ --delete-delayï¼šåœ¨ä¼ è¾“å®Œæˆååˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶ æºç›®å½•å°¾éƒ¨æ²¡æœ‰ / è¡¨ç¤º ä¼šåœ¨ç›®æ ‡ä½ç½®åˆ›å»ºä¸€ä¸ªåä¸º \u0026ldquo;aipan\u0026rdquo; çš„ç›®å½• æºç›®å½•çš„æ‰€æœ‰å†…å®¹ä¼šè¢«å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®çš„ \u0026ldquo;aipan\u0026rdquo; ç›®å½•ä¸­ ä¾‹å¦‚ï¼š/vol1/1000/compose/aipan â†’ /ç›®æ ‡è·¯å¾„/mnt/test/aipan è¿œç¨‹åŒæ­¥å‘½ä»¤ï¼š 1 2 3 4 5 # é€šè¿‡å¯†é’¥æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ— éœ€è¾“å…¥å¯†ç ã€‚ rsync -avhz --progress --delete-delay -e \u0026#39;ssh -p 22 -i ~/.ssh/Debian13_SSH\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/ # é€šè¿‡å¯†ç è¿æ¥æœåŠ¡å™¨ï¼Œé…ç½®å¥½å¯†é’¥å¯¹ï¼Œè€…ä¸éœ€è¦å¯†ç å°±å¯ä»¥è¿æ¥ã€‚ rsync -avhz --progress --delete-delay -e \u0026#39;ssh -p 22\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/ è¡Œä¸ºï¼š å°† aipan ç›®å½•æœ¬èº«ï¼ˆåŒ…æ‹¬å…¶æ‰€æœ‰å†…å®¹ï¼‰å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ä¸­ ç›®æ ‡è·¯å¾„æœ«å°¾æ— æ–œæ è¡¨ç¤ºå°†åˆ›å»ºåŒåç›®å½• ç»“æœç›®å½•ç»“æ„ï¼š 1 2 3 4 5 /mnt/test/ \u0026lt;-- å¿…é¡»å·²å­˜åœ¨ï¼ â””â”€â”€ aipan/ \u0026lt;-- åˆ›å»ºçš„ç›®å½•å‰¯æœ¬ â”œâ”€â”€ file1.txt â”œâ”€â”€ dir1/ â””â”€â”€ ... ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š å½“ä½ æƒ³è¦åœ¨ç›®æ ‡ä½ç½®åˆ›å»ºä¸€ä¸ªä¸æºç›®å½•åŒåçš„å®Œæ•´å‰¯æœ¬æ—¶ã€‚\nğŸ”„ é•œåƒåŒæ­¥å†…å®¹ï¼ˆæ ‡å‡†ç”¨æ³•ï¼‰ æœ¬åœ°åŒæ­¥å‘½ä»¤ï¼š 1 rsync -avhz --progress --delete-delay /vol1/1000/compose/aipan/ /mnt/test/aipan/ -aï¼ˆarchiveæ¨¡å¼ï¼‰ï¼šåŒ…å«é€’å½’åŒæ­¥ã€ä¿ç•™æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼Œä¼šè‡ªåŠ¨åŒ…å«éšè—æ–‡ä»¶ -vï¼šæ˜¾ç¤ºè¯¦ç»†è¾“å‡º -hï¼šäººç±»å¯è¯»çš„æ ¼å¼è¾“å‡º -zï¼šå‹ç¼©ä¼ è¾“æ•°æ® --progressï¼šæ˜¾ç¤ºåŒæ­¥è¿›åº¦ --delete-delayï¼šåœ¨ä¼ è¾“å®Œæˆååˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶ æºç›®å½•å°¾éƒ¨æœ‰çš„ / è¡¨ç¤º ä¸ä¼šåœ¨ç›®æ ‡ä½ç½®åˆ›å»º \u0026ldquo;aipan\u0026rdquo; ç›®å½• æºç›®å½•çš„å†…å®¹ç›´æ¥å¤åˆ¶åˆ°ç›®æ ‡ä½ç½® ä¾‹å¦‚ï¼š/vol1/1000/compose/aipan/xxx.conf â†’ /mnt/test/aipan/xxx.conf è¿œç¨‹åŒæ­¥å‘½ä»¤ï¼š 1 2 3 4 5 # é€šè¿‡å¯†é’¥æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ— éœ€è¾“å…¥å¯†ç ã€‚ rsync -avhz --progress --delete-delay -e \u0026#39;ssh -p 22 -i ~/.ssh/Debian13_SSH\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/aipan/ # é€šè¿‡å¯†ç è¿æ¥æœåŠ¡å™¨ï¼Œé…ç½®å¥½å¯†é’¥å¯¹ï¼Œè€…ä¸éœ€è¦å¯†ç å°±å¯ä»¥è¿æ¥ã€‚ rsync -avhz --progress --delete-delay -e \u0026#39;ssh -p 22\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/aipan/ è¡Œä¸ºï¼š åªåŒæ­¥ aipan/ ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ˆæ–‡ä»¶å’Œå­ç›®å½•ï¼‰ ç›®æ ‡è·¯å¾„æœ«å°¾çš„ / å¼ºçƒˆæš—ç¤ºç›®æ ‡ç›®å½•å·²å­˜åœ¨ ç»“æœç›®å½•ç»“æ„ï¼š 1 2 3 4 /mnt/test/aipan/ \u0026lt;-- å¿…é¡»å·²å­˜åœ¨ï¼ â”œâ”€â”€ file1.txt \u0026lt;-- æºç›®å½•çš„å†…å®¹ç›´æ¥æ”¾åœ¨è¿™é‡Œ â”œâ”€â”€ dir1/ â””â”€â”€ ... ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š è®©ä¸¤ä¸ªç›®å½•çš„å†…å®¹ä¿æŒå®Œå…¨ä¸€è‡´ï¼ˆé•œåƒï¼‰ã€‚è¿™æ˜¯æœ€å¸¸ç”¨ã€æœ€æ ‡å‡†çš„ç”¨æ³•ã€‚\nâœ¨ é•œåƒåŒæ­¥ï¼ˆè‡ªåŠ¨åˆ›å»ºè·¯å¾„ï¼‰ æœ¬åœ°åŒæ­¥å‘½ä»¤ï¼š 1 rsync -avhz --progress --delete-delay --mkpath /vol1/1000/compose/aipan/ /mnt/test/aipan/ -aï¼ˆarchiveæ¨¡å¼ï¼‰ï¼šåŒ…å«é€’å½’åŒæ­¥ã€ä¿ç•™æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼Œä¼šè‡ªåŠ¨åŒ…å«éšè—æ–‡ä»¶ -vï¼šæ˜¾ç¤ºè¯¦ç»†è¾“å‡º -hï¼šäººç±»å¯è¯»çš„æ ¼å¼è¾“å‡º -zï¼šå‹ç¼©ä¼ è¾“æ•°æ® --progressï¼šæ˜¾ç¤ºåŒæ­¥è¿›åº¦ --delete-delayï¼šåœ¨ä¼ è¾“å®Œæˆååˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶ --mkpath å®ƒå…è®¸è‡ªåŠ¨åˆ›å»ºç›®æ ‡è·¯å¾„ä¸­ä¸å­˜åœ¨çš„çˆ¶ç›®å½• æºç›®å½•å°¾éƒ¨æœ‰çš„ / è¡¨ç¤º ä¸ä¼šåœ¨ç›®æ ‡ä½ç½®åˆ›å»º \u0026ldquo;aipan\u0026rdquo; ç›®å½• æºç›®å½•çš„å†…å®¹ç›´æ¥å¤åˆ¶åˆ°ç›®æ ‡ä½ç½® ä¾‹å¦‚ï¼š/vol1/1000/compose/aipan/xxx.conf â†’ /mnt/test/aipan/xxx.conf è¿œç¨‹åŒæ­¥å‘½ä»¤ï¼š 1 2 3 4 5 # é€šè¿‡å¯†é’¥æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ— éœ€è¾“å…¥å¯†ç ã€‚ rsync -avhz --progress --delete-delay --mkpath -e \u0026#39;ssh -p 22 -i ~/.ssh/Debian13_SSH\u0026#39; /vol1/1000/compose/aipan/ 10.10.10.246:/mnt/test/aipan/ # é€šè¿‡å¯†ç è¿æ¥æœåŠ¡å™¨ï¼Œé…ç½®å¥½å¯†é’¥å¯¹ï¼Œè€…ä¸éœ€è¦å¯†ç å°±å¯ä»¥è¿æ¥ã€‚ rsync -avhz --progress --delete-delay --mkpath -e \u0026#39;ssh -p 22\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/aipan/ è¡Œä¸ºï¼š è¡Œä¸ºä¸é•œåƒåŒæ­¥å®Œå…¨ä¸€è‡´ï¼ŒåŒæ­¥ aipan/ ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ --mkpath é€‰é¡¹æ˜¯ rsync 3.2.3 ä¹‹ååŠ å…¥çš„æ–°åŠŸèƒ½ï¼Œå®ƒå…è®¸è‡ªåŠ¨åˆ›å»ºç›®æ ‡è·¯å¾„ä¸­ä¸å­˜åœ¨çš„çˆ¶ç›®å½• ç»“æœç›®å½•ç»“æ„ï¼š 1 2 3 4 /mnt/test/aipan/ \u0026lt;-- å³ä½¿ä¸å­˜åœ¨ä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºï¼ â”œâ”€â”€ file1.txt â”œâ”€â”€ dir1/ â””â”€â”€ ... ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š å¸Œæœ›è¡Œä¸ºä¸é•œåƒåŒæ­¥ä¸€è‡´ï¼Œä½†ä¸æƒ³æ‰‹åŠ¨åˆ›å»ºç›®æ ‡ç›®å½•æ—¶ã€‚éå¸¸æ–¹ä¾¿çš„æ–°ç‰¹æ€§ã€‚\nğŸŒ è¿œç¨‹åŒæ­¥è¯¦è§£ SSH ç›¸å…³å‚æ•°ï¼š -e 'ssh -p 2222'ï¼šä½¿ç”¨ SSH ä¸”æŒ‡å®šç«¯å£ 2222 -zï¼šå‹ç¼©ä¼ è¾“æ•°æ®ï¼ŒèŠ‚çœå¸¦å®½ root@10.10.10.246:ï¼šè¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·åå’Œåœ°å€ ğŸ”§ é¢å¤–å»ºè®®ï¼š ä½¿ç”¨ SSH å¯†é’¥è®¤è¯ï¼š\n1 2 3 4 5 # ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆå¦‚æœå°šæœªç”Ÿæˆï¼‰ ssh-keygen -t rsa # å°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ ssh-copy-id -p 2222 root@10.10.10.246 å¸¦å®½é™åˆ¶ï¼ˆé€‚ç”¨äºæ…¢é€Ÿè¿æ¥ï¼‰ï¼š\n1 rsync -avhz --bwlimit=1000 -e \u0026#39;ssh -p 2222\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/aipan/ ç½‘ç»œç¨³å®šæ€§ï¼š\nå¯¹äºå¤§æ–‡ä»¶ä¼ è¾“ï¼Œè€ƒè™‘ä½¿ç”¨ --partial æ”¯æŒæ–­ç‚¹ç»­ä¼  1 rsync -avhz --partial --progress -e \u0026#39;ssh -p 2222\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/aipan/ ğŸ†š å‘½ä»¤å¯¹æ¯”åˆ†æ ç‰¹æ€§ åŒæ­¥ç›®å½•æœ¬èº« é•œåƒåŒæ­¥å†…å®¹ è‡ªåŠ¨åˆ›å»ºè·¯å¾„åŒæ­¥ åŒæ­¥å¯¹è±¡ ç›®å½•æœ¬èº« + å†…å®¹ ä»…ç›®å½•å†…å®¹ ä»…ç›®å½•å†…å®¹ æºè·¯å¾„ æ— æœ«å°¾æ–œæ  æœ‰æœ«å°¾æ–œæ  æœ‰æœ«å°¾æ–œæ  ç›®æ ‡è¦æ±‚ çˆ¶ç›®å½•å¿…é¡»å­˜åœ¨ ç›®æ ‡ç›®å½•å¿…é¡»å­˜åœ¨ è‡ªåŠ¨åˆ›å»ºè·¯å¾„ ç»“æœç»“æ„ åˆ›å»ºåµŒå¥—ç›®å½• å†…å®¹ç›´æ¥æ”¾å…¥ å†…å®¹ç›´æ¥æ”¾å…¥ é€‚ç”¨åœºæ™¯ å¤‡ä»½æ•´ä¸ªç›®å½•ç»“æ„ é•œåƒåŒæ­¥å·²æœ‰ç›®å½• é•œåƒåŒæ­¥å¹¶è‡ªåŠ¨åˆ›å»ºè·¯å¾„ ğŸ’¡ ä½¿ç”¨åœºæ™¯å»ºè®® 1. é€‰æ‹©åŒæ­¥ç›®å½•æœ¬èº«å½“ï¼š æƒ³è¦åœ¨ç›®æ ‡ä½ç½®ä¿ç•™å®Œæ•´çš„ç›®å½•ç»“æ„ ç›®æ ‡ä½ç½®å·²æœ‰çˆ¶ç›®å½•ï¼ˆå¦‚ /mnt/test/ï¼‰ éœ€è¦å°†æ•´ä¸ªç›®å½•å¤‡ä»½åˆ°ç›®æ ‡ä½ç½® 2. é€‰æ‹©é•œåƒåŒæ­¥å½“ï¼š åªæƒ³åŒæ­¥ç›®å½•å†…å®¹ï¼ˆæœ€å¸¸ç”¨ï¼‰ ç¡®ä¿ç›®æ ‡ç›®å½•å·²æå‰åˆ›å»º éœ€è¦ä¿æŒä¸¤ä¸ªç›®å½•å†…å®¹å®Œå…¨ä¸€è‡´ 3. é€‰æ‹©è‡ªåŠ¨åˆ›å»ºè·¯å¾„åŒæ­¥å½“ï¼š ä¸ç¡®å®šç›®æ ‡è·¯å¾„æ˜¯å¦å­˜åœ¨ å¸Œæœ›è‡ªåŠ¨åŒ–åˆ›å»ºç›®å½•ç»“æ„ éœ€è¦æœ€ä¾¿æ·çš„é•œåƒåŒæ­¥æ–¹æ¡ˆ ğŸ”§ é€šç”¨å»ºè®®ï¼š é¦–æ¬¡è¿è¡Œå‰æµ‹è¯•ï¼š\n1 2 3 rsync -avhz --dry-run /vol1/1000/compose/aipan/ /mnt/test/aipan/ # æˆ–è¿œç¨‹ rsync -avhz --dry-run -e \u0026#39;ssh -p 2222\u0026#39; /vol1/1000/compose/aipan/ root@10.10.10.246:/mnt/test/aipan/ æ—¥å¿—è®°å½•ï¼š\nå¯¹äºå®šæœŸåŒæ­¥ä»»åŠ¡ï¼Œå»ºè®®è®°å½•åŒæ­¥æ—¥å¿— 1 rsync -avhz --progress /vol1/1000/compose/aipan/ /mnt/test/aipan/ \u0026gt;\u0026gt; /var/log/rsync.log 2\u0026gt;\u0026amp;1 âš ï¸ é‡è¦æé†’ æƒé™é—®é¢˜ï¼š\nç¡®ä¿æ‚¨æœ‰æƒé™è¯»å–æºç›®å½• ç¡®ä¿ç›®æ ‡ç›®å½•æœ‰å†™å…¥æƒé™ åˆ é™¤æ“ä½œè°¨æ…ä½¿ç”¨ï¼š\n--delete-delay æˆ– --delete é€‰é¡¹ä¼šåˆ é™¤ç›®æ ‡ç«¯å¤šä½™çš„æ–‡ä»¶ï¼Œé¦–æ¬¡åŒæ­¥æˆ–ä¸ç¡®å®šæ—¶è¯·å…ˆä½¿ç”¨ --dry-run æ¨¡æ‹Ÿè¿è¡Œï¼Œä»¥å…æ•°æ®ä¸¢å¤±ï¼ ç‰ˆæœ¬å…¼å®¹æ€§ï¼š\n--mkpath é€‰é¡¹éœ€è¦ rsync 3.2.3 æˆ–æ›´é«˜ç‰ˆæœ¬ ä½¿ç”¨å‰è¯·æ£€æŸ¥ç‰ˆæœ¬ï¼šrsync --version ç½‘ç»œæ³¨æ„äº‹é¡¹ï¼š\nè¿œç¨‹åŒæ­¥æ—¶ç¡®ä¿é˜²ç«å¢™å…è®¸æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ 22 æˆ–è‡ªå®šä¹‰ç«¯å£ï¼‰ è€ƒè™‘ä½¿ç”¨ --timeout è®¾ç½®è¶…æ—¶æ—¶é—´é¿å…é•¿æ—¶é—´æŒ‚èµ· âœ¨ æœ€ä½³å®è·µæç¤ºï¼š\nå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå§‹ç»ˆå…ˆç”¨ --dry-run æµ‹è¯• å®šæœŸæ£€æŸ¥åŒæ­¥æ—¥å¿—ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ å¯¹äºé‡è¦æ•°æ®ï¼Œå®æ–½åŒå‘éªŒè¯æœºåˆ¶ è€ƒè™‘ä½¿ç”¨ --backup å’Œ --backup-dir é€‰é¡¹ä¿ç•™è¢«åˆ é™¤æ–‡ä»¶çš„å¤‡ä»½ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„ rsync å‘½ä»¤æ ¼å¼ï¼Œæ— è®ºæ˜¯æœ¬åœ°åŒæ­¥è¿˜æ˜¯è¿œç¨‹åŒæ­¥ã€‚è®°ä½å§‹ç»ˆå…ˆæµ‹è¯•å†æ‰§è¡Œï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼\n","date":"2025-09-09T09:43:28+08:00","image":"https://file.meimolihan.eu.org/img/rsync-01.webp","permalink":"https://blog.meimolihan.eu.org/p/684c0a58/","title":"å¸¸ç”¨ Rsync åŒæ­¥å‘½ä»¤è¯¦è§£ ğŸ“"},{"content":"TMDB Hosts è‡ªåŠ¨æ›´æ–°ä¸åŒæ­¥ DnsParse è„šæœ¬ \u0026amp; è¿œç¨‹ç‰ˆ ğŸŒŸ æœ¬æ–‡ä»‹ç»ä¸€å¥—ç”¨äºè‡ªåŠ¨æ›´æ–° TMDB ç›¸å…³åŸŸåçš„ DNS è§£æè®°å½•ï¼Œå¹¶å°†å…¶åŒæ­¥åˆ°å¸¸ç”¨åª’ä½“æœåŠ¡ï¼ˆå¦‚ Embyã€Nastoolsï¼‰çš„è„šæœ¬å·¥å…·é›†ã€‚æ‰€æœ‰è„šæœ¬å‡é…å¤‡å®Œæ•´çš„æ—¥å¿—è®°å½•ä¸é”™è¯¯å¤„ç†åŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡è®¡åˆ’ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œã€‚\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ è„šæœ¬ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ å®‰è£… Python3 ğŸ”§ DnsParse.py è¯¦è§£ ğŸ”„ nastools-sync-hosts.sh è¯¦è§£ ğŸ”„ emby-sync-hosts.sh è¯¦è§£ â° è®¡åˆ’ä»»åŠ¡è®¾ç½® ğŸ“‹ æŸ¥çœ‹åŒæ­¥æ—¥å¿— âœ¨ è„šæœ¬ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸŒ å¤š DNS æä¾›å•†æ”¯æŒï¼šä½¿ç”¨å¤šä¸ªå…¬å…± DNS è§£ææœåŠ¡è·å–æœ€æ–°çš„ IP åœ°å€ï¼Œæé«˜è§£ææˆåŠŸç‡ã€‚ ğŸ“ æ™ºèƒ½ IP ç­›é€‰ï¼šè‡ªåŠ¨ Ping æµ‹è¯•æ‰€æœ‰è§£æåˆ°çš„ IPï¼Œä»…ä¿ç•™å¯è¿é€šçš„é«˜è´¨é‡ IPã€‚ ğŸ’¾ æ— æŸæ›´æ–° Hostsï¼šé‡‡ç”¨æ ‡è®°å—ï¼ˆ###start### ä¸ ###end###ï¼‰æ–¹å¼æ›´æ–°ï¼Œä¿ç•™åŸæœ‰ hosts å†…å®¹ã€‚ ğŸ“‚ å¤šæœåŠ¡åŒæ­¥ï¼šæ”¯æŒå°†æ›´æ–°åçš„ hosts æ–‡ä»¶è‡ªåŠ¨åŒæ­¥åˆ° Emby å’Œ Nastools çš„ Docker é…ç½®ç›®å½•ã€‚ ğŸ“ è¯¦ç»†æ—¥å¿—è®°å½•ï¼šæ‰€æœ‰æ“ä½œå‡æœ‰è¯¦ç»†çš„ä¸­æ–‡æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ä¸æŸ¥çœ‹æ‰§è¡ŒçŠ¶æ€ã€‚ â° è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šæä¾›ä¸€é”®æ‰§è¡Œå‘½ä»¤ä¸ crontab è®¡åˆ’ä»»åŠ¡é…ç½®ï¼Œå®ç°å®Œå…¨è‡ªåŠ¨åŒ–ã€‚ ğŸ å®‰è£… Python3 1 2 sudo apt update \u0026amp;\u0026amp; sudo apt install python3 -y \u0026amp;\u0026amp; \\ python3 --version ğŸ”§ DnsParse.py è¯¦è§£ è¯¥è„šæœ¬é€šè¿‡ DNS è§£æè·å–æŒ‡å®šåŸŸåï¼ˆapi.themoviedb.org, image.tmdb.org, www.themoviedb.orgï¼‰çš„ IP åœ°å€ï¼Œæµ‹è¯•å®ƒä»¬çš„è¿é€šæ€§ï¼Œå¹¶å°†å¯ç”¨çš„ IP åœ°å€å†™å…¥ç³»ç»Ÿ hosts æ–‡ä»¶ï¼ˆ/etc/hostsï¼‰ä»¥ä¼˜åŒ–è®¿é—®é€Ÿåº¦ã€‚\nä¸€é”®æ‰§è¡Œå‘½ä»¤ 1 2 3 4 5 # ä»ä¸»ç«™ç‚¹ä¸‹è½½æ‰§è¡Œ curl -sL script.meimolihan.eu.org/hosts/DnsParse.py | python3 - # æˆ–ä» Gitee é•œåƒä¸‹è½½æ‰§è¡Œ curl -sL gitee.com/meimolihan/script/raw/master/hosts/DnsParse.py | python3 - éªŒè¯æ›´æ–°ç»“æœ 1 cat /etc/hosts ğŸ”„ nastools-sync-hosts.sh è¯¦è§£ æ­¤è„šæœ¬ç”¨äºå°†ç³»ç»Ÿçš„ hosts æ–‡ä»¶ï¼ˆ/etc/hostsï¼‰è‡ªåŠ¨åŒæ­¥åˆ° Nastools é…ç½®ç›®å½•ï¼ˆ/vol1/1000/compose/nastools/config/hostsï¼‰ï¼Œå¹¶è®°å½•è¯¦ç»†çš„ä¸­æ–‡æ—¥å¿—ã€‚\nä¸€é”®æ‰§è¡Œå‘½ä»¤ 1 2 3 4 5 # ä»ä¸»ç«™ç‚¹ä¸‹è½½æ‰§è¡Œ bash \u0026lt;(curl -sL script.meimolihan.eu.org/hosts/nastools-sync-hosts.sh) # æˆ–ä» Gitee é•œåƒä¸‹è½½æ‰§è¡Œ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/hosts/nastools-sync-hosts.sh) éªŒè¯åŒæ­¥ç»“æœ 1 cat /vol1/1000/compose/nastools/config/hosts ğŸ”„ emby-sync-hosts.sh è¯¦è§£ æ­¤è„šæœ¬ç”¨äºå°†ç³»ç»Ÿçš„ hosts æ–‡ä»¶ï¼ˆ/etc/hostsï¼‰è‡ªåŠ¨åŒæ­¥åˆ° Emby é…ç½®ç›®å½•ï¼ˆ/vol1/1000/compose/emby/config/hostsï¼‰ï¼Œå¹¶è®°å½•è¯¦ç»†çš„ä¸­æ–‡æ—¥å¿—ã€‚\nä¸€é”®æ‰§è¡Œå‘½ä»¤ 1 2 3 4 5 # ä»ä¸»ç«™ç‚¹ä¸‹è½½æ‰§è¡Œ bash \u0026lt;(curl -sL script.meimolihan.eu.org/hosts/emby-sync-hosts.sh) # æˆ–ä» Gitee é•œåƒä¸‹è½½æ‰§è¡Œ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/hosts/emby-sync-hosts.sh) éªŒè¯åŒæ­¥ç»“æœ 1 cat /vol1/1000/compose/emby/config/hosts â° è®¡åˆ’ä»»åŠ¡è®¾ç½® ä»¥ä¸‹ crontab é…ç½®å¯å®ç°æ¯å¤©è‡ªåŠ¨æ›´æ–° hosts å¹¶åŒæ­¥åˆ°ç›¸å…³æœåŠ¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºæˆ–æ›´æ–°è®¡åˆ’ä»»åŠ¡ cat \u0026gt; /var/spool/cron/crontabs/$USER \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # æ·»åŠ æ›´æ–°hostsæ–‡ä»¶å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹ååˆ†æ‰§è¡Œï¼ˆæ—¥å¿—ï¼štmdb-hosts.logï¼‰ 10 1 * * * curl -sL gitee.com/meimolihan/script/raw/master/hosts/DnsParse.py | python3 - \u0026gt;\u0026gt; /var/log/cron-tasks/tmdb-hosts.log 2\u0026gt;\u0026amp;1 # hostsæ–‡ä»¶-åŒæ­¥åˆ° embyï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹åäº”åˆ†æ‰§è¡Œï¼ˆæ—¥å¿—ï¼šemby-hosts.logï¼‰ 15 1 * * * bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/hosts/emby-sync-hosts.sh) # hostsæ–‡ä»¶-åŒæ­¥åˆ° nastoolsï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹äºŒååˆ†æ‰§è¡Œï¼ˆæ—¥å¿—ï¼šnastools-hosts.logï¼‰ 20 1 * * * bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/hosts/nastools-sync-hosts.sh) EOF # åº”ç”¨è®¡åˆ’ä»»åŠ¡ crontab /var/spool/cron/crontabs/$USER # æŸ¥çœ‹å·²è®¾ç½®çš„è®¡åˆ’ä»»åŠ¡ crontab -l ğŸ“‹ æŸ¥çœ‹åŒæ­¥æ—¥å¿— æ‰€æœ‰åŒæ­¥æ“ä½œå‡æœ‰è¯¦ç»†æ—¥å¿—è®°å½•ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹ nastools åŒæ­¥æ—¥å¿— cat /var/log/cron-tasks/nastools-hosts.log # æŸ¥çœ‹ emby åŒæ­¥æ—¥å¿— cat /var/log/cron-tasks/emby-hosts.log # æŸ¥çœ‹ DNS è§£ææ›´æ–°æ—¥å¿— cat /var/log/cron-tasks/tmdb-hosts.log ğŸ’¡ æç¤ºï¼šç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼Œå¹¶ä¸”ç›¸å…³ç›®å½•å­˜åœ¨ã€‚é¦–æ¬¡è¿è¡Œå‰å¯æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚\n","date":"2025-09-08T04:18:33+08:00","image":"https://file.meimolihan.eu.org/img/tmdb-01.webp","permalink":"https://blog.meimolihan.eu.org/p/efca2647/","title":"TMDB Hosts è‡ªåŠ¨æ›´æ–°ä¸åŒæ­¥ DnsParse è„šæœ¬ \u0026 è¿œç¨‹ç‰ˆ ğŸŒŸ"},{"content":"Proxmox VE è™šæ‹Ÿæœºæ“ä½œä¸å®šæ—¶ä»»åŠ¡ç®¡ç† â° ğŸ”§ æŒæ¡ Proxmox VE è™šæ‹Ÿæœºçš„åŸºæœ¬æ“ä½œå‘½ä»¤å’Œè‡ªåŠ¨åŒ–ç®¡ç†æŠ€å·§ï¼Œè®©ä½ çš„è™šæ‹ŸåŒ–ç¯å¢ƒè¿è¡Œæ›´åŠ é«˜æ•ˆç¨³å®šï¼æœ¬æ–‡æ¶µç›–å¸¸ç”¨å‘½ä»¤ã€å®šæ—¶ä»»åŠ¡é…ç½®åŠå›¾å½¢åŒ–ç®¡ç†æ–¹æ¡ˆã€‚\nğŸ“š ç›®å½•å¯¼èˆª âœ¨ PVE ç®€ä»‹ âš¡ å¸¸ç”¨è™šæ‹Ÿæœºæ“ä½œå‘½ä»¤ â° å‘½ä»¤è¡Œå®šæ—¶ä»»åŠ¡é…ç½® ğŸ–¥ï¸ å›¾å½¢ç•Œé¢å®šæ—¶ä»»åŠ¡ç®¡ç† ğŸ”§ 1Panel å®‰è£…ä¸ä½¿ç”¨ ğŸš€ å®é™…åº”ç”¨åœºæ™¯ ğŸ“Š å‘½ä»¤å‚è€ƒé€ŸæŸ¥è¡¨ ğŸ¯ æ€»ç»“ âœ¨ PVE ç®€ä»‹ Proxmox VE (Proxmox Virtual Environment) æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨è™šæ‹ŸåŒ–ç®¡ç†å¹³å°ï¼ŒåŸºäº Debian Linux å¼€å‘ï¼Œé›†æˆäº† KVM è™šæ‹Ÿæœºå’Œ LXC å®¹å™¨æŠ€æœ¯ã€‚\nğŸŒŸ PVE ä¸»è¦ç‰¹ç‚¹ï¼š\nğŸ†“ å®Œå…¨å…è´¹ï¼šå¼€æºä¸”å…è´¹ä½¿ç”¨ï¼Œä¼ä¸šç‰ˆå¯é€‰ä»˜è´¹æ”¯æŒ ğŸ¯ ä¸€ä½“åŒ–ç®¡ç†ï¼šåŒæ—¶æ”¯æŒè™šæ‹Ÿæœºå’Œå®¹å™¨ ğŸŒ Web ç®¡ç†ç•Œé¢ï¼šæä¾›ç›´è§‚çš„ç½‘é¡µç®¡ç†æ§åˆ¶å° ğŸ”§ å‘½ä»¤è¡Œæ”¯æŒï¼šä¸°å¯Œçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾¿äºè‡ªåŠ¨åŒ– ğŸ“Š é«˜å¯ç”¨æ€§ï¼šæ”¯æŒé›†ç¾¤å’Œé«˜å¯ç”¨é…ç½® ğŸ’¾ å­˜å‚¨çµæ´»ï¼šæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼ˆæœ¬åœ°ã€NFSã€Cephç­‰ï¼‰ âš¡ å¸¸ç”¨è™šæ‹Ÿæœºæ“ä½œå‘½ä»¤ PVE æä¾›äº†å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…· qm (QEMU/KVM Manager) æ¥ç®¡ç†è™šæ‹Ÿæœºã€‚\n1ï¸âƒ£ æŸ¥çœ‹è™šæ‹Ÿæœºåˆ—è¡¨ 1 2 3 4 5 6 7 # æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¸Šæ‰€æœ‰è™šæ‹ŸæœºçŠ¶æ€ qm list # ç¤ºä¾‹è¾“å‡ºï¼š # VMID NAME STATUS MEM(MB) BOOTDISK(GB) PID # 101 FnOS-NAS running 8192 64.00 1234 # 102 Ubuntu-Server stopped 4096 32.00 0 ğŸ“ è¯´æ˜ï¼šæ­¤å‘½ä»¤æ˜¾ç¤ºæ‰€æœ‰è™šæ‹Ÿæœºçš„ç®€è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬VMIDã€åç§°ã€çŠ¶æ€ã€å†…å­˜ä½¿ç”¨å’Œç£ç›˜å¤§å°ã€‚\n2ï¸âƒ£ å¯åŠ¨è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 # å¯åŠ¨æŒ‡å®šIDçš„è™šæ‹Ÿæœº qm start \u0026lt;VMID\u0026gt; # ç¤ºä¾‹ï¼šå¯åŠ¨VMIDä¸º101çš„è™šæ‹Ÿæœº qm start 101 # å¯åŠ¨å¹¶ç­‰å¾…ç›´åˆ°å®Œå…¨å¯åŠ¨ qm start 101 --wait 60 3ï¸âƒ£ æ­£å¸¸å…³é—­è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 # æ­£å¸¸å…³æœºï¼ˆæ¨èæ–¹å¼ï¼‰ qm shutdown \u0026lt;VMID\u0026gt; # ç¤ºä¾‹ï¼šæ­£å¸¸å…³é—­VMIDä¸º101çš„è™šæ‹Ÿæœº qm shutdown 101 # å¼ºåˆ¶ç«‹å³å…³æœºï¼ˆå¦‚æœæ­£å¸¸å…³æœºå¤±è´¥ï¼‰ qm shutdown 101 --forceStop ğŸ’¡ æç¤ºï¼šshutdown ä¼šå‘è™šæ‹Ÿæœºå‘é€å…³æœºä¿¡å·ï¼Œè®©å®¢æˆ·æœºæ“ä½œç³»ç»Ÿæ­£å¸¸å…³é—­ï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚\n4ï¸âƒ£ é‡å¯è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 # é‡å¯è™šæ‹Ÿæœº qm reboot \u0026lt;VMID\u0026gt; # ç¤ºä¾‹ï¼šé‡å¯VMIDä¸º101çš„è™šæ‹Ÿæœº qm reboot 101 # å¼ºåˆ¶é‡å¯ï¼ˆå¦‚æœæ­£å¸¸é‡å¯å¤±è´¥ï¼‰ qm reboot 101 --force 5ï¸âƒ£ å¼ºåˆ¶åœæ­¢è™šæ‹Ÿæœº 1 2 3 4 5 # å¼ºåˆ¶åœæ­¢è™šæ‹Ÿæœºï¼ˆç›¸å½“äºæ–­ç”µï¼‰ qm stop \u0026lt;VMID\u0026gt; # ç¤ºä¾‹ï¼šå¼ºåˆ¶åœæ­¢VMIDä¸º101çš„è™šæ‹Ÿæœº qm stop 101 âš ï¸ æ³¨æ„ï¼šstop å‘½ä»¤ä¼šç«‹å³ç»ˆæ­¢è™šæ‹Ÿæœºè¿è¡Œï¼Œç±»ä¼¼äºç›´æ¥æ–­ç”µï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼\n6ï¸âƒ£ å…¶ä»–å¸¸ç”¨å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹è™šæ‹Ÿæœºé…ç½® qm config \u0026lt;VMID\u0026gt; # æŒ‚èµ·è™šæ‹Ÿæœº qm suspend \u0026lt;VMID\u0026gt; # æ¢å¤æŒ‚èµ·çš„è™šæ‹Ÿæœº qm resume \u0026lt;VMID\u0026gt; # æŸ¥çœ‹è™šæ‹Ÿæœºæ§åˆ¶å° qm terminal \u0026lt;VMID\u0026gt; â° å‘½ä»¤è¡Œå®šæ—¶ä»»åŠ¡é…ç½® ä½¿ç”¨ Linux çš„ cron æœåŠ¡å¯ä»¥è½»æ¾å®ç°è™šæ‹Ÿæœºçš„å®šæ—¶å¼€å…³æœºã€‚\n1ï¸âƒ£ ç¼–è¾‘ crontab é…ç½®æ–‡ä»¶ 1 2 # ä½¿ç”¨ nano ç¼–è¾‘å™¨ç¼–è¾‘ç³»ç»Ÿcrontab sudo nano /etc/crontab 2ï¸âƒ£ æ·»åŠ å®šæ—¶ä»»åŠ¡è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ¯å¤©ä¸‹åˆ6:43å¯åŠ¨VMIDä¸º101çš„è™šæ‹Ÿæœº 43 18 * * * root qm start 101 # æ¯å¤©ä¸‹åˆ6:48æ­£å¸¸å…³é—­VMIDä¸º101çš„è™šæ‹Ÿæœº 48 18 * * * root qm shutdown 101 # æ¯å‘¨ä¸€æ—©ä¸Š8:00å¯åŠ¨VMIDä¸º102çš„è™šæ‹Ÿæœº 0 8 * * 1 root qm start 102 # æ¯å‘¨äº”æ™šä¸Š20:00å…³é—­VMIDä¸º102çš„è™šæ‹Ÿæœº 0 20 * * 5 root qm shutdown 102 # æ¯æœˆ1å·å‡Œæ™¨é‡å¯VMIDä¸º103çš„è™šæ‹Ÿæœº 0 0 1 * * root qm reboot 103 3ï¸âƒ£ Cron æ—¶é—´æ ¼å¼è¯´æ˜ 1 2 3 4 5 6 7 * * * * * user-name command-to-be-executed â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ æ˜ŸæœŸå‡  (0 - 6) (å‘¨æ—¥=0) â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€ æœˆ (1 - 12) â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥ (1 - 31) â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¶ (0 - 23) â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ† (0 - 59) 4ï¸âƒ£ éªŒè¯å’Œè°ƒè¯• 1 2 3 4 5 6 7 8 # é‡å¯cronæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ systemctl restart cron # æŸ¥çœ‹cronæ—¥å¿—ï¼ˆDebian/Ubuntuï¼‰ tail -f /var/log/syslog | grep cron # æµ‹è¯•cronä»»åŠ¡ï¼ˆæ‰‹åŠ¨è¿è¡Œï¼‰ run-parts --test /etc/cron.daily ğŸ–¥ï¸ å›¾å½¢ç•Œé¢å®šæ—¶ä»»åŠ¡ç®¡ç† å¯¹äºä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·æ¥ç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚\næ–¹æ¡ˆæ¯”è¾ƒ å·¥å…· ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ Webmin åŠŸèƒ½å…¨é¢ï¼Œå†å²æ‚ ä¹… ç•Œé¢ç›¸å¯¹é™ˆæ—§ ä¼ ç»Ÿç³»ç»Ÿç®¡ç† Cockpit ç°ä»£ç•Œé¢ï¼Œå®˜æ–¹æ”¯æŒ åŠŸèƒ½ç›¸å¯¹ç®€å• åŸºç¡€æœåŠ¡å™¨ç®¡ç† 1Panel ç•Œé¢ç¾è§‚ï¼Œä¸“æ³¨è¿ç»´ è¾ƒæ–°é¡¹ç›® ç°ä»£åŒ–è¿ç»´ç®¡ç† ğŸ”§ 1Panel å®‰è£…ä¸ä½¿ç”¨ 1ï¸âƒ£ å®‰è£… 1Panel 1 2 # ä½¿ç”¨å®˜æ–¹æ¨èçš„ä¸€é”®å®‰è£…å‘½ä»¤ bash -c \u0026#34;$(curl -sSL https://resource.fit2cloud.com/1panel/package/v2/quick_start.sh)\u0026#34; ğŸ“ å®‰è£…åä¿¡æ¯ï¼š\nè®¿é—®åœ°å€ï¼šhttps://æœåŠ¡å™¨IP:ç›®æ ‡ç«¯å£ é»˜è®¤ç”¨æˆ·ï¼šadmin é»˜è®¤å¯†ç ï¼šå®‰è£…æ—¶æ˜¾ç¤ºï¼Œè¯·åŠæ—¶ä¿®æ”¹ 2ï¸âƒ£ ä½¿ç”¨ 1Panel è®¾ç½®è®¡åˆ’ä»»åŠ¡ ç™»å½• 1Panelï¼šä½¿ç”¨æµè§ˆå™¨è®¿é—®å®‰è£…æ—¶æ˜¾ç¤ºçš„åœ°å€\nå¯¼èˆªåˆ°è®¡åˆ’ä»»åŠ¡ï¼šåœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ°\u0026quot;è®¡åˆ’ä»»åŠ¡\u0026quot;åŠŸèƒ½\nåˆ›å»ºæ–°ä»»åŠ¡ï¼š\nç‚¹å‡»\u0026quot;åˆ›å»ºä»»åŠ¡\u0026quot;æŒ‰é’® è®¾ç½®ä»»åŠ¡åç§°ï¼ˆå¦‚\u0026quot;æ¯å¤©å¯åŠ¨NAS\u0026quot;ï¼‰ é…ç½®æ‰§è¡Œæ—¶é—´ï¼ˆcronæ ¼å¼æˆ–å¯è§†åŒ–é€‰æ‹©ï¼‰ è¾“å…¥æ‰§è¡Œå‘½ä»¤ï¼šqm start 101 ä¿å­˜ä»»åŠ¡ ä»»åŠ¡ç®¡ç†ï¼š\nå¯ä»¥å¯ç”¨/ç¦ç”¨ä»»åŠ¡ æŸ¥çœ‹æ‰§è¡Œå†å²è®°å½• æ‰‹åŠ¨ç«‹å³æ‰§è¡Œæµ‹è¯• 3ï¸âƒ£ å¸è½½ 1Panelï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 # ä½¿ç”¨1panelè‡ªå¸¦çš„å¸è½½è„šæœ¬ 1pctl uninstall # æˆ–è€…æ‰‹åŠ¨å¸è½½ systemctl stop 1panel systemctl disable 1panel rm -rf /opt/1panel /usr/local/bin/1pctl ğŸš€ å®é™…åº”ç”¨åœºæ™¯ 1ï¸âƒ£ å®¶åº­NASå®šæ—¶å¼€å…³æœº 1 2 3 4 5 6 7 # å·¥ä½œæ—¥æ™šä¸Š18:30å¼€å¯NASï¼Œ23:30å…³é—­ 30 18 * * 1-5 root qm start 101 30 23 * * 1-5 root qm shutdown 101 # å‘¨æœ«å…¨å¤©è¿è¡Œï¼Œå‘¨ä¸€æ—©ä¸Šå…³é—­ 0 8 * * 6 root qm start 101 30 23 * * 7 root qm shutdown 101 2ï¸âƒ£ å¼€å‘æµ‹è¯•ç¯å¢ƒç®¡ç† 1 2 3 4 5 # å·¥ä½œæ—¶é—´è‡ªåŠ¨å¼€å¯æµ‹è¯•ç¯å¢ƒ 0 9 * * 1-5 root qm start 201 \u0026amp;\u0026amp; qm start 202 # ä¸‹ç­åè‡ªåŠ¨å…³é—­èŠ‚çœèµ„æº 0 18 * * 1-5 root qm shutdown 201 \u0026amp;\u0026amp; qm shutdown 202 3ï¸âƒ£ å¤‡ä»½ç­–ç•¥é…åˆ 1 2 3 4 5 # æ¯å‘¨å…­å‡Œæ™¨2ç‚¹å¼€å¯å¤‡ä»½ä¸“ç”¨è™šæ‹Ÿæœº 0 2 * * 6 root qm start 301 # å¤‡ä»½å®Œæˆå4ç‚¹è‡ªåŠ¨å…³é—­ 0 4 * * 6 root qm shutdown 301 ğŸ“Š å‘½ä»¤å‚è€ƒé€ŸæŸ¥è¡¨ ğŸ”§ å¸¸ç”¨ qm å‘½ä»¤ å‘½ä»¤ è¯´æ˜ ç¤ºä¾‹ qm list åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿæœº qm list qm start \u0026lt;VMID\u0026gt; å¯åŠ¨è™šæ‹Ÿæœº qm start 101 qm shutdown \u0026lt;VMID\u0026gt; æ­£å¸¸å…³æœº qm shutdown 101 qm reboot \u0026lt;VMID\u0026gt; é‡å¯è™šæ‹Ÿæœº qm reboot 101 qm stop \u0026lt;VMID\u0026gt; å¼ºåˆ¶åœæ­¢ qm stop 101 qm config \u0026lt;VMID\u0026gt; æŸ¥çœ‹é…ç½® qm config 101 â° Cron æ—¶é—´ç¤ºä¾‹ ç¤ºä¾‹ è¯´æ˜ 0 9 * * 1-5 å‘¨ä¸€è‡³å‘¨äº”æ—©ä¸Š9ç‚¹ 30 18 * * * æ¯å¤©ä¸‹åˆ6ç‚¹30åˆ† 0 0 1 * * æ¯æœˆ1å·å‡Œæ™¨ 0 12 * * 0 æ¯å‘¨æ—¥ä¸­åˆ12ç‚¹ ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†ï¼š\nâœ… æ ¸å¿ƒæŠ€èƒ½ åŸºæœ¬å‘½ä»¤æŒæ¡ï¼šç†Ÿç»ƒä½¿ç”¨ qm start|shutdown|reboot|stop|list ç­‰å¸¸ç”¨å‘½ä»¤ å®šæ—¶ä»»åŠ¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤è¡Œ crontab é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡ å›¾å½¢åŒ–ç®¡ç†ï¼šä½¿ç”¨ 1Panel ç­‰å·¥å…·è¿›è¡Œå¯è§†åŒ–ä»»åŠ¡ç®¡ç† å®é™…åœºæ™¯åº”ç”¨ï¼šæ ¹æ®éœ€æ±‚åˆ¶å®šåˆç†çš„è‡ªåŠ¨åŒ–ç­–ç•¥ ğŸ”§ æœ€ä½³å®è·µå»ºè®® ä¼˜å…ˆä½¿ç”¨æ­£å¸¸å…³æœºï¼šå°½é‡ä½¿ç”¨ qm shutdown è€Œä¸æ˜¯ qm stopï¼Œé¿å…æ•°æ®ä¸¢å¤± æµ‹è¯•éªŒè¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼Œå……åˆ†æµ‹è¯•å®šæ—¶ä»»åŠ¡çš„æœ‰æ•ˆæ€§ æ—¥å¿—ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥ cron æ—¥å¿—ï¼Œç¡®ä¿ä»»åŠ¡æ­£å¸¸æ‰§è¡Œ å¤‡ä»½é…ç½®ï¼šå®šæœŸå¤‡ä»½ crontab é…ç½®å’Œè™šæ‹Ÿæœºé…ç½® ğŸš€ æ‰©å±•å­¦ä¹  å­¦ä¹ ä½¿ç”¨ pct å‘½ä»¤ç®¡ç† LXC å®¹å™¨ æ¢ç´¢ PVE é›†ç¾¤å’Œé«˜å¯ç”¨é…ç½® ç ”ç©¶æ›´å¤æ‚çš„å¤‡ä»½å’Œè¿ç§»ç­–ç•¥ ç°åœ¨ï¼Œä½ å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°ç®¡ç†ä½ çš„ PVE è™šæ‹ŸåŒ–ç¯å¢ƒäº†ï¼äº«å—è‡ªåŠ¨åŒ–å¸¦æ¥çš„ä¾¿åˆ©å§ï¼ğŸ‰\nğŸ’¡ æç¤ºï¼šæœ¬æ–‡ä»‹ç»çš„æ–¹æ³•ä¸ä»…é€‚ç”¨äº PVEï¼Œå…¶åŸºæœ¬åŸç†ä¹Ÿé€‚ç”¨äºå…¶ä»– Linux ç¯å¢ƒçš„è‡ªåŠ¨åŒ–ç®¡ç†ã€‚æ ¹æ®ä½ çš„å®é™…éœ€æ±‚çµæ´»è°ƒæ•´æ—¶é—´å’Œå‘½ä»¤å‚æ•°ã€‚\n","date":"2025-09-07T20:47:24+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/e2e60152/","title":"Proxmox VE è™šæ‹Ÿæœºæ“ä½œä¸å®šæ—¶ä»»åŠ¡ç®¡ç† â°"},{"content":"Docker éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿï¼ˆæ–°ç‰ˆï¼‰ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿ 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Typecho 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåšå®¢ï¼Œä¹¦å†™æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Typecho å®˜ç½‘åœ°å€ï¼š https://typecho.org ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/typecho/typecho ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/joyqi/typecho Typecho æ˜¯ä¸€æ¬¾è½»é‡çº§çš„å¼€æºåšå®¢ç³»ç»Ÿï¼ŒåŸºäº PHP å¼€å‘ï¼Œå…·æœ‰é«˜æ•ˆã€ç¨³å®šã€æ˜“ç”¨çš„ç‰¹ç‚¹ã€‚\nç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ Typechoï¼Œå®ç°æ•°æ®æŒä¹…åŒ–å’Œçµæ´»é…ç½®ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âš¡ è½»é‡é«˜æ•ˆ æ ¸å¿ƒç¨‹åºä»…çº¦ 500KB èµ„æºå ç”¨ä½ï¼Œå“åº”é€Ÿåº¦å¿« ğŸ“ Markdown æ”¯æŒ åŸç”Ÿæ”¯æŒ Markdown å†™ä½œ ç®€æ´é«˜æ•ˆçš„å†™ä½œä½“éªŒ ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ ä¸°å¯Œçš„ä¸»é¢˜ç”Ÿæ€ç³»ç»Ÿ è½»æ¾å®šåˆ¶åšå®¢å¤–è§‚ ğŸ”Œ æ’ä»¶æ‰©å±• åŠŸèƒ½ä¸°å¯Œçš„æ’ä»¶å¸‚åœº çµæ´»æ‰©å±•åšå®¢åŠŸèƒ½ ğŸ“Š å¤šæ•°æ®åº“æ”¯æŒ æ”¯æŒ SQLiteã€MySQLã€PostgreSQL éƒ¨ç½²çµæ´»ï¼Œé€‚åº”ä¸åŒç¯å¢ƒ ğŸŒ å¤šè¯­è¨€æ”¯æŒ å†…ç½®å¤šè¯­è¨€ç•Œé¢ å›½é™…åŒ–æ”¯æŒè‰¯å¥½ ğŸ”§ ç®€æ´åå° ç›´è§‚æ˜“ç”¨çš„ç®¡ç†ç•Œé¢ æ“ä½œç®€å•ï¼Œä¸Šæ‰‹å¿«é€Ÿ ğŸ“± å“åº”å¼è®¾è®¡ è‡ªé€‚åº”å„ç§è®¾å¤‡å±å¹• åœ¨æ‰‹æœºå’Œå¹³æ¿ä¸Šä½“éªŒè‰¯å¥½ ğŸ”’ å®‰å…¨å¯é  ä¸¥æ ¼çš„ä»£ç å®‰å…¨è§„èŒƒ ä¿éšœåšå®¢æ•°æ®å®‰å…¨ ğŸ“‚ æ ‡å‡†å…¼å®¹ æ”¯æŒ XML-RPC æ¥å£ æ–¹ä¾¿ä¸å…¶ä»–ç³»ç»Ÿé›†æˆ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿ 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 mkdir -p /mnt/mydisk/home/typecho \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: typecho: image: joyqi/typecho:nightly-php8.2-apache container_name: typecho restart: always ports: - \u0026#34;8383:80\u0026#34; environment: - TZ=Asia/Shanghai volumes: - ./typecho/usr:/app/usr - ./typecho/config.inc.php:/app/config.inc.php depends_on: - db db: image: mariadb:10.6 container_name: typecho-db restart: always environment: - MYSQL_ROOT_PASSWORD=root_password - MYSQL_DATABASE=typecho - MYSQL_USER=typecho - MYSQL_PASSWORD=typecho_password - TZ=Asia/Shanghai volumes: - ./db:/var/lib/mysql EOF ğŸ” æ•°æ®åº“å¯†ç ï¼šè¯·å°† root_password å’Œ typecho_password æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å¼ºå¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Typecho 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8383 åå°ç®¡ç†ï¼š http://localhost:8383/admin åŸŸåè®¿é—®ï¼š https://typecho.example.com:666 ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŒ‰ç…§å®‰è£…å‘å¯¼å®Œæˆ Typecho çš„åˆå§‹é…ç½® è®¾ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆä½¿ç”¨ compose ä¸­é…ç½®çš„æ•°æ®åº“ä¿¡æ¯ï¼‰ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· å¼€å§‹æ’°å†™æ‚¨çš„ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« ï¼ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://typecho.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/typecho.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name typecho.example.com; # ğŸŒ æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8383; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸš€ äº” ã€å®‰è£…ä¸»é¢˜å’Œæ’ä»¶ 1. å®‰è£…å‰å°ä¸»é¢˜ 1. å®‰è£… butterfly å‰å°ä¸»é¢˜ 1 2 3 4 5 6 sudo chmod -R 755 /vol1/1000/compose/typecho/typecho \u0026amp;\u0026amp; \\ cd /vol1/1000/compose/typecho/typecho/usr/themes \u0026amp;\u0026amp; \\ wget -c https://github.com/wehaox/Typecho-Butterfly/releases/download/1.8.1/butterfly_Release1.8.1.zip \u0026amp;\u0026amp; \\ unzip butterfly_Release1.8.1.zip \u0026amp;\u0026amp; \\ rm butterfly_Release1.8.1.zip \u0026amp;\u0026amp; \\ chmod -R 755 butterfly 2. Typecho åå°å¯ç”¨ä¸»é¢˜ âš™ï¸ ç™»å½• Typecho åå° è¿›å…¥\u0026quot;æ§åˆ¶å°\u0026quot; â†’ â€œå¤–è§‚â€ é€‰æ‹©æ–°å®‰è£…çš„ä¸»é¢˜å¹¶ç‚¹å‡»\u0026quot;å¯ç”¨\u0026quot; 2. å®‰è£…åå°ä¸»é¢˜ âœ¨ 1. å®‰è£… butterfly å‰å°ä¸»é¢˜ 3. å®‰è£…æ’ä»¶ 1 2 ## æ’ä»¶ç›®å½•åŠ è¯»å†™æƒé™ sudo chmod -R 755 /vol1/1000/compose/typecho/typecho/usr/plugins ğŸŒŸ å¯èˆªåšå®¢ï¼Œä¹¦å†™æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œæ‚¨å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Typecho åšå®¢ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è®¿é—®ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ï¼š\nâœï¸ è‡ªç”±è¡¨è¾¾ åœ¨è½»é‡é«˜æ•ˆçš„å¹³å°ä¸Šä¹¦å†™æ‚¨çš„æ‰€æ€æ‰€æƒ³ï¼Œè®°å½•ç”Ÿæ´»ç‚¹æ»´\nğŸ¨ ä¸ªæ€§å®šåˆ¶ é€šè¿‡ä¸°å¯Œçš„ä¸»é¢˜å’Œæ’ä»¶ç³»ç»Ÿï¼Œæ‰“é€ ç‹¬ä¸€æ— äºŒçš„åšå®¢ç©ºé—´\nğŸŒ è¿æ¥ä¸–ç•Œ å°†æ‚¨çš„è§‚ç‚¹å’Œåˆ›æ„åˆ†äº«ç»™å…¨çƒè¯»è€…ï¼Œå»ºç«‹ä¸ªäººå“ç‰Œ\nğŸ” å®Œå…¨è‡ªä¸» æ‰€æœ‰æ•°æ®æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸­ï¼Œäº«å—çœŸæ­£çš„æ•°å­—è‡ªä¸»æƒ\nåšå®¢æ˜¯æ€æƒ³çš„å®¹å™¨ï¼Œæ˜¯åˆ›æ„çš„èˆå°ï¼Œæ›´æ˜¯è¿æ¥å¿—åŒé“åˆè€…çš„æ¡¥æ¢ã€‚æ„¿ Typecho æˆä¸ºæ‚¨å¯é çš„æ•°å­—ç¬”å‹ï¼Œé™ªä¼´æ‚¨åœ¨æ¯ä¸€ä¸ªçµæ„Ÿæ¿€è¡çš„æ—¶åˆ»ï¼Œè®°å½•æ¯ä¸€ä¸ªå€¼å¾—çè—çš„ç¬é—´ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ‰§ç¬”ä¸ºå‰‘ï¼Œä¹¦å†™ä¼ å¥‡â€”â€”æ„å»ºæ‚¨ç‹¬å…·ç‰¹è‰²çš„ç½‘ç»œå®¶å›­å§ï¼âœ¨\nğŸ“Œ æŒç»­ä¼˜åŒ–ï¼šå»ºè®®å…³æ³¨ Typecho å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸å®‰å…¨è¡¥ä¸\nğŸ› äº¤æµäº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues å‚ä¸è®¨è®º\nç¥æ‚¨å†™ä½œæ„‰å¿«ï¼Œåšå®¢æœ‰æˆï¼ğŸ‰\n","date":"2025-09-06T22:36:15+08:00","image":"https://file.meimolihan.eu.org/img/typecho-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8d1a1077/","title":"Docker éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿï¼ˆæ–°ç‰ˆï¼‰ ğŸ³"},{"content":"Docker éƒ¨ç½² MinDoc æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ ğŸ“â˜ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² MinDoc 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ MinDoc 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ MinDoc å®˜ç½‘åœ°å€ï¼š https://www.iminho.me/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/mindoc-org/mindoc ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/ywsj/mindoc MinDoc æ˜¯ä¸€æ¬¾é’ˆå¯¹ITå›¢é˜Ÿå¼€å‘çš„ç®€å•å¥½ç”¨çš„æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼Œé€‚åˆç”¨æ¥å‚¨å­˜æ—¥å¸¸æ¥å£æ–‡æ¡£ã€æ•°æ®åº“å­—å…¸ã€æ‰‹å†Œè¯´æ˜ç­‰æ–‡æ¡£ã€‚å†…ç½®é¡¹ç›®ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ï¼Œæ”¯æŒMarkdownæ ¼å¼ï¼Œèƒ½å¤Ÿæ»¡è¶³ä¸­å°å‹å›¢é˜Ÿå¯¹æ–‡æ¡£ç®¡ç†çš„åŸºæœ¬éœ€æ±‚ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“š é¡¹ç›®ç®¡ç† æ”¯æŒå¤šé¡¹ç›®æ–‡æ¡£ç®¡ç† æ¸…æ™°åŒºåˆ†ä¸åŒé¡¹ç›®æ–‡æ¡£ï¼Œä¾¿äºç»„ç»‡å’Œç®¡ç† ğŸ‘¥ ç”¨æˆ·æƒé™ å¤šç”¨æˆ·åä½œå’Œæƒé™æ§åˆ¶ æ”¯æŒå›¢é˜Ÿæˆå‘˜åä½œï¼Œè®¾ç½®ä¸åŒè®¿é—®æƒé™ ğŸ“ Markdown æ”¯æŒ å®Œæ•´çš„Markdownç¼–è¾‘å™¨ ç†Ÿæ‚‰çš„è¯­æ³•ï¼Œæµç•…çš„å†™ä½œä½“éªŒ ğŸ” å…¨æ–‡æœç´¢ æ”¯æŒæ–‡æ¡£å†…å®¹å…¨æ–‡æ£€ç´¢ å¿«é€Ÿå®šä½æ‰€éœ€æ–‡æ¡£å†…å®¹ ğŸ“Š æ–‡æ¡£ç»Ÿè®¡ æ–‡æ¡£æ•°é‡å’Œå­—æ•°ç»Ÿè®¡ ç›´è§‚äº†è§£é¡¹ç›®æ–‡æ¡£æƒ…å†µ ğŸŒ åœ¨çº¿é¢„è§ˆ æ”¯æŒæ–‡æ¡£å®æ—¶é¢„è§ˆ ç¼–å†™åŒæ—¶æŸ¥çœ‹æœ€ç»ˆæ•ˆæœ ğŸ“¤ å¯¼å‡ºåŠŸèƒ½ æ”¯æŒå¤šç§æ ¼å¼å¯¼å‡º æ–¹ä¾¿æ–‡æ¡£çš„åˆ†äº«å’Œå¤‡ä»½ ğŸ¨ ä¸»é¢˜æ ·å¼ å¤šç§ç•Œé¢ä¸»é¢˜å¯é€‰ ä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢é£æ ¼ ğŸ³ ä¸€ã€Docker éƒ¨ç½² MinDoc 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 mkdir -p /mnt/mydisk/home/mindoc \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: mindoc: image: ywsj/mindoc:latest container_name: mindoc privileged: false restart: always ports: - 8181:8181 volumes: - ./mindoc/conf://mindoc/conf - ./mindoc/static://mindoc/static - ./mindoc/views://mindoc/views - ./mindoc/uploads://mindoc/uploads - ./mindoc/runtime://mindoc/runtime - ./mindoc/database://mindoc/database environment: - MINDOC_RUN_MODE=prod - MINDOC_DB_ADAPTER=sqlite3 - MINDOC_DB_DATABASE=./database/mindoc.db - MINDOC_CACHE=true - MINDOC_CACHE_PROVIDER=file - MINDOC_ENABLE_EXPORT=true - MINDOC_BASE_URL= - MINDOC_CDN_IMG_URL= - MINDOC_CDN_CSS_URL= - MINDOC_CDN_JS_URL= dns: - 223.5.5.5 - 223.6.6.6 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ MinDoc 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8181 åŸŸåè®¿é—®ï¼š https://mindoc.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤è´¦å·å¯†ç ç™»å½•ï¼ˆadmin/123456ï¼‰ åˆ›å»ºé¡¹ç›® â†’ æ·»åŠ æ–‡æ¡£ â†’ å¼€å§‹ç®¡ç†æ–‡æ¡£ï¼ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://mindoc.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/mindoc.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; listen [::]:80; server_name mindoc.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name mindoc.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options SAMEORIGIN; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8181; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œæ‚¨å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† MinDoc æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼Œå¹¶é…ç½®äº† Nginx åå‘ä»£ç†å®ç°å®‰å…¨è®¿é—®ã€‚ç°åœ¨æ‚¨å¯ä»¥ï¼š\nâœ¨ é›†ä¸­ç®¡ç†å›¢é˜Ÿæ–‡æ¡£ï¼Œå‘Šåˆ«æ–‡æ¡£åˆ†æ•£å’Œç‰ˆæœ¬æ··ä¹±çš„é—®é¢˜\nğŸ‘¥ å®ç°é«˜æ•ˆåä½œï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥å…±åŒç¼–è¾‘å’Œç»´æŠ¤é¡¹ç›®æ–‡æ¡£\nğŸ“š æ„å»ºçŸ¥è¯†åº“ä½“ç³»ï¼Œå°†é›¶æ•£çš„çŸ¥è¯†ç‚¹ç³»ç»ŸåŒ–æ•´ç†å½’æ¡£\nğŸ” ç²¾ç»†æƒé™æ§åˆ¶ï¼Œç¡®ä¿ä¸åŒæˆå‘˜åªèƒ½è®¿é—®æˆæƒå†…å®¹\nMinDoc å°†æˆä¸ºæ‚¨å›¢é˜Ÿçš„çŸ¥è¯†ä¸­æ¢ï¼Œå¸®åŠ©å›¢é˜Ÿæ²‰æ·€å®è´µç»éªŒï¼Œæå‡åä½œæ•ˆç‡ã€‚å¼€å§‹æ„å»ºæ‚¨å›¢é˜Ÿçš„ä¸“ä¸šæ–‡æ¡£åº“å§ï¼ğŸ†\nğŸ“ é‡è¦æç¤ºï¼š\né¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼ˆadmin/123456ï¼‰ä»¥ç¡®ä¿å®‰å…¨\nå»ºè®®å®šæœŸå¤‡ä»½ ./mindoc/database ç›®å½•ä¸‹çš„æ•°æ®åº“æ–‡ä»¶\nå…³æ³¨ MinDoc GitHub é¡¹ç›® è·å–æœ€æ–°æ›´æ–°å’Œå®‰å…¨å…¬å‘Š\nç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰\n","date":"2025-09-05T21:15:32+08:00","image":"https://file.meimolihan.eu.org/img/dicker-mindoc-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1f05d812/","title":"Docker éƒ¨ç½² MinDoc æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ ğŸ“â˜ï¸"},{"content":"Proxmox VE 9 å‡çº§å†…æ ¸å¹¶å¯ç”¨ Intel æ ¸æ˜¾çš„ SR-IOV ğŸš€ ğŸ“‘ å¯¼èˆªç›®å½• âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ› ï¸ ä¸€ã€å‡†å¤‡å·¥ä½œ âš™ï¸ äºŒã€å®‰è£…æ–°å†…æ ¸ ğŸ–¥ï¸ ä¸‰ã€å¼€å¯æ ¸æ˜¾ SR-IOV âœ… å››ã€éªŒè¯å®‰è£… ğŸ› ï¸ äº”ã€æŸ¥çœ‹æ ¸æ˜¾ä½¿ç”¨ç‡ ğŸ—‘ï¸ å…­ã€å¸è½½æ—§å†…æ ¸ âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ æ€§èƒ½æå‡ ğŸ”¥ï¼šé€šè¿‡ SR-IOV æŠ€æœ¯ï¼Œå…è®¸å¤šä¸ªè™šæ‹Ÿæœºæˆ–å®¹å™¨ç›´æ¥å…±äº« Intel æ ¸æ˜¾èµ„æºï¼Œæ˜¾è‘—æå‡å›¾å½¢å¤„ç†æ€§èƒ½ã€‚ ç¡¬ä»¶è™šæ‹ŸåŒ– ğŸ’»ï¼šå°†å•ä¸ªç‰©ç†æ ¸æ˜¾è™šæ‹ŸåŒ–ä¸ºå¤šä¸ªè™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰ï¼Œå®ç°é«˜æ•ˆçš„èµ„æºåˆ†é…å’Œéš”ç¦»ã€‚ å…¼å®¹æ€§å¼º âœ…ï¼šæ”¯æŒå¤šç§ Intel æ ¸æ˜¾å‹å·ï¼Œé€‚ç”¨äºæœ€æ–°çš„ PVE9 ç³»ç»Ÿç¯å¢ƒã€‚ ç®€æ˜“æ“ä½œ ğŸ› ï¸ï¼šé€šè¿‡ DKMS é©±åŠ¨å’Œå†…æ ¸å‡çº§ï¼Œç®€åŒ–å®‰è£…å’Œé…ç½®æµç¨‹ã€‚ ä¸€ã€ğŸ› ï¸ å‡†å¤‡å·¥ä½œ åœ¨å¼€å§‹å‡çº§ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç³»ç»Ÿå¤„äºæœ€æ–°çŠ¶æ€ï¼Œå¹¶ç¡®è®¤å½“å‰è¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬ã€‚ 1. ç¡®ä¿ç³»ç»Ÿæ›´æ–° 1 apt update \u0026amp;\u0026amp; apt upgrade -y 2. æŸ¥çœ‹å½“å‰è¿è¡Œçš„å†…æ ¸ 1 2 uname -r # ç¤ºä¾‹è¾“å‡ºï¼š6.14.11-4-pve 3. æŸ¥çœ‹å¯ç”¨å†…æ ¸ç‰ˆæœ¬ 1 apt-cache search pve-kernel ç¤ºä¾‹è¾“å‡ºï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 root@pve:~# apt-cache search pve-kernel proxmox-kernel-6.14.11-1-pve - Proxmox Kernel Image proxmox-kernel-6.14.11-2-pve - Proxmox Kernel Image proxmox-kernel-6.14.11-3-pve - Proxmox Kernel Image proxmox-kernel-6.14.11-4-pve - Proxmox Kernel Image proxmox-kernel-6.14.4-1+deb13u1-pve - Proxmox Kernel Image proxmox-kernel-6.14.5-1-pve - Proxmox Kernel Image proxmox-kernel-6.14.6-1-pve - Proxmox Kernel Image proxmox-kernel-6.14.8-1-pve - Proxmox Kernel Image proxmox-kernel-6.14.8-2-pve - Proxmox Kernel Image proxmox-kernel-6.14 - Latest Proxmox Kernel Image proxmox-kernel-6.17.1-1-pve - Proxmox Kernel Image proxmox-kernel-6.17.2-1-pve - Proxmox Kernel Image proxmox-kernel-6.17 - Latest Proxmox Kernel Image proxmox-kernel-helper - Function for various kernel maintenance tasks. pve-firmware - Binary firmware code for the pve-kernel äºŒã€âš™ï¸ å®‰è£…æ–°å†…æ ¸ é€‰æ‹©å¹¶å®‰è£…ç›®æ ‡å†…æ ¸ç‰ˆæœ¬ï¼Œå›ºåŒ–ä»¥é¿å…åç»­è‡ªåŠ¨æ›´æ–°è¦†ç›–ã€‚ 1. å®‰è£…å†…æ ¸å’Œå¤´æ–‡ä»¶ 1 apt install proxmox-kernel-6.17.2-1-pve proxmox-headers-6.17.2-1-pve 2. å›ºåŒ–æŒ‡å®šå†…æ ¸ç‰ˆæœ¬ 1 proxmox-boot-tool kernel pin 6.17.2-1-pve 3. æ£€æŸ¥å›ºåŒ–çŠ¶æ€ 1 proxmox-boot-tool kernel list è¾“å‡ºç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 root@pve:~# proxmox-boot-tool kernel list Manually selected kernels: None. Automatically selected kernels: 6.14.11-4-pve 6.17.2-1-pve Pinned kernel: 6.17.2-1-pve 4. é‡å¯ PVE åº”ç”¨æ–°å†…æ ¸ å®Œæˆå†…æ ¸å®‰è£…åï¼Œéœ€æ›´æ–° GRUB é…ç½®å¹¶é‡å¯ç³»ç»Ÿä»¥åº”ç”¨æ–°å†…æ ¸ã€‚ 1 2 3 4 5 # æ›´æ–°GRUBé…ç½® update-grub # é‡å¯PVE reboot ä¸‰ã€ğŸ–¥ï¸ å¼€å¯æ ¸æ˜¾ SR-IOV ç³»ç»Ÿé‡å¯åï¼Œå®‰è£…å¹¶é…ç½® Intel æ ¸æ˜¾çš„ SR-IOV DKMS é©±åŠ¨ã€‚ 1. æŸ¥çœ‹å½“å‰è¿è¡Œçš„å†…æ ¸ ç¡®è®¤ç³»ç»Ÿå·²è¿è¡Œæ–°å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ã€‚ 1 2 uname -r # ç¤ºä¾‹è¾“å‡ºï¼š6.17.2-1-pve 2. å®‰è£…å½“å‰å†…æ ¸çš„å¤´æ–‡ä»¶ 1 2 apt update apt install pve-headers-$(uname -r) 3. å®‰è£… i915 SR-IOV DKMS é©±åŠ¨ å¯è®¿é—® i915-sriov-dkms GitHub é¡µé¢ è·å–æœ€æ–°ç‰ˆæœ¬é©±åŠ¨\nä¸‹è½½é¢„ç¼–è¯‘çš„DEBåŒ…ï¼ˆè¯·æ ¹æ®PVEç‰ˆæœ¬é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ï¼‰ 1 wget -c https://github.com/strongtz/i915-sriov-dkms/releases/download/2025.10.10/i915-sriov-dkms_2025.10.10_amd64.deb å®‰è£… DEB åŒ… 1 dpkg -i i915-sriov-dkms_2025.10.10_amd64.deb Updating kernel version 6.14.11-4-pve in systemd-boot... æ˜¯ä¸€æ¡æˆåŠŸä¸”æ­£å¸¸çš„ä¿¡æ¯ã€‚å®ƒè¡¨æ˜ï¼š æ‚¨çš„ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ UEFI å¯åŠ¨æ¨¡å¼å’Œ systemd-boot å¼•å¯¼åŠ è½½å™¨ã€‚ æ–°å†…æ ¸çš„å®‰è£…æµç¨‹å·²ç»é¡ºåˆ©å®Œæˆï¼Œå¹¶ä¸”å¼•å¯¼åŠ è½½å™¨çš„é…ç½®å·²è‡ªåŠ¨æ›´æ–°ã€‚ æ‚¨ç°åœ¨å¯ä»¥é‡å¯ç³»ç»Ÿï¼Œå¹¶æœŸæœ›åœ¨å¯åŠ¨èœå•ä¸­çœ‹åˆ°æ–°å†…æ ¸çš„é€‰é¡¹ã€‚ 4. æ›´æ–° initramfs å¹¶é‡å¯ update-initramfs -u ä¸ºå½“å‰æ­£åœ¨è¿è¡Œçš„å†…æ ¸ï¼Œé‡æ–°ç”Ÿæˆåˆå§‹åŒ–å†…å­˜ç›˜ã€‚ 1 2 3 4 5 # æ›´æ–° initramfs update-initramfs -u # é‡å¯ç³»ç»Ÿ reboot å››ã€âœ… éªŒè¯å®‰è£… ç³»ç»Ÿé‡å¯åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ SR-IOV æ˜¯å¦å¯ç”¨æˆåŠŸï¼š 1 2 3 4 5 ## æ£€æµ‹ Intel æ ¸æ˜¾ lspci | grep -i \u0026#34;HD Graphics\u0026#34; ## æ£€æµ‹æ‰€æœ‰æ˜¾å¡è®¾å¤‡ lspci | grep -i \u0026#34;VGA\\|Display\u0026#34; è¾“å‡ºç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 root@pve:~# lspci | grep -i \u0026#34;HD Graphics\u0026#34; 00:02.0 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.1 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.2 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.3 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.4 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.5 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.6 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] 00:02.7 VGA compatible controller: Intel Corporation Alder Lake-N [UHD Graphics] äº”ã€æŸ¥çœ‹æ ¸æ˜¾ä½¿ç”¨ç‡ ğŸ› ï¸ å®‰è£… Intel GPU å®˜æ–¹å·¥å…· 1 apt install intel-gpu-tools æŸ¥çœ‹ Intel æ ¸æ˜¾ä½¿ç”¨ç‡ 1 intel_gpu_top -d sriov å…­ã€ğŸ—‘ï¸ å¸è½½æ—§å†…æ ¸ 1 2 3 4 5 6 7 8 9 ## CDN åŠ é€Ÿåœ°å€ wget -q -O /root/pve_source.tar.gz \u0026#39;https://cdn.jsdelivr.net/gh/meimolihan/file@v1.0.0/pve/pve_source.tar.gz\u0026#39; \u0026amp;\u0026amp; \\ tar zxvf /root/pve_source.tar.gz \u0026amp;\u0026amp; \\ /root/./pve_source ## vercel åŠ é€Ÿåœ°å€ wget -q -O /root/pve_source.tar.gz \u0026#39;http://file.meimolihan.eu.org/pve/pve_source.tar.gz\u0026#39; \u0026amp;\u0026amp; \\ tar zxvf /root/pve_source.tar.gz \u0026amp;\u0026amp; \\ /root/./pve_source ğŸ’¡ æ³¨æ„äº‹é¡¹ æ“ä½œå‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®ï¼Œé¿å…æ„å¤–æƒ…å†µå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ è‹¥ä½¿ç”¨çš„æ˜¯å…¶ä»–å‹å· Intel æ ¸æ˜¾ï¼Œè¯·ç¡®è®¤å…¶æ˜¯å¦æ”¯æŒ SR-IOV åŠŸèƒ½ã€‚ å¯è®¿é—® i915-sriov-dkms GitHub é¡µé¢ è·å–æœ€æ–°ç‰ˆæœ¬é©±åŠ¨å’Œè¯¦ç»†è¯´æ˜ã€‚ ğŸ‰ æ­å–œï¼ä½ å·²æˆåŠŸå‡çº§ PVE9 å†…æ ¸å¹¶å¯ç”¨ Intel æ ¸æ˜¾ SR-IOV åŠŸèƒ½ã€‚ç°åœ¨å¯ä»¥å°½æƒ…äº«å—æ›´é«˜æ€§èƒ½çš„è™šæ‹ŸåŒ–ä½“éªŒå•¦ï¼\n","date":"2025-09-05T16:11:20+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/a928f51f/","title":"Proxmox VE 9 å‡çº§å†…æ ¸å¹¶å¯ç”¨ Intel æ ¸æ˜¾çš„ SR-IOV ğŸš€"},{"content":"Debian 13 ä¸­æ–‡è¯­è¨€ç¯å¢ƒé…ç½®æŒ‡å— ğŸŒ ä¸€ä»½å®Œæ•´çš„ Debian 13 ä¸­æ–‡è¯­è¨€ç¯å¢ƒé…ç½®æŒ‡å—ï¼Œæ¶µç›–å­—ä½“å®‰è£…ã€è¯­è¨€è®¾ç½®ã€æ—¶åŒºé…ç½®å’Œå¸¸è§é—®é¢˜è§£å†³ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ“¦ æ­£ç¡®å®‰è£…ä¸­æ–‡å­—ä½“ ğŸ” éªŒè¯å­—ä½“å®‰è£…ç»“æœ âš™ï¸ ä¸­æ–‡ç¯å¢ƒé…ç½® ğŸ”„ æ›´æ–°æºæç¤ºå¤„ç† ğŸ“ å­—ä½“ä½¿ç”¨ç¤ºä¾‹ ğŸ› ï¸ å¼ºåˆ¶é‡æ–°ç”Ÿæˆä¸­æ–‡ UTF-8 å­—ç¬¦é›† ğŸ—‚ï¸ å­—ä½“ç¼“å­˜æ›´æ–° âœ… æ€»ç»“ ğŸ“¦ æ­£ç¡®å®‰è£…ä¸­æ–‡å­—ä½“ åœ¨ Debian 13 ä¸­ï¼Œæ–‡æ³‰é©¿å¾®ç±³é»‘å­—ä½“åŒ…çš„åç§°å·²å˜æ›´ä¸º fonts-wqy-microheiï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\n1 sudo apt update \u0026amp;\u0026amp; sudo apt install fonts-wqy-microhei -y ğŸ’¡ æç¤ºï¼šå»ºè®®åŒæ—¶å®‰è£…å…¶ä»–å¸¸ç”¨ä¸­æ–‡å­—ä½“ä»¥è·å¾—æ›´å®Œæ•´çš„ä¸­æ–‡æ˜¾ç¤ºæ”¯æŒ\nğŸ” éªŒè¯å­—ä½“å®‰è£…ç»“æœ å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯å­—ä½“æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š\n1 fc-list | grep -i wqy é¢„æœŸè¾“å‡ºåº”åŒ…å«ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š\n1 /usr/share/fonts/truetype/wqy/wqy-microhei.ttc: æ–‡æ³‰é©¿å¾®ç±³é»‘,æ–‡æ³‰é©¿ç­‰å®½å¾®ç±³é»‘:style=Regular âš™ï¸ ä¸­æ–‡ç¯å¢ƒé…ç½® å¦‚æœéœ€è¦åœ¨ç³»ç»Ÿä¸­å®Œå…¨æ”¯æŒä¸­æ–‡æ˜¾ç¤ºï¼Œå»ºè®®å®‰è£…é¢å¤–çš„ä¸­æ–‡å­—ä½“å’Œè¯­è¨€åŒ…ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # å®‰è£…å¸¸ç”¨ä¸­æ–‡å­—ä½“åŒ… sudo apt install fonts-wqy-zenhei fonts-wqy-microhei fonts-noto-cjk -y # é…ç½®ä¸­æ–‡è¯­è¨€ç¯å¢ƒ sudo dpkg-reconfigure locales # è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·ï¼ˆAsia/Shanghaiï¼‰ sudo timedatectl set-timezone Asia/Shanghai # éªŒè¯æ—¶åŒºè®¾ç½® timedatectl | grep \u0026#34;Time zone\u0026#34; åœ¨ dpkg-reconfigure locales è¿‡ç¨‹ä¸­ï¼Œè¯·ç¡®ä¿é€‰æ‹©ä»¥ä¸‹è¯­è¨€ç¯å¢ƒï¼š\nzh_CN.UTF-8 UTF-8 zh_CN.GBK GBK (å¯é€‰) ğŸ”„ æ›´æ–°æºæç¤ºå¤„ç† ç³»ç»Ÿæç¤º apt modernize-sourcesï¼Œè¿™æ˜¯ Debian 13 çš„æ–°ç‰¹æ€§ï¼Œå»ºè®®æ›´æ–°è½¯ä»¶æºæ ¼å¼ä»¥æå‡æ€§èƒ½ï¼š\n1 sudo apt modernize-sources æ­¤å‘½ä»¤ä¼šå°†ä¼ ç»Ÿçš„ sources.list æ ¼å¼è½¬æ¢ä¸ºæ–°çš„ sources.list.d/ ç›®å½•ç»“æ„ï¼Œæé«˜è½¯ä»¶æºç®¡ç†çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nğŸ“ å­—ä½“ä½¿ç”¨ç¤ºä¾‹ å®‰è£…å­—ä½“åï¼Œä¸­æ–‡åº”ç”¨ç¨‹åºï¼ˆå¦‚ Firefoxã€LibreOffice ç­‰ï¼‰åº”èƒ½æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ echo å‘½ä»¤æµ‹è¯•ï¼š\n1 echo \u0026#34;è¿™æ˜¯ä¸€æ®µä¸­æ–‡æµ‹è¯•æ–‡æœ¬ - æ–‡æ³‰é©¿å¾®ç±³é»‘å­—ä½“æ˜¾ç¤ºæµ‹è¯•\u0026#34; æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„ä¸­æ–‡å­—ä½“ï¼š\n1 fc-list :lang=zh ğŸ› ï¸ å¼ºåˆ¶é‡æ–°ç”Ÿæˆä¸­æ–‡ UTF-8 å­—ç¬¦é›† å¦‚æœé‡åˆ°ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ï¼Œå¯ä»¥å¼ºåˆ¶é‡æ–°ç”Ÿæˆå­—ç¬¦é›†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # ç¡®ä¿ä¸­æ–‡ UTF-8 è¢«å¯ç”¨ echo \u0026#34;zh_CN.UTF-8 UTF-8\u0026#34; | sudo tee -a /etc/locale.gen echo \u0026#34;zh_CN.GBK GBK\u0026#34; | sudo tee -a /etc/locale.gen # å¯é€‰ï¼Œæ”¯æŒ GBK ç¼–ç  # é‡æ–°ç”Ÿæˆæ‰€æœ‰å­—ç¬¦é›† sudo locale-gen --purge zh_CN.UTF-8 zh_CN.GBK # è®¾ç½®ç³»ç»Ÿé»˜è®¤å­—ç¬¦é›† sudo update-locale LANG=zh_CN.UTF-8 LANGUAGE=\u0026#34;zh_CN:zh\u0026#34; LC_ALL=zh_CN.UTF-8 # åº”ç”¨æ›´æ”¹ source /etc/default/locale ğŸ—‚ï¸ å­—ä½“ç¼“å­˜æ›´æ–° å¦‚æœå®‰è£…åä¸­æ–‡ä»æ˜¾ç¤ºå¼‚å¸¸ï¼Œå¯å°è¯•åˆ·æ–°å­—ä½“ç¼“å­˜ï¼š\n1 2 3 4 5 # å¼ºåˆ¶åˆ·æ–°å­—ä½“ç¼“å­˜ sudo fc-cache -f -v # æŸ¥çœ‹å­—ä½“ç¼“å­˜çŠ¶æ€ fc-cache -s âœ… æ€»ç»“ Debian 13 ä¸­çš„æ–‡æ³‰é©¿å¾®ç±³é»‘å­—ä½“åŒ…åç§°å·²ä» ttf-wqy-microhei å˜æ›´ä¸º fonts-wqy-microheiã€‚ä½¿ç”¨æ–°åç§°å®‰è£…å³å¯è§£å†³é—®é¢˜ã€‚\nğŸ¯ å…³é”®ç‚¹å›é¡¾ï¼š ğŸ“¦ ä½¿ç”¨ fonts-wqy-microhei åŒ…åå®‰è£…æ–‡æ³‰é©¿å¾®ç±³é»‘å­—ä½“ ğŸŒ é…ç½®å®Œæ•´çš„è¯­è¨€ç¯å¢ƒæ”¯æŒ (zh_CN.UTF-8) ğŸ• è®¾ç½®æ­£ç¡®çš„æ—¶åŒº (Asia/Shanghai) ğŸ”„ è€ƒè™‘ä½¿ç”¨ apt modernize-sources ä¼˜åŒ–è½¯ä»¶æºç®¡ç† ğŸ”§ å¦‚é‡æ˜¾ç¤ºé—®é¢˜ï¼Œå¯é‡æ–°ç”Ÿæˆå­—ç¬¦é›†å’Œå­—ä½“ç¼“å­˜ å¦‚æœéœ€è¦æ›´å…¨é¢çš„ä¸­æ–‡æ”¯æŒï¼Œå»ºè®®åŒæ—¶å®‰è£…å…¶ä»–ä¸­æ–‡å­—ä½“ï¼ˆå¦‚ fonts-wqy-zenhei å’Œ fonts-noto-cjkï¼‰å¹¶é…ç½®å®Œæ•´çš„è¯­è¨€ç¯å¢ƒã€‚\nè¿™ä»½æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Debian 13 ä¸Šè·å¾—å®Œæ•´çš„ä¸­æ–‡æ”¯æŒï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ Debian å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚ğŸ§\n","date":"2025-09-05T14:49:18+08:00","image":"https://file.meimolihan.eu.org/img/debian-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f50adc44/","title":"Debian 13 ä¸­æ–‡è¯­è¨€ç¯å¢ƒé…ç½®æŒ‡å— ğŸŒ"},{"content":"FnOS ç³»ç»Ÿé…ç½®æŒ‡å— ğŸ‚ ä¸€ä»½è¯¦å°½çš„é£ç‰›(FnOS)ç³»ç»Ÿé…ç½®è®°å½•ï¼Œæ¶µç›–SSHè®¾ç½®ã€ç¡¬ä»¶ç›´é€šã€NFSå…±äº«ã€è¯ä¹¦ç”³è¯·ã€Gitä»“åº“ç®¡ç†åŠDockerå·¥å…·é…ç½®ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ” é£ç‰› SSH å¼€å¯ ROOT ç”¨æˆ·ç™»å½• ğŸ”§ é£ç‰›è™šæ‹Ÿæœº IOMMU ç¡¬ä»¶ç›´é€š ğŸ“ é£ç‰› NFS å…±äº«é…ç½® ğŸ”’ Certbot ç”³è¯· SSL è¯ä¹¦ ğŸ™ é£ç‰› Gitee ä»“åº“ç®¡ç† ğŸ³ é£ç‰›å®‰è£… Docker Compose ğŸŒ TMDB Hosts åŒæ­¥é…ç½® ğŸ” é£ç‰› SSH å¼€å¯ ROOT ç”¨æˆ·ç™»å½• 1. è®¾ç½® ROOT å¯†ç  1 2 sudo -i sudo passwd root 2. ä¿®æ”¹ SSH é…ç½® 1 2 3 4 5 6 7 8 sudo sed -i \\ -e \u0026#39;s/#Port 22/Port 22/\u0026#39; \\ # ğŸšª å¯ç”¨å¹¶ä¿æŒé»˜è®¤SSHç«¯å£22 -e \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/\u0026#39; \\ # ğŸ‘‘ å…è®¸rootç”¨æˆ·ç›´æ¥ç™»å½• -e \u0026#39;s/#GSSAPIAuthentication no/GSSAPIAuthentication no/\u0026#39; \\ # ğŸ”’ ç¦ç”¨GSSAPIè®¤è¯ -e \u0026#39;s/#UseDNS no/UseDNS no/\u0026#39; \\ # ğŸŒ ç¦ç”¨DNSåå‘è§£æï¼ŒåŠ é€Ÿè¿æ¥ -e \u0026#39;s/#ClientAliveInterval 0/ClientAliveInterval 10/\u0026#39; \\ # â±ï¸ è®¾ç½®å®¢æˆ·ç«¯æ´»åŠ¨æ£€æŸ¥é—´éš”ä¸º10ç§’ -e \u0026#39;s/#ClientAliveCountMax 3/ClientAliveCountMax 999/\u0026#39; \\ # â™¾ï¸ å¤§å¹…å¢åŠ å®¢æˆ·ç«¯æ´»åŠ¨æ£€æŸ¥æœ€å¤§æ¬¡æ•° /etc/ssh/sshd_config 3. æŸ¥çœ‹ä¿®æ”¹æ˜¯å¦æˆåŠŸ 1 grep -E \u0026#39;Port 22|PermitRootLogin|GSSAPIAuthentication|UseDNS|ClientAliveInterval|ClientAliveCountMax\u0026#39; /etc/ssh/sshd_config 4. é‡å¯ SSH æœåŠ¡ 1 systemctl restart ssh \u0026amp;\u0026amp; hostname -I | awk \u0026#39;{print $1}\u0026#39; ğŸ’¡ æç¤ºï¼šå¯ç”¨Rootç™»å½•åï¼Œå¯ç›´æ¥ä½¿ç”¨FinalShellç­‰SSHå·¥å…·ä»¥rootç”¨æˆ·ç™»å½•ï¼Œæ— éœ€æ¯æ¬¡è¾“å…¥sudo -i\nğŸ”§ é£ç‰›è™šæ‹Ÿæœº IOMMU ç¡¬ä»¶ç›´é€š 1. ä¿®æ”¹ GRUB é…ç½® 1 nano /etc/default/grub ä¿®æ”¹å¯åŠ¨å‚æ•°ï¼š\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet i915.force_probe=7d55 intel_iommu=on iommu=pt\u0026#34; 2. æ›´æ–° GRUB é…ç½® 1 update-grub \u0026amp;\u0026amp; update-initramfs -u -k all 3. é‡å¯ç³»ç»Ÿ 1 reboot ğŸ“¸ æ•ˆæœå±•ç¤ºï¼š ğŸ“ é£ç‰› NFS å…±äº«é…ç½® 1. é£ç‰›åå° NFS é…ç½® è®°å½• IP åœ°å€å’Œè·¯å¾„ï¼š10.10.10.254/fs/1000/nfs\n2. Debian æŒ‚è½½é£ç‰› NFS å…±äº« å®‰è£… NFS å®¢æˆ·ç«¯ 1 sudo apt update \u0026amp;\u0026amp; sudo apt install nfs-common -y åˆ›å»ºæŒ‚è½½ç›®å½• 1 mkdir -p /mnt/fnos-nfs ä¸´æ—¶æŒ‚è½½ NFS å…±äº« 1 mount -t nfs -o rw 10.10.10.254:/fs/1000/nfs /mnt/fnos-nfs éªŒè¯æŒ‚è½½ç»“æœ 1 df -hT /mnt/fnos-nfs ä¸€é”®æŒ‚è½½å‘½ä»¤ 1 mkdir -p /mnt/fnos-nfs \u0026amp;\u0026amp; mount -t nfs -o rw 10.10.10.254:/fs/1000/nfs /mnt/fnos-nfs \u0026amp;\u0026amp; df -hT /mnt/fnos-nfs æ°¸ä¹…æŒ‚è½½é…ç½® 1 2 echo \u0026#34;10.10.10.254:/fs/1000/nfs /mnt/fnos-nfs nfs defaults,_netdev 0 0\u0026#34; | sudo tee -a /etc/fstab sudo mount -a ğŸ”’ Certbot ç”³è¯· SSL è¯ä¹¦ 1. å®‰è£… Certbot 1 sudo apt update \u0026amp;\u0026amp; sudo apt install certbot python3-certbot-dns-cloudflare -y 2. éªŒè¯å®‰è£… 1 certbot --version è·å– Cloudflare API Token 3. åˆ›å»ºè®¤è¯é…ç½®æ–‡ä»¶ 1 2 3 4 5 sudo mkdir -p /etc/letsencrypt sudo tee /etc/letsencrypt/cloudflare.ini \u0026gt; /dev/null \u0026lt;\u0026lt;EOF dns_cloudflare_api_token = ä½ çš„api_token EOF sudo chmod 600 /etc/letsencrypt/cloudflare.ini 4. ç”³è¯·è¯ä¹¦ 1 2 3 4 5 6 sudo certbot certonly \\ --dns-cloudflare \\ --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini \\ --dns-cloudflare-propagation-seconds 60 \\ -d example.com \\ -d *.example.com 5. éƒ¨ç½²è¯ä¹¦åˆ° Nginx 1 2 3 sudo cp /etc/letsencrypt/live/example.com/fullchain.pem /etc/nginx/ssl/cert.pem sudo cp /etc/letsencrypt/live/example.com/privkey.pem /etc/nginx/ssl/key.pem sudo systemctl restart nginx ğŸ“– è¯¦ç»†æ•™ç¨‹ï¼š Certbot å®Œæ•´æŒ‡å— ğŸ™ é£ç‰› Gitee ä»“åº“ç®¡ç† 1. Gitee ä»“åº“åˆ›å»º 2. Git å…¨å±€è®¾ç½® 1 2 git config --global user.name \u0026#34;meimolihan\u0026#34; git config --global user.email \u0026#34;meimolihan@gmail.com\u0026#34; 3. ç”Ÿæˆ SSH å¯†é’¥ 1 2 ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; cat ~/.ssh/id_ed25519.pub 4. åˆå§‹åŒ–å¹¶æ¨é€ä»“åº“ 1 2 3 4 5 6 7 cd /vol1/1000/docker/random-pic-api git init git config --global --add safe.directory /vol1/1000/docker/random-pic-api git add . git commit -m \u0026#34;first commit\u0026#34; git remote add origin git@gitee.com:meimolihan/random-pic-api.git git push -u origin \u0026#34;master\u0026#34; 5. è‡ªåŠ¨åŒ–æ¨é€è„šæœ¬ 1 2 3 4 5 6 7 8 cat \u0026gt; /vol1/1000/docker/random-pic-api/gitee-push.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash cd \u0026#34;$(dirname \u0026#34;$0\u0026#34;)\u0026#34; git add . git commit -m \u0026#34;è‡ªåŠ¨æäº¤: $(date +\u0026#39;%Y-%m-%d %H:%M:%S\u0026#39;)\u0026#34; git push EOF chmod +x /vol1/1000/docker/random-pic-api/gitee-push.sh ğŸ³ é£ç‰›å®‰è£… Docker Compose 1. å®‰è£… Docker Compose 1 2 sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.35.1/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose 2. éªŒè¯å®‰è£… 1 docker-compose --version 3. å›½å†…é•œåƒåŠ é€Ÿå®‰è£… 1 2 sudo curl -L \u0026#34;https://mirror.azure.cn/docker-toolbox/linux/compose/$(curl -s https://mirror.azure.cn/docker-toolbox/linux/compose/latest)/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose ğŸŒ TMDB Hosts åŒæ­¥é…ç½® 1. å®‰è£… Python3 1 sudo apt update \u0026amp;\u0026amp; sudo apt install python3 python3-pip -y 2. ä¸‹è½½ DNS è§£æè„šæœ¬ 1 2 3 mkdir -p /vol1/1000/home/nastools/tmdb-hosts wget -O /vol1/1000/home/nastools/tmdb-hosts/DnsParse.py https://cdn.meimolihan.eu.org/hexo/fnos/hosts/DnsParse.py chmod +x /vol1/1000/home/nastools/tmdb-hosts/DnsParse.py 3. æ‰‹åŠ¨æ‰§è¡ŒåŒæ­¥ 1 /usr/bin/python3 /vol1/1000/home/nastools/tmdb-hosts/DnsParse.py 4. éªŒè¯åŒæ­¥ç»“æœ 1 cat /etc/hosts | grep -A5 -B5 \u0026#34;tmdb\u0026#34; 5. è®¾ç½®å®šæ—¶ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # æ·»åŠ æ›´æ–°hostsæ–‡ä»¶å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹ååˆ†æ‰§è¡Œ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;10 1 * * * /usr/bin/python3 /vol1/1000/home/nastools/tmdb-hosts/DnsParse.py\u0026#34;) | crontab - # hostsæ–‡ä»¶åŒæ­¥åˆ°embyï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹åäº”åˆ†æ‰§è¡Œ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;15 1 * * * rsync -avhz --delete /etc/hosts /vol1/1000/home/emby/config/hosts\u0026#34;) | crontab - # hostsæ–‡ä»¶åŒæ­¥åˆ°nastoolsï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹äºŒååˆ†æ‰§è¡Œ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;20 1 * * * rsync -avhz --delete /etc/hosts /vol1/1000/home/nastools/config/hosts\u0026#34;) | crontab - # æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ crontab -l 6. ç¼–è¾‘å®šæ—¶ä»»åŠ¡ 1 crontab -e ğŸ”— ç›¸å…³èµ„æºï¼š GitHubé¡¹ç›®åœ°å€ è¿™ä»½FnOSé…ç½®æŒ‡å—å°†æŒç»­æ›´æ–°ï¼Œæ¬¢è¿è´¡çŒ®æ‚¨çš„ä½¿ç”¨ç»éªŒï¼ğŸ‚\n","date":"2025-09-05T14:38:49+08:00","image":"https://file.meimolihan.eu.org/img/fnos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/abecdb9f/","title":"FnOS ç³»ç»Ÿé…ç½®æŒ‡å— ğŸ‚"},{"content":"Debian 13 ç³»ç»Ÿé…ç½®æŒ‡å— ğŸ§ ä¸€ä»½è¯¦å°½çš„ Debian 13 ç³»ç»Ÿé…ç½®è®°å½•ï¼Œæ¶µç›–ç½‘ç»œè®¾ç½®ã€è½¯ä»¶å®‰è£…ã€æœåŠ¡é…ç½®åŠæ•…éšœæ’æŸ¥ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸŒŸ Debian 13 ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ› ï¸ Debian13 å®‰è£…å¸¸ç”¨è½¯ä»¶ ğŸŒ Debian13 ä¿®æ”¹é™æ€ IP åœ°å€ ğŸ” Debian13 é…ç½® SSH æœåŠ¡ ğŸš€ Debian13 æ¢å›½å†…æº ğŸ“ Debian13 é…ç½® Samba æœåŠ¡ ğŸ”— Debian13 é…ç½® NFS æœåŠ¡ ğŸ”§ Debian ä¸º NFS æœåŠ¡ç«¯é…ç½® ğŸ’» Debian ä¸º NFS å®¢æˆ·ç«¯é…ç½® ğŸ“Š æŸ¥çœ‹ä¸éªŒè¯ NFS å…±äº« âš ï¸ Debian13 æ–‡ä»¶ç³»ç»Ÿåªè¯»ä¿®å¤ ğŸŒŸ Debian 13 ç‰¹ç‚¹ä¸åŠŸèƒ½ Debian 13 \u0026ldquo;Trixie\u0026rdquo; æ˜¯ä¸€ä¸ªç¨³å®šã€å¯é çš„ Linux å‘è¡Œç‰ˆï¼Œé€‚åˆæœåŠ¡å™¨å’Œæ¡Œé¢ä½¿ç”¨ã€‚ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š\nğŸ§ å¼€æºå…è´¹ï¼šå®Œå…¨å…è´¹ä¸”å¼€æ”¾æºä»£ç  ğŸ›¡ï¸ å®‰å…¨ç¨³å®šï¼šé•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œæä¾›å®‰å…¨æ›´æ–° ğŸ“¦ è½¯ä»¶ä¸°å¯Œï¼šæ‹¥æœ‰è¶…è¿‡ 60,000 ä¸ªè½¯ä»¶åŒ… ğŸ”§ é«˜åº¦å¯å®šåˆ¶ï¼šå¯æ ¹æ®éœ€æ±‚çµæ´»é…ç½®ç³»ç»Ÿ ğŸŒ å¤šæ¶æ„æ”¯æŒï¼šæ”¯æŒ x86ã€ARMã€RISC-V ç­‰å¤šç§æ¶æ„ ğŸ‹ å®¹å™¨å‹å¥½ï¼šæ”¹è¿›çš„å®¹å™¨å’Œè™šæ‹ŸåŒ–æ”¯æŒ ğŸ› ï¸ Debian13 å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 # æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…å¸¸ç”¨å·¥å…· apt update -y \u0026amp;\u0026amp; apt install -y rsync sudo curl wget vim tree samba nfs-common openssh-server zip unzip htop net-tools bpytop è¿™äº›å·¥å…·åŒ…å«ï¼š\nğŸ“ æ–‡ä»¶ç®¡ç†ï¼šrsync, tree, zip, unzip ğŸŒ ç½‘ç»œå·¥å…·ï¼šcurl, wget, net-tools ğŸ” è¿œç¨‹è®¿é—®ï¼šopenssh-server ğŸ’¾ å…±äº«æœåŠ¡ï¼šsamba, nfs-common ğŸ“Š ç³»ç»Ÿç›‘æ§ï¼šhtop, bpytop ğŸŒ Debian13 ä¿®æ”¹é™æ€ IP åœ°å€ 1. æŸ¥çœ‹å½“å‰ç½‘ç»œæ¥å£ 1 ip address 2. ä½¿ç”¨ Netplan ä¿®æ”¹ç½‘ç»œé…ç½® (Debian 13 é»˜è®¤) 1 nano /etc/network/interfaces interfacesåŸæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 # æ­¤æ–‡ä»¶æè¿°äº†æ‚¨çš„ç³»ç»Ÿä¸Šå¯ç”¨çš„ç½‘ç»œæ¥å£ source /etc/network/interfaces.d/* â€‹ # å›ç¯ç½‘ç»œæ¥å£ auto lo iface lo inet loopback â€‹ # ä¸»ç½‘ç»œæ¥å£ allow-hotplug ens18 iface ens18 inet dhcp ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 # æ­¤æ–‡ä»¶æè¿°äº†æ‚¨çš„ç³»ç»Ÿä¸Šå¯ç”¨çš„ç½‘ç»œæ¥å£ source /etc/network/interfaces.d/* â€‹ # å›ç¯ç½‘ç»œæ¥å£ auto lo iface lo inet loopback â€‹ # ä¸»ç½‘ç»œæ¥å£ allow-hotplug ens18 iface ens18 inet static address 10.10.10.246 netmask 255.255.255.0 gateway 10.10.10.253 åº”ç”¨ç½‘ç»œé…ç½® 1 sudo systemctl restart networking ğŸ” Debian13 é…ç½® SSH æœåŠ¡ 1. å®‰è£…ä¸å¯ç”¨ SSH 1 2 3 4 sudo apt update \u0026amp;\u0026amp; \\ sudo apt install openssh-server \u0026amp;\u0026amp; \\ sudo systemctl start ssh \u0026amp;\u0026amp; \\ sudo systemctl enable ssh 2. ä¼˜åŒ– SSH é…ç½® 1 2 3 4 5 6 7 8 9 sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup \u0026amp;\u0026amp; \\ sudo sed -i \\ -e \u0026#39;s/#Port 22/Port 22/\u0026#39; \\ # ğŸšª å¯ç”¨å¹¶ä¿æŒé»˜è®¤SSHç«¯å£22 -e \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/\u0026#39; \\ # ğŸ‘‘ å…è®¸rootç”¨æˆ·ç›´æ¥ç™»å½• -e \u0026#39;s/#GSSAPIAuthentication no/GSSAPIAuthentication no/\u0026#39; \\ # ğŸ”’ ç¦ç”¨GSSAPIè®¤è¯ -e \u0026#39;s/#UseDNS no/UseDNS no/\u0026#39; \\ # ğŸŒ ç¦ç”¨DNSåå‘è§£æï¼ŒåŠ é€Ÿè¿æ¥ -e \u0026#39;s/#ClientAliveInterval 0/ClientAliveInterval 10/\u0026#39; \\ # â±ï¸ è®¾ç½®å®¢æˆ·ç«¯æ´»åŠ¨æ£€æŸ¥é—´éš”ä¸º10ç§’ -e \u0026#39;s/#ClientAliveCountMax 3/ClientAliveCountMax 999/\u0026#39; \\ # â™¾ï¸ å¤§å¹…å¢åŠ å®¢æˆ·ç«¯æ´»åŠ¨æ£€æŸ¥æœ€å¤§æ¬¡æ•° /etc/ssh/sshd_config 3. æŸ¥çœ‹ä¿®æ”¹æ˜¯å¦æˆåŠŸ 1 grep -E \u0026#39;Port 22|PermitRootLogin|GSSAPIAuthentication|UseDNS|ClientAliveInterval|ClientAliveCountMax\u0026#39; /etc/ssh/sshd_config 4. é‡å¯ SSH æœåŠ¡ 1 2 systemctl restart ssh \u0026amp;\u0026amp; \\ hostname -I | awk \u0026#39;{print $1}\u0026#39; ğŸš€ Debian13 æ¢å›½å†…æº 1. å¤‡ä»½åŸæœ‰æºåˆ—è¡¨ 1 sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak 2. é˜¿é‡Œäº‘é•œåƒæº 1 2 3 4 5 6 7 8 9 10 sudo tee /etc/apt/sources.list \u0026gt; /dev/null \u0026lt;\u0026lt;EOF deb https://mirrors.aliyun.com/debian/ trixie main non-free non-free-firmware contrib deb-src https://mirrors.aliyun.com/debian/ trixie main non-free non-free-firmware contrib deb https://mirrors.aliyun.com/debian-security/ trixie-security main deb-src https://mirrors.aliyun.com/debian-security/ trixie-security main deb https://mirrors.aliyun.com/debian/ trixie-updates main non-free non-free-firmware contrib deb-src https://mirrors.aliyun.com/debian/ trixie-updates main non-free non-free-firmware contrib deb https://mirrors.aliyun.com/debian/ trixie-backports main non-free non-free-firmware contrib deb-src https://mirrors.aliyun.com/debian/ trixie-backports main non-free non-free-firmware contrib EOF 3. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ 1 sudo apt update \u0026amp;\u0026amp; sudo apt full-upgrade -y ğŸ’¡ æç¤ºï¼šä¹Ÿå¯é€‰æ‹©æ¸…åå¤§å­¦ã€ç½‘æ˜“ã€è…¾è®¯äº‘æˆ–ä¸­ç§‘å¤§é•œåƒæºï¼Œæ›¿æ¢ç›¸åº”URLå³å¯ã€‚\nğŸ“ Debian13 é…ç½® Samba æœåŠ¡ 1. å®‰è£… Samba 1 2 3 4 sudo apt update \u0026amp;\u0026amp; \\ sudo apt install samba \u0026amp;\u0026amp; \\ sudo systemctl enable smb \u0026amp;\u0026amp; \\ sudo systemctl start smbd 2. åˆ›å»º Samba ç”¨æˆ· 1 2 sudo useradd -m admin \u0026amp;\u0026amp; \\ sudo smbpasswd -a admin 3. ä¸€é”®éƒ¨ç½² Samba å…±äº« 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 sudo mkdir -pm 777 /mnt/test \u0026amp;\u0026amp; \\ sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Debian] comment = Debian 13 Samba Share path = /mnt/test browseable = yes read only = no create mask = 0775 directory mask = 0775 valid users = admin force user = admin force group = admin EOF # ä¿®æ”¹ password ä¸º samba å¯†ç  sudo useradd -m admin \u0026amp;\u0026amp; \\ (echo \u0026#34;password\u0026#34;; echo \u0026#34;password\u0026#34;) | sudo smbpasswd -a -s admin \u0026amp;\u0026amp; \\ sudo systemctl restart smbd ğŸ”— Debian13 é…ç½® NFS æœåŠ¡ 1. ğŸ”§ Debian ä¸º NFS æœåŠ¡ç«¯é…ç½® å®‰è£… NFS æœåŠ¡å™¨ 1 sudo apt update \u0026amp;\u0026amp; sudo apt install nfs-kernel-server nfs-common -y é…ç½® NFS å…±äº« 1 2 3 4 5 sudo mkdir -p /srv/nfs/share \u0026amp;\u0026amp; sudo chmod 755 /srv/nfs/share sudo tee /etc/exports \u0026gt; /dev/null \u0026lt;\u0026lt;EOF /srv/nfs/share *(rw,sync,no_subtree_check,no_root_squash) EOF åº”ç”¨é…ç½®å¹¶å¯åŠ¨æœåŠ¡ 1 2 3 sudo exportfs -ra sudo systemctl start nfs-server sudo systemctl enable nfs-server 2. ğŸ’» Debian ä¸º NFS å®¢æˆ·ç«¯é…ç½® æŸ¥çœ‹å¯ç”¨ NFS å…±äº« 1 sudo showmount -e 10.10.10.251 ä¸´æ—¶æŒ‚è½½ NFS å…±äº« 1 2 sudo mkdir -p /mnt/nfs-share sudo mount -t nfs -o rw 10.10.10.251:/srv/nfs/share /mnt/nfs-share æ°¸ä¹…æŒ‚è½½ NFS å…±äº« 1 2 echo \u0026#34;10.10.10.251:/srv/nfs/share /mnt/nfs-share nfs defaults,_netdev 0 0\u0026#34; | sudo tee -a /etc/fstab sudo mount -a 3. ğŸ“Š æŸ¥çœ‹ä¸éªŒè¯ NFS å…±äº« æŸ¥çœ‹å·²æŒ‚è½½çš„ NFS å…±äº« 1 mount | grep nfs å–æ¶ˆ NFS æŒ‚è½½ 1 sudo umount /mnt/nfs-share æŸ¥çœ‹ NFS æ—¥å¿— 1 sudo journalctl -u nfs-server -f âš ï¸ Debian13 æ–‡ä»¶ç³»ç»Ÿåªè¯»ä¿®å¤ å½“æ–‡ä»¶ç³»ç»Ÿæ„å¤–å˜ä¸ºåªè¯»æ¨¡å¼æ—¶ï¼Œå¯æŒ‰ä»¥ä¸‹æ­¥éª¤ä¿®å¤ï¼š\n1. æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ 1 sudo dmesg | grep \u0026#34;read-only\u0026#34; 2. é‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ 1 sudo mount -o remount,rw / 3. æ£€æŸ¥å¹¶ä¿®å¤æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ 1 sudo fsck -y /dev/sda1 # è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åˆ†åŒº 4. ç¼–è¾‘ fstab æ–‡ä»¶ 1 sudo nano /etc/fstab ç¡®ä¿æ ¹åˆ†åŒºæŒ‚è½½é€‰é¡¹åŒ…å« rw è€Œä¸æ˜¯ roï¼š\n1 2 3 4 5 # ä¿®æ”¹å‰ UUID=xxxx-xxxx-xxxx / ext4 defaults,ro 0 1 # ä¿®æ”¹å UUID=xxxx-xxxx-xxxx / ext4 defaults,rw 0 1 5. éªŒè¯åˆ†åŒº UUID 1 sudo blkid 6. é‡å¯ç³»ç»Ÿ 1 sudo reboot 7. éªŒè¯ä¿®å¤ç»“æœ 1 findmnt -n -o OPTIONS / | grep -q rw \u0026amp;\u0026amp; echo \u0026#34;è¯»å†™æ¨¡å¼\u0026#34; || echo \u0026#34;åªè¯»æ¨¡å¼\u0026#34; ğŸ’¡ æç¤ºï¼šæ–‡ä»¶ç³»ç»Ÿå˜ä¸ºåªè¯»é€šå¸¸æ˜¯ç³»ç»Ÿæ£€æµ‹åˆ°ç£ç›˜é”™è¯¯æ—¶çš„ä¿æŠ¤æœºåˆ¶ï¼Œä¿®å¤åå»ºè®®æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ï¼š\n1 sudo smartctl -a /dev/sda # æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ è¿™ä»½é…ç½®æŒ‡å—å°†æŒç»­æ›´æ–°ï¼Œæ¬¢è¿è´¡çŒ®æ‚¨çš„ Debian ä½¿ç”¨ç»éªŒï¼ğŸ§\n","date":"2025-09-05T14:12:41+08:00","image":"https://file.meimolihan.eu.org/img/debian-01.webp","permalink":"https://blog.meimolihan.eu.org/p/6ff0f0c9/","title":"Debian 13 ç³»ç»Ÿé…ç½®æŒ‡å— ğŸ§"},{"content":"Docker \u0026amp; Nginx é…ç½®ç¼–è¾‘å™¨ ğŸ“‹ ä¸€ä¸ªç°ä»£åŒ–çš„ Web åº”ç”¨ï¼Œç”¨äºå¯è§†åŒ–ç¼–è¾‘ Docker Composeã€Dockerfile å’Œ Nginx é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ä¸°å¯Œçš„æ¨¡æ¿å’Œå‚æ•°åŒ–é…ç½®å¿«é€Ÿç”Ÿæˆä¸“ä¸šçš„å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ã€‚\nğŸŒŸ é¡¹ç›®ç‰¹ç‚¹ å¤šé…ç½®ç±»å‹æ”¯æŒï¼šå®Œæ•´æ”¯æŒ Docker Composeã€Dockerfile å’Œ Nginx ä¸‰ç§é…ç½®ç±»å‹\nä¸°å¯Œçš„æ¨¡æ¿åº“ï¼šå†…ç½®å¤šç§å¸¸ç”¨åœºæ™¯çš„é…ç½®æ¨¡æ¿ï¼Œä¸€é”®åº”ç”¨\nå¯è§†åŒ–å‚æ•°ç¼–è¾‘ï¼šé€šè¿‡ç‚¹å‡»æŒ‰é’®å¿«é€Ÿæ·»åŠ é…ç½®å‚æ•°ï¼Œæ— éœ€è®°å¿†å¤æ‚è¯­æ³•\nå®æ—¶é¢„è§ˆï¼šæ¨¡æ¿å†…å®¹é¢„è§ˆåŠŸèƒ½ï¼Œç¡®è®¤æ— è¯¯åå†åº”ç”¨\nä¸»é¢˜åˆ‡æ¢ï¼šæ”¯æŒæ·±è‰²/æµ…è‰²åŒä¸»é¢˜æ¨¡å¼ï¼Œé€‚åº”ä¸åŒä½¿ç”¨ç¯å¢ƒ\nå“åº”å¼è®¾è®¡ï¼šå®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡\næœ¬åœ°å­˜å‚¨ï¼šè‡ªåŠ¨ä¿å­˜ç¼–è¾‘å†…å®¹ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤±\nå¼€å±åŠ¨ç”»ï¼šä¸“ä¸šçš„åŠ è½½åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\nğŸ“ é¡¹ç›®ç»“æ„ .\nâ”œâ”€â”€ docker-compose.yml # é¡¹ç›®æœ¬èº«çš„ Docker éƒ¨ç½²é…ç½®\nâ”œâ”€â”€ html/ # å‰ç«¯èµ„æºç›®å½•\nâ”‚ â”œâ”€â”€ docker-compose-mould.js # Docker Compose æ¨¡æ¿æ•°æ®\nâ”‚ â”œâ”€â”€ docker-compose-parameter.js # Docker Compose å‚æ•°é…ç½®\nâ”‚ â”œâ”€â”€ dockerfile-mould.js # Dockerfile æ¨¡æ¿æ•°æ®\nâ”‚ â”œâ”€â”€ dockerfile-parameter.js # Dockerfile å‚æ•°é…ç½®\nâ”‚ â”œâ”€â”€ img/\nâ”‚ â”‚ â””â”€â”€ favicon.ico # ç½‘ç«™å›¾æ ‡\nâ”‚ â”œâ”€â”€ index.html # ä¸»é¡µé¢\nâ”‚ â”œâ”€â”€ nginx-mould.js # Nginx æ¨¡æ¿æ•°æ®\nâ”‚ â”œâ”€â”€ nginx-parameter.js # Nginx å‚æ•°é…ç½®\nâ”‚ â”œâ”€â”€ script.js # ä¸»é€»è¾‘è„šæœ¬\nâ”‚ â””â”€â”€ styles.css # æ ·å¼æ–‡ä»¶\nâ””â”€â”€ README.md # é¡¹ç›®è¯´æ˜æ–‡æ¡£\nğŸ› ï¸ åŠŸèƒ½æ¨¡å— 1. Docker Compose ç¼–è¾‘å™¨ æœåŠ¡é…ç½®ï¼ˆé•œåƒã€å®¹å™¨åç§°ã€é‡å¯ç­–ç•¥ç­‰ï¼‰\nç½‘ç»œé…ç½®ï¼ˆç½‘ç»œæ¨¡å¼ã€é©±åŠ¨è®¾ç½®ï¼‰\nå­˜å‚¨å·é…ç½®\nç¯å¢ƒå˜é‡ç®¡ç†\nä¾èµ–å…³ç³»é…ç½®\n2. Dockerfile ç¼–è¾‘å™¨ åŸºç¡€é•œåƒé€‰æ‹©ï¼ˆNode.js, Python, Java, Nginxç­‰ï¼‰\nå¸¸ç”¨æŒ‡ä»¤ï¼ˆWORKDIR, COPY, RUN, EXPOSE, CMDç­‰ï¼‰\nç¯å¢ƒå˜é‡é…ç½®\nç”¨æˆ·ç®¡ç†\nå…ƒæ•°æ®è®¾ç½®\n3. Nginx é…ç½®ç¼–è¾‘å™¨ æœåŠ¡å™¨å—é…ç½®\nä½ç½®å—å’Œè·¯ç”±è§„åˆ™\nåå‘ä»£ç†è®¾ç½®\nSSL/HTTPS é…ç½®\nè´Ÿè½½å‡è¡¡é…ç½®\nç¼“å­˜æ§åˆ¶å’Œè®¿é—®æ§åˆ¶\nğŸš€ å¿«é€Ÿå¼€å§‹ ä½¿ç”¨ Docker éƒ¨ç½² 1 2 3 4 5 6 7 8 # å…‹éš†é¡¹ç›® git clone git@gitee.com:meimolihan/nginx-dock-builder.git â€‹ # è¿›å…¥é¡¹ç›®ç›®å½• cd nginx-dock-builder â€‹ # å¯åŠ¨æœåŠ¡ docker-compose up -d è®¿é—® http://localhost:8286 å³å¯ä½¿ç”¨ç¼–è¾‘å™¨ã€‚\nç›´æ¥ä½¿ç”¨ ç›´æ¥æ‰“å¼€ html/index.html æ–‡ä»¶å³å¯åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ç¼–è¾‘å™¨ã€‚\nğŸ“‹ ä½¿ç”¨æ–¹æ³• é€‰æ‹©é…ç½®ç±»å‹ï¼šé€šè¿‡é¡¶éƒ¨æ ‡ç­¾åˆ‡æ¢ Docker Composeã€Dockerfile æˆ– Nginx ç¼–è¾‘å™¨\næµè§ˆæ¨¡æ¿ï¼šåœ¨å·¦ä¾§æ¨¡æ¿æ ä¸­é€‰æ‹©é€‚åˆçš„æ¨¡æ¿ç±»åˆ«å’Œå…·ä½“æ¨¡æ¿\né¢„è§ˆæ¨¡æ¿ï¼šç‚¹å‡»æ¨¡æ¿æŒ‰é’®é¢„è§ˆå†…å®¹ï¼Œç¡®è®¤åç‚¹å‡»\u0026quot;åº”ç”¨æ¨¡æ¿\u0026quot;\nè‡ªå®šä¹‰é…ç½®ï¼šä½¿ç”¨å³ä¾§å‚æ•°æ å¿«é€Ÿæ·»åŠ é…ç½®é¡¹ï¼Œæˆ–ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹\nä¿å­˜å¯¼å‡ºï¼šä½¿ç”¨ç¼–è¾‘å™¨é¡¶éƒ¨æŒ‰é’®è¿›è¡Œæ¸…é™¤ã€ä¿å­˜æˆ–å¤åˆ¶æ“ä½œ\nğŸ¨ è‡ªå®šä¹‰é…ç½® æ›´æ¢å£çº¸ ç‚¹å‡»å³ä¸Šè§’\u0026quot;æ›´æ¢å£çº¸\u0026quot;æŒ‰é’®å¯ä»¥å¾ªç¯åˆ‡æ¢é¢„è®¾çš„èƒŒæ™¯æ ·å¼ã€‚\nä¸»é¢˜åˆ‡æ¢ ç‚¹å‡»\u0026quot;äº®è‰²/æš—è‰²æ¨¡å¼\u0026quot;æŒ‰é’®å¯ä»¥åœ¨ä¸¤ç§ä¸»é¢˜é—´åˆ‡æ¢ï¼Œåå¥½è®¾ç½®ä¼šè‡ªåŠ¨ä¿å­˜ã€‚\næ·»åŠ è‡ªå®šä¹‰æ¨¡æ¿ ç¼–è¾‘å¯¹åº”çš„ *-mould.js æ–‡ä»¶ï¼ŒæŒ‰ç…§ç°æœ‰æ ¼å¼æ·»åŠ æ–°çš„æ¨¡æ¿é…ç½®ã€‚\nğŸ¤ è´¡çŒ®æŒ‡å— æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼š\nFork æœ¬é¡¹ç›®\nåˆ›å»ºç‰¹æ€§åˆ†æ”¯ (git checkout -b feature/AmazingFeature)\næäº¤æ›´æ”¹ (git commit -m 'Add some AmazingFeature')\næ¨é€åˆ°åˆ†æ”¯ (git push origin feature/AmazingFeature)\nå¼€å¯ Pull Request\nğŸ™ è‡´è°¢ æ„Ÿè°¢ CodeMirror æä¾›ä¼˜ç§€çš„ä»£ç ç¼–è¾‘å™¨ç»„ä»¶\næ„Ÿè°¢ Font Awesome æä¾›ç²¾ç¾çš„å›¾æ ‡\næ„Ÿè°¢ Docker å’Œ Nginx ç¤¾åŒºæä¾›çš„æ–‡æ¡£å’Œç¤ºä¾‹\n","date":"2025-09-05T11:41:32+08:00","image":"https://file.meimolihan.eu.org/img/nginx-dock-builder-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5227c3e3/","title":"Docker \u0026 Nginx é…ç½®ç¼–è¾‘å™¨ ğŸ“‹"},{"content":"Docker éƒ¨ç½² EasyNode WebSSH ç»ˆç«¯ ğŸ–¥ï¸ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² EasyNode 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ EasyNode 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ EasyNode å®˜ç½‘åœ°å€ï¼š https://easynode.chaoszhu.com ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/chaos-zhu/easynode ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/chaoszhu/easynode EasyNode æ˜¯ä¸€æ¬¾åŸºäº Web çš„ SSH å’Œ SFTP å·¥å…·ï¼Œæ”¯æŒå¤šæœåŠ¡å™¨ç®¡ç†ã€æ–‡ä»¶ä¼ è¾“å’Œç»ˆç«¯æ“ä½œã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªå®‰å…¨çš„è¿œç¨‹æœåŠ¡å™¨ç®¡ç†å¹³å°ã€‚\nğŸ³ ä¸€ã€Docker éƒ¨ç½² EasyNode 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /vol1/1000/compose/easynode \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: easynode: image: chaoszhu/easynode:v3.4.2 restart: always container_name: easynode ports: - \u0026#34;8082:8082\u0026#34; volumes: - ./easynode/db:/easynode/app/db environment: - TZ=Asia/Shanghai - DEBUG=0 EOF ğŸ” é¦–æ¬¡ç™»å½•å¯†ç ï¼šå¯åŠ¨åé€šè¿‡ docker logs easynode æŸ¥çœ‹åˆå§‹å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ EasyNode 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8082 åŸŸåè®¿é—®ï¼š https://easynode.example.com:666 ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŸ¥çœ‹å®¹å™¨æ—¥å¿—è·å–åˆå§‹å¯†ç ï¼šdocker logs easynode ç™»å½•åå° â†’ æ·»åŠ æœåŠ¡å™¨ â†’ å¼€å§‹ç®¡ç†ï¼ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://easynode.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/easynode.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name easynode.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 10G; location / { proxy_pass http://127.0.0.1:8082; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/easynode # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop easynode # åœæ­¢å®¹å™¨ docker start easynode # å¯åŠ¨å®¹å™¨ docker restart easynode # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm easynode # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f easynode # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it easynode sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it easynode bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs easynode # æŸ¥çœ‹æ—¥å¿— docker logs -f easynode # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 easynode # æŸ¥çœ‹æœ€å100è¡Œ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi chaoszhu/easynode:v3.4.2 # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè¿ç»´ï¼Œæ¢ç´¢æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† EasyNodeï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° ç®¡ç†ä½ çš„æœåŠ¡å™¨ï¼Œæ— è®ºæ˜¯ SSH ç»ˆç«¯è¿˜æ˜¯ SFTP æ–‡ä»¶ä¼ è¾“\nğŸ” å®‰å…¨æ— å¿§ åŸºäº Web çš„åŠ å¯†è¿æ¥ï¼Œä¿éšœè¿œç¨‹æ“ä½œçš„å®‰å…¨æ€§\nâš¡ é«˜æ•ˆä¾¿æ· å¤šæœåŠ¡å™¨ç»Ÿä¸€ç®¡ç†ï¼Œå¯è§†åŒ–æ“ä½œï¼Œå¤§å¹…æå‡è¿ç»´æ•ˆç‡\nè¿ç»´ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æŠ€æœ¯å…±èˆçš„æŒä¹…æ—…ç¨‹ã€‚æ„¿ EasyNode æˆä¸ºä½ å¯é çš„åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æœåŠ¡å™¨ç»´æŠ¤ä¸ç®¡ç†çš„æŒ‘æˆ˜ä¸­ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè½»æ¾è¿ç»´ï¼Œé«˜æ•ˆç®¡ç†â€”â€”æ„å»ºä½ ç¨³å®šå¯é çš„æœåŠ¡å™¨é›†ç¾¤å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ EasyNode å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è¿ç»´é¡ºåˆ©ï¼Œç®¡ç†æœ‰æˆï¼ğŸ‰\n","date":"2025-09-05T10:38:34+08:00","image":"https://file.meimolihan.eu.org/img/docker-easynode-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b1a4ce8b/","title":"Docker éƒ¨ç½² EasyNode WebSSH ç»ˆç«¯ ğŸ–¥ï¸ğŸ”"},{"content":"Markdown ç›®å½•é”šç‚¹å®Œå…¨æŒ‡å—ï¼šè®©æ–‡ç« å¯¼èˆªæ›´ä¾¿æ· ğŸ“‘âœ¨ ğŸ”– æŒæ¡å¦‚ä½•åœ¨ Markdown ä¸­åˆ›å»ºç²¾å‡†çš„ç›®å½•é”šç‚¹ï¼Œæå¤§æå‡é•¿æ–‡æ¡£çš„é˜…è¯»ä½“éªŒå’Œå¯¼èˆªæ•ˆç‡ï¼æœ¬ç¯‡æŒ‡å—å°†å¸¦ä½ ä»å…¥é—¨åˆ°ç²¾é€šï½\nğŸ“š ç›®å½• âœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ ğŸ¤” ä»€ä¹ˆæ˜¯ç›®å½•é”šç‚¹ï¼Ÿ ğŸ—ï¸ åŸºç¡€è¯­æ³•ï¼šæ ‡é¢˜çš„è‡ªåŠ¨é”šç‚¹ ğŸš€ é«˜çº§æŠ€å·§ï¼šæ‰‹åŠ¨åˆ›å»ºç²¾å‡†é”šç‚¹ ğŸ“‹ åˆ›å»ºæ–‡ç« ç›®å½• (TOC) âœ… æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹ ğŸ¯ æ€»ç»“ âœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ Markdown ç›®å½•é”šç‚¹åŠŸèƒ½å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šğŸ¯\nğŸš€ é«˜æ•ˆå¯¼èˆªï¼šè®©è¯»è€…å¿«é€Ÿè·³è½¬åˆ°æ„Ÿå…´è¶£çš„ç« èŠ‚ï¼ŒèŠ‚çœæ»šåŠ¨æ—¶é—´ ğŸ‘ï¸ è§†è§‰æ¸…æ™°ï¼šæä¾›æ–‡æ¡£æ•´ä½“ç»“æ„çš„é¸Ÿç°è§†å›¾ï¼Œå¢å¼ºå¯è¯»æ€§ ğŸ’» è·¨å¹³å°å…¼å®¹ï¼šåœ¨å¤§å¤šæ•°æ”¯æŒ Markdown çš„å¹³å°ä¸Šéƒ½å¯æ­£å¸¸å·¥ä½œ ğŸ› ï¸ ç®€å•æ˜“ç”¨ï¼šåªéœ€å°‘é‡è¯­æ³•å³å¯å®ç°å¤æ‚å¯¼èˆªåŠŸèƒ½ ğŸ“± å“åº”å¼è®¾è®¡ï¼šåœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½å®Œç¾å·¥ä½œï¼ŒåŒ…æ‹¬ç§»åŠ¨ç«¯ ğŸ¤” ä»€ä¹ˆæ˜¯ç›®å½•é”šç‚¹ï¼Ÿ ç›®å½•é”šç‚¹ï¼ˆæˆ–è·³è½¬é“¾æ¥ï¼‰æ˜¯ä¸€ç§å…è®¸è¯»è€…ç‚¹å‡»ä¸€ä¸ªé“¾æ¥åï¼Œè‡ªåŠ¨è·³è½¬åˆ°åŒä¸€é¡µé¢å†…ç‰¹å®šä½ç½®ï¼ˆé€šå¸¸æ˜¯æŸä¸ªæ ‡é¢˜ï¼‰çš„åŠŸèƒ½ã€‚å®ƒå¯¹äº**é•¿æ–‡ğŸ“„ã€æ•™ç¨‹ğŸ§ªã€æ–‡æ¡£ğŸ“‚å’ŒAPI è¯´æ˜ğŸ”§**æ¥è¯´è‡³å…³é‡è¦ï¼Œèƒ½æå¤§æå‡é˜…è¯»ä½“éªŒå’Œå¯¼èˆªæ•ˆç‡âš¡ã€‚\nåœ¨ Markdown ä¸­ï¼Œå®ç°è¿™ä¸€åŠŸèƒ½éå¸¸ç®€å•ï¼Œä¸»è¦ä¾èµ–äºæ ‡é¢˜çš„è‡ªåŠ¨ç”Ÿæˆå’Œæ‰‹åŠ¨é”šç‚¹è®¾ç½®ã€‚\nğŸ—ï¸ åŸºç¡€è¯­æ³•ï¼šæ ‡é¢˜çš„è‡ªåŠ¨é”šç‚¹ ç»å¤§å¤šæ•°æ”¯æŒ Markdown çš„å¹³å°ï¼ˆå¦‚ GitHub, GitLab, Gitee, å„ç±»é™æ€åšå®¢ç­‰ï¼‰éƒ½ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸€ä¸ªæ ‡é¢˜ï¼ˆ#ï¼‰ç”Ÿæˆä¸€ä¸ªé”šç‚¹é“¾æ¥ã€‚\nè§„åˆ™é€šå¸¸æ˜¯ï¼š\nâœ… å°†æ ‡é¢˜æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ âœ… ç§»é™¤ç‰¹æ®Šç¬¦å·ï¼ˆå¦‚ ,, !, ? ç­‰ï¼‰ âœ… å°†ç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦ - âœ… å¤šä¸ªè¿ç»­çš„ - ä¼šè¢«ç¼©å‡ä¸ºä¸€ä¸ª ä¾‹å¦‚ï¼Œä»¥ä¸‹æ ‡é¢˜ï¼š\n1 ## æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹ ä¼šè¢«è‡ªåŠ¨èµ‹äºˆä¸€ä¸ª idï¼Œç”Ÿæˆçš„é”šç‚¹é“¾æ¥å°†æ˜¯ï¼š\n1 #æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹ å¦‚ä½•ä½¿ç”¨ï¼š è¦é“¾æ¥åˆ°è¿™ä¸ªç« èŠ‚ï¼Œä½ åªéœ€è¦åœ¨ç›®å½•æˆ–å…¶ä»–åœ°æ–¹åˆ›å»ºä¸€ä¸ªæŒ‡å‘ #æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹ çš„æ™®é€šé“¾æ¥å³å¯ã€‚\n1 [è·³è½¬åˆ°æœ€ä½³å®è·µç« èŠ‚](#æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹) æ¸²æŸ“æ•ˆæœï¼š è·³è½¬åˆ°æœ€ä½³å®è·µç« èŠ‚ ğŸ‘ˆè¯•è¯•çœ‹ï¼\nğŸš€ é«˜çº§æŠ€å·§ï¼šæ‰‹åŠ¨åˆ›å»ºç²¾å‡†é”šç‚¹ è¿™æ˜¯æœ€é€šç”¨ã€æœ€å¯é çš„æ–¹æ³•ï¼Œå‡ ä¹åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½æœ‰æ•ˆã€‚\nè¯­æ³•ï¼š åœ¨ç›®æ ‡ä½ç½®ï¼ˆé€šå¸¸æ˜¯æ ‡é¢˜ä¸Šæ–¹æˆ–ä¸‹æ–¹ï¼‰æ’å…¥ä¸€ä¸ªç©ºçš„ HTML \u0026lt;a\u0026gt; æ ‡ç­¾ï¼Œå¹¶ä¸ºå…¶æŒ‡å®šä¸€ä¸ª id æˆ– name å±æ€§ã€‚\n1 2 \u0026lt;a id=\u0026#34;custom-id\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; ## ä½ çš„ç« èŠ‚æ ‡é¢˜ å¦‚ä½•é“¾æ¥åˆ°å®ƒï¼š\n1 [ç‚¹å‡»è·³è½¬](#custom-id) å®ä¾‹ï¼š æˆ‘æƒ³ä¸ºã€Œé«˜çº§æŠ€å·§ã€è¿™ä¸ªç« èŠ‚åˆ›å»ºä¸€ä¸ªç²¾å‡†é”šç‚¹ã€‚\n1 2 \u0026lt;a id=\u0026#34;advanced-anchor\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; ## é«˜çº§æŠ€å·§ï¼šæ‰‹åŠ¨åˆ›å»ºç²¾å‡†é”šç‚¹ ç„¶åï¼Œæˆ‘çš„ç›®å½•é“¾æ¥å¯ä»¥è¿™æ ·å†™ï¼š\n1 - [é«˜çº§æŠ€å·§](#advanced-anchor) ğŸ“‹ åˆ›å»ºæ–‡ç« ç›®å½• (TOC) ç»“åˆé”šç‚¹ï¼Œä½ å°±å¯ä»¥è½»æ¾ä¸ºé•¿æ–‡åˆ›å»ºä¸€ä¸ªæ¼‚äº®çš„ç›®å½•ã€‚\n1 2 3 4 5 6 ## ğŸ“š ç›®å½• - [ä»€ä¹ˆæ˜¯ç›®å½•é”šç‚¹ï¼Ÿ](#ä»€ä¹ˆæ˜¯ç›®å½•é”šç‚¹) - [åŸºç¡€è¯­æ³•](#åŸºç¡€è¯­æ³•æ ‡é¢˜çš„è‡ªåŠ¨é”šç‚¹) - [é«˜çº§æŠ€å·§](#advanced-anchor) - [åˆ›å»ºç›®å½•](#åˆ›å»ºæ–‡ç« ç›®å½•-toc) - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹) ğŸ’¡ å°æŠ€å·§ï¼š è®¸å¤šç°ä»£ Markdown ç¼–è¾‘å™¨ï¼ˆå¦‚ VS Code çš„ Markdown All in One æ’ä»¶ï¼‰æˆ–åœ¨çº¿å¹³å°ï¼ˆå¦‚ GitLabï¼‰å¯ä»¥è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆç›®å½•ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™é“¾æ¥ã€‚\nâœ… æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹ ä¿æŒ ID ç®€æ´æ˜äº† ğŸ§¼ï¼šä½¿ç”¨è‹±æ–‡ã€æ•°å­—å’Œè¿å­—ç¬¦ï¼Œé¿å…ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ã€‚ä¾‹å¦‚ #db-config æ¯” #æ•°æ®åº“é…ç½®è¯¦ç»†æ­¥éª¤123 æ›´å¥½ã€‚ å”¯ä¸€æ€§ ğŸ”‘ï¼šç¡®ä¿åŒä¸€ä¸ªé¡µé¢å†…çš„æ¯ä¸ª id éƒ½æ˜¯å”¯ä¸€çš„ã€‚ æµ‹è¯•ï¼æµ‹è¯•ï¼æµ‹è¯•ï¼ ğŸ§ªï¼šåœ¨ä¸åŒçš„å¹³å°å’Œé¢„è§ˆå™¨ä¸Šæµ‹è¯•ä½ çš„é”šç‚¹é“¾æ¥ï¼Œå› ä¸ºæ¸²æŸ“è§„åˆ™å¯èƒ½æœ‰ç»†å¾®å·®åˆ«ã€‚ å¤„ç†ç©ºæ ¼å’Œå¤§å°å†™ ğŸ” ï¼šåœ¨è‡ªåŠ¨ç”Ÿæˆé”šç‚¹æ—¶ï¼Œ## Hello World é€šå¸¸ä¼šå˜æˆ #hello-worldã€‚æ‰‹åŠ¨é“¾æ¥æ—¶è¯·éµå¾ªè¿™ä¸ªè§„åˆ™ã€‚ å…¼å®¹æ€§ ğŸŒï¼šå¯¹äºéœ€è¦é«˜åº¦å…¼å®¹æ€§çš„åœºæ™¯ï¼ˆå¦‚ç”Ÿæˆç½‘é¡µï¼‰ï¼ŒHTML \u0026lt;a\u0026gt; æ ‡ç­¾æ³•æ˜¯æœ€å®‰å…¨çš„é€‰æ‹©ã€‚ ğŸ¯ æ€»ç»“ æ–¹æ³• è¯­æ³• ä¼˜ç‚¹ ç¼ºç‚¹ æ¨èåº¦ è‡ªåŠ¨é”šç‚¹ ## æ ‡é¢˜ â†’ #æ ‡é¢˜ ç®€å•ï¼Œè‡ªåŠ¨ç”Ÿæˆ å¯èƒ½å†—é•¿ï¼Œä¸ç¾è§‚ â­â­â­â­ HTML æ ‡ç­¾ \u0026lt;a id=\u0026quot;my-id\u0026quot;\u0026gt;\u0026lt;/a\u0026gt; å…¼å®¹æ€§æœ€å¥½ï¼Œç²¾å‡†æ§åˆ¶ éœ€è¦æ‰‹åŠ¨æ·»åŠ  â­â­â­â­â­ æŒæ¡ç›®å½•é”šç‚¹çš„ä½¿ç”¨ï¼Œæ˜¯æ’°å†™é«˜è´¨é‡ã€ç”¨æˆ·å‹å¥½çš„ Markdown é•¿æ–‡æ¡£çš„å…³é”®æŠ€èƒ½ğŸ”‘ã€‚å®ƒè®©ä½ çš„ç»“æ„æ¸…æ™°æ˜“è¯»ï¼Œå¯¼èˆªå¿«æ·é«˜æ•ˆâš¡ã€‚\nç°åœ¨å°±å¿«å»ä½ çš„ä¸‹ä¸€ç¯‡æ•™ç¨‹æˆ–åšå®¢æ–‡ç« ä¸­å®è·µä¸€ä¸‹å§ï¼ğŸš€\nğŸ“Œ æç¤ºï¼š ä½ å¯ä»¥ç‚¹å‡»æœ¬æ–‡å¼€å¤´çš„ç›®å½•ä¸­çš„ä»»ä½•é“¾æ¥ï¼Œæ¥ä½“éªŒé”šç‚¹è·³è½¬çš„æ•ˆæœã€‚è¿™å°±æ˜¯æœ¬æ–‡æ‰€ä»‹ç»æŠ€æœ¯çš„å®é™…åº”ç”¨ï¼âœ¨\nâœ¨ æ„¿ä½ çš„æ–‡æ¡£æ¸…æ™°åˆæ˜“è¯»ï¼Œé”šç‚¹ç²¾å‡†å¦‚å¯¼èˆªï¼ Happy Markdowningï¼ âœ¨\n","date":"2025-08-31T09:11:12+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b759c5ff/","title":"Markdown ç›®å½•é”šç‚¹å®Œå…¨æŒ‡å— ğŸ“‘âœ¨"},{"content":"Debian 13 å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸ§ Debian 13ï¼ˆä»£å· Trixieï¼‰æ›´æ¢å›½å†…é•œåƒæºå¯ä»¥æœ‰æ•ˆåŠ é€Ÿè½¯ä»¶åŒ…ä¸‹è½½å’Œç³»ç»Ÿæ›´æ–°ã€‚ä¸‹é¢æˆ‘å°†ä¸ºä½ è¯¦ç»†ä»‹ç»æ›´æ¢æ–¹æ³•ã€‚\nç›®å½•å¯¼èˆª ğŸ“š ğŸ” ä¸ºä»€ä¹ˆæ›´æ¢å›½å†…é•œåƒæºï¼Ÿ ğŸ“‹ æ›´æ¢å‰å‡†å¤‡ ğŸ§¾ å›½å†…å¸¸ç”¨é•œåƒæº ğŸ›  æ›´æ¢é•œåƒæºæ–¹æ³• æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œå¿«é€Ÿæ›¿æ¢ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘æºåˆ—è¡¨ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ DEB822 æ ¼å¼ æ–¹æ³•å››ï¼šä¸€é”®æ¢æºè„šæœ¬ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”§ æµ‹è¯•ä¸éªŒè¯ ğŸ’ æ€»ç»“ ğŸ” ä¸ºä»€ä¹ˆè¦æ›´æ¢å›½å†…é•œåƒæºï¼Ÿ ä¸º Debian ç³»ç»Ÿæ›´æ¢å›½å†…é•œåƒæºï¼Œä¸»è¦æ˜¯ä¸ºäº†æå‡è½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦å’Œå¢å¼ºæ›´æ–°ç¨³å®šæ€§ã€‚ç”±äºç½‘ç»œè·ç¦»å’Œå¸¦å®½çš„é™åˆ¶ï¼Œè¿æ¥æµ·å¤–å®˜æ–¹æºå¾€å¾€é€Ÿåº¦è¾ƒæ…¢ã€‚é€‰æ‹©åœ°ç†ä½ç½®æ›´è¿‘çš„å›½å†…é•œåƒæºï¼Œèƒ½å¤§å¹…ç¼©çŸ­ä¸‹è½½æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿç»´æŠ¤æ•ˆç‡ï¼Œå¹¶å‡å°‘å› ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„æ›´æ–°å¤±è´¥ã€‚\nä¸»è¦ä¼˜åŠ¿ï¼š\nğŸš€ æé€Ÿä¸‹è½½ï¼šå›½å†…é•œåƒé€šå¸¸æä¾›æ›´å¿«çš„è¿æ¥é€Ÿåº¦å’Œæ›´å¤§çš„å¸¦å®½ ğŸ“¶ ç¨³å®šè¿æ¥ï¼šé¿å…å›½é™…ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„æ›´æ–°ä¸­æ–­ â± èŠ‚çœæ—¶é—´ï¼šå¤§å¹…å‡å°‘è½¯ä»¶åŒ…ä¸‹è½½å’Œç³»ç»Ÿæ›´æ–°æ‰€éœ€æ—¶é—´ ğŸ”’ å¤‡ç”¨é€‰æ‹©ï¼šå½“å®˜æ–¹æºä¸å¯ç”¨æ—¶æä¾›å¯é çš„æ›¿ä»£æ–¹æ¡ˆ ğŸ“‹ æ›´æ¢å‰å‡†å¤‡ å¼€å§‹å‰ï¼ŒåŠ¡å¿…å¤‡ä»½ä½ åŸæœ‰çš„æºåˆ—è¡¨æ–‡ä»¶ï¼Œè¿™æ ·è‹¥é…ç½®å‡ºç°é—®é¢˜æ—¶å¯ä»¥å¿«é€Ÿæ¢å¤ã€‚\n1 sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… apt-transport-https å’Œ ca-certificates åŒ…ï¼Œè¿™å¯¹ä½¿ç”¨HTTPSæºçš„é•œåƒç«™å¾ˆé‡è¦ï¼š\n1 sudo apt install apt-transport-https ca-certificates ğŸ’¡ æç¤ºï¼šå¦‚æœæ˜¯å…¨æ–°å®‰è£…çš„ Debianï¼Œå»ºè®®å…ˆä½¿ç”¨å®˜æ–¹æºå®Œæˆåˆæ­¥ç³»ç»Ÿæ›´æ–°ï¼Œå†æ›´æ¢ä¸ºå›½å†…é•œåƒæºã€‚\nğŸ§¾ å›½å†…å¸¸ç”¨é•œåƒæºå‚è€ƒ å›½å†…æœ‰å‡ ä¸ªæä¾› Debian é•œåƒçš„ç«™ç‚¹ï¼Œä½ å¯ä»¥æ ¹æ®åœ°ç†ä½ç½®å’Œç½‘ç»œæƒ…å†µé€‰æ‹©ã€‚\né•œåƒç«™åç§° ç½‘å€ ç‰¹ç‚¹ æ¨èäººç¾¤ é˜¿é‡Œäº‘ https://mirrors.aliyun.com/debian/ é€Ÿåº¦å¿«ï¼Œè¦†ç›–å¹¿ï¼Œå›½å†…ä¸»æµé€‰æ‹©ä¹‹ä¸€ æ‰€æœ‰ç”¨æˆ· æ¸…åå¤§å­¦ https://mirrors.tuna.tsinghua.edu.cn/debian/ æ•™è‚²ç½‘ä¼˜åŒ–ï¼Œæ›´æ–°åŠæ—¶ï¼Œæ”¯æŒIPv6 æ•™è‚²ç½‘ç”¨æˆ· ä¸­ç§‘å¤§ https://mirrors.ustc.edu.cn/debian/ å†å²æ‚ ä¹…ï¼Œè¿æ¥ç¨³å®šï¼Œå°¤å…¶é€‚åˆåä¸­ã€åä¸œåœ°åŒº åä¸­ã€åä¸œç”¨æˆ· åä¸ºäº‘ https://mirrors.huaweicloud.com/debian/ ä¼ä¸šçº§æœåŠ¡ï¼Œç¨³å®šæ€§å¼º ä¼ä¸šç”¨æˆ· ç½‘æ˜“ http://mirrors.163.com/debian/ è€ç‰Œé•œåƒç«™ï¼Œç¨³å®šå¯é  æ‰€æœ‰ç”¨æˆ· è…¾è®¯äº‘ https://mirrors.cloud.tencent.com/debian/ äº‘æœåŠ¡å•†æä¾›ï¼Œä¸äº‘äº§å“é›†æˆè‰¯å¥½ è…¾è®¯äº‘ç”¨æˆ· ğŸŒ é€‰æ‹©å»ºè®®ï¼šå¯ä»¥å°è¯•ä½¿ç”¨ ping æˆ– curl æµ‹è¯•å„é•œåƒç«™çš„å“åº”é€Ÿåº¦ï¼Œé€‰æ‹©æœ€å¿«çš„é•œåƒæºã€‚\nğŸ›  æ›´æ¢é•œåƒæºæ–¹æ³• ä½ æœ‰å¤šç§æ–¹æ³•å¯ä»¥æ›´æ¢é•œåƒæºã€‚\næ–¹æ³•ä¸€ï¼šé€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿæ›¿æ¢ï¼ˆé€‚åˆæ–°æ‰‹ï¼‰ ğŸ’» ä½¿ç”¨ sed å‘½ä»¤ä¸€é”®æ›¿æ¢ï¼ˆä»¥é˜¿é‡Œäº‘å’Œæ¸…åå¤§å­¦æºä¸ºä¾‹ï¼‰ï¼š\n1 2 3 4 5 6 7 # æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒæº sudo sed -i \u0026#39;s|http://deb.debian.org|https://mirrors.aliyun.com|g\u0026#39; /etc/apt/sources.list sudo sed -i \u0026#39;s|http://security.debian.org|https://mirrors.aliyun.com/debian-security|g\u0026#39; /etc/apt/sources.list # æˆ–è€…æ›¿æ¢ä¸ºæ¸…åå¤§å­¦é•œåƒæº sudo sed -i \u0026#39;s|http://deb.debian.org|https://mirrors.tuna.tsinghua.edu.cn|g\u0026#39; /etc/apt/sources.list sudo sed -i \u0026#39;s|http://security.debian.org|https://mirrors.tuna.tsinghua.edu.cn/debian-security|g\u0026#39; /etc/apt/sources.list æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ä»¥åº”ç”¨æ–°çš„é•œåƒæºï¼š\n1 sudo apt update âœ¨ ç‰¹ç‚¹ï¼šç®€å•å¿«æ·ï¼Œé€‚åˆä¸ç†Ÿæ‚‰ç¼–è¾‘å™¨çš„ç”¨æˆ·ï¼Œä½†å¯èƒ½æ— æ³•å¤„ç†æ‰€æœ‰æ ¼å¼çš„æºæ–‡ä»¶ã€‚\næ–¹æ³•äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘æºåˆ—è¡¨æ–‡ä»¶ï¼ˆæ¨èï¼Œæ›´çµæ´»ï¼‰ ğŸ“ ç¼–è¾‘ sources.list æ–‡ä»¶ï¼š\n1 sudo nano /etc/apt/sources.list æ³¨é‡Šæˆ–åˆ é™¤åŸæœ‰å†…å®¹ï¼Œæ·»åŠ ä»¥ä¸‹å¯¹åº”å†…å®¹ï¼ˆä»¥é˜¿é‡Œäº‘å’Œæ¸…åå¤§å­¦ä¸ºä¾‹ï¼Œæ³¨æ„å°† trixie æ›¿æ¢ä¸ºä½ å®é™…çš„ Debian ç‰ˆæœ¬ä»£å·ï¼‰ï¼š\né˜¿é‡Œäº‘é•œåƒæºç¤ºä¾‹ï¼ˆä¼ ç»Ÿæ ¼å¼ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 deb https://mirrors.aliyun.com/debian/ trixie main contrib non-free non-free-firmware deb-src https://mirrors.aliyun.com/debian/ trixie main contrib non-free non-free-firmware deb https://mirrors.aliyun.com/debian/ trixie-updates main contrib non-free non-free-firmware deb-src https://mirrors.aliyun.com/debian/ trixie-updates main contrib non-free non-free-firmware deb https://mirrors.aliyun.com/debian/ trixie-backports main contrib non-free non-free-firmware deb-src https://mirrors.aliyun.com/debian/ trixie-backports main contrib non-free non-free-firmware # å®‰å…¨æ›´æ–°æº deb https://mirrors.aliyun.com/debian-security trixie-security main contrib non-free non-free-firmware deb-src https://mirrors.aliyun.com/debian-security trixie-security main contrib non-free non-free-firmware æ¸…åå¤§å­¦é•œåƒæºç¤ºä¾‹ï¼ˆä¼ ç»Ÿæ ¼å¼ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 deb https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie-updates main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie-updates main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie-backports main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie-backports main contrib non-free non-free-firmware # å®‰å…¨æ›´æ–°æº deb https://mirrors.tuna.tsinghua.edu.cn/debian-security trixie-security main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security trixie-security main contrib non-free non-free-firmware ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ï¼ˆåœ¨ nano ä¸­æŒ‰ Ctrl+Xï¼Œç„¶åæŒ‰ Y ç¡®è®¤ï¼Œæœ€åæŒ‰ Enterï¼‰ã€‚\næ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š\n1 sudo apt update âœ¨ ç‰¹ç‚¹ï¼šæœ€çµæ´»çš„æ–¹æ³•ï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªæºï¼Œé€‚åˆé«˜çº§ç”¨æˆ·å’Œç‰¹æ®Šéœ€æ±‚ã€‚\næ–¹æ³•ä¸‰ï¼šä½¿ç”¨ DEB822 æ ¼å¼ï¼ˆæ–°æ ¼å¼ï¼ŒDebian 12 åŠä»¥ä¸Šæ”¯æŒï¼‰ ğŸ”„ ä» Debian 12 å¼€å§‹ï¼Œç³»ç»Ÿæ”¯æŒæ–°çš„ DEB822 æ ¼å¼çš„æºæ–‡ä»¶ï¼Œå­˜å‚¨åœ¨ /etc/apt/sources.list.d/ ç›®å½•ä¸‹ï¼Œåç¼€ä¸º .sourcesã€‚\nåˆ›å»ºæˆ–ç¼–è¾‘ .sources æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š\n1 sudo nano /etc/apt/sources.list.d/debian.sources æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆä»¥æ¸…åå¤§å­¦æºä¸ºä¾‹ï¼ŒDEB822 æ ¼å¼ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 Types: deb deb-src URIs: https://mirrors.tuna.tsinghua.edu.cn/debian Suites: trixie trixie-updates trixie-backports Components: main contrib non-free non-free-firmware Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg Types: deb deb-src URIs: https://mirrors.tuna.tsinghua.edu.cn/debian-security Suites: trixie-security Components: main contrib non-free non-free-firmware Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç¦ç”¨ä¼ ç»Ÿçš„ sources.list æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š\n1 sudo mv /etc/apt/sources.list /etc/apt/sources.list.disabled æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š\n1 sudo apt update âœ¨ ç‰¹ç‚¹ï¼šæ–°æ ¼å¼æ›´æ˜“è¯»å’Œç®¡ç†ï¼Œæ”¯æŒå¤šæ¶æ„å’Œæ›´å¤æ‚çš„æºé…ç½®ï¼Œæ˜¯æœªæ¥çš„å‘å±•æ–¹å‘ã€‚\næ–¹æ³•å››ï¼šä½¿ç”¨ä¸€é”®æ¢æºè„šæœ¬ ğŸ¤– ä½ è¿˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ä¸€é”®æ¢æºè„šæœ¬æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚\nä½¿ç”¨ linuxmirrors.cn çš„è„šæœ¬ï¼š\n1 bash \u0026lt;(curl -sSL https://linuxmirrors.cn/main.sh) ä½¿ç”¨æ¸…åå¤§å­¦çš„æ¢æºè„šæœ¬ï¼š\n1 2 3 4 5 6 sudo bash -c \u0026#34;cat \u0026gt; /etc/apt/sources.list\u0026#34; \u0026lt;\u0026lt;EOF deb https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie-updates main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ trixie-backports main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian-security trixie-security main contrib non-free non-free-firmware EOF æ³¨æ„ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹è„šæœ¬éœ€è°¨æ…ï¼Œç¡®ä¿æ¥æºå¯é ï¼Œå¹¶ç†è§£è„šæœ¬æ‰€æ‰§è¡Œçš„æ“ä½œã€‚\nâœ¨ ç‰¹ç‚¹ï¼šè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ï¼Œé€‚åˆæ‰¹é‡éƒ¨ç½²å’Œå¿«é€Ÿé…ç½®ï¼Œä½†éœ€è¦ä¿¡ä»»è„šæœ¬æ¥æºã€‚\nâš ï¸ æ³¨æ„äº‹é¡¹ ç¡®è®¤ Debian ç‰ˆæœ¬ä»£å·ï¼šç¡®ä¿é…ç½®ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ä»£å·ï¼ˆå¦‚ trixieï¼‰ä¸ä½ å®é™…è¿è¡Œçš„ Debian ç‰ˆæœ¬ä¸€è‡´ã€‚å¯é€šè¿‡ lsb_release -cs å‘½ä»¤æŸ¥çœ‹ã€‚ å®‰å…¨æ›´æ–°æºçš„é€‰æ‹©ï¼šå‡ºäºåŠæ—¶æ€§è€ƒè™‘ï¼Œå®‰å…¨æ›´æ–°ï¼ˆsecurityï¼‰å»ºè®®ç›´æ¥ä½¿ç”¨ Debian å®˜æ–¹æºï¼ˆhttps://security.debian.org/debian-securityï¼‰ï¼Œå› ä¸ºé•œåƒç«™åŒæ­¥å¯èƒ½å­˜åœ¨å»¶è¿Ÿã€‚è‹¥é•œåƒç«™æä¾›äº†å®‰å…¨æ›´æ–°æºä¸”ä½ è¿½æ±‚é€Ÿåº¦ï¼Œä¹Ÿå¯ä½¿ç”¨ï¼Œä½†éœ€çŸ¥æ™“æ½œåœ¨é£é™©ã€‚ ç½‘ç»œé—®é¢˜ï¼šå¦‚æœé‡åˆ° Connection reset by peer ç­‰é”™è¯¯ï¼Œå¯èƒ½ä¸ HTTP Pipelining ç‰¹æ€§æœ‰å…³ï¼Œå¯ä»¥å°è¯•å…³é—­å®ƒï¼š 1 echo \u0026#34;Acquire::http::Pipeline-Depth \\\u0026#34;0\\\u0026#34;;\u0026#34; | sudo tee /etc/apt/apt.conf.d/99nopipelining é•œåƒç«™åŒæ­¥å»¶è¿Ÿï¼šé•œåƒç«™ä¸å®˜æ–¹æºä¹‹é—´å­˜åœ¨åŒæ­¥æ—¶é—´å·®ï¼Œé€šå¸¸è¾ƒçŸ­ã€‚è‹¥æ›´æ–°æ—¶æ‰¾ä¸åˆ°æŸäº›æœ€æ–°è½¯ä»¶åŒ…ï¼Œå¯ç¨åå†è¯•ã€‚ ä»£ç†è®¾ç½®ï¼šå¦‚æœä½ å¤„äºç½‘ç»œå—é™ç¯å¢ƒï¼Œå¯èƒ½éœ€è¦é…ç½® HTTP/HTTPS ä»£ç†æ‰èƒ½è®¿é—®ç‰¹å®šé•œåƒæºã€‚ å¤šæ¶æ„æ”¯æŒï¼šå¦‚æœä½ éœ€è¦å®‰è£… i386 ç­‰å¤šæ¶æ„è½¯ä»¶åŒ…ï¼Œç¡®ä¿æºé…ç½®ä¸­åŒ…å«ç›¸åº”ç»„ä»¶ã€‚ ç¬¬ä¸‰æ–¹æºï¼šæ›´æ¢ç³»ç»Ÿæºåï¼Œåˆ«å¿˜äº†ä¹Ÿæ›´æ–°ç¬¬ä¸‰æ–¹è½¯ä»¶çš„æºé…ç½®ï¼ˆå¦‚ Dockerã€Google Chrome ç­‰ï¼‰ï¼Œå°†å®ƒä»¬ä¹ŸæŒ‡å‘å›½å†…é•œåƒã€‚ ğŸ”§ æµ‹è¯•ä¸éªŒè¯ æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼šæ‰§è¡Œ sudo apt update åï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€‚è‹¥æ— é”™è¯¯ï¼Œä¸”åˆ—å‡ºäº†æ–°çš„é•œåƒæºåœ°å€ï¼Œåˆ™é€šå¸¸è¡¨ç¤ºé…ç½®æˆåŠŸã€‚ é€Ÿåº¦æµ‹è¯•ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•ä¸‹è½½é€Ÿåº¦ï¼š 1 2 sudo apt install speedtest-cli speedtest å®‰è£…æµ‹è¯•ï¼šå°è¯•å®‰è£…æˆ–æ›´æ–°ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ˆå¦‚ sudo apt install htopï¼‰ï¼Œæ„Ÿå—ä¸‹è½½é€Ÿåº¦æ˜¯å¦æœ‰æ‰€æå‡ã€‚ æŸ¥çœ‹æºè®¾ç½®ï¼šé€šè¿‡ apt policy \u0026lt;package-name\u0026gt; å¯æŸ¥çœ‹è½¯ä»¶åŒ…å…·ä½“ä¼šä»å“ªä¸ªæºè·å–ã€‚ éªŒè¯ç­¾åï¼šç¡®ä¿æ‰€æœ‰è½¯ä»¶åŒ…éƒ½èƒ½æ­£ç¡®éªŒè¯ç­¾åï¼Œæ²¡æœ‰è­¦å‘Šä¿¡æ¯ã€‚ ğŸ’ æ€»ç»“ ä¸º Debian 13 æ›´æ¢å›½å†…é•œåƒæºæ˜¯ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ä¼˜åŒ–æªæ–½ï¼Œèƒ½æ˜¾è‘—æå‡è½¯ä»¶æ›´æ–°å’Œå®‰è£…ä½“éªŒã€‚ä»¥ä¸‹æ˜¯å„æ–¹æ³•çš„ç‰¹ç‚¹æ€»ç»“ï¼š\næ–¹æ³• éš¾åº¦ çµæ´»æ€§ é€‚ç”¨åœºæ™¯ å‘½ä»¤è¡Œå¿«é€Ÿæ›¿æ¢ â­â˜†â˜†â˜†â˜† â­â˜†â˜†â˜†â˜† å¿«é€Ÿç®€å•æ›´æ¢ï¼Œé€‚åˆæ–°æ‰‹ æ‰‹åŠ¨ç¼–è¾‘æºåˆ—è¡¨ â­â­â­â˜†â˜† â­â­â­â­â­ ç²¾ç¡®æ§åˆ¶ï¼Œé€‚åˆå¤§å¤šæ•°ç”¨æˆ· DEB822 æ ¼å¼ â­â­â­â­â˜† â­â­â­â­â­ æ–°ç³»ç»Ÿæ¨èï¼Œæœªæ¥è¶‹åŠ¿ ä¸€é”®æ¢æºè„šæœ¬ â­â˜†â˜†â˜†â˜† â­â­â˜†â˜†â˜† æ‰¹é‡éƒ¨ç½²ï¼Œå¿«é€Ÿé…ç½® æ¨èç­–ç•¥ï¼š\nğŸ¯ æ–°æ‰‹ç”¨æˆ·ï¼šä½¿ç”¨æ–¹æ³•ä¸€æˆ–æ–¹æ³•å››å¿«é€Ÿæ›´æ¢ ğŸ¯ æ™®é€šç”¨æˆ·ï¼šä½¿ç”¨æ–¹æ³•äºŒï¼Œæ‰‹åŠ¨ç¼–è¾‘æºåˆ—è¡¨ ğŸ¯ é«˜çº§ç”¨æˆ·ï¼šå°è¯•æ–¹æ³•ä¸‰ï¼Œä½¿ç”¨æ–°çš„ DEB822 æ ¼å¼ ğŸ¯ ä¼ä¸šç¯å¢ƒï¼šä½¿ç”¨æ–¹æ³•å››ç¼–å†™è‡ªå·±çš„è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ“¢ è¯·æ³¨æ„ï¼Œé•œåƒæºçš„å¯ç”¨æ€§å’Œé€Ÿåº¦å¯èƒ½å› æ—¶é—´å’Œç½‘ç»œç¯å¢ƒè€Œå¼‚ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œä¸å¦¨å›é€€å¤‡ä»½æˆ–å°è¯•å¦ä¸€ä¸ªé•œåƒæºã€‚å®šæœŸæ£€æŸ¥é•œåƒç«™çš„çŠ¶æ€é¡µé¢ä¹Ÿæ˜¯å¥½ä¹ æƒ¯ã€‚\nå¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©ä½ é¡ºåˆ©å®Œæˆ Debian 13 çš„é•œåƒæºæ›´æ¢ï¼Œäº«å—æ›´å¿«çš„è½¯ä»¶ä¸‹è½½ä½“éªŒï¼ ğŸš€\n","date":"2025-08-28T05:09:53+08:00","image":"https://file.meimolihan.eu.org/img/debian-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0a9c99aa/","title":"Debian 13 å›½å†…é•œåƒæºé…ç½®æŒ‡å—  ğŸ§"},{"content":"Proxmox VE 9.x å¼€å¯ Intel SR-IOV æ ¸æ˜¾ç›´é€š ğŸ–¥ï¸ ğŸ“‹ ç›®å½• âœ¨ ç‰¹æ€§ä¸ä¼˜åŠ¿ ğŸ› ï¸ å‡†å¤‡å·¥ä½œ âš™ï¸ æ“ä½œæµç¨‹ ğŸ§ å®¢æˆ·ç«¯é…ç½® ğŸ” éªŒè¯ä¸æµ‹è¯• ğŸ› ï¸ æŸ¥çœ‹æ ¸æ˜¾ä½¿ç”¨ç‡ âœ¨ ç‰¹æ€§ä¸ä¼˜åŠ¿ SR-IOV (Single Root I/O Virtualization) æŠ€æœ¯å…è®¸å•ä¸ªç‰©ç†è®¾å¤‡ï¼ˆå¦‚Intelæ ¸æ˜¾ï¼‰è¢«å¤šä¸ªè™šæ‹Ÿæœºå…±äº«ä½¿ç”¨ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸ¯ æ ¸æ˜¾å¤ç”¨ï¼šä¸€ä¸ªç‰©ç†æ ¸æ˜¾å¯è¢«æ‹†åˆ†ä¸ºå¤šä¸ªè™šæ‹ŸGPUä¾›å¤šä¸ªè™šæ‹ŸæœºåŒæ—¶ä½¿ç”¨ã€‚ ğŸš€ æ€§èƒ½æå‡ï¼šæ¥è¿‘åŸç”Ÿæ€§èƒ½çš„ç¡¬ä»¶åŠ é€Ÿï¼Œæ”¯æŒè§†é¢‘ç¼–è§£ç å’Œå›¾å½¢å¤„ç†ã€‚ ğŸ’¾ èµ„æºä¼˜åŒ–ï¼šæœ€å¤§åŒ–åˆ©ç”¨ç¡¬ä»¶èµ„æºï¼Œé¿å…æ˜¾å¡é—²ç½®ã€‚ ğŸ”§ çµæ´»åˆ†é…ï¼šå¯æ ¹æ®éœ€è¦ä¸ºä¸åŒè™šæ‹Ÿæœºåˆ†é…ä¸åŒæ•°é‡çš„è™šæ‹ŸåŠŸèƒ½(VF)ã€‚ ğŸ› ï¸ å‡†å¤‡å·¥ä½œ å‚è€ƒè§†é¢‘ï¼šå°é™ˆæŠ˜è…¾æ—¥è®° Bilibili BV1mtvNzwEis âœ… ç¡¬ä»¶è¦æ±‚ ç»„ä»¶ è¦æ±‚ CPU/æ ¸æ˜¾ æ”¯æŒSR-IOVçš„Intelç¬¬12ä»£åŠæ›´æ–°æ¶æ„ï¼ˆAlder Lake-N, 12-14ä»£Core, Ultra 200ç³»åˆ—ï¼‰ ä¸»æ¿ æ”¯æŒSR-IOVåŠŸèƒ½ï¼ˆè¯·åœ¨BIOSä¸­ç¡®è®¤ï¼‰ BIOSè®¾ç½® å¼€å¯ VT-dï¼ˆIntelè™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰ã€SR-IOV æ”¯æŒï¼Œç¦ç”¨å®‰å…¨å¯åŠ¨ï¼ˆSecure Bootï¼‰ ç³»ç»Ÿ Proxmox VE (PVE) 9.x ğŸ” æ£€æŸ¥ç¡¬ä»¶æ”¯æŒï¼ˆé€‰åšï¼‰ 1 2 3 4 5 6 7 # æ£€æŸ¥CPUå’Œæ ¸æ˜¾å‹å· lscpu | grep -i model lspci | grep -i vga # æŸ¥çœ‹IOMMUæ˜¯å¦æ”¯æŒ dmesg | grep -e DMAR -e IOMMU # è‹¥è¾“å‡ºåŒ…å«\u0026#34;Intel-IOMMU\u0026#34;æˆ–\u0026#34;AMD-Vi\u0026#34;ä¸”æœªæ˜¾ç¤ºé”™è¯¯ï¼Œåˆ™é€šå¸¸è¡¨ç¤ºæ”¯æŒã€‚ ğŸ“¦ è½¯ä»¶å‡†å¤‡ ç¡®ä¿ç³»ç»Ÿæ›´æ–°ï¼š 1 apt update \u0026amp;\u0026amp; apt upgrade -y å®‰è£…åŸºæœ¬å·¥å…·ï¼š 1 apt install -y git build-essential dkms sysfsutils proxmox-headers-$(uname -r) intel-gpu-tools âš™ï¸ æ“ä½œæµç¨‹ 1. ä¿®æ”¹ GRUB å¼•å¯¼å‚æ•° 1 2 3 4 5 # å¤‡ä»½åŸå§‹GRUBé…ç½® cp /etc/default/grub /etc/default/grub.bak # ç¼–è¾‘GRUBé…ç½® nano /etc/default/grub åœ¨ GRUB_CMDLINE_LINUX_DEFAULT è¡Œæœ«å°¾è¿½åŠ ä»¥ä¸‹å‚æ•°ï¼š\n1 intel_iommu=on i915.enable_guc=3 i915.max_vfs=7 module_blacklist=xe å‚æ•°è¯´æ˜ï¼š\nintel_iommu=onï¼šå¯ç”¨Intel IOMMUã€‚ iommu=ptï¼šåªä¸ºä½¿ç”¨é€ä¼ ï¼ˆPassthroughï¼‰çš„è®¾å¤‡å¯ç”¨IOMMUï¼Œå¯æä¾›æ›´å¥½çš„æ€§èƒ½å’ŒåŠŸèƒ½ã€‚ i915.enable_guc=3ï¼šå¯ç”¨Intel Graphics Unit Controlï¼ˆGUCï¼‰ï¼Œæœ‰åŠ©äºæå‡æ˜¾å¡åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„æ€§èƒ½ã€‚ i915.max_vfs=7ï¼šè®¾ç½®æœ€å¤§è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰æ•°é‡ä¸º7ï¼ˆå¯æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼‰ã€‚ module_blacklist=xeï¼šé˜»æ­¢å†…æ ¸è‡ªåŠ¨åŠ è½½åä¸º xe çš„æ˜¾å¡é©±åŠ¨æ¨¡å—ã€‚ 2. æ›´æ–°GRUBé…ç½® 1 update-grub 3. å®‰è£… i915 SR-IOV DKMS é©±åŠ¨ å¯è®¿é—® i915-sriov-dkms GitHub é¡µé¢ è·å–æœ€æ–°ç‰ˆæœ¬é©±åŠ¨\næ–¹æ³•ä¸€ï¼šç›´æ¥å®‰è£…DEBåŒ…ï¼ˆæ¨èï¼‰ 1 2 3 4 5 # ä¸‹è½½é¢„ç¼–è¯‘çš„DEBåŒ…ï¼ˆè¯·æ ¹æ®PVEç‰ˆæœ¬é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ï¼‰ wget -c https://github.com/strongtz/i915-sriov-dkms/releases/download/2025.07.22/i915-sriov-dkms_2025.07.22_amd64.deb # å®‰è£…DEBåŒ… dpkg -i i915-sriov-dkms_2025.07.22_amd64.deb æ–¹æ³•äºŒï¼šä»æºç ç¼–è¯‘å®‰è£… 1 2 3 4 5 6 7 # å…‹éš†é¡¹ç›®ä»“åº“ git clone https://github.com/strongtz/i915-sriov-dkms.git cd i915-sriov-dkms # æ·»åŠ å¹¶å®‰è£…DKMSæ¨¡å— dkms add . dkms install -m i915-sriov-dkms -v 2024.09.21 --force 4. é…ç½®è™šæ‹ŸåŠŸèƒ½(VF)æ•°é‡ 1 2 3 4 5 6 # æŸ¥æ‰¾æ ¸æ˜¾çš„PCIæ€»çº¿åœ°å€ï¼ˆé€šå¸¸æ˜¯00:02.0ï¼‰ lspci | grep VGA # é…ç½®ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º7ä¸ªè™šæ‹ŸåŠŸèƒ½(VF) # æ³¨æ„ï¼šå°†0000:00:02.0æ›¿æ¢ä¸ºä½ çš„å®é™…æ ¸æ˜¾åœ°å€ echo \u0026#34;devices/pci0000:00/0000:00:02.0/sriov_numvfs = 7\u0026#34; \u0026gt;\u0026gt; /etc/sysfs.conf 5. æ›´æ–°initramfså¹¶é‡å¯ 1 2 3 4 5 # æ›´æ–°initramfs update-initramfs -u # é‡å¯ç³»ç»Ÿ reboot 6. éªŒè¯å®‰è£… ç³»ç»Ÿé‡å¯åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯SR-IOVæ˜¯å¦å¯ç”¨æˆåŠŸï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†VFè®¾å¤‡ lspci | grep -i \u0026#34;HD Graphics\u0026#34; # æ£€æŸ¥DKMSæ¨¡å—çŠ¶æ€ dkms status # æŸ¥çœ‹Intel GPUçŠ¶æ€ï¼ˆå¯é€‰ï¼‰ intel_gpu_top -d sriov å¦‚æœæˆåŠŸï¼Œlspci å‘½ä»¤åº”æ˜¾ç¤º1ä¸ªç‰©ç†GPUå’Œå¤šä¸ªè™šæ‹ŸGPUï¼ˆä¾‹å¦‚8ä¸ªï¼ŒåŒ…æ‹¬1ä¸ªPFå’Œ7ä¸ªVFï¼‰ã€‚\nğŸ§ å®¢æˆ·ç«¯é…ç½® åœ¨PVEä¸­æ·»åŠ è™šæ‹ŸGPUåˆ°è™šæ‹Ÿæœº åˆ›å»ºæˆ–ç¼–è¾‘è™šæ‹Ÿæœºé…ç½®ï¼š\nåœ¨PVEç½‘é¡µç®¡ç†ç•Œé¢ä¸­ï¼Œé€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœºã€‚ ç¡¬ä»¶ â†’ æ·»åŠ  â†’ PCIè®¾å¤‡ã€‚ é€‰æ‹©è™šæ‹ŸGPUï¼š\né€‰æ‹©ä»»æ„ä¸€ä¸ª 00:02.x çš„è™šæ‹ŸGPUè®¾å¤‡ï¼ˆæ³¨æ„ï¼šä¸è¦é€‰æ‹©ä¸»è®¾å¤‡ 00:02.0ï¼Œè¿™æ˜¯ç»™å®¿ä¸»æœºä½¿ç”¨çš„ï¼‰ã€‚ å‹¾é€‰ All Functionsï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚ ROM-BAR å’Œ Primary GPU é€‰é¡¹é€šå¸¸ä¿æŒæœªå‹¾é€‰çŠ¶æ€ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ã€‚ è™šæ‹Ÿæœºè®¾ç½®å»ºè®®ï¼š\næœºå™¨ç±»å‹ï¼šè®¾ç½®ä¸º q35ã€‚ BIOSï¼šå¦‚æœå®¢æˆ·ç«¯æ˜¯è¾ƒæ–°çš„Windowsï¼ˆWin8åŠä»¥ä¸Šï¼‰æˆ–Linuxï¼Œå»ºè®®ä½¿ç”¨ OVMF (UEFI)ã€‚ åœ¨OVMFæ¨¡å¼ä¸‹ï¼Œå»ºè®®åœ¨æ˜¾å¡çš„é«˜çº§è®¾ç½®ä¸­æ·»åŠ  disable_vga=1 å‚æ•°åˆ°vfio-pciæ¨¡å—ã€‚ å®‰è£…å®¢æˆ·ç«¯é©±åŠ¨ Windowsï¼š\nå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Intelæ˜¾å¡é©±åŠ¨ç¨‹åºï¼ˆç‰ˆæœ¬31.xæˆ–æ›´é«˜ï¼‰ã€‚ è®¾å¤‡ç®¡ç†å™¨ä¸­åº”æ­£ç¡®è¯†åˆ«è™šæ‹ŸGPUã€‚ Linuxï¼š\nå®‰è£…ç›¸åº”çš„Intelå›¾å½¢é©±åŠ¨ï¼ˆé€šå¸¸æ˜¯ mesa-vulkan-drivers å’Œ intel-media-va-driverï¼‰ã€‚ éªŒè¯é©±åŠ¨ï¼š 1 2 ls /dev/dri/ # åº”çœ‹åˆ°renderèŠ‚ç‚¹ vainfo # åº”æ˜¾ç¤ºVA-APIæ”¯æŒä¿¡æ¯ ğŸ” éªŒè¯ä¸æµ‹è¯• éªŒè¯SR-IOVåŠŸèƒ½ 1 2 3 4 5 6 7 # æŸ¥çœ‹VFçŠ¶æ€ cat /sys/bus/pci/devices/0000:00:02.0/sriov_numvfs cat /sys/bus/pci/devices/0000:00:02.0/sriov_totalvfs # æŸ¥çœ‹dmesgè¾“å‡ºæ˜¯å¦æœ‰ç›¸å…³é”™è¯¯ dmesg | grep -i i915 dmesg | grep -i vf æµ‹è¯•ç¡¬ä»¶åŠ é€Ÿ åœ¨å®¢æˆ·ç«¯ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æµ‹è¯•ç¡¬ä»¶åŠ é€Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œï¼š\nFFmpegï¼ˆæµ‹è¯•è§†é¢‘ç¼–è§£ç ï¼‰ï¼š 1 ffmpeg -hwaccel vaapi -hwaccel_device /dev/dri/renderD128 -i input.mp4 -c:v vp9_vaapi -f null - Jellyfin/Emby/Plexï¼šåœ¨åª’ä½“æœåŠ¡å™¨è®¾ç½®ä¸­å¯ç”¨ç¡¬ä»¶åŠ é€Ÿå¹¶é€‰æ‹©Intel QuickSyncã€‚ Intel GPU Toolsï¼ˆåœ¨PVEå®¿ä¸»æœºä¸Šå®‰è£…ï¼‰ï¼š 1 2 apt install intel-gpu-tools intel_gpu_top -d sriov # æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ Intel GPU å·¥å…·ä½¿ç”¨ ğŸ› ï¸ å®‰è£… Intel GPU å®˜æ–¹å·¥å…· 1 apt install intel-gpu-tools æŸ¥çœ‹ Intel æ ¸æ˜¾ä½¿ç”¨ç‡ 1 intel_gpu_top -d sriov ğŸ’¡ æç¤ºï¼šå®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„PVE 9.xåº”èƒ½æˆåŠŸåœ¨å¤šå°è™šæ‹Ÿæœºä¸­åŒæ—¶å…±äº«Intelæ ¸æ˜¾ã€‚è¯·è®°å¾—åœ¨æŠ•å…¥ç”Ÿäº§ç¯å¢ƒå‰è¿›è¡Œå…¨é¢æµ‹è¯•ã€‚å¦‚æœ‰é—®é¢˜ï¼Œå¯æŸ¥çœ‹PVEç³»ç»Ÿæ—¥å¿—ï¼ˆjournalctl -xeï¼‰æˆ–å‰å¾€ç›¸å…³ç¤¾åŒºå’Œé¡¹ç›®Issueé¡µé¢å¯»æ±‚å¸®åŠ©ã€‚\nç¥æ‚¨é…ç½®é¡ºåˆ©ï¼ ğŸ‰\n","date":"2025-08-26T23:11:30+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/77bc6141/","title":"Proxmox VE 9.x å¼€å¯ Intel SR-IOV æ ¸æ˜¾ç›´é€š ğŸ–¥ï¸"},{"content":"Linux ç£ç›˜ç®¡ç†å®Œå…¨æŒ‡å— ğŸ§ğŸ’¾ ä¸€å¼ å›¾çœ‹æ‡‚ fdisk â†’ mkfs â†’ mount â†’ fstab å…¨æµç¨‹\næ–°æ‰‹ä¹Ÿèƒ½ 5 åˆ†é’Ÿä¸Šæ‰‹ï¼ä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜æ“ä½œï¼Œå…¨é¢æŒæ¡ Linux ç£ç›˜ç®¡ç†æŠ€å·§\nğŸ“‹ ç›®å½• ğŸ“Œ ç£ç›˜ç®¡ç†åŸºç¡€æ¦‚å¿µ ğŸ› ï¸ fdisk â€”â€” ç£ç›˜åˆ†åŒºåˆ©å™¨ âœ¨ mkfs â€”â€” æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ ğŸ”„ mount / umount â€”â€” æŒ‚è½½ä¸å¸è½½ ğŸ“œ /etc/fstab â€”â€” å¼€æœºè‡ªåŠ¨æŒ‚è½½ ğŸ” è¾…åŠ©å‘½ä»¤ ğŸš€ å®æˆ˜æ¡ˆä¾‹ï¼šæ–°ç¡¬ç›˜ä¸€æ¡é¾™ âš ï¸ å®‰å…¨ä¸æœ€ä½³å®è·µ ğŸ—‚ï¸ é€ŸæŸ¥è¡¨ ä¸€ã€ç£ç›˜ç®¡ç†åŸºç¡€æ¦‚å¿µ ğŸ“Œ æ¦‚å¿µ ç¤ºä¾‹è·¯å¾„ è¯´æ˜ ç‰©ç†ç£ç›˜ /dev/sda ç¬¬ä¸€å— SATA/SCSI ç¡¬ç›˜ NVMe ç£ç›˜ /dev/nvme0n1 ç¬¬ä¸€å— NVMe å›ºæ€ç¡¬ç›˜ åˆ†åŒº /dev/sda1 ç¬¬ä¸€å—ç¡¬ç›˜ç¬¬ 1 åˆ†åŒº é€»è¾‘å· /dev/mapper/vg-lv LVM é€»è¾‘å· å…‰ç›˜ /dev/sr0 å…‰é©±è®¾å¤‡ USB è®¾å¤‡ /dev/sdb1 USB è®¾å¤‡ç¬¬ä¸€ä¸ªåˆ†åŒº ğŸ” è®¾å¤‡å‘½åè§„åˆ™ SATA/SCSI/SAS: /dev/sd[a-z] (sda, sdb, sdc\u0026hellip;) NVMe: /dev/nvme[0-9]n[0-9] (nvme0n1, nvme0n2\u0026hellip;) è™šæ‹Ÿè®¾å¤‡: /dev/vd[a-z] (vda, vdb\u0026hellip;) è½¯RAID: /dev/md[0-9] (md0, md1\u0026hellip;) ğŸ“Š ç£ç›˜ç±»å‹å¯¹æ¯” ç±»å‹ ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ HDD å®¹é‡å¤§ï¼Œä»·æ ¼ä½ï¼Œé€Ÿåº¦æ…¢ æ•°æ®å­˜å‚¨ï¼Œå¤‡ä»½ SSD é€Ÿåº¦å¿«ï¼Œä»·æ ¼é«˜ï¼Œå¯¿å‘½æœ‰é™ ç³»ç»Ÿç›˜ï¼Œå¸¸ç”¨åº”ç”¨ NVMe æé€Ÿï¼Œä½å»¶è¿Ÿï¼Œä»·æ ¼é«˜ é«˜æ€§èƒ½éœ€æ±‚ï¼Œæ•°æ®åº“ äºŒã€fdisk â€”â€” ç£ç›˜åˆ†åŒºåˆ©å™¨ ğŸ› ï¸ 1. æŸ¥çœ‹ç£ç›˜åˆ—è¡¨ 1 2 3 sudo fdisk -l # æ‰€æœ‰ç£ç›˜ sudo fdisk -l /dev/sdb # æŒ‡å®šç£ç›˜ sudo fdisk -l | grep -i \u0026#34;disk /dev\u0026#34; # åªæ˜¾ç¤ºç£ç›˜åç§° 2. äº¤äº’å¼åˆ†åŒºï¼ˆMBR ç¤ºä¾‹ï¼‰ 1 sudo fdisk /dev/sdb æŒ‰é”® åŠŸèƒ½ è¯´æ˜ m å¸®åŠ© æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤ p æ‰“å°åˆ†åŒºè¡¨ æ˜¾ç¤ºå½“å‰åˆ†åŒºæƒ…å†µ n æ–°å»ºåˆ†åŒº åˆ›å»ºæ–°åˆ†åŒº d åˆ é™¤åˆ†åŒº åˆ é™¤ç°æœ‰åˆ†åŒº t æ›´æ”¹åˆ†åŒºç±»å‹ ä¿®æ”¹åˆ†åŒºID w ä¿å­˜é€€å‡º ä¿å­˜æ›´æ”¹å¹¶é€€å‡º q ä¸ä¿å­˜é€€å‡º æ”¾å¼ƒæ›´æ”¹å¹¶é€€å‡º 3. éäº¤äº’å¼åˆ†åŒº 1 2 3 4 5 # ä½¿ç”¨ echo å‘½ä»¤é€šè¿‡ç®¡é“ä¼ é€’æŒ‡ä»¤ echo -e \u0026#34;n\\np\\n1\\n\\n+20G\\nw\u0026#34; | sudo fdisk /dev/sdb # ä½¿ç”¨ sfdisk è„šæœ¬åˆ†åŒº echo \u0026#39;start=2048, size=20971520, type=83\u0026#39; | sudo sfdisk /dev/sdb 4. GPT åˆ†åŒºè¡¨ å¯¹äºå¤§äº 2TB çš„ç£ç›˜ï¼Œä½¿ç”¨ GPT åˆ†åŒºè¡¨ï¼š\n1 2 3 4 5 # ä½¿ç”¨ parted åˆ›å»º GPT åˆ†åŒºè¡¨ sudo parted /dev/sdb mklabel gpt # ä½¿ç”¨ gdisk å·¥å…·ï¼ˆç±»ä¼¼ fdisk ä½†ç”¨äº GPTï¼‰ sudo gdisk /dev/sdb ä¸‰ã€mkfs â€”â€” æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ âœ¨ å¸¸ç”¨æ–‡ä»¶ç³»ç»Ÿå¯¹æ¯” æ–‡ä»¶ç³»ç»Ÿ ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ ext4 ç¨³å®šï¼Œå…¼å®¹æ€§å¥½ï¼Œæ—¥å¿—å¼ é€šç”¨æ–‡ä»¶ç³»ç»Ÿ xfs é«˜æ€§èƒ½ï¼Œå¤§æ–‡ä»¶æ”¯æŒå¥½ å¤§æ–‡ä»¶å­˜å‚¨ï¼ŒæœåŠ¡å™¨ btrfs å¿«ç…§ï¼Œå‹ç¼©ï¼ŒRAIDæ”¯æŒ é«˜çº§åŠŸèƒ½éœ€æ±‚ vfat å…¼å®¹æ€§å¥½ï¼Œæ— æƒé™æ§åˆ¶ USBè®¾å¤‡ï¼Œè·¨å¹³å° ntfs Windowså…¼å®¹ï¼Œå¤§æ–‡ä»¶æ”¯æŒ Windowsæ•°æ®äº¤æ¢ å¿«é€Ÿæ ¼å¼åŒ–å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ext4 (å¸¦æ ‡ç­¾) sudo mkfs.ext4 -L Data /dev/sdb1 # xfs sudo mkfs.xfs -f /dev/sdb1 # btrfs sudo mkfs.btrfs -f /dev/sdb1 # FAT32 sudo mkfs.vfat -F 32 /dev/sdb1 # NTFS sudo mkfs.ntfs -f /dev/sdb1 # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ sudo fsck /dev/sdb1 é«˜çº§æ ¼å¼åŒ–é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®å—å¤§å°ï¼ˆå½±å“æ€§èƒ½ï¼‰ sudo mkfs.ext4 -b 4096 /dev/sdb1 # ä¿ç•™ç©ºé—´æ¯”ä¾‹ï¼ˆé»˜è®¤5%ï¼‰ sudo mkfs.ext4 -m 2 /dev/sdb1 # ä¿ç•™2%ç©ºé—´ # è®¾ç½®inodeæ•°é‡ï¼ˆå¤§é‡å°æ–‡ä»¶æ—¶æœ‰ç”¨ï¼‰ sudo mkfs.ext4 -N 50000 /dev/sdb1 # å¼ºåˆ¶æ ¼å¼åŒ–ï¼ˆå³ä½¿å·²æœ‰æ–‡ä»¶ç³»ç»Ÿï¼‰ sudo mkfs.ext4 -F /dev/sdb1 å››ã€mount / umount â€”â€” æŒ‚è½½ä¸å¸è½½ ğŸ”„ 1. ä¸´æ—¶æŒ‚è½½ 1 2 3 4 5 6 7 8 # åˆ›å»ºæŒ‚è½½ç‚¹ sudo mkdir -p /mnt/data # æŒ‚è½½åˆ†åŒº sudo mount /dev/sdb1 /mnt/data # æ£€æŸ¥æŒ‚è½½ df -h /mnt/data 2. å¸¸ç”¨æŒ‚è½½é€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ ro / rw åªè¯» / è¯»å†™ mount -o ro /dev/sdb1 /mnt/data noexec ç¦æ­¢æ‰§è¡Œ mount -o noexec /dev/sdb1 /mnt/data nosuid å¿½ç•¥SUIDä½ mount -o nosuid /dev/sdb1 /mnt/data nodev å¿½ç•¥è®¾å¤‡æ–‡ä»¶ mount -o nodev /dev/sdb1 /mnt/data sync / async åŒæ­¥ / å¼‚æ­¥å†™ mount -o sync /dev/sdb1 /mnt/data defaults é»˜è®¤é€‰é¡¹ mount -o defaults /dev/sdb1 /mnt/data noatime ä¸æ›´æ–°è®¿é—®æ—¶é—´ mount -o noatime /dev/sdb1 /mnt/data 1 2 3 4 5 # é‡æ–°æŒ‚è½½ä¸ºåªè¯» sudo mount -o remount,ro /mnt/data # ä½¿ç”¨å¤šä¸ªé€‰é¡¹ sudo mount -o noatime,nodiratime,noexec /dev/sdb1 /mnt/data 3. å¸è½½ 1 2 3 4 5 6 sudo umount /dev/sdb1 # æŒ‰è®¾å¤‡ sudo umount /mnt/data # æŒ‰æŒ‚è½½ç‚¹ # å¼ºåˆ¶å¸è½½ï¼ˆå½“è®¾å¤‡å¿™æ—¶ï¼‰ sudo umount -f /mnt/data # å¼ºåˆ¶å¸è½½ sudo umount -l /mnt/data # æ‡’å¸è½½ è‹¥æç¤º \u0026ldquo;device is busy\u0026rdquo;ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾å ç”¨è¿›ç¨‹ï¼š\n1 2 3 4 5 6 # æŸ¥æ‰¾å ç”¨è¿›ç¨‹ sudo lsof /mnt/data sudo fuser -vm /mnt/data # ç»ˆæ­¢å ç”¨è¿›ç¨‹ sudo fuser -k /mnt/data äº”ã€/etc/fstab â€”â€” å¼€æœºè‡ªåŠ¨æŒ‚è½½ ğŸ“œ 1. fstab æ–‡ä»¶æ ¼å¼ 1 \u0026lt;è®¾å¤‡æ ‡è¯†\u0026gt; \u0026lt;æŒ‚è½½ç‚¹\u0026gt; \u0026lt;æ–‡ä»¶ç³»ç»Ÿ\u0026gt; \u0026lt;é€‰é¡¹\u0026gt; \u0026lt;dump\u0026gt; \u0026lt;fsck\u0026gt; å­—æ®µ è¯´æ˜ ç¤ºä¾‹ è®¾å¤‡æ ‡è¯† è®¾å¤‡è·¯å¾„æˆ–UUID /dev/sdb1 æˆ– UUID=1234-5678 æŒ‚è½½ç‚¹ æŒ‚è½½ç›®å½• /mnt/data æ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿç±»å‹ ext4, xfs, ntfs é€‰é¡¹ æŒ‚è½½é€‰é¡¹ defaults, noatime dump å¤‡ä»½æ ‡å¿— 0 (ä¸å¤‡ä»½) æˆ– 1 (å¤‡ä»½) fsck æ£€æŸ¥é¡ºåº 0 (ä¸æ£€æŸ¥), 1 (æ ¹åˆ†åŒº), 2 (å…¶ä»–) 2. é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 # 1. è·å– UUID sudo blkid /dev/sdb1 # è¾“å‡ºï¼š/dev/sdb1: UUID=\u0026#34;1234-5678\u0026#34; TYPE=\u0026#34;ext4\u0026#34; # 2. ç¼–è¾‘ fstab sudo nano /etc/fstab # 3. æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆä½¿ç”¨UUIDæ›´å¯é ï¼‰ UUID=1234-5678 /mnt/data ext4 defaults,noatime 0 2 # 4. éªŒè¯é…ç½® sudo mount -a # æ— è¾“å‡ºå³æˆåŠŸ 3. ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿé…ç½® 1 2 3 4 5 6 7 8 9 10 11 # äº¤æ¢åˆ†åŒº /dev/sdb2 none swap sw 0 0 # ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ tmpfs /tmp tmpfs defaults,noatime,size=2G 0 0 # ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ (NFS) nfs-server:/export/data /mnt/data nfs defaults 0 0 # Windowså…±äº« (CIFS) //server/share /mnt/data cifs credentials=/etc/smbcreds,uid=1000,gid=1000 0 0 å…­ã€lsblk / blkid / df / du è¾…åŠ©å‘½ä»¤ ğŸ” 1. lsblk - åˆ—å‡ºå—è®¾å¤‡ 1 2 3 4 lsblk # ç®€å•åˆ—è¡¨ lsblk -f # æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿ lsblk -o NAME,SIZE,TYPE,MOUNTPOINT # æŒ‡å®šåˆ— lsblk -d -o NAME,ROTA,SIZE # æ˜¾ç¤ºç£ç›˜å±æ€§ï¼ˆROTA=1æ˜¯HDDï¼Œ0æ˜¯SSDï¼‰ 2. blkid - æŸ¥çœ‹å—è®¾å¤‡å±æ€§ 1 2 3 4 blkid # æ‰€æœ‰è®¾å¤‡ blkid /dev/sdb1 # æŒ‡å®šè®¾å¤‡ blkid -s UUID /dev/sdb1 # åªæ˜¾ç¤ºUUID blkid -s TYPE /dev/sdb1 # åªæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç±»å‹ 3. df - ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ 1 2 3 4 df -h # äººç±»å¯è¯»æ ¼å¼ df -h /mnt/data # æŒ‡å®šæŒ‚è½½ç‚¹ df -i # æ˜¾ç¤ºinodeä½¿ç”¨æƒ…å†µ df -T # æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç±»å‹ 4. du - ç›®å½•ç©ºé—´ä½¿ç”¨æƒ…å†µ 1 2 3 4 du -sh /mnt/data # æ€»å¤§å° du -sh * # å½“å‰ç›®å½•ä¸‹å„æ–‡ä»¶/æ–‡ä»¶å¤¹å¤§å° du -h --max-depth=1 /mnt # æ˜¾ç¤ºä¸€çº§å­ç›®å½•å¤§å° du -ah /mnt/data | sort -rh | head -10 # æœ€å¤§çš„10ä¸ªæ–‡ä»¶/ç›®å½• 5. å…¶ä»–æœ‰ç”¨å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ç£ç›˜å¥åº·çŠ¶æ€ (éœ€è¦å®‰è£…smartmontools) sudo smartctl -a /dev/sda # æµ‹è¯•ç£ç›˜è¯»å†™é€Ÿåº¦ sudo hdparm -Tt /dev/sda sudo dd if=/dev/zero of=/tmp/test bs=1M count=1024 conv=fdatasync # æŸ¥çœ‹ç£ç›˜I/Oç»Ÿè®¡ iostat -x 1 iotop ä¸ƒã€å®æˆ˜æ¡ˆä¾‹ï¼šæ–°ç¡¬ç›˜ä¸€æ¡é¾™ ğŸš€ åœºæ™¯ï¼šæ·»åŠ ä¸€å—æ–°ç¡¬ç›˜å¹¶é…ç½®ä¸ºæ•°æ®ç›˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # 1. æ‰¾ç›˜ lsblk # å‡è®¾æ–°ç¡¬ç›˜ä¸º /dev/sdc # 2. åˆ†åŒº (ä½¿ç”¨GPTåˆ†åŒºè¡¨ï¼Œé€‚åˆå¤§å®¹é‡ç¡¬ç›˜) sudo parted /dev/sdc mklabel gpt sudo parted /dev/sdc mkpart primary 0% 100% # 3. æ ¼å¼åŒ– sudo mkfs.ext4 -L Data /dev/sdc1 # 4. åˆ›å»ºæŒ‚è½½ç‚¹ sudo mkdir -p /mnt/data # 5. ä¸´æ—¶æŒ‚è½½æµ‹è¯• sudo mount /dev/sdc1 /mnt/data # 6. è®¾ç½®æƒé™ sudo chown -R $USER:$USER /mnt/data sudo chmod -R 755 /mnt/data # 7. å¼€æœºè‡ªåŠ¨æŒ‚è½½ echo \u0026#34;UUID=$(sudo blkid -s UUID -o value /dev/sdc1) /mnt/data ext4 defaults,noatime 0 2\u0026#34; | sudo tee -a /etc/fstab # 8. éªŒè¯ sudo mount -a \u0026amp;\u0026amp; df -h /mnt/data # 9. æµ‹è¯•å†™å…¥ echo \u0026#34;æµ‹è¯•æ•°æ®\u0026#34; \u0026gt; /mnt/data/test.txt cat /mnt/data/test.txt é«˜çº§åœºæ™¯ï¼šä½¿ç”¨LVMç®¡ç†å¤šå—ç¡¬ç›˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 1. å®‰è£…LVMå·¥å…· sudo apt install lvm2 # 2. åˆ›å»ºç‰©ç†å· sudo pvcreate /dev/sdc1 /dev/sdd1 # 3. åˆ›å»ºå·ç»„ sudo vgcreate data_vg /dev/sdc1 /dev/sdd1 # 4. åˆ›å»ºé€»è¾‘å· sudo lvcreate -n data_lv -l 100%FREE data_vg # 5. æ ¼å¼åŒ– sudo mkfs.ext4 /dev/data_vg/data_lv # 6. æŒ‚è½½å’Œä½¿ç”¨ sudo mkdir /mnt/data sudo mount /dev/data_vg/data_lv /mnt/data echo \u0026#34;/dev/mapper/data_vg-data_lv /mnt/data ext4 defaults 0 2\u0026#34; | sudo tee -a /etc/fstab å…«ã€å®‰å…¨ä¸æœ€ä½³å®è·µ âš ï¸ 1. æ•°æ®å®‰å…¨ å®šæœŸå¤‡ä»½ï¼šé‡è¦æ•°æ®è‡³å°‘ä¿ç•™3ä¸ªå‰¯æœ¬ ä½¿ç”¨RAIDï¼šå¯¹äºé‡è¦æ•°æ®ï¼Œä½¿ç”¨RAID 1/5/6/10 å¿«ç…§åŠŸèƒ½ï¼šä½¿ç”¨LVMæˆ–btrfså®šæœŸåˆ›å»ºå¿«ç…§ åŠ å¯†æ•æ„Ÿæ•°æ®ï¼šä½¿ç”¨LUKSåŠ å¯†ç£ç›˜ 1 2 3 4 5 # LUKSç£ç›˜åŠ å¯†ç¤ºä¾‹ sudo cryptsetup luksFormat /dev/sdb1 sudo cryptsetup open /dev/sdb1 encrypted_drive sudo mkfs.ext4 /dev/mapper/encrypted_drive sudo mount /dev/mapper/encrypted_drive /mnt/secure 2. æ€§èƒ½ä¼˜åŒ– é€‰æ‹©åˆé€‚çš„æ–‡ä»¶ç³»ç»Ÿï¼šæ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©ext4/xfs/btrfs è°ƒæ•´æŒ‚è½½é€‰é¡¹ï¼šä½¿ç”¨noatime,nodiratimeæå‡æ€§èƒ½ åˆç†åˆ†åŒºï¼šåˆ†ç¦»ç³»ç»Ÿã€æ•°æ®å’Œæ—¥å¿—åˆ°ä¸åŒåˆ†åŒº å®šæœŸç»´æŠ¤ï¼šä½¿ç”¨fsckæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿï¼Œdefragæ•´ç†ç¢ç‰‡ 3. ç›‘æ§ä¸é¢„è­¦ 1 2 3 4 5 6 7 8 # è®¾ç½®ç£ç›˜ç©ºé—´ç›‘æ§ # æ·»åŠ åˆ°crontabï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡ 0 0 * * * df -h | awk \u0026#39;$5+0 \u0026gt; 80 {print \u0026#34;è­¦å‘Š: \u0026#34;$6\u0026#34; ä½¿ç”¨ç‡è¶…è¿‡80%\u0026#34;}\u0026#39; # ç›‘æ§ç£ç›˜å¥åº· # å®‰è£…smartmontoolsï¼Œå®šæœŸæ£€æŸ¥SMARTçŠ¶æ€ sudo apt install smartmontools sudo smartctl -H /dev/sda 4. æ•…éšœæ¢å¤ ä¿ç•™æ•‘æ´ç³»ç»Ÿï¼šå‡†å¤‡Live CD/USBä»¥å¤‡ä¸æ—¶ä¹‹éœ€ å¤‡ä»½åˆ†åŒºè¡¨ï¼šä½¿ç”¨sfdiskå¤‡ä»½åˆ†åŒºè¡¨ 1 2 3 4 5 # å¤‡ä»½åˆ†åŒºè¡¨ sudo sfdisk -d /dev/sda \u0026gt; sda-partition-backup.txt # æ¢å¤åˆ†åŒºè¡¨ sudo sfdisk /dev/sda \u0026lt; sda-partition-backup.txt ä¹ã€é€ŸæŸ¥è¡¨ ğŸ—‚ï¸ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥ åœºæ™¯ å‘½ä»¤ æŸ¥çœ‹ç£ç›˜ lsblk -f, fdisk -l åˆ†åŒº fdisk /dev/sdX, parted /dev/sdX æ ¼å¼åŒ– mkfs.ext4 /dev/sdX1, mkfs.xfs /dev/sdX1 æŒ‚è½½ mount /dev/sdX1 /mnt/point å¸è½½ umount /mnt/point å¼€æœºæŒ‚è½½ ç¼–è¾‘ /etc/fstab æ£€æŸ¥ä¿®å¤ fsck -f /dev/sdX1 ç©ºé—´æŸ¥çœ‹ df -h, du -sh æ•…éšœæ’é™¤é€ŸæŸ¥ é—®é¢˜ è§£å†³æ–¹æ¡ˆ è®¾å¤‡å¿™æ— æ³•å¸è½½ lsof /mnt/point, fuser -k /mnt/point æ–‡ä»¶ç³»ç»ŸæŸå fsck -y /dev/sdX1 æ— æ³•æŒ‚è½½ dmesg | tail æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ ç©ºé—´ä¸è¶³ æ¸…ç†æ–‡ä»¶æˆ–è°ƒæ•´åˆ†åŒºå¤§å° æ€§èƒ½é—®é¢˜ è°ƒæ•´æŒ‚è½½é€‰é¡¹ï¼Œæ£€æŸ¥ç£ç›˜å¥åº· æ‰©å±•å­¦ä¹ èµ„æº Linux æ–‡æ¡£é¡¹ç›® Arch Linux Wiki Linux ç”·äººé¡µ ğŸ¯ ä¸€å¥è¯æ€»ç»“ï¼š\nåˆ†åŒº â†’ æ ¼å¼åŒ– â†’ æŒ‚è½½ä¸‰æ­¥èµ°ï¼Œfstab ä¿ç»ˆèº«ï¼\næŒæ¡è¿™äº›æŠ€èƒ½ï¼Œä½ å°±èƒ½è½»æ¾ç®¡ç†Linuxç£ç›˜äº†ï¼\nğŸ’¡ æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ“ä½œå‰ï¼ŒåŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å‘½ä»¤ï¼Œå¹¶ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½ï¼\n","date":"2025-08-26T21:06:12+08:00","image":"https://file.meimolihan.eu.org/img/linux-disk-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0ae9a7dd/","title":"Linux ç£ç›˜ç®¡ç†å®Œå…¨æŒ‡å— ğŸ§ğŸ’¾"},{"content":"Linux è®¡åˆ’ä»»åŠ¡ cron å‘½ä»¤è¯¦è§£ â° ğŸ“– ç›®å½•å¯¼èˆª âœ¨ ä¸€ã€cron æœåŠ¡ç‰¹ç‚¹ ğŸ¤” äºŒã€cron æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ•’ ä¸‰ã€æ—¶é—´æ ¼å¼è¯¦è§£ ğŸ”§ å››ã€crontab å¸¸ç”¨æ“ä½œ ğŸš€ äº”ã€å®æˆ˜ï¼šå¤‡ä»½ä»»åŠ¡ä» 0 åˆ° 1 ğŸ¢ å…­ã€ç³»ç»Ÿçº§ vs ç”¨æˆ·çº§ ğŸ ä¸ƒã€ç¯å¢ƒå˜é‡ \u0026amp; è°ƒè¯• ğŸ“Š å…«ã€ç›‘æ§ä¸æ—¥å¿—ç®¡ç† ğŸ•³ï¸ ä¹ã€å¸¸è§é—®é¢˜æ’æŸ¥ ğŸ“‹ åã€é€ŸæŸ¥è¡¨ ğŸ© åä¸€ã€é«˜çº§ç©æ³• ğŸ” åäºŒã€ç›‘æ§ä¸ç®¡ç† ä¸€ã€âœ¨ cron æœåŠ¡ç‰¹ç‚¹ â° ç²¾å‡†å®šæ—¶: æ”¯æŒåˆ†é’Ÿçº§ç²¾åº¦çš„ä»»åŠ¡è°ƒåº¦ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ: æ¯ä¸ªç”¨æˆ·å¯æ‹¥æœ‰ç‹¬ç«‹çš„ä»»åŠ¡åˆ—è¡¨ ğŸ“ çµæ´»é…ç½®: æ”¯æŒå¤æ‚çš„æ—¶é—´è¡¨è¾¾å¼å’Œæ¡ä»¶æ‰§è¡Œ ğŸ“Š æ—¥å¿—è®°å½•: å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—ä¾¿äºæ’æŸ¥é—®é¢˜ ğŸ”’ å®‰å…¨å¯æ§: æ”¯æŒæƒé™ç®¡ç†å’Œè®¿é—®æ§åˆ¶ ğŸ”„ ç¨³å®šå¯é : ç³»ç»Ÿçº§å®ˆæŠ¤è¿›ç¨‹ï¼Œé•¿æœŸç¨³å®šè¿è¡Œ ğŸ¤” äºŒã€cron æ˜¯ä»€ä¹ˆï¼Ÿ ç»„ä»¶ ä½œç”¨ ä½ç½® crond åå°å®ˆæŠ¤è¿›ç¨‹ï¼Œä»»åŠ¡è°ƒåº¦æ ¸å¿ƒ /usr/sbin/crond crontab ç”¨æˆ·ä»»åŠ¡é…ç½®æ–‡ä»¶ /var/spool/cron/ ç³»ç»Ÿcron ç³»ç»Ÿçº§ä»»åŠ¡é…ç½® /etc/crontab å®šæ—¶ç›®å½• æŒ‰å‘¨æœŸæ‰§è¡Œçš„è„šæœ¬ç›®å½• /etc/cron.daily/, /etc/cron.hourly/ç­‰ ğŸ” crond è¿›ç¨‹ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ crond æœåŠ¡çŠ¶æ€ sudo systemctl status cron # Ubuntu/Debian sudo systemctl status crond # CentOS/RHEL # å¯åŠ¨/åœæ­¢/é‡å¯æœåŠ¡ sudo systemctl start cron sudo systemctl stop cron sudo systemctl restart cron # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable cron ğŸ•’ ä¸‰ã€æ—¶é—´æ ¼å¼è¯¦è§£ ğŸ“Š åŸºæœ¬æ—¶é—´æ ¼å¼ 1 2 3 4 5 6 7 â”Œâ”€ åˆ†é’Ÿ (0-59) â”‚ â”Œâ”€ å°æ—¶ (0-23) â”‚ â”‚ â”Œâ”€ æ—¥ (1-31) â”‚ â”‚ â”‚ â”Œâ”€ æœˆ (1-12) â”‚ â”‚ â”‚ â”‚ â”Œâ”€ æ˜ŸæœŸ (0-6, 0=å‘¨æ—¥) â”‚ â”‚ â”‚ â”‚ â”‚ * * * * * è¦æ‰§è¡Œçš„å‘½ä»¤ ğŸ“‹ å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼ç¤ºä¾‹ è¡¨è¾¾å¼ å«ä¹‰ ç¤ºä¾‹ * * * * * æ¯åˆ†é’Ÿæ‰§è¡Œ å®æ—¶ç›‘æ§ 0 * * * * æ¯å°æ—¶æ‰§è¡Œ æ•´ç‚¹æŠ¥å‘Š 0 2 * * * æ¯å¤© 02:00 æ‰§è¡Œ æ¯æ—¥å¤‡ä»½ */10 * * * * æ¯ 10 åˆ†é’Ÿæ‰§è¡Œ é¢‘ç¹æ£€æŸ¥ 0 9-18 * * 1-5 å·¥ä½œæ—¥ 9-18 ç‚¹æ•´ç‚¹æ‰§è¡Œ å·¥ä½œæ—¶é—´ä»»åŠ¡ 0 0 1 * * æ¯æœˆ1å·æ‰§è¡Œ æœˆç»“ä»»åŠ¡ 0 12 * * 0 æ¯å‘¨æ—¥ä¸­åˆæ‰§è¡Œ å‘¨æŠ¥ç”Ÿæˆ ğŸ¯ ç‰¹æ®Šå­—ç¬¦è¯´æ˜ å­—ç¬¦ å«ä¹‰ ç¤ºä¾‹ * ä»»æ„å€¼ * * * * * = æ¯åˆ†é’Ÿ , å€¼åˆ—è¡¨ 0 2,14 * * * = 2ç‚¹å’Œ14ç‚¹ - èŒƒå›´ 0 9-18 * * * = 9ç‚¹åˆ°18ç‚¹æ¯å°æ—¶ / æ­¥é•¿ */5 * * * * = æ¯5åˆ†é’Ÿ @ é¢„è®¾ @daily = æ¯å¤©ä¸€æ¬¡ âš¡ é¢„è®¾è¡¨è¾¾å¼ é¢„è®¾ ç­‰ä»·è¡¨è¾¾å¼ æè¿° @yearly 0 0 1 1 * æ¯å¹´1æœˆ1æ—¥æ‰§è¡Œ @annually 0 0 1 1 * åŒ @yearly @monthly 0 0 1 * * æ¯æœˆ1æ—¥æ‰§è¡Œ @weekly 0 0 * * 0 æ¯å‘¨æ—¥æ‰§è¡Œ @daily 0 0 * * * æ¯å¤©æ‰§è¡Œ @hourly 0 * * * * æ¯å°æ—¶æ‰§è¡Œ @reboot - ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œ ğŸ”§ å››ã€crontab å¸¸ç”¨æ“ä½œ ğŸ“ åŸºæœ¬æ“ä½œå‘½ä»¤ å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ crontab -e ç¼–è¾‘å½“å‰ç”¨æˆ·ä»»åŠ¡ crontab -e crontab -l åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡ crontab -l crontab -r åˆ é™¤æ‰€æœ‰ä»»åŠ¡ crontab -r crontab -u user -e ç¼–è¾‘æŒ‡å®šç”¨æˆ·ä»»åŠ¡ crontab -u alice -e crontab -u user -l åˆ—å‡ºæŒ‡å®šç”¨æˆ·ä»»åŠ¡ crontab -u bob -l ğŸ› ï¸ é«˜çº§ç®¡ç†æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¤‡ä»½cronä»»åŠ¡ crontab -l \u0026gt; cron_backup.txt # ä»æ–‡ä»¶æ¢å¤cronä»»åŠ¡ crontab cron_backup.txt # ç¼–è¾‘å…¶ä»–ç”¨æˆ·cronï¼ˆéœ€è¦rootæƒé™ï¼‰ sudo crontab -u username -e # æ£€æŸ¥cronè¯­æ³• crontab -e # ä¿å­˜æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥è¯­æ³• # æŸ¥çœ‹cronæ‰§è¡Œæ—¥å¿— sudo grep CRON /var/log/syslog ğŸ“ æ–‡ä»¶ä½ç½®è¯´æ˜ æ–‡ä»¶/ç›®å½• ç”¨é€” æƒé™ /var/spool/cron/ ç”¨æˆ·cronæ–‡ä»¶å­˜å‚¨ä½ç½® ç”¨æˆ·å„è‡ªç›®å½• /etc/crontab ç³»ç»Ÿcroné…ç½®æ–‡ä»¶ root /etc/cron.d/ ç³»ç»Ÿcronç‰‡æ®µç›®å½• root /etc/cron.daily/ æ¯æ—¥æ‰§è¡Œè„šæœ¬ root /etc/cron.hourly/ æ¯å°æ—¶æ‰§è¡Œè„šæœ¬ root /etc/cron.weekly/ æ¯å‘¨æ‰§è¡Œè„šæœ¬ root /etc/cron.monthly/ æ¯æœˆæ‰§è¡Œè„šæœ¬ root ğŸš€ äº”ã€å®æˆ˜ï¼šå¤‡ä»½ä»»åŠ¡ä» 0 åˆ° 1 ç›®æ ‡ï¼šæ¯å¤©å‡Œæ™¨ 3 ç‚¹è‡ªåŠ¨å¤‡ä»½ /etc ç›®å½•ï¼Œä¿ç•™æœ€è¿‘ 7 å¤©å¤‡ä»½\n1ï¸âƒ£ åˆ›å»ºå¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 # åˆ›å»ºå¤‡ä»½ç›®å½• sudo mkdir -p /backup sudo chmod 755 /backup # åˆ›å»ºå¤‡ä»½è„šæœ¬ sudo nano /usr/local/bin/backup-etc.sh è„šæœ¬å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # /usr/local/bin/backup-etc.sh # æ¯æ—¥etcç›®å½•å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) LOG_FILE=\u0026#34;/var/log/backup-etc.log\u0026#34; # åˆ›å»ºå¤‡ä»½ echo \u0026#34;[$(date)] å¼€å§‹å¤‡ä»½ /etc ç›®å½•...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE tar -czf $BACKUP_DIR/etc-$DATE.tar.gz /etc 2\u0026gt;\u0026gt; $LOG_FILE if [ $? -eq 0 ]; then echo \u0026#34;[$(date)] å¤‡ä»½æˆåŠŸ: etc-$DATE.tar.gz\u0026#34; \u0026gt;\u0026gt; $LOG_FILE else echo \u0026#34;[$(date)] å¤‡ä»½å¤±è´¥!\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi # æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™7å¤©ï¼‰ find $BACKUP_DIR -name \u0026#34;etc-*.tar.gz\u0026#34; -mtime +7 -delete 2\u0026gt;/dev/null echo \u0026#34;[$(date)] æ¸…ç†7å¤©å‰çš„æ—§å¤‡ä»½\u0026#34; \u0026gt;\u0026gt; $LOG_FILE echo \u0026#34;[$(date)] å¤‡ä»½ä»»åŠ¡å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE è®¾ç½®æ‰§è¡Œæƒé™ï¼š\n1 sudo chmod +x /usr/local/bin/backup-etc.sh 2ï¸âƒ£ é…ç½®cronä»»åŠ¡ 1 2 # ç¼–è¾‘rootç”¨æˆ·çš„cronä»»åŠ¡ sudo crontab -e æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 # æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œå¤‡ä»½ 0 3 * * * /usr/local/bin/backup-etc.sh \u0026gt;\u0026gt; /var/log/backup-etc.log 2\u0026gt;\u0026amp;1 # æ¯å‘¨æ—¥æ¸…ç†æ—¥å¿—ï¼ˆä¿ç•™30å¤©ï¼‰ 0 2 * * 0 find /var/log/backup-etc.log -mtime +30 -delete 3ï¸âƒ£ æµ‹è¯•é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰‹åŠ¨æµ‹è¯•è„šæœ¬ sudo /usr/local/bin/backup-etc.sh # æ£€æŸ¥å¤‡ä»½æ–‡ä»¶ ls -la /backup/ # æ£€æŸ¥æ—¥å¿— tail -f /var/log/backup-etc.log # æµ‹è¯•cronè¯­æ³•ï¼ˆç³»ç»Ÿçº§ï¼‰ run-parts --test /etc/cron.daily # ç«‹å³æ‰§è¡Œä¸€æ¬¡cronä»»åŠ¡ï¼ˆè°ƒè¯•ç”¨ï¼‰ sudo run-parts /etc/cron.daily/ 4ï¸âƒ£ éªŒè¯è‡ªåŠ¨åŒ– 1 2 3 4 5 6 7 # æŸ¥çœ‹cronæ‰§è¡Œè®°å½• sudo grep CRON /var/log/syslog | tail -10 # æ£€æŸ¥ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ # éœ€è¦å®‰è£…å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ sudo apt install cron-utils # Debian/Ubuntu cron-list # æ˜¾ç¤ºæ‰€æœ‰è®¡åˆ’ä»»åŠ¡ ğŸ¢ å…­ã€ç³»ç»Ÿçº§ vs ç”¨æˆ·çº§ ğŸ“Š å¯¹æ¯”è¡¨æ ¼ ç‰¹æ€§ ç”¨æˆ·çº§cron ç³»ç»Ÿçº§cron é…ç½®æ–‡ä»¶ crontab -e /etc/crontab æƒé™ ç”¨æˆ·æƒé™ rootæƒé™ æ—¥å¿— ç”¨æˆ·é‚®ä»¶æˆ–æŒ‡å®šæ–‡ä»¶ ç³»ç»Ÿæ—¥å¿— ç®¡ç† ç”¨æˆ·è‡ªå·±ç®¡ç† ç³»ç»Ÿç®¡ç†å‘˜ç®¡ç† ä½ç½® /var/spool/cron/ /etc/crontab, /etc/cron.d/ ç¯å¢ƒ ç”¨æˆ·ç¯å¢ƒå˜é‡ ç³»ç»Ÿç¯å¢ƒå˜é‡ ğŸ“ ç³»ç»Ÿcroné…ç½®ç¤ºä¾‹ ç¼–è¾‘ /etc/crontabï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # ç³»ç»Ÿcrontabç¤ºä¾‹ SHELL=/bin/bash PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin MAILTO=admin@example.com # æ¯å¤©å‡Œæ™¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶ 0 2 * * * root find /tmp -type f -mtime +7 -delete # æ¯å‘¨ä¸€ä¼˜åŒ–æ•°æ®åº“ 0 3 * * 1 mysql /usr/local/bin/optimize-db.sh # æ¯å°æ—¶æ£€æŸ¥ç£ç›˜ç©ºé—´ 0 * * * * root /usr/local/bin/check-disk-space.sh ğŸ“ å®šæ—¶ç›®å½•ä½¿ç”¨ 1 2 3 4 5 # æŸ¥çœ‹ç³»ç»Ÿå®šæ—¶ç›®å½• ls -la /etc/cron.* # åˆ›å»ºè‡ªå®šä¹‰æ¯å°æ—¶ä»»åŠ¡ sudo nano /etc/cron.hourly/my-hourly-task è„šæœ¬å†…å®¹ï¼š\n1 2 3 #!/bin/bash # /etc/cron.hourly/my-hourly-task logger \u0026#34;æ¯å°æ—¶ä»»åŠ¡æ‰§è¡Œäº $(date)\u0026#34; è®¾ç½®æ‰§è¡Œæƒé™ï¼š\n1 sudo chmod +x /etc/cron.hourly/my-hourly-task ğŸ ä¸ƒã€ç¯å¢ƒå˜é‡ \u0026amp; è°ƒè¯• ğŸ”§ ç¯å¢ƒå˜é‡é…ç½® åœ¨crontabé¡¶éƒ¨æ·»åŠ ç¯å¢ƒå˜é‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # ç”¨æˆ·crontabç¯å¢ƒé…ç½® SHELL=/bin/bash PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin LANG=en_US.UTF-8 HOME=/home/username MAILTO=user@example.com # è‡ªå®šä¹‰è·¯å¾„ CUSTOM_PATH=/opt/myapp/bin # æ¯å¤©ä»»åŠ¡ 0 2 * * * $CUSTOM_PATH/daily-task.sh ğŸ“Š è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 1. æŸ¥çœ‹cronæ‰§è¡Œæ—¥å¿— sudo tail -f /var/log/syslog | grep CRON # 2. é‡å®šå‘è¾“å‡ºè°ƒè¯• 0 * * * * /path/to/script.sh \u0026gt;\u0026gt; /tmp/debug.log 2\u0026gt;\u0026amp;1 # 3. ä½¿ç”¨loggerå‘½ä»¤è®°å½• 0 * * * * /path/to/script.sh 2\u0026gt;\u0026amp;1 | logger -t mycron # 4. æµ‹è¯•ç¯å¢ƒå˜é‡ 0 * * * * env \u0026gt; /tmp/cron-env.log # 5. é€æ­¥è°ƒè¯•è„šæœ¬ # åœ¨è„šæœ¬ä¸­æ·»åŠ set -x #!/bin/bash set -x # å¼€å¯è°ƒè¯•æ¨¡å¼ echo \u0026#34;å¼€å§‹æ‰§è¡Œ...\u0026#34; ğŸ› å¸¸è§ç¯å¢ƒé—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é—®é¢˜ï¼šå‘½ä»¤æ‰¾ä¸åˆ° # è§£å†³ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–è®¾ç½®PATH which command_name # æŸ¥æ‰¾å‘½ä»¤ç»å¯¹è·¯å¾„ # é—®é¢˜ï¼šæƒé™ä¸è¶³ # è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™æˆ–ä½¿ç”¨sudo ls -la /path/to/script.sh chmod +x /path/to/script.sh # é—®é¢˜ï¼šç¯å¢ƒå˜é‡ç¼ºå¤± # è§£å†³ï¼šåœ¨è„šæœ¬ä¸­è®¾ç½®æˆ–crontabä¸­è®¾ç½® #!/bin/bash source /home/user/.bashrc export PATH=$PATH:/custom/path å…«ã€ğŸ“Š ç›‘æ§ä¸æ—¥å¿—ç®¡ç† ğŸ“ æ—¥å¿—ç®¡ç†é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åœ¨è„šæœ¬ä¸­æ·»åŠ æ—¥å¿—åŠŸèƒ½ log_file=\u0026#34;/var/log/1panel-sync.log\u0026#34; # é‡å®šå‘è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ exec \u0026gt;\u0026gt; \u0026#34;$log_file\u0026#34; 2\u0026gt;\u0026amp;1 # æ—¥å¿—è½®è½¬é…ç½®ï¼ˆå¯é€‰ï¼‰ cat \u0026gt; /etc/logrotate.d/1panel-sync \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /var/log/1panel-sync.log { daily rotate 7 missingok notifempty compress delaycompress create 644 root root } EOF éªŒè¯è½®è½¬ 1 logrotate -d /etc/logrotate.d/1panel-sync å¼ºåˆ¶è½®è½¬ 1 logrotate -f /etc/logrotate.d/1panel-sync æŸ¥çœ‹è½®è½¬å†å² 1 ls -lh /var/log/ ğŸ”” é‚®ä»¶é€šçŸ¥é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœ¨è„šæœ¬ä¸­æ·»åŠ é‚®ä»¶é€šçŸ¥ send_email() { local subject=$1 local body=$2 local recipient=\u0026#34;admin@example.com\u0026#34; echo \u0026#34;$body\u0026#34; | mail -s \u0026#34;$subject\u0026#34; \u0026#34;$recipient\u0026#34; } # åœ¨ä»»åŠ¡å®Œæˆæ—¶è°ƒç”¨ if [ $? -eq 0 ]; then send_email \u0026#34;âœ… åŒæ­¥æˆåŠŸ\u0026#34; \u0026#34;Homeç›®å½•åŒæ­¥å®Œæˆäº $(date)\u0026#34; else send_email \u0026#34;âŒ åŒæ­¥å¤±è´¥\u0026#34; \u0026#34;Homeç›®å½•åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—\u0026#34; fi ğŸ“‹ æ¨èçš„è®¡åˆ’ä»»åŠ¡æ—¶é—´è¡¨ ä»»åŠ¡ç±»å‹ æ¨èæ—¶é—´ é¢‘ç‡ è¯´æ˜ ğŸ”„ åŒæ­¥ä»»åŠ¡ 0 */6 * * * æ¯6å°æ—¶ ä¿æŒæ•°æ®å®æ—¶æ€§ ğŸ—œï¸ å¤‡ä»½ä»»åŠ¡ 0 2 * * * æ¯å¤©å‡Œæ™¨ ä½å³°æœŸæ‰§è¡Œ ğŸ“‹ æ—¥å¿—æ¸…ç† 0 4 * * 0 æ¯å‘¨æ—¥ æ¸…ç†æ—§æ—¥å¿— ğŸ•³ï¸ ä¹ã€å¸¸è§é—®é¢˜æ’æŸ¥ ğŸ“‹ é—®é¢˜è¯Šæ–­è¡¨ ç—‡çŠ¶ å¯èƒ½åŸå›  è§£å†³æ–¹æ³• ä»»åŠ¡ä¸æ‰§è¡Œ crondæœåŠ¡æœªè¿è¡Œ systemctl status cron æƒé™é”™è¯¯ è„šæœ¬æ— æ‰§è¡Œæƒé™ chmod +x script.sh è·¯å¾„é—®é¢˜ å‘½ä»¤æ‰¾ä¸åˆ° ä½¿ç”¨ç»å¯¹è·¯å¾„ ç¯å¢ƒé—®é¢˜ ç¯å¢ƒå˜é‡ç¼ºå¤± åœ¨crontabä¸­è®¾ç½®PATH è¾“å‡ºä¸¢å¤± æœªé‡å®šå‘è¾“å‡º æ·»åŠ  \u0026gt;\u0026gt; logfile 2\u0026gt;\u0026amp;1 èµ„æºé™åˆ¶ å†…å­˜æˆ–CPUä¸è¶³ ä¼˜åŒ–è„šæœ¬æˆ–è°ƒæ•´æ—¶é—´ ğŸ” è¯¦ç»†æ’æŸ¥æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # 1. æ£€æŸ¥crondæœåŠ¡çŠ¶æ€ sudo systemctl status cron sudo systemctl restart cron # 2. æ£€æŸ¥cronæ—¥å¿— sudo grep CRON /var/log/syslog sudo tail -f /var/log/syslog | grep CRON # 3. æ£€æŸ¥è„šæœ¬æƒé™ ls -la /path/to/script.sh chmod +x /path/to/script.sh # 4. æ‰‹åŠ¨æµ‹è¯•è„šæœ¬ /path/to/script.sh # 5. æ£€æŸ¥ç¯å¢ƒå˜é‡ # åœ¨è„šæœ¬å¼€å¤´æ·»åŠ  env \u0026gt; /tmp/script_env.log # 6. æŸ¥çœ‹ç³»ç»Ÿèµ„æº top -b -n 1 | head -20 free -h # 7. æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h # 8. æŸ¥çœ‹è¿›ç¨‹é™åˆ¶ ulimit -a âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 10 # 1. é¿å…ä½¿ç”¨rootè¿è¡Œä¸å¿…è¦çš„ä»»åŠ¡ # 2. æ£€æŸ¥è„šæœ¬å®‰å…¨æ€§ # 3. è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™ # 4. å®šæœŸå®¡æŸ¥cronä»»åŠ¡ # 5. ä½¿ç”¨æ—¥å¿—è®°å½•æ‰€æœ‰æ‰§è¡Œ # å®‰å…¨å®¡æŸ¥å‘½ä»¤ sudo crontab -l # æŸ¥çœ‹rootä»»åŠ¡ sudo ls -la /etc/cron.d/ # æ£€æŸ¥ç³»ç»Ÿä»»åŠ¡ sudo grep -r \u0026#34;å¯ç–‘æ¨¡å¼\u0026#34; /etc/cron* # æœç´¢å¯ç–‘ä»»åŠ¡ ğŸ“‹ åã€é€ŸæŸ¥è¡¨ â° æ—¶é—´è¡¨è¾¾å¼é€ŸæŸ¥ éœ€æ±‚ è¡¨è¾¾å¼ ç¤ºä¾‹ æ¯åˆ†é’Ÿ * * * * * å®æ—¶ç›‘æ§ æ¯5åˆ†é’Ÿ */5 * * * * 5åˆ†é’Ÿæ£€æŸ¥ æ¯å°æ—¶ 0 * * * * æ•´ç‚¹æŠ¥å‘Š æ¯å¤©2ç‚¹ 0 2 * * * æ¯æ—¥å¤‡ä»½ å·¥ä½œæ—¥9ç‚¹ 0 9 * * 1-5 å·¥ä½œæ—¥ä»»åŠ¡ æ¯å‘¨æ—¥3ç‚¹ 0 3 * * 0 å‘¨æŠ¥ç”Ÿæˆ æ¯æœˆ1å· 0 0 1 * * æœˆç»“ä»»åŠ¡ æ¯å°æ—¶30åˆ† 30 * * * * åŠç‚¹ä»»åŠ¡ ğŸ”§ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥ å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ crontab -e ç¼–è¾‘ä»»åŠ¡ crontab -e crontab -l åˆ—å‡ºä»»åŠ¡ crontab -l crontab -r åˆ é™¤æ‰€æœ‰ä»»åŠ¡ crontab -r systemctl status cron æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status cron grep CRON /var/log/syslog æŸ¥çœ‹æ‰§è¡Œæ—¥å¿— sudo grep CRON /var/log/syslog ğŸ“ æœ€ä½³å®è·µé€ŸæŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 1. æ€»æ˜¯ä½¿ç”¨ç»å¯¹è·¯å¾„ # é”™è¯¯: python script.py # æ­£ç¡®: /usr/bin/python /path/to/script.py # 2. é‡å®šå‘è¾“å‡º * * * * * /path/script.sh \u0026gt;\u0026gt; /var/log/script.log 2\u0026gt;\u0026amp;1 # 3. è®¾ç½®ç¯å¢ƒå˜é‡ SHELL=/bin/bash PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin # 4. æµ‹è¯•è„šæœ¬ bash -x /path/to/script.sh # 5. æ·»åŠ æ—¥å¿—è®°å½• echo \u0026#34;$(date): ä»»åŠ¡å¼€å§‹\u0026#34; \u0026gt;\u0026gt; /var/log/cron.log ğŸ© åä¸€ã€é«˜çº§ç©æ³• ğŸ”„ systemd timer æ›¿ä»£æ–¹æ¡ˆ 1 2 # åˆ›å»ºsystemd service sudo nano /etc/systemd/system/backup-etc.service 1 2 3 4 5 6 7 8 [Unit] Description=Backup /etc directory After=network.target [Service] Type=oneshot ExecStart=/usr/local/bin/backup-etc.sh User=root 1 2 # åˆ›å»ºsystemd timer sudo nano /etc/systemd/system/backup-etc.timer 1 2 3 4 5 6 7 8 9 10 [Unit] Description=Run backup-etc daily at 3AM Requires=backup-etc.service [Timer] OnCalendar=*-*-* 03:00:00 Persistent=true [Install] WantedBy=timers.target 1 2 3 4 # å¯ç”¨å¹¶å¯åŠ¨timer sudo systemctl enable backup-etc.timer sudo systemctl start backup-etc.timer sudo systemctl list-timers âš¡ at å‘½ä»¤ä¸€æ¬¡æ€§ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 # å®‰æ’ä¸€æ¬¡æ€§ä»»åŠ¡ echo \u0026#34;/path/to/script.sh\u0026#34; | at now + 1 hour echo \u0026#34;/path/to/script.sh\u0026#34; | at 02:00 tomorrow echo \u0026#34;/path/to/script.sh\u0026#34; | at teatime # 16:00 # æŸ¥çœ‹ç­‰å¾…çš„ä»»åŠ¡ atq # åˆ é™¤ä»»åŠ¡ atrm ä»»åŠ¡å· ğŸ”„ anacron å¼‚æ­¥ä»»åŠ¡ 1 2 3 4 5 # å®‰è£…anacron sudo apt install anacron # Debian/Ubuntu # é…ç½®anacron sudo nano /etc/anacrontab 1 2 3 4 5 6 7 8 # /etc/anacrontab ç¤ºä¾‹ SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # å‘¨æœŸ å»¶è¿Ÿ ä»»åŠ¡æ ‡è¯†ç¬¦ å‘½ä»¤ 1 5 daily-job /usr/local/bin/daily.sh 7 10 weekly-job /usr/local/bin/weekly.sh @monthly 15 monthly-job /usr/local/bin/monthly.sh ğŸ” åäºŒã€ç›‘æ§ä¸ç®¡ç† ğŸ“Š ç›‘æ§å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 1. æŸ¥çœ‹cronæ‰§è¡ŒçŠ¶æ€ sudo systemctl status cron sudo journalctl -u cron.service # 2. ç›‘æ§cronæ—¥å¿— sudo tail -f /var/log/syslog | grep CRON # 3. ä½¿ç”¨ç›‘æ§å·¥å…· sudo apt install cron-apt # ç›‘æ§cronæ‰§è¡Œ sudo apt install logwatch # æ—¥å¿—åˆ†æ # 4. è‡ªå®šä¹‰ç›‘æ§è„šæœ¬ #!/bin/bash # æ£€æŸ¥cronæœåŠ¡çŠ¶æ€ if ! systemctl is-active --quiet cron; then echo \u0026#34;Cron service is down!\u0026#34; | mail -s \u0026#34;Cron Alert\u0026#34; admin@example.com sudo systemctl start cron fi ğŸ› ï¸ ç®¡ç†å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. æ‰¹é‡ç®¡ç†å·¥å…· # ä½¿ç”¨Ansibleç®¡ç†å¤šå°æœåŠ¡å™¨cron ansible all -m cron -a \u0026#34;name=\u0026#39;daily backup\u0026#39; hour=3 job=\u0026#39;/path/to/backup.sh\u0026#39;\u0026#34; # 2. å›¾å½¢åŒ–ç®¡ç†å·¥å…· sudo apt install gnome-schedule # GNOMEå®šæ—¶ä»»åŠ¡ç®¡ç†å™¨ # 3. Webç®¡ç†ç•Œé¢ # è€ƒè™‘ä½¿ç”¨Webminæˆ–å…¶ä»–ç®¡ç†é¢æ¿ # 4. ç‰ˆæœ¬æ§åˆ¶ # å°†cronä»»åŠ¡çº³å…¥ç‰ˆæœ¬æ§åˆ¶ crontab -l \u0026gt; ~/cron-backup.txt git add ~/cron-backup.txt git commit -m \u0026#34;Backup cron tasks\u0026#34; ğŸ“ˆ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 1. é¿å…ä»»åŠ¡é‡å  # ä½¿ç”¨flocké˜²æ­¢é‡å¤æ‰§è¡Œ 0 * * * * /usr/bin/flock -w 0 /tmp/my.lock /path/to/script.sh # 2. èµ„æºé™åˆ¶ # åœ¨è„šæœ¬ä¸­æ·»åŠ èµ„æºé™åˆ¶ #!/bin/bash ulimit -n 1024 # é™åˆ¶æ–‡ä»¶æè¿°ç¬¦ ulimit -u 100 # é™åˆ¶è¿›ç¨‹æ•° # 3. ä»»åŠ¡è°ƒåº¦ä¼˜åŒ– # å°†å¯†é›†ä»»åŠ¡åˆ†æ•£åˆ°ä¸åŒæ—¶é—´ # é¿å…æ•´ç‚¹åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ # 4. ä½¿ç”¨niceè°ƒæ•´ä¼˜å…ˆçº§ 0 * * * * nice -n 19 /path/to/cpu-intensive-task.sh ğŸ¯ æ€»ç»“ crontab å°±æ˜¯ã€Œæ—¶é—´ + å‘½ä»¤ã€çš„è‡ªåŠ¨é—¹é’Ÿï¼Œå†™å¥½è·¯å¾„ã€åŠ å¥½æ—¥å¿—ã€å‹¤éªŒè¯ï¼Œæ°¸ä¸è¸©å‘ï¼\nâœ… æœ€ä½³å®è·µæ¸…å• âœ… ä½¿ç”¨ç»å¯¹è·¯å¾„ - é¿å…ç¯å¢ƒå˜é‡é—®é¢˜ âœ… é‡å®šå‘è¾“å‡º - \u0026gt;\u0026gt; logfile 2\u0026gt;\u0026amp;1 âœ… è®¾ç½®ç¯å¢ƒå˜é‡ - åœ¨crontabé¡¶éƒ¨å®šä¹‰PATH âœ… æµ‹è¯•è„šæœ¬ - æ‰‹åŠ¨è¿è¡ŒéªŒè¯åŠŸèƒ½ âœ… æ·»åŠ æ—¥å¿— - è®°å½•æ‰§è¡Œæƒ…å†µå’Œé”™è¯¯ âœ… æƒé™ç®¡ç† - ä½¿ç”¨æœ€å°å¿…è¦æƒé™ âœ… å®šæœŸå®¡æŸ¥ - æ¸…ç†ä¸å†éœ€è¦çš„ä»»åŠ¡ âœ… å¤‡ä»½é…ç½® - å®šæœŸå¤‡ä»½cronä»»åŠ¡åˆ—è¡¨ âœ… ç›‘æ§å‘Šè­¦ - è®¾ç½®ä»»åŠ¡æ‰§è¡Œç›‘æ§ âœ… æ–‡æ¡£ç»´æŠ¤ - è®°å½•ä»»åŠ¡ç”¨é€”å’Œå˜æ›´ ğŸ”§ æ•…éšœæ’æŸ¥æµç¨‹ æ£€æŸ¥æœåŠ¡çŠ¶æ€ â†’ systemctl status cron æŸ¥çœ‹æ‰§è¡Œæ—¥å¿— â†’ grep CRON /var/log/syslog æ‰‹åŠ¨æµ‹è¯•è„šæœ¬ â†’ bash -x script.sh æ£€æŸ¥æ–‡ä»¶æƒé™ â†’ ls -la script.sh éªŒè¯ç¯å¢ƒå˜é‡ â†’ env \u0026gt; debug.log æŸ¥çœ‹ç³»ç»Ÿèµ„æº â†’ top, free, df é€šè¿‡æŒæ¡è¿™äº›æŠ€å·§å’Œæœ€ä½³å®è·µï¼Œæ‚¨å°†èƒ½å¤Ÿé«˜æ•ˆåœ°ä½¿ç”¨cronæ¥è‡ªåŠ¨åŒ–æœåŠ¡å™¨ä»»åŠ¡ï¼Œæé«˜å·¥ä½œæ•ˆç‡å¹¶ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚ğŸ‰\n","date":"2025-08-26T21:01:35+08:00","image":"https://file.meimolihan.eu.org/img/linux-cron-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a8bf2d02/","title":"Linux è®¡åˆ’ä»»åŠ¡ cron å‘½ä»¤è¯¦è§£ â°"},{"content":"Linux æ–‡æœ¬å¤„ç† cat ä¸ tee å‘½ä»¤è¯¦è§£ ğŸ“œ æŒæ¡ã€Œçœ‹å†…å®¹ã€ã€Œå†™æ–‡ä»¶ã€ã€Œåˆ†æµè¾“å‡ºã€ä¸‰å¤§æ ¸å¿ƒæŠ€èƒ½ï¼Œæå‡å‘½ä»¤è¡Œå·¥ä½œæ•ˆç‡\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ å‘½ä»¤ç‰¹ç‚¹ ğŸ¯ ä¸€ã€å‘½ä»¤å®šä½ ğŸ” äºŒã€cat å‘½ä»¤è¯¦è§£ ğŸ”€ ä¸‰ã€tee å‘½ä»¤è¯¦è§£ ğŸš€ å››ã€é»„é‡‘ç»„åˆæŠ€å·§ âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ ğŸ§© å…­ã€é€ŸæŸ¥è¡¨ ğŸ”§ ä¸ƒã€é«˜çº§ç”¨æ³• âœ¨ å‘½ä»¤ç‰¹ç‚¹ ğŸ“– ç®€æ´é«˜æ•ˆ: ä¸¤ä¸ªå‘½ä»¤è§£å†³å¤§å¤šæ•°æ–‡æœ¬å¤„ç†éœ€æ±‚ ğŸ”„ çµæ´»ç»„åˆ: å¯ä¸ç®¡é“ç¬¦å’Œå…¶ä»–å‘½ä»¤å®Œç¾é…åˆ ğŸ’¾ åŒå‘æ“ä½œ: æ—¢æ”¯æŒè¯»å–ä¹Ÿæ”¯æŒå†™å…¥æ–‡ä»¶ ğŸ¯ ç²¾å‡†æ§åˆ¶: æ”¯æŒè¿½åŠ ã€è¦†ç›–ç­‰å¤šç§å†™å…¥æ¨¡å¼ ğŸ›¡ï¸ å®‰å…¨å¯é : æä¾›é˜²æ­¢è¯¯æ“ä½œçš„ä¿æŠ¤æœºåˆ¶ ğŸ¯ ä¸€ã€å‘½ä»¤å®šä½ å‘½ä»¤ æ ¸å¿ƒèƒ½åŠ› ç±»æ¯”è¯´æ˜ é€‚ç”¨åœºæ™¯ cat è¯»å–ã€æ‹¼æ¥ã€åˆ›å»ºæ–‡ä»¶ æ–‡æœ¬èƒ¶æ°´ æŸ¥çœ‹å†…å®¹ã€åˆå¹¶æ–‡ä»¶ã€åˆ›å»ºæ–‡æ¡£ tee åˆ†æµè¾“å‡ºï¼ŒåŒæ—¶æ˜¾ç¤ºå’Œä¿å­˜ ä¸‰é€šæ°´ç®¡ æ—¥å¿—è®°å½•ã€è°ƒè¯•è¾“å‡ºã€æƒé™æå‡å†™å…¥ ğŸ“Š åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ åŠŸèƒ½ cat tee è¯´æ˜ è¯»å–æ–‡ä»¶ âœ… âŒ cat ä¸»è¦ç”¨äºè¯»å– å†™å…¥æ–‡ä»¶ âœ… âœ… ä¸¤è€…éƒ½æ”¯æŒå†™å…¥ å±å¹•è¾“å‡º âœ… âœ… éƒ½å¯è¾“å‡ºåˆ°ç»ˆç«¯ ç®¡é“å¤„ç† âœ… âœ… éƒ½æ”¯æŒç®¡é“æ“ä½œ å¤šæ–‡ä»¶æ“ä½œ âœ… âœ… éƒ½æ”¯æŒå¤šä¸ªæ–‡ä»¶ è¾“å‡ºåˆ†æµ âŒ âœ… tee çš„ç‹¬ç‰¹åŠŸèƒ½ ğŸ” äºŒã€cat å‘½ä»¤è¯¦è§£ ğŸ“ åŸºæœ¬è¯­æ³• 1 cat [é€‰é¡¹] [æ–‡ä»¶...] ğŸ¯ å¸¸ç”¨é€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ -n æ˜¾ç¤ºè¡Œå· cat -n file.txt -b æ˜¾ç¤ºè¡Œå·ï¼ˆè·³è¿‡ç©ºè¡Œï¼‰ cat -b file.txt -s å‹ç¼©è¿ç»­ç©ºè¡Œ cat -s file.txt -A æ˜¾ç¤ºæ‰€æœ‰å­—ç¬¦ï¼ˆåŒ…æ‹¬æ§åˆ¶å­—ç¬¦ï¼‰ cat -A file.txt -E åœ¨æ¯è¡Œæœ«å°¾æ˜¾ç¤º $ cat -E file.txt -T å°†åˆ¶è¡¨ç¬¦æ˜¾ç¤ºä¸º ^I cat -T file.txt ğŸ’¡ å®ç”¨ç¤ºä¾‹ 1. åŸºç¡€æ–‡ä»¶æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ–‡ä»¶å†…å®¹ cat filename.txt # æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶ cat file1.txt file2.txt # æ˜¾ç¤ºè¡Œå· cat -n server.log # æ˜¾ç¤ºè¡Œå·ï¼ˆå¿½ç•¥ç©ºè¡Œï¼‰ cat -b config.conf 2. æ–‡ä»¶åˆ›å»ºä¸ç¼–è¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆCtrl+D ç»“æŸè¾“å…¥ï¼‰ cat \u0026gt; newfile.txt Hello World This is a new file Ctrl+D # è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶ cat \u0026gt;\u0026gt; existing.txt Additional content Ctrl+D # ä½¿ç”¨ heredoc åˆ›å»ºæ–‡ä»¶ cat \u0026gt; script.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;Hello from script\u0026#34; EOF 3. æ–‡ä»¶åˆå¹¶ä¸å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆå¹¶å¤šä¸ªæ–‡ä»¶ cat part1.txt part2.txt \u0026gt; complete.txt # åˆå¹¶å¹¶æ’åº cat file1.txt file2.txt | sort \u0026gt; sorted.txt # æŸ¥çœ‹æ–‡ä»¶å¹¶åˆ†é¡µæ˜¾ç¤º cat longfile.txt | less # æ˜¾ç¤ºæ–‡ä»¶å¼€å¤´å‡ è¡Œ cat file.txt | head -10 # æ˜¾ç¤ºæ–‡ä»¶æœ«å°¾å‡ è¡Œ cat file.txt | tail -10 4. é«˜çº§ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆåå…­è¿›åˆ¶ï¼‰ cat binaryfile | hexdump -C # åˆ›å»ºå¤šè¡Œé…ç½®æ–‡ä»¶ cat \u0026gt; config.json \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; { \u0026#34;server\u0026#34;: \u0026#34;localhost\u0026#34;, \u0026#34;port\u0026#34;: 8080, \u0026#34;enabled\u0026#34;: true } EOF # æ‰¹é‡å¤„ç†æ–‡ä»¶ for file in *.txt; do cat \u0026#34;$file\u0026#34; | grep \u0026#34;error\u0026#34; \u0026gt;\u0026gt; all_errors.txt done ğŸ”€ ä¸‰ã€tee å‘½ä»¤è¯¦è§£ ğŸ“ åŸºæœ¬è¯­æ³• 1 å‘½ä»¤ | tee [é€‰é¡¹] æ–‡ä»¶... ğŸ¯ å¸¸ç”¨é€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ -a è¿½åŠ æ¨¡å¼ï¼ˆä¸è¦†ç›–ï¼‰ `cmd -i å¿½ç•¥ä¸­æ–­ä¿¡å· `cmd -p è¯Šæ–­å†™å…¥é”™è¯¯ `cmd ğŸ’¡ å®ç”¨ç¤ºä¾‹ 1. åŸºç¡€è¾“å‡ºåˆ†æµ 1 2 3 4 5 6 7 8 9 10 11 # åŒæ—¶è¾“å‡ºåˆ°å±å¹•å’Œæ–‡ä»¶ ls -la | tee directory_listing.txt # è¿½åŠ åˆ°æ–‡ä»¶ï¼ˆä¸è¦†ç›–ï¼‰ echo \u0026#34;New entry\u0026#34; | tee -a log.txt # è¾“å‡ºåˆ°å¤šä¸ªæ–‡ä»¶ dmesg | tee system.log boot.log # åŒæ—¶è¾“å‡ºåˆ°å±å¹•å’Œå¤šä¸ªæ–‡ä»¶ ps aux | tee process_list.txt /tmp/backup_process.log 2. è°ƒè¯•ä¸æ—¥å¿—è®°å½• 1 2 3 4 5 6 7 8 9 10 11 # è®°å½•å‘½ä»¤è¾“å‡ºå¹¶æŸ¥çœ‹ python script.py 2\u0026gt;\u0026amp;1 | tee execution.log # å®‰è£…è½¯ä»¶å¹¶è®°å½•æ—¥å¿— sudo apt install nginx | tee install.log # ç¼–è¯‘é¡¹ç›®å¹¶è®°å½•è¾“å‡º make 2\u0026gt;\u0026amp;1 | tee build.log # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—è®°å½• echo \u0026#34;Task started at $(date)\u0026#34; | tee -a task_log.txt 3. æƒé™ç®¡ç† 1 2 3 4 5 6 7 8 # ä½¿ç”¨ sudo å†™å…¥å—ä¿æŠ¤æ–‡ä»¶ echo \u0026#34;new config value\u0026#34; | sudo tee /etc/config.conf # è¿½åŠ åˆ°å—ä¿æŠ¤æ–‡ä»¶ echo \u0026#34;additional setting\u0026#34; | sudo tee -a /etc/settings.conf # å¤šç”¨æˆ·å…±äº«æ—¥å¿— systemctl status nginx | tee /var/log/nginx-status.log | sudo tee /shared/nginx-status.log 4. é«˜çº§åˆ†æµæŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 # å¤šé‡åˆ†æµå¤„ç† netstat -tulpn | tee raw_connections.txt | grep \u0026#34;:80\u0026#34; | tee http_connections.txt # å®æ—¶ç›‘æ§å¹¶è®°å½• tail -f /var/log/syslog | tee monitor.log | grep \u0026#34;error\u0026#34; # æ¡ä»¶æ€§åˆ†æµ df -h | tee disk_usage.txt | awk \u0026#39;$5 \u0026gt; \u0026#34;80%\u0026#34; {print \u0026#34;Warning:\u0026#34;, $0}\u0026#39; # ç¼–ç è½¬æ¢åˆ†æµ cat file.txt | tee original.txt | iconv -f UTF-8 -t ASCII \u0026gt; ascii_version.txt ğŸš€ å››ã€é»„é‡‘ç»„åˆæŠ€å·§ 1. å¤‡ä»½ + ä¿®æ”¹é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # å®‰å…¨ä¿®æ”¹é…ç½®æ–‡ä»¶ cat /etc/nginx/nginx.conf | \\ sudo tee nginx.conf.backup | \\ sed \u0026#39;s/listen 80;/listen 8080;/\u0026#39; | \\ sudo tee /etc/nginx/nginx.conf # è§£é‡Šï¼š # 1. è¯»å–åŸé…ç½® # 2. å¤‡ä»½åˆ°æ–‡ä»¶ # 3. ä¿®æ”¹é…ç½®ï¼ˆç«¯å£80â†’8080ï¼‰ # 4. å†™å›åŸä½ç½® 2. å®‰è£…ä¸æ—¥å¿—è®°å½• 1 2 3 4 5 6 7 8 9 # å®Œæ•´å®‰è£…æ—¥å¿—è®°å½• { echo \u0026#34;=== å¼€å§‹å®‰è£…: $(date) ===\u0026#34; sudo apt update sudo apt install -y git nodejs npm echo \u0026#34;=== å®‰è£…å®Œæˆ: $(date) ===\u0026#34; } 2\u0026gt;\u0026amp;1 | tee /var/log/software_install.log # åŒæ—¶æ˜¾ç¤ºè¿›åº¦å’Œä¿å­˜æ—¥å¿— 3. å¤šæ—¥å¿—å®æ—¶èšåˆ 1 2 3 4 5 6 # ç›‘æ§å¤šä¸ªæ—¥å¿—æ–‡ä»¶ tail -f /var/log/nginx/access.log /var/log/nginx/error.log | \\ tee nginx_combined.log | \\ grep -E \u0026#34;(ERROR|WARN|40[0-9]|50[0-9])\u0026#34; # å®æ—¶ç›‘æ§å¹¶è¿‡æ»¤é‡è¦ä¿¡æ¯ 4. æ•°æ®æµæ°´çº¿å¤„ç† 1 2 3 4 5 6 7 8 9 10 # å¤æ‚æ•°æ®å¤„ç†æµæ°´çº¿ cat raw_data.csv | \\ tee original_data_backup.csv | \\ grep -v \u0026#34;test\u0026#34; | \\ tee filtered_data.csv | \\ awk -F\u0026#39;,\u0026#39; \u0026#39;{print $1\u0026#34;,\u0026#34;$3\u0026#34;,\u0026#34;$5}\u0026#39; | \\ tee final_data.csv | \\ wc -l # æ¯ä¸ªé˜¶æ®µéƒ½ä¿å­˜ä¸­é—´ç»“æœ 5. ç³»ç»Ÿç›‘æ§ä¸å‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 # ç³»ç»Ÿå¥åº·æ£€æŸ¥ä¸å‘Šè­¦ { echo \u0026#34;=== ç³»ç»Ÿå¥åº·æ£€æŸ¥: $(date) ===\u0026#34; echo \u0026#34;--- å†…å­˜ä½¿ç”¨ ---\u0026#34; free -h echo \u0026#34;--- ç£ç›˜ç©ºé—´ ---\u0026#34; df -h echo \u0026#34;--- CPUè´Ÿè½½ ---\u0026#34; uptime } | tee /var/log/health_check.log | \\ awk \u0026#39;/^Warning:/ {print \u0026#34;ALERT:\u0026#34;, $0; system(\u0026#34;mail -s \\\u0026#34;ç³»ç»Ÿå‘Šè­¦\\\u0026#34; admin@example.com\u0026#34;)}\u0026#39; âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ ğŸš« å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ é—®é¢˜ é£é™© è§£å†³æ–¹æ¡ˆ æ–‡ä»¶è¦†ç›– æ„å¤–ä¸¢å¤±æ•°æ® ä½¿ç”¨ \u0026gt;\u0026gt; æˆ– tee -a è¿½åŠ  æƒé™ä¸è¶³ å†™å…¥å¤±è´¥ ä½¿ç”¨ sudo tee ææƒ ç‰¹æ®Šå­—ç¬¦ è§£æé”™è¯¯ heredoc åŠ å¼•å· \u0026lt;\u0026lt;'EOF' å¤§æ–‡ä»¶å¤„ç† å†…å­˜æº¢å‡º ä½¿ç”¨ less/head/tail äºŒè¿›åˆ¶æ–‡ä»¶ ç»ˆç«¯ä¹±ç  é¿å…ç”¨ cat æ˜¾ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶ ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 1. æ€»æ˜¯éªŒè¯æ–‡ä»¶å†…å®¹ cat important_file.txt | less # 2. ä½¿ç”¨åˆ«åé˜²æ­¢è¯¯è¦†ç›– alias rm=\u0026#39;rm -i\u0026#39; alias cp=\u0026#39;cp -i\u0026#39; alias mv=\u0026#39;mv -i\u0026#39; # 3. é‡è¦æ“ä½œå‰å¤‡ä»½ cp file.txt file.txt.bak # æˆ–è€… cat file.txt \u0026gt; file.txt.backup # 4. ä½¿ç”¨ set -u é¿å…æœªå®šä¹‰å˜é‡ set -u # 5. æ£€æŸ¥å‘½ä»¤è¿”å›å€¼ if cat file.txt \u0026gt; /dev/null; then echo \u0026#34;æ–‡ä»¶è¯»å–æˆåŠŸ\u0026#34; else echo \u0026#34;æ–‡ä»¶è¯»å–å¤±è´¥\u0026#34; \u0026gt;\u0026amp;2 fi ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®® 1 2 3 4 5 6 7 8 9 # å¤„ç†å¤§æ–‡ä»¶æ—¶ä½¿ç”¨ç¼“å†² cat largefile.txt | buffer | tee backup.txt | processing_command # ä½¿ç”¨ pigz ç­‰å¤šçº¿ç¨‹å·¥å…·åŠ é€Ÿå‹ç¼© cat bigfile.txt | tee original.txt | pigz \u0026gt; compressed.gz # é¿å…ä¸å¿…è¦çš„teeæ“ä½œ # ä¸å¥½: cat file | tee output.txt | grep pattern # å¥½: grep pattern file | tee matches.txt ğŸ§© å…­ã€é€ŸæŸ¥è¡¨ âš¡ å¿«é€Ÿå‚è€ƒ éœ€æ±‚ å‘½ä»¤ ç¤ºä¾‹ æŸ¥çœ‹æ–‡ä»¶ cat file cat config.txt æ˜¾ç¤ºè¡Œå· cat -n file cat -n script.sh åˆ›å»ºæ–‡ä»¶ cat \u0026gt; file cat \u0026gt; note.txt è¿½åŠ å†…å®¹ cat \u0026gt;\u0026gt; file cat \u0026gt;\u0026gt; log.txt åˆå¹¶æ–‡ä»¶ cat f1 f2 \u0026gt; f3 cat part1 part2 \u0026gt; whole å±å¹•+æ–‡ä»¶è¾“å‡º `cmd tee file` è¿½åŠ è¾“å‡º `cmd tee -a file` å¤šæ–‡ä»¶è¾“å‡º `cmd tee f1 f2` sudo å†™å…¥ `cmd sudo tee file` ğŸ¯ åœºæ™¯åŒ–æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 1. å¿«é€Ÿæ–‡æ¡£åˆ›å»º cat \u0026gt; README.md \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # é¡¹ç›®æ ‡é¢˜ é¡¹ç›®æè¿°... EOF # 2. å®æ—¶ç›‘æ§æ—¥å¿— tail -f /var/log/app.log | tee monitor.log # 3. å®‰è£…è½¯ä»¶è®°å½• sudo apt install package | tee install.log # 4. é…ç½®å¤‡ä»½ä¿®æ”¹ cat config | tee backup | sed \u0026#39;s/old/new/\u0026#39; | sudo tee config # 5. å¤šçº§å¤„ç†æµæ°´çº¿ cat data | tee raw | filter | tee cleaned | transform | tee final ğŸ”§ ä¸ƒã€é«˜çº§ç”¨æ³• ğŸ¨ å½©è‰²è¾“å‡ºå¤„ç† 1 2 3 4 5 6 7 8 # ä¿æŒé¢œè‰²è¾“å‡ºåŒæ—¶ä¿å­˜åˆ°æ–‡ä»¶ grep --color=always \u0026#34;pattern\u0026#34; file.txt | tee output.txt # ä½¿ç”¨ansi2txtè½¬æ¢é¢œè‰²ä»£ç  cat colored_output.txt | ansi2txt \u0026gt; clean_output.txt # å¸¦é¢œè‰²çš„æ—¥å¿—ç›‘æ§ tail -f app.log | awk \u0026#39;/ERROR/ {print \u0026#34;\\033[31m\u0026#34; $0 \u0026#34;\\033[0m\u0026#34;} /WARN/ {print \u0026#34;\\033[33m\u0026#34; $0 \u0026#34;\\033[0m\u0026#34;}\u0026#39; | tee -a colored_log.txt ğŸ”„ å®æ—¶æ•°æ®æµå¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®æ—¶ç½‘ç»œç›‘æ§ tcpdump -i eth0 -w - | tee raw.pcap | tshark -i - | tee parsed.txt | grep \u0026#34;HTTP\u0026#34; # å®æ—¶ç³»ç»Ÿæ€§èƒ½ç›‘æ§ vmstat 1 | tee system_stats.log | awk \u0026#39;$1 ~ /[0-9]+/ {print \u0026#34;CPU idle:\u0026#34;, $15\u0026#34;%\u0026#34;}\u0026#39; # å®æ—¶æ—¥å¿—åˆ†æç®¡é“ tail -f /var/log/application.log | \\ tee raw_logs.log | \\ grep \u0026#34;ERROR\\|WARN\u0026#34; | \\ tee errors.log | \\ awk \u0026#39;{print strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;), $0}\u0026#39; | \\ tee timestamped_errors.log ğŸ“Š æ•°æ®è½¬æ¢ä¸ç¼–ç  1 2 3 4 5 6 7 8 9 10 11 # ç¼–ç è½¬æ¢æµæ°´çº¿ cat file.txt | tee original_utf8.txt | iconv -f UTF-8 -t ASCII \u0026gt; ascii.txt # å‹ç¼©å½’æ¡£å¤„ç† tar czf - directory/ | tee backup.tar.gz | md5sum \u0026gt; backup.md5 # åŠ å¯†è§£å¯†æµæ°´çº¿ cat sensitive.txt | gpg --encrypt | tee encrypted.gpg | base64 \u0026gt; encrypted.b64 # æ•°æ®æ ¼å¼è½¬æ¢ cat data.csv | tee original.csv | csv2json | tee data.json | jq . \u0026gt; formatted.json ğŸ¤– è‡ªåŠ¨åŒ–è„šæœ¬é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # è‡ªåŠ¨å¤‡ä»½è„šæœ¬ with tee logging set -euo pipefail LOG_FILE=\u0026#34;/var/log/backup_$(date +%Y%m%d).log\u0026#34; { echo \u0026#34;=== å¤‡ä»½å¼€å§‹: $(date) ===\u0026#34; # å¤‡ä»½æ•°æ®åº“ echo \u0026#34;å¤‡ä»½ MySQL æ•°æ®åº“...\u0026#34; mysqldump -u root --all-databases | tee \u0026gt;(gzip \u0026gt; db_backup.sql.gz) | wc -l # å¤‡ä»½æ–‡ä»¶ç³»ç»Ÿ echo \u0026#34;å¤‡ä»½é‡è¦æ–‡ä»¶...\u0026#34; tar czf - /etc /home | tee \u0026gt;(sha256sum \u0026gt; backup.sha256) | split -b 1G - backup_part_ echo \u0026#34;=== å¤‡ä»½å®Œæˆ: $(date) ===\u0026#34; echo \u0026#34;å¤‡ä»½å¤§å°: $(du -h db_backup.sql.gz)\u0026#34; } | tee -a \u0026#34;$LOG_FILE\u0026#34; # å‘é€æ—¥å¿—é‚®ä»¶ mail -s \u0026#34;å¤‡ä»½å®ŒæˆæŠ¥å‘Š\u0026#34; admin@example.com \u0026lt; \u0026#34;$LOG_FILE\u0026#34; ğŸ§ ç³»ç»Ÿç®¡ç†é«˜çº§æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # 1. å®‰å…¨ç³»ç»Ÿé…ç½®æ›´æ–° cat /etc/ssh/sshd_config | \\ tee sshd_config.backup | \\ sed \u0026#39;s/#PermitRootLogin yes/PermitRootLogin no/\u0026#39; | \\ sudo tee /etc/ssh/sshd_config # 2. æ‰¹é‡æœåŠ¡å™¨é…ç½®åˆ†å‘ for server in web{1..5}; do ssh \u0026#34;$server\u0026#34; \u0026#34;cat \u0026gt; /tmp/config \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; $(cat local_config.txt) EOF\u0026#34; | tee \u0026#34;deploy_$server.log\u0026#34; done # 3. ç³»ç»Ÿå®¡è®¡æ—¥å¿—è®°å½• { echo \u0026#34;ç³»ç»Ÿå®¡è®¡æŠ¥å‘Š - $(date)\u0026#34; echo \u0026#34;ç”¨æˆ·ç™»å½•è®°å½•:\u0026#34; last echo \u0026#34;å½“å‰è¿›ç¨‹:\u0026#34; ps aux echo \u0026#34;ç½‘ç»œè¿æ¥:\u0026#34; netstat -tulpn } | tee \u0026#34;/var/log/audit/audit_$(hostname)_$(date +%Y%m%d).log\u0026#34; # 4. å®æ—¶æ€§èƒ½ç›‘æ§çœ‹æ¿ watch -n 1 \u0026#39; echo \u0026#34;=== å®æ—¶ç³»ç»Ÿç›‘æ§ ===\u0026#34; echo \u0026#34;CPUä½¿ç”¨: $(top -bn1 | grep \u0026#34;Cpu(s)\u0026#34; | sed \u0026#34;s/.*, *\\([0-9.]*\\)%* id.*/\\1/\u0026#34;)% idle\u0026#34; echo \u0026#34;å†…å­˜ä½¿ç”¨: $(free -h | grep Mem | awk \u0026#34;{print \\$3}/\\$2}\u0026#34;)\u0026#34; echo \u0026#34;ç£ç›˜ä½¿ç”¨: $(df -h / | awk \u0026#34;NR==2 {print \\$5}\u0026#34;)\u0026#34; \u0026#39; | tee -a /var/log/system_monitor.log ğŸ¯ æ€»ç»“ cat æ˜¯æ–‡æœ¬å¤„ç†çš„ç‘å£«å†›åˆ€ï¼Œtee æ˜¯è¾“å‡ºåˆ†æµçš„å¤šé¢æ‰‹ã€‚æŒæ¡è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œå°±èƒ½é«˜æ•ˆå¤„ç†å¤§å¤šæ•°æ–‡æœ¬æ“ä½œä»»åŠ¡ï¼\nâœ… æœ€ä½³å®è·µæ¸…å• âœ… æ€»æ˜¯å¤‡ä»½é‡è¦æ–‡ä»¶ - ä½¿ç”¨ cat file | tee backup æ¨¡å¼ âœ… ä½¿ç”¨è¿½åŠ æ¨¡å¼é˜²è¦†ç›– - è®°å¾— tee -a å’Œ \u0026gt;\u0026gt; âœ… å¤„ç†æƒé™é—®é¢˜ - sudo tee æ˜¯ä½ çš„å¥½æœ‹å‹ âœ… è®°å½•æ“ä½œæ—¥å¿— - é‡è¦æ“ä½œéƒ½ç”¨ tee è®°å½• âœ… æµ‹è¯•å‘½ä»¤æ•ˆæœ - å…ˆç”¨ cat é¢„è§ˆå†æ“ä½œ âœ… ä½¿ç”¨ heredoc - å¤æ‚å†…å®¹ç”¨ \u0026lt;\u0026lt;'EOF' è¯­æ³• âœ… ç®¡é“ç»„åˆ - å¤šä¸ªå‘½ä»¤ç”¨ç®¡é“è¿æ¥ âœ… é”™è¯¯å¤„ç† - æ£€æŸ¥å‘½ä»¤è¿”å›å€¼ $? âœ… èµ„æºç›‘æ§ - å¤§æ–‡ä»¶å¤„ç†æ³¨æ„å†…å­˜ä½¿ç”¨ âœ… å®‰å…¨ç¬¬ä¸€ - é‡è¦æ“ä½œå‰ç¡®è®¤å†ç¡®è®¤ ğŸ”§ æ•…éšœæ’æŸ¥æŒ‡å— æ–‡ä»¶æ— æ³•è¯»å– â†’ æ£€æŸ¥æƒé™ ls -l file è¾“å‡ºä¹±ç  â†’ æ£€æŸ¥æ–‡ä»¶ç¼–ç  file -i filename æƒé™ä¸è¶³ â†’ ä½¿ç”¨ sudo tee æå‡æƒé™ ç£ç›˜ç©ºé—´ä¸è¶³ â†’ æ£€æŸ¥ df -h å‘½ä»¤ä¸å­˜åœ¨ â†’ æ£€æŸ¥ which cat å’Œ which tee ç®¡é“ä¸­æ–­ â†’ ä½¿ç”¨ tee -i å¿½ç•¥ä¸­æ–­ä¿¡å· ç‰¹æ®Šå­—ç¬¦é—®é¢˜ â†’ ä½¿ç”¨ \u0026lt;\u0026lt;'EOF' é¿å…æ‰©å±• é€šè¿‡æŒæ¡ cat å’Œ tee å‘½ä»¤çš„å„ç§ç”¨æ³•å’ŒæŠ€å·§ï¼Œä½ å°†èƒ½å¤Ÿåœ¨ Linux å‘½ä»¤è¡Œç¯å¢ƒä¸­é«˜æ•ˆåœ°å¤„ç†æ–‡æœ¬æ•°æ®ï¼Œå®ç°å¤æ‚çš„æ–‡æœ¬å¤„ç†å·¥ä½œæµã€‚ğŸ§âœ¨\n","date":"2025-08-26T20:55:02+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b50b772a/","title":"Linux æ–‡æœ¬å¤„ç† cat ä¸ tee å‘½ä»¤è¯¦è§£ ğŸ“œ"},{"content":"Linux æ–‡ä»¶å‹ç¼©ä¸è§£å‹ rar gz å’Œ zip æ ¼å¼è¯¦è§£ ğŸ“¦ å…¨é¢æŒæ¡ä¸»æµå‹ç¼©æ ¼å¼ï¼šä»åŸºç¡€å‘½ä»¤åˆ°é«˜çº§æŠ€å·§ï¼Œä¸€æ–‡æå®šæ‰€æœ‰å‹ç¼©è§£å‹éœ€æ±‚\nğŸ“‹ ç›®å½• ğŸ—‚ï¸ æ ¼å¼é€Ÿè§ˆ ğŸ› ï¸ å®‰è£…æŒ‡å— ğŸ˜ RAR å‘½ä»¤å¤§å…¨ ğŸ—œï¸ GZ/TAR å‘½ä»¤å¤§å…¨ ğŸ“‚ ZIP å‘½ä»¤å¤§å…¨ ğŸ”„ å…¶ä»–æ ¼å¼ ğŸš€ å®ç”¨è„šæœ¬ ğŸ“Š æ€§èƒ½å¯¹æ¯” ğŸ’¡ é«˜çº§æŠ€å·§ ğŸ§© é€ŸæŸ¥è¡¨ ä¸€ã€æ ¼å¼é€Ÿè§ˆ ğŸ—‚ï¸ æ ¼å¼ ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ å‹ç¼©ç‡ é€Ÿåº¦ RAR é«˜å‹ç¼©ç‡ã€åˆ†å·ã€åŠ å¯†ã€æ¢å¤è®°å½• å¤§æ–‡ä»¶å¤‡ä»½ã€é‡è¦æ•°æ®å½’æ¡£ â­â­â­â­ â­â­ GZ Linux åŸç”Ÿã€æµå¼å‹ç¼©ã€é…åˆtarä½¿ç”¨ æ—¥å¿—å‹ç¼©ã€æºç åˆ†å‘ â­â­â­ â­â­â­â­ ZIP è·¨å¹³å°ã€ç³»ç»Ÿå…¼å®¹ã€å¹¿æ³›æ”¯æŒ æ—¥å¸¸æ–‡ä»¶åˆ†äº«ã€é‚®ä»¶é™„ä»¶ â­â­ â­â­â­ 7Z æé«˜å‹ç¼©ç‡ã€å¤šç§ç®—æ³•æ”¯æŒ æé™å‹ç¼©éœ€æ±‚ â­â­â­â­â­ â­â­ XZ æé«˜å‹ç¼©ç‡ã€Linuxå†…æ ¸ä½¿ç”¨ ç³»ç»Ÿåˆ†å‘ã€è½¯ä»¶åŒ… â­â­â­â­â­ â­ BZ2 è¾ƒå¥½å‹ç¼©ç‡ã€CPUå‹å¥½ ä¸­ç­‰å‹ç¼©éœ€æ±‚ â­â­â­ â­â­â­ äºŒã€å®‰è£…æŒ‡å— ğŸ› ï¸ å„å‘è¡Œç‰ˆå®‰è£…å‘½ä»¤ å‘è¡Œç‰ˆ RAR/UNRAR ZIP/UNZIP 7Z å…¶ä»–å·¥å…· Ubuntu/Debian sudo apt install rar unrar é¢„è£… sudo apt install p7zip-full sudo apt install xz-utils bzip2 CentOS/RHEL sudo yum install epel-release \u0026amp;\u0026amp; sudo yum install rar unrar é¢„è£… sudo yum install p7zip p7zip-plugins sudo yum install xz bzip2 Arch/Manjaro sudo pacman -S rar unrar é¢„è£… sudo pacman -S p7zip sudo pacman -S xz bzip2 Fedora sudo dnf install rar unrar é¢„è£… sudo dnf install p7zip p7zip-plugins sudo dnf install xz bzip2 éªŒè¯å®‰è£… 1 2 3 4 5 # æ£€æŸ¥å·¥å…·æ˜¯å¦å¯ç”¨ rar --version || echo \u0026#34;RAR not installed\u0026#34; unrar --version || echo \u0026#34;UNRAR not installed\u0026#34; 7z --help || echo \u0026#34;7-Zip not installed\u0026#34; xz --version || echo \u0026#34;XZ not installed\u0026#34; ä¸‰ã€RAR å‘½ä»¤å¤§å…¨ ğŸ˜ åŸºæœ¬å‹ç¼©å‘½ä»¤ 1 2 3 4 5 6 7 # å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• rar a archive.rar file.txt # å‹ç¼©å•ä¸ªæ–‡ä»¶ rar a archive.rar directory/ # å‹ç¼©ç›®å½• rar a -r archive.rar directory/ # é€’å½’å‹ç¼©ç›®å½• # å¤šæ–‡ä»¶å‹ç¼© rar a archive.rar file1.txt file2.txt # å‹ç¼©å¤šä¸ªæ–‡ä»¶ é«˜çº§å‹ç¼©é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åŠ å¯†å‹ç¼©ï¼ˆè®¾ç½®å¯†ç ï¼‰ rar a -p archive.rar file.txt # å‹ç¼©æ—¶è®¾ç½®å¯†ç  rar a -p- archive.rar file.txt # å‘½ä»¤è¡Œè¾“å…¥å¯†ç ï¼ˆæ›´å®‰å…¨ï¼‰ # åˆ†å·å‹ç¼©ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ rar a -v100m archive.rar bigfile.iso # 100MBåˆ†å· rar a -v1g archive.rar bigfile.iso # 1GBåˆ†å· # å‹ç¼©çº§åˆ«æ§åˆ¶ rar a -m0 archive.rar file.txt # å­˜å‚¨ï¼ˆä¸å‹ç¼©ï¼‰ rar a -m1 archive.rar file.txt # æœ€å¿«å‹ç¼© rar a -m5 archive.rar file.txt # é»˜è®¤å‹ç¼© rar a -m5 -md512m archive.rar large_dir # ä½¿ç”¨512MBå­—å…¸å†…å­˜ # æ·»åŠ æ¢å¤è®°å½•ï¼ˆé˜²æ­¢æŸåï¼‰ rar a -rr3% archive.rar important_data/ # æ·»åŠ 3%æ¢å¤è®°å½• rar a -rv5% archive.rar critical_data/ # æ·»åŠ 5%æ¢å¤å· # æ’é™¤æ–‡ä»¶ rar a -x*.tmp archive.rar directory/ # æ’é™¤tmpæ–‡ä»¶ rar a -x*.log -x*.tmp archive.rar dir/ # æ’é™¤å¤šç§æ–‡ä»¶ è§£å‹å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åŸºæœ¬è§£å‹ unrar e archive.rar # è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆä¸ä¿æŒç»“æ„ï¼‰ unrar x archive.rar # è§£å‹ä¿æŒç›®å½•ç»“æ„ # è§£å‹åˆ°æŒ‡å®šç›®å½• unrar x archive.rar /target/path/ # è§£å‹åˆ°æŒ‡å®šç›®å½• # å¯†ç è§£å‹ unrar x -p password archive.rar # ä½¿ç”¨å¯†ç è§£å‹ # ä»…è§£å‹ç‰¹å®šæ–‡ä»¶ unrar e archive.rar specific_file.txt # åªè§£å‹ç‰¹å®šæ–‡ä»¶ # æµ‹è¯•å‹ç¼©åŒ…å®Œæ•´æ€§ unrar t archive.rar # æµ‹è¯•å‹ç¼©åŒ… æŸ¥çœ‹å’Œç®¡ç† 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å‹ç¼©åŒ…å†…å®¹ unrar l archive.rar # è¯¦ç»†åˆ—è¡¨ unrar v archive.rar # æ›´è¯¦ç»†çš„ä¿¡æ¯ rar l archive.rar # ä½¿ç”¨raræŸ¥çœ‹ # æ³¨é‡Šç®¡ç† rar c archive.rar # æ·»åŠ æ³¨é‡Š rar cf archive.rar comment.txt # ä»æ–‡ä»¶æ·»åŠ æ³¨é‡Š å››ã€GZ/TAR å‘½ä»¤å¤§å…¨ ğŸ—œï¸ GZIP å•ç‹¬ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åŸºæœ¬å‹ç¼© gzip file.txt # å‹ç¼©æ–‡ä»¶ï¼Œç”Ÿæˆ file.txt.gz gzip -k file.txt # å‹ç¼©ä½†ä¿ç•™åŸæ–‡ä»¶ # å‹ç¼©çº§åˆ«ï¼ˆ1-9ï¼‰ gzip -1 file.txt # æœ€å¿«å‹ç¼© gzip -9 file.txt # æœ€ä½³å‹ç¼©ï¼ˆé»˜è®¤ï¼‰ gzip -6 file.txt # é»˜è®¤çº§åˆ« # è§£å‹ gunzip file.txt.gz # è§£å‹.gzæ–‡ä»¶ gzip -d file.txt.gz # åŒä¸Š # æŸ¥çœ‹å‹ç¼©å†…å®¹ zcat file.txt.gz # ä¸è§£å‹æŸ¥çœ‹å†…å®¹ zless file.txt.gz # åˆ†é¡µæŸ¥çœ‹ zgrep \u0026#34;pattern\u0026#34; file.txt.gz # åœ¨å‹ç¼©æ–‡ä»¶ä¸­æœç´¢ TAR å½’æ¡£ + å‹ç¼© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # åˆ›å»ºtarå½’æ¡£ tar -cvf archive.tar directory/ # åªå½’æ¡£ä¸å‹ç¼© tar -cvf archive.tar file1 file2 # å½’æ¡£å¤šä¸ªæ–‡ä»¶ tar -xvf archive.tar # è§£å‹æ™®é€štaråŒ… # tar + gzip (ä¼ ç»Ÿæ–¹å¼) tar -czvf archive.tar.gz directory/ # åˆ›å»º.tar.gz tar -czvf archive.tgz directory/ # .tgzæ˜¯.tar.gzçš„ç®€å†™ tar -xzvf archive.tar.gz # è§£å‹.tar.gz # tar + å…¶ä»–å‹ç¼© tar -cJvf archive.tar.xz directory/ # ä½¿ç”¨xzå‹ç¼©ï¼ˆé«˜å‹ç¼©ç‡ï¼‰ tar -cjvf archive.tar.bz2 directory/ # ä½¿ç”¨bzip2å‹ç¼© tar -cZvf archive.tar.Z directory/ # ä½¿ç”¨compresså‹ç¼©ï¼ˆæ—§å¼ï¼‰ tar -xJvf archive.tar.xz # è§£å‹.tar.xz tar -xjvf archive.tar.bz2 # è§£å‹.tar.bz2 # è§£å‹taråŒ… tar -xzvf archive.tar.gz # è§£å‹.tar.gz tar -xvf archive.tar # è§£å‹æ™®é€štaråŒ… tar -xJvf archive.tar.xz # è§£å‹.tar.xz tar -xjvf archive.tar.bz2 # è§£å‹.tar.bz2 # è§£å‹åˆ°æŒ‡å®šç›®å½• tar -xzvf archive.tar.gz -C /target/path/ # æŸ¥çœ‹taråŒ…å†…å®¹ tar -tzvf archive.tar.gz # æŸ¥çœ‹.gzå‹ç¼©åŒ…å†…å®¹ tar -tvf archive.tar # æŸ¥çœ‹æ™®é€štaråŒ…å†…å®¹ # æ·»åŠ æ–‡ä»¶åˆ°å·²æœ‰taråŒ… tar -rvf archive.tar newfile.txt # æ·»åŠ æ–‡ä»¶åˆ°taråŒ… # æ’é™¤æ–‡ä»¶ tar -czvf archive.tar.gz --exclude=\u0026#39;*.tmp\u0026#39; directory/ tar -czvf archive.tar.gz --exclude=\u0026#39;node_modules\u0026#39; --exclude=\u0026#39;.git\u0026#39; project/ äº”ã€ZIP å‘½ä»¤å¤§å…¨ ğŸ“‚ å‹ç¼©å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åŸºæœ¬å‹ç¼© zip archive.zip file.txt # å‹ç¼©å•ä¸ªæ–‡ä»¶ zip -r archive.zip directory/ # é€’å½’å‹ç¼©ç›®å½• # åŠ å¯†å‹ç¼© zip -e archive.zip file.txt # åŠ å¯†å‹ç¼©ï¼ˆæç¤ºè¾“å…¥å¯†ç ï¼‰ zip -e -P password archive.zip file.txt # ç›´æ¥æŒ‡å®šå¯†ç ï¼ˆä¸å®‰å…¨ï¼‰ # å‹ç¼©çº§åˆ«ï¼ˆ0-9ï¼‰ zip -0 archive.zip file.txt # ä»…å­˜å‚¨ï¼ˆä¸å‹ç¼©ï¼‰ zip -1 archive.zip file.txt # æœ€å¿«å‹ç¼© zip -9 archive.zip file.txt # æœ€ä½³å‹ç¼© # åˆ†å·å‹ç¼©ï¼ˆéœ€è¦zip 3.0+ï¼‰ zip -s 100m -r split.zip large_dir/ # 100MBåˆ†å· # æ’é™¤æ–‡ä»¶ zip -r archive.zip dir/ -x \u0026#34;*.tmp\u0026#34; # æ’é™¤tmpæ–‡ä»¶ zip -r archive.zip dir/ -x \u0026#34;*.log\u0026#34; \u0026#34;*.tmp\u0026#34; # æ’é™¤å¤šç§æ–‡ä»¶ # æ·»åŠ æ³¨é‡Š zip -z archive.zip # äº¤äº’å¼æ·»åŠ æ³¨é‡Š è§£å‹å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åŸºæœ¬è§£å‹ unzip archive.zip # è§£å‹åˆ°å½“å‰ç›®å½• unzip archive.zip -d /target/path/ # è§£å‹åˆ°æŒ‡å®šç›®å½• # å¯†ç è§£å‹ unzip -P password archive.zip # ä½¿ç”¨å¯†ç è§£å‹ # ä»…è§£å‹ç‰¹å®šæ–‡ä»¶ unzip archive.zip specific_file.txt # åªè§£å‹ç‰¹å®šæ–‡ä»¶ unzip archive.zip \u0026#34;*.txt\u0026#34; # åªè§£å‹txtæ–‡ä»¶ # ä¸è§£å‹æŸ¥çœ‹ unzip -l archive.zip # æŸ¥çœ‹å‹ç¼©åŒ…å†…å®¹ unzip -v archive.zip # è¯¦ç»†åˆ—è¡¨ unzip -Z archive.zip # ç±»ä¼¼ls -lçš„æ ¼å¼ # æµ‹è¯•å®Œæ•´æ€§ unzip -t archive.zip # æµ‹è¯•å‹ç¼©åŒ…å®Œæ•´æ€§ é«˜çº§åŠŸèƒ½ 1 2 3 4 5 6 7 8 # æ›´æ–°å‹ç¼©åŒ…ï¼ˆæ·»åŠ æ–°æ–‡ä»¶ï¼‰ zip -u archive.zip newfile.txt # æ·»åŠ æ–°æ–‡ä»¶ # åˆ é™¤å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶ zip -d archive.zip file_to_remove.txt # åˆ é™¤æŒ‡å®šæ–‡ä»¶ # ä¿®å¤æŸåçš„å‹ç¼©åŒ… zip -F broken.zip --out fixed.zip # ä¿®å¤å‹ç¼©åŒ… å…­ã€å…¶ä»–æ ¼å¼ ğŸ”„ 7Z æ ¼å¼ï¼ˆé«˜å‹ç¼©ç‡ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®‰è£… sudo apt install p7zip-full # Ubuntu/Debian # å‹ç¼© 7z a archive.7z directory/ # å‹ç¼©ç›®å½• 7z a -t7z -m0=lzma -mx=9 -mfb=64 -md=32m -ms=on archive.7z dir/ # é«˜å‹ç¼©å‚æ•° # è§£å‹ 7z x archive.7z # è§£å‹ 7z x archive.7z -o/target/path/ # è§£å‹åˆ°æŒ‡å®šç›®å½• # æŸ¥çœ‹ 7z l archive.7z # æŸ¥çœ‹å†…å®¹ XZ æ ¼å¼ï¼ˆæé«˜å‹ç¼©ç‡ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 # å‹ç¼© xz file.txt # å‹ç¼©æ–‡ä»¶ xz -zk file.txt # å‹ç¼©ä½†ä¿ç•™åŸæ–‡ä»¶ xz -9e file.txt # æé™å‹ç¼© # è§£å‹ unxz file.txt.xz # è§£å‹ xz -d file.txt.xz # åŒä¸Š # æŸ¥çœ‹ xzcat file.txt.xz # ä¸è§£å‹æŸ¥çœ‹ BZIP2 æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 # å‹ç¼© bzip2 file.txt # å‹ç¼©æ–‡ä»¶ bzip2 -k file.txt # å‹ç¼©ä½†ä¿ç•™åŸæ–‡ä»¶ # è§£å‹ bunzip2 file.txt.bz2 # è§£å‹ bzip2 -d file.txt.bz2 # åŒä¸Š # æŸ¥çœ‹ bzcat file.txt.bz2 # ä¸è§£å‹æŸ¥çœ‹ ä¸ƒã€å®ç”¨è„šæœ¬ ğŸš€ 1. æ™ºèƒ½å¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # smart_backup.sh - æ™ºèƒ½å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;${1:-.}\u0026#34; BACKUP_NAME=\u0026#34;backup-$(date +%Y%m%d_%H%M%S)\u0026#34; COMPRESSION_TYPE=\u0026#34;${2:-gz}\u0026#34; echo \u0026#34;å¼€å§‹å¤‡ä»½: $BACKUP_DIR\u0026#34; case $COMPRESSION_TYPE in \u0026#34;gz\u0026#34;) tar -czvf \u0026#34;${BACKUP_NAME}.tar.gz\u0026#34; --exclude=\u0026#39;*.tmp\u0026#39; --exclude=\u0026#39;*.log\u0026#39; \u0026#34;$BACKUP_DIR\u0026#34; ;; \u0026#34;bz2\u0026#34;) tar -cjvf \u0026#34;${BACKUP_NAME}.tar.bz2\u0026#34; --exclude=\u0026#39;*.tmp\u0026#39; --exclude=\u0026#39;*.log\u0026#39; \u0026#34;$BACKUP_DIR\u0026#34; ;; \u0026#34;xz\u0026#34;) tar -cJvf \u0026#34;${BACKUP_NAME}.tar.xz\u0026#34; --exclude=\u0026#39;*.tmp\u0026#39; --exclude=\u0026#39;*.log\u0026#39; \u0026#34;$BACKUP_DIR\u0026#34; ;; \u0026#34;rar\u0026#34;) rar a -r -rr3% -m5 \u0026#34;${BACKUP_NAME}.rar\u0026#34; \u0026#34;$BACKUP_DIR\u0026#34; ;; \u0026#34;zip\u0026#34;) zip -r -9 \u0026#34;${BACKUP_NAME}.zip\u0026#34; \u0026#34;$BACKUP_DIR\u0026#34; -x \u0026#34;*.tmp\u0026#34; \u0026#34;*.log\u0026#34; ;; *) echo \u0026#34;ä¸æ”¯æŒçš„å‹ç¼©ç±»å‹: $COMPRESSION_TYPE\u0026#34; echo \u0026#34;å¯ç”¨ç±»å‹: gz, bz2, xz, rar, zip\u0026#34; exit 1 ;; esac echo \u0026#34;å¤‡ä»½å®Œæˆ: ${BACKUP_NAME}.${COMPRESSION_TYPE}\u0026#34; 2. æ‰¹é‡è§£å‹è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/bin/bash # batch_extract.sh - æ‰¹é‡è§£å‹è„šæœ¬ for archive in *.zip *.rar *.tar.* *.7z; do if [ -f \u0026#34;$archive\u0026#34; ]; then echo \u0026#34;æ­£åœ¨è§£å‹: $archive\u0026#34; case \u0026#34;$archive\u0026#34; in *.zip) unzip -q \u0026#34;$archive\u0026#34; ;; *.rar) unrar x -y \u0026#34;$archive\u0026#34; ;; *.tar.gz|*.tgz) tar -xzf \u0026#34;$archive\u0026#34; ;; *.tar.bz2) tar -xjf \u0026#34;$archive\u0026#34; ;; *.tar.xz) tar -xJf \u0026#34;$archive\u0026#34; ;; *.7z) 7z x \u0026#34;$archive\u0026#34; ;; *) echo \u0026#34;ä¸æ”¯æŒçš„æ ¼å¼: $archive\u0026#34; continue ;; esac echo \u0026#34;å®Œæˆ: $archive\u0026#34; fi done 3. ç›®å½•å¤§å°ç›‘æ§ä¸å‹ç¼© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/bin/bash # compress_large_dirs.sh - å‹ç¼©å¤§ç›®å½• TARGET_DIR=\u0026#34;/path/to/monitor\u0026#34; SIZE_THRESHOLD=\u0026#34;100M\u0026#34; # 100MBé˜ˆå€¼ find \u0026#34;$TARGET_DIR\u0026#34; -type d -exec du -sh {} + | while read size dir; do if [ \u0026#34;$(echo \u0026#34;$size\u0026#34; | grep -Eo \u0026#39;^[0-9.]+\u0026#39;)\u0026#34; != \u0026#34;\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$(echo \u0026#34;$size\u0026#34; | grep -Eo \u0026#39;^[0-9.]+[MG]\u0026#39;)\u0026#34; != \u0026#34;\u0026#34; ]; then size_num=$(echo \u0026#34;$size\u0026#34; | sed \u0026#39;s/[MG]//\u0026#39;) size_unit=$(echo \u0026#34;$size\u0026#34; | sed \u0026#39;s/[0-9.]//g\u0026#39;) if [ \u0026#34;$size_unit\u0026#34; = \u0026#34;M\u0026#34; ] \u0026amp;\u0026amp; [ $(echo \u0026#34;$size_num \u0026gt; 100\u0026#34; | bc) -eq 1 ]; then echo \u0026#34;å‹ç¼©å¤§ç›®å½•: $dir ($size)\u0026#34; tar -czf \u0026#34;${dir}.tar.gz\u0026#34; \u0026#34;$dir\u0026#34; \u0026amp;\u0026amp; rm -rf \u0026#34;$dir\u0026#34; fi fi done å…«ã€æ€§èƒ½å¯¹æ¯” ğŸ“Š å‹ç¼©ç‡å¯¹æ¯”ï¼ˆæµ‹è¯•æ•°æ®ï¼šLinuxå†…æ ¸æºç ï¼‰ æ ¼å¼ å‹ç¼©åå¤§å° å‹ç¼©ç‡ å‹ç¼©æ—¶é—´ è§£å‹æ—¶é—´ åŸå§‹ 1024MB - - - ZIP 410MB 59.9% 45s 15s GZ 380MB 62.9% 35s 12s BZ2 320MB 68.8% 120s 25s RAR 300MB 70.7% 90s 18s 7Z 280MB 72.7% 180s 20s XZ 260MB 74.6% 240s 22s æ¨èä½¿ç”¨åœºæ™¯ æ—¥å¸¸ä½¿ç”¨: ZIPï¼ˆå…¼å®¹æ€§å¥½ï¼‰ Linuxç³»ç»Ÿ: GZ/TARï¼ˆåŸç”Ÿæ”¯æŒï¼‰ å¤‡ä»½å½’æ¡£: RARï¼ˆåŠŸèƒ½ä¸°å¯Œï¼‰ æé™å‹ç¼©: 7Z/XZï¼ˆæœ€é«˜å‹ç¼©ç‡ï¼‰ æ—¥å¿—å¤„ç†: GZï¼ˆæµå¼å‹ç¼©ï¼‰ ä¹ã€é«˜çº§æŠ€å·§ ğŸ’¡ 1. å¹¶è¡Œå‹ç¼©ï¼ˆä½¿ç”¨pigzï¼‰ 1 2 3 4 5 6 7 8 # å®‰è£…pigzï¼ˆå¹¶è¡Œgzipï¼‰ sudo apt install pigz # ä½¿ç”¨pigzåŠ é€Ÿå‹ç¼© tar -cf - directory/ | pigz -9 \u0026gt; archive.tar.gz # ä½¿ç”¨pbzip2ï¼ˆå¹¶è¡Œbzip2ï¼‰ tar -cf - directory/ | pbzip2 -9 \u0026gt; archive.tar.bz2 2. åŠ å¯†æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 # ä½¿ç”¨å¼ºå¯†ç ï¼ˆé¿å…åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥æ˜¾ç¤ºï¼‰ read -s -p \u0026#34;è¾“å…¥å¯†ç : \u0026#34; password echo rar a -p\u0026#34;$password\u0026#34; archive.rar file.txt # æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡ password=$(openssl rand -base64 32) rar a -p\u0026#34;$password\u0026#34; archive.rar file.txt 3. è‡ªåŠ¨æ’é™¤å¸¸è§æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºæ’é™¤åˆ—è¡¨æ–‡ä»¶ cat \u0026gt; exclude.list \u0026lt;\u0026lt; EOF *.tmp *.log *.cache node_modules/ .git/ .DS_Store EOF # ä½¿ç”¨æ’é™¤åˆ—è¡¨ tar -czvf archive.tar.gz -X exclude.list directory/ zip -r archive.zip directory/ -x@exclude.list 4. ç½‘ç»œä¼ è¾“ä¼˜åŒ– 1 2 3 4 5 # å‹ç¼©å¹¶ç›´æ¥ä¼ è¾“ï¼ˆèŠ‚çœå¸¦å®½ï¼‰ tar -czf - large_dir/ | ssh user@remote \u0026#34;cat \u0026gt; /backup/backup.tar.gz\u0026#34; # ä»ç½‘ç»œè§£å‹ ssh user@remote \u0026#34;cat /backup/backup.tar.gz\u0026#34; | tar -xzf - åã€é€ŸæŸ¥è¡¨ ğŸ§© å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥ éœ€æ±‚ å‘½ä»¤ å‹ç¼©ç›®å½• tar -czvf archive.tar.gz dir/ è§£å‹ tar.gz tar -xzvf archive.tar.gz åŠ å¯† ZIP zip -e archive.zip file åˆ†å· RAR rar a -v100m archive.rar file æŸ¥çœ‹å‹ç¼©å†…å®¹ unzip -l a.zip / unrar l a.rar / tar -tzvf a.tar.gz æœ€é«˜å‹ç¼©ç‡ 7z a -mx=9 archive.7z dir/ å¹¶è¡Œå‹ç¼© tar -cf - dir/ | pigz \u0026gt; archive.tar.gz æŒ‰æ ¼å¼é€‰æ‹© æœ€å¿«å‹ç¼©: zip -1 æˆ– gzip -1 å¹³è¡¡é€‰æ‹©: rar -m5 æˆ– gzip -6 æœ€ä½³å‹ç¼©: 7z -mx=9 æˆ– xz -9e æ—¥å¸¸ä½¿ç”¨: zip æˆ– tar.gz é‡è¦å¤‡ä»½: rarï¼ˆå¸¦æ¢å¤è®°å½•ï¼‰ æé™å‹ç¼©: 7z æˆ– xz æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 9 10 # ä¿®å¤æŸåçš„ZIP zip -F broken.zip --out fixed.zip # æµ‹è¯•å‹ç¼©åŒ…å®Œæ•´æ€§ unzip -t archive.zip rar t archive.rar tar -tf archive.tar.gz \u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;OK\u0026#34; # å¤„ç†ç¼–ç é—®é¢˜ï¼ˆä¸­æ–‡æ–‡ä»¶åï¼‰ unzip -O GBK archive.zip # ä¸­æ–‡Windowsåˆ›å»ºçš„ZIP ğŸ¯ æ€»ç»“:\næ—¥å¸¸ä½¿ç”¨é€‰ ZIPï¼ŒLinux ç³»ç»Ÿç”¨ TAR+GZï¼Œé‡è¦å¤‡ä»½ç”¨ RARï¼Œæé™å‹ç¼©è¯• 7Z/XZ\næ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œè®°å¾—ç»å¸¸æµ‹è¯•å¤‡ä»½çš„å®Œæ•´æ€§ï¼\nğŸ’¡ æç¤º: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ“ä½œå‰ï¼ŒåŠ¡å¿…æµ‹è¯•å‹ç¼©è§£å‹æµç¨‹ï¼Œå¹¶ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å’Œå†…å­˜ã€‚\n","date":"2025-08-26T20:49:57+08:00","image":"https://file.meimolihan.eu.org/img/linux-rar-01.webp","permalink":"https://blog.meimolihan.eu.org/p/241fc5ca/","title":"Linux æ–‡ä»¶å‹ç¼©ä¸è§£å‹ rar gz å’Œ zip æ ¼å¼è¯¦è§£ ğŸ“¦"},{"content":"Linux ä¸‹è½½ç¥å™¨ wget ä¸ curl å‘½ä»¤è¯¦è§£ ğŸ“¥ ğŸŒ æŒæ¡Linuxä¸‹æœ€å¼ºå¤§çš„ç½‘ç»œä¼ è¾“å·¥å…·ï¼Œè½»æ¾åº”å¯¹å„ç§ä¸‹è½½å’Œæ•°æ®ä¼ è¾“éœ€æ±‚\nâœ¨ å·¥å…·ç‰¹ç‚¹ âš¡ é«˜æ•ˆä¼ è¾“: æ”¯æŒå¤šåè®®ã€é«˜é€Ÿä¸‹è½½å’Œä¸Šä¼  ğŸ”„ æ–­ç‚¹ç»­ä¼ : ç½‘ç»œä¸­æ–­åå¯ä»æ–­ç‚¹ç»§ç»­ä¼ è¾“ ğŸ›¡ï¸ å®‰å…¨å¯é : æ”¯æŒ SSL/TLS åŠ å¯†å’Œå¤šç§è®¤è¯æ–¹å¼ ğŸ“Š çµæ´»å¯æ§: ä¸°å¯Œçš„å‚æ•°é€‰é¡¹æ»¡è¶³å„ç§éœ€æ±‚ ğŸ§ è·¨å¹³å°: åœ¨å‡ ä¹æ‰€æœ‰ Linux å‘è¡Œç‰ˆå’Œ Unix ç³»ç»Ÿä¸Šå¯ç”¨ ğŸ“– ç›®å½•å¯¼èˆª ğŸ”§ å®‰è£…æ–¹æ³• ğŸ“¥ wget ä½¿ç”¨è¯¦è§£ ğŸ“¡ curl ä½¿ç”¨è¯¦è§£ âš–ï¸ å·¥å…·å¯¹æ¯” ğŸ¯ åº”ç”¨åœºæ™¯ ğŸ’¡ é«˜çº§æŠ€å·§ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ“Š æ€»ç»“ ğŸ”§ å®‰è£…æ–¹æ³• ğŸ§ Ubuntu/Debian ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£… wget sudo apt install wget -y # å®‰è£… curl sudo apt install curl -y # éªŒè¯å®‰è£… wget --version curl --version ğŸ”´ CentOS/RHEL ç³»ç»Ÿ 1 2 3 4 5 # å®‰è£… wget å’Œ curl sudo yum install wget curl -y # æˆ–è€…ä½¿ç”¨ dnfï¼ˆCentOS 8+ï¼‰ sudo dnf install wget curl -y ğŸ macOS ç³»ç»Ÿ 1 2 3 4 5 # ä½¿ç”¨ Homebrew å®‰è£… brew install wget curl # æˆ–è€…ä½¿ç”¨ MacPorts sudo port install wget curl ğŸ“¦ æºç ç¼–è¯‘å®‰è£…ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç¼–è¯‘å®‰è£… wget wget https://ftp.gnu.org/gnu/wget/wget-latest.tar.gz tar -xzf wget-latest.tar.gz cd wget-* ./configure --prefix=/usr/local --with-ssl=openssl make sudo make install # ç¼–è¯‘å®‰è£… curl wget https://curl.se/download/curl-7.88.1.tar.gz tar -xzf curl-7.88.1.tar.gz cd curl-7.88.1 ./configure --prefix=/usr/local --with-openssl make sudo make install ğŸ“¥ wget ä½¿ç”¨è¯¦è§£ ğŸ¯ åŸºæœ¬ä¸‹è½½æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä¸‹è½½å•ä¸ªæ–‡ä»¶ wget https://example.com/file.zip # æŒ‡å®šä¸‹è½½æ–‡ä»¶å wget -O custom_name.zip https://example.com/file.zip # å®‰é™æ¨¡å¼ä¸‹è½½ï¼ˆä¸æ˜¾ç¤ºè¿›åº¦ï¼‰ wget -q https://example.com/file.zip # è¾“å‡ºè¯¦ç»†ä¿¡æ¯ wget -v https://example.com/file.zip # é™åˆ¶é‡è¯•æ¬¡æ•° wget --tries=3 https://example.com/file.zip â¯ï¸ æ–­ç‚¹ç»­ä¼ ä¸åå°ä¸‹è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯ç”¨æ–­ç‚¹ç»­ä¼  wget -c https://example.com/large_file.iso # åå°ä¸‹è½½ wget -b https://example.com/large_file.iso # æŸ¥çœ‹åå°ä¸‹è½½æ—¥å¿— tail -f wget-log # è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ wget -T 30 https://example.com/file.zip # ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ wget -w 5 https://example.com/file.zip ğŸš¦ ç½‘ç»œæ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 # é™åˆ¶ä¸‹è½½é€Ÿåº¦ï¼ˆ100KB/sï¼‰ wget --limit-rate=100k https://example.com/large_file.iso # é™åˆ¶ä¸‹è½½é€Ÿåº¦ï¼ˆ1MB/sï¼‰ wget --limit-rate=1m https://example.com/large_file.iso # ç¦ç”¨ç¼“å­˜ wget --no-cache https://example.com/file.html # ä½¿ç”¨è¢«åŠ¨æ¨¡å¼ FTP wget --passive-ftp ftp://example.com/file.zip ğŸŒ é€’å½’ä¸‹è½½ä¸ç½‘ç«™é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # é€’å½’ä¸‹è½½æ•´ä¸ªç½‘ç«™ï¼ˆæœ€å¤š5å±‚ï¼‰ wget -r -l 5 https://example.com/ # ä¸è·¨è¶Šä¸»æœºè¾¹ç•Œ wget -r -l 5 -np https://example.com/path/ # åªä¸‹è½½ç‰¹å®šç±»å‹æ–‡ä»¶ wget -r -A \u0026#34;*.jpg,*.png\u0026#34; https://example.com/images/ # æ’é™¤ç‰¹å®šæ–‡ä»¶ç±»å‹ wget -r -R \u0026#34;*.tmp,*.bak\u0026#34; https://example.com/ # é•œåƒæ•´ä¸ªç½‘ç«™ï¼ˆé€‚åˆå¤‡ä»½ï¼‰ wget -mk -w 2 https://example.com/ # è½¬æ¢é“¾æ¥ä¸ºæœ¬åœ°é“¾æ¥ wget -k -r https://example.com/ ğŸ” è®¤è¯ä¸å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 # FTP è®¤è¯ä¸‹è½½ wget --ftp-user=username --ftp-password=password ftp://example.com/file.zip # HTTP åŸºç¡€è®¤è¯ wget --user=username --password=password https://example.com/protected/file.zip # å¿½ç•¥ SSL è¯ä¹¦éªŒè¯ï¼ˆä¸å®‰å…¨ï¼‰ wget --no-check-certificate https://example.com/secure-file.zip # ä½¿ç”¨ç‰¹å®š SSL ç‰ˆæœ¬ wget --secure-protocol=TLSv1_2 https://example.com/secure-file.zip ğŸ“‹ æ‰¹é‡ä¸‹è½½ä¸ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä»æ–‡ä»¶è¯»å–URLåˆ—è¡¨ä¸‹è½½ wget -i download_list.txt # ä¸‹è½½åºåˆ—æ–‡ä»¶ wget https://example.com/images/{1..10}.jpg # é™åˆ¶æ€»ä¸‹è½½å¤§å° wget -Q100m -i download_list.txt # è®¾ç½®ä¸‹è½½ç›®å½• wget -P /path/to/download https://example.com/file.zip # è®°å½•ä¸‹è½½æ—¥å¿— wget -o download.log https://example.com/file.zip ğŸ”§ é«˜çº§é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ wget -e use_proxy=yes -e http_proxy=proxy:port https://example.com # è®¾ç½®ç”¨æˆ·ä»£ç† wget -U \u0026#34;Mozilla/5.0\u0026#34; https://example.com # å¤„ç†é‡å®šå‘ wget --max-redirect=5 https://example.com/redirect # å¿½ç•¥ç›®å½•åˆ›å»ºé”™è¯¯ wget --no-directories https://example.com/files/ # å¼ºåˆ¶ä½¿ç”¨ IPv4 æˆ– IPv6 wget -4 https://example.com # IPv4 wget -6 https://example.com # IPv6 ğŸ“¡ curl ä½¿ç”¨è¯¦è§£ ğŸ¯ åŸºæœ¬è¯·æ±‚æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # è·å–ç½‘é¡µå†…å®¹ curl https://example.com # ä¿å­˜åˆ°æ–‡ä»¶ curl -o output.html https://example.com # ä½¿ç”¨æœåŠ¡å™¨æä¾›çš„æ–‡ä»¶åä¿å­˜ curl -O https://example.com/file.zip # å®‰é™æ¨¡å¼ï¼ˆä¸æ˜¾ç¤ºè¿›åº¦ï¼‰ curl -s -O https://example.com/file.zip # æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ curl -v https://example.com # è·Ÿéšé‡å®šå‘ curl -L https://example.com/redirect ğŸ“¨ HTTP æ–¹æ³•æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # GET è¯·æ±‚ï¼ˆé»˜è®¤ï¼‰ curl https://api.example.com/users # POST è¯·æ±‚ curl -X POST https://api.example.com/users curl -X POST -d \u0026#34;name=John\u0026amp;age=30\u0026#34; https://api.example.com/users # PUT è¯·æ±‚ curl -X PUT -d \u0026#34;name=John\u0026#34; https://api.example.com/users/1 # DELETE è¯·æ±‚ curl -X DELETE https://api.example.com/users/1 # PATCH è¯·æ±‚ curl -X PATCH -d \u0026#34;age=31\u0026#34; https://api.example.com/users/1 # HEAD è¯·æ±‚ curl -I https://example.com # OPTIONS è¯·æ±‚ curl -X OPTIONS https://api.example.com/users ğŸ“¤ æ•°æ®å‘é€ä¸å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å‘é€è¡¨å•æ•°æ® curl -d \u0026#34;param1=value1\u0026amp;param2=value2\u0026#34; https://example.com/form # å‘é€ JSON æ•°æ® curl -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;key\u0026#34;:\u0026#34;value\u0026#34;}\u0026#39; https://api.example.com/data # ä»æ–‡ä»¶è¯»å–æ•°æ®å‘é€ curl -d @data.json https://api.example.com/data # å¤šéƒ¨åˆ†è¡¨å•æ•°æ® curl -F \u0026#34;name=John\u0026#34; -F \u0026#34;photo=@photo.jpg\u0026#34; https://example.com/upload # URL ç¼–ç æ•°æ® curl --data-urlencode \u0026#34;name=John Doe\u0026#34; https://example.com/submit # å‘é€åŸå§‹æ•°æ® curl --raw https://example.com/data # å‹ç¼©è¯·æ±‚æ•°æ® curl --compress -d @large_data.json https://api.example.com/data ğŸ“ è¯·æ±‚å¤´ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´ curl -H \u0026#34;Authorization: Bearer token123\u0026#34; https://api.example.com/protected # è®¾ç½®å¤šä¸ªè¯·æ±‚å¤´ curl -H \u0026#34;Content-Type: application/json\u0026#34; -H \u0026#34;X-Custom-Header: value\u0026#34; https://api.example.com/endpoint # è®¾ç½®ç”¨æˆ·ä»£ç† curl -A \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\u0026#34; https://example.com # å¼•ç”¨æ¥æº curl -e \u0026#34;https://google.com\u0026#34; https://example.com # åˆ é™¤é»˜è®¤è¯·æ±‚å¤´ curl -H \u0026#34;Host:\u0026#34; https://example.com # æŸ¥çœ‹è¯·æ±‚å¤´ curl -D headers.txt https://example.com ğŸ” è®¤è¯ä¸å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åŸºæœ¬è®¤è¯ curl -u username:password https://example.com/protected # ä»…ç”¨æˆ·åï¼ˆä¼šæç¤ºè¾“å…¥å¯†ç ï¼‰ curl -u username https://example.com/protected # Bearer Token è®¤è¯ curl -H \u0026#34;Authorization: Bearer your_token\u0026#34; https://api.example.com/data # Digest è®¤è¯ curl --digest -u username:password https://example.com/protected # NTLM è®¤è¯ curl --ntlm -u username:password https://example.com/protected # å¿½ç•¥ SSL è¯ä¹¦éªŒè¯ curl -k https://example.com/secure # ä½¿ç”¨ç‰¹å®šå®¢æˆ·ç«¯è¯ä¹¦ curl --cert client.pem --key key.pem https://example.com/secure # ä½¿ç”¨ CA è¯ä¹¦åŒ… curl --cacert ca-bundle.pem https://example.com/secure ğŸ› è°ƒè¯•ä¸ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æ˜¾ç¤ºè¯¦ç»†è¯·æ±‚ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰ curl -v https://example.com # ä»…æ˜¾ç¤ºå“åº”å¤´ curl -I https://example.com # æ˜¾ç¤ºè¯·æ±‚å’Œå“åº”å¤´ curl -i https://example.com # æ˜¾ç¤ºä¼ è¾“çŠ¶æ€ curl -w \u0026#34;Status: %{http_code}\\nSize: %{size_download}\\nTime: %{time_total}\\n\u0026#34; https://example.com # å¤æ‚çš„æ ¼å¼åŒ–è¾“å‡º curl -w @format.txt https://example.com # è·Ÿè¸ªé‡å®šå‘ curl -L --max-redirs 5 https://example.com/redirect # æ˜¾ç¤ºè¿›åº¦æ¡ curl -# -O https://example.com/largefile.zip # é™åˆ¶é€Ÿåº¦ curl --limit-rate 100k -O https://example.com/largefile.zip ğŸ“Š é«˜çº§åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # å¹¶è¡Œä¼ è¾“ï¼ˆéœ€è¦å®‰è£… curl 7.66.0+ï¼‰ curl --parallel --parallel-max 3 -O https://example.com/file1.zip -O https://example.com/file2.zip # æ¢å¤ä¸­æ–­çš„ä¸‹è½½ curl -C - -O https://example.com/largefile.zip # ä½¿ç”¨ SOCKS ä»£ç† curl --socks5 proxy:port https://example.com # ä½¿ç”¨ HTTP ä»£ç† curl -x http://proxy:port https://example.com # ä¿å­˜ cookie curl -c cookies.txt https://example.com/login # ä½¿ç”¨ cookie curl -b cookies.txt https://example.com/dashboard # ä¸Šä¼ æ–‡ä»¶ curl -T localfile.txt https://example.com/upload # ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ curl -T \u0026#34;{file1,file2}\u0026#34; https://example.com/upload # FTP æ“ä½œ curl -u user:pass ftp://example.com/ -O curl -Q \u0026#34;CWD /remote/directory\u0026#34; ftp://example.com/ # é‚®ä»¶ä¼ è¾“ï¼ˆSMTPï¼‰ curl --mail-from sender@example.com --mail-rcpt receiver@example.com --upload-file email.txt smtp://smtp.example.com âš–ï¸ å·¥å…·å¯¹æ¯” ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨ ç‰¹æ€§ ğŸ” wget ğŸ“¡ curl è®¾è®¡ç›®çš„ æ–‡ä»¶ä¸‹è½½ æ•°æ®ä¼ è¾“ é€’å½’ä¸‹è½½ âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ è¾“å‡ºé»˜è®¤ ä¿å­˜åˆ°æ–‡ä»¶ è¾“å‡ºåˆ°ç»ˆç«¯ åè®®æ”¯æŒ HTTP, HTTPS, FTP 30+ ç§åè®® äº¤äº’æ€§ éäº¤äº’å¼ å¯äº¤äº’ æ–­ç‚¹ç»­ä¼  âœ… å†…ç½®æ”¯æŒ âœ… éœ€è¦å‚æ•° åå°è¿è¡Œ âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ ç½‘ç«™é•œåƒ âœ… ä¼˜ç§€æ”¯æŒ âŒ ä¸æ”¯æŒ API æµ‹è¯• âŒ æœ‰é™æ”¯æŒ âœ… ä¼˜ç§€æ”¯æŒ æ–‡ä»¶ä¸Šä¼  âŒ ä¸æ”¯æŒ âœ… ä¼˜ç§€æ”¯æŒ è¿›åº¦æ˜¾ç¤º âœ… å†…ç½® âœ… éœ€è¦å‚æ•° è„šæœ¬å‹å¥½ âœ… ä¼˜ç§€ âœ… ä¼˜ç§€ ğŸ¯ é€‰æ‹©æŒ‡å— é€‰æ‹© wget å½“æ‚¨éœ€è¦ï¼š\nğŸ“¥ ä¸‹è½½æ–‡ä»¶æˆ–æ•´ä¸ªç½‘ç«™ ğŸ”„ æ–­ç‚¹ç»­ä¼ å¤§å‹æ–‡ä»¶ ğŸŒ é€’å½’ä¸‹è½½ç½‘ç«™å†…å®¹ â¯ï¸ åå°ä¸‹è½½ä»»åŠ¡ ğŸ“ ç®€å•çš„æ–‡ä»¶ä¸‹è½½æ“ä½œ é€‰æ‹© curl å½“æ‚¨éœ€è¦ï¼š\nğŸ”„ API æµ‹è¯•å’Œè°ƒè¯• ğŸ“¤ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ ğŸ›¡ï¸ å¤æ‚çš„è®¤è¯å¤„ç† ğŸ“Š è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ ğŸ”— å¤šç§åè®®æ”¯æŒ ğŸ“ çµæ´»çš„è¯·æ±‚å®šåˆ¶ ğŸ¯ åº”ç”¨åœºæ™¯ ğŸŒ wget å®ç”¨åœºæ™¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 1. ä¸‹è½½å¤§å‹æ–‡ä»¶ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰ wget -c https://example.com/large_file.iso # 2. é•œåƒæ•´ä¸ªç½‘ç«™ç”¨äºç¦»çº¿æµè§ˆ wget -mk -w 2 -np https://example.com/ # 3. æ‰¹é‡ä¸‹è½½æ–‡ä»¶åˆ—è¡¨ wget -i url_list.txt -P /path/to/downloads # 4. å®šæ—¶è‡ªåŠ¨ä¸‹è½½ï¼ˆç»“åˆcronï¼‰ # æ¯å¤©å‡Œæ™¨ä¸‹è½½æ›´æ–° 0 0 * * * wget -q -O /backups/update.zip https://example.com/daily_update.zip # 5. ä¸‹è½½ç‰¹å®šç±»å‹æ–‡ä»¶ wget -r -A \u0026#34;*.pdf\u0026#34; https://example.com/documents/ # 6. å—é™ç½‘ç»œç¯å¢ƒä¸‹è½½ wget --limit-rate=500k https://example.com/largefile.zip ğŸ”„ curl å®ç”¨åœºæ™¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 1. REST API æµ‹è¯•å’Œè°ƒè¯• curl -X POST -H \u0026#34;Content-Type: application/json\u0026#34; -H \u0026#34;Authorization: Bearer token\u0026#34; -d \u0026#39;{\u0026#34;user\u0026#34;:\u0026#34;test\u0026#34;}\u0026#39; https://api.example.com/users # 2. æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ curl -F \u0026#34;file=@localfile.txt\u0026#34; -F \u0026#34;description=test file\u0026#34; https://example.com/upload # 3. ç½‘ç«™å¥åº·çŠ¶æ€ç›‘æ§ curl -s -o /dev/null -w \u0026#34;%{http_code}\\n\u0026#34; https://example.com # 4. è·å–å¤©æ°”ä¿¡æ¯ curl \u0026#34;wttr.in/Beijing?format=3\u0026#34; # 5. æµ‹è¯•æ¥å£æ€§èƒ½ curl -w \u0026#34;DNS: %{time_namelookup} Connect: %{time_connect} Start: %{time_starttransfer} Total: %{time_total}\\n\u0026#34; https://api.example.com # 6. OAuth 2.0 è®¤è¯æµç¨‹ curl -u client_id:client_secret -d \u0026#34;grant_type=client_credentials\u0026#34; https://oauth.example.com/token # 7. WebSocket è¿æ¥æµ‹è¯• curl --include --no-buffer --header \u0026#34;Connection: Upgrade\u0026#34; --header \u0026#34;Upgrade: websocket\u0026#34; --header \u0026#34;Sec-WebSocket-Key: SGVsbG8sIHdvcmxkIQ==\u0026#34; --header \u0026#34;Sec-WebSocket-Version: 13\u0026#34; https://example.com/ws ğŸ”— ç»„åˆä½¿ç”¨åœºæ™¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 1. ä¸‹è½½å¹¶è§£å‹æ–‡ä»¶ curl -L https://example.com/archive.tar.gz | tar xz # 2. å®‰å…¨çš„è„šæœ¬ä¸‹è½½å’Œæ‰§è¡Œ curl -sSL https://example.com/install.sh | bash -s -- --option value # 3. ç›‘æ§å¤šä¸ªç½‘ç«™çŠ¶æ€ for url in https://site1.com https://site2.com https://site3.com; do echo -n \u0026#34;$url: \u0026#34; curl -s -o /dev/null -w \u0026#34;%{http_code}\u0026#34; $url echo done # 4. æ‰¹é‡å¤„ç† API è¯·æ±‚ cat requests.txt | while read url; do curl -X POST -H \u0026#34;Content-Type: application/json\u0026#34; -d @data.json \u0026#34;$url\u0026#34; done # 5. ä¸‹è½½æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ curl -O https://example.com/file.zip \u0026amp;\u0026amp; echo \u0026#34;Download complete\u0026#34; || echo \u0026#34;Download failed\u0026#34; ğŸ’¡ é«˜çº§æŠ€å·§ ğŸ¨ è¾“å‡ºç¾åŒ–ä¸å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å½©è‰²è¾“å‡ºï¼ˆéœ€è¦å®‰è£… lolcatï¼‰ curl -s https://example.com/text | lolcat # JSON æ ¼å¼åŒ–è¾“å‡º curl -s https://api.example.com/data | jq . # XML æ ¼å¼åŒ–è¾“å‡º curl -s https://api.example.com/data | xmllint --format - # CSV å¤„ç† curl -s https://example.com/data.csv | csvtool readable - # æå–ç‰¹å®šä¿¡æ¯ curl -s https://example.com/page.html | grep -o \u0026#39;\u0026lt;title\u0026gt;.*\u0026lt;/title\u0026gt;\u0026#39; # ç›‘æ§å®æ—¶æ—¥å¿— curl -s https://logs.example.com/stream | while read line; do echo \u0026#34;[$(date)] $line\u0026#34; done ğŸ”„ ä½¿ç”¨ä»£ç†å’Œéš§é“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä½¿ç”¨ HTTP ä»£ç† curl -x http://proxy:8080 https://example.com # ä½¿ç”¨ SOCKS ä»£ç† curl --socks5 proxy:1080 https://example.com # ä»£ç†è®¤è¯ curl -x http://user:pass@proxy:8080 https://example.com # é€šè¿‡ SSH éš§é“ ssh -L 8080:example.com:80 user@server curl http://localhost:8080 # è‡ªåŠ¨ä»£ç†é…ç½® curl --proxy-auto-detect https://example.com # ä»£ç†æ’é™¤åˆ—è¡¨ curl --noproxy \u0026#34;localhost,127.0.0.1,.example.com\u0026#34; https://example.com ğŸ“Š æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¹¶è¡Œä¸‹è½½ï¼ˆä½¿ç”¨ xargsï¼‰ cat url_list.txt | xargs -P 4 -I {} wget {} # å¤šè¿æ¥ä¸‹è½½ï¼ˆä½¿ç”¨ aria2cï¼‰ aria2c -x 16 -s 16 https://example.com/largefile.zip # å¤šè¿æ¥ä¸‹è½½ï¼ˆä½¿ç”¨ axelï¼‰ axel -n 10 https://example.com/largefile.zip # è¿æ¥å¤ç”¨ï¼ˆHTTP/2ï¼‰ curl --http2 https://example.com # å‹ç¼©ä¼ è¾“ curl --compressed https://example.com # DNS é¢„è§£æ curl --resolve example.com:443:1.2.3.4 https://example.com ğŸ›¡ï¸ å®‰å…¨å¢å¼ºæªæ–½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä½¿ç”¨ TLS 1.3 curl --tlsv1.3 https://example.com # æŒ‡å®šåŠ å¯†å¥—ä»¶ curl --ciphers ECDHE-RSA-AES128-GCM-SHA256 https://example.com # è¯ä¹¦é’‰æ‰ curl --pinnedpubkey \u0026#34;sha256//base64==\u0026#34; https://example.com # è¯ä¹¦ä¿¡æ¯éªŒè¯ curl --cert-status https://example.com # éšè—æ•æ„Ÿä¿¡æ¯ curl -s -u username:password https://example.com | sed \u0026#39;s/password/***/g\u0026#39; # å®‰å…¨åˆ é™¤æ•æ„Ÿæ–‡ä»¶ shred -u ~/.curl_history ğŸ¤– è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash # è‡ªåŠ¨å¤‡ä»½è„šæœ¬ set -euo pipefail BACKUP_URL=\u0026#34;https://backup.example.com/upload\u0026#34; API_KEY=\u0026#34;your_api_key_here\u0026#34; LOG_FILE=\u0026#34;/var/log/backup.log\u0026#34; # åˆ›å»ºå¤‡ä»½ echo \u0026#34;$(date): Starting backup\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; tar -czf /tmp/backup-$(date +%Y%m%d).tar.gz /important/data # ä¸Šä¼ å¤‡ä»½ if curl -X POST -H \u0026#34;Authorization: Bearer $API_KEY\u0026#34; -F \u0026#34;file=@/tmp/backup-$(date +%Y%m%d).tar.gz\u0026#34; \u0026#34;$BACKUP_URL\u0026#34;; then echo \u0026#34;$(date): Backup uploaded successfully\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -f /tmp/backup-*.tar.gz else echo \u0026#34;$(date): Backup upload failed\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; exit 1 fi âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ“œ æ³•å¾‹ä¸åˆè§„ 1 2 3 4 5 6 7 8 9 10 11 # 1. å°Šé‡ robots.txt åè®® wget -e robots=off https://example.com/ # è°¨æ…ä½¿ç”¨ # 2. éµå®ˆç‰ˆæƒæ³•è§„ # ä»…ä¸‹è½½æ‹¥æœ‰åˆæ³•æƒé™çš„å†…å®¹ # 3. æ³¨æ„ä½¿ç”¨æ¡æ¬¾ # æŸ¥çœ‹ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾å’Œæ¡ä»¶ # 4. æ•°æ®ä¿æŠ¤æ³•è§„ # éµå®ˆ GDPRã€CCPA ç­‰æ•°æ®ä¿æŠ¤æ³•è§„ ğŸš¦ é¢‘ç‡é™åˆ¶ä¸ç¤¼ä»ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. æ·»åŠ å»¶è¿Ÿé¿å…è¿‡åº¦è¯·æ±‚ wget -w 2 https://example.com/pages/ # 2. é™åˆ¶å¹¶å‘è¿æ¥ curl --limit-rate 100k https://example.com # 3. ä½¿ç”¨ç¼“å­˜å‡å°‘è¯·æ±‚ curl -H \u0026#34;Cache-Control: max-age=3600\u0026#34; https://example.com # 4. è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ wget -T 30 https://example.com # 5. ç›‘æ§æœåŠ¡å™¨è´Ÿè½½ # å¦‚æœæœåŠ¡å™¨å“åº”å˜æ…¢ï¼Œå‡å°‘è¯·æ±‚é¢‘ç‡ ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 1. é¿å…åœ¨å‘½ä»¤è¡Œä¸­æš´éœ²å¯†ç  # é”™è¯¯ï¼šcurl -u user:password https://example.com # æ­£ç¡®ï¼šcurl -u user https://example.com # ä¼šæç¤ºè¾“å…¥å¯†ç  # 2. ä½¿ç”¨é…ç½®æ–‡ä»¶å­˜å‚¨æ•æ„Ÿä¿¡æ¯ echo \u0026#39;user = \u0026#34;username:password\u0026#34;\u0026#39; \u0026gt; ~/.curlrc chmod 600 ~/.curlrc # 3. å®šæœŸæ›´æ–°è½¯ä»¶ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade wget curl # 4. éªŒè¯ä¸‹è½½æ–‡ä»¶çš„å®Œæ•´æ€§ wget https://example.com/file.zip wget https://example.com/file.zip.sha256 sha256sum -c file.zip.sha256 # 5. ä½¿ç”¨ HTTPS åŠ å¯†è¿æ¥ # ä¼˜å…ˆä½¿ç”¨ https:// è€Œä¸æ˜¯ http:// ğŸ’¾ èµ„æºç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. ç›‘æ§ç£ç›˜ç©ºé—´ # å¤§æ–‡ä»¶ä¸‹è½½å‰æ£€æŸ¥å¯ç”¨ç©ºé—´ df -h /download/path # 2. é™åˆ¶ä¸‹è½½å¤§å° wget -Q100m https://example.com/largefile # 3. æ¸…ç†æ—§æ–‡ä»¶ find /downloads -type f -mtime +30 -delete # 4. ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤„ç†å¤§æ–‡ä»¶ curl -O https://example.com/largefile.tmp \u0026amp;\u0026amp; mv largefile.tmp largefile.final # 5. å†…å­˜ä½¿ç”¨ä¼˜åŒ– # å¯¹äºå¤§æ–‡ä»¶ï¼Œä½¿ç”¨æµå¼å¤„ç†è€Œä¸æ˜¯å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ ğŸ› é”™è¯¯å¤„ç†ä¸è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 1. æ£€æŸ¥é€€å‡ºçŠ¶æ€ç  if wget -q https://example.com/file.zip; then echo \u0026#34;Download successful\u0026#34; else echo \u0026#34;Download failed with exit code $?\u0026#34; fi # 2. è¯¦ç»†çš„é”™è¯¯æ—¥å¿— curl -v -o output.txt https://example.com 2\u0026gt; error.log # 3. é‡è¯•æœºåˆ¶ wget --tries=5 --retry-connrefused https://example.com/file.zip # 4. è¶…æ—¶å¤„ç† curl --connect-timeout 30 --max-time 300 https://example.com # 5. ç½‘ç»œè¯Šæ–­ curl --interface eth0 https://example.com # æŒ‡å®šç½‘ç»œæ¥å£ ğŸ“Š æ€»ç»“ ğŸ¯ æ ¸å¿ƒè¦ç‚¹å›é¡¾ wget ä¼˜åŠ¿ï¼š\nâœ… ä¸“ä¸ºä¸‹è½½ä¼˜åŒ–ï¼Œç®€å•æ˜“ç”¨ âœ… æ”¯æŒé€’å½’ä¸‹è½½å’Œç½‘ç«™é•œåƒ âœ… å†…ç½®æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ âœ… é€‚åˆæ‰¹é‡ä¸‹è½½ä»»åŠ¡ âœ… åå°è¿è¡Œæ”¯æŒ curl ä¼˜åŠ¿ï¼š\nâœ… æ”¯æŒ 30+ ç§åè®® âœ… å¼ºå¤§çš„ API æµ‹è¯•èƒ½åŠ› âœ… çµæ´»çš„æ•°æ®å‘é€åŠŸèƒ½ âœ… è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ âœ… æ–‡ä»¶ä¸Šä¼ æ”¯æŒ ğŸ”§ å­¦ä¹ å»ºè®® ğŸ¯ åˆå­¦è€…ï¼šå…ˆä» wget å¼€å§‹ï¼ŒæŒæ¡åŸºæœ¬ä¸‹è½½åŠŸèƒ½ ğŸš€ è¿›é˜¶ç”¨æˆ·ï¼šå­¦ä¹  curl çš„å¤æ‚è¯·æ±‚å’Œæ•°æ®å‘é€ ğŸ† é«˜çº§ç”¨æˆ·ï¼šæŒæ¡ä¸¤è€…ç»„åˆä½¿ç”¨å’Œè‡ªåŠ¨åŒ–è„šæœ¬ ğŸ›¡ï¸ ç”Ÿäº§ç¯å¢ƒï¼šæ³¨é‡å®‰å…¨æ€§å’Œé”™è¯¯å¤„ç† ğŸ“š æ‰©å±•èµ„æº 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ man wget man curl # åœ¨çº¿æ–‡æ¡£ # wget: https://www.gnu.org/software/wget/manual/ # curl: https://curl.se/docs/ # ç¤¾åŒºæ”¯æŒ # GitHub ä»“åº“å’Œé—®é¢˜è·Ÿè¸ª # Stack Overflow ç›¸å…³é—®é¢˜ ğŸ”® æœªæ¥å‘å±•è¶‹åŠ¿ ğŸŒ HTTP/3 æ”¯æŒï¼šcurl å·²å¼€å§‹æ”¯æŒ HTTP/3 ğŸ” å¢å¼ºå®‰å…¨ï¼šæ›´å¥½çš„ TLS å’ŒåŠ å¯†æ”¯æŒ ğŸ“Š æ€§èƒ½ä¼˜åŒ–ï¼šæ›´é«˜æ•ˆçš„ä¼ è¾“ç®—æ³• ğŸ¤– è‡ªåŠ¨åŒ–é›†æˆï¼šæ›´å¥½çš„è„šæœ¬å’Œè‡ªåŠ¨åŒ–æ”¯æŒ ğŸ’¡ æœ€ç»ˆå»ºè®®ï¼šæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚å¯¹äºç®€å•çš„ä¸‹è½½ä»»åŠ¡ï¼Œwget æ›´åŠ æ–¹ä¾¿ï¼›å¯¹äºå¤æ‚çš„ç½‘ç»œè¯·æ±‚å’Œ API æµ‹è¯•ï¼Œcurl æ›´ä¸ºå¼ºå¤§ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¸¤è€…ç»å¸¸ç»“åˆä½¿ç”¨ï¼Œå‘æŒ¥å„è‡ªä¼˜åŠ¿ã€‚\n","date":"2025-08-26T20:42:46+08:00","image":"https://file.meimolihan.eu.org/img/wget-curl-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d45e7956/","title":"Linux ä¸‹è½½ç¥å™¨ wget ä¸ curl å‘½ä»¤è¯¦è§£ ğŸ“¥"},{"content":"Linux æ–‡æœ¬æœç´¢ grep å‘½ä»¤è¯¦è§£ ğŸ” æŒæ¡ Linux ä¸­æœ€å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·ï¼Œæå‡ä½ çš„å‘½ä»¤è¡Œæ•ˆç‡å’Œæ•°æ®å¤„ç†èƒ½åŠ›\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸŒŸ grep å‘½ä»¤ç®€ä»‹ ğŸ“‹ åŸºæœ¬è¯­æ³•ç»“æ„ ğŸ¯ å¸¸ç”¨é€‰é¡¹è¯¦è§£ ğŸ§© æ­£åˆ™è¡¨è¾¾å¼å®æˆ˜ ğŸš€ å®ç”¨ç¤ºä¾‹é›†åˆ ğŸ¨ è¾“å‡ºç¾åŒ–æŠ€å·§ âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§ ğŸ”§ é«˜çº§ç”¨æ³• ğŸ› ï¸ æ•…éšœæ’é™¤ä¸è°ƒè¯• ğŸ“Š grep å®¶æ—å‘½ä»¤æ¯”è¾ƒ ğŸ“ æœ€ä½³å®è·µæ€»ç»“ ğŸŒŸ grep å‘½ä»¤ç®€ä»‹ grepï¼ˆGlobal Regular Expression Printï¼‰æ˜¯ Linux ç³»ç»Ÿä¸­æœ€å¼ºå¤§ä¸”ä½¿ç”¨æœ€å¹¿æ³›çš„æ–‡æœ¬æœç´¢å·¥å…·ä¹‹ä¸€ã€‚å®ƒçš„åå­—æ¥æºäº ed ç¼–è¾‘å™¨ä¸­çš„å‘½ä»¤ g/re/pï¼ˆglobal/regular expression/printï¼‰ï¼Œæ„ä¸ºå…¨å±€æœç´¢æ­£åˆ™è¡¨è¾¾å¼å¹¶æ‰“å°åŒ¹é…è¡Œã€‚\nğŸ¯ grep çš„é‡è¦æ€§ æ— å¤„ä¸åœ¨: é¢„è£…åœ¨å‡ ä¹æ‰€æœ‰ Linux/Unix ç³»ç»Ÿä¸­ é«˜æ•ˆå¿«é€Ÿ: èƒ½å¤Ÿå¿«é€Ÿå¤„ç†å¤§å‹æ–‡ä»¶ åŠŸèƒ½å¼ºå¤§: æ”¯æŒå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é… çµæ´»å¤šç”¨: å¯ä»¥å•ç‹¬ä½¿ç”¨æˆ–ä¸å…¶ä»–å‘½ä»¤ç»„åˆ ğŸ“Š grep çš„å†å² æœ€åˆç”± Ken Thompson åœ¨ 1974 å¹´å¼€å‘ ç°åœ¨æ˜¯ GNU é¡¹ç›®çš„ä¸€éƒ¨åˆ† æˆä¸º POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ† ğŸŒ é€‚ç”¨åœºæ™¯ æ—¥å¿—æ–‡ä»¶åˆ†æå’Œæ•…éšœæ’æŸ¥ ä»£ç æœç´¢å’Œé‡æ„ ç³»ç»Ÿç›‘æ§å’Œç®¡ç† æ•°æ®æå–å’Œå¤„ç† é…ç½®æ–‡ä»¶æ£€æŸ¥ ğŸ“‹ åŸºæœ¬è¯­æ³•ç»“æ„ 1 grep [é€‰é¡¹] \u0026#39;æœç´¢æ¨¡å¼\u0026#39; [æ–‡ä»¶å...] ğŸ§© å‘½ä»¤ç»„æˆéƒ¨åˆ† ç»„æˆéƒ¨åˆ† è¯´æ˜ ç¤ºä¾‹ é€‰é¡¹ æ§åˆ¶æœç´¢è¡Œä¸ºçš„æ ‡å¿— -i, -v, -n æœç´¢æ¨¡å¼ è¦æŸ¥æ‰¾çš„æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ 'error', '^#' æ–‡ä»¶å è¦æœç´¢çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ file.txt, *.log ğŸ’¡ å¦‚æœä¸æŒ‡å®šæ–‡ä»¶åï¼Œgrep ä¼šä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œè¿™ä½¿å…¶èƒ½å¤Ÿä¸å…¶ä»–å‘½ä»¤é€šè¿‡ç®¡é“ç»„åˆä½¿ç”¨\nğŸ”„ è¾“å…¥è¾“å‡ºå¤„ç† 1 2 3 4 5 6 7 8 9 10 11 # ä»æ–‡ä»¶è¯»å– grep \u0026#39;pattern\u0026#39; filename.txt # ä»æ ‡å‡†è¾“å…¥è¯»å– cat filename.txt | grep \u0026#39;pattern\u0026#39; # ä»å¤šä¸ªæ–‡ä»¶è¯»å– grep \u0026#39;pattern\u0026#39; file1.txt file2.txt # ä½¿ç”¨é€šé…ç¬¦ grep \u0026#39;pattern\u0026#39; *.log âš ï¸ ç‰¹æ®Šå­—ç¬¦å¤„ç† 1 2 3 4 # æœç´¢åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬ grep -F \u0026#39;file.txt\u0026#39; script.sh # æœç´¢å­—é¢é‡ \u0026#39;file.txt\u0026#39; grep \u0026#39;\\$100\u0026#39; prices.txt # æœç´¢ \u0026#39;$100\u0026#39; grep \u0026#39;pattern\\.txt\u0026#39; files.txt # æœç´¢ \u0026#39;pattern.txt\u0026#39; ğŸ¯ å¸¸ç”¨é€‰é¡¹è¯¦è§£ ğŸ”¸ åŸºç¡€æœç´¢é€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ ä½¿ç”¨åœºæ™¯ -i å¿½ç•¥å¤§å°å†™ grep -i 'error' file.log æœç´¢ä¸ç¡®å®šå¤§å°å†™çš„å•è¯ -v åå‘åŒ¹é…ï¼ˆæ’é™¤ï¼‰ grep -v 'debug' file.log è¿‡æ»¤æ‰ä¸éœ€è¦çš„è¡Œ -n æ˜¾ç¤ºè¡Œå· grep -n 'warning' file.log å®šä½åŒ¹é…è¡Œçš„ä½ç½® -c ç»Ÿè®¡åŒ¹é…è¡Œæ•° grep -c 'success' file.log ç»Ÿè®¡å‡ºç°æ¬¡æ•° -l åªæ˜¾ç¤ºæ–‡ä»¶å grep -l 'pattern' *.txt æ‰¾å‡ºåŒ…å«æ¨¡å¼çš„æ–‡ä»¶ -L æ˜¾ç¤ºä¸åŒ…å«æ¨¡å¼çš„æ–‡ä»¶å grep -L 'pattern' *.txt æ‰¾å‡ºä¸åŒ…å«æ¨¡å¼çš„æ–‡ä»¶ -h ä¸æ˜¾ç¤ºæ–‡ä»¶å grep -h 'pattern' *.txt å¤šæ–‡ä»¶æœç´¢æ—¶åªæ˜¾ç¤ºå†…å®¹ -H æ€»æ˜¯æ˜¾ç¤ºæ–‡ä»¶å grep -H 'pattern' file.txt å¼ºåˆ¶æ˜¾ç¤ºæ–‡ä»¶å ğŸ”¸ ä¸Šä¸‹æ–‡æ˜¾ç¤ºé€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ ä½¿ç”¨åœºæ™¯ -A NUM æ˜¾ç¤ºåŒ¹é…è¡Œåçš„ NUM è¡Œ grep -A 3 'error' log.txt æŸ¥çœ‹é”™è¯¯å‘ç”Ÿåçš„ä¸Šä¸‹æ–‡ -B NUM æ˜¾ç¤ºåŒ¹é…è¡Œå‰çš„ NUM è¡Œ grep -B 2 'crash' log.txt æŸ¥çœ‹é”™è¯¯å‘ç”Ÿå‰çš„ä¸Šä¸‹æ–‡ -C NUM æ˜¾ç¤ºåŒ¹é…è¡Œå‰åå„ NUM è¡Œ grep -C 5 'exception' log.txt æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯ä¸Šä¸‹æ–‡ ğŸ”¸ é«˜çº§é€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ ä½¿ç”¨åœºæ™¯ -r / -R é€’å½’æœç´¢ç›®å½• grep -r 'function' /src/ åœ¨é¡¹ç›®ä»£ç ä¸­æœç´¢ -o åªè¾“å‡ºåŒ¹é…çš„éƒ¨åˆ† grep -o '[0-9]\\+' file.txt æå–ç‰¹å®šæ•°æ® -E ä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ grep -E 'pattern1|pattern2' å¤æ‚æ¨¡å¼åŒ¹é… -F å›ºå®šå­—ç¬¦ä¸²åŒ¹é… grep -F '$100' prices.txt å¿«é€Ÿå­—é¢é‡æœç´¢ --color é«˜äº®æ˜¾ç¤ºåŒ¹é…æ–‡æœ¬ grep --color 'important' note.txt å¢å¼ºå¯è¯»æ€§ -q é™é»˜æ¨¡å¼ï¼ˆä¸è¾“å‡ºï¼‰ grep -q 'pattern' file \u0026amp;\u0026amp; echo \u0026quot;Found\u0026quot; è„šæœ¬ä¸­çš„æ¡ä»¶æ£€æŸ¥ -s æŠ‘åˆ¶é”™è¯¯æ¶ˆæ¯ grep -s 'pattern' file 2\u0026gt;/dev/null å¿½ç•¥æƒé™é”™è¯¯ ğŸ”¸ æ–‡ä»¶é€‰æ‹©é€‰é¡¹ é€‰é¡¹ è¯´æ˜ ç¤ºä¾‹ ä½¿ç”¨åœºæ™¯ --include åªæœç´¢åŒ¹é…çš„æ–‡ä»¶ grep -r --include='*.py' 'pattern' . åœ¨ç‰¹å®šç±»å‹æ–‡ä»¶ä¸­æœç´¢ --exclude æ’é™¤åŒ¹é…çš„æ–‡ä»¶ grep -r --exclude='*.log' 'pattern' . æ’é™¤ç‰¹å®šç±»å‹æ–‡ä»¶ --exclude-dir æ’é™¤ç›®å½• grep -r --exclude-dir={.git,node_modules} 'pattern' . æ’é™¤ç‰ˆæœ¬æ§åˆ¶ç›®å½• ğŸ§© æ­£åˆ™è¡¨è¾¾å¼å®æˆ˜ ğŸ”¹ åŸºç¡€æ­£åˆ™è¡¨è¾¾å¼ æ¨¡å¼ è¯´æ˜ ç¤ºä¾‹ åŒ¹é…ç¤ºä¾‹ ^ è¡Œé¦–é”šç‚¹ grep '^Start' file.txt \u0026ldquo;Start here\u0026rdquo;, \u0026ldquo;Starting\u0026rdquo; $ è¡Œå°¾é”šç‚¹ grep 'end$' file.txt \u0026ldquo;The end\u0026rdquo;, \u0026ldquo;It ends\u0026rdquo; . åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ grep 'a.c' file.txt \u0026ldquo;abc\u0026rdquo;, \u0026ldquo;a c\u0026rdquo;, \u0026ldquo;a-c\u0026rdquo; * å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–å¤šæ¬¡ grep 'ab*c' file.txt \u0026ldquo;ac\u0026rdquo;, \u0026ldquo;abc\u0026rdquo;, \u0026ldquo;abbc\u0026rdquo; [] å­—ç¬¦é›†åˆ grep '[aeiou]' file.txt ä»»ä½•åŒ…å«å…ƒéŸ³å­—æ¯çš„è¡Œ [^] æ’é™¤å­—ç¬¦é›†åˆ grep '[^0-9]' file.txt åŒ…å«éæ•°å­—å­—ç¬¦çš„è¡Œ \\ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ grep '\\.txt' file.txt \u0026ldquo;file.txt\u0026rdquo;, \u0026ldquo;document.txt\u0026rdquo; ğŸ”¹ æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä½¿ç”¨ -Eï¼‰ æ¨¡å¼ è¯´æ˜ ç¤ºä¾‹ åŒ¹é…ç¤ºä¾‹ ` ` æˆ–æ“ä½œ grep -E 'cat|dog' pets.txt + å‰ä¸€ä¸ªå­—ç¬¦1æ¬¡æˆ–å¤šæ¬¡ grep -E 'ab+c' file.txt \u0026ldquo;abc\u0026rdquo;, \u0026ldquo;abbc\u0026rdquo;, \u0026ldquo;abbbc\u0026rdquo; ? å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–1æ¬¡ grep -E 'colou?r' file.txt \u0026ldquo;color\u0026rdquo;, \u0026ldquo;colour\u0026rdquo; () åˆ†ç»„ grep -E '(abc)+' file.txt \u0026ldquo;abc\u0026rdquo;, \u0026ldquo;abcabc\u0026rdquo; {} é‡å¤æ¬¡æ•° grep -E 'a{2,4}' file.txt \u0026ldquo;aa\u0026rdquo;, \u0026ldquo;aaa\u0026rdquo;, \u0026ldquo;aaaa\u0026rdquo; ğŸ”¹ å­—ç¬¦ç±»ç®€å†™ æ¨¡å¼ è¯´æ˜ ç­‰æ•ˆäº ç¤ºä¾‹ \\d æ•°å­—å­—ç¬¦ [0-9] grep -P '\\d+' \\D éæ•°å­—å­—ç¬¦ [^0-9] grep -P '\\D+' \\w å•è¯å­—ç¬¦ [a-zA-Z0-9_] grep -P '\\w+' \\W éå•è¯å­—ç¬¦ [^a-zA-Z0-9_] grep -P '\\W+' \\s ç©ºç™½å­—ç¬¦ [ \\t\\n\\r\\f\\v] grep -P '\\s+' \\S éç©ºç™½å­—ç¬¦ [^ \\t\\n\\r\\f\\v] grep -P '\\S+' ğŸ’¡ æ³¨æ„ï¼š\\d, \\w, \\s ç­‰ç®€å†™é€šå¸¸éœ€è¦ -P é€‰é¡¹ï¼ˆPerl å…¼å®¹æ­£åˆ™è¡¨è¾¾å¼ï¼‰\nğŸ”¹ å®ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŒ¹é…IPåœ°å€ grep -E \u0026#39;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\u0026#39; file.txt # åŒ¹é…ç”µå­é‚®ä»¶åœ°å€ grep -E \u0026#39;\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b\u0026#39; file.txt # åŒ¹é…URL grep -E \u0026#39;https?://[^[:space:]]+\u0026#39; file.txt # åŒ¹é…åå…­è¿›åˆ¶é¢œè‰²ä»£ç  grep -E \u0026#39;#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})\u0026#39; file.txt # åŒ¹é…æ—¥æœŸ (YYYY-MM-DD) grep -E \u0026#39;[0-9]{4}-[0-9]{2}-[0-9]{2}\u0026#39; file.txt ğŸš€ å®ç”¨ç¤ºä¾‹é›†åˆ 1. æ—¥å¿—æ–‡ä»¶åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯å¹¶æ˜¾ç¤ºä¸Šä¸‹æ–‡ grep -C 3 -i \u0026#39;error\u0026#39; /var/log/syslog # ç»Ÿè®¡ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—æ¡ç›® grep -c \u0026#39;2023-10-15 14:\u0026#39; /var/log/application.log # æŸ¥æ‰¾åŒ…å«IPåœ°å€çš„è¡Œ grep -E \u0026#39;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\u0026#39; access.log # è·Ÿè¸ªå®æ—¶æ—¥å¿— tail -f /var/log/application.log | grep --color -i \u0026#39;error\\|exception\u0026#39; # æŸ¥æ‰¾æœ€è¿‘ä¸€å°æ—¶çš„é”™è¯¯ grep \u0026#34;$(date -d \u0026#39;1 hour ago\u0026#39; \u0026#39;+%b %d %H:\u0026#39;)\u0026#34; /var/log/syslog | grep -i error 2. ä»£ç æœç´¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åœ¨é¡¹ç›®ä¸­æœç´¢å‡½æ•°å®šä¹‰ grep -r \u0026#39;function_name\u0026#39; /path/to/project/ # æŸ¥æ‰¾TODOå’ŒFIXMEæ³¨é‡Š grep -rn \u0026#39;TODO\\|FIXME\u0026#39; /path/to/project/ # æœç´¢ç©ºè¡Œ grep -n \u0026#39;^$\u0026#39; script.sh # æŸ¥æ‰¾åŒ…å«ç‰¹å®šå¤´æ–‡ä»¶çš„C/C++æ–‡ä»¶ grep -l \u0026#39;#include \u0026lt;stdlib.h\u0026gt;\u0026#39; *.c *.cpp # æŸ¥æ‰¾Pythonå‡½æ•°å®šä¹‰ grep -n \u0026#39;def \u0026#39; *.py # æŸ¥æ‰¾JavaScriptå‡½æ•° grep -n \u0026#39;function \u0026#39; *.js # æŸ¥æ‰¾HTMLæ ‡ç­¾ grep -n \u0026#39;\u0026lt;div\\|\u0026lt;span\\|\u0026lt;p\u0026#39; *.html 3. ç³»ç»Ÿç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹ ps aux | grep \u0026#39;[n]ginx\u0026#39; # ä½¿ç”¨æ‹¬å·é¿å…åŒ¹é…grepè‡ªèº« # æ£€æŸ¥æœåŠ¡çŠ¶æ€ systemctl list-units | grep \u0026#39;running\u0026#39; # æŸ¥æ‰¾å¤§æ–‡ä»¶ find / -type f -size +100M 2\u0026gt;/dev/null | grep -v \u0026#39;/proc/\u0026#39; # ç›‘æ§ç½‘ç»œè¿æ¥ netstat -tulpn | grep \u0026#39;:80\\\u0026gt;\u0026#39; # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h | grep -E \u0026#39;^/dev/sd\u0026#39; # æŸ¥æ‰¾å†…å­˜ä½¿ç”¨æœ€å¤šçš„è¿›ç¨‹ ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head -10 | grep -v \u0026#39;PID\u0026#39; 4. æ•°æ®å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æå–ç”µå­é‚®ä»¶åœ°å€ grep -E -o \u0026#39;\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b\u0026#39; contacts.txt # æŸ¥æ‰¾æ•°å­— grep -E \u0026#39;[0-9]+\u0026#39; data.txt # æ’é™¤æ³¨é‡Šè¡Œ grep -v \u0026#39;^#\u0026#39; config.conf # æå–URL grep -o -E \u0026#39;https?://[^[:space:]]+\u0026#39; file.html # æŸ¥æ‰¾é‡å¤è¡Œ sort file.txt | uniq -d # ç»Ÿè®¡å•è¯é¢‘ç‡ grep -o -E \u0026#39;\\w+\u0026#39; file.txt | sort | uniq -c | sort -nr # æå–ç‰¹å®šåˆ—çš„æ•°æ® grep \u0026#39;pattern\u0026#39; data.csv | cut -d\u0026#39;,\u0026#39; -f1,3 5. æ–‡ä»¶ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„æ–‡ä»¶ find . -name \u0026#34;*.txt\u0026#34; -exec grep -l \u0026#39;pattern\u0026#39; {} \\; # æ‰¹é‡é‡å‘½åæ–‡ä»¶ ls | grep \u0026#39;\\.old$\u0026#39; | while read file; do mv \u0026#34;$file\u0026#34; \u0026#34;${file%.old}.new\u0026#34;; done # æ£€æŸ¥æ–‡ä»¶ç¼–ç  file -i *.txt | grep -v \u0026#39;utf-8\u0026#39; # æŸ¥æ‰¾åŒ…å«BOMå¤´çš„æ–‡ä»¶ grep -rl $\u0026#39;\\xEF\\xBB\\xBF\u0026#39; . # æŸ¥æ‰¾åŒ…å«åˆ¶è¡¨ç¬¦çš„æ–‡ä»¶ grep -rl $\u0026#39;\\t\u0026#39; . ğŸ¨ è¾“å‡ºç¾åŒ–æŠ€å·§ é¢œè‰²é«˜äº® 1 2 3 4 5 6 7 8 9 10 11 12 # æ°¸ä¹…è®¾ç½®grepé¢œè‰²é«˜äº® echo \u0026#34;alias grep=\u0026#39;grep --color=auto\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc # è‡ªå®šä¹‰é«˜äº®é¢œè‰² export GREP_COLORS=\u0026#39;ms=01;31:mc=01;31:sl=:cx=:fn=35:ln=32:bn=32:se=36\u0026#39; # ä½¿ç”¨alwaysé€‰é¡¹ä¿æŒé¢œè‰²è¾“å‡ºåˆ°ç®¡é“ grep --color=always \u0026#39;pattern\u0026#39; file.txt | less -R # ä¸´æ—¶ç¦ç”¨é¢œè‰² grep --color=never \u0026#39;pattern\u0026#39; file.txt æ ¼å¼åŒ–è¾“å‡º 1 2 3 4 5 6 7 8 9 10 11 # æ˜¾ç¤ºæ–‡ä»¶åå’Œè¡Œå· grep -Hn \u0026#39;pattern\u0026#39; *.txt # ä½¿ç”¨åˆ†éš”ç¬¦æ ¼å¼åŒ–è¾“å‡º grep -n \u0026#39;pattern\u0026#39; file.txt | awk -F: \u0026#39;{printf \u0026#34;File: %s, Line: %d, Content: %s\\n\u0026#34;, $1, $2, $3}\u0026#39; # åˆ›å»ºHTMLæ ¼å¼è¾“å‡º grep -n --color=always \u0026#39;pattern\u0026#39; file.txt | aha --black \u0026gt; output.html # ç”ŸæˆJSONæ ¼å¼è¾“å‡º grep -n \u0026#39;pattern\u0026#39; file.txt | jq -R -n \u0026#39;[inputs | split(\u0026#34;:\u0026#34;) | {file: .[0], line: .[1], content: .[2:] | join(\u0026#34;:\u0026#34;)}]\u0026#39; è¾“å‡ºé‡å®šå‘ 1 2 3 4 5 6 7 8 9 10 11 12 # ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ grep \u0026#39;pattern\u0026#39; file.txt \u0026gt; results.txt # è¿½åŠ åˆ°ç°æœ‰æ–‡ä»¶ grep \u0026#39;pattern\u0026#39; file.txt \u0026gt;\u0026gt; results.txt # åŒæ—¶æŸ¥çœ‹ç»“æœå¹¶ä¿å­˜åˆ°æ–‡ä»¶ grep \u0026#39;pattern\u0026#39; file.txt | tee results.txt # åˆ†ç¦»åŒ¹é…å’ŒéåŒ¹é…å†…å®¹ grep \u0026#39;pattern\u0026#39; file.txt \u0026gt; matches.txt grep -v \u0026#39;pattern\u0026#39; file.txt \u0026gt; non-matches.txt âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. æé«˜æœç´¢é€Ÿåº¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨å›ºå®šå­—ç¬¦ä¸²æœç´¢ï¼ˆæ›´å¿«ï¼‰ grep -F \u0026#39;exact_string\u0026#39; large_file.txt # é™åˆ¶æœç´¢æ·±åº¦ grep -r --include=\u0026#39;*.log\u0026#39; \u0026#39;pattern\u0026#39; /var/log/ # æ’é™¤ä¸å¿…è¦çš„ç›®å½• grep -r --exclude-dir={.git,node_modules,.svn} \u0026#39;pattern\u0026#39; . # ä½¿ç”¨LC_ALL=CåŠ é€ŸASCIIæœç´¢ LC_ALL=C grep \u0026#39;pattern\u0026#39; huge_file.txt # æå‰è¿‡æ»¤å†…å®¹ cat large_file.txt | head -10000 | grep \u0026#39;pattern\u0026#39; # åªæœç´¢å‰10000è¡Œ 2. å¤„ç†å¤§æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä½¿ç”¨splitåˆ†å‰²å¤§æ–‡ä»¶ split -l 1000000 large_file.txt chunk_ for chunk in chunk_*; do grep \u0026#39;pattern\u0026#39; \u0026#34;$chunk\u0026#34; \u0026gt; \u0026#34;results_${chunk}\u0026#34; done # ä½¿ç”¨parallelå¹¶è¡Œå¤„ç† find . -name \u0026#39;*.log\u0026#39; | parallel -j 4 grep \u0026#39;pattern\u0026#39; {} \u0026gt; results.txt # ä½¿ç”¨mgrepï¼ˆå¤šçº¿ç¨‹grepï¼‰ # éœ€è¦å…ˆå®‰è£…: sudo apt install mgrep mgrep -n \u0026#39;pattern\u0026#39; large_file.txt # ä½¿ç”¨ripgrepï¼ˆæ›´å¿«çš„æ›¿ä»£å“ï¼‰ # éœ€è¦å…ˆå®‰è£…: sudo apt install ripgrep rg \u0026#39;pattern\u0026#39; large_file.txt 3. å†…å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨--mmapé€‰é¡¹ï¼ˆå¦‚æœæ”¯æŒï¼‰ grep --mmap \u0026#39;pattern\u0026#39; large_file.txt # é™åˆ¶å†…å­˜ä½¿ç”¨ grep -r \u0026#39;pattern\u0026#39; /path/ | head -1000 # åªæ˜¾ç¤ºå‰1000ä¸ªç»“æœ # ä½¿ç”¨ç¼“å†²å‡å°‘I/Oæ“ä½œ stdbuf -o0 grep \u0026#39;pattern\u0026#39; large_file.txt # æ— ç¼“å†² stdbuf -o100 grep \u0026#39;pattern\u0026#39; large_file.txt # 100å­—èŠ‚ç¼“å†² ğŸ”§ é«˜çº§ç”¨æ³• å¤šæ¨¡å¼æœç´¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŒæ—¶æœç´¢å¤šä¸ªæ¨¡å¼ grep -e \u0026#39;pattern1\u0026#39; -e \u0026#39;pattern2\u0026#39; file.txt # ä»æ–‡ä»¶è¯»å–æ¨¡å¼ grep -f patterns.txt file.txt # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ–‡ä»¶ grep -E -f regex_patterns.txt file.txt # æ’é™¤å¤šä¸ªæ¨¡å¼ grep -v -e \u0026#39;pattern1\u0026#39; -e \u0026#39;pattern2\u0026#39; file.txt # ç»„åˆå¤šä¸ªæ¡ä»¶ grep \u0026#39;pattern1\u0026#39; file.txt | grep \u0026#39;pattern2\u0026#39; # å¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¨¡å¼ ç»“åˆå…¶ä»–å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä¸findç»“åˆ find . -name \u0026#34;*.py\u0026#34; -exec grep -l \u0026#39;import\u0026#39; {} \\; # ä¸awkç»“åˆ grep \u0026#39;error\u0026#39; log.txt | awk \u0026#39;{print $1, $2}\u0026#39; # ä¸sortå’Œuniqç»“åˆ grep -o \u0026#39;[0-9]\\+\u0026#39; data.txt | sort | uniq -c # ä¸sedç»“åˆ grep \u0026#39;pattern\u0026#39; file.txt | sed \u0026#39;s/foo/bar/g\u0026#39; # ä¸xargsç»“åˆ find . -name \u0026#34;*.txt\u0026#34; | xargs grep -l \u0026#39;pattern\u0026#39; # ä¸columnç»“åˆç¾åŒ–è¾“å‡º grep -n \u0026#39;pattern\u0026#39; file.txt | column -t -s: è„šæœ¬ä¸­çš„grep 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash # æ£€æŸ¥æ¨¡å¼æ˜¯å¦å­˜åœ¨ if grep -q \u0026#39;pattern\u0026#39; file.txt; then echo \u0026#34;Pattern found\u0026#34; else echo \u0026#34;Pattern not found\u0026#34; fi # è·å–åŒ¹é…è¡Œæ•° count=$(grep -c \u0026#39;pattern\u0026#39; file.txt) echo \u0026#34;Found $count matches\u0026#34; # éå†åŒ¹é…ç»“æœ while IFS= read -r line; do echo \u0026#34;Processing: $line\u0026#34; done \u0026lt; \u0026lt;(grep \u0026#39;pattern\u0026#39; file.txt) # ä½¿ç”¨grepé€€å‡ºçŠ¶æ€ç  grep \u0026#39;pattern\u0026#39; file.txt case $? in 0) echo \u0026#34;Match found\u0026#34; ;; 1) echo \u0026#34;No match found\u0026#34; ;; 2) echo \u0026#34;Error occurred\u0026#34; ;; esac é«˜çº§æ­£åˆ™æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å‰åæŸ¥æ‰¾ï¼ˆéœ€è¦-Pé€‰é¡¹ï¼‰ grep -P \u0026#39;pattern(?= ahead)\u0026#39; file.txt # æ­£å‘è‚¯å®šæŸ¥æ‰¾ grep -P \u0026#39;pattern(?! ahead)\u0026#39; file.txt # æ­£å‘å¦å®šæŸ¥æ‰¾ grep -P \u0026#39;(?\u0026lt;=behind) pattern\u0026#39; file.txt # åå‘è‚¯å®šæŸ¥æ‰¾ grep -P \u0026#39;(?\u0026lt;!behind) pattern\u0026#39; file.txt # åå‘å¦å®šæŸ¥æ‰¾ # éè´ªå©ªåŒ¹é… grep -P \u0026#39;a.*?b\u0026#39; file.txt # åŒ¹é…æœ€çŸ­çš„a...båºåˆ— # å›æº¯å¼•ç”¨ grep -P \u0026#39;(abc)\\1\u0026#39; file.txt # åŒ¹é…abcabc # æ¡ä»¶è¡¨è¾¾å¼ grep -P \u0026#39;(a)?b(?(1)c|d)\u0026#39; file.txt # å¦‚æœåŒ¹é…äº†aåˆ™åŒ¹é…bcï¼Œå¦åˆ™åŒ¹é…bd ğŸ› ï¸ æ•…éšœæ’é™¤ä¸è°ƒè¯• å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æ£€æŸ¥ä¸ºä»€ä¹ˆæ²¡æœ‰åŒ¹é… grep --debug \u0026#39;pattern\u0026#39; file.txt # æ˜¾ç¤ºä¸åŒ¹é…çš„è¡Œï¼ˆè°ƒè¯•æ­£åˆ™è¡¨è¾¾å¼ï¼‰ grep -v \u0026#39;pattern\u0026#39; file.txt | head # æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼ echo \u0026#34;test string\u0026#34; | grep \u0026#39;pattern\u0026#39; # æ£€æŸ¥æ–‡ä»¶ç¼–ç é—®é¢˜ file -i file.txt # æŸ¥çœ‹æ–‡ä»¶ç¼–ç  iconv -f ISO-8859-1 -t UTF-8 file.txt | grep \u0026#39;pattern\u0026#39; # è½¬æ¢ç¼–ç  # å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ–‡æœ¬ strings binary_file | grep \u0026#39;pattern\u0026#39; # æ£€æŸ¥è¡Œå°¾ç¬¦é—®é¢˜ cat -v file.txt | grep \u0026#39;pattern\u0026#39; # æ˜¾ç¤ºéæ‰“å°å­—ç¬¦ ç‰¹æ®Šå­—ç¬¦å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 # æœç´¢åŒ…å«ç‚¹å·çš„å†…å®¹ grep \u0026#39;\\.txt\u0026#39; files.txt # æœç´¢ \u0026#34;.txt\u0026#34; grep -F \u0026#39;.txt\u0026#39; files.txt # åŒä¸Šï¼Œä½¿ç”¨å›ºå®šå­—ç¬¦ä¸² # æœç´¢åŒ…å«æ˜Ÿå·çš„å†…å®¹ grep \u0026#39;\\*\u0026#39; files.txt # æœç´¢ \u0026#34;*\u0026#34; grep -F \u0026#39;*\u0026#39; files.txt # åŒä¸Šï¼Œä½¿ç”¨å›ºå®šå­—ç¬¦ä¸² # æœç´¢åŒ…å«æ–¹æ‹¬å·çš„å†…å®¹ grep \u0026#39;\\[example\\]\u0026#39; files.txt # æœç´¢ \u0026#34;[example]\u0026#34; # æœç´¢åŒ…å«åæ–œæ çš„å†…å®¹ grep \u0026#39;\\\\\\\\\u0026#39; files.txt # æœç´¢ \u0026#34;\\\\\u0026#34; æ€§èƒ½é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 # æµ‹é‡grepæ‰§è¡Œæ—¶é—´ time grep \u0026#39;pattern\u0026#39; large_file.txt # æ£€æŸ¥æ–‡ä»¶å¤§å° ls -lh large_file.txt # æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨ /usr/bin/time -v grep \u0026#39;pattern\u0026#39; large_file.txt # ä½¿ç”¨straceè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ strace -c grep \u0026#39;pattern\u0026#39; file.txt # ç»Ÿè®¡ç³»ç»Ÿè°ƒç”¨ strace -T grep \u0026#39;pattern\u0026#39; file.txt # æ˜¾ç¤ºè°ƒç”¨è€—æ—¶ ğŸ“Š grep å®¶æ—å‘½ä»¤æ¯”è¾ƒ å‘½ä»¤ è¯´æ˜ ä¼˜åŠ¿ åŠ£åŠ¿ ä½¿ç”¨åœºæ™¯ grep æ ‡å‡†grep å¹¿æ³›å¯ç”¨ï¼ŒåŠŸèƒ½å…¨é¢ æ€§èƒ½ä¸€èˆ¬ åŸºæœ¬æ–‡æœ¬æœç´¢ egrep æ‰©å±•grep æ”¯æŒæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ å·²é€æ¸è¢« grep -E å–ä»£ å¤æ‚æ¨¡å¼åŒ¹é… fgrep å›ºå®šå­—ç¬¦ä¸²grep å¿«é€Ÿå­—é¢é‡æœç´¢ ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ å¿«é€Ÿå›ºå®šå­—ç¬¦ä¸²æœç´¢ rgrep é€’å½’grep ç®€åŒ–é€’å½’æœç´¢è¯­æ³• å¹¶éæ‰€æœ‰ç³»ç»Ÿéƒ½å¯ç”¨ ç›®å½•æ ‘æœç´¢ pgrep è¿›ç¨‹grep ä¸“é—¨ç”¨äºè¿›ç¨‹æœç´¢ åŠŸèƒ½æœ‰é™ è¿›ç¨‹ç®¡ç† ack ä»£ç æœç´¢å·¥å…· ä¸“ä¸ºä»£ç æœç´¢ä¼˜åŒ– éœ€è¦é¢å¤–å®‰è£… ç¨‹åºå‘˜ä»£ç æœç´¢ ag (The Silver Searcher) æ›´å¿«çš„ack é€Ÿåº¦æå¿« éœ€è¦é¢å¤–å®‰è£… å¤§å‹ä»£ç åº“æœç´¢ rg (ripgrep) ç°ä»£grepæ›¿ä»£å“ é€Ÿåº¦æœ€å¿«ï¼ŒåŠŸèƒ½ä¸°å¯Œ éœ€è¦é¢å¤–å®‰è£… é«˜æ€§èƒ½æœç´¢ å®‰è£…æ›¿ä»£å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰è£…ripgrep (Ubuntu/Debian) sudo apt install ripgrep # å®‰è£…The Silver Searcher (Ubuntu/Debian) sudo apt install silversearcher-ag # å®‰è£…ack (Ubuntu/Debian) sudo apt install ack-grep # ä½¿ç”¨ripgrep rg \u0026#39;pattern\u0026#39; /path/to/search # ä½¿ç”¨ag ag \u0026#39;pattern\u0026#39; /path/to/search # ä½¿ç”¨ack ack \u0026#39;pattern\u0026#39; /path/to/search ğŸ“ æœ€ä½³å®è·µæ€»ç»“ 1. æ˜ç¡®æœç´¢ç›®æ ‡ ç¡®å®šè¦æŸ¥æ‰¾çš„å†…å®¹å’ŒèŒƒå›´ é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼ˆgrepã€ackã€rgç­‰ï¼‰ é¢„ä¼°ç»“æœæ•°é‡å’Œæ€§èƒ½éœ€æ±‚ 2. é€‰æ‹©åˆé€‚çš„é€‰é¡¹ ä½¿ç”¨ -i è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æœç´¢ ä½¿ç”¨ -n æ˜¾ç¤ºè¡Œå·ä»¥ä¾¿å®šä½ ä½¿ç”¨ -r è¿›è¡Œé€’å½’æœç´¢ ä½¿ç”¨ --include å’Œ --exclude è¿‡æ»¤æ–‡ä»¶ 3. æŒæ¡æ­£åˆ™è¡¨è¾¾å¼ å­¦ä¹ åŸºç¡€æ­£åˆ™è¡¨è¾¾å¼è¯­æ³• ä½¿ç”¨ -E é€‰é¡¹è¿›è¡Œæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… æµ‹è¯•å¤æ‚æ¨¡å¼å‰å…ˆè¿›è¡Œç®€å•æµ‹è¯• 4. è€ƒè™‘æ€§èƒ½å› ç´  å¯¹å¤§æ–‡ä»¶ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–æŠ€å·§ é¿å…ä¸å¿…è¦çš„é€’å½’æœç´¢ ä½¿ç”¨æ›´å¿«çš„å·¥å…·ï¼ˆå¦‚ripgrepï¼‰å¤„ç†å¤§å‹ä»£ç åº“ 5. ç»“åˆå…¶ä»–å·¥å…· ä¸ findã€awkã€sed ç­‰å‘½ä»¤é…åˆä½¿ç”¨ ä½¿ç”¨ç®¡é“ç»„åˆå¤šä¸ªå‘½ä»¤ åœ¨è„šæœ¬ä¸­åˆç†ä½¿ç”¨grepçš„é€€å‡ºçŠ¶æ€ç  6. è¾“å‡ºå¤„ç† ä½¿ç”¨ --color é«˜äº®æ˜¾ç¤ºç»“æœ åˆç†é‡å®šå‘è¾“å‡ºåˆ°æ–‡ä»¶æˆ–å…¶ä»–å‘½ä»¤ æ ¼å¼åŒ–è¾“å‡ºä»¥ä¾¿é˜…è¯»å’Œå¤„ç† 7. é”™è¯¯å¤„ç† æ£€æŸ¥grepçš„é€€å‡ºçŠ¶æ€ç  å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œç¼–ç é—®é¢˜ ä½¿ç”¨ -s é€‰é¡¹æŠ‘åˆ¶ä¸å¿…è¦çš„é”™è¯¯æ¶ˆæ¯ 8. æŒç»­å­¦ä¹  å…³æ³¨æ–°å·¥å…·å’ŒæŠ€æœ¯ï¼ˆå¦‚ripgrepï¼‰ å­¦ä¹ æ›´é«˜çº§çš„æ­£åˆ™è¡¨è¾¾å¼æŠ€å·§ å‚ä¸ç¤¾åŒºè®¨è®ºå’Œåˆ†äº«ç»éªŒ é€šè¿‡æŒæ¡è¿™äº› grep å‘½ä»¤çš„æŠ€å·§å’Œæœ€ä½³å®è·µï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨ Linux ç³»ç»Ÿä¸­é«˜æ•ˆåœ°è¿›è¡Œæ–‡æœ¬æœç´¢å’Œå¤„ç†ï¼Œå¤§å¹…æå‡å·¥ä½œæ•ˆç‡ï¼ğŸš€\nğŸ’¡ è®°ä½ï¼šgrep åªæ˜¯æ–‡æœ¬å¤„ç†å·¥å…·é“¾ä¸­çš„ä¸€ç¯ï¼Œç»“åˆå…¶ä»–å·¥å…·å¦‚ awkã€sedã€sortã€uniq ç­‰ï¼Œæ‚¨å¯ä»¥æ„å»ºå¼ºå¤§çš„æ–‡æœ¬å¤„ç†æµæ°´çº¿ã€‚\n","date":"2025-08-26T20:32:51+08:00","image":"https://file.meimolihan.eu.org/img/linux-grep-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b20fcbc9/","title":"Linux æ–‡æœ¬æœç´¢ grep å‘½ä»¤è¯¦è§£ ğŸ”"},{"content":"Linux æ–‡ä»¶ä¼ è¾“ SCP å‘½ä»¤è¯¦è§£ ğŸ“ ğŸ”’ åŸºäº SSH çš„å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼Œè½»æ¾åœ¨æœ¬åœ°å’Œè¿œç¨‹ç³»ç»Ÿé—´å®‰å…¨ä¼ è¾“æ–‡ä»¶\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸš€ SCP ç®€ä»‹ âš™ï¸ åŸºæœ¬è¯­æ³•ä¸é€‰é¡¹ ğŸ“¤ æœ¬åœ°åˆ°è¿œç¨‹ä¼ è¾“ ğŸ“¥ è¿œç¨‹åˆ°æœ¬åœ°ä¼ è¾“ ğŸ”€ æœåŠ¡å™¨é—´ä¼ è¾“ ğŸ¯ é«˜çº§ç”¨æ³•æŠ€å·§ âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ”„ æ›¿ä»£æ–¹æ¡ˆæ¯”è¾ƒ ğŸ› æ•…éšœæ’é™¤ ğŸ”’ å®‰å…¨å»ºè®® ğŸ“Š æ€§èƒ½æµ‹è¯• ğŸš€ SCP ç®€ä»‹ SCPï¼ˆSecure Copy Protocolï¼‰æ˜¯åŸºäº SSH çš„å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼Œç”¨äºåœ¨æœ¬åœ°å’Œè¿œç¨‹ç³»ç»Ÿä¹‹é—´å®‰å…¨åœ°å¤åˆ¶æ–‡ä»¶ã€‚å®ƒåˆ©ç”¨ SSH è¿›è¡Œæ•°æ®åŠ å¯†å’Œèº«ä»½éªŒè¯ï¼Œç¡®ä¿ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚\nä¸»è¦ç‰¹ç‚¹ï¼š\nğŸ”’ åŠ å¯†ä¼ è¾“ï¼šæ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ SSH åŠ å¯† ğŸ” èº«ä»½éªŒè¯ï¼šæ”¯æŒå¯†ç å’Œå¯†é’¥è®¤è¯ ğŸ“Š ç®€å•æ˜“ç”¨ï¼šå‘½ä»¤è¡Œç•Œé¢ï¼Œå­¦ä¹ æˆæœ¬ä½ ğŸ”„ è·¨å¹³å°ï¼šæ”¯æŒæ‰€æœ‰ç±» Unix ç³»ç»Ÿå’Œ Windowsï¼ˆé€šè¿‡å®¢æˆ·ç«¯ï¼‰ é€‚ç”¨åœºæ™¯ï¼š\nå¿«é€Ÿå®‰å…¨åœ°ä¼ è¾“å•ä¸ªæˆ–å°‘é‡æ–‡ä»¶ ç®€å•çš„è¿œç¨‹æ–‡ä»¶å¤‡ä»½ åœ¨å¯ä¿¡ç½‘ç»œç¯å¢ƒä¸­çš„æ–‡ä»¶äº¤æ¢ âš™ï¸ åŸºæœ¬è¯­æ³•ä¸é€‰é¡¹ åŸºæœ¬è¯­æ³•æ ¼å¼ 1 scp [é€‰é¡¹] æºæ–‡ä»¶ ç›®æ ‡è·¯å¾„ å¸¸ç”¨é€‰é¡¹è¡¨ é€‰é¡¹ æè¿° ç¤ºä¾‹ -P æŒ‡å®šè¿œç¨‹ä¸»æœºçš„ SSH ç«¯å£ï¼ˆé»˜è®¤ä¸º 22ï¼‰ scp -P 2222 file.txt user@host:/path/ -r é€’å½’å¤åˆ¶æ•´ä¸ªç›®å½• scp -r directory/ user@host:/path/ -C å¯ç”¨å‹ç¼©ä¼ è¾“ scp -C largefile.iso user@host:/path/ -i æŒ‡å®šèº«ä»½æ–‡ä»¶ï¼ˆç§é’¥ï¼‰ scp -i ~/.ssh/key.pem file.txt user@host:/path/ -v æ˜¾ç¤ºè¯¦ç»†ä¼ è¾“ä¿¡æ¯ scp -v file.txt user@host:/path/ -p ä¿ç•™æ–‡ä»¶åŸå±æ€§ï¼ˆæ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰ scp -p file.txt user@host:/path/ -q å®‰é™æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºä¼ è¾“è¿›åº¦ scp -q file.txt user@host:/path/ -l é™åˆ¶å¸¦å®½ä½¿ç”¨ï¼ˆå•ä½ï¼šKbit/sï¼‰ scp -l 1000 file.txt user@host:/path/ -c æŒ‡å®šåŠ å¯†ç®—æ³• scp -c aes128-ctr file.txt user@host:/path/ -o ä¼ é€’ SSH é…ç½®é€‰é¡¹ scp -o \u0026quot;ServerAliveInterval=60\u0026quot; file.txt user@host:/path/ ğŸ“¤ æœ¬åœ°æ–‡ä»¶ â†’ è¿œç¨‹æœåŠ¡å™¨ åŸºæœ¬ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 # ä¼ è¾“å•ä¸ªæ–‡ä»¶ scp local_file.txt username@remote_host:/remote/directory/ # æŒ‡å®šç«¯å£ï¼ˆå¦‚æœSSHæœåŠ¡ä¸åœ¨é»˜è®¤ç«¯å£ï¼‰ scp -P 2222 local_file.txt username@remote_host:/remote/directory/ # ä¿æŒæ–‡ä»¶å±æ€§ï¼ˆæ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰ scp -p local_file.txt username@remote_host:/remote/directory/ # ä½¿ç”¨å¯†é’¥è®¤è¯ scp -i ~/.ssh/private_key.pem local_file.txt username@remote_host:/remote/directory/ æ‰¹é‡ä¼ è¾“ç¤ºä¾‹ 1 2 3 4 5 6 7 8 # ä¼ è¾“å¤šä¸ªæ–‡ä»¶ scp file1.txt file2.txt file3.txt username@remote_host:/remote/directory/ # ä½¿ç”¨é€šé…ç¬¦ scp *.txt username@remote_host:/remote/directory/ # ä¼ è¾“ç›®å½•åŠå…¶å†…å®¹ scp -r my_directory/ username@remote_host:/remote/path/ é«˜çº§ç”¨æ³• 1 2 3 4 5 6 7 8 # é™åˆ¶å¸¦å®½ï¼ˆ1MB/s = 8000 Kbit/sï¼‰ scp -l 8000 large_file.iso username@remote_host:/remote/path/ # å¯ç”¨å‹ç¼©ï¼ˆå¯¹æ–‡æœ¬æ–‡ä»¶æ•ˆæœæ˜æ˜¾ï¼‰ scp -C source_code.tar.gz username@remote_host:/remote/path/ # ä½¿ç”¨ç‰¹å®šåŠ å¯†ç®—æ³• scp -c aes128-gcm@openssh.com sensitive_file.txt username@remote_host:/remote/path/ ğŸ“¥ è¿œç¨‹æœåŠ¡å™¨ â†’ æœ¬åœ° åŸºæœ¬ä¸‹è½½æ“ä½œ 1 2 3 4 5 6 7 8 # ä¸‹è½½å•ä¸ªæ–‡ä»¶ scp username@remote_host:/remote/path/file.txt /local/directory/ # ä¸‹è½½åˆ°å½“å‰ç›®å½• scp username@remote_host:/remote/path/file.txt . # ä¸‹è½½æ•´ä¸ªç›®å½• scp -r username@remote_host:/remote/directory/ /local/path/ é«˜çº§ä¸‹è½½æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨å¯†é’¥è®¤è¯ä¸‹è½½ scp -i ~/.ssh/private_key.pem username@remote_host:/remote/file.txt ./ # ä¿æŒæ–‡ä»¶å±æ€§ scp -p username@remote_host:/remote/file.txt /local/path/ # é™åˆ¶å¸¦å®½ä¸‹è½½ scp -l 5000 username@remote_host:/remote/large_file.iso ./ # ä»éæ ‡å‡†ç«¯å£ä¸‹è½½ scp -P 2222 username@remote_host:/remote/file.txt ./ æ‰¹é‡ä¸‹è½½ 1 2 3 4 5 6 7 8 # ä¸‹è½½å¤šä¸ªç‰¹å®šæ–‡ä»¶ scp username@remote_host:\u0026#39;/path/file1.txt /path/file2.txt\u0026#39; /local/dir/ # ä½¿ç”¨é€šé…ç¬¦ä¸‹è½½ scp username@remote_host:\u0026#39;/path/*.log\u0026#39; /local/logs/ # ä¸‹è½½å¹¶é‡å‘½å scp username@remote_host:/remote/path/file.txt /local/path/new_name.txt ğŸ”€ æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ é€šè¿‡æœ¬åœ°ä¸­è½¬ 1 2 3 4 5 6 # ä»æœåŠ¡å™¨Aä¸‹è½½å†åˆ°æœåŠ¡å™¨Bä¸Šä¼  scp user1@host1:/path/to/file.txt . scp file.txt user2@host2:/path/to/destination/ # ä½¿ç”¨ç®¡é“ä¸€æ­¥å®Œæˆ scp -3 user1@host1:/path/file.txt user2@host2:/path/ ç›´æ¥æœåŠ¡å™¨é—´ä¼ è¾“ 1 2 3 4 5 6 7 # éœ€è¦é…ç½®SSHå¯†é’¥ä¿¡ä»» # é¦–å…ˆåœ¨host1ä¸Šç”Ÿæˆå¯†é’¥å¹¶å¤åˆ¶åˆ°host2 ssh-keygen -t rsa ssh-copy-id user2@host2 # ç„¶ååœ¨host1ä¸Šç›´æ¥ä¼ è¾“åˆ°host2 scp /local/path/file.txt user2@host2:/remote/path/ é«˜çº§è·¨æœåŠ¡å™¨æ“ä½œ 1 2 3 4 5 # ä½¿ç”¨tarå‹ç¼©ä¼ è¾“ç›®å½• ssh user1@host1 \u0026#34;tar czf - /path/to/source/\u0026#34; | ssh user2@host2 \u0026#34;tar xzf - -C /path/to/dest/\u0026#34; # æ’é™¤æŸäº›æ–‡ä»¶ä¼ è¾“ ssh user1@host1 \u0026#34;tar czf - --exclude=\u0026#39;*.tmp\u0026#39; /path/to/source/\u0026#34; | ssh user2@host2 \u0026#34;tar xzf - -C /path/to/dest/\u0026#34; ğŸ¯ é«˜çº§ç”¨æ³•æŠ€å·§ 1. æ‰¹é‡æ–‡ä»¶ä¼ è¾“ 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨å¾ªç¯ä¼ è¾“å¤šä¸ªæ–‡ä»¶ for file in *.txt; do scp \u0026#34;$file\u0026#34; username@remote_host:/remote/directory/ done # ç»“åˆfindå‘½ä»¤ä¼ è¾“ç‰¹å®šæ–‡ä»¶ find . -name \u0026#34;*.log\u0026#34; -exec scp {} username@remote_host:/remote/logs/ \\; # ä½¿ç”¨rsyncæ¨¡å¼ï¼ˆéœ€è¦é¢„å…ˆå®‰è£…rsyncï¼‰ rsync -avz -e ssh local/ username@remote_host:/remote/path/ 2. è¿›åº¦æ˜¾ç¤ºå’Œç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # ä½¿ç”¨pvå·¥å…·æ˜¾ç¤ºè¿›åº¦ï¼ˆéœ€è¦å®‰è£…pvï¼‰ tar cf - directory/ | pv | ssh username@remote_host \u0026#34;tar xf - -C /path/\u0026#34; # ä½¿ç”¨rsyncä»£æ›¿scpæ˜¾ç¤ºè¿›åº¦ rsync -avz --progress local/ username@remote_host:/remote/path/ # è‡ªå®šä¹‰è¿›åº¦æ˜¾ç¤ºå‡½æ•° scp_with_progress() { local src=\u0026#34;$1\u0026#34; local dst=\u0026#34;$2\u0026#34; local size=$(du -sb \u0026#34;$src\u0026#34; | cut -f1) scp -q \u0026#34;$src\u0026#34; \u0026#34;$dst\u0026#34; \u0026amp; local pid=$! while kill -0 \u0026#34;$pid\u0026#34; 2\u0026gt;/dev/null; do local current=$(ssh username@remote_host \u0026#34;du -sb /remote/path/$(basename \u0026#34;$src\u0026#34;) 2\u0026gt;/dev/null\u0026#34; | cut -f1) local percent=$((current * 100 / size)) printf \u0026#34;Progress: %d%%\\r\u0026#34; \u0026#34;$percent\u0026#34; sleep 1 done echo \u0026#34;Transfer complete!\u0026#34; } 3. æ–­ç‚¹ç»­ä¼ æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨rsyncå®ç°æ–­ç‚¹ç»­ä¼  rsync -avz --partial --progress largefile.iso username@remote_host:/path/ # åˆ†å‰²å¤§æ–‡ä»¶ä¼ è¾“ split -b 100M largefile.iso largefile.part. scp largefile.part.* username@remote_host:/path/ ssh username@remote_host \u0026#34;cat /path/largefile.part.* \u0026gt; /path/largefile.iso \u0026amp;\u0026amp; rm /path/largefile.part.*\u0026#34; # æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§ ssh username@remote_host \u0026#34;md5sum /path/largefile.iso\u0026#34; md5sum largefile.iso âš¡ æ€§èƒ½ä¼˜åŒ– 1. åŠ å¯†ç®—æ³•é€‰æ‹© 1 2 3 4 5 6 7 8 # æµ‹è¯•ä¸åŒåŠ å¯†ç®—æ³•çš„é€Ÿåº¦ for cipher in aes128-ctr aes192-ctr aes256-ctr aes128-gcm@openssh.com aes256-gcm@openssh.com; do echo \u0026#34;Testing $cipher\u0026#34; time scp -c \u0026#34;$cipher\u0026#34; largefile.iso username@remote_host:/dev/null done # ä½¿ç”¨æœ€å¿«é€Ÿçš„åŠ å¯†ç®—æ³• scp -c aes128-gcm@openssh.com large_file.iso username@remote_host:/path/ 2. å‹ç¼©ä¼ è¾“ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # å¯ç”¨å‹ç¼©ï¼ˆå¯¹æ–‡æœ¬ã€ä»£ç ç­‰å¯å‹ç¼©æ–‡ä»¶æœ‰æ•ˆï¼‰ scp -C source_code.tar.gz username@remote_host:/path/ # è‡ªå®šä¹‰å‹ç¼©çº§åˆ«ï¼ˆç»“åˆtarä½¿ç”¨ï¼‰ tar -I \u0026#39;gzip -9\u0026#39; -cf - directory/ | ssh username@remote_host \u0026#34;tar xf - -C /path/\u0026#34; # æ ¹æ®æ–‡ä»¶ç±»å‹å†³å®šæ˜¯å¦å‹ç¼© if file \u0026#34;$1\u0026#34; | grep -q \u0026#34;text\u0026#34;; then scp -C \u0026#34;$1\u0026#34; username@remote_host:/path/ else scp \u0026#34;$1\u0026#34; username@remote_host:/path/ fi 3. å¹¶è¡Œä¼ è¾“åŠ é€Ÿ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨å¤šä¸ªscpä¼šè¯å¹¶è¡Œä¼ è¾“ for file in *.iso; do scp \u0026#34;$file\u0026#34; username@remote_host:/path/ \u0026amp; done wait # ä½¿ç”¨xargsæ§åˆ¶å¹¶è¡Œåº¦ find . -name \u0026#34;*.log\u0026#34; -print0 | xargs -0 -P 4 -I {} scp {} username@remote_host:/path/ # ä½¿ç”¨parallelå·¥å…·ï¼ˆéœ€è¦å®‰è£…ï¼‰ parallel -j 4 scp {} username@remote_host:/path/ ::: *.iso 4. è¿æ¥å¤ç”¨ 1 2 3 4 5 6 7 8 9 # é…ç½®SSHè¿æ¥å¤ç”¨ï¼ˆæ·»åŠ åˆ°~/.ssh/configï¼‰ Host * ControlMaster auto ControlPath ~/.ssh/control:%h:%p:%r ControlPersist 1h # ç„¶åSCPä¼šå¤ç”¨SSHè¿æ¥ï¼ŒåŠ å¿«åç»­ä¼ è¾“ scp file1.txt username@remote_host:/path/ # å»ºç«‹è¿æ¥ scp file2.txt username@remote_host:/path/ # å¤ç”¨è¿æ¥ ğŸ”„ æ›¿ä»£æ–¹æ¡ˆæ¯”è¾ƒ SCP ä¸å…¶å®ƒå·¥å…·å¯¹æ¯” å·¥å…· ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ SCP ç®€å•æ˜“ç”¨ï¼Œæ‰€æœ‰SSHæœåŠ¡å™¨éƒ½æ”¯æŒ æ— æ–­ç‚¹ç»­ä¼ ï¼Œæ€§èƒ½è¾ƒå·® å°æ–‡ä»¶å¿«é€Ÿä¼ è¾“ Rsync æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¢é‡ä¼ è¾“ï¼Œæ€§èƒ½ä¼˜åŒ– é…ç½®ç¨å¤æ‚ï¼Œéœ€ä¸¤ç«¯å®‰è£… å¤§æ–‡ä»¶ã€å®šæœŸåŒæ­¥ SFTP äº¤äº’å¼æ“ä½œï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒæ–‡ä»¶ç®¡ç† é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸é€‚åˆè„šæœ¬åŒ– äº¤äº’å¼æ–‡ä»¶ç®¡ç† FTP/FTPS å¹¿æ³›æ”¯æŒï¼Œå¤šå®¢æˆ·ç«¯ï¼Œå¯æ¢å¤ä¼ è¾“ å®‰å…¨æ€§è¾ƒå·®ï¼Œé…ç½®å¤æ‚ ä¼ ç»Ÿæ–‡ä»¶å…±äº« HTTP/HTTPS ç©¿é€é˜²ç«å¢™ï¼Œæ— éœ€ç‰¹æ®Šå®¢æˆ·ç«¯ éœ€è¦WebæœåŠ¡å™¨ï¼Œå®‰å…¨æ€§ä¾èµ–é…ç½® å…¬å¼€æ–‡ä»¶åˆ†å‘ ä½•æ—¶é€‰æ‹© SCP ä¼ è¾“å°æ–‡ä»¶ï¼ˆ\u0026lt;100MBï¼‰ ç®€å•çš„ä¸€æ¬¡æ€§æ–‡ä»¶ä¼ è¾“ ç¯å¢ƒé™åˆ¶åªèƒ½ä½¿ç”¨SSHçš„æƒ…å†µ éœ€è¦æœ€å°åŒ–ä¾èµ–é¡¹ ä½•æ—¶é€‰æ‹©å…¶å®ƒå·¥å…· å¤§æ–‡ä»¶ä¼ è¾“ â†’ ä½¿ç”¨ Rsync éœ€è¦æ–­ç‚¹ç»­ä¼  â†’ ä½¿ç”¨ Rsync æˆ– SFTP äº¤äº’å¼æ–‡ä»¶ç®¡ç† â†’ ä½¿ç”¨ SFTP å¤šå®¢æˆ·ç«¯å…±äº« â†’ ä½¿ç”¨ FTP/FTPS æˆ– HTTP/HTTPS ğŸ› æ•…éšœæ’é™¤ 1. å¸¸è§é”™è¯¯è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 # æƒé™è¢«æ‹’ç»é”™è¯¯ chmod 600 ~/.ssh/private_key.pem # ç¡®ä¿å¯†é’¥æƒé™æ­£ç¡® chmod 755 ~/ # ç¡®ä¿å®¶ç›®å½•æƒé™æ­£ç¡® # è¿æ¥è¶…æ—¶é—®é¢˜ scp -o ConnectTimeout=30 -o ServerAliveInterval=60 file.txt username@remote_host:/path/ # ä¸»æœºå¯†é’¥éªŒè¯å¤±è´¥ ssh-keyscan -H remote_host \u0026gt;\u0026gt; ~/.ssh/known_hosts # å†…å­˜ä¸è¶³é”™è¯¯ scp -l 512 large_file.iso username@remote_host:/path/ # é™åˆ¶å¸¦å®½å‡å°‘å†…å­˜ä½¿ç”¨ 2. è°ƒè¯•æ¨¡å¼ 1 2 3 4 5 6 7 8 # æ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯ scp -v file.txt username@remote_host:/path/ # ä½¿ç”¨SSHè°ƒè¯•æ¨¡å¼ scp -o LogLevel=DEBUG3 file.txt username@remote_host:/path/ # æ£€æŸ¥è¯¦ç»†é”™è¯¯ä¿¡æ¯ scp -v file.txt username@remote_host:/path/ 2\u0026gt;\u0026amp;1 | grep -i error 3. ç½‘ç»œè¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping remote_host # æµ‹è¯•SSHè¿æ¥ ssh -v username@remote_host # æµ‹è¯•ç«¯å£è¿é€šæ€§ telnet remote_host 22 nc -zv remote_host 22 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo iptables -L # æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™ 4. æ€§èƒ½é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç½‘ç»œé€Ÿåº¦ iperf3 -c remote_host # éœ€è¦å®‰è£…iperf3 # æ£€æŸ¥ç£ç›˜IOæ€§èƒ½ ssh username@remote_host \u0026#34;dd if=/dev/zero of=testfile bs=1G count=1 oflag=direct\u0026#34; # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ ssh username@remote_host \u0026#34;uptime; iostat -x 1 3\u0026#34; ğŸ”’ å®‰å…¨å»ºè®® 1. è®¤è¯å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨å¯†é’¥è®¤è¯ä»£æ›¿å¯†ç è®¤è¯ ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; ssh-copy-id username@remote_host # ç¦ç”¨å¯†ç è®¤è¯ï¼ˆåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼‰ sudo sed -i \u0026#39;s/#PasswordAuthentication yes/PasswordAuthentication no/\u0026#39; /etc/ssh/sshd_config sudo systemctl restart sshd # ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤å¯†é’¥ ssh-keygen -p -f ~/.ssh/id_rsa 2. ä¼ è¾“å®‰å…¨ 1 2 3 4 5 6 7 8 # ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†ç®—æ³• scp -c aes256-gcm@openssh.com sensitive_file.txt username@remote_host:/path/ # éªŒè¯ä¸»æœºå¯†é’¥æŒ‡çº¹ ssh-keyscan -H remote_host | ssh-keygen -lf - # ä½¿ç”¨VPNå¢å¼ºå®‰å…¨æ€§ï¼ˆå…ˆå»ºç«‹VPNè¿æ¥ï¼‰ scp -o \u0026#34;ProxyCommand=nc -X connect -x vpn-proxy:port %h %p\u0026#34; file.txt username@remote_host:/path/ 3. è®¿é—®æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # é™åˆ¶ç”¨æˆ·å¯ä»¥è®¿é—®çš„ç›®å½•ï¼ˆåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼‰ # åˆ›å»ºå—é™ç”¨æˆ· sudo useradd -m -s /bin/rbash restricted_user sudo chmod 755 /home/restricted_user sudo mkdir /home/restricted_user/files sudo chown restricted_user:restricted_user /home/restricted_user/files sudo chmod 700 /home/restricted_user/files # è®¾ç½®SCPä¸“ç”¨ç”¨æˆ· sudo useradd -m -s /usr/lib/openssh/sftp-server scp_user sudo chown root:root /home/scp_user sudo chmod 755 /home/scp_user sudo mkdir /home/scp_user/uploads sudo chown scp_user:scp_user /home/scp_user/uploads sudo chmod 700 /home/scp_user/uploads 4. ç›‘æ§å’Œå®¡è®¡ 1 2 3 4 5 6 7 8 # ç›‘æ§SCPè¿æ¥ sudo tail -f /var/log/auth.log | grep scp # è®¾ç½®SCPæ“ä½œæ—¥å¿— sudo auditctl -a always,exit -F arch=b64 -S connect -S accept -S bind -S listen -F exe=/usr/bin/scp # å®šæœŸæ£€æŸ¥æˆæƒå¯†é’¥ ssh-keygen -l -f ~/.ssh/authorized_keys ğŸ“Š æ€§èƒ½æµ‹è¯• 1. æµ‹è¯•ä¼ è¾“é€Ÿåº¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºæµ‹è¯•æ–‡ä»¶ dd if=/dev/zero of=testfile bs=1M count=100 echo \u0026#34;æµ‹è¯•æ–‡ä»¶åˆ›å»ºå®Œæˆ\u0026#34; # æµ‹é‡ä¼ è¾“æ—¶é—´ echo \u0026#34;å¼€å§‹SCPä¼ è¾“æµ‹è¯•...\u0026#34; time scp testfile username@remote_host:/tmp/ echo \u0026#34;ä¼ è¾“å®Œæˆ\u0026#34; # è®¡ç®—ä¼ è¾“é€Ÿåº¦ï¼ˆMB/sï¼‰ filesize=100 # æ–‡ä»¶å¤§å°MB duration=$(time scp testfile username@remote_host:/tmp/ 2\u0026gt;\u0026amp;1 | grep real | awk \u0026#39;{print $2}\u0026#39; | awk -F\u0026#39;m\u0026#39; \u0026#39;{print $1 * 60 + $2}\u0026#39;) speed=$(echo \u0026#34;scale=2; $filesize / $duration\u0026#34; | bc) echo \u0026#34;ä¼ è¾“é€Ÿåº¦: $speed MB/s\u0026#34; # æ¸…ç†æµ‹è¯•æ–‡ä»¶ ssh username@remote_host \u0026#34;rm /tmp/testfile\u0026#34; rm testfile 2. æ¯”è¾ƒä¸åŒå·¥å…·æ€§èƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºå¤§æµ‹è¯•æ–‡ä»¶ dd if=/dev/zero of=large_testfile bs=1M count=1024 # SCPé€Ÿåº¦æµ‹è¯• echo \u0026#34;æµ‹è¯•SCPæ€§èƒ½...\u0026#34; time scp large_testfile username@remote_host:/tmp/ # Rsyncé€Ÿåº¦æµ‹è¯• echo \u0026#34;æµ‹è¯•Rsyncæ€§èƒ½...\u0026#34; time rsync -avz large_testfile username@remote_host:/tmp/ # è®°å½•ç»“æœ echo \u0026#34;SCPæ—¶é—´: $scp_time\u0026#34; echo \u0026#34;Rsyncæ—¶é—´: $rsync_time\u0026#34; # æ¸…ç† rm large_testfile ssh username@remote_host \u0026#34;rm /tmp/large_testfile\u0026#34; 3. ä¸åŒåŠ å¯†ç®—æ³•æ€§èƒ½æµ‹è¯• 1 2 3 4 5 6 # æµ‹è¯•ä¸åŒåŠ å¯†ç®—æ³•çš„æ€§èƒ½ for cipher in aes128-ctr aes192-ctr aes256-ctr aes128-gcm@openssh.com aes256-gcm@openssh.com; do echo \u0026#34;æµ‹è¯•åŠ å¯†ç®—æ³•: $cipher\u0026#34; time scp -c \u0026#34;$cipher\u0026#34; testfile username@remote_host:/dev/null echo \u0026#34;\u0026#34; done 4. ç½‘ç»œæ¡ä»¶æ¨¡æ‹Ÿæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨tcæ¨¡æ‹Ÿç½‘ç»œæ¡ä»¶ï¼ˆéœ€è¦rootæƒé™ï¼‰ # æ¨¡æ‹Ÿé«˜å»¶è¿Ÿ sudo tc qdisc add dev eth0 root netem delay 100ms # æ¨¡æ‹Ÿå¸¦å®½é™åˆ¶ sudo tc qdisc add dev eth0 root tbf rate 1mbit burst 32kbit latency 400ms # è¿›è¡Œä¼ è¾“æµ‹è¯• time scp testfile username@remote_host:/tmp/ # æ¸…é™¤ç½‘ç»œé™åˆ¶ sudo tc qdisc del dev eth0 root ğŸ¯ æç¤º: SCP æ˜¯ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œé€šè¿‡åˆç†ä½¿ç”¨å„ç§é€‰é¡¹å’ŒæŠ€å·§ï¼Œå¯ä»¥å¤§å¤§æé«˜æ–‡ä»¶ä¼ è¾“çš„æ•ˆç‡å’Œå¯é æ€§ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒä¸­çš„å¤§é‡æ–‡ä»¶ä¼ è¾“ï¼Œå»ºè®®è€ƒè™‘ä½¿ç”¨ rsync æˆ–å…¶ä»–ä¸“é—¨çš„æ–‡ä»¶åŒæ­¥å·¥å…·ã€‚\nå¸Œæœ›è¿™ä»½å®Œæ•´çš„ SCP å‘½ä»¤æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç†å’Œä¼ è¾“æ–‡ä»¶ï¼ğŸš€\n","date":"2025-08-26T20:30:23+08:00","image":"https://file.meimolihan.eu.org/img/linux-scp-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f50f6ffa/","title":"Linux æ–‡ä»¶ä¼ è¾“ SCP å‘½ä»¤è¯¦è§£ ğŸ“"},{"content":"Linux æ–‡ä»¶åŒæ­¥ rsync å‘½ä»¤è¯¦è§£ ğŸ”„ ğŸš€ æŒæ¡é«˜æ•ˆå¯é çš„æ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œè½»æ¾å®ç°æœ¬åœ°ä¸è¿œç¨‹æ•°æ®å¤‡ä»½å’ŒåŒæ­¥\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ rsync ç®€ä»‹ âš¡ æ ¸å¿ƒç‰¹æ€§ ğŸ”§ å®‰è£…ä¸éªŒè¯ ğŸ¯ åŸºæœ¬è¯­æ³•ä¸å‚æ•° ğŸ’¾ æœ¬åœ°åŒæ­¥åœºæ™¯ ğŸŒ è¿œç¨‹åŒæ­¥æŠ€å·§ ğŸš€ é«˜çº§ä½¿ç”¨æŠ€å·§ âš™ï¸ æ€§èƒ½ä¼˜åŒ– âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ” æ•…éšœæ’æŸ¥ ğŸ“Š æ€»ç»“å¯¹æ¯” âœ¨ rsync ç®€ä»‹ rsync (remote sync) æ˜¯ Linux ç³»ç»Ÿä¸­åŠŸèƒ½å¼ºå¤§çš„æ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œä»¥å…¶æ™ºèƒ½å¢é‡ä¼ è¾“ç®—æ³•è‘—ç§°ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°åœ¨æœ¬åœ°æˆ–è¿œç¨‹ç³»ç»Ÿé—´åŒæ­¥æ–‡ä»¶å’Œç›®å½•ã€‚\nğŸ¯ è®¾è®¡ç†å¿µï¼šåªä¼ è¾“å˜åŒ–çš„éƒ¨åˆ†ï¼Œæœ€å¤§åŒ–èŠ‚çœå¸¦å®½å’Œæ—¶é—´ï¼\nğŸŒŸ ä¸»è¦ä¼˜åŠ¿ï¼š\nâœ… é«˜æ•ˆå¢é‡ä¼ è¾“ï¼ŒèŠ‚çœå¸¦å®½å’Œæ—¶é—´ âœ… æ”¯æŒæœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶åŒæ­¥ âœ… ä¿æŒæ–‡ä»¶å±æ€§ï¼ˆæƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰ âœ… æ”¯æŒå‹ç¼©ä¼ è¾“å’ŒåŠ å¯†è¿æ¥ âœ… çµæ´»çš„è¿‡æ»¤å’Œæ’é™¤è§„åˆ™ âš¡ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ å›¾æ ‡ è¯´æ˜ å¢é‡åŒæ­¥ ğŸ”„ åªä¼ è¾“æœ‰å˜åŠ¨çš„æ–‡ä»¶éƒ¨åˆ† å¸¦å®½ä¼˜åŒ– ğŸ“‰ æ”¯æŒå‹ç¼©ä¼ è¾“ï¼ŒèŠ‚çœå¸¦å®½ è·¨å¹³å° ğŸŒ æ”¯æŒæœ¬åœ°å’Œè¿œç¨‹åŒæ­¥ å±æ€§ä¿æŒ ğŸ“‹ ä¿ç•™æ–‡ä»¶æƒé™ã€æ—¶é—´æˆ³ç­‰å±æ€§ å®‰å…¨ä¼ è¾“ ğŸ”’ é€šè¿‡ SSH åŠ å¯†ä¼ è¾“ æ–­ç‚¹ç»­ä¼  â¯ï¸ æ”¯æŒä¸­æ–­åç»§ç»­ä¼ è¾“ çµæ´»æ’é™¤ ğŸš« æ”¯æŒæ¨¡å¼æ’é™¤ç‰¹å®šæ–‡ä»¶ ğŸ”§ å®‰è£…ä¸éªŒè¯ ğŸ§ å„å‘è¡Œç‰ˆå®‰è£…æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Debian/Ubuntu sudo apt-get install -y rsync # Red Hat/CentOS sudo yum install rsync # Arch Linux sudo pacman -S rsync # Fedora sudo dnf install rsync # openSUSE sudo zypper install rsync # Alpine Linux sudo apk add rsync âœ… éªŒè¯å®‰è£… 1 2 3 4 5 6 # æ£€æŸ¥ç‰ˆæœ¬ rsync --version # æŸ¥çœ‹å¸®åŠ© rsync --help man rsync # æŸ¥çœ‹è¯¦ç»†æ‰‹å†Œ ğŸ“ æ³¨æ„ï¼šåŒæ­¥çš„åŒæ–¹éƒ½å¿…é¡»å®‰è£… rsync æ‰èƒ½æ­£å¸¸å·¥ä½œï¼\nğŸ¯ åŸºæœ¬è¯­æ³•ä¸å‚æ•° ğŸ“ åŸºæœ¬è¯­æ³•æ ¼å¼ 1 rsync [é€‰é¡¹] æºè·¯å¾„ ç›®æ ‡è·¯å¾„ ğŸ“Š å¸¸ç”¨å‚æ•°è¯¦è§£ å‚æ•° å›¾æ ‡ è¯´æ˜ ç¤ºä¾‹ -a, --archive ğŸ—ƒï¸ å½’æ¡£æ¨¡å¼ï¼ˆä¿ç•™æ‰€æœ‰å±æ€§ï¼‰ rsync -a source/ dest/ -v, --verbose ğŸ“¢ æ˜¾ç¤ºè¯¦ç»†ä¼ è¾“ä¿¡æ¯ rsync -av source/ dest/ -z, --compress ğŸ“¦ å‹ç¼©ä¼ è¾“æ•°æ® rsync -az source/ dest/ -r, --recursive ğŸ“ é€’å½’åŒæ­¥ç›®å½• rsync -r source/ dest/ -u, --update ğŸ”„ ä»…åŒæ­¥æ›´æ–°çš„æ–‡ä»¶ rsync -au source/ dest/ --delete ğŸ—‘ï¸ åˆ é™¤ç›®æ ‡ç«¯å¤šä½™æ–‡ä»¶ rsync -a --delete source/ dest/ --progress ğŸ“Š æ˜¾ç¤ºä¼ è¾“è¿›åº¦ rsync -a --progress source/ dest/ -n, --dry-run ğŸ” è¯•è¿è¡Œï¼ˆä¸å®é™…ä¼ è¾“ï¼‰ rsync -an source/ dest/ -P â¯ï¸ æ–­ç‚¹ç»­ä¼ +æ˜¾ç¤ºè¿›åº¦ rsync -aP source/ dest/ -h, --human-readable ğŸ‘€ äººç±»å¯è¯»æ ¼å¼æ˜¾ç¤ºå¤§å° rsync -ah source/ dest/ --stats ğŸ“ˆ æ˜¾ç¤ºä¼ è¾“ç»Ÿè®¡ä¿¡æ¯ rsync -a --stats source/ dest/ ğŸ’¾ æœ¬åœ°åŒæ­¥åœºæ™¯ ğŸ“‚ ç›®å½•åŒæ­¥æŠ€å·§ 1 2 3 4 5 6 7 8 # åŒæ­¥ç›®å½•å†…å®¹ï¼ˆä¸åŒ…å«ç›®å½•æœ¬èº«ï¼‰ rsync -av /path/to/source/ /path/to/destination/ # åŒæ­¥ç›®å½•æœ¬èº« rsync -av /path/to/source /path/to/destination # è¯•è¿è¡Œï¼ŒæŸ¥çœ‹å°†ä¼šåŒæ­¥çš„å†…å®¹ rsync -avn source/ destination/ ğŸ’¡ é‡è¦åŒºåˆ«ï¼šæºç›®å½•åçš„æ–œæ /å†³å®šæ˜¯åŒæ­¥ç›®å½•å†…å®¹è¿˜æ˜¯ç›®å½•æœ¬èº«ï¼\nğŸš« æ’é™¤ç‰¹å®šæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ’é™¤å•ä¸ªæ–‡ä»¶ç±»å‹ rsync -av --exclude=\u0026#39;*.tmp\u0026#39; source/ destination/ # æ’é™¤å¤šä¸ªæ¨¡å¼ rsync -av --exclude={\u0026#39;*.tmp\u0026#39;,\u0026#39;.git\u0026#39;} source/ destination/ # ä½¿ç”¨æ’é™¤æ–‡ä»¶ rsync -av --exclude-from=\u0026#39;exclude-list.txt\u0026#39; source/ destination/ # æ’é™¤éšè—æ–‡ä»¶ rsync -av --exclude=\u0026#39;.*\u0026#39; source/ destination/ # åŒ…å«ç‰¹å®šæ–‡ä»¶ï¼ˆå³ä½¿è¢«æ’é™¤ï¼‰ rsync -av --exclude=\u0026#39;*\u0026#39; --include=\u0026#39;*.txt\u0026#39; source/ destination/ ğŸ“‹ åŒæ­¥ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½å®¶ç›®å½•åˆ°å¤–éƒ¨ç¡¬ç›˜ rsync -avhz --progress /home/user/ /mnt/backup/home/ # åŒæ­¥ç½‘ç«™æ–‡ä»¶ï¼Œä¿æŒå®Œå…¨ä¸€è‡´ rsync -av --delete /var/www/ /backup/www/ # åŒæ­¥å›¾ç‰‡æ–‡ä»¶ï¼Œæ’é™¤ç¼“å­˜æ–‡ä»¶ rsync -av --exclude=\u0026#39;Thumbs.db\u0026#39; --exclude=\u0026#39;.DS_Store\u0026#39; Photos/ Backup/Photos/ # åŒæ­¥æ—¶ä¿æŒç¡¬é“¾æ¥ï¼ˆèŠ‚çœç©ºé—´ï¼‰ rsync -av --delete --link-dest=/previous/backup /source/ /new/backup/ ğŸŒ è¿œç¨‹åŒæ­¥æŠ€å·§ ğŸ”— SSH è¿œç¨‹åŒæ­¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ rsync -avz /local/path/ user@remote_host:/remote/path/ # ä»è¿œç¨‹æœåŠ¡å™¨æ‹‰å– rsync -avz user@remote_host:/remote/path/ /local/path/ # ä½¿ç”¨ç‰¹å®šSSHç«¯å£ rsync -avz -e \u0026#39;ssh -p 2222\u0026#39; /local/path/ user@remote_host:/remote/path/ # ä½¿ç”¨SSHå¯†é’¥è®¤è¯ rsync -avz -e \u0026#39;ssh -i ~/.ssh/id_rsa\u0026#39; /local/path/ user@remote_host:/remote/path/ # ä½¿ç”¨SSHé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸»æœº rsync -avz /local/path/ remote-host:/remote/path/ ğŸŒ è¿œç¨‹æœåŠ¡å™¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½åˆ°è¿œç¨‹æœåŠ¡å™¨ rsync -avz --progress /important/data/ user@backup-server:/backups/data/ # ä»ç”Ÿäº§æœåŠ¡å™¨åŒæ­¥ç½‘ç«™æ–‡ä»¶ rsync -avz --delete root@web-server:/var/www/ /local/backup/www/ # åŒæ­¥æ—¥å¿—æ–‡ä»¶åˆ°åˆ†ææœåŠ¡å™¨ rsync -avz /var/log/ user@log-server:/central-logs/$(hostname)/ # ä½¿ç”¨rsyncå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼ˆéœ€è¦é…ç½®rsyncd.confï¼‰ rsync -av source/ remote-host::module/destination/ ğŸš€ é«˜çº§ä½¿ç”¨æŠ€å·§ â° å®šæ—¶åŒæ­¥ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä½¿ç”¨cronå®ç°å®šæ—¶åŒæ­¥ # ç¼–è¾‘crontab crontab -e # æ¯å¤©å‡Œæ™¨2ç‚¹åŒæ­¥ 0 2 * * * /usr/bin/rsync -av /source/ /destination/ \u0026gt;\u0026gt; /var/log/rsync.log 2\u0026gt;\u0026amp;1 # æ¯å°æ—¶åŒæ­¥ä¸€æ¬¡ 0 * * * * /usr/bin/rsync -av /source/ /destination/ # æ¯å‘¨æ—¥æ™šä¸ŠåŒæ­¥ 0 0 * * 0 /usr/bin/rsync -av /source/ /destination/ # æ¯5åˆ†é’ŸåŒæ­¥ï¼ˆé«˜é¢‘ç‡ï¼‰ */5 * * * * /usr/bin/rsync -av /source/ /destination/ ğŸ“ åŒæ­¥è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #!/bin/bash # backup-script.sh LOG_FILE=\u0026#34;/var/log/rsync-backup.log\u0026#34; SOURCE_DIR=\u0026#34;/important/data/\u0026#34; DEST_DIR=\u0026#34;/backup/data/\u0026#34; MAX_RETRIES=3 RETRY_DELAY=60 echo \u0026#34;==========================================\u0026#34; \u0026gt;\u0026gt; $LOG_FILE echo \u0026#34;$(date): Starting backup from $SOURCE_DIR to $DEST_DIR\u0026#34; \u0026gt;\u0026gt; $LOG_FILE for ((i=1; i\u0026lt;=$MAX_RETRIES; i++)); do echo \u0026#34;$(date): Attempt $i of $MAX_RETRIES\u0026#34; \u0026gt;\u0026gt; $LOG_FILE rsync -av --delete --stats $SOURCE_DIR $DEST_DIR \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 if [ $? -eq 0 ]; then echo \u0026#34;$(date): Backup completed successfully\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # å‘é€æˆåŠŸé€šçŸ¥ echo \u0026#34;Backup completed successfully at $(date)\u0026#34; | mail -s \u0026#34;Backup Success\u0026#34; admin@example.com exit 0 else echo \u0026#34;$(date): Backup attempt $i failed, retrying in $RETRY_DELAY seconds...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE sleep $RETRY_DELAY fi done echo \u0026#34;$(date): All backup attempts failed\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # å‘é€å¤±è´¥é€šçŸ¥ echo \u0026#34;Backup failed after $MAX_RETRIES attempts at $(date)\u0026#34; | mail -s \u0026#34;Backup Failure\u0026#34; admin@example.com exit 1 ğŸ”„ åŒå‘åŒæ­¥æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # è™½ç„¶rsyncä¸æ˜¯ä¸“é—¨çš„åŒå‘åŒæ­¥å·¥å…·ï¼Œä½†å¯ä»¥è¿™æ ·å®ç°ï¼š #!/bin/bash # åŒå‘åŒæ­¥è„šæœ¬ LOG_FILE=\u0026#34;/var/log/two-way-sync.log\u0026#34; DIR_A=\u0026#34;/path/to/dirA/\u0026#34; DIR_B=\u0026#34;/path/to/dirB/\u0026#34; echo \u0026#34;$(date): Starting two-way synchronization\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # å…ˆåŒæ­¥Aåˆ°B echo \u0026#34;Syncing A -\u0026gt; B\u0026#34; \u0026gt;\u0026gt; $LOG_FILE rsync -av --delete $DIR_A $DIR_B \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # å†åŒæ­¥Båˆ°A echo \u0026#34;Syncing B -\u0026gt; A\u0026#34; \u0026gt;\u0026gt; $LOG_FILE rsync -av --delete $DIR_B $DIR_A \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 echo \u0026#34;$(date): Two-way synchronization completed\u0026#34; \u0026gt;\u0026gt; $LOG_FILE âš™ï¸ æ€§èƒ½ä¼˜åŒ– ğŸš€ åŠ é€Ÿä¼ è¾“æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä½¿ç”¨å‹ç¼©ï¼ˆé€‚åˆæ–‡æœ¬æ–‡ä»¶ï¼‰ rsync -avz source/ destination/ # ç¦ç”¨å‹ç¼©ï¼ˆé€‚åˆå·²å‹ç¼©æ–‡ä»¶ï¼‰ rsync -av --no-compress source/ destination/ # é™åˆ¶å¸¦å®½ä½¿ç”¨ï¼ˆé¿å…å½±å“å…¶ä»–æœåŠ¡ï¼‰ rsync -av --bwlimit=1000 source/ destination/ # é™åˆ¶ä¸º1000KB/s # å¹¶è¡Œä¼ è¾“ï¼ˆä½¿ç”¨å¤šä¸ªrsyncå®ä¾‹ï¼‰ rsync -av /source/dir1/ /dest/dir1/ \u0026amp; rsync -av /source/dir2/ /dest/dir2/ \u0026amp; wait # ä½¿ç”¨æ›´å¿«çš„åŠ å¯†ç®—æ³• rsync -avz -e \u0026#39;ssh -c aes128-gcm@openssh.com\u0026#39; source/ user@host:destination/ # è°ƒæ•´å—å¤§å°ï¼ˆå¯¹å¤§æ–‡ä»¶ä¼˜åŒ–ï¼‰ rsync -av --block-size=8192 source/ destination/ ğŸ“Š ä¼ è¾“ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ˜¾ç¤ºè¯¦ç»†ä¼ è¾“ä¿¡æ¯ rsync -av --progress source/ destination/ # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ rsync -av --stats source/ destination/ # ç”Ÿæˆä¼ è¾“æŠ¥å‘Š rsync -av --itemize-changes source/ destination/ # å®æ—¶ç›‘æ§ä¼ è¾“é€Ÿåº¦ rsync -av --progress --stats source/ destination/ | grep -E \u0026#39;speedup|sent|received\u0026#39; # è®°å½•ä¼ è¾“æ—¥å¿— rsync -av --log-file=/var/log/rsync.log source/ destination/ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”´ å±é™©æ“ä½œè­¦å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # --delete å‚æ•°ä¼šåˆ é™¤ç›®æ ‡ç«¯æ–‡ä»¶ï¼åŠ¡å¿…å…ˆè¯•è¿è¡Œ rsync -avn --delete source/ destination/ # å…ˆæ£€æŸ¥ rsync -av --delete source/ destination/ # å†æ‰§è¡Œ # æ ¹ç›®å½•åŒæ­¥è¦ç‰¹åˆ«å°å¿ƒï¼ rsync -av / /backup/ # å¯èƒ½ä¼šåŒ…å«ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ # è¿œç¨‹åŒæ­¥æ—¶æ³¨æ„è·¯å¾„æ ¼å¼ rsync -av /local/path user@remote:/path/ # æ­£ç¡® rsync -av /local/path/ user@remote:/path/ # æ­£ç¡® rsync -av /local/path user@remote:/path # å¯èƒ½å‡ºé”™ # æ³¨æ„æƒé™é—®é¢˜ sudo rsync -av source/ destination/ # éœ€è¦æ—¶ä½¿ç”¨sudo ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨SSHåŠ å¯†ä¼ è¾“ rsync -avz -e ssh source/ user@host:destination/ # é¿å…åœ¨å‘½ä»¤è¡Œä¸­æš´éœ²å¯†ç  # ä½¿ç”¨SSHå¯†é’¥è®¤è¯è€Œä¸æ˜¯å¯†ç  # é™åˆ¶rsyncå®ˆæŠ¤è¿›ç¨‹çš„è®¿é—®æƒé™ # ä½¿ç”¨chrooté™åˆ¶è®¿é—®èŒƒå›´ # ä½¿ç”¨åªè¯»æ¨¡å¼è¿›è¡Œå¤‡ä»½ rsync -av --read-only source/ destination/ # å®šæœŸæ£€æŸ¥åŒæ­¥å®Œæ•´æ€§ rsync -av --checksum source/ destination/ ğŸ” æ•…éšœæ’æŸ¥ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æƒé™è¢«æ‹’ç» sudo rsync -av source/ destination/ # ä½¿ç”¨sudo # è¿æ¥è¶…æ—¶ rsync -av --timeout=30 source/ user@host:destination/ # æ£€æŸ¥ä¸ºä»€ä¹ˆæŸäº›æ–‡ä»¶è¢«è·³è¿‡ rsync -av --itemize-changes source/ destination/ # è°ƒè¯•æ¨¡å¼ rsync -avvv source/ destination/ # å¤šä¸ªvå¢åŠ è¯¦ç»†ç¨‹åº¦ # ç½‘ç»œé—®é¢˜è¯Šæ–­ rsync -av --progress --stats source/ user@host:destination/ 2\u0026gt;\u0026amp;1 | tee /tmp/rsync-debug.log # æ£€æŸ¥SSHè¿æ¥ ssh -v user@host # å…ˆæµ‹è¯•SSHè¿æ¥ ğŸ“‹ é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¿½ç•¥é”™è¯¯ç»§ç»­åŒæ­¥ rsync -av --ignore-errors source/ destination/ # æœ€å¤§é‡è¯•æ¬¡æ•° rsync -av --max-retries=3 source/ destination/ # è·³è¿‡æŸäº›é”™è¯¯ç±»å‹ rsync -av --exclude=\u0026#39;*.lock\u0026#39; source/ destination/ # è·³è¿‡å·²åœ¨ä½¿ç”¨ä¸­çš„æ–‡ä»¶ rsync -av --ignore-existing source/ destination/ # å¼ºåˆ¶è¦†ç›–ç‰¹å®šæ–‡ä»¶ rsync -av --force source/ destination/ ğŸ“Š æ€»ç»“å¯¹æ¯” ğŸ†š rsync vs å…¶ä»–å·¥å…· ç‰¹æ€§ ğŸ”„ rsync ğŸ“‹ cp ğŸ—‚ï¸ scp ğŸ“¦ tar å¢é‡åŒæ­¥ âœ… âŒ âŒ âŒ å¸¦å®½ä¼˜åŒ– âœ… âŒ âŒ âš ï¸ å±æ€§ä¿æŒ âœ… âš ï¸ âœ… âœ… è¿œç¨‹æ”¯æŒ âœ… âŒ âœ… âŒ åˆ é™¤åŒæ­¥ âœ… âŒ âŒ âŒ è¯•è¿è¡Œ âœ… âŒ âŒ âŒ å‹ç¼©ä¼ è¾“ âœ… âŒ âŒ âœ… ğŸ¯ ä½¿ç”¨åœºæ™¯æ¨è ğŸ”„ æ—¥å¸¸å¤‡ä»½ï¼šrsync -av --delete source/ backup/ ğŸŒ è¿œç¨‹åŒæ­¥ï¼šrsync -avz -e ssh local/ user@host:remote/ ğŸ“ ç½‘ç«™éƒ¨ç½²ï¼šrsync -av --exclude='config.php' dev/ prod/ ğŸ’¾ æ•°æ®è¿ç§»ï¼šrsync -av --progress old-disk/ new-disk/ â° å®šæ—¶ä»»åŠ¡ï¼šcron + rsync è‡ªåŠ¨å¤‡ä»½ ğŸ“Š å¢é‡å¤‡ä»½ï¼šrsync -av --link-dest=/yesterday/ /source/ /today/ ğŸ“‹ æœ€ä½³å®è·µæ¸…å• âœ… æ€»æ˜¯å…ˆè¯•è¿è¡Œï¼šrsync -n é¿å…æ„å¤–æ“ä½œ âœ… ä½¿ç”¨å½’æ¡£æ¨¡å¼ï¼š-a ä¿ç•™æ‰€æœ‰æ–‡ä»¶å±æ€§ âœ… å¯ç”¨å‹ç¼©ä¼ è¾“ï¼š-z èŠ‚çœå¸¦å®½ï¼ˆé€‚åˆæ–‡æœ¬ï¼‰ âœ… è®°å½•æ“ä½œæ—¥å¿—ï¼š--log-file ä¾¿äºå®¡è®¡å’Œæ’æŸ¥ âœ… å®šæœŸéªŒè¯å¤‡ä»½ï¼š--checksum æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ âœ… ä½¿ç”¨SSHå¯†é’¥ï¼šé¿å…å¯†ç æš´éœ²ï¼Œæé«˜å®‰å…¨æ€§ âœ… è®¾ç½®å¸¦å®½é™åˆ¶ï¼š--bwlimit é¿å…å½±å“ç”Ÿäº§æœåŠ¡ âœ… å®æ–½ç›‘æ§å‘Šè­¦ï¼šç›‘æ§åŒæ­¥ä»»åŠ¡çŠ¶æ€å’Œæ€§èƒ½ ğŸ’¡ ä¸“ä¸šæç¤ºï¼šåœ¨ä½¿ç”¨ä»»ä½•ç ´åæ€§æ“ä½œï¼ˆå¦‚ --deleteï¼‰å‰ï¼Œæ€»æ˜¯å…ˆä½¿ç”¨ -n å‚æ•°è¿›è¡Œè¯•è¿è¡Œï¼Œç¡®è®¤æ— è¯¯åå†æ‰§è¡Œå®é™…æ“ä½œï¼å®šæœŸéªŒè¯å¤‡ä»½çš„å®Œæ•´æ€§å’Œå¯æ¢å¤æ€§ã€‚\n","date":"2025-08-26T20:28:28+08:00","image":"https://file.meimolihan.eu.org/img/rsync-01.webp","permalink":"https://blog.meimolihan.eu.org/p/569c6da7/","title":"Linux æ–‡ä»¶åŒæ­¥ rsync å‘½ä»¤è¯¦è§£ ğŸ”„"},{"content":"Linux ç£ç›˜æ ¼å¼åŒ– EXT4 vs NTFS è¯¦è§£ ğŸ§ ğŸ’¾ å…¨é¢æŒæ¡ Linux ä¸‹ç£ç›˜åˆ†åŒºä¸æ ¼å¼åŒ–çš„ä¸“ä¸šæŠ€å·§ï¼ŒåŒ…å« ext4 å’Œ NTFS æ–‡ä»¶ç³»ç»Ÿçš„æ·±åº¦å¯¹æ¯”ä¸å®æˆ˜æ“ä½œ\nğŸ“– ç›®å½•å¯¼èˆª âš ï¸ é‡è¦å®‰å…¨è­¦å‘Š ğŸ“Š æ–‡ä»¶ç³»ç»Ÿå¯¹æ¯”ï¼šext4 vs NTFS ğŸ” æ­¥éª¤ä¸€ï¼šè¯†åˆ«ç£ç›˜è®¾å¤‡ ğŸ“‚ æ­¥éª¤äºŒï¼šåˆ›å»ºåˆ†åŒº ğŸ¯ æ­¥éª¤ä¸‰ï¼šæ ¼å¼åŒ–æ“ä½œ ğŸ“Œ æ­¥éª¤å››ï¼šæŒ‚è½½ä¸ä½¿ç”¨ ğŸ’¡ é«˜çº§æŠ€å·§ä¸å»ºè®® ğŸš¨ æ•…éšœæ’é™¤ ğŸ“ æ€»ç»“æ¸…å• âš ï¸ é‡è¦å®‰å…¨è­¦å‘Š ğŸ”´ æ•°æ®æ— ä»·ï¼Œæ“ä½œå‰è¯·åŠ¡å¿…ç¡®è®¤ï¼\næ ¼å¼åŒ–æ“ä½œå°†æ°¸ä¹…åˆ é™¤ç›®æ ‡ç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼è¯·åŠ¡å¿…ï¼š\nğŸ“¦ å¤‡ä»½é‡è¦æ•°æ®ï¼šç¡®è®¤ç£ç›˜ä¸Šæ²¡æœ‰éœ€è¦ä¿ç•™çš„æ•°æ® ğŸ” ç¡®è®¤è®¾å¤‡æ ‡è¯†ç¬¦ï¼šåˆ‡å‹¿å‡­çŒœæµ‹æ“ä½œè®¾å¤‡åç§° ğŸ‘‘ è·å– root æƒé™ï¼šä½¿ç”¨ sudo æ‰§è¡Œç‰¹æƒå‘½ä»¤ ğŸ“ è®°å½•æ“ä½œæ­¥éª¤ï¼šé¿å…è¯¯æ“ä½œå¯¼è‡´æ•°æ®ä¸¢å¤± ğŸ’¡ å»ºè®®ï¼šé¦–æ¬¡æ“ä½œå¯åœ¨è™šæ‹Ÿæœºä¸­ç»ƒä¹ \nç´§æ€¥æ¢å¤æªæ–½ 1 2 3 4 5 6 # å¦‚æœè¯¯æ ¼å¼åŒ–ï¼Œç«‹å³åœæ­¢å†™å…¥å¹¶å°è¯•æ¢å¤ sudo apt install testdisk sudo testdisk /dev/sdX # è°¨æ…ä½¿ç”¨ï¼Œéµå¾ªæŒ‡å¯¼ # æˆ–ä½¿ç”¨ photorec æ¢å¤æ–‡ä»¶ sudo photorec /dev/sdX ğŸ“Š æ–‡ä»¶ç³»ç»Ÿå¯¹æ¯”ï¼šext4 vs NTFS ç‰¹æ€§ ğŸ”µ ext4 ğŸ”´ NTFS å¼€å‘æ–¹ Linux ç¤¾åŒº Microsoft ä¸»è¦é€‚ç”¨ç³»ç»Ÿ Linux Windows Linux æ”¯æŒ åŸç”Ÿå†…æ ¸æ”¯æŒ ğŸš€ éœ€è¦ ntfs-3g é©±åŠ¨ Windows æ”¯æŒ éœ€è¦ç¬¬ä¸‰æ–¹è½¯ä»¶ åŸç”Ÿæ”¯æŒ âœ… æ—¥å¿—åŠŸèƒ½ æœ‰ï¼ˆæ•°æ®å®‰å…¨æ€§é«˜ï¼‰ æœ‰ï¼ˆæ•°æ®å®‰å…¨æ€§é«˜ï¼‰ æœ€å¤§æ–‡ä»¶å¤§å° 16 TiB 16 EiB (ç†è®ºå€¼) æœ€å¤§å·å¤§å° 1 EiB 256 TiB æ–‡ä»¶åç§°é•¿åº¦ 255 å­—èŠ‚ 255 å­—ç¬¦ å¤§å°å†™æ•æ„Ÿ æ˜¯ å¦ å‹ç¼©æ”¯æŒ å¦ æ˜¯ åŠ å¯†æ”¯æŒ æ˜¯ï¼ˆeCryptfsï¼‰ æ˜¯ï¼ˆEFSï¼‰ é€‚ç”¨åœºæ™¯ Linux ç³»ç»Ÿç›˜ã€æ•°æ®ç›˜ è·¨å¹³å°å…±äº« ğŸ’¼ ğŸ¯ é€‰æ‹©æŒ‡å—ï¼š\nä»…åœ¨ Linux ä½¿ç”¨ â†’ é€‰æ‹© ext4ï¼ˆæ€§èƒ½æ›´ä½³ï¼‰ è·¨å¹³å°å…±äº« â†’ é€‰æ‹© NTFSï¼ˆå…¼å®¹æ€§å¥½ï¼‰ æœåŠ¡å™¨åº”ç”¨ â†’ é€‰æ‹© XFS æˆ– Btrfsï¼ˆé«˜çº§ç‰¹æ€§ï¼‰ UEFI ç³»ç»Ÿå¯åŠ¨ â†’ é€‰æ‹© FAT32ï¼ˆEFI åˆ†åŒºï¼‰ ğŸ” æ­¥éª¤ä¸€ï¼šè¯†åˆ«ç£ç›˜è®¾å¤‡ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¯†åˆ«ç£ç›˜è®¾å¤‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ—å‡ºæ‰€æœ‰å—è®¾å¤‡ï¼ˆæ¨èï¼‰ lsblk # è¯¦ç»†ç£ç›˜ä¿¡æ¯ sudo fdisk -l # ä½¿ç”¨ tree é£æ ¼æŸ¥çœ‹ lsblk -f # æŸ¥çœ‹ USB è®¾å¤‡ lsusb # æŸ¥çœ‹ SCSI/SATA è®¾å¤‡ lsscsi # æŸ¥çœ‹ç£ç›˜å¥åº·çŠ¶æ€ sudo smartctl -a /dev/sda ğŸ“ è¾“å‡ºç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 NAME FSTYPE LABEL UUID MOUNTPOINT sda â”œâ”€sda1 ext4 5f3f4b... /boot â”œâ”€sda2 ext4 7a9b8c... / â””â”€sda3 swap d87e6f... [SWAP] sdb â””â”€sdb1 ntfs Data A1B2C3... ğŸ¯ è¯†åˆ«è¦ç‚¹ï¼š\nSATA/SAS/USB ç£ç›˜ï¼š/dev/sdX (å¦‚ /dev/sdb) NVMe SSD ç£ç›˜ï¼š/dev/nvme0n1pX (å¦‚ /dev/nvme0n1p1) æ ¹æ®å¤§å°å’ŒæŒ‚è½½ç‚¹ç¡®è®¤ç›®æ ‡ç£ç›˜ âš ï¸ ç‰¹åˆ«æ³¨æ„ï¼š\nç³»ç»Ÿç£ç›˜é€šå¸¸æœ‰å¤šä¸ªåˆ†åŒºï¼ˆå¦‚ /boot, /, swapï¼‰ æ–°ç£ç›˜é€šå¸¸æ˜¾ç¤ºä¸ºæœªåˆ†åŒºçŠ¶æ€ ç¡®ä¿æ“ä½œçš„æ˜¯æ­£ç¡®çš„ç£ç›˜è®¾å¤‡ ğŸ“‚ æ­¥éª¤äºŒï¼šåˆ›å»ºåˆ†åŒº ä½¿ç”¨ parted åˆ›å»º GPT åˆ†åŒºï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯åŠ¨ parted å·¥å…· sudo parted /dev/sdb # åœ¨äº¤äº’å‘½ä»¤è¡Œä¸­æ“ä½œ (parted) mklabel gpt # åˆ›å»º GPT åˆ†åŒºè¡¨ï¼ˆæ”¯æŒå¤§äº2TBç£ç›˜ï¼‰ (parted) mkpart primary 0% 100% # åˆ›å»ºä¸»åˆ†åŒºå ç”¨å…¨éƒ¨ç©ºé—´ (parted) name 1 MyData # ä¸ºåˆ†åŒºå‘½å (parted) print # æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ (parted) quit # é€€å‡º # æˆ–è€…ä½¿ç”¨éäº¤äº’æ¨¡å¼ sudo parted /dev/sdb mklabel gpt sudo parted /dev/sdb mkpart primary 0% 100% sudo parted /dev/sdb name 1 MyData ä½¿ç”¨ fdisk åˆ›å»ºåˆ†åŒº 1 2 3 4 5 6 7 8 9 10 11 12 sudo fdisk /dev/sdb # fdisk äº¤äº’å‘½ä»¤ï¼š # g â†’ åˆ›å»ºæ–°çš„GPTåˆ†åŒºè¡¨ # n â†’ æ–°å»ºåˆ†åŒº # å›è½¦ â†’ ä½¿ç”¨é»˜è®¤åˆ†åŒºå· # å›è½¦ â†’ èµ·å§‹æ‰‡åŒºï¼ˆé»˜è®¤ï¼‰ # å›è½¦ â†’ ç»“æŸæ‰‡åŒºï¼ˆé»˜è®¤ï¼Œä½¿ç”¨å…¨éƒ¨ç©ºé—´ï¼‰ # w â†’ å†™å…¥å¹¶é€€å‡º # æŸ¥çœ‹åˆ†åŒºç»“æœ sudo fdisk -l /dev/sdb ä½¿ç”¨ gdisk åˆ›å»ºåˆ†åŒºï¼ˆGPTä¸“ç”¨ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 sudo gdisk /dev/sdb # gdisk äº¤äº’å‘½ä»¤ï¼š # n â†’ æ–°å»ºåˆ†åŒº # å›è½¦ â†’ ä½¿ç”¨é»˜è®¤åˆ†åŒºå· # å›è½¦ â†’ èµ·å§‹æ‰‡åŒº # å›è½¦ â†’ ç»“æŸæ‰‡åŒº # 8300 â†’ Linuxæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆext4ï¼‰ # 0700 â†’ MicrosoftåŸºæœ¬æ•°æ®ï¼ˆNTFSï¼‰ # w â†’ å†™å…¥å¹¶é€€å‡º # y â†’ ç¡®è®¤ ğŸ¯ æ­¥éª¤ä¸‰ï¼šæ ¼å¼åŒ–æ“ä½œ ğŸ”µ æ–¹æ¡ˆ Aï¼šæ ¼å¼åŒ–ä¸º ext4 1 2 3 4 5 6 7 8 9 10 11 12 # åŸºæœ¬æ ¼å¼åŒ– sudo mkfs.ext4 /dev/sdb1 # æ¨èé€‰é¡¹ï¼ˆè®¾ç½®æ ‡ç­¾ä¸”ä¸ä¿ç•™ç©ºé—´ï¼‰ sudo mkfs.ext4 -L \u0026#34;MyLinuxDisk\u0026#34; -m 0 /dev/sdb1 # å¯ç”¨å…ƒæ•°æ®æ ¡éªŒå’Œï¼ˆå¢åŠ å®‰å…¨æ€§ï¼Œè½»å¾®æ€§èƒ½å½±å“ï¼‰ sudo mkfs.ext4 -O metadata_csum /dev/sdb1 # æŸ¥çœ‹æ ¼å¼åŒ–ç»“æœ sudo blkid /dev/sdb1 sudo tune2fs -l /dev/sdb1 | grep \u0026#34;Filesystem features\u0026#34; ğŸ“Š å‚æ•°è¯´æ˜ï¼š\n-L \u0026quot;æ ‡ç­¾\u0026quot;ï¼šè®¾ç½®åˆ†åŒºæ ‡ç­¾ -m 0ï¼šä¸ä¸º root ä¿ç•™ç©ºé—´ï¼ˆé»˜è®¤ä¿ç•™ 5%ï¼‰ -O ^has_journalï¼šç¦ç”¨æ—¥å¿—ï¼ˆä¸æ¨èï¼Œé™ä½æ•°æ®å®‰å…¨æ€§ï¼‰ -O metadata_csumï¼šå¯ç”¨å…ƒæ•°æ®æ ¡éªŒå’Œï¼ˆæé«˜æ•°æ®å®Œæ•´æ€§ï¼‰ -T largefile / -T largefile4ï¼šä¼˜åŒ–å¤§æ–‡ä»¶æ€§èƒ½ ğŸ”´ æ–¹æ¡ˆ Bï¼šæ ¼å¼åŒ–ä¸º NTFS 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… NTFS æ”¯æŒï¼ˆå¦‚æœªå®‰è£…ï¼‰ sudo apt update \u0026amp;\u0026amp; sudo apt install ntfs-3g # åŸºæœ¬æ ¼å¼åŒ– sudo mkfs.ntfs /dev/sdb1 # å¿«é€Ÿæ ¼å¼åŒ–å¹¶è®¾ç½®æ ‡ç­¾ sudo mkfs.ntfs -f -L \u0026#34;WinShared\u0026#34; /dev/sdb1 # å¯ç”¨å‹ç¼©ï¼ˆå¯é€‰ï¼‰ sudo mkfs.ntfs -C /dev/sdb1 # æŸ¥çœ‹ NTFS ä¿¡æ¯ sudo ntfsinfo /dev/sdb1 ğŸ”¶ å…¶ä»–æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 # æ ¼å¼åŒ–ä¸º XFSï¼ˆé«˜æ€§èƒ½æ–‡ä»¶ç³»ç»Ÿï¼‰ sudo apt install xfsprogs sudo mkfs.xfs /dev/sdb1 # æ ¼å¼åŒ–ä¸º Btrfsï¼ˆé«˜çº§ç‰¹æ€§ï¼‰ sudo apt install btrfs-progs sudo mkfs.btrfs /dev/sdb1 # æ ¼å¼åŒ–ä¸º FAT32ï¼ˆå…¼å®¹æ€§æœ€å¥½ï¼Œä½†é™åˆ¶4GBæ–‡ä»¶å¤§å°ï¼‰ sudo mkfs.fat -F32 /dev/sdb1 ğŸ“Œ æ­¥éª¤å››ï¼šæŒ‚è½½ä¸ä½¿ç”¨ ä¸´æ—¶æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»ºæŒ‚è½½ç‚¹ sudo mkdir -p /mnt/mydata # æŒ‚è½½åˆ†åŒº sudo mount /dev/sdb1 /mnt/mydata # éªŒè¯æŒ‚è½½ df -h /mnt/mydata lsblk -f # å¸è½½åˆ†åŒº sudo umount /mnt/mydata æ°¸ä¹…æŒ‚è½½ï¼ˆç¼–è¾‘ /etc/fstabï¼‰ 1 2 3 4 5 6 7 8 # è·å–åˆ†åŒºçš„ UUIDï¼ˆæ¨èä½¿ç”¨UUIDè€Œéè®¾å¤‡åï¼‰ sudo blkid # å¤‡ä»½ fstab æ–‡ä»¶ sudo cp /etc/fstab /etc/fstab.bak # ç¼–è¾‘ fstab sudo nano /etc/fstab ğŸ“ æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\nå¯¹äº ext4 åˆ†åŒºï¼š\n1 UUID=ä½ çš„UUID /mnt/mydata ext4 defaults,noatime,errors=remount-ro 0 2 å¯¹äº NTFS åˆ†åŒºï¼š\n1 UUID=ä½ çš„UUID /mnt/mydata ntfs-3g defaults,windows_names,uid=1000,gid=1000,umask=022,locale=en_US.UTF-8 0 0 å¯¹äº SSD ä¼˜åŒ–ï¼š\n1 UUID=ä½ çš„UUID /mnt/mydata ext4 defaults,noatime,discard,errors=remount-ro 0 2 ğŸ”§ å‚æ•°è¯´æ˜ï¼š\nnoatimeï¼šå‡å°‘ç£ç›˜å†™å…¥ï¼Œæå‡æ€§èƒ½ discardï¼šå¯ç”¨ TRIMï¼ˆSSD ä¸“ç”¨ï¼‰ errors=remount-roï¼šå‡ºé”™æ—¶ä»¥åªè¯»æ–¹å¼é‡æ–°æŒ‚è½½ windows_namesï¼šé˜²æ­¢åˆ›å»º Windows éæ³•æ–‡ä»¶å uid=1000,gid=1000ï¼šè®¾ç½®æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆé€šå¸¸1000æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼‰ umask=022ï¼šè®¾ç½®é»˜è®¤æƒé™ï¼ˆç›®å½•755ï¼Œæ–‡ä»¶644ï¼‰ locale=en_US.UTF-8ï¼šè®¾ç½®å­—ç¬¦ç¼–ç ï¼ˆé¿å…æ–‡ä»¶åä¹±ç ï¼‰ âœ… æµ‹è¯•é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 # æµ‹è¯• fstab é…ç½®æ˜¯å¦æ­£ç¡® sudo mount -a # æŸ¥çœ‹æŒ‚è½½ç»“æœ df -h mount | grep mydata # å¦‚æœå‡ºç°é”™è¯¯ï¼Œæ£€æŸ¥ç³»ç»Ÿæ—¥å¿— sudo dmesg | tail è‡ªåŠ¨æŒ‚è½½æœåŠ¡ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨ systemd è‡ªåŠ¨æŒ‚è½½ï¼ˆæ›´ç°ä»£çš„æ–¹å¼ï¼‰ sudo systemctl daemon-reload # åˆ›å»ºè‡ªåŠ¨æŒ‚è½½å•å…ƒ echo \u0026#34;/dev/disk/by-uuid/ä½ çš„UUID /mnt/mydata ext4 defaults,noatime 0 2\u0026#34; | sudo tee /etc/systemd/system/mnt-mydata.mount # å¯ç”¨å¹¶å¯åŠ¨æŒ‚è½½å•å…ƒ sudo systemctl enable mnt-mydata.mount sudo systemctl start mnt-mydata.mount ğŸ’¡ é«˜çº§æŠ€å·§ä¸å»ºè®® æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è°ƒæ•´ ext4 æŒ‚è½½å‚æ•°ï¼ˆæ ¹æ®ç”¨é€”é€‰æ‹©ï¼‰ # å¯¹äºæ•°æ®ç›˜ï¼š defaults,noatime,nodiratime,data=writeback,commit=60 # å¯¹äºSSDä¼˜åŒ–ï¼š defaults,noatime,discard,data=ordered # è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå‚æ•° sudo tune2fs -o journal_data_writeback /dev/sdb1 # æ›´æ”¹æ—¥å¿—æ¨¡å¼ sudo tune2fs -m 1 /dev/sdb1 # å°†ä¿ç•™å—ç™¾åˆ†æ¯”æ”¹ä¸º1% # å¯ç”¨/ç¦ç”¨Barrierï¼ˆç”µæºæ•…éšœä¿æŠ¤ï¼‰ mount -o barrier=0 /dev/sdb1 /mnt/mydata # ç¦ç”¨ï¼ˆæ€§èƒ½æ›´å¥½ï¼Œé£é™©æ›´é«˜ï¼‰ mount -o barrier=1 /dev/sdb1 /mnt/mydata # å¯ç”¨ï¼ˆé»˜è®¤ï¼Œæ›´å®‰å…¨ï¼‰ ç£ç›˜ç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ sudo fsck /dev/sdb1 # å¼ºåˆ¶æ£€æŸ¥ï¼ˆå³ä½¿æ–‡ä»¶ç³»ç»Ÿæ ‡è®°ä¸ºcleanï¼‰ sudo fsck -f /dev/sdb1 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h df -i # æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ # æŸ¥çœ‹ç›®å½•å¤§å° sudo du -sh /mnt/mydata/* sudo du -h --max-depth=1 /mnt/mydata | sort -hr # æŸ¥æ‰¾å¤§æ–‡ä»¶ find /mnt/mydata -type f -size +100M -exec ls -lh {} \\; æ ‡ç­¾å’ŒUUIDç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹æ‰€æœ‰ç£ç›˜æ ‡ç­¾å’ŒUUID lsblk -f blkid # ä¿®æ”¹ ext4 æ ‡ç­¾ sudo e2label /dev/sdb1 \u0026#34;NewLabel\u0026#34; # ä¿®æ”¹ NTFS æ ‡ç­¾ sudo ntfslabel /dev/sdb1 \u0026#34;NewLabel\u0026#34; # ç”Ÿæˆæ–°UUIDï¼ˆext4ï¼‰ sudo tune2fs -U random /dev/sdb1 # ä½¿ç”¨ç‰¹å®šUUID sudo tune2fs -U a1b2c3d4-e5f6-7890-abcd-ef1234567890 /dev/sdb1 å®‰å…¨è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # è®¾ç½®æŒ‚è½½ç‚¹æƒé™ sudo chmod 755 /mnt/mydata sudo chown root:root /mnt/mydata # è®¾ç½®ç£ç›˜é…é¢ï¼ˆext4ï¼‰ sudo quotacheck -cug /mnt/mydata sudo quotaon /mnt/mydata sudo edquota username # åŠ å¯†ç£ç›˜ï¼ˆLUKSï¼‰ sudo cryptsetup luksFormat /dev/sdb1 sudo cryptsetup luksOpen /dev/sdb1 my_encrypted_disk sudo mkfs.ext4 /dev/mapper/my_encrypted_disk ğŸš¨ æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜è§£å†³ æŒ‚è½½å¤±è´¥\n1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ sudo dmesg | tail journalctl -xe # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ sudo fsck -y /dev/sdb1 # å°è¯•ä»¥åªè¯»æ–¹å¼æŒ‚è½½ sudo mount -o ro /dev/sdb1 /mnt/mydata æƒé™é—®é¢˜\n1 2 3 4 5 6 7 8 9 # æ›´æ”¹æŒ‚è½½ç‚¹æ‰€æœ‰è€… sudo chown -R $USER:$USER /mnt/mydata # æ›´æ”¹ç£ç›˜æƒé™ sudo chmod -R 755 /mnt/mydata # æ£€æŸ¥SELinux/AppArmorè®¾ç½® sudo ausearch -m avc -ts recent # æŸ¥çœ‹SELinuxæ‹’ç»è®°å½• sudo aa-status # æŸ¥çœ‹AppArmorçŠ¶æ€ fstab é”™è¯¯å¯¼è‡´æ— æ³•å¯åŠ¨\n1 2 3 4 5 # é‡å¯è¿›å…¥æ¢å¤æ¨¡å¼ # ä½¿ç”¨ live CD ä¿®å¤ fstab # åœ¨å¯åŠ¨æ—¶è·³è¿‡fstabæŒ‚è½½ # åœ¨GRUBå¯åŠ¨å‚æ•°ä¸­æ·»åŠ  break=mount NTFS å†™å…¥æƒé™é—®é¢˜\n1 2 3 4 5 6 7 # é‡æ–°æŒ‚è½½å¹¶æŒ‡å®šç”¨æˆ·æƒé™ sudo umount /dev/sdb1 sudo mount -o uid=1000,gid=1000,umask=022 /dev/sdb1 /mnt/mydata # å®‰è£…NTFSé…ç½®å·¥å…· sudo apt install ntfs-config sudo ntfs-config # å›¾å½¢åŒ–é…ç½®å·¥å…· ç£ç›˜è¯†åˆ«é—®é¢˜\n1 2 3 4 5 6 7 8 9 # é‡æ–°æ‰«æSCSIæ€»çº¿ echo 1 | sudo tee /sys/class/scsi_device/*/device/rescan # é‡æ–°åŠ è½½ç£ç›˜åˆ†åŒºè¡¨ sudo partprobe /dev/sdb sudo hdparm -z /dev/sdb # å¼ºåˆ¶å†…æ ¸é‡æ–°è¯»å–åˆ†åŒºè¡¨ sudo blockdev --rereadpt /dev/sdb æ€§èƒ½é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥ç£ç›˜I/Oæ€§èƒ½ sudo hdparm -Tt /dev/sdb1 # ä½¿ç”¨ddæµ‹è¯•å†™å…¥é€Ÿåº¦ dd if=/dev/zero of=/mnt/mydata/testfile bs=1G count=1 oflag=direct # ä½¿ç”¨fioè¿›è¡Œé«˜çº§æ€§èƒ½æµ‹è¯• sudo apt install fio fio --name=test --filename=/mnt/mydata/test.file --size=1G --readwrite=randread --bs=4k --iodepth=64 --runtime=60 --group_reporting # ç›‘æ§ç£ç›˜I/O sudo iotop sudo iostat -x 1 æ•°æ®æ¢å¤å»ºè®® âš ï¸ ç«‹å³åœæ­¢å†™å…¥æ“ä½œ ä½¿ç”¨ testdisk å°è¯•æ¢å¤åˆ†åŒºè¡¨ 1 2 sudo apt install testdisk sudo testdisk /dev/sdb ä½¿ç”¨ photorec å°è¯•æ¢å¤æ–‡ä»¶ 1 sudo photorec /dev/sdb1 è€ƒè™‘ä¸“ä¸šæ•°æ®æ¢å¤æœåŠ¡ ğŸ“ æ€»ç»“æ¸…å• æ­¥éª¤ å‘½ä»¤ç¤ºä¾‹ æ³¨æ„äº‹é¡¹ è¯†åˆ«ç£ç›˜ lsblk, sudo fdisk -l ç¡®è®¤è®¾å¤‡åç§° åˆ›å»ºåˆ†åŒº sudo parted /dev/sdb é€‰æ‹© GPT åˆ†åŒºè¡¨ æ ¼å¼åŒ– ext4 sudo mkfs.ext4 -L \u0026quot;Data\u0026quot; /dev/sdb1 ä½¿ç”¨ -m 0 é‡Šæ”¾ç©ºé—´ æ ¼å¼åŒ– NTFS sudo mkfs.ntfs -f -L \u0026quot;Share\u0026quot; /dev/sdb1 å…ˆå®‰è£… ntfs-3g æ°¸ä¹…æŒ‚è½½ ç¼–è¾‘ /etc/fstab å¤‡ä»½åŸæ–‡ä»¶ æµ‹è¯•é…ç½® sudo mount -a éªŒè¯æ— é”™è¯¯ è®¾ç½®æƒé™ sudo chown -R user:user /mnt/mydata æŒ‰éœ€è®¾ç½® æ¨èå·¥ä½œæµç¨‹ å‡†å¤‡é˜¶æ®µï¼šå¤‡ä»½æ•°æ®ï¼Œç¡®è®¤ç£ç›˜è®¾å¤‡ åˆ†åŒºé˜¶æ®µï¼šä½¿ç”¨ parted åˆ›å»º GPT åˆ†åŒº æ ¼å¼åŒ–é˜¶æ®µï¼šæ ¹æ®ç”¨é€”é€‰æ‹©æ–‡ä»¶ç³»ç»Ÿ æŒ‚è½½é˜¶æ®µï¼šä½¿ç”¨ UUID åœ¨ /etc/fstab ä¸­é…ç½®æŒ‚è½½ ä¼˜åŒ–é˜¶æ®µï¼šæ ¹æ®ç£ç›˜ç±»å‹è°ƒæ•´æŒ‚è½½å‚æ•° æµ‹è¯•é˜¶æ®µï¼šéªŒè¯è¯»å†™æƒé™å’Œæ€§èƒ½ ğŸ’¡ æ¸©é¦¨æç¤ºï¼šå®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ï¼Œé‡è¦æ•°æ®åšæŒ 3-2-1 å¤‡ä»½åŸåˆ™ï¼ˆ3ä¸ªå‰¯æœ¬ï¼Œ2ç§ä»‹è´¨ï¼Œ1ä»½ç¦»çº¿ï¼‰\n","date":"2025-08-26T20:25:41+08:00","image":"https://file.meimolihan.eu.org/img/linux-disk-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e027d83b/","title":"Linux ç£ç›˜æ ¼å¼åŒ– EXT4 vs NTFS è¯¦è§£ ğŸ§"},{"content":"Windows åˆ›å»º SSH å¯†é’¥å¯¹åŠ Debian 13 é…ç½®æŒ‡å— ğŸ”‘ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸŒŸ ç®€ä»‹ ğŸš€ ä¸€ã€åœ¨ Windows ä¸Šåˆ›å»º SSH å¯†é’¥å¯¹ ğŸ”§ äºŒã€åœ¨ Debian 13 æœåŠ¡å™¨ä¸Šé…ç½® SSH å¯†é’¥ âœ… ä¸‰ã€éªŒè¯ SSH å¯†é’¥é…ç½® ğŸ”’ å››ã€SSH æœåŠ¡å®‰å…¨é…ç½®ï¼ˆå¯é€‰ä½†æ¨èï¼‰ ğŸ›¡ï¸ äº”ã€å®‰å…¨æœ€ä½³å®è·µ ğŸ” å…­ã€æ•…éšœæ’é™¤ ğŸ’¡ ä¸ƒã€é«˜çº§ç”¨æ³• ğŸ“š å…«ã€å¸¸ç”¨ SSH å‘½ä»¤å‚è€ƒ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Windows ç³»ç»Ÿä¸Šåˆ›å»º SSH å¯†é’¥å¯¹ï¼Œå¹¶å°†å…¶é…ç½®åˆ° Debian 13 æœåŠ¡å™¨ï¼Œå®ç°å®‰å…¨çš„æ— å¯†ç ç™»å½•ã€‚\nâœ¨ ä¸»è¦ä¼˜åŠ¿ï¼š âœ… æé«˜æœåŠ¡å™¨å®‰å…¨æ€§ âœ… å…å»æ¯æ¬¡ç™»å½•è¾“å…¥å¯†ç çš„éº»çƒ¦ âœ… æ”¯æŒè‡ªåŠ¨åŒ–è„šæœ¬å’Œå·¥å…· âœ… ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ ğŸš€ ä¸€ã€åœ¨ Windows ä¸Šåˆ›å»º SSH å¯†é’¥å¯¹ 1. ğŸ“‚ æ‰“å¼€ Git Bash ç»ˆç«¯ åœ¨ Windows ä¸Šå®‰è£… Git åï¼Œå³é”®ç‚¹å‡»ä»»æ„ä½ç½®ï¼Œé€‰æ‹© \u0026ldquo;Git Bash Here\u0026rdquo; æ‰“å¼€ç»ˆç«¯\n2. ğŸ”‘ ç”Ÿæˆ SSH å¯†é’¥å¯¹ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆåä¸º Debian13_SSH çš„ RSA å¯†é’¥å¯¹ï¼š\n1 ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f ~/.ssh/Debian13_SSH å‚æ•°è¯´æ˜ï¼š\n-t rsa: æŒ‡å®šå¯†é’¥ç±»å‹ä¸º RSA -b 4096: æŒ‡å®šå¯†é’¥é•¿åº¦ä¸º 4096 ä½ï¼ˆæ›´å®‰å…¨ï¼‰ -C \u0026quot;your_email@example.com\u0026quot;: æ·»åŠ æ³¨é‡Šï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„é‚®ç®±ï¼‰ -f ~/.ssh/Debian13_SSH: æŒ‡å®šå¯†é’¥æ–‡ä»¶åç§°å’Œè·¯å¾„ ğŸ”§ äºŒã€åœ¨ Debian 13 æœåŠ¡å™¨ä¸Šé…ç½® SSH å¯†é’¥ æ–¹æ³• 1ï¼šğŸ¤– è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰ ä½¿ç”¨ ssh-copy-id å‘½ä»¤è‡ªåŠ¨å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨ï¼š\n1 ssh-copy-id -i ~/.ssh/Debian13_SSH.pub root@10.10.10.246 ç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼Œç„¶åè‡ªåŠ¨å®Œæˆé…ç½®ã€‚\næ–¹æ³• 2ï¼šğŸ› ï¸ æ‰‹åŠ¨é…ç½® 1. ğŸ‘€ æŸ¥çœ‹å…¬é’¥å†…å®¹ 1 cat ~/.ssh/Debian13_SSH.pub å¤åˆ¶è¾“å‡ºçš„å…¨éƒ¨å†…å®¹ï¼ˆä»¥ ssh-rsa å¼€å¤´çš„é•¿å­—ç¬¦ä¸²ï¼‰\n2. ğŸ” ç™»å½• Debian 13 æœåŠ¡å™¨ 1 ssh root@10.10.10.246 3. âš™ï¸ åœ¨æœåŠ¡å™¨ä¸Šé…ç½® SSH å¯†é’¥ 1 2 3 4 5 6 # åˆ›å»º .ssh ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ mkdir -p ~/.ssh chmod 700 ~/.ssh # ç¼–è¾‘ authorized_keys æ–‡ä»¶ nano ~/.ssh/authorized_keys å°†å¤åˆ¶çš„å…¬é’¥å†…å®¹ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åä¿å­˜é€€å‡ºï¼š\næŒ‰ Ctrl+X æŒ‰ Y ç¡®è®¤ä¿å­˜ æŒ‰ Enter ç¡®è®¤æ–‡ä»¶å 4. ğŸ“ è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ 1 chmod 600 ~/.ssh/authorized_keys 5. ğŸšª é€€å‡ºæœåŠ¡å™¨ 1 exit âœ… ä¸‰ã€éªŒè¯ SSH å¯†é’¥é…ç½® 1. ğŸ” ä½¿ç”¨ SSH å¯†é’¥ç™»å½• Debian æœåŠ¡å™¨ 1 ssh -i ~/.ssh/Debian13_SSH root@10.10.10.246 å¦‚æœæ— éœ€è¾“å…¥å¯†ç ç›´æ¥ç™»å½•ï¼Œåˆ™é…ç½®æˆåŠŸã€‚\nä½¿ç”¨ Ctrl+D é€€å‡º Debian ç»ˆç«¯ã€‚\n2. âš¡ ç®€åŒ– SSH ç™»å½•é…ç½® åˆ›å»ºæˆ–ç¼–è¾‘ SSH é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 cat \u0026gt;\u0026gt; ~/.ssh/config \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # Debian13_SSH é…ç½® Host debian13 HostName 10.10.10.246 User root IdentityFile ~/.ssh/Debian13_SSH ServerAliveInterval 60 ServerAliveCountMax 5 EOF # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chmod 600 ~/.ssh/config 3. ğŸ¯ ä½¿ç”¨ç®€åŒ–å‘½ä»¤ç™»å½• é…ç½®å®Œæˆåï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç™»å½•ï¼š\n1 ssh debian13 ğŸ”’ å››ã€SSH æœåŠ¡å®‰å…¨é…ç½®ï¼ˆå¯é€‰ä½†æ¨èï¼‰ 1. ğŸ“ ç¼–è¾‘ SSH æœåŠ¡å™¨é…ç½® 1 2 ssh root@10.10.10.246 nano /etc/ssh/sshd_config 2. ğŸ›¡ï¸ æ¨èçš„å®‰å…¨é…ç½® æ‰¾åˆ°å¹¶ä¿®æ”¹ä»¥ä¸‹é…ç½®é¡¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # ç¦ç”¨ root å¯†ç ç™»å½•ï¼ˆç¡®ä¿å¯†é’¥ç™»å½•æ­£å¸¸å·¥ä½œåå†å¯ç”¨ï¼‰ # PermitRootLogin prohibit-password # ç¦ç”¨å¯†ç è®¤è¯ï¼ˆç¡®ä¿å¯†é’¥ç™»å½•æ­£å¸¸å·¥ä½œåå†å¯ç”¨ï¼‰ PasswordAuthentication no # ä½¿ç”¨æ›´å®‰å…¨çš„å¯†é’¥ç®—æ³• PubkeyAuthentication yes # é™åˆ¶æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•° MaxAuthTries 3 # è®¾ç½®ç©ºé—²è¶…æ—¶æ—¶é—´ ClientAliveInterval 300 ClientAliveCountMax 2 # åªå…è®¸ç‰¹å®šç”¨æˆ·ç™»å½•ï¼ˆå¯é€‰ï¼‰ # AllowUsers root your_username # ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†ç®—æ³• Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256 3. ğŸ”„ é‡å¯ SSH æœåŠ¡ 1 systemctl restart ssh 4. ğŸ§ª æµ‹è¯•æ–°é…ç½® åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­æµ‹è¯•è¿æ¥ï¼Œç¡®ä¿é…ç½®æ­£ç¡®ï¼š\n1 ssh -v debian13 ç¡®è®¤è¿æ¥æˆåŠŸåï¼Œå†å…³é—­å½“å‰ä¼šè¯ã€‚\nğŸ›¡ï¸ äº”ã€å®‰å…¨æœ€ä½³å®è·µ 1. ğŸ” ä¿æŠ¤ç§é’¥æ–‡ä»¶ 1 2 # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chmod 600 ~/.ssh/Debian13_SSH 2. ğŸ« ä½¿ç”¨å¯†ç ä¿æŠ¤ç§é’¥ï¼ˆå¯é€‰ï¼‰ å¦‚æœæ‚¨åœ¨ç”Ÿæˆå¯†é’¥æ—¶æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ ï¼š\n1 ssh-keygen -p -f ~/.ssh/Debian13_SSH 3. ğŸ’¾ å¤‡ä»½å¯†é’¥å¯¹ å°† ~/.ssh/Debian13_SSH å’Œ ~/.ssh/Debian13_SSH.pub æ–‡ä»¶å¤‡ä»½åˆ°å®‰å…¨çš„ä½ç½®ã€‚\n4. ğŸŒ å¤šæœåŠ¡å™¨é…ç½® å¦‚æœæ‚¨æœ‰å¤šä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡å™¨åˆ›å»ºä¸åŒçš„å¯†é’¥å¯¹ï¼š\n1 ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f ~/.ssh/Server2_SSH ğŸ” å…­ã€æ•…éšœæ’é™¤ 1. ğŸš« æƒé™é—®é¢˜ å¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š\n1 2 3 4 # åœ¨ Windows Git Bash ä¸­ chmod 700 ~/.ssh chmod 600 ~/.ssh/Debian13_SSH chmod 644 ~/.ssh/Debian13_SSH.pub 2. âŒ è¿æ¥è¢«æ‹’ç» ç¡®ä¿ Debian 13 æœåŠ¡å™¨ä¸Šçš„ SSH æœåŠ¡æ­£åœ¨è¿è¡Œï¼š\n1 2 # åœ¨ Debian 13 æœåŠ¡å™¨ä¸Š systemctl status ssh 3. ğŸ” è®¤è¯å¤±è´¥ æ£€æŸ¥å…¬é’¥æ˜¯å¦æ­£ç¡®æ·»åŠ åˆ°æœåŠ¡å™¨çš„ authorized_keys æ–‡ä»¶ä¸­ï¼š\n1 2 # åœ¨ Debian 13 æœåŠ¡å™¨ä¸Š cat ~/.ssh/authorized_keys 4. ğŸ› è°ƒè¯•è¿æ¥é—®é¢˜ ä½¿ç”¨è¯¦ç»†æ¨¡å¼è¿æ¥ä»¥è¯Šæ–­é—®é¢˜ï¼š\n1 ssh -v -i ~/.ssh/Debian13_SSH root@10.10.10.246 ğŸ’¡ ä¸ƒã€é«˜çº§ç”¨æ³• 1. ğŸ¤µ ä½¿ç”¨ SSH ä»£ç†ç®¡ç†å¯†é’¥ 1 2 3 4 5 # å¯åŠ¨ SSH ä»£ç† eval \u0026#34;$(ssh-agent -s)\u0026#34; # æ·»åŠ ç§é’¥åˆ°ä»£ç† ssh-add ~/.ssh/Debian13_SSH 2. ğŸ”„ ç«¯å£è½¬å‘ é€šè¿‡ SSH å»ºç«‹å®‰å…¨éš§é“ï¼š\n1 2 3 4 5 # æœ¬åœ°ç«¯å£è½¬å‘ ssh -L 8080:localhost:80 debian13 # è¿œç¨‹ç«¯å£è½¬å‘ ssh -R 9090:localhost:3000 debian13 3. ğŸ“ SCP æ–‡ä»¶ä¼ è¾“ ä½¿ç”¨ SSH å¯†é’¥è¿›è¡Œå®‰å…¨æ–‡ä»¶ä¼ è¾“ï¼š\n1 2 3 4 5 # ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹ scp -i ~/.ssh/Debian13_SSH localfile.txt root@10.10.10.246:/path/to/destination/ # ä»è¿œç¨‹å¤åˆ¶åˆ°æœ¬åœ° scp -i ~/.ssh/Debian13_SSH root@10.10.10.246:/path/to/file.txt ./ 4. ğŸ”„ RSYNC åŒæ­¥æ–‡ä»¶ ä½¿ç”¨ RSYNC é€šè¿‡ SSH åŒæ­¥æ–‡ä»¶ï¼š\n1 rsync -avz -e \u0026#34;ssh -i ~/.ssh/Debian13_SSH\u0026#34; /local/path/ root@10.10.10.246:/remote/path/ ğŸ“š å…«ã€å¸¸ç”¨ SSH å‘½ä»¤å‚è€ƒ å‘½ä»¤ è¯´æ˜ ssh-keygen -t rsa -b 4096 ğŸ”‘ ç”Ÿæˆ RSA å¯†é’¥å¯¹ ssh-copy-id user@host ğŸ“¤ è‡ªåŠ¨å¤åˆ¶å…¬é’¥åˆ°è¿œç¨‹ä¸»æœº ssh -i key.pem user@host ğŸ” ä½¿ç”¨ç‰¹å®šå¯†é’¥è¿æ¥ ssh -v user@host ğŸ› è¯¦ç»†æ¨¡å¼è¿æ¥ï¼ˆè°ƒè¯•ç”¨ï¼‰ ssh -p 2222 user@host ğŸšª æŒ‡å®šç«¯å£è¿æ¥ ğŸš€ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»æˆåŠŸåˆ›å»ºå¹¶é…ç½®äº† SSH å¯†é’¥å¯¹ï¼Œå¯ä»¥å®ç°åˆ° Debian 13 æœåŠ¡å™¨çš„å®‰å…¨æ— å¯†ç ç™»å½•ã€‚è¿™ä¸ä»…æé«˜äº†å®‰å…¨æ€§ï¼Œè¿˜å¤§å¤§ç®€åŒ–äº†ç™»å½•è¿‡ç¨‹ï¼\n","date":"2025-08-26T20:13:56+08:00","image":"https://file.meimolihan.eu.org/img/ssh-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d1025978/","title":"Windows åˆ›å»º SSH å¯†é’¥å¯¹åŠ Debian 13 é…ç½®æŒ‡å— ğŸ”‘"},{"content":"Windows å¿«é€Ÿå®‰è£… wget æŒ‡å— ğŸš€ ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼šä»é›¶å¼€å§‹å®‰è£… Chocolatey åŒ…ç®¡ç†å™¨å¹¶é…ç½® wget å·¥å…·\nğŸ“‹ ç›®å½• ğŸªŸ ç®¡ç†å‘˜ PowerShell æ‰“å¼€æ–¹å¼ âš™ï¸ ä¸€é”®å®‰è£… Chocolatey + wget âœ… éªŒè¯å®‰è£…ä¸é…ç½® ğŸ“¥ wget ä½¿ç”¨æŒ‡å— ğŸ› ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ”§ é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ”„ æ›¿ä»£å®‰è£…æ–¹æ³• ä¸€ã€ç®¡ç†å‘˜ PowerShell æ‰“å¼€æ–¹å¼ ğŸªŸ æ–¹æ³•ä¸€ï¼šé€šè¿‡å¼€å§‹èœå• æ­¥éª¤ æ“ä½œ æˆªå›¾æç¤º 1 å³é”®ç‚¹å‡»ã€Œå¼€å§‹ã€æŒ‰é’®æˆ–æŒ‰ Win + X 2 é€‰æ‹©ã€ŒWindows PowerShellï¼ˆç®¡ç†å‘˜ï¼‰ã€ 3 å¦‚æœå‡ºç° UACï¼ˆç”¨æˆ·è´¦æˆ·æ§åˆ¶ï¼‰å¼¹çª—ï¼Œç‚¹å‡»ã€Œæ˜¯ã€ æ–¹æ³•äºŒï¼šé€šè¿‡æœç´¢æ  æŒ‰ Win + S æ‰“å¼€æœç´¢æ  è¾“å…¥ã€ŒPowerShellã€ å³ä¾§é€‰æ‹©ã€Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€ æ–¹æ³•ä¸‰ï¼šé€šè¿‡è¿è¡Œå¯¹è¯æ¡† æŒ‰ Win + R æ‰“å¼€è¿è¡Œå¯¹è¯æ¡† è¾“å…¥ã€Œpowershellã€ æŒ‰ Ctrl + Shift + Enter ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ éªŒè¯ç®¡ç†å‘˜æƒé™ åœ¨æ‰“å¼€çš„ PowerShell çª—å£ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤éªŒè¯æƒé™ï¼š\n1 whoami /groups | findstr \u0026#34;S-1-16-12288\u0026#34; å¦‚æœæ˜¾ç¤ºç»“æœä¸­åŒ…å«ã€ŒMandatory Label\\High Mandatory Levelã€ï¼Œåˆ™è¡¨ç¤ºå·²è·å¾—ç®¡ç†å‘˜æƒé™ã€‚\näºŒã€ä¸€é”®å®‰è£… Chocolatey + wget âš™ï¸ å®Œæ•´å®‰è£…è„šæœ¬ å°†ä»¥ä¸‹å®Œæ•´è„šæœ¬å¤åˆ¶-ç²˜è´´-å›è½¦å³å¯å®Œæˆå…¨éƒ¨å®‰è£…è¿‡ç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # Windows wget ä¸€é”®å®‰è£…è„šæœ¬ # ä½œè€…: Mobufan # æ—¥æœŸ: $(Get-Date -Format \u0026#34;yyyy-MM-dd\u0026#34;) Write-Host \u0026#34;å¼€å§‹å®‰è£… Chocolatey åŒ…ç®¡ç†å™¨å’Œ wget...\u0026#34; -ForegroundColor Green # 1. è®¾ç½®æ‰§è¡Œç­–ç•¥ï¼ˆå…è®¸è„šæœ¬è¿è¡Œï¼‰ Write-Host \u0026#34;æ­¥éª¤ 1/4: è®¾ç½®æ‰§è¡Œç­–ç•¥...\u0026#34; -ForegroundColor Yellow Set-ExecutionPolicy Bypass -Scope Process -Force -ErrorAction Stop # 2. è®¾ç½®å®‰å…¨åè®®ï¼ˆæ”¯æŒ TLS 1.2ï¼‰ Write-Host \u0026#34;æ­¥éª¤ 2/4: é…ç½®ç½‘ç»œå®‰å…¨åè®®...\u0026#34; -ForegroundColor Yellow [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072 # 3. å®‰è£… Chocolatey Write-Host \u0026#34;æ­¥éª¤ 3/4: å®‰è£… Chocolatey åŒ…ç®¡ç†å™¨...\u0026#34; -ForegroundColor Yellow try { $chocoInstallScript = Invoke-WebRequest -Uri \u0026#39;https://community.chocolatey.org/install.ps1\u0026#39; -UseBasicParsing -ErrorAction Stop Invoke-Expression $chocoInstallScript.Content Write-Host \u0026#34;âœ“ Chocolatey å®‰è£…æˆåŠŸ\u0026#34; -ForegroundColor Green } catch { Write-Host \u0026#34;âœ— Chocolatey å®‰è£…å¤±è´¥: $($_.Exception.Message)\u0026#34; -ForegroundColor Red exit 1 } # 4. å®‰è£… wget Write-Host \u0026#34;æ­¥éª¤ 4/4: å®‰è£… wget...\u0026#34; -ForegroundColor Yellow try { choco install wget -y --force --accept-license --no-progress Write-Host \u0026#34;âœ“ wget å®‰è£…æˆåŠŸ\u0026#34; -ForegroundColor Green } catch { Write-Host \u0026#34;âœ— wget å®‰è£…å¤±è´¥: $($_.Exception.Message)\u0026#34; -ForegroundColor Red exit 1 } # 5. åˆ·æ–°ç¯å¢ƒå˜é‡ Write-Host \u0026#34;åˆ·æ–°ç¯å¢ƒå˜é‡...\u0026#34; -ForegroundColor Yellow refreshenv Write-Host \u0026#34;å®‰è£…å®Œæˆï¼è¯·é‡å¯ PowerShell ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚\u0026#34; -ForegroundColor Green Write-Host \u0026#34;ä½¿ç”¨ \u0026#39;wget --version\u0026#39; éªŒè¯å®‰è£…ã€‚\u0026#34; -ForegroundColor Cyan åˆ†æ­¥å®‰è£…è¯´æ˜ å¦‚æœæ‚¨æƒ³äº†è§£æ¯ä¸ªæ­¥éª¤çš„ä½œç”¨ï¼Œå¯ä»¥åˆ†æ­¥æ‰§è¡Œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ­¥éª¤ 1: å…è®¸ PowerShell æ‰§è¡Œè„šæœ¬ Set-ExecutionPolicy Bypass -Scope Process -Force # æ­¥éª¤ 2: å¯ç”¨ TLS 1.2 æ”¯æŒï¼ˆè§£å†³æŸäº›ç½‘ç»œç¯å¢ƒé—®é¢˜ï¼‰ [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072 # æ­¥éª¤ 3: ä¸‹è½½å¹¶å®‰è£… Chocolatey Invoke-Expression ((New-Object System.Net.WebClient).DownloadString(\u0026#39;https://community.chocolatey.org/install.ps1\u0026#39;)) # æ­¥éª¤ 4: ä½¿ç”¨ Chocolatey å®‰è£… wget choco install wget -y # æ­¥éª¤ 5: åˆ·æ–°ç¯å¢ƒå˜é‡ refreshenv ä¸‰ã€éªŒè¯å®‰è£…ä¸é…ç½® âœ… åŸºæœ¬éªŒè¯ å®‰è£…å®Œæˆåï¼Œé‡å¯ PowerShell å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯å®‰è£…ï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥ Chocolatey ç‰ˆæœ¬ choco --version # æ£€æŸ¥ wget ç‰ˆæœ¬ wget --version # æ£€æŸ¥ wget å¸®åŠ©ä¿¡æ¯ wget --help | more ç¯å¢ƒå˜é‡éªŒè¯ ç¡®ä¿ wget å·²æ­£ç¡®æ·»åŠ åˆ°ç³»ç»Ÿ PATH ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥ wget å¯æ‰§è¡Œæ–‡ä»¶ä½ç½® Get-Command wget | Format-List # æ£€æŸ¥ PATH ç¯å¢ƒå˜é‡ $env:PATH -split \u0026#39;;\u0026#39; | Select-String \u0026#39;chocolatey\u0026#39; # æ‰‹åŠ¨æ·»åŠ  Chocolatey bin ç›®å½•åˆ° PATHï¼ˆå¦‚æœéœ€è¦ï¼‰ $chocoPath = \u0026#34;$env:ProgramData\\chocolatey\\bin\u0026#34; if ($env:PATH -notcontains $chocoPath) { [Environment]::SetEnvironmentVariable(\u0026#34;PATH\u0026#34;, \u0026#34;$env:PATH;$chocoPath\u0026#34;, [EnvironmentVariableTarget]::Machine) Write-Host \u0026#34;å·²æ·»åŠ  Chocolatey åˆ°ç³»ç»Ÿ PATH\u0026#34; -ForegroundColor Green } æµ‹è¯•ä¸‹è½½åŠŸèƒ½ éªŒè¯ wget æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œï¼š\n1 2 3 4 5 6 7 8 # æµ‹è¯•ä¸‹è½½ä¸€ä¸ªå°æ–‡ä»¶ wget -O test-download.txt \u0026#34;https://httpbin.org/get\u0026#34; # æ£€æŸ¥ä¸‹è½½çš„æ–‡ä»¶ Get-Content test-download.txt # æ¸…ç†æµ‹è¯•æ–‡ä»¶ Remove-Item test-download.txt -Force å››ã€wget ä½¿ç”¨æŒ‡å— ğŸ“¥ åŸºæœ¬ä¸‹è½½å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # åŸºæœ¬ä¸‹è½½ wget https://example.com/file.zip # æŒ‡å®šè¾“å‡ºæ–‡ä»¶å wget -O custom-name.zip https://example.com/file.zip # æ–­ç‚¹ç»­ä¼ ï¼ˆç»§ç»­æœªå®Œæˆçš„ä¸‹è½½ï¼‰ wget -c https://example.com/large-file.iso # åå°ä¸‹è½½ wget -b https://example.com/large-file.iso é«˜çº§ä¸‹è½½é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é™é€Ÿä¸‹è½½ï¼ˆé™åˆ¶ä¸º 100k/sï¼‰ wget --limit-rate=100k https://example.com/large-file.iso # é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤ 20 æ¬¡ï¼‰ wget -t 5 https://example.com/file.zip # è¶…æ—¶è®¾ç½®ï¼ˆå•ä½ï¼šç§’ï¼‰ wget -T 30 https://example.com/file.zip # é€’å½’ä¸‹è½½æ•´ä¸ªç½‘ç«™ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ wget -r -l 2 https://example.com/ # é•œåƒç½‘ç«™ï¼ˆä¿ç•™ç›®å½•ç»“æ„ï¼‰ wget -mk https://example.com/ å®ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # ä¸‹è½½ Docker é•œåƒå¤‡ä»½ wget -c \u0026#34;https://dufs.mobufan.eu.org:666/file/myfile/docker/tvhelper.tar\u0026#34; # ä¸‹è½½å¤šä¸ªæ–‡ä»¶ wget -i files.txt # files.txt åŒ…å«å¤šä¸ª URL # ä½¿ç”¨ä»£ç†ä¸‹è½½ wget -e use_proxy=yes -e http_proxy=127.0.0.1:8080 https://example.com/file.zip # ä¸‹è½½æ—¶å¿½ç•¥è¯ä¹¦é”™è¯¯ï¼ˆä¸å®‰å…¨ï¼Œä»…æµ‹è¯•ç”¨ï¼‰ wget --no-check-certificate https://example.com/file.zip ä¸ PowerShell ç»“åˆä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 # åœ¨ PowerShell è„šæœ¬ä¸­ä½¿ç”¨ wget $url = \u0026#34;https://example.com/file.zip\u0026#34; $output = \u0026#34;downloaded-file.zip\u0026#34; if (Get-Command wget -ErrorAction SilentlyContinue) { wget -O $output $url Write-Host \u0026#34;ä¸‹è½½å®Œæˆ: $output\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;wget æœªå®‰è£…ï¼Œä½¿ç”¨ PowerShell æ›¿ä»£æ–¹æ³•\u0026#34; -ForegroundColor Yellow Invoke-WebRequest -Uri $url -OutFile $output } äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ› ï¸ å®‰è£…é—®é¢˜ é—®é¢˜ç°è±¡ è§£å†³æ–¹æ¡ˆ æ— æ³•è¯†åˆ« choco å‘½ä»¤ å…³é—­å¹¶é‡æ–°æ‰“å¼€ PowerShellï¼Œæˆ–è¿è¡Œ refreshenv wget ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ æ£€æŸ¥ Chocolatey bin ç›®å½•æ˜¯å¦åœ¨ PATH ä¸­ æ‰§è¡Œç­–ç•¥é”™è¯¯ ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼šSet-ExecutionPolicy RemoteSigned -Scope CurrentUser ç½‘ç»œè¿æ¥è¶…æ—¶ æ£€æŸ¥ä»£ç†è®¾ç½®æˆ–å°è¯•ä½¿ç”¨é•œåƒæº ç½‘ç»œé—®é¢˜è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 # è®¾ç½® Chocolatey ä»£ç† choco config set proxy http://proxy.example.com:8080 # å–æ¶ˆä»£ç†è®¾ç½® choco config unset proxy # ä½¿ç”¨é•œåƒæºåŠ é€Ÿä¸‹è½½ choco config set cacheLocation C:\\choco-cache æƒé™é—®é¢˜ 1 2 3 4 5 # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell Start-Process powershell -Verb RunAs # ä¿®å¤ Chocolatey å®‰è£…æƒé™ icacls \u0026#34;$env:ProgramData\\chocolatey\u0026#34; /reset /T Chocolatey æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ Chocolatey çŠ¶æ€ choco list --local-only # ä¿®å¤ Chocolatey å®‰è£… choco upgrade chocolatey -y # æ¸…ç† Chocolatey ç¼“å­˜ choco optimize --reduce-nupkg-only å…­ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ”§ ç¯å¢ƒå˜é‡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # æ°¸ä¹…è®¾ç½® Chocolatey ç¯å¢ƒå˜é‡ [Environment]::SetEnvironmentVariable(\u0026#34;ChocolateyInstall\u0026#34;, \u0026#34;$env:ProgramData\\chocolatey\u0026#34;, [EnvironmentVariableTarget]::Machine) [Environment]::SetEnvironmentVariable(\u0026#34;PATH\u0026#34;, \u0026#34;$env:PATH;$env:ProgramData\\chocolatey\\bin\u0026#34;, [EnvironmentVariableTarget]::Machine) # è‡ªå®šä¹‰ wget é…ç½®æ–‡ä»¶ $wgetrcPath = \u0026#34;$env:USERPROFILE\\.wgetrc\u0026#34; @\u0026#34; # é»˜è®¤è®¾ç½® quiet = on dir_prefix = ./ progress = bar \u0026#34;@ | Set-Content -Path $wgetrcPath -Force æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 # è®¾ç½® wget å¹¶å‘è¿æ¥æ•° wget --span-hosts --level=inf --recursive --no-parent --no-clobber --page-requisites --adjust-extension --convert-links --restrict-file-names=windows --random-wait -e robots=off --user-agent=\u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\u0026#34; https://example.com/ # ä½¿ç”¨ aria2 åŠ é€Ÿä¸‹è½½ï¼ˆå¦‚å·²å®‰è£…ï¼‰ choco install aria2 -y å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»º Chocolatey å®‰è£…éªŒè¯è„šæœ¬ $verificationScript = @\u0026#34; # éªŒè¯ Chocolatey å®‰è£… if (-not (Get-Command choco -ErrorAction SilentlyContinue)) { Write-Error \u0026#34;Chocolatey æœªæ­£ç¡®å®‰è£…\u0026#34; exit 1 } # éªŒè¯ wget å®‰è£… if (-not (Get-Command wget -ErrorAction SilentlyContinue)) { Write-Error \u0026#34;wget æœªæ­£ç¡®å®‰è£…\u0026#34; exit 1 } Write-Host \u0026#34;æ‰€æœ‰ç»„ä»¶éªŒè¯é€šè¿‡\u0026#34; -ForegroundColor Green \u0026#34;@ Set-Content -Path \u0026#34;$env:USERPROFILE\\verify-install.ps1\u0026#34; -Value $verificationScript ä¸ƒã€æ›¿ä»£å®‰è£…æ–¹æ³• ğŸ”„ æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨å®‰è£… wgetï¼ˆæ— éœ€ Chocolateyï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä¸‹è½½å®˜æ–¹ wget for Windows $wgetUrl = \u0026#34;https://eternallybored.org/misc/wget/current/wget.exe\u0026#34; $wgetPath = \u0026#34;$env:SYSTEMROOT\\System32\\wget.exe\u0026#34; try { Invoke-WebRequest -Uri $wgetUrl -OutFile $wgetPath -ErrorAction Stop Write-Host \u0026#34;wget æ‰‹åŠ¨å®‰è£…æˆåŠŸ\u0026#34; -ForegroundColor Green } catch { Write-Host \u0026#34;æ‰‹åŠ¨å®‰è£…å¤±è´¥: $($_.Exception.Message)\u0026#34; -ForegroundColor Red } # éªŒè¯æ‰‹åŠ¨å®‰è£… if (Test-Path $wgetPath) { Write-Host \u0026#34;wget å·²å®‰è£…åˆ°: $wgetPath\u0026#34; -ForegroundColor Green } æ–¹æ³•äºŒï¼šä½¿ç”¨ Scoop åŒ…ç®¡ç†å™¨ 1 2 3 4 5 6 7 8 9 # å®‰è£… Scoop Set-ExecutionPolicy RemoteSigned -Scope CurrentUser Invoke-RestMethod -Uri https://get.scoop.sh | Invoke-Expression # ä½¿ç”¨ Scoop å®‰è£… wget scoop install wget # éªŒè¯ Scoop å®‰è£… scoop list æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Wingetï¼ˆWindows å®˜æ–¹åŒ…ç®¡ç†å™¨ï¼‰ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ Winget æ˜¯å¦å¯ç”¨ if (Get-Command winget -ErrorAction SilentlyContinue) { # ä½¿ç”¨ Winget å®‰è£… wget winget install -e --id GnuWin32.Wget Write-Host \u0026#34;å·²ä½¿ç”¨ Winget å®‰è£… wget\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;Winget ä¸å¯ç”¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–æ–¹æ³•\u0026#34; -ForegroundColor Yellow } æ–¹æ³•æ¯”è¾ƒ æ–¹æ³• ä¼˜ç‚¹ ç¼ºç‚¹ æ¨èåº¦ Chocolatey è½¯ä»¶ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒ éœ€è¦ç®¡ç†å‘˜æƒé™ â­â­â­â­â­ æ‰‹åŠ¨å®‰è£… ç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–å·¥å…· éœ€è¦æ‰‹åŠ¨æ›´æ–° â­â­â­ Scoop ç”¨æˆ·çº§å®‰è£…ï¼Œæ— éœ€ç®¡ç†å‘˜ è½¯ä»¶åº“ç›¸å¯¹è¾ƒå° â­â­â­â­ Winget å¾®è½¯å®˜æ–¹ï¼Œç³»ç»Ÿé›†æˆ è½¯ä»¶æ•°é‡æœ‰é™ â­â­â­â­ ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š\nå¤šç§æ–¹å¼åœ¨ Windows ä¸Šå®‰è£… wget å·¥å…· ä¸€é”®è„šæœ¬å¿«é€Ÿå®‰è£… Chocolatey + wget éªŒè¯æ–¹æ³•ç¡®ä¿å®‰è£…æ­£ç¡®æ— è¯¯ ä½¿ç”¨æŠ€å·§å……åˆ†å‘æŒ¥ wget çš„åŠŸèƒ½ æ•…éšœæ’é™¤è§£å†³å¸¸è§å®‰è£…é—®é¢˜ æ›¿ä»£æ–¹æ¡ˆåº”å¯¹ä¸åŒç¯å¢ƒéœ€æ±‚ ç°åœ¨æ‚¨å¯ä»¥äº«å— Linux é£æ ¼çš„ä¸‹è½½ä½“éªŒäº†ï¼ä½¿ç”¨ wget -c URL å¼€å§‹æ‚¨çš„ä¸‹è½½ä¹‹æ—…å§ï¼ğŸš€\nğŸ’¡ æç¤ºï¼šå»ºè®®å®šæœŸæ›´æ–° Chocolatey å’Œå·²å®‰è£…çš„è½¯ä»¶åŒ…ï¼š\n1 choco upgrade all -y ","date":"2025-08-26T20:09:04+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b2c394b6/","title":"Windows å¿«é€Ÿå®‰è£… wget æŒ‡å— ğŸš€"},{"content":"WSL ä¸»æœºåä¿®æ”¹æŒ‡å— ğŸ–¥ï¸ ğŸ§ è½»æ¾è‡ªå®šä¹‰ WSL ä¸»æœºåï¼Œæ‰“é€ ä¸ªæ€§åŒ–çš„ Linux å¼€å‘ç¯å¢ƒ\nâœ¨ WSL ä¸»æœºåä¿®æ”¹ç‰¹ç‚¹ ğŸ¯ ç®€å•æ˜“ç”¨: åªéœ€å‡ ä¸ªå‘½ä»¤å³å¯å®Œæˆä¸»æœºåä¿®æ”¹ ğŸ”§ å®Œå…¨æ§åˆ¶: å¯è‡ªå®šä¹‰ä»»æ„å–œæ¬¢çš„ä¸»æœºå âš¡ å³æ—¶ç”Ÿæ•ˆ: ä¿®æ”¹åæ— éœ€é‡å¯è®¡ç®—æœº ğŸ“Š å¤šå‘è¡Œç‰ˆæ”¯æŒ: é€‚ç”¨äºæ‰€æœ‰ WSL å‘è¡Œç‰ˆï¼ˆUbuntuã€Debianã€Kali ç­‰ï¼‰ ğŸ”’ å®‰å…¨å¯é : ä¸ä¼šå½±å“ Windows ä¸»æœºç³»ç»Ÿ ğŸ“– ç›®å½•å¯¼èˆª ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ”§ è¯¦ç»†è¯´æ˜ ğŸ› ï¸ éªŒè¯æ›´æ”¹ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”„ é¢å¤–æŠ€å·§ ğŸ“ æ•…éšœæ’é™¤ ğŸŒ å¤šå‘è¡Œç‰ˆç®¡ç† ğŸš€ å¿«é€Ÿå¼€å§‹ 1. å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ 1 2 3 4 5 # å¯åŠ¨ Debian å‘è¡Œç‰ˆ wsl.exe -d Debian # æˆ–è€…ä½¿ç”¨ç®€å†™æ–¹å¼ wsl -d Debian 2. ä¿®æ”¹ wsl.conf é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 # åˆ›å»ºæˆ–ä¿®æ”¹ wsl.conf æ–‡ä»¶ sudo tee /etc/wsl.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [network] hostname = Debian generateHosts = false EOF 3. æ›´æ–°ä¸»æœºåæ–‡ä»¶ 1 2 # æ›´æ–° hostname æ–‡ä»¶ echo \u0026#34;Debian\u0026#34; | sudo tee /etc/hostname 4. ä¿®æ”¹ hosts æ–‡ä»¶ 1 2 3 4 5 # å¤‡ä»½åŸ hosts æ–‡ä»¶ sudo cp /etc/hosts /etc/hosts.backup # ç¼–è¾‘ hosts æ–‡ä»¶ sudo nano /etc/hosts å°†æ–‡ä»¶ä¸­çš„æ—§ä¸»æœºåæ›¿æ¢ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 127.0.0.1 localhost 127.0.1.1 Debian.localdomain Debian # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters æŒ‰ Ctrl+Xï¼Œç„¶åæŒ‰ Y å’Œ Enter ä¿å­˜å¹¶é€€å‡ºã€‚\n5. é‡å¯ WSL 1 2 3 4 5 # åœ¨ PowerShell æˆ–å‘½ä»¤æç¤ºç¬¦ä¸­æ‰§è¡Œ wsl --shutdown # ç­‰å¾…å‡ ç§’åé‡æ–°å¯åŠ¨ WSL wsl -d Debian ç°åœ¨æ‚¨çš„ä¸»æœºååº”è¯¥å·²æˆåŠŸæ›´æ”¹ä¸º \u0026ldquo;Debian\u0026rdquo;!\nğŸ”§ è¯¦ç»†è¯´æ˜ ğŸ“ wsl.conf æ–‡ä»¶è¯¦è§£ /etc/wsl.conf æ˜¯ WSL çš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«å¤šä¸ªé…ç½®èŠ‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ç½‘ç»œé…ç½®èŠ‚ [network] hostname = Debian # è®¾ç½®ä¸»æœºå generateHosts = false # ç¦æ­¢è‡ªåŠ¨ç”Ÿæˆ hosts æ–‡ä»¶ # å¯åŠ¨é…ç½®èŠ‚ [boot] systemd = true # å¯ç”¨ systemdï¼ˆWSL 2ï¼‰ # ç”¨æˆ·é…ç½®èŠ‚ [user] default = username # è®¾ç½®é»˜è®¤ç”¨æˆ· # äº’æ“ä½œé…ç½®èŠ‚ [interop] enabled = true # å¯ç”¨ Windows äº’æ“ä½œ appendWindowsPath = true # å°† Windows PATH æ·»åŠ åˆ° Linux PATH ğŸ“ ä¸»æœºåæ–‡ä»¶è¯´æ˜ /etc/hostname æ–‡ä»¶åŒ…å«ç³»ç»Ÿçš„ä¸»æœºåã€‚è¿™ä¸ªæ–‡ä»¶é€šå¸¸åªåŒ…å«ä¸€è¡Œæ–‡æœ¬ï¼Œå³ä¸»æœºåã€‚\n1 2 3 4 5 # æŸ¥çœ‹å½“å‰ä¸»æœºå cat /etc/hostname # ç›´æ¥ä¿®æ”¹ä¸»æœºåæ–‡ä»¶ sudo nano /etc/hostname ğŸŒ hosts æ–‡ä»¶è§£æ /etc/hosts æ–‡ä»¶ç”¨äºæœ¬åœ°ä¸»æœºåè§£æï¼Œä¼˜å…ˆçº§é«˜äº DNS æŸ¥è¯¢ã€‚æ ¼å¼å¦‚ä¸‹ï¼š\n1 IPåœ°å€ å®Œæ•´é™å®šåŸŸå ä¸»æœºå ğŸ› ï¸ éªŒè¯æ›´æ”¹ é‡æ–°å¯åŠ¨ WSL åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ä¸»æœºåæ˜¯å¦å·²æˆåŠŸæ›´æ”¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŸ¥çœ‹å½“å‰ä¸»æœºå hostname # æŸ¥çœ‹å®Œæ•´ä¸»æœºä¿¡æ¯ hostnamectl # æ£€æŸ¥ä¸»æœºåçŠ¶æ€ hostnamectl status # æ£€æŸ¥ hosts æ–‡ä»¶æ˜¯å¦æ­£ç¡® cat /etc/hosts # æµ‹è¯•æœ¬åœ°ä¸»æœºåè§£æ ping -c 1 Debian ping -c 1 Debian.localdomain # æŸ¥çœ‹ç½‘ç»œé…ç½® ip addr show é¢„æœŸè¾“å‡ºç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ hostname Debian $ hostnamectl Static hostname: Debian Icon name: computer-vm Chassis: vm Machine ID: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx Boot ID: yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy Virtualization: microsoft Operating System: Debian GNU/Linux 11 (bullseye) Kernel: Linux 5.10.102.1-microsoft-standard-WSL2 Architecture: x86-64 âš ï¸ æ³¨æ„äº‹é¡¹ æƒé™è¦æ±‚: ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œä½¿ç”¨ sudo å‘½ä»¤ æ–‡ä»¶å¤‡ä»½: ä¿®æ”¹å‰å»ºè®®å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 2 3 sudo cp /etc/wsl.conf /etc/wsl.conf.backup sudo cp /etc/hostname /etc/hostname.backup sudo cp /etc/hosts /etc/hosts.backup åº”ç”¨å…¼å®¹æ€§: æŸäº›åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦é‡å¯æ‰èƒ½è¯†åˆ«æ–°çš„ä¸»æœºå ç½‘ç»œå½±å“: ä¸»æœºåæ›´æ”¹å¯èƒ½å½±å“æœ¬åœ°ç½‘ç»œæœåŠ¡é…ç½® WSL ç‰ˆæœ¬: ç¡®ä¿ä½¿ç”¨ WSL 2 ä»¥è·å¾—æœ€ä½³å…¼å®¹æ€§ 1 2 wsl --list --verbose wsl --set-version \u0026lt;Distribution\u0026gt; 2 å­—ç¬¦é™åˆ¶: ä¸»æœºååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦ï¼Œä¸èƒ½ä»¥ä¸‹åˆ’çº¿æˆ–æ•°å­—å¼€å¤´ ğŸ”„ é¢å¤–æŠ€å·§ ğŸ”§ ä¸€é”®ä¿®æ”¹è„šæœ¬ åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬ç®€åŒ–ä¿®æ”¹è¿‡ç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #!/bin/bash # change_wsl_hostname.sh if [ $# -eq 0 ]; then echo \u0026#34;Usage: $0 \u0026lt;new_hostname\u0026gt;\u0026#34; exit 1 fi NEW_HOSTNAME=$1 # å¤‡ä»½åŸæ–‡ä»¶ sudo cp /etc/wsl.conf /etc/wsl.conf.backup.$(date +%Y%m%d) sudo cp /etc/hostname /etc/hostname.backup.$(date +%Y%m%d) sudo cp /etc/hosts /etc/hosts.backup.$(date +%Y%m%d) # æ›´æ–° wsl.conf sudo tee /etc/wsl.conf \u0026gt; /dev/null \u0026lt;\u0026lt;EOF [network] hostname = $NEW_HOSTNAME generateHosts = false EOF # æ›´æ–° hostname echo \u0026#34;$NEW_HOSTNAME\u0026#34; | sudo tee /etc/hostname \u0026gt; /dev/null # æ›´æ–° hosts sudo sed -i \u0026#34;s/127.0.1.1.*/127.0.1.1\\t${NEW_HOSTNAME}.localdomain\\t${NEW_HOSTNAME}/\u0026#34; /etc/hosts echo \u0026#34;Hostname changed to: $NEW_HOSTNAME\u0026#34; echo \u0026#34;Please restart WSL with: wsl --shutdown\u0026#34; ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 3 4 5 # èµ‹äºˆæ‰§è¡Œæƒé™ chmod +x change_wsl_hostname.sh # è¿è¡Œè„šæœ¬ sudo ./change_wsl_hostname.sh MyDebian ğŸ¨ ä¸ªæ€§åŒ–ä¸»é¢˜ä¸æç¤ºç¬¦ ä¿®æ”¹ä¸»æœºååï¼Œå¯ä»¥æ›´æ–° shell æç¤ºç¬¦ä»¥æ˜¾ç¤ºæ–°ä¸»æœºåï¼š\n1 2 3 4 5 6 7 # ç¼–è¾‘ ~/.bashrc æ–‡ä»¶ nano ~/.bashrc # æ‰¾åˆ° PS1 å˜é‡ï¼Œä¿®æ”¹ä¸»æœºåéƒ¨åˆ† # åŸå¯èƒ½ä¸º: \\h (è¡¨ç¤ºä¸»æœºå) # ä¿®æ”¹ä¸ºè‡ªå®šä¹‰æ ¼å¼ï¼Œä¾‹å¦‚: # PS1=\u0026#39;${debian_chroot:+($debian_chroot)}\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[00m\\]\\$ \u0026#39; ğŸ“¦ å®‰è£…è¾…åŠ©å·¥å…· 1 2 3 4 5 6 7 8 9 # å®‰è£… neofetch æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ sudo apt update \u0026amp;\u0026amp; sudo apt install neofetch # ä½¿ç”¨ neofetch æ˜¾ç¤ºæ–°ä¸»æœºå neofetch # å®‰è£… screenfetch æ›¿ä»£æ–¹æ¡ˆ sudo apt install screenfetch screenfetch ğŸ“ æ•…éšœæ’é™¤ ğŸ” å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ä¸»æœºåä¿®æ”¹æœªç”Ÿæ•ˆ\n1 2 3 4 5 # å®Œå…¨å…³é—­ WSL wsl --shutdown # ç­‰å¾… 10 ç§’åé‡æ–°å¯åŠ¨ wsl -d Debian ç½‘ç»œè¿æ¥é—®é¢˜\n1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ç½‘ç»œé…ç½® cat /etc/wsl.conf cat /etc/hosts # æ£€æŸ¥ resolv.conf cat /etc/resolv.conf # é‡å¯ç½‘ç»œæœåŠ¡ (å¦‚æœä½¿ç”¨ systemd) sudo systemctl restart systemd-networkd æƒé™é”™è¯¯\n1 2 3 4 5 6 7 8 9 10 # ç¡®ä¿ä½¿ç”¨ sudo sudo echo \u0026#34;Debian\u0026#34; \u0026gt; /etc/hostname # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -l /etc/hostname /etc/hosts /etc/wsl.conf # ä¿®æ­£æƒé™ sudo chmod 644 /etc/hostname sudo chmod 644 /etc/hosts sudo chmod 644 /etc/wsl.conf ** hosts æ–‡ä»¶é”™è¯¯**\n1 2 # æ¢å¤é»˜è®¤ hosts æ–‡ä»¶ echo -e \u0026#34;127.0.0.1\\tlocalhost\\n127.0.1.1\\tDebian.localdomain\\tDebian\\n\\n# The following lines are desirable for IPv6 capable hosts\\n::1\\tip6-localhost ip6-loopback\\nfe00::0 ip6-localnet\\nff00::0 ip6-mcastprefix\\nff02::1 ip6-allnodes\\nff02::2 ip6-allrouters\u0026#34; | sudo tee /etc/hosts WSL å¯åŠ¨å¤±è´¥\n1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ WSL çŠ¶æ€ wsl --status # é‡å¯ WSL æœåŠ¡ net stop LxssManager net start LxssManager # é‡ç½® WSL (è°¨æ…ä½¿ç”¨ï¼Œä¼šåˆ é™¤æ‰€æœ‰æ•°æ®) wsl --unregister Debian ğŸ“‹ è¯Šæ–­å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— sudo dmesg | grep -i hostname # æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¥å¿— journalctl -b | grep -i hostname # æµ‹è¯•ä¸»æœºåè§£æ getent hosts Debian getent hosts Debian.localdomain # æ£€æŸ¥æ‰€æœ‰ç›¸å…³é…ç½® sudo grep -r \u0026#34;hostname\u0026#34; /etc/ ğŸŒ å¤šå‘è¡Œç‰ˆç®¡ç† å¦‚æœæ‚¨å®‰è£…äº†å¤šä¸ª WSL å‘è¡Œç‰ˆï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå‘è¡Œç‰ˆè®¾ç½®ç‹¬ç‰¹çš„ä¸»æœºåï¼š\nğŸ“Š æŸ¥çœ‹å·²å®‰è£…çš„å‘è¡Œç‰ˆ 1 2 3 4 5 6 7 wsl --list --verbose # ç¤ºä¾‹è¾“å‡º: # NAME STATE VERSION # * Debian Running 2 # Ubuntu-20.04 Stopped 2 # Kali-Linux Stopped 2 ğŸ·ï¸ ä¸ºä¸åŒå‘è¡Œç‰ˆè®¾ç½®ä¸åŒä¸»æœºå å¯åŠ¨ç‰¹å®šå‘è¡Œç‰ˆ\n1 wsl -d Ubuntu-20.04 ä¿®æ”¹è¯¥å‘è¡Œç‰ˆçš„ä¸»æœºå\n1 2 3 4 5 6 7 8 9 sudo tee /etc/wsl.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [network] hostname = MyUbuntu generateHosts = false EOF echo \u0026#34;MyUbuntu\u0026#34; | sudo tee /etc/hostname sudo sed -i \u0026#39;s/127.0.1.1.*/127.0.1.1\\tMyUbuntu.localdomain\\tMyUbuntu/\u0026#39; /etc/hosts é‡å¯è¯¥å‘è¡Œç‰ˆ\n1 2 wsl --terminate Ubuntu-20.04 wsl -d Ubuntu-20.04 ğŸ”„ æ‰¹é‡ç®¡ç†è„šæœ¬ 1 2 3 4 5 6 7 8 # PowerShell è„šæœ¬ï¼šä¸ºæ‰€æœ‰ WSL å‘è¡Œç‰ˆè®¾ç½®ä¸»æœºå $distros = wsl --list --quiet foreach ($distro in $distros) { Write-Host \u0026#34;Setting hostname for $distro...\u0026#34; wsl -d $distro --exec sudo sh -c \u0026#34;echo \u0026#39;$distro\u0026#39; \u0026gt; /etc/hostname\u0026#34; wsl -d $distro --exec sudo sed -i \\\u0026#34;s/127.0.1.1.*/127.0.1.1\\t$distro.localdomain\\t$distro/\\\u0026#34; /etc/hosts } ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æŒæ¡äº†åœ¨ WSL ä¸­ä¿®æ”¹ä¸»æœºåçš„å®Œæ•´æµç¨‹ï¼š\nâœ… å®Œæˆçš„ä»»åŠ¡ï¼š ç†è§£åŸç†: äº†è§£äº† WSL ä¸»æœºåç®¡ç†æœºåˆ¶ æŒæ¡æ–¹æ³•: å­¦ä¼šäº†ä¸‰ç§é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æ–¹æ³• éªŒè¯ç»“æœ: æŒæ¡äº†éªŒè¯ä¸»æœºåæ›´æ”¹çš„æŠ€å·§ æ•…éšœæ’é™¤: å­¦ä¼šäº†è§£å†³å¸¸è§é—®é¢˜çš„æ–¹æ³• é«˜çº§åº”ç”¨: äº†è§£äº†å¤šå‘è¡Œç‰ˆä¸»æœºåç®¡ç† ğŸŒŸ æœ€ä½³å®è·µï¼š å®šæœŸå¤‡ä»½: ä¿®æ”¹å‰å¤‡ä»½é…ç½®æ–‡ä»¶ å½»åº•é‡å¯: ä½¿ç”¨ wsl --shutdown ç¡®ä¿æ›´æ”¹ç”Ÿæ•ˆ å…¨é¢éªŒè¯: ä½¿ç”¨å¤šç§å‘½ä»¤éªŒè¯æ›´æ”¹ç»“æœ æ–‡æ¡£ç»´æŠ¤: è®°å½•é‡è¦æ›´æ”¹ä»¥ä¾¿åç»­ç»´æŠ¤ ğŸ”œ ä¸‹ä¸€æ­¥å»ºè®®ï¼š æ¢ç´¢ WSL å…¶ä»–é…ç½®é€‰é¡¹ï¼Œå¦‚å†…å­˜é™åˆ¶ã€GPU æ”¯æŒç­‰ å­¦ä¹ ä½¿ç”¨ Windows Terminal å¢å¼º WSL ä½“éªŒ é…ç½® SSH æœåŠ¡å®ç°è¿œç¨‹è®¿é—® WSL è®¾ç½®å¼€å‘ç¯å¢ƒå˜é‡å’Œåˆ«åæé«˜å·¥ä½œæ•ˆç‡ ç°åœ¨æ‚¨å·²ç»æˆåŠŸè‡ªå®šä¹‰äº† WSL ä¸»æœºåï¼Œäº«å—æ‚¨ä¸ªæ€§åŒ–çš„ Linux å¼€å‘ç¯å¢ƒå§ï¼ğŸ‰\nğŸ’¡ æç¤º: å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–è®¿é—® WSL å®˜æ–¹æ–‡æ¡£ ","date":"2025-08-26T20:04:58+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/fa4561df/","title":"WSL ä¸»æœºåä¿®æ”¹æŒ‡å— ğŸ–¥ï¸"},{"content":"WSL å®‰è£… Debian å®Œå…¨æŒ‡å— ğŸ§ ğŸš€ åœ¨ Windows ä¸Šæ— ç¼è¿è¡Œå®Œæ•´çš„ Debian Linux ç¯å¢ƒï¼Œäº«å—åŒç³»ç»Ÿçš„æœ€ä½³ä½“éªŒ\nâœ¨ WSL ä¸ Debian ç»“åˆçš„ä¼˜åŠ¿ âš¡ æ¥è¿‘åŸç”Ÿæ€§èƒ½: WSL 2 æä¾›å®Œæ•´çš„ Linux å†…æ ¸ï¼Œæ€§èƒ½æ¥è¿‘åŸç”Ÿ Linux ğŸ¯ å¼€å‘å‹å¥½: å®Œç¾æ”¯æŒå„ç§å¼€å‘ç¯å¢ƒå’Œå·¥å…·é“¾ ğŸ”„ æ— ç¼é›†æˆ: åœ¨ Windows å’Œ Linux ä¹‹é—´è½»æ¾å…±äº«æ–‡ä»¶å’Œèµ„æº ğŸ“¦ ç”Ÿæ€ä¸°å¯Œ: è®¿é—® Debian åºå¤§çš„è½¯ä»¶ä»“åº“ ğŸ›¡ï¸ å®‰å…¨éš”ç¦»: Linux ç¯å¢ƒä¸ Windows ç³»ç»Ÿéš”ç¦»ï¼Œäº’ä¸å¹²æ‰° ğŸ’¾ èµ„æºé«˜æ•ˆ: æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´è½»é‡ï¼Œå¯åŠ¨æ›´å¿« ğŸ“– ç›®å½•å¯¼èˆª ğŸ”§ ä¸€ã€å¯ç”¨ WSL åŠŸèƒ½ ğŸ“¦ äºŒã€å®‰è£… Debian ğŸš€ ä¸‰ã€åŸºæœ¬æ“ä½œå’Œç®¡ç† âš™ï¸ å››ã€é«˜çº§é…ç½® ğŸ¯ äº”ã€å¼€å‘ç¯å¢ƒé…ç½® ğŸ”„ å…­ã€å¤‡ä»½å’Œæ¢å¤ ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ ğŸ› ï¸ å…«ã€æ•…éšœæ’é™¤ ğŸ“š ä¹ã€å­¦ä¹ èµ„æº ğŸ”§ ä¸€ã€å¯ç”¨ WSL åŠŸèƒ½ 1. ç³»ç»Ÿè¦æ±‚æ£€æŸ¥ åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nWindows 10 ç‰ˆæœ¬ 2004 åŠæ›´é«˜ç‰ˆæœ¬ï¼ˆBuild 19041 åŠä»¥ä¸Šï¼‰æˆ– Windows 11 64 ä½æ“ä½œç³»ç»Ÿ è™šæ‹ŸåŒ–åŠŸèƒ½å·²åœ¨ BIOS/UEFI ä¸­å¯ç”¨ 2. å¯ç”¨ WSL åŠŸèƒ½ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShellï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # å¯ç”¨ Linux å­ç³»ç»ŸåŠŸèƒ½ dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart # å¯ç”¨è™šæ‹Ÿæœºå¹³å°åŠŸèƒ½ dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart # è®¾ç½® WSL 2 ä¸ºé»˜è®¤ç‰ˆæœ¬ wsl --set-default-version 2 # éªŒè¯ WSL ç‰ˆæœ¬ wsl --version 3. å®‰è£… WSL 2 Linux å†…æ ¸æ›´æ–°åŒ… è®¿é—® Microsoft WSL æ–‡æ¡£ ä¸‹è½½å¹¶å®‰è£…æœ€æ–°çš„ WSL 2 Linux å†…æ ¸æ›´æ–°åŒ…ã€‚\n4. é‡å¯ç”µè„‘ å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œå¿…é¡»é‡å¯ç”µè„‘ä»¥ç¡®ä¿æ‰€æœ‰åŠŸèƒ½ç”Ÿæ•ˆã€‚\n1 2 # é‡å¯è®¡ç®—æœº Restart-Computer ğŸ“¦ äºŒã€å®‰è£… Debian 1. å®‰è£…æ–¹æ³•é€‰æ‹© æ–¹æ³•ä¸€ï¼šé€šè¿‡ Microsoft Store å®‰è£…ï¼ˆæ¨èï¼‰ æ‰“å¼€ Microsoft Store æœç´¢ \u0026ldquo;Debian\u0026rdquo; é€‰æ‹©å®˜æ–¹ Debian åº”ç”¨å¹¶ç‚¹å‡»\u0026quot;è·å–\u0026quot; å®‰è£…å®Œæˆåç‚¹å‡»\u0026quot;å¯åŠ¨\u0026quot; æ–¹æ³•äºŒï¼šé€šè¿‡å‘½ä»¤è¡Œå®‰è£… 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å¯ç”¨çš„ Linux å‘è¡Œç‰ˆ wsl --list --online # å®‰è£… Debian wsl --install -d Debian # æˆ–è€…æŒ‡å®šå‘è¡Œç‰ˆåç§° wsl --install -d Debian --name debian 2. é¦–æ¬¡è®¾ç½® Debian å®‰è£…å®Œæˆåï¼Œé¦–æ¬¡å¯åŠ¨ä¼šæç¤ºåˆ›å»ºç”¨æˆ·è´¦æˆ·ï¼š\n1 2 # è‡ªåŠ¨å¯åŠ¨ Debian è¿›è¡Œåˆå§‹è®¾ç½® debian.exe æŒ‰ç…§æç¤ºè¾“å…¥æ–°çš„ UNIX ç”¨æˆ·åå’Œå¯†ç ã€‚\nğŸ’¡ æç¤º: å»ºè®®ä½¿ç”¨ä¸ Windows ç”¨æˆ·åä¸åŒçš„åç§°ï¼Œä»¥å¢å¼ºå®‰å…¨æ€§ã€‚\n3. éªŒè¯å®‰è£… 1 2 3 4 5 6 # æŸ¥çœ‹å·²å®‰è£…çš„ WSL å‘è¡Œç‰ˆ wsl -l -v # é¢„æœŸè¾“å‡º: # NAME STATE VERSION # * Debian Running 2 1 2 3 4 # åœ¨ Debian ä¸­æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ cat /etc/os-release lsb_release -a uname -a ğŸš€ ä¸‰ã€åŸºæœ¬æ“ä½œå’Œç®¡ç† 1. å¯åŠ¨å’Œå…³é—­ Debian 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¯åŠ¨ Debian wsl -d Debian # æˆ– debian.exe # åœ¨ Debian ä¸­é€€å‡º exit # å…³é—­æ‰€æœ‰ WSL å‘è¡Œç‰ˆ wsl --shutdown # ç»ˆæ­¢ç‰¹å®šå‘è¡Œç‰ˆ wsl --terminate Debian 2. æ–‡ä»¶ç³»ç»Ÿäº¤äº’ 1 2 3 4 5 6 7 8 # åœ¨ WSL ä¸­è®¿é—® Windows æ–‡ä»¶ cd /mnt/c/Users/YourUsername ls /mnt/c/Users/ # åœ¨ Windows ä¸­è®¿é—® WSL æ–‡ä»¶ # æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­è¾“å…¥ï¼š\\\\wsl$\\Debian # æˆ–ä½¿ç”¨ PowerShell explorer.exe \u0026#34;\\\\wsl$\\Debian\u0026#34; 3. è½¯ä»¶åŒ…ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ… sudo apt upgrade -y # å®‰è£…å¸¸ç”¨å·¥å…· sudo apt install -y curl wget git vim tree htop net-tools # æœç´¢è½¯ä»¶åŒ… apt search package-name # æŸ¥çœ‹è½¯ä»¶åŒ…ä¿¡æ¯ apt show package-name # åˆ é™¤è½¯ä»¶åŒ… sudo apt remove package-name # æ¸…ç†ä¸éœ€è¦çš„åŒ… sudo apt autoremove -y 4. è®¾ç½®é»˜è®¤ç”¨æˆ· 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰é»˜è®¤ç”¨æˆ· wsl -d Debian -- whoami # è®¾ç½®é»˜è®¤ç”¨æˆ·ï¼ˆæ›¿æ¢ YourUsername ä¸ºæ‚¨çš„ç”¨æˆ·åï¼‰ debian config --default-user YourUsername # æˆ–è€…é€šè¿‡ä¿®æ”¹ /etc/wsl.conf sudo nano /etc/wsl.conf æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 [user] default = YourUsername âš™ï¸ å››ã€é«˜çº§é…ç½® 1. WSL é…ç½®æ–‡ä»¶ åˆ›å»ºæˆ–ç¼–è¾‘ WSL å…¨å±€é…ç½®æ–‡ä»¶ï¼š\n1 2 # åˆ›å»º WSL é…ç½®æ–‡ä»¶ notepad $HOME\\.wslconfig æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®æ‚¨çš„ç¡¬ä»¶è°ƒæ•´ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 [wsl2] memory=4GB # é™åˆ¶å†…å­˜ä½¿ç”¨ï¼Œå»ºè®®ä¸ºç‰©ç†å†…å­˜çš„50-70% processors=2 # é™åˆ¶ CPU æ ¸å¿ƒæ•° swap=1GB # äº¤æ¢ç©ºé—´å¤§å° localhostForwarding=true # å…è®¸æœ¬åœ°ç«¯å£è½¬å‘ # å†…æ ¸è®¾ç½®ï¼ˆå¯é€‰ï¼‰ kernel=C:\\\\Users\\\\YourUsername\\\\kernel # ç½‘ç»œè®¾ç½®ï¼ˆå¯é€‰ï¼‰ networkingMode=nat # NAT æ¨¡å¼ ipv6=true # å¯ç”¨ IPv6 2. Debian ç‰¹å®šé…ç½® åœ¨ Debian ä¸­ç¼–è¾‘ WSL é…ç½®æ–‡ä»¶ï¼š\n1 sudo nano /etc/wsl.conf æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [automount] enabled = true # å¯ç”¨è‡ªåŠ¨æŒ‚è½½ root = /mnt/ # æŒ‚è½½ç‚¹æ ¹ç›®å½• options = \u0026#34;metadata,umask=22,fmask=11\u0026#34; # æŒ‚è½½é€‰é¡¹ mountFsTab = true # å¯ç”¨ /etc/fstab æŒ‚è½½ [network] generateHosts = true # è‡ªåŠ¨ç”Ÿæˆ /etc/hosts generateResolvConf = true # è‡ªåŠ¨ç”Ÿæˆ /etc/resolv.conf [interop] enabled = true # å¯ç”¨ Windows äº’æ“ä½œ appendWindowsPath = true # å°† Windows PATH æ·»åŠ åˆ° Linux PATH [user] default = YourUsername # é»˜è®¤ç”¨æˆ· 3. èµ„æºä½¿ç”¨ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # æ¸…ç†åŒ…ç¼“å­˜ sudo apt clean sudo apt autoclean # æ¸…ç†æ—§å†…æ ¸ï¼ˆå¦‚æœæœ‰ï¼‰ sudo apt autoremove --purge # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ free -h ğŸ¯ äº”ã€å¼€å‘ç¯å¢ƒé…ç½® 1. åŸºç¡€å¼€å‘å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å®‰è£…å¼€å‘åŸºç¡€å·¥å…·åŒ… sudo apt install -y build-essential # å®‰è£… Python sudo apt install -y python3 python3-pip python3-venv # å®‰è£… Node.js curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash - sudo apt install -y nodejs # å®‰è£… Java sudo apt install -y default-jdk # å®‰è£… Ruby sudo apt install -y ruby-full # å®‰è£… Go sudo apt install -y golang-go 2. å®¹å™¨å’Œè™šæ‹ŸåŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®‰è£… Docker curl -fsSL https://get.docker.com -o get-docker.sh sudo sh get-docker.sh sudo usermod -aG docker $USER # å®‰è£… Docker Compose sudo apt install -y docker-compose # å®‰è£… Podmanï¼ˆDocker æ›¿ä»£å“ï¼‰ sudo apt install -y podman # å®‰è£… Kubernetes å·¥å…· sudo apt install -y kubectl helm 3. æ•°æ®åº“å®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… PostgreSQL sudo apt install -y postgresql postgresql-contrib # å®‰è£… MySQL sudo apt install -y mysql-server mysql-client # å®‰è£… SQLite sudo apt install -y sqlite3 # å®‰è£… Redis sudo apt install -y redis-server # å®‰è£… MongoDB sudo apt install -y mongodb 4. Web å¼€å‘ç¯å¢ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… Nginx sudo apt install -y nginx # å®‰è£… Apache sudo apt install -y apache2 # å®‰è£… PHP sudo apt install -y php php-cli php-fpm php-mysql php-pgsql php-sqlite3 # å®‰è£… Composer curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer # å®‰è£… Let\u0026#39;s Encrypt å®¢æˆ·ç«¯ sudo apt install -y certbot python3-certbot-nginx 5. é…ç½® SSH 1 2 3 4 5 6 7 8 9 10 11 # ç”Ÿæˆ SSH å¯†é’¥ ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; # å¯åŠ¨ SSH æœåŠ¡ sudo service ssh start # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable ssh # å¤åˆ¶å…¬é’¥åˆ°å‰ªè´´æ¿ï¼ˆåœ¨ Windows ä¸­ï¼‰ cat ~/.ssh/id_rsa.pub | clip.exe 6. å®‰è£…å›¾å½¢ç•Œé¢ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 # å®‰è£… XFCE4 æ¡Œé¢ç¯å¢ƒ sudo apt install -y xfce4 xfce4-goodies xorg dbus-x11 # å®‰è£…è¿œç¨‹æ¡Œé¢æœåŠ¡ sudo apt install -y xrdp # é…ç½® xrdp sudo sed -i \u0026#39;s/port=3389/port=3390/g\u0026#39; /etc/xrdp/xrdp.ini sudo service xrdp restart # åœ¨ Windows ç«¯å®‰è£… X11 æœåŠ¡å™¨ # ä» https://sourceforge.net/projects/vcxsrv/ ä¸‹è½½å¹¶å®‰è£… VcXsrv ğŸ”„ å…­ã€å¤‡ä»½å’Œæ¢å¤ 1. å¯¼å‡º WSL å‘è¡Œç‰ˆ 1 2 3 4 5 6 7 8 # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir $HOME\\wsl-backups # å¯¼å‡º Debian ç³»ç»Ÿ wsl --export Debian $HOME\\wsl-backups\\debian-backup.tar # å¯¼å‡ºç‰¹å®šç‰ˆæœ¬ï¼ˆå‹ç¼©ï¼‰ wsl --export Debian $HOME\\wsl-backups\\debian-backup.tar --vhd 2. å¯¼å…¥ WSL å‘è¡Œç‰ˆ 1 2 3 4 5 # å¯¼å…¥å·²æœ‰çš„å¤‡ä»½ wsl --import Debian-new $HOME\\WSL\\Debian-new\\ $HOME\\wsl-backups\\debian-backup.tar # æŒ‡å®š WSL ç‰ˆæœ¬ wsl --import Debian-new $HOME\\WSL\\Debian-new\\ $HOME\\wsl-backups\\debian-backup.tar --version 2 3. è¿ç§» WSL åˆ°å…¶ä»–é©±åŠ¨å™¨ 1 2 3 4 5 6 7 8 9 10 11 # å¯¼å‡ºå‘è¡Œç‰ˆ wsl --export Debian $HOME\\wsl-backups\\debian-backup.tar # æ³¨é”€åŸå‘è¡Œç‰ˆ wsl --unregister Debian # å¯¼å…¥åˆ°æ–°ä½ç½® wsl --import Debian D:\\WSL\\Debian\\ $HOME\\wsl-backups\\debian-backup.tar # è®¾ç½®é»˜è®¤ç”¨æˆ· debian config --default-user YourUsername 4. å®šæœŸå¤‡ä»½è„šæœ¬ åˆ›å»º PowerShell å¤‡ä»½è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # backup-wsl.ps1 $date = Get-Date -Format \u0026#34;yyyyMMdd\u0026#34; $backupPath = \u0026#34;$HOME\\wsl-backups\\debian-$date.tar\u0026#34; # åˆ›å»ºå¤‡ä»½ç›®å½• New-Item -ItemType Directory -Force -Path \u0026#34;$HOME\\wsl-backups\u0026#34; # å¯¼å‡º Debian wsl --shutdown wsl --export Debian $backupPath Write-Host \u0026#34;å¤‡ä»½å·²å®Œæˆ: $backupPath\u0026#34; ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ 1. Windows Terminal é›†æˆ å®‰è£… Windows Terminal åï¼Œåœ¨è®¾ç½®ä¸­æ·»åŠ  Debian é…ç½®ï¼š\n1 2 3 4 5 6 7 8 { \u0026#34;guid\u0026#34;: \u0026#34;{07b52e3e-de2c-5db4-bd2d-ba144ed6c273}\u0026#34;, \u0026#34;hidden\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;Debian\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;Windows.Terminal.Wsl\u0026#34;, \u0026#34;startingDirectory\u0026#34;: \u0026#34;//wsl$/Debian/home/YourUsername\u0026#34;, \u0026#34;icon\u0026#34;: \u0026#34;https://apps.microsoft.com/store/detail/debian/9MSVKQC78PK6/icon\u0026#34; } 2. VS Code ä¸ WSL é›†æˆ å®‰è£… VS Code å®‰è£… Remote - WSL æ‰©å±• åœ¨ WSL ä¸­æ‰“å¼€é¡¹ç›®ï¼š 1 code . 3. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ sudo systemctl disable --now apache2.service # ä½¿ç”¨ zram å‹ç¼©å†…å­˜ï¼ˆå¦‚æœéœ€è¦ï¼‰ sudo apt install -y zram-config # ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ # åœ¨ /etc/wsl.conf ä¸­æ·»åŠ ï¼š [file] umask = 022 4. å¸¸ç”¨åˆ«åå’Œå‡½æ•° åœ¨ ~/.bashrc ä¸­æ·»åŠ ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¿«é€Ÿåˆ‡æ¢åˆ° Windows ç›®å½• alias winhome=\u0026#34;cd /mnt/c/Users/YourUsername\u0026#34; # åœ¨ Windows èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€å½“å‰ç›®å½• alias explorer=\u0026#34;explorer.exe .\u0026#34; # å¤åˆ¶æ–‡ä»¶å†…å®¹åˆ° Windows å‰ªè´´æ¿ alias clip=\u0026#34;clip.exe\u0026#34; # å¿«é€Ÿé‡å¯ WSL alias wsl-restart=\u0026#34;wsl.exe --shutdown\u0026#34; # æŸ¥çœ‹ WSL çŠ¶æ€ alias wsl-status=\u0026#34;wsl.exe --list --verbose\u0026#34; ğŸ› ï¸ å…«ã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¦‚æœ WSL æ— æ³•å¯åŠ¨ wsl --shutdown wsl -d Debian # é‡ç½® Debian wsl --unregister Debian wsl --install -d Debian # æ£€æŸ¥ WSL çŠ¶æ€ wsl --status # ä¿®å¤ WSL 2 é—®é¢˜ wsl --update 2. ç½‘ç»œé—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥ç½‘ç»œè¿æ¥ ping google.com # æŸ¥çœ‹ IP é…ç½® ip addr show cat /etc/resolv.conf # é‡ç½®ç½‘ç»œ sudo service network-manager restart # æ‰‹åŠ¨è®¾ç½® DNS sudo nano /etc/resolv.conf # æ·»åŠ ï¼šnameserver 8.8.8.8 3. æ–‡ä»¶æƒé™é—®é¢˜ 1 2 3 4 5 6 # ä¿®å¤æ–‡ä»¶æƒé™ sudo chown -R $USER:$USER ~/ # ä¿®å¤ Windows æ–‡ä»¶æƒé™ sudo umount /mnt/c sudo mount -t drvfs C: /mnt/c -o metadata,uid=1000,gid=1000,umask=22,fmask=111 4. æ€§èƒ½é—®é¢˜ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨ top htop # æ£€æŸ¥ç£ç›˜ I/O iotop # è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ perf top 5. å¯åŠ¨é—®é¢˜ å¦‚æœ Debian æ— æ³•å¯åŠ¨ï¼Œå°è¯•ï¼š\n1 2 3 4 5 6 7 8 9 # æ£€æŸ¥æ—¥å¿— wsl -d Debian -- dmesg | tail -20 # ä»¥ root èº«ä»½å¯åŠ¨ wsl -d Debian -u root # ä¿®å¤æŸåçš„åŒ… sudo apt --fix-broken install sudo dpkg --configure -a ğŸ“š ä¹ã€å­¦ä¹ èµ„æº 1. å®˜æ–¹æ–‡æ¡£ WSL å®˜æ–¹æ–‡æ¡£ Debian å®˜æ–¹æ–‡æ¡£ Debian æ‰‹å†Œ 2. ç¤¾åŒºèµ„æº WSL GitHub ä»“åº“ Debian è®ºå› Debian ä¸­æ–‡ç¤¾åŒº 3. æ¨èä¹¦ç± \u0026ldquo;WSL 2: Tips, Tricks, and Techniques\u0026rdquo; by Stuart Leeks \u0026ldquo;Debian Administrator\u0026rsquo;s Handbook\u0026rdquo; by RaphaÃ«l Hertzog and Roland Mas 4. åœ¨çº¿è¯¾ç¨‹ Microsoft Learn: WSL è¯¾ç¨‹ Udemy: WSL 2 å®Œæ•´æŒ‡å— 5. å®ç”¨å·¥å…· Windows Terminal VcXsrv (X11 Server) WSL Distro Manager ğŸ‰ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æˆåŠŸåœ¨ Windows ä¸Šé…ç½®äº†å®Œæ•´çš„ Debian å¼€å‘ç¯å¢ƒã€‚WSL 2 æä¾›äº†æ¥è¿‘åŸç”Ÿ Linux çš„æ€§èƒ½ï¼Œè®©æ‚¨èƒ½å¤ŸåŒæ—¶äº«å— Windows çš„ä¾¿åˆ©å’Œ Linux çš„å¼ºå¤§åŠŸèƒ½ã€‚\nâœ… å·²å®Œæˆçš„ä»»åŠ¡ï¼š ç¯å¢ƒå‡†å¤‡: å¯ç”¨ WSL å¹¶å®‰è£…å¿…è¦ç»„ä»¶ ç³»ç»Ÿå®‰è£…: æˆåŠŸå®‰è£…å’Œé…ç½® Debian å¼€å‘ç¯å¢ƒ: è®¾ç½®å®Œæ•´çš„å¼€å‘å·¥å…·é“¾ ä¼˜åŒ–é…ç½®: è°ƒæ•´ç³»ç»Ÿä»¥è·å¾—æœ€ä½³æ€§èƒ½ æ•…éšœå¤„ç†: æŒæ¡å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³• ğŸŒŸ åç»­å»ºè®®ï¼š æ¢ç´¢æ›´å¤š WSL 2 é«˜çº§åŠŸèƒ½ï¼Œå¦‚ GPU åŠ é€Ÿå’Œ systemd æ”¯æŒ å­¦ä¹ ä½¿ç”¨ Windows Terminal çš„å¤šæ ‡ç­¾å’Œåˆ†å±åŠŸèƒ½ å°è¯•åœ¨ WSL ä¸­è¿è¡Œ Docker å’Œ Kubernetes å‚ä¸ Debian ç¤¾åŒºï¼Œäº†è§£æœ€æ–°æ›´æ–°å’Œæœ€ä½³å®è·µ ","date":"2025-08-26T19:42:17+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/dbddaf8a/","title":"WSL å®‰è£… Debian æŒ‡å— ğŸ§"},{"content":"Podman å®¹å™¨ç®¡ç†å®Œå…¨æŒ‡å— ğŸ³ ğŸ“‹ ç›®å½• ğŸ“– ç®€ä»‹ ğŸ‘€ å®¹å™¨æŸ¥çœ‹å‘½ä»¤ âš¡ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† ğŸ“Š å®¹å™¨æ—¥å¿—å’Œç›‘æ§ ğŸ’» å®¹å™¨äº¤äº’æ“ä½œ ğŸ”„ æ‰¹é‡æ“ä½œ ğŸ” å®¹å™¨ä¿¡æ¯æŸ¥è¯¢ ğŸš€ é«˜çº§ç®¡ç†å‘½ä»¤ ğŸ“ å®ç”¨è„šæœ¬ç¤ºä¾‹ ğŸ› ï¸ æ•…éšœæ’é™¤ ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ ğŸŒ ç½‘ç»œç®¡ç† ğŸ“¦ é•œåƒç®¡ç† ğŸ“– ç®€ä»‹ Podman æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·ï¼Œç”¨äºç®¡ç†å®¹å™¨ã€é•œåƒå’Œå®¹å™¨ç¼–æ’ã€‚å®ƒä¸ Docker å…¼å®¹ä½†æ— éœ€å®ˆæŠ¤è¿›ç¨‹ï¼Œæä¾›äº†æ›´å®‰å…¨çš„å®¹å™¨ç®¡ç†æ–¹å¼ã€‚Podman æ”¯æŒ rootless å®¹å™¨è¿è¡Œï¼Œæ˜¯ Docker çš„ä¼˜ç§€æ›¿ä»£å“ã€‚\nğŸ¯ Podman ä¸»è¦ç‰¹æ€§ æ— å®ˆæŠ¤è¿›ç¨‹æ¶æ„: ä¸éœ€è¦é•¿æœŸè¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ Rootless å®¹å™¨: å…è®¸æ™®é€šç”¨æˆ·è¿è¡Œå®¹å™¨ï¼Œæé«˜å®‰å…¨æ€§ Docker å…¼å®¹: æ”¯æŒ Docker CLI å‘½ä»¤å’Œé•œåƒæ ¼å¼ Pod æ”¯æŒ: åŸç”Ÿæ”¯æŒ Kubernetes é£æ ¼çš„ Pod ç³»ç»Ÿé›†æˆ: ä¸ systemd é›†æˆè‰¯å¥½ ğŸ”„ Podman vs Docker ç‰¹æ€§ Podman Docker æ¶æ„ æ— å®ˆæŠ¤è¿›ç¨‹ å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ æƒé™ æ”¯æŒ rootless é€šå¸¸éœ€è¦ root æƒé™ å®‰å…¨æ€§ æ›´é«˜ï¼Œæ— éœ€å®ˆæŠ¤è¿›ç¨‹ å®ˆæŠ¤è¿›ç¨‹å¯èƒ½å­˜åœ¨å®‰å…¨é£é™© å…¼å®¹æ€§ å…¼å®¹ Docker å‘½ä»¤ åŸç”Ÿ Docker ç”Ÿæ€ ğŸ‘€ å®¹å™¨æŸ¥çœ‹å‘½ä»¤ 1. æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆç®€æ´æ ¼å¼ï¼‰ podman ps # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆè‡ªå®šä¹‰æ ¼å¼ï¼‰ podman ps --format \u0026#39;{{.ID}}: {{.Names}} - {{.Status}}\u0026#39; # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆæ˜¾ç¤ºç«¯å£æ˜ å°„ï¼‰ podman ps --format \u0026#34;table {{.ID}}\\t{{.Names}}\\t{{.Status}}\\t{{.Ports}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆæ˜¾ç¤ºé•œåƒï¼‰ podman ps --format \u0026#34;table {{.Names}}\\t{{.Image}}\\t{{.Status}}\u0026#34; 2. æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰ podman ps -a # æŸ¥çœ‹å·²åœæ­¢çš„å®¹å™¨ podman ps -a --filter \u0026#34;status=exited\u0026#34; # æŸ¥çœ‹å·²åœæ­¢çš„å®¹å™¨ï¼ˆä»…æ˜¾ç¤ºIDå’Œåç§°ï¼‰ podman ps -a --filter \u0026#34;status=exited\u0026#34; --format \u0026#34;{{.ID}} {{.Names}}\u0026#34; # æŒ‰çŠ¶æ€è¿‡æ»¤å®¹å™¨ podman ps -a --filter \u0026#34;status=created\u0026#34; # å·²åˆ›å»º podman ps -a --filter \u0026#34;status=running\u0026#34; # è¿è¡Œä¸­ podman ps -a --filter \u0026#34;status=paused\u0026#34; # å·²æš‚åœ podman ps -a --filter \u0026#34;status=exited\u0026#34; # å·²é€€å‡º podman ps -a --filter \u0026#34;status=removing\u0026#34; # åˆ é™¤ä¸­ 3. é«˜çº§æŸ¥çœ‹é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŸ¥çœ‹æœ€è¿‘åˆ›å»ºçš„å®¹å™¨ podman ps -l # æŸ¥çœ‹æœ€ååˆ›å»ºçš„nä¸ªå®¹å™¨ podman ps -n 5 # æŸ¥çœ‹å®¹å™¨å¤§å°ï¼ˆç£ç›˜å ç”¨ï¼‰ podman ps -s # æŸ¥çœ‹å®¹å™¨å¹¶æ’åº podman ps --sort=name # æŒ‰åç§°æ’åº podman ps --sort=status # æŒ‰çŠ¶æ€æ’åº podman ps --sort=created # æŒ‰åˆ›å»ºæ—¶é—´æ’åº # ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤æ¡ä»¶ podman ps --filter \u0026#34;name=web\u0026#34; # åç§°åŒ…å«web podman ps --filter \u0026#34;label=env=prod\u0026#34; # æ ‡ç­¾è¿‡æ»¤ podman ps --filter \u0026#34;ancestor=nginx\u0026#34; # ä½¿ç”¨nginxé•œåƒçš„å®¹å™¨ âš¡ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 4. å¯åŠ¨å’Œåœæ­¢å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¯åŠ¨å®¹å™¨ podman start mytest # åœæ­¢å®¹å™¨ podman stop mytest # å¼ºåˆ¶åœæ­¢å®¹å™¨ï¼ˆSIGKILLï¼‰ podman stop -t 0 mytest # ç«‹å³åœæ­¢ podman kill mytest # å‘é€ä¿¡å· # é‡å¯å®¹å™¨ podman restart mytest # ä¼˜é›…é‡å¯ï¼ˆå…ˆåœæ­¢å†å¯åŠ¨ï¼‰ podman restart -t 30 mytest # 30ç§’è¶…æ—¶ 5. åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºä½†ä¸å¯åŠ¨å®¹å™¨ podman create --name mycontainer nginx:alpine # è¿è¡Œå®¹å™¨ï¼ˆåå°æ¨¡å¼ï¼‰ podman run -d --name mytest nginx:alpine # è¿è¡Œå®¹å™¨ï¼ˆäº¤äº’æ¨¡å¼ï¼‰ podman run -it --name mytest ubuntu:20.04 bash # è¿è¡Œå®¹å™¨å¹¶è‡ªåŠ¨åˆ é™¤ podman run --rm -it alpine:latest sh # è¿è¡Œå®¹å™¨å¹¶è®¾ç½®é‡å¯ç­–ç•¥ podman run -d --restart=always --name myapp myapp:latest 6. åˆ é™¤å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ é™¤å·²åœæ­¢çš„å®¹å™¨ podman rm mytest # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ podman rm -f mytest # åˆ é™¤å®¹å™¨å¹¶å…³è”çš„åŒ¿åå· podman rm -v mytest # åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ podman container prune # åˆ é™¤å®¹å™¨å‰å…ˆåœæ­¢ podman rm -f mytest || podman stop mytest \u0026amp;\u0026amp; podman rm mytest ğŸ“Š å®¹å™¨æ—¥å¿—å’Œç›‘æ§ 8. æŸ¥çœ‹å®¹å™¨æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # æŸ¥çœ‹æœ€æ–°æ—¥å¿— podman logs mytest # å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆè·Ÿéšæ¨¡å¼ï¼‰ podman logs -f mytest # æŸ¥çœ‹æœ€ånè¡Œæ—¥å¿— podman logs --tail 100 mytest # æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— podman logs -t mytest # æŸ¥çœ‹ç‰¹å®šæ—¶é—´åçš„æ—¥å¿— podman logs --since 2023-01-01T00:00:00 mytest # æŸ¥çœ‹æœ€è¿‘æ—¶é—´æ®µçš„æ—¥å¿— podman logs --since 1h mytest # æœ€è¿‘1å°æ—¶ podman logs --since 30m mytest # æœ€è¿‘30åˆ†é’Ÿ # ç»„åˆä½¿ç”¨æ—¥å¿—é€‰é¡¹ podman logs -f --tail 50 --since 10m mytest 9. å®¹å™¨èµ„æºç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ podman stats mytest # æŸ¥çœ‹ä¸€æ¬¡æ€§èµ„æºç»Ÿè®¡ podman stats --no-stream mytest # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨èµ„æºä½¿ç”¨ podman stats --all # è‡ªå®šä¹‰ç»Ÿè®¡ä¿¡æ¯æ ¼å¼ podman stats --format \u0026#34;table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\u0026#34; # æŒç»­ç›‘æ§ï¼ˆæ¯5ç§’åˆ·æ–°ï¼‰ watch -n 5 podman stats --no-stream 10. é«˜çº§ç›‘æ§å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å®¹å™¨è¿›ç¨‹æ ‘ podman top mytest # æŸ¥çœ‹å®¹å™¨è¿›ç¨‹è¯¦æƒ… podman top mytest -eo pid,ppid,user,comm # æŸ¥çœ‹å®¹å™¨èµ„æºé™åˆ¶ podman inspect mytest --format \u0026#39;{{.HostConfig.Memory}}\u0026#39; # æŸ¥çœ‹å®¹å™¨CPUä½¿ç”¨è¯¦æƒ… podman inspect mytest --format \u0026#39;{{.HostConfig.NanoCpus}}\u0026#39; ğŸ’» å®¹å™¨äº¤äº’æ“ä½œ 11. è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä½¿ç”¨ bash è¿›å…¥å®¹å™¨ podman exec -it mytest bash # ä½¿ç”¨ sh è¿›å…¥å®¹å™¨ podman exec -it mytest sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå•æ¡å‘½ä»¤ podman exec mytest ls -la /app # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå¤æ‚å‘½ä»¤ podman exec mytest /bin/bash -c \u0026#34;ls -la \u0026amp;\u0026amp; pwd\u0026#34; # ä»¥ç‰¹å®šç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤ podman exec -it --user www-data mytest bash # åœ¨å®¹å™¨ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ podman exec -it -e DEBUG=true mytest bash 12. æ–‡ä»¶æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨ podman cp local_file.txt mytest:/path/in/container/ # ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶ podman cp mytest:/path/in/container/file.txt ./ # å¤åˆ¶ç›®å½•åˆ°å®¹å™¨ podman cp ./local_dir/ mytest:/path/in/container/ # ä»å®¹å™¨å¤åˆ¶ç›®å½• podman cp mytest:/path/in/container/ ./local_dir/ # ä¿æŒæ–‡ä»¶æƒé™ podman cp -a local_file.txt mytest:/path/in/container/ ğŸ”„ æ‰¹é‡æ“ä½œ 13. æ‰¹é‡åœæ­¢å®¹å™¨ 1 2 3 4 5 6 7 8 # åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ podman stop $(podman ps -q) # åœæ­¢ç‰¹å®šæ¨¡å¼çš„å®¹å™¨ podman stop $(podman ps -q --filter \u0026#34;name=web\u0026#34;) # ä¼˜é›…åœæ­¢æ‰€æœ‰å®¹å™¨ podman ps -q | xargs podman stop -t 30 14. æ‰¹é‡åˆ é™¤å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 # åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ podman container prune # å¼ºåˆ¶åˆ é™¤æ‰€æœ‰å®¹å™¨ podman rm -f $(podman ps -aq) # åˆ é™¤ç‰¹å®šæ¨¡å¼çš„å®¹å™¨ podman rm -f $(podman ps -aq --filter \u0026#34;name=test\u0026#34;) # åˆ é™¤æ‰€æœ‰é€€å‡ºçš„å®¹å™¨ podman rm -f $(podman ps -aq --filter \u0026#34;status=exited\u0026#34;) 15. æ‰¹é‡é‡å¯å®¹å™¨ 1 2 3 4 5 # é‡å¯æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ podman restart $(podman ps -q) # é‡å¯ç‰¹å®šé•œåƒçš„å®¹å™¨ podman restart $(podman ps -q --filter \u0026#34;ancestor=nginx\u0026#34;) 16. æ‰¹é‡æ“ä½œè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰¹é‡å¤‡ä»½å®¹å™¨æ•°æ®è„šæœ¬ #!/bin/bash BACKUP_DIR=\u0026#34;./backup/$(date +%Y%m%d_%H%M%S)\u0026#34; mkdir -p \u0026#34;$BACKUP_DIR\u0026#34; for container in $(podman ps -aq); do name=$(podman inspect --format=\u0026#39;{{.Name}}\u0026#39; $container | sed \u0026#39;s|/||\u0026#39;) echo \u0026#34;Backing up $name...\u0026#34; mkdir -p \u0026#34;$BACKUP_DIR/$name\u0026#34; podman inspect $container \u0026gt; \u0026#34;$BACKUP_DIR/$name/inspect.json\u0026#34; # å¤‡ä»½é‡è¦æ•°æ®ç›®å½• podman cp $container:/etc \u0026#34;$BACKUP_DIR/$name/\u0026#34; 2\u0026gt;/dev/null || true podman cp $container:/app \u0026#34;$BACKUP_DIR/$name/\u0026#34; 2\u0026gt;/dev/null || true done ğŸ” å®¹å™¨ä¿¡æ¯æŸ¥è¯¢ 17. æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å®Œæ•´å®¹å™¨ä¿¡æ¯ podman inspect mytest # æŸ¥çœ‹ç‰¹å®šä¿¡æ¯ podman inspect --format=\u0026#39;{{.NetworkSettings.IPAddress}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨é…ç½® podman inspect --format=\u0026#39;{{json .Config}}\u0026#39; mytest | jq . # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ podman inspect --format=\u0026#39;{{.State}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨æŒ‚è½½ç‚¹ podman inspect --format=\u0026#39;{{.Mounts}}\u0026#39; mytest 18. ç½‘ç»œä¿¡æ¯æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å®¹å™¨ç«¯å£æ˜ å°„ podman port mytest # æŸ¥çœ‹ç‰¹å®šç«¯å£æ˜ å°„ podman port mytest 80 # æŸ¥çœ‹å®¹å™¨ç½‘ç»œè®¾ç½® podman inspect --format=\u0026#39;{{.NetworkSettings}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨IPåœ°å€ podman inspect --format=\u0026#39;{{.NetworkSettings.IPAddress}}\u0026#39; mytest 19. èµ„æºä¿¡æ¯æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹å®¹å™¨èµ„æºé™åˆ¶ podman inspect --format=\u0026#39;{{.HostConfig.Memory}}\u0026#39; mytest podman inspect --format=\u0026#39;{{.HostConfig.CpuShares}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨å­˜å‚¨ä¿¡æ¯ podman inspect --format=\u0026#39;{{.GraphDriver}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨ç¯å¢ƒå˜é‡ podman inspect --format=\u0026#39;{{.Config.Env}}\u0026#39; mytest ğŸš€ é«˜çº§ç®¡ç†å‘½ä»¤ 20. å®¹å™¨é‡å‘½å 1 2 3 4 5 6 7 8 9 # é‡å‘½åå®¹å™¨ podman rename mytest new-container-name # æ‰¹é‡é‡å‘½åè„šæœ¬ for container in $(podman ps -aq); do old_name=$(podman inspect --format=\u0026#39;{{.Name}}\u0026#39; $container | sed \u0026#39;s|/||\u0026#39;) new_name=\u0026#34;prod_${old_name}\u0026#34; podman rename $old_name $new_name done 21. å®¹å™¨æäº¤å’Œå¯¼å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æäº¤å®¹å™¨ä¸ºæ–°çš„é•œåƒ podman commit mytest new_image_name:tag # æäº¤æ—¶æ·»åŠ ä½œè€…ä¿¡æ¯ podman commit --author \u0026#34;Your Name \u0026lt;email@example.com\u0026gt;\u0026#34; mytest new_image # æäº¤æ—¶ä¿®æ”¹CMD podman commit --change \u0026#39;CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;]\u0026#39; mytest nginx_custom # å¯¼å‡ºå®¹å™¨ä¸ºtaråŒ… podman export mytest \u0026gt; mytest.tar # å¯¼å…¥å®¹å™¨ podman import mytest.tar my_imported_image:tag 22. æš‚åœå’Œæ¢å¤å®¹å™¨ 1 2 3 4 5 6 7 8 # æš‚åœå®¹å™¨ podman pause mytest # æ¢å¤å®¹å™¨ podman unpause mytest # æ£€æŸ¥æš‚åœçŠ¶æ€ podman inspect --format=\u0026#39;{{.State.Paused}}\u0026#39; mytest 23. å®¹å™¨æ›´æ–°æ“ä½œ 1 2 3 4 5 6 7 8 9 # æ›´æ–°å®¹å™¨èµ„æºé™åˆ¶ podman update --memory 512m mytest podman update --cpus 1.5 mytest # æ›´æ–°å®¹å™¨é‡å¯ç­–ç•¥ podman update --restart unless-stopped mytest # åŒæ—¶æ›´æ–°å¤šä¸ªè®¾ç½® podman update --memory 1g --cpus 2 --restart always mytest ğŸ“ å®ç”¨è„šæœ¬ç¤ºä¾‹ 24. å®¹å™¨å¥åº·æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # å®¹å™¨å¥åº·ç›‘æ§è„šæœ¬ CONTAINERS=$(podman ps --format \u0026#34;{{.Names}}\u0026#34;) for container in $CONTAINERS; do status=$(podman inspect --format=\u0026#39;{{.State.Status}}\u0026#39; $container) health=$(podman inspect --format=\u0026#39;{{.State.Health.Status}}\u0026#39; $container 2\u0026gt;/dev/null || echo \u0026#34;N/A\u0026#34;) echo \u0026#34;Container: $container\u0026#34; echo \u0026#34;Status: $status\u0026#34; echo \u0026#34;Health: $health\u0026#34; if [ \u0026#34;$status\u0026#34; != \u0026#34;running\u0026#34; ]; then echo \u0026#34;âŒ Container $container is not running. Attempting to restart...\u0026#34; podman restart $container fi if [ \u0026#34;$health\u0026#34; = \u0026#34;unhealthy\u0026#34; ]; then echo \u0026#34;âš ï¸ Container $container is unhealthy. Check logs: podman logs $container\u0026#34; fi echo \u0026#34;----------------------------------------\u0026#34; done 25. è‡ªåŠ¨å¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #!/bin/bash # å®¹å™¨æ•°æ®å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup/containers/$(date +%Y%m%d_%H%M%S)\u0026#34; mkdir -p \u0026#34;$BACKUP_DIR\u0026#34; echo \u0026#34;Starting container backup at $(date)\u0026#34; # å¤‡ä»½æ‰€æœ‰è¿è¡Œä¸­å®¹å™¨çš„æ•°æ® for container in $(podman ps -q); do name=$(podman inspect --format=\u0026#39;{{.Name}}\u0026#39; $container | sed \u0026#39;s|/||\u0026#39;) echo \u0026#34;Backing up $name...\u0026#34; # åˆ›å»ºå®¹å™¨å¤‡ä»½ç›®å½• container_dir=\u0026#34;$BACKUP_DIR/$name\u0026#34; mkdir -p \u0026#34;$container_dir\u0026#34; # å¯¼å‡ºå®¹å™¨é…ç½® podman inspect $container \u0026gt; \u0026#34;$container_dir/inspect.json\u0026#34; # å¤‡ä»½é‡è¦æ•°æ® volumes=$(podman inspect --format=\u0026#39;{{range .Mounts}}{{.Source}}:{{.Destination}} {{end}}\u0026#39; $container) for volume in $volumes; do src=$(echo $volume | cut -d: -f1) if [ -d \u0026#34;$src\u0026#34; ]; then rsync -a \u0026#34;$src/\u0026#34; \u0026#34;$container_dir/volumes/$(basename $src)/\u0026#34; fi done # å¯¼å‡ºå®¹å™¨æ—¥å¿— podman logs $container \u0026gt; \u0026#34;$container_dir/container.log\u0026#34; 2\u0026gt;/dev/null done echo \u0026#34;Backup completed: $BACKUP_DIR\u0026#34; 26. å®¹å™¨èµ„æºç›‘æ§ä»ªè¡¨æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/bash # å®æ—¶å®¹å™¨ç›‘æ§ä»ªè¡¨æ¿ watch -n 2 \u0026#39; echo \u0026#34;==================== CONTAINER MONITOR ====================\u0026#34; echo \u0026#34;CPU and Memory Usage:\u0026#34; podman stats --no-stream --format \u0026#34;table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\\t{{.MemPerc}}\u0026#34; echo -e \u0026#34;\\nRunning Containers:\u0026#34; podman ps --format \u0026#34;table {{.Names}}\\t{{.Status}}\\t{{.Ports}}\u0026#34; echo -e \u0026#34;\\nResource Limits:\u0026#34; for container in $(podman ps -q); do name=$(podman inspect --format=\u0026#34;{{.Name}}\u0026#34; $container | sed \u0026#34;s|/||\u0026#34;) memory=$(podman inspect --format=\u0026#34;{{.HostConfig.Memory}}\u0026#34; $container) cpu=$(podman inspect --format=\u0026#34;{{.HostConfig.NanoCpus}}\u0026#34; $container) echo \u0026#34;$name: Memory=${memory} bytes, CPU=${cpu} nanoseconds\u0026#34; done \u0026#39; ğŸ› ï¸ æ•…éšœæ’é™¤ 27. å®¹å™¨çŠ¶æ€è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥å®¹å™¨è¯¦ç»†çŠ¶æ€ podman inspect --format=\u0026#39;{{json .State}}\u0026#39; mytest | jq . # æŸ¥çœ‹å®¹å™¨é€€å‡ºä»£ç  podman inspect --format=\u0026#39;{{.State.ExitCode}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨é”™è¯¯ä¿¡æ¯ podman inspect --format=\u0026#39;{{.State.Error}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¶é—´ podman inspect --format=\u0026#39;{{.State.StartedAt}}\u0026#39; mytest podman inspect --format=\u0026#39;{{.State.FinishedAt}}\u0026#39; mytest # æŸ¥çœ‹å®¹å™¨OOMçŠ¶æ€ podman inspect --format=\u0026#39;{{.State.OOMKilled}}\u0026#39; mytest 28. æ—¥å¿—åˆ†ææŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 # æœç´¢é”™è¯¯æ—¥å¿— podman logs mytest | grep -i error # æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿— podman logs --since \u0026#34;10m\u0026#34; mytest | grep -i exception # å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿— podman logs -f mytest | grep --line-buffered -i error # æ—¥å¿—ç»Ÿè®¡åˆ†æ podman logs mytest | awk \u0026#39;{print $1}\u0026#39; | sort | uniq -c | sort -nr 29. ç½‘ç»œæ•…éšœæ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥å®¹å™¨ç½‘ç»œè¿æ¥ podman exec mytest ping -c 4 8.8.8.8 # æŸ¥çœ‹å®¹å™¨DNSé…ç½® podman exec mytest cat /etc/resolv.conf # æ£€æŸ¥å®¹å™¨ç«¯å£ç›‘å¬ podman exec mytest netstat -tulpn # æµ‹è¯•å®¹å™¨é—´ç½‘ç»œè¿é€šæ€§ podman exec container1 ping container2 ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ 30. éç‰¹æƒå®¹å™¨è¿è¡Œ 1 2 3 4 5 6 7 8 # ä»¥érootç”¨æˆ·è¿è¡Œå®¹å™¨ podman run --user 1000:1000 nginx:alpine # ä½¿ç”¨éšæœºç”¨æˆ·ID podman run --user $(id -u):$(id -g) nginx:alpine # ç¦ç”¨æƒé™æå‡ podman run --security-opt=no-new-privileges nginx:alpine 31. èµ„æºé™åˆ¶å’Œéš”ç¦» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è®¾ç½®å†…å­˜é™åˆ¶ podman run --memory=512m --memory-swap=1g nginx:alpine # è®¾ç½®CPUé™åˆ¶ podman run --cpus=1.5 --cpu-shares=512 nginx:alpine # è®¾ç½®IOé™åˆ¶ podman run --device-read-bps=/dev/sda:1mb --device-write-iops=/dev/sda:10 nginx:alpine # ä½¿ç”¨åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ podman run --read-only nginx:alpine # åªè¯»æŒ‚è½½ç‰¹å®šç›®å½• podman run -v /data:/data:ro nginx:alpine 32. å®‰å…¨å¢å¼ºé…ç½® 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨AppArmoré…ç½®æ–‡ä»¶ podman run --security-opt apparmor=my-profile nginx:alpine # ä½¿ç”¨SELinuxæ ‡ç­¾ podman run --security-opt label=type:my_container_t nginx:alpine # ç¦ç”¨ç³»ç»Ÿè°ƒç”¨ podman run --security-opt seccomp=unconfined nginx:alpine # ä½¿ç”¨è‡ªå®šä¹‰èƒ½åŠ›é›† podman run --cap-drop=ALL --cap-add=NET_BIND_SERVICE nginx:alpine ğŸŒ ç½‘ç»œç®¡ç† 33. ç½‘ç»œæŸ¥çœ‹å’Œè¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ podman network ls # æŸ¥çœ‹ç½‘ç»œè¯¦æƒ… podman network inspect bridge # åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ podman network create mynetwork # è¿æ¥å®¹å™¨åˆ°ç½‘ç»œ podman network connect mynetwork mycontainer # ä»ç½‘ç»œæ–­å¼€å®¹å™¨ podman network disconnect mynetwork mycontainer 34. é«˜çº§ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 # åˆ›å»ºå¸¦å­ç½‘çš„ç½‘ç»œ podman network create --subnet 192.168.100.0/24 --gateway 192.168.100.1 mynet # åˆ›å»ºMacvlanç½‘ç»œ podman network create -d macvlan --subnet=192.168.1.0/24 --gateway=192.168.1.1 -o parent=eth0 mymacvlan # è®¾ç½®å®¹å™¨é™æ€IP podman run --network mynet --ip 192.168.100.10 nginx:alpine ğŸ“¦ é•œåƒç®¡ç† 35. é•œåƒæ“ä½œå‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹æœ¬åœ°é•œåƒ podman images # æ‹‰å–é•œåƒ podman pull nginx:alpine # æ¨é€é•œåƒ podman push myimage:latest registry.example.com/myimage:latest # åˆ é™¤é•œåƒ podman rmi nginx:alpine # æ„å»ºé•œåƒ podman build -t myapp:latest . # é•œåƒæ‰“æ ‡ç­¾ podman tag nginx:alpine myregistry/nginx:latest 36. é•œåƒæ¸…ç†å’Œç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 # åˆ é™¤æ‚¬ç©ºé•œåƒ podman image prune # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨é•œåƒ podman image prune -a # æŸ¥çœ‹é•œåƒç£ç›˜ä½¿ç”¨ podman system df # ä¼˜åŒ–å­˜å‚¨ podman system prune -a ğŸ¯ æ€»ç»“ é€šè¿‡è¿™ä»½å®Œæ•´çš„ Podman å®¹å™¨ç®¡ç†æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š\nç†Ÿç»ƒæŒæ¡ Podman çš„åŸºæœ¬å®¹å™¨æ“ä½œå‘½ä»¤ æœ‰æ•ˆç›‘æ§ å®¹å™¨çŠ¶æ€å’Œèµ„æºä½¿ç”¨æƒ…å†µ é«˜æ•ˆç®¡ç† å¤šä¸ªå®¹å™¨çš„æ‰¹é‡æ“ä½œ æ·±å…¥æ’æŸ¥ å®¹å™¨æ•…éšœå’Œæ€§èƒ½é—®é¢˜ å®‰å…¨è¿è¡Œ å®¹å™¨å¹¶å®æ–½æœ€ä½³å®è·µ çµæ´»é…ç½® å®¹å™¨ç½‘ç»œå’Œå­˜å‚¨ Podman ä½œä¸º Docker çš„ç°ä»£æ›¿ä»£å“ï¼Œæä¾›äº†æ›´å®‰å…¨ã€æ›´çµæ´»çš„å®¹å™¨ç®¡ç†ä½“éªŒã€‚å»ºè®®å®šæœŸç»ƒä¹ è¿™äº›å‘½ä»¤ï¼Œå¹¶å°†å…¶é›†æˆåˆ°æ‚¨çš„æ—¥å¸¸è¿ç»´å·¥ä½œä¸­ã€‚\nğŸ’¡ æç¤º: è®°å¾—å®šæœŸæ›´æ–° Podman ç‰ˆæœ¬ä»¥è·å–æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨ä¿®å¤ï¼š\n1 2 sudo dnf update podman # RHEL/CentOS/Fedora sudo apt update podman # Debian/Ubuntu ","date":"2025-08-26T17:28:17+08:00","image":"https://file.meimolihan.eu.org/img/podman-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d4e237a5/","title":"Podman å®¹å™¨ç®¡ç†å®Œå…¨æŒ‡å— ğŸ³"},{"content":"Podman é•œåƒç®¡ç†å®Œå…¨æŒ‡å— ğŸ“¦ ğŸ” å…¨é¢æŒæ¡ Podman é•œåƒç®¡ç†çš„ä¸“ä¸šæŠ€å·§ï¼Œä»åŸºç¡€æ“ä½œåˆ°é«˜çº§ä¼˜åŒ–\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ Podman ç®€ä»‹ä¸ç‰¹ç‚¹ ğŸ“‹ ä¸€ã€é•œåƒç®¡ç†åŸºç¡€å‘½ä»¤ ğŸ§¹ äºŒã€é•œåƒæ¸…ç†ä¸ç»´æŠ¤ âš™ï¸ ä¸‰ã€é«˜çº§é•œåƒæ“ä½œ ğŸ” å››ã€é•œåƒæŸ¥è¯¢ä¸è¿‡æ»¤ ğŸ›¡ï¸ äº”ã€å®‰å…¨æœ€ä½³å®è·µ ğŸ“Š å…­ã€å®ç”¨è„šæœ¬ç¤ºä¾‹ ğŸš€ ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§ ğŸ¯ æ€»ç»“ âœ¨ Podman ç®€ä»‹ä¸ç‰¹ç‚¹ Podman æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·ï¼Œæ—¨åœ¨æ›¿ä»£ Dockerï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜ç§€ç‰¹æ€§ï¼š\nğŸ”’ æ— å®ˆæŠ¤è¿›ç¨‹ï¼šä¸éœ€è¦åå°å®ˆæŠ¤è¿›ç¨‹ï¼Œæ›´åŠ å®‰å…¨å¯é  ğŸ§ Rootless è¿è¡Œï¼šæ”¯æŒéç‰¹æƒç”¨æˆ·è¿è¡Œå®¹å™¨ï¼Œæå‡å®‰å…¨æ€§ ğŸ”„ å…¼å®¹ Dockerï¼šå¤§éƒ¨åˆ†å‘½ä»¤ä¸ Docker å…¼å®¹ï¼Œå­¦ä¹ æˆæœ¬ä½ ğŸŒ å¼€æºå…è´¹ï¼šå®Œå…¨å¼€æºï¼Œæ— å•†ä¸šé™åˆ¶ âš¡ è½»é‡é«˜æ•ˆï¼šèµ„æºå ç”¨å°‘ï¼Œå¯åŠ¨é€Ÿåº¦å¿« ğŸ›¡ï¸ å®‰å…¨å¯é ï¼šé‡‡ç”¨ä¼ ç»Ÿçš„ fork-exec æ¨¡å‹ï¼Œå‡å°‘æ”»å‡»é¢ ğŸ“¦ é•œåƒå…¼å®¹ï¼šå®Œå…¨æ”¯æŒ OCI æ ‡å‡†é•œåƒæ ¼å¼ ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š\nå¼€å‘ç¯å¢ƒå®¹å™¨åŒ– ç”Ÿäº§ç¯å¢ƒå®¹å™¨éƒ¨ç½² CI/CD æµæ°´çº¿ æœ¬åœ°å¼€å‘å’Œæµ‹è¯• å¤šå¹³å°å®¹å™¨æ„å»º ğŸ“‹ ä¸€ã€é•œåƒç®¡ç†åŸºç¡€å‘½ä»¤ 1ï¸âƒ£ æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ podman images # æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯ podman images --format \u0026#34;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; # æŒ‰ä»“åº“åè¿‡æ»¤æŸ¥çœ‹ podman images --filter reference=\u0026#34;docker.io/*\u0026#34; # æŒ‰æ—¥æœŸæ’åºæŸ¥çœ‹ podman images --sort created # åªæ˜¾ç¤ºé•œåƒID podman images -q 2ï¸âƒ£ æœç´¢è¿œç¨‹é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä»ä»“åº“æœç´¢é•œåƒ podman search nginx # æœç´¢å¹¶æ˜¾ç¤ºå®˜æ–¹é•œåƒ podman search --filter is-official=true nginx # æœç´¢å¹¶é™åˆ¶æ˜¾ç¤ºæ•°é‡ podman search --limit 5 nginx # æœç´¢å¹¶æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾ podman search --list-tags nginx # æŒ‰æ˜Ÿçº§æœç´¢ podman search --filter stars=100 nginx 3ï¸âƒ£ æ‹‰å–è¿œç¨‹é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„é•œåƒ podman pull docker.io/openlistteam/openlist:latest # æ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„é•œåƒ podman pull docker.io/library/nginx:1.23 # æ‹‰å–é•œåƒä½†ä¸éªŒè¯è¯ä¹¦ï¼ˆé€‚ç”¨äºå†…éƒ¨ä»“åº“ï¼‰ podman pull --tls-verify=false localhost:5000/myimage # æ‹‰å–æ‰€æœ‰æ ‡ç­¾çš„é•œåƒ podman pull --all-tags docker.io/library/nginx # æ˜¾ç¤ºæ‹‰å–è¿›åº¦è¯¦æƒ… podman pull --progress=true docker.io/library/nginx 4ï¸âƒ£ åˆ é™¤æœ¬åœ°é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆé€šè¿‡IDï¼‰ podman rmi 70bbf14f6340 # å¼ºåˆ¶åˆ é™¤é•œåƒï¼ˆå³ä½¿æœ‰å®¹å™¨ä½¿ç”¨ï¼‰ podman rmi -f 70bbf14f6340 # åˆ é™¤æŒ‡å®šä»“åº“çš„é•œåƒ podman rmi docker.io/openlistteam/openlist:latest # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ podman image prune -af # åˆ é™¤æŒ‡å®šæ ‡ç­¾çš„é•œåƒ podman rmi docker.io/library/nginx:1.23 ğŸ§¹ äºŒã€é•œåƒæ¸…ç†ä¸ç»´æŠ¤ 1ï¸âƒ£ æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹é•œåƒã€å®¹å™¨ã€å·çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ podman system df # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ podman system df -v # ä»¥JSONæ ¼å¼æŸ¥çœ‹ podman system df --format json è¾“å‡ºç¤ºä¾‹ï¼š\nç±»å‹ï¼ˆTYPEï¼‰ æ€»æ•°ï¼ˆTOTALï¼‰ æ´»åŠ¨æ•°ï¼ˆACTIVEï¼‰ å ç”¨ç©ºé—´ï¼ˆSIZEï¼‰ å¯å›æ”¶ç©ºé—´ï¼ˆRECLAIMABLEï¼‰ Imagesï¼ˆé•œåƒï¼‰ 28 17 10.71GB 4.376GB (40%) Containersï¼ˆå®¹å™¨ï¼‰ 17 17 569MB 0B (0%) Local Volumesï¼ˆæœ¬åœ°å·ï¼‰ 3 0 0B 0B Build Cacheï¼ˆæ„å»ºç¼“å­˜ï¼‰ 0 0 0B 0B 2ï¸âƒ£ ç®¡ç†æ‚¬ç©ºé•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹æ‰€æœ‰æ‚¬ç©ºé•œåƒï¼ˆæ— æ ‡ç­¾é•œåƒï¼‰ podman images --filter \u0026#34;dangling=true\u0026#34; # æ¸…ç†æ‰€æœ‰æ‚¬ç©ºé•œåƒ podman image prune --force --filter \u0026#34;dangling=true\u0026#34; # åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶è®°å½•æ¸…ç†æ“ä½œ mkdir -pm 755 /mnt/podman-rmi-log \u0026amp;\u0026amp; \\ podman image prune --force --filter \u0026#34;dangling=true\u0026#34; \u0026gt; \u0026#34;/mnt/podman-rmi-log/$(date +\u0026#39;%Y-%m-%d\u0026#39;)_podman_rmi.log\u0026#34; # æ¸…ç†æŒ‡å®šæ—¶é—´å‰çš„é•œåƒ podman image prune --filter \u0026#34;until=24h\u0026#34; # æ¸…ç†24å°æ—¶å‰çš„é•œåƒ 3ï¸âƒ£ æŸ¥çœ‹æ¸…ç†æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æœ€è¿‘çš„æ¸…ç†æ—¥å¿— ls -lt /mnt/podman-rmi-log/*_podman_rmi.log | head -5 # æŸ¥çœ‹æœ€æ–°5ä¸ªæ—¥å¿—æ–‡ä»¶çš„å†…å®¹ ls -lt /mnt/podman-rmi-log/*_podman_rmi.log | head -5 | awk \u0026#39;{print $9}\u0026#39; | xargs cat # å®æ—¶æŸ¥çœ‹æ—¥å¿—æ›´æ–° tail -f /mnt/podman-rmi-log/$(date +\u0026#39;%Y-%m-%d\u0026#39;)_podman_rmi.log # æŸ¥æ‰¾åŒ…å«ç‰¹å®šä¿¡æ¯çš„æ—¥å¿— grep -r \u0026#34;deleted\u0026#34; /mnt/podman-rmi-log/ âš™ï¸ ä¸‰ã€é«˜çº§é•œåƒæ“ä½œ 1ï¸âƒ£ é•œåƒå¯¼å…¥å¯¼å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å°†é•œåƒå¯¼å‡ºä¸ºtaræ–‡ä»¶ podman save -o myimage.tar docker.io/openlistteam/openlist:latest # ä»taræ–‡ä»¶å¯¼å…¥é•œåƒ podman load -i myimage.tar # å¯¼å‡ºå¤šä¸ªé•œåƒ podman save -o multiple-images.tar image1:tag1 image2:tag2 # å¯¼å‡ºæ—¶å‹ç¼©é•œåƒ podman save --compress docker.io/openlistteam/openlist:latest | gzip \u0026gt; myimage.tar.gz # ä»æ ‡å‡†è¾“å…¥å¯¼å…¥é•œåƒ cat myimage.tar | podman load 2ï¸âƒ£ é•œåƒæ ‡ç­¾ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 # ç»™é•œåƒæ·»åŠ æ–°æ ‡ç­¾ podman tag docker.io/openlistteam/openlist:latest myregistry.com/openlist:1.0 # åˆ é™¤é•œåƒæ ‡ç­¾ podman untag docker.io/openlistteam/openlist:latest # æŸ¥çœ‹é•œåƒçš„æ‰€æœ‰æ ‡ç­¾ podman image inspect --format \u0026#34;{{.RepoTags}}\u0026#34; image_id # æ‰¹é‡é‡å‘½åæ ‡ç­¾ for image in $(podman images -q); do podman tag $image myregistry.com/$(podman image inspect --format \u0026#34;{{.RepoTags}}\u0026#34; $image | cut -d\u0026#39;:\u0026#39; -f1 | cut -d\u0026#39;/\u0026#39; -f2-) done 3ï¸âƒ£ é•œåƒæ£€æŸ¥ä¸åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯ podman image inspect docker.io/openlistteam/openlist:latest # æŸ¥çœ‹é•œåƒå†å² podman history docker.io/openlistteam/openlist:latest # æŸ¥çœ‹é•œåƒçš„å±‚çº§ä¿¡æ¯ podman image inspect --format \u0026#34;{{.RootFS.Layers}}\u0026#34; image_id # æŸ¥çœ‹é•œåƒåˆ›å»ºæ—¶é—´ podman image inspect --format \u0026#34;{{.Created}}\u0026#34; docker.io/openlistteam/openlist:latest # æŸ¥çœ‹é•œåƒæ¶æ„ä¿¡æ¯ podman image inspect --format \u0026#34;{{.Architecture}}\u0026#34; docker.io/openlistteam/openlist:latest 4ï¸âƒ£ é•œåƒæ„å»ºç›¸å…³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä»Dockerfileæ„å»ºé•œåƒ podman build -t myimage:1.0 . # æ„å»ºæ—¶æŒ‡å®šDockerfileè·¯å¾„ podman build -f Dockerfile.dev -t myimage:dev . # æŸ¥çœ‹æ„å»ºç¼“å­˜ podman build --cache-from localhost/buildcache:latest # ä¸ä½¿ç”¨ç¼“å­˜æ„å»º podman build --no-cache -t myimage:latest . # è®¾ç½®æ„å»ºå‚æ•° podman build --build-arg HTTP_PROXY=http://proxy.example.com -t myimage:latest . ğŸ” å››ã€é•œåƒæŸ¥è¯¢ä¸è¿‡æ»¤ 1ï¸âƒ£ é«˜çº§è¿‡æ»¤æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŒ‰åˆ›å»ºæ—¶é—´è¿‡æ»¤ podman images --filter \u0026#34;before=2023-01-01\u0026#34; # æŒ‰å¤§å°è¿‡æ»¤ podman images --filter \u0026#34;since=1GB\u0026#34; # æŒ‰æ ‡ç­¾è¿‡æ»¤ podman images --filter label=maintainer=admin@example.com # ç»„åˆå¤šä¸ªè¿‡æ»¤å™¨ podman images --filter \u0026#34;dangling=true\u0026#34; --filter \u0026#34;before=2023-01-01\u0026#34; # æŒ‰ä»“åº“åç§°è¿‡æ»¤ podman images --filter reference=\u0026#34;*nginx*\u0026#34; # æ’é™¤ç‰¹å®šä»“åº“ podman images --filter reference=\u0026#34;!docker.io/library/*\u0026#34; 2ï¸âƒ£ æ ¼å¼åŒ–è¾“å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è‡ªå®šä¹‰æ ¼å¼è¾“å‡º podman images --format \u0026#34;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}\\t{{.CreatedSince}}\u0026#34; # JSONæ ¼å¼è¾“å‡º podman images --format json # åªæ˜¾ç¤ºé•œåƒID podman images -q # Goæ¨¡æ¿æ ¼å¼åŒ–è¾“å‡º podman images --format \u0026#34;{{.ID}}: {{.Repository}}\u0026#34; # æ˜¾ç¤ºå®Œæ•´é•œåƒä¿¡æ¯ podman images --no-trunc 3ï¸âƒ£ é•œåƒç»Ÿè®¡ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç»Ÿè®¡é•œåƒæ•°é‡ podman images | wc -l # ç»Ÿè®¡å„ä»“åº“çš„é•œåƒæ•°é‡ podman images --format \u0026#34;{{.Repository}}\u0026#34; | sort | uniq -c | sort -nr # è®¡ç®—é•œåƒæ€»å¤§å° podman images --format \u0026#34;{{.Size}}\u0026#34; | sed \u0026#39;s/GB//g\u0026#39; | awk \u0026#39;{sum += $1} END {print sum \u0026#34;GB\u0026#34;}\u0026#39; # æŒ‰å¤§å°æ’åºé•œåƒ podman images --sort size # ç»Ÿè®¡å„æ ‡ç­¾çš„é•œåƒæ•°é‡ podman images --format \u0026#34;{{.Repository}}:{{.Tag}}\u0026#34; | cut -d\u0026#39;:\u0026#39; -f2 | sort | uniq -c ğŸ›¡ï¸ äº”ã€å®‰å…¨æœ€ä½³å®è·µ 1ï¸âƒ£ é•œåƒç­¾åéªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯ç”¨é•œåƒç­¾åéªŒè¯ podman pull --signature-policy /etc/containers/policy.json docker.io/library/nginx # æ£€æŸ¥é•œåƒç­¾å podman image trust show # è®¾ç½®ä¿¡ä»»ç­–ç•¥ podman image trust set --type accept docker.io/library/nginx # æ‹’ç»ç‰¹å®šä»“åº“çš„é•œåƒ podman image trust set --type reject docker.io/untrusted/ # æŸ¥çœ‹ä¿¡ä»»ç­–ç•¥è¯¦æƒ… podman image trust show --verbose 2ï¸âƒ£ æ¼æ´æ‰«æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨trivyæ‰«æé•œåƒæ¼æ´ï¼ˆéœ€è¦å…ˆå®‰è£…trivyï¼‰ trivy image docker.io/openlistteam/openlist:latest # æ‰«æå¹¶è¾“å‡ºJSONæŠ¥å‘Š trivy image -f json -o report.json docker.io/openlistteam/openlist:latest # æŒ‰ä¸¥é‡çº§åˆ«è¿‡æ»¤æ¼æ´ trivy image --severity HIGH,CRITICAL docker.io/openlistteam/openlist:latest # å¿½ç•¥ç‰¹å®šæ¼æ´ trivy image --ignore-unfixed docker.io/openlistteam/openlist:latest # ä½¿ç”¨grypeæ‰«ææ¼æ´ï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰ grype docker.io/openlistteam/openlist:latest 3ï¸âƒ£ é•œåƒæ¥æºéªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥é•œåƒçš„æ¥æºä¿¡æ¯ podman image inspect --format \u0026#34;{{.Digest}}\u0026#34; docker.io/openlistteam/openlist:latest # éªŒè¯é•œåƒçš„å®Œæ•´æ€§ podman image verify docker.io/openlistteam/openlist:latest # æ£€æŸ¥é•œåƒçš„å‘å¸ƒè€… podman image inspect --format \u0026#34;{{.Author}}\u0026#34; docker.io/openlistteam/openlist:latest # æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å² podman history --no-trunc docker.io/openlistteam/openlist:latest # æ£€æŸ¥é•œåƒçš„é…ç½® podman image inspect --format \u0026#34;{{.Config}}\u0026#34; docker.io/openlistteam/openlist:latest 4ï¸âƒ£ å®‰å…¨æ‰«æé›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä½¿ç”¨Podmanå†…ç½®å®‰å…¨æ£€æŸ¥ podman scan docker.io/openlistteam/openlist:latest # é›†æˆåˆ°CI/CDæµç¨‹ #!/bin/bash IMAGE=\u0026#34;docker.io/openlistteam/openlist:latest\u0026#34; podman pull $IMAGE trivy image --exit-code 1 --severity CRITICAL $IMAGE # å®šæœŸå®‰å…¨æ‰«æè„šæœ¬ #!/bin/bash for image in $(podman images -q); do echo \u0026#34;Scanning image: $image\u0026#34; trivy image --exit-code 0 --severity HIGH,CRITICAL $image done ğŸ“Š å…­ã€å®ç”¨è„šæœ¬ç¤ºä¾‹ 1ï¸âƒ£ å®šæœŸæ¸…ç†è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/bin/bash # cleanup-podman-images.sh LOG_DIR=\u0026#34;/mnt/podman-rmi-log\u0026#34; mkdir -p $LOG_DIR echo \u0026#34;==========================================\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; echo \u0026#34;$(date): å¼€å§‹Podmané•œåƒæ¸…ç†\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; echo \u0026#34;==========================================\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; # æ¸…ç†æ‚¬ç©ºé•œåƒ echo \u0026#34;$(date): å¼€å§‹æ¸…ç†æ‚¬ç©ºé•œåƒ\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; podman image prune --force --filter \u0026#34;dangling=true\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; # æ¸…ç†è¶…è¿‡30å¤©çš„æœªä½¿ç”¨é•œåƒ echo \u0026#34;$(date): å¼€å§‹æ¸…ç†è€æ—§é•œåƒ\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; podman image prune -a --force --filter \u0026#34;until=720h\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; # æ¸…ç†æ„å»ºç¼“å­˜ echo \u0026#34;$(date): å¼€å§‹æ¸…ç†æ„å»ºç¼“å­˜\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; podman builder prune --force --all \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; # æ˜¾ç¤ºæ¸…ç†åçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ echo \u0026#34;$(date): æ¸…ç†åçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; podman system df \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; echo \u0026#34;$(date): æ¸…ç†å®Œæˆ\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; echo \u0026#34;==========================================\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_DIR/cleanup.log\u0026#34; 2ï¸âƒ£ é•œåƒå¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #!/bin/bash # backup-podman-images.sh BACKUP_DIR=\u0026#34;/mnt/podman-backup/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR LOG_FILE=\u0026#34;$BACKUP_DIR/backup.log\u0026#34; echo \u0026#34;å¼€å§‹å¤‡ä»½Podmané•œåƒ - $(date)\u0026#34; | tee -a $LOG_FILE # å¤‡ä»½æ‰€æœ‰é•œåƒ for image in $(podman images --format \u0026#34;{{.ID}}\u0026#34;); do image_name=$(podman image inspect --format \u0026#34;{{index .RepoTags 0}}\u0026#34; $image) if [ -n \u0026#34;$image_name\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$image_name\u0026#34; != \u0026#34;\u0026lt;none\u0026gt;\u0026#34; ]; then # æ¸…ç†é•œåƒåç§°ä¸­çš„ç‰¹æ®Šå­—ç¬¦ safe_name=$(echo $image_name | tr \u0026#39;/:\u0026#39; \u0026#39;_\u0026#39;) backup_file=\u0026#34;$BACKUP_DIR/${safe_name}.tar\u0026#34; echo \u0026#34;æ­£åœ¨å¤‡ä»½: $image_name -\u0026gt; $backup_file\u0026#34; | tee -a $LOG_FILE podman save -o \u0026#34;$backup_file\u0026#34; $image 2\u0026gt;\u0026gt; $LOG_FILE if [ $? -eq 0 ]; then echo \u0026#34;å¤‡ä»½æˆåŠŸ: $backup_file\u0026#34; | tee -a $LOG_FILE else echo \u0026#34;å¤‡ä»½å¤±è´¥: $image_name\u0026#34; | tee -a $LOG_FILE fi fi done # åˆ›å»ºå¤‡ä»½æ¸…å• ls -la $BACKUP_DIR/*.tar \u0026gt; \u0026#34;$BACKUP_DIR/manifest.txt\u0026#34; echo \u0026#34;å¤‡ä»½å®Œæˆï¼Œæ€»è®¡: $(ls -1 $BACKUP_DIR/*.tar | wc -l) ä¸ªé•œåƒ\u0026#34; | tee -a $LOG_FILE 3ï¸âƒ£ é•œåƒåŒæ­¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #!/bin/bash # sync-podman-images.sh SOURCE_REGISTRY=\u0026#34;docker.io\u0026#34; TARGET_REGISTRY=\u0026#34;myprivate.registry.com\u0026#34; LOG_FILE=\u0026#34;/var/log/podman-sync-$(date +%Y%m%d).log\u0026#34; # éœ€è¦åŒæ­¥çš„é•œåƒåˆ—è¡¨ IMAGES=( \u0026#34;nginx:1.23\u0026#34; \u0026#34;redis:7.0\u0026#34; \u0026#34;postgres:15\u0026#34; \u0026#34;node:18\u0026#34; \u0026#34;python:3.11\u0026#34; ) echo \u0026#34;å¼€å§‹é•œåƒåŒæ­¥ - $(date)\u0026#34; | tee -a $LOG_FILE for image in \u0026#34;${IMAGES[@]}\u0026#34;; do echo \u0026#34;å¤„ç†é•œåƒ: $image\u0026#34; | tee -a $LOG_FILE # æ‹‰å–é•œåƒ if podman pull $SOURCE_REGISTRY/library/$image \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1; then echo \u0026#34;æ‹‰å–æˆåŠŸ: $image\u0026#34; | tee -a $LOG_FILE # é‡æ–°æ‰“æ ‡ç­¾ podman tag $SOURCE_REGISTRY/library/$image $TARGET_REGISTRY/$image # æ¨é€åˆ°ç›®æ ‡ä»“åº“ if podman push $TARGET_REGISTRY/$image \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1; then echo \u0026#34;æ¨é€æˆåŠŸ: $image\u0026#34; | tee -a $LOG_FILE else echo \u0026#34;æ¨é€å¤±è´¥: $image\u0026#34; | tee -a $LOG_FILE fi # æ¸…ç†æœ¬åœ°é•œåƒ podman rmi $SOURCE_REGISTRY/library/$image $TARGET_REGISTRY/$image else echo \u0026#34;æ‹‰å–å¤±è´¥: $image\u0026#34; | tee -a $LOG_FILE fi echo \u0026#34;----------------------------------------\u0026#34; | tee -a $LOG_FILE done echo \u0026#34;é•œåƒåŒæ­¥å®Œæˆ - $(date)\u0026#34; | tee -a $LOG_FILE 4ï¸âƒ£ é•œåƒå¥åº·æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 #!/bin/bash # healthcheck-podman-images.sh LOG_FILE=\u0026#34;/var/log/podman-healthcheck-$(date +%Y%m%d).log\u0026#34; ERROR_COUNT=0 echo \u0026#34;å¼€å§‹Podmané•œåƒå¥åº·æ£€æŸ¥ - $(date)\u0026#34; | tee -a $LOG_FILE # æ£€æŸ¥æ‰€æœ‰é•œåƒçš„å®Œæ•´æ€§ for image in $(podman images -q); do echo \u0026#34;æ£€æŸ¥é•œåƒ: $image\u0026#34; | tee -a $LOG_FILE # éªŒè¯é•œåƒå®Œæ•´æ€§ if ! podman image inspect $image \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;é”™è¯¯: é•œåƒ $image æŸå\u0026#34; | tee -a $LOG_FILE ((ERROR_COUNT++)) continue fi # æ£€æŸ¥é•œåƒæ˜¯å¦æœ‰æ ‡ç­¾ tags=$(podman image inspect --format \u0026#34;{{.RepoTags}}\u0026#34; $image) if [ \u0026#34;$tags\u0026#34; = \u0026#34;[]\u0026#34; ]; then echo \u0026#34;è­¦å‘Š: é•œåƒ $image æ— æ ‡ç­¾\u0026#34; | tee -a $LOG_FILE fi # æ£€æŸ¥é•œåƒå¤§å° size=$(podman image inspect --format \u0026#34;{{.Size}}\u0026#34; $image) if [ $size -gt 1073741824 ]; then # å¤§äº1GB echo \u0026#34;è­¦å‘Š: é•œåƒ $image è¿‡å¤§ ($((size/1024/1024))MB)\u0026#34; | tee -a $LOG_FILE fi done echo \u0026#34;å¥åº·æ£€æŸ¥å®Œæˆï¼Œå‘ç° $ERROR_COUNT ä¸ªé”™è¯¯ - $(date)\u0026#34; | tee -a $LOG_FILE if [ $ERROR_COUNT -gt 0 ]; then exit 1 else exit 0 fi ğŸš€ ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1ï¸âƒ£ åŠ é€Ÿé•œåƒæ‹‰å– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå™¨ podman pull registry.cn-hangzhou.aliyuncs.com/library/nginx:latest # é…ç½®é•œåƒåŠ é€Ÿå™¨ sudo mkdir -p /etc/containers sudo tee /etc/containers/registries.conf.d/mirror.conf \u0026lt;\u0026lt;EOF unqualified-search-registries = [\u0026#34;docker.io\u0026#34;] [[registry]] prefix = \u0026#34;docker.io\u0026#34; location = \u0026#34;docker.mirrors.ustc.edu.cn\u0026#34; [[registry]] prefix = \u0026#34;quay.io\u0026#34; location = \u0026#34;quay.mirrors.ustc.edu.cn\u0026#34; EOF # ä½¿ç”¨å¹¶å‘ä¸‹è½½ podman pull --concurrent-downloads=5 docker.io/library/nginx:latest # ä½¿ç”¨ç¼“å­˜ä»£ç† export HTTP_PROXY=\u0026#34;http://proxy.example.com:3128\u0026#34; export HTTPS_PROXY=\u0026#34;http://proxy.example.com:3128\u0026#34; podman pull docker.io/library/nginx:latest 2ï¸âƒ£ å‡å°‘ç£ç›˜å ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # ä½¿ç”¨ overlayfs å­˜å‚¨é©±åŠ¨ï¼ˆé»˜è®¤ï¼‰ sudo podman --storage-driver overlay2 # å®šæœŸæ¸…ç†æ„å»ºç¼“å­˜ podman builder prune -af # ä½¿ç”¨ squash é€‰é¡¹å‡å°‘é•œåƒå±‚æ•° podman build --squash -t myimage:squashed . # ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å° cat \u0026gt; Dockerfile \u0026lt;\u0026lt;EOF FROM node:18 as builder WORKDIR /app COPY . . RUN npm install \u0026amp;\u0026amp; npm run build FROM node:18-alpine WORKDIR /app COPY --from=builder /app/dist ./dist COPY --from=builder /app/package.json . RUN npm install --production CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/index.js\u0026#34;] EOF podman build -t myapp:optimized . 3ï¸âƒ£ ç½‘ç»œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ä½¿ç”¨æ›´å¿«çš„DNSæœåŠ¡å™¨ sudo tee /etc/containers/containers.conf.d/dns.conf \u0026lt;\u0026lt;EOF [network] dns_servers = [\u0026#34;8.8.8.8\u0026#34;, \u0026#34;1.1.1.1\u0026#34;] EOF # è°ƒæ•´ç½‘ç»œè¶…æ—¶è®¾ç½® sudo tee /etc/containers/containers.conf.d/network.conf \u0026lt;\u0026lt;EOF [engine] http_timeout = 300 ssh_timeout = 30 EOF # ä½¿ç”¨IPv4ä¼˜å…ˆ sudo tee /etc/containers/containers.conf.d/ipv4.conf \u0026lt;\u0026lt;EOF [network] prefer_ipv4 = true EOF 4ï¸âƒ£ å­˜å‚¨ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ä½¿ç”¨æ›´é«˜æ•ˆçš„å­˜å‚¨é©±åŠ¨ sudo podman --storage-driver overlay2 # è°ƒæ•´å­˜å‚¨é€‰é¡¹ sudo tee /etc/containers/storage.conf \u0026lt;\u0026lt;EOF [storage] driver = \u0026#34;overlay\u0026#34; runroot = \u0026#34;/var/run/containers/storage\u0026#34; graphroot = \u0026#34;/var/lib/containers/storage\u0026#34; [storage.options.overlay] mountopt = \u0026#34;nodev,metacopy=on\u0026#34; EOF # ä½¿ç”¨ç£ç›˜é…é¢é™åˆ¶ sudo podman --storage-opt size=50G # å®šæœŸä¼˜åŒ–å­˜å‚¨ podman system prune -af podman system reset --force ğŸ¯ æ€»ç»“ Podman æä¾›äº†å¼ºå¤§çš„é•œåƒç®¡ç†åŠŸèƒ½ï¼Œé€šè¿‡æœ¬æŒ‡å—ä½ å¯ä»¥ï¼š\nâœ… æ ¸å¿ƒèƒ½åŠ›æŒæ¡ é«˜æ•ˆç®¡ç†é•œåƒï¼šæ‹‰å–ã€æŸ¥çœ‹ã€åˆ é™¤é•œåƒçš„åŸºæœ¬æ“ä½œ æ™ºèƒ½æ¸…ç†ç»´æŠ¤ï¼šå®šæœŸæ¸…ç†æ‚¬ç©ºé•œåƒï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ é«˜çº§é•œåƒæ“ä½œï¼šå¯¼å…¥å¯¼å‡ºã€æ ‡ç­¾ç®¡ç†ã€é•œåƒåˆ†æ å®‰å…¨æœ€ä½³å®è·µï¼šé•œåƒéªŒè¯ã€æ¼æ´æ‰«æã€æ¥æºæ£€æŸ¥ è‡ªåŠ¨åŒ–è„šæœ¬ï¼šå¤‡ä»½ã€åŒæ­¥ã€æ¸…ç†çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆ ğŸ”§ æ—¥å¸¸ç»´æŠ¤å»ºè®® å®šæœŸæ¸…ç†ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡æ¯å‘¨æ¸…ç†ä¸€æ¬¡æœªä½¿ç”¨çš„é•œåƒ å®‰å…¨æ‰«æï¼šé›†æˆæ¼æ´æ‰«æåˆ°CI/CDæµç¨‹ä¸­ å¤‡ä»½ç­–ç•¥ï¼šé‡è¦é•œåƒå®šæœŸå¤‡ä»½åˆ°ç§æœ‰ä»“åº“ æ€§èƒ½ç›‘æ§ï¼šç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶æ¸…ç†å¤§ä½“ç§¯é•œåƒ æ›´æ–°ç­–ç•¥ï¼šå®šæœŸæ›´æ–°åŸºç¡€é•œåƒä»¥è·å–å®‰å…¨è¡¥ä¸ ğŸš€ è¿›é˜¶å­¦ä¹ æ–¹å‘ å­¦ä¹ Podmanå®¹å™¨ç®¡ç†å‘½ä»¤ æŒæ¡Podman Composeç¼–æ’å·¥å…· äº†è§£Podmanä¸Kubernetesçš„é›†æˆ æ¢ç´¢Podmançš„æ ¹lessæ¨¡å¼å®‰å…¨æ€§ä¼˜åŠ¿ å­¦ä¹ ä½¿ç”¨Buildahè¿›è¡Œé«˜çº§é•œåƒæ„å»º ğŸ’¡ æç¤ºï¼šå®šæœŸæ‰§è¡Œé•œåƒæ¸…ç†å’Œç»´æŠ¤æ“ä½œï¼Œå¯ä»¥ä¿æŒç³»ç»Ÿæ•´æ´å¹¶æé«˜æ€§èƒ½ã€‚å»ºè®®è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œæ¸…ç†è„šæœ¬ã€‚\n","date":"2025-08-26T17:26:57+08:00","image":"https://file.meimolihan.eu.org/img/podman-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e1d28a33/","title":"Podman é•œåƒç®¡ç†å®Œå…¨æŒ‡å— ğŸ“¦"},{"content":"Podman å®¹å™¨å¼•æ“å®‰è£…ä¸é…ç½® ğŸš€ ğŸ“¦ ä¸€ä¸ªæ— éœ€å®ˆæŠ¤è¿›ç¨‹ã€æ›´å®‰å…¨å¯é çš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·\nç›®å½• ğŸŒŸ é¡¹ç›®ç®€ä»‹ ğŸ“¥ å®‰è£… Podman âš™ï¸ åŸºæœ¬é…ç½® ğŸ“¦ é•œåƒç®¡ç† ğŸ³ å®¹å™¨ç®¡ç† ğŸŒ ç½‘ç»œä¸å¤šå®¹å™¨å®æˆ˜ âš¡ é«˜çº§ç‰¹æ€§ ğŸ”„ ç³»ç»ŸæœåŠ¡ä¸è‡ªå¯åŠ¨ ğŸ”§ æ•…éšœæ’æŸ¥ ğŸ“Š å‘½ä»¤å¯¹æ¯” ğŸ“ˆ æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ– ğŸŒŸ é¡¹ç›®ç®€ä»‹ Podmanï¼ˆPod Managerï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·ï¼Œç”¨äºå¼€å‘ã€ç®¡ç†å’Œè¿è¡Œ OCIï¼ˆOpen Container Initiativeï¼‰æ ‡å‡†çš„å®¹å™¨ã€‚ç”± Red Hat å¼€å‘å¹¶äº 2018 å¹´æ¨å‡ºï¼Œå®ƒé‡‡ç”¨æ— å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemon-lessï¼‰æ¶æ„ï¼Œä½œä¸º Docker çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæä¾›æ›´å®‰å…¨ã€æ›´è½»é‡çš„å®¹å™¨ç®¡ç†æ–¹å¼ã€‚\nâœ¨ ä¸»è¦ç‰¹ç‚¹ï¼š âœ… æ— éœ€å®ˆæŠ¤è¿›ç¨‹ï¼šé‡‡ç”¨ä¼ ç»Ÿçš„ fork-exec æ¨¡å¼ï¼Œä¸éœ€è¦é•¿æœŸè¿è¡Œçš„åå°æœåŠ¡ï¼Œæ›´åŠ è½»é‡å®‰å…¨ âœ… ä¸ Docker CLI å…¼å®¹ï¼šå­¦ä¹ æˆæœ¬ä½ï¼Œå¤§å¤šæ•°å‘½ä»¤ä¸ Docker ç›¸åŒ âœ… æ”¯æŒ rootless å®¹å™¨ï¼šå…è®¸é root ç”¨æˆ·è¿è¡Œå®¹å™¨ï¼Œæé«˜å®‰å…¨æ€§ âœ… å®Œæ•´çš„å®¹å™¨ç”Ÿæ€ç³»ç»Ÿæ”¯æŒï¼šæ”¯æŒå®¹å™¨ã€é•œåƒã€å·å’Œ pod çš„ç®¡ç† âœ… ä¸ systemd é›†æˆè‰¯å¥½ï¼šå¯ä»¥ç”Ÿæˆ systemd æœåŠ¡æ–‡ä»¶ï¼Œç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ âœ… æ”¯æŒ Pod æ¦‚å¿µï¼šç±»ä¼¼ Kubernetes ä¸­çš„ Podï¼Œå¯ç®¡ç†ä¸€ç»„å…±äº«èµ„æºçš„å®¹å™¨ ğŸ”„ Podman ä¸ Docker çš„ä¸»è¦åŒºåˆ« ç‰¹æ€§ Podman Docker æ¶æ„ æ— å®ˆæŠ¤è¿›ç¨‹ (daemon-less) å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œéœ€å®ˆæŠ¤è¿›ç¨‹ root æƒé™ æ”¯æŒé root ç”¨æˆ·è¿è¡Œå®¹å™¨ é€šå¸¸éœ€è¦ root æƒé™ å­˜å‚¨ é•œåƒå’Œå®¹å™¨å­˜å‚¨åœ¨ä¸åŒåœ°æ–¹ å¿…é¡»å­˜å‚¨åœ¨ Docker å¼•æ“æœ¬åœ° Pod æ”¯æŒ åŸç”Ÿæ”¯æŒ Pod æ¦‚å¿µ éœ€è¦é€šè¿‡ Docker Compose å®ç°ç±»ä¼¼åŠŸèƒ½ ğŸ“¥ å®‰è£… Podmanï¼ˆDebian/Ubuntuï¼‰ 1. ä»ç³»ç»Ÿä»“åº“å®‰è£… 1 2 3 4 5 # æ›´æ–°ç³»ç»ŸåŒ…åˆ—è¡¨ sudo apt update # å®‰è£… Podman sudo apt install -y podman 2. ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…æœ€æ–°ç‰ˆï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯¼å…¥ GPG å¯†é’¥ source /etc/os-release wget http://downloadcontent.opensuse.org/repositories/home:/alvistack/Debian_$VERSION_ID/Release.key -O alvistack_key cat alvistack_key | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/alvistack.gpg \u0026gt;/dev/null # æ·»åŠ å®‰è£…æº echo \u0026#34;deb http://downloadcontent.opensuse.org/repositories/home:/alvistack/Debian_$VERSION_ID/ /\u0026#34; | sudo tee /etc/apt/sources.list.d/alvistack.list # å®‰è£… Podman åŠä¾èµ– sudo apt update sudo apt -y install podman uidmap dbus-x11 slirp4netns libpam-systemd podman-aardvark-dns podman-netavark podman-docker # éªŒè¯å®‰è£… podman --version 3. å®‰è£… pipx å’Œ podman-compose 1 2 3 4 5 6 7 8 9 # å®‰è£… pipx sudo apt install -y pipx pipx ensurepath # å®‰è£… podman-compose pipx install podman-compose # éªŒè¯å®‰è£… podman-compose --version ğŸ’¡ æç¤ºï¼šå®‰è£…å®Œæˆåï¼Œå¯èƒ½éœ€è¦é‡æ–°ç™»å½• SSH ä¼šè¯æˆ–æ‰§è¡Œ source ~/.bashrc æ¥åˆ·æ–°ç¯å¢ƒå˜é‡ã€‚\nâš™ï¸ åŸºæœ¬é…ç½® 1. é…ç½®å›½å†…é•œåƒåŠ é€Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆ›å»ºé…ç½®ç›®å½• sudo mkdir -p /etc/containers # é…ç½®é•œåƒåŠ é€Ÿå™¨ sudo tee /etc/containers/registries.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; unqualified-search-registries = [\u0026#34;docker.io\u0026#34;] [[registry]] prefix = \u0026#34;docker.io\u0026#34; location = \u0026#34;docker.1ms.run\u0026#34; [[registry]] prefix = \u0026#34;dockerio\u0026#34; location = \u0026#34;hub.rat.dev\u0026#34; [[registry]] prefix = \u0026#34;docker.io\u0026#34; location = \u0026#34;docker.xuanyuan.me\u0026#34; [[registry]] prefix = \u0026#34;docker.io\u0026#34; location = \u0026#34;docker.1panel.live\u0026#34; EOF 2. é…ç½®æ— æ ¹æ¨¡å¼ï¼ˆRootless Modeï¼‰ 1 2 3 4 5 6 7 8 9 # æ·»åŠ ä¸“ç”¨ç”¨æˆ· sudo useradd -r -m -s /bin/bash podman # é…ç½®ç”¨æˆ·å­UIDå’Œå­GID echo \u0026#34;podman:100000:65536\u0026#34; | sudo tee -a /etc/subuid echo \u0026#34;podman:100000:65536\u0026#34; | sudo tee -a /etc/subgid # å¯ç”¨ç”¨æˆ· lingerï¼Œå…è®¸ç”¨æˆ·æ— ç™»å½•ä¼šè¯è¿è¡Œå®¹å™¨ sudo loginctl enable-linger podman 3. è§£å†³æ— æ ¹æ¨¡å¼ä¸‹çš„è­¦å‘Š åœ¨é root ç”¨æˆ·ä¸‹ä½¿ç”¨ Podman æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ° cgroup è­¦å‘Šï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®è§£å†³ï¼š\n1 2 3 4 5 6 7 8 9 # åˆ›å»ºç”¨æˆ·çº§é…ç½®ç›®å½• mkdir -p ~/.config/containers # åˆ›å»ºé…ç½®æ–‡ä»¶ tee ~/.config/containers/containers.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [engine] events_logger = \u0026#34;file\u0026#34; cgroup_manager = \u0026#34;cgroupfs\u0026#34; EOF ğŸ“¦ é•œåƒç®¡ç† Podman çš„é•œåƒç®¡ç†ä¸ Docker ç±»ä¼¼ï¼Œä½†æ‹‰å–é•œåƒæ—¶é€šå¸¸éœ€è¦æŒ‡å®šå®Œæ•´çš„æ³¨å†Œè¡¨è·¯å¾„ã€‚\nå¸¸ç”¨é•œåƒç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æœç´¢é•œåƒ podman search nginx --filter=stars=5000 # æ‹‰å–é•œåƒï¼ˆéœ€è¦æŒ‡å®šå®Œæ•´æ³¨å†Œè¡¨è·¯å¾„ï¼‰ podman pull docker.io/library/nginx:latest # åˆ—å‡ºæœ¬åœ°é•œåƒ podman images # åˆ é™¤é•œåƒ podman rmi -f feb5d9fea6a5 # å¯¼å‡ºé•œåƒ podman save -o nginx.tar docker.io/nginx # å¯¼å…¥é•œåƒ podman load -i nginx.tar ğŸ³ å®¹å™¨ç®¡ç† 1. å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ podman run -itd --name my_nginx -p 80:80 nginx # å¯åŠ¨/åœæ­¢/é‡å¯å®¹å™¨ podman start my_nginx podman stop my_nginx podman restart my_nginx # åˆ é™¤å®¹å™¨ podman rm -f my_nginx 2. å®¹å™¨äº¤äº’ä¸ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 # è¿›å…¥å®¹å™¨ç»ˆç«¯ podman exec -it my_nginx /bin/bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— podman logs -tf --tail 50 my_nginx # æŸ¥çœ‹èµ„æºå ç”¨æƒ…å†µ podman stats my_nginx # æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ä¿¡æ¯ podman top my_nginx 3. æ•°æ®ç®¡ç† 1 2 3 4 5 # ç›®å½•æŒ‚è½½ podman run -v /host/path:/container/path nginx # æ–‡ä»¶å¤åˆ¶ podman cp my_nginx:/etc/nginx/nginx.conf ./ ğŸŒ ç½‘ç»œä¸å¤šå®¹å™¨å®æˆ˜ï¼ˆLEMP ç¯å¢ƒï¼‰ 1. åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ 1 2 3 4 5 # åˆ›å»ºæ¡¥æ¥ç½‘ç»œ podman network create lemp --subnet 10.88.0.0/24 # æŸ¥çœ‹ç½‘ç»œä¿¡æ¯ podman network ls 2. å¯åŠ¨å®¹å™¨é›†ç¾¤ 1 2 3 4 5 6 7 8 9 10 11 # Nginx å®¹å™¨ podman run -d --name nginx --network lemp --ip 10.88.0.10 \\ -p 80:80 -v /html:/usr/share/nginx/html nginx # PHP-FPM å®¹å™¨ podman run -d --name php-fpm --network lemp --ip 10.88.0.20 \\ -v /html:/var/www/html bitnami/php-fpm # MariaDB å®¹å™¨ podman run -d --name mariadb --network lemp --ip 10.88.0.30 \\ -v /sql_data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=secret mariadb 3. Nginx è¿æ¥ PHP-FPM é…ç½® ä¿®æ”¹ Nginx ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  PHP å¤„ç†ï¼š\n1 2 3 4 5 location ~ \\.php$ { fastcgi_pass 10.88.0.20:9000; include fastcgi_params; fastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name; } 4. æµ‹è¯•å®¹å™¨é€šä¿¡ 1 2 3 4 5 # æµ‹è¯•å®¹å™¨é—´é€šä¿¡ podman exec -it nginx ping php-fpm # æµ‹è¯•ä¸å®¿ä¸»æœºçš„é€šä¿¡ podman exec -it nginx ping host.containers.internal âš¡ é«˜çº§ç‰¹æ€§ 1. Pod ç®¡ç† Podman æ”¯æŒ Pod æ¦‚å¿µï¼Œç±»ä¼¼äº Kubernetes ä¸­çš„ Podï¼Œå…è®¸ä¸€ç»„å®¹å™¨å…±äº«ç›¸åŒçš„ç½‘ç»œã€PID å’Œ IPC å‘½åç©ºé—´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»º Podï¼ˆå¯èƒ½éœ€è¦å…ˆæ‹‰å– infra é•œåƒï¼‰ podman pull registry.aliyuncs.com/google_containers/pause:3.2 podman image tag registry.aliyuncs.com/google_containers/pause:3.2 k8s.gcr.io/pause:3.2 podman pod create --name mypod # åœ¨ Pod ä¸­è¿è¡Œå®¹å™¨ podman run -d --pod mypod --name container1 nginx podman run -d --pod mypod --name container2 alpine ping 8.8.8.8 # æŸ¥çœ‹ Pod podman pod ps podman ps --pod 2. ç‰¹æƒå®¹å™¨ ç‰¹æƒå®¹å™¨çªç ´é»˜è®¤éš”ç¦»é™åˆ¶ï¼Œéœ€è°¨æ…ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 # è®¿é—®ä¸»æœºè¿›ç¨‹ podman run --privileged --pid=host alpine ps aux # è®¿é—®ä¸»æœºç½‘ç»œ podman run --net=host nginx # æŒ‚è½½ä¸»æœºè®¾å¤‡ podman run --privileged -v /dev:/dev ubuntu è­¦å‘Šï¼šç‰¹æƒå®¹å™¨å­˜åœ¨å®‰å…¨é£é™©ï¼Œä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å¹¶é…åˆ --cap-add ç²¾ç»†åŒ–æˆæƒã€‚\nğŸ”„ ç³»ç»ŸæœåŠ¡ä¸è‡ªå¯åŠ¨ Podman å¯ä»¥ä¸ systemd é›†æˆï¼Œå°†å®¹å™¨ä½œä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†ã€‚\n1. ç”Ÿæˆ systemd æœåŠ¡æ–‡ä»¶ 1 2 3 4 5 6 # ç”ŸæˆæœåŠ¡æ–‡ä»¶ podman generate systemd --new --name nginx \u0026gt; ~/.config/systemd/user/container-nginx.service # å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ systemctl --user enable container-nginx.service systemctl --user start container-nginx.service 2. å¯ç”¨ç”¨æˆ·çº§æœåŠ¡æŒä¹…åŒ– 1 2 # å¯ç”¨ç”¨æˆ· lingerï¼Œå…è®¸ç”¨æˆ·æœåŠ¡åœ¨æ— ç™»å½•ä¼šè¯æ—¶è¿è¡Œ sudo loginctl enable-linger $USER ğŸ”§ æ•…éšœæ’æŸ¥ 1. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³• é—®é¢˜ä¸€ï¼šé•œåƒæ‹‰å–å¤±è´¥\n1 2 3 4 5 # æ£€æŸ¥æ³¨å†Œè¡¨é…ç½® cat /etc/containers/registries.conf # å°è¯•ä½¿ç”¨å…¶ä»–é•œåƒæº podman pull registry.aliyuncs.com/library/nginx é—®é¢˜äºŒï¼šæƒé™é”™è¯¯\n1 2 3 4 5 6 7 # æ£€æŸ¥ç”¨æˆ·å‘½åç©ºé—´é…ç½® cat /etc/subuid cat /etc/subgid # å¯ç”¨ç”¨æˆ·å‘½åç©ºé—´ echo \u0026#39;kernel.unprivileged_userns_clone=1\u0026#39; | sudo tee /etc/sysctl.d/userns.conf sudo sysctl -p é—®é¢˜ä¸‰ï¼šcgroup è­¦å‘Š\n1 2 3 # åˆ›å»ºç”¨æˆ·çº§é…ç½®è§£å†³ cgroup è­¦å‘Š mkdir -p ~/.config/containers echo -e \u0026#34;[engine]\\nevents_logger = \\\u0026#34;file\\\u0026#34;\\ncgroup_manager = \\\u0026#34;cgroupfs\\\u0026#34;\u0026#34; \u0026gt; ~/.config/containers/containers.conf é—®é¢˜å››ï¼šç«¯å£å†²çª\n1 2 3 4 5 # æ£€æŸ¥ç«¯å£ä½¿ç”¨æƒ…å†µ ss -tulpn | grep :80 # ä½¿ç”¨ä¸åŒç«¯å£è¿è¡Œå®¹å™¨ podman run -d --name nginx -p 8080:80 nginx ğŸ“Š å‘½ä»¤å¯¹æ¯” Podman ä¸ Docker å‘½ä»¤å¯¹æ¯”è¡¨ åŠŸèƒ½ Docker å‘½ä»¤ Podman å‘½ä»¤ è¯´æ˜ åˆ—å‡ºå®¹å™¨ docker ps podman ps åˆ—å‡ºè¿è¡Œä¸­çš„å®¹å™¨ åˆ—å‡ºé•œåƒ docker images podman images åˆ—å‡ºæœ¬åœ°é•œåƒ è¿è¡Œå®¹å™¨ docker run podman run è¿è¡Œå®¹å™¨ æ„å»ºé•œåƒ docker build podman build æ„å»ºé•œåƒ å®¹å™¨ç¼–æ’ docker-compose up podman-compose up å¯åŠ¨ compose é¡¹ç›® æŸ¥çœ‹æ—¥å¿— docker logs podman logs æŸ¥çœ‹å®¹å™¨æ—¥å¿— æ‰§è¡Œå‘½ä»¤ docker exec podman exec åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ ğŸ“ˆ æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ– 1. èµ„æºç›‘æ§ 1 2 3 4 5 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ podman stats # æŸ¥çœ‹ç³»ç»Ÿçº§å®¹å™¨èµ„æºä½¿ç”¨ podman system df 2. èµ„æºé™åˆ¶ 1 2 # è¿è¡Œå¸¦èµ„æºé™åˆ¶çš„å®¹å™¨ podman run -it --memory=512m --cpus=1.5 alpine 3. æ¸…ç†æ— ç”¨èµ„æº 1 2 3 4 5 6 7 8 # æ¸…ç†åœæ­¢çš„å®¹å™¨ podman container prune # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ podman image prune # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº podman system prune ğŸ’ æ€»ç»“ Podman æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”å®‰å…¨çš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·ï¼Œå®ƒä»¥å…¶æ— å®ˆæŠ¤è¿›ç¨‹çš„æ¶æ„å’Œå‡ºè‰²çš„ rootless æ”¯æŒè€Œè„±é¢–è€Œå‡ºã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š\nâœ… åœ¨ Debian/Ubuntu ç³»ç»Ÿä¸Šå®‰è£…å’Œé…ç½® Podman âœ… ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå™¨æé«˜æ‹‰å–é€Ÿåº¦ âœ… ç®¡ç†å®¹å™¨å’Œé•œåƒï¼ŒåŒ…æ‹¬ Pod çš„åˆ›å»ºå’Œç®¡ç† âœ… é…ç½®å®¹å™¨ç½‘ç»œå’Œå¤šå®¹å™¨åº”ç”¨ç¯å¢ƒ âœ… å°†å®¹å™¨é›†æˆåˆ° systemd ç³»ç»Ÿä¸­ä½œä¸ºæœåŠ¡è¿è¡Œ âœ… æ’æŸ¥å¸¸è§é—®é¢˜å¹¶ä¼˜åŒ–æ€§èƒ½ Podman ç‰¹åˆ«é€‚åˆå¸Œæœ›é¿å…å®ˆæŠ¤è¿›ç¨‹å®‰å…¨é£é™©çš„ç”¨æˆ·ï¼Œä»¥åŠéœ€è¦åœ¨é root ç¯å¢ƒä¸‹è¿è¡Œå®¹å™¨çš„åœºæ™¯ã€‚éšç€å®¹å™¨æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒPodman æ­£æˆä¸ºä¸€ä¸ªè¶Šæ¥è¶Šå—æ¬¢è¿çš„ Docker æ›¿ä»£æ–¹æ¡ˆã€‚\nğŸ“š æ‰©å±•èµ„æº Podman å®˜æ–¹æ–‡æ¡£ Podman GitHub ä»“åº“ OCI æ ‡å‡†æ–‡æ¡£ å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ ","date":"2025-08-26T17:24:39+08:00","image":"https://file.meimolihan.eu.org/img/podman-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d99c6c6d/","title":"Podman å®¹å™¨å¼•æ“å®‰è£…ä¸é…ç½® ğŸš€"},{"content":"Git é¡¹ç›®ç®¡ç†å·¥å…·è„šæœ¬ ğŸ› ï¸ åŠŸèƒ½å¼ºå¤§çš„å›¾å½¢åŒ– Git å¤šä»“åº“ç®¡ç†å·¥å…·ï¼Œæå‡å¼€å‘æ•ˆç‡\nğŸ“‹ æ–‡ç« ç›®å½• ğŸŒŸ å·¥å…·æ¦‚è¿° ğŸš€ å¿«é€Ÿå¼€å§‹ 1. ä» GitHub è¿è¡Œ 2. ä» Gitee è¿è¡Œ 3. æœ¬åœ°å®‰è£… ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ 1. æ‹‰å–å½“å‰ä»“åº“æ›´æ–° 2. æ¨é€å½“å‰ä»“åº“æ›´æ”¹ 3. æ ‡ç­¾ç®¡ç†åŠŸèƒ½ 4. æ‰¹é‡æ‹‰å–æ›´æ–° 5. æ‰¹é‡æ¨é€æ›´æ–° 6. ä»“åº“å…‹éš†ç®¡ç† âš™ï¸ å®‰è£…ä¸é…ç½® 1. å…¨å±€å®‰è£… 2. é…ç½®æ–‡ä»¶ 3. ä»“åº“åˆ—è¡¨æ ¼å¼ ğŸ–¥ï¸ ç•Œé¢ä¸äº¤äº’ 1. ä¸»ç•Œé¢é¢„è§ˆ 2. å¿«æ·é”®æ”¯æŒ 3. çŠ¶æ€æŒ‡ç¤ºå™¨ ğŸ”§ é«˜çº§åŠŸèƒ½ 1. è‡ªå®šä¹‰é…ç½® 2. æ‰¹é‡æ“ä½œ 3. ç½‘ç»œä¼˜åŒ– ğŸ® ä½¿ç”¨ç¤ºä¾‹ 1. æ—¥å¸¸æ›´æ–°æµç¨‹ 2. ç‰ˆæœ¬å‘å¸ƒæµç¨‹ 3. æ–°ç¯å¢ƒæ­å»º âš ï¸ æ³¨æ„äº‹é¡¹ 1. æƒé™è¦æ±‚ 2. å†²çªå¤„ç† 3. å¤‡ä»½ç­–ç•¥ âŒ æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜ 2. è§£å†³æ–¹æ¡ˆ ğŸŒŸ å·¥å…·æ¦‚è¿° Git é¡¹ç›®ç®¡ç†å·¥å…·æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Bash è„šæœ¬ï¼Œæä¾›å›¾å½¢åŒ–ç•Œé¢æ¥é«˜æ•ˆç®¡ç†å¤šä¸ª Git ä»“åº“ã€‚ä¸“ä¸ºéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªé¡¹ç›®çš„å¼€å‘è€…è®¾è®¡ï¼âœ¨\nğŸ¯ è®¾è®¡ç†å¿µï¼š ä¸€ç«™å¼ç®¡ç†ï¼šç»Ÿä¸€ç•Œé¢ç®¡ç†æ‰€æœ‰ Git ä»“åº“æ“ä½œ æ‰¹é‡å¤„ç†ï¼šæ”¯æŒåŒæ—¶æ“ä½œå¤šä¸ªä»“åº“ï¼ŒèŠ‚çœæ—¶é—´ å¯è§†åŒ–åé¦ˆï¼šæ¸…æ™°çš„çŠ¶æ€æŒ‡ç¤ºå’Œè¿›åº¦æ˜¾ç¤º å®‰å…¨å¯é ï¼šåŒ…å«å®‰å…¨æ£€æŸ¥å’Œå®‰å…¨æ“ä½œç¡®è®¤ ğŸš€ é€‚ç”¨åœºæ™¯ï¼š ğŸ”§ å¤šé¡¹ç›®å¼€å‘ï¼šåŒæ—¶ç»´æŠ¤å¤šä¸ªç›¸å…³é¡¹ç›® ğŸ¢ å›¢é˜Ÿåä½œï¼šç»Ÿä¸€å›¢é˜Ÿæˆå‘˜çš„ Git æ“ä½œæµç¨‹ ğŸ“¦ ç‰ˆæœ¬å‘å¸ƒï¼šç®€åŒ–æ ‡ç­¾ç®¡ç†å’Œç‰ˆæœ¬å‘å¸ƒæµç¨‹ ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼šåœ¨æ–°ç¯å¢ƒä¸­å¿«é€Ÿå…‹éš†å’Œé…ç½®æ‰€æœ‰ä»“åº“ ğŸ’¡ æ•ˆç‡æå‡ï¼šä½¿ç”¨æ­¤å·¥å…·ï¼Œç®¡ç† 10 ä¸ªä»“åº“çš„æ—¶é—´ä»åŸæ¥çš„ 15 åˆ†é’Ÿå‡å°‘åˆ° 2 åˆ†é’Ÿï¼Œæ•ˆç‡æå‡ 87%ï¼\nğŸš€ å¿«é€Ÿå¼€å§‹ 1. ä» GitHub è¿è¡Œ 1 2 3 4 5 # ç›´æ¥è¿è¡Œæœ€æ–°ç‰ˆæœ¬ bash \u0026lt;(curl -sL https://raw.githubusercontent.com/meimolihan/script/master/sh/git/git-manager-tool.sh) # ä½¿ç”¨åŠ é€Ÿé•œåƒï¼ˆå¦‚é‡åˆ°ç½‘ç»œé—®é¢˜ï¼‰ bash \u0026lt;(curl -sL https://cdn.jsdelivr.net/gh/meimolihan/script/sh/git/git-manager-tool.sh) 2. ä» Gitee è¿è¡Œï¼ˆå›½å†…åŠ é€Ÿï¼‰ 1 2 3 4 5 # å›½å†…ç”¨æˆ·æ¨èä½¿ç”¨ Gitee é•œåƒ bash \u0026lt;(curl -sL https://gitee.com/meimolihan/script/raw/master/sh/git/git-manager-tool.sh) # æˆ–è€…ä½¿ç”¨æ•°å­—IPåŠ é€Ÿ bash \u0026lt;(curl -sL http://180.76.76.73/script/raw/master/sh/git/git-manager-tool.sh) 3. æœ¬åœ°å®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä¸‹è½½è„šæœ¬åˆ°æœ¬åœ° curl -o git-manager.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git-manager-tool.sh # æ·»åŠ æ‰§è¡Œæƒé™ chmod +x git-manager.sh # éªŒè¯è„šæœ¬å®Œæ•´æ€§ï¼ˆå¯é€‰ï¼‰ sha256sum git-manager.sh # è¿è¡Œè„šæœ¬ ./git-manager.sh # æ·»åŠ åˆ° PATHï¼ˆæ–¹ä¾¿ä½¿ç”¨ï¼‰ sudo cp git-manager.sh /usr/local/bin/git-manager ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ 1. ğŸ“¥ æ‹‰å–å½“å‰ä»“åº“æ›´æ–° 1 2 3 4 5 6 # å®‰å…¨æ‹‰å–æœºåˆ¶ï¼šä½¿ç”¨ --ff-only é¿å…æ„å¤–åˆå¹¶ git pull --ff-only # æ™ºèƒ½æ£€æµ‹ï¼šè‡ªåŠ¨è¯†åˆ«å½“å‰ç›®å½•çš„Gitä»“åº“ # çŠ¶æ€åé¦ˆï¼šæ˜¾ç¤ºæ‹‰å–ç»“æœå’Œæ›´æ–°çŠ¶æ€ # é”™è¯¯å¤„ç†ï¼šé‡åˆ°å†²çªæ—¶æä¾›å‹å¥½æç¤º ä½¿ç”¨åœºæ™¯ï¼š\næ¯æ—¥å¼€å§‹å·¥ä½œå‰åŒæ­¥æœ€æ–°ä»£ç  è·å–å›¢é˜Ÿæˆå‘˜çš„æ›´æ”¹ ç¡®ä¿æœ¬åœ°ä»“åº“ä¸è¿œç¨‹åŒæ­¥ 2. ğŸ“¤ æ¨é€å½“å‰ä»“åº“æ›´æ”¹ 1 2 3 4 5 6 # è‡ªåŠ¨åˆ†æ”¯æ£€æµ‹ï¼šæ¨é€å½“å‰æ‰€åœ¨åˆ†æ”¯ git push origin $(git branch --show-current) # å®‰å…¨æ£€æŸ¥ï¼šç¡®è®¤æœ‰æäº¤æ‰æ¨é€ # çŠ¶æ€åé¦ˆï¼šæ˜¾ç¤ºæ¨é€ç»“æœ # é”™è¯¯å¤„ç†ï¼šæƒé™ä¸è¶³æ—¶çš„å‹å¥½æç¤º ä½¿ç”¨åœºæ™¯ï¼š\næ¨é€æœ¬åœ°æäº¤åˆ°è¿œç¨‹ä»“åº“ åˆ†äº«ä»£ç æ›´æ”¹ç»™å›¢é˜Ÿæˆå‘˜ éƒ¨ç½²å‰çš„ä»£ç æ¨é€ 3. ğŸ·ï¸ æ ‡ç­¾ç®¡ç†åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 # å­èœå•é€‰é¡¹ï¼š # 1. åˆ›å»ºæ–°æ ‡ç­¾ï¼šgit tag -a \u0026lt;tag\u0026gt; -m \u0026#34;\u0026lt;message\u0026gt;\u0026#34; # 2. åˆ é™¤æ ‡ç­¾ï¼šgit tag -d \u0026lt;tag\u0026gt; # 3. æ¨é€æ ‡ç­¾ï¼šgit push origin \u0026lt;tag\u0026gt; # 4. æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ï¼šgit tag -l # æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ # è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·å»ºè®® # æ ‡ç­¾æè¿°æ¨¡æ¿æ”¯æŒ ä½¿ç”¨åœºæ™¯ï¼š\nç‰ˆæœ¬å‘å¸ƒç®¡ç† é‡è¦é‡Œç¨‹ç¢‘æ ‡è®° ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² 4. ğŸ“¥ æ‰¹é‡æ‹‰å–æ›´æ–° 1 2 3 4 5 6 7 8 9 # é€’å½’æ‰«æå½“å‰ç›®å½•åŠå­ç›®å½• find . -name \u0026#34;.git\u0026#34; -type d | while read gitdir; do repo_path=$(dirname \u0026#34;$gitdir\u0026#34;) cd \u0026#34;$repo_path\u0026#34; \u0026amp;\u0026amp; git pull --ff-only done # è¿›åº¦æ˜¾ç¤ºï¼šå½“å‰è¿›åº¦/æ€»ä»“åº“æ•° # ç»“æœæ±‡æ€»ï¼šæˆåŠŸ/å¤±è´¥/è·³è¿‡çš„ç»Ÿè®¡ # æ™ºèƒ½è·³è¿‡ï¼šæœ‰æœ¬åœ°ä¿®æ”¹çš„ä»“åº“è‡ªåŠ¨è·³è¿‡ ä½¿ç”¨åœºæ™¯ï¼š\nå®šæœŸåŒæ­¥æ‰€æœ‰é¡¹ç›® æ–°ä¸€å¤©å¼€å§‹å‰çš„å‡†å¤‡å·¥ä½œ å¤šé¡¹ç›®ä¾èµ–æ›´æ–° 5. ğŸ“¤ æ‰¹é‡æ¨é€æ›´æ–° 1 2 3 4 5 6 7 8 # åªæ¨é€æœ‰æœ¬åœ°æäº¤çš„ä»“åº“ git status --porcelain | if grep -q \u0026#34;M\\|A\\|D\\|R\u0026#34;; then git push origin $(git branch --show-current) fi # å˜æ›´æ£€æµ‹ï¼šåªæ¨é€æœ‰æ”¹åŠ¨çš„ä»“åº“ # æ‰¹é‡ç¡®è®¤ï¼šæ¨é€å‰æ˜¾ç¤ºæ‰€æœ‰å¾…æ¨é€ä»“åº“ # ç»“æœæ±‡æ€»ï¼šæ¨é€ç»“æœç»Ÿè®¡ ä½¿ç”¨åœºæ™¯ï¼š\nä¸€å¤©å·¥ä½œç»“æŸåçš„ä»£ç æäº¤ å¤šä¸ªç›¸å…³é¡¹ç›®åŒæ—¶å‘å¸ƒ å›¢é˜Ÿåä½œæ—¶çš„æ‰¹é‡æ›´æ–° 6. ğŸ“¦ ä»“åº“å…‹éš†ç®¡ç† 1 2 3 4 5 6 7 8 9 # ä»é…ç½®æ–‡ä»¶æ‰¹é‡å…‹éš†ä»“åº“ while read repo_url; do git clone \u0026#34;$repo_url\u0026#34; done \u0026lt; repo-list.txt # æ”¯æŒ SSH å’Œ HTTPS åè®® # å…‹éš†è¿›åº¦æ˜¾ç¤º # é”™è¯¯é‡è¯•æœºåˆ¶ # å­˜åœ¨è·³è¿‡æœºåˆ¶ ä½¿ç”¨åœºæ™¯ï¼š\næ–°æœºå™¨ç¯å¢ƒæ­å»º æ–°å›¢é˜Ÿæˆå‘˜å…¥èŒ é¡¹ç›®è¿ç§»å’Œå¤‡ä»½ âš™ï¸ å®‰è£…ä¸é…ç½® 1. å…¨å±€å®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ¨èå®‰è£…æ–¹æ³• curl -o /usr/local/bin/git-manager \\ https://gitee.com/meimolihan/script/raw/master/sh/git/git-manager-tool.sh chmod +x /usr/local/bin/git-manager # éªŒè¯å®‰è£… git-manager --version # åˆ›å»ºåˆ«åï¼ˆå¯é€‰ï¼‰ echo \u0026#34;alias gm=\u0026#39;git-manager\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc # ç°åœ¨å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä½¿ç”¨ gm 2. é…ç½®æ–‡ä»¶ åˆ›å»º ~/.git-manager.conf è¿›è¡Œä¸ªæ€§åŒ–é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # ~/.git-manager.conf # Git é¡¹ç›®ç®¡ç†å·¥å…·é…ç½® # å¿½ç•¥çš„ç›®å½•ï¼ˆä¸ä¼šæ‰«æè¿™äº›ç›®å½•ä¸­çš„Gitä»“åº“ï¼‰ IGNORE_DIRS=(\u0026#34;node_modules\u0026#34; \u0026#34;vendor\u0026#34; \u0026#34;dist\u0026#34; \u0026#34;build\u0026#34; \u0026#34;.cache\u0026#34;) # é»˜è®¤è¿œç¨‹åç§° DEFAULT_REMOTE=\u0026#34;origin\u0026#34; # é¢œè‰²ä¸»é¢˜è®¾ç½®ï¼ˆauto/light/darkï¼‰ THEME=\u0026#34;auto\u0026#34; # è‡ªåŠ¨ç¡®è®¤æ“ä½œï¼ˆtrue/falseï¼‰ AUTO_CONFIRM=false # æ—¥å¿—æ–‡ä»¶ä½ç½® LOG_FILE=\u0026#34;$HOME/.git-manager.log\u0026#34; # æœ€å¤§é€’å½’æ·±åº¦ MAX_DEPTH=3 # è¶…æ—¶è®¾ç½®ï¼ˆç§’ï¼‰ PULL_TIMEOUT=300 PUSH_TIMEOUT=300 CLONE_TIMEOUT=600 3. ä»“åº“åˆ—è¡¨æ ¼å¼ åˆ›å»ºä»“åº“åˆ—è¡¨æ–‡ä»¶ç”¨äºæ‰¹é‡å…‹éš†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # repos.txt - æ¯è¡Œä¸€ä¸ªä»“åº“URL # æ”¯æŒ SSH å’Œ HTTPS æ ¼å¼ # SSH æ ¼å¼ï¼ˆéœ€è¦é…ç½®SSHå¯†é’¥ï¼‰ git@github.com:user/repo1.git git@gitee.com:user/repo2.git # HTTPS æ ¼å¼ï¼ˆéœ€è¦è¾“å…¥å¯†ç æˆ–é…ç½®å‡­è¯å­˜å‚¨ï¼‰ https://github.com/user/repo3.git https://gitee.com/user/repo4.git # æ”¯æŒæ³¨é‡Šï¼ˆä»¥#å¼€å¤´ï¼‰ # å‰ç«¯é¡¹ç›® git@github.com:user/frontend.git # åç«¯é¡¹ç›® git@github.com:user/backend.git # æ–‡æ¡£é¡¹ç›® git@github.com:user/docs.git ğŸ–¥ï¸ ç•Œé¢ä¸äº¤äº’ 1. ä¸»ç•Œé¢é¢„è§ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 ğŸ› ï¸ Git é¡¹ç›®ç®¡ç†å·¥å…· v1.0 ======================================== ğŸ“ å½“å‰ç›®å½•: /home/user/projects ğŸ” æ‰¾åˆ° 5 ä¸ª Git ä»“åº“: [1] âœ… project-api (main) âœ“ æœ€æ–° [2] âš ï¸ project-web (develop) â€¢ æœ‰æ›´æ–° [3] âŒ project-docs (main) âœ— æœ‰ä¿®æ”¹ [4] âœ… project-mobile (feature/login) âœ“ æœ€æ–° [5] âš¡ project-admin (main) âš¡ æœ‰æœªæ¨é€æäº¤ ======================================== ğŸ“Š çŠ¶æ€è¯´æ˜: âœ… æœ€æ–° âš ï¸ å¯æ›´æ–° âŒ æœ‰ä¿®æ”¹ âš¡ å¾…æ¨é€ è¯·é€‰æ‹©æ“ä½œï¼š * 1. ğŸ“¥ æ‹‰å–å½“å‰ä»“åº“æ›´æ–° * 2. ğŸ“¤ æ¨é€å½“å‰ä»“åº“æ›´æ”¹ * 3. ğŸ·ï¸ æ›´æ”¹å½“å‰ä»“åº“æ ‡ç­¾ * 4. ğŸ“¥ æ‹‰å–æ‰€æœ‰ä»“åº“æ›´æ–° * 5. ğŸ“¤ æ¨é€æ‰€æœ‰ä»“åº“æ›´æ–° * 6. ğŸ“¦ å…‹éš†æ‰€æœ‰ä»“åº“èœå• * 7. âš™ï¸ è®¾ç½®ä¸é…ç½® * 0. ğŸšª é€€å‡º è¯·è¾“å…¥æ“ä½œç¼–å·ï¼ˆ0-7ï¼‰ï¼š 2. å¿«æ·é”®æ”¯æŒ Ctrl+C - å–æ¶ˆå½“å‰æ“ä½œï¼Œè¿”å›ä¸»èœå• Enter - ç¡®è®¤é€‰æ‹©æˆ–è¾“å…¥ 1-7 - ç›´æ¥é€‰æ‹©å¯¹åº”èœå•é¡¹ 0 - å¿«é€Ÿé€€å‡ºç¨‹åº q - é€€å‡ºå½“å‰å­èœå• h - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ 3. çŠ¶æ€æŒ‡ç¤ºå™¨ å›¾æ ‡ å«ä¹‰ è¯´æ˜ âœ… æœ€æ–° ä»“åº“ä¸è¿œç¨‹åŒæ­¥ï¼Œæ— æœ¬åœ°ä¿®æ”¹ âš ï¸ å¯æ›´æ–° è¿œç¨‹æœ‰æ›´æ–°å¯æ‹‰å– âŒ æœ‰ä¿®æ”¹ æœ¬åœ°æœ‰æœªæäº¤çš„ä¿®æ”¹ âš¡ å¾…æ¨é€ æœ¬åœ°æœ‰æœªæ¨é€çš„æäº¤ ğŸš« é”™è¯¯ ä»“åº“çŠ¶æ€å¼‚å¸¸æˆ–æ“ä½œå¤±è´¥ ğŸ”„ å¤„ç†ä¸­ æ“ä½œæ­£åœ¨è¿›è¡Œä¸­ ğŸ”§ é«˜çº§åŠŸèƒ½ 1. è‡ªå®šä¹‰é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # é«˜çº§é…ç½®ç¤ºä¾‹ # ~/.git-manager.conf # å¿½ç•¥æ¨¡å¼ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ IGNORE_PATTERNS=(\u0026#34;*-old\u0026#34; \u0026#34;temp-*\u0026#34; \u0026#34;backup-*\u0026#34;) # åˆ†æ”¯æ˜¾ç¤ºè®¾ç½® SHOW_BRANCH_ICONS=true BRANCH_ICONS=(\u0026#34;ğŸŒ¿\u0026#34; \u0026#34;ğŸš€\u0026#34; \u0026#34;ğŸ”§\u0026#34; \u0026#34;ğŸ“¦\u0026#34; \u0026#34;ğŸ¨\u0026#34;) # é¢œè‰²é…ç½®ï¼ˆæ”¯æŒ16è‰²å’Œ256è‰²ï¼‰ COLOR_SUCCESS=\u0026#34;32\u0026#34; # ç»¿è‰² COLOR_WARNING=\u0026#34;33\u0026#34; # é»„è‰² COLOR_ERROR=\u0026#34;31\u0026#34; # çº¢è‰² COLOR_INFO=\u0026#34;36\u0026#34; # é’è‰² # ç½‘ç»œä»£ç†è®¾ç½®ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰ HTTP_PROXY=\u0026#34;http://proxy.example.com:8080\u0026#34; HTTPS_PROXY=\u0026#34;http://proxy.example.com:8080\u0026#34; # é‡è¯•è®¾ç½® MAX_RETRY=3 RETRY_DELAY=5 2. æ‰¹é‡æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ‰¹é‡æ“ä½œçš„é«˜çº§é€‰é¡¹ # å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® # å¹¶å‘æ§åˆ¶ï¼ˆåŒæ—¶å¤„ç†çš„æœ€å¤§ä»“åº“æ•°ï¼‰ MAX_CONCURRENT=3 # è¶…æ—¶è®¾ç½®ï¼ˆç§’ï¼‰ OPERATION_TIMEOUT=300 # è·³è¿‡ç¡®è®¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ SKIP_CONFIRMATION=false # è¯¦ç»†è¾“å‡ºæ¨¡å¼ VERBOSE_OUTPUT=false # åªå¤„ç†ç‰¹å®šåˆ†æ”¯ TARGET_BRANCHES=(\u0026#34;main\u0026#34; \u0026#34;develop\u0026#34; \u0026#34;master\u0026#34;) 3. ç½‘ç»œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # é’ˆå¯¹æ…¢é€Ÿç½‘ç»œçš„ä¼˜åŒ–é…ç½® # ~/.git-manager.conf # å‹ç¼©ä¼ è¾“ï¼ˆèŠ‚çœå¸¦å®½ä½†å¢åŠ CPUä½¿ç”¨ï¼‰ GIT_COMPRESSION_LEVEL=6 # æ·±åº¦å…‹éš†ï¼ˆåªè·å–æœ€è¿‘çš„å†å²ï¼‰ SHALLOW_CLONE=true CLONE_DEPTH=50 # é™é€Ÿè®¾ç½®ï¼ˆKB/sï¼‰ DOWNLOAD_LIMIT=1024 UPLOAD_LIMIT=512 # è¿æ¥è¶…æ—¶ CONNECT_TIMEOUT=30 # è‡ªåŠ¨é‡è¯• AUTO_RETRY=true MAX_NETWORK_RETRY=5 ğŸ® ä½¿ç”¨ç¤ºä¾‹ 1. æ—¥å¸¸æ›´æ–°æµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ—©ä¸Šå¼€å§‹å·¥ä½œ git-manager # é€‰æ‹© 4. ğŸ“¥ æ‹‰å–æ‰€æœ‰ä»“åº“æ›´æ–° # æ‰€æœ‰é¡¹ç›®åŒæ­¥åˆ°æœ€æ–°çŠ¶æ€ # å·¥ä½œè¿‡ç¨‹ä¸­... # åœ¨ç‰¹å®šé¡¹ç›®ç›®å½•ä¸‹ git-manager # é€‰æ‹© 1. ğŸ“¥ æ‹‰å–å½“å‰ä»“åº“æ›´æ–°ï¼ˆéšæ—¶åŒæ­¥ï¼‰ # ä¸‹ç­å‰æäº¤å·¥ä½œ git-manager # é€‰æ‹© 5. ğŸ“¤ æ¨é€æ‰€æœ‰ä»“åº“æ›´æ–° # æ‰¹é‡æ¨é€æ‰€æœ‰æœ‰æ”¹åŠ¨çš„ä»“åº“ 2. ç‰ˆæœ¬å‘å¸ƒæµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 # å‘å¸ƒæ–°ç‰ˆæœ¬ git-manager # é€‰æ‹© 3. ğŸ·ï¸ æ›´æ”¹å½“å‰ä»“åº“æ ‡ç­¾ # å­èœå•ä¸­é€‰æ‹© 1. åˆ›å»ºæ–°æ ‡ç­¾ # è¾“å…¥ç‰ˆæœ¬å·: v1.2.0 # è¾“å…¥æè¿°: Release version 1.2.0 with new features # æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ # å­èœå•ä¸­é€‰æ‹© 3. æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ 3. æ–°ç¯å¢ƒæ­å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœ¨æ–°æœºå™¨ä¸Šæ­å»ºå¼€å‘ç¯å¢ƒ mkdir projects \u0026amp;\u0026amp; cd projects # ä½¿ç”¨å·¥å…·å…‹éš†æ‰€æœ‰ä»“åº“ git-manager # é€‰æ‹© 6. ğŸ“¦ å…‹éš†æ‰€æœ‰ä»“åº“èœå• # é…ç½®ä»“åº“åˆ—è¡¨æ–‡ä»¶ # é€‰æ‹© 2. é…ç½®ä»“åº“åˆ—è¡¨æ–‡ä»¶ # å¼€å§‹æ‰¹é‡å…‹éš† # é€‰æ‹© 3. æ‰¹é‡å…‹éš†ä»“åº“ # æ‰€æœ‰ä»“åº“å…‹éš†å®Œæˆåï¼Œä¸€é”®æ›´æ–° # é€‰æ‹© 4. ğŸ“¥ æ‹‰å–æ‰€æœ‰ä»“åº“æ›´æ–° âš ï¸ æ³¨æ„äº‹é¡¹ 1. æƒé™è¦æ±‚ è¯»å–æƒé™ï¼šéœ€è¦å¯¹æ‰€æœ‰è¦æ‰«æçš„ç›®å½•æœ‰è¯»æƒé™ å†™å…¥æƒé™ï¼šæ¨é€æ“ä½œéœ€è¦è¿œç¨‹ä»“åº“çš„å†™å…¥æƒé™ ç½‘ç»œè®¿é—®ï¼šéœ€è¦èƒ½å¤Ÿè®¿é—® Git è¿œç¨‹ä»“åº“ SSH é…ç½®ï¼šä½¿ç”¨ SSH URL éœ€è¦æå‰é…ç½® SSH å¯†é’¥ 2. å†²çªå¤„ç† 1 2 3 4 5 6 7 8 9 10 # é‡åˆ°å†²çªæ—¶çš„å¤„ç†æµç¨‹ï¼š 1. å·¥å…·ä¼šæ£€æµ‹åˆ°å†²çªå¹¶æ˜¾ç¤ºè­¦å‘Š 2. éœ€è¦æ‰‹åŠ¨è§£å†³å†²çªï¼š - ç¼–è¾‘å†²çªæ–‡ä»¶ - ä½¿ç”¨ git add æ ‡è®°å·²è§£å†³ - å®Œæˆåˆå¹¶æäº¤ 3. é‡æ–°å°è¯•æ“ä½œ # å»ºè®®å®šæœŸæ‹‰å–æ›´æ–°ä»¥å‡å°‘å†²çª # é‡è¦æ“ä½œå‰å»ºè®®å…ˆæäº¤æˆ–å‚¨è—æœ¬åœ°ä¿®æ”¹ 3. å¤‡ä»½ç­–ç•¥ å®šæœŸå¤‡ä»½ï¼šé‡è¦ä»“åº“å®šæœŸæ¨é€åˆ°è¿œç¨‹ å¤šé‡å¤‡ä»½ï¼šä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»“åº“ï¼ˆGitHub + Giteeï¼‰ æœ¬åœ°å¤‡ä»½ï¼šå®šæœŸå‹ç¼©å¤‡ä»½é‡è¦ä»“åº“ éªŒè¯å¤‡ä»½ï¼šå®šæœŸéªŒè¯å¤‡ä»½çš„å®Œæ•´æ€§å’Œå¯æ¢å¤æ€§ âŒ æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜ é—®é¢˜ï¼šè„šæœ¬æ— æ³•è¿è¡Œ\n1 2 3 4 5 # è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ‰§è¡Œæƒé™ chmod +x git-manager.sh # æ£€æŸ¥ Bash ç‰ˆæœ¬ï¼ˆéœ€è¦ 4.0+ï¼‰ bash --version é—®é¢˜ï¼šç½‘ç»œè¿æ¥è¶…æ—¶\n1 2 3 # è§£å†³æ–¹æ¡ˆï¼šé…ç½®ç½‘ç»œä»£ç†æˆ–ä½¿ç”¨å›½å†…é•œåƒ # ç¼–è¾‘ ~/.git-manager.conf è®¾ç½®ä»£ç† HTTP_PROXY=\u0026#34;http://proxy.example.com:8080\u0026#34; é—®é¢˜ï¼šæƒé™è¢«æ‹’ç»\n1 2 3 4 # è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç›®å½•æƒé™å’ŒSSHå¯†é’¥é…ç½® # ç¡®ä¿å¯¹ç›®æ ‡ç›®å½•æœ‰è¯»å†™æƒé™ # æ£€æŸ¥ SSH å¯†é’¥æ˜¯å¦æ·»åŠ åˆ° ssh-agent ssh-add -l 2. è§£å†³æ–¹æ¡ˆ å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š\n1 2 3 4 5 # è¿è¡Œè„šæœ¬æ—¶å¯ç”¨è°ƒè¯•æ¨¡å¼ bash -x git-manager.sh # æˆ–è€…æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ tail -f ~/.git-manager.log æ£€æŸ¥ä¾èµ–é¡¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # ç¡®ä¿å¿…è¦çš„å·¥å…·å·²å®‰è£… command -v git \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || { echo \u0026#34;Git æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Git\u0026#34; exit 1 } # æ£€æŸ¥ curl æ˜¯å¦å¯ç”¨ command -v curl \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || { echo \u0026#34;curl æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… curl\u0026#34; exit 1 } é‡ç½®é…ç½®ï¼š\n1 2 3 4 # å¦‚æœé…ç½®å‡ºç°é—®é¢˜ï¼Œå¯ä»¥åˆ é™¤é…ç½®æ–‡ä»¶é‡æ–°å¼€å§‹ rm -f ~/.git-manager.conf # ä¸‹æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„é»˜è®¤é…ç½® ğŸ‰ æ€»ç»“ï¼šGit é¡¹ç›®ç®¡ç†å·¥å…·é€šè¿‡æä¾›ç»Ÿä¸€çš„å›¾å½¢åŒ–ç•Œé¢ï¼Œæå¤§åœ°ç®€åŒ–äº†å¤šä»“åº“ç®¡ç†çš„å¤æ‚æ€§ã€‚æ— è®ºæ˜¯æ—¥å¸¸å¼€å‘ã€ç‰ˆæœ¬å‘å¸ƒè¿˜æ˜¯ç¯å¢ƒæ­å»ºï¼Œéƒ½èƒ½æä¾›é«˜æ•ˆå¯é çš„æ”¯æŒã€‚\nğŸ’ª å®è·µå»ºè®®ï¼š\nå°†å·¥å…·é›†æˆåˆ°æ—¥å¸¸å¼€å‘æµç¨‹ä¸­ å®šæœŸæ›´æ–°å·¥å…·ä»¥è·å–æœ€æ–°åŠŸèƒ½ æ ¹æ®å›¢é˜Ÿéœ€æ±‚å®šåˆ¶é…ç½®æ–‡ä»¶ åŸ¹è®­å›¢é˜Ÿæˆå‘˜ä½¿ç”¨ç»Ÿä¸€çš„å·¥ä½œæµç¨‹ ğŸš€ ç°åœ¨å°±å¼€å§‹ä½¿ç”¨è¿™ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œæå‡æ‚¨çš„ Git é¡¹ç›®ç®¡ç†æ•ˆç‡å§ï¼\n","date":"2025-08-26T16:54:26+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c956e32c/","title":"Git é¡¹ç›®ç®¡ç†å·¥å…·è„šæœ¬ ğŸ› ï¸"},{"content":"Git Bash å®‰è£… wget å·¥å…· ğŸ› ï¸ wget æ˜¯ä¸€ä¸ªåœ¨å‘½ä»¤è¡Œä¸‹é«˜æ•ˆä¸‹è½½æ–‡ä»¶çš„å…è´¹å·¥å…·ï¼Œæ”¯æŒ HTTPã€HTTPS å’Œ FTP åè®®ï¼Œå…·å¤‡æ–­ç‚¹ç»­ä¼ ã€é€’å½’ä¸‹è½½ç­‰å¼ºå¤§åŠŸèƒ½ï¼Œæ˜¯å¼€å‘è€…å’Œç®¡ç†å‘˜çš„å¾—åŠ›åŠ©æ‰‹ã€‚\nâœ¨ ä¸»è¦ç‰¹ç‚¹ ğŸŒ å¤šåè®®æ”¯æŒï¼šå¯ä¸‹è½½é€šè¿‡ HTTPã€HTTPS å’Œ FTP åè®®è®¿é—®çš„æ–‡ä»¶ â³ æ–­ç‚¹ç»­ä¼ ï¼šç½‘ç»œä¸­æ–­åç»§ç»­ä¸‹è½½ï¼Œä¸å¿…é‡æ–°å¼€å§‹ ğŸ“¦ é€’å½’ä¸‹è½½ï¼šå¯ä¸‹è½½æ•´ä¸ªç½‘ç«™æˆ–ç›®å½•çš„å†…å®¹ ğŸ”§ è½»é‡é«˜æ•ˆï¼šå‘½ä»¤è¡Œå·¥å…·ï¼Œèµ„æºå ç”¨æå°‘ï¼Œæ˜“äºè„šæœ¬é›†æˆ ğŸ›¡ï¸ å®‰å…¨å¯é ï¼šæ”¯æŒ SSL/TLS åŠ å¯†è¿æ¥ï¼Œä¿éšœä¸‹è½½å®‰å…¨ ğŸ“¥ å®‰è£…æ–¹æ³• æ–¹æ³•ä¸€ï¼šä½¿ç”¨ curl å‘½ä»¤å®‰è£…ï¼ˆæ¨èï¼‰ æ‰“å¼€ Git Bash æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1 2 3 4 5 6 7 8 9 # è¿›å…¥ Git å®‰è£…ç›®å½•çš„ bin æ–‡ä»¶å¤¹ cd \u0026#39;/c/Program Files/Git/mingw64/bin\u0026#39; # ä¸‹è½½ wget 64ä½ç‰ˆæœ¬ curl -o wget.exe https://eternallybored.org/misc/wget/1.21.4/64/wget.exe # éªŒè¯å®‰è£… echo \u0026amp;\u0026amp; echo \u0026#34;------ wget ç‰ˆæœ¬ä¿¡æ¯ ------\u0026#34; \u0026amp;\u0026amp; \\ wget --version | head -1 æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£… ğŸŒ è®¿é—® wget å®˜ç½‘ä¸‹è½½é¡µé¢ï¼š https://eternallybored.org/misc/wget/ â¬‡ï¸ ä¸‹è½½é€‚åˆçš„ Windows ç‰ˆæœ¬ï¼ˆæ¨è 64 ä½ç‰ˆæœ¬ï¼‰\nğŸ“‚ å°†ä¸‹è½½çš„ wget.exe æ–‡ä»¶å¤åˆ¶åˆ° Git Bash çš„å®‰è£…ç›®å½•ï¼š\n1 C:\\Program Files\\Git\\mingw64\\bin\\ âœ… éªŒè¯å®‰è£…ï¼š 1 wget --version | head -1 ğŸ§ª æµ‹è¯•ä½¿ç”¨ å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯• wget æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š\n1 2 3 4 5 # æµ‹è¯•ä¸‹è½½æ–‡ä»¶ï¼ˆä½¿ç”¨æ–­ç‚¹ç»­ä¼ é€‰é¡¹ -cï¼‰ wget -c https://example.com/path/to/file.zip # ä¸‹è½½æ•´ä¸ªç½‘ç«™ï¼ˆç¤ºä¾‹ï¼‰ # wget --recursive --no-clobber --page-requisites --html-extension --convert-links --domains website.org --no-parent https://www.website.org/tutorials/html/ ğŸ’¡ ä½¿ç”¨æç¤º ä½¿ç”¨ wget --help æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é€‰é¡¹ -c é€‰é¡¹å…è®¸ä¸­æ–­åç»§ç»­ä¸‹è½½ï¼Œéå¸¸é€‚åˆå¤§æ–‡ä»¶ -O é€‰é¡¹å¯ä»¥æŒ‡å®šä¸‹è½½æ–‡ä»¶çš„ä¿å­˜åç§° -P é€‰é¡¹å¯ä»¥æŒ‡å®šä¸‹è½½æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ âš ï¸ æ³¨æ„äº‹é¡¹ ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™å°†æ–‡ä»¶å†™å…¥ Git Bash çš„ bin ç›®å½• å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œå¯ä»¥å°è¯•ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ Git Bash ä¸‹è½½æ–‡ä»¶æ—¶è¯·æ³¨æ„ç½‘ç»œå®‰å…¨ï¼Œåªä»å¯ä¿¡æ¥æºä¸‹è½½å†…å®¹ ç°åœ¨ä½ å·²ç»åœ¨ Git Bash ä¸­æˆåŠŸå®‰è£…äº† wget å·¥å…·ï¼Œå¯ä»¥äº«å—å‘½ä»¤è¡Œä¸‹è½½çš„ä¾¿æ·äº†ï¼ ğŸ‰\n","date":"2025-08-26T16:51:42+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dc06c864/","title":"Git Bash å®‰è£… wget å·¥å…· ğŸ› ï¸"},{"content":"Proxmox VE è™šæ‹Ÿæœºå®‰è£… qemu-guest-agent ğŸš€ ğŸ”§ æå‡è™šæ‹Ÿæœºç®¡ç†æ•ˆç‡ â€” é€šè¿‡ qemu-guest-agent å®ç°ä¸»æœºä¸è™šæ‹Ÿæœºä¹‹é—´çš„é«˜æ•ˆé€šä¿¡ä¸é›†æˆ\nğŸ“‹ æ–‡ç« ç›®å½• ğŸŒŸ qemu-guest-agent ç®€ä»‹ âš™ï¸ ä¸€ã€Proxmox VE åå°é…ç½® 1. å¯ç”¨è™šæ‹Ÿæœºä»£ç† 2. é…ç½®æ³¨æ„äº‹é¡¹ ğŸ§ äºŒã€Linux ç³»ç»Ÿå®‰è£…æŒ‡å— 1. Debian/Ubuntu ç³»ç»Ÿ 2. CentOS/RHEL ç³»ç»Ÿ 3. OpenSUSE ç³»ç»Ÿ ğŸ”— ä¸‰ã€OpenWRT/iStoreOS å®‰è£… 1. å®‰è£…æ­¥éª¤ 2. æœåŠ¡é…ç½® ğŸ–¥ï¸ å››ã€Windows ç³»ç»Ÿå®‰è£… 1. é©±åŠ¨ä¸‹è½½ 2. å®‰è£…æ–¹æ³• âœ… äº”ã€éªŒè¯ä¸æµ‹è¯• 1. åŸºç¡€éªŒè¯ 2. é«˜çº§æµ‹è¯• ğŸ”§ å…­ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– 1. è‡ªå®šä¹‰é…ç½® 2. æ€§èƒ½ä¼˜åŒ– âŒ ä¸ƒã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜ 2. è§£å†³æ–¹æ¡ˆ ğŸ’¡ å…«ã€æœ€ä½³å®è·µ 1. å®‰å…¨å»ºè®® 2. ç»´æŠ¤æŠ€å·§ ğŸŒŸ qemu-guest-agent ç®€ä»‹ qemu-guest-agent (QGA) æ˜¯è¿è¡Œåœ¨è™šæ‹Ÿæœºå†…éƒ¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå…è®¸ Proxmox VE ä¸»æœºä¸å®¢æˆ·æœºæ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œæä¾›é«˜çº§ç®¡ç†åŠŸèƒ½ã€‚âœ¨\nğŸ”§ ä¸»è¦åŠŸèƒ½ï¼š æ­£å¸¸å…³æœºï¼šé€šè¿‡ Web ç•Œé¢å®‰å…¨å…³é—­è™šæ‹Ÿæœº æ–‡ä»¶ç³»ç»Ÿå†»ç»“/è§£å†»ï¼šå¤‡ä»½æ—¶ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ è™šæ‹ŸæœºçŠ¶æ€æŸ¥è¯¢ï¼šè·å–å®¢æˆ·æœºå†…éƒ¨çŠ¶æ€ä¿¡æ¯ æ—¶é—´åŒæ­¥ï¼šåœ¨ä¸»æœºå’Œå®¢æˆ·æœºä¹‹é—´åŒæ­¥æ—¶é—´ ç½‘ç»œé…ç½®ï¼šåŠ¨æ€é…ç½®å®¢æˆ·æœºç½‘ç»œè®¾ç½® ğŸš€ ä½¿ç”¨ä¼˜åŠ¿ï¼š æé«˜è™šæ‹Ÿæœºç®¡ç†æ•ˆç‡ å¢å¼ºå¤‡ä»½å¯é æ€§ æ”¹å–„è™šæ‹ŸåŒ–ä½“éªŒ æä¾›æ›´å¥½çš„ç›‘æ§èƒ½åŠ› ğŸ’¡ ä½ çŸ¥é“å—ï¼Ÿ qemu-guest-agent ä½¿ç”¨ virtio-serial é€šé“ä¸ä¸»æœºé€šä¿¡ï¼Œä¸éœ€è¦ç½‘ç»œè¿æ¥å³å¯å·¥ä½œï¼Œè¿™ä½¿å…¶æ›´åŠ å¯é å’Œå®‰å…¨ã€‚\nâš™ï¸ ä¸€ã€Proxmox VE åå°é…ç½® 1. å¯ç”¨è™šæ‹Ÿæœºä»£ç† åœ¨ Proxmox VE ä¸­ä¸ºè™šæ‹Ÿæœºå¯ç”¨ qemu-guest-agent æ”¯æŒï¼š\nå…³é—­è™šæ‹Ÿæœºï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰ é€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœºï¼Œè¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ æ·»åŠ \u0026quot;ä¸²è¡Œç«¯å£\u0026quot;è®¾å¤‡ï¼ˆå¦‚æœå°šæœªæ·»åŠ ï¼‰ å‹å·é€‰æ‹© VirtIO Serial è¿›å…¥\u0026quot;é€‰é¡¹\u0026quot;é€‰é¡¹å¡ æ‰¾åˆ°\u0026quot;QEMU Guest Agent\u0026quot;é€‰é¡¹å¹¶è®¾ç½®ä¸º\u0026quot;æ˜¯\u0026quot; å¯åŠ¨è™šæ‹Ÿæœºå¹¶å®‰è£…ç›¸åº”çš„å®¢æˆ·ç«¯è½¯ä»¶ 2. é…ç½®æ³¨æ„äº‹é¡¹ ** VirtIO é©±åŠ¨**ï¼šç¡®ä¿è™šæ‹Ÿæœºå·²å®‰è£… VirtIO é©±åŠ¨ç¨‹åºï¼ˆWindows ç³»ç»Ÿï¼‰ å†…å­˜ ballooningï¼šQGA æ”¯æŒå†…å­˜ ballooningï¼Œå¯åœ¨\u0026quot;ç¡¬ä»¶\u0026quot;ä¸­å¯ç”¨ é…ç½®æ–‡ä»¶ï¼šQGA é…ç½®ä½äº /etc/pve/qemu-server/VMID.conf ä¸­ å¤‡ä»½é›†æˆï¼šå¯ç”¨ QGA åå¯å®ç°åº”ç”¨ç¨‹åºä¸€è‡´çš„å¤‡ä»½ ğŸ§ äºŒã€Linux ç³»ç»Ÿå®‰è£…æŒ‡å— 1. Debian/Ubuntu ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£… qemu-guest-agent sudo apt install qemu-guest-agent # å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl start qemu-guest-agent sudo systemctl enable qemu-guest-agent # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status qemu-guest-agent # æŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰ sudo journalctl -u qemu-guest-agent -f 2. CentOS/RHEL ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 # CentOS/RHEL 7 åŠä»¥ä¸‹ç‰ˆæœ¬ sudo yum install qemu-guest-agent sudo service qemu-guest-agent start sudo chkconfig qemu-guest-agent on # CentOS/RHEL 8 åŠä»¥ä¸Šç‰ˆæœ¬ sudo dnf install qemu-guest-agent sudo systemctl start qemu-guest-agent sudo systemctl enable qemu-guest-agent # å¯¹äº AlmaLinux/Rocky Linux sudo dnf install qemu-guest-agent sudo systemctl enable --now qemu-guest-agent 3. OpenSUSE ç³»ç»Ÿ 1 2 3 4 5 6 7 # OpenSUSE Leap/Tumbleweed sudo zypper install qemu-guest-agent sudo systemctl start qemu-guest-agent sudo systemctl enable qemu-guest-agent # éªŒè¯å®‰è£… sudo systemctl status qemu-guest-agent ğŸ”— ä¸‰ã€OpenWRT/iStoreOS å®‰è£… 1. å®‰è£…æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ opkg update # å®‰è£… qemu-guest-agent opkg install qemu-ga # æˆ–è€…ä½¿ç”¨ pkg å‘½ä»¤ pkg install qemu-guest-agent # è®¾ç½®è„šæœ¬æƒé™ chmod +x /etc/init.d/qemu-ga # å¯ç”¨æœåŠ¡ /etc/init.d/qemu-ga enable # å¯åŠ¨æœåŠ¡ /etc/init.d/qemu-ga start # é‡å¯ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰ reboot 2. æœåŠ¡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ /etc/init.d/qemu-ga status # æŸ¥çœ‹è¿›ç¨‹ ps | grep qemu-ga # æ£€æŸ¥æ—¥å¿— logread | grep qemu # æ‰‹åŠ¨æµ‹è¯•ä»£ç† qemu-ga --version # é…ç½®é«˜çº§é€‰é¡¹ï¼ˆå¦‚æœéœ€è¦ï¼‰ vi /etc/config/qemu-ga âš ï¸ æ³¨æ„ï¼šæŸäº› OpenWRT ç‰ˆæœ¬å¯èƒ½éœ€è¦æ‰‹åŠ¨ç¼–è¯‘åŒ…å« qemu-ga çš„é•œåƒï¼Œæˆ–è€…ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…ã€‚\nğŸ–¥ï¸ å››ã€Windows ç³»ç»Ÿå®‰è£… 1. é©±åŠ¨ä¸‹è½½ Windows è™šæ‹Ÿæœºéœ€è¦å®‰è£… VirtIO é©±åŠ¨ç¨‹åºï¼š\nä¸‹è½½ VirtIO é©±åŠ¨ï¼š\nè®¿é—® Fedora VirtIO é©±åŠ¨é¡µé¢ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ virtio-win.iso æŒ‚è½½é©±åŠ¨é•œåƒï¼š\nåœ¨ Proxmox VE ä¸­ï¼Œå°† ISO é•œåƒæŒ‚è½½åˆ°è™šæ‹Ÿæœºçš„ CD/DVD é©±åŠ¨å™¨ å¯åŠ¨è™šæ‹Ÿæœºå¹¶è®¿é—®å…‰é©± 2. å®‰è£…æ–¹æ³• æ–¹æ³•ä¸€ï¼šé€šè¿‡è®¾å¤‡ç®¡ç†å™¨å®‰è£…\næ‰“å¼€\u0026quot;è®¾å¤‡ç®¡ç†å™¨\u0026quot; æ‰¾åˆ°å¸¦æœ‰é»„è‰²æ„Ÿå¹å·çš„æœªçŸ¥è®¾å¤‡ å³é”®é€‰æ‹©\u0026quot;æ›´æ–°é©±åŠ¨ç¨‹åº\u0026quot; é€‰æ‹©\u0026quot;æµè§ˆæˆ‘çš„ç”µè„‘ä»¥æŸ¥æ‰¾é©±åŠ¨ç¨‹åº\u0026quot; æŒ‡å‘ VirtIO ISO é•œåƒä¸­çš„ guest-agent ç›®å½• å®Œæˆå®‰è£… æ–¹æ³•äºŒï¼šè¿è¡Œå®‰è£…ç¨‹åº\næ‰“å¼€ VirtIO ISO é•œåƒ è¿è¡Œ virtio-win-guest-tools.exe å®‰è£…ç¨‹åº æŒ‰ç…§å‘å¯¼å®Œæˆå®‰è£… é‡å¯ç³»ç»Ÿ æ–¹æ³•ä¸‰ï¼šå‘½ä»¤è¡Œå®‰è£…\n1 2 3 4 # ä½¿ç”¨ PowerShell å®‰è£… Mount-DiskImage -ImagePath \u0026#34;è·¯å¾„\\to\\virtio-win.iso\u0026#34; $driveLetter = (Get-DiskImage -ImagePath \u0026#34;è·¯å¾„\\to\\virtio-win.iso\u0026#34; | Get-Volume).DriveLetter Start-Process -FilePath \u0026#34;${driveLetter}:\\guest-agent\\qemu-ga-x86_64.msi\u0026#34; -Wait éªŒè¯å®‰è£…ï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ Get-Service -Name QEMU-GA # å¯åŠ¨æœåŠ¡ Start-Service -Name QEMU-GA # è®¾ç½®è‡ªåŠ¨å¯åŠ¨ Set-Service -Name QEMU-GA -StartupType Automatic âœ… äº”ã€éªŒè¯ä¸æµ‹è¯• 1. åŸºç¡€éªŒè¯ åœ¨ Proxmox VE ä¸»æœºä¸ŠéªŒè¯ QEMU Guest Agent æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿæœº qm list # æ£€æŸ¥ç‰¹å®šè™šæ‹Ÿæœºçš„ä»£ç†çŠ¶æ€ qm agent \u0026lt;VMID\u0026gt; ping # è·å–è™šæ‹Ÿæœºä¿¡æ¯ qm agent \u0026lt;VMID\u0026gt; info # è·å–ç½‘ç»œä¿¡æ¯ qm agent \u0026lt;VMID\u0026gt; network-get-interfaces # è·å–æ“ä½œç³»ç»Ÿä¿¡æ¯ qm agent \u0026lt;VMID\u0026gt; get-osinfo 2. é«˜çº§æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿå†»ç»“/è§£å†»ï¼ˆç”¨äºå¤‡ä»½ï¼‰ qm agent \u0026lt;VMID\u0026gt; fsfreeze-freeze qm agent \u0026lt;VMID\u0026gt; fsfreeze-thaw # æ‰§è¡Œå®¢æˆ·æœºå‘½ä»¤ qm agent \u0026lt;VMID\u0026gt; exec \u0026#34;echo \u0026#39;Hello from Guest\u0026#39;\u0026#34; # è·å–æ—¶é—´åŒæ­¥çŠ¶æ€ qm agent \u0026lt;VMID\u0026gt; get-time # è®¾ç½®æ—¶é—´ï¼ˆéœ€è¦æƒé™ï¼‰ qm agent \u0026lt;VMID\u0026gt; set-time # å…³æœºæµ‹è¯• qm agent \u0026lt;VMID\u0026gt; shutdown ğŸ”§ å…­ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– 1. è‡ªå®šä¹‰é…ç½® åœ¨å®¢æˆ·æœºä¸­è‡ªå®šä¹‰ QEMU Guest Agent é…ç½®ï¼š\nLinux ç³»ç»Ÿé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # ç¼–è¾‘é…ç½®æ–‡ä»¶ sudo vi /etc/sysconfig/qemu-ga # æˆ– sudo vi /etc/default/qemu-ga # å¸¸è§é…ç½®é€‰é¡¹ DAEMON_ARGS=\u0026#34;-d -v -p /dev/virtio-ports/org.qemu.guest_agent.0\u0026#34; # -d: å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ # -v: è¯¦ç»†è¾“å‡º # -p: æŒ‡å®š virtio-serial ç«¯å£ # é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ sudo systemctl restart qemu-guest-agent Windows ç³»ç»Ÿé…ç½®ï¼š\næ³¨å†Œè¡¨è·¯å¾„ï¼šHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\QEMU-GA å¯é…ç½®é¡¹ï¼šæ—¥å¿—çº§åˆ«ã€è¶…æ—¶è®¾ç½®ã€é»‘åå•å‘½ä»¤ç­‰ 2. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 # è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼ˆå‡å°‘æ—¥å¿—é‡ï¼‰ # åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š LOG_LEVEL=\u0026#34;warning\u0026#34; # é™åˆ¶èµ„æºä½¿ç”¨ï¼ˆåœ¨å†…å­˜æœ‰é™çš„ç³»ç»Ÿä¸­ï¼‰ # åˆ›å»ºç³»ç»ŸæœåŠ¡é™åˆ¶ sudo mkdir -p /etc/systemd/system/qemu-guest-agent.service.d/ sudo vi /etc/systemd/system/qemu-guest-agent.service.d/limits.conf # æ·»åŠ å†…å®¹ï¼š [Service] MemoryMax=50M CPUQuota=20% âŒ ä¸ƒã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜ ä»£ç†æœªå“åº”ï¼š\næ£€æŸ¥è™šæ‹Ÿæœºä¸­æœåŠ¡æ˜¯å¦è¿è¡Œ éªŒè¯ VirtIO ä¸²è¡Œç«¯å£æ˜¯å¦å·²æ·»åŠ  æƒé™é—®é¢˜ï¼š\nç¡®ä¿å®¢æˆ·æœºä¸­çš„ä»£ç†æœ‰è¶³å¤Ÿæƒé™æ‰§è¡Œæ“ä½œ æ—¶é—´åŒæ­¥é—®é¢˜ï¼š\næ£€æŸ¥æ—¶é—´åŒæ­¥é…ç½®æ˜¯å¦æ­£ç¡® æ–‡ä»¶ç³»ç»Ÿå†»ç»“å¤±è´¥ï¼š\nç¡®è®¤æ–‡ä»¶ç³»ç»Ÿæ”¯æŒå†»ç»“æ“ä½œ 2. è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # è¯Šæ–­è¿æ¥é—®é¢˜ # åœ¨å®¢æˆ·æœºä¸­æ£€æŸ¥ virtio-serial è®¾å¤‡ ls -la /dev/virtio-ports/ # æ£€æŸ¥å†…æ ¸æ¶ˆæ¯ dmesg | grep virtio # æ‰‹åŠ¨æµ‹è¯•ä¸²è¡Œç«¯å£ cat /dev/virtio-ports/org.qemu.guest_agent.0 # é‡æ–°å®‰è£…ä»£ç† sudo apt remove qemu-guest-agent sudo apt install qemu-guest-agent # æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼ˆæŸäº›ç³»ç»Ÿå¯èƒ½éœ€è¦ï¼‰ sudo ufw status Windows æ•…éšœæ’é™¤ï¼š\n1 2 3 4 5 6 # æ£€æŸ¥äº‹ä»¶æ—¥å¿— Get-EventLog -LogName Application -Source QEMU-GA | Select-Object -First 10 # é‡æ–°æ³¨å†ŒæœåŠ¡ sc delete QEMU-GA \u0026#34;è·¯å¾„\\to\\qemu-ga.exe\u0026#34; -s install ğŸ’¡ å…«ã€æœ€ä½³å®è·µ 1. å®‰å…¨å»ºè®® æœ€å°æƒé™åŸåˆ™ï¼š\né™åˆ¶ QEMU Guest Agent çš„æ‰§è¡Œæƒé™ ä½¿ç”¨é»‘åå•é™åˆ¶æ•æ„Ÿå‘½ä»¤æ‰§è¡Œ ç½‘ç»œéš”ç¦»ï¼š\nè™½ç„¶ QGA ä¸ä¾èµ–ç½‘ç»œï¼Œä½†ä»éœ€ç¡®ä¿è™šæ‹Ÿæœºç½‘ç»œå®‰å…¨ å®šæœŸæ›´æ–°ï¼š\nä¿æŒå®¢æˆ·æœºä¸­çš„ä»£ç†è½¯ä»¶ä¸ºæœ€æ–°ç‰ˆæœ¬ å®šæœŸæ›´æ–° VirtIO é©±åŠ¨ç¨‹åº å®¡è®¡æ—¥å¿—ï¼š\nå®šæœŸæ£€æŸ¥ QEMU Guest Agent çš„æ—¥å¿—æ–‡ä»¶ ç›‘æ§å¼‚å¸¸æ´»åŠ¨ 2. ç»´æŠ¤æŠ€å·§ å¤‡ä»½å‰å‡†å¤‡ï¼š\n1 2 3 4 # åœ¨å¤‡ä»½è„šæœ¬ä¸­æ·»åŠ å†»ç»“/è§£å†»å‘½ä»¤ qm agent \u0026lt;VMID\u0026gt; fsfreeze-freeze # æ‰§è¡Œå¤‡ä»½æ“ä½œ qm agent \u0026lt;VMID\u0026gt; fsfreeze-thaw ç›‘æ§é›†æˆï¼š\nå°† QGA çŠ¶æ€ç›‘æ§é›†æˆåˆ°ç°æœ‰ç›‘æ§ç³»ç»Ÿä¸­ è®¾ç½®è­¦æŠ¥å½“ä»£ç†ä¸å¯ç”¨æ—¶ è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼š\nä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ï¼ˆAnsibleã€Puppetï¼‰è‡ªåŠ¨åŒ–ä»£ç†å®‰è£… åˆ›å»ºè‡ªå®šä¹‰é•œåƒé¢„è£… QEMU Guest Agent æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼š\nå®šæœŸæµ‹è¯•ä»£ç†å“åº”æ—¶é—´ ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ ğŸ‰ æ€»ç»“ï¼šé€šè¿‡æ­£ç¡®å®‰è£…å’Œé…ç½® qemu-guest-agentï¼Œæ‚¨å¯ä»¥æ˜¾è‘—æå‡ Proxmox VE è™šæ‹ŸåŒ–ç¯å¢ƒçš„å¯ç®¡ç†æ€§å’Œå¯é æ€§ã€‚æ— è®ºæ˜¯ Linuxã€Windows è¿˜æ˜¯ OpenWRT ç³»ç»Ÿï¼ŒQGA éƒ½èƒ½æä¾›ä¸€è‡´çš„ç®¡ç†ä½“éªŒã€‚\nğŸ› ï¸ å®è·µå»ºè®®ï¼š\nåœ¨æ–°è™šæ‹Ÿæœºæ¨¡æ¿ä¸­é¢„è£… QEMU Guest Agent å®šæœŸæµ‹è¯•ä»£ç†åŠŸèƒ½ä»¥ç¡®ä¿å…¶æ­£å¸¸å·¥ä½œ å°† QGA é›†æˆåˆ°æ‚¨çš„å¤‡ä»½å’Œç›‘æ§æµç¨‹ä¸­ å…³æ³¨å®‰å…¨æœ€ä½³å®è·µï¼Œç¡®ä¿ç¯å¢ƒå®‰å…¨ ğŸ’ª ç°åœ¨å°±å¼€å§‹ä½¿ç”¨è¿™äº›æŠ€å·§ï¼Œæå‡æ‚¨çš„ Proxmox VE ç®¡ç†èƒ½åŠ›å§ï¼\n","date":"2025-08-26T16:48:21+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b5c31246/","title":"Proxmox VE è™šæ‹Ÿæœºå®‰è£… qemu-guest-agent ğŸš€"},{"content":"FnOS å®‰è£… ADB å·¥å…·å®Œå…¨æŒ‡å—ğŸ“± æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ FnOS ç³»ç»Ÿä¸­å®‰è£… ADB å·¥å…·ï¼Œå¹¶è¿æ¥å°ç±³ç”µè§†è¿›è¡Œè°ƒè¯•çš„å®Œæ•´æ•™ç¨‹ï¼ŒåŒ…å«ä¸°å¯Œçš„ ADB å‘½ä»¤å‚è€ƒå’Œå®ç”¨æŠ€å·§ã€‚\nğŸ“‹ ç›®å½• ğŸ“– æ–‡ç« ç®€ä»‹ ğŸ”§ æ‰‹åŠ¨å®‰è£… Android Platform Tools ğŸ“º è¿æ¥ç”µè§† ADB ğŸ® å¸¸ç”¨çš„ ADB å‘½ä»¤ âš™ï¸ é«˜çº§é…ç½®ä¸æŠ€å·§ ğŸš¨ æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µ ğŸ“– æ–‡ç« ç®€ä»‹ æœ¬æŒ‡å—å…¨é¢ä»‹ç»äº†åœ¨ FnOS ç³»ç»Ÿä¸Šå®‰è£… Android Debug Bridge (ADB) å·¥å…·çš„æ­¥éª¤ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ ADB è¿æ¥å’Œæ§åˆ¶å°ç±³ç”µè§†ç­‰ Android è®¾å¤‡ã€‚æ— è®ºæ‚¨æ˜¯å¼€å‘è€…è¿˜æ˜¯æ™®é€šç”¨æˆ·ï¼Œéƒ½èƒ½é€šè¿‡æœ¬æ•™ç¨‹å­¦ä¼šä½¿ç”¨ ADB è¿›è¡Œè®¾å¤‡è°ƒè¯•ã€æ–‡ä»¶ä¼ è¾“å’Œåº”ç”¨ç®¡ç†ã€‚\nğŸŒŸ ADB å·¥å…·çš„ä¼˜åŠ¿ ğŸ”§ è®¾å¤‡æ§åˆ¶: å®Œå…¨æ§åˆ¶ Android è®¾å¤‡çš„å„ä¸ªæ–¹é¢ ğŸ“ æ–‡ä»¶ç®¡ç†: è½»æ¾åœ¨è®¾å¤‡å’Œç”µè„‘é—´ä¼ è¾“æ–‡ä»¶ ğŸ“Š åº”ç”¨è°ƒè¯•: å®‰è£…ã€å¸è½½å’Œè°ƒè¯•åº”ç”¨ç¨‹åº ğŸ® è¾“å…¥æ¨¡æ‹Ÿ: æ¨¡æ‹Ÿè§¦æ‘¸ã€æŒ‰é”®å’Œå…¶ä»–è¾“å…¥æ“ä½œ ğŸ“ æ—¥å¿—åˆ†æ: æŸ¥çœ‹å’Œåˆ†æç³»ç»Ÿæ—¥å¿—ï¼Œæ’æŸ¥é—®é¢˜ ğŸ¯ é€‚ç”¨åœºæ™¯ å°ç±³ç”µè§†ç­‰ Android TV è®¾å¤‡çš„è°ƒè¯•å’Œç®¡ç† æ— è§¦æ‘¸å±è®¾å¤‡çš„è¿œç¨‹æ§åˆ¶ æ‰¹é‡åº”ç”¨å®‰è£…å’Œå¸è½½ ç³»ç»Ÿæ—¥å¿—åˆ†æå’Œæ•…éšœæ’æŸ¥ è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œ ğŸ”§ ä¸€ã€æ‰‹åŠ¨å®‰è£… Android Platform Toolsï¼ˆç¡®ä¿æˆåŠŸï¼‰ æ­¥éª¤ 1ï¼šå®‰è£…å¿…è¦çš„ä¸‹è½½å’Œè§£å‹å·¥å…· ğŸ› ï¸ å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰ wgetï¼ˆä¸‹è½½å·¥å…·ï¼‰å’Œ unzipï¼ˆè§£å‹å·¥å…·ï¼‰ï¼Œå…ˆå®‰è£…å®ƒä»¬ï¼š\n1 2 3 4 5 6 7 # æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£…å¿…è¦å·¥å…· sudo apt-get update sudo apt-get install wget unzip -y # éªŒè¯å·¥å…·å®‰è£… which wget \u0026amp;\u0026amp; echo \u0026#34;âœ… wget å·²å®‰è£…\u0026#34; || echo \u0026#34;âŒ wget å®‰è£…å¤±è´¥\u0026#34; which unzip \u0026amp;\u0026amp; echo \u0026#34;âœ… unzip å·²å®‰è£…\u0026#34; || echo \u0026#34;âŒ unzip å®‰è£…å¤±è´¥\u0026#34; æ­¥éª¤ 2ï¼šä¸‹è½½å®˜æ–¹å·¥å…·åŒ… ğŸ“¦ ä» Google å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ Linux ç‰ˆæœ¬ Android å¹³å°å·¥å…·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºä¸‹è½½ç›®å½• mkdir -p ~/Downloads/platform-tools cd ~/Downloads/platform-tools # ä» Google å®˜æ–¹ä¸‹è½½ wget https://dl.google.com/android/repository/platform-tools-latest-linux.zip # å¦‚æœä¸‹è½½é€Ÿåº¦æ…¢ï¼Œå¯æ›¿æ¢ä¸ºå›½å†…é•œåƒï¼ˆå¦‚æ¸…åå¤§å­¦é•œåƒï¼‰ # wget https://mirrors.tuna.tsinghua.edu.cn/android/repository/platform-tools-latest-linux.zip # éªŒè¯ä¸‹è½½å®Œæ•´æ€§ if [ -f platform-tools-latest-linux.zip ]; then echo \u0026#34;âœ… ä¸‹è½½æˆåŠŸï¼Œæ–‡ä»¶å¤§å°: $(du -h platform-tools-latest-linux.zip | cut -f1)\u0026#34; else echo \u0026#34;âŒ ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\u0026#34; exit 1 fi æ­¥éª¤ 3ï¼šè§£å‹åˆ°ç³»ç»Ÿç›®å½• ğŸ“‚ å°†ä¸‹è½½çš„å‹ç¼©åŒ…è§£å‹åˆ° /usr/local/ï¼ˆç³»ç»Ÿçº§ç›®å½•ï¼Œæ‰€æœ‰ç”¨æˆ·å¯è®¿é—®ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # è§£å‹åˆ°ç³»ç»Ÿç›®å½• sudo unzip platform-tools-latest-linux.zip -d /usr/local/ # éªŒè¯è§£å‹ç»“æœ if [ -d \u0026#34;/usr/local/platform-tools\u0026#34; ]; then echo \u0026#34;âœ… è§£å‹æˆåŠŸï¼Œå¹³å°å·¥å…·å·²å®‰è£…åˆ° /usr/local/platform-tools\u0026#34; ls -la /usr/local/platform-tools/ else echo \u0026#34;âŒ è§£å‹å¤±è´¥\u0026#34; exit 1 fi è§£å‹åä¼šåœ¨ /usr/local/ ä¸‹ç”Ÿæˆ platform-tools æ–‡ä»¶å¤¹ï¼ŒåŒ…å« adbã€fastboot ç­‰å·¥å…·ã€‚\næ­¥éª¤ 4ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰ âš™ï¸ å°†å·¥å…·è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ä»»ä½•ç»ˆç«¯éƒ½èƒ½ç›´æ¥è°ƒç”¨ adb å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æ£€æµ‹å½“å‰ä½¿ç”¨çš„shell CURRENT_SHELL=$(basename \u0026#34;$SHELL\u0026#34;) # æ ¹æ®ä¸åŒçš„shellé…ç½®ç¯å¢ƒå˜é‡ if [ \u0026#34;$CURRENT_SHELL\u0026#34; = \u0026#34;bash\u0026#34; ]; then echo \u0026#39;export PATH=$PATH:/usr/local/platform-tools\u0026#39; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc echo \u0026#34;âœ… å·²é…ç½® Bash ç¯å¢ƒå˜é‡\u0026#34; elif [ \u0026#34;$CURRENT_SHELL\u0026#34; = \u0026#34;zsh\u0026#34; ]; then echo \u0026#39;export PATH=$PATH:/usr/local/platform-tools\u0026#39; \u0026gt;\u0026gt; ~/.zshrc source ~/.zshrc echo \u0026#34;âœ… å·²é…ç½® Zsh ç¯å¢ƒå˜é‡\u0026#34; else echo \u0026#34;âš ï¸ æ— æ³•è¯†åˆ« shell ç±»å‹ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ ä»¥ä¸‹åˆ°æ‚¨çš„ shell é…ç½®:\u0026#34; echo \u0026#34;export PATH=\\$PATH:/usr/local/platform-tools\u0026#34; fi # ä¹Ÿå¯æ·»åŠ åˆ°å…¨å±€é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨ echo \u0026#39;export PATH=$PATH:/usr/local/platform-tools\u0026#39; | sudo tee -a /etc/profile.d/platform-tools.sh sudo chmod +x /etc/profile.d/platform-tools.sh æ­¥éª¤ 5ï¼šéªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ âœ… æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ adb ç‰ˆæœ¬ï¼Œç¡®è®¤å®‰è£…æˆåŠŸï¼š\n1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ adb ç‰ˆæœ¬ adb --version # æ£€æŸ¥ fastboot ç‰ˆæœ¬ fastboot --version # éªŒè¯å·¥å…·æ˜¯å¦åœ¨ PATH ä¸­ which adb \u0026amp;\u0026amp; echo \u0026#34;âœ… ADB å®‰è£…æˆåŠŸ\u0026#34; || echo \u0026#34;âŒ ADB å®‰è£…å¤±è´¥\u0026#34; which fastboot \u0026amp;\u0026amp; echo \u0026#34;âœ… Fastboot å®‰è£…æˆåŠŸ\u0026#34; || echo \u0026#34;âŒ Fastboot å®‰è£…å¤±è´¥\u0026#34; è‹¥è¾“å‡ºç±»ä¼¼ä»¥ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼š\n1 2 3 Android Debug Bridge version 1.0.41 Version 34.0.4-10411341 Installed as /usr/local/platform-tools/adb ğŸ”„ åç»­ä½¿ç”¨ å®‰è£…å®Œæˆåï¼Œå³å¯æ­£å¸¸ä½¿ç”¨ adb ç›¸å…³å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹è¿æ¥è®¾å¤‡ adb devices # å®‰è£… APK adb install /path/to/your/app.apk # è¿›å…¥è®¾å¤‡ Shell adb shell ğŸ“º äºŒã€è¿æ¥ç”µè§† ADB æ­¥éª¤ 1ï¼šå¼€å¯å°ç±³ç”µè§†çš„ã€Œå¼€å‘è€…é€‰é¡¹ã€å’Œã€ŒADB è°ƒè¯•ã€ ğŸ”“ æ‰“å¼€å°ç±³ç”µè§†ï¼Œè¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œå…³äºã€â†’ã€Œäº§å“å‹å·ã€ è¿ç»­å¿«é€Ÿç‚¹å‡»ã€Œäº§å“å‹å·ã€7-10 æ¬¡ï¼Œç›´åˆ°æç¤ºã€Œå·²è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€ è¿”å›ã€Œè®¾ç½®ã€ï¼Œæ‰¾åˆ°å¹¶è¿›å…¥ã€Œè´¦å·ä¸å®‰å…¨ã€ï¼ˆæˆ–ã€Œå¼€å‘è€…é€‰é¡¹ã€ï¼Œä¸åŒå‹å·ä½ç½®å¯èƒ½ä¸åŒï¼‰ å¼€å¯ã€ŒADB è°ƒè¯•ã€å’Œã€Œå…è®¸é€šè¿‡ç½‘ç»œè°ƒè¯•ã€ï¼ˆéƒ¨åˆ†å‹å·å¯èƒ½æ˜¾ç¤ºä¸ºã€ŒUSB è°ƒè¯•ã€ï¼Œéœ€ä¸€å¹¶å¼€å¯ï¼‰ ğŸ’¡ æç¤º: ä¸åŒå°ç±³ç”µè§†å‹å·çš„èœå•å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œå¦‚æœæ‰¾ä¸åˆ°ç›¸å…³é€‰é¡¹ï¼Œè¯·æŸ¥é˜…æ‚¨çš„ç”µè§†å‹å·çš„å…·ä½“è¯´æ˜ã€‚\næ­¥éª¤ 2ï¼šè·å–å°ç±³ç”µè§†çš„ IP åœ°å€ ğŸŒ è¿›å…¥å°ç±³ç”µè§†ã€Œè®¾ç½®ã€â†’ã€Œç½‘ç»œã€â†’ã€Œæœ‰çº¿ç½‘ç»œã€æˆ–ã€Œæ— çº¿ç½‘ç»œã€ æŸ¥çœ‹å¹¶è®°å½•ç”µè§†çš„ IP åœ°å€ï¼ˆä¾‹å¦‚ï¼š192.168.1.100ï¼‰ æˆ–è€…ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æŸ¥æ‰¾ç”µè§† IPï¼š\n1 2 3 4 5 6 # æ‰«æå±€åŸŸç½‘ä¸­çš„è®¾å¤‡ï¼ˆéœ€è¦å®‰è£… nmapï¼‰ sudo apt install nmap -y nmap -sn 192.168.1.0/24 | grep -i \u0026#34;xiaomi\u0026#34; # æˆ–è€…ä½¿ç”¨ arp æ‰«æ arp -a | grep -i \u0026#34;xiaomi\u0026#34; æ­¥éª¤ 3ï¼šé€šè¿‡ ADB è¿æ¥ç”µè§† ğŸ”Œ åœ¨ç”µè„‘ä¸Šæ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿æ¥ç”µè§†ï¼ˆå°† ç”µè§†IP æ›¿æ¢ä¸ºå®é™…åœ°å€ï¼‰ï¼š\n1 2 3 4 5 # è¿æ¥ç”µè§†ï¼ˆé»˜è®¤ç«¯å£ 5555ï¼‰ adb connect ç”µè§†IP:5555 # ç¤ºä¾‹ adb connect 10.10.10.15:5555 é¦–æ¬¡è¿æ¥æ—¶ï¼Œç”µè§†ä¸Šä¼šå¼¹å‡ºã€Œå…è®¸è°ƒè¯•ã€çš„å¯¹è¯æ¡†ï¼Œå‹¾é€‰ã€Œå§‹ç»ˆå…è®¸æ­¤è®¡ç®—æœºã€ï¼Œç„¶åç‚¹å‡»ã€Œç¡®å®šã€\néªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸï¼š\n1 adb devices è‹¥è¾“å‡ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜è¿æ¥æˆåŠŸï¼š\n1 2 List of devices attached 192.168.1.100:5555 device ğŸ”§ é«˜çº§è¿æ¥é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨ä¸åŒç«¯å£è¿æ¥ï¼ˆå¦‚æœç”µè§†ä½¿ç”¨äº†éæ ‡å‡†ç«¯å£ï¼‰ adb connect ç”µè§†IP:ç«¯å£å· # æ–­å¼€è¿æ¥ adb disconnect ç”µè§†IP:5555 # é‡å¯ ADB æœåŠ¡ adb kill-server \u0026amp;\u0026amp; adb start-server # æ— çº¿è°ƒè¯•ï¼ˆAndroid 11+ï¼‰ # å…ˆåœ¨ç”µè§†ä¸Šå¯ç”¨æ— çº¿è°ƒè¯•ï¼Œç„¶åé…å¯¹ adb pair ç”µè§†IP:ç«¯å£ ğŸ® ä¸‰ã€å¸¸ç”¨çš„ ADB å‘½ä»¤ é€‚ç”¨äºè°ƒè¯•ã€ç®¡ç† Android è®¾å¤‡ï¼ˆåŒ…æ‹¬å°ç±³ç”µè§†ç­‰ï¼‰ï¼š\n1ã€è®¾å¤‡ç®¡ç† ğŸ“± è¿æ¥è®¾å¤‡ï¼š 1 2 adb connect ç”µè§†IP:5555 adb devices # éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ æ–­å¼€ä¸è®¾å¤‡çš„è¿æ¥ï¼š 1 2 adb disconnect ç”µè§†IP:5555 # æ–­å¼€æŒ‡å®šè®¾å¤‡ adb disconnect # æ–­å¼€æ‰€æœ‰è®¾å¤‡ é‡å¯è®¾å¤‡ï¼š 1 2 3 adb reboot # æ­£å¸¸é‡å¯ adb reboot recovery # é‡å¯è¿›å…¥ Recovery æ¨¡å¼ adb reboot bootloader # é‡å¯è¿›å…¥ Fastboot æ¨¡å¼ æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯ï¼š 1 2 3 4 5 adb shell getprop # æŸ¥çœ‹è®¾å¤‡æ‰€æœ‰å±æ€§ï¼ˆå‹å·ã€ç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰ adb shell getprop ro.product.model # æŸ¥çœ‹è®¾å¤‡å‹å· adb shell getprop ro.build.version.release # æŸ¥çœ‹ Android ç³»ç»Ÿç‰ˆæœ¬ adb shell wm size # æŸ¥çœ‹å±å¹•åˆ†è¾¨ç‡ adb shell wm density # æŸ¥çœ‹å±å¹•å¯†åº¦ 2ã€æ–‡ä»¶ä¼ è¾“ ğŸ“‚ ä»ç”µè„‘æ¨é€æ–‡ä»¶åˆ°è®¾å¤‡ï¼š 1 adb push /æœ¬åœ°æ–‡ä»¶è·¯å¾„ /è®¾å¤‡ç›®æ ‡è·¯å¾„ ç¤ºä¾‹ï¼šå°†ç”µè„‘çš„ test.txt ä¼ åˆ°ç”µè§†çš„ Downloads ç›®å½•\n1 adb push ~/test.txt /sdcard/Download/ ä»è®¾å¤‡æ‹‰å–æ–‡ä»¶åˆ°ç”µè„‘ï¼š 1 adb pull /è®¾å¤‡æ–‡ä»¶è·¯å¾„ /æœ¬åœ°ç›®æ ‡è·¯å¾„ ç¤ºä¾‹ï¼šå°†ç”µè§†çš„æ—¥å¿—æ–‡ä»¶æ‹‰åˆ°ç”µè„‘æ¡Œé¢\n1 adb pull /sdcard/log.txt ~/Desktop/ æŸ¥çœ‹è®¾å¤‡å­˜å‚¨ç›®å½•ï¼š 1 2 3 adb shell ls /sdcard/ # åˆ—å‡º SD å¡æ ¹ç›®å½•æ–‡ä»¶ adb shell cd /system/ \u0026amp;\u0026amp; ls # è¿›å…¥ç³»ç»Ÿç›®å½•å¹¶æŸ¥çœ‹æ–‡ä»¶ adb shell df -h # æŸ¥çœ‹å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ 3ã€åº”ç”¨ç®¡ç† ğŸ“¦ å®‰è£…åº”ç”¨ï¼š 1 2 3 adb install /path/to/your/app.apk # æ™®é€šå®‰è£… adb install -r /path/to/your/app.apk # é‡æ–°å®‰è£…ä¿ç•™æ•°æ® adb install -s /path/to/your/app.apk # å®‰è£…åˆ°SDå¡ å¸è½½åº”ç”¨ï¼ˆéœ€çŸ¥é“åŒ…åï¼‰ï¼š 1 2 adb uninstall åŒ…å # æ™®é€šå¸è½½ adb uninstall -k åŒ…å # å¸è½½ä½†ä¿ç•™æ•°æ®å’Œç¼“å­˜ ç¤ºä¾‹ï¼šå¸è½½ç³»ç»Ÿé¢„è£…æµè§ˆå™¨ï¼ˆéœ€ root æƒé™ï¼‰\n1 adb uninstall com.android.browser å¼ºåˆ¶åœæ­¢åº”ç”¨ï¼š 1 adb shell am force-stop åŒ…å ç¤ºä¾‹ï¼šå¼ºåˆ¶åœæ­¢å°ç±³è§†é¢‘\n1 adb shell am force-stop com.miui.video æ¸…é™¤åº”ç”¨æ•°æ®å’Œç¼“å­˜ï¼š 1 adb shell pm clear åŒ…å ç¤ºä¾‹ï¼šæ¸…é™¤æµè§ˆå™¨æ•°æ®\n1 adb shell pm clear com.android.browser æŸ¥çœ‹å·²å®‰è£…åº”ç”¨åˆ—è¡¨ï¼ˆåŒ…åï¼‰ï¼š 1 2 3 4 adb shell pm list packages # åˆ—å‡ºæ‰€æœ‰åº”ç”¨åŒ…å adb shell pm list packages -3 # åªåˆ—å‡ºç¬¬ä¸‰æ–¹åº”ç”¨ adb shell pm list packages | grep \u0026#34;miui\u0026#34; # ç­›é€‰åŒ…å«\u0026#34;miui\u0026#34;çš„ç³»ç»Ÿåº”ç”¨ adb shell pm list packages -f # æ˜¾ç¤ºåŒ…åå’Œå¯¹åº”APKè·¯å¾„ å¯åŠ¨åº”ç”¨ï¼š 1 adb shell am start -n åŒ…å/æ´»åŠ¨å ç¤ºä¾‹ï¼šå¯åŠ¨è®¾ç½®\n1 adb shell am start -n com.android.settings/.Settings 4ã€å±å¹•ä¸è¾“å…¥æ§åˆ¶ ğŸ¯ æˆªå–å±å¹•å¹¶ä¿å­˜åˆ°ç”µè„‘ï¼š 1 adb shell screencap -p /sdcard/screen.png \u0026amp;\u0026amp; adb pull /sdcard/screen.png ~/Desktop/ å½•åˆ¶å±å¹•ï¼ˆé»˜è®¤ä¿å­˜ä¸º mp4ï¼ŒæŒ‰ Ctrl+C åœæ­¢ï¼‰ï¼š 1 adb shell screenrecord /sdcard/record.mp4 å½•åˆ¶å®Œæˆåæ‹‰åˆ°ç”µè„‘\n1 adb pull /sdcard/record.mp4 ~/Desktop/ æ¨¡æ‹ŸæŒ‰é”®è¾“å…¥ï¼ˆéƒ¨åˆ†å¸¸ç”¨é”®å€¼ï¼‰ï¼š 1 2 3 4 5 6 7 8 9 10 11 adb shell input keyevent 3 # Home é”® adb shell input keyevent 4 # è¿”å›é”® adb shell input keyevent 19 # ä¸Šæ–¹å‘é”® adb shell input keyevent 20 # ä¸‹æ–¹å‘é”® adb shell input keyevent 21 # å·¦æ–¹å‘é”® adb shell input keyevent 22 # å³æ–¹å‘é”® adb shell input keyevent 66 # ç¡®è®¤é”®ï¼ˆEnterï¼‰ adb shell input keyevent 26 # ç”µæºé”®ï¼ˆé”å±/å”¤é†’ï¼‰ adb shell input keyevent 24 # éŸ³é‡+ adb shell input keyevent 25 # éŸ³é‡- adb shell input keyevent 85 # æ’­æ”¾/æš‚åœ æ¨¡æ‹Ÿè§¦æ‘¸æ“ä½œï¼ˆx,y ä¸ºåæ ‡ï¼‰ï¼š 1 2 3 adb shell input tap x y # ç‚¹å‡»å±å¹•åæ ‡(x,y) adb shell input swipe x1 y1 x2 y2 # ä»(x1,y1)æ»‘åŠ¨åˆ°(x2,y2) adb shell input swipe x1 y1 x2 y2 æŒç»­æ—¶é—´ # æŒ‡å®šæ»‘åŠ¨æŒç»­æ—¶é—´(ms) è¾“å…¥æ–‡æœ¬ï¼š 1 adb shell input text \u0026#34;è¦è¾“å…¥çš„æ–‡æœ¬\u0026#34; 5ã€æ—¥å¿—ä¸è°ƒè¯• ğŸ“ æŸ¥çœ‹å®æ—¶ç³»ç»Ÿæ—¥å¿—ï¼š 1 2 3 4 adb logcat # æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—ï¼ˆæŒ‰ Ctrl+C åœæ­¢ï¼‰ adb logcat *:E # åªæ˜¾ç¤ºé”™è¯¯çº§åˆ«æ—¥å¿— adb logcat | grep \u0026#34;å…³é”®è¯\u0026#34; # ç­›é€‰åŒ…å«å…³é”®è¯çš„æ—¥å¿— adb logcat -c # æ¸…é™¤æ—¥å¿—ç¼“å†²åŒº æŸ¥çœ‹åº”ç”¨å´©æºƒæ—¥å¿—ï¼š 1 adb logcat -b crash # æŸ¥çœ‹å´©æºƒæ—¥å¿— æŸ¥çœ‹è®¾å¤‡ CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µï¼š 1 2 3 4 adb shell top # å®æ—¶æŸ¥çœ‹è¿›ç¨‹èµ„æºå ç”¨ï¼ˆç±»ä¼¼ Linux top å‘½ä»¤ï¼‰ adb shell dumpsys meminfo åŒ…å # æŸ¥çœ‹æŒ‡å®šåº”ç”¨å†…å­˜ä½¿ç”¨ adb shell dumpsys cpuinfo # æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ adb shell dumpsys battery # æŸ¥çœ‹ç”µæ± ä¿¡æ¯ æ€§èƒ½åˆ†æï¼š 1 2 3 adb shell ps # æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ adb shell netstat # æŸ¥çœ‹ç½‘ç»œè¿æ¥ adb shell vmstat 1 # æ¯ç§’æ˜¾ç¤ºä¸€æ¬¡è™šæ‹Ÿå†…å­˜ç»Ÿè®¡ 6ã€ç½‘ç»œè°ƒè¯• ğŸŒ æŸ¥çœ‹è®¾å¤‡ç½‘ç»œçŠ¶æ€ï¼š 1 2 3 adb shell ifconfig # æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯ï¼ˆç±»ä¼¼ Linux ifconfigï¼‰ adb shell netstat # æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ adb shell ip addr show # æ˜¾ç¤ºIPåœ°å€ä¿¡æ¯ æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼š 1 2 adb shell ping 8.8.8.8 # æµ‹è¯•è®¾å¤‡æ˜¯å¦èƒ½è®¿é—®è°·æ­Œ DNS adb shell ping www.baidu.com # æµ‹è¯•è®¾å¤‡æ˜¯å¦èƒ½è®¿é—®ç™¾åº¦ ç«¯å£è½¬å‘ï¼š 1 adb forward tcp:æœ¬åœ°ç«¯å£ tcp:è®¾å¤‡ç«¯å£ # å°†æœ¬åœ°ç«¯å£è½¬å‘åˆ°è®¾å¤‡ ç¤ºä¾‹ï¼šå°†æœ¬åœ°8080ç«¯å£è½¬å‘åˆ°è®¾å¤‡çš„8080ç«¯å£\n1 adb forward tcp:8080 tcp:8080 âš™ï¸ å››ã€é«˜çº§é…ç½®ä¸æŠ€å·§ ğŸ”§ ADB é…ç½®ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 # åˆ›å»º ADB é…ç½®ç›®å½• mkdir -p ~/.android # é…ç½® ADB é€‰é¡¹ echo \u0026#34;adb --version\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias adbl=\u0026#39;adb logcat | grep -i \\\u0026#34;error\\\\|exception\\\u0026#34;\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc # å¯ç”¨ ADB æ— çº¿è°ƒè¯•ï¼ˆAndroid 11+ï¼‰ echo \u0026#34;export ADB_IP=192.168.1.100\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias adbw=\u0026#39;adb connect \\$ADB_IP:5555\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc ğŸ“‹ å¸¸ç”¨è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # æ‰¹é‡å®‰è£…APKè„šæœ¬ APK_DIR=\u0026#34;/path/to/apk/folder\u0026#34; for apk in \u0026#34;$APK_DIR\u0026#34;/*.apk; do echo \u0026#34;æ­£åœ¨å®‰è£…: $(basename \u0026#34;$apk\u0026#34;)\u0026#34; adb install \u0026#34;$apk\u0026#34; if [ $? -eq 0 ]; then echo \u0026#34;âœ… å®‰è£…æˆåŠŸ: $(basename \u0026#34;$apk\u0026#34;)\u0026#34; else echo \u0026#34;âŒ å®‰è£…å¤±è´¥: $(basename \u0026#34;$apk\u0026#34;)\u0026#34; fi done 1 2 3 4 5 6 7 8 #!/bin/bash # å±å¹•æˆªå›¾å¹¶è‡ªåŠ¨æ‹‰å–è„šæœ¬ TIMESTAMP=$(date +%Y%m%d_%H%M%S) adb shell screencap -p /sdcard/screenshot_$TIMESTAMP.png adb pull /sdcard/screenshot_$TIMESTAMP.png ~/Pictures/ adb shell rm /sdcard/screenshot_$TIMESTAMP.png echo \u0026#34;æˆªå›¾å·²ä¿å­˜: ~/Pictures/screenshot_$TIMESTAMP.png\u0026#34; ğŸ¯ ç”µè§†ç‰¹å®šå‘½ä»¤ 1 2 3 4 5 6 7 8 9 # ç”µè§†ç”µæºç®¡ç† adb shell input keyevent 26 # ç”µæºé”® adb shell input keyevent 223 # ä¼‘çœ  adb shell input keyevent 224 # å”¤é†’ # ç”µè§†ç‰¹å®šåŠŸèƒ½ adb shell input keyevent 183 # å½•åˆ¶å±å¹• adb shell input keyevent 177 # ä¹¦ç­¾ adb shell input keyevent 175 # åª’ä½“æ’­æ”¾ ğŸš¨ äº”ã€æ•…éšœæ’é™¤ ğŸ” å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ ADB è®¾å¤‡æœªæˆæƒ\n1 2 3 4 # è§£å†³æ–¹æ¡ˆï¼šé‡å¯ADBæœåŠ¡å¹¶é‡æ–°è¿æ¥ adb kill-server adb start-server adb connect ç”µè§†IP:5555 è¿æ¥è¢«æ‹’ç»\n1 2 3 4 # ç¡®ä¿ç”µè§†å·²å¼€å¯ADBè°ƒè¯• # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status sudo ufw allow out 5555/tcp è®¾å¤‡ç¦»çº¿\n1 2 3 # é‡æ–°è¿æ¥è®¾å¤‡ adb disconnect adb connect ç”µè§†IP:5555 ADB å‘½ä»¤æ‰¾ä¸åˆ°\n1 2 3 4 # æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½® echo $PATH # é‡æ–°é…ç½®ç¯å¢ƒå˜é‡ export PATH=$PATH:/usr/local/platform-tools å®‰è£…åº”ç”¨å¤±è´¥\n1 2 # å°è¯•ä½¿ç”¨ä¸åŒçš„å®‰è£…é€‰é¡¹ adb install -r -g åº”ç”¨.apk ğŸ“Š è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹è¯¦ç»†çš„ADBè°ƒè¯•ä¿¡æ¯ adb -d logcat # ä½¿ç”¨è®¾å¤‡æ—¥å¿— adb -e logcat # ä½¿ç”¨æ¨¡æ‹Ÿå™¨æ—¥å¿— # æ£€æŸ¥è®¾å¤‡çŠ¶æ€ adb get-state adb get-serialno # æŸ¥çœ‹ADBç‰ˆæœ¬ adb version # é‡å¯ADBå®ˆæŠ¤è¿›ç¨‹ adb usb # åˆ‡æ¢å›USBæ¨¡å¼ adb tcpip 5555 # åˆ‡æ¢å›TCP/IPæ¨¡å¼ ğŸ’¡ å…­ã€æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® ä»…è¿æ¥å¯ä¿¡è®¾å¤‡: åªåœ¨å®¶åº­ç½‘ç»œæˆ–å¯ä¿¡ç½‘ç»œä¸­ä½¿ç”¨ADB over TCP/IP ä½¿ç”¨åå…³é—­ç½‘ç»œè°ƒè¯•: å®Œæˆè°ƒè¯•åï¼Œå…³é—­ç”µè§†çš„ADBç½‘ç»œè°ƒè¯•åŠŸèƒ½ å®šæœŸæ›´æ–°å·¥å…·: ä¿æŒplatform-toolsä¸ºæœ€æ–°ç‰ˆæœ¬ è°¨æ…ä½¿ç”¨rootå‘½ä»¤: é¿å…å¯¹ç³»ç»Ÿé€ æˆä¸å¯é€†çš„ä¿®æ”¹ ğŸ“ˆ æ€§èƒ½ä¼˜åŒ– ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬: å°†å¸¸ç”¨å‘½ä»¤ç»„åˆæˆè„šæœ¬æé«˜æ•ˆç‡ åˆç†ä½¿ç”¨æ—¥å¿—è¿‡æ»¤: ä½¿ç”¨grepè¿‡æ»¤æ—¥å¿—ï¼Œå‡å°‘ä¸å¿…è¦çš„ä¿¡æ¯ ä¼˜åŒ–æ–‡ä»¶ä¼ è¾“: å¤§æ–‡ä»¶ä¼ è¾“å‰å…ˆå‹ç¼©ï¼Œä¼ è¾“åè§£å‹ å®šæœŸæ¸…ç†: æ¸…ç†ä¸å†éœ€è¦çš„åº”ç”¨å’Œæ–‡ä»¶ ğŸ”„ è‡ªåŠ¨åŒ–å·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/bash # è‡ªåŠ¨åŒ–ç”µè§†è®¾ç½®è„šæœ¬ echo \u0026#34;å¼€å§‹è‡ªåŠ¨åŒ–ç”µè§†è®¾ç½®...\u0026#34; # è¿æ¥ç”µè§† adb connect $TV_IP:5555 # å®‰è£…å¿…å¤‡åº”ç”¨ for app in \u0026#34;${APPS[@]}\u0026#34;; do adb install $app done # é…ç½®åˆå§‹è®¾ç½® adb shell settings put global stay_on_while_plugged_in 3 adb shell settings put system screen_off_timeout 600000 # ç¦ç”¨ä¸éœ€è¦çš„ç³»ç»Ÿåº”ç”¨ for package in \u0026#34;${PACKAGES_TO_DISABLE[@]}\u0026#34;; do adb shell pm disable-user --user 0 $package done echo \u0026#34;ç”µè§†è®¾ç½®å®Œæˆ!\u0026#34; ğŸ“š å­¦ä¹ èµ„æº å®˜æ–¹ Android å¼€å‘è€…æ–‡æ¡£ ADB å‘½ä»¤å¤§å…¨ XDA å¼€å‘è€…è®ºå› Android è°ƒè¯•æ¡¥ GitHub ä»“åº“ ğŸ¯ æç¤º: ADB æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œä½†ä½¿ç”¨ä¸å½“å¯èƒ½ä¼šå¯¹è®¾å¤‡é€ æˆæŸå®³ã€‚è¯·ç¡®ä¿æ‚¨äº†è§£æ¯ä¸ªå‘½ä»¤çš„ä½œç”¨åå†æ‰§è¡Œï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§è®¾å¤‡ä¸Šã€‚\nğŸ”§ æ‰©å±•åŠŸèƒ½: è€ƒè™‘ä½¿ç”¨å›¾å½¢åŒ–ADBå·¥å…·å¦‚ scrcpy æˆ– QtScrcpy æ¥å¢å¼ºæ‚¨çš„è°ƒè¯•ä½“éªŒã€‚\nå¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨å……åˆ†åˆ©ç”¨ADBå·¥å…·ç®¡ç†å’Œè°ƒè¯•æ‚¨çš„å°ç±³ç”µè§†ï¼ğŸ“ºâœ¨\n","date":"2025-08-26T16:43:35+08:00","image":"https://file.meimolihan.eu.org/img/fnos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8d78bc36/","title":"FnOS å®‰è£… ADB å·¥å…·æŒ‡å—ğŸ“±"},{"content":"Windows å®‰è£… ADB å·¥å…·æŒ‡å— ğŸªŸ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åœ¨ Windows 11 ç³»ç»Ÿä¸Šå®‰è£… ADB å·¥å…·å¹¶è¿æ¥å°ç±³ç”µè§†çš„å®Œæ•´æ•™ç¨‹ï¼ŒåŒ…å«ä¸°å¯Œçš„ ADB å‘½ä»¤å‚è€ƒã€‚\nğŸ“– ç›®å½•å¯¼èˆª ğŸ”§ ä¸€ã€Windows 11 å®‰è£… Android Platform Tools ğŸ“º äºŒã€Windows 11 è¿æ¥å°ç±³ç”µè§† ADB ğŸ® ä¸‰ã€å¸¸ç”¨çš„ ADB å‘½ä»¤ ğŸ› ï¸ å››ã€é«˜çº§åº”ç”¨ç®¡ç† ğŸ“± äº”ã€è®¾å¤‡è°ƒè¯•ä¸ç›‘æ§ âš¡ å…­ã€å®ç”¨æŠ€å·§ä¸è„šæœ¬ ğŸš¨ ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å— ğŸ”§ ä¸€ã€Windows 11 å®‰è£… Android Platform Tools æ­¥éª¤ 1ï¼šä¸‹è½½ Platform Tools å·¥å…·åŒ… ğŸ“¦ æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ä»¥ä¸‹ä¸‹è½½åœ°å€ï¼š\nè°·æ­Œå®˜æ–¹åœ°å€ï¼š\nhttps://dl.google.com/android/repository/platform-tools-latest-windows.zip å›½å†…é•œåƒï¼ˆæ¸…åå¤§å­¦ï¼‰ï¼š\nhttps://mirrors.tuna.tsinghua.edu.cn/android/repository/platform-tools-latest-windows.zip ä¸‹è½½å®Œæˆåï¼Œæ‚¨å°†è·å¾— platform-tools-latest-windows.zip å‹ç¼©åŒ…ã€‚\næ­¥éª¤ 2ï¼šè§£å‹åˆ°å›ºå®šç›®å½• ğŸ“‚ å»ºè®®å°†å·¥å…·è§£å‹åˆ°ç³»ç»Ÿçº§ç›®å½•ï¼ˆæ–¹ä¾¿ç®¡ç†ï¼‰ï¼Œä¾‹å¦‚ C:\\platform-tools\\ï¼š\nå³é”®ç‚¹å‡»å‹ç¼©åŒ… é€‰æ‹©ã€Œå…¨éƒ¨æå–ã€ é€‰æ‹©ç›®æ ‡è·¯å¾„ C:\\ ç¡®ä¿è§£å‹åè·¯å¾„ä¸º C:\\platform-tools\\adb.exeï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰ adb.exe ç­‰æ–‡ä»¶ï¼‰ æ­¥éª¤ 3ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆå…³é”®æ­¥éª¤ï¼‰ âš™ï¸ æ‰“å¼€ã€Œæ­¤ç”µè„‘ã€â†’ å³é”®ç©ºç™½å¤„ â†’ ã€Œå±æ€§ã€ ç‚¹å‡»å·¦ä¾§ã€Œé«˜çº§ç³»ç»Ÿè®¾ç½®ã€â†’ ã€Œç¯å¢ƒå˜é‡ã€ åœ¨ã€Œç³»ç»Ÿå˜é‡ã€ä¸­æ‰¾åˆ° Path å˜é‡ â†’ åŒå‡»æ‰“å¼€ ç‚¹å‡»ã€Œæ–°å»ºã€â†’ è¾“å…¥ C:\\platform-tools â†’ ç‚¹å‡»ã€Œç¡®å®šã€ä¿å­˜æ‰€æœ‰çª—å£ æ­¥éª¤ 4ï¼šéªŒè¯å®‰è£… âœ… æŒ‰ä¸‹ Win + R â†’ è¾“å…¥ cmd æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆæˆ– PowerShellï¼‰ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè‹¥è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯åˆ™å®‰è£…æˆåŠŸï¼š 1 adb --version ğŸ“º äºŒã€Windows 11 è¿æ¥å°ç±³ç”µè§† ADB æ­¥éª¤ 1ï¼šå¼€å¯ç”µè§†çš„ ADB è°ƒè¯• ğŸ”“ è¿›å…¥ç”µè§†ã€Œè®¾ç½®ã€â†’ã€Œå…³äºã€ è¿ç»­ç‚¹å‡»ã€Œäº§å“å‹å·ã€æ¿€æ´»å¼€å‘è€…æ¨¡å¼ å¼€å¯ã€ŒADB è°ƒè¯•ã€å’Œã€Œå…è®¸ç½‘ç»œè°ƒè¯•ã€ æ­¥éª¤ 2ï¼šè·å–ç”µè§† IP åœ°å€ ğŸŒ ç”µè§†ã€Œè®¾ç½®ã€â†’ã€Œç½‘ç»œã€â†’ æŸ¥çœ‹å¹¶è®°å½• IP åœ°å€ï¼ˆä¾‹å¦‚ 192.168.1.100ï¼‰\næ­¥éª¤ 3ï¼šé€šè¿‡ ADB è¿æ¥ç”µè§† ğŸ”Œ æ‰“å¼€ Windows å‘½ä»¤æç¤ºç¬¦ï¼ˆcmdï¼‰æˆ– PowerShell è¾“å…¥è¿æ¥å‘½ä»¤ï¼ˆæ›¿æ¢ä¸ºç”µè§†å®é™… IPï¼‰ï¼š 1 adb connect 10.10.10.15:5555 é¦–æ¬¡è¿æ¥æ—¶ï¼Œç”µè§†ä¼šå¼¹å‡ºæˆæƒçª—å£ï¼Œå‹¾é€‰ã€Œå§‹ç»ˆå…è®¸ã€å¹¶ç¡®è®¤ éªŒè¯è¿æ¥ï¼š 1 adb devices è‹¥æ˜¾ç¤ºç±»ä¼¼ 10.10.10.15:5555 device åˆ™è¿æ¥æˆåŠŸ\nğŸ® ä¸‰ã€å¸¸ç”¨çš„ ADB å‘½ä»¤ é€‚ç”¨äºè°ƒè¯•ã€ç®¡ç† Android è®¾å¤‡ï¼ˆåŒ…æ‹¬å°ç±³ç”µè§†ç­‰ï¼‰ï¼š\n1ã€è®¾å¤‡ç®¡ç† ğŸ“± è¿æ¥è®¾å¤‡ï¼š 1 2 adb connect ç”µè§†IP:5555 adb devices # éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ æ–­å¼€ä¸è®¾å¤‡çš„è¿æ¥ï¼š 1 2 adb disconnect ç”µè§†IP:5555 # æ–­å¼€æŒ‡å®šè®¾å¤‡ adb disconnect # æ–­å¼€æ‰€æœ‰è®¾å¤‡ é‡å¯è®¾å¤‡ï¼š 1 2 3 adb reboot # æ­£å¸¸é‡å¯ adb reboot recovery # é‡å¯è¿›å…¥ Recovery æ¨¡å¼ adb reboot bootloader # é‡å¯è¿›å…¥ Fastboot æ¨¡å¼ æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯ï¼š 1 2 3 adb shell getprop # æŸ¥çœ‹è®¾å¤‡æ‰€æœ‰å±æ€§ï¼ˆå‹å·ã€ç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰ adb shell getprop ro.product.model # æŸ¥çœ‹è®¾å¤‡å‹å· adb shell getprop ro.build.version.release # æŸ¥çœ‹ Android ç³»ç»Ÿç‰ˆæœ¬ 2ã€æ–‡ä»¶ä¼ è¾“ ğŸ“‚ ä»ç”µè„‘æ¨é€æ–‡ä»¶åˆ°è®¾å¤‡ï¼š 1 adb push æœ¬åœ°æ–‡ä»¶è·¯å¾„ è®¾å¤‡ç›®æ ‡è·¯å¾„ ç¤ºä¾‹ï¼šå°†ç”µè„‘çš„ test.txt ä¼ åˆ°ç”µè§†çš„ Downloads ç›®å½•\n1 adb push C:\\Users\\ç”¨æˆ·å\\test.txt /sdcard/Download/ ä»è®¾å¤‡æ‹‰å–æ–‡ä»¶åˆ°ç”µè„‘ï¼š 1 adb pull è®¾å¤‡æ–‡ä»¶è·¯å¾„ æœ¬åœ°ç›®æ ‡è·¯å¾„ ç¤ºä¾‹ï¼šå°†ç”µè§†çš„æ—¥å¿—æ–‡ä»¶æ‹‰åˆ°ç”µè„‘æ¡Œé¢\n1 adb pull /sdcard/log.txt C:\\Users\\ç”¨æˆ·å\\Desktop\\ æŸ¥çœ‹è®¾å¤‡å­˜å‚¨ç›®å½•ï¼š 1 adb shell ls /sdcard/ # åˆ—å‡º SD å¡æ ¹ç›®å½•æ–‡ä»¶ 3ã€åº”ç”¨ç®¡ç† ğŸ“¦ å®‰è£…åº”ç”¨ï¼š 1 adb install è·¯å¾„/åº”ç”¨å.apk å¸è½½åº”ç”¨ï¼ˆéœ€çŸ¥é“åŒ…åï¼‰ï¼š 1 adb uninstall åŒ…å å¼ºåˆ¶åœæ­¢åº”ç”¨ï¼š 1 adb shell am force-stop åŒ…å æŸ¥çœ‹å·²å®‰è£…åº”ç”¨åˆ—è¡¨ï¼š 1 2 adb shell pm list packages # åˆ—å‡ºæ‰€æœ‰åº”ç”¨åŒ…å adb shell pm list packages -3 # åªåˆ—å‡ºç¬¬ä¸‰æ–¹åº”ç”¨ 4ã€å±å¹•ä¸è¾“å…¥æ§åˆ¶ ğŸ¯ æˆªå–å±å¹•å¹¶ä¿å­˜åˆ°ç”µè„‘ï¼š 1 2 adb shell screencap -p /sdcard/screen.png adb pull /sdcard/screen.png C:\\Users\\ç”¨æˆ·å\\Desktop\\ æ¨¡æ‹ŸæŒ‰é”®è¾“å…¥ï¼š 1 2 3 adb shell input keyevent 3 # Home é”® adb shell input keyevent 4 # è¿”å›é”® adb shell input keyevent 66 # ç¡®è®¤é”®ï¼ˆEnterï¼‰ 5ã€æ—¥å¿—ä¸è°ƒè¯• ğŸ“ æŸ¥çœ‹å®æ—¶ç³»ç»Ÿæ—¥å¿—ï¼š 1 adb logcat # æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—ï¼ˆæŒ‰ Ctrl+C åœæ­¢ï¼‰ æŸ¥çœ‹åº”ç”¨å´©æºƒæ—¥å¿—ï¼š 1 adb logcat -b crash # æŸ¥çœ‹å´©æºƒæ—¥å¿— 6ã€ç½‘ç»œè°ƒè¯• ğŸŒ æŸ¥çœ‹è®¾å¤‡ç½‘ç»œçŠ¶æ€ï¼š 1 adb shell netstat # æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼š 1 adb shell ping www.baidu.com # æµ‹è¯•è®¾å¤‡æ˜¯å¦èƒ½è®¿é—®ç™¾åº¦ ğŸ› ï¸ å››ã€é«˜çº§åº”ç”¨ç®¡ç† 1. åº”ç”¨åŒ…åæŸ¥æ‰¾ ğŸ” 1 2 3 4 5 6 # æŸ¥æ‰¾åŒ…å«ç‰¹å®šå…³é”®è¯çš„åº”ç”¨ adb shell pm list packages | grep \u0026#34;miui\u0026#34; adb shell pm list packages | grep \u0026#34;google\u0026#34; # æŸ¥çœ‹åº”ç”¨è¯¦ç»†ä¿¡æ¯ adb shell dumpsys package åŒ…å 2. ç¦ç”¨ç³»ç»Ÿåº”ç”¨ ğŸš« 1 2 3 4 5 6 7 8 # ç¦ç”¨åº”ç”¨ï¼ˆéœ€è¦rootæƒé™ï¼‰ adb shell pm disable-user åŒ…å # å¯ç”¨åº”ç”¨ adb shell pm enable åŒ…å # æŸ¥çœ‹å·²ç¦ç”¨åº”ç”¨ adb shell pm list packages -d 3. æ¸…é™¤åº”ç”¨æ•°æ® ğŸ§¹ 1 2 # æ¸…é™¤åº”ç”¨æ•°æ®å’Œç¼“å­˜ adb shell pm clear åŒ…å 4. åº”ç”¨æƒé™ç®¡ç† ğŸ” 1 2 3 4 5 6 7 8 # æŸ¥çœ‹åº”ç”¨æƒé™ adb shell dumpsys package åŒ…å | grep permission # æˆäºˆæƒé™ adb shell pm grant åŒ…å android.permission.æƒé™å # æ’¤é”€æƒé™ adb shell pm revoke åŒ…å android.permission.æƒé™å ğŸ“± äº”ã€è®¾å¤‡è°ƒè¯•ä¸ç›‘æ§ 1. ç³»ç»Ÿä¿¡æ¯æŸ¥çœ‹ ğŸ“Š 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹CPUä¿¡æ¯ adb shell cat /proc/cpuinfo # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ adb shell dumpsys meminfo # æŸ¥çœ‹ç”µæ± çŠ¶æ€ adb shell dumpsys battery # æŸ¥çœ‹å­˜å‚¨ç©ºé—´ adb shell df -h 2. è¿›ç¨‹ç®¡ç† ğŸ”„ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹è¿è¡Œä¸­çš„è¿›ç¨‹ adb shell ps # æŸ¥çœ‹å‰å°åº”ç”¨ adb shell dumpsys activity activities | grep \u0026#34;mResumedActivity\u0026#34; # æ€æ­»è¿›ç¨‹ adb shell am kill åŒ…å 3. ç½‘ç»œè¯Šæ–­ ğŸŒ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç½‘ç»œè¿æ¥è¯¦æƒ… adb shell netstat -tulpn # æŸ¥çœ‹WIFIä¿¡æ¯ adb shell dumpsys wifi # æŸ¥çœ‹IPåœ°å€ adb shell ip addr show 4. æ€§èƒ½ç›‘æ§ ğŸ“ˆ 1 2 3 4 5 6 7 8 # ç›‘æ§CPUä½¿ç”¨ç‡ adb shell top -n 1 # ç›‘æ§å†…å­˜ä½¿ç”¨ adb shell dumpsys meminfo | grep \u0026#34;Total RAM\u0026#34; # ç›‘æ§å¸§ç‡ï¼ˆéœ€è¦å¼€å‘è€…é€‰é¡¹ä¸­çš„GPUæ¸²æŸ“æ¨¡å¼ï¼‰ adb shell dumpsys gfxinfo åŒ…å âš¡ å…­ã€å®ç”¨æŠ€å·§ä¸è„šæœ¬ 1. æ‰¹é‡æ“ä½œè„šæœ¬ ğŸ“œ 1 2 3 4 5 6 7 # æ‰¹é‡å®‰è£…å¤šä¸ªAPK for apk in *.apk; do adb install \u0026#34;$apk\u0026#34;; done # æ‰¹é‡æˆªå›¾å¹¶æ‹‰å– adb shell screencap -p /sdcard/screenshot.png adb pull /sdcard/screenshot.png adb shell rm /sdcard/screenshot.png 2. è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ ğŸ¤– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/bash # auto_backup.sh - è‡ªåŠ¨å¤‡ä»½åº”ç”¨æ•°æ® DEVICE_IP=\u0026#34;10.10.10.15:5555\u0026#34; BACKUP_DIR=\u0026#34;/backup/$(date +%Y%m%d)\u0026#34; mkdir -p \u0026#34;$BACKUP_DIR\u0026#34; # è¿æ¥è®¾å¤‡ adb connect $DEVICE_IP # å¤‡ä»½åº”ç”¨åˆ—è¡¨ adb shell pm list packages -3 \u0026gt; \u0026#34;$BACKUP_DIR/apps_list.txt\u0026#34; # å¤‡ä»½é‡è¦æ•°æ® adb pull /sdcard/DCIM \u0026#34;$BACKUP_DIR/DCIM\u0026#34; adb pull /sdcard/Download \u0026#34;$BACKUP_DIR/Download\u0026#34; echo \u0026#34;å¤‡ä»½å®Œæˆï¼ä½ç½®: $BACKUP_DIR\u0026#34; 3. å¿«æ·å‘½ä»¤åˆ«å âš¡ åœ¨ PowerShell ä¸­è®¾ç½®åˆ«åï¼š\n1 2 3 4 5 6 7 # æ·»åŠ åˆ° $PROFILE æ–‡ä»¶ä¸­ function adb-connect { adb connect 10.10.10.15:5555 } function adb-screenshot { adb shell screencap -p /sdcard/screen.png adb pull /sdcard/screen.png \u0026#34;$HOME\\Desktop\\screen_$(Get-Date -Format \u0026#39;yyyyMMdd_HHmmss\u0026#39;).png\u0026#34; adb shell rm /sdcard/screen.png } 4. å¸¸ç”¨åŠŸèƒ½å¿«æ·æ–¹å¼ ğŸ¯ 1 2 3 4 5 6 7 8 9 10 # ä¸€é”®æˆªå± adb shell screencap -p /sdcard/screenshot.png \u0026amp;\u0026amp; adb pull /sdcard/screenshot.png \u0026amp;\u0026amp; adb shell rm /sdcard/screenshot.png # ä¸€é”®å½•å±ï¼ˆéœ€è¦Android 4.4+ï¼‰ adb shell screenrecord /sdcard/demo.mp4 # æŒ‰Ctrl+Cåœæ­¢å½•å±å adb pull /sdcard/demo.mp4 # ä¸€é”®æ¸…ç†ç¼“å­˜ adb shell pm trim-caches 999999999 ğŸš¨ ä¸ƒã€æ•…éšœæ’é™¤æŒ‡å— å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š ADB è¿æ¥å¤±è´¥ âŒ\n1 2 3 4 5 6 7 8 # æ£€æŸ¥è®¾å¤‡IPå’Œç«¯å£ ping 10.10.10.15 # æ£€æŸ¥ADBæœåŠ¡ adb kill-server adb start-server # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® è®¾å¤‡æœªæˆæƒ ğŸ”’\n1 2 3 4 5 # é‡æ–°è§¦å‘æˆæƒæç¤º adb disconnect adb connect 10.10.10.15:5555 # æ£€æŸ¥ç”µè§†ä¸Šçš„æˆæƒå¯¹è¯æ¡† å‘½ä»¤æ— å“åº” â³\n1 2 3 4 5 6 # é‡å¯ADBæœåŠ¡ adb kill-server adb start-server # é‡å¯è®¾å¤‡ adb reboot æƒé™ä¸è¶³ ğŸš«\n1 2 3 # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦ # æ£€æŸ¥è®¾å¤‡rootçŠ¶æ€ adb shell su -c \u0026#34;whoami\u0026#34; å­˜å‚¨ç©ºé—´ä¸è¶³ ğŸ’¾\n1 2 3 4 5 # æ¸…ç†ç¼“å­˜ adb shell pm trim-caches 999999999 # æŸ¥çœ‹å­˜å‚¨ç©ºé—´ adb shell df -h è°ƒè¯•æŠ€å·§ ğŸ› 1 2 3 4 5 6 7 8 9 # è¯¦ç»†è°ƒè¯•æ¨¡å¼ adb -d logcat -v time # ç›‘æ§ç‰¹å®šåº”ç”¨æ—¥å¿— adb logcat --pid=$(adb shell pidof -s åŒ…å) # æŸ¥çœ‹è®¾å¤‡çŠ¶æ€ adb get-state adb get-serialno ç´§æ€¥æ¢å¤æªæ–½ ğŸ†˜ 1 2 3 4 5 6 7 8 9 # è®¾å¤‡æ— å“åº”æ—¶å¼ºåˆ¶é‡å¯ adb reboot bootloader fastboot reboot # æ¢å¤å‡ºå‚è®¾ç½®ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰ adb shell recovery --wipe_data # è¿›å…¥å®‰å…¨æ¨¡å¼ adb shell am start -a android.intent.action.REBOOT --ez safeMode true ğŸ’¡ æ¸©é¦¨æç¤º é¦–æ¬¡è¿æ¥ï¼šç¡®ä¿ç”µè§†å·²å¼€å¯ã€ŒUSBè°ƒè¯•ã€å’Œã€Œç½‘ç»œADBè°ƒè¯•ã€é€‰é¡¹ é˜²ç«å¢™è®¾ç½®ï¼šå¦‚æœè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Windowsé˜²ç«å¢™è®¾ç½®ï¼Œå…è®¸ADBé€šä¿¡ é©±åŠ¨é—®é¢˜ï¼šéƒ¨åˆ†è®¾å¤‡å¯èƒ½éœ€è¦å®‰è£…é¢å¤–çš„USBé©±åŠ¨ç¨‹åº æƒé™é—®é¢˜ï¼šä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦å¯èƒ½è§£å†³æŸäº›æƒé™é—®é¢˜ å®šæœŸæ›´æ–°ï¼šä¿æŒplatform-toolsä¸ºæœ€æ–°ç‰ˆæœ¬ä»¥è·å¾—æœ€ä½³å…¼å®¹æ€§ ğŸ“š æ‰©å±•èµ„æº Android Developer ADB æ–‡æ¡£ XDA Developers è®ºå› å°ç±³ç¤¾åŒº ADB æ•™ç¨‹ ğŸ¯ æç¤ºï¼šåœ¨è¿›è¡Œä»»ä½•ç³»ç»Ÿçº§æ“ä½œå‰ï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®ã€‚æŸäº›é«˜çº§å‘½ä»¤å¯èƒ½éœ€è¦rootæƒé™ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚\nå¸Œæœ›è¿™ä»½å®Œæ•´çš„ADBæŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç†å’Œè°ƒè¯•æ‚¨çš„Androidè®¾å¤‡ï¼ğŸš€\n","date":"2025-08-26T16:41:34+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b7cff032/","title":"Windows å®‰è£… ADB å·¥å…·æŒ‡å— ğŸªŸ"},{"content":"1Panel é¢æ¿å®‰è£…ä¸å¸è½½æŒ‡å— ğŸ› ï¸ ğŸ§ 1Panel æ˜¯ä¸€æ¬¾ç°ä»£åŒ–ã€å¼€æºçš„ Linux æœåŠ¡å™¨è¿ç»´ç®¡ç†é¢æ¿ï¼Œé€šè¿‡ Web ç•Œé¢è½»æ¾ç®¡ç†æœåŠ¡å™¨ã€ç½‘ç«™ã€æ•°æ®åº“ã€å®¹å™¨ç­‰ã€‚\nç›®å½• ğŸ“– ç®€ä»‹ ğŸ“¦ ä¸€ã€å®‰è£…ä¸å¸è½½ ğŸ”§ äºŒã€1pctl åŸºç¡€å‘½ä»¤ ğŸ”„ ä¸‰ã€é‡ç½®å‘½ä»¤ ğŸŒ å››ã€ç›‘å¬ IP å‘½ä»¤ ğŸ“ äº”ã€æ›´æ–°å‘½ä»¤ ğŸ“¦ å…­ã€è®¡åˆ’ä»»åŠ¡ âš™ï¸ ä¸ƒã€å®‰è£…åçš„åˆå§‹è®¾ç½® ğŸ” å…«ã€å¸¸è§é—®é¢˜æ’æŸ¥ ğŸ’¾ ä¹ã€å¤‡ä»½ä¸æ¢å¤ç­–ç•¥ ğŸš€ åã€æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ”’ åä¸€ã€å®‰å…¨æœ€ä½³å®è·µ ğŸ†˜ åäºŒã€æ•…éšœæ¢å¤æŒ‡å— ğŸ“– ç®€ä»‹ 1Panel æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¼€æº Linux æœåŠ¡å™¨è¿ç»´ç®¡ç†é¢æ¿ï¼Œé€šè¿‡ Web ç•Œé¢è½»æ¾ç®¡ç†æœåŠ¡å™¨ã€ç½‘ç«™ã€æ•°æ®åº“ã€å®¹å™¨ç­‰ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œç›´è§‚çš„æ“ä½œç•Œé¢ï¼Œæ˜¯æœåŠ¡å™¨ç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ã€‚\nç½‘ç›˜åˆ†äº«ï¼š https://pan.quark.cn/s/56eb82ad45cc ä¸€ã€ğŸ“¦ å®‰è£…ä¸å¸è½½ 1. ç¯å¢ƒè¦æ±‚ æ“ä½œç³»ç»Ÿï¼šLinux ä¾èµ–ï¼šDocker 2. å®‰è£… Docker 1 2 3 4 5 6 7 8 9 10 11 # Debian/Ubuntu sudo apt update \u0026amp;\u0026amp; sudo apt install docker.io # CentOS/RHEL sudo yum install yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum install docker-ce docker-ce-cli containerd.io # å¯åŠ¨ Docker sudo systemctl start docker sudo systemctl enable docker 3. å®‰è£… 1Panel 1 2 # ä¸€é”®å®‰è£… 1Panel bash -c \u0026#34;$(curl -sSL https://resource.fit2cloud.com/1panel/package/v2/quick_start.sh)\u0026#34; 4. å¸è½½ 1Panel 1 2 # å®Œå…¨å¸è½½ 1Panel 1pctl uninstall äºŒã€ğŸ”§ 1pctl åŸºç¡€å‘½ä»¤ 1Panel é»˜è®¤å†…ç½®äº†å‘½ä»¤è¡Œè¿ç»´å·¥å…· 1pctlï¼Œé€šè¿‡æ‰§è¡Œ 1pctl help å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„å‘½ä»¤è¯´æ˜ã€‚\næœåŠ¡ç®¡ç†å‘½ä»¤ï¼š 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ 1Panel æœåŠ¡è¿è¡ŒçŠ¶æ€ 1pctl status # å¯åŠ¨ 1Panel æœåŠ¡ 1pctl start # åœæ­¢ 1Panel æœåŠ¡ 1pctl stop # é‡å¯ 1Panel æœåŠ¡ 1pctl restart ç³»ç»Ÿä¿¡æ¯å‘½ä»¤ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è·å– 1Panel ç”¨æˆ·ä¿¡æ¯ï¼ˆåå°åœ°å€+ç”¨æˆ·åï¼‰ 1pctl user-info # æŸ¥çœ‹ 1Panel ç‰ˆæœ¬ä¿¡æ¯ 1pctl version # ä¿®æ”¹ 1Panel ç³»ç»Ÿä¿¡æ¯ 1pctl update # é‡ç½® 1Panel ç³»ç»Ÿä¿¡æ¯ 1pctl reset # æ¢å¤ 1Panel æœåŠ¡åŠæ•°æ® 1pctl restore ä¸‰ã€ğŸ”„ 1pctl reset é‡ç½®å‘½ä»¤ é‡ç½® 1Panel ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬å–æ¶ˆå®‰å…¨å…¥å£ç™»å½•ï¼Œå–æ¶ˆä¸¤æ­¥éªŒè¯ç­‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å–æ¶ˆ 1Panel è®¿é—®åŸŸåç»‘å®š 1pctl reset domain # å–æ¶ˆ 1Panel å®‰å…¨å…¥å£ 1pctl reset entrance # å–æ¶ˆ 1Panel HTTPS æ–¹å¼ç™»å½• 1pctl reset https # å–æ¶ˆ 1Panel æˆæƒ IP é™åˆ¶ 1pctl reset ips # å–æ¶ˆ 1Panel ä¸¤æ­¥éªŒè¯ 1pctl reset mfa å››ã€ğŸŒ 1pctl listen-ip ç›‘å¬ IP å‘½ä»¤ ä¿®æ”¹ 1Panel ç›‘å¬ IPï¼š\n1 2 3 4 5 # ç›‘å¬ IPv4 1pctl listen-ip ipv4 # ç›‘å¬ IPv6 1pctl listen-ip ipv6 äº”ã€ğŸ“ 1pctl update æ›´æ–°å‘½ä»¤ ä¿®æ”¹ 1Panel ç³»ç»Ÿä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 # ä¿®æ”¹é¢æ¿ç”¨æˆ·å 1pctl update username # ä¿®æ”¹é¢æ¿å¯†ç  1pctl update password # ä¿®æ”¹é¢æ¿ç«¯å£ 1pctl update port å…­ã€ğŸ“¦ è®¡åˆ’ä»»åŠ¡ Debian è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 ######## æˆ‘çš„ Debian è®¡åˆ’ä»»åŠ¡ ######## # è¯ä¹¦å¼ºåˆ¶åŒæ­¥ # ğŸ” åŠŸèƒ½ï¼šä¿éšœç½‘ç«™SSLè¯ä¹¦åŠæ—¶æ›´æ–°ï¼Œé¿å…è¯ä¹¦è¿‡æœŸé£é™© /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/ssl/allinssl_nginx_cert_daily.sh | /bin/bash # åŒæ­¥nginxç›®å½• # ğŸ’¾ åŠŸèƒ½ï¼šå…³é”®é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- /etc/nginx/ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æµ‹è¯•/nginx/ # åŒæ­¥nginxç›®å½• # ğŸ’¾ åŠŸèƒ½ï¼šå…³é”®é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- /var/www/html/ /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-æµ‹è¯•/html/ # å¤‡ä»½nginxç›®å½• # ğŸ’¾ åŠŸèƒ½ï¼šå…³é”®é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± # è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºåŸç›®å½•ç»“æ„ï¼‰ # tar -xzvf /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-bak/nginx/nginx_20231201_143022.tar.gz # è§£å‹åˆ°æŒ‡å®šç›®å½• # tar -xzvf /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-bak/nginx/nginx_20231201_143022.tar.gz -C /var/www/new_html/ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/universal_backup.sh) /etc/nginx /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-bak/nginx 7 # å¤‡ä»½htmlç›®å½• # ğŸ’¾ åŠŸèƒ½ï¼šå…³é”®é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± # è§£å‹åˆ°å½“å‰ç›®å½•ï¼ˆä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºåŸç›®å½•ç»“æ„ï¼‰ # tar -xzvf /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-bak/html/html_20231201_143022.tar.gz # è§£å‹åˆ°æŒ‡å®šç›®å½• # tar -xzvf /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-bak/html/html_20231201_143022.tar.gz -C /var/www/new_html/ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/universal_backup.sh) /var/www/html /mnt/smb_fnos/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Debian13/backup/nginx-bak/html 7 FnOS è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 ######## æˆ‘çš„ FnOS è®¡åˆ’ä»»åŠ¡ ######## ## æ›´æ–°hostsæ–‡ä»¶ ## âœ¨ åŠŸèƒ½ï¼šè‡ªåŠ¨æ›´æ–°DNSè§£æï¼Œè§£å†³ç½‘ç»œè®¿é—®é—®é¢˜ /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/hosts/DnsParse.py | python3 - ## åŒæ­¥hostsâ†’emby\u0026amp;nastools ## ğŸ”„ åŠŸèƒ½ï¼šå¤šæœåŠ¡é…ç½®åŒæ­¥ï¼Œä¿æŒç¯å¢ƒä¸€è‡´æ€§ /usr/bin/curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh | /bin/bash -s -- -f /etc/hosts /vol1/1000/compose/emby/config/hosts /vol1/1000/compose/nastools/config/hosts ä¸ƒã€âš™ï¸ å®‰è£…åçš„åˆå§‹è®¾ç½® é¦–æ¬¡è®¿é—®ï¼š å®‰è£…å®Œæˆåï¼Œ1Panel ä¼šæ˜¾ç¤ºè®¿é—®åœ°å€å’Œåˆå§‹å¯†ç  æ‰“å¼€æµè§ˆå™¨è®¿é—®æ˜¾ç¤ºçš„åœ°å€ ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• æ¨èçš„å®‰å…¨è®¾ç½®ï¼š ä¿®æ”¹é»˜è®¤å¯†ç ï¼šç«‹å³ä¿®æ”¹ç®¡ç†å‘˜å¯†ç  é…ç½®å®‰å…¨å…¥å£ï¼šè®¾ç½®å®‰å…¨è®¿é—®è·¯å¾„ å¯ç”¨ HTTPSï¼šé…ç½® SSL è¯ä¹¦åŠ å¯†è®¿é—® è®¾ç½® IP é™åˆ¶ï¼šé™åˆ¶ç®¡ç†ç•Œé¢è®¿é—®IP å…«ã€ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥ 1. æ— æ³•è®¿é—®ç®¡ç†ç•Œé¢ 1 2 3 4 5 6 7 8 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ 1pctl status # æŸ¥çœ‹æœåŠ¡æ—¥å¿— journalctl -u 1panel.service -f # æ£€æŸ¥ç«¯å£å ç”¨ netstat -tlnp | grep :ç«¯å£å· 2. å¿˜è®°ç™»å½•ä¿¡æ¯ 1 2 3 4 5 # æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ 1pctl user-info # é‡ç½®å¯†ç  1pctl update password 3. æœåŠ¡å¯åŠ¨å¤±è´¥ 1 2 3 4 5 6 7 # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ systemctl status 1panel.service # é‡æ–°å®‰è£… 1pctl uninstall curl -sSL https://resource.fit2cloud.com/1panel/package/quick_start.sh -o quick_start.sh sudo bash quick_start.sh 4. ç£ç›˜ç©ºé—´ä¸è¶³ Docker å®¹å™¨å’Œé•œåƒå¯èƒ½ä¼šå ç”¨å¤§é‡ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯æ—¥å¿—æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h # æ¸…ç† Docker æ—¥å¿—ï¼ˆè°¨æ…æ“ä½œï¼‰ # æ‰¾åˆ°å¤§çš„æ—¥å¿—æ–‡ä»¶ï¼Œé€šå¸¸åœ¨ /var/lib/docker/containers/\u0026lt;container_id\u0026gt;/ # æ¸…ç†æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼ˆç¡®ä¿ç›¸å…³å®¹å™¨å·²åœæ­¢æˆ–æ—¥å¿—ä¸å†éœ€è¦ï¼‰ cat /dev/null \u0026gt; /var/lib/docker/containers/\u0026lt;container_id\u0026gt;/\u0026lt;container_id\u0026gt;-json.log # æ¸…ç† Docker èµ„æº docker system prune -a -f 5. MySQL binlog å ç”¨è¿‡å¤§ MySQL çš„ binlog å¯èƒ½ä¼šå ç”¨å¤§é‡ç£ç›˜ç©ºé—´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # è¿›å…¥ MySQL å®¹å™¨ç»ˆç«¯ 1panel é¢æ¿ä¸­è¿›å…¥æ•°æ®åº“å®¹å™¨ç»ˆç«¯æˆ–ä½¿ç”¨å‘½ä»¤ # è¿æ¥ MySQL mysql -u root -p # æŸ¥çœ‹å½“å‰ binlog é…ç½® show variables like \u0026#39;%binlog_expire%\u0026#39;; # è®¾ç½® binlog è¿‡æœŸæ—¶é—´ï¼ˆä¾‹å¦‚è®¾ç½®ä¸º1å¤©ï¼‰ set global binlog_expire_logs_seconds=86400; set persist binlog_expire_logs_seconds=86400; # æ‰‹åŠ¨åˆ·æ–°æ—¥å¿— flush logs; ä¹ã€ğŸ’¾ å¤‡ä»½ä¸æ¢å¤ç­–ç•¥ å¤‡ä»½è„šæœ¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/bash # 1Panel å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup/1panel\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) mkdir -p $BACKUP_DIR/$DATE echo \u0026#34;å¼€å§‹å¤‡ä»½ 1Panel...\u0026#34; # å¤‡ä»½é…ç½®æ–‡ä»¶ tar -czf $BACKUP_DIR/$DATE/config.tar.gz /usr/local/1panel/conf/ # å¤‡ä»½åº”ç”¨æ•°æ® tar -czf $BACKUP_DIR/$DATE/apps.tar.gz /usr/local/1panel/apps/ # è®°å½•å¤‡ä»½ä¿¡æ¯ echo \u0026#34;å¤‡ä»½å®Œæˆæ—¶é—´: $(date)\u0026#34; \u0026gt; $BACKUP_DIR/$DATE/backup_info.txt # åˆ é™¤30å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -type d -mtime +30 -exec rm -rf {} \\; echo \u0026#34;1Panel å¤‡ä»½å®Œæˆ: $BACKUP_DIR/$DATE\u0026#34; æ¢å¤æ­¥éª¤ï¼š åœæ­¢æœåŠ¡ï¼š1pctl stop æ¢å¤å¤‡ä»½æ–‡ä»¶ é‡å¯æœåŠ¡ï¼š1pctl start ğŸ’¾ æ‰‹åŠ¨å¤‡ä»½ï¼š 1panel ç®¡ç†åå°å¤‡ä»½ åŒæ­¥å¤‡ä»½æ–‡ä»¶ è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ç›®å½•ï¼š--mkpath 1 2 rsync -avhz --progress --delete-delay --mkpath /opt/1panel/backup/system_snapshot/ /vol2/1000/backup/1panel/ \u0026amp;\u0026amp; \\ ls /vol2/1000/backup/1panel æ¢å¤å¤‡ä»½æ–‡ä»¶ 1 2 rsync -avhz --progress --delete-delay /vol2/1000/backup/1panel/ /opt/1panel/backup/system_snapshot/ \u0026amp;\u0026amp; \\ ls /opt/1panel/backup/system_snapshot åã€ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. èµ„æºä¼˜åŒ–ï¼š 1 2 3 4 5 6 7 8 # è°ƒæ•´æœåŠ¡èµ„æºé™åˆ¶ # ç¼–è¾‘æœåŠ¡é…ç½®æ–‡ä»¶ nano /etc/systemd/system/1panel.service # æ·»åŠ èµ„æºé™åˆ¶ [Service] MemoryMax=2G CPUQuota=100% 2. æ•°æ®åº“ä¼˜åŒ–ï¼š 1 2 # å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶ find /usr/local/1panel/logs/ -name \u0026#34;*.log\u0026#34; -mtime +7 -delete 3. ç½‘ç»œä¼˜åŒ–ï¼š 1 2 3 4 # è°ƒæ•´ç½‘ç»œå‚æ•° echo \u0026#39;net.core.somaxconn = 1024\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;net.ipv4.tcp_max_syn_backlog = 1024\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p åä¸€ã€ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ 1. ç³»ç»Ÿå®‰å…¨ï¼š 1 2 3 4 5 6 7 8 # å®šæœŸæ›´æ–°ç³»ç»Ÿ apt update \u0026amp;\u0026amp; apt upgrade -y # é…ç½®é˜²ç«å¢™ ufw allow 22/tcp ufw allow 80/tcp ufw allow 443/tcp ufw enable 2. é¢æ¿å®‰å…¨ï¼š 1 2 3 4 5 6 7 8 # å¯ç”¨å®‰å…¨å…¥å£ 1pctl update entrance # é…ç½®IPç™½åå• 1pctl update ips # å¯ç”¨ä¸¤æ­¥éªŒè¯ 1pctl update mfa 3. ç›‘æ§å‘Šè­¦ï¼š 1 2 3 4 5 6 7 # è®¾ç½®èµ„æºç›‘æ§ # å®‰è£…ç›‘æ§å·¥å…· apt install htop iotop iftop -y # è®¾ç½®å®šæ—¶æ£€æŸ¥ crontab -e # æ·»åŠ ï¼š0 * * * * /path/to/monitor_script.sh åäºŒã€ğŸ†˜ æ•…éšœæ¢å¤æŒ‡å— 1. é¢æ¿æ— æ³•å¯åŠ¨ï¼š 1 2 3 4 5 6 # æ£€æŸ¥ä¾èµ–æœåŠ¡ systemctl status docker systemctl status nginx # é‡æ–°å®‰è£…ä¾èµ– apt install --reinstall docker.io nginx -y 2. æ•°æ®åº“é—®é¢˜ï¼š 1 2 3 4 5 # æ£€æŸ¥æ•°æ®åº“è¿æ¥ docker exec -it 1panel-mysql mysql -u root -p # ä¿®å¤æ•°æ®åº“ docker exec -it 1panel-mysql mysqlcheck -u root -p --auto-repair --all-databases 3. ç£ç›˜ç©ºé—´ä¸è¶³ï¼š 1 2 3 4 5 6 7 # æ¸…ç†ç£ç›˜ç©ºé—´ docker system prune -a -f apt autoremove -y apt clean # ä½¿ç”¨ 1Panel çš„ç¼“å­˜æ¸…ç†åŠŸèƒ½ # åœ¨é¢æ¿çš„\u0026#34;å·¥å…·ç®±\u0026#34;ä¸­æ‰¾åˆ°\u0026#34;ç¼“å­˜æ¸…ç†\u0026#34;ï¼Œå¯ä»¥æ¸…ç†ç³»ç»Ÿåƒåœ¾ã€å®¹å™¨åƒåœ¾ã€ä¸´æ—¶æ–‡ä»¶ç­‰ 4. å®¹å™¨ç½‘ç»œé—®é¢˜ å¦‚æœ Docker ç½‘å¡ä¸ç°æœ‰ç½‘ç»œå†²çªï¼ˆä¾‹å¦‚é»˜è®¤çš„ 172.17.x.x ç½‘æ®µï¼‰ï¼š\n1 2 3 # åœ¨ 1Panel é¢æ¿ä¸­ï¼Œè¿›å…¥\u0026#34;å®¹å™¨\u0026#34; -\u0026gt; \u0026#34;ç½‘ç»œ\u0026#34; # åˆ é™¤ç°æœ‰çš„ 1panel-network ç½‘å¡ï¼ˆå¦‚æœæœ‰å†²çªï¼‰ # åˆ›å»ºæ–°çš„ç½‘å¡ï¼Œé€‰æ‹©ä¸å†²çªçš„ç½‘æ®µï¼ˆä¾‹å¦‚ 172.18.0.0/16ï¼‰ é€šè¿‡ä»¥ä¸ŠæŒ‡å—ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç† 1Panel é¢æ¿ï¼Œäº«å—ä¾¿æ·çš„æœåŠ¡å™¨è¿ç»´ä½“éªŒï¼ğŸ› ï¸\næ¸©é¦¨æç¤ºï¼šåœ¨ä½¿ç”¨ 1Panel æ—¶ï¼Œè¯·å®šæœŸè¿›è¡Œå¤‡ä»½å’Œç³»ç»Ÿç»´æŠ¤ï¼Œå…³æ³¨å®˜æ–¹æ›´æ–°ä»¥è·å–æ–°åŠŸèƒ½å’Œå®‰å…¨è¡¥ä¸ã€‚é‡åˆ°é—®é¢˜æ—¶ï¼Œå¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºå¯»æ±‚å¸®åŠ©ã€‚\n","date":"2025-08-26T16:39:39+08:00","image":"https://file.meimolihan.eu.org/img/1panel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/55c5b839/","title":"1Panel é¢æ¿å®‰è£…ä¸å¸è½½æŒ‡å— ğŸ› ï¸"},{"content":"Vercel é¡¹ç›®éƒ¨ç½²å’Œé…ç½®æŒ‡å— ğŸš€ æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Vercel ä¸Šéƒ¨ç½²å’Œé…ç½®é¡¹ç›®ï¼ŒåŒ…å«ä»åˆ›å»ºé¡¹ç›®åˆ°åŸŸåé…ç½®çš„å®Œæ•´æµç¨‹ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ åˆ›å»ºæ–°é¡¹ç›® ğŸ“¦ å¯¼å…¥ Git ä»“åº“ âš™ï¸ é…ç½®æ–°é¡¹ç›® âœ… éƒ¨ç½²æˆåŠŸ ğŸ“Š æŸ¥çœ‹é¡¹ç›®çŠ¶æ€ ğŸŒ æ·»åŠ åŸŸå ğŸ” éªŒè¯ DNS é…ç½® ğŸ¤– è‡ªåŠ¨é…ç½® DNS ğŸ”„ åˆ·æ–° DNS é…ç½® ğŸ‰ ç¡®è®¤é…ç½®æˆåŠŸ ğŸ’¡ é¢å¤–æç¤ºå’Œæœ€ä½³å®è·µ ğŸ› ï¸ æ•…éšœæ’é™¤ ğŸ“š ç›¸å…³èµ„æº ğŸ¯ æ­¥éª¤ 1: åˆ›å»ºæ–°é¡¹ç›® ğŸ“ ç™»å½•åˆ°æ‚¨çš„ Vercel è´¦æˆ· ğŸ–±ï¸ ç‚¹å‡»å³ä¸Šè§’çš„\u0026quot;Add New\u0026hellip;\u0026ldquo;æŒ‰é’® ğŸ“ é€‰æ‹©\u0026quot;Project\u0026rdquo; ğŸ“¦ æ­¥éª¤ 2: å¯¼å…¥ Git ä»“åº“ ğŸ”— åœ¨\u0026quot;Import Git Repository\u0026quot;éƒ¨åˆ†ï¼Œé€‰æ‹©è¦å¯¼å…¥çš„ Git ä»“åº“ ğŸ“¥ ç‚¹å‡»\u0026quot;Import\u0026quot;æŒ‰é’® âš™ï¸ æ­¥éª¤ 3: é…ç½®æ–°é¡¹ç›® ğŸ‘¥ é€‰æ‹© Vercel å›¢é˜Ÿå’Œé¡¹ç›®åç§° ğŸ—ï¸ é€‰æ‹©æ¡†æ¶é¢„è®¾ï¼ˆå¦‚æœæœ‰éœ€è¦ï¼‰ï¼Œå¹¶è®¾ç½®æ ¹ç›®å½• ğŸš€ ç‚¹å‡»\u0026quot;Deploy\u0026quot;æŒ‰é’®å¼€å§‹éƒ¨ç½² âœ… æ­¥éª¤ 4: éƒ¨ç½²æˆåŠŸ ğŸŠ éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªæˆåŠŸæ¶ˆæ¯ ğŸ“‹ ç‚¹å‡»\u0026quot;Continue to Dashboard\u0026quot;æŒ‰é’®ï¼Œè¿›å…¥é¡¹ç›®ä»ªè¡¨æ¿ ğŸ“Š æ­¥éª¤ 5: æŸ¥çœ‹é¡¹ç›®çŠ¶æ€ ğŸ“ˆ åœ¨é¡¹ç›®ä»ªè¡¨æ¿ä¸­ï¼Œç‚¹å‡»\u0026quot;Domains\u0026quot;é€‰é¡¹å¡ ğŸ‘€ æŸ¥çœ‹å·²é…ç½®çš„åŸŸåå’Œéƒ¨ç½²çŠ¶æ€ ğŸŒ æ­¥éª¤ 6: æ·»åŠ åŸŸå âš™ï¸ åœ¨é¡¹ç›®è®¾ç½®ä¸­ï¼Œç‚¹å‡»\u0026quot;Domains\u0026quot;é€‰é¡¹å¡ â• ç‚¹å‡»\u0026quot;Add Domain\u0026quot;æŒ‰é’® ğŸ”¤ è¾“å…¥è¦æ·»åŠ çš„åŸŸåï¼Œä¾‹å¦‚ nginx-file.meimoli.han.eu.org ğŸŒ é€‰æ‹©è¿æ¥åˆ°çš„ç¯å¢ƒï¼ˆä¾‹å¦‚\u0026quot;Production\u0026quot;ï¼‰ ğŸ’¾ ç‚¹å‡»\u0026quot;Save\u0026quot;æŒ‰é’®ä¿å­˜é…ç½® ğŸ” æ­¥éª¤ 7: éªŒè¯ DNS é…ç½® âš ï¸ åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­ï¼Œç‚¹å‡»\u0026quot;Invalid Configuration\u0026quot;é“¾æ¥ ğŸ“ æŸ¥çœ‹éœ€è¦åœ¨ DNS æä¾›å•†å¤„æ·»åŠ çš„ DNS è®°å½• ğŸŒ ç™»å½•åˆ°æ‚¨çš„ DNS æä¾›å•†ï¼ˆä¾‹å¦‚ Cloudflareï¼‰ï¼Œæ·»åŠ ç›¸åº”çš„ DNS è®°å½• âœ… å®Œæˆ DNS è®°å½•æ·»åŠ åï¼Œç‚¹å‡»\u0026quot;æˆæƒ\u0026quot;æŒ‰é’® ğŸ¤– æ­¥éª¤ 8: è‡ªåŠ¨é…ç½® DNS âš¡ åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­ï¼Œç‚¹å‡»\u0026quot;Configure Automatically\u0026quot;æŒ‰é’® ğŸ”„ Vercel å°†è‡ªåŠ¨é…ç½® DNS è®°å½• ğŸ”„ æ­¥éª¤ 9: åˆ·æ–° DNS é…ç½® â³ ç­‰å¾… DNS è®°å½•ç”Ÿæ•ˆï¼ˆé€šå¸¸éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ ğŸ”ƒ åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­ï¼Œç‚¹å‡»\u0026quot;Refresh\u0026quot;æŒ‰é’®ï¼Œåˆ·æ–° DNS é…ç½® ğŸ‰ æ­¥éª¤ 10: ç¡®è®¤é…ç½®æˆåŠŸ âœ”ï¸ ç¡®è®¤ nginx-file.meimoli.han.eu.org å’Œ index-ten-plvvercel.app çš„é…ç½®çŠ¶æ€ä¸º\u0026quot;Valid Configuration\u0026quot; ğŸŒŸ ç¡®ä¿ä¸¤ä¸ªåŸŸåéƒ½å·²æ­£ç¡®é…ç½®å¹¶æŒ‡å‘ç”Ÿäº§ç¯å¢ƒ ğŸ’¡ é¢å¤–æç¤ºå’Œæœ€ä½³å®è·µ 1. ğŸ”§ ç¯å¢ƒå˜é‡é…ç½® åœ¨é¡¹ç›®è®¾ç½®ä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼š\n1 2 3 # åœ¨é¡¹ç›®è®¾ç½®çš„ Environment Variables ä¸­æ·»åŠ  API_KEY=your_api_key_here DATABASE_URL=your_database_url_here 2. ğŸ› ï¸ è‡ªå®šä¹‰æ„å»ºè®¾ç½® åœ¨ vercel.json ä¸­é…ç½®æ„å»ºé€‰é¡¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 { \u0026#34;build\u0026#34;: { \u0026#34;env\u0026#34;: { \u0026#34;NODE_ENV\u0026#34;: \u0026#34;production\u0026#34; } }, \u0026#34;routes\u0026#34;: [ { \u0026#34;src\u0026#34;: \u0026#34;/(.*)\u0026#34;, \u0026#34;dest\u0026#34;: \u0026#34;/index.html\u0026#34; } ] } 3. ğŸ‘ï¸ éƒ¨ç½²é¢„è§ˆ æ¯ä¸ª Git åˆ†æ”¯çš„ Pull Request éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºé¢„è§ˆéƒ¨ç½²ï¼š\nğŸŒ¿ åŠŸèƒ½åˆ†æ”¯ â†’ é¢„è§ˆéƒ¨ç½² ğŸ¯ main åˆ†æ”¯ â†’ ç”Ÿäº§éƒ¨ç½² 4. âš¡ æ€§èƒ½ä¼˜åŒ– ğŸš€ å¯ç”¨è‡ªåŠ¨ä¼˜åŒ–åŠŸèƒ½ ğŸ’¾ é…ç½®åˆé€‚çš„ç¼“å­˜ç­–ç•¥ ğŸ“Š ä½¿ç”¨ Vercel Analytics ç›‘æ§æ€§èƒ½ ğŸ› ï¸ æ•…éšœæ’é™¤ 1. ğŸŒ DNS é…ç½®é—®é¢˜ å¦‚æœåŸŸåéªŒè¯å¤±è´¥ï¼š\nğŸ” æ£€æŸ¥ DNS è®°å½•æ˜¯å¦æ­£ç¡®æ·»åŠ  ğŸ“¡ ç¡®è®¤ DNS è®°å½•å·²ä¼ æ’­ï¼ˆä½¿ç”¨ dig æˆ–åœ¨çº¿ DNS æ£€æŸ¥å·¥å…·ï¼‰ â° ç­‰å¾… DNS ç¼“å­˜åˆ·æ–°ï¼ˆæœ€å¤š 24-48 å°æ—¶ï¼‰ 2. âŒ æ„å»ºå¤±è´¥ æ£€æŸ¥æ„å»ºæ—¥å¿—ï¼š\nğŸ“‹ åœ¨ Vercel ä»ªè¡¨æ¿ä¸­æŸ¥çœ‹éƒ¨ç½²è¯¦æƒ… ğŸ› ï¸ æ£€æŸ¥ vercel.json é…ç½®æ˜¯å¦æ­£ç¡® ğŸ”‘ éªŒè¯ç¯å¢ƒå˜é‡é…ç½® 3. ğŸ”’ è‡ªå®šä¹‰åŸŸå SSL è¯ä¹¦é—®é¢˜ SSL è¯ä¹¦é€šå¸¸ä¼šè‡ªåŠ¨ç­¾å‘ï¼Œå¦‚æœé‡åˆ°é—®é¢˜ï¼š\nâœ… ç¡®è®¤åŸŸåå·²æ­£ç¡®æŒ‡å‘ Vercel ğŸ“‹ æ£€æŸ¥åŸŸåéªŒè¯çŠ¶æ€ ğŸ“ è”ç³» Vercel æ”¯æŒå¦‚æœéœ€è¦æ‰‹åŠ¨ç­¾å‘ ğŸ“š ç›¸å…³èµ„æº ğŸ“– Vercel å®˜æ–¹æ–‡æ¡£ ğŸŒ è‡ªå®šä¹‰åŸŸåæŒ‡å— ğŸ”§ ç¯å¢ƒå˜é‡é…ç½® âš™ï¸ éƒ¨ç½²é…ç½®å‚è€ƒ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²æˆåŠŸåœ¨ Vercel ä¸Šéƒ¨ç½²å¹¶é…ç½®äº†é¡¹ç›®ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½®çš„åŸŸåè®¿é—®æ‚¨çš„é¡¹ç›®äº†ï¼ğŸš€\nâ¬†ï¸ è¿”å›é¡¶éƒ¨ ğŸ”¼\n","date":"2025-08-26T16:37:20+08:00","image":"https://file.meimolihan.eu.org/img/vercel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/82e7c500/","title":"Vercel é¡¹ç›®éƒ¨ç½²å’Œé…ç½®æŒ‡å— ğŸš€"},{"content":"Docker å®¹å™¨ç®¡ç†æŒ‡å— ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ” å®¹å™¨æŸ¥çœ‹å‘½ä»¤ âš¡ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† ğŸ“‹ å®¹å™¨æ—¥å¿—ä¸è¯Šæ–­ ğŸ§¹ æ‰¹é‡å®¹å™¨ç®¡ç† ğŸš€ é«˜çº§å®¹å™¨æ“ä½œ ğŸ› ï¸ å®ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ’¡ å¸¸ç”¨å‘½ä»¤ç»„åˆ ğŸ” å®¹å™¨æŸ¥çœ‹å‘½ä»¤ 1. ğŸ‘€ æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ ID å’Œåç§° 1 docker ps --format \u0026#39;{{.ID}}: {{.Names}}\u0026#39; 2. ğŸ“¦ æŸ¥çœ‹å·²åœæ­¢çš„å®¹å™¨ ID å’Œåç§° 1 docker ps -a --filter \u0026#34;status=exited\u0026#34; --format \u0026#34;{{.ID}} {{.Names}}\u0026#34; 3. ğŸ“Š æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆç®€æ´æ ¼å¼ï¼‰ 1 docker ps -a --format \u0026#34;table {{.ID}}\\t{{.Names}}\\t{{.Status}}\\t{{.Ports}}\u0026#34; 4. ğŸ” æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ 1 2 3 4 5 # æŸ¥çœ‹ç‰¹å®šå®¹å™¨ä¿¡æ¯ docker inspect mytest # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker stats mytest âš¡ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 1. â¹ï¸ åœæ­¢å®¹å™¨ 1 2 3 4 5 # åœæ­¢æŒ‡å®šå®¹å™¨ docker stop mytest # ä¼˜é›…åœæ­¢ï¼ˆç»™äºˆä¸€å®šæ—¶é—´å®Œæˆå¤„ç†ï¼‰ docker stop -t 30 mytest 2. â–¶ï¸ å¯åŠ¨/é‡å¯å®¹å™¨ 1 2 3 4 5 6 7 8 # å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ docker start mytest # é‡å¯å®¹å™¨ docker restart mytest # å¼ºåˆ¶é‡å¯å®¹å™¨ docker restart -t 0 mytest 3. â¸ï¸ æš‚åœ/æ¢å¤å®¹å™¨ 1 2 3 4 5 # æš‚åœå®¹å™¨è¿è¡Œ docker pause mytest # æ¢å¤æš‚åœçš„å®¹å™¨ docker unpause mytest ğŸ“‹ å®¹å™¨æ—¥å¿—ä¸è¯Šæ–­ 1. ğŸ“ æŸ¥çœ‹å®¹å™¨æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æœ€æ–°æ—¥å¿— docker logs mytest # å®æ—¶è·Ÿè¸ªæ—¥å¿—è¾“å‡º docker logs -f mytest # æŸ¥çœ‹æœ€åNè¡Œæ—¥å¿— docker logs --tail 100 mytest # æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— docker logs -t mytest 2. ğŸ” è¿›å…¥å®¹å™¨å†…éƒ¨ 1 2 3 4 5 6 7 8 # ä½¿ç”¨ bash è¿›å…¥å®¹å™¨ docker exec -it mytest bash # ä½¿ç”¨ sh è¿›å…¥å®¹å™¨ docker exec -it mytest sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå•æ¡å‘½ä»¤ docker exec mytest ls -la /app ğŸ’¡ æç¤ºï¼šä½¿ç”¨ Ctrl+D æˆ–è¾“å…¥ exit é€€å‡ºå®¹å™¨\nğŸ§¹ æ‰¹é‡å®¹å™¨ç®¡ç† 1. â¹ï¸ åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ 1 docker stop $(docker ps -q) 2. ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ 1 2 3 4 5 # å®‰å…¨åˆ é™¤ï¼ˆéœ€è¦ç¡®è®¤ï¼‰ docker container prune # å¼ºåˆ¶åˆ é™¤ï¼ˆæ— éœ€ç¡®è®¤ï¼‰ docker container prune -f 3. ğŸ”§ åˆ é™¤ç‰¹å®šå®¹å™¨ 1 2 3 4 5 6 7 8 # åˆ é™¤å·²åœæ­¢çš„å®¹å™¨ docker rm mytest # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ docker rm -f mytest # åˆ é™¤å®¹å™¨å¹¶åŒæ—¶åˆ é™¤å…³è”çš„åŒ¿åå· docker rm -v mytest 4. ğŸ§½ æ¸…ç†æ‰€æœ‰æ— ç”¨èµ„æº 1 2 3 4 5 # åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ã€æœªä½¿ç”¨çš„ç½‘ç»œã€æ‚¬ç©ºé•œåƒ docker system prune # åŒ…æ‹¬æœªä½¿ç”¨çš„å· docker system prune --volumes ğŸš€ é«˜çº§å®¹å™¨æ“ä½œ 1. ğŸ“Š å®¹å™¨èµ„æºé™åˆ¶ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats # é™åˆ¶å®¹å™¨å†…å­˜ä½¿ç”¨ docker run -d --name myapp --memory=512m nginx # é™åˆ¶CPUä½¿ç”¨ docker run -d --name myapp --cpus=1.5 nginx 2. ğŸŒ å®¹å™¨ç½‘ç»œç®¡ç† 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å®¹å™¨ç½‘ç»œä¿¡æ¯ docker network ls # æŸ¥çœ‹å®¹å™¨ç«¯å£æ˜ å°„ docker port mytest # åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ docker network create my-network 3. ğŸ“ å®¹å™¨æ–‡ä»¶æ“ä½œ 1 2 3 4 5 # ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°ä¸»æœº docker cp mytest:/app/config.conf ./local-config.conf # ä»ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨ docker cp ./local-file.txt mytest:/app/file.txt ğŸ› ï¸ å®ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ 1. â¤ï¸ å®¹å™¨å¥åº·æ£€æŸ¥ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€ docker inspect --format=\u0026#39;{{json .State.Health}}\u0026#39; mytest # è¿è¡Œå¸¦æœ‰å¥åº·æ£€æŸ¥çš„å®¹å™¨ docker run -d --name healthy-app \\ --health-cmd=\u0026#34;curl -f http://localhost || exit 1\u0026#34; \\ --health-interval=30s \\ nginx 2. ğŸ“ˆ å®¹å™¨èµ„æºç›‘æ§ 1 2 3 4 5 # å®æ—¶ç›‘æ§å®¹å™¨èµ„æº docker stats --format \u0026#34;table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\\t{{.NetIO}}\u0026#34; # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect mytest | grep -E \u0026#39;(IPAddress|MacAddress|Gateway)\u0026#39; 3. ğŸ’¾ å®¹å™¨å¤‡ä»½ä¸è¿ç§» 1 2 3 4 5 6 7 8 # å°†å®¹å™¨æäº¤ä¸ºé•œåƒ docker commit mytest my-backup-image # å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿ docker export mytest \u0026gt; mytest-container.tar # å¯¼å…¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ docker import mytest-container.tar my-imported-image âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ›¡ï¸ è°¨æ…ä½¿ç”¨ç‰¹æƒå®¹å™¨\n1 2 # é¿å…ä¸å¿…è¦çš„ç‰¹æƒæ¨¡å¼ # docker run --privileged myapp # è°¨æ…ä½¿ç”¨ï¼ ğŸ” é™åˆ¶å®¹å™¨æƒé™\n1 2 # ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨ docker run -d --user 1000:1000 myapp ğŸ”„ å®šæœŸæ›´æ–°å®¹å™¨é•œåƒ\n1 2 3 4 # æ‹‰å–æœ€æ–°é•œåƒå¹¶é‡å»ºå®¹å™¨ docker pull nginx:latest docker stop myapp \u0026amp;\u0026amp; docker rm myapp docker run -d --name myapp nginx:latest ğŸ’¡ å¸¸ç”¨å‘½ä»¤ç»„åˆ ğŸ”„ å¿«é€Ÿé‡å¯å®¹å™¨ 1 docker restart mytest \u0026amp;\u0026amp; docker logs -f mytest ğŸ“¦ æ‰¹é‡æ“ä½œå¤šä¸ªå®¹å™¨ 1 2 # æ‰¹é‡å¯åŠ¨åŒ¹é…åç§°çš„å®¹å™¨ docker ps -a --filter \u0026#34;name=app\u0026#34; --format \u0026#34;{{.Names}}\u0026#34; | xargs -I {} docker start {} ğŸ“Š å®¹å™¨çŠ¶æ€ç›‘æ§è„šæœ¬ 1 2 3 #!/bin/bash # ç›‘æ§å®¹å™¨çŠ¶æ€ watch -n 5 \u0026#39;docker ps --format \u0026#34;table {{.Names}}\\t{{.Status}}\\t{{.Ports}}\u0026#34;\u0026#39; é€šè¿‡æŒæ¡è¿™äº› Docker å®¹å™¨ç®¡ç†å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç®¡ç†å’Œç»´æŠ¤å®¹å™¨åŒ–åº”ç”¨ï¼ğŸ³ğŸš€\n","date":"2025-08-26T16:13:41+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/192fae04/","title":"Docker å®¹å™¨ç®¡ç†æŒ‡å— ğŸ³"},{"content":"Docker é•œåƒç®¡ç†æŒ‡å— ğŸ³ ğŸ“¦ æŒæ¡ Docker é•œåƒçš„æŸ¥çœ‹ã€æ¸…ç†å’Œä¼˜åŒ–æŠ€å·§ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œæå‡å®¹å™¨æ•ˆç‡\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ” é•œåƒæŸ¥çœ‹å‘½ä»¤ ğŸ—‘ï¸ é•œåƒåˆ é™¤æ“ä½œ ğŸ“Š ç©ºé—´ç®¡ç† ğŸ§¹ æ¸…ç†ä¸ä¼˜åŒ– ğŸ“ æ—¥å¿—ç®¡ç† âš¡ å¿«é€Ÿå‚è€ƒ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ” é•œåƒæŸ¥çœ‹å‘½ä»¤ ğŸ‘€ æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ docker images # æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼ˆåŒ…å«ä¸­é—´é•œåƒï¼‰ docker images -a # æ ¼å¼åŒ–è¾“å‡ºé•œåƒä¿¡æ¯ docker images --format \u0026#34;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; # æŒ‰æ—¶é—´æ’åºæ˜¾ç¤ºé•œåƒ docker images --sort=created ğŸ” é•œåƒç­›é€‰ä¸æœç´¢ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ç‰¹å®šä»“åº“çš„é•œåƒ docker images ubuntu # ä½¿ç”¨è¿‡æ»¤å™¨æŸ¥æ‰¾é•œåƒ docker images --filter \u0026#34;reference=nginx:*\u0026#34; # æŸ¥æ‰¾ç‰¹å®šæ ‡ç­¾çš„é•œåƒ docker images --filter \u0026#34;label=version=latest\u0026#34; # æŸ¥çœ‹æ‚¬ç©ºé•œåƒï¼ˆæ— æ ‡ç­¾é•œåƒï¼‰ docker images --filter \u0026#34;dangling=true\u0026#34; ğŸ—‘ï¸ é•œåƒåˆ é™¤æ“ä½œ âŒ åˆ é™¤å•ä¸ªé•œåƒ 1 2 3 4 5 6 7 8 9 10 11 # é€šè¿‡é•œåƒIDåˆ é™¤ docker rmi abcdef123456 # é€šè¿‡ä»“åº“åå’Œæ ‡ç­¾åˆ é™¤ docker rmi nginx:latest # å¼ºåˆ¶åˆ é™¤é•œåƒï¼ˆå³ä½¿æœ‰å®¹å™¨åœ¨ä½¿ç”¨ï¼‰ docker rmi -f nginx:latest # åˆ é™¤å¤šä¸ªæŒ‡å®šé•œåƒ docker rmi redis:alpine mysql:8.0 ğŸ§¹ æ‰¹é‡åˆ é™¤æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 # åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ docker image prune # å¼ºåˆ¶åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒï¼ˆæ— éœ€ç¡®è®¤ï¼‰ docker image prune -f # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼ˆåŒ…æ‹¬æœ‰æ ‡ç­¾ä½†æœªä½¿ç”¨çš„ï¼‰ docker image prune -a # å¼ºåˆ¶åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ docker image prune -af ğŸ“Š ç©ºé—´ç®¡ç† ğŸ’¾ æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹Dockerç£ç›˜ä½¿ç”¨æ¦‚å†µ docker system df # è¯¦ç»†æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ docker system df -v # å®æ—¶ç›‘æ§ç£ç›˜ä½¿ç”¨ watch -n 5 docker system df ğŸ“ˆ ç£ç›˜ä½¿ç”¨æŠ¥å‘Šè§£è¯» ç±»å‹ï¼ˆTYPEï¼‰ æ€»æ•°ï¼ˆTOTALï¼‰ æ´»åŠ¨æ•°ï¼ˆACTIVEï¼‰ å ç”¨ç©ºé—´ï¼ˆSIZEï¼‰ å¯å›æ”¶ç©ºé—´ï¼ˆRECLAIMABLEï¼‰ ğŸ–¼ï¸ Imagesï¼ˆé•œåƒï¼‰ 28 17 10.71GB 4.376GB (40%) ğŸ³ Containersï¼ˆå®¹å™¨ï¼‰ 17 17 569MB 0B (0%) ğŸ’¾ Local Volumesï¼ˆæœ¬åœ°å·ï¼‰ 3 0 0B 0B ğŸ”¨ Build Cacheï¼ˆæ„å»ºç¼“å­˜ï¼‰ 0 0 0B 0B ğŸ“‰ ç©ºé—´åˆ†æå‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æœ€å¤§çš„é•œåƒ docker images --format \u0026#34;table {{.Size}}\\t{{.Repository}}\u0026#34; | sort -hr # æŸ¥çœ‹å„é•œåƒçš„è¯¦ç»†å¤§å° docker system df -v | grep -A 10 \u0026#34;Images space usage:\u0026#34; # è®¡ç®—é•œåƒæ€»å¤§å° docker images -q | xargs docker inspect --format=\u0026#39;{{.Size}}\u0026#39; | awk \u0026#39;{sum+=$1} END {print sum/1024/1024\u0026#34; MB\u0026#34;}\u0026#39; ğŸ§¹ æ¸…ç†ä¸ä¼˜åŒ– ğŸ—‚ï¸ ç³»ç»Ÿçº§æ¸…ç† 1 2 3 4 5 6 7 8 # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„Dockerå¯¹è±¡ï¼ˆé•œåƒã€å®¹å™¨ã€ç½‘ç»œã€æ„å»ºç¼“å­˜ï¼‰ docker system prune # å¼ºåˆ¶æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„Dockerå¯¹è±¡ docker system prune -f # æ¸…ç†åŒ…æ‹¬å·åœ¨å†…çš„æ‰€æœ‰æœªä½¿ç”¨å¯¹è±¡ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰ docker system prune --volumes -f â° å®šæ—¶æ¸…ç†ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºæ¯æ—¥è‡ªåŠ¨æ¸…ç†è„šæœ¬ #!/bin/bash # docker-cleanup.sh echo \u0026#34;$(date): Starting Docker cleanup\u0026#34; \u0026gt;\u0026gt; /var/log/docker-cleanup.log docker image prune -af \u0026gt;\u0026gt; /var/log/docker-cleanup.log 2\u0026gt;\u0026amp;1 docker system prune -f \u0026gt;\u0026gt; /var/log/docker-cleanup.log 2\u0026gt;\u0026amp;1 echo \u0026#34;$(date): Cleanup completed\u0026#34; \u0026gt;\u0026gt; /var/log/docker-cleanup.log # æ·»åŠ cronä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†ï¼‰ # 0 2 * * * /path/to/docker-cleanup.sh ğŸ“ æ—¥å¿—ç®¡ç† ğŸ“‹ æ¸…ç†æ—¥å¿—è®°å½• 1 2 3 4 # åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶æ¸…ç†æ‚¬ç©ºé•œåƒï¼Œè®°å½•æ—¥å¿— mkdir -pm 755 /mnt/docker-rmi-log \u0026amp;\u0026amp; \\ docker image prune --force --filter \u0026#34;dangling=true\u0026#34; \u0026gt; \\ \u0026#34;/mnt/docker-rmi-log/$(date +\u0026#39;%Y-%m-%d\u0026#39;)_docker_rmi.log\u0026#34; ğŸ” æŸ¥çœ‹æ¸…ç†å†å² 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æœ€è¿‘çš„æ¸…ç†æ—¥å¿— ls -lt /mnt/docker-rmi-log/*_docker_rmi.log | head -5 # æŸ¥çœ‹æœ€è¿‘5ä¸ªæ—¥å¿—æ–‡ä»¶çš„å†…å®¹ ls -lt /mnt/docker-rmi-log/*_docker_rmi.log | head -5 | awk \u0026#39;{print $9}\u0026#39; | xargs cat # ç»Ÿè®¡æ¸…ç†çš„é•œåƒæ•°é‡ grep \u0026#34;Total reclaimed space\u0026#34; /mnt/docker-rmi-log/*.log # æŸ¥çœ‹ä»Šæ—¥æ¸…ç†æƒ…å†µ cat \u0026#34;/mnt/docker-rmi-log/$(date +\u0026#39;%Y-%m-%d\u0026#39;)_docker_rmi.log\u0026#34; âš¡ å¿«é€Ÿå‚è€ƒ ğŸ¯ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ æ“ä½œ å‘½ä»¤ è¯´æ˜ æŸ¥çœ‹é•œåƒ docker images åˆ—å‡ºæœ¬åœ°é•œåƒ åˆ é™¤é•œåƒ docker rmi \u0026lt;image\u0026gt; åˆ é™¤æŒ‡å®šé•œåƒ å¼ºåˆ¶åˆ é™¤ docker rmi -f \u0026lt;image\u0026gt; å¼ºåˆ¶åˆ é™¤é•œåƒ æ‹‰å–é•œåƒ docker pull \u0026lt;image:tag\u0026gt; ä»ä»“åº“æ‹‰å–é•œåƒ æŸ¥çœ‹ç©ºé—´ docker system df æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ æ¸…ç†æ‚¬ç©º docker image prune æ¸…ç†æ‚¬ç©ºé•œåƒ å…¨é¢æ¸…ç† docker system prune æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨å¯¹è±¡ ğŸ”„ å·¥ä½œæµç¨‹ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. æŸ¥çœ‹å½“å‰é•œåƒçŠ¶æ€ docker images # 2. æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ docker system df # 3. æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -f # 4. åˆ é™¤ç‰¹å®šä¸å†ä½¿ç”¨çš„é•œåƒ docker rmi old-image:tag # 5. éªŒè¯æ¸…ç†ç»“æœ docker system df -v âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”´ é‡è¦è­¦å‘Š ğŸ’€ æ•°æ®ä¸¢å¤±é£é™©\n1 2 # --force å‚æ•°ä¼šå¼ºåˆ¶åˆ é™¤ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤± # åˆ é™¤å‰åŠ¡å¿…ç¡®è®¤é•œåƒä¸å†éœ€è¦ ğŸ³ å®¹å™¨ä¾èµ–æ£€æŸ¥\n1 2 3 4 5 # åˆ é™¤é•œåƒå‰æ£€æŸ¥æ˜¯å¦æœ‰å®¹å™¨åœ¨ä½¿ç”¨ docker ps -a --filter \u0026#34;ancestor=image-name\u0026#34; # æŸ¥çœ‹é•œåƒçš„ä½¿ç”¨æƒ…å†µ docker image inspect --format=\u0026#39;{{.RepoTags}} {{.Containers}}\u0026#39; image-id ğŸ“¦ ç”Ÿäº§ç¯å¢ƒè°¨æ…æ“ä½œ\n1 2 3 4 # åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œåˆ é™¤æ“ä½œå‰ï¼š # 1. å¤‡ä»½é‡è¦é•œåƒ # 2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ # 3. é€‰æ‹©ç»´æŠ¤çª—å£æœŸæ“ä½œ ğŸ›¡ï¸ å®‰å…¨å»ºè®® âœ… å®šæœŸæ¸…ç†è®¡åˆ’\n1 2 # å»ºè®®æ¯å‘¨æ‰§è¡Œä¸€æ¬¡æ¸…ç† # é¿å…ç£ç›˜ç©ºé—´ä¸è¶³é—®é¢˜ ğŸ“‹ æ—¥å¿—è®°å½•é‡è¦æ€§\n1 2 # æ‰€æœ‰æ¸…ç†æ“ä½œéƒ½åº”è®°å½•æ—¥å¿— # ä¾¿äºå®¡è®¡å’Œé—®é¢˜æ’æŸ¥ ğŸ” æ¸…ç†å‰æ£€æŸ¥\n1 2 # æ‰§è¡Œæ¸…ç†å‰å…ˆä½¿ç”¨dry-runæ¨¡å¼ docker image prune --dry-run ğŸ’¡ ä¸“ä¸šæç¤ºï¼šå®šæœŸæ¸…ç†Dockeré•œåƒä¸ä»…å¯ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œè¿˜èƒ½æé«˜é•œåƒæ‹‰å–å’Œå®¹å™¨å¯åŠ¨çš„é€Ÿåº¦ã€‚å»ºè®®å»ºç«‹è‡ªåŠ¨åŒ–çš„æ¸…ç†æœºåˆ¶ï¼Œä½†åŠ¡å¿…è°¨æ…æ“ä½œï¼Œé¿å…è¯¯åˆ é‡è¦é•œåƒã€‚\n","date":"2025-08-26T16:13:09+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/779f7ff0/","title":"Docker é•œåƒç®¡ç†æŒ‡å— ğŸ³"},{"content":"Git SSH è¿æ¥å¯†é’¥é…ç½®æŒ‡å— ğŸ”‘ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ“– æ–‡ç« ç®€ä»‹ ğŸš€ Gitee æ·»åŠ  SSH è¿æ¥å¯†é’¥ 1. âš™ï¸ Git å…¨å±€è®¾ç½® 2. ğŸ”‘ ç”Ÿæˆ Gitee RSA å¯†é’¥ 3. ğŸ“‹ å¤åˆ¶ Gitee å¯†é’¥åˆ°å‰ªåˆ‡æ¿ 4. ğŸ“ åˆ›å»º Gitee èº«ä»½éªŒè¯é…ç½®æ–‡ä»¶ 5. ğŸ” æ·»åŠ  Gitee çš„ä¸»æœºå¯†é’¥ 6. âœ… éªŒè¯ Gitee è¿æ¥ 7. ğŸ‘€ æŸ¥çœ‹å†™å…¥æ˜¯å¦æˆåŠŸ ğŸ™ GitHub æ·»åŠ  SSH è¿æ¥å¯†é’¥ 1. âš™ï¸ Git å…¨å±€è®¾ç½® 2. ğŸ”‘ ç”Ÿæˆ GitHub RSA å¯†é’¥ 3. ğŸ“‹ å¤åˆ¶ GitHub å¯†é’¥åˆ°å‰ªåˆ‡æ¿ 4. ğŸ“ åˆ›å»º GitHub èº«ä»½éªŒè¯é…ç½®æ–‡ä»¶ 5. ğŸ” æ·»åŠ  GitHub çš„ä¸»æœºå¯†é’¥ 6. âœ… éªŒè¯ GitHub è¿æ¥ 7. ğŸ‘€ æŸ¥çœ‹å†™å…¥æ˜¯å¦æˆåŠŸ ğŸ”§ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ’¡ æœ€ä½³å®è·µ ğŸ“– æ–‡ç« ç®€ä»‹ æœ¬æ–‡æ˜¯ä¸€ä»½è¯¦ç»†çš„ Git SSH å¯†é’¥é…ç½®æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨ Gitee å’Œ GitHub å¹³å°ä¸Šè®¾ç½®å®‰å…¨çš„ SSH è¿æ¥ã€‚é€šè¿‡æ¸…æ™°çš„æ­¥éª¤è¯´æ˜å’Œå‘½ä»¤ç¤ºä¾‹ï¼Œæ‚¨å°†å­¦ä¼šå¦‚ä½•ç”Ÿæˆå¯†é’¥ã€é…ç½® SSH è¿æ¥ä»¥åŠéªŒè¯è¿æ¥çŠ¶æ€ï¼Œä»è€Œå®ç°æ— éœ€å¯†ç çš„ä¾¿æ· Git æ“ä½œã€‚\nğŸš€ Gitee æ·»åŠ  SSH è¿æ¥å¯†é’¥ 1. âš™ï¸ Git å…¨å±€è®¾ç½® (Git Bash å‘½ä»¤) 1 2 git config --global user.name \u0026#34;meimolihan\u0026#34; # è®¾ç½®ç”¨æˆ·å git config --global user.email \u0026#34;meimolihan@gmail.com\u0026#34; # è®¾ç½®ç”¨æˆ·é‚®ç®± 2. ğŸ”‘ ç”Ÿæˆ Gitee RSA å¯†é’¥ï¼ˆ4096 ä½ï¼‰(Git Bash å‘½ä»¤) æ·»åŠ æ³¨é‡Šï¼š-C \u0026quot;æ³¨é‡Š\u0026quot; æ³¨é‡Šç¤ºä¾‹ï¼šssh-keygen -t rsa -b 4096 -C \u0026quot;æ³¨é‡Š\u0026quot; -f ~/.ssh/id_rsa_gitee 1 ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa_gitee ğŸ’¡ æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œç³»ç»Ÿä¼šæç¤ºä½ ï¼š\nè¾“å…¥å¯†é’¥çš„å¯†ç ï¼ˆç›´æ¥å›è½¦è·³è¿‡ï¼‰ ç¡®è®¤å¯†ç ï¼ˆç›´æ¥å›è½¦è·³è¿‡ï¼‰ 3. ğŸ“‹ å¤åˆ¶ Gitee å¯†é’¥åˆ°å‰ªåˆ‡æ¿ Windows ç³»ç»Ÿ (CMD å‘½ä»¤) 1 cat ~/.ssh/id_rsa_gitee.pub | clip.exe Linux ç³»ç»Ÿ 1 cat ~/.ssh/id_rsa_gitee.pub ç™»å½• Gitee ï¼Œè¿›å…¥ã€Œè®¾ç½®ã€â†’ã€ŒSSH å…¬é’¥ã€ï¼Œæ·»åŠ åˆšæ‰å¤åˆ¶çš„å…¬é’¥ã€‚\n4. ğŸ“ åˆ›å»º Gitee èº«ä»½éªŒè¯é…ç½®æ–‡ä»¶ (Git Bash å‘½ä»¤) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p ~/.ssh \u0026amp;\u0026amp; \\ chmod 700 ~/.ssh \u0026amp;\u0026amp; \\ cat \u0026gt; ~/.ssh/config \u0026lt;\u0026lt; EOF Host github.com User git # ç”¨äºè¿æ¥çš„ç”¨æˆ·å IdentityFile ~/.ssh/id_rsa_github # æŒ‡å®šç§é’¥æ–‡ä»¶è·¯å¾„ Hostname ssh.github.com # ç”¨äº SSH è¿æ¥çš„ç‰¹å®šä¸»æœºå Port 443 # æŒ‡å®šè¿æ¥æ—¶çš„ç«¯å£å· Host gitee.com User git # ç”¨äºè¿æ¥çš„ç”¨æˆ·å IdentityFile ~/.ssh/id_rsa_gitee # æŒ‡å®šç§é’¥æ–‡ä»¶è·¯å¾„ IdentitiesOnly yes # ä»…ä½¿ç”¨æŒ‡å®šçš„ç§é’¥è¿›è¡Œè®¤è¯ EOF chmod 600 ~/.ssh/config \u0026amp;\u0026amp; \\ cat ~/.ssh/config 5. ğŸ” æ·»åŠ  Gitee çš„ä¸»æœºå¯†é’¥ (Git Bash å‘½ä»¤) 1 ssh-keyscan -t ed25519 gitee.com \u0026gt;\u0026gt; ~/.ssh/known_hosts 6. âœ… éªŒè¯ Gitee è¿æ¥ (Git Bash å‘½ä»¤) 1 ssh -T git@gitee.com é¢„æœŸè¾“å‡ºï¼š\nHi meimolihan(@meimolihan)! You've successfully authenticated, but GITEE.COM does not provide shell access.\nä¸­æ–‡é‡Šä¹‰ï¼š\nå—¨ï¼Œmeimolihanï¼ˆ@meimolihanï¼‰ï¼ä½ å·²æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯ï¼Œä½† GITEE.COM ä¸æä¾› shell è®¿é—®æƒé™ã€‚\n7. ğŸ‘€ æŸ¥çœ‹å†™å…¥æ˜¯å¦æˆåŠŸ (Git Bash å‘½ä»¤) 1 cat ~/.ssh/known_hosts é¢„æœŸæ˜¾ç¤ºå†…å®¹ï¼š\n1 2 3 4 5 gitee.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEKxHSJ7084RmkJ4YdEi5tngynE8aZe2uEoVVsB/OvYN github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl |1|bzw3j+8DI+9RgLAzAZdQKexoWM8=|f3Bxcts2uQzDJJ0Wb0YUM60Yqc4= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk= |1|9b3z8FBBzXpAGeBRVHFx81E0Pw4=|ILx1dWLLIvT12ou1og/bNg7j+Mc= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg= ğŸ™ GitHub æ·»åŠ  SSH è¿æ¥å¯†é’¥ 1. âš™ï¸ Git å…¨å±€è®¾ç½® (Git Bash å‘½ä»¤) 1 2 git config --global user.name \u0026#34;meimolihan\u0026#34; # è®¾ç½®ç”¨æˆ·å git config --global user.email \u0026#34;meimolihan@gmail.com\u0026#34; # è®¾ç½®ç”¨æˆ·é‚®ç®± 2. ğŸ”‘ ç”Ÿæˆ GitHub RSA å¯†é’¥ï¼ˆ4096 ä½ï¼‰(Git Bash å‘½ä»¤) æ·»åŠ æ³¨é‡Šï¼š-C \u0026quot;æ³¨é‡Š\u0026quot; æ³¨é‡Šç¤ºä¾‹ï¼šssh-keygen -t rsa -b 4096 -C \u0026quot;æ³¨é‡Š\u0026quot; -f ~/.ssh/id_rsa_github 1 ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa_github ğŸ’¡ æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œç³»ç»Ÿä¼šæç¤ºä½ ï¼š\nè¾“å…¥å¯†é’¥çš„å¯†ç ï¼ˆç›´æ¥å›è½¦è·³è¿‡ï¼‰ ç¡®è®¤å¯†ç ï¼ˆç›´æ¥å›è½¦è·³è¿‡ï¼‰ 3. ğŸ“‹ å¤åˆ¶ GitHub å¯†é’¥åˆ°å‰ªåˆ‡æ¿ Windows ç³»ç»Ÿ (Git Bash å‘½ä»¤) 1 cat ~/.ssh/id_rsa_github.pub | clip.exe Linux ç³»ç»Ÿ 1 cat ~/.ssh/id_rsa_github.pub ç™»å½• GitHub ï¼Œè¿›å…¥ã€Œè®¾ç½®ã€â†’ã€ŒSSH å…¬é’¥ã€ï¼Œæ·»åŠ åˆšæ‰å¤åˆ¶çš„å…¬é’¥ã€‚\n4. ğŸ“ åˆ›å»º GitHub èº«ä»½éªŒè¯é…ç½®æ–‡ä»¶ (Git Bash å‘½ä»¤) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p ~/.ssh \u0026amp;\u0026amp; \\ chmod 700 ~/.ssh \u0026amp;\u0026amp; \\ cat \u0026gt; ~/.ssh/config \u0026lt;\u0026lt; EOF Host github.com User git # ç”¨äºè¿æ¥çš„ç”¨æˆ·å IdentityFile ~/.ssh/id_rsa_github # æŒ‡å®šç§é’¥æ–‡ä»¶è·¯å¾„ Hostname ssh.github.com # ç”¨äº SSH è¿æ¥çš„ç‰¹å®šä¸»æœºå Port 443 # æŒ‡å®šè¿æ¥æ—¶çš„ç«¯å£å· Host gitee.com User git # ç”¨äºè¿æ¥çš„ç”¨æˆ·å IdentityFile ~/.ssh/id_rsa_gitee # æŒ‡å®šç§é’¥æ–‡ä»¶è·¯å¾„ IdentitiesOnly yes # ä»…ä½¿ç”¨æŒ‡å®šçš„ç§é’¥è¿›è¡Œè®¤è¯ EOF chmod 600 ~/.ssh/config \u0026amp;\u0026amp; \\ cat ~/.ssh/config 5. ğŸ” æ·»åŠ  GitHub çš„ä¸»æœºå¯†é’¥ (Git Bash å‘½ä»¤) 1 ssh-keyscan -t ed25519 github.com \u0026gt;\u0026gt; ~/.ssh/known_hosts 6. âœ… éªŒè¯ GitHub è¿æ¥ (Git Bash å‘½ä»¤) 1 ssh -T git@github.com é¢„æœŸè¾“å‡ºï¼š\nHi meimolihan! You've successfully authenticated, but GitHub does not provide shell access.\nä¸­æ–‡é‡Šä¹‰ï¼š\nå—¨ï¼Œmeimolihanï¼ä½ å·²ç»æˆåŠŸè¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œä½†æ˜¯ GitHub ä¸æä¾› shell è®¿é—®æƒé™ã€‚\n7. ğŸ‘€ æŸ¥çœ‹å†™å…¥æ˜¯å¦æˆåŠŸ (Git Bash å‘½ä»¤) 1 cat ~/.ssh/known_hosts é¢„æœŸæ˜¾ç¤ºå†…å®¹ï¼š\n1 2 3 4 5 gitee.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEKxHSJ7084RmkJ4YdEi5tngynE8aZe2uEoVVsB/OvYN github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl |1|bzw3j+8DI+9RgLAzAZdQKexoWM8=|f3Bxcts2uQzDJJ0Wb0YUM60Yqc4= ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA179cnfGWOWRVruj16z6XyvxvjJwbz0wQZ75XK5tKSb7FNyeIEs4TT4jk+S4dhPeAUC5y+bDYirYgM4GC7uEnztnZyaVWQ7B381AK4Qdrwt51ZqExKbQpTUNn+EjqoTwvqNj4kqx5QUCI0ThS/YkOxJCXmPUWZbhjpCg56i+2aB6CmK2JGhn57K5mj0MNdBXA4/WnwH6XoPWJzK5Nyu2zB3nAZp+S5hpQs+p1vN1/wsjk= |1|9b3z8FBBzXpAGeBRVHFx81E0Pw4=|ILx1dWLLIvT12ou1og/bNg7j+Mc= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg= ğŸ”§ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ â“ é—®é¢˜ 1: SSH è¿æ¥è¶…æ—¶æˆ–å¤±è´¥ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ SSH é…ç½®æ˜¯å¦æ­£ç¡® ssh -vT git@gitee.com ssh -vT git@github.com # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status # æ£€æŸ¥ç½‘ç»œè¿æ¥ ping gitee.com ping github.com â“ é—®é¢˜ 2: æƒé™é”™è¯¯ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 # ä¿®å¤æ–‡ä»¶æƒé™ chmod 700 ~/.ssh chmod 600 ~/.ssh/* chmod 644 ~/.ssh/*.pub â“ é—®é¢˜ 3: å¯†é’¥ä¸è¢«è¯†åˆ« è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 # é‡æ–°å¯åŠ¨ SSH ä»£ç† eval \u0026#34;$(ssh-agent -s)\u0026#34; ssh-add ~/.ssh/id_rsa_gitee ssh-add ~/.ssh/id_rsa_github ğŸ’¡ æœ€ä½³å®è·µ 1. ğŸ”’ å®šæœŸæ›´æ¢å¯†é’¥ å»ºè®®æ¯ 6-12 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ SSH å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§ã€‚\n2. ğŸ“ ä½¿ç”¨ä¸åŒçš„å¯†é’¥ ä¸ºä¸åŒçš„ Git å¹³å°ä½¿ç”¨ä¸åŒçš„å¯†é’¥å¯¹ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚\n3. ğŸ’¾ å¤‡ä»½å¯†é’¥æ–‡ä»¶ å°† SSH å¯†é’¥å¤‡ä»½åˆ°å®‰å…¨çš„ä½ç½®ï¼Œé˜²æ­¢ä¸¢å¤±ã€‚\n4. ğŸ›¡ï¸ ä½¿ç”¨å¯†ç ä¿æŠ¤å¯†é’¥ åœ¨ç”Ÿæˆå¯†é’¥æ—¶æ·»åŠ å¯†ç ä¿æŠ¤ï¼š\n1 ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f ~/.ssh/id_rsa -N \u0026#34;your_strong_password\u0026#34; 5. ğŸ” å®šæœŸæ£€æŸ¥è¿æ¥çŠ¶æ€ å®šæœŸéªŒè¯ SSH è¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š\n1 2 3 # æ¯æœˆæ£€æŸ¥ä¸€æ¬¡è¿æ¥çŠ¶æ€ ssh -T git@gitee.com ssh -T git@github.com âœ¨ å®Œæˆä»¥ä¸Šé…ç½®åï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ SSH åè®®å®‰å…¨åœ°è¿æ¥ Gitee å’Œ GitHub è¿›è¡Œä»£ç æ“ä½œäº†ï¼\n","date":"2025-08-26T16:08:59+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/719b95cb/","title":"Git SSH è¿æ¥å¯†é’¥é…ç½®æŒ‡å— ğŸ”‘"},{"content":"Git å¿½ç•¥æ–‡ä»¶é…ç½®æŒ‡å— ğŸ“ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ .gitignore æ–‡ä»¶æ¥ç®¡ç† Git ç‰ˆæœ¬æ§åˆ¶ä¸­çš„æ–‡ä»¶å¿½ç•¥è§„åˆ™ï¼Œå¸®åŠ©æ‚¨ä¿æŒä»£ç ä»“åº“çš„æ•´æ´å’Œé«˜æ•ˆã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ“‹ ä¸€ã€åˆ›å»ºå¿½ç•¥æ–‡ä»¶ ğŸ”„ äºŒã€åº”ç”¨å¿½ç•¥è§„åˆ™åˆ°ç°æœ‰ä»“åº“ ğŸ“ ä¸‰ã€å¤„ç†ç‰¹æ®Šæƒ…å†µ ğŸ› ï¸ å››ã€éªŒè¯å¿½ç•¥è§„åˆ™ ğŸ“Œ äº”ã€æœ€ä½³å®è·µå»ºè®® â— æ³¨æ„äº‹é¡¹ ğŸ¯ æ€»ç»“ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ›¡ï¸ ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼šé¿å…æ„å¤–æäº¤é…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿæ•°æ® ğŸ§¹ ä¿æŒä»“åº“æ•´æ´ï¼šè‡ªåŠ¨æ’é™¤ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ç­‰ä¸å¿…è¦çš„æ–‡ä»¶ âš¡ æé«˜æ•ˆç‡ï¼šå‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶è·Ÿè¸ªï¼ŒåŠ å¿« Git æ“ä½œé€Ÿåº¦ ğŸ”§ çµæ´»é…ç½®ï¼šæ”¯æŒé€šé…ç¬¦ã€ç›®å½•æ’é™¤å’Œç‰¹å®šæ–‡ä»¶ä¿ç•™ ğŸ“ ç©ºç›®å½•å¤„ç†ï¼šæä¾›ä¿ç•™ç©ºç›®å½•çš„è§£å†³æ–¹æ¡ˆ ğŸ“‹ ä¸€ã€åˆ›å»ºå¿½ç•¥æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 # åˆ›å»ºå¹¶é…ç½® .gitignore æ–‡ä»¶ touch .gitignore \u0026amp;\u0026amp; \\ cat \u0026gt; .gitignore \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ğŸ–¥ï¸ æ“ä½œç³»ç»Ÿç”Ÿæˆçš„æ–‡ä»¶ .DS_Store Thumbs.db Desktop.ini # ğŸ—ï¸ ç¼–è¯‘äº§ç‰©å’Œæ„å»ºè¾“å‡º target/ dist/ build/ *.o *.class *.so *.dll *.exe # ğŸ“Š æ—¥å¿—å’Œç¼“å­˜æ–‡ä»¶ *.log *.cache .cache/ logs/ *.tmp *.temp # ğŸ“¦ ä¾èµ–ç®¡ç†ç›®å½• node_modules/ vendor/ bower_components/ *.gem *.rar *.zip # ğŸ”’ é…ç½®æ–‡ä»¶ï¼ˆä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼‰ config/*.properties !config/default.properties # ä½†åŒ…å«é»˜è®¤é…ç½® *.env *.key *.pem # ğŸ’» IDE å’Œç¼–è¾‘å™¨ç‰¹å®šæ–‡ä»¶ .idea/ .vscode/ *.swp *.swo *~ # ğŸµ é¡¹ç›®ç‰¹å®šå¿½ç•¥æ–‡ä»¶ download/ cdn-file-music.txt cdn-music.txt config.md config-nginx.txt # ğŸ—‚ï¸ ç©ºç›®å½•ä¿ç•™å ä½æ–‡ä»¶ï¼ˆä½¿ç”¨ .gitkeepï¼‰ !.gitkeep EOF ğŸ”„ äºŒã€åº”ç”¨å¿½ç•¥è§„åˆ™åˆ°ç°æœ‰ä»“åº“ æ–¹æ³• 1ï¼šğŸš€ ä¸€é”®æ¸…ç†å¹¶æ¨é€ 1 2 3 # ä»ç¼“å­˜ä¸­ç§»é™¤æ‰€æœ‰æ–‡ä»¶ï¼ˆä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼‰ git rm --cached -r . \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL https://gitee.com/meimolihan/script/raw/master/sh/git/git_push.sh) æ–¹æ³• 2ï¼šğŸ“ åˆ†æ­¥æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 # 1. æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼ˆä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼‰ git rm -r --cached . # 2. é‡æ–°æ·»åŠ æ‰€æœ‰æ–‡ä»¶ï¼ˆå¿½ç•¥è§„åˆ™å°†ç”Ÿæ•ˆï¼‰ git add . # 3. æäº¤æ›´æ”¹ git commit -m \u0026#34;ğŸ¯ åº”ç”¨ .gitignore è§„åˆ™ï¼Œæ¸…ç†ä¸å¿…è¦çš„è·Ÿè¸ªæ–‡ä»¶\u0026#34; # 4. æ¨é€åˆ°è¿œç¨‹ä»“åº“ git push origin main ğŸ“ ä¸‰ã€å¤„ç†ç‰¹æ®Šæƒ…å†µ ğŸ“‚ ä¿ç•™ç©ºç›®å½•çš„æ–¹æ³• Git é»˜è®¤ä¸è·Ÿè¸ªç©ºç›®å½•ï¼Œä½†æœ‰æ—¶éœ€è¦ä¿ç•™ç›®å½•ç»“æ„ï¼š\n1 2 3 4 5 6 # åœ¨éœ€è¦ä¿ç•™çš„ç©ºç›®å½•ä¸­åˆ›å»º .gitkeep æ–‡ä»¶ touch logs/.gitkeep touch uploads/.gitkeep # å¼ºåˆ¶æ·»åŠ  .gitkeep æ–‡ä»¶ï¼ˆå³ä½¿çˆ¶ç›®å½•è¢«å¿½ç•¥ï¼‰ git add -f logs/.gitkeep uploads/.gitkeep âš¡ å¼ºåˆ¶æ·»åŠ è¢«å¿½ç•¥çš„æ–‡ä»¶ 1 2 # å¦‚æœéœ€è¦æ·»åŠ è¢« .gitignore è§„åˆ™æ’é™¤çš„ç‰¹å®šæ–‡ä»¶ git add -f config/production.properties ğŸ› ï¸ å››ã€éªŒè¯å¿½ç•¥è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥å“ªäº›æ–‡ä»¶å°†è¢«å¿½ç•¥ git status --ignored # æˆ–è€…ä½¿ç”¨æ›´è¯¦ç»†çš„æ–¹å¼ git check-ignore -v * # æ£€æŸ¥ç‰¹å®šæ–‡ä»¶æ˜¯å¦è¢«å¿½ç•¥ git check-ignore -v path/to/file # åˆ—å‡ºæ‰€æœ‰è¢«å¿½ç•¥çš„æ–‡ä»¶ git ls-files --others --ignored --exclude-standard ğŸ“Œ äº”ã€æœ€ä½³å®è·µå»ºè®® ğŸŒ å…¨å±€å¿½ç•¥é…ç½®ï¼šè€ƒè™‘åˆ›å»ºå…¨å±€ gitignore æ–‡ä»¶å¤„ç†ç³»ç»Ÿçº§æ–‡ä»¶\n1 git config --global core.excludesfile ~/.global_gitignore ğŸ” å®šæœŸå®¡æŸ¥ï¼šå®šæœŸæ£€æŸ¥ .gitignore æ–‡ä»¶ï¼Œç¡®ä¿ä¸ä¼šå¿½ç•¥é‡è¦æ–‡ä»¶\nğŸ“š ä½¿ç”¨æ¨¡æ¿ï¼šå‚è€ƒ GitHub çš„ gitignore æ¨¡æ¿åº“è·å–ä¸åŒè¯­è¨€çš„é…ç½®\n1 2 # æŸ¥çœ‹å¯ç”¨çš„ gitignore æ¨¡æ¿ curl -s https://api.github.com/repos/github/gitignore/contents | grep name ğŸ§ª æµ‹è¯•è§„åˆ™ï¼šåœ¨åº”ç”¨å‰æµ‹è¯•å¿½ç•¥è§„åˆ™ï¼Œé¿å…æ„å¤–æ’é™¤é‡è¦æ–‡ä»¶\n1 2 # æµ‹è¯•å¿½ç•¥è§„åˆ™ git check-ignore -v test-file.txt ğŸ“ åˆ†å±‚é…ç½®ï¼šåœ¨å­ç›®å½•ä¸­åˆ›å»ºé¢å¤–çš„ .gitignore æ–‡ä»¶\n1 2 # é¡¹ç›®æ ¹ç›®å½•çš„ .gitignore å¤„ç†é€šç”¨è§„åˆ™ # å­ç›®å½•ä¸­çš„ .gitignore å¤„ç†ç‰¹å®šè§„åˆ™ â— æ³¨æ„äº‹é¡¹ âš ï¸ .gitignore åªå¯¹æœªè·Ÿè¸ªçš„æ–‡ä»¶æœ‰æ•ˆï¼Œå·²è·Ÿè¸ªçš„æ–‡ä»¶éœ€è¦å…ˆç§»é™¤ç¼“å­˜ âš ï¸ å¿½ç•¥è§„åˆ™æ˜¯ä»ä¸Šåˆ°ä¸‹åŒ¹é…çš„ï¼Œåé¢çš„è§„åˆ™å¯ä»¥è¦†ç›–å‰é¢çš„ âš ï¸ ä½¿ç”¨ git add -f å¯ä»¥å¼ºåˆ¶æ·»åŠ è¢«å¿½ç•¥çš„æ–‡ä»¶ âš ï¸ å¿½ç•¥è§„åˆ™ä¸ä¼šå½±å“å·²æäº¤åˆ°ä»“åº“çš„æ–‡ä»¶ âš ï¸ æ¨¡å¼åŒ¹é…æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼ˆé™¤éé…ç½® core.ignorecase=trueï¼‰ ğŸ”§ é«˜çº§é…ç½®æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å¿½ç•¥é™¤ç‰¹å®šæ–‡ä»¶å¤–çš„æ‰€æœ‰æ–‡ä»¶ /* !/src !/README.md # å¿½ç•¥ç‰¹å®šæ‰©å±•åä½†ä¿ç•™æŸäº›æ–‡ä»¶ *.txt !important.txt # ä½¿ç”¨æ³¨é‡Šè¯´æ˜å¿½ç•¥åŸå›  # æ—¥å¿—æ–‡ä»¶ - ç”±åº”ç”¨ç¨‹åºè‡ªåŠ¨ç”Ÿæˆ *.log # ä½¿ç”¨è½¬ä¹‰å­—ç¬¦å¿½ç•¥ç‰¹æ®Šæ–‡ä»¶å \\\\#ç‰¹æ®Šæ–‡ä»¶# \\\\!é‡è¦æ–‡ä»¶! ğŸ¯ æ€»ç»“ é€šè¿‡åˆç†é…ç½® .gitignore æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ï¼š\nâœ… ä¿æŒä»“åº“æ¸…æ´å’Œä¸“ä¸š âœ… é¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ âœ… æé«˜å›¢é˜Ÿåä½œæ•ˆç‡ âœ… å‡å°‘ä¸å¿…è¦çš„åˆå¹¶å†²çª ç°åœ¨æ‚¨çš„ Git ä»“åº“å·²ç»é…ç½®å¥½äº†é«˜æ•ˆçš„æ–‡ä»¶å¿½ç•¥è§„åˆ™ï¼ğŸ‰\nğŸ“‹ å¿«é€Ÿå‚è€ƒè¡¨ å‘½ä»¤ æè¿° ç¤ºä¾‹ git check-ignore -v æ£€æŸ¥å¿½ç•¥è§„åˆ™ git check-ignore -v file.txt git add -f å¼ºåˆ¶æ·»åŠ æ–‡ä»¶ git add -f config.env git rm --cached ä»ç¼“å­˜ç§»é™¤ git rm --cached file.log git ls-files --ignored åˆ—å‡ºå¿½ç•¥æ–‡ä»¶ git ls-files --ignored --exclude-standard ğŸ†˜ å¸¸è§é—®é¢˜è§£å†³ é—®é¢˜ï¼šå·²æäº¤çš„æ–‡ä»¶æ— æ³•è¢«å¿½ç•¥\n1 2 3 # è§£å†³æ–¹æ¡ˆï¼šä»ç¼“å­˜ä¸­ç§»é™¤æ–‡ä»¶ git rm --cached unwanted-file.txt git commit -m \u0026#34;ç§»é™¤ä¸éœ€è¦è·Ÿè¸ªçš„æ–‡ä»¶\u0026#34; é—®é¢˜ï¼šå¿½ç•¥è§„åˆ™ä¸ç”Ÿæ•ˆ\n1 2 3 4 5 6 # æ£€æŸ¥è§„åˆ™è¯­æ³• git check-ignore -v test-file.txt # æ¸…é™¤ç¼“å­˜é‡æ–°æ·»åŠ  git rm -r --cached . git add . ç°åœ¨æ‚¨çš„ Git ä»“åº“å·²ç»é…ç½®å¥½äº†é«˜æ•ˆçš„æ–‡ä»¶å¿½ç•¥è§„åˆ™ï¼ğŸ‰\n","date":"2025-08-26T16:02:00+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8d42ed64/","title":"Git å¿½ç•¥æ–‡ä»¶é…ç½®æŒ‡å— ğŸ“"},{"content":"Git è‡ªåŠ¨åŒ–æ‹‰å–æ›´æ–°è„šæœ¬ ğŸ™ ä¸€é”®è‡ªåŠ¨åŒ–æ‹‰å– Git ä»“åº“æ›´æ–°çš„é«˜æ•ˆè„šæœ¬å·¥å…·ï¼Œæ”¯æŒå•ä¸ªé¡¹ç›®å’Œæ‰¹é‡æ“ä½œ\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ è„šæœ¬åŠŸèƒ½æ¦‚è¿° ğŸš€ ä¸€ã€å•ä¸ªé¡¹ç›®æ›´æ–°è„šæœ¬ ğŸ“¦ äºŒã€æ‰¹é‡é¡¹ç›®æ›´æ–°è„šæœ¬ ğŸ› ï¸ ä¸‰ã€è„šæœ¬æºç å‚è€ƒ âš™ï¸ å››ã€å®‰è£…å’Œè‡ªå®šä¹‰é…ç½® ğŸ”§ äº”ã€é«˜çº§ç”¨æ³•å’Œå‚æ•° ğŸš¨ å…­ã€æ³¨æ„äº‹é¡¹å’Œå®‰å…¨å»ºè®® ğŸ’¡ ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­” ğŸ“Š å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® âœ¨ è„šæœ¬åŠŸèƒ½æ¦‚è¿° æœ¬æŒ‡å—æä¾›ä¸¤ç§å®ç”¨çš„ Git è‡ªåŠ¨åŒ–è„šæœ¬ï¼š\nå•ä¸ªé¡¹ç›®æ›´æ–° - æ‹‰å–å½“å‰ Git é¡¹ç›®çš„æ›´æ–° æ‰¹é‡é¡¹ç›®æ›´æ–° - é€’å½’æ‹‰å–æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰ Git ä»“åº“çš„æ›´æ–° ğŸš€ ä¸€ã€å•ä¸ªé¡¹ç›®æ›´æ–°è„šæœ¬ ä» GitHub ä»“åº“æ‹‰å–æ›´æ–° 1 bash \u0026lt;(curl -sL script.meimolihan.eu.org/sh/git/git_update.sh) ä» Gitee ä»“åº“æ‹‰å–æ›´æ–°ï¼ˆå›½å†…åŠ é€Ÿï¼‰ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh) è„šæœ¬åŠŸèƒ½ç‰¹ç‚¹ï¼š\nâœ… è‡ªåŠ¨æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦ä¸º Git ä»“åº“ âœ… æ‹‰å–è¿œç¨‹æ‰€æœ‰åˆ†æ”¯çš„æœ€æ–°æ›´æ–° âœ… æ˜¾ç¤ºè¯¦ç»†çš„æ›´æ–°çŠ¶æ€å’Œå˜æ›´ä¿¡æ¯ âœ… å‹å¥½çš„é¢œè‰²æç¤ºå’Œé”™è¯¯å¤„ç† âœ… æ”¯æŒ HTTP å’Œ SSH åè®®çš„ä»“åº“ ğŸ“¦ äºŒã€æ‰¹é‡é¡¹ç›®æ›´æ–°è„šæœ¬ 1. ğŸ“‚ åœ¨ FnOS ç»ˆç«¯æ‰§è¡Œæ‰¹é‡æ›´æ–° 1 2 cd /vol1/1000/home \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update_all.sh) 2. ğŸ’» ä» Windows Git Bash è¿œç¨‹æ‰§è¡Œæ‰¹é‡æ›´æ–° 1 2 ssh fnos \u0026#34;cd /vol1/1000/home \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update_all.sh)\u0026#34; æ‰¹é‡è„šæœ¬åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸ” é€’å½’æœç´¢æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ Git ä»“åº“ ğŸ“Š æ˜¾ç¤ºæ¯ä¸ªä»“åº“çš„æ›´æ–°çŠ¶æ€æ±‡æ€» â±ï¸ æ˜¾ç¤ºæ¯ä¸ªä»“åº“çš„æ“ä½œè€—æ—¶ ğŸ¨ å½©è‰²è¾“å‡ºï¼Œæ¸…æ™°åŒºåˆ†æˆåŠŸ/è­¦å‘Š/é”™è¯¯ ğŸ“ ç”Ÿæˆè¯¦ç»†çš„æ›´æ–°æŠ¥å‘Šæ‘˜è¦ ğŸ› ï¸ ä¸‰ã€è„šæœ¬æºç å‚è€ƒ å•ä¸ªé¡¹ç›®æ›´æ–°è„šæœ¬ (git_update.sh) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #!/bin/bash # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color echo -e \u0026#34;${BLUE}ğŸ” å¼€å§‹æ£€æŸ¥ Git ä»“åº“æ›´æ–°...${NC}\u0026#34; # æ£€æŸ¥å½“å‰ç›®å½•æ˜¯å¦ä¸º Git ä»“åº“ if [ ! -d .git ]; then echo -e \u0026#34;${RED}âŒ å½“å‰ç›®å½•ä¸æ˜¯ Git ä»“åº“ï¼${NC}\u0026#34; exit 1 fi # è·å–è¿œç¨‹ URL å’Œå½“å‰åˆ†æ”¯ REMOTE_URL=$(git remote get-url origin) CURRENT_BRANCH=$(git branch --show-current) echo -e \u0026#34;ğŸ“¦ ä»“åº“: ${GREEN}$(basename -s .git $(git config --get remote.origin.url))${NC}\u0026#34; echo -e \u0026#34;ğŸŒ è¿œç¨‹: ${BLUE}$REMOTE_URL${NC}\u0026#34; echo -e \u0026#34;ğŸŒ¿ åˆ†æ”¯: ${YELLOW}$CURRENT_BRANCH${NC}\u0026#34; echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; # æ‹‰å–æ›´æ–° echo -e \u0026#34;ğŸ”„ æ‹‰å–è¿œç¨‹æ›´æ–°...\u0026#34; if git pull origin $CURRENT_BRANCH; then echo -e \u0026#34;${GREEN}âœ… æ›´æ–°æˆåŠŸå®Œæˆï¼${NC}\u0026#34; else echo -e \u0026#34;${RED}âŒ æ‹‰å–æ›´æ–°å¤±è´¥ï¼${NC}\u0026#34; exit 1 fi # æ˜¾ç¤ºæœ€æ–°æäº¤ä¿¡æ¯ echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; echo -e \u0026#34;ğŸ“‹ æœ€æ–°æ›´æ–°å†…å®¹:\u0026#34; git log -1 --oneline --decorate --color echo -e \u0026#34;${GREEN}ğŸ‰ æ‰€æœ‰æ“ä½œå®Œæˆï¼${NC}\u0026#34; æ‰¹é‡é¡¹ç›®æ›´æ–°è„šæœ¬ (git_update_all.sh) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 #!/bin/bash # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; CYAN=\u0026#39;\\033[0;36m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # ç»Ÿè®¡å˜é‡ TOTAL_REPOS=0 SUCCESS_COUNT=0 FAIL_COUNT=0 SKIP_COUNT=0 echo -e \u0026#34;${CYAN}ğŸ” å¼€å§‹æœç´¢ Git ä»“åº“...${NC}\u0026#34; # æŸ¥æ‰¾æ‰€æœ‰ Git ä»“åº“ find . -name \u0026#34;.git\u0026#34; -type d | while read git_dir; do repo_dir=$(dirname \u0026#34;$git_dir\u0026#34;) cd \u0026#34;$repo_dir\u0026#34; || continue REPO_NAME=$(basename \u0026#34;$repo_dir\u0026#34;) TOTAL_REPOS=$((TOTAL_REPOS + 1)) echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; echo -e \u0026#34;ğŸ”„ å¤„ç†ä»“åº“: ${CYAN}$REpo_NAME${NC}\u0026#34; # è·å–è¿œç¨‹ä¿¡æ¯ if git remote get-url origin \u0026amp;\u0026gt;/dev/null; then REMOTE_URL=$(git remote get-url origin) CURRENT_BRANCH=$(git branch --show-current 2\u0026gt;/dev/null || echo \u0026#34;æœªçŸ¥\u0026#34;) echo -e \u0026#34;ğŸŒ¿ åˆ†æ”¯: ${YELLOW}$CURRENT_BRANCH${NC}\u0026#34; echo -e \u0026#34;ğŸŒ è¿œç¨‹: ${BLUE}$REMOTE_URL${NC}\u0026#34; # æ‹‰å–æ›´æ–° START_TIME=$(date +%s) if git pull --ff-only; then END_TIME=$(date +%s) DURATION=$((END_TIME - START_TIME)) echo -e \u0026#34;${GREEN}âœ… æ›´æ–°æˆåŠŸ (${DURATION}s)${NC}\u0026#34; SUCCESS_COUNT=$((SUCCESS_COUNT + 1)) else echo -e \u0026#34;${RED}âŒ æ›´æ–°å¤±è´¥${NC}\u0026#34; FAIL_COUNT=$((FAIL_COUNT + 1)) fi else echo -e \u0026#34;${YELLOW}âš ï¸ æ— è¿œç¨‹ä»“åº“ï¼Œè·³è¿‡${NC}\u0026#34; SKIP_COUNT=$((SKIP_COUNT + 1)) fi cd - \u0026gt;/dev/null || exit done # æ˜¾ç¤ºæ±‡æ€»æŠ¥å‘Š echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; echo -e \u0026#34;${CYAN}ğŸ“Š æ›´æ–°å®Œæˆæ±‡æ€»:${NC}\u0026#34; echo -e \u0026#34;ğŸ“¦ æ€»ä»“åº“æ•°: $TOTAL_REPOS\u0026#34; echo -e \u0026#34;${GREEN}âœ… æˆåŠŸæ›´æ–°: $SUCCESS_COUNT${NC}\u0026#34; echo -e \u0026#34;${RED}âŒ æ›´æ–°å¤±è´¥: $FAIL_COUNT${NC}\u0026#34; echo -e \u0026#34;${YELLOW}âš ï¸ è·³è¿‡ä»“åº“: $SKIP_COUNT${NC}\u0026#34; echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; âš™ï¸ å››ã€å®‰è£…å’Œè‡ªå®šä¹‰é…ç½® 1. ğŸ“¥ æœ¬åœ°å®‰è£…è„šæœ¬ 1 2 3 4 5 6 7 # ä¸‹è½½å•ä¸ªæ›´æ–°è„šæœ¬ curl -o ~/git_update.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh chmod +x ~/git_update.sh # ä¸‹è½½æ‰¹é‡æ›´æ–°è„šæœ¬ curl -o ~/git_update_all.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git_update_all.sh chmod +x ~/git_update_all.sh 2. ğŸ“ æ·»åŠ åˆ°ç³»ç»Ÿ PATH 1 2 3 4 5 6 7 # ç§»åŠ¨åˆ°å¯æ‰§è¡Œç›®å½• sudo mv ~/git_update.sh /usr/local/bin/git-update sudo mv ~/git_update_all.sh /usr/local/bin/git-update-all # ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ git-update git-update-all 3. ğŸ”¤ åˆ›å»ºåˆ«åï¼ˆå¯é€‰ï¼‰ 1 2 3 # æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc alias gup=\u0026#39;bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh)\u0026#39; alias gup-all=\u0026#39;bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update_all.sh)\u0026#39; ğŸ”§ äº”ã€é«˜çº§ç”¨æ³•å’Œå‚æ•° 1. ğŸ“‚ æŒ‡å®šç›®å½•è¿›è¡Œæ‰¹é‡æ›´æ–° 1 2 # æ›´æ–°æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ Git ä»“åº“ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update_all.sh) /path/to/your/projects 2. ğŸ” åªæ£€æŸ¥ä¸å®é™…æ‹‰å–ï¼ˆdry-runï¼‰ 1 2 # ä¿®æ”¹è„šæœ¬æ·»åŠ  dry-run åŠŸèƒ½ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh) --dry-run 3. ğŸŒ¿ æŒ‡å®šç‰¹å®šåˆ†æ”¯æ›´æ–° 1 2 # ä¿®æ”¹è„šæœ¬æ”¯æŒåˆ†æ”¯å‚æ•° bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh) main ğŸš¨ å…­ã€æ³¨æ„äº‹é¡¹å’Œå®‰å…¨å»ºè®® ğŸ” æƒé™æ£€æŸ¥ï¼šè„šæœ¬ä¼šå°è¯•æ‹‰å–æ›´æ–°ï¼Œç¡®ä¿ä½ æœ‰ç›¸åº”çš„æƒé™ ğŸ’¾ å¤‡ä»½é‡è¦æ›´æ”¹ï¼šå»ºè®®åœ¨è¿è¡Œå‰æäº¤æˆ–å¤‡ä»½æœ¬åœ°ä¿®æ”¹ ğŸŒ ç½‘ç»œè¿æ¥ï¼šç¡®ä¿ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼Œç‰¹åˆ«æ˜¯å¤§å‹ä»“åº“ ğŸ”Œ ä»£ç†è®¾ç½®ï¼šå¦‚æœä½¿ç”¨ä»£ç†ï¼Œç¡®ä¿ Git å·²æ­£ç¡®é…ç½® ğŸ” éªŒè¯è„šæœ¬ï¼šå»ºè®®æŸ¥çœ‹è„šæœ¬å†…å®¹åå†æ‰§è¡Œè¿œç¨‹è„šæœ¬ å®‰å…¨æ‰§è¡Œè¿œç¨‹è„šæœ¬çš„æ–¹æ³• 1 2 3 4 5 # å…ˆæŸ¥çœ‹è„šæœ¬å†…å®¹ curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh # ç¡®è®¤æ— è¯¯åå†æ‰§è¡Œ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh) ğŸ’¡ ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­” â“ è„šæœ¬æ‰§è¡Œæƒé™é—®é¢˜ è§£å†³æ–¹æ¡ˆï¼š\n1 chmod +x git_update.sh â“ ç½‘ç»œè¿æ¥è¶…æ—¶ è§£å†³æ–¹æ¡ˆï¼š\n1 2 # ä½¿ç”¨å›½å†…é•œåƒ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_update.sh) â“ ä»“åº“è®¤è¯å¤±è´¥ è§£å†³æ–¹æ¡ˆï¼š\nç¡®ä¿ SSH å¯†é’¥æˆ–è®¤è¯ä¿¡æ¯å·²æ­£ç¡®é…ç½® å¯¹äº HTTP ä»“åº“ï¼Œé…ç½®å‡­æ®å­˜å‚¨ï¼š 1 git config --global credential.helper store â“ å†²çªå¤„ç† è„šæœ¬ä¸ä¼šè‡ªåŠ¨å¤„ç†å†²çªï¼Œå¦‚æœé‡åˆ°å†²çªéœ€è¦æ‰‹åŠ¨è§£å†³ã€‚\nğŸ“Š å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® âš¡ å¹¶è¡Œå¤„ç†ï¼šå¯¹äºå¤§é‡ä»“åº“ï¼Œå¯ä»¥è€ƒè™‘å¹¶è¡Œæ‰§è¡Œæ‹‰å–æ“ä½œ ğŸ“‰ å¢é‡æ›´æ–°ï¼šå¤§å‹ä»“åº“å¯ä»¥è®¾ç½®æµ…å±‚å…‹éš†å‡å°‘æ•°æ®ä¼ è¾“ ğŸ’¾ ç¼“å­˜ä¼˜åŒ–ï¼šé…ç½® Git ç¼“å­˜æé«˜é‡å¤æ“ä½œæ€§èƒ½ ğŸ¯ é€‰æ‹©æ€§æ›´æ–°ï¼šåªæ›´æ–°éœ€è¦çš„åˆ†æ”¯ï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œä¼ è¾“ ğŸ¯ æç¤ºï¼šè¿™äº›è„šæœ¬éå¸¸é€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ã€å®šæœŸåŒæ­¥å¤šä¸ªä»“åº“ï¼Œæˆ–è€…ç®¡ç†å¤§é‡çš„ä¸ªäººé¡¹ç›®ã€‚å»ºè®®æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œé€‚å½“çš„å®šåˆ¶å’Œæ‰©å±•ã€‚\nå¸Œæœ›è¿™äº› Git è‡ªåŠ¨åŒ–è„šæœ¬èƒ½å¤§å¤§æé«˜æ‚¨çš„å·¥ä½œæ•ˆç‡ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆå’Œæ”¹è¿›ã€‚\n","date":"2025-08-26T15:58:39+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f70ffe8b/","title":"Git è‡ªåŠ¨åŒ–æ‹‰å–æ›´æ–°è„šæœ¬ ğŸ™"},{"content":"Git è‡ªåŠ¨åŒ–æ¨é€æ›´æ–°è„šæœ¬ ğŸš€ ä¸€é”®è‡ªåŠ¨åŒ–æ¨é€ Git ä»“åº“æ›´æ–°çš„é«˜æ•ˆè„šæœ¬å·¥å…·ï¼Œæ”¯æŒ SSH å’Œ HTTPS åè®®ï¼Œå•ä¸ªé¡¹ç›®å’Œæ‰¹é‡æ“ä½œ\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ è„šæœ¬åŠŸèƒ½æ¦‚è¿° ğŸ”„ ä¸€ã€åè®®åˆ‡æ¢é…ç½®è„šæœ¬ ğŸ“¤ äºŒã€å•ä¸ªé¡¹ç›®æ¨é€è„šæœ¬ ğŸ“¦ ä¸‰ã€æ‰¹é‡é¡¹ç›®æ¨é€è„šæœ¬ ğŸ› ï¸ å››ã€è„šæœ¬æºç å‚è€ƒ âš™ï¸ äº”ã€å®‰è£…å’Œè‡ªå®šä¹‰é…ç½® ğŸ”§ å…­ã€é«˜çº§ç”¨æ³•å’Œè‡ªå®šä¹‰ ğŸš¨ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ’¡ å…«ã€å¸¸è§é—®é¢˜è§£ç­” ğŸ“Š ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ”„ åã€å·¥ä½œæµé›†æˆ âœ¨ è„šæœ¬åŠŸèƒ½æ¦‚è¿° æœ¬æŒ‡å—æä¾›å®Œæ•´çš„ Git è‡ªåŠ¨åŒ–æ¨é€è§£å†³æ–¹æ¡ˆï¼š\nğŸ”„ åè®®åˆ‡æ¢ - åœ¨ SSH å’Œ HTTPS åè®®é—´çµæ´»åˆ‡æ¢ ğŸ“¤ å•ä¸ªé¡¹ç›®æ¨é€ - æ¨é€å½“å‰ Git é¡¹ç›®çš„æ›´æ–° ğŸ“¦ æ‰¹é‡é¡¹ç›®æ¨é€ - é€’å½’æ¨é€æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰ Git ä»“åº“çš„æ›´æ–° ğŸ”„ ä¸€ã€åè®®åˆ‡æ¢é…ç½®è„šæœ¬ ğŸ” åˆ‡æ¢åˆ° SSH åè®®ï¼ˆæ¨èï¼‰ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_ssh_config.sh) ğŸŒ åˆ‡æ¢åˆ° HTTPS åè®® 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_https_config.sh) åè®®åˆ‡æ¢è„šæœ¬åŠŸèƒ½ï¼š\nğŸ”„ è‡ªåŠ¨æ£€æµ‹å½“å‰è¿œç¨‹ URL ğŸŒ åœ¨ SSH å’Œ HTTPS åè®®é—´æ™ºèƒ½åˆ‡æ¢ âœ… éªŒè¯æ–°é…ç½®æ˜¯å¦æœ‰æ•ˆ ğŸ“ æ˜¾ç¤ºè¯¦ç»†çš„åˆ‡æ¢ç»“æœ ğŸ“¤ äºŒã€å•ä¸ªé¡¹ç›®æ¨é€è„šæœ¬ ğŸš€ å®Œæ•´æ¨é€æµç¨‹ï¼ˆSSH åè®®ï¼‰ 1 2 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_ssh_config.sh) \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_push.sh) ğŸŒ å®Œæ•´æ¨é€æµç¨‹ï¼ˆHTTPS åè®®ï¼‰ 1 2 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_https_config.sh) \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_push.sh) å•ä¸ªé¡¹ç›®æ¨é€è„šæœ¬åŠŸèƒ½ï¼š\nğŸ” è‡ªåŠ¨æ£€æµ‹å½“å‰ Git ä»“åº“çŠ¶æ€ ğŸ“¦ æ·»åŠ æ‰€æœ‰å˜æ›´æ–‡ä»¶åˆ°æš‚å­˜åŒº ğŸ’¬ ç”Ÿæˆæ™ºèƒ½æäº¤ä¿¡æ¯ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ ğŸš€ æ¨é€åˆ°è¿œç¨‹ä»“åº“ ğŸ¨ å½©è‰²è¾“å‡ºæ˜¾ç¤ºæ¯ä¸ªæ­¥éª¤çŠ¶æ€ âš¡ é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶ ğŸ“¦ ä¸‰ã€æ‰¹é‡é¡¹ç›®æ¨é€è„šæœ¬ ğŸ“‚ åœ¨ FnOS ç»ˆç«¯æ‰§è¡Œæ‰¹é‡æ¨é€ 1 2 cd /vol1/1000/home \u0026amp;\u0026amp; \\ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_push_all.sh) ğŸ’» ä» Windows Git Bash è¿œç¨‹æ‰§è¡Œæ‰¹é‡æ¨é€ 1 ssh fnos \u0026#34;cd /vol1/1000/home \u0026amp;\u0026amp; bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_push_all.sh)\u0026#34; æ‰¹é‡æ¨é€è„šæœ¬åŠŸèƒ½ï¼š\nğŸ”„ é€’å½’æœç´¢æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ Git ä»“åº“ ğŸ“Š æ˜¾ç¤ºæ¯ä¸ªä»“åº“çš„æ¨é€çŠ¶æ€æ±‡æ€» â±ï¸ æ˜¾ç¤ºæ¯ä¸ªä»“åº“çš„æ“ä½œè€—æ—¶ ğŸ¯ æ™ºèƒ½è·³è¿‡æ— éœ€æ¨é€çš„ä»“åº“ ğŸ“ ç”Ÿæˆè¯¦ç»†çš„æ¨é€æŠ¥å‘Šæ‘˜è¦ ğŸ› ï¸ å››ã€è„šæœ¬æºç å‚è€ƒ ğŸ” åè®®åˆ‡æ¢è„šæœ¬ (git_ssh_config.sh) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 #!/bin/bash # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; echo -e \u0026#34;${BLUE}ğŸ”§ åˆ‡æ¢åˆ° SSH åè®®...${NC}\u0026#34; # æ£€æŸ¥æ˜¯å¦ä¸º Git ä»“åº“ if [ ! -d .git ]; then echo -e \u0026#34;${RED}âŒ å½“å‰ç›®å½•ä¸æ˜¯ Git ä»“åº“ï¼${NC}\u0026#34; exit 1 fi # è·å–å½“å‰è¿œç¨‹ URL CURRENT_URL=$(git remote get-url origin 2\u0026gt;/dev/null) if [ -z \u0026#34;$CURRENT_URL\u0026#34; ]; then echo -e \u0026#34;${RED}âŒ æœªé…ç½®è¿œç¨‹ä»“åº“ï¼${NC}\u0026#34; exit 1 fi echo -e \u0026#34;ğŸ“¡ å½“å‰è¿œç¨‹: ${YELLOW}$CURRENT_URL${NC}\u0026#34; # è½¬æ¢ä¸º SSH åè®® if [[ $CURRENT_URL == https://* ]]; then # HTTPS è½¬ SSH SSH_URL=$(echo $CURRENT_URL | sed \u0026#39;s|https://|git@|\u0026#39; | sed \u0026#39;s|/|:|\u0026#39;) git remote set-url origin \u0026#34;$SSH_URL\u0026#34; echo -e \u0026#34;${GREEN}âœ… å·²åˆ‡æ¢åˆ° SSH åè®®: $SSH_URL${NC}\u0026#34; elif [[ $CURRENT_URL == git@* ]]; then echo -e \u0026#34;${YELLOW}âš ï¸ å·²ç»æ˜¯ SSH åè®®ï¼Œæ— éœ€åˆ‡æ¢${NC}\u0026#34; else echo -e \u0026#34;${RED}âŒ ä¸æ”¯æŒçš„åè®®æ ¼å¼${NC}\u0026#34; exit 1 fi ğŸš€ å•ä¸ªé¡¹ç›®æ¨é€è„šæœ¬ (git_push.sh) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 #!/bin/bash # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; CYAN=\u0026#39;\\033[0;36m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; echo -e \u0026#34;${CYAN}ğŸš€ å¼€å§‹ Git æ¨é€æµç¨‹...${NC}\u0026#34; # æ£€æŸ¥æ˜¯å¦ä¸º Git ä»“åº“ if [ ! -d .git ]; then echo -e \u0026#34;${RED}âŒ å½“å‰ç›®å½•ä¸æ˜¯ Git ä»“åº“ï¼${NC}\u0026#34; exit 1 fi # è·å–ä»“åº“ä¿¡æ¯ REPO_NAME=$(basename -s .git $(git config --get remote.origin.url)) CURRENT_BRANCH=$(git branch --show-current) REMOTE_URL=$(git remote get-url origin) echo -e \u0026#34;ğŸ“¦ ä»“åº“: ${GREEN}$REPO_NAME${NC}\u0026#34; echo -e \u0026#34;ğŸŒ¿ åˆ†æ”¯: ${YELLOW}$CURRENT_BRANCH${NC}\u0026#34; echo -e \u0026#34;ğŸŒ è¿œç¨‹: ${BLUE}$REMOTE_URL${NC}\u0026#34; echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´ if [ -z \u0026#34;$(git status --porcelain)\u0026#34; ]; then echo -e \u0026#34;${YELLOW}âš ï¸ æ²¡æœ‰éœ€è¦æäº¤çš„å˜æ›´${NC}\u0026#34; exit 0 fi # æ˜¾ç¤ºå˜æ›´çŠ¶æ€ echo -e \u0026#34;ğŸ“‹ å˜æ›´æ–‡ä»¶:\u0026#34; git status -s # æ·»åŠ æ‰€æœ‰å˜æ›´ echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; echo -e \u0026#34;ğŸ“¥ æ·»åŠ å˜æ›´æ–‡ä»¶...\u0026#34; git add . # æäº¤å˜æ›´ COMMIT_MSG=\u0026#34;Update: $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;)\u0026#34; echo -e \u0026#34;ğŸ’¬ æäº¤ä¿¡æ¯: ${YELLOW}$COMMIT_MSG${NC}\u0026#34; if git commit -m \u0026#34;$COMMIT_MSG\u0026#34;; then echo -e \u0026#34;${GREEN}âœ… æäº¤æˆåŠŸ${NC}\u0026#34; else echo -e \u0026#34;${RED}âŒ æäº¤å¤±è´¥${NC}\u0026#34; exit 1 fi # æ¨é€åˆ°è¿œç¨‹ echo -e \u0026#34;${BLUE}========================================${NC}\u0026#34; echo -e \u0026#34;ğŸš€ æ¨é€åˆ°è¿œç¨‹ä»“åº“...\u0026#34; if git push origin $CURRENT_BRANCH; then echo -e \u0026#34;${GREEN}âœ… æ¨é€æˆåŠŸå®Œæˆï¼${NC}\u0026#34; else echo -e \u0026#34;${RED}âŒ æ¨é€å¤±è´¥ï¼${NC}\u0026#34; exit 1 fi echo -e \u0026#34;${GREEN}ğŸ‰ æ‰€æœ‰æ“ä½œå®Œæˆï¼${NC}\u0026#34; âš™ï¸ äº”ã€å®‰è£…å’Œè‡ªå®šä¹‰é…ç½® 1. ğŸ“¥ æœ¬åœ°å®‰è£…è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 # ä¸‹è½½åè®®åˆ‡æ¢è„šæœ¬ curl -o ~/git_ssh_config.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git_ssh_config.sh curl -o ~/git_https_config.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git_https_config.sh # ä¸‹è½½æ¨é€è„šæœ¬ curl -o ~/git_push.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git_push.sh curl -o ~/git_push_all.sh https://gitee.com/meimolihan/script/raw/master/sh/git/git_push_all.sh # æ·»åŠ æ‰§è¡Œæƒé™ chmod +x ~/git_*.sh 2. ğŸ”¤ åˆ›å»ºä¾¿æ·å‘½ä»¤åˆ«å 1 2 3 4 # æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc alias git-push-ssh=\u0026#39;bash ~/git_ssh_config.sh \u0026amp;\u0026amp; bash ~/git_push.sh\u0026#39; alias git-push-https=\u0026#39;bash ~/git_https_config.sh \u0026amp;\u0026amp; bash ~/git_push.sh\u0026#39; alias git-push-all=\u0026#39;bash ~/git_push_all.sh\u0026#39; 3. ğŸ“ å…¨å±€å®‰è£…åˆ°ç³»ç»Ÿ 1 2 3 4 5 6 7 8 # ç§»åŠ¨åˆ°ç³»ç»Ÿå‘½ä»¤ç›®å½• sudo mv ~/git_ssh_config.sh /usr/local/bin/git-ssh-config sudo mv ~/git_https_config.sh /usr/local/bin/git-https-config sudo mv ~/git_push.sh /usr/local/bin/git-push sudo mv ~/git_push_all.sh /usr/local/bin/git-push-all # ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ git-ssh-config \u0026amp;\u0026amp; git-push ğŸ”§ å…­ã€é«˜çº§ç”¨æ³•å’Œè‡ªå®šä¹‰ 1. ğŸ’¬ è‡ªå®šä¹‰æäº¤ä¿¡æ¯ 1 2 # ä¿®æ”¹ git_push.sh ä¸­çš„æäº¤ä¿¡æ¯ COMMIT_MSG=\u0026#34;ä½ çš„è‡ªå®šä¹‰æäº¤ä¿¡æ¯ $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;)\u0026#34; 2. ğŸ¯ é€‰æ‹©æ€§æ·»åŠ æ–‡ä»¶ 1 2 3 # ä¿®æ”¹æ·»åŠ æ­¥éª¤ä¸ºé€‰æ‹©æ€§æ·»åŠ  echo -e \u0026#34;ğŸ“¥ æ·»åŠ å˜æ›´æ–‡ä»¶...\u0026#34; git add -p # äº¤äº’å¼æ·»åŠ  3. ğŸŒ¿ æ¨é€åˆ°ç‰¹å®šåˆ†æ”¯ 1 2 # ä¿®æ”¹æ¨é€å‘½ä»¤æŒ‡å®šåˆ†æ”¯ git push origin main # æ¨é€åˆ° main åˆ†æ”¯ 4. âš¡ å¼ºåˆ¶æ¨é€ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ 1 2 # æ·»åŠ å¼ºåˆ¶æ¨é€é€‰é¡¹ git push --force-with-lease origin $CURRENT_BRANCH ğŸš¨ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ” æƒé™éªŒè¯ï¼šç¡®ä¿æœ‰æ¨é€æƒé™ï¼Œç‰¹åˆ«æ˜¯å¼ºåˆ¶æ¨é€ ğŸ” ä»£ç å®¡æŸ¥ï¼šæ¨é€å‰æ£€æŸ¥å˜æ›´å†…å®¹ ğŸ’¾ å¤‡ä»½é‡è¦ä»£ç ï¼šé‡è¦å˜æ›´å»ºè®®å…ˆåˆ›å»ºå¤‡ä»½ ğŸ›¡ï¸ åˆ†æ”¯ä¿æŠ¤ï¼šé¿å…ç›´æ¥æ¨é€åˆ°å—ä¿æŠ¤çš„åˆ†æ”¯ ğŸ”’ æ•æ„Ÿä¿¡æ¯ï¼šç¡®ä¿ä¸æ¨é€æ•æ„Ÿä¿¡æ¯å’Œé…ç½®æ–‡ä»¶ ğŸ” å®‰å…¨æ£€æŸ¥å‘½ä»¤ 1 2 3 4 5 # æ£€æŸ¥å°†è¦æ¨é€çš„å†…å®¹ git log --oneline origin/main..HEAD # æ£€æŸ¥æ–‡ä»¶å˜æ›´è¯¦æƒ… git diff --staged ğŸ’¡ å…«ã€å¸¸è§é—®é¢˜è§£ç­” â“ æ¨é€æƒé™è¢«æ‹’ç» è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 # æ£€æŸ¥ SSH å¯†é’¥é…ç½® ssh -T git@github.com # æˆ–é…ç½® HTTPS å‡­æ®å­˜å‚¨ git config --global credential.helper store â“ å†²çªæ— æ³•æ¨é€ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 # å…ˆæ‹‰å–æœ€æ–°å˜æ›´ git pull --rebase origin main # è§£å†³å†²çªåé‡æ–°æ¨é€ git push origin main â“ è¿œç¨‹ä»“åº“ä¸å­˜åœ¨ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 # æ·»åŠ è¿œç¨‹ä»“åº“ git remote add origin git@github.com:username/repo.git # æˆ–åˆ›å»ºæ–°ä»“åº“åæ¨é€ git push -u origin main â“ å¤§æ–‡ä»¶æ¨é€å¤±è´¥ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 # ä½¿ç”¨ Git LFS ç®¡ç†å¤§æ–‡ä»¶ git lfs track \u0026#34;*.psd\u0026#34; git add .gitattributes git add file.psd git commit -m \u0026#34;Add large file\u0026#34; git push origin main ğŸ“Š ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® âš¡ åˆ†æ‰¹æ¨é€ï¼šå¤§é‡å˜æ›´æ—¶åˆ†å¤šæ¬¡æ¨é€ ğŸ” ä½¿ç”¨ SSHï¼šSSH åè®®é€šå¸¸æ¯” HTTPS æ›´å¿« ğŸ—œï¸ å‹ç¼©æ•°æ®ï¼šå¯ç”¨ Git å‹ç¼©åŠŸèƒ½ ğŸ“‰ æµ…å±‚æ¨é€ï¼šå¯¹äºå¤§å‹ä»“åº“è€ƒè™‘æµ…å±‚æ“ä½œ ğŸ”€ å¹¶è¡Œæ“ä½œï¼šæ‰¹é‡è„šæœ¬å¯ä¼˜åŒ–ä¸ºå¹¶è¡Œæ‰§è¡Œ ğŸ—œï¸ å¯ç”¨å‹ç¼©é…ç½® 1 2 3 # é…ç½® Git å‹ç¼© git config --global core.compression 9 git config --global pack.depth 50 ğŸ”„ åã€å·¥ä½œæµé›†æˆ 1. ğŸ¤– ç»“åˆ CI/CD æµç¨‹ 1 2 3 4 5 6 7 # åœ¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸­ä½¿ç”¨ #!/bin/bash set -e # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º # åˆ‡æ¢åè®®å¹¶æ¨é€ bash git_ssh_config.sh bash git_push.sh 2. ğŸª é¢„æ¨é€é’©å­ï¼ˆpre-push hookï¼‰ 1 2 3 4 # åˆ›å»º .git/hooks/pre-push #!/bin/bash # è¿è¡Œæµ‹è¯• before æ¨é€ npm test \u0026amp;\u0026amp; echo \u0026#34;æµ‹è¯•é€šè¿‡ï¼Œå¼€å§‹æ¨é€\u0026#34; || exit 1 3. â° å®šæ—¶è‡ªåŠ¨æ¨é€ 1 2 # ä½¿ç”¨ crontab å®šæ—¶æ¨é€ 0 18 * * * cd /path/to/repo \u0026amp;\u0026amp; /usr/local/bin/git-push ğŸ¯ æç¤ºï¼šè¿™äº›è„šæœ¬éå¸¸é€‚åˆè‡ªåŠ¨åŒ–æ—¥å¸¸æ¨é€æµç¨‹ã€æ‰¹é‡ç®¡ç†å¤šä¸ªé¡¹ç›®ï¼Œæˆ–è€…é›†æˆåˆ°æ›´å¤æ‚çš„ DevOps å·¥ä½œæµä¸­ã€‚å»ºè®®æ ¹æ®å›¢é˜Ÿè§„èŒƒå’Œä¸ªäººä¹ æƒ¯è¿›è¡Œé€‚å½“çš„å®šåˆ¶ã€‚\nå¸Œæœ›è¿™äº› Git è‡ªåŠ¨åŒ–æ¨é€è„šæœ¬èƒ½å¤§å¤§æé«˜æ‚¨çš„å·¥ä½œæ•ˆç‡ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆå’Œæ”¹è¿›ã€‚\n","date":"2025-08-26T15:54:28+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/530282cc/","title":"Git è‡ªåŠ¨åŒ–æ¨é€æ›´æ–°è„šæœ¬ ğŸš€"},{"content":"Git æ‰¹é‡æ¸…é™¤ç¼“å­˜æ–‡ä»¶ ğŸ“â¡ï¸ğŸ—‘ï¸ åŠŸèƒ½ç®€ä»‹ ğŸš€ æœ¬æ–‡æä¾›äº†ä¸¤ä¸ªå®ç”¨è„šæœ¬ï¼Œå¸®åŠ©æ‚¨æ‰¹é‡æ¸…é™¤å¤šä¸ª Git ä»“åº“ä¸­çš„ç¼“å­˜æ–‡ä»¶ã€‚ä½¿ç”¨è¿™äº›è„šæœ¬å¯ä»¥å¿«é€Ÿã€é«˜æ•ˆåœ°å¤„ç†å¤§é‡ Git é¡¹ç›®ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦åŒæ—¶ç®¡ç†å¤šä¸ªä»“åº“çš„å¼€å‘è€…ã€‚\nä¸»è¦ç‰¹ç‚¹ âœ¨ ğŸ” è‡ªåŠ¨é€’å½’æŸ¥æ‰¾ï¼šè‡ªåŠ¨æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ Git ä»“åº“ âš¡ æ‰¹é‡å¤„ç†ï¼šä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªé¡¹ç›®ï¼ŒèŠ‚çœæ—¶é—´ ğŸ”’ å®‰å…¨æ“ä½œï¼šä½¿ç”¨ --cached å‚æ•°ï¼Œç¡®ä¿ä¸ä¼šåˆ é™¤å®é™…æ–‡ä»¶ ğŸŒ è¿œç¨‹æ”¯æŒï¼šæä¾›æœ¬åœ°å’Œè¿œç¨‹ä¸¤ç§æ‰§è¡Œæ–¹å¼ è„šæœ¬è¯¦æƒ… ä¸€ã€æœ¬åœ°æ‰¹é‡æ¸…é™¤ç¼“å­˜æ–‡ä»¶è„šæœ¬ ğŸ“‚ æ­¤è„šæœ¬ä¼šåœ¨æŒ‡å®šç›®å½•ä¸­æŸ¥æ‰¾æ‰€æœ‰åŒ…å« .git æ–‡ä»¶å¤¹çš„å­ç›®å½•ï¼Œå¹¶å¯¹æ¯ä¸ª Git ä»“åº“æ‰§è¡Œ git rm --cached -r . å‘½ä»¤æ¥æ¸…é™¤ç¼“å­˜ã€‚\nä½¿ç”¨æ–¹æ³•ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºå¹¶ç¼–è¾‘è„šæœ¬ touch git_rm_cached.sh \u0026amp;\u0026amp; \\ cat \u0026gt; git_rm_cached.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash find \u0026#34;$1\u0026#34; -type d -name .git -exec dirname {} \\; | while read -r repo_dir; do cd \u0026#34;$repo_dir\u0026#34; || continue echo \u0026#34;æ­£åœ¨å¤„ç†ä»“åº“ï¼š$repo_dir\u0026#34; git rm --cached -r . done EOF # æ·»åŠ æ‰§è¡Œæƒé™ chmod +x git_rm_cached.sh # è¿è¡Œè„šæœ¬ï¼ˆè¯·å°† /vol1/1000/compose æ›¿æ¢ä¸ºæ‚¨è¦æ‰«æçš„å®é™…è·¯å¾„ï¼‰ bash git_rm_cached.sh /vol1/1000/compose äºŒã€è¿œç¨‹æ‰¹é‡æ¸…é™¤ç¼“å­˜æ–‡ä»¶è„šæœ¬ ğŸŒ å¦‚æœæ‚¨ä¸æƒ³æ‰‹åŠ¨åˆ›å»ºè„šæœ¬ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿œç¨‹è„šæœ¬æ‰§è¡Œç›¸åŒæ“ä½œã€‚\nä½¿ç”¨æ–¹æ³•ï¼š 1 2 3 bash \u0026lt;(curl -sL https://gitee.com/meimolihan/script/raw/master/sh/git/git_rm_cached.sh) ./hugo-main cd hugo-main ; git add . ; git commit -m \u0026#34;update\u0026#34; ; git push ä½¿ç”¨åœºæ™¯ ğŸ¯ å¤§é‡æ–‡ä»¶è¯¯åŠ å…¥ç¼“å­˜ï¼šå½“æ„å¤–å°†å¤§é‡æ–‡ä»¶ï¼ˆå¦‚æ—¥å¿—ã€ç¼–è¯‘äº§ç‰©ç­‰ï¼‰åŠ å…¥ Git ç¼“å­˜æ—¶ æ‰¹é‡æ›´æ–°.gitignoreï¼šä¿®æ”¹äº†.gitignore è§„åˆ™åï¼Œéœ€è¦æ¸…é™¤å·²è·Ÿè¸ªçš„ç¼“å­˜æ–‡ä»¶ å¤šé¡¹ç›®ç®¡ç†ï¼šåŒæ—¶å¤„ç†å¤šä¸ªé¡¹ç›®çš„ç¼“å­˜æ¸…ç†å·¥ä½œ æ³¨æ„äº‹é¡¹ âš ï¸ æ‰§è¡Œå‰è¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ® ç¡®è®¤æŒ‡å®šçš„ç›®å½•è·¯å¾„æ­£ç¡®æ— è¯¯ æ¸…é™¤ç¼“å­˜æ“ä½œä¸ä¼šåˆ é™¤ç‰©ç†æ–‡ä»¶ï¼Œåªä¼šä» Git è·Ÿè¸ªä¸­ç§»é™¤ æ‰§è¡Œåéœ€è¦é‡æ–°æ·»åŠ éœ€è¦è·Ÿè¸ªçš„æ–‡ä»¶ æ€»ç»“ ğŸ“ é€šè¿‡è¿™ä¸¤ä¸ªè„šæœ¬ï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°å¤š Git ä»“åº“çš„ç¼“å­˜æ‰¹é‡æ¸…ç†å·¥ä½œï¼Œå¤§å¤§æé«˜å·¥ä½œæ•ˆç‡ã€‚æ— è®ºæ˜¯æœ¬åœ°è„šæœ¬è¿˜æ˜¯è¿œç¨‹è„šæœ¬ï¼Œéƒ½èƒ½å¸®åŠ©æ‚¨å¿«é€Ÿè§£å†³ Git ç¼“å­˜ç®¡ç†çš„é—®é¢˜ã€‚\nå¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆï¼ ğŸ˜Š\n","date":"2025-08-26T15:52:24+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/98b39c73/","title":"Git æ‰¹é‡æ¸…é™¤ç¼“å­˜æ–‡ä»¶ ğŸ“â¡ï¸ğŸ—‘ï¸"},{"content":"Git è¿æ¥é…ç½®è„šæœ¬ SSH ä¸ HTTPS è½»æ¾åˆ‡æ¢ ğŸ”„ å½“å‰ä»“åº“åˆ‡æ¢ä¸ºï¼šSSH è¿æ¥/https è¿æ¥\nç›®å½•å¯¼èˆª ğŸ§­ ğŸ” æŸ¥çœ‹å½“å‰ä»“åº“é…ç½® ğŸ”‘ Git SSH é…ç½®è„šæœ¬ ğŸŒ Git HTTPS é…ç½®è„šæœ¬ ğŸ’¡ ä½¿ç”¨åœºæ™¯ä¸ä¼˜åŠ¿ âš™ï¸ è„šæœ¬åŠŸèƒ½è¯¦è§£ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ› ï¸ æ‰‹åŠ¨é…ç½®æ–¹æ³• ä¸€ã€æŸ¥çœ‹å½“å‰ä»“åº“é…ç½®çš„è¿œç¨‹ä»“åº“ä¿¡æ¯ ğŸ” åœ¨æ‰§è¡Œä»»ä½•æ›´æ”¹ä¹‹å‰ï¼Œæœ€å¥½å…ˆæ£€æŸ¥å½“å‰çš„è¿œç¨‹ä»“åº“é…ç½®ï¼š\n1 git remote -v è¿™æ¡å‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰é…ç½®çš„è¿œç¨‹ä»“åº“åœ°å€ï¼Œå¸®åŠ©ä½ ç¡®è®¤å½“å‰ä½¿ç”¨çš„æ˜¯ SSH è¿˜æ˜¯ HTTPS åè®®ã€‚\nâœ¨ æç¤ºï¼šä½ è¿˜å¯ä»¥ä½¿ç”¨ git config --get remote.origin.url æ¥åªè·å– origin è¿œç¨‹ä»“åº“çš„ URLã€‚\näºŒã€Git SSH é…ç½®è„šæœ¬ ğŸ”‘ âœ… è‡ªåŠ¨å°†å½“å‰ç›®å½•è®¾ç½®ä¸º Git å®‰å…¨ç›®å½• âœ… å°†å½“å‰ä»“åº“ä¿®æ”¹ä¸º SSH è¿æ¥æ–¹å¼ âœ… ä¸€é”®å®Œæˆé…ç½®å¹¶æ¨é€æ›´æ”¹ 1 2 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_ssh_config.sh) \u0026amp;\u0026amp; \\ git add . ; git commit -m \u0026#34;update\u0026#34; ; git push SSH è¿æ¥çš„ä¼˜åŠ¿ï¼š ğŸ”’ æ›´å®‰å…¨ï¼šä½¿ç”¨å¯†é’¥å¯¹è®¤è¯ï¼Œæ— éœ€ä¼ è¾“å¯†ç  âš¡ æ›´å¿«é€Ÿï¼šè¿æ¥å»ºç«‹åæ— éœ€æ¯æ¬¡éªŒè¯ ğŸ”‘ å…å¯†ç æ¨é€ï¼šé…ç½® SSH å¯†é’¥åæ— éœ€æ¯æ¬¡è¾“å…¥å¯†ç  ğŸ¢ é€‚åˆå›¢é˜Ÿï¼šä¼ä¸šç¯å¢ƒé€šå¸¸æ¨èä½¿ç”¨ SSH æ–¹å¼ ä¸‰ã€Git HTTPS é…ç½®è„šæœ¬ ğŸŒ âœ… è‡ªåŠ¨å°†å½“å‰ç›®å½•è®¾ç½®ä¸º Git å®‰å…¨ç›®å½• âœ… å°†å½“å‰ä»“åº“ä¿®æ”¹ä¸º HTTPS è¿æ¥æ–¹å¼ âœ… ä¸€é”®å®Œæˆé…ç½®å¹¶æ¨é€æ›´æ”¹ 1 2 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/git_https_config.sh) \u0026amp;\u0026amp; \\ git add . ; git commit -m \u0026#34;update\u0026#34; ; git push HTTPS è¿æ¥çš„ä¼˜åŠ¿ï¼š ğŸŒ é€šç”¨æ€§å¼ºï¼šé€‚ç”¨äºæ‰€æœ‰ç½‘ç»œç¯å¢ƒï¼Œå³ä½¿é˜²ç«å¢™é™åˆ¶ SSH ğŸ”“ æ˜“äºè®¾ç½®ï¼šä¸éœ€è¦ç”Ÿæˆå’Œé…ç½® SSH å¯†é’¥ ğŸ‘¤ èº«ä»½éªŒè¯çµæ´»ï¼šæ”¯æŒä¸ªäººè®¿é—®ä»¤ç‰Œ(PAT)å’Œå¯†ç  ğŸ  é€‚åˆå®¶ç”¨ï¼šåœ¨å®¶åº­ç½‘ç»œæˆ–å…¬å…±ç½‘ç»œä¸­æ›´å®¹æ˜“ä½¿ç”¨ å››ã€ä½¿ç”¨åœºæ™¯ä¸ä¼˜åŠ¿ ğŸ’¡ ä½•æ—¶ä½¿ç”¨ SSH è¿æ¥ï¼Ÿ ğŸ¢ ä¼ä¸šå¼€å‘ç¯å¢ƒï¼šå†…éƒ¨ç½‘ç»œé€šå¸¸æ”¯æŒ SSH ğŸ”§ é¢‘ç¹æ“ä½œä»“åº“ï¼šé¿å…å¤šæ¬¡è¾“å…¥å¯†ç  ğŸ”’ å®‰å…¨æ€§è¦æ±‚é«˜ï¼šä½¿ç”¨å¯†é’¥è®¤è¯æ›´å®‰å…¨ âš¡ éœ€è¦æœ€ä½³æ€§èƒ½ï¼šSSH è¿æ¥é€šå¸¸æ›´ç¨³å®šå¿«é€Ÿ ä½•æ—¶ä½¿ç”¨ HTTPS è¿æ¥ï¼Ÿ ğŸ  å®¶åº­æˆ–å…¬å…±ç½‘ç»œï¼šæ›´å®¹æ˜“é€šè¿‡é˜²ç«å¢™ ğŸš€ å¿«é€Ÿä¸´æ—¶è®¿é—®ï¼šä¸éœ€è¦é…ç½® SSH å¯†é’¥ ğŸ‘¥ è´¡çŒ®å¼€æºé¡¹ç›®ï¼šè®¸å¤šå¼€æºé¡¹ç›®æ¨è HTTPS ğŸ“± è·¨è®¾å¤‡å·¥ä½œï¼šåœ¨ä¸åŒè®¾å¤‡ä¸Šå¿«é€Ÿå…‹éš†ä»“åº“ è„šæœ¬ä¼˜åŠ¿ï¼š âš¡ ä¸€é”®åˆ‡æ¢ï¼šæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ Git é…ç½® ğŸ”§ è‡ªåŠ¨å®‰å…¨è®¾ç½®ï¼šè‡ªåŠ¨é…ç½® Git å®‰å…¨ç›®å½• ğŸ“¦ å®Œæ•´å·¥ä½œæµï¼šåŒ…å«æäº¤å’Œæ¨é€æ­¥éª¤ ğŸŒ å¤šå¹³å°æ”¯æŒï¼šé€‚ç”¨äº Linuxã€macOS å’Œ WSL äº”ã€è„šæœ¬åŠŸèƒ½è¯¦è§£ âš™ï¸ Git SSH é…ç½®è„šæœ¬åŠŸèƒ½ï¼š ğŸ” è®¾ç½®å½“å‰ç›®å½•ä¸º Git å®‰å…¨ç›®å½• ğŸ”„ ä¿®æ”¹è¿œç¨‹ä»“åº“ URL ä¸º SSH æ ¼å¼ ğŸ“ éªŒè¯æ›´æ”¹æ˜¯å¦æˆåŠŸ âœ… æä¾›å¯è§†åŒ–åé¦ˆ Git HTTPS é…ç½®è„šæœ¬åŠŸèƒ½ï¼š ğŸ” è®¾ç½®å½“å‰ç›®å½•ä¸º Git å®‰å…¨ç›®å½• ğŸ”„ ä¿®æ”¹è¿œç¨‹ä»“åº“ URL ä¸º HTTPS æ ¼å¼ ğŸ“ éªŒè¯æ›´æ”¹æ˜¯å¦æˆåŠŸ âœ… æä¾›å¯è§†åŒ–åé¦ˆ è„šæœ¬æ‰§è¡Œæµç¨‹ï¼š ğŸ“‚ æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦ä¸º Git ä»“åº“ ğŸ” æ£€æŸ¥å½“å‰è¿œç¨‹ä»“åº“é…ç½® âš™ï¸ ä¿®æ”¹è¿œç¨‹ä»“åº“ URL âœ… éªŒè¯ä¿®æ”¹ç»“æœ ğŸš€ æ‰§è¡Œåç»­ Git æ“ä½œï¼ˆæ·»åŠ ã€æäº¤ã€æ¨é€ï¼‰ å…­ã€æ³¨æ„äº‹é¡¹ âš ï¸ æƒé™è¦æ±‚ï¼šç¡®ä¿ä½ æœ‰æƒé™ä¿®æ”¹è¿œç¨‹ä»“åº“é…ç½® ç½‘ç»œè¿æ¥ï¼šæ‰§è¡Œè„šæœ¬å‰è¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ è„šæœ¬æ¥æºï¼šåªè¿è¡Œæ¥è‡ªå¯ä¿¡æºçš„è„šæœ¬ å¯†é’¥é…ç½®ï¼šä½¿ç”¨ SSH å‰éœ€å…ˆé…ç½® SSH å¯†é’¥ å‡­è¯å­˜å‚¨ï¼šHTTPS æ–¹å¼å¯èƒ½éœ€è¦é…ç½®å‡­è¯å­˜å‚¨ å¤‡ä»½é‡è¦æ•°æ®ï¼šåœ¨æ‰§è¡Œä»»ä½•è‡ªåŠ¨åŒ–è„šæœ¬å‰å¤‡ä»½é‡è¦æ›´æ”¹ å¸¸è§é—®é¢˜è§£å†³ï¼š SSH è¿æ¥é—®é¢˜ï¼š\n1 2 3 4 5 # æ£€æŸ¥ SSH å¯†é’¥æ˜¯å¦å·²æ·»åŠ è‡³ ssh-agent ssh-add -l # æµ‹è¯• SSH è¿æ¥ ssh -T git@gitee.com HTTPS è®¤è¯é—®é¢˜ï¼š\n1 2 3 4 5 # é…ç½® Git å‡­è¯å­˜å‚¨ git config --global credential.helper store # æ¸…é™¤ç¼“å­˜çš„å‡­æ® git credential reject ä¸ƒã€æ‰‹åŠ¨é…ç½®æ–¹æ³• ğŸ› ï¸ å¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨è„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€ï¼š\næ‰‹åŠ¨åˆ‡æ¢åˆ° SSHï¼š 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰è¿œç¨‹ä»“åº“ URL git remote -v # ä¿®æ”¹ä¸º SSH æ ¼å¼ git remote set-url origin git@gitee.com:username/repository.git # éªŒè¯ä¿®æ”¹ git remote -v æ‰‹åŠ¨åˆ‡æ¢åˆ° HTTPSï¼š 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰è¿œç¨‹ä»“åº“ URL git remote -v # ä¿®æ”¹ä¸º HTTPS æ ¼å¼ git remote set-url origin https://gitee.com/username/repository.git # éªŒè¯ä¿®æ”¹ git remote -v æ‰‹åŠ¨è®¾ç½®å®‰å…¨ç›®å½•ï¼š 1 2 3 4 5 # è®¾ç½®å½“å‰ç›®å½•ä¸ºå®‰å…¨ç›®å½• git config --global --add safe.directory $(pwd) # éªŒè¯è®¾ç½® git config --global --get-all safe.directory æ€»ç»“ ğŸ¯ é€šè¿‡ä½¿ç”¨è¿™äº›è„šæœ¬ï¼Œä½ å¯ä»¥è½»æ¾åœ¨ SSH å’Œ HTTPS åè®®ä¹‹é—´åˆ‡æ¢ Git è¿œç¨‹ä»“åº“è¿æ¥æ–¹å¼ã€‚SSH æä¾›æ›´å®‰å…¨å’Œé«˜æ•ˆçš„è¿æ¥ï¼Œè€Œ HTTPS åˆ™æ›´é€šç”¨å’Œæ˜“äºè®¾ç½®ã€‚æ ¹æ®ä½ çš„ç½‘ç»œç¯å¢ƒå’Œå·¥ä½œæµç¨‹é€‰æ‹©æœ€é€‚åˆçš„è¿æ¥æ–¹å¼ã€‚\næ— è®ºé€‰æ‹©å“ªç§æ–¹å¼ï¼Œè®°å¾—å®šæœŸæ£€æŸ¥ä½ çš„è¿æ¥å®‰å…¨æ€§ï¼Œå¹¶ç¡®ä¿ä½ çš„å‡­è¯å’Œå¯†é’¥å¾—åˆ°å¦¥å–„ä¿ç®¡ã€‚ Happy coding! ğŸš€\n","date":"2025-08-26T15:50:50+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3d640d7e/","title":"Git è¿æ¥é…ç½®è„šæœ¬ SSH ä¸ HTTPS è½»æ¾åˆ‡æ¢ ğŸ”„"},{"content":"Git æ–°ä»“åº“åˆå§‹åŒ–è„šæœ¬ ğŸ“ ä¸€é”®è‡ªåŠ¨åŒ–åˆ›å»ºå’Œåˆå§‹åŒ– Git ä»“åº“çš„ä¾¿æ·å·¥å…·ï¼Œæ”¯æŒ Giteeã€GitHub å’Œ Gitea å¹³å°\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ è„šæœ¬åŠŸèƒ½æ¦‚è¿° ğŸš€ ä¸€ã€Gitee æ–°ä»“åº“åˆå§‹åŒ– ğŸŒ äºŒã€GitHub æ–°ä»“åº“åˆå§‹åŒ– ğŸ  ä¸‰ã€Gitea æ–°ä»“åº“åˆå§‹åŒ– ğŸ› ï¸ å››ã€è„šæœ¬æºç å‚è€ƒ âš™ï¸ äº”ã€é…ç½®å’Œå‡†å¤‡å·¥ä½œ ğŸ”§ å…­ã€é«˜çº§é…ç½®é€‰é¡¹ ğŸ’¡ ä¸ƒã€ä½¿ç”¨æŠ€å·§ ğŸš¨ å…«ã€æ³¨æ„äº‹é¡¹ ğŸ”„ ä¹ã€æ•…éšœæ’é™¤ ğŸ“Š åã€å„å¹³å°ç‰¹æ€§å¯¹æ¯” âœ¨ è„šæœ¬åŠŸèƒ½æ¦‚è¿° æœ¬æŒ‡å—æä¾›ä¸‰ä¸ªä¸»æµ Git å¹³å°çš„ä»“åº“åˆå§‹åŒ–è„šæœ¬ï¼š\nGitee ä»“åº“åˆå§‹åŒ– - å›½å†…ç äº‘å¹³å° GitHub ä»“åº“åˆå§‹åŒ– - å…¨çƒæœ€å¤§ä»£ç æ‰˜ç®¡å¹³å° Gitea ä»“åº“åˆå§‹åŒ– - è‡ªå»º Git æœåŠ¡å¹³å° æ ¸å¿ƒä¼˜åŠ¿ï¼š\nâš¡ ä¸€é”®è‡ªåŠ¨åŒ–åˆå§‹åŒ–æµç¨‹ ğŸ”„ æ”¯æŒå¤šä¸ªä¸»æµ Git å¹³å° ğŸ“ è‡ªåŠ¨åˆ›å»ºæ ‡å‡†é¡¹ç›®ç»“æ„ ğŸ” å®‰å…¨çš„è®¤è¯å’Œæƒé™ç®¡ç† ğŸ›¡ï¸ å†…ç½®æœ€ä½³å®è·µé…ç½® ğŸš€ ä¸€ã€Gitee æ–°ä»“åº“åˆå§‹åŒ– æ‰§è¡Œ Gitee ä»“åº“åˆ›å»ºè„šæœ¬ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/gitee_new_godown.sh) åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸ“ è‡ªåŠ¨åˆ›å»º Gitee æ–°ä»“åº“ ğŸ”§ åˆå§‹åŒ–æœ¬åœ° Git é…ç½® ğŸ”— è®¾ç½®è¿œç¨‹ä»“åº“è¿æ¥ ğŸ“ åˆ›å»ºæ ‡å‡†çš„ç›®å½•ç»“æ„ ğŸ“„ æ·»åŠ åŸºç¡€é…ç½®æ–‡ä»¶ è¾“å‡ºç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 ğŸš€ å¼€å§‹åˆ›å»º Gitee æ–°ä»“åº“... ğŸ“¦ ä»“åº“åç§°: my-project ğŸ”§ åˆå§‹åŒ– Git ä»“åº“... ğŸ“ åˆ›å»ºåŸºç¡€æ–‡ä»¶... âœ… æœ¬åœ°ä»“åº“åˆå§‹åŒ–å®Œæˆ ğŸ“ è¯·æ‰‹åŠ¨åœ¨ Gitee ä¸Šåˆ›å»ºä»“åº“... ğŸ‰ ä»“åº“åˆå§‹åŒ–æµç¨‹å®Œæˆï¼ ğŸŒ äºŒã€GitHub æ–°ä»“åº“åˆå§‹åŒ– æ‰§è¡Œ GitHub ä»“åº“åˆ›å»ºè„šæœ¬ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/github_new_godown.sh) åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸ™ åˆ›å»º GitHub æ–°ä»“åº“ ğŸ” æ”¯æŒ Personal Access Token è®¤è¯ ğŸŒ è‡ªåŠ¨è®¾ç½®ä»“åº“å¯è§æ€§ï¼ˆPublic/Privateï¼‰ ğŸ“‹ é…ç½®ä»“åº“æè¿°å’Œä¸»é¢˜æ ‡ç­¾ ğŸ›¡ï¸ æ·»åŠ åŸºç¡€çš„å®‰å…¨é…ç½®æ–‡ä»¶ é«˜çº§åŠŸèƒ½ï¼š\nè‡ªåŠ¨åˆ›å»º ISSUE_TEMPLATE å’Œ PULL_REQUEST_TEMPLATE è®¾ç½®åˆ†æ”¯ä¿æŠ¤è§„åˆ™ é…ç½® GitHub Actions å·¥ä½œæµ æ·»åŠ  CODEOWNERS æ–‡ä»¶ ğŸ  ä¸‰ã€Gitea æ–°ä»“åº“åˆå§‹åŒ– æ‰§è¡Œ Gitea ä»“åº“åˆ›å»ºè„šæœ¬ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/gitea_new_godown.sh) åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸ–¥ï¸ æ”¯æŒè‡ªå»º Gitea å®ä¾‹ ğŸ”§ è‡ªå®šä¹‰ä»“åº“é…ç½®é€‰é¡¹ ğŸ‘¥ è®¾ç½®åä½œè€…å’Œå›¢é˜Ÿæƒé™ ğŸ“Š é…ç½®ä»“åº“ç»Ÿè®¡å’Œç›‘æ§ ğŸ”„ æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ é…ç½®é€‰é¡¹ï¼š\n1 2 3 4 5 6 7 8 # è®¾ç½® Gitea å®ä¾‹åœ°å€ export GITEA_URL=\u0026#34;https://git.example.com\u0026#34; # è®¾ç½®è®¤è¯ä»¤ç‰Œ export GITEA_TOKEN=\u0026#34;your-access-token\u0026#34; # è®¾ç½®ç»„ç»‡/ç”¨æˆ· export GITEA_OWNER=\u0026#34;username-or-org\u0026#34; ğŸ› ï¸ å››ã€è„šæœ¬æºç å‚è€ƒ Gitee ä»“åº“åˆå§‹åŒ–è„šæœ¬ (gitee_new_godown.sh) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 #!/bin/bash # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; CYAN=\u0026#39;\\033[0;36m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; echo -e \u0026#34;${CYAN}ğŸš€ å¼€å§‹åˆ›å»º Gitee æ–°ä»“åº“...${NC}\u0026#34; # è·å–å½“å‰ç›®å½•åä½œä¸ºä»“åº“å REPO_NAME=$(basename \u0026#34;$PWD\u0026#34;) echo -e \u0026#34;ğŸ“¦ ä»“åº“åç§°: ${GREEN}$REPO_NAME${NC}\u0026#34; # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ Git ä»“åº“ if [ -d .git ]; then echo -e \u0026#34;${YELLOW}âš ï¸ å½“å‰ç›®å½•å·²ç»æ˜¯ Git ä»“åº“${NC}\u0026#34; exit 1 fi # åˆå§‹åŒ– Git ä»“åº“ echo -e \u0026#34;${BLUE}ğŸ”§ åˆå§‹åŒ– Git ä»“åº“...${NC}\u0026#34; git init git branch -M main # åˆ›å»ºåŸºç¡€æ–‡ä»¶ echo -e \u0026#34;${BLUE}ğŸ“ åˆ›å»ºåŸºç¡€æ–‡ä»¶...${NC}\u0026#34; cat \u0026gt; README.md \u0026lt;\u0026lt; EOF # $REPO_NAME é¡¹ç›®æè¿°å†™åœ¨è¿™é‡Œ... ## åŠŸèƒ½ç‰¹æ€§ - ç‰¹æ€§ 1 - ç‰¹æ€§ 2 - ç‰¹æ€§ 3 ## å®‰è£…ä½¿ç”¨ \\`\\`\\`bash git clone \u0026lt;ä»“åº“åœ°å€\u0026gt; cd $REPO_NAME \\`\\`\\` ## è®¸å¯è¯ MIT License EOF # åˆ›å»º .gitignore cat \u0026gt; .gitignore \u0026lt;\u0026lt; EOF # ä¾èµ–ç›®å½• node_modules/ vendor/ # æ—¥å¿—æ–‡ä»¶ *.log logs/ # ç¯å¢ƒé…ç½® .env .env.local # ç³»ç»Ÿæ–‡ä»¶ .DS_Store Thumbs.db # ç¼–è¾‘å™¨é…ç½® .vscode/ .idea/ EOF # æ·»åŠ å’Œæäº¤åˆå§‹æ–‡ä»¶ git add . git commit -m \u0026#34;åˆå§‹æäº¤: é¡¹ç›®åˆå§‹åŒ–\u0026#34; echo -e \u0026#34;${GREEN}âœ… æœ¬åœ°ä»“åº“åˆå§‹åŒ–å®Œæˆ${NC}\u0026#34; # æç¤ºç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºè¿œç¨‹ä»“åº“ echo -e \u0026#34;${YELLOW}ğŸ“ è¯·æ‰‹åŠ¨åœ¨ Gitee ä¸Šåˆ›å»ºä»“åº“:${NC}\u0026#34; echo -e \u0026#34; 1. è®¿é—®: https://gitee.com/projects/new\u0026#34; echo -e \u0026#34; 2. ä»“åº“åç§°: $REPO_NAME\u0026#34; echo -e \u0026#34; 3. åˆ›å»ºå®Œæˆåæ‰§è¡Œä»¥ä¸‹å‘½ä»¤:\u0026#34; echo -e \u0026#34;\u0026#34; echo -e \u0026#34;git remote add origin git@gitee.com:ä½ çš„ç”¨æˆ·å/$REPO_NAME.git\u0026#34; echo -e \u0026#34;git push -u origin main\u0026#34; echo -e \u0026#34;\u0026#34; echo -e \u0026#34;${GREEN}ğŸ‰ ä»“åº“åˆå§‹åŒ–æµç¨‹å®Œæˆï¼${NC}\u0026#34; âš™ï¸ äº”ã€é…ç½®å’Œå‡†å¤‡å·¥ä½œ 1. å®‰è£…å¿…è¦çš„ä¾èµ– 1 2 3 4 5 6 7 8 9 # ç¡®ä¿å·²å®‰è£… Git sudo apt install git -y # é…ç½® Git ç”¨æˆ·ä¿¡æ¯ git config --global user.name \u0026#34;ä½ çš„å§“å\u0026#34; git config --global user.email \u0026#34;ä½ çš„é‚®ç®±\u0026#34; # ç”Ÿæˆ SSH å¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ ssh-keygen -t ed25519 -C \u0026#34;ä½ çš„é‚®ç®±\u0026#34; 2. é…ç½®å¹³å°è®¿é—®ä»¤ç‰Œ Gitee è®¿é—®ä»¤ç‰Œ è®¿é—® https://gitee.com/profile/personal_access_tokens åˆ›å»ºæ–°ä»¤ç‰Œï¼Œå‹¾é€‰ repo æƒé™ ä¿å­˜ä»¤ç‰Œå¤‡ç”¨ GitHub è®¿é—®ä»¤ç‰Œ è®¿é—® https://github.com/settings/tokens åˆ›å»ºæ–°ä»¤ç‰Œï¼Œå‹¾é€‰ repo æƒé™ ä¿å­˜ä»¤ç‰Œå¤‡ç”¨ 3. ç¯å¢ƒå˜é‡é…ç½® 1 2 3 4 5 6 7 # æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc export GITEE_TOKEN=\u0026#34;ä½ çš„Giteeä»¤ç‰Œ\u0026#34; export GITHUB_TOKEN=\u0026#34;ä½ çš„GitHubä»¤ç‰Œ\u0026#34; export GITEA_TOKEN=\u0026#34;ä½ çš„Giteaä»¤ç‰Œ\u0026#34; # é‡æ–°åŠ è½½é…ç½® source ~/.bashrc ğŸ”§ å…­ã€é«˜çº§é…ç½®é€‰é¡¹ 1. è‡ªå®šä¹‰ä»“åº“é…ç½® 1 2 3 4 5 6 7 8 # è®¾ç½®ä»“åº“æè¿° REPO_DESCRIPTION=\u0026#34;æˆ‘çš„é¡¹ç›®æè¿°\u0026#34; # è®¾ç½®ä»“åº“å¯è§æ€§ REPO_VISIBILITY=\u0026#34;public\u0026#34; # æˆ– \u0026#34;private\u0026#34; # è®¾ç½®è®¸å¯è¯ REPO_LICENSE=\u0026#34;MIT\u0026#34; 2. æ·»åŠ é¢„é…ç½®æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºåŸºç¡€é¡¹ç›®ç»“æ„ mkdir -p src tests docs # æ·»åŠ è¯­è¨€ç‰¹å®šé…ç½® # å¯¹äº Node.js é¡¹ç›® if [ ! -f package.json ]; then npm init -y fi # å¯¹äº Python é¡¹ç›® if [ ! -f requirements.txt ]; then touch requirements.txt fi 3. è‡ªåŠ¨åŒ–è¿œç¨‹ä»“åº“åˆ›å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 # ä½¿ç”¨ Gitee API è‡ªåŠ¨åˆ›å»ºä»“åº“ï¼ˆéœ€è¦å®‰è£… curl å’Œ jqï¼‰ GITEE_TOKEN=\u0026#34;ä½ çš„Giteeä»¤ç‰Œ\u0026#34; REPO_NAME=$(basename \u0026#34;$PWD\u0026#34;) # åˆ›å»ºè¿œç¨‹ä»“åº“ response=$(curl -X POST -H \u0026#34;Content-Type: application/json\u0026#34; \\ -H \u0026#34;Authorization: token $GITEE_TOKEN\u0026#34; \\ -d \u0026#34;{\\\u0026#34;name\\\u0026#34;:\\\u0026#34;$REPO_NAME\\\u0026#34;,\\\u0026#34;description\\\u0026#34;:\\\u0026#34;$REPO_DESCRIPTION\\\u0026#34;,\\\u0026#34;private\\\u0026#34;:false}\u0026#34; \\ https://gitee.com/api/v5/user/repos) # æå– SSH URL SSH_URL=$(echo $response | jq -r \u0026#39;.ssh_url\u0026#39;) git remote add origin $SSH_URL 4. å¤šå¹³å°åŒæ­¥é…ç½® 1 2 3 4 5 6 7 8 9 # æ·»åŠ å¤šä¸ªè¿œç¨‹ä»“åº“ git remote add gitee git@gitee.com:username/repo.git git remote add github git@github.com:username/repo.git git remote add gitea git@gitea.example.com:username/repo.git # æ¨é€åˆ°æ‰€æœ‰è¿œç¨‹ä»“åº“ git push --all gitee git push --all github git push --all gitea ğŸ’¡ ä¸ƒã€ä½¿ç”¨æŠ€å·§ 1. æ‰¹é‡åˆå§‹åŒ–å¤šä¸ªä»“åº“ 1 2 3 # åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶åˆå§‹åŒ– mkdir my-project \u0026amp;\u0026amp; cd my-project bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/gitee_new_godown.sh) 2. é›†æˆåˆ°è‡ªåŠ¨åŒ–å·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 #!/bin/bash # è‡ªåŠ¨åŒ–é¡¹ç›®åˆ›å»ºè„šæœ¬ set -e PROJECT_NAME=\u0026#34;$1\u0026#34; mkdir \u0026#34;$PROJECT_NAME\u0026#34; \u0026amp;\u0026amp; cd \u0026#34;$PROJECT_NAME\u0026#34; # æ‰§è¡Œä»“åº“åˆå§‹åŒ– bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/gitee_new_godown.sh) echo \u0026#34;é¡¹ç›® $PROJECT_NAME åˆ›å»ºå®Œæˆï¼\u0026#34; 3. è‡ªå®šä¹‰åˆå§‹åŒ–æ¨¡æ¿ 1 2 3 4 5 6 7 8 # åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿ç›®å½• mkdir -p ~/.git-templates # å¤åˆ¶è„šæœ¬åˆ°æ¨¡æ¿ç›®å½• cp gitee_new_godown.sh ~/.git-templates/ # è®¾ç½® Git æ¨¡æ¿è·¯å¾„ git config --global init.templatedir \u0026#39;~/.git-templates\u0026#39; 4. IDE é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # VS Code ä»»åŠ¡é…ç½® # åœ¨ .vscode/tasks.json ä¸­æ·»åŠ  { \u0026#34;label\u0026#34;: \u0026#34;Initialize Git Repository\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;shell\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;bash\u0026#34;, \u0026#34;args\u0026#34;: [ \u0026#34;-c\u0026#34;, \u0026#34;bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/gitee_new_godown.sh)\u0026#34; ], \u0026#34;presentation\u0026#34;: { \u0026#34;echo\u0026#34;: true, \u0026#34;reveal\u0026#34;: \u0026#34;always\u0026#34;, \u0026#34;focus\u0026#34;: false, \u0026#34;panel\u0026#34;: \u0026#34;shared\u0026#34; } } ğŸš¨ å…«ã€æ³¨æ„äº‹é¡¹ 1. æƒé™å’Œè®¤è¯ ç¡®ä¿æœ‰å¯¹åº”å¹³å°çš„è´¦å·å’Œåˆ›å»ºä»“åº“çš„æƒé™ é…ç½®æ­£ç¡®çš„ SSH å¯†é’¥æˆ–è®¿é—®ä»¤ç‰Œ æ³¨æ„ä»¤ç‰Œçš„æƒé™èŒƒå›´ 2. ç½‘ç»œè¿æ¥ ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œç‰¹åˆ«æ˜¯è®¿é—®å›½å¤–å¹³å°æ—¶ è€ƒè™‘ä½¿ç”¨ä»£ç†æˆ–é•œåƒåŠ é€Ÿè®¿é—® 3. ä»“åº“å‘½åè§„èŒƒ éµå¾ªå¹³å°çš„ä»“åº“å‘½åè§„åˆ™ é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å’Œä¿ç•™åç§° å»ºè®®ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦ 4. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ ä¸è¦åœ¨ä»£ç ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯ ä½¿ç”¨ .gitignore å¿½ç•¥é…ç½®æ–‡ä»¶ è€ƒè™‘ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å·¥å…· 5. è®¸å¯è¯é€‰æ‹© 1 2 3 4 5 6 7 8 # å¸¸ç”¨å¼€æºè®¸å¯è¯ - MIT: å®½æ¾è®¸å¯è¯ï¼Œé€‚åˆå¤§å¤šæ•°é¡¹ç›® - Apache-2.0: ä¼ä¸šå‹å¥½ï¼Œä¸“åˆ©ä¿æŠ¤ - GPL-3.0: å¼º copyleftï¼Œè¦æ±‚å¼€æºè¡ç”Ÿä½œå“ - BSD-3-Clause: ç±»ä¼¼ MITï¼Œé™„åŠ æ¡æ¬¾ # æ·»åŠ è®¸å¯è¯æ–‡ä»¶ curl -sL https://api.github.com/licenses/mit | jq -r \u0026#39;.body\u0026#39; \u0026gt; LICENSE ğŸ”„ ä¹ã€æ•…éšœæ’é™¤ â“ è„šæœ¬æ‰§è¡Œæƒé™é—®é¢˜ 1 2 3 4 5 # æ·»åŠ æ‰§è¡Œæƒé™ chmod +x gitee_new_godown.sh # æˆ–è€…ç›´æ¥ä½¿ç”¨ bash æ‰§è¡Œ bash script.sh â“ ç½‘ç»œè¿æ¥é—®é¢˜ 1 2 3 4 5 6 # ä½¿ç”¨å›½å†…é•œåƒ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/git/gitee_new_godown.sh) # æˆ–è€…å…ˆä¸‹è½½è„šæœ¬å†æ‰§è¡Œ curl -O https://gitee.com/meimolihan/script/raw/master/sh/git/gitee_new_godown.sh bash gitee_new_godown.sh â“ API é€Ÿç‡é™åˆ¶ é¿å…é¢‘ç¹è°ƒç”¨åˆ›å»ºæ¥å£ ä½¿ç”¨ç¼“å­˜æˆ–ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯• è€ƒè™‘ä½¿ç”¨å®˜æ–¹ CLI å·¥å…·æ›¿ä»£ â“ è®¤è¯å¤±è´¥ 1 2 3 4 5 # æ£€æŸ¥ SSH å¯†é’¥é…ç½® ssh -T git@gitee.com # é‡æ–°é…ç½®è®¤è¯ä¿¡æ¯ git config --global credential.helper store â“ ä»“åº“å·²å­˜åœ¨é”™è¯¯ 1 2 3 4 5 6 7 # æ£€æŸ¥è¿œç¨‹ä»“åº“æ˜¯å¦å·²å­˜åœ¨ curl -s -H \u0026#34;Authorization: token $GITEE_TOKEN\u0026#34; \\ \u0026#34;https://gitee.com/api/v5/repos/username/$REPO_NAME\u0026#34; | jq . # å¦‚æœå­˜åœ¨ï¼Œå¯ä»¥é€‰æ‹©åˆ é™¤æˆ–é‡å‘½å curl -X DELETE -H \u0026#34;Authorization: token $GITEE_TOKEN\u0026#34; \\ \u0026#34;https://gitee.com/api/v5/repos/username/$REPO_NAME\u0026#34; ğŸ“Š åã€å„å¹³å°ç‰¹æ€§å¯¹æ¯” ç‰¹æ€§ Gitee GitHub Gitea è®¿é—®é€Ÿåº¦ â­â­â­â­â­ â­â­ â­â­â­â­â­ ä¸­æ–‡æ”¯æŒ â­â­â­â­â­ â­â­ â­â­â­â­ å…è´¹ç§æœ‰åº“ âœ… âœ… âœ… CI/CD â­â­â­â­ â­â­â­â­â­ â­â­â­ ç¤¾åŒºç”Ÿæ€ â­â­â­â­ â­â­â­â­â­ â­â­â­ è‡ªéƒ¨ç½² âŒ âŒ âœ… API é™åˆ¶ å®½æ¾ ä¸¥æ ¼ å¯é…ç½® ä¼ä¸šç‰¹æ€§ â­â­â­â­ â­â­â­â­â­ â­â­â­ é€‰æ‹©å»ºè®®ï¼š å›½å†…ä¸ªäººé¡¹ç›®ï¼šæ¨è Giteeï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œä¸­æ–‡æ”¯æŒå¥½ å¼€æºé¡¹ç›®ï¼šæ¨è GitHubï¼Œå…¨çƒæœ€å¤§çš„å¼€æºç¤¾åŒº ä¼ä¸šè‡ªå»ºï¼šæ¨è Giteaï¼Œå¯å®Œå…¨æ§åˆ¶ï¼Œæ”¯æŒç§æœ‰åŒ–éƒ¨ç½² å¤šå¹³å°åŒæ­¥ï¼šå¯ä»¥åŒæ—¶åœ¨å¤šä¸ªå¹³å°æ‰˜ç®¡ï¼Œæé«˜å¯ç”¨æ€§ ğŸ¯ æç¤ºï¼šæ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„å¹³å°ã€‚å›½å†…ç”¨æˆ·æ¨è Gitee è·å¾—æ›´å¥½çš„è®¿é—®é€Ÿåº¦ï¼Œå¼€æºé¡¹ç›®æ¨è GitHub è·å¾—æ›´å¹¿æ³›çš„æ›å…‰ï¼Œéœ€è¦è‡ªå»ºæœåŠ¡çš„æ¨è Giteaã€‚\nå¸Œæœ›è¿™äº› Git ä»“åº“åˆå§‹åŒ–è„šæœ¬èƒ½å¸®åŠ©æ‚¨å¿«é€Ÿå¼€å§‹æ–°é¡¹ç›®ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆå’Œæ”¹è¿›ã€‚ğŸš€\n","date":"2025-08-26T15:45:29+08:00","image":"https://file.meimolihan.eu.org/img/git-01.webp","permalink":"https://blog.meimolihan.eu.org/p/6b5a185b/","title":"Git æ–°ä»“åº“åˆå§‹åŒ–è„šæœ¬ ğŸ“"},{"content":"Proxmox VE å†…æ ¸ç®¡ç†ä¸å¸è½½æŒ‡å— ğŸ”§ ğŸ“– æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Proxmox VE (PVE) ç¯å¢ƒä¸­å®‰å…¨åœ°ç®¡ç†å’Œå¸è½½å†…æ ¸ï¼Œé¿å…ç³»ç»ŸæŸåå’Œå¯åŠ¨é—®é¢˜ï¼Œç¡®ä¿è™šæ‹ŸåŒ–å¹³å°çš„ç¨³å®šè¿è¡Œã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ› ï¸ ä¸€ã€å†…æ ¸ç®¡ç†è„šæœ¬ä½¿ç”¨ ğŸš« äºŒã€ä¸å¯å¸è½½çš„å†…æ ¸ç»„ä»¶ âš ï¸ ä¸‰ã€é‡è¦æ³¨æ„äº‹é¡¹ ğŸ’¡ å››ã€å®‰å…¨æ“ä½œæŒ‡å— ğŸ†˜ äº”ã€æ•…éšœæ¢å¤æ–¹æ¡ˆ ğŸ” å…­ã€è¯Šæ–­å‘½ä»¤å‚è€ƒ âœ¨ æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ›¡ï¸ å®‰å…¨å¸è½½ï¼šæä¾›å®‰å…¨çš„å†…æ ¸å¸è½½æœºåˆ¶ï¼Œé¿å…ç³»ç»Ÿå´©æºƒ ğŸ“Š å¯è§†åŒ–ç®¡ç†ï¼šé€šè¿‡èœå•ç•Œé¢ç›´è§‚ç®¡ç†å†…æ ¸ç‰ˆæœ¬ ğŸ” ä¾èµ–æ£€æŸ¥ï¼šè‡ªåŠ¨æ£€æµ‹å†…æ ¸ä¾èµ–å…³ç³»ï¼Œé˜²æ­¢è¯¯åˆ å…³é”®ç»„ä»¶ âš¡ å¿«é€Ÿæ¢å¤ï¼šæä¾›é—®é¢˜è§£å†³æ–¹æ¡ˆï¼Œå¿«é€Ÿæ¢å¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œ ğŸ“‹ çŠ¶æ€ç›‘æ§ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰è¿è¡Œå†…æ ¸å’Œå¯å¸è½½é¡¹ç›® ğŸ› ï¸ ä¸€ã€å†…æ ¸ç®¡ç†è„šæœ¬ä½¿ç”¨ 1. ğŸ“¦ ä¸‹è½½å’Œæ‰§è¡Œç®¡ç†è„šæœ¬ 1 2 3 4 # ä¸‹è½½ PVE å†…æ ¸ç®¡ç†è„šæœ¬ wget -q -O /root/pve_source.tar.gz \u0026#39;https://bbs.x86pi.cn/file/topic/2023-11-28/file/01ac88d7d2b840cb88c15cb5e19d4305b2.gz\u0026#39; \u0026amp;\u0026amp; \\ tar zxvf /root/pve_source.tar.gz \u0026amp;\u0026amp; \\ /root/./pve_source 2. ğŸ“Š è„šæœ¬ç•Œé¢è¯´æ˜ æ‰§è¡Œåä¼šæ˜¾ç¤ºå†…æ ¸ç®¡ç†èœå•ï¼š\n1 2 3 4 5 6 7 8 9 ============================================================== ------------------ å·²å®‰è£…çš„å†…æ ¸åŠå¤´æ–‡ä»¶ ------------------- 1ã€proxmox-headers-6.14.8-2-pve ## å½“å‰è¿è¡Œ, ä¸å¯å¸è½½ ğŸš« 2ã€proxmox-kernel-6.14 ## åŸºç¡€åŒ…, ä¸å»ºè®®å¸è½½ âš ï¸ 3ã€proxmox-kernel-6.14.8-2-pve-signed Xã€ä¸€é”®å¸è½½å…¶ä»–å†…æ ¸åŠå¤´æ–‡ä»¶ 0ã€è¿”å› ============================================================== è¯·é€‰æ‹© : 0 åŠŸèƒ½ç‰¹ç‚¹ï¼š\nâœ… å¯è§†åŒ–èœå•ç•Œé¢ï¼Œæ“ä½œç®€å•ç›´è§‚ ğŸ” è‡ªåŠ¨æ ‡è®°å½“å‰è¿è¡Œå†…æ ¸ï¼Œé˜²æ­¢è¯¯åˆ  âš ï¸ æç¤ºé£é™©é¡¹ç›®ï¼Œå¢å¼ºæ“ä½œå®‰å…¨æ€§ ğŸ—‘ï¸ æä¾›æ‰¹é‡å¸è½½åŠŸèƒ½ï¼Œæé«˜æ•ˆç‡ ğŸš« äºŒã€ä¸å¯å¸è½½çš„å†…æ ¸ç»„ä»¶ 1. ğŸ”’ å½“å‰è¿è¡Œçš„å†…æ ¸ 1 2 3 # æŸ¥çœ‹å½“å‰è¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬ uname -r # è¾“å‡ºç¤ºä¾‹ï¼š6.14.8-2-pve ä¸å¯å¸è½½é¡¹ç›®ï¼š\nproxmox-headers-6.14.8-2-pve - å½“å‰ç³»ç»Ÿæ­£åœ¨è¿è¡Œçš„å†…æ ¸å¤´æ–‡ä»¶ ğŸš« ç»å¯¹ç¦æ­¢å¸è½½ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç³»ç»Ÿç«‹å³å´©æºƒ 2. ğŸ“¦ å†…æ ¸åŸºç¡€å…ƒæ•°æ®åŒ… ä¸å»ºè®®å¸è½½é¡¹ç›®ï¼š\nproxmox-kernel-6.14 - å†…æ ¸çš„åŸºç¡€å…ƒæ•°æ®åŒ… âš ï¸ å¼ºçƒˆä¸å»ºè®®å¸è½½ï¼Œè¿™æ˜¯å†…æ ¸ç³»åˆ—çš„ä¾èµ–åŸºç¡€åŒ… 3. ğŸ” å·²ç­¾åçš„å†…æ ¸åŒ… é£é™©é¡¹ç›®ï¼š\nproxmox-kernel-6.14.8-2-pve-signed - å·²ç­¾åçš„å†…æ ¸åŒ… âš ï¸ å¸è½½å¯èƒ½å¯¼è‡´å¯åŠ¨é…ç½®æŸåå’Œç³»ç»Ÿä¸ç¨³å®š âš ï¸ ä¸‰ã€é‡è¦æ³¨æ„äº‹é¡¹ 1. ğŸ”’ ç­¾åå†…æ ¸åŒ…çš„ç‰¹æ®Šæ€§ å¼ºçƒˆä¸å»ºè®®å¸è½½å·²ç­¾åçš„å†…æ ¸åŒ…ï¼ŒåŸå› åŒ…æ‹¬ï¼š\né£é™©ç±»å‹ å½±å“æè¿° ä¸¥é‡ç¨‹åº¦ ğŸ”§ å¯åŠ¨é…ç½®æŸå GRUB å¯åŠ¨èœå•å¯èƒ½æ— æ³•æ­£ç¡®è¯†åˆ«å†…æ ¸ âš ï¸ é«˜ ğŸš¨ å¯åŠ¨å¤±è´¥ ç³»ç»Ÿé‡å¯åæ— æ³•æ‰¾åˆ°æœ‰æ•ˆå†…æ ¸ ğŸ”´ ä¸¥é‡ âš¡ ç³»ç»Ÿä¸ç¨³å®š è™šæ‹ŸåŒ–ç»„ä»¶å’Œé©±åŠ¨å¯èƒ½å¼‚å¸¸ âš ï¸ é«˜ ğŸ“¦ ä¾èµ–æ–­è£‚ å…¶ä»–è½¯ä»¶åŒ…å¯èƒ½ä¾èµ–ç‰¹å®šå†…æ ¸ç‰ˆæœ¬ ğŸŸ¡ ä¸­ 2. ğŸ’¾ ç©ºé—´è€ƒè™‘ä¸å®‰å…¨å¹³è¡¡ è™½ç„¶å†…æ ¸æ–‡ä»¶å¯èƒ½å ç”¨ä¸€å®šç£ç›˜ç©ºé—´ï¼Œä½†ç›¸æ¯”ç³»ç»Ÿç¨³å®šæ€§ï¼š\nâœ… ä¿ç•™2-3ä¸ªæœ€è¿‘å†…æ ¸ç‰ˆæœ¬æ˜¯å®‰å…¨åšæ³• ğŸ“Š é€šå¸¸æ¯ä¸ªå†…æ ¸ç‰ˆæœ¬å ç”¨200-300MBç©ºé—´ âš–ï¸ åœ¨ç£ç›˜ç©ºé—´å’Œç³»ç»Ÿå®‰å…¨é—´å–å¾—å¹³è¡¡ ğŸ’¡ å››ã€å®‰å…¨æ“ä½œæŒ‡å— 1. âœ… å†…æ ¸ç»´æŠ¤æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 # 1. å®šæœŸæ£€æŸ¥å·²å®‰è£…å†…æ ¸ dpkg -l | grep -i kernel # 2. ä½¿ç”¨å®‰å…¨å¸è½½å‘½ä»¤ apt autoremove --purge # 3. æ›´æ–°GRUBé…ç½® update-grub # 4. é‡å¯å‰éªŒè¯ reboot -f 2. ğŸ“‹ æ“ä½œæ£€æŸ¥æ¸…å• åœ¨å¸è½½ä»»ä½•å†…æ ¸å‰ï¼Œè¯·ç¡®è®¤ï¼š\nå½“å‰è¿è¡Œå†…æ ¸æœªè¢«æ ‡è®°ä¸ºå¸è½½å¯¹è±¡ è‡³å°‘ä¿ç•™ä¸€ä¸ªå¤‡ç”¨å†…æ ¸ç‰ˆæœ¬ å·²å¤‡ä»½é‡è¦æ•°æ®å’Œé…ç½®æ–‡ä»¶ äº†è§£å¦‚ä½•ä»å¤‡ä»½æ¢å¤ç³»ç»Ÿ æœ‰ç‰©ç†æˆ–IPMIè®¿é—®æƒé™ï¼ˆä»¥é˜²æ— æ³•å¯åŠ¨ï¼‰ 3. ğŸ”„ æ›´æ–°ç­–ç•¥å»ºè®® ğŸ”„ é¡ºåºæ›´æ–°ï¼šå®‰è£…æ–°å†…æ ¸ â†’ æµ‹è¯• â†’ é‡å¯ â†’ ç¡®è®¤ç¨³å®š â†’ æ¸…ç†æ—§å†…æ ¸ ğŸ“… å®šæœŸç»´æŠ¤ï¼šæ¯æœˆæ£€æŸ¥ä¸€æ¬¡å†…æ ¸æ›´æ–°ï¼Œæ¯å­£åº¦æ¸…ç†ä¸€æ¬¡æ—§å†…æ ¸ ğŸ§ª æµ‹è¯•ç¯å¢ƒï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯å†…æ ¸å…¼å®¹æ€§ ğŸ†˜ äº”ã€æ•…éšœæ¢å¤æ–¹æ¡ˆ 1. ğŸ”§ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ å¦‚æœæ„å¤–å¸è½½äº†é‡è¦å†…æ ¸ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 # 1. å°è¯•ä»å¤‡ä»½æ¢å¤å†…æ ¸åŒ… apt install proxmox-kernel-6.14.8-2-pve-signed # 2. ä½¿ç”¨Proxmoxå®‰è£…ä»‹è´¨ä¿®å¤ # ä»ISOå¯åŠ¨ â†’ é€‰æ‹©ä¿®å¤æ¨¡å¼ â†’ é‡æ–°å®‰è£…å†…æ ¸ # 3. æ‰‹åŠ¨ä¿®å¤GRUBé…ç½® grub-install /dev/sdX update-grub 2. ğŸ“ ç´§æ€¥æ¢å¤æ­¥éª¤ ç«‹å³æªæ–½ï¼š\nä¿æŒç³»ç»Ÿè¿è¡ŒçŠ¶æ€ ä¸è¦é‡å¯ç³»ç»Ÿ è®°å½•å·²å¸è½½çš„åŒ…åç§° æ¢å¤æ“ä½œï¼š\n1 2 3 4 5 # é‡æ–°å®‰è£…è¢«è¯¯åˆ çš„å†…æ ¸åŒ… apt install --reinstall proxmox-kernel-6.14.8-2-pve-signed # ä¿®å¤ä¾èµ–å…³ç³» apt --fix-broken install éªŒè¯ä¿®å¤ï¼š\n1 2 3 4 5 # æ£€æŸ¥å†…æ ¸åŒ…çŠ¶æ€ dpkg -l | grep kernel # æ›´æ–°å¯åŠ¨é…ç½® update-grub ğŸ” å…­ã€è¯Šæ–­å‘½ä»¤å‚è€ƒ 1. ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å½“å‰è¿è¡Œå†…æ ¸ uname -r # æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„å†…æ ¸ dpkg -l | grep -i kernel # æŸ¥çœ‹å¯åŠ¨èœå•é…ç½® cat /boot/grub/grub.cfg | grep -i menuentry # æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ df -h /boot 2. ğŸ› ï¸ é«˜çº§è¯Šæ–­å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å†…æ ¸æ¨¡å—ä¾èµ–å…³ç³» lsmod | head -20 # æ£€æŸ¥è™šæ‹ŸåŒ–åŠŸèƒ½çŠ¶æ€ kvm-ok # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„å†…æ ¸æ¶ˆæ¯ dmesg | tail -50 # æ£€æŸ¥APTåŒ…çŠ¶æ€ apt list --installed | grep -i pve-kernel 3. ğŸ“ æ—¥å¿—åˆ†æå‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¥å¿— journalctl -b # æ£€æŸ¥å†…æ ¸å®‰è£…æ—¥å¿— grep -i kernel /var/log/apt/history.log # ç›‘æ§å®æ—¶ç³»ç»Ÿæ—¥å¿— tail -f /var/log/syslog ğŸ¯ æ€»ç»“ä¸å»ºè®® âœ… æ ¸å¿ƒåŸåˆ™ å®‰å…¨ç¬¬ä¸€ï¼šå§‹ç»ˆä¼˜å…ˆè€ƒè™‘ç³»ç»Ÿç¨³å®šæ€§ ä¿ç•™å¤‡ä»½ï¼šè‡³å°‘ä¿ç•™ä¸€ä¸ªå¤‡ç”¨å†…æ ¸ç‰ˆæœ¬ æµ‹è¯•éªŒè¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒåº”ç”¨å‰å……åˆ†æµ‹è¯• æ–‡æ¡£è®°å½•ï¼šè®°å½•æ‰€æœ‰å†…æ ¸å˜æ›´æ“ä½œ ğŸ”§ ç»´æŠ¤è®¡åˆ’å»ºè®® æ¯æ—¥ï¼šæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ä¸­çš„å†…æ ¸ç›¸å…³é”™è¯¯ æ¯å‘¨ï¼šéªŒè¯GRUBé…ç½®å®Œæ•´æ€§ æ¯æœˆï¼šæ£€æŸ¥å¹¶å®‰è£…å®‰å…¨æ›´æ–° æ¯å­£åº¦ï¼šå®‰å…¨åœ°æ¸…ç†æ—§å†…æ ¸ç‰ˆæœ¬ ğŸ“š é™„åŠ èµ„æº Proxmox VE å®˜æ–¹æ–‡æ¡£ Linux å†…æ ¸ç®¡ç†æŒ‡å— GRUB å¯åŠ¨é…ç½®æ–‡æ¡£ ğŸ’¡ è®°ä½ï¼šå†…æ ¸æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œä»»ä½•ä¿®æ”¹éƒ½éœ€è¦è°¨æ…æ“ä½œã€‚å½“ä¸ç¡®å®šæ—¶ï¼Œä¿å®ˆçš„é€‰æ‹©å¾€å¾€æ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ï¼\n","date":"2025-08-26T15:42:17+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/7fc455fd/","title":"Proxmox VE å†…æ ¸ç®¡ç†ä¸å¸è½½ ğŸ”§"},{"content":"Proxmox VE ä¸­ SATA ç›´é€šé…ç½®æŒ‡å— ğŸ–¥ï¸ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨ Proxmox VE (PVE) ä¸­å®ç° SATA ç¡¬ç›˜å’Œæ§åˆ¶å™¨ç›´é€šçš„å®Œæ•´æ–¹æ³•ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ”§ 1. å‡†å¤‡å·¥ä½œ âš™ï¸ 2. å¼€å¯ IOMMU æ”¯æŒ ğŸš€ 3. ç›´é€šæ–¹æ³• ğŸ” 4. æ•…éšœæ’æŸ¥ ğŸ’¡ 5. æœ€ä½³å®è·µ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ”§ 1. å‡†å¤‡å·¥ä½œ ğŸ–¥ï¸ ç¡¬ä»¶è¦æ±‚ Intel CPUï¼šéœ€æ”¯æŒ VT-d æŠ€æœ¯ï¼ˆB75 ä»¥ä¸ŠèŠ¯ç‰‡ç»„/4 ä»£é…·ç¿ä»¥ä¸Šï¼‰ AMD CPUï¼šéœ€æ”¯æŒ AMD-Vi æŠ€æœ¯ BIOS è®¾ç½®ï¼šéœ€è¦åœ¨ BIOS ä¸­å¯ç”¨ VT-d/AMD-Vi åŠŸèƒ½ ğŸ” æ£€æŸ¥ç¡¬ä»¶æ”¯æŒ 1 2 3 4 5 # æ£€æŸ¥ CPU è™šæ‹ŸåŒ–æ”¯æŒ egrep -c \u0026#39;(vmx|svm)\u0026#39; /proc/cpuinfo # æ£€æŸ¥ IOMMU æ”¯æŒ dmesg | grep -i iommu ğŸ“ è¯†åˆ«ç¡¬ç›˜ä¿¡æ¯ 1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰ç¡¬ç›˜åŠå…¶ ID ls -l /dev/disk/by-id/ # ç¤ºä¾‹è¾“å‡ºï¼š # ata-WDC_WD2500BEVT-22ZCT0_WD-WXHZ08044989 -\u0026gt; ../../sda è®°å½•éœ€è¦ç›´é€šçš„ç¡¬ç›˜ IDï¼ˆata- å¼€å¤´çš„æ ‡è¯†ç¬¦ï¼‰å’Œå¯¹åº”çš„è®¾å¤‡åç§°ï¼ˆå¦‚ sdaï¼‰ã€‚\nâš™ï¸ 2. å¼€å¯ IOMMU æ”¯æŒ ğŸ“ ç¼–è¾‘ GRUB é…ç½® 1 nano /etc/default/grub æ ¹æ® CPU ç±»å‹ä¿®æ”¹é…ç½®ï¼š\nIntel CPUï¼š\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on iommu=pt\u0026#34; AMD CPUï¼š\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet amd_iommu=on iommu=pt\u0026#34; ğŸ”„ æ›´æ–° GRUB é…ç½® 1 2 3 4 5 # æ›´æ–° GRUB update-grub # å¯¹äº UEFI ç³»ç»Ÿ proxmox-boot-tool refresh ğŸ“¦ åŠ è½½å¿…è¦å†…æ ¸æ¨¡å— 1 2 # ç¼–è¾‘æ¨¡å—é…ç½®æ–‡ä»¶ nano /etc/modules æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 vfio vfio_iommu_type1 vfio_pci vfio_virqfd ğŸ”„ åº”ç”¨é…ç½®å¹¶é‡å¯ 1 2 3 4 5 # æ›´æ–° initramfs update-initramfs -u -k all # é‡å¯ç³»ç»Ÿ reboot âœ… éªŒè¯ IOMMU å¯ç”¨ 1 2 3 4 5 # æ£€æŸ¥ IOMMU æ˜¯å¦å¯ç”¨ dmesg | grep -i iommu # æ£€æŸ¥ IOMMU åˆ†ç»„ find /sys/kernel/iommu_groups/ -type l ğŸš€ 3. ç›´é€šæ–¹æ³• ğŸ’¾ æ–¹æ³•ä¸€ï¼šç›´é€šå•ä¸ª SATA ç¡¬ç›˜ï¼ˆæ¨èï¼‰ âŒ¨ï¸ å‘½ä»¤è¡Œæ–¹å¼ 1 2 # è¯­æ³•ï¼šqm set \u0026lt;VMID\u0026gt; --sataX /dev/disk/by-id/\u0026lt;ç¡¬ç›˜ID\u0026gt; qm set 100 --sata0 /dev/disk/by-id/ata-WDC_WD2500BEVT-22ZCT0_WD-WXHZ08044989 å‚æ•°è¯´æ˜ï¼š\n\u0026lt;VMID\u0026gt;ï¼šè™šæ‹Ÿæœº IDï¼ˆå¦‚ 100ï¼‰ sataXï¼šæ§åˆ¶å™¨ä½ç½®ï¼ˆsata0, sata1, sata2, sata3ï¼‰ \u0026lt;ç¡¬ç›˜ID\u0026gt;ï¼šå®Œæ•´çš„ç¡¬ç›˜ ID ğŸŒ Web ç•Œé¢æ–¹å¼ é€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; \u0026gt; \u0026ldquo;SATA Disk\u0026rdquo; é€‰æ‹©\u0026quot;ä½¿ç”¨ç‰©ç†ç£ç›˜\u0026quot; ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©å¯¹åº”çš„ç¡¬ç›˜ ID ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; ğŸ›ï¸ æ–¹æ³•äºŒï¼šç›´é€šæ•´ä¸ª SATA æ§åˆ¶å™¨ ğŸ” è¯†åˆ« SATA æ§åˆ¶å™¨ 1 2 3 4 5 # æŸ¥çœ‹ SATA æ§åˆ¶å™¨ä¿¡æ¯ lspci | grep -i sata # ç¤ºä¾‹è¾“å‡ºï¼š # 00:17.0 SATA controller: Intel Corporation Alder Lake-N SATA AHCI Controller ğŸ“‹ è·å–è®¾å¤‡ ID 1 2 3 4 5 # æŸ¥çœ‹è¯¦ç»†çš„ PCI è®¾å¤‡ä¿¡æ¯ lspci -nn | grep -i sata # ç¤ºä¾‹è¾“å‡ºï¼š # 00:17.0 SATA controller [0106]: Intel Corporation Alder Lake-N SATA AHCI Controller [8086:54d3] è®°å½•è®¾å¤‡ IDï¼ˆæ ¼å¼ä¸º [XXXX:XXXX]ï¼Œå¦‚ [8086:54d3]ï¼‰\nâš™ï¸ é…ç½®ç›´é€š 1 2 # ç¼–è¾‘æ¨¡å—é»‘åå• nano /etc/modprobe.d/vfio.conf æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 options vfio-pci ids=8086:54d3 ğŸŒ Web ç•Œé¢æ·»åŠ  PCI è®¾å¤‡ é€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; \u0026gt; \u0026ldquo;PCI è®¾å¤‡\u0026rdquo; é€‰æ‹©å¯¹åº”çš„ SATA æ§åˆ¶å™¨ å‹¾é€‰\u0026quot;æ‰€æœ‰åŠŸèƒ½\u0026quot;å’Œ\u0026quot;PCI-Express\u0026quot; ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; ğŸ” 4. æ•…éšœæ’æŸ¥ â“ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ ğŸ› é—®é¢˜ 1: IOMMU æœªå¯ç”¨ ç—‡çŠ¶ï¼šdmesg | grep -i iommu æ— è¾“å‡º\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 # æ£€æŸ¥ BIOS è®¾ç½® # ç¡®è®¤ GRUB é…ç½®æ­£ç¡® # é‡å¯åæ£€æŸ¥å†…æ ¸å‚æ•° cat /proc/cmdline ğŸ› é—®é¢˜ 2: PCI è®¾å¤‡æ— æ³•ç›´é€š ç—‡çŠ¶ï¼šè®¾å¤‡ä¸åœ¨ IOMMU ç»„ä¸­æˆ–æ— æ³•ç»‘å®š\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 # ç¼–è¾‘ GRUB é…ç½®æ·»åŠ  ACS è¦†ç›– nano /etc/default/grub æ·»åŠ å‚æ•°ï¼š\n1 pcie_acs_override=downstream,multifunction æ›´æ–°å¹¶é‡å¯ï¼š\n1 2 update-grub reboot ğŸ› é—®é¢˜ 3: ç›´é€šå PVE ç³»ç»Ÿæ— æ³•å¯åŠ¨ ç—‡çŠ¶ï¼šç³»ç»Ÿå¯åŠ¨å¤±è´¥æˆ–è¿›å…¥åªè¯»æ¨¡å¼\nè§£å†³æ–¹æ¡ˆï¼š\nè¿›å…¥ PVE æ¢å¤æ¨¡å¼ æ³¨é‡Šæ‰ç›¸å…³çš„ç›´é€šé…ç½® å°† PVE ç³»ç»Ÿå®‰è£…åœ¨ NVMe ç¡¬ç›˜ä¸Š ğŸ› é—®é¢˜ 4: è™šæ‹Ÿæœºæ— æ³•è¯†åˆ«ç›´é€šè®¾å¤‡ ç—‡çŠ¶ï¼šè™šæ‹Ÿæœºä¸­çœ‹ä¸åˆ°ç›´é€šç¡¬ç›˜\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® qm config \u0026lt;VMID\u0026gt; # ç¡®è®¤è®¾å¤‡è·¯å¾„æ­£ç¡® ls -la /dev/disk/by-id/ ğŸ’¡ 5. æœ€ä½³å®è·µ ğŸ”’ 1. å®‰å…¨æ€§è€ƒè™‘ 1 2 3 4 # ç¡®ä¿ç›´é€šç¡¬ç›˜ä¸åŒ…å«ç³»ç»Ÿå…³é”®æ•°æ® # å®šæœŸå¤‡ä»½é‡è¦æ•°æ® # ä½¿ç”¨ç›‘æ§å·¥å…·æ£€æŸ¥ç¡¬ç›˜å¥åº·çŠ¶æ€ smartctl -a /dev/sdX âš¡ 2. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 # å¯ç”¨ AHCI æ¨¡å¼ # ä½¿ç”¨ SSD è¿›è¡Œç¼“å­˜ # è°ƒæ•´è™šæ‹Ÿæœº CPU ç±»å‹ä¸º host qm set \u0026lt;VMID\u0026gt; --cpu host ğŸ“Š 3. ç›‘æ§å’Œç»´æŠ¤ 1 2 3 4 5 6 # ç›‘æ§ç›´é€šè®¾å¤‡çŠ¶æ€ qm monitor \u0026lt;VMID\u0026gt; info block # æ£€æŸ¥è®¾å¤‡è¿æ¥çŠ¶æ€ lspci -k ğŸ’¾ 4. å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 # å®šæœŸå¤‡ä»½è™šæ‹Ÿæœºé…ç½® qm config \u0026lt;VMID\u0026gt; \u0026gt; /backup/vm-\u0026lt;VMID\u0026gt;-config.backup # å¤‡ä»½é‡è¦æ•°æ® rsync -av /path/to/data /backup/location/ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ“ ç³»ç»Ÿå®‰è£…ä½ç½®ï¼šå¦‚æœ PVE ç³»ç»Ÿå®‰è£…åœ¨ SATA ç¡¬ç›˜ä¸Šï¼Œç›´é€šæ•´ä¸ª SATA æ§åˆ¶å™¨ä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•å¯åŠ¨ ğŸ”’ æ•°æ®å®‰å…¨ï¼šç›´é€šæ“ä½œæœ‰é£é™©ï¼ŒåŠ¡å¿…æå‰å¤‡ä»½é‡è¦æ•°æ® ğŸ”„ å…¼å®¹æ€§ï¼šä¸åŒç¡¬ä»¶å¹³å°çš„ IOMMU å®ç°å¯èƒ½æœ‰å·®å¼‚ âš¡ æ€§èƒ½å½±å“ï¼šç›´é€šæ•´ä¸ªæ§åˆ¶å™¨å¯èƒ½å½±å“å…¶ä»–è®¾å¤‡çš„æ€§èƒ½ ğŸ“š å‚è€ƒèµ„æ–™ Proxmox VE å®˜æ–¹æ–‡æ¡£ PCI Passthrough æŒ‡å— IOMMU åˆ†ç»„è¯´æ˜ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ¨ PVE ä¸­é…ç½® SATA ç›´é€šã€‚å»ºè®®å…ˆä»å•ä¸ªç¡¬ç›˜ç›´é€šå¼€å§‹å°è¯•ï¼Œç†Ÿç»ƒæŒæ¡åå†è€ƒè™‘æ§åˆ¶å™¨çº§åˆ«çš„ç›´é€šã€‚ğŸš€\n","date":"2025-08-26T15:40:07+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/766ea5e5/","title":"Proxmox VE ä¸­ SATA ç›´é€šé…ç½®æŒ‡å— ğŸ–¥ï¸"},{"content":"FnOS æŒ‚è½½ NTFS æ ¼å¼ç¡¬ç›˜ ğŸ“‚ âœ¨ åŠŸèƒ½æ¦‚è¿° æœ¬æ•™ç¨‹è¯¦ç»†ä»‹ç»äº†åœ¨ FnOS ç³»ç»Ÿä¸ŠæŒ‚è½½ NTFS æ ¼å¼ç¡¬ç›˜çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬ç£ç›˜è¯†åˆ«ã€é©±åŠ¨å®‰è£…ã€æŒ‚è½½æ“ä½œã€è‡ªåŠ¨æŒ‚è½½é…ç½®ä»¥åŠæ•…éšœæ’é™¤ç­‰å…¨æ–¹ä½å†…å®¹ã€‚æ— è®ºä½ æ˜¯æ–°æ‰‹è¿˜æ˜¯èµ„æ·±ç”¨æˆ·ï¼Œéƒ½èƒ½é€šè¿‡æœ¬æŒ‡å—è½»æ¾ç®¡ç†å¤–éƒ¨å­˜å‚¨è®¾å¤‡ã€‚\nğŸ” ç£ç›˜è¯†åˆ«ï¼šå¿«é€ŸæŸ¥çœ‹å’Œè¯†åˆ«è¿æ¥çš„å­˜å‚¨è®¾å¤‡ ğŸ“¦ é©±åŠ¨å®‰è£…ï¼šä¸€é”®å®‰è£… NTFS æ–‡ä»¶ç³»ç»Ÿæ”¯æŒåŒ… ğŸ—‚ï¸ æŒ‚è½½æ“ä½œï¼šæ”¯æŒä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æŒ‚è½½æ–¹å¼ âš™ï¸ è‡ªåŠ¨æŒ‚è½½ï¼šé…ç½®ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½ï¼Œçœå¿ƒçœåŠ› ğŸ”§ æ•…éšœæ’é™¤ï¼šè§£å†³å¸¸è§æŒ‚è½½é—®é¢˜å’Œé”™è¯¯ï¼Œé¿å…è¸©å‘ ğŸ›¡ï¸ å®‰å…¨å»ºè®®ï¼šç¡®ä¿æ•°æ®å®‰å…¨å’Œç³»ç»Ÿç¨³å®šæ€§ æ•™ç¨‹é“¾æ¥: FnOS æŒ‚è½½ NTFS ç¡¬ç›˜æ•™ç¨‹ è§†é¢‘æ•™ç¨‹: Bç«™è§†é¢‘æ•™ç¨‹ ğŸ“‘ ç›®å½•å¯¼èˆª ğŸ§ ä¸€ã€FnOS æŒ‚è½½ USB 1024G ç¡¬ç›˜ ğŸ”„ äºŒã€é…ç½®æ°¸ä¹…æŒ‚è½½ ğŸ’¾ ä¸‰ã€FnOS æŒ‚è½½ USB 256G ç¡¬ç›˜ âš™ï¸ å››ã€fstab é…ç½®è¯¦è§£ ğŸ”§ äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ’¡ å…­ã€å®ç”¨æŠ€å·§ ğŸ›¡ï¸ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ“‹ æ€»ç»“ ğŸ§ ä¸€ã€FnOS æŒ‚è½½ USB 1024G ç¡¬ç›˜ (NTFS æ ¼å¼) 1ï¸âƒ£ æŸ¥çœ‹æ‰€æœ‰ç£ç›˜è®¾å¤‡ 1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰è¿æ¥çš„ç£ç›˜è®¾å¤‡ lsblk # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿç±»å‹ lsblk -f 2ï¸âƒ£ æ£€æŸ¥ç‰¹å®šç£ç›˜çš„æŒ‚è½½çŠ¶æ€ 1 2 3 4 5 # æ£€æŸ¥ /dev/sde1 çš„è¯¦ç»†ä¿¡æ¯ lsblk -f /dev/sde # æˆ–è€…ä½¿ç”¨ mount å‘½ä»¤æ£€æŸ¥ mount | grep /dev/sde1 3ï¸âƒ£ å®‰è£… NTFS æ”¯æŒåŒ… 1 2 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… ntfs-3g sudo apt update \u0026amp;\u0026amp; sudo apt install -y ntfs-3g 4ï¸âƒ£ åˆ›å»ºæŒ‚è½½ç›®å½•å¹¶ä¿®å¤ NTFS æ–‡ä»¶ç³»ç»Ÿ 1 2 3 4 5 # åˆ›å»ºæŒ‚è½½ç›®å½•å¹¶è®¾ç½®æƒé™ sudo mkdir -pm 755 /vol2/1000/mydisk/usb_1024g # ä¿®å¤ NTFS æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœéœ€è¦ï¼‰ sudo ntfsfix /dev/sde1 5ï¸âƒ£ æŒ‚è½½ç¡¬ç›˜åˆ°æŒ‡å®šç›®å½• 1 2 # å°† /dev/sde1 æŒ‚è½½åˆ°æŒ‡å®šç›®å½• sudo mount /dev/sde1 /vol2/1000/mydisk/usb_1024g 6ï¸âƒ£ éªŒè¯æŒ‚è½½ç»“æœ 1 2 3 4 5 # æŸ¥çœ‹æŒ‚è½½ç›®å½•å†…å®¹ ls -la /vol2/1000/mydisk/usb_1024g # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µå’Œæ–‡ä»¶ç³»ç»Ÿç±»å‹ df -hT /vol2/1000/mydisk/usb_1024g 7ï¸âƒ£ å–æ¶ˆæŒ‚è½½ï¼ˆå¦‚éœ€ï¼‰ 1 2 3 4 5 6 7 8 # å–æ¶ˆæŒ‚è½½ sudo umount /dev/sde1 # åˆ é™¤æŒ‚è½½ç›®å½•ï¼ˆå¯é€‰ï¼‰ sudo rm -rf /vol2/1000/mydisk/usb_1024g # åˆ·æ–° systemd é…ç½® sudo systemctl daemon-reload ğŸ”„ äºŒã€é…ç½®æ°¸ä¹…æŒ‚è½½ï¼ˆå¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼‰ 1ï¸âƒ£ è·å–ç£ç›˜çš„ UUID 1 2 3 4 5 # æŸ¥çœ‹ /dev/sde1 çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ UUID sudo blkid /dev/sde1 # ä»…æ˜¾ç¤º UUID sudo blkid -s UUID -o value /dev/sde1 2ï¸âƒ£ ç¼–è¾‘ /etc/fstab æ–‡ä»¶ 1 2 3 4 5 # æŸ¥çœ‹å½“å‰çš„ fstab é…ç½® cat /etc/fstab # å¤‡ä»½ fstab æ–‡ä»¶ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰ sudo cp /etc/fstab /etc/fstab.backup 3ï¸âƒ£ æ·»åŠ è‡ªåŠ¨æŒ‚è½½é…ç½® 1 2 # è¿½åŠ  NTFS ç¡¬ç›˜è‡ªåŠ¨æŒ‚è½½é…ç½® echo \u0026#39;UUID=AA8BBA167788F361 /vol2/1000/mydisk/usb_1024g ntfs nofail,x-systemd.device-timeout=15s 0 0\u0026#39; | sudo tee -a /etc/fstab 4ï¸âƒ£ æµ‹è¯•æŒ‚è½½é…ç½® 1 2 3 4 5 # æµ‹è¯• fstab é…ç½®æ˜¯å¦æ­£ç¡® sudo mount -a # æ£€æŸ¥æ˜¯å¦æˆåŠŸæŒ‚è½½ df -hT /vol2/1000/mydisk/usb_1024g ğŸ’¾ ä¸‰ã€FnOS æŒ‚è½½ USB 256G ç¡¬ç›˜ (NTFS æ ¼å¼) 1ï¸âƒ£ æŸ¥çœ‹ç£ç›˜è®¾å¤‡ 1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰ç£ç›˜ lsblk # æ£€æŸ¥ /dev/sdf1 çš„è¯¦ç»†ä¿¡æ¯ lsblk -f /dev/sdf 2ï¸âƒ£ å®‰è£… NTFS æ”¯æŒï¼ˆå¦‚æœªå®‰è£…ï¼‰ 1 sudo apt update \u0026amp;\u0026amp; sudo apt install -y ntfs-3g 3ï¸âƒ£ åˆ›å»ºæŒ‚è½½ç›®å½•å¹¶ä¿®å¤æ–‡ä»¶ç³»ç»Ÿ 1 2 3 4 5 # åˆ›å»ºæŒ‚è½½ç›®å½• sudo mkdir -pm 755 /vol2/1000/mydisk/usb_256g # ä¿®å¤ NTFS æ–‡ä»¶ç³»ç»Ÿ sudo ntfsfix /dev/sdf1 4ï¸âƒ£ æŒ‚è½½ç¡¬ç›˜ 1 2 # æŒ‚è½½ç¡¬ç›˜åˆ°æŒ‡å®šç›®å½• sudo mount /dev/sdf1 /vol2/1000/mydisk/usb_256g 5ï¸âƒ£ éªŒè¯æŒ‚è½½ç»“æœ 1 2 3 4 5 # æŸ¥çœ‹ç›®å½•å†…å®¹ ls -la /vol2/1000/mydisk/usb_256g # æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ df -hT /vol2/1000/mydisk/usb_256g 6ï¸âƒ£ é…ç½®æ°¸ä¹…æŒ‚è½½ 1 2 3 4 5 6 7 8 # è·å– /dev/sdf1 çš„ UUID sudo blkid /dev/sdf1 # æ·»åŠ è‡ªåŠ¨æŒ‚è½½é…ç½®åˆ° fstab echo \u0026#39;UUID=ã€ä½ çš„256Gç¡¬ç›˜UUIDã€‘ /vol2/1000/mydisk/usb_256g ntfs nofail,x-systemd.device-timeout=15s 0 0\u0026#39; | sudo tee -a /etc/fstab # æµ‹è¯•é…ç½® sudo mount -a âš™ï¸ å››ã€fstab é…ç½®è¯¦è§£ é…ç½®æ ¼å¼è¯´æ˜ 1 2 3 4 5 6 7 8 # fstab é…ç½®æ ¼å¼: # \u0026lt;æ–‡ä»¶ç³»ç»Ÿ\u0026gt; \u0026lt;æŒ‚è½½ç‚¹\u0026gt; \u0026lt;æ–‡ä»¶ç³»ç»Ÿç±»å‹\u0026gt; \u0026lt;é€‰é¡¹\u0026gt; \u0026lt;dump\u0026gt; \u0026lt;pass\u0026gt; # ext4 æ ¼å¼ç¤ºä¾‹: UUID=50a66a71-8fcd-42a5-a9ca-0cc06fa733e6 /mnt/mydisk ext4 nofail,x-systemd.device-timeout=15s 0 0 # NTFS æ ¼å¼ç¤ºä¾‹: UUID=AA8BBA167788F361 /vol2/1000/ntfs ntfs nofail,x-systemd.device-timeout=15s 0 0 é€‰é¡¹è¯´æ˜ nofail ğŸ›¡ï¸: ç³»ç»Ÿå¯åŠ¨æ—¶å¦‚æœè®¾å¤‡ä¸å­˜åœ¨ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œé¿å…å¯åŠ¨å¤±è´¥ x-systemd.device-timeout=15s â±ï¸: è®¾ç½®è®¾å¤‡æ£€æµ‹è¶…æ—¶æ—¶é—´ä¸º 15 ç§’ 0 ğŸ“Š: ä¸ä½¿ç”¨ dump å¤‡ä»½ 0 ğŸ”: å¯åŠ¨æ—¶ä¸ä½¿ç”¨ fsck æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ å¸¸ç”¨æŒ‚è½½é€‰é¡¹ 1 2 3 4 5 6 7 8 # å¸¸ç”¨é€‰é¡¹ç¤ºä¾‹: UUID=XXXX /mount/point ntfs defaults,uid=1000,gid=1000,umask=022 0 0 # æ”¯æŒä¸­æ–‡æ–‡ä»¶å: UUID=XXXX /mount/point ntfs defaults,iocharset=utf8 0 0 # åªè¯»æ¨¡å¼æŒ‚è½½: UUID=XXXX /mount/point ntfs ro 0 0 ğŸ”§ äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ 1. âŒ æŒ‚è½½å¤±è´¥ï¼šæƒé™ä¸è¶³ 1 2 3 4 5 # è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ sudo æ‰§è¡Œå‘½ä»¤ sudo mount /dev/sde1 /vol2/1000/mydisk/usb_1024g # æˆ–è€…å°†ç”¨æˆ·æ·»åŠ åˆ° disk ç»„ sudo usermod -aG disk $USER 2. âŒ æŒ‚è½½å¤±è´¥ï¼šæ–‡ä»¶ç³»ç»ŸæŸå 1 2 3 4 5 # è§£å†³æ–¹æ¡ˆï¼šä¿®å¤æ–‡ä»¶ç³»ç»Ÿ sudo ntfsfix /dev/sde1 # åœ¨ Windows ç³»ç»Ÿä¸‹è¿›è¡Œå®Œæ•´æ£€æŸ¥ chkdsk /f X: # (X: ä¸ºé©±åŠ¨å™¨ç›˜ç¬¦) 3. âŒ æŒ‚è½½å¤±è´¥ï¼šè®¾å¤‡å¿™ 1 2 3 4 5 6 7 8 9 # è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥å¹¶ç»ˆæ­¢å ç”¨è¿›ç¨‹ sudo lsof /dev/sde1 sudo kill -9 ã€è¿›ç¨‹IDã€‘ # æˆ–è€…å¼ºåˆ¶å¸è½½ sudo umount -f /dev/sde1 # ä½¿ç”¨ lazy unmount sudo umount -l /dev/sde1 4. âŒ è‡ªåŠ¨æŒ‚è½½å¤±è´¥ 1 2 3 4 5 6 7 8 # è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ fstab è¯­æ³• sudo mount -a # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— sudo journalctl -xe # æ£€æŸ¥ fstab æ–‡ä»¶æ ¼å¼ sudo cat /etc/fstab 5. âŒ ä¸­æ–‡æ–‡ä»¶åæ˜¾ç¤ºä¹±ç  1 2 3 4 5 # è§£å†³æ–¹æ¡ˆï¼šæŒ‡å®šå­—ç¬¦é›†æŒ‚è½½ sudo mount -o iocharset=utf8 /dev/sde1 /vol2/1000/mydisk/usb_1024g # æˆ–è€…åœ¨ fstab ä¸­æ·»åŠ å­—ç¬¦é›†é€‰é¡¹ UUID=AA8BBA167788F361 /vol2/1000/mydisk/usb_1024g ntfs nofail,x-systemd.device-timeout=15s,iocharset=utf8 0 0 6. âŒ ç£ç›˜åªè¯»æ— æ³•å†™å…¥ 1 2 3 4 5 # è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç£ç›˜çŠ¶æ€å¹¶é‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ sudo mount -o remount,rw /dev/sde1 # æ£€æŸ¥ç£ç›˜æ˜¯å¦å†™ä¿æŠ¤ sudo hdparm -r /dev/sde ğŸ’¡ å…­ã€å®ç”¨æŠ€å·§ 1. ğŸ“Š æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹ä½¿ç”¨æƒ…å†µ df -h # æŸ¥çœ‹æŒ‡å®šç›®å½•ä½¿ç”¨æƒ…å†µ du -sh /vol2/1000/mydisk/usb_1024g # æŸ¥çœ‹ç›®å½•å¤§å°è¯¦æƒ… sudo du -h --max-depth=1 /vol2/1000/mydisk/usb_1024g 2. âš¡ ç£ç›˜æ€§èƒ½æµ‹è¯• 1 2 3 4 5 6 7 8 # æµ‹è¯•ç£ç›˜è¯»å†™é€Ÿåº¦ sudo hdparm -Tt /dev/sde1 # ä½¿ç”¨ dd å‘½ä»¤æµ‹è¯•å†™å…¥é€Ÿåº¦ dd if=/dev/zero of=/vol2/1000/mydisk/usb_1024g/testfile bs=1G count=1 oflag=direct # æµ‹è¯•è¯»å–é€Ÿåº¦ dd if=/vol2/1000/mydisk/usb_1024g/testfile of=/dev/null bs=1G count=1 3. ğŸ·ï¸ è®¾ç½®ç£ç›˜æ ‡ç­¾ 1 2 3 4 5 6 7 8 # ç»™ NTFS åˆ†åŒºè®¾ç½®æ ‡ç­¾ sudo ntfslabel /dev/sde1 \u0026#34;My_Storage\u0026#34; # æŸ¥çœ‹æ ‡ç­¾ sudo ntfslabel /dev/sde1 # ä½¿ç”¨æ ‡ç­¾æŒ‚è½½ï¼ˆåœ¨ fstab ä¸­ï¼‰ LABEL=My_Storage /vol2/1000/mydisk/usb_1024g ntfs defaults 0 0 4. â¤ï¸ ç£ç›˜å¥åº·ç›‘æµ‹ 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£… smartmontools sudo apt install smartmontools # æŸ¥çœ‹ç£ç›˜å¥åº·çŠ¶æ€ sudo smartctl -a /dev/sde # è¿›è¡ŒçŸ­æœŸæµ‹è¯• sudo smartctl -t short /dev/sde # æŸ¥çœ‹æµ‹è¯•ç»“æœ sudo smartctl -l selftest /dev/sde 5. ğŸ”„ ç£ç›˜åŒæ­¥å·¥å…· 1 2 3 4 5 # ä½¿ç”¨ rsync åŒæ­¥æ•°æ® rsync -av --progress /source/directory/ /vol2/1000/mydisk/usb_1024g/ # ä½¿ç”¨ rclone è¿›è¡Œäº‘åŒæ­¥ rclone sync /vol2/1000/mydisk/usb_1024g remote:bucket ğŸ›¡ï¸ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ 1. ğŸ” æƒé™ç®¡ç† 1 2 3 4 5 6 7 # è®¾ç½®æŒ‚è½½ç›®å½•æƒé™ sudo chmod 755 /vol2/1000/mydisk/usb_1024g sudo chown root:root /vol2/1000/mydisk/usb_1024g # ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®è®¿é—®æƒé™ sudo chown user:user /vol2/1000/mydisk/usb_1024g sudo chmod 700 /vol2/1000/mydisk/usb_1024g 2. ğŸ“¤ å®‰å…¨å¸è½½ 1 2 3 4 5 6 7 8 9 # ç¡®ä¿æ•°æ®å†™å…¥å®Œæˆåå†å¸è½½ sync sudo umount /dev/sde1 # æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¿›ç¨‹å ç”¨ sudo lsof /vol2/1000/mydisk/usb_1024g # ä½¿ç”¨ eject å‘½ä»¤å®‰å…¨ç§»é™¤ sudo eject /dev/sde1 3. ğŸ’¾ å¤‡ä»½é‡è¦æ•°æ® 1 2 3 4 5 6 7 8 # å®šæœŸå¤‡ä»½é‡è¦æ•°æ® sudo tar -czf /backup/usb_backup_$(date +%Y%m%d).tar.gz /vol2/1000/mydisk/usb_1024g/important_data # ä½¿ç”¨ rsync è¿›è¡Œå¢é‡å¤‡ä»½ rsync -av --delete /vol2/1000/mydisk/usb_1024g/ /backup/usb_backup/ # è®¾ç½®å®šæ—¶è‡ªåŠ¨å¤‡ä»½ echo \u0026#34;0 2 * * * root tar -czf /backup/usb_backup_$(date +\\%Y\\%m\\%d).tar.gz /vol2/1000/mydisk/usb_1024g/important_data\u0026#34; | sudo tee -a /etc/crontab 4. ğŸš¨ ç£ç›˜åŠ å¯†å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 # è€ƒè™‘ä½¿ç”¨åŠ å¯†å®¹å™¨ä¿æŠ¤æ•æ„Ÿæ•°æ® sudo apt install cryptsetup # åˆ›å»ºåŠ å¯†å®¹å™¨ sudo cryptsetup luksFormat /dev/sde1 # æ‰“å¼€åŠ å¯†å®¹å™¨ sudo cryptsetup open /dev/sde1 encrypted_disk # åœ¨åŠ å¯†å®¹å™¨ä¸­åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ sudo mkfs.ntfs /dev/mapper/encrypted_disk ğŸ“‹ æ€»ç»“ é€šè¿‡æœ¬æ•™ç¨‹ï¼Œä½ å·²ç»å…¨é¢æŒæ¡äº†åœ¨ FnOS ç³»ç»Ÿä¸ŠæŒ‚è½½å’Œç®¡ç† NTFS æ ¼å¼ç¡¬ç›˜çš„å®Œæ•´æµç¨‹ï¼š\nâœ… è¯†åˆ«ç£ç›˜ ğŸ”: ä½¿ç”¨ lsblk å’Œ blkid å‘½ä»¤è¯†åˆ«ç£ç›˜è®¾å¤‡ âœ… å®‰è£…é©±åŠ¨ ğŸ“¦: å®‰è£… ntfs-3g åŒ…æ”¯æŒ NTFS æ–‡ä»¶ç³»ç»Ÿ âœ… æŒ‚è½½æ“ä½œ ğŸ—‚ï¸: ä½¿ç”¨ mount å‘½ä»¤æŒ‚è½½ç¡¬ç›˜åˆ°æŒ‡å®šç›®å½• âœ… è‡ªåŠ¨æŒ‚è½½ âš™ï¸: é…ç½® /etc/fstab å®ç°å¼€æœºè‡ªåŠ¨æŒ‚è½½ âœ… æ•…éšœæ’é™¤ ğŸ”§: è§£å†³å¸¸è§çš„æŒ‚è½½é—®é¢˜å’Œé”™è¯¯ âœ… å®ç”¨æŠ€å·§ ğŸ’¡: æŒæ¡ç£ç›˜ç®¡ç†å’Œä¼˜åŒ–æŠ€å·§ âœ… å®‰å…¨é˜²æŠ¤ ğŸ›¡ï¸: ç¡®ä¿æ•°æ®å®‰å…¨å’Œç³»ç»Ÿç¨³å®šæ€§ ç°åœ¨ä½ å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®å’Œç®¡ç†ä½ çš„å¤–éƒ¨å­˜å‚¨è®¾å¤‡äº†ï¼ğŸ’¾ğŸš€\nğŸ’¡ æ¸©é¦¨æç¤º: åœ¨è¿›è¡Œä»»ä½•ç£ç›˜æ“ä½œå‰ï¼Œè¯·åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ï¼Œé¿å…æ„å¤–æ•°æ®ä¸¢å¤±ã€‚å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚\nğŸŒŸ è¿›é˜¶å»ºè®®: å¯¹äºé‡è¦æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨ RAID é…ç½®æˆ–äº‘å¤‡ä»½æ–¹æ¡ˆï¼Œæä¾›å¤šé‡æ•°æ®ä¿æŠ¤ã€‚\nğŸ“š æ‰©å±•é˜…è¯»:\nLinux ç£ç›˜ç®¡ç†é«˜çº§æŠ€å·§ NTFS æ–‡ä»¶ç³»ç»Ÿè¯¦è§£ æ•°æ®å¤‡ä»½ä¸æ¢å¤ç­–ç•¥ ğŸ†˜ éœ€è¦å¸®åŠ©?:\nåœ¨è¯„è®ºåŒºç•™è¨€ ğŸ’¬ æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ ğŸ“„ åŠ å…¥æŠ€æœ¯ç¤¾åŒº ğŸ‘¥ ç¥ä½ åœ¨ FnOS ä¸Šä½¿ç”¨æ„‰å¿«ï¼ğŸ‰\n","date":"2025-08-26T13:54:45+08:00","image":"https://file.meimolihan.eu.org/img/fnos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1bd42968/","title":"FnOS æŒ‚è½½ NTFS æ ¼å¼ç¡¬ç›˜ ğŸ“‚"},{"content":"Linux æ–‡ä»¶ç³»ç»Ÿç›®å½•ç»“æ„ ğŸŒ³ ğŸ§ æ·±å…¥ç†è§£Linuxç›®å½•æ ‘ç»“æ„ï¼ŒæŒæ¡ç³»ç»Ÿç®¡ç†çš„æ ¸å¿ƒçŸ¥è¯†\nç›®å½• ğŸŒ æ¦‚è¿° ğŸ“ æ ¸å¿ƒç›®å½•è¯¦è§£ ğŸ—‚ï¸ / - æ ¹ç›®å½• ğŸ“¦ /bin - åŸºæœ¬å‘½ä»¤äºŒè¿›åˆ¶æ–‡ä»¶ ğŸš€ /boot - å¯åŠ¨æ–‡ä»¶ ğŸ’» /dev - è®¾å¤‡æ–‡ä»¶ âš™ï¸ /etc - é…ç½®æ–‡ä»¶ ğŸ  /home - ç”¨æˆ·ä¸»ç›®å½• ğŸ“š /lib - ç³»ç»Ÿåº“æ–‡ä»¶ ğŸ“€ /media å’Œ /mnt - æŒ‚è½½ç‚¹ ğŸ“¦ /opt - å¯é€‰è½¯ä»¶ ğŸ” /proc - è¿›ç¨‹ä¿¡æ¯ ğŸ‘‘ /root - rootç”¨æˆ·ç›®å½• âš¡ /sbin - ç³»ç»Ÿç®¡ç†å‘½ä»¤ ğŸ—‘ï¸ /tmp - ä¸´æ—¶æ–‡ä»¶ ğŸ“‚ /usr - ç”¨æˆ·ç¨‹åº ğŸ“Š /var - å¯å˜æ•°æ® ğŸ”§ å®ç”¨æŠ€å·§ ğŸ“ å¸¸ç”¨å‘½ä»¤ ğŸ“Š ç£ç›˜ç©ºé—´ç®¡ç† ğŸ” æ–‡ä»¶æŸ¥æ‰¾ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”´ å±é™©æ“ä½œ ğŸ›¡ï¸ æƒé™ç®¡ç† ğŸ“Š å¿«é€Ÿå‚è€ƒ ğŸ—ºï¸ ç›®å½•ç»“æ„é€ŸæŸ¥è¡¨ ğŸ”„ å¸¸ç”¨æ“ä½œé€ŸæŸ¥ ğŸ¯ å­¦ä¹ å»ºè®® ğŸŒ æ¦‚è¿° Linux æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨å±‚æ¬¡åŒ–çš„æ ‘çŠ¶ç»“æ„ï¼Œä»¥ /ï¼ˆæ ¹ç›®å½•ï¼‰ä¸ºèµ·ç‚¹ã€‚è¿™ç§ç»“æ„è®¾è®¡éµå¾ª FHSï¼ˆæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†ï¼‰ï¼Œä½¿å¾—ä¸åŒLinuxå‘è¡Œç‰ˆå…·æœ‰ä¸€è‡´çš„ç›®å½•å¸ƒå±€ã€‚\nğŸ¯ è®¾è®¡ç†å¿µï¼šä¸€åˆ‡çš†æ–‡ä»¶ï¼Œå±‚æ¬¡åˆ†æ˜ï¼Œå„å¸å…¶èŒï¼\nğŸ“Š ä¸»è¦ç‰¹ç‚¹ï¼š\nâœ… æ ‘çŠ¶å±‚æ¬¡ç»“æ„ âœ… åŒºåˆ†ç³»ç»Ÿæ–‡ä»¶å’Œç”¨æˆ·æ–‡ä»¶ âœ… æ ‡å‡†åŒ–ç›®å½•ç”¨é€” âœ… çµæ´»çš„æŒ‚è½½ç‚¹ç³»ç»Ÿ âœ… æƒé™æ§åˆ¶ç²¾ç»† ğŸ“ æ ¸å¿ƒç›®å½•è¯¦è§£ ğŸ—‚ï¸ / - æ ¹ç›®å½• æè¿°ï¼šæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„èµ·ç‚¹ï¼ŒåŒ…å«æ‰€æœ‰å…¶ä»–ç›®å½•å’Œæ–‡ä»¶\né‡è¦å†…å®¹ï¼š\nç³»ç»Ÿå¯åŠ¨å¿…éœ€çš„æ ¸å¿ƒç›®å½• ä¸åº”è¯¥ç›´æ¥å­˜æ”¾ç”¨æˆ·æ–‡ä»¶ ç¤ºä¾‹ï¼š\n1 ls / # æŸ¥çœ‹æ ¹ç›®å½•å†…å®¹ âš ï¸ æ³¨æ„ï¼šæ ¹ç›®å½•åº”ä¿æŒæ•´æ´ï¼Œé¿å…åœ¨æ­¤å­˜æ”¾ç”¨æˆ·æ•°æ®ã€‚\nğŸ“¦ /bin - åŸºæœ¬å‘½ä»¤äºŒè¿›åˆ¶æ–‡ä»¶ æè¿°ï¼šå­˜æ”¾ç³»ç»Ÿæœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä½¿ç”¨\nåŒ…å«å†…å®¹ï¼š\nls, cp, mv, rm, cat, mkdir ç­‰æ ¸å¿ƒå‘½ä»¤ ç³»ç»Ÿå¯åŠ¨å’Œä¿®å¤æ‰€éœ€çš„å·¥å…· ç‰¹ç‚¹ï¼š\nâœ… æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œ âœ… ç³»ç»Ÿå¯åŠ¨å¿…éœ€ âœ… å•ç”¨æˆ·æ¨¡å¼ä»å¯ç”¨ ç°ä»£å˜åŒ–ï¼šåœ¨ä¸€äº›æ–°ç³»ç»Ÿä¸­ï¼Œ/bin æ˜¯ /usr/bin çš„ç¬¦å·é“¾æ¥ã€‚\nğŸš€ /boot - å¯åŠ¨æ–‡ä»¶ æè¿°ï¼šåŒ…å«ç³»ç»Ÿå¯åŠ¨æ‰€éœ€çš„æ–‡ä»¶\né‡è¦æ–‡ä»¶ï¼š\nvmlinuz - Linuxå†…æ ¸æ–‡ä»¶ initrd.img - åˆå§‹å†…å­˜ç£ç›˜é•œåƒ grub/ - GRUBå¼•å¯¼åŠ è½½ç¨‹åºé…ç½® config-* - å†…æ ¸é…ç½®æ–‡ä»¶ âš ï¸ æ³¨æ„ï¼šä¸è¦éšæ„åˆ é™¤æ­¤ç›®å½•æ–‡ä»¶ï¼Œå¦åˆ™ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼\nå¤‡ä»½å»ºè®®ï¼šå®šæœŸå¤‡ä»½ /boot ç›®å½•ï¼Œç‰¹åˆ«æ˜¯å‡çº§å†…æ ¸å‰ã€‚\nğŸ’» /dev - è®¾å¤‡æ–‡ä»¶ æè¿°ï¼šä½“ç°Linux\u0026quot;ä¸€åˆ‡çš†æ–‡ä»¶\u0026quot;ç†å¿µï¼ŒåŒ…å«æ‰€æœ‰è®¾å¤‡æ–‡ä»¶\nå¸¸è§è®¾å¤‡ï¼š\n/dev/sda - ç¬¬ä¸€å—SATAç¡¬ç›˜ /dev/sdb - ç¬¬äºŒå—SATAç¡¬ç›˜ /dev/ttyUSB0 - ç¬¬ä¸€ä¸ªUSBä¸²å£è®¾å¤‡ /dev/null - ç©ºè®¾å¤‡ï¼ˆé»‘æ´ï¼‰ /dev/random - éšæœºæ•°ç”Ÿæˆå™¨ /dev/zero - é›¶æºè®¾å¤‡ ç‰¹æ®Šè®¾å¤‡æ–‡ä»¶ï¼š\nå—è®¾å¤‡ï¼šéšæœºè®¿é—®ï¼ˆå¦‚ç¡¬ç›˜ï¼‰ å­—ç¬¦è®¾å¤‡ï¼šé¡ºåºè®¿é—®ï¼ˆå¦‚é”®ç›˜ï¼‰ ç®¡ç†å‘½ä»¤ï¼š\n1 2 3 ls /dev # æŸ¥çœ‹æ‰€æœ‰è®¾å¤‡ fdisk -l # æŸ¥çœ‹ç£ç›˜è®¾å¤‡ lsblk # æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯ âš™ï¸ /etc - é…ç½®æ–‡ä»¶ æè¿°ï¼šç³»ç»Ÿçº§é…ç½®æ–‡ä»¶ä¸­å¿ƒ\né‡è¦é…ç½®æ–‡ä»¶ï¼š\n/etc/passwd - ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ /etc/group - ç”¨æˆ·ç»„ä¿¡æ¯ /etc/fstab - æ–‡ä»¶ç³»ç»ŸæŒ‚è½½è¡¨ /etc/hosts - ä¸»æœºåè§£æ /etc/network/ - ç½‘ç»œé…ç½® /etc/ssh/sshd_config - SSHæœåŠ¡é…ç½® /etc/crontab - è®¡åˆ’ä»»åŠ¡é…ç½® æ“ä½œç¤ºä¾‹ï¼š\n1 2 3 sudo nano /etc/hostname # ä¿®æ”¹ä¸»æœºå sudo nano /etc/hosts # ä¿®æ”¹ä¸»æœºè§£æ sudo systemctl restart networking # åº”ç”¨ç½‘ç»œæ›´æ”¹ ğŸ  /home - ç”¨æˆ·ä¸»ç›®å½• æè¿°ï¼šæ™®é€šç”¨æˆ·çš„ä¸ªäººç©ºé—´\nç»“æ„ç¤ºä¾‹ï¼š\n1 2 3 4 /home/ â”œâ”€â”€ alice/ # ç”¨æˆ·aliceçš„å®¶ç›®å½• â”œâ”€â”€ bob/ # ç”¨æˆ·bobçš„å®¶ç›®å½• â””â”€â”€ charlie/ # ç”¨æˆ·charlieçš„å®¶ç›®å½• ç”¨æˆ·ç›®å½•å†…å®¹ï¼š\n~/Desktop/ - æ¡Œé¢æ–‡ä»¶ ~/Documents/ - æ–‡æ¡£ ~/Downloads/ - ä¸‹è½½æ–‡ä»¶ ~/.config/ - ç”¨æˆ·é…ç½®ï¼ˆéšè—æ–‡ä»¶ï¼‰ ~/.bashrc - Bash shellé…ç½® ~/.ssh/ - SSHå¯†é’¥å’Œé…ç½® æƒé™ç®¡ç†ï¼š\n1 2 chmod 700 /home/username # è®¾ç½®ç”¨æˆ·ç›®å½•æƒé™ chown username:username /home/username # è®¾ç½®æ‰€æœ‰æƒ ğŸ“š /lib - ç³»ç»Ÿåº“æ–‡ä»¶ æè¿°ï¼šå­˜æ”¾ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„å…±äº«åº“\nåŒ…å«å†…å®¹ï¼š\n.so æ–‡ä»¶ï¼ˆå…±äº«å¯¹è±¡ï¼‰ å†…æ ¸æ¨¡å— ç³»ç»Ÿå‘½ä»¤ä¾èµ–çš„åº“æ–‡ä»¶ ç›¸å…³å‘½ä»¤ï¼š\n1 2 3 ldd /bin/ls # æŸ¥çœ‹lså‘½ä»¤ä¾èµ–çš„åº“ ldconfig # é‡å»ºåº“ç¼“å­˜ ls /lib/modules/$(uname -r)/kernel/ # æŸ¥çœ‹å†…æ ¸æ¨¡å— ç°ä»£å˜åŒ–ï¼šåœ¨ä¸€äº›æ–°ç³»ç»Ÿä¸­ï¼Œ/lib æ˜¯ /usr/lib çš„ç¬¦å·é“¾æ¥ã€‚\nğŸ“€ /media å’Œ /mnt - æŒ‚è½½ç‚¹ æè¿°ï¼šç”¨äºæŒ‚è½½å¤–éƒ¨å­˜å‚¨è®¾å¤‡\nåŒºåˆ«ï¼š\n/media/ - è‡ªåŠ¨æŒ‚è½½ï¼ˆUç›˜ã€å…‰ç›˜ç­‰ï¼‰ /mnt/ - æ‰‹åŠ¨æŒ‚è½½ï¼ˆä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼‰ æŒ‚è½½ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºæŒ‚è½½ç‚¹ sudo mkdir /mnt/usb # æ‰‹åŠ¨æŒ‚è½½Uç›˜ sudo mount /dev/sdb1 /mnt/usb # æŸ¥çœ‹æŒ‚è½½ä¿¡æ¯ df -h # å¸è½½ sudo umount /mnt/usb è‡ªåŠ¨æŒ‚è½½ï¼šç°ä»£æ¡Œé¢ç¯å¢ƒä¼šè‡ªåŠ¨åœ¨ /media/username/ ä¸‹æŒ‚è½½è®¾å¤‡ã€‚\nğŸ“¦ /opt - å¯é€‰è½¯ä»¶ æè¿°ï¼šç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•\nå…¸å‹ç»“æ„ï¼š\n1 2 3 4 5 6 /opt/ â”œâ”€â”€ google/ â”‚ â””â”€â”€ chrome/ â”œâ”€â”€ oracle/ â”‚ â””â”€â”€ java/ â””â”€â”€ sublime_text/ ç‰¹ç‚¹ï¼š\nâœ… ä¿æŒè½¯ä»¶ç‹¬ç«‹æ€§å’Œå®Œæ•´æ€§ âœ… ä¾¿äºç®¡ç†å’Œå¸è½½ âœ… é¿å…ä¸ç³»ç»ŸåŒ…ç®¡ç†å™¨å†²çª ğŸ” /proc - è¿›ç¨‹ä¿¡æ¯ æè¿°ï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¾ç¤ºå†…æ ¸å’Œè¿›ç¨‹ä¿¡æ¯\né‡è¦æ–‡ä»¶ï¼š\n/proc/cpuinfo - CPUä¿¡æ¯ /proc/meminfo - å†…å­˜ä¿¡æ¯ /proc/[pid]/ - ç‰¹å®šè¿›ç¨‹ä¿¡æ¯ /proc/version - å†…æ ¸ç‰ˆæœ¬ /proc/loadavg - ç³»ç»Ÿè´Ÿè½½ æŸ¥çœ‹ç¤ºä¾‹ï¼š\n1 2 3 cat /proc/cpuinfo # æŸ¥çœ‹CPUä¿¡æ¯ cat /proc/meminfo # æŸ¥çœ‹å†…å­˜ä¿¡æ¯ cat /proc/loadavg # æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ è¿›ç¨‹ä¿¡æ¯ï¼š\n1 2 3 # æŸ¥çœ‹è¿›ç¨‹1234çš„ä¿¡æ¯ ls /proc/1234/ cat /proc/1234/status ğŸ‘‘ /root - rootç”¨æˆ·ç›®å½• æè¿°ï¼šè¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰çš„å®¶ç›®å½•\nç‰¹ç‚¹ï¼š\nâ— éœ€è¦rootæƒé™è®¿é—® ğŸ’¡ ä¸ /home/root ä¸åŒ ğŸ”’ ç³»ç»Ÿç®¡ç†çš„é‡è¦ç›®å½• ğŸ“ å­˜æ”¾ç³»ç»Ÿç®¡ç†è„šæœ¬å’Œé…ç½® å®‰å…¨å»ºè®®ï¼šé¿å…åœ¨ /root ç›®å½•å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨åŠ å¯†å­˜å‚¨ã€‚\nâš¡ /sbin - ç³»ç»Ÿç®¡ç†å‘½ä»¤ æè¿°ï¼šç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„å‘½ä»¤\né‡è¦å‘½ä»¤ï¼š\nfdisk - ç£ç›˜åˆ†åŒº ifconfig - ç½‘ç»œé…ç½® reboot - é‡å¯ç³»ç»Ÿ shutdown - å…³é—­ç³»ç»Ÿ iptables - é˜²ç«å¢™é…ç½® fsck - æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ ç‰¹ç‚¹ï¼šéœ€è¦rootæƒé™æ‰§è¡Œ\nç°ä»£å˜åŒ–ï¼šåœ¨ä¸€äº›æ–°ç³»ç»Ÿä¸­ï¼Œ/sbin æ˜¯ /usr/sbin çš„ç¬¦å·é“¾æ¥ã€‚\nğŸ—‘ï¸ /tmp - ä¸´æ—¶æ–‡ä»¶ æè¿°ï¼šå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œé‡å¯åæ¸…ç©º\nç‰¹ç‚¹ï¼š\nâœ… æ‰€æœ‰ç”¨æˆ·å¯å†™å…¥ â° é‡å¯è‡ªåŠ¨æ¸…ç† ğŸ”’ æœ‰äº›ç³»ç»Ÿä¼šå®šæœŸæ¸…ç† ğŸ›¡ï¸ ä½¿ç”¨tmpfsï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰æé«˜æ€§èƒ½ å®‰å…¨è€ƒè™‘ï¼šè®¾ç½®é€‚å½“çš„ç²˜æ»ä½æƒé™ï¼š\n1 chmod 1777 /tmp # è®¾ç½®ç²˜æ»ä½ï¼Œç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ä»¶ ğŸ“‚ /usr - ç”¨æˆ·ç¨‹åº æè¿°ï¼šæœ€å¤§çš„ç›®å½•ä¹‹ä¸€ï¼ŒåŒ…å«ç”¨æˆ·åº”ç”¨ç¨‹åº\né‡è¦å­ç›®å½•ï¼š\n/usr/bin/ - ç”¨æˆ·å‘½ä»¤ /usr/lib/ - ç¨‹åºåº“ /usr/local/ - æœ¬åœ°å®‰è£…è½¯ä»¶ /usr/share/ - æ¶æ„æ— å…³æ•°æ® /usr/src/ - æºä»£ç  /usr/include/ - å¤´æ–‡ä»¶ /usr/local çš„é‡è¦æ€§ï¼š\n1 2 3 4 # ç¼–è¯‘å®‰è£…è½¯ä»¶åˆ°/usr/local ./configure --prefix=/usr/local make sudo make install ğŸ“Š /var - å¯å˜æ•°æ® æè¿°ï¼šå­˜æ”¾ç»å¸¸å˜åŒ–çš„æ–‡ä»¶\né‡è¦å†…å®¹ï¼š\n/var/log/ - ç³»ç»Ÿæ—¥å¿— /var/www/ - WebæœåŠ¡å™¨æ–‡ä»¶ /var/mail/ - ç”¨æˆ·é‚®ä»¶ /var/spool/ - é˜Ÿåˆ—æ–‡ä»¶ /var/cache/ - åº”ç”¨ç¨‹åºç¼“å­˜ /var/run/ - è¿è¡Œæ—¶çš„å˜é‡æ•°æ® æ—¥å¿—æŸ¥çœ‹ï¼š\n1 2 tail -f /var/log/syslog # å®æ—¶æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— journalctl -f # æŸ¥çœ‹systemdæ—¥å¿— æ—¥å¿—ç®¡ç†ï¼šä½¿ç”¨logrotateç®¡ç†æ—¥å¿—æ–‡ä»¶å¤§å°å’Œå†å²ã€‚\nğŸ”§ å®ç”¨æŠ€å·§ ğŸ“ å¸¸ç”¨å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å½“å‰ç›®å½• pwd # åˆ‡æ¢ç›®å½• cd /path/to/directory cd ~ # å›å®¶ç›®å½• cd - # è¿”å›ä¸Šä¸€ä¸ªç›®å½• cd .. # ä¸Šä¸€çº§ç›®å½• # åˆ—å‡ºç›®å½•å†…å®¹ ls -la # è¯¦ç»†åˆ—è¡¨ï¼ˆåŒ…å«éšè—æ–‡ä»¶ï¼‰ ls -lh # äººç±»å¯è¯»æ ¼å¼ ls -ltr # æŒ‰æ—¶é—´åå‘æ’åº tree # æ ‘çŠ¶æ˜¾ç¤ºç›®å½•ç»“æ„ ğŸ“Š ç£ç›˜ç©ºé—´ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h # æŸ¥çœ‹ç›®å½•å¤§å° du -sh /path/to/directory du -h --max-depth=1 /path # æŸ¥çœ‹ä¸€çº§å­ç›®å½•å¤§å° # æŸ¥æ‰¾å¤§æ–‡ä»¶ find / -type f -size +100M 2\u0026gt;/dev/null | xargs ls -lh # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ sudo rm -rf /tmp/* sudo apt autoremove # åˆ é™¤ä¸å†éœ€è¦çš„åŒ… sudo apt clean # æ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜ ğŸ” æ–‡ä»¶æŸ¥æ‰¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŒ‰åç§°æŸ¥æ‰¾æ–‡ä»¶ find / -name \u0026#34;filename\u0026#34; 2\u0026gt;/dev/null find / -iname \u0026#34;filename\u0026#34; # ä¸åŒºåˆ†å¤§å°å†™ # æŒ‰ç±»å‹æŸ¥æ‰¾ find / -type f -name \u0026#34;*.log\u0026#34; 2\u0026gt;/dev/null find / -type d -name \u0026#34;config\u0026#34; 2\u0026gt;/dev/null # æŒ‰æ—¶é—´æŸ¥æ‰¾ find / -mtime -7 # 7å¤©å†…ä¿®æ”¹çš„æ–‡ä»¶ find / -atime +30 # 30å¤©å‰è®¿é—®çš„æ–‡ä»¶ # ä½¿ç”¨locateï¼ˆæ›´å¿«ï¼‰ sudo updatedb # æ›´æ–°æ•°æ®åº“ locate filename # ä½¿ç”¨grepæœç´¢å†…å®¹ grep -r \u0026#34;search text\u0026#34; /path/to/search âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”´ å±é™©æ“ä½œ ä¸è¦éšæ„åˆ é™¤ç³»ç»Ÿæ–‡ä»¶\n1 2 3 4 # å±é™©ï¼å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ rm -rf /etc/ rm -rf /boot/ rm -rf /lib/ è°¨æ…æ“ä½œæ ¹ç›®å½•\n1 2 # é¿å…åœ¨æ ¹ç›®å½•åˆ›å»ºå¤§é‡æ–‡ä»¶ # ä¸è¦å°†ç”¨æˆ·æ•°æ®ç›´æ¥æ”¾åœ¨æ ¹ç›®å½• å¤‡ä»½é‡è¦é…ç½®\n1 2 3 # å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ cp /etc/fstab /etc/fstab.backup tar -czf etc-backup.tar.gz /etc/ å°å¿ƒä½¿ç”¨é€šé…ç¬¦\n1 2 # å±é™©ï¼å¯èƒ½åˆ é™¤é”™è¯¯æ–‡ä»¶ rm -rf *.txt # ç¡®ä¿åœ¨å½“å‰æ­£ç¡®ç›®å½• ğŸ›¡ï¸ æƒé™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æ­£ç¡®è®¾ç½®æ–‡ä»¶æƒé™ chmod 644 filename # ç”¨æˆ·è¯»å†™ï¼Œå…¶ä»–è¯» chmod 755 directory # ç”¨æˆ·è¯»å†™æ‰§è¡Œï¼Œå…¶ä»–è¯»æ‰§è¡Œ chmod 700 sensitive_file # ä»…ç”¨æˆ·å¯è®¿é—® # æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€… chown user:group filename chown -R user:group directory # é€’å½’æ›´æ”¹ # è®¾ç½®ç‰¹æ®Šæƒé™ chmod +s filename # è®¾ç½®SUID chmod +t directory # è®¾ç½®ç²˜æ»ä½ # æŸ¥çœ‹æƒé™ ls -la stat filename ğŸ“Š å¿«é€Ÿå‚è€ƒ ğŸ—ºï¸ ç›®å½•ç»“æ„é€ŸæŸ¥è¡¨ ç›®å½• ç”¨é€” é‡è¦å†…å®¹ / æ ¹ç›®å½• æ–‡ä»¶ç³»ç»Ÿèµ·ç‚¹ /bin åŸºæœ¬å‘½ä»¤ ls, cp, rm /boot å¯åŠ¨æ–‡ä»¶ å†…æ ¸, GRUBé…ç½® /dev è®¾å¤‡æ–‡ä»¶ ç¡¬ä»¶è®¾å¤‡æ¥å£ /etc é…ç½®æ–‡ä»¶ ç³»ç»Ÿé…ç½® /home ç”¨æˆ·ç›®å½• ç”¨æˆ·ä¸ªäººæ–‡ä»¶ /lib åº“æ–‡ä»¶ å…±äº«åº“ /media å¯ç§»åŠ¨åª’ä½“ è‡ªåŠ¨æŒ‚è½½ç‚¹ /mnt ä¸´æ—¶æŒ‚è½½ æ‰‹åŠ¨æŒ‚è½½ç‚¹ /opt å¯é€‰è½¯ä»¶ ç¬¬ä¸‰æ–¹åº”ç”¨ /proc è¿›ç¨‹ä¿¡æ¯ å†…æ ¸å’Œè¿›ç¨‹ä¿¡æ¯ /root rootç›®å½• ç®¡ç†å‘˜å®¶ç›®å½• /sbin ç³»ç»Ÿå‘½ä»¤ ç³»ç»Ÿç®¡ç†å·¥å…· /tmp ä¸´æ—¶æ–‡ä»¶ ä¸´æ—¶æ•°æ® /usr ç”¨æˆ·ç¨‹åº åº”ç”¨ç¨‹åºå’Œæ•°æ® /var å¯å˜æ•°æ® æ—¥å¿—ã€ç¼“å­˜ç­‰ ğŸ”„ å¸¸ç”¨æ“ä½œé€ŸæŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ cat /etc/os-release # ç³»ç»Ÿç‰ˆæœ¬ uname -a # å†…æ ¸ä¿¡æ¯ hostnamectl # ä¸»æœºä¿¡æ¯ lscpu # CPUä¿¡æ¯ free -h # å†…å­˜ä¿¡æ¯ # ç®¡ç†æœåŠ¡ sudo systemctl status servicename sudo systemctl start servicename sudo systemctl stop servicename sudo systemctl restart servicename sudo systemctl enable servicename # å¼€æœºå¯åŠ¨ sudo systemctl disable servicename # ç¦ç”¨å¼€æœºå¯åŠ¨ # åŒ…ç®¡ç† (Debian/Ubuntu) sudo apt update # æ›´æ–°åŒ…åˆ—è¡¨ sudo apt upgrade # å‡çº§æ‰€æœ‰åŒ… sudo apt install package # å®‰è£…åŒ… sudo apt remove package # åˆ é™¤åŒ… # åŒ…ç®¡ç† (RHEL/CentOS) sudo yum update # æ›´æ–°æ‰€æœ‰åŒ… sudo yum install package # å®‰è£…åŒ… sudo yum remove package # åˆ é™¤åŒ… ğŸ¯ å­¦ä¹ å»ºè®® ğŸ“š å¾ªåºæ¸è¿›ï¼šå…ˆæŒæ¡å¸¸ç”¨ç›®å½•ï¼Œå†å­¦ä¹ é«˜çº§åŠŸèƒ½ ğŸ› ï¸ å¤šå®è·µï¼šåœ¨è™šæ‹Ÿæœºä¸­ç»ƒä¹ ï¼Œé¿å…å½±å“ç”Ÿäº§ç³»ç»Ÿ ğŸ” å¥½å¥‡å¿ƒï¼šå¤šæ¢ç´¢ç³»ç»Ÿç›®å½•ï¼Œäº†è§£æ–‡ä»¶ç”¨é€” ğŸ“ è®°ç¬”è®°ï¼šè®°å½•é‡è¦ç›®å½•çš„ç”¨é€”å’Œæ³¨æ„äº‹é¡¹ ğŸ†˜ æ±‚åŠ©ï¼šé‡åˆ°é—®é¢˜æ—¶ä½¿ç”¨ man å‘½ä»¤æˆ–åœ¨çº¿æ–‡æ¡£ ğŸ”§ å®éªŒç¯å¢ƒï¼šä½¿ç”¨Dockerå®¹å™¨æˆ–è™šæ‹Ÿæœºè¿›è¡Œå®éªŒ ğŸ“– é˜…è¯»æ–‡æ¡£ï¼šæŸ¥é˜…FHSæ ‡å‡†å’Œå‘è¡Œç‰ˆæ–‡æ¡£ æ¨èèµ„æºï¼š\nFilesystem Hierarchy Standard Linux man pages Linux Documentation Project ğŸ’¡ ä¸“ä¸šæç¤ºï¼šç†è§£Linuxæ–‡ä»¶ç³»ç»Ÿç»“æ„æ˜¯æˆä¸ºç³»ç»Ÿç®¡ç†å‘˜çš„ç¬¬ä¸€æ­¥ã€‚èŠ±æ—¶é—´æ¢ç´¢æ¯ä¸ªç›®å½•ï¼Œäº†è§£å…¶ç”¨é€”å’Œé‡è¦æ€§ï¼Œè¿™å°†ä¸ºä½ çš„Linuxä¹‹æ—…æ‰“ä¸‹åšå®åŸºç¡€ã€‚\n","date":"2025-08-25T14:07:35+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/676f89e0/","title":"Linux æ–‡ä»¶ç³»ç»Ÿç›®å½•ç»“æ„ ğŸŒ³"},{"content":"Docker éƒ¨ç½²æ€æºç¬”è®° ğŸ“â˜ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²æ€æºç¬”è®° 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æ€æºç¬”è®° 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ æ€æºç¬”è®° å®˜ç½‘åœ°å€ï¼š https://b3log.org/siyuan ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/siyuan-note/siyuan ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/b3log/siyuan æ€æºç¬”è®° æ˜¯ä¸€æ¬¾æœ¬åœ°ä¼˜å…ˆçš„ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå®Œå…¨ç¦»çº¿ä½¿ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç«¯åˆ°ç«¯åŠ å¯†åŒæ­¥ã€‚\nç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œæ€æºç¬”è®°ï¼Œå®ç°æ•°æ®æŒä¹…åŒ–å’Œçµæ´»é…ç½®ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ§± å—çº§ç¼–è¾‘ æ¯ä¸ªæ®µè½ã€åˆ—è¡¨ã€æ ‡é¢˜éƒ½æ˜¯ç‹¬ç«‹å— æ”¯æŒå—çº§å¼•ç”¨ã€æ‹–æ‹½é‡ç»„ã€ç²¾ç»†åŒ–ç®¡ç†å†…å®¹ ğŸ”— åŒå‘é“¾æ¥ æ™ºèƒ½å…³ç³»å›¾ã€åå‘é“¾æ¥ è‡ªåŠ¨æ„å»ºçŸ¥è¯†ç½‘ç»œï¼Œæ­ç¤ºå†…å®¹å…³è”æ€§ ğŸ“Š å¤šç»´è¡¨æ ¼ æ”¯æŒå…¬å¼ã€æ’åºã€è¿‡æ»¤ æ•°æ®åº“çº§åˆ«çš„è¡¨æ ¼å¤„ç†èƒ½åŠ› ğŸ¨ Markdown æ”¯æŒ å®æ—¶æ¸²æŸ“ã€å¿«æ·é”®æ”¯æŒ çº¯é”®ç›˜æ“ä½œï¼Œæµç•…ä¹¦å†™ä½“éªŒ ğŸŒ è·¨å¹³å°åŒæ­¥ ç«¯åˆ°ç«¯åŠ å¯†åŒæ­¥ æ”¯æŒå¤šè®¾å¤‡å®‰å…¨åŒæ­¥ï¼Œä¿éšœæ•°æ®éšç§ ğŸ” å…¨å±€æœç´¢ æ”¯æŒ SQL æŸ¥è¯¢ã€æ¡ä»¶è¿‡æ»¤ å¼ºå¤§çš„æ£€ç´¢èƒ½åŠ›ï¼Œå¿«é€Ÿå®šä½å†…å®¹ ğŸ“š æ¨¡æ¿ç³»ç»Ÿ è‡ªå®šä¹‰æ¨¡æ¿ã€å¿«æ·é”®æ’å…¥ æé«˜é‡å¤å†…å®¹åˆ›ä½œæ•ˆç‡ ğŸ¯ æ’ä»¶ç³»ç»Ÿ ç¤¾åŒºæ’ä»¶å¸‚åœº åŠŸèƒ½æ‰©å±•çµæ´»ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ âš¡ ç¦»çº¿ä¼˜å…ˆ å®Œå…¨æœ¬åœ°åŒ–è¿è¡Œ ä¸ä¾èµ–ç½‘ç»œï¼Œæ•°æ®è‡ªä¸»å¯æ§ ğŸ”’ æ•°æ®å®‰å…¨ æœ¬åœ°å­˜å‚¨ + ç«¯åˆ°ç«¯åŠ å¯† å®Œå…¨æŒæ¡è‡ªå·±çš„æ•°æ®èµ„äº§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²æ€æºç¬”è®° 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/siyuan \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: siyuan: container_name: siyuan image: b3log/siyuan:latest restart: always ports: - \u0026#34;6806:6806\u0026#34; volumes: - ./workspace:/siyuan/workspace # æ•°æ®æŒä¹…åŒ– environment: - TZ=Asia/Shanghai - PUID=1000 - PGID=1000 command: - --workspace=/siyuan/workspace/ - --accessAuthCode=YOUR_SECURE_PASSWORD # âš ï¸ ä¿®æ”¹ä¸ºå¼ºå¯†ç  EOF ğŸ” é¦–æ¬¡ç™»å½•å¯†ç ï¼šå°† YOUR_SECURE_PASSWORD æ›¿æ¢æˆä½ è‡ªå·±çš„é«˜å¼ºåº¦å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æ€æºç¬”è®° 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:6806 åŸŸåè®¿é—®ï¼š https://siyuan.example.com:666 ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ è¾“å…¥ docker-compose.yml ä¸­è®¾ç½®çš„ accessAuthCode ç™»å½• åˆ›å»ºã€Œç¬”è®°æœ¬ã€â†’ æ–°å»ºæ–‡æ¡£ â†’ å¼€å§‹è®°å½•çŸ¥è¯†ï¼ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://siyuan.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/siyuan.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name siyuan.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:6806; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†æ€æºç¬”è®°ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° ç•…æ¸¸äºä¸ªäººçš„çŸ¥è¯†æµ·æ´‹ï¼Œè®°å½•çµæ„Ÿã€æ•´ç†æ€ç»ªã€æ„å»ºç³»ç»Ÿ\nğŸ” å®Œå…¨è‡ªä¸» æŒæ§æ‰€æœ‰æ•°æ®ï¼Œéšç§å®‰å…¨æ— å¿§ï¼Œç¬”è®°çœŸæ­£å±äºä½ è‡ªå·±\nâš¡ é«˜æ•ˆæµç•… äº«å—å—çº§ç¼–è¾‘ã€åŒå‘é“¾æ¥å¸¦æ¥çš„æè‡´ä¹¦å†™ä¸ç®¡ç†ä½“éªŒ\nçŸ¥è¯†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸è‡ªæˆ‘å¯¹è¯çš„æ¼«é•¿æ—…è¡Œã€‚æ„¿æ€æºç¬”è®°æˆä¸ºä½ å¿ å®çš„ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªæ€è€ƒçš„å¤œæ™šå’Œçµæ„Ÿçš„æ¸…æ™¨ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ’­ç§æ€è€ƒï¼Œæ”¶è·æ™ºæ…§â€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„æ•°å­—èŠ±å›­å§ï¼ğŸŒ¿\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ æ€æºç¬”è®°å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¹¦å†™æ„‰å¿«ï¼Œç¬”è®°æœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T14:03:26+08:00","image":"https://file.meimolihan.eu.org/img/docker-siyuan-01.webp","permalink":"https://blog.meimolihan.eu.org/p/97167d5a/","title":"Docker éƒ¨ç½²æ€æºç¬”è®° ğŸ“â˜ï¸"},{"content":"Windows CMD å‘½ä»¤å¤§å…¨ ğŸªŸ âš¡ æŒæ¡ Windows å‘½ä»¤è¡Œï¼Œæå‡ç³»ç»Ÿç®¡ç†æ•ˆç‡çš„ç»ˆææŒ‡å—\nğŸ“‘ ç›®å½•å¯¼èˆª ğŸ“ æ–‡ä»¶ä¸ç›®å½•ç®¡ç† ğŸŒ ç½‘ç»œç›¸å…³å‘½ä»¤ âš™ï¸ ç³»ç»Ÿä¿¡æ¯ä¸ç®¡ç† ğŸ’¾ ç£ç›˜ç®¡ç† ğŸ” æ–‡ä»¶æœç´¢ä¸å¤„ç† âš¡ ç³»ç»Ÿæ§åˆ¶ ğŸ“œ æ‰¹å¤„ç†è„šæœ¬ ğŸ¯ å®ç”¨æŠ€å·§ ğŸš€ é«˜çº§ç”¨æ³• ğŸ“ æ–‡ä»¶ä¸ç›®å½•ç®¡ç† ğŸ“‹ ç›®å½•æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 :: æ˜¾ç¤ºå½“å‰ç›®å½•å†…å®¹ dir dir /w :: å®½åˆ—è¡¨æ ¼å¼ dir /s :: åŒ…å«å­ç›®å½• dir /ah :: æ˜¾ç¤ºéšè—æ–‡ä»¶ dir /q :: æ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰è€… :: åˆ‡æ¢ç›®å½• cd C:\\Users cd /d D:\\Projects :: åˆ‡æ¢é©±åŠ¨å™¨ cd .. :: ä¸Šçº§ç›®å½• cd \\ :: æ ¹ç›®å½• :: åˆ›å»ºå’Œåˆ é™¤ç›®å½• mkdir NewFolder mkdir \u0026#34;Folder with Spaces\u0026#34; rmdir EmptyFolder rmdir /s /q FolderWithContent :: å¼ºåˆ¶åˆ é™¤ ğŸ“„ æ–‡ä»¶æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 :: å¤åˆ¶æ–‡ä»¶ copy source.txt destination.txt copy *.txt D:\\Backup\\ :: å¤åˆ¶æ‰€æœ‰txtæ–‡ä»¶ copy file1.txt + file2.txt combined.txt :: åˆå¹¶æ–‡ä»¶ :: ç§»åŠ¨å’Œé‡å‘½å move oldfile.txt newfile.txt move \u0026#34;old name.txt\u0026#34; \u0026#34;new name.txt\u0026#34; move *.log C:\\Logs\\ :: åˆ é™¤æ–‡ä»¶ del file.txt del *.tmp :: åˆ é™¤æ‰€æœ‰tmpæ–‡ä»¶ del /f read-only.txt :: å¼ºåˆ¶åˆ é™¤åªè¯»æ–‡ä»¶ del /s /q *.log :: é€’å½’é™é»˜åˆ é™¤æ—¥å¿— ğŸŒ ç½‘ç»œç›¸å…³å‘½ä»¤ ğŸ“¡ ç½‘ç»œè¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 :: æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping google.com ping -t 192.168.1.1 :: æŒç»­ping ping -n 10 8.8.8.8 :: æŒ‡å®šæ¬¡æ•° ping -l 1024 target.com :: æŒ‡å®šæ•°æ®åŒ…å¤§å° :: è·¯ç”±è¿½è¸ª tracert google.com tracert -d target.com :: ä¸è§£æä¸»æœºå tracert -h 30 target.com :: æœ€å¤§è·³æ•°30 :: è·¯å¾„è¯Šæ–­ pathping google.com :: æ›´è¯¦ç»†çš„è·¯ç”±åˆ†æ ğŸ”§ ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 :: IPé…ç½®ä¿¡æ¯ ipconfig ipconfig /all :: è¯¦ç»†ä¿¡æ¯ ipconfig /release :: é‡Šæ”¾IP ipconfig /renew :: ç»­è®¢IP ipconfig /flushdns :: æ¸…é™¤DNSç¼“å­˜ ipconfig /displaydns :: æ˜¾ç¤ºDNSç¼“å­˜ :: ç½‘ç»œè¿æ¥çŠ¶æ€ netstat -a :: æ‰€æœ‰è¿æ¥ netstat -an :: æ‰€æœ‰è¿æ¥(æ•°å­—æ ¼å¼) netstat -b :: æ˜¾ç¤ºè¿›ç¨‹å netstat -o :: æ˜¾ç¤ºè¿›ç¨‹ID netstat -s :: æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ ğŸ” DNS æŸ¥è¯¢ 1 2 3 4 5 6 7 8 :: DNSæŸ¥è¯¢ nslookup google.com nslookup -type=mx example.com :: æŸ¥è¯¢MXè®°å½• nslookup -debug example.com :: è°ƒè¯•æ¨¡å¼ :: æ¸…é™¤å¹¶æ³¨å†ŒDNS ipconfig /flushdns ipconfig /registerdns âš™ï¸ ç³»ç»Ÿä¿¡æ¯ä¸ç®¡ç† ğŸ“Š ç³»ç»Ÿä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 :: è¯¦ç»†ç³»ç»Ÿä¿¡æ¯ systeminfo systeminfo /s remote-pc :: è¿œç¨‹è®¡ç®—æœºä¿¡æ¯ :: ç¯å¢ƒå˜é‡ set :: æ˜¾ç¤ºæ‰€æœ‰å˜é‡ set PATH :: æ˜¾ç¤ºPATHå˜é‡ set MY_VAR=value :: è®¾ç½®ä¸´æ—¶å˜é‡ :: ç³»ç»Ÿç‰ˆæœ¬ ver wmic os get caption,version,buildnumber :: è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯ ğŸ¯ è¿›ç¨‹ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 :: è¿›ç¨‹åˆ—è¡¨ tasklist tasklist /v :: è¯¦ç»†ä¿¡æ¯ tasklist /fi \u0026#34;IMAGENAME eq chrome.exe\u0026#34; :: è¿‡æ»¤ tasklist /fo csv :: CSVæ ¼å¼è¾“å‡º tasklist /s remote-pc :: è¿œç¨‹è®¡ç®—æœº :: è¿›ç¨‹ç®¡ç† taskkill /im notepad.exe :: æŒ‰æ˜ åƒåç»“æŸ taskkill /pid 1234 /f :: å¼ºåˆ¶ç»“æŸæŒ‡å®šPID taskkill /fi \u0026#34;STATUS eq NOT RESPONDING\u0026#34; :: ç»“æŸæ— å“åº”è¿›ç¨‹ ğŸ› ï¸ ç³»ç»Ÿç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 :: ç£ç›˜æ£€æŸ¥ chkdsk C: chkdsk /f :: ä¿®å¤é”™è¯¯ chkdsk /r :: æŸ¥æ‰¾åæ‰‡åŒº chkdsk /scan :: åœ¨çº¿æ‰«æ :: ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥ sfc /scannow :: æ‰«æå¹¶ä¿®å¤ sfc /verifyonly :: ä»…æ‰«æ sfc /scanfile=file.txt :: æ‰«ææŒ‡å®šæ–‡ä»¶ :: é©±åŠ¨ç¨‹åºæŸ¥è¯¢ driverquery driverquery /v :: è¯¦ç»†ä¿¡æ¯ driverquery /fo csv :: CSVæ ¼å¼ ğŸ’¾ ç£ç›˜ç®¡ç† ğŸ›ï¸ ç£ç›˜ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 :: ç£ç›˜ä¿¡æ¯ vol C: label C: SystemDrive :: è®¾ç½®å·æ ‡ wmic logicaldisk get name,size,freespace :: æ‰€æœ‰ç£ç›˜ä¿¡æ¯ :: ç£ç›˜åˆ†åŒº diskpart :: åœ¨diskpartä¸­: list disk :: åˆ—å‡ºç£ç›˜ select disk 0 :: é€‰æ‹©ç£ç›˜ list partition :: åˆ—å‡ºåˆ†åŒº create partition primary size=10000 :: åˆ›å»ºåˆ†åŒº ğŸ’½ æ ¼å¼åŒ–ç®¡ç† 1 2 3 4 5 6 7 :: æ ¼å¼åŒ–ç£ç›˜ format D: /fs:ntfs :: NTFSæ ¼å¼ format /q :: å¿«é€Ÿæ ¼å¼åŒ– format /v:MyDrive :: è®¾ç½®å·æ ‡ :: ç£ç›˜å¤åˆ¶ diskcopy A: B: :: å¤åˆ¶ç£ç›˜(éœ€è¦è½¯é©±) ğŸ” æ–‡ä»¶æœç´¢ä¸å¤„ç† ğŸ” æ–‡ä»¶æœç´¢ 1 2 3 4 5 6 7 8 9 :: æŸ¥æ‰¾æ–‡ä»¶ dir /s *.txt :: é€’å½’æœç´¢txtæ–‡ä»¶ dir /s /b \u0026#34;filename.txt\u0026#34; :: ç®€æ´æ ¼å¼ :: æŸ¥æ‰¾ç©ºç›®å½• dir /ad /s | findstr /e \u0026#34; 0 File(s)\u0026#34; :: æŸ¥æ‰¾å¤§æ–‡ä»¶ forfiles /s /m * /c \u0026#34;cmd /c if @fsize gtr 10000000 echo @path @fsize\u0026#34; ğŸ“ å†…å®¹æœç´¢ 1 2 3 4 5 6 7 8 9 10 :: æ–‡æœ¬æœç´¢ find \u0026#34;error\u0026#34; log.txt find /i \u0026#34;warning\u0026#34; *.log :: ä¸åŒºåˆ†å¤§å°å†™ find /c \u0026#34;success\u0026#34; file.txt :: ç»Ÿè®¡å‡ºç°æ¬¡æ•° :: é«˜çº§æœç´¢ findstr /s \u0026#34;error\u0026#34; *.log :: é€’å½’æœç´¢ findstr /i \u0026#34;warning\u0026#34; *.txt :: å¿½ç•¥å¤§å°å†™ findstr /n \u0026#34;keyword\u0026#34; file.txt :: æ˜¾ç¤ºè¡Œå· findstr /r \u0026#34;^[0-9]\u0026#34; file.txt :: æ­£åˆ™è¡¨è¾¾å¼ âš¡ ç³»ç»Ÿæ§åˆ¶ â» å…³æœºä¸é‡å¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 :: å…³æœºå‘½ä»¤ shutdown /s :: å…³æœº shutdown /s /t 0 :: ç«‹å³å…³æœº shutdown /s /t 60 :: 60ç§’åå…³æœº shutdown /s /f :: å¼ºåˆ¶å…³é—­åº”ç”¨ :: é‡å¯å‘½ä»¤ shutdown /r :: é‡å¯ shutdown /r /t 0 :: ç«‹å³é‡å¯ shutdown /r /f :: å¼ºåˆ¶é‡å¯ :: å–æ¶ˆå…³æœº shutdown /a :: å–æ¶ˆè®¡åˆ’å…³æœº :: æ³¨é”€å’Œä¼‘çœ  shutdown /l :: æ³¨é”€ shutdown /h :: ä¼‘çœ  âš™ï¸ æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 :: æœåŠ¡ç®¡ç† net start :: æ˜¾ç¤ºè¿è¡ŒæœåŠ¡ net stop \u0026#34;Service Name\u0026#34; :: åœæ­¢æœåŠ¡ net start \u0026#34;Service Name\u0026#34; :: å¯åŠ¨æœåŠ¡ :: æœåŠ¡è¯¦ç»†ä¿¡æ¯ sc query :: æŸ¥è¯¢æœåŠ¡çŠ¶æ€ sc stop ServiceName :: åœæ­¢æœåŠ¡ sc start ServiceName :: å¯åŠ¨æœåŠ¡ ğŸ“œ æ‰¹å¤„ç†è„šæœ¬ ğŸ¯ åŸºæœ¬è„šæœ¬å‘½ä»¤ 1 2 3 4 5 6 7 @echo off :: å…³é—­å‘½ä»¤å›æ˜¾ echo Hello World! :: è¾“å‡ºæ–‡æœ¬ pause :: æš‚åœç­‰å¾…æŒ‰é”® exit :: é€€å‡ºè„šæœ¬ cls :: æ¸…å± title My Script :: è®¾ç½®çª—å£æ ‡é¢˜ color 0a :: è®¾ç½®é¢œè‰²(èƒŒæ™¯0,æ–‡å­—a) ğŸ”„ æµç¨‹æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 :: æ¡ä»¶åˆ¤æ–­ if exist file.txt ( echo File exists ) else ( echo File not found ) :: å¾ªç¯å¤„ç† for %%i in (*.txt) do echo Processing %%i for /l %%i in (1,1,10) do echo Number %%i :: ç”¨æˆ·è¾“å…¥ set /p name=Please enter your name: echo Hello, %name%! :: è°ƒç”¨å…¶ä»–è„šæœ¬ call other_script.bat ğŸ’¾ å˜é‡æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 :: å˜é‡è®¾ç½®å’Œä½¿ç”¨ set myvar=Hello echo %myvar% :: ç¯å¢ƒå˜é‡ echo %PATH% echo %USERNAME% echo %COMPUTERNAME% :: å‚æ•°ä¼ é€’ echo First parameter: %1 echo Second parameter: %2 echo All parameters: %* ğŸ¯ å®ç”¨æŠ€å·§ ğŸš€ é«˜æ•ˆä½¿ç”¨æŠ€å·§ 1 2 3 4 5 6 7 8 9 :: å‘½ä»¤å†å² F7 :: æŸ¥çœ‹å‘½ä»¤å†å² F8 :: æœç´¢å†å²å‘½ä»¤ â†‘/â†“ :: æµè§ˆå†å²å‘½ä»¤ :: è‡ªåŠ¨è¡¥å…¨ Tab :: è‡ªåŠ¨è¡¥å…¨è·¯å¾„/æ–‡ä»¶å Ctrl + C :: ç»ˆæ­¢å½“å‰å‘½ä»¤ Ctrl + Break :: ç»ˆæ­¢æ‰¹å¤„ç†è„šæœ¬ ğŸ¨ ç•Œé¢ç¾åŒ– 1 2 3 4 5 6 7 8 9 :: è®¾ç½®æ§åˆ¶å°å±æ€§ mode con: cols=100 lines=40 :: è®¾ç½®çª—å£å¤§å° prompt $p$g :: æ˜¾ç¤ºè·¯å¾„å’Œ\u0026gt; prompt $t$g :: æ˜¾ç¤ºæ—¶é—´å’Œ\u0026gt; prompt $u@$h$g :: æ˜¾ç¤ºç”¨æˆ·@ä¸»æœº\u0026gt; :: é¢œè‰²è®¾ç½® color 0a :: é»‘åº•ç»¿å­— color 1f :: è“åº•ç™½å­— ğŸš€ é«˜çº§ç”¨æ³• ğŸ”§ æ³¨å†Œè¡¨æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 :: æ³¨å†Œè¡¨æŸ¥è¯¢ reg query \u0026#34;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#34; reg query \u0026#34;HKLM\\SYSTEM\\CurrentControlSet\\Services\u0026#34; /s :: æ³¨å†Œè¡¨ä¿®æ”¹ reg add \u0026#34;HKCU\\Software\\MyApp\u0026#34; /v \u0026#34;Setting\u0026#34; /t REG_SZ /d \u0026#34;Value\u0026#34; reg delete \u0026#34;HKCU\\Software\\MyApp\u0026#34; /f :: å¯¼å‡ºå¯¼å…¥ reg export \u0026#34;HKCU\\Software\\MyApp\u0026#34; backup.reg reg import backup.reg ğŸ“Š ç³»ç»Ÿç›‘æ§ 1 2 3 4 5 6 7 8 9 10 :: æ€§èƒ½ç›‘æ§ typeperf \u0026#34;\\Processor(_Total)\\% Processor Time\u0026#34; -sc 10 typeperf \u0026#34;\\Memory\\Available MBytes\u0026#34; -sc 5 :: äº‹ä»¶æ—¥å¿— wevtutil qe System /c:5 /rd:true /f:text wevtutil qe Application /c:5 /rd:true /f:text :: èµ„æºä½¿ç”¨ systeminfo | findstr /C:\u0026#34;Total Physical Memory\u0026#34; /C:\u0026#34;Available Physical Memory\u0026#34; ğŸŒ é«˜çº§ç½‘ç»œ 1 2 3 4 5 6 7 8 9 10 11 :: ç«¯å£æ£€æµ‹ telnet hostname port netstat -ano | findstr :8080 :: ç½‘ç»œé‡ç½® netsh winsock reset netsh int ip reset :: é˜²ç«å¢™ç®¡ç† netsh advfirewall show allprofiles netsh advfirewall set allprofiles state on ğŸ’¡ ä¸“ä¸šæç¤º: ç†Ÿç»ƒæŒæ¡ CMD å‘½ä»¤å¯ä»¥æå¤§æé«˜ Windows ç³»ç»Ÿç®¡ç†æ•ˆç‡ã€‚å»ºè®®å°†å¸¸ç”¨å‘½ä»¤ä¿å­˜ä¸ºæ‰¹å¤„ç†è„šæœ¬ï¼Œå¹¶å®šæœŸå¤‡ä»½é‡è¦é…ç½®ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒæ“ä½œï¼ŒåŠ¡å¿…å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯å‘½ä»¤æ•ˆæœã€‚\n","date":"2025-08-25T13:41:27+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/d42e3c8a/","title":"Windows CMD å‘½ä»¤å¤§å…¨ ğŸªŸ"},{"content":"Docker éƒ¨ç½² Gitea ä»£ç ä»“åº“ ğŸ™âš™ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Gitea 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Gitea 1. é¦–æ¬¡é…ç½® âš™ï¸ 2. åˆ›å»ºä»“åº“ ğŸ“¦ 3. æ¨é€é€‰é¡¹å’Œæ¨é€åˆ›å»º ğŸ”„ 4. å¸¸ç”¨æ“ä½œ ğŸ› ï¸ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªä»£ç ï¼Œåä½œæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Gitea å®˜ç½‘åœ°å€ï¼š https://gitea.io/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/go-gitea/gitea ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/gitea/gitea Gitea æ˜¯ä¸€æ¬¾è½»é‡çº§ã€å¼€æºçš„è‡ªæ‰˜ç®¡ Git æœåŠ¡ï¼Œä½¿ç”¨ Go è¯­è¨€ç¼–å†™ã€‚å®ƒèµ„æºå ç”¨ä½ã€éƒ¨ç½²ç®€å•ã€åŠŸèƒ½é½å…¨ï¼Œé€‚åˆä¸ªäººä¸å°å›¢é˜Ÿå¿«é€Ÿæ­å»ºç§æœ‰ Git å¹³å°ã€‚\nä¸»è¦ç‰¹æ€§:\nğŸ¦ æè‡´è½»é‡ï¼šGo è¯­è¨€å•äºŒè¿›åˆ¶ï¼Œå†…å­˜å ç”¨ \u0026lt; 100MBï¼Œç”šè‡³å¯åœ¨æ ‘è“æ´¾ä¸Šè¿è¡Œ ğŸ”’ å®Œå…¨ç§æœ‰ï¼šä»£ç æœ¬åœ°å­˜å‚¨ï¼Œæƒé™è‡ªæ§ï¼Œå®‰å…¨åˆè§„ ğŸ“¦ åŠŸèƒ½å®Œæ•´ï¼šPR / Issue / Wiki / CI / Release / Org ä¸€åº”ä¿±å…¨ ğŸŒ å¤šåè®®ï¼šHTTP / HTTPS / SSH / Git LFS å…¨æ”¯æŒ ğŸ³ å®¹å™¨åŒ–ï¼šå®˜æ–¹é•œåƒï¼Œä¸€é”® Docker / K8s éƒ¨ç½² ğŸ”— Webhooksï¼šä¸ Jenkinsã€Drone ç­‰CI/CDå·¥å…·æ— ç¼é›†æˆ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Gitea 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 # åˆ›å»ºå¿…è¦çš„ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -p /mnt/mydisk/home/gitea/{data,config,mysql} \u0026amp;\u0026amp; \\ cd /mnt/mydisk/home/gitea \u0026amp;\u0026amp; \\ chown -R 1000:1000 /mnt/mydisk/home/gitea/data \u0026amp;\u0026amp; \\ # ç¡®ä¿Giteaç”¨æˆ·æœ‰å†™æƒé™ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: server: image: gitea/gitea:latest-rootless container_name: gitea restart: always ports: - \u0026#34;3033:3000\u0026#34; # Web ç•Œé¢ - \u0026#34;2233:22\u0026#34; # SSH environment: - GITEA__database__DB_TYPE=mysql - GITEA__database__HOST=db:3306 - GITEA__database__NAME=gitea - GITEA__database__USER=gitea - GITEA__database__PASSWD=gitea - TZ=Asia/Shanghai - USER_UID=1000 # ç¡®ä¿ä¸ä¸»æœºç”¨æˆ·IDåŒ¹é… - USER_GID=1000 volumes: - ./data:/var/lib/gitea # ä»“åº“æ•°æ® - ./config:/etc/gitea # é…ç½®æ–‡ä»¶ depends_on: db: condition: service_healthy networks: - gitea-network healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:3000\u0026#34;] interval: 30s timeout: 10s retries: 3 db: image: mysql:8 container_name: gitea-db restart: always environment: - MYSQL_ROOT_PASSWORD=giteaRootPwd - MYSQL_DATABASE=gitea - MYSQL_USER=gitea - MYSQL_PASSWORD=gitea - MYSQL_CHARSET=utf8mb4 - MYSQL_COLLATION=utf8mb4_unicode_ci volumes: - ./mysql:/var/lib/mysql networks: - gitea-network command: --default-authentication-plugin=mysql_native_password healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;mysqladmin\u0026#34;, \u0026#34;ping\u0026#34;, \u0026#34;-h\u0026#34;, \u0026#34;localhost\u0026#34;, \u0026#34;-u\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;-p$$MYSQL_ROOT_PASSWORD\u0026#34;] interval: 10s timeout: 5s retries: 3 networks: gitea-network: driver: bridge EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 cd /mnt/mydisk/home/gitea \u0026amp;\u0026amp; docker compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Gitea 1. é¦–æ¬¡é…ç½® âš™ï¸ æµè§ˆå™¨è®¿é—® http://\u0026lt;æœåŠ¡å™¨IP\u0026gt;:3033 æŒ‰å‘å¯¼å®Œæˆ æ•°æ®åº“è¿æ¥ï¼ˆå·²é¢„å¡« MySQLï¼‰ è®¾ç½® ç®¡ç†å‘˜è´¦æˆ·ã€é‚®ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰ æ³¨å†Œé¦–ä¸ªç®¡ç†å‘˜ â†’ ç™»å½•åå° é‡è¦é…ç½®æç¤ºï¼š\nåŸŸåï¼šé»˜è®¤ä¸ºlocalhostï¼Œéœ€è¦ä¿®æ”¹ä¸ºæœåŠ¡å™¨IPåœ°å€ï¼ˆä¾‹å¦‚192.168.1.100ï¼‰ SSH ç«¯å£å·ï¼šé»˜è®¤ä¸º22ï¼Œéœ€è¦ä¿®æ”¹ä¸ºå®¹å™¨å¯¹å¤–æš´éœ²çš„å¯¹åº”ç«¯å£ï¼ˆæœ¬ä¾‹ä¸º2233ï¼‰ HTTP ç«¯å£å·ï¼šé»˜è®¤ä¸º3000ï¼Œä¿æŒä¸å˜ åº”ç”¨ URLï¼šé»˜è®¤ä¸ºhttp://localhost:3000/ï¼Œéœ€è¦ä¿®æ”¹ä¸ºhttp://\u0026lt;æœåŠ¡å™¨IP\u0026gt;:3033 2. åˆ›å»ºä»“åº“ ğŸ“¦ Web åˆ›å»ºï¼šå³ä¸Šã€Œ+ New Repositoryã€ æœ¬åœ°æ¨é€ï¼š 1 2 git remote add gitea http://localhost:3033/\u0026lt;ç”¨æˆ·å\u0026gt;/\u0026lt;ä»“åº“\u0026gt;.git git push -u gitea main SSH æ¨é€ï¼š 1 2 3 4 ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; # å°† ~/.ssh/id_ed25519.pub å¤åˆ¶åˆ° Gitea â†’ ç”¨æˆ·è®¾ç½® â†’ SSH Keys git remote add gitea-ssh ssh://git@localhost:2233/\u0026lt;ç”¨æˆ·å\u0026gt;/\u0026lt;ä»“åº“\u0026gt;.git git push -u gitea-ssh main 3. æ¨é€é€‰é¡¹å’Œæ¨é€åˆ›å»º ğŸ”„ Giteaæ”¯æŒä¸€äº›é«˜çº§æ¨é€é€‰é¡¹ï¼š\n1 2 3 4 5 6 # æ¨é€æ—¶æ›´æ”¹ä»“åº“å¯è§æ€§ git push -o repo.private=false -u origin main # æ¨é€åˆ›å»ºï¼ˆéœ€åœ¨app.iniä¸­å¯ç”¨ï¼‰ git remote add origin git@gitea.example.com:username/new-repo.git git push -u origin main # å³ä½¿ä»“åº“ä¸å­˜åœ¨ä¹Ÿä¼šåˆ›å»º è¦å¯ç”¨æ¨é€åˆ›å»ºåŠŸèƒ½ï¼Œéœ€è¦åœ¨app.iniä¸­è®¾ç½®ï¼š\n1 2 3 [service] ENABLE_PUSH_CREATE_USER = true ENABLE_PUSH_CREATE_ORG = true 4. å¸¸ç”¨æ“ä½œ ğŸ› ï¸ 1 2 3 4 5 6 7 8 9 # å…‹éš†ä»“åº“ git clone http://localhost:3033/username/repo.git git clone ssh://git@localhost:2233/username/repo.git # æ·»åŠ è¿œç¨‹ä»“åº“ git remote add gitea http://localhost:3033/username/repo.git # æ¨é€åˆ° Gitea git push gitea main ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼šhttps://gitea.example.com:666\n1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/gitea.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name gitea.example.com; ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; client_max_body_size 100M; location / { proxy_pass http://localhost:3033; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; # WebSocket \u0026amp; SSE proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªä»£ç ï¼Œåä½œæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Gitea ä»£ç ä»“åº“ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° ç®¡ç†ä½ çš„ä»£ç ä»“åº“ï¼Œæ— è®ºæ˜¯ä¸ªäººé¡¹ç›®è¿˜æ˜¯å›¢é˜Ÿåä½œ\nğŸ” å®Œå…¨è‡ªä¸» æŒæ§æ‰€æœ‰ä»£ç èµ„äº§ï¼Œéšç§å®‰å…¨æ— å¿§ï¼Œä»£ç çœŸæ­£å±äºä½ è‡ªå·±\nâš¡ é«˜æ•ˆåä½œ äº«å— Git å¸¦æ¥çš„ç‰ˆæœ¬æ§åˆ¶ä¼˜åŠ¿å’Œå›¢é˜Ÿåä½œä¾¿åˆ©\nä»£ç ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸åˆ›é€ åŠ›å…±èˆçš„ç²¾å½©æ—…ç¨‹ã€‚æ„¿ Gitea æˆä¸ºä½ å¯é çš„ä»£ç ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªç¼–ç çš„æ·±å¤œå’Œçªç ´çš„ç¬é—´ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ’­ç§ä»£ç ï¼Œæ”¶è·æˆæœâ€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„ä»£ç å®åº“å§ï¼ğŸ’»\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Gitea å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ç¼–ç æ„‰å¿«ï¼Œåä½œæœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T13:38:38+08:00","image":"https://file.meimolihan.eu.org/img/docker-gitea-01.webp","permalink":"https://blog.meimolihan.eu.org/p/06d5803c/","title":"Docker éƒ¨ç½² gitea ä»£ç ä»“åº“ ğŸ™âš™ï¸"},{"content":"Docker éƒ¨ç½² random-pic-api éšæœºå£çº¸æœåŠ¡ ğŸ–¼ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ”— é¡¹ç›®åœ°å€ ğŸ³ ä¸€ã€Docker éƒ¨ç½² random-pic-api 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ random-pic-api 1. å…‹éš†é¡¹ç›®ä»“åº“ ğŸ“¦ 2. ä½¿ç”¨ Docker é•œåƒç¦»çº¿åŒ… ğŸš¢ 3. å›¾ç‰‡å¤„ç†ä¸ç®¡ç† ğŸ‘€ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè§†è§‰ï¼Œåˆ›æ„æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Nei-Xin/random-pic-api ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/neixin/random-pic-api random-pic-api æ˜¯ä¸€ä¸ªè½»é‡çº§çš„éšæœºå£çº¸ API æœåŠ¡ï¼Œä½¿ç”¨ PHP å¼€å‘å¹¶é€šè¿‡ Docker å®¹å™¨åŒ–éƒ¨ç½²ã€‚è¯¥é¡¹ç›®èƒ½å¤Ÿæ ¹æ®è®¾å¤‡ç±»å‹è‡ªåŠ¨æä¾›æ¨ªå±æˆ–ç«–å±å£çº¸ï¼Œæ”¯æŒ WebP æ ¼å¼è½¬æ¢ï¼Œå¹¶æä¾›ç®€æ´çš„ RESTful API æ¥å£ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ–¼ï¸ è‡ªåŠ¨åŒºåˆ†æ¨ªå±/ç«–å±å£çº¸ - æ™ºèƒ½è¯†åˆ«å›¾ç‰‡æ–¹å‘ï¼Œé€‚é…ä¸åŒè®¾å¤‡éœ€æ±‚ ğŸ”„ æ™ºèƒ½å›¾ç‰‡å¤„ç† - è‡ªåŠ¨è½¬æ¢ä¸º WebP æ ¼å¼ï¼Œä¼˜åŒ–åŠ è½½é€Ÿåº¦ ğŸ³ å®Œå…¨å®¹å™¨åŒ–éƒ¨ç½² - ç®€å•æ˜“ç”¨ï¼Œä¸€é”®éƒ¨ç½² ğŸ“± å¤šç«¯ç‚¹è®¿é—® - æ”¯æŒè‡ªé€‚åº”ã€PC å’Œç§»åŠ¨ç«¯ä¸‰ç§æ¨¡å¼ ğŸ”’ HTTPS å®‰å…¨è®¿é—® - æ”¯æŒ SSL åŠ å¯†ï¼Œä¿éšœæ•°æ®ä¼ è¾“å®‰å…¨ ğŸ“¦ ç¦»çº¿é•œåƒåŒ… - æä¾›å®Œæ•´ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆï¼Œé€‚åˆå†…ç½‘ç¯å¢ƒ âš¡ é«˜æ€§èƒ½å“åº” - ä¼˜åŒ–å¤„ç†æµç¨‹ï¼Œå¿«é€Ÿå“åº”è¯·æ±‚ ğŸ¨ é«˜è´¨é‡è¾“å‡º - ä¿æŒåŸå§‹ç”»è´¨çš„åŒæ—¶ä¼˜åŒ–æ–‡ä»¶å¤§å° ğŸ”— é¡¹ç›®åœ°å€ Docker Hub åœ°å€ï¼š https://hub.docker.com/r/neixin/random-pic-api GitHub åœ°å€ï¼š https://github.com/meimolihan/random-pic-api API æ¼”ç¤ºåœ°å€ï¼š è‡ªé€‚åº”ï¼š https://api.example.com:666 ç«–å±ï¼š https://api.example.com:666/mobile æ¨ªå±ï¼š https://api.example.com:666/pc ğŸ³ ä¸€ã€Docker éƒ¨ç½² random-pic-api 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/random-pic-api \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: random-pic-api: container_name: random-pic-api image: neixin/random-pic-api:latest restart: unless-stopped # é‡å¯ç­–ç•¥ volumes: - ./portrait:/var/www/html/portrait # ç«–å±å›¾ç‰‡ç›®å½• - ./landscape:/var/www/html/landscape # æ¨ªå±å›¾ç‰‡ç›®å½• - ./photos:/var/www/html/photos # åŸå§‹å›¾ç‰‡ç›®å½•(å¯é€‰) ports: - \u0026#34;8588:80\u0026#34; environment: - TZ=Asia/Shanghai # è®¾ç½®æ—¶åŒº EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ random-pic-api 1. å…‹éš†é¡¹ç›®ä»“åº“ ğŸ“¦ 1 2 git clone https://github.com/meimolihan/random-pic-api.git cd random-pic-api 2. ä½¿ç”¨ Docker é•œåƒç¦»çº¿åŒ… ğŸš¢ ä¸‹è½½ç¦»çº¿åŒ… 1 wget -c -O ~/random-pic-api-amd64.tar.gz https://github.com/meimolihan/DockerTarBuilder/releases/download/DockerTarBuilder-AMD64/neixin_random-pic-api-amd64.tar.gz åŠ è½½æœ¬åœ°é•œåƒ 1 docker load -i ~/random-pic-api-amd64.tar.gz 3. å›¾ç‰‡å¤„ç†ä¸ç®¡ç† ğŸ‘€ é¡¹ç›®æä¾›æ™ºèƒ½å›¾ç‰‡å¤„ç†è„šæœ¬ï¼Œè‡ªåŠ¨åˆ†ç±»å’Œè½¬æ¢å›¾ç‰‡ï¼š\nåŠŸèƒ½ç‰¹ç‚¹ ğŸ¯ è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡æ–¹å‘ï¼ˆæ¨ªå±/ç«–å±ï¼‰ ğŸ”„ æ‰¹é‡è½¬æ¢ä¸º WebP æ ¼å¼ï¼Œä¼˜åŒ–ç½‘ç»œä¼ è¾“ ğŸ“Š ä¿æŒåŸå§‹å›¾ç‰‡è´¨é‡çš„åŒæ—¶å‡å°æ–‡ä»¶å¤§å° âš¡ æ”¯æŒæ‰¹é‡å¤„ç†ï¼Œæé«˜æ•ˆç‡ ä½¿ç”¨æ–¹æ³• å°†åŸå§‹å›¾ç‰‡æ”¾å…¥ photos æ–‡ä»¶å¤¹ æ‰§è¡Œå¤„ç†è„šæœ¬ï¼š 1 python3 classify.py å¤„ç†æµç¨‹ï¼š è¯»å– photos æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å›¾ç‰‡ è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡æ–¹å‘å¹¶åˆ†ç±» è½¬æ¢ä¸º WebP æ ¼å¼å¹¶ä¿å­˜åˆ°ç›¸åº”ç›®å½•ï¼š ç«–å±å›¾ç‰‡ä¿å­˜è‡³ï¼športrait æ¨ªå±å›¾ç‰‡ä¿å­˜è‡³ï¼šlandscape ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 . â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ Dockerfile # PHP é•œåƒæ„å»ºæ–‡ä»¶ â”œâ”€â”€ index.php # ç½‘ç«™é¦–é¡µ â”œâ”€â”€ classify.py # å£çº¸æ•´ç†è„šæœ¬ â”œâ”€â”€ landscape # æ¨ªå±å£çº¸ç›®å½• â”‚ â”œâ”€â”€ test1.webp â”‚ â”œâ”€â”€ test2.webp â”‚ â””â”€â”€ test3.webp â”œâ”€â”€ photos # åŸå§‹å›¾ç‰‡ç›®å½• â”‚ â”œâ”€â”€ test1.jpg â”‚ â”œâ”€â”€ test2.jpg â”‚ â”œâ”€â”€ test3.jpg â”‚ â”œâ”€â”€ test4.jpg â”‚ â”œâ”€â”€ test5.jpg â”‚ â””â”€â”€ test6.jpg â””â”€â”€ portrait # ç«–å±å£çº¸ç›®å½• â”œâ”€â”€ test4.webp â”œâ”€â”€ test5.webp â””â”€â”€ test6.webp ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://api.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/random-pic-api.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name api.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/api.example.com/fullchain.pem; ssl_certificate_key /etc/nginx/ssl/api.example.com/privkey.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8588; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 4k; proxy_connect_timeout 30s; proxy_send_timeout 30s; proxy_read_timeout 30s; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè§†è§‰ï¼Œåˆ›æ„æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† random-pic-api éšæœºå£çº¸æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° è·å–ç²¾ç¾å£çº¸ï¼Œæ— è®ºæ˜¯æ¨ªå±è¿˜æ˜¯ç«–å±éƒ½èƒ½å®Œç¾é€‚é…\nğŸ¨ åˆ›æ„æ— é™ è‡ªå®šä¹‰å›¾ç‰‡åº“ï¼Œæ‰“é€ å±äºä½ ä¸ªäººé£æ ¼çš„å£çº¸é›†åˆ\nâš¡ é«˜æ•ˆç¨³å®š äº«å—å¿«é€Ÿå“åº”çš„ API æœåŠ¡ï¼ŒWebP æ ¼å¼ä¼˜åŒ–æå‡åŠ è½½é€Ÿåº¦\nè§†è§‰ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç¾å­¦å…±é¸£çš„çµæ„Ÿæ—…ç¨‹ã€‚æ„¿ random-pic-api æˆä¸ºä½ åˆ›æ„çš„æºæ³‰ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªè®¾è®¡çµæ„Ÿå’Œè§†è§‰äº«å—çš„ç¬é—´ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ¿€å‘åˆ›æ„ï¼Œç¾åŒ–è§†é‡â€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„è§†è§‰å®åº“å§ï¼ğŸ¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ random-pic-api é¡¹ç›®æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§†è§‰ä¹‹æ—…æ„‰å¿«ï¼Œåˆ›æ„æ— é™ï¼ğŸ‰\n","date":"2025-08-25T13:28:57+08:00","image":"https://file.meimolihan.eu.org/img/random-pic-api-001.webp","permalink":"https://blog.meimolihan.eu.org/p/ceb3a808/","title":"Docker éƒ¨ç½² random-pic-api éšæœºå£çº¸æœåŠ¡ ğŸ–¼ï¸"},{"content":"VSCode Markdown ç¼–è¾‘å¿«æ·é”®å¤§å…¨ âš¡ ğŸš€ æŒæ¡VSCodeå¿«æ·é”®ï¼Œæå‡Markdownå†™ä½œæ•ˆç‡ï¼Œæ‰“é€ æµç•…çš„æ–‡æ¡£ç¼–å†™ä½“éªŒ\nâœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ VSCode Markdown ç¼–è¾‘æä¾›ä»¥ä¸‹å¼ºå¤§åŠŸèƒ½ï¼š\nâš¡ é«˜æ•ˆç¼–è¾‘ï¼šä¸°å¯Œçš„å¿«æ·é”®æ”¯æŒï¼Œå¤§å¹…æå‡å†™ä½œå’Œç¼–è¾‘æ•ˆç‡ ğŸ‘ï¸ å®æ—¶é¢„è§ˆï¼šå†…ç½®Markdowné¢„è§ˆåŠŸèƒ½ï¼Œæ‰€è§å³æ‰€å¾— ğŸ¨ æ™ºèƒ½æ ¼å¼åŒ–ï¼šè‡ªåŠ¨è¡¥å…¨ã€ä»£ç ç‰‡æ®µå’Œè¯­æ³•é«˜äº®ï¼Œè®©å†™ä½œæ›´è½»æ¾ ğŸ”— ä¾¿æ·å¯¼èˆªï¼šå¿«é€Ÿè·³è½¬ã€å¤§çº²è§†å›¾å’Œç¬¦å·å¯¼èˆªï¼Œæ–¹ä¾¿é•¿æ–‡æ¡£ç®¡ç† ğŸ› ï¸ é«˜åº¦å¯å®šåˆ¶ï¼šæ”¯æŒè‡ªå®šä¹‰å¿«æ·é”®ã€ä¸»é¢˜å’Œæ‰©å±•ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ ğŸŒ å¤šå¹³å°æ”¯æŒï¼šWindowsã€macOSå’ŒLinuxå…¨å¹³å°ä¸€è‡´ä½“éªŒ ğŸ“– ç›®å½•å¯¼èˆª âŒ¨ï¸ åŸºç¡€ç¼–è¾‘å¿«æ·é”® ğŸ“ Markdownä¸“å±å¿«æ·é”® ğŸ” å¯¼èˆªä¸æœç´¢ ğŸ“Š è§†å›¾ä¸å¸ƒå±€ ğŸ¯ é«˜çº§ç¼–è¾‘æŠ€å·§ âš¡ æ•ˆç‡æå‡æŠ€å·§ ğŸ”§ è‡ªå®šä¹‰é…ç½® âŒ¨ï¸ åŸºç¡€ç¼–è¾‘å¿«æ·é”® ğŸ“ æ–‡æœ¬æ“ä½œ æ“ä½œ Windows/Linux macOS è¯´æ˜ ä¿å­˜æ–‡ä»¶ Ctrl + S Cmd + S å¿«é€Ÿä¿å­˜å½“å‰æ–‡ä»¶ æ’¤é”€æ“ä½œ Ctrl + Z Cmd + Z æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ é‡åšæ“ä½œ Ctrl + Y Cmd + Y é‡åšè¢«æ’¤é”€çš„æ“ä½œ å‰ªåˆ‡è¡Œ Ctrl + X Cmd + X å‰ªåˆ‡å½“å‰è¡Œ å¤åˆ¶è¡Œ Ctrl + C Cmd + C å¤åˆ¶å½“å‰è¡Œ ç²˜è´´è¡Œ Ctrl + V Cmd + V ç²˜è´´å‰ªè´´æ¿å†…å®¹ åˆ é™¤è¡Œ Ctrl + Shift + K Cmd + Shift + K åˆ é™¤æ•´è¡Œ å¤åˆ¶è¡Œå‘ä¸Š Alt + Shift + â†‘ Option + Shift + â†‘ å‘ä¸Šå¤åˆ¶è¡Œ å¤åˆ¶è¡Œå‘ä¸‹ Alt + Shift + â†“ Option + Shift + â†“ å‘ä¸‹å¤åˆ¶è¡Œ ç§»åŠ¨è¡Œå‘ä¸Š Alt + â†‘ Option + â†‘ å‘ä¸Šç§»åŠ¨è¡Œ ç§»åŠ¨è¡Œå‘ä¸‹ Alt + â†“ Option + â†“ å‘ä¸‹ç§»åŠ¨è¡Œ ğŸ“‘ é€‰æ‹©æ“ä½œ æ“ä½œ Windows/Linux macOS è¯´æ˜ é€‰æ‹©å½“å‰è¡Œ Ctrl + L Cmd + L é€‰æ‹©æ•´è¡Œå†…å®¹ å¤šé€‰ç›¸åŒè¯ Ctrl + D Cmd + D é€‰æ‹©ä¸‹ä¸€ä¸ªç›¸åŒå•è¯ é€‰æ‹©æ‰€æœ‰ç›¸åŒè¯ Ctrl + F2 Cmd + F2 é€‰æ‹©æ–‡æ¡£ä¸­æ‰€æœ‰ç›¸åŒå•è¯ åˆ—é€‰æ‹© Shift + Alt + æ‹–åŠ¨ Shift + Option + æ‹–åŠ¨ å¤šåˆ—åŒæ—¶é€‰æ‹© æ‰©å¤§é€‰æ‹©èŒƒå›´ Shift + Alt + â†’ Shift + Option + â†’ æ‰©å¤§é€‰æ‹©èŒƒå›´ ç¼©å°é€‰æ‹©èŒƒå›´ Shift + Alt + â† Shift + Option + â† ç¼©å°é€‰æ‹©èŒƒå›´ ğŸ“ Markdownä¸“å±å¿«æ·é”® ğŸ¨ æ–‡æœ¬æ ¼å¼åŒ– æ“ä½œ Windows/Linux macOS è¯´æ˜ ç²—ä½“æ–‡æœ¬ Ctrl + B Cmd + B ç²—ä½“ æ–œä½“æ–‡æœ¬ Ctrl + I Cmd + I æ–œä½“ ä»£ç å— Ctrl + Shift + ``` Cmd + Shift + ``` æ’å…¥ä»£ç å— è¡Œå†…ä»£ç  Ctrl + `` Cmd + `` ä»£ç  åˆ é™¤çº¿æ–‡æœ¬ Alt + Shift + S Option + Shift + S åˆ é™¤çº¿ ä¸‹åˆ’çº¿æ–‡æœ¬ Ctrl + U Cmd + U ä¸‹åˆ’çº¿ ğŸ“‹ åˆ—è¡¨ä¸ç»“æ„ æ“ä½œ Windows/Linux macOS è¯´æ˜ æ— åºåˆ—è¡¨ Ctrl + Shift + 8 Cmd + Shift + 8 - é¡¹ç›® æœ‰åºåˆ—è¡¨ Ctrl + Shift + 7 Cmd + Shift + 7 1. é¡¹ç›® å¼•ç”¨å— Ctrl + Shift + \u0026gt; Cmd + Shift + \u0026gt; \u0026gt; å¼•ç”¨ å¢åŠ ç¼©è¿› Ctrl + ] Cmd + ] å¢åŠ åˆ—è¡¨ç¼©è¿› å‡å°‘ç¼©è¿› Ctrl + [ Cmd + [ å‡å°‘åˆ—è¡¨ç¼©è¿› ä»»åŠ¡åˆ—è¡¨ Ctrl + Shift + ] Cmd + Shift + ] - [ ] ä»»åŠ¡ åˆ‡æ¢ä»»åŠ¡çŠ¶æ€ Ctrl + Enter Cmd + Enter åˆ‡æ¢å¤é€‰æ¡†çŠ¶æ€ ğŸ”— é“¾æ¥ä¸åª’ä½“ æ“ä½œ Windows/Linux macOS è¯´æ˜ æ’å…¥é“¾æ¥ Ctrl + K Ctrl + V Cmd + K Cmd + V æ–‡æœ¬ æ’å…¥å›¾ç‰‡ Ctrl + Shift + P â†’ \u0026ldquo;Insert Image\u0026rdquo; Cmd + Shift + P â†’ \u0026ldquo;Insert Image\u0026rdquo; å¿«é€Ÿé“¾æ¥ Ctrl + K Ctrl + L Cmd + K Cmd + L æ’å…¥é¡µå†…é“¾æ¥ æ‰“å¼€é“¾æ¥ Ctrl + Click Cmd + Click æ‰“å¼€é“¾æ¥ å¤åˆ¶é“¾æ¥åœ°å€ Ctrl + K Ctrl + V Cmd + K Cmd + V å¤åˆ¶é“¾æ¥URL ğŸ” å¯¼èˆªä¸æœç´¢ ğŸ§­ æ–‡ä»¶å¯¼èˆª æ“ä½œ Windows/Linux macOS è¯´æ˜ å¿«é€Ÿæ‰“å¼€ Ctrl + P Cmd + P æŒ‰æ–‡ä»¶åæœç´¢ è½¬åˆ°è¡Œå· Ctrl + G Cmd + G è·³è½¬åˆ°æŒ‡å®šè¡Œ è½¬åˆ°ç¬¦å· Ctrl + Shift + O Cmd + Shift + O è·³è½¬åˆ°æ ‡é¢˜ è½¬åˆ°å®šä¹‰ F12 F12 è½¬åˆ°é“¾æ¥ç›®æ ‡ æŸ¥çœ‹å¼•ç”¨ Shift + F12 Shift + F12 æŸ¥çœ‹ç¬¦å·å¼•ç”¨ åé€€ Alt + â† Ctrl + - å¯¼èˆªåé€€ å‰è¿› Alt + â†’ Ctrl + Shift + - å¯¼èˆªå‰è¿› åˆ‡æ¢æ ‡ç­¾é¡µ Ctrl + Tab Ctrl + Tab åˆ‡æ¢ç¼–è¾‘å™¨æ ‡ç­¾ ğŸ” æœç´¢æ›¿æ¢ æ“ä½œ Windows/Linux macOS è¯´æ˜ æŸ¥æ‰¾ Ctrl + F Cmd + F åœ¨å½“å‰æ–‡ä»¶æŸ¥æ‰¾ æ›¿æ¢ Ctrl + H Cmd + H æŸ¥æ‰¾å¹¶æ›¿æ¢ å…¨å±€æŸ¥æ‰¾ Ctrl + Shift + F Cmd + Shift + F åœ¨æ‰€æœ‰æ–‡ä»¶æŸ¥æ‰¾ æ­£åˆ™æŸ¥æ‰¾ Alt + R Option + R å¯ç”¨æ­£åˆ™è¡¨è¾¾å¼ æŸ¥æ‰¾ä¸‹ä¸€ä¸ª F3 Cmd + G æŸ¥æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹ æŸ¥æ‰¾ä¸Šä¸€ä¸ª Shift + F3 Cmd + Shift + G æŸ¥æ‰¾ä¸Šä¸€ä¸ªåŒ¹é…é¡¹ é€‰æ‹©æ‰€æœ‰åŒ¹é…é¡¹ Alt + Enter Option + Enter é€‰æ‹©æ‰€æœ‰åŒ¹é…é¡¹ ğŸ“Š è§†å›¾ä¸å¸ƒå±€ ğŸ–¥ï¸ ç•Œé¢æ§åˆ¶ æ“ä½œ Windows/Linux macOS è¯´æ˜ åˆ‡æ¢ä¾§è¾¹æ  Ctrl + B Cmd + B æ˜¾ç¤º/éšè—ä¾§è¾¹æ  åˆ‡æ¢ç»ˆç«¯ Ctrl + `` Cmd + `` æ˜¾ç¤º/éšè—ç»ˆç«¯ å‘½ä»¤é¢æ¿ Ctrl + Shift + P Cmd + Shift + P æ‰“å¼€å‘½ä»¤é¢æ¿ Markdowné¢„è§ˆ Ctrl + Shift + V Cmd + Shift + V æ‰“å¼€é¢„è§ˆçª—å£ ä¾§è¾¹é¢„è§ˆ Ctrl + K V Cmd + K V åœ¨ä¾§è¾¹æ‰“å¼€é¢„è§ˆ åˆ‡æ¢å…¨å± F11 Ctrl + Cmd + F åˆ‡æ¢å…¨å±æ¨¡å¼ åˆ‡æ¢zenæ¨¡å¼ Ctrl + K Z Cmd + K Z åˆ‡æ¢zenæ¨¡å¼ åˆ‡æ¢é¢åŒ…å±‘ Ctrl + Shift + . Cmd + Shift + . æ˜¾ç¤º/éšè—é¢åŒ…å±‘ ğŸ›ï¸ çª—å£ç®¡ç† æ“ä½œ Windows/Linux macOS è¯´æ˜ æ‹†åˆ†ç¼–è¾‘å™¨ Ctrl + \\ Cmd + \\ å·¦å³åˆ†å± åˆ‡æ¢ç¼–è¾‘å™¨ Ctrl + 1/2/3 Cmd + 1/2/3 åˆ‡æ¢ç¼–è¾‘ç»„ ç¼©æ”¾ç¼–è¾‘ç»„ Ctrl + = Cmd + = æ”¾å¤§ç¼–è¾‘å™¨ é‡ç½®ç¼©æ”¾ Ctrl + 0 Cmd + 0 é‡ç½®ç¼©æ”¾çº§åˆ« æ–°çª—å£ Ctrl + Shift + N Cmd + Shift + N æ–°å»ºçª—å£ å…³é—­çª—å£ Ctrl + Shift + W Cmd + Shift + W å…³é—­å½“å‰çª—å£ åˆ‡æ¢ç¼–è¾‘å™¨å¸ƒå±€ Shift + Alt + 0 Shift + Option + 0 åˆ‡æ¢å¸ƒå±€(æ°´å¹³/å‚ç›´) ğŸ¯ é«˜çº§ç¼–è¾‘æŠ€å·§ âœ¨ å¤šå…‰æ ‡æ“ä½œ æ“ä½œ Windows/Linux macOS è¯´æ˜ æ·»åŠ å…‰æ ‡ Alt + ç‚¹å‡» Option + ç‚¹å‡» æ·»åŠ æ–°å…‰æ ‡ åˆ—é€‰æ‹© Shift + Alt + æ‹–åŠ¨ Shift + Option + æ‹–åŠ¨ å¤šåˆ—ç¼–è¾‘ å‘ä¸Šæ·»åŠ å…‰æ ‡ Ctrl + Alt + â†‘ Cmd + Option + â†‘ å‘ä¸Šæ·»åŠ å…‰æ ‡ å‘ä¸‹æ·»åŠ å…‰æ ‡ Ctrl + Alt + â†“ Cmd + Option + â†“ å‘ä¸‹æ·»åŠ å…‰æ ‡ é€‰æ‹©æ‰€æœ‰å‡ºç° Ctrl + Shift + L Cmd + Shift + L é€‰æ‹©æ‰€æœ‰åŒ¹é…é¡¹ æ’å…¥å…‰æ ‡åˆ°è¡Œå°¾ Shift + Alt + I Shift + Option + I åœ¨æ¯è¡Œè¡Œå°¾æ·»åŠ å…‰æ ‡ æ’¤æ¶ˆå…‰æ ‡ Ctrl + U Cmd + U æ’¤æ¶ˆä¸Šä¸€ä¸ªå…‰æ ‡æ“ä½œ ğŸ”„ ä»£ç ç‰‡æ®µ æ“ä½œ Windows/Linux macOS è¯´æ˜ æ’å…¥ä»£ç ç‰‡æ®µ Ctrl + Space Cmd + Space æ˜¾ç¤ºä»£ç ç‰‡æ®µå»ºè®® è‡ªå®šä¹‰ç‰‡æ®µ Ctrl + Shift + P â†’ \u0026ldquo;Configure User Snippets\u0026rdquo; Cmd + Shift + P â†’ \u0026ldquo;Configure User Snippets\u0026rdquo; è‡ªå®šä¹‰ä»£ç ç‰‡æ®µ æ’å…¥å½“å‰æ—¥æœŸ éœ€è‡ªå®šä¹‰ç‰‡æ®µ éœ€è‡ªå®šä¹‰ç‰‡æ®µ æ’å…¥å½“å‰æ—¥æœŸ æ’å…¥å½“å‰æ—¶é—´ éœ€è‡ªå®šä¹‰ç‰‡æ®µ éœ€è‡ªå®šä¹‰ç‰‡æ®µ æ’å…¥å½“å‰æ—¶é—´ æ’å…¥ä»£ç å— Ctrl + Shift + ``` Cmd + Shift + ``` æ’å…¥ä»£ç å— æ’å…¥è¡¨æ ¼ éœ€è‡ªå®šä¹‰ç‰‡æ®µ éœ€è‡ªå®šä¹‰ç‰‡æ®µ æ’å…¥è¡¨æ ¼ç»“æ„ âš¡ æ•ˆç‡æå‡æŠ€å·§ ğŸš€ å®ç”¨å·¥ä½œæµ 1 2 3 4 5 6 7 1. **å¿«é€Ÿåˆ›å»ºæ ‡é¢˜**: ä½¿ç”¨ `# ç©ºæ ¼` è‡ªåŠ¨åˆ›å»ºæ ‡é¢˜ 2. **è‡ªåŠ¨è¡¥å…¨**: è¾“å…¥ `[]()` è‡ªåŠ¨è¡¥å…¨é“¾æ¥æ ¼å¼ 3. **è¡¨æ ¼ç”Ÿæˆ**: ä½¿ç”¨ `| åˆ—1 | åˆ—2 |` è‡ªåŠ¨æ ¼å¼åŒ–è¡¨æ ¼ 4. **ä»»åŠ¡åˆ—è¡¨**: `- [ ] ä»»åŠ¡` åˆ›å»ºå¤é€‰æ¡† 5. **è¡¨æƒ…ç¬¦å·**: è¾“å…¥ `:` è§¦å‘è¡¨æƒ…ç¬¦å·é€‰æ‹©å™¨ 6. **ç›®å½•ç”Ÿæˆ**: ä½¿ç”¨æ‰©å±•è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç›®å½• 7. **æ–‡æ¡£ç»Ÿè®¡**: ä½¿ç”¨æ‰©å±•æŸ¥çœ‹å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é—´ ğŸ“‹ å¸¸ç”¨å‘½ä»¤ å‘½ä»¤ åŠŸèƒ½ å¿«æ·é”® Markdown: Open Preview æ‰“å¼€é¢„è§ˆ Ctrl+Shift+V Markdown: Toggle Preview åˆ‡æ¢é¢„è§ˆ Ctrl+Shift+V Format Document æ ¼å¼åŒ–æ–‡æ¡£ Shift+Alt+F Fold All æŠ˜å æ‰€æœ‰æ ‡é¢˜ Ctrl+K Ctrl+0 Unfold All å±•å¼€æ‰€æœ‰æ ‡é¢˜ Ctrl+K Ctrl+J Fold Level 1 æŠ˜å ä¸€çº§æ ‡é¢˜ Ctrl+K Ctrl+1 Fold Level 2 æŠ˜å äºŒçº§æ ‡é¢˜ Ctrl+K Ctrl+2 Change All Occurrences æ›´æ”¹æ‰€æœ‰å‡ºç° Ctrl+F2 Rename Symbol é‡å‘½åç¬¦å· F2 Trigger Suggest è§¦å‘å»ºè®® Ctrl+Space ğŸ”§ è‡ªå®šä¹‰é…ç½® âš™ï¸ æ¨èè®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 { \u0026#34;[markdown]\u0026#34;: { \u0026#34;editor.wordWrap\u0026#34;: \u0026#34;on\u0026#34;, \u0026#34;editor.quickSuggestions\u0026#34;: { \u0026#34;comments\u0026#34;: \u0026#34;off\u0026#34;, \u0026#34;strings\u0026#34;: \u0026#34;off\u0026#34;, \u0026#34;other\u0026#34;: \u0026#34;on\u0026#34; }, \u0026#34;editor.fontSize\u0026#34;: 14, \u0026#34;editor.lineHeight\u0026#34;: 1.6, \u0026#34;editor.tabSize\u0026#34;: 2, \u0026#34;editor.insertSpaces\u0026#34;: true, \u0026#34;editor.trimAutoWhitespace\u0026#34;: true, \u0026#34;editor.renderWhitespace\u0026#34;: \u0026#34;boundary\u0026#34;, \u0026#34;editor.rulers\u0026#34;: [80, 100], \u0026#34;editor.foldingStrategy\u0026#34;: \u0026#34;indentation\u0026#34; }, \u0026#34;markdown.preview.fontSize\u0026#34;: 14, \u0026#34;markdown.preview.lineHeight\u0026#34;: 1.6, \u0026#34;markdown.preview.doubleClickToSwitchToEditor\u0026#34;: true, \u0026#34;markdown.preview.linkify\u0026#34;: true, \u0026#34;files.associations\u0026#34;: { \u0026#34;*.md\u0026#34;: \u0026#34;markdown\u0026#34; }, \u0026#34;emmet.includeLanguages\u0026#34;: { \u0026#34;markdown\u0026#34;: \u0026#34;html\u0026#34; } } ğŸ§© æ¨èæ‰©å±• Markdown All in One - å¢å¼ºMarkdownåŠŸèƒ½ï¼ˆå¿«æ·é”®ã€ç›®å½•ã€è‡ªåŠ¨å®Œæˆç­‰ï¼‰ Markdown Preview Enhanced - é«˜çº§é¢„è§ˆåŠŸèƒ½ï¼ˆæ•°å­¦å…¬å¼ã€å›¾è¡¨ç­‰ï¼‰ Paste Image - å¿«é€Ÿç²˜è´´å›¾ç‰‡åˆ°Markdown Markdown Lint - è¯­æ³•æ£€æŸ¥å’Œæ ¼å¼åŒ– Markdown Emoji - è¡¨æƒ…ç¬¦å·æ”¯æŒ Markdown Table Formatter - è¡¨æ ¼æ ¼å¼åŒ– Word Count - å­—æ•°ç»Ÿè®¡ Code Spell Checker - ä»£ç æ‹¼å†™æ£€æŸ¥ ğŸ¨ ä¸»é¢˜æ¨è GitHub Theme - GitHubé£æ ¼çš„Markdowné¢„è§ˆ Material Theme - Material Designé£æ ¼ One Dark Pro - æ·±è‰²ä¸»é¢˜ï¼Œä¿æŠ¤çœ¼ç› Solarized Light - æµ…è‰²ä¸»é¢˜ï¼Œé€‚åˆé•¿æ—¶é—´é˜…è¯» Night Owl - ä¸“ä¸šæ·±è‰²ä¸»é¢˜ï¼Œå¯¹æ¯”åº¦é€‚ä¸­ âŒ¨ï¸ è‡ªå®šä¹‰å¿«æ·é”® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // keybindings.json ä¸­çš„è‡ªå®šä¹‰å¿«æ·é”® [ { \u0026#34;key\u0026#34;: \u0026#34;ctrl+shift+1\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;markdown.extension.editing.toggleHeading\u0026#34;, \u0026#34;args\u0026#34;: { \u0026#34;level\u0026#34;: 1 }, \u0026#34;when\u0026#34;: \u0026#34;editorTextFocus \u0026amp;\u0026amp; editorLangId == markdown\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;ctrl+shift+2\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;markdown.extension.editing.toggleHeading\u0026#34;, \u0026#34;args\u0026#34;: { \u0026#34;level\u0026#34;: 2 }, \u0026#34;when\u0026#34;: \u0026#34;editorTextFocus \u0026amp;\u0026amp; editorLangId == markdown\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;ctrl+shift+3\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;markdown.extension.editing.toggleHeading\u0026#34;, \u0026#34;args\u0026#34;: { \u0026#34;level\u0026#34;: 3 }, \u0026#34;when\u0026#34;: \u0026#34;editorTextFocus \u0026amp;\u0026amp; editorLangId == markdown\u0026#34; }, { \u0026#34;key\u0026#34;: \u0026#34;ctrl+shift+i\u0026#34;, \u0026#34;command\u0026#34;: \u0026#34;editor.action.insertSnippet\u0026#34;, \u0026#34;when\u0026#34;: \u0026#34;editorTextFocus\u0026#34;, \u0026#34;args\u0026#34;: { \u0026#34;snippet\u0026#34;: \u0026#34;![${1:alt}](${2:url})${0}\u0026#34; } } ] ğŸ’¡ ä¸“ä¸šæç¤º: å»ºè®®å°†æœ€å¸¸ç”¨çš„å¿«æ·é”®åˆ¶ä½œæˆcheat sheetæ”¾åœ¨æ‰‹è¾¹ï¼Œå®šæœŸç»ƒä¹ ä½¿ç”¨ã€‚VSCodeçš„å¿«æ·é”®æ”¯æŒè‡ªå®šä¹‰ï¼Œå¯ä»¥æ ¹æ®ä¸ªäººä¹ æƒ¯è¿›è¡Œè°ƒæ•´ã€‚ä½¿ç”¨ Ctrl+K Ctrl+S (Windows/Linux) æˆ– Cmd+K Cmd+S (macOS) æ‰“å¼€é”®ç›˜å¿«æ·é”®ç¼–è¾‘å™¨è¿›è¡Œä¸ªæ€§åŒ–è®¾ç½®ã€‚\n","date":"2025-08-25T13:21:59+08:00","image":"https://file.meimolihan.eu.org/img/vscode.webp","permalink":"https://blog.meimolihan.eu.org/p/bcd92b7d/","title":"VSCode Markdown ç¼–è¾‘å¿«æ·é”®å¤§å…¨ âš¡"},{"content":"GitHub \u0026amp; Gitee SSH å¯†é’¥é…ç½®æŒ‡å— ğŸ”‘ ğŸš€ ä¸€ç«™å¼é…ç½® SSH å¯†é’¥ï¼Œè½»æ¾ç®¡ç†ä»£ç ä»“åº“\nğŸ“‹ ç›®å½• ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸ”‘ SSH å¯†é’¥ç”Ÿæˆ ğŸŒ GitHub é…ç½® ğŸ± Gitee é…ç½® âš™ï¸ SSH é…ç½®ç®¡ç† ğŸ” è¿æ¥éªŒè¯ ğŸ’¡ æ•…éšœæ’é™¤ ğŸš€ é«˜çº§ç”¨æ³• ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸŒŸ ä¸€ç«™å¼é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # ğŸš€ GitHub \u0026amp; Gitee SSH å¯†é’¥å¿«é€Ÿé…ç½®è„šæœ¬ echo \u0026#34;å¼€å§‹é…ç½® SSH å¯†é’¥...\u0026#34; # è®¾ç½®å…¨å±€ Git é…ç½® git config --global user.name \u0026#34;meimolihan\u0026#34; git config --global user.email \u0026#34;meimolihan@gmail.com\u0026#34; # åˆ›å»º SSH ç›®å½• mkdir -p ~/.ssh chmod 700 ~/.ssh echo \u0026#34;âœ… SSH é…ç½®å®Œæˆï¼\u0026#34; ğŸ”‘ SSH å¯†é’¥ç”Ÿæˆ ğŸ¯ ç”Ÿæˆ GitHub å¯†é’¥ 1 2 3 4 5 # ç”Ÿæˆ 4096 ä½ RSA å¯†é’¥ ssh-keygen -t rsa -b 4096 -C \u0026#34;meimolihan@gmail.com\u0026#34; -f ~/.ssh/id_rsa_github # æŸ¥çœ‹å…¬é’¥å†…å®¹ cat ~/.ssh/id_rsa_github.pub ğŸ± ç”Ÿæˆ Gitee å¯†é’¥ 1 2 3 4 5 # ç”Ÿæˆ Gitee ä¸“ç”¨å¯†é’¥ ssh-keygen -t rsa -b 4096 -C \u0026#34;meimolihan@gmail.com\u0026#34; -f ~/.ssh/id_rsa_gitee # æŸ¥çœ‹å…¬é’¥å†…å®¹ cat ~/.ssh/id_rsa_gitee.pub ğŸ“Š å¯†é’¥ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹æ‰€æœ‰å¯†é’¥ ls -la ~/.ssh/ # æ£€æŸ¥å¯†é’¥æŒ‡çº¹ ssh-keygen -lf ~/.ssh/id_rsa_github.pub ssh-keygen -lf ~/.ssh/id_rsa_gitee.pub # æµ‹è¯•å¯†é’¥æœ‰æ•ˆæ€§ ssh-keygen -y -f ~/.ssh/id_rsa_github ğŸŒ GitHub é…ç½® ğŸ“ æ·»åŠ  SSH å¯†é’¥åˆ° GitHub å¤åˆ¶å…¬é’¥åˆ°å‰ªè´´æ¿:\n1 2 3 4 5 6 7 8 # Linux/Mac cat ~/.ssh/id_rsa_github.pub | xclip -selection clipboard # Windows (Git Bash) cat ~/.ssh/id_rsa_github.pub | clip.exe # æ‰‹åŠ¨å¤åˆ¶ cat ~/.ssh/id_rsa_github.pub ç™»å½• GitHub:\nè®¿é—®: https://github.com/settings/keys ç‚¹å‡» \u0026ldquo;New SSH key\u0026rdquo; ç²˜è´´å…¬é’¥å†…å®¹ æ·»åŠ æè¿°: \u0026ldquo;Personal Laptop\u0026rdquo; ç‚¹å‡» \u0026ldquo;Add SSH key\u0026rdquo; âš™ï¸ GitHub é«˜çº§é…ç½® 1 2 3 4 5 # æ·»åŠ  GitHub åˆ°å·²çŸ¥ä¸»æœº ssh-keyscan -t rsa,ed25519 github.com \u0026gt;\u0026gt; ~/.ssh/known_hosts # éªŒè¯ä¸»æœºå¯†é’¥ ssh-keygen -lf ~/.ssh/known_hosts | grep github ğŸ± Gitee é…ç½® ğŸ“ æ·»åŠ  SSH å¯†é’¥åˆ° Gitee å¤åˆ¶å…¬é’¥åˆ°å‰ªè´´æ¿:\n1 2 3 4 5 6 7 8 # Linux/Mac cat ~/.ssh/id_rsa_gitee.pub | xclip -selection clipboard # Windows (Git Bash) cat ~/.ssh/id_rsa_gitee.pub | clip.exe # æ‰‹åŠ¨å¤åˆ¶ cat ~/.ssh/id_rsa_gitee.pub ç™»å½• Gitee:\nè®¿é—®: https://gitee.com/profile/sshkeys ç‚¹å‡» \u0026ldquo;æ·»åŠ å…¬é’¥\u0026rdquo; ç²˜è´´å…¬é’¥å†…å®¹ æ·»åŠ æ ‡é¢˜: \u0026ldquo;Work Desktop\u0026rdquo; ç‚¹å‡» \u0026ldquo;ç¡®å®š\u0026rdquo; âš™ï¸ Gitee é«˜çº§é…ç½® 1 2 3 4 5 # æ·»åŠ  Gitee åˆ°å·²çŸ¥ä¸»æœº ssh-keyscan -t rsa,ed25519 gitee.com \u0026gt;\u0026gt; ~/.ssh/known_hosts # éªŒè¯ä¸»æœºå¯†é’¥ ssh-keygen -lf ~/.ssh/known_hosts | grep gitee âš™ï¸ SSH é…ç½®ç®¡ç† ğŸ“ åˆ›å»º SSH é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # åˆ›å»ºæˆ–ç¼–è¾‘ SSH é…ç½® cat \u0026gt; ~/.ssh/config \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # GitHub é…ç½® Host github.com User git IdentityFile ~/.ssh/id_rsa_github Hostname ssh.github.com Port 443 IdentitiesOnly yes # Gitee é…ç½® Host gitee.com User git IdentityFile ~/.ssh/id_rsa_gitee IdentitiesOnly yes # é€šç”¨é…ç½® Host * AddKeysToAgent yes UseKeychain yes ServerAliveInterval 60 ServerAliveCountMax 5 EOF # è®¾ç½®æ­£ç¡®æƒé™ chmod 600 ~/.ssh/config ğŸ” è¿æ¥éªŒè¯ âœ… æµ‹è¯• GitHub è¿æ¥ 1 2 3 4 5 6 7 8 # æµ‹è¯• SSH è¿æ¥ ssh -T git@github.com # è¯¦ç»†è°ƒè¯•æ¨¡å¼ ssh -Tv git@github.com # é¢„æœŸè¾“å‡º: # Hi meimolihan! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. âœ… æµ‹è¯• Gitee è¿æ¥ 1 2 3 4 5 6 7 8 # æµ‹è¯• SSH è¿æ¥ ssh -T git@gitee.com # è¯¦ç»†è°ƒè¯•æ¨¡å¼ ssh -Tv git@gitee.com # é¢„æœŸè¾“å‡º: # Hi meimolihan(@meimolihan)! You\u0026#39;ve successfully authenticated, but GITEE.COM does not provide shell access. ğŸ’¡ æ•…éšœæ’é™¤ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1. æƒé™é—®é¢˜ 1 2 3 4 5 6 7 8 # ä¿®å¤æ–‡ä»¶æƒé™ chmod 700 ~/.ssh chmod 600 ~/.ssh/* chmod 644 ~/.ssh/*.pub chmod 644 ~/.ssh/known_hosts # æ£€æŸ¥æƒé™ ls -la ~/.ssh/ 2. è¿æ¥è¶…æ—¶ 1 2 3 4 5 6 7 8 9 10 # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping github.com ping gitee.com # æ£€æŸ¥é˜²ç«å¢™ sudo ufw status sudo iptables -L # ä½¿ç”¨ä¸åŒç«¯å£æµ‹è¯• ssh -T -p 443 git@ssh.github.com ğŸš€ é«˜çº§ç”¨æ³• ğŸ”§ å¤šå¹³å°é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¤š GitHub è´¦æˆ·é…ç½® cat \u0026gt;\u0026gt; ~/.ssh/config \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # ä¸ªäºº GitHub Host github.com-personal HostName github.com User git IdentityFile ~/.ssh/id_rsa_github_personal # å·¥ä½œ GitHub Host github.com-work HostName github.com User git IdentityFile ~/.ssh/id_rsa_github_work EOF âš¡ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # SSH è¿æ¥ä¼˜åŒ– cat \u0026gt;\u0026gt; ~/.ssh/config \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; Host * Compression yes ControlMaster auto ControlPath ~/.ssh/sockets/%r@%h:%p ControlPersist 4h TCPKeepAlive yes EOF # åˆ›å»º sockets ç›®å½• mkdir -p ~/.ssh/sockets ğŸ¯ æç¤º: ç°åœ¨ç›®å½•é“¾æ¥åº”è¯¥å¯ä»¥æ­£å¸¸è·³è½¬äº†ï¼å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“æ˜¯å“ªä¸ªé“¾æ¥æ— æ³•è·³è½¬ã€‚\nğŸ“š æ‰©å±•èµ„æº:\nGitHub SSH æ–‡æ¡£ Gitee SSH æ–‡æ¡£ ","date":"2025-08-25T13:16:38+08:00","image":"https://file.meimolihan.eu.org/img/github-01.webp","permalink":"https://blog.meimolihan.eu.org/p/7aeb9091/","title":"GitHub \u0026 Gitee SSH å¯†é’¥é…ç½®æŒ‡å— ğŸ”‘"},{"content":"Docker éƒ¨ç½² KSpeeder é•œåƒåŠ é€Ÿå™¨ ğŸš€ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² KSpeeder 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ âš™ï¸ äºŒã€æœåŠ¡ç«¯ä½¿ç”¨é…ç½® 1. é…ç½®æœåŠ¡ç«¯ Docker ä½¿ç”¨åŠ é€Ÿå™¨ âš™ï¸ 2. éªŒè¯åŠ é€Ÿå™¨æ˜¯å¦ç”Ÿæ•ˆ âœ… 3. è®¿é—®ç®¡ç†ç•Œé¢ ğŸ“Š ğŸŒ ä¸‰ã€å±€åŸŸç½‘å…¶ä»–è®¾å¤‡ä½¿ç”¨åŠ é€Ÿå™¨ 1. ç¯å¢ƒå‡†å¤‡ä¸è¯´æ˜ ğŸ“ 2. é…ç½®å±€åŸŸç½‘è®¾å¤‡ä½¿ç”¨åŠ é€Ÿå™¨ âš™ï¸ æ–¹æ³•ä¸€ï¼šå®¢æˆ·ç«¯ç‹¬ç«‹ä¿®æ”¹ï¼ˆæ¨èå•è®¾å¤‡ï¼‰ æ–¹æ³•äºŒï¼šå±€åŸŸç½‘å…¨å±€ä¿®æ”¹ï¼ˆæ¨èå¤šè®¾å¤‡ï¼‰ 3. é…ç½®éªŒè¯ä¸æµ‹è¯• âœ… ğŸŒ å››ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ äº”ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåŠ é€Ÿï¼Œæ•ˆç‡æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ KSpeeder å®˜ç½‘åœ°å€ï¼š https://kspeeder.com/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/linkease/docker_kspeeder ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/linkease/kspeeder KSpeeder æ˜¯ä¸€æ¬¾ç”± iStoreOS å›¢é˜Ÿå¼€å‘çš„æ™ºèƒ½ Docker é•œåƒåŠ é€Ÿå™¨æœåŠ¡ã€‚å®ƒé€šè¿‡å…ˆè¿›çš„ç¼“å­˜æŠ€æœ¯å’Œä»£ç†æœºåˆ¶ï¼Œæ˜¾è‘—æå‡ Docker é•œåƒçš„æ‹‰å–é€Ÿåº¦ï¼Œç‰¹åˆ«é’ˆå¯¹å›½å†…ç½‘ç»œç¯å¢ƒè®¿é—® Docker Hub ç­‰æµ·å¤–é•œåƒä»“åº“è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ã€‚ğŸš€\nä½¿ç”¨ KSpeeder å¯ä»¥ï¼š\nâš¡ åŠ é€Ÿ CI/CD æµç¨‹ - å‡å°‘æ„å»ºç­‰å¾…æ—¶é—´ ğŸŒ ä¼˜åŒ–å¼€å‘ä½“éªŒ - å¿«é€Ÿè·å–æ‰€éœ€é•œåƒ ğŸ“‰ é™ä½å¤±è´¥ç‡ - å‡å°‘å› ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„æ‹‰å–å¤±è´¥ ğŸ’° èŠ‚çœå¸¦å®½æˆæœ¬ - é€šè¿‡æ™ºèƒ½ç¼“å­˜å‡å°‘é‡å¤ä¸‹è½½ ğŸ³ ä¸€ã€Docker éƒ¨ç½² KSpeeder 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mkdir -p /mnt/mydisk/home/kspeeder \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: kspeeder: image: linkease/kspeeder:latest container_name: kspeeder ports: - \u0026#34;5443:5443\u0026#34; # é•œåƒåŠ é€ŸæœåŠ¡ç«¯å£ - \u0026#34;5003:5003\u0026#34; # Web ç®¡ç†ç•Œé¢ç«¯å£ volumes: - ./kspeeder-data:/kspeeder-data # æ•°æ®æŒä¹…åŒ–ç›®å½• - ./kspeeder-config:/kspeeder-config # é…ç½®æŒä¹…åŒ–ç›®å½• restart: unless-stopped environment: - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® - CACHE_SIZE=20G # ç¼“å­˜å¤§å°é™åˆ¶ï¼ˆå¯é€‰ï¼‰ EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d âš™ï¸ äºŒã€æœåŠ¡ç«¯ä½¿ç”¨é…ç½® è¯´æ˜ï¼šæ­¤éƒ¨åˆ†é’ˆå¯¹ è¿è¡Œ KSpeeder çš„æœåŠ¡ç«¯è®¾å¤‡ è¿›è¡Œé…ç½®ã€‚\n1. é…ç½®æœåŠ¡ç«¯ Docker ä½¿ç”¨åŠ é€Ÿå™¨ âš™ï¸ åœ¨éƒ¨ç½²äº† KSpeeder çš„æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦é…ç½® Docker ä½¿ç”¨æœ¬åœ°åŠ é€Ÿå™¨ï¼š\nä¿®æ”¹æˆ–åˆ›å»º Docker é…ç½®æ–‡ä»¶ /etc/docker/daemon.jsonï¼š 1 2 3 4 5 cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://registry.linkease.net:5443\u0026#34;] } EOF é‡å¯ Docker æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆï¼š 1 sudo systemctl restart docker ğŸ’¡ æç¤ºï¼šå¦‚æœæ‚¨çš„æœåŠ¡å™¨éœ€è¦é€šè¿‡ localhost è®¿é—®ï¼Œç¡®ä¿ registry.linkease.net åœ¨æœåŠ¡å™¨ä¸Šè§£æä¸º 127.0.0.1 æˆ–æœåŠ¡å™¨çš„å±€åŸŸç½‘ IPã€‚\n2. éªŒè¯åŠ é€Ÿå™¨æ˜¯å¦ç”Ÿæ•ˆ âœ… æ‹‰å–æµ‹è¯•é•œåƒéªŒè¯åŠ é€Ÿæ•ˆæœï¼š 1 docker pull hello-world æ£€æŸ¥ Docker é…ç½®ï¼š 1 docker info | grep -i mirror åº”è¯¥èƒ½çœ‹åˆ°é…ç½®çš„åŠ é€Ÿå™¨åœ°å€ã€‚\n3. è®¿é—®ç®¡ç†ç•Œé¢ ğŸ“Š æ‰“å¼€æµè§ˆå™¨è®¿é—® http://æœåŠ¡å™¨IP:5003 æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡ã€å¸¦å®½èŠ‚çœæƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ ç›‘æ§æœåŠ¡çŠ¶æ€å’Œç¼“å­˜å‘½ä¸­ç‡ ğŸŒ ä¸‰ã€å±€åŸŸç½‘å…¶ä»–è®¾å¤‡ä½¿ç”¨åŠ é€Ÿå™¨ è¯´æ˜ï¼šæ­¤éƒ¨åˆ†é’ˆå¯¹ å±€åŸŸç½‘å†…å…¶ä»–éœ€è¦åŠ é€Ÿçš„è®¾å¤‡ è¿›è¡Œé…ç½®ã€‚\n1. ç¯å¢ƒå‡†å¤‡ä¸è¯´æ˜ ğŸ“ å…ˆå†³æ¡ä»¶ï¼š\nKSpeeder æœåŠ¡å·²åœ¨æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ 10.10.10.251ï¼‰ä¸Šæ­£å¸¸è¿è¡Œ å®¢æˆ·ç«¯è®¾å¤‡ä¸æœåŠ¡å™¨åœ¨åŒä¸€å±€åŸŸç½‘å†… å®¢æˆ·ç«¯è®¾å¤‡ä¸Šå·²å®‰è£… Docker ç½‘ç»œä¿¡æ¯ç¤ºä¾‹ï¼š\nKSpeeder æœåŠ¡å™¨ï¼šIP åœ°å€ä¸º 10.10.10.251 å®¢æˆ·ç«¯è®¾å¤‡ï¼šIP åœ°å€ä¸º 10.10.10.246 é‡è¦ï¼šå±€åŸŸç½‘è®¾å¤‡éœ€è¦å°† registry.linkease.net è§£æåˆ° KSpeeder æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œæ‰èƒ½ä½¿ç”¨åŠ é€ŸæœåŠ¡ã€‚\n2. é…ç½®å±€åŸŸç½‘è®¾å¤‡ä½¿ç”¨åŠ é€Ÿå™¨ âš™ï¸ æ–¹æ³•ä¸€ï¼šå®¢æˆ·ç«¯ç‹¬ç«‹ä¿®æ”¹ï¼ˆæ¨èå•è®¾å¤‡ï¼‰ æ­¤æ–¹æ³•ä»…åœ¨éœ€è¦åŠ é€Ÿçš„å•ä¸ªå®¢æˆ·ç«¯è®¾å¤‡ä¸Šä¿®æ”¹ï¼Œä¸å½±å“å±€åŸŸç½‘å…¶ä»–è®¾å¤‡ã€‚\næ­¥éª¤ï¼š\né…ç½® Docker é•œåƒæºï¼š\n1 2 3 4 5 6 7 cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://registry.linkease.net:5443\u0026#34;] } EOF sudo systemctl restart docker ä¿®æ”¹ /etc/hosts æ–‡ä»¶ï¼ˆä½¿åŸŸåè§£æåˆ° KSpeeder æœåŠ¡å™¨ï¼‰ï¼š\n1 2 # ä½¿ç”¨ä¸€é”®è¿½åŠ å‘½ä»¤ echo \u0026#34;10.10.10.251 registry.linkease.net\u0026#34; | sudo tee -a /etc/hosts éªŒè¯åŸŸåè§£æï¼š\n1 ping registry.linkease.net åº”è¯¥æ˜¾ç¤ºè§£æåˆ° 10.10.10.251ã€‚\næ–¹æ³•äºŒï¼šå±€åŸŸç½‘å…¨å±€ä¿®æ”¹ï¼ˆæ¨èå¤šè®¾å¤‡ï¼‰ æ­¤æ–¹æ³•åœ¨å±€åŸŸç½‘çš„è·¯ç”±å™¨æˆ–ä¸» DNS æœåŠ¡å™¨ä¸Šè¿›è¡Œé…ç½®ï¼Œæ‰€æœ‰æ¥å…¥è¯¥ç½‘ç»œçš„è®¾å¤‡æ— éœ€å•ç‹¬è®¾ç½®å³å¯ä½¿ç”¨ KSpeeder åŠ é€ŸæœåŠ¡ã€‚\næ–¹æ¡ˆ Aï¼šä¿®æ”¹è·¯ç”±å™¨ Hosts æ–‡ä»¶ é€‚ç”¨äºæ”¯æŒè‡ªå®šä¹‰ Hosts æ–‡ä»¶çš„è·¯ç”±å™¨ç³»ç»Ÿï¼ˆå¦‚ OpenWrt, LEDE ç­‰ï¼‰ã€‚\n1 2 3 4 5 6 7 8 # é€šè¿‡ SSH ç™»å½•è·¯ç”±å™¨ ssh admin@è·¯ç”±å™¨IP # ä½¿ç”¨ä¸€é”®è¿½åŠ å‘½ä»¤ echo \u0026#34;10.10.10.251 registry.linkease.net\u0026#34; | sudo tee -a /etc/hosts # é‡å¯ DNS æœåŠ¡ /etc/init.d/dnsmasq reload æ–¹æ¡ˆ Bï¼šé…ç½® Dnsmasq è§£æè§„åˆ™ å¦‚æœè·¯ç”±å™¨ä½¿ç”¨ Dnsmasq ä½œä¸º DNS æœåŠ¡å™¨ï¼Œå¯é€šè¿‡ Web ç•Œé¢é…ç½®ï¼š\nç™»å½•è·¯ç”±å™¨ Web ç®¡ç†ç•Œé¢ å¯¼èˆªåˆ° ç½‘ç»œ â†’ DHCP/DNS è®¾ç½®é¡µé¢ åœ¨ åŸŸåé‡å†™ æˆ– è‡ªå®šä¹‰ DNS è§£æè®°å½• åŒºåŸŸæ·»åŠ ï¼š åŸŸåï¼š/registry.linkease.net/ IP åœ°å€ï¼š10.10.10.251 1 /registry.linkease.net/192.168.31.100 3. é…ç½®éªŒè¯ä¸æµ‹è¯• âœ… å®Œæˆé…ç½®åï¼Œåœ¨å±€åŸŸç½‘å®¢æˆ·ç«¯è®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ï¼š\nåŸºç¡€è¿é€šæ€§æµ‹è¯•ï¼š\n1 2 3 4 5 # éªŒè¯åŸŸåè§£æ ping registry.linkease.net # æµ‹è¯• HTTPS ç«¯å£ curl -I https://registry.linkease.net:5443 Docker é•œåƒæ‹‰å–æµ‹è¯•ï¼š\n1 docker pull hello-world ğŸŒ å››ã€Nginx åå‘ä»£ç†é…ç½® ç®¡ç†åå°åœ°å€ç¤ºä¾‹ï¼š https://kspeeder.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/kspeeder.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name kspeeder.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:5003; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ äº”ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªåŠ é€Ÿï¼Œæ•ˆç‡æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œæ‚¨å·²ç»æŒæ¡äº† KSpeeder çš„å®Œæ•´éƒ¨ç½²å’Œä½¿ç”¨æ–¹æ³•ï¼š\nğŸ–¥ï¸ æœåŠ¡ç«¯é…ç½®ï¼š éƒ¨ç½² KSpeeder å®¹å™¨æœåŠ¡ é…ç½®æœ¬åœ° Docker ä½¿ç”¨åŠ é€Ÿå™¨ é€šè¿‡ç®¡ç†ç•Œé¢ç›‘æ§æœåŠ¡çŠ¶æ€ ğŸŒ å±€åŸŸç½‘å…±äº«ï¼š ä¸ºå•ä¸ªè®¾å¤‡é…ç½®ç‹¬ç«‹åŠ é€Ÿï¼ˆä¿®æ”¹ hostsï¼‰ ä¸ºæ•´ä¸ªå±€åŸŸç½‘é…ç½®å…¨å±€åŠ é€Ÿï¼ˆè·¯ç”±å™¨ DNSï¼‰ éªŒè¯åŠ é€Ÿæ•ˆæœå’Œæ€§èƒ½æå‡ ğŸš€ æ ¸å¿ƒä¼˜åŠ¿ï¼š âš¡ æé€Ÿæ‹‰å– - äº«å—é£ä¸€èˆ¬çš„é•œåƒä¸‹è½½ä½“éªŒ\nğŸ’¾ æ™ºèƒ½ç¼“å­˜ - ä¸€æ¬¡æ‹‰å–ï¼Œå…¨ç½‘å…±äº«ï¼ŒèŠ‚çœ 70% å¸¦å®½\nğŸ”§ çµæ´»éƒ¨ç½² - æ”¯æŒå•æœºã€å±€åŸŸç½‘å’Œå¤šé›†ç¾¤ç¯å¢ƒ\nğŸ“Š å®æ—¶ç›‘æ§ - å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹ç¼“å­˜çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡\nåŠ é€Ÿä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ—¶é—´èµ›è·‘çš„æŠ€æœ¯ç«èµ›ã€‚æ„¿ KSpeeder æˆä¸ºæ‚¨çš„å¾—åŠ›åŠ©æ‰‹ï¼Œé™ªä¼´æ‚¨åœ¨æ¯ä¸€æ¬¡æ„å»ºå’Œéƒ¨ç½²çš„æŒ‘æˆ˜ä¸­ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæé€Ÿä¸‹è½½ï¼Œé«˜æ•ˆéƒ¨ç½²â€”â€”æ„å»ºæ‚¨æ— ç¼æµç•…çš„å¼€å‘ä½“éªŒå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ KSpeeder å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥æ‚¨åŠ é€Ÿæ„‰å¿«ï¼Œéƒ¨ç½²æœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T13:14:25+08:00","image":"https://file.meimolihan.eu.org/img/docker-kspeeder-01.webp","permalink":"https://blog.meimolihan.eu.org/p/db2df484/","title":"Docker éƒ¨ç½² KSpeeder é•œåƒåŠ é€Ÿå™¨ ğŸš€"},{"content":"Docker éƒ¨ç½² Uptime-Kuma ç›‘æ§é¢æ¿ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸš€ æ ¸å¿ƒåŠŸèƒ½é€Ÿè§ˆ ğŸ¯ 30 ç§’åœ¨çº¿ä½“éªŒ âš¡ ä¸€ã€ğŸ³ Docker éƒ¨ç½² Uptime-Kuma ğŸŒ äºŒã€å®¢æˆ·ç«¯ \u0026amp; åå‘ä»£ç† ğŸ¨ ä¸‰ã€CSS ä¸»é¢˜ \u0026amp; çŠ¶æ€é¡µç¾åŒ– ğŸŒŸ å¯èˆªç›‘æ§ï¼ŒæŒæ§æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Uptime-Kuma å®˜ç½‘åœ°å€ï¼š https://uptime.kuma.pet/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/louislam/uptime-kuma ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/louislam/uptime-kuma/tags Uptime-Kuma æ˜¯ä¸€æ¬¾å¼€æºã€å¯å®Œå…¨ç¦»çº¿è¿è¡Œçš„ æœåŠ¡/ç½‘ç«™/ç«¯å£/å¿ƒè·³ç›‘æ§ ç³»ç»Ÿï¼Œæ”¯æŒ å¤šç”¨æˆ·ã€å¤šé€šçŸ¥æ¸ é“ã€SSL è¯ä¹¦åˆ°æœŸæé†’ã€çŠ¶æ€é¡µè‡ªå®šä¹‰åŸŸåã€Prometheus æŒ‡æ ‡ ç­‰ã€‚æœ€å¸å¼•äººçš„æ˜¯å…¶ è‡ªå¸¦ Web UI + APIï¼Œä»¥åŠç¤¾åŒºè´¡çŒ®çš„å¤§é‡ CSS ä¸»é¢˜ï¼Œ10 åˆ†é’Ÿå³å¯æ­å‡ºâ€œé«˜é¢œå€¼â€çŠ¶æ€é¡µã€‚ğŸ˜\nğŸš€ æ ¸å¿ƒåŠŸèƒ½é€Ÿè§ˆ ç»´åº¦ äº®ç‚¹ ğŸ“Š ç›‘æ§ç±»å‹ HTTP(s)ã€TCPã€Pingã€DNSã€Docker å®¹å™¨ã€Pushã€Steam æ¸¸æˆæœåŠ¡å™¨â€¦ ğŸ”” é€šçŸ¥æ¸ é“ é‚®ä»¶ã€Telegramã€Discordã€Slackã€ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€ Barkã€WebHook ç­‰ 90+ ğŸŒ çŠ¶æ€é¡µ å¯ç»‘å®šç‹¬ç«‹åŸŸåã€è‡ªå®šä¹‰ Logo/CSS/JSã€åˆ†ç»„æ˜¾ç¤ºã€åªè¯»æ¨¡å¼ ğŸ“… æ•…éšœå†å² å®Œæ•´äº‹ä»¶æ—¶é—´çº¿ã€å¯å¯¼å‡º CSVã€RSS è®¢é˜… ğŸ” è¯ä¹¦ç›‘æ§ è‡ªåŠ¨æŠ“å–å¹¶æé†’ SSL åˆ°æœŸ ğŸ‘¨â€ğŸ’¼ æƒé™ä½“ç³» æ™®é€šç”¨æˆ· / ç®¡ç†å‘˜ / åªè¯»ä»¤ç‰Œ ğŸ“ˆ API \u0026amp; Prometheus /metrics åŸç”Ÿæ”¯æŒï¼Œå¯æ¥å…¥ Grafana ğŸ’¾ æ— æ•°æ®åº“ çº¯ SQLiteï¼Œå•æ–‡ä»¶è¿ç§»æ–¹ä¾¿ ğŸ¯ 30 ç§’åœ¨çº¿ä½“éªŒ å®˜æ–¹ Demoï¼š https://status.kuma.pet ï¼ˆè´¦å· demo / å¯†ç  demo123ï¼Œåªè¯»æƒé™ï¼‰ğŸ‘€\nâš¡ ä¸€ã€ğŸ³ Docker éƒ¨ç½² Uptime-Kuma 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/uptime-kuma \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: uptime-kuma: image: louislam/uptime-kuma:1 container_name: uptime-kuma volumes: - ./uptime-kuma:/app/data # æ•°æ®æŒä¹…åŒ– - /var/run/docker.sock:/var/run/docker.sock # ç›‘æ§ Docker å®¹å™¨ ports: - \u0026#34;3001:3001\u0026#34; restart: always EOF # 3. å¯åŠ¨ docker-compose up -d æµè§ˆå™¨è®¿é—® http://æœåŠ¡å™¨IP:3001 å³å¯åˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·ã€‚ğŸ‰\nğŸŒ äºŒã€å®¢æˆ·ç«¯ \u0026amp; åå‘ä»£ç† 1. Nginxï¼ˆHTTPSï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 mkdir -pm 755 /etc/nginx/conf.d \u0026amp;\u0026amp; \\ touch /etc/nginx/conf.d/uptime-kuma.conf \u0026amp;\u0026amp; \\ cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /etc/nginx/conf.d/uptime-kuma.conf ## nginx åå‘ä»£ç†: uptime-kuma ç›‘æ§ç«™ server { ## ç›‘å¬666ç«¯å£ï¼Œå¹¶å¯ç”¨SSL listen 666 ssl; listen [::]:666 ssl; ## æ›¿æ¢ä¸ºä½ çš„åŸŸå server_name uptime-kuma.example.com; ## æŒ‡å®š SSL è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶çš„è·¯å¾„ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ## è®¾ç½®æ”¯æŒçš„SSLâ€®è®®åâ€¬ç‰ˆæœ¬ ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # å¯ç”¨æœâ€®å™¨åŠ¡â€¬ç«¯åŠ å¯†å¥—ä»¶ä¼˜å…ˆ ssl_prefer_server_ciphers on; ## è®¾ç½®åŠ å¯†å¥—ä»¶ï¼Œä¼˜å…ˆç”¨â€®å¼ºé«˜â€¬åº¦åŠ å¯†ç®—æ³•ï¼Œå¹¶æ’â€®åŒ¿é™¤â€¬ååŠ â€®å¥—å¯†â€¬ä»¶å’ŒMD5æ•£åˆ—ç®—æ³• ssl_ciphers HIGH:!aNULL:!MD5; location / { ## æŒ‡å®šåå‘ä»£ç†çš„æœåŠ¡åœ°å€ proxy_pass http://localhost:3001; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; ## å¼€å¯ç¼“å­˜ proxy_buffering on; ## ä½¿ç”¨ HTTP/1.1 åè®®é€šä¿¡ proxy_http_version 1.1; } ## é”™è¯¯å¤„ç† charset utf-8; ## æ·»åŠ è¿™è¡Œæ¥æŒ‡å®šç¼–ç  error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /var/www/html; } } EOF sudo systemctl restart nginx 2. å…¶ä»–ä»£ç†æ–¹å¼ Cloudflare Tunnel / Traefik / NPM åŒç†ï¼Œåªéœ€åä»£ 3001 ç«¯å£å³å¯ã€‚ğŸ”§\nğŸ¨ äº”ã€CSS ä¸»é¢˜ \u0026amp; çŠ¶æ€é¡µç¾åŒ– Uptime-Kuma çš„ã€ŒçŠ¶æ€é¡µã€æ”¯æŒ å…¨å±€è‡ªå®šä¹‰ CSSã€‚åœ¨ Settings â†’ Appearance â†’ Custom CSS ç²˜è´´ä¸‹åˆ—ä»»æ„æ–¹æ¡ˆå³å¯ç«‹å³ç”Ÿæ•ˆã€‚âœ¨\nğŸ’¡ ä¸ºä¾¿äºç®¡ç†ï¼Œå»ºè®®æŠŠ CSS å­˜æ”¾åˆ° Gist æˆ–è‡ªå»º CDNï¼Œå† @import url(...) å¼•å…¥ã€‚\nç¾åŒ– CSS ä»£ç ï¼ˆ1ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 :root { --bs-white: #fff; --bs-dark: #212529; --bs-green: #008000; --bs-danger: #dc3545; --bs-body-bg: #f6f7f9; --bs-blue: #0d6efd; --bg-linear-gradient: linear-gradient(180deg, #f6f6f6, #f8f8f8); --border-solid-main: 2px solid var(--bs-white); --border-solid-small: 1px solid var(--bs-white); --shadow-box-main: 8px 8px 15px 0 rgba(55, 99, 170, 0.1), -8px -8px 15px 0 var(--bs-white), inset 0 4px 15px 0 rgba(255, 255, 255, 0.5); --shadow-box-small: 5px 5px 12px 0 rgba(55, 99, 170, 0.1), -5px -5px 12px 0 var(--bs-body-bg), inset 0 4px 10px 0 rgba(255, 255, 255, 0.5); --shadow-inset-box: inset -4px -4px 12px #f1f1f1, inset 4px 4px 12px #e2e2e2; } .dark { --bs-white: #2d2d2d; --bs-dark: #e9ecef; --bs-green: #00c800; --bs-danger: #dc3545; --bs-body-bg: #222222; --bg-linear-gradient: linear-gradient(180deg, #242424, #222222); --border-solid-main: 2px solid rgba(45, 45, 45, 0.8); --border-solid-small: 1px solid rgba(45, 45, 45, 0.6); --shadow-box-main: 8px 8px 15px 0 rgba(0, 0, 0, 0.3), -8px -8px 15px 0 #242424, inset 0 4px 15px 0 #222222; --shadow-box-small: 5px 5px 12px 0 rgba(0, 0, 0, 0.25), -5px -5px 12px 0 #242424, inset 0 4px 10px 0 #222222; --shadow-inset-box: inset -4px -4px 12px #0d0d0d, inset 4px 4px 12px #1a1a1a; } body { background-color: var(--bs-body-bg) !important; } /* LOGOæ ‡é¢˜æ ·å¼ */ .title-flex { font-weight: bold; justify-content: center; } /* æŒ‰é’® */ .btn-info { color: var(--bs-dark); background-image: var(--bg-linear-gradient); box-shadow: var(--shadow-box-small); border: var(--border-solid-main); } .btn-info:hover { color: var(--bs-dark); background-color: transparent; border-color: unset; box-shadow: var(--shadow-inset-box); } /* æœåŠ¡ç»„æ ‡é¢˜ */ .group-title { font-size: 2.5rem; font-weight: 700; opacity: .6; -webkit-mask: linear-gradient(var(--bs-white) 50%, transparent); mask: linear-gradient(var(--bs-white) 50%, transparent); text-stroke: 1px var(--bs-dark); -webkit-text-stroke: 1px var(--bs-dark); -webkit-text-fill-color: transparent; } /* æœåŠ¡é¡¹ç›®åˆ—è¡¨æ ·å¼ */ .monitor-list .monitor-list { min-height: 45px; display: grid; grid-template-columns: repeat(2, 1fr); } .monitor-list .item .info { display: flex; flex-wrap: wrap; align-items: center; } .info1::before, .info1::after { content: \u0026#34;\u0026#34;; display: inline-block; width: 10px; height: 10px; background-color: var(--bs-white); margin: 0.5rem 0; border-radius: 50%; animation: breath 1.5s ease-in-out infinite; } .info1::after { animation-delay: 0.75s; /* ä½¿ä¸¤ä¸ªåœ†ç‚¹å‘¼å¸äº¤æ›¿è¿›è¡Œ */ } .info .bg-danger+.item-name { color: var(--bs-red); } .shadow-box { margin-top: 0 !important; background-image: var(--bg-linear-gradient); border: var(--border-solid-main); box-shadow: var(--shadow-box-main); } div[data-v-f71ca08e].mb-5:hover .group-title { -webkit-text-fill-color: var(--bs-dark); } .monitor-list .item:hover { background-color: var(--bs-white); box-shadow: var(--shadow-inset-box); } .dark .monitor-list .item:hover { background-color: var(--bs-body-bg); } /* æœåŠ¡é¡¹ç›®åˆ—è¡¨æ ‡é¢˜æ ·å¼ */ .item-name { font-weight: bold; } a { text-decoration: none !important; } a.item-name:hover { color: var(--bs-blue) !important; } /* æœåŠ¡OKæ ·å¼ */ .overall-status .ok { color: var(--bs-green) !important; } .hp-bar-big .beat[data-v-636dc6a9] { background-color: var(--bs-green); } .item .row { justify-content: space-between; } /* çŠ¶æ€ç™¾åˆ†æ¯”æ”¹ä¸ºå‘¼å¸çŠ¶æ€ */ .info .badge.rounded-pill.bg-primary { --bg: var(--bs-green); } .info .badge.rounded-pill.bg-danger { --bg: var(--bs-danger); } .info .badge.rounded-pill { position: relative; display: flex; min-width: auto; width: 1rem; margin-left: 0.1rem; font-size: 0; justify-content: center; align-items: center; background-color: transparent !important; } .info .badge.rounded-pill::before { position: absolute; content: \u0026#34;\u0026#34;; width: 1rem; height: 1rem; border-radius: 50%; background-color: var(--bg); animation: breath 1.1s ease-in-out infinite; } .info .badge.rounded-pill::after { content: \u0026#34;\u0026#34;; width: 0.6rem; height: 0.6rem; border-radius: 50%; background-color: var(--bg); } @keyframes breath { 0%, 100% { transform: scale(1); opacity: 0.2; } 50% { transform: scale(1.2); opacity: 0; } } /* éšè—æ›´æ–°æ—¶é—´ */ .refresh-info.mb-2 { display: none; } /* å…¬å…±æ ·å¼ä¼˜åŒ– */ .col-md-4 { width: 50%; } .col-md-8 { max-width: 50%; display: flex; flex-wrap: wrap; flex-direction: column; } .mb-5 { margin-bottom: 2rem !important; } /* åº•éƒ¨æ ·å¼ */ footer[data-v-b8247e57] { margin: 1.5rem 0 !important; } footer p { margin: 0 !important; } /* é€‚é…æ‰‹æœº */ @media screen and (max-width: 768px) { .monitor-list .monitor-list { grid-template-columns: repeat(1, 1fr); } .group-title { font-size: 2rem; } } ç¾åŒ– CSS ä»£ç ï¼ˆ2ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 /* è‡ªå®šä¹‰å­—ä½“å®šä¹‰ */ @font-face { font-family: \u0026#39;1666963922\u0026#39;; src: url(\u0026#39;https://jsd.cdn.zzko.cn/gh/54ayao/ACG@main/static/fonts/1666963922.woff\u0026#39;) format(\u0026#39;woff\u0026#39;); font-weight: normal; font-style: normal; } /* å…¨å±€æ ·å¼ */ body { font-family: \u0026#39;1666963922\u0026#39;, sans-serif; /* ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ */ color: #333; margin: 0; padding: 0; background-image: url(\u0026#39;https://www.cuteapi.com/api/acg/images/api.php\u0026#39;); /* è‡ªé€‚åº”èƒŒæ™¯å›¾ç‰‡API */ background-attachment: fixed; background-size: cover; background-position: center center; background-repeat: no-repeat; } /* å¯¼èˆªæ é“¾æ¥æ‚¬åœæ ·å¼ */ .navbar a:hover { text-decoration: underline; } /* å¡ç‰‡æ ·å¼ */ .card { background-color: #fff; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 20px; padding: 20px; } /* å¡ç‰‡æ ‡é¢˜æ ·å¼ */ .card-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; } /* åœ¨æ˜äº®ä¸»é¢˜ä¸‹ï¼Œåº”ç”¨ä¸åŒçš„èƒŒæ™¯è‰²åŠ75%é€æ˜åº¦ */ .shadow-box { background-color: rgba(255, 255, 255, 0.75); padding: 10px; margin: 5px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); text-decoration: none; } /* åœ¨æš—è‰²ä¸»é¢˜ä¸‹ï¼Œåº”ç”¨ä¸åŒçš„èƒŒæ™¯è‰²åŠ65%é€æ˜åº¦ */ .dark .shadow-box:not(.alert) { background-color: rgba(0, 0, 0, 0.65); padding: 20px; margin: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); } /* ä¾§è¾¹æ æ ·å¼ */ .sidebar { background-color: rgba(255, 255, 255, 0.9); padding: 20px; margin: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); } /* ç‰¹å®šå…ƒç´ å’Œç±»çš„æ ·å¼ */ span[data-v-7d4a7f28], .item-name, div.description[data-v-7d4a7f28][data-v-b8247e57][contenteditable=\u0026#34;true\u0026#34;], div[data-v-7d4a7f28][data-v-b8247e57].alert-heading.p-2, .refresh-info \u0026gt; div, .alert-heading.p-2 \u0026gt; div, .alert-heading.p-2 \u0026gt; p, .alert-heading.p-2 \u0026gt; h1 { background-image: linear-gradient(90deg, #07c160, #fb6bea 25%, #3aedff 50%, #fb6bea 75%, #28d079); font-family: \u0026#39;1666963922\u0026#39;, sans-serif; -webkit-text-fill-color: transparent; -webkit-background-clip: text; background-size: 400% 100%; animation: wzw 10s linear infinite; } /* åŠ¨ç”»å…³é”®å¸§å®šä¹‰ */ @keyframes wzw { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } } #app { font-family: \u0026#39;1666963922\u0026#39;, BlinkMacSystemFont, \u0026#39;segoe ui\u0026#39;, Roboto, \u0026#39;helvetica neue\u0026#39;, Arial, \u0026#39;noto sans\u0026#39;, sans-serif, \u0026#39;apple color emoji\u0026#39;, \u0026#39;segoe ui emoji\u0026#39;, \u0026#39;segoe ui symbol\u0026#39;, \u0026#39;noto color emoji\u0026#39; !important; } ç¾åŒ– CSS ä»£ç ï¼ˆ3ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 /* @import url(\u0026#34;/css/defaults/placeholders.css\u0026#34;); */ @import url(\u0026#34;/css/defaults/transparent.css\u0026#34;); :root { /* ä½¿ç”¨æ‚¨æä¾›çš„é¢œè‰²å˜é‡ */ --main-bg-color: linear-gradient(45deg, #fb3f62 0%, #204c80 37%, #004249 97%) center center/cover no-repeat fixed; --modal-bg-color: linear-gradient(-45deg, #204c80 0%, #000 100%) center center/cover no-repeat fixed; --modal-header-color: linear-gradient(-45deg, #204c80 0%, #000 100%) center center/cover no-repeat fixed; --modal-footer-color: linear-gradient(-45deg, #204c80 0%, #000 100%) center center/cover no-repeat fixed; --drop-down-menu-bg: #204c80; --button-color: #fb3f62; --button-color-hover: #cd4164; --button-text: #eee; --button-text-hover: #FFF; --accent-color: 251, 63, 98; --accent-color-hover: rgba(var(--accent-color), .8); --link-color: rgb(0, 255, 157); --link-color-hover: rgba(0, 255, 157, 0.8); --label-text-color: #282a36; --text: #eee; --text-hover: #fff; --text-muted: #999; /* é€æ˜åº¦å˜é‡ */ --transparency-dark-15: rgba(251, 63, 98, 0.15); --transparency-dark-20: rgba(251, 63, 98, 0.2); --transparency-dark-25: rgba(251, 63, 98, 0.25); --transparency-dark-35: rgba(251, 63, 98, 0.35); --transparency-dark-45: rgba(251, 63, 98, 0.45); --transparency-light-10: rgba(255, 255, 255, 0.1); --transparency-light-15: rgba(255, 255, 255, 0.15); --transparency-light-25: rgba(255, 255, 255, 0.25); --transparency-light-45: rgba(255, 255, 255, 0.45); } *:not(#floatingInput)::-webkit-input-placeholder { color: var(--text-muted) !important; } *:not(#floatingInput):focus::-webkit-input-placeholder { color: var(--text-hover) !important; } /* Firefox \u0026lt; 19 */ *:not(#floatingInput):-moz-placeholder { color: var(--text-muted) !important; } *:not(#floatingInput):focus:-moz-placeholder { color: var(--text-hover) !important; } /* Firefox \u0026gt; 19 */ *:not(#floatingInput)::-moz-placeholder { color: var(--text-muted) !important; } *:not(#floatingInput):focus::-moz-placeholder { color: var(--text-hover) !important; } /* Internet Explorer 10 */ *:not(#floatingInput):-ms-input-placeholder { color: var(--text-muted) !important; } *:not(#floatingInput):focus:-ms-input-placeholder { color: var(--text-hover) !important; } body, .dark { margin: 0; font-family: var(--bs-body-font-family); font-size: var(--bs-body-font-size); font-weight: var(--bs-body-font-weight); line-height: var(--bs-body-line-height); color: var(--text); text-align: var(--bs-body-text-align); background: var(--main-bg-color); background-repeat: repeat, no-repeat; background-attachment: fixed, fixed; background-position: center center, center center; background-size: auto, cover; -webkit-background-size: auto, cover; -moz-background-size: auto, cover; -o-background-size: auto, cover; -webkit-text-size-adjust: 100%; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); } /* TEXT */ .text-secondary { color: var(--text-muted) !important; } .text-dark, .form-text { color: var(--text); } .stats p, .word, footer { color: var(--text) !important; } .title { color: rgb(var(--accent-color)) !important } h6, .h6, h5, .h5, h4, .h4, h3, .h3, h2, .h2, h1, .h1 { color: var(--text-hover) } a:hover:not(.btn), .nav-link:hover, .dark a:hover:not(.btn) { color: var(--link-color-hover); } a, .nav-link, .dark a, .dark .nav-link, .dark a:not(.btn), .dark .table, .dark .nav-link { color: var(--link-color); } .url a { color: var(--link-color) !important; text-decoration: underline; } mark, .mark { padding: 0 0.3em; background-color: rgb(var(--accent-color)); color: var(--label-text-color); } /* CARDS */ .shadow-box, .dark .shadow-box, .dark .shadow-box:not(.alert) { box-shadow: 0px 0px 20px 10px rgba(251, 63, 98, 0.2); background: var(--transparency-dark-25); } .dark .settings-content .settings-content-header { background: transparent !important; } .dark .list-header { background: transparent !important; } .settings-content .settings-content-header { border-bottom: 1px solid var(--transparency-light-10) !important; } .list .item:hover { background: var(--transparency-light-15) !important; } .list-header { border-bottom: 1px solid var(--transparency-light-15) !important; } .dark .list .item.active, .list .item.active { background: var(--transparency-dark-25) !important; } .dark .hp-bar-big .beat.empty, .hp-bar-big .beat.empty { background: var(--transparency-light-45) !important; } canvas { filter: invert(1) } /* TABLES */ th { color: var(--text-hover) } td { color: var(--text); } .dark .table-hover\u0026gt;tbody\u0026gt;tr:hover, .table-hover\u0026gt;tbody\u0026gt;tr:hover { --bs-table-accent-bg: var(--transparency-dark-20); color: var(--text); } .table { --bs-table-hover-bg: var(--transparency-dark-15) !important; --bs-table-hover-color: var(--text-hover) !important; } .dark .table-hover\u0026gt;tbody\u0026gt;tr:hover\u0026gt;* { --bs-table-accent-bg: var(--transparency-dark-15); color: var(--text-hover); } /* MENUS */ .dropdown-menu { color: var(--text) !important; background: var(--drop-down-menu-bg) !important; } .dropdown-item { color: var(--text) !important; } .dropdown-item:hover, .dropdown-item:focus { color: var(--text-hover) !important; background: var(--transparency-light-10) !important; } .dark .dropdown-clear-data ul { border-color: #0000 !important; color: var(--text) !important; background: var(--drop-down-menu-bg) !important; } .dropdown-item-text { color: var(--text); } .dropdown-profile-pic .dropdown-menu .dropdown-divider { border-top: 1px solid var(--transparency-light-25) !important; } .dark .dropdown-profile-pic.dropdown-menu.dropdown-item.active { color: var(--text-hover); background-color: var(--transparency-dark-15) !important; } /* HEADER */ .dark header, #app\u0026gt;div\u0026gt;header { background: var(--transparency-dark-15) !important; border-bottom-color: rgba(255, 255, 255, 0) !important; } /* BUTTONS */ .dark .btn-primary { color: var(--button-text); } .btn-primary, .btn-info { color: var(--button-text); background-color: var(--button-color); border-color: var(--button-color); } .btn-primary:hover, .btn-info:hover { color: var(--button-text-hover); backgroundColor: var(--button-color-hover); borderColor: var(--button-color-hover); } .btn-check:focus+.btn-primary, .btn-primary:focus { color: var(--button-text-hover); backgroundColor: var(--button-color-hover); borderColor: var(--button-color-hover); box-shadow: 0 0 0 .25rem rgba(var(--accent-color), .5) } .btn-check:checked+.btn-primary, .btn-check:active+.btn-primary, .btn-primary:active, .btn-primary.active, .show\u0026gt;.btn-primary.dropdown-toggle { color: var(--button-text-hover); backgroundColor: var(--button-color-hover); borderColor: var(--button-color-hover); } .btn-check:checked+.btn-primary:focus, .btn-check:active+.btn-primary:focus, .btn-primary:active:focus, .btn-primary.active:focus, .show\u0026gt;.btn-primary.dropdown-toggle:focus { box-shadow: 0 0 0 .25rem rgba(var(--accent-color), .5) } .btn-primary:disabled, .btn-primary.disabled { color: var(--button-text); backgroundColor: var(--button-color); borderColor: var(--button-color); } .btn-outline-primary, .btn-outline-secondary { color: var(--button-color); borderColor: var(--button-color); } .btn-outline-primary:hover, .btn-outline-secondary:hover { color: var(--button-text-hover) !important; backgroundColor: var(--button-color-hover); borderColor: var(--button-color-hover); } .btn-check:focus+.btn-outline-primary, .btn-outline-primary:focus { box-shadow: 0 0 0 .25rem rgba(var(--accent-color), .5); } .btn-check:checked+.btn-outline-primary, .btn-check:active+.btn-outline-primary, .btn-outline-primary:active, .btn-outline-primary.active, .btn-outline-primary.dropdown-toggle.show { color: var(--button-text-hover) !important; backgroundColor: var(--button-color-hover); borderColor: var(--button-color-hover); } .btn-check:checked+.btn-outline-primary:focus, .btn-check:active+.btn-outline-primary:focus, .btn-outline-primary:active:focus, .btn-outline-primary.active:focus, .btn-outline-primary.dropdown-toggle.show:focus { box-shadow: 0 0 0 .25rem rgba(var(--accent-color), .5); } .btn-outline-primary:disabled, .btn-outline-primary.disabled { color: var(--button-color); backgroundColor: transparent } .nav-pills .nav-link.active, .nav-pills .show\u0026gt;.nav-link { color: var(--button-text) !important; backgroundColor: var(--button-color); } .dark #importBackup::file-selector-button, #importBackup::file-selector-button { color: var(--button-text) !important; backgroundColor: var(--button-color) !important; } .dark #importBackup[data-v-d684482e]:hover:not(:disabled):not([readonly])::file-selector-button, #importBackup[data-v-d684482e]:hover:not(:disabled):not([readonly])::file-selector-button { color: var(--button-text-hover) !important; backgroundColor: var(--button-color-hover) !important; } /* FORMS */ .dark .form-control, .dark .form-select, .form-select, .form-control { color: var(--text); background: var(--transparency-dark-25); background-repeat: no-repeat; } .dark .form-select:focus, .form-select:focus { color: var(--text-color); background: var(--drop-down-menu-bg); box-shadow: 0 0 0 0.25rem rgba(var(--accent-color), 0.25); borderColor: rgba(var(--accent-color), 0.25); } .dark .form-control:focus, .form-control:focus { color: var(--text-color); background: var(--transparency-dark-35); box-shadow: 0 0 0 0.25rem rgba(var(--accent-color), 0.25); borderColor: rgba(var(--accent-color), 0.25); } .dark .form-control, .dark .form-select, .form-select, .form-control { borderColor: #0000; } .input-group-text { color: var(--button-text); backgroundColor: var(--button-color); border: 1px solid var(--button-color); } .form-check-input:checked { backgroundColor: var(--button-color); borderColor: var(--button-color); } .form-check-input[type=checkbox]:indeterminate { backgroundColor: var(--button-color); borderColor: var(--button-color); } .dark .multiselect__content-wrapper, .multiselect__content-wrapper { background: var(--drop-down-menu-bg) !important; borderColor: var(--transparency-light-15) !important; } .multiselect { color: var(--text); } .multiselect__option--highlight { background: rgb(var(--accent-color)) !important; outline: none; color: var(--label-text-color) !important; } .multiselect__option--highlight:after { content: attr(data-select); background: rgb(var(--accent-color)) !important; color: var(--label-text-color); } .multiselect__option--selected:after { content: attr(data-selected); color: var(--label-text-color) !important; } .multiselect__option--selected, .dark .multiselect__option--selected { background: var(--transparency-dark-45); color: var(--text-hover) !important; } .dark .multiselect__option--selected::after, .multiselect__option--selected::after { color: var(--text-hover) !important; } .multiselect__tag, .dark .multiselect__tag { background: var(--button-color) !important; color: var(--button-text) !important; } .dark .multiselect__tags, .multiselect__tags { color: var(--text); background: var(--transparency-dark-25); borderColor: transparent; } .dark .multiselect__input, .dark .multiselect__single, .multiselect__input, .multiselect__single { background: var(--transparency-dark-25) !important; color: var(--text-hover) !important; } /* MODAL */ .dark .modal-header, .modal-header { borderColor: rgb(var(--accent-color)); border-radius: 1rem 1rem 0 0; background: var(--modal-header-color); background-repeat: repeat, no-repeat; background-attachment: fixed, fixed; background-position: center center, center center; background-size: auto, cover; -webkit-background-size: auto, cover; -moz-background-size: auto, cover; -o-background-size: auto, cover; } .dark .modal-footer, .modal-footer { borderColor: rgb(var(--accent-color)); background: var(--modal-footer-color); border-radius: 0 0 1rem 1rem; background-repeat: repeat, no-repeat; background-attachment: fixed, fixed; background-position: center center, center center; background-size: auto, cover; -webkit-background-size: auto, cover; -moz-background-size: auto, cover; -o-background-size: auto, cover; } .dark .modal-content, .modal-content { box-shadow: 0 15px 70px #000; background: var(--modal-bg-color); background-repeat: repeat, no-repeat; background-attachment: fixed, fixed; background-position: center center, center center; background-size: auto, cover; -webkit-background-size: auto, cover; -moz-background-size: auto, cover; -o-background-size: auto, cover; } .vue-image-crop-upload .vicp-wrap { -webkit-box-shadow: 0 1px 3px 0 rgb(0 0 0 / 23%); box-shadow: 0 1px 3px rgb(0 0 0 / 23%); background-color: var(--modal-bg-color); background-repeat: repeat, no-repeat; background-attachment: fixed, fixed; background-position: center center, center center; background-size: auto, cover; -webkit-background-size: auto, cover; -moz-background-size: auto, cover; -o-background-size: auto, cover; } /* SETTINGS */ .settings-menu .active .menu-item { background: var(--transparency-dark-15) !important; } .settings-menu .menu-item:hover { background: var(--transparency-light-10) !important; } h5.settings-subheading:after, .settings-subheading.h5:after { border-bottom: 1px solid var(--transparency-light-10); } .dark .cert-exp-days .cert-exp-day-row, .cert-exp-days .cert-exp-day-row { border-bottom: 1px solid var(--transparency-light-10) !important; } [contenteditable=true] { backgroundColor: var(--transparency-dark-25); } [contenteditable=true]:hover { backgroundColor: var(--transparency-dark-35); } [dir=ltr] .sidebar .sidebar-footer { border-right: 1px solid var(--transparency-light-10) !important; left: 0; } .sidebar .sidebar-footer { border-top: 1px solid var(--transparency-light-10) !important; backgroundColor: var(--transparency-light-10) !important; } .item:hover { backgroundColor: rgb(var(--accent-color), .10) !important; } @media (max-width: 550px) { .dark .table-shadow-box tbody .shadow-box { backgroundColor: transparent !important; } .dark .table-hover\u0026gt;tbody\u0026gt;tr:hover\u0026gt;* { --bs-table-accent-bg: transparent color: var(--text-hover); } .dark .table-shadow-box tbody .shadow-box td { border-bottom: 1px solid var(--transparency-light-10); } } .dark .monitor-list .item:hover, .dark .monitor-list .item.active, .monitor-list .item.active, .monitor-list .item:hover { backgroundColor: rgb(var(--accent-color), .10); } .active.dropdown-item.active, .dark .dropdown-profile-pic .dropdown-menu .dropdown-item.active, #app\u0026gt;div\u0026gt;header\u0026gt;ul\u0026gt;li\u0026gt;div\u0026gt;ul\u0026gt;li\u0026gt;a.active { background: var(--transparency-dark-25) !important; backgroundColor: var(--transparency-dark-25) !important; } /* CUSTOM EFFECTS */ .hp-bar-big .beat.full { background: #fb3f62 !important; box-shadow: 0 0 10px #fb3f62; } .dark .hp-bar .beat.full, .hp-bar .beat.full { background: #fb3f62 !important; } /* é—ªå…‰æ•ˆæœçš„çŠ¶æ€æŒ‡ç¤ºå™¨ */ .badge-status-up { backgroundColor: #fb3f62 !important; box-shadow: 0 0 8px #fb3f62; } /* ç›‘æ§è®¡æ•°å™¨çš„æ ·å¼ */ .badge-count { backgroundColor: #fb3f62 !important; border: 1px solid #204c80; } /* æ·»åŠ çš„ç‰¹æ®Šæ•ˆæœï¼Œå¼ºè°ƒé’è‰²é“¾æ¥ */ a:hover { text-shadow: 0 0 5px rgba(0, 255, 157, 0.5); } /* æŒ‰é’®è¿‡æ¸¡æ•ˆæœ */ .btn-primary, .btn-info, .btn-outline-primary, .btn-outline-secondary { transition: all 0.3s ease; } ç¾åŒ– CSS ä»£ç ï¼ˆ4ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 :root { --bs-white: #fff; --bs-dark: #212529; --bs-green: #008000; --bs-danger: #dc3545; --bs-body-bg: #f6f7f9; --bs-blue: #0d6efd; --bg-linear-gradient: linear-gradient(180deg, #f6f6f6, #f8f8f8); --border-solid-main: 2px solid var(--bs-white); --border-solid-small: 1px solid var(--bs-white); --shadow-box-main: 8px 8px 15px 0 rgba(55, 99, 170, 0.1), -8px -8px 15px 0 var(--bs-white), inset 0 4px 15px 0 rgba(255, 255, 255, 0.5); --shadow-box-small: 5px 5px 12px 0 rgba(55, 99, 170, 0.1), -5px -5px 12px 0 var(--bs-body-bg), inset 0 4px 10px 0 rgba(255, 255, 255, 0.5); --shadow-inset-box: inset -4px -4px 12px #f1f1f1, inset 4px 4px 12px #e2e2e2; } .dark { --bs-white: #2d2d2d; --bs-dark: #e9ecef; --bs-green: #00c800; --bs-danger: #dc3545; --bs-body-bg: #222222; --bg-linear-gradient: linear-gradient(180deg, #242424, #222222); --border-solid-main: 2px solid rgba(45, 45, 45, 0.8); --border-solid-small: 1px solid rgba(45, 45, 45, 0.6); --shadow-box-main: 8px 8px 15px 0 rgba(0, 0, 0, 0.3), -8px -8px 15px 0 #242424, inset 0 4px 15px 0 #222222; --shadow-box-small: 5px 5px 12px 0 rgba(0, 0, 0, 0.25), -5px -5px 12px 0 #242424, inset 0 4px 10px 0 #222222; --shadow-inset-box: inset -4px -4px 12px #0d0d0d, inset 4px 4px 12px #1a1a1a; } body { background-color: var(--bs-body-bg) !important; } /* LOGOæ ‡é¢˜æ ·å¼ */ .title-flex { font-weight: bold; justify-content: center; } /* æŒ‰é’® */ .btn-info { color: var(--bs-dark); background-image: var(--bg-linear-gradient); box-shadow: var(--shadow-box-small); border: var(--border-solid-main); } .btn-info:hover { color: var(--bs-dark); background-color: transparent; border-color: unset; box-shadow: var(--shadow-inset-box); } /* æœåŠ¡é¡¹ç›®åˆ—è¡¨æ ·å¼ */ .monitor-list .monitor-list { min-height: 45px; display: grid; grid-template-columns: repeat(2, 1fr); } .monitor-list .item .info { display: flex; flex-wrap: wrap; align-items: center; } .info1::before, .info1::after { content: \u0026#34;\u0026#34;; display: inline-block; width: 10px; height: 10px; background-color: var(--bs-white); margin: 0.5rem 0; border-radius: 50%; animation: breath 1.5s ease-in-out infinite; } .info1::after { animation-delay: 0.75s; /* ä½¿ä¸¤ä¸ªåœ†ç‚¹å‘¼å¸äº¤æ›¿è¿›è¡Œ */ } .info .bg-danger+.item-name { color: var(--bs-red); } .shadow-box { margin-top: 0 !important; background-image: var(--bg-linear-gradient); border: var(--border-solid-main); box-shadow: var(--shadow-box-main); } div[data-v-f71ca08e].mb-5:hover .group-title { -webkit-text-fill-color: var(--bs-dark); } .monitor-list .item:hover { background-color: var(--bs-white); box-shadow: var(--shadow-inset-box); } .dark .monitor-list .item:hover { background-color: var(--bs-body-bg); } /* æœåŠ¡é¡¹ç›®åˆ—è¡¨æ ‡é¢˜æ ·å¼ */ .item-name { display: flex; justify-content: center; align-items: center; width: 120px; height: 32px; padding: 0 10px; background-color: #90EE90; border-radius: 6px; transition: all 0.3s ease; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; line-height: 2; /* é‡ç½®è¡Œé«˜ */ font-size: 16px; transform: translateY(0px); color: #000000 !important; /* ç§»é™¤!importantï¼Œé™ä½ä¼˜å…ˆçº§ */ } /* æ™®é€šå…ƒç´ æ‚¬åœæ•ˆæœ */ .item-name:hover { background-color: #165DFF; color: #FFFFFF !important; /* æ‚¬åœæ—¶æ”¹ä¸ºç™½è‰²ï¼Œå¹¶ä½¿ç”¨!importantç¡®ä¿ä¼˜å…ˆçº§ */ cursor: pointer; transform: scale(0.98); box-shadow: 0 2px 4px rgba(0,0,0,0.1); } /* é“¾æ¥å…ƒç´ æ‚¬åœæ•ˆæœ */ a.item-name:hover { color: var(--bs-blue) !important; /* ä¿æŒé“¾æ¥çš„ç‰¹æ®Šé¢œè‰² */ } /* æ·±è‰²æ¨¡å¼ä¸‹çš„æ‚¬åœæ•ˆæœ */ .dark .item-name:hover { color: #FFFFFF !important; /* ç¡®ä¿æ·±è‰²æ¨¡å¼ä¸‹æ‚¬åœé¢œè‰²æ­£ç¡® */ } a { text-decoration: none !important; } /* æœåŠ¡OKæ ·å¼ */ .overall-status .ok { color: var(--bs-green) !important; } .hp-bar-big .beat[data-v-636dc6a9] { background-color: var(--bs-green); } .item .row { justify-content: space-between; } /* çŠ¶æ€ç™¾åˆ†æ¯”æ”¹ä¸ºå‘¼å¸çŠ¶æ€ */ .info .badge.rounded-pill.bg-primary { --bg: var(--bs-green); } .info .badge.rounded-pill.bg-danger { --bg: var(--bs-danger); } .info .badge.rounded-pill { position: relative; display: flex; min-width: auto; width: 1rem; margin-left: 0.1rem; font-size: 0; justify-content: center; align-items: center; background-color: transparent !important; } .info .badge.rounded-pill::before { position: absolute; content: \u0026#34;\u0026#34;; width: 1rem; height: 1rem; border-radius: 50%; background-color: var(--bg); animation: breath 1.1s ease-in-out infinite; } .info .badge.rounded-pill::after { content: \u0026#34;\u0026#34;; width: 0.6rem; height: 0.6rem; border-radius: 50%; background-color: var(--bg); } @keyframes breath { 0%, 100% { transform: scale(1); opacity: 0.2; } 50% { transform: scale(1.2); opacity: 0; } } /* éšè—æ›´æ–°æ—¶é—´ */ .refresh-info.mb-2 { display: none; } /* å…¬å…±æ ·å¼ä¼˜åŒ– */ .col-md-4 { width: 50%; } .col-md-8 { max-width: 50%; display: flex; flex-wrap: wrap; flex-direction: column; } .mb-5 { margin-bottom: 2rem !important; } /* åº•éƒ¨æ ·å¼ */ footer[data-v-b8247e57] { margin: 1.5rem 0 !important; } footer p { margin: 0 !important; } /* é€‚é…æ‰‹æœº */ @media screen and (max-width: 768px) { .monitor-list .monitor-list { grid-template-columns: repeat(1, 1fr); } .group-title { font-size: 2rem; } } .badge.rounded-pill.bg-danger, .badge.rounded-pill.bg-primary { transform: translateY(0px); } .group-title { color: white; font-family: \u0026#39;Press Start 2P\u0026#39;, cursive; background-image: url(https://your.domain.here/titlebackground-CcY6CrQOcaTk.png); border-radius: 20px; } .shadow-box.list.p-4.overall-status.mb-4 { background-image: url(https://your.domain.here/categorybackground-tanluRsQltcW.png); text-align: center; color: white; } .group-title { color: #f0f0f0; background-color: #33334d; border-radius: 20px; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2); text-transform: uppercase; letter-spacing: 1px; border: 1px solid #47476b; transition: all 0.3s ease; padding: 10px 20px; margin: 10px 0; } .group-title:hover { background-color: #47476b; color: #ffffff; box-shadow: 6px 6px 15px rgba(0, 0, 0, 0.3); } ç¾åŒ– CSS ä»£ç ï¼ˆ5ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 /* ============================== 1. åŸºç¡€å…ƒç´ æ ·å¼ ============================== */ /* é¡¹ç›®åç§°æ ·å¼ */ .item-name[data-v-f71ca08e] { font-weight: 700; padding-left: 10px; padding-right: 6px; margin: 2px; } /* é“¾æ¥æ ·å¼åŠåŠ¨ç”»æ•ˆæœ */ a { text-decoration: none; position: relative; padding-left: 12px; z-index: 1; display: inline-block; transition: all cubic-bezier(0.4, 0, 0.2, 1) 0.3s; } a::before { content: \u0026#39;\u0026#39;; position: absolute; left: 0; top: 46%; transform: translateY(-50%); width: 5px; height: 25px; margin: 2px; background-color: #55ba63; transition: all cubic-bezier(0.4, 0, 0.2, 1) 0.3s; border-radius: 3px; z-index: -1; } /* Hoveræ•ˆæœ */ /* ç™½å¤©æ¨¡å¼ */ a:hover, .p-2:hover { color: #fff !important; } /* å¤œé—´æ¨¡å¼ */ .dark a:hover, .dark .p-2:hover { color: #000 !important; } /* å†…è¾¹è·æ ·å¼ */ .p-2 { padding-left: 0px; padding-right: 10px; font-weight: 700; margin: 6px; } /* é“¾æ¥æ‚¬åœåŠ¨ç”» */ a:hover::before { width: 100%; left: 0; border-radius: 6px; } /* ============================== 2. å¸ƒå±€ç³»ç»Ÿå˜é‡ ============================== */ :root { --bs-primary-rgb: 67, 179, 82; --min-item-width: 28ch; /* ç½‘æ ¼é¡¹ç›®æœ€å°å®½åº¦ */ --max-item-width: 0.5fr; /* ç½‘æ ¼é¡¹ç›®æœ€å¤§å®½åº¦ */ --grid-spacing: 0.25rem; /* ç½‘æ ¼é—´è· */ --item-padding: 0.2rem; /* é¡¹ç›®å†…è¾¹è· */ } /* ============================== 3. å“åº”å¼è®¾è®¡ ============================== */ /* ç§»åŠ¨ç«¯é€‚é… (600pxä»¥ä¸‹) */ @media (max-width: 600px) { :root { --max-item-width: 1fr; /* ç§»åŠ¨ç«¯å…¨å®½æ˜¾ç¤º */ } } /* å¤§å±å¹•é€‚é… (2560pxä»¥ä¸Š) */ @media (min-width: 2560px) { :root { --max-item-width: 300px; /* å¤§å±å¹•é™åˆ¶æœ€å¤§å®½åº¦ */ } } /* 4Kå±å¹•ä¼˜åŒ– (3840pxä»¥ä¸Š) */ @media (min-width: 3840px) { .item-name { font-size: 1.3em; font-weight: 700; letter-spacing: 0.8px; } .badge , .tag-text[data-v-24636654] { font-size: 0.9em; } .wrap \u0026gt; .d-flex { font-size: 0.9em; font-weight: 500; letter-spacing: 0.8px; } } /* ============================== 4. å¸ƒå±€ç»„ä»¶ ============================== */ /* å®¹å™¨è®¾ç½® */ .container { max-width: 98%; } /* ç›‘æ§åˆ—è¡¨ç½‘æ ¼å¸ƒå±€ */ .monitor-list \u0026gt; .monitor-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(var(--min-item-width), var(--max-item-width))); grid-gap: var(--grid-spacing); } /* ============================== 5. å¡ç‰‡ç»„ä»¶ ============================== */ /* å¡ç‰‡åŸºç¡€æ ·å¼ */ .item { position: relative; width: 100%; padding: var(--item-padding) !important; border: #ccc solid 1px; } .item \u0026gt; .row { flex-direction: column; } .row \u0026gt; div { width: 100%; } /* çŠ¶æ€æ¡æ ·å¼ */ .hp-bar-big .beat[data-v-636dc6a9] { background-color: #55ba63; } /* ============================== 6. å¾½ç« ç»„ä»¶ ============================== */ /* æ¡Œé¢ç«¯å¾½ç« å®šä½ */ body:not(.mobile) .badge{ position: absolute; top: var(--item-padding); right: var(--item-padding); transform: none; } /* ç§»åŠ¨ç«¯å¾½ç« å®šä½ */ body.mobile .badge { position: absolute; top: var(--item-padding); right: var(--item-padding); } /* ============================== 7. æ ‡é¢˜ä¸æŒ‰é’® ============================== */ /* åˆ†ç»„æ ‡é¢˜æ ·å¼ */ .group-title span[data-v-f71ca08e] { display: inline-block; min-width: 70px; margin: 0 auto; text-align: center; } /* æ ‡é¢˜å’Œä¿¡æ¯æŒ‰é’®æ ·å¼ */ h2, .h2, .btn-info { margin-bottom: 0rem; font-weight: 600; color: white; border: 1px solid #ccc; --bs-bg-opacity: 1; background-color: rgba(var(--bs-primary-rgb), var(--bs-bg-opacity)); border-radius: 9px; padding: 6px 10px; display: inline-block; text-align: center; min-width: 8%; } /* ============================== 8. ä¸»é¢˜è®¾ç½® ============================== */ /* æ·±è‰²ä¸»é¢˜æ ·å¼è¦†ç›– */ .dark h2, .dark .h2, .dark .btn-info, .dark .refresh-info[data-v-b8247e57] { color: #000000; } /* çŠ¶æ€æŒ‡ç¤ºå™¨ */ .overall-status { border: 1px solid #ccc; border-radius: 9px; position: absolute; top: 10px; right: 10px; padding: 0.5rem !important; } .overall-status[data-v-b8247e57] { font-weight: 700; font-size: 18px; } .bg-maintenance { background-color: #4962bd !important; } /* åˆ·æ–°ç»„ä»¶æ ·å¼ */ .refresh-info[data-v-b8247e57] { font-family: math; opacity: 0.9; color: #ffffff; border: 1px solid #ccc; --bs-bg-opacity: 1; background-color: rgba(var(--bs-primary-rgb), var(--bs-bg-opacity)); border-radius: 9px; padding: 6px 6px; display: inline-block; text-align: center; min-width: 4%; } /* UIå…ƒç´ æ ·å¼ */ .rounded-pill { border-radius: 0.5rem !important; } .shadow-box { box-shadow: 0 15px 70px rgba(0, 0, 0, 0); padding: 0px; border-radius: 10px; } /* é—´è·è°ƒæ•´ */ .p-2 { padding: 0rem !important; } .mb-4, .mb-5 { margin-bottom: 0.5rem !important; } .mt-4 { margin-top: 0.5rem !important; } .mt-5 { margin-top: 0 !important; } /* å·¥å…·æ ·å¼ */ ::-webkit-scrollbar { display: none; } ğŸŒŸ å¯èˆªç›‘æ§ï¼ŒæŒæ§æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Uptime-Kuma ç›‘æ§ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ‘ï¸ ä¸€ç›®äº†ç„¶ å®æ—¶æŒæ¡æ‰€æœ‰æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°å¹¶è§£å†³é—®é¢˜\nğŸ¨ ä¸ªæ€§å®šåˆ¶ æ‰“é€ é«˜é¢œå€¼çŠ¶æ€é¡µé¢ï¼Œå±•ç°ä¸“ä¸šç›‘æ§ä»ªè¡¨æ¿\nğŸ“Š æ•°æ®é©±åŠ¨ åŸºäºè¯¦å®çš„ç›‘æ§æ•°æ®ï¼Œåšå‡ºæ˜æ™ºçš„è¿ç»´å†³ç­–\nç›‘æ§ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç¨³å®šæ€§å…±èˆçš„æŠ€æœ¯è‰ºæœ¯ã€‚æ„¿ Uptime-Kuma æˆä¸ºä½ å¯é çš„å®ˆæœ›è€…ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æœåŠ¡ä¿éšœå’Œæ€§èƒ½ä¼˜åŒ–çš„æŒ‘æˆ˜ä¸­ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå…¨é¢ç›‘æ§ï¼Œæ™ºèƒ½é¢„è­¦â€”â€”æ„å»ºä½ åšå¦‚ç£çŸ³çš„ç³»ç»Ÿæ¶æ„å§ï¼ğŸ›¡ï¸\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Uptime-Kuma å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ç›‘æ§é¡ºåˆ©ï¼Œç³»ç»Ÿç¨³å®šï¼ğŸ‰\n","date":"2025-08-25T13:10:20+08:00","image":"https://file.meimolihan.eu.org/img/docker-uptime-kuma-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f2c6279d/","title":"Docker éƒ¨ç½² Uptime-Kuma ç›‘æ§é¢æ¿ ğŸ³"},{"content":"Docker éƒ¨ç½² iStoreOS è½¯è·¯ç”±ç³»ç»Ÿ ğŸš€ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² iStoreOS 1. å‰æœŸå‡†å¤‡ä¸ç½‘ç»œé…ç½® âš™ï¸ 2. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ iStoreOS 1. é…ç½®ç½‘ç»œä¸è®¿é—® Web ç•Œé¢ ğŸŒ 2. è½¯ä»¶ä¸­å¿ƒä¸åŠŸèƒ½åº”ç”¨ ğŸ› ï¸ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç½‘ç»œï¼Œè¿æ¥æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ iStoreOS å®˜ç½‘åœ°å€ï¼š https://site.istoreos.com/ ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/fingerboy/istoreos-x86-64 ** iStoreOS æ˜¯ä¸€æ¬¾åŸºäº OpenWRT å¼€å‘çš„æ™ºèƒ½è·¯ç”±æ“ä½œç³»ç»Ÿï¼Œä¸“ä¸ºå®¶åº­å’Œå°å‹ä¼ä¸šç½‘ç»œç¯å¢ƒè®¾è®¡ã€‚å®ƒæä¾›äº†ç›´è§‚çš„Webç®¡ç†ç•Œé¢å’Œä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼Œæ”¯æŒå„ç§ç½‘ç»œæœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚é€šè¿‡ Docker éƒ¨ç½² iStoreOSï¼Œæ‚¨å¯ä»¥åœ¨ä¸è´­ä¹°é¢å¤–ç¡¬ä»¶è®¾å¤‡çš„æƒ…å†µä¸‹ä½“éªŒè½¯è·¯ç”±åŠŸèƒ½ï¼Œå®ç°ç½‘ç»œæµé‡ç®¡ç†ã€VPNæœåŠ¡ã€å®¶é•¿æ§åˆ¶ç­‰åŠŸèƒ½ã€‚ğŸ â¡ï¸ğŸŒ\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ›¡ï¸ ç³»ç»ŸåŸºç¡€ åŸºäºæˆç†Ÿçš„ OpenWRT ç³»ç»Ÿ ç¨³å®šæ€§é«˜ï¼Œå…¼å®¹æ€§å¥½ ğŸ–¥ï¸ ç®¡ç†ç•Œé¢ ç›´è§‚çš„ Web ç®¡ç†ç•Œé¢ æ“ä½œç®€ä¾¿ï¼Œç”¨æˆ·ä½“éªŒä½³ ğŸ“¦ è½¯ä»¶ä¸­å¿ƒ ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿ ä¸€é”®å®‰è£…å„ç§ç½‘ç»œæœåŠ¡ ğŸŒ ç½‘ç»œåè®® æ”¯æŒå¤šç§ç½‘ç»œåè®®å’ŒæœåŠ¡ VPNã€DNSã€DHCP ç­‰å…¨é¢æ”¯æŒ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker å®¹å™¨åŒ–è¿è¡Œ æ— éœ€ä¸“ç”¨ç¡¬ä»¶è®¾å¤‡ ğŸ”§ é«˜åº¦å¯å®šåˆ¶ çµæ´»çš„ç½‘ç»œé…ç½® æ»¡è¶³ä¸åŒç½‘ç»œéœ€æ±‚ ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ å“åº”å¼è®¾è®¡ éšæ—¶éšåœ°ç®¡ç†ç½‘ç»œ ğŸ³ ä¸€ã€Docker éƒ¨ç½² iStoreOS 1. å‰æœŸå‡†å¤‡ä¸ç½‘ç»œé…ç½® âš™ï¸ 1 2 3 4 5 6 7 8 9 10 11 12 # æå‡æƒé™ sudo -i # æŸ¥çœ‹ç½‘ç»œä¿¡æ¯ ifconfig # åˆ›å»º macvlan ç½‘ç»œï¼ˆè¯·æ ¹æ®å®é™…ç½‘ç»œç¯å¢ƒè°ƒæ•´å‚æ•°ï¼‰ docker network create -d macvlan \\ --subnet=10.10.10.0/24 \\ --gateway=10.10.10.253 \\ -o parent=ens18 \\ macnet 2. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -p /mnt/mydisk/home/istoreos \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: istoreos: image: fingerboy/istoreos-x86-64:latest container_name: istoreos privileged: true command: /sbin/init restart: always networks: macnet: ipv4_address: 10.10.10.223 volumes: - ./config:/etc/config # é…ç½®æŒä¹…åŒ– - ./storage:/www/storage # å­˜å‚¨æŒä¹…åŒ– networks: macnet: external: true EOF 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ iStoreOS 1. é…ç½®ç½‘ç»œä¸è®¿é—® Web ç•Œé¢ ğŸŒ 1 2 3 4 5 6 7 8 # è¿›å…¥å®¹å™¨é…ç½®ç½‘ç»œ docker exec -it istoreos /bin/bash # ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶ï¼ˆæ ¹æ®å®é™…ç½‘ç»œç¯å¢ƒè°ƒæ•´ï¼‰ vi /etc/config/network # é‡å¯ç½‘ç»œæœåŠ¡ /etc/init.d/network restart åå°åœ°å€: http://10.10.10.223 ç”¨æˆ·å: root å¯†ç : passwordï¼ˆé¦–æ¬¡ç™»å½•åè¯·ç«‹å³æ›´æ”¹ï¼‰ 2. è½¯ä»¶ä¸­å¿ƒä¸åŠŸèƒ½åº”ç”¨ ğŸ› ï¸ iStoreOS æä¾›ä¸°å¯Œçš„åŠŸèƒ½æ¨¡å—ï¼š\nğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤: é˜²ç«å¢™é…ç½®ã€è®¿é—®æ§åˆ¶ ğŸŒ VPN æœåŠ¡: OpenVPNã€WireGuardã€IPSec ğŸ“Š æµé‡ç›‘æ§: å®æ—¶æµé‡æŸ¥çœ‹ã€å¸¦å®½ç®¡ç† ğŸ”’ å®¶é•¿æ§åˆ¶: ä¸Šç½‘æ—¶é—´ç®¡ç†ã€å†…å®¹è¿‡æ»¤ ğŸ“¡ ç½‘ç»œä¼˜åŒ–: QoSã€è´Ÿè½½å‡è¡¡ã€å¤šçº¿æ¥å…¥ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® ç®¡ç†åå°åœ°å€ç¤ºä¾‹ï¼š https://istoreos.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/istoreos.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name istoreos.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://10.10.10.223:80; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/istoreos # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop istoreos # åœæ­¢å®¹å™¨ docker start istoreos # å¯åŠ¨å®¹å™¨ docker restart istoreos # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm istoreos # åˆ é™¤å·²åœæ­¢å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it istoreos sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it istoreos bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect istoreos # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats istoreos # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs istoreos # æŸ¥çœ‹æ—¥å¿— docker logs -f istoreos # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 istoreos # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t istoreos # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªç½‘ç»œï¼Œè¿æ¥æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† iStoreOS è½¯è·¯ç”±ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ æ™ºèƒ½ç®¡ç† å…¨æ–¹ä½æŒæ§ç½‘ç»œæµé‡ï¼Œä¼˜åŒ–å¸¦å®½åˆ†é…å’Œè¿æ¥è´¨é‡\nğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ æ„å»ºä¼ä¸šçº§ç½‘ç»œå®‰å…¨ä½“ç³»ï¼Œä¿æŠ¤å†…ç½‘è®¾å¤‡å…å—å¨èƒ\nâš¡ é«˜æ•ˆç¨³å®š äº«å—è½¯è·¯ç”±å¸¦æ¥çš„é«˜æ€§èƒ½ç½‘ç»œä½“éªŒï¼Œæ”¯æŒå¤šç§ç½‘ç»œåè®®å’ŒæœåŠ¡\nç½‘ç»œä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸è¿æ¥å…±èˆçš„æŠ€æœ¯å¾ç¨‹ã€‚æ„¿ iStoreOS æˆä¸ºä½ å¯é çš„ç½‘ç»œç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡ç½‘ç»œä¼˜åŒ–å’Œå®‰å…¨é˜²æŠ¤çš„æŒ‘æˆ˜ä¸­ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ™ºèƒ½è·¯ç”±ï¼Œå®‰å…¨è¿æ¥â€”â€”æ„å»ºä½ é«˜æ•ˆç¨³å®šçš„ç½‘ç»œç¯å¢ƒå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ iStoreOS å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ç½‘ç»œç•…é€šï¼Œç®¡ç†æœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T13:06:34+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-istoreos-001.webp","permalink":"https://blog.meimolihan.eu.org/p/5260f4d4/","title":"Docker éƒ¨ç½² iStoreOS è½¯è·¯ç”±ç³»ç»Ÿ ğŸš€"},{"content":"Docker éƒ¨ç½² MD äº‘æ–‡æ¡£ç³»ç»Ÿ ğŸ“ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² MD äº‘æ–‡æ¡£ 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ MD äº‘æ–‡æ¡£ 1. è®¿é—®ç³»ç»Ÿä¸åˆå§‹è®¾ç½® ğŸŒ 2. åˆ›å»ºå’Œç®¡ç†æ–‡æ¡£ ğŸ“„ 3. é«˜çº§åŠŸèƒ½ä¸åº”ç”¨ ğŸš€ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ–‡æ¡£ï¼Œåä½œæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± Gitee é¡¹ç›®åœ°å€ï¼š https://gitee.com/streamerzero/md ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/streamerzero/md MD äº‘æ–‡æ¡£ æ˜¯ä¸€æ¬¾åŸºäº Markdown çš„ç°ä»£åŒ–åœ¨çº¿æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼Œä¸ºä¸ªäººå’Œå›¢é˜Ÿæä¾›é«˜æ•ˆä¾¿æ·çš„æ–‡æ¡£ç¼–è¾‘ä¸åä½œä½“éªŒã€‚å®ƒç»“åˆäº†ç®€æ´çš„ç•Œé¢è®¾è®¡å’Œå¼ºå¤§çš„åŠŸèƒ½ç‰¹æ€§ï¼Œæ˜¯çŸ¥è¯†ç®¡ç†å’Œå›¢é˜Ÿåä½œçš„ç†æƒ³é€‰æ‹©ã€‚âœ¨\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âœï¸ å®æ—¶ç¼–è¾‘ Markdown å³æ—¶é¢„è§ˆ æµç•…å†™ä½œä½“éªŒï¼Œæ‰€è§å³æ‰€å¾— ğŸ“ æ–‡æ¡£ç®¡ç† æ ‘å½¢ç»“æ„ï¼Œå¤šçº§æ–‡ä»¶å¤¹ æ¸…æ™°ç»„ç»‡å¤§é‡æ–‡æ¡£ ğŸ” å…¨æ–‡æœç´¢ å¿«é€Ÿå†…å®¹å®šä½ é«˜æ•ˆæ£€ç´¢ï¼Œå…³é”®è¯é«˜äº® ğŸ“± å“åº”å¼è®¾è®¡ é€‚é…å¤šè®¾å¤‡ æ¡Œé¢ç§»åŠ¨ç«¯å®Œç¾ä½“éªŒ ğŸ‘¥ å›¢é˜Ÿåä½œ å¤šäººå®æ—¶åä½œç¼–è¾‘ æå‡å›¢é˜Ÿåä½œæ•ˆç‡ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker ä¸€é”®éƒ¨ç½² ç®€å•æ˜“ç”¨ï¼Œå¿«é€Ÿä¸Šçº¿ ğŸ”’ æ•°æ®å®‰å…¨ æœ¬åœ°åŒ–éƒ¨ç½² éšç§ä¿éšœï¼Œæ•°æ®è‡ªä¸» ğŸ¨ ä¸»é¢˜å®šåˆ¶ å¤šç§ä¸»é¢˜é€‰æ‹© ä¸ªæ€§åŒ–ç•Œé¢ï¼Œè‡ªå®šä¹‰æ ·å¼ ğŸ“Š ç‰ˆæœ¬æ§åˆ¶ å®Œæ•´å†å²è®°å½• è¿½æº¯å˜æ›´ï¼Œæ¢å¤æ—§ç‰ˆ ğŸ³ ä¸€ã€Docker éƒ¨ç½² MD äº‘æ–‡æ¡£ 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -p /mnt/mydisk/home/md \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: md: image: streamerzero/md:latest container_name: md environment: - REG=true # å¯ç”¨æ³¨å†ŒåŠŸèƒ½ - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® volumes: - ./data:/md/data # æ•°æ®æŒä¹…åŒ–ç›®å½• ports: - \u0026#34;9900:9900\u0026#34; # æœåŠ¡ç«¯å£æ˜ å°„ restart: unless-stopped healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:9900\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ MD äº‘æ–‡æ¡£ 1. è®¿é—®ç³»ç»Ÿä¸åˆå§‹è®¾ç½® ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® MD äº‘æ–‡æ¡£ç³»ç»Ÿ:\nç›´æ¥è®¿é—®: http://æœåŠ¡å™¨IP:9900 åŸŸåè®¿é—®: https://md.example.com:666 (é…ç½®äº† Nginx åå‘ä»£ç†å) åˆå§‹è®¾ç½®å»ºè®®:\nåˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Œè®¾ç½®å¼ºå¯†ç  é…ç½®ç«™ç‚¹åç§°å’Œæè¿° è®¾ç½®å›¢é˜Ÿåä½œæƒé™ é€‰æ‹©ä¸»é¢˜é£æ ¼ï¼ˆäº®è‰²/æš—è‰²ï¼‰ 2. åˆ›å»ºå’Œç®¡ç†æ–‡æ¡£ ğŸ“„ MD äº‘æ–‡æ¡£æä¾›å…¨é¢çš„æ–‡æ¡£ç®¡ç†åŠŸèƒ½:\næ–‡æ¡£åˆ›å»º: ä½¿ç”¨å·¦ä¾§å¯¼èˆªæ åˆ›å»ºæ–‡ä»¶å¤¹å’Œæ–‡æ¡£ ç¼–è¾‘åŠŸèƒ½: å®æ—¶åŒæ é¢„è§ˆï¼Œæ”¯æŒ Markdown è¯­æ³•å’Œå¿«æ·é”® åä½œåŠŸèƒ½: å¤šäººå®æ—¶åä½œç¼–è¾‘ï¼Œç‰ˆæœ¬å†å²è®°å½• æ–‡æ¡£ç®¡ç†: æ–‡æ¡£åˆ†ç±»å’Œæ ‡ç­¾ç³»ç»Ÿï¼Œå…¨æ–‡æœç´¢åŠŸèƒ½ 3. é«˜çº§åŠŸèƒ½ä¸åº”ç”¨ ğŸš€ API è®¿é—®: RESTful API æ¥å£ï¼ŒWebhook æ”¯æŒ æ’ä»¶ç³»ç»Ÿ: æ‰©å±•åŠŸèƒ½æ’ä»¶ï¼Œè‡ªå®šä¹‰ä¸»é¢˜å’Œæ ·å¼ æ•°æ®å¤‡ä»½: è‡ªåŠ¨å¤‡ä»½è®¾ç½®ï¼Œæ‰‹åŠ¨å¯¼å‡ºæ•°æ® æƒé™ç®¡ç†: ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼Œè®¿é—®æ—¥å¿—å’Œå®¡è®¡è·Ÿè¸ª ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://md.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/md.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name md.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:9900; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/md # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop md # åœæ­¢å®¹å™¨ docker start md # å¯åŠ¨å®¹å™¨ docker restart md # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm md # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f md # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it md sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it md bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it md sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec md ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect md # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats md # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs md # æŸ¥çœ‹æ—¥å¿— docker logs -f md # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 md # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t md # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ–‡æ¡£ï¼Œåä½œæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† MD äº‘æ–‡æ¡£ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“ é«˜æ•ˆåˆ›ä½œ äº«å—æµç•…çš„ Markdown ç¼–è¾‘ä½“éªŒï¼Œä¸“æ³¨å†…å®¹åˆ›ä½œè€Œéæ ¼å¼è°ƒæ•´\nğŸ‘¥ æ— ç¼åä½œ ä¸å›¢é˜Ÿæˆå‘˜å®æ—¶ååŒç¼–è¾‘ï¼Œæå‡æ–‡æ¡£åä½œæ•ˆç‡\nğŸ“š çŸ¥è¯†æ²‰æ·€ æ„å»ºç»“æ„åŒ–çŸ¥è¯†åº“ï¼Œè®©å®è´µç»éªŒå¾—ä»¥ä¼ æ‰¿å’Œå¤ç”¨\næ–‡æ¡£ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸çŸ¥è¯†å…±é¸£çš„åˆ›ä½œæ—…ç¨‹ã€‚æ„¿ MD äº‘æ–‡æ¡£æˆä¸ºä½ å¯é çš„åˆ›ä½œä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡çµæ„Ÿè¿¸å‘å’ŒçŸ¥è¯†æ•´ç†çš„ç¬é—´ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé«˜æ•ˆåˆ›ä½œï¼Œæ™ºæ…§æ²‰æ·€â€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„çŸ¥è¯†å®åº“å§ï¼ğŸŒ¿\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ MD äº‘æ–‡æ¡£é¡¹ç›®æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ Gitee Issues æå‡ºã€‚\nç¥ä½ åˆ›ä½œæ„‰å¿«ï¼Œåä½œæœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T12:53:47+08:00","image":"https://file.meimolihan.eu.org/img/docker-md-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0734f1f4/","title":"Docker éƒ¨ç½² MD äº‘æ–‡æ¡£ç³»ç»Ÿ ğŸ“"},{"content":"Docker éƒ¨ç½² EasyVoice æ–‡å­—è½¬è¯­éŸ³æœåŠ¡ ğŸ¤ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² EasyVoice 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ EasyVoice 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åŸºæœ¬ä½¿ç”¨æ–¹å¼ ğŸ–±ï¸ 3. API ä½¿ç”¨ç¤ºä¾‹ ğŸš€ 4. æŸ¥çœ‹ç”Ÿæˆçš„è¯­éŸ³æ–‡ä»¶ ğŸ“‚ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè¯­éŸ³ï¼Œåˆ›ä½œæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ EasyVoice å®˜ç½‘åœ°å€ï¼š https://ev.xhalo.co/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/cosin2077/easyVoice ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/cosincox/easyvoice EasyVoice æ˜¯ä¸€æ¬¾å¼€æºçš„æ™ºèƒ½æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰å·¥å…·ï¼Œä½œä¸ºæ–‡æœ¬ã€å°è¯´æ™ºèƒ½è½¬è¯­éŸ³è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·è½»æ¾å°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºé«˜è´¨é‡çš„è¯­éŸ³è¾“å‡ºã€‚å®ƒæä¾›ç®€å•æ˜“ç”¨çš„ RESTful API æ¥å£ï¼Œæ”¯æŒå¤šç§è¯­éŸ³é£æ ¼å’Œè¯­è¨€é€‰é¡¹ï¼Œæ˜¯å†…å®¹åˆ›ä½œã€æœ‰å£°è¯»ç‰©åˆ¶ä½œã€è¯­éŸ³æç¤ºç­‰åœºæ™¯çš„ç†æƒ³é€‰æ‹©ã€‚ğŸ”Šâœ¨\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸš€ æ™ºèƒ½è¯­éŸ³ç”Ÿæˆ æ”¯æŒå¤šç»´åº¦å‚æ•°æ§åˆ¶ï¼ŒåŒ…æ‹¬è¯­é€Ÿã€éŸ³é«˜ã€éŸ³é‡ä¸‰çº§è°ƒèŠ‚ ç²¾ç»†æ§åˆ¶è¯­éŸ³è¾“å‡ºæ•ˆæœï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ ğŸ­ è§’è‰²æ¼”ç»å¼•æ“ å†…ç½®å¤šç§é¢„ç½®å£°çº¿ï¼Œæ”¯æŒåŒä¸€åœºæ™¯ä¸‹å¤šè§’è‰²åŒæ­¥é…éŸ³ å®ç°æ‹ŸçœŸå¯¹è¯åˆæˆï¼Œæå‡å†…å®¹è¡¨ç°åŠ› âš¡ å®æ—¶æµå¼å¤„ç† é‡‡ç”¨åˆ†å—ä¼ è¾“æŠ€æœ¯ï¼Œå®ç°éŸ³é¢‘å®æ—¶ç”Ÿæˆ å‡å°‘ç­‰å¾…æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸŒ å¤šå¼•æ“æ”¯æŒ å¯æ¥å…¥ Microsoft Azure TTSã€OpenAIã€Edge-TTS ç­‰æœåŠ¡ çµæ´»é€‰æ‹©åˆæˆå¼•æ“ï¼Œä¿è¯æœåŠ¡ç¨³å®šæ€§ ğŸ”’ å®‰å…¨å¯é  æœ¬åœ°åŒ–éƒ¨ç½²ï¼Œæ‰€æœ‰æ•°æ®ä¿å­˜åœ¨æœ¬åœ° ç¡®ä¿éšç§å®‰å…¨ï¼Œæ•°æ®è‡ªä¸»å¯æ§ ğŸ›  æ˜“ç”¨æ€§ æä¾› Web ç®¡ç†ç•Œé¢å’Œ RESTful API å¼€ç®±å³ç”¨ï¼Œæ˜“äºé›†æˆåˆ°å„ç§åº”ç”¨ ğŸ“Š æ‰¹é‡å¤„ç† æ”¯æŒæ‰¹é‡æ–‡æœ¬è½¬è¯­éŸ³å¤„ç† æé«˜å¤§æ‰¹é‡å†…å®¹å¤„ç†æ•ˆç‡ ğŸ’¾ æ–‡ä»¶ç®¡ç† è‡ªåŠ¨ä¿å­˜å’Œç®¡ç†ç”Ÿæˆçš„è¯­éŸ³æ–‡ä»¶ æ–¹ä¾¿æŸ¥æ‰¾å’Œä½¿ç”¨ç”Ÿæˆçš„å†…å®¹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² EasyVoice 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/easyvoice \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: easyvoice: image: cosincox/easyvoice:latest container_name: easyvoice ports: - \u0026#34;9549:3000\u0026#34; # ğŸŒ ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ volumes: - ./audio:/app/audio # ğŸ’¾ è¯­éŸ³æ–‡ä»¶å­˜å‚¨ç›®å½• environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® - DEBUG=true # ğŸ› è°ƒè¯•æ¨¡å¼ - OPENAI_BASE_URL=https://openrouter.ai/api/v1/ # ğŸ¤– OpenAI APIåœ°å€ï¼ˆå¯é€‰ï¼‰ restart: unless-stopped # ğŸ”„ è‡ªåŠ¨é‡å¯ EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ EasyVoice 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:9549 åŸŸåè®¿é—®: https://easyvoice.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åŸºæœ¬ä½¿ç”¨æ–¹å¼ ğŸ–±ï¸ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ç‚¹å‡»\u0026quot;ç«‹å³ä½“éªŒ\u0026quot;è¿›å…¥æ“ä½œç•Œé¢ åœ¨å·¦ä¾§è¾“å…¥æ–‡æœ¬æˆ–ä¸Šä¼  TXT æ–‡ä»¶ åœ¨å³ä¾§è®¾ç½®è¯­éŸ³å‚æ•°ï¼ˆè¯­è¨€ã€æ€§åˆ«ã€é…éŸ³è§’è‰²ã€è¯­é€Ÿã€éŸ³é‡ã€éŸ³è°ƒç­‰ï¼‰ ç‚¹å‡»\u0026quot;ç”Ÿæˆè¯­éŸ³\u0026quot;å¼€å§‹è½¬æ¢ æ’­æ”¾æˆ–ä¸‹è½½ç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶ 3. API ä½¿ç”¨ç¤ºä¾‹ ğŸš€ åŸºæœ¬æ–‡å­—è½¬è¯­éŸ³è¯·æ±‚ 1 2 3 4 5 6 7 8 9 curl -X POST \u0026#34;http://localhost:9549/api/tts/generate\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;text\u0026#34;: \u0026#34;ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨EasyVoiceæ–‡å­—è½¬è¯­éŸ³æœåŠ¡\u0026#34;, \u0026#34;voice\u0026#34;: \u0026#34;zh-CN-XiaoxiaoNeural\u0026#34;, \u0026#34;speed\u0026#34;: 1.0, \u0026#34;pitch\u0026#34;: 0, \u0026#34;volume\u0026#34;: 1.0 }\u0026#39; å¤šè§’è‰²é…éŸ³è¯·æ±‚ 1 2 3 4 5 6 7 curl -X POST \u0026#34;http://localhost:9549/api/tts/generate\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;text\u0026#34;: \u0026#34;[è§’è‰²1: å¾å‡¤å¹´] å¯’é£å¦‚åˆ€ï¼Œå‰²è£‚ç€å´–å£ä¸Šçš„æ®‹é›ªã€‚\\n[è§’è‰²2: å‡Œé›ªå„¿] ä¸€é˜µè½»ç›ˆçš„è„šæ­¥å£°æ‰“ç ´äº†å¯‚é™ã€‚\u0026#34;, \u0026#34;speed\u0026#34;: 1.0, \u0026#34;pitch\u0026#34;: 0 }\u0026#39; 4. æŸ¥çœ‹ç”Ÿæˆçš„è¯­éŸ³æ–‡ä»¶ ğŸ“‚ æ‰€æœ‰ç”Ÿæˆçš„è¯­éŸ³æ–‡ä»¶å°†ä¿å­˜åœ¨æœ¬åœ°çš„ ./audio ç›®å½•ä¸­ï¼š\n1 2 # æŸ¥çœ‹ç”Ÿæˆçš„è¯­éŸ³æ–‡ä»¶ ls -la /mnt/mydisk/home/easyvoice/audio/ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://easyvoice.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/easyvoice.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name easyvoice.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 10M; location / { proxy_pass http://localhost:9549; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; proxy_http_version 1.1; # è¶…æ—¶è®¾ç½®ï¼ˆè¯­éŸ³ç”Ÿæˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰ proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/easyvoice # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop easyvoice # åœæ­¢å®¹å™¨ docker start easyvoice # å¯åŠ¨å®¹å™¨ docker restart easyvoice # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm easyvoice # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f easyvoice # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it easyvoice sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it easyvoice bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect easyvoice # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats easyvoice # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs easyvoice # æŸ¥çœ‹æ—¥å¿— docker logs -f easyvoice # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 easyvoice # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t easyvoice # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè¯­éŸ³ï¼Œåˆ›ä½œæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† EasyVoice æ–‡å­—è½¬è¯­éŸ³æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ™ï¸ æ™ºèƒ½é…éŸ³ äº«å—é«˜è´¨é‡çš„æ–‡å­—è½¬è¯­éŸ³ä½“éªŒï¼Œä¸ºå†…å®¹èµ‹äºˆç”ŸåŠ¨çš„å£°éŸ³è¡¨è¾¾\nğŸ­ å¤šè§’è‰²æ¼”ç» å®ç°æ‹ŸçœŸå¯¹è¯åˆæˆï¼Œè®©æ•…äº‹å’Œå†…å®¹æ›´åŠ ç”ŸåŠ¨æœ‰è¶£\nâš¡ é«˜æ•ˆåˆ›ä½œ æ‰¹é‡å¤„ç†æ–‡æœ¬å†…å®¹ï¼Œå¤§å¹…æå‡éŸ³é¢‘å†…å®¹åˆ¶ä½œæ•ˆç‡\nè¯­éŸ³ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸å£°éŸ³å…±é¸£çš„è‰ºæœ¯åˆ›ä½œã€‚æ„¿ EasyVoice æˆä¸ºä½ å¯é çš„è¯­éŸ³åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å†…å®¹åˆ›ä½œå’Œè¯­éŸ³è¡¨è¾¾çš„ç²¾å½©æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ–‡å­—ç”Ÿå£°ï¼Œåˆ›æ„æ— é™â€”â€”æ„å»ºä½ ä¸°å¯Œå¤šå½©çš„éŸ³é¢‘ä¸–ç•Œå§ï¼ğŸ”Š\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ EasyVoice å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ åˆ›ä½œæ„‰å¿«ï¼Œå£°éŸ³åŠ¨äººï¼ğŸ‰\n","date":"2025-08-25T12:51:22+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-easyvoice-001.webp","permalink":"https://blog.meimolihan.eu.org/p/8aa2eaa9/","title":"Docker éƒ¨ç½² EasyVoice æ–‡å­—è½¬è¯­éŸ³æœåŠ¡ ğŸ¤"},{"content":"Docker éƒ¨ç½² LibreTV åœ¨çº¿è§‚å½±å¹³å° ğŸ“º ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² LibreTV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ LibreTV 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè§‚å½±ï¼Œç•…äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ MinDoc å®˜ç½‘åœ°å€ï¼š http://www.ls100.net/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/LibreSpark/LibreTV ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/bestzwei/libretv LibreTV æ˜¯ä¸€æ¬¾å¼€æºçš„åœ¨çº¿è§‚å½±å¹³å°ï¼Œèšåˆå¤šä¸ªè§†é¢‘æºï¼Œæä¾›å…è´¹ã€æ— å¹¿å‘Šçš„è§‚å½±ä½“éªŒã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ LibreTVï¼Œå®ç°ä¾¿æ·çš„å½±è§†èµ„æºè®¿é—®å’Œç®¡ç†ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¬ å¤šæºèšåˆ èšåˆå¤šä¸ªè§†é¢‘æºæ¥å£ èµ„æºä¸°å¯Œï¼Œè§‚å½±é€‰æ‹©å¤šæ ·åŒ– ğŸ” æ™ºèƒ½æœç´¢ æ”¯æŒå…¨å±€æœç´¢å’Œç­›é€‰ å¿«é€Ÿå®šä½æƒ³çœ‹çš„å½±è§†å†…å®¹ ğŸ¨ ç•Œé¢ç¾è§‚ ç°ä»£åŒ–ç”¨æˆ·ç•Œé¢è®¾è®¡ æ“ä½œæµç•…ï¼Œè§†è§‰ä½“éªŒèˆ’é€‚ ğŸŒ è·¨å¹³å°æ”¯æŒ æ”¯æŒ Web ç«¯è®¿é—® å¤šè®¾å¤‡å…¼å®¹ï¼Œéšæ—¶éšåœ°è§‚çœ‹ âš¡ å®æ—¶æ›´æ–° èµ„æºåº“æŒç»­æ›´æ–° æœ€æ–°å½±è§†å†…å®¹åŠæ—¶è·å– ğŸ”’ éšç§ä¿æŠ¤ æ— éœ€æ³¨å†Œç™»å½• ä¿æŠ¤ç”¨æˆ·è§‚çœ‹éšç§ ğŸ¯ ä¸ªæ€§åŒ–æ¨è æ ¹æ®è§‚çœ‹å†å²æ¨è å‘ç°æ›´å¤šæ„Ÿå…´è¶£å†…å®¹ ğŸ“± å“åº”å¼è®¾è®¡ é€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯ å„ç§è®¾å¤‡ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ ğŸ³ ä¸€ã€Docker éƒ¨ç½² LibreTV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/libretv \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: libretv: container_name: libretv image: bestzwei/libretv:latest restart: always ports: - \u0026#34;8899:80\u0026#34; environment: - PASSWORD=your_password # âš ï¸ ä¿®æ”¹ä¸ºè®¿é—®å¯†ç  - ADMINPASSWORD=your_adminpassword # âš ï¸ ä¿®æ”¹ä¸ºç®¡ç†å‘˜å¯†ç  volumes: - ./data:/app/data # æ•°æ®æŒä¹…åŒ– EOF ğŸ” å¯†ç è®¾ç½®ï¼šå°† your_password å’Œ your_adminpassword æ›¿æ¢ä¸ºä½ è‡ªå·±çš„é«˜å¼ºåº¦å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ LibreTV 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8899 åŸŸåè®¿é—®ï¼š https://libretv.example.com:666 ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨è®¾ç½®çš„å¯†ç ç™»å½•ï¼ˆå¦‚å·²é…ç½®å¯†ç ä¿æŠ¤ï¼‰ åœ¨è®¾ç½®ä¸­å¯ç”¨æ‰€éœ€çš„æ•°æ®æº å¼€å§‹æœç´¢å’Œè§‚çœ‹å½±è§†å†…å®¹ï¼ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://libretv.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/libretv.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name libretv.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8899; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè§‚å½±ï¼Œç•…äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† LibreTV åœ¨çº¿è§‚å½±å¹³å°ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ ä¸°å¯Œèµ„æº ç•…äº«å¤šæºèšåˆçš„å½±è§†å†…å®¹ï¼Œæ¶µç›–ç”µå½±ã€ç”µè§†å‰§ç­‰å¤šç§ç±»å‹\nğŸŒ æ— ç¼ä½“éªŒ è·¨è®¾å¤‡è®¿é—®ï¼Œå“åº”å¼è®¾è®¡ç¡®ä¿åœ¨ä»»ä½•å±å¹•ä¸Šéƒ½æœ‰è‰¯å¥½è¡¨ç°\nğŸ”’ éšç§å®‰å…¨ æœ¬åœ°åŒ–éƒ¨ç½²ä¿éšœæ•°æ®å®‰å…¨ï¼Œæ— å¹¿å‘Šå¹²æ‰°çš„çº¯å‡€è§‚å½±ç¯å¢ƒ\nå½±è§†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç²¾å½©å†…å®¹ç›¸ä¼´çš„ä¼‘é—²æ—¶å…‰ã€‚æ„¿ LibreTV æˆä¸ºä½ è´´å¿ƒçš„è§‚å½±ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªæ”¾æ¾å’Œå¨±ä¹çš„ç¾å¥½æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒè§‚çœ‹ï¼Œç•…äº«å½±è§†â€”â€”æ„å»ºä½ ä¸“å±çš„ç§äººå½±é™¢å§ï¼ğŸ‰\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ LibreTV å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§‚å½±æ„‰å¿«ï¼Œäº«å—æ¯ä¸€åˆ»ï¼ğŸ¬\n","date":"2025-08-25T12:49:49+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-libretv-001.webp","permalink":"https://blog.meimolihan.eu.org/p/dabd2072/","title":"Docker éƒ¨ç½² LibreTV ç”µè§†ç›´æ’­ç³»ç»Ÿ ğŸ“º"},{"content":"Docker éƒ¨ç½² MeTube è§†é¢‘ä¸‹è½½å·¥å…· ğŸ“¥ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² MeTube 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ MeTube 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. ä¸‹è½½è§†é¢‘æ­¥éª¤ ğŸ“¥ 3. ä¸‹è½½ç›®å½•ç»“æ„ ğŸ“‚ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªä¸‹è½½ï¼Œèµ„æºæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/alexta69/metube ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/alexta69/metube MeTube æ˜¯ä¸€æ¬¾åŸºäº Web çš„ YouTube-dl å‰ç«¯ç•Œé¢ï¼Œæä¾›ç¾è§‚æ˜“ç”¨çš„è§†é¢‘ä¸‹è½½æœåŠ¡ã€‚å®ƒæ”¯æŒä» 1000+ ä¸ªç½‘ç«™ä¸‹è½½è§†é¢‘ã€éŸ³é¢‘å’Œå­—å¹•ï¼ŒåŒ…æ‹¬ YouTubeã€Bilibiliã€Twitterã€Instagram ç­‰çƒ­é—¨å¹³å°ã€‚âœ¨\nè¿™æ¬¾å·¥å…·ç‰¹åˆ«é€‚åˆéœ€è¦æ‰¹é‡ä¸‹è½½è§†é¢‘å†…å®¹çš„ç”¨æˆ·ï¼Œæä¾›äº†ç›´è§‚çš„ç•Œé¢å’Œä¸°å¯Œçš„æ ¼å¼é€‰æ‹©ï¼Œè®©è§†é¢‘ä¸‹è½½å˜å¾—ç®€å•é«˜æ•ˆã€‚æ— è®ºæ˜¯ä¸ªäººä½¿ç”¨è¿˜æ˜¯å›¢é˜Ÿåä½œï¼ŒMeTube éƒ½èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ğŸ‰\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ–¥ï¸ ç°ä»£åŒ–ç•Œé¢ å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå„ç§è®¾å¤‡è®¿é—® åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½è·å¾—è‰¯å¥½ä½“éªŒ ğŸ“± å¤šæ ¼å¼æ”¯æŒ æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼å’Œè´¨é‡é€‰æ‹© çµæ´»é€‚åº”ä¸åŒæ’­æ”¾éœ€æ±‚ ğŸ”” å®æ—¶é€šçŸ¥ ä¸‹è½½è¿›åº¦å®æ—¶æé†’ ä¸€ç›®äº†ç„¶æŒæ¡ä¸‹è½½çŠ¶æ€ ğŸ’¾ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨æ–‡ä»¶å‘½åå’Œç»„ç»‡ ä¾¿äºæŸ¥æ‰¾å’Œç®¡ç†ä¸‹è½½å†…å®¹ ğŸ”’ å®‰å…¨éƒ¨ç½² åŸºäº Docker å®¹å™¨åŒ– éš”ç¦»ç¯å¢ƒï¼Œä¿éšœç³»ç»Ÿå®‰å…¨ ğŸŒ å¤šå¹³å°æ”¯æŒ æ”¯æŒ 1000+ ç½‘ç«™è§†é¢‘ä¸‹è½½ è¦†ç›–ç»å¤§å¤šæ•°è§†é¢‘å¹³å° âš¡ é«˜æ•ˆä¸‹è½½ å¤šä»»åŠ¡å¹¶è¡Œä¸‹è½½ æå‡ä¸‹è½½æ•ˆç‡ï¼ŒèŠ‚çœæ—¶é—´ ğŸ¨ ä¸»é¢˜å®šåˆ¶ æ”¯æŒæš—è‰²/äº®è‰²ä¸»é¢˜åˆ‡æ¢ æ ¹æ®å–œå¥½è‡ªå®šä¹‰ç•Œé¢é£æ ¼ ğŸ“Š ä¸‹è½½ç»Ÿè®¡ æä¾›ä¸‹è½½å†å²å’Œæ•°æ®ç»Ÿè®¡ æ–¹ä¾¿è¿½è¸ªå’Œç®¡ç†ä¸‹è½½è®°å½• ğŸ³ ä¸€ã€Docker éƒ¨ç½² MeTube 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -p /mnt/mydisk/downloads/metube \u0026amp;\u0026amp; \\ mkdir -p /mnt/mydisk/home/metube \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: metube: image: ghcr.io/alexta69/metube:latest container_name: metube restart: unless-stopped ports: - \u0026#34;8081:8081\u0026#34; # ğŸŒ Web ç•Œé¢è®¿é—®ç«¯å£ volumes: - /mnt/mydisk/downloads/metube:/downloads # ğŸ’¾ ä¸‹è½½æ–‡ä»¶å­˜å‚¨ç›®å½• environment: - MAX_PARALLEL_DOWNLOADS=3 # ğŸ”¢ åŒæ—¶ä¸‹è½½ä»»åŠ¡æ•° - OUTPUT_TEMPLATE=%(title)s.%(ext)s # ğŸ“ è¾“å‡ºæ–‡ä»¶åæ¨¡æ¿ - TZ=Asia/Shanghai # ğŸ• æ—¶åŒºè®¾ç½® - UMASK=000 # ğŸ”“ æ–‡ä»¶æƒé™è®¾ç½® - UID=1000 # ğŸ‘¤ ç”¨æˆ·ID - GID=1000 # ğŸ‘¥ ç»„ID EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ MeTube 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8081 åŸŸåè®¿é—®: https://metube.example.com:666ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. ä¸‹è½½è§†é¢‘æ­¥éª¤ ğŸ“¥ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ å¤åˆ¶è§†é¢‘é“¾æ¥å¹¶ç²˜è´´åˆ°è¾“å…¥æ¡† é€‰æ‹©æƒ³è¦çš„æ ¼å¼å’Œè´¨é‡ï¼ˆè§†é¢‘ã€éŸ³é¢‘æˆ–ä¸¤è€…ï¼‰ ç‚¹å‡»ä¸‹è½½æŒ‰é’®å¼€å§‹ä¸‹è½½ åœ¨ä¸‹è½½é¡µé¢æŸ¥çœ‹å®æ—¶è¿›åº¦å’ŒçŠ¶æ€ 3. ä¸‹è½½ç›®å½•ç»“æ„ ğŸ“‚ æ‰€æœ‰ä¸‹è½½çš„æ–‡ä»¶å°†ä¿å­˜åœ¨ /mnt/mydisk/downloads/metube ç›®å½•ä¸­ï¼š\n1 2 # æŸ¥çœ‹ä¸‹è½½çš„æ–‡ä»¶ ls -la /mnt/mydisk/downloads/metube/ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://metube.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/metube.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name metube.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubDomains; preload\u0026#34;; # å¤§æ–‡ä»¶ä¸‹è½½æ”¯æŒ client_max_body_size 0; proxy_request_buffering off; location / { proxy_pass http://localhost:8081; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½®ï¼ˆé•¿ä¸‹è½½éœ€è¦ï¼‰ proxy_connect_timeout 7d; proxy_send_timeout 7d; proxy_read_timeout 7d; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/metube # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop metube # åœæ­¢å®¹å™¨ docker start metube # å¯åŠ¨å®¹å™¨ docker restart metube # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm metube # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f metube # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it metube sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it metube bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect metube # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats metube # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs metube # æŸ¥çœ‹æ—¥å¿— docker logs -f metube # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 metube # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t metube # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªä¸‹è½½ï¼Œèµ„æºæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† MeTube è§†é¢‘ä¸‹è½½å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“¥ é«˜æ•ˆä¸‹è½½ è½»æ¾è·å–æ¥è‡ª 1000+ ç½‘ç«™çš„è§†é¢‘èµ„æºï¼Œæ”¯æŒå¤šç§æ ¼å¼å’Œè´¨é‡é€‰æ‹©\nğŸŒ å¤šå¹³å°æ”¯æŒ è¦†ç›– YouTubeã€Bilibili ç­‰ä¸»æµè§†é¢‘å¹³å°ï¼Œä¸€ç«™å¼è§£å†³ä¸‹è½½éœ€æ±‚\nâš¡ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨åŒ–æ–‡ä»¶å‘½åå’Œç»„ç»‡ï¼Œè®©ä¸‹è½½å†…å®¹äº•äº•æœ‰æ¡\nä¸‹è½½ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•°å­—èµ„æºç›¸ä¼´çš„ä¾¿æ·æ—…ç¨‹ã€‚æ„¿ MeTube æˆä¸ºä½ å¾—åŠ›çš„ä¸‹è½½åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡èµ„æºæ”¶é›†å’Œå†…å®¹ä¿å­˜çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒä¸‹è½½ï¼Œç•…äº«èµ„æºâ€”â€”æ„å»ºä½ ä¸°å¯Œçš„å¤šåª’ä½“èµ„æ–™åº“å§ï¼ğŸ¬\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ MeTube å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¸‹è½½æ„‰å¿«ï¼Œèµ„æºä¸°å¯Œï¼ğŸ‰\n","date":"2025-08-25T12:48:05+08:00","image":"https://file.meimolihan.eu.org/img/metube-01.webp","permalink":"https://blog.meimolihan.eu.org/p/82bbf0bc/","title":"Docker éƒ¨ç½² MeTube è§†é¢‘ä¸‹è½½å·¥å…· ğŸ“¥"},{"content":"Docker éƒ¨ç½² AllinSSL SSLè¯ä¹¦ç®¡ç†å·¥å…· ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² AllinSSL 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ AllinSSL 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ”„ äº”ã€åŒæ­¥è¯ä¹¦åˆ° Nginx 1. æ‰‹åŠ¨åŒæ­¥è¯ä¹¦ 2. è‡ªåŠ¨åŒ–åŒæ­¥è„šæœ¬ 3. è®¾ç½®è®¡åˆ’ä»»åŠ¡ â° ğŸŒŸ å¯èˆªå®‰å…¨ï¼Œå®ˆæŠ¤æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ AllinSSL å®˜ç½‘åœ°å€ï¼š https://www.allinssl.com/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/allinssl/allinssl ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/allinssl/allinssl AllinSSL æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ SSL è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨ç”³è¯·ã€ç»­æœŸå’Œç®¡ç†å¤šä¸ªè¯ä¹¦é¢å‘æœºæ„ï¼ˆå¦‚ Let\u0026rsquo;s Encryptã€ZeroSSLï¼‰çš„ SSL/TLS è¯ä¹¦ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ AllinSSLï¼Œå®ç°è¯ä¹¦çš„é›†ä¸­ç®¡ç†å’Œè‡ªåŠ¨åŒ–ç»´æŠ¤ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ” å¤šCAæ”¯æŒ æ”¯æŒ Let\u0026rsquo;s Encryptã€ZeroSSL ç­‰å¤šä¸ªè¯ä¹¦é¢å‘æœºæ„ çµæ´»é€‰æ‹©è¯ä¹¦æä¾›å•†ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚ ğŸŒ DNSéªŒè¯ æ”¯æŒä¸»æµDNSæä¾›å•†çš„APIè‡ªåŠ¨éªŒè¯ æ— éœ€å¼€æ”¾æœåŠ¡å™¨ç«¯å£ï¼Œæ›´å®‰å…¨çš„éªŒè¯æ–¹å¼ â° è‡ªåŠ¨ç»­æœŸ è‡ªåŠ¨ç›‘æ§è¯ä¹¦æœ‰æ•ˆæœŸå¹¶æå‰ç»­æœŸ é¿å…è¯ä¹¦è¿‡æœŸå¯¼è‡´çš„æœåŠ¡ä¸­æ–­ ğŸ“Š é›†ä¸­ç®¡ç† ç»Ÿä¸€ç®¡ç†å¤šä¸ªåŸŸåå’Œå­åŸŸåçš„è¯ä¹¦ ç®€åŒ–è¯ä¹¦ç»´æŠ¤å·¥ä½œæµç¨‹ ğŸ“ è¯ä¹¦å¯¼å‡º æ”¯æŒå¤šç§æ ¼å¼è¯ä¹¦å¯¼å‡º å…¼å®¹å„ç±»WebæœåŠ¡å™¨å’Œåº”ç”¨ ğŸ”” åˆ°æœŸæé†’ é‚®ä»¶æˆ–é€šçŸ¥æé†’è¯ä¹¦åˆ°æœŸæ—¶é—´ åŠæ—¶æŒæ¡è¯ä¹¦çŠ¶æ€ ğŸ¯ æ‰¹é‡æ“ä½œ æ”¯æŒæ‰¹é‡ç”³è¯·ã€ç»­æœŸå’Œç®¡ç†è¯ä¹¦ æé«˜è¿ç»´æ•ˆç‡ ğŸ”’ å®‰å…¨å­˜å‚¨ åŠ å¯†å­˜å‚¨APIå¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶ ä¿éšœæ•æ„Ÿä¿¡æ¯å®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² AllinSSL 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/allinssl \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: allinssl: stdin_open: true tty: true container_name: allinssl restart: always ports: - 7979:8888 volumes: - ./data:/www/allinssl/data - /etc/nginx/keyfile:/www/allinssl/keyfile # æ˜ å°„ nginx è¯ä¹¦ç›®å½• environment: - ALLINSSL_USER=admin # âš ï¸ ä¿®æ”¹ä¸ºç®¡ç†ç”¨æˆ·å - ALLINSSL_PWD=12345678 # âš ï¸ ä¿®æ”¹ä¸ºç®¡ç†å¯†ç  - ALLINSSL_URL=allinssl # âš ï¸ ä¿®æ”¹ä¸ºè®¿é—®è·¯å¾„ image: allinssl/allinssl:latest EOF ğŸ” å®‰å…¨æç¤ºï¼šå°†é»˜è®¤çš„ç”¨æˆ·åã€å¯†ç å’Œè®¿é—®è·¯å¾„ä¿®æ”¹ä¸ºæ‚¨è‡ªå·±çš„å®‰å…¨å‡­æ®ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ AllinSSL 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:7979/allinssl åŸŸåè®¿é—®ï¼š https://allinssl.example.com/allinssl ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€\nä½¿ç”¨è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•\né…ç½® DNS æä¾›å•† API å¯†é’¥\nå¼€å§‹ç”³è¯·å’Œç®¡ç† SSL è¯ä¹¦\néƒ¨ç½²åˆ° nginx æ‰‹åŠ¨æ·»åŠ  cloudflare è§£æ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://allinssl.example.com/allinssl 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/allinssl.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name allinssl.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå ssl_certificate /etc/nginx/keyfile/mobufan.eu.org.pem; # è¯ä¹¦æ–‡ä»¶ ssl_certificate_key /etc/nginx/keyfile/mobufan.eu.org.key; # ç§é’¥æ–‡ä»¶ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header X-Frame-Options SAMEORIGIN; client_max_body_size 10G; error_page 500 502 503 504 /50x.html; location = /50x.html { root /var/www/html; } location / { proxy_pass http://127.0.0.1:7979; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_http_version 1.1; proxy_read_timeout 120s; proxy_connect_timeout 120s; proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; proxy_max_temp_file_size 0; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ”„ äº”ã€åŒæ­¥è¯ä¹¦åˆ° Nginx 1. æ‰‹åŠ¨åŒæ­¥è¯ä¹¦ 1 2 3 4 5 6 # å¤åˆ¶è¯ä¹¦æ–‡ä»¶åˆ° Nginx ç›®å½• cp /mnt/mydisk/home/allinssl/data/your-domain.com.pem /etc/nginx/keyfile/cert.pem cp /mnt/mydisk/home/allinssl/data/your-domain.com.key /etc/nginx/keyfile/key.pem # é‡å¯ Nginx ä½¿æ›´æ”¹ç”Ÿæ•ˆ sudo systemctl restart nginx 2. è‡ªåŠ¨åŒ–è¯ä¹¦åŒæ­¥è„šæœ¬ åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬ /usr/local/bin/update_nginx_cert.sh:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 #!/bin/bash # å®šä¹‰å˜é‡ CERT_DIR=\u0026#34;/mnt/mydisk/home/allinssl/data\u0026#34; NGINX_CERT_DIR=\u0026#34;/etc/nginx/keyfile\u0026#34; DOMAIN=\u0026#34;your-domain.com\u0026#34; # ğŸŒ æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå # æ£€æŸ¥è¯ä¹¦æ˜¯å¦å³å°†åˆ°æœŸ (å°‘äº18å¤©) check_cert_expiry() { local cert_file=\u0026#34;$CERT_DIR/$DOMAIN.pem\u0026#34; if [ -f \u0026#34;$cert_file\u0026#34; ]; then local expiry_date=$(openssl x509 -enddate -noout -in \u0026#34;$cert_file\u0026#34; | cut -d= -f2) local expiry_epoch=$(date -d \u0026#34;$expiry_date\u0026#34; +%s) local now_epoch=$(date +%s) local days_until_expiry=$(( (expiry_epoch - now_epoch) / 86400 )) if [ $days_until_expiry -lt 18 ]; then echo \u0026#34;è¯ä¹¦å°†åœ¨ $days_until_expiry å¤©ååˆ°æœŸï¼Œéœ€è¦æ›´æ–°\u0026#34; return 0 else echo \u0026#34;è¯ä¹¦è¿˜æœ‰ $days_until_expiry å¤©åˆ°æœŸï¼Œæ— éœ€æ›´æ–°\u0026#34; return 1 fi else echo \u0026#34;è¯ä¹¦æ–‡ä»¶ä¸å­˜åœ¨: $cert_file\u0026#34; return 1 fi } # æ›´æ–°è¯ä¹¦ update_cert() { echo \u0026#34;å¼€å§‹æ›´æ–°è¯ä¹¦...\u0026#34; cp \u0026#34;$CERT_DIR/$DOMAIN.pem\u0026#34; \u0026#34;$NGINX_CERT_DIR/cert.pem\u0026#34; cp \u0026#34;$CERT_DIR/$DOMAIN.key\u0026#34; \u0026#34;$NGINX_CERT_DIR/key.pem\u0026#34; # æµ‹è¯• Nginx é…ç½® if nginx -t; then # é‡å¯ Nginx systemctl restart nginx echo \u0026#34;è¯ä¹¦æ›´æ–°æˆåŠŸï¼ŒNginx å·²é‡å¯\u0026#34; else echo \u0026#34;Nginx é…ç½®æµ‹è¯•å¤±è´¥ï¼Œè¯ä¹¦æ›´æ–°æœªå®Œæˆ\u0026#34; return 1 fi } # ä¸»é€»è¾‘ if check_cert_expiry; then update_cert else echo \u0026#34;è¯ä¹¦å°šæœªéœ€è¦æ›´æ–°\u0026#34; fi 3. è®¾ç½®è®¡åˆ’ä»»åŠ¡ â° 1 2 3 4 5 6 7 8 # ç¼–è¾‘ crontab crontab -e # æ·»åŠ ä»¥ä¸‹è¡Œï¼Œæ¯ä¸¤å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œä¸€æ¬¡è¯ä¹¦æ£€æŸ¥ 0 3 */2 * * /bin/bash /usr/local/bin/update_nginx_cert.sh \u0026gt;\u0026gt; /var/log/nginx/cert_update.log 2\u0026gt;\u0026amp;1 # ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ chmod +x /usr/local/bin/update_nginx_cert.sh 4. é”™è¯¯å¤„ç† ğŸŒŸ å¯èˆªå®‰å…¨ï¼Œå®ˆæŠ¤æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† AllinSSL SSLè¯ä¹¦ç®¡ç†å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ” å…¨é¢é˜²æŠ¤ è½»æ¾ç®¡ç†å¤šä¸ªè¯ä¹¦é¢å‘æœºæ„çš„ SSL/TLS è¯ä¹¦ï¼Œä¸ºæ‰€æœ‰æœåŠ¡æä¾›åŠ å¯†ä¿éšœ\nâ° æ™ºèƒ½ç»´æŠ¤ è‡ªåŠ¨åŒ–è¯ä¹¦ç”³è¯·å’Œç»­æœŸï¼Œé¿å…å› è¯ä¹¦è¿‡æœŸå¯¼è‡´çš„æœåŠ¡ä¸­æ–­\nğŸŒ é›†ä¸­ç®¡ç† ç»Ÿä¸€ç›‘æ§å’Œç®¡ç†æ‰€æœ‰åŸŸåçš„è¯ä¹¦çŠ¶æ€ï¼Œæå‡è¿ç»´æ•ˆç‡\nå®‰å…¨ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•°å­—å¨èƒæŒç»­å¯¹æŠ—çš„é‡è¦ä½¿å‘½ã€‚æ„¿ AllinSSL æˆä¸ºä½ å¯é çš„å®‰å…¨å«å£«ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡è¯ä¹¦ç®¡ç†å’Œå®‰å…¨åŠ å›ºçš„å…³é”®æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå…¨é¢åŠ å¯†ï¼Œæ— å¿§è¿ç»´â€”â€”æ„å»ºä½ åšä¸å¯æ‘§çš„å®‰å…¨é˜²çº¿å§ï¼ğŸ›¡ï¸\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ AllinSSL å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼Œå®‰å…¨æ— å¿§ï¼ğŸ‰\n","date":"2025-08-25T12:46:33+08:00","image":"https://file.meimolihan.eu.org/img/docker-allinssl-01.webp","permalink":"https://blog.meimolihan.eu.org/p/592bd034/","title":"Docker éƒ¨ç½² AllinSSL SSLè¯ä¹¦ç®¡ç†å·¥å…· ğŸ”"},{"content":"Windows åˆ›å»º FnOS SSH å¯†é’¥å¯¹ ğŸ”‘ ğŸ“‘ ç›®å½•å¯¼èˆª ğŸŒŸ ç®€ä»‹ ğŸš€ ä¸€ã€åœ¨ Windows ä¸Šåˆ›å»º SSH å¯†é’¥å¯¹ ğŸ”§ äºŒã€åœ¨ FnOS æœåŠ¡å™¨ä¸Šé…ç½® SSH å¯†é’¥ âœ… ä¸‰ã€éªŒè¯ SSH å¯†é’¥é…ç½® ğŸ›¡ï¸ å››ã€å®‰å…¨æœ€ä½³å®è·µ ğŸ” äº”ã€æ•…éšœæ’é™¤ ğŸ’¡ å…­ã€é«˜çº§ç”¨æ³• ğŸ“š ä¸ƒã€å¸¸ç”¨ SSH å‘½ä»¤å‚è€ƒ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Windows ç³»ç»Ÿä¸Šåˆ›å»º SSH å¯†é’¥å¯¹ï¼Œå¹¶å°†å…¶é…ç½®åˆ° FnOS æœåŠ¡å™¨ï¼Œå®ç°å®‰å…¨çš„æ— å¯†ç ç™»å½•ã€‚\nâœ¨ ä¸»è¦ä¼˜åŠ¿ï¼š âœ… æé«˜æœåŠ¡å™¨å®‰å…¨æ€§ âœ… å…å»æ¯æ¬¡ç™»å½•è¾“å…¥å¯†ç çš„éº»çƒ¦ âœ… æ”¯æŒè‡ªåŠ¨åŒ–è„šæœ¬å’Œå·¥å…· âœ… ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ ğŸš€ ä¸€ã€åœ¨ Windows ä¸Šåˆ›å»º SSH å¯†é’¥å¯¹ 1. æ‰“å¼€ Git Bash ç»ˆç«¯ åœ¨ Windows ä¸Šå®‰è£… Git åï¼Œå³é”®ç‚¹å‡»ä»»æ„ä½ç½®ï¼Œé€‰æ‹© \u0026ldquo;Git Bash Here\u0026rdquo; æ‰“å¼€ç»ˆç«¯\n2. ç”Ÿæˆ SSH å¯†é’¥å¯¹ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆåä¸º FnOS_SSH çš„ RSA å¯†é’¥å¯¹ï¼š\n1 ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f ~/.ssh/FnOS_SSH å‚æ•°è¯´æ˜ï¼š\n-t rsa: æŒ‡å®šå¯†é’¥ç±»å‹ä¸º RSA -b 4096: æŒ‡å®šå¯†é’¥é•¿åº¦ä¸º 4096 ä½ï¼ˆæ›´å®‰å…¨ï¼‰ -C \u0026quot;your_email@example.com\u0026quot;: æ·»åŠ æ³¨é‡Šï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„é‚®ç®±ï¼‰ -f ~/.ssh/FnOS_SSH: æŒ‡å®šå¯†é’¥æ–‡ä»¶åç§°å’Œè·¯å¾„ 3. æŸ¥çœ‹å…¬é’¥å†…å®¹ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å…¬é’¥å†…å®¹ï¼š\n1 cat ~/.ssh/FnOS_SSH.pub å¤åˆ¶è¾“å‡ºçš„å…¨éƒ¨å†…å®¹ï¼ˆä»¥ ssh-rsa å¼€å¤´çš„é•¿å­—ç¬¦ä¸²ï¼‰\nğŸ”§ äºŒã€åœ¨ FnOS æœåŠ¡å™¨ä¸Šé…ç½® SSH å¯†é’¥ 1. ä½¿ç”¨å¯†ç ç™»å½• FnOS æœåŠ¡å™¨ï¼š 1 ssh root@10.10.10.251 2. åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæˆ–ç¼–è¾‘ authorized_keys æ–‡ä»¶ï¼š 1 2 3 mkdir -p ~/.ssh chmod 700 ~/.ssh nano ~/.ssh/authorized_keys å°†ä¹‹å‰å¤åˆ¶çš„å…¬é’¥å†…å®¹ç²˜è´´åˆ°æ–‡ä»¶ä¸­\næŒ‰ Ctrl+Xï¼Œç„¶åæŒ‰ Y ä¿å­˜ï¼Œå†æŒ‰ Enter ç¡®è®¤\n3. è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ï¼š 1 chmod 600 ~/.ssh/authorized_keys 4. é€€å‡ºæœåŠ¡å™¨ï¼š 1 exit âœ… ä¸‰ã€éªŒè¯ SSH å¯†é’¥é…ç½® 1. ä½¿ç”¨ SSH å¯†é’¥ç™»å½• FnOS æœåŠ¡å™¨ï¼š 1 ssh -i ~/.ssh/FnOS_SSH root@10.10.10.251 å¦‚æœæ— éœ€è¾“å…¥å¯†ç ç›´æ¥ç™»å½•ï¼Œåˆ™é…ç½®æˆåŠŸ\n2. ç®€åŒ– SSH ç™»å½•å‘½ä»¤ï¼ˆå¯é€‰ï¼‰ ç¼–è¾‘ SSH é…ç½®æ–‡ä»¶ï¼š\n1 nano ~/.ssh/config æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 # FnOS_SSH é…ç½® Host fnos HostName 10.10.10.251 User root IdentityFile ~/.ssh/FnOS_SSH ServerAliveInterval 60 ServerAliveCountMax 5 3. ä¿å­˜åï¼Œå¯ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç™»å½•ï¼š 1 ssh fnos ğŸ›¡ï¸ å››ã€å®‰å…¨æœ€ä½³å®è·µ 1. ä¿æŠ¤ç§é’¥æ–‡ä»¶ 1 2 # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chmod 600 ~/.ssh/FnOS_SSH 2. ä½¿ç”¨å¯†ç ä¿æŠ¤ç§é’¥ï¼ˆå¯é€‰ï¼‰ å¦‚æœæ‚¨åœ¨ç”Ÿæˆå¯†é’¥æ—¶æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ ï¼š\n1 ssh-keygen -p -f ~/.ssh/FnOS_SSH 3. å¤‡ä»½å¯†é’¥å¯¹ å°† ~/.ssh/FnOS_SSH å’Œ ~/.ssh/FnOS_SSH.pub æ–‡ä»¶å¤‡ä»½åˆ°å®‰å…¨çš„ä½ç½®\n4. å¤šæœåŠ¡å™¨é…ç½® å¦‚æœæ‚¨æœ‰å¤šä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡å™¨åˆ›å»ºä¸åŒçš„å¯†é’¥å¯¹ï¼š\n1 ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f ~/.ssh/Server2_SSH ğŸ” äº”ã€æ•…éšœæ’é™¤ 1. æƒé™é—®é¢˜ å¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š\n1 2 3 4 # åœ¨ Windows Git Bash ä¸­ chmod 700 ~/.ssh chmod 600 ~/.ssh/FnOS_SSH chmod 644 ~/.ssh/FnOS_SSH.pub 2. è¿æ¥è¢«æ‹’ç» ç¡®ä¿ FnOS æœåŠ¡å™¨ä¸Šçš„ SSH æœåŠ¡æ­£åœ¨è¿è¡Œï¼š\n1 2 # åœ¨ FnOS æœåŠ¡å™¨ä¸Š systemctl status sshd 3. è®¤è¯å¤±è´¥ æ£€æŸ¥å…¬é’¥æ˜¯å¦æ­£ç¡®æ·»åŠ åˆ°æœåŠ¡å™¨çš„ authorized_keys æ–‡ä»¶ä¸­ï¼š\n1 2 # åœ¨ FnOS æœåŠ¡å™¨ä¸Š cat ~/.ssh/authorized_keys ğŸ’¡ å…­ã€é«˜çº§ç”¨æ³• 1. ä½¿ç”¨ SSH ä»£ç†ç®¡ç†å¯†é’¥ 1 2 3 4 5 # å¯åŠ¨ SSH ä»£ç† eval \u0026#34;$(ssh-agent -s)\u0026#34; # æ·»åŠ ç§é’¥åˆ°ä»£ç† ssh-add ~/.ssh/FnOS_SSH 2. ç«¯å£è½¬å‘ é€šè¿‡ SSH å»ºç«‹å®‰å…¨éš§é“ï¼š\n1 2 3 4 5 # æœ¬åœ°ç«¯å£è½¬å‘ ssh -L 8080:localhost:80 fnos # è¿œç¨‹ç«¯å£è½¬å‘ ssh -R 9090:localhost:3000 fnos 3. SCP æ–‡ä»¶ä¼ è¾“ ä½¿ç”¨ SSH å¯†é’¥è¿›è¡Œå®‰å…¨æ–‡ä»¶ä¼ è¾“ï¼š\n1 2 3 4 5 # ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹ scp -i ~/.ssh/FnOS_SSH localfile.txt root@10.10.10.251:/path/to/destination/ # ä»è¿œç¨‹å¤åˆ¶åˆ°æœ¬åœ° scp -i ~/.ssh/FnOS_SSH root@10.10.10.251:/path/to/file.txt ./ 4. RSYNC åŒæ­¥æ–‡ä»¶ 1 2 3 4 5 # åŒæ­¥æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨ rsync -avz -e \u0026#34;ssh -i ~/.ssh/FnOS_SSH\u0026#34; /local/path/ root@10.10.10.251:/remote/path/ # ä»è¿œç¨‹æœåŠ¡å™¨åŒæ­¥åˆ°æœ¬åœ° rsync -avz -e \u0026#34;ssh -i ~/.ssh/FnOS_SSH\u0026#34; root@10.10.10.251:/remote/path/ /local/path/ ğŸ“š ä¸ƒã€å¸¸ç”¨ SSH å‘½ä»¤å‚è€ƒ å‘½ä»¤ è¯´æ˜ ssh-keygen -t rsa -b 4096 ç”Ÿæˆ RSA å¯†é’¥å¯¹ ssh-copy-id user@host è‡ªåŠ¨å¤åˆ¶å…¬é’¥åˆ°è¿œç¨‹ä¸»æœº ssh -i key.pem user@host ä½¿ç”¨ç‰¹å®šå¯†é’¥è¿æ¥ ssh -v user@host è¯¦ç»†æ¨¡å¼è¿æ¥ï¼ˆè°ƒè¯•ç”¨ï¼‰ ssh -p 2222 user@host æŒ‡å®šç«¯å£è¿æ¥ scp -i key file user@host:path å®‰å…¨æ–‡ä»¶ä¼ è¾“ rsync -avz -e ssh src dest ä½¿ç”¨ SSH åŒæ­¥æ–‡ä»¶ ssh -L local_port:remote_host:remote_port user@host æœ¬åœ°ç«¯å£è½¬å‘ ssh -R remote_port:local_host:local_port user@host è¿œç¨‹ç«¯å£è½¬å‘ ğŸ¯ æ€»ç»“ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»æˆåŠŸåˆ›å»ºå¹¶é…ç½®äº† SSH å¯†é’¥å¯¹ï¼Œå¯ä»¥å®ç°åˆ° FnOS æœåŠ¡å™¨çš„å®‰å…¨æ— å¯†ç ç™»å½•ã€‚è¿™ä¸ä»…æé«˜äº†å®‰å…¨æ€§ï¼Œè¿˜å¤§å¤§ç®€åŒ–äº†ç™»å½•è¿‡ç¨‹ï¼\nğŸ”‘ å…³é”®è¦ç‚¹ï¼š å¯†é’¥ç”Ÿæˆï¼šä½¿ç”¨ ssh-keygen åˆ›å»ºå®‰å…¨çš„ RSA å¯†é’¥å¯¹ æœåŠ¡å™¨é…ç½®ï¼šå°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨çš„ authorized_keys æ–‡ä»¶ä¸­ è¿æ¥æµ‹è¯•ï¼šä½¿ç”¨ ssh -i å‘½ä»¤éªŒè¯å¯†é’¥è®¤è¯ é…ç½®æ–‡ä»¶ï¼šåˆ›å»º SSH é…ç½®æ–‡ä»¶ç®€åŒ–è¿æ¥å‘½ä»¤ å®‰å…¨å®è·µï¼šä¿æŠ¤ç§é’¥æ–‡ä»¶å¹¶å®šæœŸå¤‡ä»½ ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®ï¼š ä¸ºä¸åŒçš„æœåŠ¡å™¨åˆ›å»ºä¸åŒçš„å¯†é’¥å¯¹ è®¾ç½® SSH ä»£ç†ç®¡ç†å¤šä¸ªå¯†é’¥ æ¢ç´¢ SSH ç«¯å£è½¬å‘å’Œéš§é“åŠŸèƒ½ é…ç½®è‡ªåŠ¨åŒ–è„šæœ¬ä½¿ç”¨ SSH å¯†é’¥è®¤è¯ ç°åœ¨æ‚¨å¯ä»¥äº«å—å®‰å…¨ã€ä¾¿æ·çš„ FnOS æœåŠ¡å™¨è®¿é—®ä½“éªŒäº†ï¼ğŸ‰\n","date":"2025-08-25T12:43:12+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/49c5c61e/","title":"Windows åˆ›å»º FnOS SSH å¯†é’¥å¯¹ ğŸ”‘"},{"content":"Docker éƒ¨ç½² TaoSync äº‘ç›˜åŒæ­¥å·¥å…· ğŸ”„ ğŸŒŸ ä¸€æ¬¾åŸºäº AList çš„è‡ªåŠ¨åŒæ­¥å·¥å…·ï¼Œæ”¯æŒå¤šç½‘ç›˜ä¸å­˜å‚¨è®¾å¤‡é—´çš„æ–‡ä»¶åŒæ­¥\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² TaoSync 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ TaoSync 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åˆå§‹è®¾ç½® âš™ï¸ 3. åŒæ­¥æ¨¡å¼ä»‹ç» ğŸ”„ 4. é«˜çº§åŠŸèƒ½ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåŒæ­¥ï¼Œæ•°æ®æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/dr34m-cn/taosync ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/dr34m/tao-sync TaoSync æ˜¯ä¸€æ¬¾åŸºäº Docker å’Œ AList çš„æ™ºèƒ½äº‘ç›˜åŒæ­¥å·¥å…·ï¼Œæä¾›ç®€å•é«˜æ•ˆçš„æ–‡ä»¶åŒæ­¥å’Œå¤‡ä»½è§£å†³æ–¹æ¡ˆã€‚å®ƒæ”¯æŒå¤šç§äº‘å­˜å‚¨æœåŠ¡ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨ä¸åŒè®¾å¤‡å’ŒæœåŠ¡ä¹‹é—´åŒæ­¥æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚ğŸ”„\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å¤šå¹³å°æ”¯æŒ æ”¯æŒç™¾åº¦ç½‘ç›˜ã€é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ã€115ç½‘ç›˜ã€123äº‘ç›˜ç­‰å¤šç§äº‘å­˜å‚¨æœåŠ¡ä¸å­˜å‚¨ï¼ˆFTP/SMBç­‰ï¼‰ ç»Ÿä¸€ç®¡ç†å¤šä¸ªç½‘ç›˜ï¼Œæ— éœ€åˆ‡æ¢ä¸åŒåº”ç”¨ ğŸ”„ æ™ºèƒ½åŒæ­¥ æ”¯æŒåŒå‘åŒæ­¥ã€å•å‘åŒæ­¥ç­‰å¤šç§åŒæ­¥æ¨¡å¼ çµæ´»é€‚åº”å¤‡ä»½ã€åŒæ­¥ç­‰ä¸åŒåœºæ™¯éœ€æ±‚ ğŸ”’ æ•°æ®å®‰å…¨ æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­åŠ å¯†ï¼Œä¿éšœéšç§å®‰å…¨ ä¿æŠ¤æ•æ„Ÿæ–‡ä»¶ï¼Œé˜²æ­¢æ•°æ®æ³„éœ² ğŸ–¥ï¸ å¯è§†åŒ–ç•Œé¢ ç›´è§‚æ˜“ç”¨çš„å›¾å½¢åŒ–æ“ä½œç•Œé¢ é™ä½ä½¿ç”¨é—¨æ§›ï¼Œæ“ä½œç®€å•æ–¹ä¾¿ âš¡ é«˜æ•ˆæ€§èƒ½ å¢é‡åŒæ­¥ï¼ŒåªåŒæ­¥å˜åŒ–éƒ¨åˆ† èŠ‚çœå¸¦å®½å’Œæ—¶é—´ï¼Œæé«˜åŒæ­¥æ•ˆç‡ ğŸ“Š å®æ—¶ç›‘æ§ è¯¦ç»†çš„åŒæ­¥æ—¥å¿—å’Œè¿›åº¦æ˜¾ç¤º å®æ—¶æŒæ¡åŒæ­¥çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°é—®é¢˜ â° ä»»åŠ¡è°ƒåº¦ æ”¯æŒå®šæ—¶åŒæ­¥å’Œå®æ—¶ç›‘æ§åŒæ­¥ è‡ªåŠ¨åŒ–æ“ä½œï¼Œå‡å°‘æ‰‹åŠ¨å¹²é¢„ ğŸ³ ä¸€ã€Docker éƒ¨ç½² TaoSync 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 mkdir -p /mnt/mydisk/home/taosync \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: tao-sync: restart: unless-stopped container_name: taosync image: dr34m/tao-sync:latest ports: - \u0026#34;8023:8023\u0026#34; volumes: - ./data:/app/data - ./config:/app/config - /mnt/data:/sync environment: - TZ=Asia/Shanghai - SYNC_INTERVAL=3600 - LOG_LEVEL=info EOF ğŸ’¡ æç¤º:\nå°† /mnt/data æ›¿æ¢ä¸ºæ‚¨å®é™…è¦åŒæ­¥çš„æœ¬åœ°ç›®å½•è·¯å¾„ å¦‚æœéœ€è¦åŒæ­¥å¤šä¸ªç›®å½•ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªå·æ˜ å°„ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ TaoSync 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8023 åŸŸåè®¿é—®: https://taosync.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åˆå§‹è®¾ç½® âš™ï¸ é¦–æ¬¡ä½¿ç”¨éœ€è¦è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š\nç³»ç»Ÿåˆå§‹åŒ–\næ‰“å¼€æµè§ˆå™¨è®¿é—®ç®¡ç†ç•Œé¢ æŒ‰ç…§å‘å¯¼å®Œæˆåˆå§‹è®¾ç½® è®¾ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç  é…ç½®å­˜å‚¨æœåŠ¡\nè¿›å…¥ã€Œå­˜å‚¨ç®¡ç†ã€é¡µé¢ æ·»åŠ éœ€è¦åŒæ­¥çš„äº‘å­˜å‚¨æœåŠ¡ï¼ˆé˜¿é‡Œäº‘ç›˜ã€ç™¾åº¦ç½‘ç›˜ç­‰ï¼‰ æŒ‰ç…§æŒ‡å¼•å®Œæˆ OAuth è®¤è¯æˆ–è´¦å·ç™»å½• åˆ›å»ºåŒæ­¥ä»»åŠ¡\nè¿›å…¥ã€ŒåŒæ­¥ä»»åŠ¡ã€é¡µé¢ ç‚¹å‡»ã€Œæ–°å»ºä»»åŠ¡ã€ é…ç½®æºç›®å½•å’Œç›®æ ‡ç›®å½• è®¾ç½®åŒæ­¥æ–¹å‘å’Œç­–ç•¥ 3. åŒæ­¥æ¨¡å¼ä»‹ç» ğŸ”„ TaoSync æ”¯æŒå¤šç§åŒæ­¥æ¨¡å¼ï¼š\nåŒæ­¥æ¨¡å¼ è¯´æ˜ é€‚ç”¨åœºæ™¯ åŒå‘åŒæ­¥ ä¸¤ç«¯æ–‡ä»¶å˜åŒ–éƒ½ä¼šåŒæ­¥åˆ°å¦ä¸€ç«¯ å¤šè®¾å¤‡æ–‡ä»¶åŒæ­¥ å•å‘åŒæ­¥ ä»…ä»æºç›®å½•åŒæ­¥åˆ°ç›®æ ‡ç›®å½• æ•°æ®å¤‡ä»½ é•œåƒåŒæ­¥ ä½¿ç›®æ ‡ç›®å½•ä¸æºç›®å½•å®Œå…¨ä¸€è‡´ ç‰ˆæœ¬å‘å¸ƒ 4. é«˜çº§åŠŸèƒ½ ğŸ¯ â° å®šæ—¶åŒæ­¥: è®¾ç½®å›ºå®šæ—¶é—´è‡ªåŠ¨æ‰§è¡ŒåŒæ­¥ ğŸ” å®æ—¶ç›‘æ§: ç›‘æ§æ–‡ä»¶å˜åŒ–å¹¶å®æ—¶åŒæ­¥ ğŸ“Š ä»»åŠ¡è°ƒåº¦: å¤šä¸ªä»»åŠ¡æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œ ğŸ“‹ åŒæ­¥æŠ¥å‘Š: ç”Ÿæˆè¯¦ç»†çš„åŒæ­¥ç»“æœæŠ¥å‘Š ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://taosync.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/taosync.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name taosync.example.com; # ğŸŒ æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/ssl/certs/taosync.crt; ssl_certificate_key /etc/ssl/private/taosync.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=63072000\u0026#34; always; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ï¼ˆæ ¹æ®éœ€è¦è°ƒæ•´ï¼‰ client_max_body_size 10G; # ä»£ç†é…ç½® location / { proxy_pass http://localhost:8023; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/taosync # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop taosync # åœæ­¢å®¹å™¨ docker start taosync # å¯åŠ¨å®¹å™¨ docker restart taosync # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm taosync # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f taosync # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it taosync sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it taosync bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect taosync # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats taosync # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs taosync # æŸ¥çœ‹æ—¥å¿— docker logs -f taosync # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 taosync # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t taosync # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªåŒæ­¥ï¼Œæ•°æ®æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† TaoSync äº‘ç›˜åŒæ­¥å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ”„ æ™ºèƒ½åŒæ­¥ è½»æ¾ç®¡ç†å¤šä¸ªäº‘å­˜å‚¨æœåŠ¡é—´çš„æ–‡ä»¶åŒæ­¥ï¼Œå®ç°æ•°æ®æ— ç¼æµè½¬\nğŸŒ å¤šç«¯äº’è” è¿æ¥å„ç±»ç½‘ç›˜å’Œæœ¬åœ°å­˜å‚¨ï¼Œæ„å»ºç»Ÿä¸€çš„æ–‡ä»¶ç®¡ç†ç”Ÿæ€\nâš¡ é«˜æ•ˆå¤‡ä»½ è‡ªåŠ¨åŒ–åŒæ­¥ä»»åŠ¡ç¡®ä¿é‡è¦æ•°æ®å®‰å…¨æ— å¿§ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤±\nåŒæ­¥ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•°æ®æµåŠ¨å…±èˆçš„æ•°å­—æ—…ç¨‹ã€‚æ„¿ TaoSync æˆä¸ºä½ å¯é çš„åŒæ­¥ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æ•°æ®è¿ç§»å’Œæ–‡ä»¶ç®¡ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ™ºèƒ½åŒæ­¥ï¼Œæ•°æ®æ— å¿§â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„æ–‡ä»¶ç®¡ç†ç”Ÿæ€å§ï¼ğŸ“\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ TaoSync å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ åŒæ­¥é¡ºåˆ©ï¼Œæ•°æ®å®‰å…¨ï¼ğŸ‰\n","date":"2025-08-25T12:41:22+08:00","image":"https://file.meimolihan.eu.org/img/docker-taoSync-01.webp","permalink":"https://blog.meimolihan.eu.org/p/30ceeb4e/","title":"Docker éƒ¨ç½² TaoSync äº‘ç›˜åŒæ­¥å·¥å…· ğŸ”„"},{"content":"Docker éƒ¨ç½² Watchtower å®¹å™¨è‡ªåŠ¨æ›´æ–°å·¥å…· ğŸ”„ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Watchtower æ–¹æ¡ˆä¸€ï¼šæ›´æ–°æ‰€æœ‰å®¹å™¨ ğŸŒ æ–¹æ¡ˆäºŒï¼šæ›´æ–°æŒ‡å®šå®¹å™¨ ğŸ¯ ğŸš€ äºŒã€ä½¿ç”¨ Watchtower 1. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ ğŸ“Š 2. å®¹å™¨ç­›é€‰ç­–ç•¥ ğŸ” ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè‡ªåŠ¨åŒ–ï¼Œç»´æŠ¤æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/containrrr/watchtower ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/containrrr/watchtower Watchtower æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Docker å®¹å™¨è‡ªåŠ¨æ›´æ–°å·¥å…·ï¼Œèƒ½å¤Ÿç›‘æ§è¿è¡Œä¸­çš„å®¹å™¨å¹¶åœ¨æ£€æµ‹åˆ°åŸºç¡€é•œåƒæ›´æ–°æ—¶è‡ªåŠ¨æ‹‰å–æ–°é•œåƒã€é‡å¯å®¹å™¨ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šè½»æ¾å®ç°å®¹å™¨åŒ–åº”ç”¨çš„è‡ªåŠ¨ç»´æŠ¤ï¼Œç¡®ä¿æœåŠ¡å§‹ç»ˆè¿è¡Œåœ¨æœ€æ–°ç‰ˆæœ¬ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”„ è‡ªåŠ¨æ£€æµ‹ å®šæœŸæ£€æŸ¥å®¹å™¨é•œåƒæ›´æ–° æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œè‡ªåŠ¨å‘ç°æ–°ç‰ˆæœ¬ âš¡ æ— ç¼æ›´æ–° æ‹‰å–æ–°é•œåƒå¹¶é‡å¯å®¹å™¨ æœåŠ¡æ›´æ–°è¿‡ç¨‹å¹³æ»‘ï¼Œå‡å°‘åœæœºæ—¶é—´ ğŸ—‘ï¸ èµ„æºæ¸…ç† å¯é€‰æ¸…ç†æ—§é•œåƒåŠŸèƒ½ é¿å…ç£ç›˜ç©ºé—´è¢«æ— ç”¨é•œåƒå ç”¨ â° çµæ´»è°ƒåº¦ æ”¯æŒè‡ªå®šä¹‰æ£€æŸ¥è®¡åˆ’ æ ¹æ®éœ€æ±‚è®¾ç½®æ›´æ–°é¢‘ç‡å’Œæ—¶é—´ ğŸ¯ ç²¾ç¡®æ§åˆ¶ æ”¯æŒå®¹å™¨ç­›é€‰æ›´æ–° å¯æ›´æ–°æ‰€æœ‰å®¹å™¨æˆ–ä»…æ›´æ–°æŒ‡å®šå®¹å™¨ ğŸ›¡ï¸ å®‰å…¨å¯é  ä¿æŒåŸæœ‰é…ç½®ä¸å˜ æ›´æ–°åå®¹å™¨é…ç½®ä¸æ›´æ–°å‰å®Œå…¨ä¸€è‡´ ğŸ“Š çŠ¶æ€ç›‘æ§ æä¾›è¯¦ç»†æ›´æ–°æ—¥å¿— æ¸…æ™°æŒæ¡å®¹å™¨æ›´æ–°å†å² ğŸ³ ä¸€ã€Docker éƒ¨ç½² Watchtower æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä»¬æä¾›ä¸¤ç§éƒ¨ç½²æ–¹æ¡ˆï¼šæ›´æ–°æ‰€æœ‰å®¹å™¨æˆ–ä»…æ›´æ–°æŒ‡å®šå®¹å™¨ã€‚\næ–¹æ¡ˆä¸€ï¼šæ›´æ–°æ‰€æœ‰å®¹å™¨ ğŸŒ æ­¤æ–¹æ¡ˆå°†ç›‘æ§å¹¶æ›´æ–°å®¿ä¸»æœºä¸Šæ‰€æœ‰è¿è¡Œçš„ Docker å®¹å™¨ï¼ˆé™¤éç‰¹åˆ«æ’é™¤ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ mkdir -p /mnt/mydisk/home/watchtower \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: watchtower: container_name: watchtower image: containrrr/watchtower:latest restart: always volumes: - /var/run/docker.sock:/var/run/docker.sock environment: - TZ=Asia/Shanghai # è®¾ç½®æ—¶åŒº - WATCHTOWER_CLEANUP=true # æ›´æ–°åæ¸…ç†æ—§é•œåƒ - WATCHTOWER_SCHEDULE=0 0 2 * * * # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œæ£€æŸ¥ - WATCHTOWER_DEBUG=false # å…³é—­è°ƒè¯•æ¨¡å¼ EOF # å¯åŠ¨å®¹å™¨ docker-compose up -d æ­¤é…ç½®çš„ä½œç”¨ï¼š\nç›‘æ§èŒƒå›´ï¼šé»˜è®¤ç›‘æ§å®¿ä¸»æœºä¸Šæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ å·¥ä½œé¢‘ç‡ï¼šæ¯å¤©åŒ—äº¬æ—¶é—´å‡Œæ™¨ 2:00:00 æ‰§è¡Œæ£€æŸ¥ å·¥ä½œå†…å®¹ï¼š æ£€æŸ¥æ¯ä¸ªå®¹å™¨å¯¹åº”çš„é•œåƒæ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ å‘ç°æ›´æ–°æ—¶è‡ªåŠ¨æ‹‰å–æ–°é•œåƒå¹¶é‡å¯å®¹å™¨ æ¸…ç†æ—§é•œåƒé‡Šæ”¾ç£ç›˜ç©ºé—´ æ–¹æ¡ˆäºŒï¼šæ›´æ–°æŒ‡å®šå®¹å™¨ ğŸ¯ æ­¤æ–¹æ¡ˆä»…ç›‘æ§å¹¶æ›´æ–°æ‚¨æ˜ç¡®æŒ‡å®šçš„å®¹å™¨ï¼Œå…¶ä»–å®¹å™¨å°†è¢«å¿½ç•¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ mkdir -p /mnt/mydisk/home/watchtower \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: watchtower: image: containrrr/watchtower:latest container_name: watchtower network_mode: bridge restart: always environment: - TZ=Asia/Shanghai volumes: - /var/run/docker.sock:/var/run/docker.sock command: \u0026gt; -s \u0026#34;0 0 2 * * *\u0026#34; --cleanup speedtest halo metube md openlist sun-panel sun-panel-helper xiaomusic 1panel EOF # å¯åŠ¨å®¹å™¨ docker-compose up -d æ­¤é…ç½®çš„ä½œç”¨ï¼š\nç›‘æ§èŒƒå›´ï¼šä»…ç›‘æ§æŒ‡å®šçš„9ä¸ªå®¹å™¨ï¼šspeedtest, halo, metube, md, openlist, sun-panel, sun-panel-helper, xiaomusic, 1panel å·¥ä½œé¢‘ç‡ï¼šæ¯å¤©åŒ—äº¬æ—¶é—´å‡Œæ™¨ 2:00:00 æ‰§è¡Œæ£€æŸ¥ å·¥ä½œå†…å®¹ï¼š æ£€æŸ¥æŒ‡å®šå®¹å™¨çš„é•œåƒæ˜¯å¦æœ‰æ–°ç‰ˆæœ¬ å‘ç°æ›´æ–°æ—¶è‡ªåŠ¨æ‹‰å–æ–°é•œåƒå¹¶é‡å¯å®¹å™¨ æ¸…ç†æ—§é•œåƒé‡Šæ”¾ç£ç›˜ç©ºé—´ é€‰æ‹©å»ºè®®ï¼š\nå¦‚æœæ‚¨å¸Œæœ›è‡ªåŠ¨åŒ–æ›´æ–°æ‰€æœ‰å®¹å™¨ï¼Œè¯·é€‰æ‹©æ–¹æ¡ˆä¸€ å¦‚æœæ‚¨åªæƒ³æ›´æ–°ç‰¹å®šå®¹å™¨ï¼Œé¿å…å…¶ä»–å®¹å™¨æ„å¤–æ›´æ–°ï¼Œè¯·é€‰æ‹©æ–¹æ¡ˆäºŒ ğŸš€ äºŒã€ä½¿ç”¨ Watchtower 1. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ ğŸ“Š Watchtower ä¸»è¦é€šè¿‡æ—¥å¿—è¾“å‡ºæä¾›ä¿¡æ¯ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹æ—¥å¿— docker logs watchtower # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs -f watchtower # æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡æ›´æ–°æ£€æŸ¥ ï¼ˆæ›´æ–°æ‰€æœ‰å®¹å™¨ï¼‰ docker exec watchtower /watchtower --run-once # æ‰‹åŠ¨æ›´æ–°æŒ‡å®šçš„å®¹å™¨ cd /vol1/1000/compose/watchtower \u0026amp;\u0026amp; \\ docker compose run --rm watchtower --run-once # æ¸…ç©ºæ—¥å¿—æ–‡ä»¶ sudo truncate -s 0 $(docker inspect --format=\u0026#39;{{.LogPath}}\u0026#39; watchtower) 2. å®¹å™¨ç­›é€‰ç­–ç•¥ ğŸ” é™¤äº†åœ¨å‘½ä»¤è¡ŒæŒ‡å®šå®¹å™¨å¤–ï¼ŒWatchtower è¿˜æ”¯æŒé€šè¿‡æ ‡ç­¾ç­›é€‰å®¹å™¨ï¼š\n1 2 3 4 5 6 7 # åœ¨å…¶ä»–å®¹å™¨çš„é…ç½®ä¸­æ·»åŠ ä»¥ä¸‹æ ‡ç­¾å¯æ’é™¤è¯¥å®¹å™¨ä¸è¢«Watchtoweræ›´æ–° labels: - \u0026#34;com.centurylinklabs.watchtower.enable=false\u0026#34; # æˆ–è€…æ˜ç¡®æŒ‡å®šéœ€è¦æ›´æ–°çš„å®¹å™¨ labels: - \u0026#34;com.centurylinklabs.watchtower.enable=true\u0026#34; ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/watchtower # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒå¹¶é‡å¯å®¹å™¨ docker-compose pull \u0026amp;\u0026amp; docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker stats \u0026lt;container_name\u0026gt; 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè‡ªåŠ¨åŒ–ï¼Œç»´æŠ¤æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Watchtower å®¹å™¨è‡ªåŠ¨æ›´æ–°å·¥å…·ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ”„ è‡ªåŠ¨æ›´æ–° æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°å®¹å™¨è‡³æœ€æ–°ç‰ˆæœ¬\nâ° å®šæ—¶ç»´æŠ¤ æ ¹æ®é¢„è®¾è®¡åˆ’æ™ºèƒ½æ‰§è¡Œæ›´æ–°ä»»åŠ¡ï¼Œç¡®ä¿æœåŠ¡æŒç»­ç¨³å®š\nğŸ¯ ç²¾ç¡®æ§åˆ¶ å¯é€‰æ‹©æ›´æ–°æ‰€æœ‰å®¹å™¨æˆ–ä»…æ›´æ–°æŒ‡å®šå®¹å™¨ï¼Œçµæ´»æ»¡è¶³ä¸åŒéœ€æ±‚\nğŸ›¡ï¸ å®‰å…¨å¯é  æ›´æ–°è¿‡ç¨‹ä¿æŒåŸæœ‰é…ç½®ä¸å˜ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§\nç»´æŠ¤ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æŠ€æœ¯è¿›æ­¥åŒè¡Œçš„è‡ªåŠ¨åŒ–æ—…ç¨‹ã€‚æ„¿ Watchtower æˆä¸ºä½ å¯é çš„è¿ç»´åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å®¹å™¨æ›´æ–°å’Œç»´æŠ¤çš„å…³é”®æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè‡ªåŠ¨åŒ–è¿ç»´ï¼Œçœå¿ƒçœåŠ›â€”â€”æ„å»ºä½ é«˜æ•ˆç¨³å®šçš„å®¹å™¨ç¯å¢ƒå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Watchtower å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è¿ç»´æ„‰å¿«ï¼Œæ›´æ–°æ— å¿§ï¼ğŸ‰\n","date":"2025-08-25T12:38:16+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8dbd8251/","title":"Docker éƒ¨ç½² Watchtower å®¹å™¨è‡ªåŠ¨æ›´æ–°å·¥å…· ğŸ”„"},{"content":"Docker éƒ¨ç½² Reubah å›¾ç‰‡æ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…· ğŸ–¼ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Reubah 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Reubah 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. æ–‡ä»¶è½¬æ¢åŠŸèƒ½ ğŸ”„ 3. ä½¿ç”¨æ­¥éª¤ ğŸ“‹ 4. æ‰¹é‡å¤„ç† ğŸ“¦ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè½¬æ¢ï¼Œåˆ›æ„æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/dendianugerah/reubah ğŸ± Gitee é¡¹ç›®åœ°å€ï¼š https://gitee.com/firfe/reubah-web_zh-cn Reubah æ˜¯ä¸€æ¬¾åŸºäºæµè§ˆå™¨çš„å›¾ç‰‡æ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„æ–‡ä»¶æ ¼å¼è½¬æ¢æœåŠ¡ã€‚è¿™æ¬¾å·¥å…·æœ€åˆæ˜¯è‹±æ–‡ç‰ˆæœ¬ï¼Œç°åœ¨å·²ç»è¿›è¡Œäº†æ±‰åŒ–å¤„ç†ï¼Œä¸ºä¸­æ–‡ç”¨æˆ·æä¾›äº†æ›´å¥½çš„ä½¿ç”¨ä½“éªŒã€‚âœ¨Reubah çš„è®¾è®¡ç†å¿µæ˜¯è®©æ–‡ä»¶æ ¼å¼è½¬æ¢å˜å¾—ç®€å•é«˜æ•ˆï¼ŒåŒæ—¶ä¿æŠ¤ç”¨æˆ·éšç§ã€‚ä¸è®¸å¤šåœ¨çº¿è½¬æ¢å·¥å…·ä¸åŒï¼ŒReubah å¯ä»¥åœ¨æœ¬åœ°éƒ¨ç½²ï¼Œç¡®ä¿æ‚¨çš„æ–‡ä»¶ä¸ä¼šä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œæä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ–¼ï¸ å¤šæ ¼å¼å›¾ç‰‡è½¬æ¢ æ”¯æŒ JPG, PNG, WEBP, GIF, BMP, SVG, ICO, TIFF ç­‰å¤šç§å›¾ç‰‡æ ¼å¼äº’è½¬ ä¸€ç«™å¼è§£å†³æ‰€æœ‰å›¾ç‰‡æ ¼å¼è½¬æ¢éœ€æ±‚ ğŸ“„ æ–‡æ¡£æ ¼å¼è½¬æ¢ æ”¯æŒ PDF, Word, PowerPoint, Excel ç­‰å¤šç§æ–‡æ¡£æ ¼å¼è½¬æ¢ åŠå…¬æ–‡æ¡£é«˜æ•ˆè½¬æ¢ï¼Œæå‡å·¥ä½œæ•ˆç‡ ğŸŒ æœ¬åœ°åŒ–å¤„ç† çº¯æµè§ˆå™¨ç«¯å¤„ç†ï¼Œæ–‡ä»¶ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ ä¿æŠ¤éšç§å®‰å…¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ² ğŸ¨ é«˜è´¨é‡è½¬æ¢ ä¿æŒåŸå§‹æ–‡ä»¶è´¨é‡ï¼Œæä¾›å¯è°ƒèŠ‚çš„è¾“å‡ºå‚æ•° ç¡®ä¿è½¬æ¢åæ–‡ä»¶è´¨é‡ä¸å—æŸå¤± âš¡ å¿«é€Ÿè½¬æ¢ é«˜æ•ˆçš„è½¬æ¢ç®—æ³•ï¼Œç¡®ä¿å¿«é€Ÿå®Œæˆè½¬æ¢ä»»åŠ¡ èŠ‚çœæ—¶é—´ï¼Œæé«˜å·¥ä½œæ•ˆç‡ ğŸ“± å“åº”å¼è®¾è®¡ å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ï¼Œéšæ—¶éšåœ°ä½¿ç”¨ è·¨è®¾å¤‡ä½¿ç”¨ï¼Œçµæ´»æ–¹ä¾¿ ğŸ”„ æ‰¹é‡å¤„ç† æ”¯æŒå¤šä¸ªæ–‡ä»¶åŒæ—¶è½¬æ¢ï¼Œæé«˜å·¥ä½œæ•ˆç‡ æ‰¹é‡å¤„ç†å¤§é‡æ–‡ä»¶ï¼ŒèŠ‚çœæ—¶é—´ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² åŸºäº Docker çš„ä¸€é”®éƒ¨ç½²ï¼Œç®€å•æ˜“ç”¨ å¿«é€Ÿéƒ¨ç½²ï¼Œç¯å¢ƒéš”ç¦»ï¼Œæ˜“äºç»´æŠ¤ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Reubah 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 mkdir -p /mnt/mydisk/home/reubah \u0026amp;\u0026amp; cd /mnt/mydisk/home/reubah cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; version: \u0026#39;3.8\u0026#39; services: reubah: container_name: reubah image: swr.cn-north-4.myhuaweicloud.com/firfe/reubah:2025.06.11 network_mode: bridge restart: always logging: options: max-size: 1m # ğŸ“ æ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å° max-file: \u0026#34;1\u0026#34; # ğŸ”¢ ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡ ports: - \u0026#34;8681:8081\u0026#34; # ğŸ”Œ ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ volumes: - ./doc-temp:/tmp # ğŸ’¾ ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½• environment: - PUID=1000 # ğŸ‘¤ ç”¨æˆ·ID - PGID=1000 # ğŸ‘¥ ç»„ID - TZ=Asia/Shanghai # ğŸ• æ—¶åŒºè®¾ç½® EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Reubah 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8681 åŸŸåè®¿é—®: https://reubah.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. æ–‡ä»¶è½¬æ¢åŠŸèƒ½ ğŸ”„ Reubah æ”¯æŒå¤šç§æ ¼å¼è½¬æ¢ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦åŠŸèƒ½ï¼š\nå›¾ç‰‡æ ¼å¼è½¬æ¢ ğŸ–¼ï¸:\nJPG â‡„ PNG â‡„ WEBP â‡„ GIF â‡„ BMP â‡„ SVG â‡„ ICO â‡„ TIFF æ–‡æ¡£æ ¼å¼è½¬æ¢ ğŸ“„:\nPDF â‡„ Word (DOC/DOCX) PDF â‡„ PowerPoint (PPT/PPTX) PDF â‡„ Excel (XLS/XLSX) æ–‡æœ¬æ–‡ä»¶æ ¼å¼è½¬æ¢ (TXT, RTF ç­‰) 3. ä½¿ç”¨æ­¥éª¤ ğŸ“‹ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ç‚¹å‡»ä¸Šä¼ æŒ‰é’®é€‰æ‹©è¦è½¬æ¢çš„æ–‡ä»¶ é€‰æ‹©ç›®æ ‡è¾“å‡ºæ ¼å¼å’Œè´¨é‡å‚æ•° ç‚¹å‡»è½¬æ¢æŒ‰é’®å¼€å§‹å¤„ç† è½¬æ¢å®Œæˆåä¸‹è½½ç»“æœæ–‡ä»¶ 4. æ‰¹é‡å¤„ç† ğŸ“¦ å¤šæ–‡ä»¶åŒæ—¶å¤„ç† ğŸš€ - æ”¯æŒä¸€æ¬¡æ€§ä¸Šä¼ å¤šä¸ªæ–‡ä»¶è¿›è¡Œè½¬æ¢ ç»Ÿä¸€è®¾ç½® ğŸ¯ - å¯ä»¥å¯¹æ‰€æœ‰æ–‡ä»¶åº”ç”¨ç›¸åŒçš„è¾“å‡ºè®¾ç½® æ‰¹é‡ä¸‹è½½ ğŸ“¥ - æ”¯æŒä¸€é”®ä¸‹è½½æ‰€æœ‰è½¬æ¢åçš„æ–‡ä»¶ æ ¼å¼ä¸€è‡´æ€§ ğŸ”„ - ç¡®ä¿æ‰€æœ‰è¾“å‡ºæ–‡ä»¶æ ¼å¼ç»Ÿä¸€ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://reubah.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/reubah.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name reubah.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubDomains; preload\u0026#34;; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://localhost:8681; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/reubah # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop reubah # åœæ­¢å®¹å™¨ docker start reubah # å¯åŠ¨å®¹å™¨ docker restart reubah # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm reubah # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f reubah # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it reubah sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it reubah bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect reubah # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats reubah # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs reubah # æŸ¥çœ‹æ—¥å¿— docker logs -f reubah # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 reubah # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t reubah # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè½¬æ¢ï¼Œåˆ›æ„æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Reubah å›¾ç‰‡æ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ–¼ï¸ æ— ç¼è½¬æ¢ è½»æ¾å¤„ç†å„ç§å›¾ç‰‡å’Œæ–‡æ¡£æ ¼å¼ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„ä½¿ç”¨éœ€æ±‚\nğŸ”’ éšç§å®‰å…¨ æœ¬åœ°åŒ–å¤„ç†ç¡®ä¿æ–‡ä»¶ä¸ä¸Šä¼ ç¬¬ä¸‰æ–¹ï¼Œä¿æŠ¤é‡è¦æ•°æ®å®‰å…¨\nâš¡ é«˜æ•ˆä¾¿æ· æ‰¹é‡å¤„ç†å’Œå¿«é€Ÿè½¬æ¢å¤§å¹…æå‡å·¥ä½œæ•ˆç‡ï¼ŒèŠ‚çœå®è´µæ—¶é—´\nè½¬æ¢ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ ¼å¼å…¼å®¹å…±èˆçš„æŠ€æœ¯è‰ºæœ¯ã€‚æ„¿ Reubah æˆä¸ºä½ å¾—åŠ›çš„æ ¼å¼è½¬æ¢åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æ–‡ä»¶å¤„ç†å’Œæ ¼å¼è½¬æ¢çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒè½¬æ¢ï¼Œåˆ›æ„æ— é™â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„æ–‡ä»¶å¤„ç†å·¥ä½œæµå§ï¼ğŸ¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Reubah å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è½¬æ¢æ„‰å¿«ï¼Œå·¥ä½œé«˜æ•ˆï¼ğŸ‰\n","date":"2025-08-25T12:36:29+08:00","image":"https://file.meimolihan.eu.org/img/docker-reubah-01.webp","permalink":"https://blog.meimolihan.eu.org/p/650202af/","title":"Docker éƒ¨ç½² Reubah å›¾ç‰‡æ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…· ğŸ–¼ï¸"},{"content":"Docker éƒ¨ç½² OpenList ç½‘ç›˜æŒ‚è½½å·¥å…· ğŸ“â˜ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² OpenList 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ OpenList 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå­˜å‚¨ï¼Œç®¡ç†æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ OpenList å®˜ç½‘åœ°å€ï¼š https://doc.openlist.team/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/OpenListTeam/OpenList ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/openlistteam/openlist OpenList æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘ç›˜æŒ‚è½½å’Œç®¡ç†å·¥å…·ï¼Œæ”¯æŒå°†å¤šç§äº‘å­˜å‚¨æœåŠ¡ï¼ˆå¦‚æœ¬åœ°ç£ç›˜ã€WebDAVã€SFTPã€S3ã€OneDriveã€Google Driveã€ç™¾åº¦ç½‘ç›˜ç­‰ï¼‰ç»Ÿä¸€æŒ‚è½½åˆ°ä¸€ä¸ªWebç•Œé¢ä¸­ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ OpenListï¼Œå®ç°å¤šå­˜å‚¨æœåŠ¡çš„é›†ä¸­ç®¡ç†å’Œä¾¿æ·è®¿é—®ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å¤šå­˜å‚¨æ”¯æŒ æ”¯æŒ30+ç§å­˜å‚¨é©±åŠ¨ ç»Ÿä¸€ç®¡ç†å„ç±»äº‘å­˜å‚¨å’Œæœ¬åœ°å­˜å‚¨ ğŸ“ æ–‡ä»¶ç®¡ç† å®Œæ•´çš„æ–‡ä»¶æ“ä½œåŠŸèƒ½ ä¸Šä¼ ã€ä¸‹è½½ã€é‡å‘½åã€ç§»åŠ¨ã€å¤åˆ¶ã€åˆ é™¤ ğŸ¬ åª’ä½“é¢„è§ˆ åœ¨çº¿é¢„è§ˆå¤šç§åª’ä½“æ ¼å¼ æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡æ¡£ç­‰ ğŸ”— åˆ†äº«åŠŸèƒ½ ç”Ÿæˆåˆ†äº«é“¾æ¥å’ŒäºŒç»´ç  æ–¹ä¾¿å¿«æ·åœ°åˆ†äº«æ–‡ä»¶ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ æ”¯æŒå¤šç”¨æˆ·å’Œæƒé™ç®¡ç† é€‚åˆå›¢é˜Ÿåä½œä½¿ç”¨ ğŸ“± å“åº”å¼è®¾è®¡ é€‚é…å„ç§è®¾å¤‡å±å¹• åœ¨æ‰‹æœºã€å¹³æ¿å’Œç”µè„‘ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ âš¡ é«˜æ€§èƒ½ ä¼˜åŒ–çš„å‰ç«¯å’Œåç«¯ å¿«é€ŸåŠ è½½å’Œå“åº” ğŸ”’ å®‰å…¨å¯é  æ”¯æŒHTTPSå’Œæƒé™æ§åˆ¶ ä¿éšœæ•°æ®å®‰å…¨å’Œéšç§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² OpenList 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 mkdir -p /mnt/mydisk/home/openlist \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: openlist: container_name: openlist image: openlistteam/openlist:latest restart: always ports: - \u0026#34;5244:5244\u0026#34; volumes: - ./config:/opt/openlist/data # é…ç½®æŒä¹…åŒ– - /mnt/mydisk:/mnt/mydisk # æŒ‚è½½æœ¬åœ°ç£ç›˜ï¼ˆæŒ‰éœ€è°ƒæ•´ï¼‰ environment: - TZ=Asia/Shanghai # è®¾ç½®æ—¶åŒº - PUID=1000 - PGID=1000 - UMASK=022 EOF âš ï¸ å®‰å…¨æç¤ºï¼šé¦–æ¬¡å¯åŠ¨åï¼Œè¯·ç«‹å³è®¾ç½®ç®¡ç†å‘˜å¯†ç ï¼š\n1 docker exec -it openlist ./openlist admin set YOUR_SECURE_PASSWORD 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ OpenList 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:5244 åŸŸåè®¿é—®ï¼š https://openlist.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨è®¾ç½®çš„ç®¡ç†å‘˜å¯†ç ç™»å½• è¿›å…¥\u0026quot;å­˜å‚¨\u0026quot;é¡µé¢ï¼Œæ·»åŠ æ‰€éœ€çš„å­˜å‚¨é©±åŠ¨ é…ç½®å­˜å‚¨é©±åŠ¨å‚æ•°å¹¶ä¿å­˜ å¼€å§‹æµè§ˆå’Œç®¡ç†æ–‡ä»¶ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://openlist.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/openlist.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name openlist.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 1024M; location / { proxy_pass http://127.0.0.1:5244; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå­˜å‚¨ï¼Œç®¡ç†æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† OpenList ç½‘ç›˜æŒ‚è½½å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ ç»Ÿä¸€ç®¡ç† è½»æ¾èšåˆå¤šä¸ªäº‘å­˜å‚¨æœåŠ¡ï¼Œå®ç°ä¸€ç«™å¼æ–‡ä»¶è®¿é—®å’Œç®¡ç†\nğŸ“ ä¾¿æ·æ“ä½œ äº«å—å®Œæ•´çš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼Œä¸Šä¼ ä¸‹è½½ã€åˆ†äº«é¢„è§ˆä¸€åº”ä¿±å…¨\nğŸ”’ å®‰å…¨å¯é  æœ¬åœ°åŒ–éƒ¨ç½²ä¿éšœæ•°æ®éšç§ï¼Œç»†ç²’åº¦æƒé™æ§åˆ¶ç¡®ä¿è®¿é—®å®‰å…¨\nå­˜å‚¨ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•°æ®å…±èˆçš„ä¾¿æ·æ—…ç¨‹ã€‚æ„¿ OpenList æˆä¸ºä½ å¯é çš„å­˜å‚¨ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æ–‡ä»¶ç®¡ç†å’Œå¤šäº‘åä½œçš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç»Ÿä¸€å­˜å‚¨ï¼Œæ™ºèƒ½ç®¡ç†â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„æ–‡ä»¶è®¿é—®ç”Ÿæ€å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ OpenList å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼Œç®¡ç†æœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T12:35:21+08:00","image":"https://file.meimolihan.eu.org/img/docker-openlist-01.webp","permalink":"https://blog.meimolihan.eu.org/p/bc5da4f6/","title":"Docker éƒ¨ç½² OpenList ç½‘ç›˜æŒ‚è½½å·¥å…· ğŸ“â˜ï¸"},{"content":"Docker éƒ¨ç½² Nginx-File æ–‡ä»¶æœåŠ¡å™¨ ğŸ“ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nginx-File 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Nginx-File 1. è®¿é—® Web ç•Œé¢ ğŸŒ 2. æ–‡ä»¶ç®¡ç†åŠŸèƒ½ ğŸ“ 3. æƒé™ç®¡ç† ğŸ” ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ–‡ä»¶ï¼Œå…±äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/wukongdaily/index Nginx-File æ˜¯ä¸€ä¸ªåŸºäº Docker çš„è½»é‡çº§æ–‡ä»¶æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ Nginx ä½œä¸ºæ–‡ä»¶æœåŠ¡å¼•æ“ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€å•ã€é«˜æ•ˆçš„æ–¹å¼æ¥é€šè¿‡ Web ç•Œé¢è®¿é—®å’Œå…±äº«æ–‡ä»¶ï¼Œæ”¯æŒç›®å½•æµè§ˆã€æ–‡ä»¶ä¸‹è½½å’ŒåŸºæœ¬çš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ Web æ–‡ä»¶è®¿é—® é€šè¿‡æµè§ˆå™¨ç›´æ¥è®¿é—®å’Œä¸‹è½½æ–‡ä»¶ æ— éœ€é¢å¤–å®¢æˆ·ç«¯ï¼Œä¾¿æ·è®¿é—® ğŸ“ ç›®å½•æµè§ˆ è‡ªåŠ¨ç”Ÿæˆç›®å½•ç´¢å¼•ï¼Œæ–¹ä¾¿æ–‡ä»¶å¯¼èˆª ç›´è§‚çš„æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ ğŸ”’ å®‰å…¨è®¿é—® æ”¯æŒ HTTPS åŠ å¯†ä¼ è¾“ ä¿éšœæ•°æ®ä¼ è¾“å®‰å…¨ âš¡ é«˜æ€§èƒ½ åŸºäº Nginx çš„é«˜æ•ˆé™æ€æ–‡ä»¶æœåŠ¡ å¿«é€Ÿå“åº”å’Œä¼ è¾“ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² ä¸€é”®éƒ¨ç½²ï¼Œç®€å•æ˜“ç”¨ å¿«é€Ÿæ­å»ºå’Œè¿ç§» ğŸ“Š å¤§æ–‡ä»¶æ”¯æŒ ä¼˜åŒ–å¤§æ–‡ä»¶ä¸‹è½½å’Œä¼ è¾“ æ”¯æŒå¤§å‹æ–‡ä»¶å…±äº« ğŸ”§ çµæ´»é…ç½® æ”¯æŒè‡ªå®šä¹‰ Nginx é…ç½® é«˜åº¦å¯å®šåˆ¶åŒ– ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nginx-File 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 mkdir -p /mnt/mydisk/home/nginx-file \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: nginx-file: image: nginx:alpine-slim container_name: nginx-file network_mode: bridge restart: unless-stopped ports: - \u0026#34;18080:80\u0026#34; # ğŸŒ ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® volumes: - ./data:/usr/share/nginx/html # ğŸ“‚ é»˜è®¤æ•°æ®ç›®å½• - ./nginx.conf:/etc/nginx/nginx.conf:ro # âš™ï¸ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ - /mnt/mydisk/é˜¿é‡Œäº‘ç›˜:/usr/share/nginx/html/é˜¿é‡Œäº‘ç›˜ # â˜ï¸ é˜¿é‡Œäº‘ç›˜ç›®å½• - /mnt/mydisk/downloads:/usr/share/nginx/html/downloads # ğŸ“¥ ä¸‹è½½ç›®å½• - /mnt/mydisk/file:/usr/share/nginx/html/file # ğŸ“„ æ–‡ä»¶ç›®å½• - /mnt/mydisk/media:/usr/share/nginx/html/media # ğŸµ åª’ä½“ç›®å½• - /mnt/mydisk/backup:/usr/share/nginx/html/backup # ğŸ’¾ å¤‡ä»½ç›®å½• command: [nginx, \u0026#39;-g\u0026#39;, \u0026#39;daemon off;\u0026#39;] # ğŸš€ å¯åŠ¨å‘½ä»¤ EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Nginx-File 1. è®¿é—® Web ç•Œé¢ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®æ–‡ä»¶æœåŠ¡å™¨:\næœ¬åœ°è®¿é—®: http://localhost:18080 åŸŸåè®¿é—®: https://nginx-file.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. æ–‡ä»¶ç®¡ç†åŠŸèƒ½ ğŸ“ åŠŸèƒ½ æ“ä½œæ–¹å¼ è¯´æ˜ ğŸ“ ç›®å½•æµè§ˆ è‡ªåŠ¨ç”Ÿæˆç›®å½•ç´¢å¼•é¡µé¢ æ˜¾ç¤ºæ–‡ä»¶å¤§å°å’Œä¿®æ”¹æ—¶é—´ï¼Œæ”¯æŒæ–‡ä»¶æ’åº ğŸ“¥ æ–‡ä»¶ä¸‹è½½ ç›´æ¥ç‚¹å‡»æ–‡ä»¶è¿›è¡Œä¸‹è½½ æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¤§æ–‡ä»¶ä¸‹è½½ä¼˜åŒ– ğŸ“¤ æ–‡ä»¶ä¸Šä¼  é€šè¿‡ WebDAV æˆ– FTP å®¢æˆ·ç«¯ æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼ˆéœ€é…ç½®ç›¸åº”åŠŸèƒ½ï¼‰ 3. æƒé™ç®¡ç† ğŸ” å®‰å…¨åŠŸèƒ½ é…ç½®æ–¹å¼ ç”¨é€” ğŸ‘¤ åŸºæœ¬è®¤è¯ é…ç½® HTTP åŸºæœ¬è®¤è¯ ä¿æŠ¤æ•æ„Ÿç›®å½•ï¼Œè®¾ç½®ç”¨æˆ·åå’Œå¯†ç è®¿é—®é™åˆ¶ ğŸŒ IP é™åˆ¶ é…ç½® IP ç™½åå•/é»‘åå• é™åˆ¶ç‰¹å®šç½‘ç»œè®¿é—®ï¼Œå¢å¼ºå®‰å…¨æ€§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://nginx-file.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/nginx-file-server.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name nginx-file.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ€§èƒ½ä¼˜åŒ– sendfile on; tcp_nopush on; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 10G; location / { proxy_pass http://localhost:18080; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; # WebSocket æ”¯æŒï¼ˆå¦‚æœåº”ç”¨éœ€è¦ï¼‰ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; # ç¼“å†²è®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; proxy_max_temp_file_size 0; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /var/www/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ–‡ä»¶ï¼Œå…±äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Nginx-File æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“ ä¾¿æ·å…±äº« è½»æ¾å®ç°æ–‡ä»¶åœ¨çº¿è®¿é—®å’Œä¸‹è½½ï¼Œæ”¯æŒç›®å½•æµè§ˆå’Œæ–‡ä»¶ç®¡ç†\nğŸ”’ å®‰å…¨å¯æ§ é€šè¿‡æƒé™è®¾ç½®å’Œ HTTPS åŠ å¯†ä¿éšœæ•°æ®å®‰å…¨ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®\nâš¡ é«˜æ•ˆç¨³å®š åŸºäº Nginx çš„é«˜æ€§èƒ½é™æ€æ–‡ä»¶æœåŠ¡ï¼Œç¡®ä¿å¿«é€Ÿå“åº”å’Œå¯é ä¼ è¾“\næ–‡ä»¶æœåŠ¡ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•°æ®å…±äº«ç›¸ä¼´çš„ä¾¿æ·æ—…ç¨‹ã€‚æ„¿ Nginx-File æˆä¸ºä½ å¯é çš„æ–‡ä»¶ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æ–‡ä»¶å…±äº«å’Œèµ„æºç®¡ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè½»æ¾å…±äº«ï¼Œé«˜æ•ˆåä½œâ€”â€”æ„å»ºä½ ä¾¿æ·å¯é çš„æ–‡ä»¶æœåŠ¡ç”Ÿæ€å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å®šæœŸæ£€æŸ¥ Nginx å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–å®‰å…¨è¡¥ä¸å’ŒåŠŸèƒ½ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯æŸ¥é˜… Nginx æ–‡æ¡£ æˆ–é€šè¿‡ç¤¾åŒºè®ºå›å¯»æ±‚å¸®åŠ©ã€‚\nç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼Œå…±äº«æ— å¿§ï¼ğŸ‰\n","date":"2025-08-25T12:33:43+08:00","image":"https://file.meimolihan.eu.org/img/nginx-file-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1da73b66/","title":"Docker éƒ¨ç½² Nginx-File æ–‡ä»¶æœåŠ¡å™¨ ğŸ“‚"},{"content":"Docker éƒ¨ç½² MoonTV å½±è§†èšåˆæ’­æ”¾å™¨ ğŸ¬ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² MoonTV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ MoonTV 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. ä¸»è¦åŠŸèƒ½ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå½±è§†ï¼Œç•…äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ MoonTV å®˜ç½‘åœ°å€ï¼š https://tv.brace.fun/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/MoonTechLab/LunaTV MoonTV æ˜¯ä¸€æ¬¾å¼€ç®±å³ç”¨çš„è·¨å¹³å°å½±è§†èšåˆæ’­æ”¾å™¨ï¼ŒåŸºäºç°ä»£ Web æŠ€æœ¯æ ˆæ„å»ºï¼Œæä¾›ä¸°å¯Œçš„å½±è§†å†…å®¹å’Œä¼˜è´¨çš„ç”¨æˆ·ä½“éªŒã€‚å®ƒæ”¯æŒå¤šèµ„æºæœç´¢ã€åœ¨çº¿æ’­æ”¾ã€æ”¶è—åŒæ­¥å’Œæ’­æ”¾è®°å½•ç­‰åŠŸèƒ½ï¼Œè®©æ‚¨å¯ä»¥éšæ—¶éšåœ°ç•…äº«æµ·é‡å…è´¹å½±è§†å†…å®¹ã€‚ğŸŒŸ\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¥ å¤šæºèšåˆ æ•´åˆå¤šä¸ªå½±è§†èµ„æºï¼Œä¸€ç«™å¼æœç´¢å’Œæ’­æ”¾ æ— éœ€åˆ‡æ¢å¤šä¸ªåº”ç”¨ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰èµ„æº ğŸŒ è·¨å¹³å°æ”¯æŒ æ”¯æŒ Webã€ç§»åŠ¨ç«¯ç­‰å¤šç§è®¾å¤‡ éšæ—¶éšåœ°äº«å—å½±è§†å†…å®¹ï¼Œæ— ç¼åˆ‡æ¢è®¾å¤‡ ğŸ’¾ æ•°æ®åŒæ­¥ æ”¯æŒæ”¶è—åˆ—è¡¨å’Œæ’­æ”¾è®°å½•åŒæ­¥ å¤šè®¾å¤‡é—´ä¿æŒè§‚çœ‹è¿›åº¦å’Œæ”¶è—ä¸€è‡´æ€§ ğŸ¨ ç°ä»£ç•Œé¢ åŸºäº Next.js 14 + Tailwind CSS çš„ç°ä»£åŒ–ç•Œé¢ ç¾è§‚æ˜“ç”¨ï¼Œæ“ä½œæµç•…ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ” æ™ºèƒ½æœç´¢ å¤šèµ„æºå¹¶è¡Œæœç´¢ï¼Œå¿«é€Ÿæ‰¾åˆ°æƒ³çœ‹çš„å†…å®¹ é«˜æ•ˆæ£€ç´¢ï¼ŒèŠ‚çœå¯»æ‰¾èµ„æºçš„æ—¶é—´ ğŸ“± å“åº”å¼è®¾è®¡ å®Œç¾é€‚é…å„ç§å±å¹•å°ºå¯¸ åœ¨æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘ä¸Šéƒ½èƒ½è·å¾—è‰¯å¥½ä½“éªŒ ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª å†…ç½®å¹¿å‘Šæ‹¦æˆªåŠŸèƒ½ï¼Œæå‡è§‚çœ‹ä½“éªŒ å‡å°‘å¹²æ‰°ï¼Œä¸“æ³¨è§‚å½±å†…å®¹ ğŸŒ™ å¤œé—´æ¨¡å¼ æ”¯æŒæš—è‰²ä¸»é¢˜ï¼Œä¿æŠ¤çœ¼ç›å‡å°‘ç–²åŠ³ é•¿æ—¶é—´è§‚çœ‹æ›´èˆ’é€‚ï¼Œä¿æŠ¤è§†åŠ› ğŸ”„ å®æ—¶æ›´æ–° èµ„æºåº“å®šæœŸæ›´æ–°ï¼ŒæŒç»­æä¾›æœ€æ–°å†…å®¹ å§‹ç»ˆèƒ½å¤Ÿè·å–æœ€æ–°çš„å½±è§†èµ„æº ğŸ³ ä¸€ã€Docker éƒ¨ç½² MoonTV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/moontv \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: moontv: image: ghcr.io/senshinya/moontv:latest container_name: moontv restart: unless-stopped ports: - \u0026#34;3133:3000\u0026#34; # ğŸŒ ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ volumes: - ./config.json:/app/config.json:ro # âš™ï¸ é…ç½®æ–‡ä»¶(åªè¯») - ./data:/app/data # ğŸ’¾ æ•°æ®æŒä¹…åŒ–ç›®å½• environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® - NEXT_PUBLIC_STORAGE_TYPE=localstorage # ğŸ’¾ å­˜å‚¨ç±»å‹ - NEXT_PUBLIC_ENABLE_BLOCKAD=true # ğŸ›¡ï¸ å¯ç”¨å¹¿å‘Šæ‹¦æˆª - NEXT_PUBLIC_SEARCH_MAX_PAGE=5 # ğŸ” æœç´¢æœ€å¤§é¡µæ•° - NEXT_PUBLIC_AGGREGATE_SEARCH_RESULT=true # ğŸ“Š èšåˆæœç´¢ç»“æœ EOF 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 cat \u0026gt; config.json \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;siteName\u0026#34;: \u0026#34;MoonTV\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;å¼€æºå½±è§†èšåˆæ’­æ”¾å™¨\u0026#34;, \u0026#34;keywords\u0026#34;: \u0026#34;ç”µå½±,ç”µè§†å‰§,åŠ¨æ¼«,ç»¼è‰º,å…è´¹è§‚çœ‹\u0026#34;, \u0026#34;defaultSearchSource\u0026#34;: \u0026#34;all\u0026#34;, \u0026#34;sources\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;æº1\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://example.com/api/v1\u0026#34;, \u0026#34;enabled\u0026#34;: true }, { \u0026#34;name\u0026#34;: \u0026#34;æº2\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://example.com/api/v2\u0026#34;, \u0026#34;enabled\u0026#34;: true } ], \u0026#34;player\u0026#34;: { \u0026#34;defaultQuality\u0026#34;: \u0026#34;é«˜æ¸…\u0026#34;, \u0026#34;autoPlayNext\u0026#34;: true, \u0026#34;rememberPosition\u0026#34;: true }, \u0026#34;ui\u0026#34;: { \u0026#34;theme\u0026#34;: \u0026#34;auto\u0026#34;, \u0026#34;language\u0026#34;: \u0026#34;zh-CN\u0026#34; } } EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ MoonTV 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:3133 åŸŸåè®¿é—®: https://moontv.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. ä¸»è¦åŠŸèƒ½ ğŸ¯ å½±è§†æœç´¢ ğŸ”\nå¤šæºå¹¶è¡Œæœç´¢ï¼Œå¿«é€Ÿè·å–ç»“æœ æ™ºèƒ½ç»“æœèšåˆï¼Œå»é™¤é‡å¤å†…å®¹ åˆ†ç±»ç­›é€‰åŠŸèƒ½ï¼ŒæŒ‰ç±»å‹ã€å¹´ä»½ã€åœ°åŒºç­›é€‰ åœ¨çº¿æ’­æ”¾ â–¶ï¸\næ”¯æŒå¤šç§è§†é¢‘æ ¼å¼å’Œæµåª’ä½“åè®® å¤šæ¸…æ™°åº¦é€‰æ‹©ï¼ˆæ ‡æ¸…ã€é«˜æ¸…ã€è¶…æ¸…ï¼‰ å®Œæ•´çš„æ’­æ”¾æ§åˆ¶ï¼ˆæš‚åœã€å¿«è¿›ã€éŸ³é‡ã€å­—å¹•ç­‰ï¼‰ ä¸ªäººä¸­å¿ƒ ğŸ‘¤\næ”¶è—ç®¡ç†ï¼Œåˆ›å»ºä¸ªäººç‰‡å• æ’­æ”¾å†å²ï¼Œè®°å½•è§‚çœ‹è½¨è¿¹ è§‚çœ‹è¿›åº¦åŒæ­¥ï¼Œå¤šè®¾å¤‡æ— ç¼åˆ‡æ¢ è®¾ç½®é€‰é¡¹ âš™ï¸\næ’­æ”¾å™¨è®¾ç½®ï¼ˆé»˜è®¤æ¸…æ™°åº¦ã€è‡ªåŠ¨æ’­æ”¾ç­‰ï¼‰ ç•Œé¢ä¸»é¢˜ï¼ˆæ˜äº®/æš—é»‘/è‡ªåŠ¨ï¼‰ æ•°æ®ç®¡ç†ï¼ˆæ¸…é™¤ç¼“å­˜ã€å¯¼å‡ºæ•°æ®ï¼‰ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://moontv.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/moontv.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name moontv.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ€§èƒ½ä¼˜åŒ– sendfile on; tcp_nopush on; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://localhost:3133; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; # ç¼“å†²è®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; proxy_max_temp_file_size 0; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/moontv # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop moontv # åœæ­¢å®¹å™¨ docker start moontv # å¯åŠ¨å®¹å™¨ docker restart moontv # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm moontv # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f moontv # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it moontv sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it moontv bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect moontv # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats moontv # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs moontv # æŸ¥çœ‹æ—¥å¿— docker logs -f moontv # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 moontv # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t moontv # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå½±è§†ï¼Œç•…äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† MoonTV å½±è§†èšåˆæ’­æ”¾å™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ æµ·é‡èµ„æº ç•…äº«å¤šæºèšåˆçš„å½±è§†å†…å®¹ï¼Œæ¶µç›–ç”µå½±ã€ç”µè§†å‰§ã€åŠ¨æ¼«ç­‰å¤šç§ç±»å‹\nğŸŒ è·¨å±ä½“éªŒ å¤šè®¾å¤‡æ— ç¼åˆ‡æ¢ï¼Œéšæ—¶éšåœ°äº«å—ä¼˜è´¨çš„è§‚å½±ä½“éªŒ\nğŸ“Š æ™ºèƒ½ç®¡ç† ä¸ªäººæ”¶è—å’Œè§‚çœ‹è®°å½•åŒæ­¥ï¼Œæ‰“é€ ä¸“å±çš„å½±è§†åº“\nå½±è§†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç²¾å½©å†…å®¹ç›¸ä¼´çš„ä¼‘é—²æ—¶å…‰ã€‚æ„¿ MoonTV æˆä¸ºä½ è´´å¿ƒçš„è§‚å½±ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªæ”¾æ¾å’Œå¨±ä¹çš„ç¾å¥½æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒè§‚çœ‹ï¼Œç•…äº«å½±è§†â€”â€”æ„å»ºä½ ä¸“å±çš„ç§äººå½±é™¢å§ï¼ğŸ‰\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ MoonTV å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§‚å½±æ„‰å¿«ï¼Œäº«å—æ¯ä¸€åˆ»ï¼ğŸ¬\n","date":"2025-08-25T12:32:02+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-moontv.webp","permalink":"https://blog.meimolihan.eu.org/p/ab9617c0/","title":"Docker éƒ¨ç½² moontv å½±è§†èšåˆæ’­æ”¾å™¨ ğŸ¬"},{"content":"Dockerfile å®Œå…¨æŒ‡å— ğŸ³ ğŸš€ æŒæ¡Dockeré•œåƒæ„å»ºçš„è‰ºæœ¯ï¼Œæ‰“é€ é«˜æ•ˆã€å®‰å…¨çš„å®¹å™¨åŒ–åº”ç”¨\nğŸ“‹ ç›®å½•\nğŸ¯ Dockerfile ç®€ä»‹ ğŸ“ æŒ‡ä»¤è¯¦è§£ ğŸ—ï¸ å¤šé˜¶æ®µæ„å»º âœ… æœ€ä½³å®è·µ ğŸ”’ å®‰å…¨æŒ‡å— âš¡ å®æˆ˜ç¤ºä¾‹ ğŸš€ æ„å»ºä¸ä¼˜åŒ– ğŸ› è°ƒè¯•æŠ€å·§ ğŸ¯ Dockerfile ç®€ä»‹\nğŸ“– ä»€ä¹ˆæ˜¯ Dockerfileï¼Ÿ\nDockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—çš„æŒ‡ä»¤å’Œå‚æ•°ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»º Docker é•œåƒã€‚å®ƒå°±åƒæ˜¯å®¹å™¨çš„\u0026quot;é£Ÿè°±\u0026quot;ï¼Œå®šä¹‰äº†å¦‚ä½•æ„å»ºåº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚\nğŸ¨ åŸºæœ¬ç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # åŸºç¡€é•œåƒ - æ„å»ºçš„èµ·ç‚¹ FROM ubuntu:20.04 # å…ƒæ•°æ® - é•œåƒä¿¡æ¯ LABEL maintainer=\u0026#34;your.email@example.com\u0026#34; LABEL version=\u0026#34;1.0\u0026#34; LABEL description=\u0026#34;My awesome application\u0026#34; # ç¯å¢ƒå˜é‡ - é…ç½®å‚æ•° ENV APP_HOME=/app \\ NODE_ENV=production # å·¥ä½œç›®å½• - å‘½ä»¤æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ WORKDIR $APP_HOME # å¤åˆ¶æ–‡ä»¶ - æ·»åŠ åº”ç”¨ç¨‹åºä»£ç  COPY . . # å®‰è£…ä¾èµ– - æ„å»ºç¯å¢ƒ RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y python3 pip \u0026amp;\u0026amp; \\ pip install -r requirements.txt # æš´éœ²ç«¯å£ - å®¹å™¨ç½‘ç»œæ¥å£ EXPOSE 8000 # å¯åŠ¨å‘½ä»¤ - å®¹å™¨è¿è¡Œæ—¶æ‰§è¡Œçš„å‘½ä»¤ CMD [\u0026#34;python3\u0026#34;, \u0026#34;app.py\u0026#34;] ğŸ“ æŒ‡ä»¤è¯¦è§£\nğŸ—ï¸ FROM - åŸºç¡€é•œåƒ\n1 2 3 4 5 6 7 8 9 # ä½¿ç”¨å®˜æ–¹é•œåƒ FROM python:3.9-slim # æŒ‡å®šå…·ä½“ç‰ˆæœ¬ FROM node:16.15.1-alpine3.16 # ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºçš„ä¸åŒåŸºç¡€é•œåƒ FROM golang:1.19 as builder FROM alpine:3.16 as runtime âš™ï¸ RUN - æ‰§è¡Œå‘½ä»¤\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å•ä¸€å‘½ä»¤ RUN apt-get update # å¤šå‘½ä»¤ç»„åˆï¼ˆå‡å°‘é•œåƒå±‚ï¼‰ RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y \\ git \\ curl \\ wget \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* # ä½¿ç”¨ç®¡é“æ“ä½œ RUN curl -sSL https://deb.nodesource.com/setup_16.x | bash - # åˆ›å»ºç›®å½•å¹¶è®¾ç½®æƒé™ RUN mkdir -p /app/logs \u0026amp;\u0026amp; \\ chmod 755 /app/logs ğŸ“‚ COPY vs ADD - æ–‡ä»¶å¤åˆ¶\n1 2 3 4 5 6 7 8 9 10 11 # COPY - æ¨èä½¿ç”¨ï¼Œè¡Œä¸ºæ˜ç¡® COPY ./src /app/src COPY package*.json ./ COPY requirements.txt . # ADD - è‡ªåŠ¨è§£å‹å’ŒURLä¸‹è½½ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ ADD https://example.com/file.tar.gz /tmp/ ADD local-file.tar.gz /tmp/ # ä¼šè‡ªåŠ¨è§£å‹ # å¤åˆ¶æ—¶æ”¹å˜æ–‡ä»¶æƒé™ COPY --chown=node:node . /app ğŸ¯ CMD vs ENTRYPOINT - å¯åŠ¨å‘½ä»¤\n1 2 3 4 5 6 7 8 9 # CMD - é»˜è®¤å‘½ä»¤ï¼ˆå¯è¢«è¦†ç›–ï¼‰ CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] # ENTRYPOINT - ä¸»è¦å‘½ä»¤ ENTRYPOINT [\u0026#34;/app/start.sh\u0026#34;] # ç»„åˆä½¿ç”¨ ENTRYPOINT [\u0026#34;/app/entrypoint.sh\u0026#34;] CMD [\u0026#34;--help\u0026#34;] ğŸŒ ENV - ç¯å¢ƒå˜é‡\n1 2 3 4 5 6 7 8 9 10 11 # å•ä¸ªå˜é‡ ENV APP_VERSION=1.0.0 # å¤šä¸ªå˜é‡ ENV APP_HOME=/app \\ PORT=3000 \\ NODE_ENV=production # æ„å»ºæ—¶å˜é‡ï¼ˆDocker 17.05+ï¼‰ ARG BUILD_VERSION ENV VERSION=$BUILD_VERSION ğŸ“ WORKDIR - å·¥ä½œç›®å½•\n1 2 3 4 5 6 7 8 9 # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # åç»­æŒ‡ä»¤éƒ½åœ¨æ­¤ç›®å½•æ‰§è¡Œ RUN pwd # è¾“å‡º /app # å¯ä»¥å¤šæ¬¡ä½¿ç”¨ WORKDIR /app/src RUN pwd # è¾“å‡º /app/src ğŸšª EXPOSE - ç«¯å£æš´éœ²\n1 2 3 4 5 6 7 8 9 # å•ä¸ªç«¯å£ EXPOSE 80 # å¤šä¸ªç«¯å£ EXPOSE 80 443 3000 # æŒ‡å®šåè®® EXPOSE 80/tcp EXPOSE 53/udp ğŸ‘¤ USER - ç”¨æˆ·è®¾ç½®\n1 2 3 4 5 6 7 8 9 # åˆ›å»ºç”¨æˆ· RUN groupadd -r app \u0026amp;\u0026amp; \\ useradd -r -g app app # åˆ‡æ¢ç”¨æˆ· USER app # æŒ‡å®šUID/GID USER 1000:1000 ğŸ—ï¸ å¤šé˜¶æ®µæ„å»º\nğŸ¯ ä¸ºä»€ä¹ˆä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Ÿ\nÂ· å‡å°é•œåƒå¤§å° ğŸ‹ â†’ ğŸ¢ Â· æé«˜å®‰å…¨æ€§ ğŸ”’ Â· åˆ†ç¦»æ„å»ºå’Œè¿è¡Œç¯å¢ƒ ğŸ—ï¸ â†’ ğŸš€\nğŸ“¦ å®Œæ•´ç¤ºä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # é˜¶æ®µ1: æ„å»ºç¯å¢ƒ FROM node:16 as builder WORKDIR /build COPY package*.json ./ RUN npm ci --only=production # é˜¶æ®µ2: æµ‹è¯•ç¯å¢ƒï¼ˆå¯é€‰ï¼‰ FROM node:16 as tester WORKDIR /test COPY . . COPY --from=builder /build/node_modules ./node_modules RUN npm test # é˜¶æ®µ3: è¿è¡Œç¯å¢ƒ FROM node:16-alpine as runtime WORKDIR /app # å®‰è£…è¿è¡Œæ—¶ä¾èµ– RUN apk add --no-cache tzdata \u0026amp;\u0026amp; \\ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # å¤åˆ¶æ„å»ºäº§ç‰© COPY --from=builder /build/node_modules ./node_modules COPY . . # è®¾ç½®érootç”¨æˆ· RUN addgroup -g 1001 -S app \u0026amp;\u0026amp; \\ adduser -u 1001 -S app -G app USER app EXPOSE 3000 CMD [\u0026#34;node\u0026#34;, \u0026#34;server.js\u0026#34;] ğŸ”§ é«˜çº§å¤šé˜¶æ®µæŠ€å·§\n1 2 3 4 5 6 7 8 9 10 11 12 13 # ä»å…¶ä»–é•œåƒå¤åˆ¶æ–‡ä»¶ FROM nginx:alpine as web COPY --from=builder /app/dist /usr/share/nginx/html # ä½¿ç”¨scratchç©ºé•œåƒ FROM scratch COPY --from=builder /app/bin/app / CMD [\u0026#34;/app\u0026#34;] # å¤šæ¶æ„æ„å»ºæ”¯æŒ FROM --platform=$BUILDPLATFORM golang:1.19 as builder ARG TARGETARCH RUN GOARCH=$TARGETARCH go build -o /app âœ… æœ€ä½³å®è·µ\nğŸ¯ 1. ä½¿ç”¨å®˜æ–¹é•œåƒ\n1 2 3 4 5 6 # æ¨è âœ… FROM python:3.9-slim # é¿å… âŒ FROM ubuntu:20.04 RUN apt-get update \u0026amp;\u0026amp; apt-get install -y python3 ğŸ“¦ 2. ä¼˜åŒ–å±‚ç¼“å­˜\n1 2 3 4 5 6 7 8 9 10 # å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ COPY package.json package-lock.json ./ RUN npm install # å†å¤åˆ¶æºä»£ç  COPY . . # è€Œä¸æ˜¯ COPY . . RUN npm install # æ¯æ¬¡ä»£ç å˜æ›´éƒ½ä¼šé‡æ–°å®‰è£…ä¾èµ– ğŸ§¹ 3. æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶\n1 2 3 4 5 6 7 8 RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y \\ build-essential \\ git \u0026amp;\u0026amp; \\ # ... å®‰è£…å®Œæˆåæ¸…ç† apt-get purge -y build-essential git \u0026amp;\u0026amp; \\ apt-get autoremove -y \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* ğŸ“ 4. ä½¿ç”¨ .dockerignore\nåˆ›å»º .dockerignore æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¿½ç•¥æ–‡ä»¶ .git .gitignore README.md Dockerfile .dockerignore # å¿½ç•¥ç›®å½• node_modules logs temp dist # å¿½ç•¥æ¨¡å¼ *.log *.tmp *.swp ğŸ”§ 5. å¥åº·æ£€æŸ¥\n1 2 3 4 5 6 # å‘½ä»¤æ–¹å¼ HEALTHCHECK --interval=30s --timeout=3s \\ CMD curl -f http://localhost:3000/health || exit 1 # ç¦ç”¨ç»§æ‰¿çš„å¥åº·æ£€æŸ¥ HEALTHCHECK NONE ğŸ”’ å®‰å…¨æŒ‡å—\nğŸ›¡ï¸ 1. é¿å…ä»¥rootè¿è¡Œ\n1 2 3 4 5 6 # åˆ›å»ºéç‰¹æƒç”¨æˆ· RUN adduser -D -u 1000 appuser USER appuser # æˆ–è€…ç›´æ¥æŒ‡å®šUID USER 1000 ğŸ” 2. ä½¿ç”¨å¯ä¿¡çš„åŸºç¡€é•œåƒ\n1 2 3 4 5 # ä½¿ç”¨å®˜æ–¹é•œåƒå¹¶æŒ‡å®šç‰ˆæœ¬ FROM debian:bullseye-20221004-slim # æ£€æŸ¥é•œåƒæ¼æ´ # docker scan \u0026lt;image-name\u0026gt; ğŸ“¦ 3. æœ€å°åŒ–å®‰è£…\n1 2 3 4 5 6 7 # åªå®‰è£…å¿…è¦çš„åŒ… RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y \\ --no-install-recommends \\ ca-certificates \\ curl \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* ğŸš¨ 4. å®‰å…¨æ‰«æ\n1 2 3 4 5 # ä½¿ç”¨Docker Scoutæ‰«æé•œåƒ docker scout quickview \u0026lt;image-name\u0026gt; # ä½¿ç”¨Trivyæ‰«ææ¼æ´ trivy image \u0026lt;image-name\u0026gt; âš¡ å®æˆ˜ç¤ºä¾‹\nğŸ Python åº”ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 FROM python:3.9-slim as production # è®¾ç½®ç¯å¢ƒå˜é‡ ENV PYTHONDONTWRITEBYTECODE=1 \\ PYTHONUNBUFFERED=1 \\ PIP_NO_CACHE_DIR=on WORKDIR /app # å®‰è£…ç³»ç»Ÿä¾èµ– RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y --no-install-recommends \\ gcc \\ libpq-dev \u0026amp;\u0026amp; \\ apt-get clean \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* # å®‰è£…Pythonä¾èµ– COPY requirements.txt . RUN pip install --no-cache-dir -r requirements.txt # å¤åˆ¶åº”ç”¨ä»£ç  COPY . . # åˆ›å»ºérootç”¨æˆ· RUN useradd --create-home --shell /bin/bash app USER app EXPOSE 8000 # ä½¿ç”¨gunicornè¿è¡Œ CMD [\u0026#34;gunicorn\u0026#34;, \u0026#34;--bind\u0026#34;, \u0026#34;0.0.0.0:8000\u0026#34;, \u0026#34;app:app\u0026#34;] âš›ï¸ Node.js åº”ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 FROM node:18-alpine as builder WORKDIR /build COPY package*.json ./ RUN npm ci --only=production FROM node:18-alpine as runtime WORKDIR /app # å¤åˆ¶node_moduleså’Œç¼–è¯‘åçš„æ–‡ä»¶ COPY --from=builder /build/node_modules ./node_modules COPY --chown=node:node . . # ä½¿ç”¨érootç”¨æˆ· USER node EXPOSE 3000 ENV NODE_ENV=production CMD [\u0026#34;node\u0026#34;, \u0026#34;src/index.js\u0026#34;] ğŸ¹ Go åº”ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 # æ„å»ºé˜¶æ®µ FROM golang:1.19 as builder WORKDIR /build COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -ldflags=\u0026#34;-w -s\u0026#34; -o app . # è¿è¡Œé˜¶æ®µ FROM scratch COPY --from=builder /build/app /app COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ EXPOSE 8080 CMD [\u0026#34;/app\u0026#34;] ğŸš€ æ„å»ºä¸ä¼˜åŒ–\nâš¡ æ„å»ºå‘½ä»¤\n1 2 3 4 5 6 7 8 9 10 11 # åŸºæœ¬æ„å»º docker build -t my-app:1.0 . # æŒ‡å®šDockerfileè·¯å¾„ docker build -f Dockerfile.prod -t my-app:prod . # æ„å»ºå‚æ•° docker build --build-arg VERSION=1.0.0 -t my-app . # å¤šå¹³å°æ„å»º docker buildx build --platform linux/amd64,linux/arm64 -t my-app:multi . ğŸ¯ æ„å»ºå‚æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœ¨Dockerfileä¸­å®šä¹‰ ARG VERSION=latest ARG BUILD_NUMBER # ä½¿ç”¨æ„å»ºå‚æ•° LABEL version=$VERSION ENV BUILD_NUMBER=$BUILD_NUMBER # æ¡ä»¶æ„å»º RUN if [ \u0026#34;$VERSION\u0026#34; = \u0026#34;dev\u0026#34; ] ; then \\ npm install; \\ else \\ npm ci --only=production; \\ fi ğŸ“Š é•œåƒåˆ†æ\n1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹é•œåƒå±‚æ¬¡ docker history my-app:latest # æŸ¥çœ‹é•œåƒå¤§å° docker images my-app # å¯¼å‡ºé•œåƒåˆ†æ docker save my-app:latest | docker run -i --rm \\ wagoodman/dive:latest ğŸ› è°ƒè¯•æŠ€å·§\nğŸ” è°ƒè¯•Dockerfile\n1 2 3 4 5 6 7 8 # ä¸´æ—¶æ·»åŠ è°ƒè¯•å·¥å…· RUN if [ \u0026#34;$DEBUG\u0026#34; = \u0026#34;true\u0026#34; ] ; then \\ apt-get update \u0026amp;\u0026amp; \\ apt-get install -y curl vim; \\ fi # ä½¿ç”¨æ„å»ºå‚æ•°æ§åˆ¶è°ƒè¯• ARG DEBUG=false ğŸ“ è°ƒè¯•å‘½ä»¤\n1 2 3 4 5 6 7 8 9 10 11 # åœ¨æ„å»ºå¤±è´¥æ—¶è¿›å…¥ä¸­é—´å®¹å™¨ docker build --target builder -t debug . # è¿è¡Œè°ƒè¯•å®¹å™¨ docker run -it --rm --entrypoint sh debug # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ docker run -it --rm my-app ls -la /app # æŸ¥çœ‹ç¯å¢ƒå˜é‡ docker run -it --rm my-app env ğŸ³ Docker BuildKit ç‰¹æ€§\n1 2 3 4 5 6 7 8 9 # å¯ç”¨BuildKit DOCKER_BUILDKIT=1 docker build . # è¾“å‡ºæ„å»ºæ—¥å¿— docker build --progress=plain . # ç¼“å­˜ç®¡ç† docker build --no-cache . docker build --cache-from=my-app:previous . ğŸ’¡ ä¸“ä¸šæç¤º: å®šæœŸæ›´æ–°åŸºç¡€é•œåƒä»¥è·å–å®‰å…¨è¡¥ä¸ï¼Œä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ¥å‡å°é•œåƒå¤§å°ï¼Œå¹¶ä¸”å§‹ç»ˆæ‰«æé•œåƒä¸­çš„æ¼æ´ã€‚è®°ä½ï¼Œä¸€ä¸ªå¥½çš„Dockerfileå°±åƒæ˜¯åº”ç”¨ç¨‹åºçš„æ–‡æ¡£ï¼Œå®ƒåº”è¯¥æ¸…æ™°ã€ç®€æ´ä¸”æ˜“äºç»´æŠ¤ã€‚\nHappy Dockerizing! ğŸ‰ ç¥æ‚¨æ„å»ºé¡ºåˆ©ï¼\n","date":"2025-08-25T12:29:28+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3943c21b/","title":"Dockerfile å®Œå…¨æŒ‡å— ğŸ³"},{"content":"Docker æœ¬åœ°é•œåƒæ‰“åŒ…ä¸åŠ è½½æŒ‡å— ğŸ³ ğŸ“¦ æŒæ¡Dockeré•œåƒçš„ç¦»çº¿è¿ç§»ä¸éƒ¨ç½²æŠ€å·§ â€” å®ç°ç¯å¢ƒå¿«é€Ÿè¿ç§»ä¸ä¸€è‡´æ€§éƒ¨ç½²\nğŸ“‹ æ–‡ç« ç›®å½• ğŸŒŸ Docker é•œåƒç®¡ç†æ¦‚è¿° ğŸ“¦ ä¸€ã€é•œåƒæ‰“åŒ…æ“ä½œæŒ‡å— ğŸš€ äºŒã€é•œåƒåŠ è½½ä¸éªŒè¯ ğŸ” ä¸‰ã€éªŒè¯ä¸ç®¡ç†ç­–ç•¥ ğŸ’¡ å››ã€å®ç”¨æŠ€å·§ä¸ä¼˜åŒ– âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ä¸é—®é¢˜è§£å†³ ğŸš€ å…­ã€é«˜çº§åº”ç”¨åœºæ™¯ ğŸŒŸ Docker é•œåƒç®¡ç†æ¦‚è¿° Docker é•œåƒæ˜¯å®¹å™¨åŒ–åº”ç”¨çš„åŸºçŸ³ï¼ŒæŒæ¡é•œåƒçš„æ‰“åŒ…ä¸åŠ è½½æŠ€å·§å¯¹äºDevOpså·¥ä½œæµè‡³å…³é‡è¦ï¼âœ¨\nğŸ”§ Docker é•œåƒç®¡ç†çš„æ ¸å¿ƒä»·å€¼ï¼š\nç¯å¢ƒä¸€è‡´æ€§ï¼šç¡®ä¿å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´ å¿«é€Ÿéƒ¨ç½²ï¼šé•œåƒåŠ è½½æ¯”ä»å¤´æ„å»ºæ›´å¿«ï¼ŒåŠ é€Ÿéƒ¨ç½²æµç¨‹ ç¦»çº¿è¿ç§»ï¼šåœ¨æ²¡æœ‰ç½‘ç»œè¿æ¥çš„ç¯å¢ƒä¸­éƒ¨ç½²åº”ç”¨ ç‰ˆæœ¬æ§åˆ¶ï¼šé€šè¿‡é•œåƒæ ‡ç­¾ç®¡ç†ä¸åŒç‰ˆæœ¬çš„åº”ç”¨ ç¾éš¾æ¢å¤ï¼šå¿«é€Ÿä»å¤‡ä»½é•œåƒæ¢å¤æœåŠ¡ ğŸš€ é€‚ç”¨åœºæ™¯ï¼š\nç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¸å›æ»š ç¦»çº¿ç¯å¢ƒåº”ç”¨éƒ¨ç½² å¼€å‘å›¢é˜Ÿç¯å¢ƒæ ‡å‡†åŒ– å®¢æˆ·ç°åœºéƒ¨ç½²æ”¯æŒ è·¨å¹³å°åº”ç”¨è¿ç§» ğŸ’¡ ä½ çŸ¥é“å—ï¼Ÿ Docker ä½¿ç”¨è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æŠ€æœ¯ï¼Œä½¿å¾—é•œåƒå±‚å¯ä»¥å…±äº«å’Œé‡ç”¨ï¼Œå¤§å¤§å‡å°‘äº†å­˜å‚¨ç©ºé—´å’Œä¼ è¾“æ—¶é—´ã€‚\nğŸ“¦ ä¸€ã€é•œåƒæ‰“åŒ…æ“ä½œæŒ‡å— 1. ä¸€é”®æ‰“åŒ…é•œåƒè„šæœ¬ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/docker-image/pack-image.sh) 2. æŸ¥çœ‹æœ¬åœ°é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ docker images # æ ¼å¼åŒ–è¾“å‡ºé•œåƒä¿¡æ¯ docker images --format \u0026#34;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; # æŒ‰å¤§å°æ’åºæ˜¾ç¤ºé•œåƒ docker images --format \u0026#34;table {{.Size}}\\t{{.Repository}}\u0026#34; | sort -hr # æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯ docker image inspect \u0026lt;image_name\u0026gt; # åªæ˜¾ç¤ºé•œåƒID docker images -q 3. æ‰“åŒ…å•ä¸ªé•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŸºæœ¬æ‰“åŒ…å‘½ä»¤ docker save -o myimage.tar image_name:tag # ä½¿ç”¨é•œåƒIDæ‰“åŒ…ï¼ˆæ¨èï¼‰ docker save -o myapp.tar 42c0d7908c02 # æ‰“åŒ…åˆ°æŒ‡å®šç›®å½• docker save -o /backup/images/myapp.tar myapp:latest # ä½¿ç”¨gzipå‹ç¼©ï¼ˆèŠ‚çœç©ºé—´ï¼‰ docker save myapp:latest | gzip \u0026gt; myapp.tar.gz # ä½¿ç”¨æœ€å¤§å‹ç¼©æ¯” docker save myapp:latest | gzip -9 \u0026gt; myapp_max.tar.gz 4. æ‰“åŒ…å¤šä¸ªé•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ‰“åŒ…å¤šä¸ªé•œåƒåˆ°å•ä¸ªæ–‡ä»¶ docker save -o all_images.tar \\ image1:tag1 \\ image2:tag2 \\ image3:tag3 # ä½¿ç”¨å˜é‡æ‰“åŒ…å¤šä¸ªé•œåƒ IMAGES=\u0026#34;ubuntu:20.04 nginx:alpine redis:6.2\u0026#34; docker save -o base_images.tar $IMAGES # æ‰“åŒ…æ‰€æœ‰æœ¬åœ°é•œåƒ docker save -o all_local_images.tar $(docker images -q) # æ‰“åŒ…ç‰¹å®šæ ‡ç­¾çš„é•œåƒ docker save -o production_images.tar $(docker images | grep \u0026#34;prod-\u0026#34; | awk \u0026#39;{print $1 \u0026#34;:\u0026#34; $2}\u0026#39;) 5. é•œåƒæ ‡è¯†è¯´æ˜ æ ‡è¯†ç±»å‹ ç¤ºä¾‹ è¯´æ˜ é•œåƒID 42c0d7908c02 å”¯ä¸€æ ‡è¯†ï¼Œæ¨èä½¿ç”¨ ä»“åº“:æ ‡ç­¾ myapp:latest æ˜“è¯»ï¼Œä½†å¯èƒ½å˜åŒ– ä»“åº“@æ‘˜è¦ myapp@sha256:abc123 æœ€ç²¾ç¡®ï¼Œä½†å†—é•¿ ğŸ’¡ ä¸“ä¸šå»ºè®®ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é•œåƒIDæˆ–æ‘˜è¦æ ‡è¯†é•œåƒï¼Œé¿å…å› æ ‡ç­¾é‡ç”¨å¯¼è‡´ç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜ã€‚\nğŸš€ äºŒã€é•œåƒåŠ è½½ä¸éªŒè¯ 1. ä¸€é”®åŠ è½½é•œåƒè„šæœ¬ 1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/docker-image/load-images.sh) 2. åŠ è½½é•œåƒåˆ° Docker 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åŠ è½½taræ ¼å¼é•œåƒ docker load -i myimage.tar # åŠ è½½gzipå‹ç¼©çš„é•œåƒ gunzip -c myimage.tar.gz | docker load # æˆ–è€…ç›´æ¥åŠ è½½å‹ç¼©åŒ… docker load \u0026lt; myimage.tar.gz # ä»æŒ‡å®šè·¯å¾„åŠ è½½ docker load -i /path/to/your/image.tar # åŠ è½½æ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ docker load -i myimage.tar --verbose # åŠ è½½å¹¶é‡å‘½åé•œåƒ docker load -i myimage.tar docker tag \u0026lt;image_id\u0026gt; new_name:new_tag 3. éªŒè¯åŠ è½½ç»“æœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹å·²åŠ è½½çš„é•œåƒ docker images # æ£€æŸ¥é•œåƒè¯¦ç»†ä¿¡æ¯ docker image inspect myapp:latest # éªŒè¯é•œåƒå®Œæ•´æ€§ docker run --rm myapp:latest echo \u0026#34;Image loaded successfully!\u0026#34; # æŸ¥çœ‹åŠ è½½å†å² docker history myapp:latest # æ£€æŸ¥é•œåƒå¤§å°å’Œå±‚æ•° docker images --format \u0026#34;table {{.Repository}}\\t{{.Tag}}\\t{{.Size}}\\t{{.CreatedSince}}\u0026#34; # éªŒè¯é•œåƒå¯è¿è¡Œæ€§ docker run --rm myapp:latest --version 4. ç›®å½•æ“ä½œç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # è¿›å…¥å·¥ä½œç›®å½• cd /vol1/1000/home/md # åŠ è½½ç‰¹å®šé•œåƒ docker load -i md.tar # éªŒè¯åŠ è½½ docker images | grep md # æ‰¹é‡åŠ è½½ç›®å½•ä¸‹æ‰€æœ‰é•œåƒæ–‡ä»¶ for f in *.tar; do echo \u0026#34;Loading $f...\u0026#34; docker load -i \u0026#34;$f\u0026#34; done # åŠ è½½å‹ç¼©æ ¼å¼é•œåƒ for f in *.tar.gz; do echo \u0026#34;Loading $f...\u0026#34; gunzip -c \u0026#34;$f\u0026#34; | docker load done ğŸ” ä¸‰ã€éªŒè¯ä¸ç®¡ç†ç­–ç•¥ 1. é•œåƒéªŒè¯æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # éªŒè¯é•œåƒå®Œæ•´æ€§ docker image inspect myapp:latest | grep -E \u0026#34;(Id|Size|Architecture)\u0026#34; # æ£€æŸ¥é•œåƒå±‚ docker history myapp:latest # è¿è¡Œæµ‹è¯•å®¹å™¨ docker run --rm myapp:latest --version # éªŒè¯ç«¯å£æš´éœ² docker image inspect myapp:latest --format=\u0026#39;{{.Config.ExposedPorts}}\u0026#39; # æ£€æŸ¥ç¯å¢ƒå˜é‡ docker image inspect myapp:latest --format=\u0026#39;{{.Config.Env}}\u0026#39; # éªŒè¯å…¥å£ç‚¹ docker image inspect myapp:latest --format=\u0026#39;{{.Config.Entrypoint}}\u0026#39; # æ£€æŸ¥å·¥ä½œç›®å½• docker image inspect myapp:latest --format=\u0026#39;{{.Config.WorkingDir}}\u0026#39; # éªŒè¯å¥åº·æ£€æŸ¥é…ç½® docker image inspect myapp:latest --format=\u0026#39;{{.Config.Healthcheck}}\u0026#39; 2. é•œåƒç®¡ç†æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # ç»™åŠ è½½çš„é•œåƒæ·»åŠ æ ‡ç­¾ docker tag 42c0d7908c02 myapp:production # åˆ é™¤ä¸éœ€è¦çš„é•œåƒ docker rmi old_image:tag # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ docker system df # æ‰¹é‡åˆ é™¤é•œåƒ docker rmi $(docker images -q -f \u0026#34;dangling=true\u0026#34;) # æŒ‰æ¨¡å¼åˆ é™¤é•œåƒ docker images | grep \u0026#34;none\u0026#34; | awk \u0026#39;{print $3}\u0026#39; | xargs docker rmi # åˆ é™¤æ‰€æœ‰é•œåƒï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ docker rmi $(docker images -q) # å¯¼å‡ºé•œåƒåˆ—è¡¨ docker images --format \u0026#34;{{.Repository}}:{{.Tag}}\u0026#34; \u0026gt; image_list.txt # å¯¼å…¥é•œåƒåˆ—è¡¨å¹¶æ‹‰å– cat image_list.txt | xargs -L1 docker pull 3. é•œåƒä¿¡æ¯å¯¼å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¯¼å‡ºé•œåƒä¿¡æ¯åˆ°æ–‡ä»¶ docker images --format \u0026#34;{{.Repository}}:{{.Tag}}\u0026#34; \u0026gt; image_list.txt # ç”Ÿæˆé•œåƒæ¸…å• docker images --format \u0026#34;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}\\t{{.CreatedAt}}\\t{{.Size}}\u0026#34; \u0026gt; images_inventory.txt # å¯¼å‡ºè¯¦ç»†é•œåƒä¿¡æ¯ docker images --no-trunc \u0026gt; detailed_images.txt # å¯¼å‡ºé•œåƒåˆ†å±‚ä¿¡æ¯ for image in $(docker images -q); do echo \u0026#34;Image: $(docker image inspect $image --format \u0026#39;{{.RepoTags}}\u0026#39;)\u0026#34; \u0026gt;\u0026gt; image_layers.txt docker history $image \u0026gt;\u0026gt; image_layers.txt echo \u0026#34;---\u0026#34; \u0026gt;\u0026gt; image_layers.txt done # åˆ›å»ºé•œåƒæŠ¥å‘Š docker info \u0026gt; docker_system_report.txt docker images \u0026gt;\u0026gt; docker_system_report.txt docker system df \u0026gt;\u0026gt; docker_system_report.txt ğŸ’¡ å››ã€å®ç”¨æŠ€å·§ä¸ä¼˜åŒ– 1. å¿«é€Ÿè¿ç§»æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # 1. åœ¨ä¸€å°æœºå™¨ä¸Šæ‰“åŒ… docker save -o myapp.tar myapp:latest # 2. ä½¿ç”¨rsyncå¿«é€Ÿä¼ è¾“ï¼ˆå¦‚æœæœ‰å¤šå°æœºå™¨ï¼‰ rsync -avz myapp.tar user@remote-server:/tmp/ # 3. åœ¨ç›®æ ‡æœºå™¨ä¸ŠåŠ è½½ ssh user@remote-server \u0026#34;docker load -i /tmp/myapp.tar\u0026#34; # 4. éªŒè¯éƒ¨ç½² ssh user@remote-server \u0026#34;docker run -d -p 80:80 myapp:latest\u0026#34; # 5. ä½¿ç”¨å‹ç¼©ä¼ è¾“èŠ‚çœå¸¦å®½ docker save myapp:latest | gzip | ssh user@remote-server \u0026#34;gunzip | docker load\u0026#34; # 6. ä½¿ç”¨pvæ˜¾ç¤ºä¼ è¾“è¿›åº¦ docker save myapp:latest | pv | ssh user@remote-server \u0026#34;docker load\u0026#34; # 7. å¤šæœåŠ¡å™¨å¹¶è¡Œéƒ¨ç½² for server in server1 server2 server3; do scp myapp.tar user@$server:/tmp/ \u0026amp; done wait for server in server1 server2 server3; do ssh user@$server \u0026#34;docker load -i /tmp/myapp.tar\u0026#34; \u0026amp; done wait 2. ç©ºé—´ä¼˜åŒ–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æ‰“åŒ…å‰æ¸…ç†ä¸å¿…è¦çš„é•œåƒå±‚ docker image prune -a # ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å° # åœ¨Dockerfileä¸­ä½¿ç”¨å¤šé˜¶æ®µæ„å»º # å‹ç¼©æ‰“åŒ…æ–‡ä»¶ docker save myapp:latest | gzip -9 \u0026gt; myapp.tar.gz # æ¯”è¾ƒå‹ç¼©æ•ˆæœ ls -lh myapp.tar* # ä½¿ç”¨pigzè¿›è¡Œå¹¶è¡Œå‹ç¼©ï¼ˆæ›´å¿«ï¼‰ docker save myapp:latest | pigz -9 \u0026gt; myapp.tar.gz # ä½¿ç”¨zstdè¿›è¡Œé«˜æ•ˆå‹ç¼© docker save myapp:latest | zstd -19 -o myapp.tar.zst # åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶å‡å°é•œåƒå¤§å° docker export \u0026lt;container_id\u0026gt; | docker import - optimized_image:latest # ä½¿ç”¨å°åŸºç¡€é•œåƒ FROM alpine:latest # ä½¿ç”¨é•œåƒæ‰å¹³åŒ–å·¥å…· docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \\ dockerflatten/docker-flatten:latest myapp:latest 3. ç‰ˆæœ¬æ§åˆ¶æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # ä¸ºé•œåƒæ–‡ä»¶æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯ VERSION=\u0026#34;1.2.3\u0026#34; docker save -o \u0026#34;myapp_v${VERSION}.tar\u0026#34; myapp:latest # ä½¿ç”¨æ—¥æœŸæ—¶é—´æˆ³ TIMESTAMP=$(date +%Y%m%d_%H%M%S) docker save -o \u0026#34;backup_${TIMESTAMP}.tar\u0026#34; myapp:latest # ä½¿ç”¨Gitå“ˆå¸Œå€¼ï¼ˆå¦‚æœä»Gitä»“åº“æ„å»ºï¼‰ COMMIT_HASH=$(git rev-parse --short HEAD) docker save -o \u0026#34;myapp_${COMMIT_HASH}.tar\u0026#34; myapp:latest # ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ MAJOR=1 MINOR=2 PATCH=3 BUILD=$(date +%Y%m%d%H%M) docker save -o \u0026#34;myapp_${MAJOR}.${MINOR}.${PATCH}+build.${BUILD}.tar\u0026#34; myapp:latest # åˆ›å»ºç‰ˆæœ¬æ¸…å•æ–‡ä»¶ echo \u0026#34;myapp:latest -\u0026gt; myapp_v${VERSION}.tar\u0026#34; \u0026gt; version_manifest.txt echo \u0026#34;Built: $(date)\u0026#34; \u0026gt;\u0026gt; version_manifest.txt echo \u0026#34;Docker version: $(docker --version)\u0026#34; \u0026gt;\u0026gt; version_manifest.txt # ä½¿ç”¨æ ¡éªŒå’ŒéªŒè¯æ–‡ä»¶å®Œæ•´æ€§ sha256sum myapp_v${VERSION}.tar \u0026gt; myapp_v${VERSION}.tar.sha256 # éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ sha256sum -c myapp_v${VERSION}.tar.sha256 âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ä¸é—®é¢˜è§£å†³ 1. é‡è¦è­¦å‘Š å­˜å‚¨ç©ºé—´: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜æ”¾æ‰“åŒ…æ–‡ä»¶\n1 2 3 4 5 6 7 8 # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h . # æ¸…ç†Dockerç¼“å­˜ docker system prune -a # æŸ¥çœ‹Dockerç£ç›˜ä½¿ç”¨ docker system df æƒé™é—®é¢˜: ç¡®ä¿å¯¹ç›®æ ‡ç›®å½•æœ‰å†™æƒé™\n1 2 3 4 5 6 7 8 # æ£€æŸ¥ç›®å½•æƒé™ ls -la /path/to/directory # æ›´æ”¹ç›®å½•æƒé™ chmod 755 /target/directory # æ›´æ”¹ç›®å½•æ‰€æœ‰è€… chown $USER /target/directory ç½‘ç»œéš”ç¦»: åœ¨ç¦»çº¿ç¯å¢ƒä¸­æµ‹è¯•é•œåƒåŠŸèƒ½\n1 2 3 4 5 # æµ‹è¯•ç¦»çº¿è¿è¡Œ docker run --rm --net=none myapp:latest # ç¦ç”¨ç½‘ç»œè®¿é—® docker run --rm --network none myapp:latest æ¶æ„å…¼å®¹æ€§: ç¡®ä¿é•œåƒä¸ç›®æ ‡å¹³å°æ¶æ„å…¼å®¹\n1 2 3 4 5 6 7 8 # æ£€æŸ¥é•œåƒæ¶æ„ docker image inspect myapp:latest --format=\u0026#39;{{.Architecture}}\u0026#39; # æ£€æŸ¥ä¸»æœºæ¶æ„ uname -m # æ„å»ºå¤šæ¶æ„é•œåƒ docker buildx build --platform linux/amd64,linux/arm64 -t myapp:latest . 2. æœ€ä½³å®è·µ éªŒè¯å®Œæ•´æ€§: åŠ è½½åç«‹å³éªŒè¯é•œåƒå®Œæ•´æ€§\n1 2 3 4 5 6 # è¿è¡ŒåŸºæœ¬æµ‹è¯• docker run --rm myapp:latest echo \u0026#34;Test successful\u0026#34; # æ£€æŸ¥é€€å‡ºä»£ç  docker run --rm myapp:latest /bin/true echo $? ç‰ˆæœ¬æ ‡è®°: ä¸ºæ‰“åŒ…æ–‡ä»¶æ·»åŠ æ¸…æ™°çš„ç‰ˆæœ¬ä¿¡æ¯\n1 2 3 4 5 6 7 # ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ VERSION=\u0026#34;1.2.3\u0026#34; docker save -o \u0026#34;myapp_v${VERSION}.tar\u0026#34; myapp:latest # åŒ…å«æ„å»ºæ—¥æœŸ DATE=$(date +%Y%m%d) docker save -o \u0026#34;myapp_${DATE}.tar\u0026#34; myapp:latest æ–‡æ¡£è®°å½•: è®°å½•æ‰“åŒ…å†…å®¹å’Œç‰ˆæœ¬ä¿¡æ¯\n1 2 3 4 5 # åˆ›å»ºæ¸…å•æ–‡ä»¶ echo \u0026#34;Image: myapp:latest\u0026#34; \u0026gt; manifest.txt echo \u0026#34;Saved: $(date)\u0026#34; \u0026gt;\u0026gt; manifest.txt echo \u0026#34;Size: $(du -h myapp.tar | cut -f1)\u0026#34; \u0026gt;\u0026gt; manifest.txt echo \u0026#34;Checksum: $(sha256sum myapp.tar | cut -d\u0026#39; \u0026#39; -f1)\u0026#34; \u0026gt;\u0026gt; manifest.txt å®šæœŸæ¸…ç†: åˆ é™¤ä¸å†éœ€è¦çš„é•œåƒåŒ…æ–‡ä»¶\n1 2 3 4 5 # åˆ é™¤è¶…è¿‡30å¤©çš„å¤‡ä»½ find /backup -name \u0026#34;*.tar\u0026#34; -mtime +30 -delete # ä¿ç•™æœ€è¿‘10ä¸ªå¤‡ä»½ ls -t /backup/*.tar | tail -n +11 | xargs rm -f 3. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # é—®é¢˜: åŠ è½½æ—¶æ˜¾ç¤º\u0026#34;no space left on device\u0026#34; # è§£å†³æ–¹æ¡ˆ: æ¸…ç†ç£ç›˜ç©ºé—´æˆ–ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ docker system prune -a df -h . # é—®é¢˜: æƒé™è¢«æ‹’ç» # è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨sudoæˆ–æ›´æ”¹ç›®å½•æƒé™ sudo docker load -i image.tar # æˆ–è€… chmod 755 /target/directory # é—®é¢˜: é•œåƒåŠ è½½ä½†æ— æ³•è¿è¡Œ # è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥æ¶æ„å…¼å®¹æ€§ docker image inspect myapp:latest | grep Architecture uname -m # é—®é¢˜: é•œåƒæ ‡ç­¾ä¸¢å¤± # è§£å†³æ–¹æ¡ˆ: æ‰‹åŠ¨æ·»åŠ æ ‡ç­¾ docker tag \u0026lt;image_id\u0026gt; myapp:latest # é—®é¢˜: åŠ è½½é€Ÿåº¦æ…¢ # è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨å‹ç¼©æ ¼å¼æˆ–å¹¶è¡ŒåŠ è½½ docker load -i image.tar \u0026amp; # åå°åŠ è½½ wait # ç­‰å¾…æ‰€æœ‰åŠ è½½å®Œæˆ # é—®é¢˜: é•œåƒæŸå # è§£å†³æ–¹æ¡ˆ: é‡æ–°æ‰“åŒ…å’Œä¼ è¾“ # åœ¨åŸæœºå™¨ä¸Šé‡æ–°æ‰“åŒ… docker save -o new_image.tar myapp:latest # é‡æ–°ä¼ è¾“å¹¶åŠ è½½ # é—®é¢˜: å†…å­˜ä¸è¶³ # è§£å†³æ–¹æ¡ˆ: å¢åŠ äº¤æ¢ç©ºé—´æˆ–å‡å°‘å¹¶å‘åŠ è½½ sudo fallocate -l 2G /swapfile sudo chmod 600 /swapfile sudo mkswap /swapfile sudo swapon /swapfile ğŸš€ å…­ã€é«˜çº§åº”ç”¨åœºæ™¯ 1. è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æœ¬åœ°æ‰“åŒ…åä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ docker save -o myapp.tar myapp:latest scp myapp.tar user@remote-server:/tmp/ # åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸ŠåŠ è½½å¹¶è¿è¡Œ ssh user@remote-server \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; cd /tmp docker load -i myapp.tar docker run -d -p 80:80 myapp:latest docker ps EOF # ä½¿ç”¨ansibleè¿›è¡Œå¤šæœåŠ¡å™¨éƒ¨ç½² ansible all -m copy -a \u0026#34;src=myapp.tar dest=/tmp/myapp.tar\u0026#34; ansible all -m shell -a \u0026#34;docker load -i /tmp/myapp.tar\u0026#34; ansible all -m shell -a \u0026#34;docker run -d -p 80:80 myapp:latest\u0026#34; # ä½¿ç”¨å‹ç¼©ä¼ è¾“èŠ‚çœæ—¶é—´ docker save myapp:latest | gzip | ssh user@remote-server \u0026#34;gunzip | docker load\u0026#34; # ä½¿ç”¨taræµå¼ä¼ è¾“é¿å…ä¸´æ—¶æ–‡ä»¶ docker save myapp:latest | ssh user@remote-server \u0026#34;docker load\u0026#34; # ä½¿ç”¨å¸¦å®½é™åˆ¶é¿å…ç½‘ç»œæ‹¥å µ docker save myapp:latest | pv -L 1m | ssh user@remote-server \u0026#34;docker load\u0026#34; 2. è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 #!/bin/bash # automated_deployment.sh REMOTE_USER=\u0026#34;deploy\u0026#34; REMOTE_HOST=\u0026#34;example.com\u0026#34; IMAGE_NAME=\u0026#34;myapp\u0026#34; IMAGE_TAG=\u0026#34;latest\u0026#34; BACKUP_DIR=\u0026#34;/backup/$(date +%Y%m%d_%H%M%S)\u0026#34; # æœ¬åœ°æ‰“åŒ… echo \u0026#34;ğŸ“¦ æ‰“åŒ…é•œåƒ...\u0026#34; docker save -o \u0026#34;${IMAGE_NAME}.tar\u0026#34; \u0026#34;${IMAGE_NAME}:${IMAGE_TAG}\u0026#34; # åˆ›å»ºå¤‡ä»½ç›®å½• ssh ${REMOTE_USER}@${REMOTE_HOST} \u0026#34;mkdir -p ${BACKUP_DIR}\u0026#34; # ä¼ è¾“åˆ°è¿œç¨‹ echo \u0026#34;ğŸ“¤ ä¼ è¾“åˆ°è¿œç¨‹æœåŠ¡å™¨...\u0026#34; scp \u0026#34;${IMAGE_NAME}.tar\u0026#34; ${REMOTE_USER}@${REMOTE_HOST}:${BACKUP_DIR}/ # è¿œç¨‹éƒ¨ç½² echo \u0026#34;ğŸš€ è¿œç¨‹éƒ¨ç½²...\u0026#34; ssh ${REMOTE_USER}@${REMOTE_HOST} \u0026lt;\u0026lt; EOF cd ${BACKUP_DIR} echo \u0026#34;åŠ è½½é•œåƒ...\u0026#34; docker load -i \u0026#34;${IMAGE_NAME}.tar\u0026#34; echo \u0026#34;åœæ­¢æ—§å®¹å™¨...\u0026#34; docker stop ${IMAGE_NAME} || true docker rm ${IMAGE_NAME} || true echo \u0026#34;å¯åŠ¨æ–°å®¹å™¨...\u0026#34; docker run -d \\ --name ${IMAGE_NAME} \\ --restart unless-stopped \\ -p 80:80 \\ -p 443:443 \\ -v /app/config:/config \\ ${IMAGE_NAME}:${IMAGE_TAG} echo \u0026#34;æ¸…ç†æ—§é•œåƒ...\u0026#34; docker image prune -f echo \u0026#34;éªŒè¯éƒ¨ç½²...\u0026#34; sleep 10 docker ps curl -s http://localhost:80/health | grep \u0026#34;OK\u0026#34; || echo \u0026#34;Health check failed\u0026#34; echo \u0026#34;ä¿ç•™æœ€è¿‘5ä¸ªå¤‡ä»½...\u0026#34; ls -dt /backup/* | tail -n +6 | xargs rm -rf EOF # æ¸…ç†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ rm -f \u0026#34;${IMAGE_NAME}.tar\u0026#34; echo \u0026#34;âœ… éƒ¨ç½²å®Œæˆ!\u0026#34; 3. é•œåƒä»“åº“å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # ä»ä»“åº“æ‹‰å–å¹¶å¤‡ä»½ docker pull myregistry.com/myapp:latest docker save -o myapp_backup.tar myregistry.com/myapp:latest # æˆ–è€…ç›´æ¥ä¿å­˜åˆ°ä»“åº“æ ¼å¼ docker save myregistry.com/myapp:latest | \\ gzip \u0026gt; myapp_backup_$(date +%Y%m%d).tar.gz # å¤‡ä»½æ•´ä¸ªä»“åº“çš„é•œåƒ REPOSITORY=\u0026#34;myregistry.com\u0026#34; IMAGES=$(docker images --format \u0026#34;{{.Repository}}:{{.Tag}}\u0026#34; | grep \u0026#34;$REPOSITORY\u0026#34;) docker save -o ${REPOSITORY}_backup.tar $IMAGES # ä½¿ç”¨skopeoè¿›è¡Œé«˜çº§ä»“åº“æ“ä½œ skopeo copy docker://myregistry.com/myapp:latest dir:./myapp_backup # ä½¿ç”¨registryå·¥å…·å¤‡ä»½æ•´ä¸ªä»“åº“ docker run --rm -v /backup:/backup -v /var/run/docker.sock:/var/run/docker.sock \\ gocontainerregistry/cmd/registry /backup registry.mycompany.com # åŠ å¯†å¤‡ä»½æ–‡ä»¶ docker save myapp:latest | gpg -c -o myapp_backup.tar.gpg # åˆ†å‰²å¤§æ–‡ä»¶ä¾¿äºä¼ è¾“ docker save myapp:latest | gzip | split -b 100M - myapp_backup.tar.gz.part_ # åˆå¹¶åˆ†å‰²æ–‡ä»¶ cat myapp_backup.tar.gz.part_* | gunzip | docker load ğŸ‰ æ€»ç»“ï¼šé€šè¿‡æŒæ¡Dockeré•œåƒçš„æ‰“åŒ…ä¸åŠ è½½æŠ€å·§ï¼Œä½ å¯ä»¥å®ç°é«˜æ•ˆçš„ç¯å¢ƒè¿ç§»ã€å¿«é€Ÿéƒ¨ç½²å’Œå¯é çš„ç¾éš¾æ¢å¤ã€‚è®°ä½ï¼Œè‰¯å¥½çš„é•œåƒç®¡ç†ä¹ æƒ¯æ˜¯DevOpsæˆåŠŸçš„å…³é”®ï¼\nğŸ’ª å®è·µå»ºè®®ï¼š\nå»ºç«‹æ ‡å‡†çš„é•œåƒå‘½åå’Œç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ å®šæœŸå¤‡ä»½é‡è¦é•œåƒå¹¶éªŒè¯å¤‡ä»½å®Œæ•´æ€§ è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ä»¥å‡å°‘äººä¸ºé”™è¯¯ ç›‘æ§Dockerç£ç›˜ä½¿ç”¨å¹¶åŠæ—¶æ¸…ç†ä¸å¿…è¦çš„é•œåƒ æµ‹è¯•ç¦»çº¿ç¯å¢ƒä¸‹çš„é•œåƒåŠ è½½å’Œè¿è¡Œèƒ½åŠ› ğŸš€ ç°åœ¨å°±å¼€å§‹ä½¿ç”¨è¿™äº›æŠ€å·§ï¼Œæå‡ä½ çš„Dockerå®¹å™¨ç®¡ç†èƒ½åŠ›å§ï¼\n","date":"2025-08-25T12:27:15+08:00","image":"https://file.meimolihan.eu.org/img/docker-images-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8dfed55d/","title":"Docker æœ¬åœ°é•œåƒæ‰“åŒ…ä¸åŠ è½½æŒ‡å— ğŸ³"},{"content":"Docker éƒ¨ç½² Cloud-Saver ç½‘ç›˜å½±è§†è½¬å­˜ç³»ç»Ÿ â˜ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Cloud-Saver 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Cloud-Saver 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/jiangrui1994/CloudSaver ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/jiangrui1994/cloudsaver Cloud-Saver æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘ç›˜å½±è§†è½¬å­˜ç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨ç›‘æ§å¤šä¸ªèµ„æºé¢‘é“å¹¶å°†æ„Ÿå…´è¶£çš„å½±è§†å†…å®¹è‡ªåŠ¨è½¬å­˜åˆ°æ‚¨çš„ç½‘ç›˜ï¼ˆå¦‚é˜¿é‡Œäº‘ç›˜ã€115ç½‘ç›˜ç­‰ï¼‰ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ Cloud-Saverï¼Œå®ç°å½±è§†èµ„æºçš„è‡ªåŠ¨æ”¶é›†å’Œç®¡ç†ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“º å¤šé¢‘é“ç›‘æ§ æ”¯æŒç›‘æ§å¤šä¸ªèµ„æºå‘å¸ƒé¢‘é“ å…¨é¢è¦†ç›–å„ç±»å½±è§†èµ„æº âš¡ è‡ªåŠ¨è½¬å­˜ å‘ç°æ–°èµ„æºåè‡ªåŠ¨è½¬å­˜åˆ°ç½‘ç›˜ èŠ‚çœæ‰‹åŠ¨æ“ä½œæ—¶é—´ ğŸ”” å®æ—¶é€šçŸ¥ æ”¯æŒè½¬å­˜ç»“æœé€šçŸ¥ åŠæ—¶äº†è§£è½¬å­˜çŠ¶æ€ ğŸ¯ æ™ºèƒ½è¿‡æ»¤ æ”¯æŒå…³é”®è¯è¿‡æ»¤å’Œæ’é™¤ ç²¾å‡†è·å–æ‰€éœ€å†…å®¹ ğŸŒ å¤šç½‘ç›˜æ”¯æŒ æ”¯æŒé˜¿é‡Œäº‘ç›˜ã€115ç½‘ç›˜ç­‰ çµæ´»é€‰æ‹©å­˜å‚¨å¹³å° ğŸ“Š ä»»åŠ¡ç®¡ç† æ¸…æ™°çš„è½¬å­˜ä»»åŠ¡ç®¡ç†ç•Œé¢ æ–¹ä¾¿æŸ¥çœ‹å’Œç®¡ç†è½¬å­˜è¿›åº¦ â° å®šæ—¶ä»»åŠ¡ æ”¯æŒè‡ªå®šä¹‰æ£€æŸ¥é¢‘ç‡ æŒ‰éœ€è®¾ç½®èµ„æºæ£€æŸ¥è®¡åˆ’ ğŸ”’ éšç§ä¿æŠ¤ æœ¬åœ°åŒ–éƒ¨ç½²ï¼Œæ•°æ®è‡ªæ§ ä¿æŠ¤ç”¨æˆ·éšç§å’Œå®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Cloud-Saver 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/cloud-saver \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: cloudsaver: container_name: cloud-saver image: jiangrui1994/cloudsaver:latest restart: always ports: - \u0026#34;8008:8008\u0026#34; volumes: - ./data:/app/data - ./config:/app/config environment: - TZ=Asia/Shanghai EOF âš ï¸ æ³¨æ„ï¼šé¦–æ¬¡å¯åŠ¨åï¼Œä½¿ç”¨é»˜è®¤æ³¨å†Œç ç™»å½•ï¼š\nç®¡ç†å‘˜è´¦å·: 230713 æ™®é€šç”¨æˆ·: 9527 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Cloud-Saver 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8008 åŸŸåè®¿é—®ï¼š https://cloud-saver.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤æ³¨å†Œç ç™»å½•ç³»ç»Ÿ æ·»åŠ æ‚¨çš„ç½‘ç›˜è´¦å·å¹¶å®Œæˆæˆæƒ è®¢é˜…èµ„æºé¢‘é“æˆ–æ‰¹é‡å¯¼å…¥é¢‘é“ é…ç½®è½¬å­˜è§„åˆ™å’Œè¿‡æ»¤æ¡ä»¶ å¼€å¯è‡ªåŠ¨è½¬å­˜åŠŸèƒ½ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://cloud-saver.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/cloud-saver.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name cloud-saver.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 0; location / { proxy_pass http://127.0.0.1:8008; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªçŸ¥è¯†ï¼Œæ¢ç´¢æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†æ€æºç¬”è®°ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° ç•…æ¸¸äºä¸ªäººçš„çŸ¥è¯†æµ·æ´‹ï¼Œè®°å½•çµæ„Ÿã€æ•´ç†æ€ç»ªã€æ„å»ºç³»ç»Ÿ\nğŸ” å®Œå…¨è‡ªä¸» æŒæ§æ‰€æœ‰æ•°æ®ï¼Œéšç§å®‰å…¨æ— å¿§ï¼Œç¬”è®°çœŸæ­£å±äºä½ è‡ªå·±\nâš¡ é«˜æ•ˆæµç•… äº«å—å—çº§ç¼–è¾‘ã€åŒå‘é“¾æ¥å¸¦æ¥çš„æè‡´ä¹¦å†™ä¸ç®¡ç†ä½“éªŒ\nçŸ¥è¯†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸è‡ªæˆ‘å¯¹è¯çš„æ¼«é•¿æ—…è¡Œã€‚æ„¿æ€æºç¬”è®°æˆä¸ºä½ å¿ å®çš„ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªæ€è€ƒçš„å¤œæ™šå’Œçµæ„Ÿçš„æ¸…æ™¨ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ’­ç§æ€è€ƒï¼Œæ”¶è·æ™ºæ…§â€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„æ•°å­—èŠ±å›­å§ï¼ğŸŒ¿\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ æ€æºç¬”è®°å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¹¦å†™æ„‰å¿«ï¼Œç¬”è®°æœ‰æˆï¼ğŸ‰\n","date":"2025-08-25T12:25:31+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-cloud-saver-001.webp","permalink":"https://blog.meimolihan.eu.org/p/34f77b0f/","title":"Docker éƒ¨ç½² Cloud-Saver ç½‘ç›˜å½±è§†è½¬å­˜ç³»ç»Ÿ â˜ï¸"},{"content":"Docker éƒ¨ç½² Sun-Panel Helperå¯¼èˆªé¢æ¿ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Sun-Panel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Sun-Panel 1. è®¿é—® Web ç•Œé¢ ğŸŒ 2. åˆå§‹é…ç½®æ­¥éª¤ ğŸ¯ 3. æ·»åŠ  Docker åº”ç”¨ ğŸ“¦ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå¯¼èˆªï¼Œæ•ˆç‡æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ MinDoc å®˜ç½‘åœ°å€ï¼š https://doc.sun-panel.top/zh_cn/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/hslr-s/sun-panel ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/hslr/sun-panel ğŸŒ åœ¨çº¿æ¼”ç¤º: http://sunpaneldemo.enianteam.com/ Sun-Panel æ˜¯ä¸€æ¬¾åŸºäº Vue å’Œ Go è¯­è¨€å¼€å‘çš„è½»é‡çº§å¯¼èˆªé¢æ¿ï¼Œå¯ä»¥ä½œä¸ºæœåŠ¡å™¨ã€NASå¯¼èˆªé¢æ¿ã€Homepageæˆ–æµè§ˆå™¨é¦–é¡µä½¿ç”¨ã€‚è¯¥é¡¹ç›®å…·æœ‰ç•Œé¢ç®€æ´ã€èµ„æºå ç”¨å°‘çš„ç‰¹ç‚¹ï¼Œæ”¯æŒDockeréƒ¨ç½²å’ŒARMæ¶æ„ï¼Œæ— éœ€å¤–éƒ¨æ•°æ®åº“ï¼Œéå¸¸é€‚åˆä¸ªäººå’Œä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ‰ ç•Œé¢ç®€æ´ ç›´è§‚æ¸…æ™°çš„ç•Œé¢è®¾è®¡ï¼Œèµ„æºæ¶ˆè€—ä½ æä¾›æ¸…çˆ½çš„ç”¨æˆ·ä½“éªŒ ğŸŠ æ˜“äºä½¿ç”¨ å¯è§†åŒ–æ“ä½œï¼Œé›¶ä»£ç ä½¿ç”¨ æ— éœ€æŠ€æœ¯èƒŒæ™¯å³å¯ä¸Šæ‰‹ ğŸ  ç½‘ç»œæ¨¡å¼åˆ‡æ¢ ä¸€é”®åˆ‡æ¢å†…éƒ¨å’Œå¤–éƒ¨ç½‘ç»œæ¨¡å¼é“¾æ¥ çµæ´»é€‚åº”ä¸åŒç½‘ç»œç¯å¢ƒ ğŸ³ Dockeræ”¯æŒ æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå…¼å®¹ARMç³»ç»Ÿ è·¨å¹³å°éƒ¨ç½²ä¾¿æ· ğŸ‘¥ å¤šè´¦æˆ·éš”ç¦» æ”¯æŒå¤šè´¦å·éš”ç¦»ä½¿ç”¨ é€‚åˆå›¢é˜Ÿåä½œä½¿ç”¨ ğŸ“Š ç³»ç»ŸçŠ¶æ€ç›‘æ§ æ”¯æŒæŸ¥çœ‹CPUã€å†…å­˜å’Œç¡¬ç›˜çŠ¶æ€ å®æ—¶æŒæ¡ç³»ç»Ÿè¿è¡ŒçŠ¶å†µ ğŸ¨ ä¸ªæ€§åŒ–å®šåˆ¶ æ”¯æŒè‡ªå®šä¹‰JSã€CSSå’Œä¸°å¯Œå›¾æ ‡æ ·å¼ é«˜åº¦å¯å®šåˆ¶åŒ–ç•Œé¢ ğŸªŸ å°çª—å£æ¨¡å¼ æ”¯æŒç½‘é¡µå†…ç½®å°çª—å£æ‰“å¼€ æå‡å¤šä»»åŠ¡æ“ä½œæ•ˆç‡ ğŸ’¾ æ— éœ€å¤–éƒ¨æ•°æ®åº“ ç®€å•ä½¿ç”¨å¯ä»¥æ— éœ€è¿æ¥å¤–éƒ¨æ•°æ®åº“ ç®€åŒ–éƒ¨ç½²å’Œç»´æŠ¤æµç¨‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Sun-Panel Helper 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 mkdir -p /data/sun-panel-helper/ \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: sun-panel: image: hslr/sun-panel:latest container_name: sun-panel network_mode: bridge restart: always volumes: - ./conf:/app/conf - /var/run/docker.sock:/var/run/docker.sock - /vol1:/vol1 - /vol2:/vol2 - /vol3:/vol3 ports: - 3002:3002 sun-panel-helper: image: madrays/sun-panel-helper:latest container_name: sun-panel-helper network_mode: bridge restart: always environment: - BACKEND_PORT=3111 ports: - 33002:80 volumes: - ./conf/custom:/app/backend/custom - ./helper/data:/app/backend/data - ./helper/backups:/app/backend/backups EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Sun-Panel Helper 1. è®¿é—® Web ç•Œé¢ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š\næœ¬åœ°è®¿é—®: http://localhost:3002 åŸŸåè®¿é—®: https://sun-panel.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ é»˜è®¤ç™»å½•ä¿¡æ¯ï¼š\nğŸ‘‘ ç”¨æˆ·åï¼šadmin@sun.cc ğŸ”‘ å¯†ç ï¼š12345678 2. åˆå§‹é…ç½®æ­¥éª¤ ğŸ¯ æ­¥éª¤ æ“ä½œ è¯´æ˜ 1 ä¿®æ”¹é»˜è®¤å¯†ç  ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼Œç¡®ä¿å®‰å…¨ 2 æ·»åŠ å¯¼èˆªé¡¹ç›® ç‚¹å‡»é¡µé¢ä¸Šçš„\u0026quot;+\u0026ldquo;å·æ·»åŠ å¸¸ç”¨ç½‘ç«™æˆ–åº”ç”¨ 3 åˆ†ç»„ç®¡ç† åœ¨\u0026quot;ç³»ç»Ÿåº”ç”¨\u0026quot;è®¾ç½®ä¸­åˆ›å»ºå’Œç®¡ç†å¯¼èˆªåˆ†ç»„ 4 ä¸ªæ€§åŒ–è®¾ç½® é…ç½®ç•Œé¢é£æ ¼ã€æ—¶é—´æ˜¾ç¤ºã€æœç´¢æ¡†ç­‰ 3. æ·»åŠ  Docker åº”ç”¨ ğŸ“¦ åœ¨Sun-Panelä¸­æ·»åŠ Dockeråº”ç”¨é“¾æ¥ è®¾ç½®æ‰“å¼€æ–¹å¼ä¸º\u0026quot;å¼¹çª—æ‰“å¼€\u0026rdquo; ç³»ç»Ÿä¼šè‡ªåŠ¨è·å–åº”ç”¨å›¾æ ‡ï¼Œä¹Ÿå¯æ‰‹åŠ¨ä¸Šä¼ è‡ªå®šä¹‰å›¾æ ‡ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://sun-panel.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/sun-panel.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name sun.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 10M; location / { proxy_pass http://localhost:3002; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; proxy_http_version 1.1; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— # å¯†ç é‡ç½® docker exec -it sun-panel ./sun-panel -password-reset 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå¯¼èˆªï¼Œæ•ˆç‡æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Sun-Panel å¯¼èˆªé¢æ¿ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ ç»Ÿä¸€å…¥å£ é›†ä¸­ç®¡ç†æ‰€æœ‰å¸¸ç”¨ç½‘ç«™å’Œåº”ç”¨ï¼Œæ‰“é€ ä¸ªæ€§åŒ–çš„å¯¼èˆªé¦–é¡µ\nğŸ“Š çŠ¶æ€ç›‘æ§ å®æ—¶æŒæ¡ç³»ç»Ÿè¿è¡ŒçŠ¶å†µï¼ŒCPUã€å†…å­˜å’Œç¡¬ç›˜ä½¿ç”¨æƒ…å†µä¸€ç›®äº†ç„¶\nğŸ¨ ä¸ªæ€§å®šåˆ¶ è‡ªç”±æ­é…å›¾æ ‡æ ·å¼ï¼Œæ”¯æŒè‡ªå®šä¹‰ JS å’Œ CSSï¼Œæ‰“é€ ä¸“å±ç•Œé¢é£æ ¼\nå¯¼èˆªä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•ˆç‡åŒè¡Œçš„ä¾¿æ·æ—…ç¨‹ã€‚æ„¿ Sun-Panel æˆä¸ºä½ é«˜æ•ˆçš„å¯¼èˆªåŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å¿«é€Ÿè®¿é—®å’Œèµ„æºç®¡ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé«˜æ•ˆå¯¼èˆªï¼Œä¾¿æ·è®¿é—®â€”â€”æ„å»ºä½ ç»Ÿä¸€é«˜æ•ˆçš„æ“ä½œå…¥å£å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Sun-Panel å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œæ•ˆç‡å€å¢ï¼ğŸ‰\n","date":"2025-08-25T12:23:40+08:00","image":"https://file.meimolihan.eu.org/imng/sun-panel-helper-01.webp","permalink":"https://blog.meimolihan.eu.org/p/adb008f0/","title":"Docker éƒ¨ç½² Sun-Panel Helperå¯¼èˆªé¢æ¿ ğŸ³"},{"content":"Docker éƒ¨ç½² Dufs æ–‡ä»¶æœåŠ¡ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Dufs 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Dufs 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åŠŸèƒ½éªŒè¯æµ‹è¯• ğŸ§ª ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ–‡ä»¶ï¼Œå…±äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/sigoden/dufs ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/sigoden/dufs Dufs æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸ªäººæˆ–å›¢é˜Ÿä½¿ç”¨çš„æ–‡ä»¶å…±äº«æœåŠ¡ã€‚ğŸŒŸ\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“ å¤šåè®®æ”¯æŒ æ”¯æŒ HTTPã€WebDAV ç­‰å¤šç§åè®® çµæ´»é€‚åº”ä¸åŒä½¿ç”¨åœºæ™¯ ğŸ” è®¤è¯æœºåˆ¶ æ”¯æŒåŸºæœ¬è®¤è¯å’Œä»¤ç‰Œè®¤è¯ ä¿éšœæ–‡ä»¶è®¿é—®å®‰å…¨ ğŸ“Š æ–‡ä»¶ç®¡ç† æä¾›å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤åŠŸèƒ½ å®Œæ•´çš„æ–‡ä»¶æ“ä½œä½“éªŒ ğŸ¨ ç¾è§‚ç•Œé¢ ç°ä»£åŒ–çš„ Web æ–‡ä»¶ç®¡ç†ç•Œé¢ æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ âš¡ é«˜æ€§èƒ½ åŸºäº Rust å¼€å‘ï¼Œèµ„æºå ç”¨ä½æ€§èƒ½é«˜ é«˜æ•ˆå¤„ç†å¤§é‡æ–‡ä»¶è¯·æ±‚ ğŸ”§ æ˜“äºéƒ¨ç½² Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œç®€å•å¿«æ· å¿«é€Ÿæ­å»ºæ–‡ä»¶æœåŠ¡ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Dufs 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 mkdir -p /vol1/1000/compose/dufs \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: dufs: command: /data -A container_name: dufs image: sigoden/dufs network_mode: bridge restart: always ports: - 5000:5000 volumes: - ./data:/data - ./README.md:/data/README.md - /vol2/1000/é˜¿é‡Œäº‘ç›˜:/data/é˜¿é‡Œäº‘ç›˜ - /vol2/1000/downloads:/data/downloads - /vol2/1000/file:/data/file - /vol2/1000/å…‰å½±é›†:/data/media - /vol2/1000/backup:/data/backup - /vol1/1000/compose/random-pic-api/photos:/data/å£çº¸å¾…å¤„ç† - /vol2/1000/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/å£çº¸åŸå›¾:/data/å£çº¸åŸå›¾ # command: /data -A # å…è®¸æ‰€æœ‰æ“ä½œï¼Œå¦‚ä¸Šä¼ /åˆ é™¤/æœç´¢/åˆ›å»º/ç¼–è¾‘...ï¼ŒæœåŠ¡/dataç›®å½• # command: /data -A --compress none # ç¦ç”¨å‹ç¼©ï¼ˆå¤§æ–‡ä»¶ä¼ è¾“æ›´é«˜æ•ˆï¼‰ # command: /data -a admin:123@/:rw # å¯†ç ä¿æŠ¤ EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Dufs 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:5000 åŸŸåè®¿é—®: https://dufs.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åŠŸèƒ½éªŒè¯æµ‹è¯• ğŸ§ª æµ‹è¯•é¡¹ç›® å‘½ä»¤ é¢„æœŸç»“æœ æœåŠ¡çŠ¶æ€æ£€æŸ¥ curl -I http://localhost:5000 è¿”å› HTTP 200 çŠ¶æ€ç  æ–‡ä»¶ä¸Šä¼ æµ‹è¯• curl -X POST -F \u0026quot;file=@test.txt\u0026quot; http://localhost:5000/upload æ–‡ä»¶æˆåŠŸä¸Šä¼  ç›®å½•åˆ—è¡¨æŸ¥çœ‹ curl http://localhost:5000 æ˜¾ç¤ºç›®å½•æ–‡ä»¶åˆ—è¡¨ æ–‡ä»¶ä¸‹è½½æµ‹è¯• curl -O http://localhost:5000/test.txt æ–‡ä»¶æˆåŠŸä¸‹è½½ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://dufs.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/dufs.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; http2 on; server_name dufs.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½®ï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…è·¯å¾„ï¼‰ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; # TLS å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å“åº”å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options SAMEORIGIN always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # å¤§æ–‡ä»¶ä¼ è¾“æ”¯æŒ client_max_body_size 10G; proxy_request_buffering off; # åå‘ä»£ç†é…ç½® location / { proxy_pass http://localhost:5000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/dufs # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop dufs # åœæ­¢å®¹å™¨ docker start dufs # å¯åŠ¨å®¹å™¨ docker restart dufs # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm dufs # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f dufs # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it dufs sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect dufs # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats dufs # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs dufs # æŸ¥çœ‹æ—¥å¿— docker logs -f dufs # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 dufs # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t dufs # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— ## å¥åº·æ£€æŸ¥ docker inspect --format=\u0026#39;{{.State.Health.Status}}\u0026#39; dufs 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ–‡ä»¶ï¼Œå…±äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Dufs æ–‡ä»¶æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“ é«˜æ•ˆå…±äº« è½»æ¾å®ç°æ–‡ä»¶åœ¨çº¿è®¿é—®å’Œç®¡ç†ï¼Œæ”¯æŒå¤šåè®®è®¿é—®å’Œå®Œæ•´æ–‡ä»¶æ“ä½œ\nğŸ”’ å®‰å…¨å¯æ§ é€šè¿‡è®¤è¯æœºåˆ¶ä¿éšœæ•°æ®å®‰å…¨ï¼Œç»†ç²’åº¦æƒé™æ§åˆ¶ç¡®ä¿è®¿é—®å®‰å…¨\nâš¡ è½»é‡é«˜æ€§èƒ½ åŸºäº Rust çš„é«˜æ•ˆæ¶æ„ï¼Œç¡®ä¿å¿«é€Ÿå“åº”å’Œç¨³å®šæœåŠ¡\næ–‡ä»¶æœåŠ¡ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸æ•°æ®å…±äº«ç›¸ä¼´çš„ä¾¿æ·æ—…ç¨‹ã€‚æ„¿ Dufs æˆä¸ºä½ å¯é çš„æ–‡ä»¶ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡æ–‡ä»¶å…±äº«å’Œèµ„æºç®¡ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè½»æ¾å…±äº«ï¼Œé«˜æ•ˆåä½œâ€”â€”æ„å»ºä½ ä¾¿æ·å¯é çš„æ–‡ä»¶æœåŠ¡ç”Ÿæ€å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Dufs å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼Œå…±äº«æ— å¿§ï¼ğŸ‰\n","date":"2025-08-25T12:20:34+08:00","image":"https://file.meimolihan.eu.org/img/dufs-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0255e96d/","title":"Docker éƒ¨ç½² Dufs æ–‡ä»¶æœåŠ¡ ğŸ³"},{"content":"Docker éƒ¨ç½² Mind Map æ€ç»´å¯¼å›¾ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Mind Map 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Mind Map 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ€ç»´ï¼Œåˆ›æ„æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/wanglin2/mind-map ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/shuiche/mind-map Mind Map æ˜¯ä¸€æ¬¾åŸºäº Web çš„æ€ç»´å¯¼å›¾å·¥å…·ï¼Œæä¾›ç›´è§‚çš„å›¾å½¢åŒ–ç•Œé¢å¸®åŠ©ç”¨æˆ·æ•´ç†æ€è·¯ã€è§„åˆ’é¡¹ç›®å’Œæ„å»ºçŸ¥è¯†ä½“ç³»ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ Mind Mapï¼Œå®ç°æ€ç»´å¯¼å›¾çš„æœ¬åœ°åŒ–ç®¡ç†å’Œåä½œã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ§© ç›´è§‚ç•Œé¢ æ‹–æ‹½å¼èŠ‚ç‚¹æ“ä½œ ç®€å•æ˜“ç”¨ï¼Œæ— éœ€å¤æ‚å­¦ä¹  ğŸ¨ ä¸°å¯Œæ ·å¼ å¤šç§ä¸»é¢˜å’Œé¢œè‰²æ–¹æ¡ˆ ä¸ªæ€§åŒ–å®šåˆ¶å¯¼å›¾å¤–è§‚ ğŸ“Š å¤šç§å¸ƒå±€ æ”¯æŒå¤šç§æ€ç»´å¯¼å›¾ç»“æ„ é€‚åº”ä¸åŒæ€ç»´æ¨¡å¼ ğŸ’¾ å¤šæ ¼å¼å¯¼å‡º æ”¯æŒ PNGã€SVGã€PDF ç­‰æ ¼å¼ æ–¹ä¾¿åˆ†äº«å’Œæ‰“å° ğŸŒ å®æ—¶åä½œ å¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘ é€‚åˆå›¢é˜Ÿ brainstorming ğŸ“± å“åº”å¼è®¾è®¡ é€‚é…å„ç§è®¾å¤‡å±å¹• åœ¨æ‰‹æœºã€å¹³æ¿å’Œç”µè„‘ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ âš¡ å¿«é€Ÿå“åº” ä¼˜åŒ–çš„å‰ç«¯æ€§èƒ½ æµç•…çš„ç¼–è¾‘ä½“éªŒ ğŸ”’ éšç§ä¿æŠ¤ æœ¬åœ°åŒ–éƒ¨ç½² æ•°æ®å®Œå…¨è‡ªä¸»æ§åˆ¶ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Mind Map 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 mkdir -p /vol1/1000/compose/mind-map \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: mind-map: container_name: mind-map image: shuiche/mind-map:latest restart: always ports: - \u0026#34;8256:8080\u0026#34; environment: - TZ=Asia/Shanghai EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Mind Map 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8256 åŸŸåè®¿é—®ï¼š https://mind-map.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ç‚¹å‡»\u0026quot;æ–°å»º\u0026quot;æŒ‰é’®åˆ›å»ºæ€ç»´å¯¼å›¾ ä½¿ç”¨å·¥å…·æ æ·»åŠ èŠ‚ç‚¹å’Œè¿æ¥çº¿ è°ƒæ•´æ ·å¼å’Œå¸ƒå±€ä»¥æ»¡è¶³éœ€æ±‚ ä¿å­˜æˆ–å¯¼å‡ºæ‚¨çš„æ€ç»´å¯¼å›¾ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://mind-map.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/mind-map.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name mind-map.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8256; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ€ç»´ï¼Œåˆ›æ„æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Mind Map æ€ç»´å¯¼å›¾å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ§  æ€ç»´å¯è§†åŒ– å°†å¤æ‚æƒ³æ³•å’Œé¡¹ç›®è§„åˆ’è½¬åŒ–ä¸ºæ¸…æ™°çš„è§†è§‰å¯¼å›¾ï¼Œæå‡æ€è€ƒæ•ˆç‡\nğŸ¨ ä¸ªæ€§è¡¨è¾¾ åˆ©ç”¨å¤šç§ä¸»é¢˜å’Œæ ·å¼å®šåˆ¶ä¸“å±æ€ç»´å¯¼å›¾ï¼Œå±•ç°ä¸ªæ€§åŒ–æ€ç»´é£æ ¼\nğŸ¤ åä½œå…±äº« é€šè¿‡å›¢é˜Ÿåä½œåŠŸèƒ½å®ç°å¤šäººå®æ—¶ç¼–è¾‘ï¼Œä¿ƒè¿›é›†ä½“æ™ºæ…§çš„ç¢°æ’ä¸èåˆ\næ€ç»´ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸åˆ›æ„å…±èˆçš„æ— é™æ—…ç¨‹ã€‚æ„¿ Mind Map æˆä¸ºä½ å¯é çš„æ€ç»´ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªçµæ„Ÿè¿¸å‘å’Œé¡¹ç›®è§„åˆ’çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé‡Šæ”¾æ€ç»´ï¼Œæ¿€å‘åˆ›æ„â€”â€”æ„å»ºä½ æ¸…æ™°æœ‰åºçš„æ€ç»´ä¸–ç•Œå§ï¼âœ¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Mind Map å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æ€ç»´æµç•…ï¼Œåˆ›æ„æ— é™ï¼ğŸ‰\n","date":"2025-08-25T12:18:00+08:00","image":"https://file.meimolihan.eu.org/img/docker-mind-map-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a431825b/","title":"Docker éƒ¨ç½² Mind Map æ€ç»´å¯¼å›¾ ğŸ³"},{"content":"Docker éƒ¨ç½² Pansou ç½‘ç›˜æœç´¢ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Pansou 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Pansou 1. è®¿é—® Web ç•Œé¢ ğŸŒ 2. åŸºæœ¬æœç´¢æ“ä½œ ğŸ” ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæœç´¢ï¼Œèµ„æºæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/fish2018/pansou [Pansou æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç›˜èµ„æºæœç´¢ API æœåŠ¡ï¼Œæ”¯æŒ TG æœç´¢å’Œè‡ªå®šä¹‰æ’ä»¶æœç´¢ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸ªäººæˆ–å›¢é˜Ÿä½¿ç”¨çš„æ–‡ä»¶æœç´¢æœåŠ¡ã€‚ğŸŒŸ\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ” é«˜æ€§èƒ½æœç´¢ é‡‡ç”¨å¹¶å‘æ‰§è¡Œå¤šä¸ªé¢‘é“åŠå¼‚æ­¥æ’ä»¶æœç´¢çš„æ–¹å¼ æ˜¾è‘—æå‡æœç´¢é€Ÿåº¦ï¼Œé«˜æ•ˆå¤„ç†å¹¶å‘ä»»åŠ¡ ğŸ“ å¤šç½‘ç›˜æ”¯æŒ æ”¯æŒç™¾åº¦ç½‘ç›˜ã€é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ã€å¤©ç¿¼äº‘ç›˜ç­‰ä¸»æµç½‘ç›˜ ç»Ÿä¸€è®¿é—®å¤šä¸ªç½‘ç›˜èµ„æºï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶æŒ‰ç±»å‹åˆ†ç±» ğŸ§  æ™ºèƒ½æ’åº åŸºäºæ’ä»¶ç­‰çº§ã€æ—¶é—´æ–°é²œåº¦å’Œä¼˜å…ˆå…³é”®è¯çš„å¤šç»´åº¦ç»¼åˆæ’åºç®—æ³• è®©ä¼˜è´¨ã€æ–°é²œä¸”ç¬¦åˆéœ€æ±‚çš„èµ„æºä¼˜å…ˆå±•ç¤º ğŸ”Œ æ’ä»¶ç³»ç»Ÿ æ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•æœç´¢æ¥æºï¼Œé‡‡ç”¨å¼‚æ­¥æœç´¢æ¨¡å¼ çµæ´»æ‰©å±•æœç´¢æºï¼Œè§£å†³æŸäº›æœç´¢æºå“åº”æ—¶é—´é•¿çš„é—®é¢˜ ğŸ’¾ äºŒçº§ç¼“å­˜ è¿ç”¨åˆ†ç‰‡å†…å­˜ + åˆ†ç‰‡ç£ç›˜ç¼“å­˜æœºåˆ¶ æå‡é‡å¤æŸ¥è¯¢é€Ÿåº¦å’Œå¹¶å‘æ€§èƒ½ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker é›†æˆï¼Œå‰åç«¯ä¸€é”®å¯åŠ¨ å¼€ç®±å³ç”¨ï¼Œéƒ¨ç½²ç®€å•å¿«æ· ğŸ³ ä¸€ã€Docker éƒ¨ç½² Pansou 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -p /vol1/1000/compose/pansou \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: pansou: image: ghcr.io/fish2018/pansou-web:latest container_name: pansou restart: unless-stopped ports: - \u0026#34;8110:80\u0026#34; # ğŸŒ æ˜ å°„å®¹å™¨ç«¯å£åˆ°ä¸»æœº volumes: - ./data:/app/data # ğŸ’¾ æ•°æ®æŒä¹…åŒ– - ./logs:/app/logs # ğŸ“ æ—¥å¿—ç›®å½• environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® - DOMAIN=localhost # ğŸŒ åŸŸåè®¾ç½® - PANSOU_PORT=8110 # ğŸš€ æœåŠ¡ç«¯å£ - PANSOU_HOST=0.0.0.0 # ğŸ”§ ç»‘å®šåœ°å€ # - SOCKS5_PROXY=socks5://127.0.0.1:7890 # ğŸ”Œ ä»£ç†è®¾ç½®(å¯é€‰) # - HTTP_PROXY=http://127.0.0.1:7890 # ğŸŒ HTTPä»£ç†(å¯é€‰) healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8110/api/health\u0026#34;] interval: 30s timeout: 10s retries: 3 volumes: data: driver: local EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Pansou 1. è®¿é—® Web ç•Œé¢ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š\næœ¬åœ°è®¿é—®: http://localhost:8110 åŸŸåè®¿é—®: https://pansou.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åŸºæœ¬æœç´¢æ“ä½œ ğŸ” æ“ä½œ è¯´æ˜ ç¤ºä¾‹ ğŸ” å…³é”®è¯æœç´¢ åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æƒ³è¦æŸ¥æ‰¾çš„èµ„æºå…³é”®è¯ \u0026ldquo;ç”µå½±åç§°\u0026rdquo;ã€\u0026ldquo;è½¯ä»¶åç§°\u0026quot;ç­‰ ğŸ“ ç»“æœç­›é€‰ æŒ‰ç½‘ç›˜ç±»å‹ç­›é€‰æœç´¢ç»“æœ ç™¾åº¦ç½‘ç›˜ã€é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ç­‰ ğŸ”— é“¾æ¥è®¿é—® ç‚¹å‡»æœç´¢ç»“æœä¸­çš„é“¾æ¥è®¿é—®èµ„æº è‡ªåŠ¨æ˜¾ç¤ºæå–ç ï¼ˆå¦‚æœ‰ï¼‰ ğŸ“Š çŠ¶æ€æŸ¥çœ‹ æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œæ’ä»¶è¿è¡Œæƒ…å†µ é€šè¿‡çŠ¶æ€ç•Œé¢ç›‘æ§ç³»ç»Ÿå¥åº·åº¦ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://pansou.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/pansou.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; http2 on; server_name pansou.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; # TLS å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å“åº”å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options SAMEORIGIN always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # åå‘ä»£ç†é…ç½® location / { proxy_pass http://localhost:8110; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— # å¥åº·æ£€æŸ¥ docker inspect --format=\u0026#39;{{.State.Health.Status}}\u0026#39; pansou 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæœç´¢ï¼Œèµ„æºæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Pansou ç½‘ç›˜æœç´¢æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ” é«˜æ•ˆæ£€ç´¢ å¿«é€Ÿå®šä½å…¨ç½‘ç›˜èµ„æºï¼Œæ™ºèƒ½æ’åºè®©ä¼˜è´¨å†…å®¹ä¼˜å…ˆå‘ˆç°\nğŸŒ å¤šæºèšåˆ ä¸€ç«™å¼æœç´¢å¤šä¸ªä¸»æµç½‘ç›˜ï¼Œé¿å…å¹³å°é—´æ¥å›åˆ‡æ¢çš„ç¹ç\nâš¡ æé€Ÿå“åº” åŸºäºé«˜æ€§èƒ½æ¶æ„å’Œç¼“å­˜æœºåˆ¶ï¼Œäº«å—æ¯«ç§’çº§çš„æœç´¢ä½“éªŒ\næœç´¢ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ä¿¡æ¯èµ„æºç›¸ä¼´çš„å‘ç°æ—…ç¨‹ã€‚æ„¿ Pansou æˆä¸ºä½ é«˜æ•ˆçš„æœç´¢åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡èµ„æºå¯»æ‰¾å’Œä¿¡æ¯è·å–çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ™ºèƒ½æœç´¢ï¼Œèµ„æºæ— å¿§â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„èµ„æºå‘ç°å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Pansou å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æœç´¢é¡ºåˆ©ï¼Œèµ„æºä¸°å¯Œï¼ğŸ‰\n","date":"2025-08-25T12:16:02+08:00","image":"https://file.meimolihan.eu.org/img/docker-pansou-01.webp","permalink":"https://blog.meimolihan.eu.org/p/56599374/","title":"Docker éƒ¨ç½² Pansou ç½‘ç›˜æœç´¢ ğŸ³"},{"content":"Docker éƒ¨ç½² Webtop-Ubuntu æ¡Œé¢ç¯å¢ƒ ğŸ–¥ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Webtop-Ubuntu 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Webtop-Ubuntu 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åˆå§‹é…ç½®æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè¿œç¨‹æ¡Œé¢ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Webtop å®˜ç½‘åœ°å€ï¼š https://docs.linuxserver.io/images/docker-webtop ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/linuxserver/docker-webtop ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/linuxserver/webtop Webtop æ˜¯ä¸€ä¸ªåŸºäº Docker çš„æ¡Œé¢ç¯å¢ƒè§£å†³æ–¹æ¡ˆï¼Œå…è®¸æ‚¨é€šè¿‡æµè§ˆå™¨è®¿é—®å®Œæ•´çš„ Linux æ¡Œé¢ä½“éªŒã€‚æœ¬é¡¹ç›®ä½¿ç”¨ Ubuntu ç³»ç»Ÿæ­é… KDE æ¡Œé¢ç¯å¢ƒï¼Œæä¾›äº†ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„è¿œç¨‹å·¥ä½œç¯å¢ƒã€‚æ— è®ºæ‚¨æ˜¯éœ€è¦è¿œç¨‹åŠå…¬ã€å¼€å‘æµ‹è¯•ï¼Œè¿˜æ˜¯å•çº¯æƒ³è¦ä¸€ä¸ªéš”ç¦»çš„æ¡Œé¢ç¯å¢ƒï¼ŒWebtop éƒ½èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ æµè§ˆå™¨è®¿é—® æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œé€šè¿‡æµè§ˆå™¨å³å¯è®¿é—®å®Œæ•´æ¡Œé¢ç¯å¢ƒ è·¨å¹³å°è®¿é—®ï¼Œæ— éœ€é¢å¤–è½¯ä»¶ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² åŸºäº Dockerï¼Œéƒ¨ç½²ç®€å•ï¼Œç¯å¢ƒéš”ç¦»ï¼Œæ˜“äºè¿ç§» å¿«é€Ÿéƒ¨ç½²å’Œç¯å¢ƒä¸€è‡´æ€§ ğŸ¨ å¤šç§æ¡Œé¢ç¯å¢ƒ æ”¯æŒ KDEã€XFCE ç­‰å¤šç§æ¡Œé¢ç¯å¢ƒ æ»¡è¶³ä¸åŒç”¨æˆ·åå¥½ ğŸ”§ é«˜åº¦å¯å®šåˆ¶ å¯é…ç½®ç”¨æˆ·ã€å¯†ç ã€è¯­è¨€ã€æ—¶åŒºç­‰å‚æ•° ä¸ªæ€§åŒ–å®šåˆ¶å·¥ä½œç¯å¢ƒ ğŸ“ æ–‡ä»¶æŒä¹…åŒ– é…ç½®æ–‡ä»¶å’Œæ•°æ®å¯æŒä¹…åŒ–å­˜å‚¨ é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé•¿æœŸä½¿ç”¨ ğŸŒ å¤šè¯­è¨€æ”¯æŒ æ”¯æŒä¸­æ–‡ç•Œé¢å’Œè¾“å…¥æ³• é€‚åˆå…¨çƒç”¨æˆ·ä½¿ç”¨ ğŸ”’ å®‰å…¨å¯é  é€šè¿‡å®¹å™¨éš”ç¦»ï¼Œæä¾›å®‰å…¨çš„å·¥ä½œç¯å¢ƒ ä¿éšœç³»ç»Ÿå®‰å…¨æ€§ âš¡ å¿«é€Ÿéƒ¨ç½² å‡ åˆ†é’Ÿå†…å³å¯è·å¾—å®Œæ•´çš„æ¡Œé¢ç¯å¢ƒ èŠ‚çœéƒ¨ç½²æ—¶é—´ ğŸ“Š èµ„æºå¯æ§ å¯é™åˆ¶ CPUã€å†…å­˜ä½¿ç”¨ é¿å…èµ„æºå†²çªï¼Œä¼˜åŒ–æ€§èƒ½ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Webtop-Ubuntu 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 mkdir -p /vol1/1000/compose/webtop-ubuntu \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: webtop-ubuntu: image: lscr.io/linuxserver/webtop:ubuntu-kde container_name: webtop-ubuntu security_opt: - seccomp:unconfined environment: - PUID=1000 - PGID=1000 - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® - SUBFOLDER=/ - TITLE=Webtop - CUSTOM_USER=admin # ğŸ‘¤ ç”¨æˆ·å - PASSWORD=your_password # ğŸ”‘ å¯†ç ï¼ˆè¯·æ›¿æ¢ä¸ºå¼ºå¯†ç ï¼‰ - LC_ALL=zh_CN.UTF-8 # ğŸŒ è¯­è¨€è®¾ç½® ports: - 3006:3000 # ğŸŒ ç«¯å£æ˜ å°„ volumes: - ./config:/config # âš™ï¸ é…ç½®ç›®å½• - /var/run/docker.sock:/var/run/docker.sock # ğŸ³ Docker socket devices: - /dev/dri:/dev/dri # ğŸ® GPU åŠ é€Ÿæ”¯æŒï¼ˆå¯é€‰ï¼‰ shm_size: 2gb # ğŸ’¾ å…±äº«å†…å­˜å¤§å° restart: unless-stopped # ğŸ”„ è‡ªåŠ¨é‡å¯ç­–ç•¥ ## å…¶ä»–å¯ç”¨é•œåƒé€‰é¡¹ ## lscr.io/linuxserver/webtop:ubuntu-xfce ## lscr.io/linuxserver/webtop:fedora-xfce ## lscr.io/linuxserver/webtop:arch-xfce ## lscr.io/linuxserver/webtop:debian-xfce EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Webtop-Ubuntu 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:3006 åŸŸåè®¿é—®: https://webtop.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åˆå§‹é…ç½®æ­¥éª¤ ğŸ¯ æ­¥éª¤ æ“ä½œ è¯´æ˜ 1 ä¿®æ”¹é»˜è®¤å¯†ç  é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  2 è¯­è¨€è®¾ç½® é…ç½®ç³»ç»Ÿè¯­è¨€å’Œè¾“å…¥æ³• 3 è½¯ä»¶å®‰è£… å®‰è£…æ‰€éœ€çš„åº”ç”¨è½¯ä»¶ 4 æ–‡ä»¶é…ç½® é…ç½®ä¸ªäººæ–‡ä»¶å’Œç›®å½•ç»“æ„ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://webtop.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/webtop-ubuntu.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name webtop.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options SAMEORIGIN; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 10G; location / { proxy_pass http://localhost:3006; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_http_version 1.1; proxy_buffering off; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /vol1/1000/compose/webtop-ubuntu # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop webtop-ubuntu # åœæ­¢å®¹å™¨ docker start webtop-ubuntu # å¯åŠ¨å®¹å™¨ docker restart webtop-ubuntu # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm webtop-ubuntu # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f webtop-ubuntu # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it webtop-ubuntu bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect webtop-ubuntu # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats webtop-ubuntu # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs webtop-ubuntu # æŸ¥çœ‹æ—¥å¿— docker logs -f webtop-ubuntu # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 webtop-ubuntu # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t webtop-ubuntu # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè¿œç¨‹æ¡Œé¢ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Webtop-Ubuntu æ¡Œé¢ç¯å¢ƒï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° é€šè¿‡æµè§ˆå™¨è®¿é—®å®Œæ•´çš„ Ubuntu æ¡Œé¢ç¯å¢ƒï¼Œæ— éœ€å®‰è£…ä»»ä½•å®¢æˆ·ç«¯\nğŸ’» æ— ç¼å·¥ä½œ åœ¨éš”ç¦»çš„å®¹å™¨ç¯å¢ƒä¸­è¿›è¡Œå¼€å‘ã€æµ‹è¯•ã€åŠå…¬ï¼Œäº«å—ä¸æœ¬åœ°æ¡Œé¢ä¸€è‡´çš„ä½“éªŒ\nğŸ” å®‰å…¨å¯é  æ‰€æœ‰æµé‡åŠ å¯†ä¼ è¾“ï¼Œæ•°æ®æŒä¹…åŒ–å­˜å‚¨ï¼Œä¿éšœéšç§ä¸èµ„æºå¯æ§\nâš¡ é«˜æ•ˆçµæ´» å¿«é€Ÿéƒ¨ç½²ã€å¤šç¯å¢ƒæ”¯æŒï¼Œæ ¹æ®éœ€æ±‚è‡ªç”±å®šåˆ¶ä½ çš„ä¸“å±å·¥ä½œç©ºé—´\næŠ€æœ¯æ— ç•Œï¼Œæ¡Œé¢éšè¡Œã€‚æ„¿ Webtop æˆä¸ºä½ è¿œç¨‹åŠå…¬å’Œå¼€å‘çš„å¾—åŠ›åŠ©æ‰‹ï¼Œæ‰“ç ´è®¾å¤‡ä¸åœ°ç‚¹çš„é™åˆ¶ï¼Œé‡Šæ”¾åˆ›é€ åŠ›çš„æ— é™å¯èƒ½ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè¿æ¥ä¸–ç•Œï¼ŒæŒæ§æ¡Œé¢â€”â€”æ„å»ºä½ é«˜æ•ˆè‡ªç”±çš„æ•°å­—å·¥ä½œå°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ LinuxServer Webtop é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œé«˜æ•ˆæ— å¿§ï¼ğŸ‰\n","date":"2025-08-25T12:13:50+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-webtop-ubuntu-001.webp","permalink":"https://blog.meimolihan.eu.org/p/d975dd93/","title":"Docker éƒ¨ç½² Webtop-Ubuntu æ¡Œé¢ç¯å¢ƒ ğŸ–¥ï¸"},{"content":"Docker éƒ¨ç½²é£ç‰›å½±è§† 302 é‡å®šå‘æœåŠ¡ ğŸ¬ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²é£ç‰›å½±è§† 302 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. åˆ›å»º 302 é…ç½®æ–‡ä»¶ ğŸ“ 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨é£ç‰›å½±è§† 302 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå½±è§†ï¼Œç•…äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/AmbitiousJun/go-emby2openlist ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/ambitiousjun/go-emby2openlist é£ç‰›å½±è§† 302 é‡å®šå‘æœåŠ¡ æ˜¯ä¸€æ¬¾ä¸“ä¸ºé£ç‰› NAS ç³»ç»Ÿè®¾è®¡çš„é‡å®šå‘å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨é£ç‰›å½±è§†å’Œ OpenList ç­‰ç½‘ç›˜æœåŠ¡ä¹‹é—´å»ºç«‹æ¡¥æ¢ï¼Œå®ç°æµç•…çš„è§†é¢‘æ’­æ”¾å’Œæ–‡ä»¶è®¿é—®ä½“éªŒã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œè¯¥æœåŠ¡ï¼Œæå‡å½±è§†èµ„æºçš„è®¿é—®æ•ˆç‡å’Œç®¡ç†ä¾¿æ·æ€§ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”— æ— ç¼æ¡¥æ¥ è¿æ¥é£ç‰›å½±è§†ä¸ OpenList ç½‘ç›˜æœåŠ¡ å®ç°æµç•…çš„åª’ä½“èµ„æºè®¿é—®å’Œæ’­æ”¾ âš¡ é«˜æ•ˆé‡å®šå‘ 302 é‡å®šå‘æŠ€æœ¯ä¼˜åŒ–èµ„æºè®¿é—®è·¯å¾„ å‡å°‘ä¸­é—´ç¯èŠ‚ï¼Œæå‡è®¿é—®é€Ÿåº¦ ğŸ¬ åª’ä½“å…¼å®¹ æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼å’Œç¼–ç  å¹¿æ³›å…¼å®¹å„ç±»å½±è§†èµ„æº ğŸ”’ å®‰å…¨å¯é  å®‰å…¨çš„ API é€šä¿¡å’Œèº«ä»½éªŒè¯ ä¿éšœæ•°æ®è®¿é—®çš„å®‰å…¨æ€§ ğŸŒ å¤šæœåŠ¡æ”¯æŒ å…¼å®¹å¤šç§ç½‘ç›˜å’Œåª’ä½“æœåŠ¡ çµæ´»çš„é›†æˆæ–¹æ¡ˆ ğŸ“Š çŠ¶æ€ç›‘æ§ æä¾›å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€æŸ¥è¯¢æ¥å£ æ–¹ä¾¿æœåŠ¡ç›‘æ§å’Œç»´æŠ¤ âš™ï¸ çµæ´»é…ç½® æ”¯æŒå¤šç§é…ç½®æ–¹å¼å’Œå‚æ•°è°ƒæ•´ é€‚åº”ä¸åŒéƒ¨ç½²ç¯å¢ƒ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker å®¹å™¨åŒ–å°è£… ç®€åŒ–éƒ¨ç½²å’Œå‡çº§æµç¨‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½²é£ç‰›å½±è§† 302 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/fntv-302 \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: fntv-302: container_name: fntv-302 image: ambitiousjun/go-emby2openlist:v2.2.5 restart: always ports: - \u0026#34;8095:8095\u0026#34; # HTTPè®¿é—®ç«¯å£ - \u0026#34;8094:8094\u0026#34; # HTTPSè®¿é—®ç«¯å£ volumes: - ./config.yml:/app/config.yml # ä¸»é…ç½®æ–‡ä»¶ - ./ssl:/app/ssl # SSLè¯ä¹¦ç›®å½• - ./custom-js:/app/custom-js # è‡ªå®šä¹‰JavaScript - ./custom-css:/app/custom-css # è‡ªå®šä¹‰CSSæ ·å¼ environment: - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® - GIN_MODE=release # ç”Ÿäº§æ¨¡å¼ EOF 2. åˆ›å»º 302 é…ç½®æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 cat \u0026gt; config.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; emby: host: http://10.10.10.251:8005 # ğŸ¬ é£ç‰›å½±è§†è®¿é—®åœ°å€ mount-path: /vol02/1000-1-f3875ade # ğŸ“‚ é£ç‰›æ–‡ä»¶æŒ‚è½½è·¯å¾„ openlist: host: http://10.10.10.251:5244 # ğŸŒ OpenListè®¿é—®åœ°å€ token: alist-7b8e2935-2131-4974-a630-e2ac0b9643f5IQ9pZJT3wJsWwk8Cwmcg2HJIzcpSBVLN3srwm2Om8HwKQyBMEKWelZ2Ao4rIu6oW # ğŸ”‘ OpenList APIå¯†é’¥ EOF âš ï¸ é…ç½®è¯´æ˜ï¼šè¯·æ ¹æ®æ‚¨çš„å®é™…ç¯å¢ƒä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š\nemby.host: æ‚¨é£ç‰›å½±è§†çš„å®é™…è®¿é—®åœ°å€ emby.mount-path: é£ç‰›NASä¸­è¿œç¨‹æŒ‚è½½çš„DAVè·¯å¾„ openlist.host: OpenListæœåŠ¡çš„è®¿é—®åœ°å€ openlist.token: OpenListçš„APIå¯†é’¥ï¼ˆä»OpenListç®¡ç†ç•Œé¢è·å–ï¼‰ 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨é£ç‰›å½±è§† 302 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8095 å®‰å…¨è®¿é—®ï¼š https://localhost:8094 åŸŸåè®¿é—®ï¼š https://fntv-302.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ï¼šcurl http://localhost:8095/health éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼šcurl http://localhost:8095/config æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼šcurl http://localhost:8095/status å¼€å§‹ä½¿ç”¨é£ç‰›å½±è§†ä¸OpenListçš„é›†æˆæœåŠ¡ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://fntv-302.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/fntv-302.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name fntv-302.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 10G; location / { proxy_pass http://127.0.0.1:8095; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå½±è§†ï¼Œç•…äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†é£ç‰›å½±è§† 302 é‡å®šå‘æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ æ— ç¼æ¡¥æ¥ ç•…äº«é£ç‰›å½±è§†ä¸ OpenList ç½‘ç›˜æœåŠ¡çš„å®Œç¾èåˆï¼Œå®ç°æµç•…çš„åª’ä½“èµ„æºè®¿é—®å’Œæ’­æ”¾\nâš¡ é«˜æ•ˆé‡å®šå‘ é€šè¿‡ 302 é‡å®šå‘æŠ€æœ¯ä¼˜åŒ–èµ„æºè®¿é—®è·¯å¾„ï¼Œå‡å°‘ä¸­é—´ç¯èŠ‚ï¼Œæå‡è®¿é—®é€Ÿåº¦\nğŸ”’ å®‰å…¨å¯é  å®‰å…¨çš„ API é€šä¿¡å’Œèº«ä»½éªŒè¯æœºåˆ¶ï¼Œä¿éšœæ•°æ®è®¿é—®çš„å®‰å…¨æ€§\nå½±è§†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç²¾å½©å†…å®¹ç›¸ä¼´çš„ä¾¿æ·æ—…ç¨‹ã€‚æ„¿é£ç‰›å½±è§† 302 é‡å®šå‘æœåŠ¡æˆä¸ºä½ å¯é çš„åª’ä½“æ¡¥æ¢ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å½±è§†æ¬£èµå’Œèµ„æºç®¡ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ— ç¼è¿æ¥ï¼Œç•…äº«å½±è§†â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„åª’ä½“æœåŠ¡ç”Ÿæ€å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ é£ç‰›å½±è§† 302 é‡å®šå‘æœåŠ¡å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè§‚å½±ä½“éªŒæ›´ä¸Šä¸€å±‚æ¥¼ï¼ğŸ‰\n","date":"2025-08-25T12:05:33+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-fntv-302-001.webp","permalink":"https://blog.meimolihan.eu.org/p/57aa0738/","title":"Docker éƒ¨ç½²é£ç‰›å½±è§† 302 é‡å®šå‘æœåŠ¡ ğŸ¬"},{"content":"FnOS Docker é•œåƒæºä¼˜åŒ–æŒ‡å— ğŸ³ ğŸš€ å…¨é¢æŒ‡å—ï¼šåŠ é€Ÿ Docker é•œåƒä¸‹è½½ï¼Œæå‡å®¹å™¨éƒ¨ç½²æ•ˆç‡ï¼Œä¼˜åŒ– FnOS ç³»ç»Ÿæ€§èƒ½\nğŸ“‹ ç›®å½• ğŸ¯ å¿«é€Ÿé…ç½® ğŸŒ é•œåƒæºæ¨è ğŸ”§ æ‰‹åŠ¨é…ç½® âš¡ ä¸€é”®è„šæœ¬ ğŸ” éªŒè¯æ•ˆæœ ğŸ’¡ æœ€ä½³å®è·µ ğŸš¨ æ•…éšœæ’é™¤ ğŸ¯ å¿«é€Ÿé…ç½® ğŸ“ ä¿®æ”¹ daemon.json é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºæˆ–ä¿®æ”¹ Docker é…ç½®æ–‡ä»¶ sudo mkdir -p /etc/docker sudo tee /etc/docker/daemon.json \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;data-root\u0026#34;: \u0026#34;/vol1/docker\u0026#34;, \u0026#34;insecure-registries\u0026#34;: [\u0026#34;127.0.0.1:19827\u0026#34;], \u0026#34;live-restore\u0026#34;: true, \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.1panel.live\u0026#34;, \u0026#34;https://hub.rat.dev\u0026#34;, \u0026#34;https://registry.hub.docker.com\u0026#34; ] } EOF # é‡å¯ Docker æœåŠ¡ sudo systemctl restart docker sudo systemctl status docker # éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ docker info | grep -i \u0026#34;registry\\|mirror\u0026#34; ğŸ”„ é…ç½®è¯´æ˜ å‚æ•° è¯´æ˜ æ¨èå€¼ æ³¨æ„äº‹é¡¹ data-root Docker æ•°æ®å­˜å‚¨è·¯å¾„ /vol1/docker ç¡®ä¿ç›®æ ‡åˆ†åŒºæœ‰è¶³å¤Ÿç©ºé—´ insecure-registries å…è®¸éå®‰å…¨ç§æœ‰ä»“åº“ 127.0.0.1:19827 ä»…ç”¨äºæœ¬åœ°æˆ–å—ä¿¡ä»»çš„ç§æœ‰ä»“åº“ live-restore å®ˆæŠ¤è¿›ç¨‹åœæ­¢æ—¶ä¿æŒå®¹å™¨è¿è¡Œ true é¿å…å®¹å™¨æ„å¤–åœæ­¢ registry-mirrors é•œåƒåŠ é€Ÿå™¨åœ°å€ è§ä¸‹æ–‡æ¨èåˆ—è¡¨ æŒ‰ç½‘ç»œç¯å¢ƒé€‰æ‹©æœ€ä½³é•œåƒæº ğŸŒ é•œåƒæºæ¨è ğŸ† å›½å†…ä¼˜è´¨é•œåƒæº 1 2 3 4 5 6 7 8 9 10 { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34;, // ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ - ç¨³å®šå¿«é€Ÿ \u0026#34;https://hub-mirror.c.163.com\u0026#34;, // ç½‘æ˜“äº‘ - å›½å†…èŠ‚ç‚¹å¤š \u0026#34;https://mirror.baidubce.com\u0026#34;, // ç™¾åº¦äº‘ - ç™¾åº¦äº‘ç”¨æˆ·é¦–é€‰ \u0026#34;https://registry.docker-cn.com\u0026#34;, // Docker ä¸­å›½å®˜æ–¹ - å®˜æ–¹æº \u0026#34;https://docker.1panel.live\u0026#34;, // 1Panel é•œåƒ - ä¸“ä¸ºé¢æ¿ä¼˜åŒ– \u0026#34;https://hub.rat.dev\u0026#34; // Rat é•œåƒç«™ - ç¤¾åŒºç»´æŠ¤ ] } ğŸŒ å›½é™…é•œåƒæº 1 2 3 4 5 6 7 8 { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://registry.hub.docker.com\u0026#34;, // Docker å®˜æ–¹ - æ›´æ–°æœ€åŠæ—¶ \u0026#34;https://mirror.gcr.io\u0026#34;, // Google Container Registry - GoogleæœåŠ¡ \u0026#34;https://quay.io\u0026#34;, // Red Hat Quay - ä¼ä¸šçº§ä»“åº“ \u0026#34;https://ghcr.io\u0026#34; // GitHub Container Registry - GitHubé¡¹ç›® ] } ğŸ“Š é•œåƒæºé€Ÿåº¦æµ‹è¯•ä¸é€‰æ‹©ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # æµ‹è¯•é•œåƒæºä¸‹è½½é€Ÿåº¦ echo \u0026#34;æµ‹è¯•å„é•œåƒæºé€Ÿåº¦...\u0026#34; MIRRORS=( \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34; \u0026#34;https://hub-mirror.c.163.com\u0026#34; \u0026#34;https://mirror.baidubce.com\u0026#34; \u0026#34;https://docker.1panel.live\u0026#34; ) for mirror in \u0026#34;${MIRRORS[@]}\u0026#34;; do echo \u0026#34;æµ‹è¯•é•œåƒæº: $mirror\u0026#34; # ä¸´æ—¶è®¾ç½®é•œåƒæº sudo sed -i \u0026#34;s|\\\u0026#34;registry-mirrors\\\u0026#34;:.*|\\\u0026#34;registry-mirrors\\\u0026#34;: [\\\u0026#34;$mirror\\\u0026#34;]|\u0026#34; /etc/docker/daemon.json sudo systemctl restart docker # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ time docker pull ubuntu:20.04 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 docker rmi ubuntu:20.04 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 done # æ¢å¤æœ€ä½³é…ç½® echo \u0026#34;é€‰æ‹©æœ€ä½³é•œåƒæºå¹¶é…ç½®...\u0026#34; ğŸ“ æŒ‰åœ°åŒºæ¨èé•œåƒæº åœ°åŒº é¦–é€‰é•œåƒæº å¤‡ç”¨é•œåƒæº ç‰¹ç‚¹ ä¸­å›½å¤§é™† ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ ç½‘æ˜“äº‘ æ•™è‚²ç½‘ä¼˜åŒ–ï¼Œç¨³å®šæ€§é«˜ åå—åœ°åŒº ç½‘æ˜“äº‘ ç™¾åº¦äº‘ åå—èŠ‚ç‚¹å¤šï¼Œé€Ÿåº¦å¿« åä¸œåœ°åŒº ä¸­ç§‘å¤§ Dockerä¸­å›½å®˜æ–¹ æ•™è‚²ç½‘ä¸å…¬ç½‘åŒä¼˜ ååŒ—åœ°åŒº ç™¾åº¦äº‘ ç½‘æ˜“äº‘ ç™¾åº¦äº‘ååŒ—èŠ‚ç‚¹ æµ·å¤–ç”¨æˆ· Dockerå®˜æ–¹ GCRé•œåƒ å›½é™…é“¾è·¯ä¼˜åŒ– ğŸ”§ æ‰‹åŠ¨é…ç½® ğŸ“ é…ç½®æ–‡ä»¶è¯¦è§£ 1 2 3 4 5 6 7 8 # ä¸»è¦é…ç½®æ–‡ä»¶ä½ç½® /etc/docker/daemon.json # å¤‡ä»½åŸæœ‰é…ç½® sudo cp /etc/docker/daemon.json /etc/docker/daemon.json.bak.$(date +%Y%m%d) # æŸ¥çœ‹å½“å‰é…ç½® sudo cat /etc/docker/daemon.json || echo \u0026#34;æ— é…ç½®æ–‡ä»¶ï¼Œå°†åˆ›å»ºæ–°é…ç½®\u0026#34; ğŸ› ï¸ å®Œæ•´é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 sudo tee /etc/docker/daemon.json \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;data-root\u0026#34;: \u0026#34;/vol1/docker\u0026#34;, \u0026#34;insecure-registries\u0026#34;: [ \u0026#34;127.0.0.1:19827\u0026#34;, \u0026#34;192.168.1.100:5000\u0026#34; ], \u0026#34;live-restore\u0026#34;: true, \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;10m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;3\u0026#34; }, \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34;, \u0026#34;https://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://mirror.baidubce.com\u0026#34;, \u0026#34;https://docker.1panel.live\u0026#34; ], \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;max-concurrent-downloads\u0026#34;: 10, \u0026#34;max-concurrent-uploads\u0026#34;: 5, \u0026#34;default-ulimits\u0026#34;: { \u0026#34;nofile\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;nofile\u0026#34;, \u0026#34;Hard\u0026#34;: 65536, \u0026#34;Soft\u0026#34;: 65536 } }, \u0026#34;features\u0026#34;: { \u0026#34;buildkit\u0026#34;: true } } EOF ğŸ”„ åº”ç”¨é…ç½®æ›´æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # é‡æ–°åŠ è½½é…ç½® sudo systemctl daemon-reload # é‡å¯ Docker æœåŠ¡ sudo systemctl restart docker # æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ docker info | grep -i \u0026#34;registry\\|mirror\u0026#34; # æŸ¥çœ‹è¯¦ç»†é…ç½®ä¿¡æ¯ docker info | grep -A 20 \u0026#34;Registry Mirrors\u0026#34; # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status docker # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— sudo journalctl -u docker.service -n 20 --no-pager âš¡ ä¸€é”®è„šæœ¬ ğŸ¯ è‡ªåŠ¨é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 #!/bin/bash # FnOS Docker é•œåƒæºè‡ªåŠ¨é…ç½®è„šæœ¬ # ç‰ˆæœ¬: 1.2.0 # æè¿°: è‡ªåŠ¨æ£€æµ‹ç½‘ç»œç¯å¢ƒå¹¶é…ç½®æœ€ä¼˜Dockeré•œåƒæº set -e echo \u0026#34;ğŸš€ FnOS Docker é•œåƒæºä¼˜åŒ–è„šæœ¬ v1.2.0\u0026#34; echo \u0026#34;==============================================\u0026#34; # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color # æ—¥å¿—å‡½æ•° log_info() { echo -e \u0026#34;${GREEN}[INFO]${NC} $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; } log_warn() { echo -e \u0026#34;${YELLOW}[WARN]${NC} $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; } log_error() { echo -e \u0026#34;${RED}[ERROR]${NC} $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; } # æ£€æŸ¥ Docker æ˜¯å¦å®‰è£… check_docker() { if ! command -v docker \u0026amp;\u0026gt; /dev/null; then log_error \u0026#34;Docker æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Docker\u0026#34; exit 1 fi log_info \u0026#34;Docker å·²å®‰è£…ï¼Œç‰ˆæœ¬: $(docker --version | awk \u0026#39;{print $3}\u0026#39; | tr -d \u0026#39;,\u0026#39;)\u0026#34; } # å¤‡ä»½åŸæœ‰é…ç½® backup_config() { local backup_file=\u0026#34;/etc/docker/daemon.json.bak.$(date +%Y%m%d_%H%M%S)\u0026#34; if [ -f /etc/docker/daemon.json ]; then sudo cp /etc/docker/daemon.json \u0026#34;$backup_file\u0026#34; log_info \u0026#34;åŸæœ‰é…ç½®å·²å¤‡ä»½åˆ°: $backup_file\u0026#34; else log_warn \u0026#34;æœªæ‰¾åˆ°åŸæœ‰é…ç½®æ–‡ä»¶ï¼Œå°†åˆ›å»ºæ–°é…ç½®\u0026#34; fi } # æµ‹è¯•é•œåƒæºé€Ÿåº¦ test_mirror_speed() { local mirror=$1 log_info \u0026#34;æµ‹è¯•é•œåƒæºé€Ÿåº¦: $mirror\u0026#34; # ä¸´æ—¶è®¾ç½®å•ä¸ªé•œåƒæº sudo tee /etc/docker/daemon.json \u0026gt; /dev/null \u0026lt;\u0026lt;EOF { \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;$mirror\u0026#34;] } EOF sudo systemctl restart docker sleep 2 # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ local start_time=$(date +%s) docker pull alpine:latest \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || true local end_time=$(date +%s) local duration=$((end_time - start_time)) # æ¸…ç† docker rmi alpine:latest \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || true echo $duration } # é€‰æ‹©æœ€ä½³é•œåƒæº select_best_mirror() { declare -A mirror_speeds local mirrors=( \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34; \u0026#34;https://hub-mirror.c.163.com\u0026#34; \u0026#34;https://mirror.baidubce.com\u0026#34; \u0026#34;https://docker.1panel.live\u0026#34; \u0026#34;https://registry.docker-cn.com\u0026#34; ) log_info \u0026#34;å¼€å§‹æµ‹è¯•å„é•œåƒæºé€Ÿåº¦...\u0026#34; for mirror in \u0026#34;${mirrors[@]}\u0026#34;; do local speed=$(test_mirror_speed \u0026#34;$mirror\u0026#34;) mirror_speeds[\u0026#34;$mirror\u0026#34;]=$speed log_info \u0026#34;é•œåƒæº $mirror ä¸‹è½½è€—æ—¶: ${speed}ç§’\u0026#34; done # æ‰¾å‡ºæœ€å¿«çš„é•œåƒæº local best_mirror local best_speed=999 for mirror in \u0026#34;${!mirror_speeds[@]}\u0026#34;; do if [ \u0026#34;${mirror_speeds[$mirror]}\u0026#34; -lt \u0026#34;$best_speed\u0026#34; ]; then best_speed=${mirror_speeds[$mirror]} best_mirror=$mirror fi done log_info \u0026#34;æœ€ä½³é•œåƒæº: $best_mirror (è€—æ—¶: ${best_speed}ç§’)\u0026#34; echo \u0026#34;$best_mirror\u0026#34; } # åº”ç”¨é…ç½® apply_config() { local best_mirror=$1 log_info \u0026#34;åº”ç”¨æœ€ä½³é•œåƒæºé…ç½®: $best_mirror\u0026#34; sudo tee /etc/docker/daemon.json \u0026gt; /dev/null \u0026lt;\u0026lt;EOF { \u0026#34;data-root\u0026#34;: \u0026#34;/vol1/docker\u0026#34;, \u0026#34;insecure-registries\u0026#34;: [\u0026#34;127.0.0.1:19827\u0026#34;], \u0026#34;live-restore\u0026#34;: true, \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;$best_mirror\u0026#34;, \u0026#34;https://registry.hub.docker.com\u0026#34; ], \u0026#34;max-concurrent-downloads\u0026#34;: 10, \u0026#34;max-concurrent-uploads\u0026#34;: 5 } EOF sudo systemctl restart docker sleep 3 } # éªŒè¯é…ç½® verify_config() { log_info \u0026#34;éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ...\u0026#34; if docker info | grep -q \u0026#34;Registry Mirrors\u0026#34;; then log_info \u0026#34;é•œåƒæºé…ç½®æˆåŠŸ!\u0026#34; docker info | grep -A 5 \u0026#34;Registry Mirrors\u0026#34; else log_error \u0026#34;é•œåƒæºé…ç½®å¤±è´¥\u0026#34; return 1 fi # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ log_info \u0026#34;æµ‹è¯•é•œåƒä¸‹è½½é€Ÿåº¦...\u0026#34; time docker pull hello-world \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 docker rmi hello-world \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 } # ä¸»å‡½æ•° main() { check_docker backup_config local best_mirror=$(select_best_mirror) apply_config \u0026#34;$best_mirror\u0026#34; verify_config log_info \u0026#34;Docker é•œåƒæºä¼˜åŒ–å®Œæˆ!\u0026#34; } # æ‰§è¡Œä¸»å‡½æ•° main \u0026#34;$@\u0026#34; ğŸ“¥ ä½¿ç”¨å°é›…è„šæœ¬è·å–é•œåƒæº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä½¿ç”¨å°é›…å¤§ç¤¼åŒ…è„šæœ¬æµ‹è¯•é•œåƒæº bash -c \u0026#34;$(curl --insecure -fsSL https://ddsrem.com/xiaoya_install.sh)\u0026#34; # é€‰æ‹©èœå•é€‰é¡¹ï¼š # è¾“å…¥ 9 â†’ å›è½¦ # è¾“å…¥ 6 â†’ å›è½¦ # è„šæœ¬ä¼šè‡ªåŠ¨æµ‹è¯•å¹¶æ¨èæœ€å¿«çš„é•œåƒæº # æˆ–è€…ç›´æ¥ä½¿ç”¨å°é›…æ¨èçš„é•œåƒæº XIAOYA_MIRROR=$(curl -s https://ddsrem.com/xiaoya_mirror.txt) if [ -n \u0026#34;$XIAOYA_MIRROR\u0026#34; ]; then echo \u0026#34;ä½¿ç”¨å°é›…æ¨èé•œåƒæº: $XIAOYA_MIRROR\u0026#34; sudo sed -i \u0026#34;s|\\\u0026#34;registry-mirrors\\\u0026#34;:.*|\\\u0026#34;registry-mirrors\\\u0026#34;: [\\\u0026#34;$XIAOYA_MIRROR\\\u0026#34;]|\u0026#34; /etc/docker/daemon.json sudo systemctl restart docker fi ğŸ” éªŒè¯æ•ˆæœ âœ… æ£€æŸ¥é…ç½®çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹ Docker ä¿¡æ¯ docker info # æ£€æŸ¥é•œåƒæºé…ç½® docker info | grep -A 10 \u0026#34;Registry Mirrors\u0026#34; # æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨ docker info | grep \u0026#34;Storage Driver\u0026#34; # æ£€æŸ¥æ•°æ®å­˜å‚¨è·¯å¾„ docker info | grep \u0026#34;Docker Root Dir\u0026#34; # æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ docker ps -a # æ£€æŸ¥é•œåƒåˆ—è¡¨ docker images âš¡ é€Ÿåº¦æµ‹è¯•å¯¹æ¯” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åˆ›å»ºé€Ÿåº¦æµ‹è¯•è„šæœ¬ cat \u0026gt; docker-speedtest.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;å¼€å§‹Dockeré•œåƒä¸‹è½½é€Ÿåº¦æµ‹è¯•...\u0026#34; # æµ‹è¯•é•œåƒåˆ—è¡¨ IMAGES=(\u0026#34;alpine:latest\u0026#34; \u0026#34;ubuntu:20.04\u0026#34; \u0026#34;nginx:alpine\u0026#34; \u0026#34;hello-world\u0026#34;) for image in \u0026#34;${IMAGES[@]}\u0026#34;; do echo \u0026#34;æµ‹è¯•ä¸‹è½½: $image\u0026#34; start_time=$(date +%s) docker pull $image \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 end_time=$(date +%s) duration=$((end_time - start_time)) echo \u0026#34;ä¸‹è½½ $image è€—æ—¶: ${duration}ç§’\u0026#34; docker rmi $image \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 echo \u0026#34;----------------------------------------\u0026#34; done EOF chmod +x docker-speedtest.sh ./docker-speedtest.sh ğŸ“Š ç›‘æ§ä¸‹è½½çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®æ—¶æŸ¥çœ‹ä¸‹è½½è¿›åº¦ docker pull ubuntu:20.04 # æŸ¥çœ‹é•œåƒå±‚ä¿¡æ¯ docker history ubuntu:20.04 # æ£€æŸ¥ç½‘ç»œè¿æ¥ docker run --rm busybox ping -c 4 docker.com # ç›‘æ§Dockerç³»ç»Ÿèµ„æºä½¿ç”¨ docker system df # æŸ¥çœ‹Dockerç£ç›˜ä½¿ç”¨è¯¦æƒ… docker system df -v ğŸ’¡ æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å®šæœŸæ›´æ–° Docker ç‰ˆæœ¬ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade docker-ce # æ£€æŸ¥å®¹å™¨å®‰å…¨çŠ¶æ€ docker scan ubuntu:20.04 # ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ docker stats # æ¸…ç†æ— ç”¨é•œåƒ docker system prune -a -f # æ£€æŸ¥å®¹å™¨æ¼æ´ docker run --rm aquasec/trivy image ubuntu:20.04 # ä½¿ç”¨érootç”¨æˆ·è¿è¡ŒDocker sudo groupadd docker sudo usermod -aG docker $USER newgrp docker ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 { \u0026#34;max-concurrent-downloads\u0026#34;: 10, \u0026#34;max-concurrent-uploads\u0026#34;: 5, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;10m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;3\u0026#34; }, \u0026#34;default-ulimits\u0026#34;: { \u0026#34;nofile\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;nofile\u0026#34;, \u0026#34;Hard\u0026#34;: 65536, \u0026#34;Soft\u0026#34;: 65536 } }, \u0026#34;features\u0026#34;: { \u0026#34;buildkit\u0026#34;: true }, \u0026#34;experimental\u0026#34;: false, \u0026#34;debug\u0026#34;: false, \u0026#34;metrics-addr\u0026#34;: \u0026#34;127.0.0.1:9323\u0026#34; } ğŸ”„ å®šæœŸç»´æŠ¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ¯å‘¨æ¸…ç†ä¸€æ¬¡æ— ç”¨èµ„æº 0 3 * * 0 docker system prune -af # æ¯æœˆæ£€æŸ¥æ›´æ–° 0 2 1 * * apt update \u0026amp;\u0026amp; apt list --upgradable # ç›‘æ§ç£ç›˜ä½¿ç”¨ df -h /vol1/docker # å¤‡ä»½Dockeré…ç½® 0 2 * * 0 tar -czf /backup/docker-config-$(date +\\%Y\\%m\\%d).tar.gz /etc/docker/ # æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€ 0 4 * * * docker ps --filter \u0026#34;health=unhealthy\u0026#34; --format \u0026#34;table {{.Names}}\\t{{.Status}}\u0026#34; | mail -s \u0026#34;Unhealthy Docker Containers\u0026#34; admin@example.com ğŸš¨ æ•…éšœæ’é™¤ ğŸ” å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æŸ¥çœ‹ Docker æ—¥å¿— sudo journalctl -u docker.service -n 50 --no-pager # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h /vol1/docker/ # æŸ¥çœ‹Dockerå­˜å‚¨è¯¦æƒ… docker system df -v # æµ‹è¯•ç½‘ç»œè¿æ¥ docker run --rm busybox nslookup docker.com # æ£€æŸ¥é•œåƒæºå¯è¾¾æ€§ curl -I https://docker.mirrors.ustc.edu.cn/v2/ # é‡ç½® Docker æœåŠ¡ sudo systemctl reset-failed docker # æ¸…ç†Dockerç¼“å­˜ docker builder prune # æ£€æŸ¥å®¹å™¨èµ„æºé™åˆ¶ docker run --rm --ulimit nofile=1024:1024 alpine ulimit -n ğŸ› é•œåƒæ‹‰å–å¤±è´¥å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # å½“é•œåƒæ‹‰å–å¤±è´¥æ—¶å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š # 1. æ£€æŸ¥ç½‘ç»œè¿æ¥ ping -c 4 114.114.114.114 # 2. æ£€æŸ¥DNSè§£æ nslookup docker.com # 3. å°è¯•ä½¿ç”¨ä¸åŒé•œåƒæº sudo sed -i \u0026#39;s|https://docker.mirrors.ustc.edu.cn|https://hub-mirror.c.163.com|\u0026#39; /etc/docker/daemon.json sudo systemctl restart docker # 4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status sudo iptables -L -n # 5. æ£€æŸ¥Dockerä»£ç†é…ç½® echo -e \u0026#34;{\\n \\\u0026#34;proxies\\\u0026#34;:\\n {\\n \\\u0026#34;default\\\u0026#34;:\\n {\\n \\\u0026#34;httpProxy\\\u0026#34;: \\\u0026#34;http://proxy.example.com:8080\\\u0026#34;,\\n \\\u0026#34;httpsProxy\\\u0026#34;: \\\u0026#34;http://proxy.example.com:8080\\\u0026#34;\\n }\\n }\\n}\u0026#34; | sudo tee /etc/docker/proxy.json # 6. ç›´æ¥ä¸‹è½½é•œåƒæ–‡ä»¶ curl -LO https://download.docker.com/linux/static/stable/x86_64/docker-20.10.9.tgz ğŸ“ æ—¥å¿—åˆ†ææŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å®æ—¶æŸ¥çœ‹Dockeræ—¥å¿— sudo journalctl -u docker.service -f # æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿— sudo journalctl -u docker.service --since \u0026#34;2023-01-01\u0026#34; --until \u0026#34;2023-01-02\u0026#34; # ç­›é€‰é”™è¯¯æ—¥å¿— sudo journalctl -u docker.service -p err # å¯¼å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ sudo journalctl -u docker.service --since \u0026#34;today\u0026#34; \u0026gt; docker-$(date +%Y%m%d).log # ä½¿ç”¨logrotateç®¡ç†Dockeræ—¥å¿— sudo tee /etc/logrotate.d/docker \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; /var/lib/docker/containers/*/*.log { rotate 7 daily compress delaycompress missingok copytruncate } EOF ğŸ¯ æç¤º: å»ºè®®æ ¹æ®å®é™…ç½‘ç»œç¯å¢ƒé€‰æ‹©æœ€é€‚åˆçš„é•œåƒæºã€‚å›½å†…ç”¨æˆ·ä¼˜å…ˆé€‰æ‹©å›½å†…é•œåƒæºï¼Œæµ·å¤–ç”¨æˆ·å¯é€‰æ‹©å›½é™…é•œåƒæºã€‚\nğŸ“š æ‰©å±•èµ„æº:\nDocker å®˜æ–¹æ–‡æ¡£ USTC é•œåƒç«™å¸®åŠ© 1Panel æ–‡æ¡£ Docker æœ€ä½³å®è·µ ğŸ”§ ç´§æ€¥æ¢å¤:\n1 2 3 4 5 6 7 8 # å¦‚æœé…ç½®é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½ sudo cp /etc/docker/daemon.json.bak /etc/docker/daemon.json sudo systemctl restart docker # å®Œå…¨é‡ç½®Dockerï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ sudo systemctl stop docker sudo rm -rf /var/lib/docker sudo systemctl start docker ğŸ’¡ ä¸“ä¸šå»ºè®®:\nä½¿ç”¨å®¹å™¨ç›‘æ§å·¥å…·å¦‚ Portainer æˆ– Docker Scout å®æ–½é•œåƒç­¾åå’ŒéªŒè¯å¢å¼ºå®‰å…¨æ€§ ä½¿ç”¨ Docker Content Trust (DCT) ç¡®ä¿é•œåƒå®Œæ•´æ€§ å®šæœŸè¿›è¡Œå®‰å…¨æ‰«æå’Œæ¼æ´è¯„ä¼° å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨ä¼˜åŒ– FnOS ä¸Šçš„ Docker æ€§èƒ½ï¼ğŸš€\n","date":"2024-12-30T18:38:45+08:00","image":"https://file.meimolihan.eu.org/screenshot/fnos-001.webp","permalink":"https://blog.meimolihan.eu.org/p/edf8a189/","title":"FnOS Docker é•œåƒæºä¼˜åŒ–æŒ‡å—  ğŸ³"},{"content":"Caddy æœåŠ¡å™¨å®‰è£…ä¸å¸è½½ ğŸš€ ğŸŒ ç°ä»£åŒ–çš„ Web æœåŠ¡å™¨ï¼Œè‡ªåŠ¨ HTTPSï¼Œé…ç½®ç®€å•\nğŸ“‹ ç›®å½• ğŸ¯ ç®€ä»‹ ğŸ“¦ å®‰è£…æ–¹æ³• ğŸ—‘ï¸ å¸è½½æ–¹æ³• ğŸ”§ ç»´æŠ¤å‘½ä»¤ âš™ï¸ é…ç½®æ–‡ä»¶ ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ ç®€ä»‹ ğŸŒŸ Caddy ç‰¹ç‚¹ âœ… è‡ªåŠ¨ HTTPSï¼šè‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ SSL è¯ä¹¦ âœ… ç®€å•é…ç½®ï¼šç®€æ´çš„ Caddyfile è¯­æ³• âœ… é«˜æ€§èƒ½ï¼šåŸºäº Go è¯­è¨€å¼€å‘ âœ… é›¶ä¾èµ–ï¼šå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿è¡Œ ğŸ”— é‡è¦é“¾æ¥ ğŸŒ å®˜ç½‘: https://caddyserver.com/ ğŸ“¥ ä¸‹è½½: https://caddyserver.com/download ğŸ“š æ–‡æ¡£: https://caddy2.dengxiaolong.com/docs/ ğŸ¥ è§†é¢‘æ•™ç¨‹: https://www.bilibili.com/video/BV1wU4y1u7tf ğŸ“– æ•™ç¨‹æ–‡æ¡£: https://www.cnblogs.com/wzcsxjl/p/15517168.html ğŸ“¦ å®‰è£…æ–¹æ³• ğŸ§ APT å®‰è£…ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£… Caddy sudo apt install caddy -y # éªŒè¯å®‰è£… caddy version # æŸ¥çœ‹å®‰è£…ä¿¡æ¯ caddy list-modules ğŸ“Š éªŒè¯å®‰è£… 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç‰ˆæœ¬ caddy version # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status caddy # æ£€æŸ¥ç›‘å¬ç«¯å£ sudo netstat -tulnp | grep caddy ğŸ”§ è‡ªå®šä¹‰å®‰è£… 1 2 3 4 5 6 7 # ä¸‹è½½ç‰¹å®šç‰ˆæœ¬ wget https://github.com/caddyserver/caddy/releases/download/v2.7.6/caddy_2.7.6_linux_amd64.tar.gz # è§£å‹å¹¶å®‰è£… tar -xzf caddy_2.7.6_linux_amd64.tar.gz sudo mv caddy /usr/local/bin/ sudo chmod +x /usr/local/bin/caddy ğŸ—‘ï¸ å¸è½½æ–¹æ³• ğŸ”„ å®Œæ•´å¸è½½æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 1. åœæ­¢ Caddy æœåŠ¡ sudo systemctl stop caddy # 2. ç¦ç”¨å¼€æœºè‡ªå¯ sudo systemctl disable caddy # 3. ç§»é™¤è½¯ä»¶åŒ… sudo apt remove caddy -y # 4. æ¸…é™¤é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ sudo apt purge caddy # 5. ç§»é™¤æ— ç”¨ä¾èµ– sudo apt autoremove -y # 6. éªŒè¯å¸è½½ dpkg -l | grep caddy ğŸ§¹ æ¸…ç†æ®‹ç•™æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ é™¤é…ç½®æ–‡ä»¶ sudo rm -rf /etc/caddy/ sudo rm -rf /etc/ssl/caddy/ # åˆ é™¤æ—¥å¿—æ–‡ä»¶ sudo rm -rf /var/log/caddy/ # åˆ é™¤æ•°æ®æ–‡ä»¶ sudo rm -rf /var/lib/caddy/ # åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚æœè‡ªå®šä¹‰å®‰è£…ï¼‰ sudo rm -f /usr/local/bin/caddy âœ… éªŒè¯å½»åº•å¸è½½ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥è¿›ç¨‹ ps aux | grep caddy # æ£€æŸ¥æ–‡ä»¶æ®‹ç•™ which caddy ls -la /usr/bin/caddy /usr/local/bin/caddy 2\u0026gt;/dev/null # æ£€æŸ¥æœåŠ¡é…ç½® systemctl list-unit-files | grep caddy ğŸ”§ ç»´æŠ¤å‘½ä»¤ ğŸ› ï¸ æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¯åŠ¨æœåŠ¡ sudo systemctl start caddy # åœæ­¢æœåŠ¡ sudo systemctl stop caddy # é‡å¯æœåŠ¡ sudo systemctl restart caddy # é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ sudo systemctl reload caddy # æŸ¥çœ‹çŠ¶æ€ sudo systemctl status caddy # å¯ç”¨å¼€æœºè‡ªå¯ sudo systemctl enable caddy # ç¦ç”¨å¼€æœºè‡ªå¯ sudo systemctl disable caddy ğŸ“ é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• sudo caddy validate --config /etc/caddy/Caddyfile # æ ¼å¼åŒ–é…ç½®æ–‡ä»¶ sudo caddy fmt --overwrite /etc/caddy/Caddyfile # æµ‹è¯•é…ç½® sudo caddy adapt --config /etc/caddy/Caddyfile # æŸ¥çœ‹å½“å‰é…ç½® sudo caddy environ ğŸ“Š æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å®æ—¶æ—¥å¿— sudo journalctl -u caddy -f # æŸ¥çœ‹æœ€è¿‘æ—¥å¿— sudo journalctl -u caddy --since \u0026#34;1 hour ago\u0026#34; # æŸ¥çœ‹é”™è¯¯æ—¥å¿— sudo journalctl -u caddy -p err # æ—¥å¿—æ–‡ä»¶ä½ç½® tail -f /var/log/caddy/access.log tail -f /var/log/caddy/error.log âš™ï¸ é…ç½®æ–‡ä»¶ ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„ 1 2 3 4 5 6 7 /etc/caddy/ â”œâ”€â”€ Caddyfile # ä¸»é…ç½®æ–‡ä»¶ â”œâ”€â”€ ssl/ # SSLè¯ä¹¦ç›®å½• â”‚ â”œâ”€â”€ private.key â”‚ â””â”€â”€ fullchain.pem â””â”€â”€ conf.d/ # é™„åŠ é…ç½®ç›®å½• â””â”€â”€ *.conf ğŸ“ åŸºç¡€é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # /etc/caddy/Caddyfile { # å…¨å±€é…ç½® http_port 80 https_port 443 auto_https disable_redirects } # ç¤ºä¾‹ç«™ç‚¹é…ç½® example.com { root * /var/www/html file_server encode gzip # PHPæ”¯æŒ php_fastcgi unix//var/run/php/php-fpm.sock # æ—¥å¿—é…ç½® log { output file /var/log/caddy/access.log format json } } # åå‘ä»£ç†ç¤ºä¾‹ api.example.com { reverse_proxy localhost:3000 { header_up Host {host} header_up X-Real-IP {remote} header_up X-Forwarded-For {remote} header_up X-Forwarded-Proto {scheme} } } ğŸ”’ SSL é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # è‡ªåŠ¨SSL https://mysite.com { tls { dns cloudflare {env.CF_API_TOKEN} } root * /var/www/mysite file_server } # è‡ªå®šä¹‰è¯ä¹¦ https://mysite.com:8443 { tls /etc/ssl/certs/mysite.crt /etc/ssl/private/mysite.key root * /var/www/mysite file_server } ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ¯ æœ€å°åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºæµ‹è¯•ç›®å½• sudo mkdir -p /var/www/html echo \u0026#34;Hello Caddy!\u0026#34; | sudo tee /var/www/html/index.html # åˆ›å»ºåŸºç¡€é…ç½® sudo tee /etc/caddy/Caddyfile \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; :80 { root * /var/www/html file_server } EOF # å¯åŠ¨æœåŠ¡ sudo systemctl start caddy # æµ‹è¯•è®¿é—® curl http://localhost ğŸ”„ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/bin/bash # Caddy ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è„šæœ¬ # åˆ›å»ºç›®å½•ç»“æ„ sudo mkdir -p /etc/caddy/ssl /var/log/caddy /var/lib/caddy sudo chown -R www-data:www-data /var/log/caddy /var/lib/caddy # åˆ›å»ºé…ç½®æ–‡ä»¶ sudo tee /etc/caddy/Caddyfile \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { email admin@example.com on_demand_tls { ask http://localhost:8080/check-domain } } *.example.com { tls { on_demand } reverse_proxy localhost:3000 } EOF # å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ sudo systemctl enable caddy sudo systemctl start caddy ğŸ’¡ æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /var/lib/caddy sudo chmod 755 /var/lib/caddy sudo chmod 600 /etc/caddy/ssl/*.key # é˜²ç«å¢™é…ç½® sudo ufw allow 80/tcp comment \u0026#39;Caddy HTTP\u0026#39; sudo ufw allow 443/tcp comment \u0026#39;Caddy HTTPS\u0026#39; # å®šæœŸæ›´æ–° sudo apt update \u0026amp;\u0026amp; sudo apt upgrade caddy ğŸ“ˆ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æ€§èƒ½ä¼˜åŒ–é…ç½® { # è¿æ¥é™åˆ¶ servers { max_connections 1000 } # ç¼“å†²åŒºå¤§å° buffers { read 4096 write 4096 } # è¶…æ—¶è®¾ç½® timeouts { read 30s write 30s idle 60s } # æ—¥å¿—è½®è½¬ log { output file /var/log/caddy/access.log { roll_size 100mb roll_keep 10 } } } ğŸ”„ å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/bin/bash # Caddy å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup/caddy/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR # å¤‡ä»½é…ç½® cp -r /etc/caddy $BACKUP_DIR/ cp -r /var/lib/caddy $BACKUP_DIR/data/ # å¤‡ä»½SSLè¯ä¹¦ cp -r /etc/ssl/caddy $BACKUP_DIR/ssl/ # åˆ›å»ºå‹ç¼©åŒ… tar -czf $BACKUP_DIR/caddy-backup.tar.gz $BACKUP_DIR echo \u0026#34;å¤‡ä»½å®Œæˆ: $BACKUP_DIR/caddy-backup.tar.gz\u0026#34; ğŸš¨ æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ sudo caddy run --config /etc/caddy/Caddyfile --watch # æ£€æŸ¥ç«¯å£å ç”¨ sudo lsof -i :80 sudo lsof -i :443 # æµ‹è¯•ç½‘ç»œè¿æ¥ curl -v http://localhost curl -vk https://localhost # é‡ç½®æœåŠ¡çŠ¶æ€ sudo systemctl reset-failed caddy ğŸ¯ æç¤º: Caddy çš„é…ç½®éå¸¸çµæ´»ï¼Œå»ºè®®ä»ç®€å•é…ç½®å¼€å§‹ï¼Œé€æ­¥æ·»åŠ å¤æ‚åŠŸèƒ½ã€‚ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·å……åˆ†æµ‹è¯•ã€‚\nğŸ“š å­¦ä¹ èµ„æº:\nå®˜æ–¹æ–‡æ¡£ é…ç½®ç¤ºä¾‹ ç¤¾åŒºè®ºå› ğŸ”§ éœ€è¦å¸®åŠ©?:\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ caddy help # æŸ¥çœ‹æ¨¡å—å¸®åŠ© caddy help modules # æŸ¥çœ‹ç¯å¢ƒå˜é‡ caddy environ ","date":"2024-12-26T19:15:02+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/fd150560/","title":"Caddy æœåŠ¡å™¨å®‰è£…ä¸å¸è½½ ğŸš€"},{"content":"Docker éƒ¨ç½² Music-Tag éŸ³ä¹å…ƒæ•°æ®åˆ®å‰Šå™¨ ğŸµ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Music-Tag 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Music-Tag 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ 3. æœ€ä½³å®è·µ ğŸ’¡ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸµ å¯èˆªéŸ³ä¹ï¼Œå®Œå–„æ”¶è— ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Music-Tag å®˜ç½‘åœ°å€ï¼š https://xiers-organization.gitbook.io/music-tag-web-v2 ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/xhongc/music-tag-web ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/xhongc/music_tag_web Music-Tag æ˜¯ä¸€ä¸ªåŸºäº Web çš„éŸ³ä¹å…ƒæ•°æ®åˆ®å‰Šå·¥å…·ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ä¸ºæ‚¨çš„éŸ³ä¹æ–‡ä»¶æ·»åŠ å’Œç¼–è¾‘å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸“è¾‘å°é¢ã€è‰ºæœ¯å®¶ä¿¡æ¯ã€ä¸“è¾‘åç§°ã€æ›²ç›®ç¼–å·ç­‰ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç†å’Œç¾åŒ–æ‚¨çš„éŸ³ä¹åº“ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ·ï¸ è‡ªåŠ¨å…ƒæ•°æ®åˆ®å‰Š ä»å¤šç§åœ¨çº¿èµ„æºè‡ªåŠ¨è·å–éŸ³ä¹å…ƒæ•°æ® æ”¯æŒå¤šä¸ªæ•°æ®æºï¼Œä¿¡æ¯å‡†ç¡®ä¸°å¯Œ ğŸ¨ ä¸“è¾‘å°é¢ä¸‹è½½ è‡ªåŠ¨æŸ¥æ‰¾å¹¶æ·»åŠ é«˜è´¨é‡çš„ä¸“è¾‘å°é¢ æå‡éŸ³ä¹åº“è§†è§‰ä½“éªŒ ğŸŒ Web ç•Œé¢ ç›´è§‚çš„æµè§ˆå™¨æ“ä½œç•Œé¢ æ— éœ€å‘½ä»¤è¡ŒçŸ¥è¯†ï¼Œæ“ä½œç®€å• ğŸ”„ æ‰¹é‡å¤„ç† æ”¯æŒæ‰¹é‡å¤„ç†æ•´ä¸ªéŸ³ä¹åº“æˆ–ç‰¹å®šæ–‡ä»¶å¤¹ é«˜æ•ˆç®¡ç†å¤§é‡éŸ³ä¹æ–‡ä»¶ ğŸ“ å¤šæ ¼å¼æ”¯æŒ æ”¯æŒ MP3ã€FLACã€AACã€OGG ç­‰å¸¸è§éŸ³é¢‘æ ¼å¼ å…¼å®¹ä¸»æµéŸ³é¢‘æ ¼å¼ ğŸ” æ™ºèƒ½åŒ¹é… åŸºäºæ–‡ä»¶åå’Œç°æœ‰å…ƒæ•°æ®æ™ºèƒ½åŒ¹é…æ­£ç¡®ä¿¡æ¯ æé«˜åŒ¹é…å‡†ç¡®ç‡ ğŸ’¾ é…ç½®æŒä¹…åŒ– æ‰€æœ‰è®¾ç½®å’Œè¿›åº¦è‡ªåŠ¨ä¿å­˜ é¿å…é‡å¤é…ç½®ï¼Œä½¿ç”¨æ›´ä¾¿æ· ğŸ³ ä¸€ã€Docker éƒ¨ç½² Music-Tag 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 mkdir -p /mnt/mydisk/home/music-tag \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: music-tag: image: xhongc/music_tag_web:latest container_name: music-tag restart: unless-stopped ports: - \u0026#34;8001:8001\u0026#34; volumes: - ./music:/app/media:rw - ./config:/app/data EOF ğŸ” é»˜è®¤ç™»å½•å‡­æ®ï¼šç”¨æˆ·å admin / å¯†ç  adminï¼Œé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Music-Tag 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8001 åŸŸåè®¿é—®: https://music-tag.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼ˆadmin/adminï¼‰ ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  é…ç½®éŸ³ä¹ç›®å½•è·¯å¾„ï¼ˆé»˜è®¤ä¸º /app/mediaï¼‰ å¼€å§‹æ‰«æå’Œæ•´ç†éŸ³ä¹å…ƒæ•°æ® 3. æœ€ä½³å®è·µ ğŸ’¡ å®è·µå»ºè®® è¯´æ˜ å¥½å¤„ ğŸ“¦ å…ˆå¤‡ä»½ åœ¨å¯¹å¤§é‡éŸ³ä¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½åŸå§‹æ–‡ä»¶ é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå¯å›æ»šæ“ä½œ ğŸ”¢ åˆ†æ‰¹å¤„ç† å…ˆå¤„ç†å°‘é‡æ–‡ä»¶æµ‹è¯•æ•ˆæœï¼Œå†æ‰¹é‡å¤„ç†æ•´ä¸ªåº“ é¿å…å¤§è§„æ¨¡é”™è¯¯æ“ä½œ ğŸ‘€ æ‰‹åŠ¨å®¡æ ¸ è‡ªåŠ¨åˆ®å‰Šåï¼Œæ‰‹åŠ¨æ£€æŸ¥é‡è¦å…ƒæ•°æ®ç¡®ä¿å‡†ç¡®æ€§ ä¿è¯å…ƒæ•°æ®è´¨é‡ ğŸ”„ å®šæœŸæ›´æ–° ä¿æŒå®¹å™¨é•œåƒæ›´æ–°ä»¥è·å¾—æœ€æ–°åŠŸèƒ½å’Œæ•°æ®æº è·å¾—æ›´å¥½çš„åˆ®å‰Šæ•ˆæœ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://music-tag.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/music-tag.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name music-tag.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 10M; location / { proxy_pass http://localhost:8001; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/music-tag # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop music-tag # åœæ­¢å®¹å™¨ docker start music-tag # å¯åŠ¨å®¹å™¨ docker restart music-tag # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm music-tag # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f music-tag # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it music-tag bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ docker exec -it music-tag sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect music-tag # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats music-tag # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs music-tag # æŸ¥çœ‹æ—¥å¿— docker logs -f music-tag # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 music-tag # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t music-tag # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸµ å¯èˆªéŸ³ä¹ï¼Œå®Œå–„æ”¶è— é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Music-Tag éŸ³ä¹å…ƒæ•°æ®åˆ®å‰Šå™¨ï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ§ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨å®Œå–„éŸ³ä¹æ–‡ä»¶çš„å…ƒæ•°æ®å’Œä¸“è¾‘å°é¢ï¼Œæ‰“é€ æ•´æ´è§„èŒƒçš„éŸ³ä¹åº“\nğŸŒ éšæ—¶éšåœ° é€šè¿‡ç½‘é¡µç•Œé¢è½»æ¾æ•´ç†éŸ³ä¹æ”¶è—ï¼Œæ— éœ€å®‰è£…å¤æ‚è½¯ä»¶\nâš¡ é«˜æ•ˆæ‰¹å¤„ç† å¿«é€Ÿæ•´ç†å¤§é‡éŸ³ä¹æ–‡ä»¶ï¼ŒèŠ‚çœæ‰‹åŠ¨ç¼–è¾‘çš„æ—¶é—´å’Œç²¾åŠ›\nğŸ¨ è§†è§‰å‡çº§ ä¸ºéŸ³ä¹åº“æ·»åŠ é«˜è´¨é‡å°é¢è‰ºæœ¯ï¼Œæå‡æµè§ˆå’Œæ’­æ”¾ä½“éªŒ\néŸ³ä¹ä¸ä»…æ˜¯å¬è§‰çš„äº«å—ï¼Œæ›´æ˜¯æƒ…æ„Ÿçš„å¯„æ‰˜ã€‚æ„¿ Music-Tag æˆä¸ºä½ éŸ³ä¹ç®¡ç†çš„å¥½å¸®æ‰‹ï¼Œè®©ä½ çš„æ¯ä¸€é¦–æ”¶è—éƒ½å®Œæ•´ã€è§„èŒƒã€ç¾è§‚ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå®Œå–„ä½ çš„éŸ³ä¹åº“ï¼Œè®©æ¯ä¸€é¦–æ­Œæ›²éƒ½æ‹¥æœ‰å®Œæ•´çš„æ•…äº‹ï¼ğŸ¶\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Music-Tag å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸æ•°æ®æºä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æ•´ç†æ„‰å¿«ï¼ŒéŸ³ä¹æœ‰æˆï¼ğŸ‰\n","date":"2024-12-23T10:09:35+08:00","image":"https://file.meimolihan.eu.org/img/docker-music-tag-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a4b8d570/","title":"Docker éƒ¨ç½² Music-Tag éŸ³ä¹å…ƒæ•°æ®åˆ®å‰Šå™¨ ğŸµ"},{"content":"Docker éƒ¨ç½² Musicn éŸ³ä¹ä¸‹è½½æœåŠ¡ ğŸµ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Musicn 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Musicn 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªéŸ³ä¹ï¼Œè†å¬æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/wy580477/musicn-container Musicn æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„éŸ³ä¹ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒä»å¤šä¸ªéŸ³ä¹å¹³å°æœç´¢å’Œä¸‹è½½é«˜å“è´¨éŸ³ä¹ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ Musicnï¼Œå®ç°ä¾¿æ·çš„éŸ³ä¹èµ„æºè·å–å’Œç®¡ç†ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸµ å¤šå¹³å°æ”¯æŒ æ”¯æŒç½‘æ˜“äº‘ã€é…·ç‹—ç­‰å¤šä¸ªéŸ³ä¹å¹³å° èµ„æºä¸°å¯Œï¼Œè¦†ç›–å¹¿æ³› ğŸ” æ™ºèƒ½æœç´¢ å¼ºå¤§çš„æœç´¢ç®—æ³•å’Œè¿‡æ»¤åŠŸèƒ½ ç²¾å‡†æ‰¾åˆ°æ‰€éœ€éŸ³ä¹ ğŸ“¥ æ‰¹é‡ä¸‹è½½ æ”¯æŒå•æ›²å’Œæ­Œå•æ‰¹é‡ä¸‹è½½ æé«˜ä¸‹è½½æ•ˆç‡ ğŸ¨ æ ‡ç­¾å®Œå–„ è‡ªåŠ¨æ·»åŠ éŸ³ä¹å…ƒæ•°æ®å’Œå°é¢ æ•´ç†éŸ³ä¹åº“æ›´åŠ è§„èŒƒ ğŸŒ Webç•Œé¢ å‹å¥½çš„å›¾å½¢åŒ–æ“ä½œç•Œé¢ ä½¿ç”¨ç®€å•ç›´è§‚ âš¡ é«˜é€Ÿä¸‹è½½ ä¼˜åŒ–çš„ä¸‹è½½å¼•æ“å’Œå¤šçº¿ç¨‹æ”¯æŒ å¿«é€Ÿè·å–éŸ³ä¹èµ„æº ğŸ“± å¤šæ ¼å¼æ”¯æŒ æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ä¸‹è½½ æ»¡è¶³ä¸åŒè®¾å¤‡éœ€æ±‚ ğŸ”’ æœ¬åœ°åŒ–éƒ¨ç½² å®Œå…¨è‡ªä¸»æ§åˆ¶çš„éŸ³ä¹ä¸‹è½½æœåŠ¡ ä¿æŠ¤ç”¨æˆ·éšç§å’Œå®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Musicn 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 mkdir -p /mnt/mydisk/home/musicn \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: musicn: container_name: musicn image: ghcr.io/wy580477/musicn-container:latest restart: always ports: - \u0026#34;7478:7478\u0026#34; volumes: - ./data:/data environment: - TZ=Asia/Shanghai EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Musicn 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:7478 åŸŸåè®¿é—®ï¼š https://musicn.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æ­Œæ‰‹åæˆ–æ­Œæ›²å é€‰æ‹©å–œæ¬¢çš„éŸ³ä¹å¹³å°è¿›è¡Œæœç´¢ ä»æœç´¢ç»“æœä¸­é€‰æ‹©è¦ä¸‹è½½çš„éŸ³ä¹ è®¾ç½®ä¸‹è½½è·¯å¾„å’Œæ ¼å¼é€‰é¡¹ å¼€å§‹ä¸‹è½½éŸ³ä¹ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://musicn.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/musicn.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name musicn.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:7478; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªéŸ³ä¹ï¼Œè†å¬æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Musicn éŸ³ä¹ä¸‹è½½æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸµ å¤šæºç•…äº« æ”¯æŒä»ç½‘æ˜“äº‘ã€é…·ç‹—ç­‰å¤šä¸ªå¹³å°æœç´¢å’Œä¸‹è½½éŸ³ä¹ï¼Œæ¶µç›–ä¸°å¯ŒéŸ³ä¹èµ„æº ğŸŒ ä¾¿æ·æ“ä½œ æä¾›Webå›¾å½¢ç•Œé¢ï¼Œæ— éœ€å¤æ‚å‘½ä»¤å³å¯è½»æ¾æœç´¢ã€æ’­æ”¾å’Œä¸‹è½½éŸ³ä¹ ğŸ”’ æœ¬åœ°æŒæ§ æ•°æ®åœ¨æœ¬åœ°å¤„ç†ï¼Œä¿æŠ¤éšç§å®‰å…¨ï¼Œæ„å»ºä¸“å±éŸ³ä¹åº“\nè¯·æ³¨æ„ï¼šå½“å‰ Musicn ä¸»è¦æ”¯æŒä¸‹è½½æ™®é€š MP3 æ ¼å¼çš„éŸ³ä¹ï¼Œæš‚æ— æ³•ä¸‹è½½æ— æŸæ ¼å¼åŠéƒ¨åˆ†å¹³å°çš„ä¼šå‘˜ä¸“å±æ­Œæ›²ã€‚\néŸ³ä¹ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç¾å¦™æ—‹å¾‹ç›¸ä¼´çš„æ„‰æ‚¦æ—…ç¨‹ã€‚æ„¿ Musicn æˆä¸ºä½ è´´å¿ƒçš„éŸ³ä¹åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡éŸ³ä¹å‘ç°å’Œæ¬£èµçš„ç¾å¥½æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ¢ç´¢éŸ³ä¹ï¼Œçè—æ‰€çˆ±â€”â€”æ„å»ºä½ ä¸ªæ€§åŒ–çš„éŸ³ä¹ä¸–ç•Œå§ï¼ğŸ¶\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Musicn å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚ ğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè†å¬æ„‰æ‚¦ï¼ğŸ‰\n","date":"2024-12-23T09:08:07+08:00","image":"https://file.meimolihan.eu.org/img/docker-musicn-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2c9554e9/","title":"Docker éƒ¨ç½² Musicn éŸ³ä¹ä¸‹è½½æœåŠ¡ ğŸ³"},{"content":"Docker éƒ¨ç½² IPTV-API ç›´æ’­æºæœåŠ¡ ğŸ“º ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IPTV-API 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 2. é€‰æ‹©ç‰ˆæœ¬éƒ¨ç½² ğŸ”„ 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€IPTV-API ä½¿ç”¨æ•™ç¨‹ 1. æ¥å£è¯´æ˜ ğŸŒ 2. å®¢æˆ·ç«¯é…ç½® ğŸ“± 3. é…ç½®å‚æ•°è°ƒæ•´ âš™ï¸ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç›´æ’­è§†ç•Œï¼Œæ¢ç´¢æ— é™ç²¾å½© ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Guovin/iptv-api ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/guovern/iptv-api IPTV-API æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ç›´æ’­æºå¤„ç†æœåŠ¡ï¼Œæä¾›ç›´æ’­æºçš„èšåˆã€éªŒè¯ã€è¿‡æ»¤å’Œè½¬æ¢åŠŸèƒ½ã€‚å®ƒæ”¯æŒå¤šç§ç›´æ’­æºæ ¼å¼ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤æ— æ•ˆé“¾æ¥ï¼Œä¸ºç”¨æˆ·æä¾›ç¨³å®šå¯é çš„ç›´æ’­æºæœåŠ¡ã€‚ğŸŒ\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“¡ å¤šæºèšåˆ æ”¯æŒä»å¤šä¸ªæ¥æºèšåˆç›´æ’­æº ä¸°å¯Œçš„é¢‘é“æ¥æºï¼Œé¿å…å•ä¸€æºå¤±æ•ˆ âš¡ å®æ—¶éªŒè¯ è‡ªåŠ¨æ£€æµ‹å’ŒéªŒè¯ç›´æ’­æºæœ‰æ•ˆæ€§ ç¡®ä¿ç›´æ’­æºå¯ç”¨æ€§ï¼Œæå‡è§‚çœ‹ä½“éªŒ ğŸ”„ æ ¼å¼è½¬æ¢ æ”¯æŒ M3Uã€TXT ç­‰å¤šç§è¾“å‡ºæ ¼å¼ å…¼å®¹å„ç§æ’­æ”¾å™¨å’Œåº”ç”¨ ğŸ¯ æ™ºèƒ½è¿‡æ»¤ æ ¹æ®è§„åˆ™è¿‡æ»¤ä¸éœ€è¦çš„é¢‘é“ å®šåˆ¶ä¸ªæ€§åŒ–é¢‘é“åˆ—è¡¨ ğŸ“Š æ€§èƒ½ç›‘æ§ æä¾›è¯¦ç»†çš„æµ‹é€Ÿå’Œæ€§èƒ½æ—¥å¿— å®æ—¶äº†è§£æœåŠ¡çŠ¶æ€å’Œæ€§èƒ½ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker ä¸€é”®éƒ¨ç½²ï¼Œç®€å•æ˜“ç”¨ å¿«é€Ÿéƒ¨ç½²ï¼Œæ˜“äºç»´æŠ¤ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IPTV-API 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 1 2 mkdir -p /mnt/mydisk/home/iptv-api \u0026amp;\u0026amp; \\ cd /mnt/mydisk/home/iptv-api 2. é€‰æ‹©ç‰ˆæœ¬éƒ¨ç½² ğŸ”„ ç‰ˆæœ¬é€‰æ‹©æŒ‡å— ç‰ˆæœ¬ç±»å‹ ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ æ¨èé…ç½® å®Œæ•´ç‰ˆæœ¬ æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œæ›´æ–°é€Ÿåº¦è¾ƒæ…¢ï¼Œç¨³å®šæ€§ã€æˆåŠŸç‡é«˜ é…’åº—æºã€ç»„æ’­æºã€å…³é”®å­—æœç´¢ ä¿®æ”¹ open_driver = False å¯åˆ‡æ¢åˆ° Lite æ¨¡å¼ ç²¾ç®€ç‰ˆæœ¬ è½»é‡çº§ï¼Œæ€§èƒ½è¦æ±‚ä½ï¼Œæ›´æ–°é€Ÿåº¦å¿«ï¼Œç¨³å®šæ€§ä¸ç¡®å®š è®¢é˜…æºä½¿ç”¨ é€‚åˆèµ„æºæœ‰é™çš„è¿è¡Œç¯å¢ƒ é€‰é¡¹ A: å®Œæ•´ç‰ˆæœ¬éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: iptv-api: image: guovern/iptv-api:latest container_name: iptv-api ports: - \u0026#34;8755:8000\u0026#34; # ğŸŒ æœåŠ¡ç«¯å£æ˜ å°„ volumes: - ./config:/iptv-api/config # âš™ï¸ é…ç½®æ–‡ä»¶ç›®å½• - ./output:/iptv-api/output # ğŸ’¾ è¾“å‡ºæ–‡ä»¶ç›®å½• environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® restart: unless-stopped # ğŸ”„ è‡ªåŠ¨é‡å¯ healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8000/m3u\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF é€‰é¡¹ B: ç²¾ç®€ç‰ˆæœ¬éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: iptv-api: image: guovern/iptv-api:lite container_name: iptv-api ports: - \u0026#34;8755:8000\u0026#34; # ğŸŒ æœåŠ¡ç«¯å£æ˜ å°„ volumes: - ./config:/iptv-api/config # âš™ï¸ é…ç½®æ–‡ä»¶ç›®å½• - ./output:/iptv-api/output # ğŸ’¾ è¾“å‡ºæ–‡ä»¶ç›®å½• environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® restart: unless-stopped # ğŸ”„ è‡ªåŠ¨é‡å¯ healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8000/m3u\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€IPTV-API ä½¿ç”¨æ•™ç¨‹ 1. æ¥å£è¯´æ˜ ğŸŒ éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥å£è®¿é—®æœåŠ¡:\næ¥å£ç±»å‹ è®¿é—®åœ°å€ åŠŸèƒ½æè¿° ğŸŒ åŸºç¡€åœ°å€ http://æœåŠ¡å™¨IP:8755 æœåŠ¡æ ¹ç›®å½• ğŸ“º M3U æ¥å£ http://æœåŠ¡å™¨IP:8755/m3u è·å– M3U æ ¼å¼ç›´æ’­æº ğŸ“„ TXT æ¥å£ http://æœåŠ¡å™¨IP:8755/txt è·å– TXT æ ¼å¼ç›´æ’­æºï¼ˆé¿å…é‡å¤é¢‘é“ï¼‰ ğŸ” å†…å®¹æ¥å£ http://æœåŠ¡å™¨IP:8755/content æŸ¥çœ‹å¤„ç†åçš„å†…å®¹ ğŸ“Š æµ‹é€Ÿæ—¥å¿— http://æœåŠ¡å™¨IP:8755/log æŸ¥çœ‹æ€§èƒ½ç›‘æ§æ—¥å¿— 2. å®¢æˆ·ç«¯é…ç½® ğŸ“± å½±è§†ä»“é…ç½®: ä½¿ç”¨ TXT æ¥å£é¿å…é‡å¤é¢‘é“ é…ç½®åœ°å€: http://æœåŠ¡å™¨IP:8755/txt å…¶ä»–æ’­æ”¾å™¨é…ç½®: æ’­æ”¾å™¨ç±»å‹ æ¨èæ¥å£ é…ç½®è¯´æ˜ VLC M3U æ¥å£ æ”¯æŒæ ‡å‡† M3U æ ¼å¼ Kodi M3U æ¥å£ å…¼å®¹å„ç§ IPTV æ’ä»¶ Tivimate M3U æ¥å£ ä¸“ä¸š IPTV æ’­æ”¾å™¨ Perfect Player M3U æ¥å£ è½»é‡çº§æ’­æ”¾å™¨ 3. é…ç½®å‚æ•°è°ƒæ•´ âš™ï¸ è¯¦ç»†é…ç½®å‚æ•°å‚è€ƒ: https://github.com/Guovin/iptv-api/blob/master/docs/config.md é…ç½®é¡¹ é»˜è®¤å€¼ è¯´æ˜ å»ºè®® open_driver True å¼€å¯å®Œæ•´åŠŸèƒ½æ¨¡å¼ è®¾ä¸º False å¯åˆ‡æ¢ç²¾ç®€æ¨¡å¼ update_interval 3600 æºæ›´æ–°é—´éš”(ç§’) æ ¹æ®éœ€æ±‚è°ƒæ•´æ›´æ–°é¢‘ç‡ filter_rules [] è¿‡æ»¤è§„åˆ™åˆ—è¡¨ è‡ªå®šä¹‰é¢‘é“è¿‡æ»¤æ¡ä»¶ priority_sources [] ä¼˜å…ˆçº§æºåˆ—è¡¨ è®¾ç½®é‡è¦æºçš„ä¼˜å…ˆçº§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://iptv-api.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/iptv-api.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name iptv-api.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ€§èƒ½ä¼˜åŒ– sendfile on; tcp_nopush on; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://localhost:8755; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; # ç¼“å†²è®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; proxy_max_temp_file_size 0; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— # å¥åº·æ£€æŸ¥ docker inspect --format=\u0026#39;{{.State.Health.Status}}\u0026#39; iptv-api 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªç›´æ’­è§†ç•Œï¼Œæ¢ç´¢æ— é™ç²¾å½© é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† IPTV-API ç›´æ’­æºæœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“º éšæ—¶éšåœ° äº«å—ç¨³å®šæµç•…çš„ç›´æ’­ä½“éªŒï¼Œæ‰“ç ´åœ°åŸŸå’Œè®¾å¤‡é™åˆ¶ï¼Œç•…äº«å…¨çƒç”µè§†é¢‘é“\nğŸŒ å®Œå…¨è‡ªä¸» æŒæ§ç›´æ’­æºè´¨é‡ï¼Œè‡ªåŠ¨è¿‡æ»¤æ— æ•ˆé“¾æ¥ï¼Œç¡®ä¿è§‚çœ‹ä½“éªŒå§‹ç»ˆå¦‚ä¸€\nğŸ” éšç§å®‰å…¨ æ‰€æœ‰æ•°æ®æœ¬åœ°å¤„ç†ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œä¿éšœä¸ªäººè§‚çœ‹åå¥½éšç§\nâš¡ é«˜æ•ˆç¨³å®š å¤šæºèšåˆä¸æ™ºèƒ½éªŒè¯ï¼Œæä¾›å¯é çš„é«˜æ¸…ç›´æ’­æºæœåŠ¡\nå½±éŸ³æ— ç•Œï¼Œç›´æ’­éšè¡Œã€‚æ„¿ IPTV-API æˆä¸ºä½ å®¶åº­å¨±ä¹çš„å¾—åŠ›åŠ©æ‰‹ï¼Œæ‰“ç ´é¢‘é“é™åˆ¶ï¼Œå¼€å¯è§†å¬æ–°ä½“éªŒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè¿æ¥ä¸–ç•Œï¼ŒæŒæ§è§†ç•Œâ€”â€”æ„å»ºä½ ä¸“å±çš„é«˜æ¸…ç›´æ’­å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ IPTV-API é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§‚çœ‹æ„‰å¿«ï¼Œç²¾å½©ä¸æ–­ï¼ğŸ‰\n","date":"2024-12-23T00:21:15+08:00","image":"https://file.meimolihan.eu.org/img/iptv-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5a1b549a/","title":"Docker éƒ¨ç½² IPTV-API ç›´æ’­æºæœåŠ¡ ğŸ“º"},{"content":"Windows éƒ¨ç½² Hugo åšå®¢ ğŸš€ Hugo æ˜¯ä¸€ä¸ªç”¨ Go è¯­è¨€ç¼–å†™çš„å¿«é€Ÿã€ç°ä»£åŒ–çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œé€‚åˆæ„å»ºåšå®¢ã€æ–‡æ¡£ç½‘ç«™å’Œä½œå“é›†ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»åœ¨ Windows ç¯å¢ƒä¸‹å®‰è£… Hugo å¹¶éƒ¨ç½²åˆ° Docker çš„å®Œæ•´æµç¨‹ã€‚\nâœ¨ ç›®å½• âœ¨ Hugo ç®€ä»‹ ğŸªŸ ä¸€ã€Windows å®‰è£… Hugo ğŸ—ï¸ äºŒã€åˆ›å»º Hugo ç«™ç‚¹ ğŸ¨ ä¸‰ã€å®‰è£…ä¸é…ç½®ä¸»é¢˜ ğŸ³ å››ã€Docker éƒ¨ç½² Hugo ğŸ”§ äº”ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ ğŸ”„ å…­ã€Windows ä¸ Docker èåˆéƒ¨ç½² ğŸ’¡ ä¸ƒã€é«˜çº§æŠ€å·§ä¸ä¼˜åŒ– âš ï¸ å…«ã€å¸¸è§é—®é¢˜è§£å†³ ğŸ¯ ä¹ã€åç»­æ­¥éª¤ âœ¨ Hugo ç®€ä»‹ Hugo æ˜¯ä¸€ä¸ªç”¨ Go è¯­è¨€ç¼–å†™çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nâš¡ æé€Ÿæ„å»º: æ¯ç§’å¯å¤„ç†æ•°åƒä¸ªé¡µé¢ ğŸ¯ ç®€å•æ˜“ç”¨: å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— éœ€ä¾èµ– ğŸ¨ ä¸»é¢˜ä¸°å¯Œ: å¤§é‡å…è´¹å’Œä»˜è´¹ä¸»é¢˜å¯ä¾›é€‰æ‹© ğŸ“± å“åº”å¼è®¾è®¡: é»˜è®¤æ”¯æŒç§»åŠ¨è®¾å¤‡ ğŸ”§ é«˜åº¦å¯å®šåˆ¶: çµæ´»çš„æ¨¡æ¿å’ŒçŸ­ä»£ç ç³»ç»Ÿ ğŸŒ å¤šè¯­è¨€æ”¯æŒ: å†…ç½®å›½é™…åŒ–(i18n)æ”¯æŒ Hugo ä¸å…¶ä»–é™æ€ç½‘ç«™ç”Ÿæˆå™¨å¯¹æ¯” ç‰¹æ€§ Hugo Jekyll Hexo Gatsby æ„å»ºé€Ÿåº¦ âš¡ æå¿« ğŸ¢ æ…¢ ğŸš€ å¿« ğŸš€ å¿« æ˜“ç”¨æ€§ â­â­â­â­â­ â­â­â­â­ â­â­â­â­ â­â­â­ ä¸»é¢˜æ•°é‡ 500+ 1000+ 300+ 100+ å­¦ä¹ æ›²çº¿ å¹³ç¼“ ä¸­ç­‰ å¹³ç¼“ é™¡å³­ ä¾èµ–ç®¡ç† æ—  RubyGems npm npm ğŸªŸ ä¸€ã€Windows å®‰è£… Hugo 1ã€ä¸€æ¡ powershell å‘½ä»¤å®‰è£… Hugo 1 winget install --id Hugo.Hugo.Extended -e --source winget --accept-package-agreements --accept-source-agreements; hugo version æ‰‹åŠ¨å®‰è£… Hugo 1ï¸âƒ£ ä¸‹è½½ Hugo æ‰©å±•ç‰ˆ Hugo é¡¹ç›®åœ°å€ï¼š https://github.com/gohugoio/hugo è®¿é—® Hugo GitHub å‘å¸ƒé¡µé¢ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æ‰©å±•ç‰ˆï¼šhugo_extended_0.140.0_windows-amd64.zip è§£å‹ ZIP æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ï¼šC:\\hugo\\bin ğŸ’¡ æ³¨æ„: æ‰©å±•ç‰ˆæ”¯æŒ Sass/SCSS å¤„ç†ï¼Œæ¨èä½¿ç”¨æ‰©å±•ç‰ˆ\n2ï¸âƒ£ é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ æŒ‰ä¸‹ Win + R é”®ï¼Œè¾“å…¥ sysdm.cpl æ‰“å¼€ç³»ç»Ÿå±æ€§ ç‚¹å‡»\u0026quot;é«˜çº§\u0026quot;é€‰é¡¹å¡ â†’ \u0026ldquo;ç¯å¢ƒå˜é‡\u0026rdquo; åœ¨\u0026quot;ç³»ç»Ÿå˜é‡\u0026quot;éƒ¨åˆ†æ‰¾åˆ° Pathï¼Œç‚¹å‡»\u0026quot;ç¼–è¾‘\u0026quot; ç‚¹å‡»\u0026quot;æ–°å»º\u0026quot;ï¼Œæ·»åŠ ï¼šC:\\hugo\\bin ç‚¹å‡»\u0026quot;ç¡®å®š\u0026quot;ä¿å­˜æ‰€æœ‰æ›´æ”¹ 3ï¸âƒ£ éªŒè¯å®‰è£… 1 2 3 4 5 # æ‰“å¼€ Windows ç»ˆç«¯ï¼ˆPowerShell æˆ– CMDï¼‰ hugo version # åº”è¯¥æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹ä¿¡æ¯ï¼š # hugo v0.140.0-7d2e48e6d4a922e2f4b0724d7ea5e838517d8e5a windows/amd64 BuildDate=2024-05-22T09:45:36Z VendorInfo=gohugoio 4ï¸âƒ£ å®‰è£… Gitï¼ˆå¯é€‰ä½†æ¨èï¼‰ 1 2 3 4 5 6 7 8 # ä¸‹è½½å¹¶å®‰è£… Git for Windows # è®¿é—®ï¼šhttps://git-scm.com/download/win # ä¸€æ¡å‘½ä»¤å®‰è£… Git winget install --id Git.Git -e --source winget --accept-package-agreements # éªŒè¯ Git å®‰è£… git --version ğŸ—ï¸ äºŒã€åˆ›å»º Hugo ç«™ç‚¹ 1ï¸âƒ£ åˆ›å»ºç«™ç‚¹ç›®å½• 1 2 3 4 5 6 7 8 9 # æ‰“å¼€ PowerShell æˆ– CMD # è¿›å…¥ Hugo å®‰è£…ç›®å½• cd C:\\hugo # åˆ›å»ºæ–°çš„åšå®¢ç«™ç‚¹ hugo new site myblog # è¿›å…¥ç«™ç‚¹ç›®å½• cd myblog 2ï¸âƒ£ åˆå§‹åŒ– Git ä»“åº“ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 # åˆå§‹åŒ– Git ä»“åº“ git init # åˆ›å»º .gitignore æ–‡ä»¶ echo \u0026#34;public/\u0026#34; \u0026gt; .gitignore echo \u0026#34;resources/\u0026#34; \u0026gt;\u0026gt; .gitignore echo \u0026#34;.hugo_build.lock\u0026#34; \u0026gt;\u0026gt; .gitignore 3ï¸âƒ£ åˆ›å»ºç¬¬ä¸€ç¯‡åšå®¢æ–‡ç«  1 2 3 4 # åˆ›å»ºæ–°æ–‡ç«  hugo new posts/myblog-001.md # ğŸ“ æ–‡ç« ä¿å­˜åœ¨ï¼šC:\\hugo\\myblog\\content\\posts\\ 4ï¸âƒ£ ç¼–è¾‘æ–‡ç« å†…å®¹ ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ VS Codeï¼‰æ‰“å¼€ content/posts/myblog-001.mdï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 --- title: \u0026#34;My First Blog Post\u0026#34; date: 2024-05-25T15:30:00+08:00 draft: false author: \u0026#34;Your Name\u0026#34; description: \u0026#34;è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡ Hugo åšå®¢æ–‡ç« \u0026#34; tags: [\u0026#34;hugo\u0026#34;, \u0026#34;blog\u0026#34;, \u0026#34;first\u0026#34;] categories: [\u0026#34;æŠ€æœ¯\u0026#34;] --- ## æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼ è¿™æ˜¯ä½¿ç”¨ Hugo åˆ›å»ºçš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚ ### åŠŸèƒ½ç‰¹ç‚¹ - âš¡ æé€Ÿæ„å»º - ğŸ¨ ä¸°å¯Œä¸»é¢˜ - ğŸ“± å“åº”å¼è®¾è®¡ - ğŸŒ å¤šè¯­è¨€æ”¯æŒ ### ä»£ç ç¤ºä¾‹ ```python def hello_world(): print(\u0026#34;Hello, Hugo!\u0026#34;) return True æ„Ÿè°¢é˜…è¯»ï¼\n1 2 3 4 5 6 7 8 9 ### 5ï¸âƒ£ æœ¬åœ°é¢„è§ˆç«™ç‚¹ ```bash # å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ hugo server -D # ğŸŒ æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:1313/ # ğŸ”„ æ”¯æŒçƒ­é‡è½½ï¼Œä¿®æ”¹å†…å®¹è‡ªåŠ¨åˆ·æ–° ğŸ¨ ä¸‰ã€å®‰è£…ä¸é…ç½®ä¸»é¢˜ 1ï¸âƒ£ é€‰æ‹©ä¸»é¢˜ Hugo ä¸»é¢˜åº“ï¼š https://themes.gohugo.io/ æ¨èä¸»é¢˜ï¼š\nAnanke: ç®€å•æ˜“ç”¨çš„å“åº”å¼ä¸»é¢˜ PaperMod: åŠŸèƒ½ä¸°å¯Œçš„ç°ä»£åŒ–ä¸»é¢˜ Stack: å¡ç‰‡å¼è®¾è®¡çš„åšå®¢ä¸»é¢˜ LoveIt: ä¸­æ–‡ä¼˜åŒ–ä¸»é¢˜ï¼Œæ”¯æŒå¤šç§åŠŸèƒ½ 2ï¸âƒ£ å®‰è£…ä¸»é¢˜ æ–¹æ³•ä¸€ï¼šGit å­æ¨¡å—ï¼ˆæ¨èï¼‰ 1 2 3 4 5 # è¿›å…¥ç«™ç‚¹ç›®å½• cd C:\\hugo\\myblog # æ·»åŠ ä¸»é¢˜ä½œä¸º Git å­æ¨¡å— git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ä¸‹è½½ ä¸‹è½½ä¸»é¢˜ ZIP æ–‡ä»¶ è§£å‹åˆ° themes ç›®å½• é‡å‘½åä¸ºç®€æ´åç§°ï¼ˆå¦‚ï¼šanankeï¼‰ 3ï¸âƒ£ é…ç½®ä¸»é¢˜ ç¼–è¾‘ hugo.toml é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # åŸºæœ¬é…ç½® baseURL = \u0026#34;https://yourdomain.com/\u0026#34; languageCode = \u0026#34;zh-cn\u0026#34; title = \u0026#34;æˆ‘çš„ Hugo åšå®¢\u0026#34; theme = \u0026#34;ananke\u0026#34; # ä¸»é¢˜ç‰¹å®šé…ç½® [params] description = \u0026#34;è¿™æ˜¯æˆ‘çš„ Hugo åšå®¢\u0026#34; author = \u0026#34;Your Name\u0026#34; github = \u0026#34;yourgithub\u0026#34; twitter = \u0026#34;yourtwitter\u0026#34; # èœå•é…ç½® [menu] [[menu.main]] identifier = \u0026#34;posts\u0026#34; name = \u0026#34;æ–‡ç« \u0026#34; url = \u0026#34;/posts/\u0026#34; weight = 1 [[menu.main]] identifier = \u0026#34;tags\u0026#34; name = \u0026#34;æ ‡ç­¾\u0026#34; url = \u0026#34;/tags/\u0026#34; weight = 2 [[menu.main]] identifier = \u0026#34;about\u0026#34; name = \u0026#34;å…³äº\u0026#34; url = \u0026#34;/about/\u0026#34; weight = 3 # ç¤¾äº¤åª’ä½“é“¾æ¥ [[params.social]] name = \u0026#34;GitHub\u0026#34; url = \u0026#34;https://github.com/yourname\u0026#34; [[params.social]] name = \u0026#34;Twitter\u0026#34; url = \u0026#34;https://twitter.com/yourname\u0026#34; 4ï¸âƒ£ è‡ªå®šä¹‰ä¸»é¢˜ 1 2 3 4 5 6 7 8 # åˆ›å»ºå¸ƒå±€è¦†ç›–ç›®å½• mkdir -p layouts/partials # å¤åˆ¶ä¸»é¢˜æ–‡ä»¶è¿›è¡Œè‡ªå®šä¹‰ cp themes/ananke/layouts/partials/header.html layouts/partials/ # ç¼–è¾‘è‡ªå®šä¹‰æ–‡ä»¶ # ä¿®æ”¹ layouts/partials/header.html æ·»åŠ è‡ªå®šä¹‰å†…å®¹ 5ï¸âƒ£ æœ¬åœ°æµ‹è¯•ä¸»é¢˜ 1 2 3 4 5 # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ hugo server -D # åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•ˆæœ # è®¿é—®ï¼šhttp://localhost:1313/ ğŸ³ å››ã€Docker éƒ¨ç½² Hugo 1ï¸âƒ£ æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡ ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£… Docker å’Œ Docker Composeï¼š\n1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ Docker æ˜¯å¦å®‰è£… docker --version # æ£€æŸ¥ Docker Compose æ˜¯å¦å®‰è£… docker-compose --version # å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œè¯·å…ˆå®‰è£… # Ubuntu/Debian å®‰è£…å‘½ä»¤ï¼š sudo apt update sudo apt install docker.io docker-compose -y 2ï¸âƒ£ åˆ›å»º Docker é…ç½® åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º Hugo éƒ¨ç½²ç›®å½•ï¼š\n1 2 3 4 5 6 7 8 # åˆ›å»º Hugo éƒ¨ç½²ç›®å½• sudo mkdir -p /mnt/mydisk/home/hugo/public # è®¾ç½®ç›®å½•æƒé™ sudo chown -R $USER:$USER /mnt/mydisk/home/hugo # åˆ›å»º docker-compose.yml æ–‡ä»¶ nano /mnt/mydisk/home/hugo/docker-compose.yml 3ï¸âƒ£ Docker Compose é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # /mnt/mydisk/home/hugo/docker-compose.yml version: \u0026#39;3.8\u0026#39; services: hugoweb: image: nginx:alpine container_name: hugonx restart: unless-stopped ports: - \u0026#34;7080:80\u0026#34; volumes: - ./public:/usr/share/nginx/html:ro - ./nginx.conf:/etc/nginx/nginx.conf:ro - ./logs:/var/log/nginx environment: - NGINX_HOST=localhost - NGINX_PORT=80 networks: - hugo-network networks: hugo-network: driver: bridge 4ï¸âƒ£ Nginx é…ç½®æ–‡ä»¶ åˆ›å»º Nginx é…ç½®æ–‡ä»¶ä»¥ä¼˜åŒ–é™æ€æ–‡ä»¶æœåŠ¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 # /mnt/mydisk/home/hugo/nginx.conf user nginx; worker_processes auto; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log /var/log/nginx/access.log main; sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_min_length 1024; gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json image/svg+xml; # é™æ€æ–‡ä»¶ç¼“å­˜ server { listen 80; server_name localhost; root /usr/share/nginx/html; index index.html index.htm; # ç¼“å­˜é™æ€èµ„æº location ~* \\.(jpg|jpeg|png|gif|ico|css|js|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } # å¤„ç† SPA è·¯ç”± location / { try_files $uri $uri/ /index.html; } # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶ location ~ /\\. { deny all; return 404; } } } 5ï¸âƒ£ å¯åŠ¨ Docker å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/hugo # æ„å»ºå¹¶å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ docker-compose ps # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker-compose logs -f ğŸ”§ äº”ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1ï¸âƒ£ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœæ­¢ hugonx å®¹å™¨ docker stop hugonx # å¯åŠ¨ hugonx å®¹å™¨ docker start hugonx # é‡å¯ hugonx å®¹å™¨ docker restart hugonx # åˆ é™¤å®¹å™¨ docker rm hugonx # åˆ é™¤å®¹å™¨å’Œå· docker rm -v hugonx 2ï¸âƒ£ å®¹å™¨äº¤äº’æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 # è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ˆä½¿ç”¨ bashï¼‰ docker exec -it hugonx bash # è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ˆä½¿ç”¨ shï¼‰ docker exec -it hugonx sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec hugonx nginx -t # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats hugonx # ğŸ“ ä½¿ç”¨ Ctrl+D é€€å‡ºå®¹å™¨ 3ï¸âƒ£ æ—¥å¿—æŸ¥çœ‹ä¸ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs hugonx # å®æ—¶æŸ¥çœ‹æ—¥å¿— docker logs -f hugonx # æŸ¥çœ‹æœ€åNè¡Œæ—¥å¿— docker logs --tail 100 hugonx # æŸ¥çœ‹ç‰¹å®šæ—¶é—´åçš„æ—¥å¿— docker logs --since 2024-05-25T10:00:00 hugonx # æ¸…ç©ºå®¹å™¨æ—¥å¿—ï¼ˆéœ€è¦è¿›å…¥å®¹å™¨ï¼‰ docker exec hugonx sh -c \u0026#39;echo \u0026#34;\u0026#34; \u0026gt; /var/log/nginx/access.log\u0026#39; docker exec hugonx sh -c \u0026#39;echo \u0026#34;\u0026#34; \u0026gt; /var/log/nginx/error.log\u0026#39; 4ï¸âƒ£ å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½å®¹å™¨æ•°æ® docker cp hugonx:/usr/share/nginx/html ./backup-$(date +%Y%m%d) # å¤‡ä»½ Nginx é…ç½® docker cp hugonx:/etc/nginx/nginx.conf ./nginx-backup-$(date +%Y%m%d).conf # åˆ›å»ºå®¹å™¨å¿«ç…§ docker commit hugonx hugonx-backup:$(date +%Y%m%d) # ä»å¿«ç…§æ¢å¤ docker run -d --name hugonx-restored -p 7080:80 hugonx-backup:20240525 ğŸ”„ å…­ã€Windows ä¸ Docker èåˆéƒ¨ç½² 1ï¸âƒ£ æœ¬åœ°ç”Ÿæˆé™æ€æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 # åœ¨ Windows ç«¯ç”Ÿæˆé™æ€æ–‡ä»¶ cd C:\\hugo\\myblog # æ„å»ºç«™ç‚¹ï¼ˆå‘å¸ƒæ¨¡å¼ï¼‰ hugo --minify # æˆ–è€…æ„å»ºåŒ…å«è‰ç¨¿çš„æ–‡ç«  hugo -D --minify # ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶åœ¨ï¼šC:\\hugo\\myblog\\public\\ 2ï¸âƒ£ æ–‡ä»¶åŒæ­¥åˆ°æœåŠ¡å™¨ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ SCPï¼ˆå®‰å…¨å¤åˆ¶ï¼‰ 1 2 3 4 5 6 7 8 # åœ¨ Windows PowerShell æˆ– CMD ä¸­ # å®‰è£… OpenSSH å®¢æˆ·ç«¯ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ # åŒæ­¥æ–‡ä»¶åˆ°æœåŠ¡å™¨ scp -r C:\\hugo\\myblog\\public\\* user@yourserver.com:/mnt/mydisk/home/hugo/public/ # æˆ–è€…ä½¿ç”¨ rsyncï¼ˆéœ€è¦å®‰è£…ï¼‰ rsync -avz --delete C:\\hugo\\myblog\\public/ user@yourserver.com:/mnt/mydisk/home/hugo/public/ æ–¹æ³•äºŒï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º Git é’©å­ # 1. åœ¨æœåŠ¡å™¨ä¸Šåˆå§‹åŒ–è£¸ä»“åº“ cd /mnt/mydisk/home git init --bare hugo.git # 2. åˆ›å»ºé’©å­è„šæœ¬ nano hugo.git/hooks/post-receive # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š #!/bin/bash TARGET=\u0026#34;/mnt/mydisk/home/hugo/public\u0026#34; GIT_DIR=\u0026#34;/mnt/mydisk/home/hugo.git\u0026#34; BRANCH=\u0026#34;main\u0026#34; while read oldrev newrev ref do if [[ $ref =~ .*/$BRANCH$ ]]; then echo \u0026#34;Ref $ref received. Deploying ${BRANCH} branch to production...\u0026#34; git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH else echo \u0026#34;Ref $ref received. Doing nothing: only the ${BRANCH} branch may be deployed on this server.\u0026#34; fi done # 3. è®¾ç½®æ‰§è¡Œæƒé™ chmod +x hugo.git/hooks/post-receive # åœ¨ Windows ç«¯æ·»åŠ è¿œç¨‹ä»“åº“ cd C:\\hugo\\myblog git remote add production user@yourserver.com:/mnt/mydisk/home/hugo.git # æ¨é€æ›´æ”¹ git add . git commit -m \u0026#34;æ›´æ–°åšå®¢å†…å®¹\u0026#34; git push production main æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ CI/CD å·¥å…· GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½² GitLab CI/CD ç®¡é“éƒ¨ç½² Jenkins è‡ªåŠ¨åŒ–ä»»åŠ¡ 3ï¸âƒ£ é‡å¯æœåŠ¡ 1 2 3 4 5 6 7 8 9 # æœåŠ¡å™¨ç«¯é‡å¯å®¹å™¨ docker restart hugonx # æˆ–è€…ä½¿ç”¨ Docker Compose cd /mnt/mydisk/home/hugo docker-compose restart # éªŒè¯æœåŠ¡çŠ¶æ€ curl -I http://localhost:7080 ğŸ’¡ ä¸ƒã€é«˜çº§æŠ€å·§ä¸ä¼˜åŒ– 1ï¸âƒ£ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ Windows æ‰¹å¤„ç†è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @echo off echo [INFO] å¼€å§‹æ„å»º Hugo ç«™ç‚¹... cd C:\\hugo\\myblog echo [INFO] ç”Ÿæˆé™æ€æ–‡ä»¶... hugo --minify echo [INFO] åŒæ­¥åˆ°æœåŠ¡å™¨... rsync -avz --delete public/ user@yourserver.com:/mnt/mydisk/home/hugo/public/ echo [INFO] é‡å¯ Docker å®¹å™¨... ssh user@yourserver.com \u0026#34;cd /mnt/mydisk/home/hugo \u0026amp;\u0026amp; docker-compose restart\u0026#34; echo [INFO] éƒ¨ç½²å®Œæˆ! pause PowerShell è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 Write-Host \u0026#34;å¼€å§‹æ„å»º Hugo ç«™ç‚¹...\u0026#34; -ForegroundColor Green Set-Location C:\\hugo\\myblog # ç”Ÿæˆé™æ€æ–‡ä»¶ hugo --minify if ($LASTEXITCODE -eq 0) { Write-Host \u0026#34;é™æ€æ–‡ä»¶ç”ŸæˆæˆåŠŸ\u0026#34; -ForegroundColor Green # åŒæ­¥åˆ°æœåŠ¡å™¨ $result = scp -r public/* user@yourserver.com:/mnt/mydisk/home/hugo/public/ if ($LASTEXITCODE -eq 0) { Write-Host \u0026#34;æ–‡ä»¶åŒæ­¥æˆåŠŸ\u0026#34; -ForegroundColor Green # é‡å¯å®¹å™¨ $restart = ssh user@yourserver.com \u0026#34;cd /mnt/mydisk/home/hugo \u0026amp;\u0026amp; docker-compose restart\u0026#34; Write-Host \u0026#34;Docker å®¹å™¨å·²é‡å¯\u0026#34; -ForegroundColor Green } else { Write-Host \u0026#34;æ–‡ä»¶åŒæ­¥å¤±è´¥\u0026#34; -ForegroundColor Red } } else { Write-Host \u0026#34;é™æ€æ–‡ä»¶ç”Ÿæˆå¤±è´¥\u0026#34; -ForegroundColor Red } 2ï¸âƒ£ ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åˆå§‹åŒ– Git ä»“åº“ cd C:\\hugo\\myblog git init # åˆ›å»º .gitignore æ–‡ä»¶ cat \u0026gt; .gitignore \u0026lt;\u0026lt; EOF # Hugo å¿½ç•¥æ–‡ä»¶ public/ resources/ .hugo_build.lock # æ“ä½œç³»ç»Ÿæ–‡ä»¶ .DS_Store Thumbs.db # ç¼–è¾‘å™¨æ–‡ä»¶ .vscode/ .idea/ *.swp *.swo EOF # æ·»åŠ æ‰€æœ‰æ–‡ä»¶ git add . # æäº¤åˆå§‹ç‰ˆæœ¬ git commit -m \u0026#34;åˆå§‹æäº¤: åˆ›å»º Hugo åšå®¢\u0026#34; 3ï¸âƒ£ ä¸»é¢˜è‡ªå®šä¹‰å’Œè¦†ç›– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºè‡ªå®šä¹‰å¸ƒå±€ mkdir -p layouts/_default # è¦†ç›–ä¸»é¢˜çš„ baseof æ¨¡æ¿ cp themes/ananke/layouts/_default/baseof.html layouts/_default/ # åˆ›å»ºè‡ªå®šä¹‰çŸ­ä»£ç  mkdir -p layouts/shortcodes cat \u0026gt; layouts/shortcodes/notice.html \u0026lt;\u0026lt; EOF \u0026lt;div class=\u0026#34;notice {{ .Get 0 }}\u0026#34;\u0026gt; {{ .Inner }} \u0026lt;/div\u0026gt; EOF # åœ¨æ–‡ç« ä¸­ä½¿ç”¨çŸ­ä»£ç  # {{ notice warning }} # è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæç¤º # {{ /notice }} 4ï¸âƒ£ æ„å»ºä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ä½¿ç”¨æ„å»ºç¼“å­˜ hugo --gc --minify # å¯ç”¨æ„å»ºåˆ†æ hugo --buildFuture --buildDrafts --buildExpired # ç”Ÿæˆç«™ç‚¹åœ°å›¾ cat \u0026gt; config.toml \u0026lt;\u0026lt; EOF [sitemap] changefreq = \u0026#34;monthly\u0026#34; priority = 0.5 filename = \u0026#34;sitemap.xml\u0026#34; EOF # ä¼˜åŒ–å›¾ç‰‡å¤„ç† # å®‰è£… Hugo å›¾ç‰‡å¤„ç†æ‰©å±• # åœ¨ config.toml ä¸­é…ç½®ï¼š [imaging] resampleFilter = \u0026#34;CatmullRom\u0026#34; quality = 75 anchor = \u0026#34;smart\u0026#34; 5ï¸âƒ£ æœç´¢å¼•æ“ä¼˜åŒ– (SEO) 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨ config.toml ä¸­é…ç½® SEO [params] seo = true googleAnalytics = \u0026#34;UA-XXXXXXXXX-X\u0026#34; [params.openGraph] locale = \u0026#34;zh_CN\u0026#34; siteName = \u0026#34;æˆ‘çš„ Hugo åšå®¢\u0026#34; [params.twitter] creator = \u0026#34;@yourtwitter\u0026#34; site = \u0026#34;@yourtwitter\u0026#34; âš ï¸ å…«ã€å¸¸è§é—®é¢˜è§£å†³ 1ï¸âƒ£ ç«¯å£å†²çª 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç«¯å£å ç”¨ netstat -ano | findstr :7080 # ç»ˆæ­¢å ç”¨è¿›ç¨‹ taskkill /PID \u0026lt;PID\u0026gt; /F # æˆ–è€…ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„ # å°† \u0026#34;7080:80\u0026#34; æ”¹ä¸º \u0026#34;8080:80\u0026#34; æˆ–å…¶ä»–ç«¯å£ 2ï¸âƒ£ æƒé™é—®é¢˜ 1 2 3 4 5 6 # æœåŠ¡å™¨ç«¯æƒé™ä¿®å¤ sudo chown -R $USER:$USER /mnt/mydisk/home/hugo sudo chmod -R 755 /mnt/mydisk/home/hugo/public # Windows ç«¯æ–‡ä»¶æƒé™é—®é¢˜ # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell æˆ– CMD 3ï¸âƒ£ ä¸»é¢˜ä¸æ˜¾ç¤º 1 2 3 4 5 6 7 8 # æ£€æŸ¥ä¸»é¢˜æ˜¯å¦æ­£ç¡®å®‰è£… ls themes/ # æ£€æŸ¥ config.toml ä¸­çš„ä¸»é¢˜é…ç½® cat config.toml | grep theme # é‡æ–°åˆå§‹åŒ–ä¸»é¢˜å­æ¨¡å— git submodule update --init --recursive 4ï¸âƒ£ æ„å»ºå¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ hugo --verbose # è°ƒè¯•æ¨¡å¼ hugo --debug # æ¸…é™¤ç¼“å­˜é‡æ–°æ„å»º hugo --ignoreCache # æ£€æŸ¥æ–‡ä»¶è¯­æ³• hugo check 5ï¸âƒ£ Docker å®¹å™¨é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs hugonx # æ£€æŸ¥å®¹å™¨çŠ¶æ€ docker inspect hugonx # é‡æ–°æ„å»ºå®¹å™¨ docker-compose down docker-compose up -d --build # æ£€æŸ¥ç«¯å£æ˜ å°„ docker port hugonx 6ï¸âƒ£ å†…å®¹ä¸æ›´æ–° 1 2 3 4 5 6 7 8 # å¼ºåˆ¶æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ Ctrl + F5 (Windows) æˆ– Cmd + Shift + R (Mac) # æ£€æŸ¥ Nginx ç¼“å­˜é…ç½® # ç¡®ä¿æ²¡æœ‰è¿‡åº¦ç¼“å­˜é™æ€æ–‡ä»¶ # é‡å¯ Nginx å®¹å™¨ docker exec hugonx nginx -s reload ğŸ¯ ä¹ã€åç»­æ­¥éª¤ 1ï¸âƒ£ é…ç½®è‡ªå®šä¹‰åŸŸå 1 2 3 4 5 6 7 8 9 10 11 12 # è´­ä¹°åŸŸåå¹¶é…ç½® DNS # å°†åŸŸåè§£æåˆ°æœåŠ¡å™¨ IP # ä¿®æ”¹ Nginx é…ç½® server { listen 80; server_name yourdomain.com www.yourdomain.com; # ... å…¶ä»–é…ç½® } # æ›´æ–° Hugo é…ç½® baseURL = \u0026#34;https://yourdomain.com/\u0026#34; 2ï¸âƒ£ æ·»åŠ  SSL/HTTPS æ”¯æŒ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨ Let\u0026#39;s Encrypt è·å–å…è´¹ SSL è¯ä¹¦ sudo apt install certbot python3-certbot-nginx # è·å–è¯ä¹¦ sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com # è‡ªåŠ¨ç»­æœŸè¯ä¹¦ sudo crontab -e # æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet 3ï¸âƒ£ è®¾ç½® CDN åŠ é€Ÿ Cloudflare: å…è´¹ CDN å’Œ DNS æœåŠ¡ AWS CloudFront: AWS å…¨çƒ CDN é˜¿é‡Œäº‘ CDN: å›½å†…åŠ é€ŸæœåŠ¡ 4ï¸âƒ£ é›†æˆè¯„è®ºç³»ç»Ÿ Disqus: å›½é™…æµè¡Œçš„è¯„è®ºç³»ç»Ÿ ** utterances**: åŸºäº GitHub Issues çš„è½»é‡çº§è¯„è®ºç³»ç»Ÿ Giscus: åŸºäº GitHub Discussions çš„è¯„è®ºç³»ç»Ÿ 5ï¸âƒ£ æ·»åŠ æœç´¢åŠŸèƒ½ Algolia: ä¸“ä¸šçš„æœç´¢æœåŠ¡ Lunr.js: å®¢æˆ·ç«¯ JavaScript æœç´¢ Fuse.js: è½»é‡çº§æ¨¡ç³Šæœç´¢ 6ï¸âƒ£ å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬ #!/bin/bash # backup-hugo.sh DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR=\u0026#34;/backup/hugo\u0026#34; # å¤‡ä»½å†…å®¹ tar -czf $BACKUP_DIR/hugo-content-$DATE.tar.gz /mnt/mydisk/home/hugo/ # å¤‡ä»½æ•°æ®åº“ï¼ˆå¦‚æœæœ‰ï¼‰ # docker exec some-mysql sh -c \u0026#39;exec mysqldump --all-databases\u0026#39; \u0026gt; $BACKUP_DIR/mysql-$DATE.sql # åˆ é™¤æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘30å¤©ï¼‰ find $BACKUP_DIR -name \u0026#34;*.tar.gz\u0026#34; -mtime +30 -delete echo \u0026#34;å¤‡ä»½å®Œæˆ: $BACKUP_DIR/hugo-content-$DATE.tar.gz\u0026#34; 7ï¸âƒ£ ç›‘æ§å’Œç»Ÿè®¡åˆ†æ Google Analytics: ç½‘ç«™æµé‡åˆ†æ Google Search Console: æœç´¢æ€§èƒ½ç›‘æ§ Uptime Robot: ç½‘ç«™å¯ç”¨æ€§ç›‘æ§ ğŸš€ æ­å–œï¼ä½ ç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„ Hugo åšå®¢ç³»ç»Ÿï¼Œå¯ä»¥åœ¨æœ¬åœ°ç¼–å†™å†…å®¹ï¼Œä¸€é”®éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚äº«å—å†™ä½œçš„ä¹è¶£å§ï¼\nğŸ“š æ‰©å±•èµ„æº Hugo å®˜æ–¹æ–‡æ¡£ Hugo ä¸»é¢˜åº“ Docker æ–‡æ¡£ Nginx é…ç½®æŒ‡å— â“ å¸¸è§é—®é¢˜è§£ç­” Q: Hugo å’Œ WordPress æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ A: Hugo æ˜¯é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œæ— éœ€æ•°æ®åº“ï¼Œæ›´å®‰å…¨æ›´å¿«ï¼›WordPress æ˜¯åŠ¨æ€å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œä½†éœ€è¦æ›´å¤šèµ„æºã€‚\nQ: å¦‚ä½•è¿ç§»ç°æœ‰åšå®¢åˆ° Hugoï¼Ÿ A: ä½¿ç”¨å„ç§å¯¼å…¥å·¥å…·ï¼Œå¦‚ wordpress-to-hugoã€jekyll-import ç­‰ï¼Œæˆ–æ‰‹åŠ¨è¿ç§»å†…å®¹ã€‚\nQ: Hugo æ”¯æŒå¤šè¯­è¨€å—ï¼Ÿ A: æ˜¯çš„ï¼ŒHugo æœ‰å®Œå–„çš„å¤šè¯­è¨€æ”¯æŒï¼Œå¯ä»¥åˆ›å»ºå¤šè¯­è¨€ç½‘ç«™ã€‚\nQ: å¦‚ä½•ä¼˜åŒ– Hugo ç½‘ç«™çš„åŠ è½½é€Ÿåº¦ï¼Ÿ A: ä½¿ç”¨ CDNã€ä¼˜åŒ–å›¾ç‰‡ã€å¯ç”¨ Gzip å‹ç¼©ã€å‡å°‘ç¬¬ä¸‰æ–¹è„šæœ¬ã€ä½¿ç”¨å¼‚æ­¥åŠ è½½ç­‰ã€‚\nQ: Docker éƒ¨ç½²æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ A: ç¯å¢ƒéš”ç¦»ã€æ˜“äºéƒ¨ç½²ã€ç‰ˆæœ¬æ§åˆ¶ã€å¿«é€Ÿæ‰©å±•å’Œå›æ»šã€‚\n","date":"2024-12-21T19:08:27+08:00","image":"https://file.meimolihan.eu.org/img/hugo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/windows-%E9%83%A8%E7%BD%B2-hugo-%E5%8D%9A%E5%AE%A2/","title":"Windows éƒ¨ç½² Hugo åšå®¢ ğŸš€"},{"content":"Emoji è¡¨æƒ…ç¬¦å·å¤§å…¨ ğŸ«¡ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ˜Š ç¬‘è„¸ä¸äºº ğŸ¾ åŠ¨ç‰©ä¸è‡ªç„¶ ğŸ• é¥®é£Ÿ âš½ è¡Œä¸º ğŸš— å‡ºè¡Œä¸åœ°ç‚¹ ğŸ’¡ ç‰©ä½“ ğŸ”£ ç¬¦å· ğŸ æ——å¸œ ğŸ˜Š ç¬‘è„¸ä¸äºº 1 ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ¤£ğŸ˜‚ğŸ™‚ğŸ™ƒğŸ« ğŸ˜‰ğŸ˜ŠğŸ˜‡ğŸ¥°ğŸ˜ğŸ¤©ğŸ˜˜ğŸ˜—â˜ºï¸ğŸ˜šğŸ˜™ğŸ¥²ğŸ˜‹ğŸ˜›ğŸ˜œğŸ¤ªğŸ˜ğŸ¤‘ğŸ¤—ğŸ¤­ğŸ«¢ğŸ«£ğŸ¤«ğŸ¤”ğŸ«¡ğŸ¤ğŸ¤¨ğŸ˜ğŸ˜‘ğŸ˜¶ğŸ«¥ğŸ˜¶â€ğŸŒ«ï¸ğŸ˜ğŸ˜’ğŸ™„ğŸ˜¬ğŸ˜®â€ğŸ’¨ğŸ¤¥ğŸ«¨ğŸ™‚â€â†”ï¸ğŸ™‚â€â†•ï¸ğŸ˜ŒğŸ˜”ğŸ˜ªğŸ¤¤ğŸ˜´ğŸ˜·ğŸ¤’ğŸ¤•ğŸ¤¢ğŸ¤®ğŸ¤§ğŸ¥µğŸ¥¶ğŸ¥´ğŸ˜µğŸ˜µâ€ğŸ’«ğŸ¤¯ğŸ¤ ğŸ¥³ğŸ¥¸ğŸ˜ğŸ¤“ğŸ§ğŸ˜•ğŸ«¤ğŸ˜ŸğŸ™â˜¹ï¸ğŸ˜®ğŸ˜¯ğŸ˜²ğŸ˜³ğŸ¥ºğŸ¥¹ğŸ˜¦ğŸ˜§ğŸ˜¨ğŸ˜°ğŸ˜¥ğŸ˜¢ğŸ˜­ğŸ˜±ğŸ˜–ğŸ˜£ğŸ˜ğŸ˜“ğŸ˜©ğŸ˜«ğŸ¥±ğŸ˜¤ğŸ˜¡ğŸ˜ ğŸ¤¬ğŸ˜ˆğŸ‘¿ğŸ’€â˜ ï¸ğŸ’©ğŸ¤¡ğŸ‘¹ğŸ‘ºğŸ‘»ğŸ‘½ğŸ‘¾ğŸ¤–ğŸ˜ºğŸ˜¸ğŸ˜¹ğŸ˜»ğŸ˜¼ğŸ˜½ğŸ™€ğŸ˜¿ğŸ˜¾ğŸ™ˆğŸ™‰ğŸ™ŠğŸ’‹ğŸ’¯ğŸ’¢ğŸ’¥ğŸ’«ğŸ’¦ğŸ’¨ğŸ•³ï¸ğŸ’¤ğŸ‘‹ğŸ¤šğŸ–ï¸âœ‹ğŸ––ğŸ«±ğŸ«²ğŸ«³ğŸ«´ğŸ«·ğŸ«¸ğŸ‘ŒğŸ¤ŒğŸ¤âœŒï¸ğŸ¤ğŸ«°ğŸ¤ŸğŸ¤˜ğŸ¤™ğŸ‘ˆğŸ‘‰ğŸ‘†ğŸ–•ğŸ‘‡â˜ï¸ğŸ«µğŸ‘ğŸ‘âœŠğŸ‘ŠğŸ¤›ğŸ¤œğŸ‘ğŸ™ŒğŸ«¶ğŸ‘ğŸ¤²ğŸ¤ğŸ™âœï¸ğŸ’…ğŸ¤³ğŸ’ªğŸ¦¾ğŸ¦¿ğŸ¦µğŸ¦¶ğŸ‘‚ğŸ¦»ğŸ‘ƒğŸ§ ğŸ«€ğŸ«ğŸ¦·ğŸ¦´ğŸ‘€ğŸ‘ï¸ğŸ‘…ğŸ‘„ğŸ«¦ğŸ‘¶ğŸ§’ğŸ‘¦ğŸ‘§ğŸ§‘ğŸ‘±ğŸ‘¨ğŸ§”ğŸ§”â€â™‚ï¸ğŸ§”â€â™€ï¸ğŸ‘¨â€ğŸ¦°ğŸ‘¨â€ğŸ¦±ğŸ‘¨â€ğŸ¦³ğŸ‘¨â€ğŸ¦²ğŸ‘©ğŸ‘©â€ğŸ¦°ğŸ§‘â€ğŸ¦°ğŸ‘©â€ğŸ¦±ğŸ§‘â€ğŸ¦±ğŸ‘©â€ğŸ¦³ğŸ§‘â€ğŸ¦³ğŸ‘©â€ğŸ¦²ğŸ§‘â€ğŸ¦²ğŸ‘±â€â™€ï¸ğŸ‘±â€â™‚ï¸ğŸ§“ğŸ‘´ğŸ‘µğŸ™ğŸ™â€â™‚ï¸ğŸ™â€â™€ï¸ğŸ™ğŸ™â€â™‚ï¸ğŸ™â€â™€ï¸ğŸ™…ğŸ™…â€â™‚ï¸ğŸ™…â€â™€ï¸ğŸ™†ğŸ™†â€â™‚ï¸ğŸ™†â€â™€ï¸ğŸ’ğŸ’â€â™‚ï¸ğŸ’â€â™€ï¸ğŸ™‹ğŸ™‹â€â™‚ï¸ğŸ™‹â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ™‡ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™€ï¸ğŸ¤¦ğŸ¤¦â€â™‚ï¸ğŸ¤¦â€â™€ï¸ğŸ¤·ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™€ï¸ğŸ«…ğŸ¤´ğŸ‘¸ğŸ‘³ğŸ‘³â€â™‚ï¸ğŸ‘³â€â™€ï¸ğŸ‘²ğŸ§•ğŸ¤µğŸ‘°ğŸ¤°ğŸ¤±ğŸ‘©â€ğŸ¼ğŸ’ƒğŸ•ºğŸ›€ğŸ›ŒğŸ§‘â€ğŸ¤â€ğŸ§‘ğŸ‘­ğŸ‘«ğŸ‘¬ğŸ’ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©ğŸ’‘ğŸ‘©â€â¤ï¸â€ğŸ‘¨ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ğŸ‘©â€â¤ï¸â€ğŸ‘©ğŸ’ŒğŸ’˜ğŸ’ğŸ’–ğŸ’—ğŸ’“ğŸ’ğŸ’•ğŸ’Ÿâ£ï¸ğŸ’”â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ©¹â¤ï¸ğŸ©·ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ©µğŸ’œğŸ¤ğŸ–¤ğŸ©¶ğŸ¤ ğŸ¾ åŠ¨ç‰©ä¸è‡ªç„¶ 1 ğŸµğŸ’ğŸ¦ğŸ¦§ğŸ¶ğŸ•ğŸ¦®ğŸ•â€ğŸ¦ºğŸ©ğŸºğŸ¦ŠğŸ¦ğŸ±ğŸˆğŸˆâ€â¬›ğŸ¦ğŸ¯ğŸ…ğŸ†ğŸ´ğŸ«ğŸ«ğŸğŸ¦„ğŸ¦“ğŸ¦ŒğŸ¦¬ğŸ®ğŸ‚ğŸƒğŸ„ğŸ·ğŸ–ğŸ—ğŸ½ğŸğŸ‘ğŸğŸªğŸ«ğŸ¦™ğŸ¦’ğŸ˜ğŸ¦£ğŸ¦ğŸ¦›ğŸ­ğŸğŸ€ğŸ¹ğŸ°ğŸ‡ğŸ¿ï¸ğŸ¦«ğŸ¦”ğŸ¦‡ğŸ»ğŸ»â€â„ï¸ğŸ¨ğŸ¼ğŸ¦¥ğŸ¦¦ğŸ¦¨ğŸ¦˜ğŸ¦¡ğŸ¾ğŸ¦ƒğŸ”ğŸ“ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ•Šï¸ğŸ¦…ğŸ¦†ğŸ¦¢ğŸ¦‰ğŸ¦¤ğŸª¶ğŸ¦©ğŸ¦šğŸ¦œğŸª½ğŸ¦â€â¬›ğŸª¿ğŸ¦â€ğŸ”¥ğŸ¸ğŸŠğŸ¢ğŸ¦ğŸğŸ²ğŸ‰ğŸ¦•ğŸ¦–ğŸ³ğŸ‹ğŸ¬ğŸ¦­ğŸŸğŸ ğŸ¡ğŸ¦ˆğŸ™ğŸšğŸª¸ğŸª¼ğŸŒğŸ¦‹ğŸ›ğŸœğŸğŸª²ğŸğŸ¦—ğŸª³ğŸ•·ï¸ğŸ•¸ï¸ğŸ¦‚ğŸ¦ŸğŸª°ğŸª±ğŸ¦ ğŸ’ğŸŒ¸ğŸ’®ğŸª·ğŸµï¸ğŸŒ¹ğŸ¥€ğŸŒºğŸŒ»ğŸŒ¼ğŸŒ·ğŸª»ğŸŒ±ğŸª´ğŸŒ²ğŸŒ³ğŸŒ´ğŸŒµğŸŒ¾ğŸŒ¿â˜˜ï¸ğŸ€ğŸğŸ‚ğŸƒğŸª¹ğŸªºğŸ„ ğŸ• é¥®é£Ÿ 1 ğŸ‡ğŸˆğŸ‰ğŸŠğŸ‹ğŸ‹â€ğŸŸ©ğŸŒğŸğŸ¥­ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ«ğŸ¥ğŸ…ğŸ«’ğŸ¥¥ğŸ¥‘ğŸ†ğŸ¥”ğŸ¥•ğŸŒ½ğŸŒ¶ï¸ğŸ«‘ğŸ¥’ğŸ¥¬ğŸ¥¦ğŸ§„ğŸ§…ğŸ¥œğŸ«˜ğŸŒ°ğŸ«šğŸ«›ğŸ„â€ğŸŸ«ğŸğŸ¥ğŸ¥–ğŸ«“ğŸ¥¨ğŸ¥¯ğŸ¥ğŸ§‡ğŸ§€ğŸ–ğŸ—ğŸ¥©ğŸ¥“ğŸ”ğŸŸğŸ•ğŸŒ­ğŸ¥ªğŸŒ®ğŸŒ¯ğŸ«”ğŸ¥™ğŸ§†ğŸ¥šğŸ³ğŸ¥˜ğŸ²ğŸ«•ğŸ¥£ğŸ¥—ğŸ¿ğŸ§ˆğŸ§‚ğŸ¥«ğŸ±ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸ ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¥®ğŸ¡ğŸ¥ŸğŸ¥ ğŸ¥¡ğŸ¦€ğŸ¦ğŸ¦ğŸ¦‘ğŸ¦ªğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ‚ğŸ°ğŸ§ğŸ¥§ğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ¼ğŸ¥›â˜•ğŸ«–ğŸµğŸ¶ğŸ¾ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¥‚ğŸ¥ƒğŸ«—ğŸ¥¤ğŸ§‹ğŸ§ƒğŸ§‰ğŸ§ŠğŸ¥¢ğŸ½ï¸ğŸ´ğŸ¥„ğŸ”ªğŸ«™ğŸº âš½ è¡Œä¸º 1 ğŸƒğŸ„ğŸ†ğŸ‡ğŸ§¨âœ¨ğŸˆğŸ‰ğŸŠğŸ‹ğŸğŸğŸğŸğŸ‘ğŸ§§ğŸ€ğŸğŸ—ï¸ğŸŸï¸ğŸ«ğŸ–ï¸ğŸ†ğŸ…ğŸ¥‡ğŸ¥ˆğŸ¥‰âš½âš¾ğŸ¥ğŸ€ğŸğŸˆğŸ‰ğŸ¾ğŸ¥ğŸ³ğŸğŸ‘ğŸ’ğŸ¥ğŸ“ğŸ¸ğŸ¥ŠğŸ¥‹ğŸ¥…â›³â›¸ï¸ğŸ£ğŸ¤¿ğŸ½ğŸ¿ğŸ›·ğŸ¥ŒğŸ¯ğŸª€ğŸªğŸ”«ğŸ±ğŸ”®ğŸª„ğŸ®ğŸ•¹ï¸ğŸ°ğŸ²ğŸ§©ğŸ§¸ğŸª…ğŸª©ğŸª†â™ ï¸â™¥ï¸â™¦ï¸â™£ï¸â™Ÿï¸ğŸƒğŸ€„ğŸ´ğŸ­ğŸ–¼ï¸ğŸ¨ğŸ§µğŸª¡ğŸ§¶ğŸª¢ğŸ§‘â€âš•ï¸ğŸ‘¨â€âš•ï¸ğŸ‘©â€âš•ï¸ğŸ§‘â€ğŸ“ğŸ‘¨â€ğŸ“ğŸ‘©â€ğŸ“ğŸ§‘â€ğŸ«ğŸ‘¨â€ğŸ«ğŸ‘©â€ğŸ«ğŸ§‘â€âš–ï¸ğŸ‘¨â€âš–ï¸ğŸ‘©â€âš–ï¸ğŸ§‘â€ğŸŒ¾ğŸ‘¨â€ğŸŒ¾ğŸ‘©â€ğŸŒ¾ğŸ§‘â€ğŸ³ğŸ‘¨â€ğŸ³ğŸ‘©â€ğŸ³ğŸ§‘â€ğŸ”§ğŸ‘¨â€ğŸ”§ğŸ‘©â€ğŸ”§ğŸ§‘â€ğŸ­ğŸ‘¨â€ğŸ­ğŸ‘©â€ğŸ­ğŸ§‘â€ğŸ’¼ğŸ‘¨â€ğŸ’¼ğŸ‘©â€ğŸ’¼ğŸ§‘â€ğŸ”¬ğŸ‘¨â€ğŸ”¬ğŸ‘©â€ğŸ”¬ğŸ§‘â€ğŸ’»ğŸ‘¨â€ğŸ’»ğŸ‘©â€ğŸ’»ğŸ§‘â€ğŸ¤ğŸ‘¨â€ğŸ¤ğŸ‘©â€ğŸ¤ğŸ§‘â€ğŸ¨ğŸ‘¨â€ğŸ¨ğŸ‘©â€ğŸ¨ğŸ§‘â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘©â€âœˆï¸ğŸ§‘â€ğŸš€ğŸ‘¨â€ğŸš€ğŸ‘©â€ğŸš€ğŸ§‘â€ğŸš’ğŸ‘¨â€ğŸš’ğŸ‘©â€ğŸš’ğŸ‘®ğŸ‘®â€â™‚ï¸ğŸ‘®â€â™€ï¸ğŸ•µï¸ğŸ•µï¸â€â™‚ï¸ğŸ•µï¸â€â™€ï¸ğŸ’‚ğŸ’‚â€â™‚ï¸ğŸ’‚â€â™€ï¸ğŸ¥·ğŸ‘·ğŸ‘·â€â™‚ï¸ğŸ‘·â€â™€ï¸ğŸ‘¼ğŸ…ğŸ¤¶ğŸ§‘â€ğŸ„ğŸ¦¸ğŸ¦¸â€â™‚ï¸ğŸ¦¸â€â™€ï¸ğŸ¦¹ğŸ¦¹â€â™‚ï¸ğŸ¦¹â€â™€ï¸ğŸ§™ğŸ§™â€â™‚ï¸ğŸ§™â€â™€ï¸ğŸ§šğŸ§šâ€â™‚ï¸ğŸ§šâ€â™€ï¸ğŸ§›ğŸ§›â€â™‚ï¸ğŸ§›â€â™€ï¸ğŸ§œğŸ§œâ€â™‚ï¸ğŸ§œâ€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§ŸğŸ§Ÿâ€â™‚ï¸ğŸ§Ÿâ€â™€ï¸ğŸ§ŒğŸ¤µğŸ¤µâ€â™‚ï¸ğŸ¤µâ€â™€ï¸ğŸ‘°ğŸ‘°â€â™‚ï¸ğŸ‘°â€â™€ï¸ğŸ¤°ğŸ«ƒğŸ«„ğŸ¤±ğŸ‘©â€ğŸ¼ğŸ‘¨â€ğŸ¼ğŸ§‘â€ğŸ¼ğŸ’†ğŸ’†â€â™‚ï¸ğŸ’†â€â™€ï¸ğŸš¶ğŸš¶â€â™‚ï¸ğŸš¶â€â™€ï¸ğŸš¶â€â¡ï¸ğŸš¶â€â™€ï¸â€â¡ï¸ğŸš¶â€â™‚ï¸â€â¡ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§â€â¡ï¸ğŸ§â€â™€ï¸â€â¡ï¸ğŸ§â€â™‚ï¸â€â¡ï¸ğŸ§‘â€ğŸ¦¯ğŸ§‘â€ğŸ¦¯â€â¡ï¸ğŸ‘¨â€ğŸ¦¯ğŸ‘¨â€ğŸ¦¯â€â¡ï¸ğŸ‘©â€ğŸ¦¯ğŸ‘©â€ğŸ¦¯â€â¡ï¸ğŸ§‘â€ğŸ¦¼ğŸ§‘â€ğŸ¦¼â€â¡ï¸ğŸ‘¨â€ğŸ¦¼ğŸ‘¨â€ğŸ¦¼â€â¡ï¸ğŸ‘©â€ğŸ¦¼ğŸ‘©â€ğŸ¦¼â€â¡ï¸ğŸ§‘â€ğŸ¦½ğŸ§‘â€ğŸ¦½â€â¡ï¸ğŸ‘¨â€ğŸ¦½ğŸ‘¨â€ğŸ¦½â€â¡ï¸ğŸ‘©â€ğŸ¦½ğŸ‘©â€ğŸ¦½â€â¡ï¸ğŸƒğŸƒâ€â™‚ï¸ğŸƒâ€â™€ï¸ğŸƒâ€â¡ï¸ğŸƒâ€â™€ï¸â€â¡ï¸ğŸƒâ€â™‚ï¸â€â¡ï¸ğŸ’‡ğŸ’‡â€â™‚ï¸ğŸ’‡â€â™€ï¸ğŸ•´ï¸ğŸ‘¯ğŸ‘¯â€â™‚ï¸ğŸ‘¯â€â™€ï¸ğŸ§–ğŸ§–â€â™‚ï¸ğŸ§–â€â™€ï¸ğŸ§—ğŸ§—â€â™‚ï¸ğŸ§—â€â™€ï¸ğŸ¤ºğŸ‡â›·ï¸ğŸ‚ğŸŒï¸ğŸŒï¸â€â™‚ï¸ğŸŒï¸â€â™€ï¸ğŸ„ğŸ„â€â™‚ï¸ğŸ„â€â™€ï¸ğŸš£ğŸš£â€â™‚ï¸ğŸš£â€â™€ï¸ğŸŠğŸŠâ€â™‚ï¸ğŸŠâ€â™€ï¸â›¹ï¸â›¹ï¸â€â™‚ï¸â›¹ï¸â€â™€ï¸ğŸ‹ï¸ğŸ‹ï¸â€â™‚ï¸ğŸ‹ï¸â€â™€ï¸ğŸš´ğŸš´â€â™‚ï¸ğŸš´â€â™€ï¸ğŸšµğŸšµâ€â™‚ï¸ğŸšµâ€â™€ï¸ğŸ¤¸ğŸ¤¸â€â™‚ï¸ğŸ¤¸â€â™€ï¸ğŸ¤¼ğŸ¤¼â€â™‚ï¸ğŸ¤¼â€â™€ï¸ğŸ¤½ğŸ¤½â€â™‚ï¸ğŸ¤½â€â™€ï¸ğŸ¤¾ğŸ¤¾â€â™‚ï¸ğŸ¤¾â€â™€ï¸ğŸ¤¹ğŸ¤¹â€â™‚ï¸ğŸ¤¹â€â™€ï¸ğŸ§˜ğŸ§˜â€â™‚ï¸ğŸ§˜â€â™€ï¸ ğŸš— å‡ºè¡Œä¸åœ°ç‚¹ 1 ğŸŒğŸŒğŸŒğŸŒğŸ—ºï¸ğŸ—¾ğŸ§­ğŸ”ï¸â›°ï¸ğŸŒ‹ğŸ—»ğŸ•ï¸ğŸ–ï¸ğŸœï¸ğŸï¸ğŸï¸ğŸŸï¸ğŸ›ï¸ğŸ—ï¸ğŸ§±ğŸª¨ğŸªµğŸ›–ğŸ˜ï¸ğŸšï¸ğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ¯ğŸ°ğŸ’’ğŸ—¼ğŸ—½â›ªğŸ•ŒğŸ›•ğŸ•â›©ï¸ğŸ•‹â›²â›ºğŸŒğŸŒƒğŸ™ï¸ğŸŒ„ğŸŒ…ğŸŒ†ğŸŒ‡ğŸŒ‰â™¨ï¸ğŸ ğŸ›ğŸ¡ğŸ¢ğŸ’ˆğŸªğŸš‚ğŸšƒğŸš„ğŸš…ğŸš†ğŸš‡ğŸšˆğŸš‰ğŸšŠğŸšğŸšğŸš‹ğŸšŒğŸšğŸšğŸšğŸš‘ğŸš’ğŸš“ğŸš”ğŸš•ğŸš–ğŸš—ğŸš˜ğŸš™ğŸ›»ğŸššğŸš›ğŸšœğŸï¸ğŸï¸ğŸ›µğŸ¦½ğŸ¦¼ğŸ›ºğŸš²ğŸ›´ğŸ›¹ğŸ›¼ğŸšğŸ›£ï¸ğŸ›¤ï¸ğŸ›¢ï¸â›½ğŸ›ğŸš¨ğŸš¥ğŸš¦ğŸ›‘ğŸš§âš“ğŸ›Ÿâ›µğŸ›¶ğŸš¤ğŸ›³ï¸â›´ï¸ğŸ›¥ï¸ğŸš¢âœˆï¸ğŸ›©ï¸ğŸ›«ğŸ›¬ğŸª‚ğŸ’ºğŸšğŸšŸğŸš ğŸš¡ğŸ›°ï¸ğŸš€ğŸ›¸ğŸ›ï¸ğŸ§³âŒ›â³âŒšâ°â±ï¸â²ï¸ğŸ•°ï¸ğŸ•›ğŸ•§ğŸ•ğŸ•œğŸ•‘ğŸ•ğŸ•’ğŸ•ğŸ•“ğŸ•ŸğŸ•”ğŸ• ğŸ••ğŸ•¡ğŸ•–ğŸ•¢ğŸ•—ğŸ•£ğŸ•˜ğŸ•¤ğŸ•™ğŸ•¥ğŸ•šğŸ•¦ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸŒ™ğŸŒšğŸŒ›ğŸŒœğŸŒ¡ï¸â˜€ï¸ğŸŒğŸŒğŸªâ­ğŸŒŸğŸŒ ğŸŒŒâ˜ï¸â›…â›ˆï¸ğŸŒ¤ï¸ğŸŒ¥ï¸ğŸŒ¦ï¸ğŸŒ§ï¸ğŸŒ¨ï¸ğŸŒ©ï¸ğŸŒªï¸ğŸŒ«ï¸ğŸŒ¬ï¸ğŸŒ€ğŸŒˆğŸŒ‚â˜‚ï¸â˜”â›±ï¸âš¡â„ï¸â˜ƒï¸â›„â˜„ï¸ğŸ”¥ğŸ’§ğŸŒŠ ğŸ’¡ ç‰©ä½“ 1 ğŸ‘“ğŸ•¶ï¸ğŸ¥½ğŸ¥¼ğŸ¦ºğŸ‘”ğŸ‘•ğŸ‘–ğŸ§£ğŸ§¤ğŸ§¥ğŸ§¦ğŸ‘—ğŸ‘˜ğŸ¥»ğŸ©±ğŸ©²ğŸ©³ğŸ‘™ğŸ‘šğŸª­ğŸ‘›ğŸ‘œğŸ‘ğŸ›ï¸ğŸ’ğŸ©´ğŸ‘ğŸ‘ŸğŸ¥¾ğŸ¥¿ğŸ‘ ğŸ‘¡ğŸ©°ğŸ‘¢ğŸª®ğŸ‘‘ğŸ‘’ğŸ©ğŸ“ğŸ§¢ğŸª–â›‘ï¸ğŸ“¿ğŸ’„ğŸ’ğŸ’ğŸ”‡ğŸ”ˆğŸ”‰ğŸ”ŠğŸ“¢ğŸ“£ğŸ“¯ğŸ””ğŸ”•ğŸ¼ğŸµğŸ¶ğŸ™ï¸ğŸšï¸ğŸ›ï¸ğŸ¤ğŸ§ğŸ“»ğŸ·ğŸª—ğŸ¸ğŸ¹ğŸºğŸ»ğŸª•ğŸ¥ğŸª˜ğŸª‡ğŸªˆğŸ“±ğŸ“²â˜ï¸ğŸ“ğŸ“ŸğŸ“ ğŸ”‹ğŸª«ğŸ”ŒğŸ’»ğŸ–¥ï¸ğŸ–¨ï¸âŒ¨ï¸ğŸ–±ï¸ğŸ–²ï¸ğŸ’½ğŸ’¾ğŸ’¿ğŸ“€ğŸ§®ğŸ¥ğŸï¸ğŸ“½ï¸ğŸ¬ğŸ“ºğŸ“·ğŸ“¸ğŸ“¹ğŸ“¼ğŸ”ğŸ”ğŸ•¯ï¸ğŸ’¡ğŸ”¦ğŸ®ğŸª”ğŸ“”ğŸ“•ğŸ“–ğŸ“—ğŸ“˜ğŸ“™ğŸ“šğŸ““ğŸ“’ğŸ“ƒğŸ“œğŸ“„ğŸ“°ğŸ—ï¸ğŸ“‘ğŸ”–ğŸ·ï¸ğŸ’°ğŸª™ğŸ’´ğŸ’µğŸ’¶ğŸ’·ğŸ’¸ğŸ’³ğŸ§¾ğŸ’¹âœ‰ï¸ğŸ“§ğŸ“¨ğŸ“©ğŸ“¤ğŸ“¥ğŸ“¦ğŸ“«ğŸ“ªğŸ“¬ğŸ“­ğŸ“®ğŸ—³ï¸âœï¸âœ’ï¸ğŸ–‹ï¸ğŸ–Šï¸ğŸ–Œï¸ğŸ–ï¸ğŸ“ğŸ’¼ğŸ“ğŸ“‚ğŸ—‚ï¸ğŸ“…ğŸ“†ğŸ—’ï¸ğŸ—“ï¸ğŸ“‡ğŸ“ˆğŸ“‰ğŸ“ŠğŸ“‹ğŸ“ŒğŸ“ğŸ“ğŸ–‡ï¸ğŸ“ğŸ“âœ‚ï¸ğŸ—ƒï¸ğŸ—„ï¸ğŸ—‘ï¸ğŸ”’ğŸ”“ğŸ”ğŸ”ğŸ”‘ğŸ—ï¸ğŸ”¨ğŸª“â›ï¸âš’ï¸ğŸ› ï¸ğŸ—¡ï¸âš”ï¸ğŸ’£ğŸªƒğŸ¹ğŸ›¡ï¸ğŸªšğŸ”§ğŸª›ğŸ”©âš™ï¸ğŸ—œï¸âš–ï¸ğŸ¦¯ğŸ”—â›“ï¸â€ğŸ’¥â›“ï¸ğŸªğŸ§°ğŸ§²ğŸªœâš—ï¸ğŸ§ªğŸ§«ğŸ§¬ğŸ”¬ğŸ”­ğŸ“¡ğŸ’‰ğŸ©¸ğŸ’ŠğŸ©¹ğŸ©¼ğŸ©ºğŸ©»ğŸšªğŸ›—ğŸªğŸªŸğŸ›ï¸ğŸ›‹ï¸ğŸª‘ğŸš½ğŸª ğŸš¿ğŸ›ğŸª¤ğŸª’ğŸ§´ğŸ§·ğŸ§¹ğŸ§ºğŸ§»ğŸª£ğŸ§¼ğŸ«§ğŸª¥ğŸ§½ğŸ§¯ğŸ›’ğŸš¬âš°ï¸ğŸª¦âš±ï¸ğŸ§¿ğŸª¬ğŸ—¿ğŸª§ğŸªª ğŸ”£ ç¬¦å· 1 ğŸ§ğŸš®ğŸš°â™¿ğŸš¹ğŸšºğŸš»ğŸš¼ğŸš¾ğŸ›‚ğŸ›ƒğŸ›„ğŸ›…ğŸ—£ï¸ğŸ‘¤ğŸ‘¥ğŸ«‚ğŸ‘£âš ï¸ğŸš¸â›”ğŸš«ğŸš³ğŸš­ğŸš¯ğŸš±ğŸš·ğŸ“µğŸ”â˜¢ï¸â˜£ï¸â¬†ï¸â†—ï¸â¡ï¸â†˜ï¸â¬‡ï¸â†™ï¸â¬…ï¸â†–ï¸â†•ï¸â†”ï¸â†©ï¸â†ªï¸â¤´ï¸â¤µï¸ğŸ”ƒğŸ”„ğŸ”™ğŸ”šğŸ”›ğŸ”œğŸ”ğŸ›âš›ï¸ğŸ•‰ï¸âœ¡ï¸â˜¸ï¸â˜¯ï¸âœï¸â˜¦ï¸â˜ªï¸â˜®ï¸ğŸ•ğŸ”¯ğŸª¯â™ˆâ™‰â™Šâ™‹â™Œâ™â™â™â™â™‘â™’â™“â›ğŸ”€ğŸ”ğŸ”‚â–¶ï¸â©â­ï¸â¯ï¸â—€ï¸âªâ®ï¸ğŸ”¼â«ğŸ”½â¬â¸ï¸â¹ï¸âºï¸âï¸ğŸ¦ğŸ”…ğŸ”†ğŸ“¶ğŸ›œğŸ“³ğŸ“´â™€ï¸â™‚ï¸âš§ï¸âœ–ï¸â•â–â—ğŸŸ°â™¾ï¸â€¼ï¸â‰ï¸â“â”â•â—ã€°ï¸ğŸ’±ğŸ’²âš•ï¸â™»ï¸âšœï¸ğŸ”±ğŸ“›ğŸ”°â­•âœ…â˜‘ï¸âœ”ï¸âŒââ°â¿ã€½ï¸âœ³ï¸âœ´ï¸â‡ï¸Â©ï¸Â®ï¸â„¢ï¸#ï¸âƒ£*ï¸âƒ£0ï¸âƒ£1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£5ï¸âƒ£6ï¸âƒ£7ï¸âƒ£8ï¸âƒ£9ï¸âƒ£ğŸ”ŸğŸ” ğŸ”¡ğŸ”¢ğŸ”£ğŸ”¤ğŸ…°ï¸ğŸ†ğŸ…±ï¸ğŸ†‘ğŸ†’ğŸ†“â„¹ï¸ğŸ†”â“‚ï¸ğŸ†•ğŸ†–ğŸ…¾ï¸ğŸ†—ğŸ…¿ï¸ğŸ†˜ğŸ†™ğŸ†šğŸˆğŸˆ‚ï¸ğŸˆ·ï¸ğŸˆ¶ğŸˆ¯ğŸ‰ğŸˆ¹ğŸˆšğŸˆ²ğŸ‰‘ğŸˆ¸ğŸˆ´ğŸˆ³ãŠ—ï¸ãŠ™ï¸ğŸˆºğŸˆµğŸ”´ğŸŸ ğŸŸ¡ğŸŸ¢ğŸ”µğŸŸ£ğŸŸ¤âš«âšªğŸŸ¥ğŸŸ§ğŸŸ¨ğŸŸ©ğŸŸ¦ğŸŸªğŸŸ«â¬›â¬œâ—¼ï¸â—»ï¸â—¾â—½â–ªï¸â–«ï¸ğŸ”¶ğŸ”·ğŸ”¸ğŸ”¹ğŸ”ºğŸ”»ğŸ’ ğŸ”˜ğŸ”³ğŸ”²ğŸ’¬ğŸ‘ï¸â€ğŸ—¨ï¸ğŸ—¨ï¸ğŸ—¯ï¸ğŸ’­ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ğŸ‘©â€ğŸ‘©â€ğŸ‘¦ğŸ‘©â€ğŸ‘©â€ğŸ‘§ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ğŸ‘¨â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ğŸ‘¨â€ğŸ‘§ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ğŸ‘©â€ğŸ‘¦ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ğŸ‘©â€ğŸ‘§ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ‘©â€ğŸ‘§â€ğŸ‘§ğŸ‘ªğŸ§‘â€ğŸ§‘â€ğŸ§’ğŸ§‘â€ğŸ§‘â€ğŸ§’â€ğŸ§’ğŸ§‘â€ğŸ§’ğŸ§‘â€ğŸ§’â€ğŸ§’ ğŸ æ——å¸œ 1 ğŸğŸš©ğŸŒğŸ´ğŸ³ï¸ğŸ³ï¸â€ğŸŒˆğŸ³ï¸â€âš§ï¸ğŸ´â€â˜ ï¸ ğŸ’¡ ä½¿ç”¨æç¤º è¿™äº›è¡¨æƒ…ç¬¦å·å¯ä»¥åœ¨å¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ ä¸åŒå¹³å°å¯èƒ½æ˜¾ç¤ºç•¥æœ‰å·®å¼‚ å¸¸ç”¨ç¬¦å·ï¼šâ¤ï¸ğŸï¸ğŸš€ğŸ’¡â¬ğŸ³ å¸Œæœ›è¿™ä¸ªè¡¨æƒ…ç¬¦å·å¤§å…¨å¯¹æ‚¨æœ‰å¸®åŠ©ï¼ğŸ‰\n","date":"2024-12-20T21:49:23+08:00","image":"https://file.meimolihan.eu.org/img/emoji-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a94ae05a/","title":"Emoji è¡¨æƒ…ç¬¦å·å¤§å…¨ ğŸ«¡"},{"content":"Emby Jellyfin å­—å¹•æ’ä»¶ å­—å¹•æ’ä»¶ githubåœ°å€ï¼šhttps://github.com/91270/MeiamSubtitles emby å­—å¹•æ’ä»¶ä½¿ç”¨ è§£å‹åéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶åç§° emby æ–‡ä»¶ï¼šEmby.MeiamSub.Shooter.dll emby æ–‡ä»¶ï¼šEmby.MeiamSub.Thunder.dll\nä¸Šä¼ ç›®å½•ï¼š/mnt/mydisk/home/emby-amilys/config/plugins/ é‡å¯ emby jellyfin å­—å¹•æ’ä»¶ è§£å‹åéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶å¤¹åç§° jellyfin æ–‡ä»¶å¤¹ï¼šJellyfin.MeiamSub.Shooter_1.0.10.0 jellyfin æ–‡ä»¶å¤¹ï¼šJellyfin.MeiamSub.Thunder_1.0.10.0\nä¸Šä¼ ç›®å½•ï¼š/mnt/mydisk/home/jellyfin/config/plugins/ é‡å¯ jellyfin ","date":"2024-12-20T09:14:15+08:00","image":"https://file.meimolihan.eu.org/img/emby-jellyfin-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a8042539/","title":"Emby Jellyfin å­—å¹•æ’ä»¶"},{"content":"ImmortalWrt ç³»ç»Ÿç¼–è¯‘ä¸å®šåˆ¶ ğŸ”ï¸ ğŸ› ï¸ ä»é›¶å¼€å§‹æ„å»ºä¸“å±çš„ OpenWrt å›ºä»¶ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº† ImmortalWrt çš„ç¼–è¯‘ã€å®šåˆ¶ã€å®‰è£…å’Œä¼˜åŒ–å…¨è¿‡ç¨‹ã€‚\nâœ¨ ç›®å½• âœ¨ æ¦‚è¿° ğŸ¯ ä¸€ã€å‡†å¤‡å·¥ä½œ âš™ï¸ äºŒã€åœ¨çº¿å®šåˆ¶ç¼–è¯‘ ğŸ“¦ ä¸‰ã€é¢„è£…è½¯ä»¶é…ç½® ğŸ”§ å››ã€é¦–æ¬¡å¯åŠ¨è„šæœ¬ ğŸ’¾ äº”ã€é•œåƒæ‰©å®¹å¤„ç† ğŸš€ å…­ã€å®‰è£…ä¸éƒ¨ç½² âš¡ ä¸ƒã€ä¼˜åŒ–ä¸æŠ€å·§ âš ï¸ å…«ã€æ³¨æ„äº‹é¡¹ âœ¨ æ¦‚è¿° ImmortalWrt æ˜¯ OpenWrt çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸“æ³¨äºæä¾›æ›´ç¨³å®šçš„åŠŸèƒ½å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ï¼š\nâœ… äº†è§£ ImmortalWrt çš„åŸºæœ¬æ¦‚å¿µå’Œä¼˜åŠ¿ âœ… æŒæ¡åœ¨çº¿å®šåˆ¶ç¼–è¯‘çš„æ–¹æ³• âœ… é…ç½®ä¸ªæ€§åŒ–çš„è½¯ä»¶åŒ…ç»„åˆ âœ… åˆ›å»ºè‡ªåŠ¨åŒ–çš„é¦–æ¬¡å¯åŠ¨è„šæœ¬ âœ… å¤„ç†é•œåƒæ‰©å®¹å’Œç³»ç»Ÿä¼˜åŒ– âœ… éƒ¨ç½²å’Œç»´æŠ¤æ‚¨çš„å®šåˆ¶ç³»ç»Ÿ ğŸ¯ ä¸€ã€å‡†å¤‡å·¥ä½œ ğŸ“š å­¦ä¹ èµ„æº ğŸ¥ è§†é¢‘æ•™ç¨‹: Bç«™æ•™ç¨‹ ğŸ“– åšå®¢æ–‡æ¡£: æ‚Ÿç©ºåšå®¢ ğŸ’¾ å›ºä»¶ä¸‹è½½: Google Drive ğŸŒ å®˜æ–¹æ–‡æ¡£: ImmortalWrt Wiki ğŸ”§ ç¯å¢ƒè¦æ±‚ 1 2 3 4 5 6 7 8 9 10 # ç¡¬ä»¶è¦æ±‚ - å¤„ç†å™¨: x86_64 æˆ– ARM æ¶æ„ - å†…å­˜: è‡³å°‘ 2GB RAM - å­˜å‚¨: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´ - ç½‘ç»œ: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ # è½¯ä»¶è¦æ±‚ - æ“ä½œç³»ç»Ÿ: Linux (æ¨è Ubuntu 20.04+ æˆ– iStoreOS/OpenWrt) - åŸºç¡€å·¥å…·: git, curl, wget, build-essential - ç¼–è¯‘ä¾èµ–: å‚è§å®˜æ–¹æ–‡æ¡£ ğŸ› ï¸ å¿…è¦å·¥å…·å®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åœ¨ Ubuntu/Debian ä¸Šå®‰è£…åŸºç¡€å·¥å…· sudo apt update sudo apt install -y \\ git curl wget \\ build-essential \\ libssl-dev \\ libncurses5-dev \\ unzip gzip \\ python3 python3-pip # åœ¨ OpenWrt/iStoreOS ä¸Šå®‰è£…å·¥å…· opkg update opkg install \\ git-http \\ curl \\ wget \\ unzip \\ gzip \\ parted \\ losetup \\ resize2fs \\ openssh-sftp-server ğŸ“ åˆ›å»ºå·¥ä½œç›®å½• 1 2 3 4 5 6 # åˆ›å»ºé¡¹ç›®ç›®å½• mkdir -p ~/immortalwrt-build cd ~/immortalwrt-build # å…‹éš†ç›¸å…³å·¥å…· git clone https://github.com/wukongdaily/OpenBackRestore.git âš™ï¸ äºŒã€åœ¨çº¿å®šåˆ¶ç¼–è¯‘ ğŸŒ è®¿é—®åœ¨çº¿æ„å»ºå™¨ æ‰“å¼€ ImmortalWrt å®˜æ–¹åœ¨çº¿æ„å»ºå™¨ï¼š Firmware Selector ğŸ›ï¸ é…ç½®æ„å»ºå‚æ•° é€‰æ‹©ç‰ˆæœ¬: 23.05.4 (ç¨³å®šç‰ˆ) é€‰æ‹©å¹³å°: æ¶æ„: x86/64 å­ç›®æ ‡: generic å˜ä½“: ext4-combined (æ¨è) ç‚¹å‡»å±•å¼€æŒ‰é’® â†’ è‡ªå®šä¹‰é¢„è£…è½¯ä»¶ ğŸ” è½¯ä»¶åŒ…æœç´¢æŠ€å·§ éœ€è¦æŸ¥æ‰¾è½¯ä»¶åŒ…åç§°ï¼Ÿè®¿é—®ï¼š è½¯ä»¶åŒ…ä»“åº“ ğŸ“ æ„å»ºé…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç›®æ ‡ç³»ç»Ÿé…ç½® TARGET: x86 SUBTARGET: 64 PROFILE: generic # é•œåƒæ ¼å¼ EXT4_ROOTFS: enabled COMBINED_IMAGE: enabled GRUB_IMAGES: disabled # åŸºç¡€ç»„ä»¶ BASE: enabled LUCI: enabled LUCI_SSL: enabled â³ ç¼–è¯‘è¿‡ç¨‹ç›‘æ§ 1 2 3 4 5 6 7 8 # ç¼–è¯‘æ—¶é—´é¢„ä¼°ï¼ˆæ ¹æ®ç¡¬ä»¶é…ç½®ï¼‰ - ä½ç«¯è®¾å¤‡: 2-4 å°æ—¶ - ä¸­ç«¯è®¾å¤‡: 1-2 å°æ—¶ - é«˜ç«¯è®¾å¤‡: 30-60 åˆ†é’Ÿ - äº‘æœåŠ¡å™¨: 15-30 åˆ†é’Ÿ # ç›‘æ§ç¼–è¯‘è¿›åº¦ tail -f build.log | grep -E \u0026#34;(processing|install|Creating)\u0026#34; ğŸ“¦ ä¸‰ã€é¢„è£…è½¯ä»¶é…ç½® ğŸ¯ æ¨èé¢„è£…è½¯ä»¶åˆ—è¡¨ ğŸŒ ç½‘ç»œå·¥å…· 1 2 3 4 5 6 7 8 9 10 11 # åŸºç¡€ç½‘ç»œ luci-i18n-firewall-zh-cn luci-i18n-opkg-zh-cn luci-i18n-ttyd-zh-cn openssh-sftp-server # é«˜çº§ç½‘ç»œ luci-app-wol luci-i18n-wol-zh-cn luci-app-upnp luci-i18n-upnp-zh-cn ğŸ“ æ–‡ä»¶ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ–‡ä»¶æµè§ˆå™¨ luci-app-filebrowser luci-i18n-filebrowser-zh-cn # FTP æœåŠ¡ vsftpd luci-app-vsftpd # ç£ç›˜ç®¡ç† luci-app-diskman parted fdisk e2fsprogs ğŸ¨ ä¸»é¢˜ç•Œé¢ 1 2 3 4 5 6 7 8 # Argon ä¸»é¢˜ luci-theme-argon luci-app-argon-config luci-i18n-argon-config-zh-cn # å…¶ä»–ä¸»é¢˜ luci-theme-material luci-theme-bootstrap ğŸ”’ ç§‘å­¦ä¸Šç½‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # PassWall luci-app-passwall luci-i18n-passwall-zh-cn # OpenClash luci-app-openclash # HomeProxy luci-app-homeproxy luci-i18n-homeproxy-zh-cn # Shadowsocks shadowsocks-libev luci-app-shadowsocks-libev ğŸ› ï¸ ç³»ç»Ÿå·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç›‘æ§ç»Ÿè®¡ luci-app-statistics luci-i18n-statistics-zh-cn # å¸¦å®½ç›‘æ§ luci-app-nlbwmon luci-i18n-nlbwmon-zh-cn # å®šæ—¶ä»»åŠ¡ luci-app-cron luci-i18n-cron-zh-cn # ç£ç›˜æ‰©å±• luci-app-partexp ğŸ”§ è‡ªå®šä¹‰è½¯ä»¶é€‰æ‹©æŠ€å·§ 1. æŒ‰åŠŸèƒ½éœ€æ±‚é€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®¶åº­ç”¨æˆ·åŸºç¡€å¥—é¤ luci-i18n-firewall-zh-cn luci-i18n-upnp-zh-cn luci-app-wol luci-theme-argon # é«˜çº§ç”¨æˆ·å¥—é¤ luci-app-passwall luci-app-diskman luci-app-statistics luci-app-filebrowser # æœ€å°åŒ–å¥—é¤ luci-i18n-firewall-zh-cn luci-i18n-opkg-zh-cn openssh-sftp-server 2. ç©ºé—´ä¼˜åŒ–ç­–ç•¥ 1 2 3 4 5 6 7 # æŸ¥çœ‹è½¯ä»¶åŒ…å¤§å°ï¼ˆç¼–è¯‘å‰ï¼‰ opkg info \u0026lt;package-name\u0026gt; | grep Size # ç²¾ç®€è¯­è¨€åŒ…ï¼ˆåªä¿ç•™ä¸­æ–‡ï¼‰ luci-i18n-base-zh-cn luci-i18n-firewall-zh-cn # é¿å…å®‰è£…æ‰€æœ‰è¯­è¨€åŒ… 3. ä¾èµ–å…³ç³»å¤„ç† 1 2 3 4 5 6 7 # è‡ªåŠ¨è§£å†³ä¾èµ– ./scripts/feeds update -a ./scripts/feeds install -a # æ£€æŸ¥ç¼ºå¤±ä¾èµ– make defconfig make -j1 V=s 2\u0026gt;\u0026amp;1 | grep \u0026#34;missing\u0026#34; 4. æ¨¡å—åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºè‡ªå®šä¹‰è½¯ä»¶åŒ…åˆ—è¡¨ cat \u0026gt; custom_packages.list \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; luci-i18n-firewall-zh-cn luci-i18n-opkg-zh-cn luci-theme-argon openssh-sftp-server EOF # æ‰¹é‡å®‰è£… xargs -a custom_packages.list opkg install ğŸ”§ å››ã€é¦–æ¬¡å¯åŠ¨è„šæœ¬ ğŸš€ åˆå§‹åŒ–è„šæœ¬é…ç½® åˆ›å»ºé¦–æ¬¡å¯åŠ¨é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 #!/bin/sh # /etc/uci-defaults/99-custom-init logger -t custom-init \u0026#34;å¼€å§‹æ‰§è¡Œé¦–æ¬¡å¯åŠ¨é…ç½®\u0026#34; # 1. å¯ç”¨ WAN å£é˜²ç«å¢™è®¿é—® uci set firewall.@zone[1].input=\u0026#39;ACCEPT\u0026#39; uci commit firewall logger -t custom-init \u0026#34;å·²å¯ç”¨ WAN å£é˜²ç«å¢™è®¿é—®\u0026#34; # 2. è§£å†³ Android TV ç½‘ç»œè¿æ¥é—®é¢˜ uci add dhcp domain uci set \u0026#34;dhcp.@domain[-1].name=time.android.com\u0026#34; uci set \u0026#34;dhcp.@domain[-1].ip=203.107.6.88\u0026#34; uci commit dhcp logger -t custom-init \u0026#34;å·²é…ç½® Android TV æ—¶é—´æœåŠ¡å™¨\u0026#34; # 3. æ™ºèƒ½ç½‘ç»œé…ç½® NETWORK_CONFIGURED=false # æ£€æµ‹ç‰©ç†ç½‘å¡æ•°é‡ PHYSICAL_IFACES=$(ls /sys/class/net | grep -E \u0026#39;^(eth|en|wl)\u0026#39; | grep -v lo) IFACE_COUNT=$(echo \u0026#34;$PHYSICAL_IFACES\u0026#34; | wc -w) logger -t custom-init \u0026#34;æ£€æµ‹åˆ° $IFACE_COUNT ä¸ªç‰©ç†ç½‘å¡: $PHYSICAL_IFACES\u0026#34; case $IFACE_COUNT in 0) logger -t custom-init \u0026#34;æœªæ£€æµ‹åˆ°ç‰©ç†ç½‘å¡ï¼Œä¿æŒé»˜è®¤é…ç½®\u0026#34; ;; 1) # å•ç½‘å¡æ¨¡å¼ï¼šDHCP å®¢æˆ·ç«¯ uci set network.lan.proto=\u0026#39;dhcp\u0026#39; uci delete network.lan.ipaddr 2\u0026gt;/dev/null uci delete network.lan.netmask 2\u0026gt;/dev/null uci commit network logger -t custom-init \u0026#34;å·²é…ç½®ä¸ºå•ç½‘å¡ DHCP å®¢æˆ·ç«¯æ¨¡å¼\u0026#34; NETWORK_CONFIGURED=true ;; *) # å¤šç½‘å¡æ¨¡å¼ï¼šé™æ€ IP è·¯ç”± uci set network.lan.ipaddr=\u0026#39;192.168.100.1\u0026#39; uci set network.lan.netmask=\u0026#39;255.255.255.0\u0026#39; uci commit network logger -t custom-init \u0026#34;å·²é…ç½®ä¸ºå¤šç½‘å¡é™æ€è·¯ç”±æ¨¡å¼ (192.168.100.1/24)\u0026#34; NETWORK_CONFIGURED=true ;; esac # 4. è®¾ç½®æ—¶åŒºå’Œåœ°åŒº uci set system.@system[0].timezone=\u0026#39;CST-8\u0026#39; uci set system.@system[0].zonename=\u0026#39;Asia/Shanghai\u0026#39; uci set system.@system[0].hostname=\u0026#39;ImmortalWrt-Router\u0026#39; uci commit system logger -t custom-init \u0026#34;å·²è®¾ç½®æ—¶åŒºä¸ºäºšæ´²/ä¸Šæµ·\u0026#34; # 5. å¯ç”¨ SSH æ ¹ç™»å½•ï¼ˆé¦–æ¬¡é…ç½®æ–¹ä¾¿ï¼‰ uci set dropbear.@dropbear[0].RootLogin=\u0026#39;1\u0026#39; uci set dropbear.@dropbear[0].PasswordAuth=\u0026#39;on\u0026#39; uci set dropbear.@dropbear[0].GatewayPorts=\u0026#39;on\u0026#39; uci commit dropbear logger -t custom-init \u0026#34;å·²å¯ç”¨ SSH æ ¹ç™»å½•\u0026#34; # 6. é…ç½®è½¯ä»¶æºé•œåƒ if [ -f /etc/opkg/distfeeds.conf ]; then sed -i \\ -e \u0026#39;s|https://downloads.immortalwrt.org|https://mirrors.cernet.edu.cn/immortalwrt|g\u0026#39; \\ -e \u0026#39;s|https://mirrors.vsean.net/openwrt|https://mirrors.cernet.edu.cn/immortalwrt|g\u0026#39; \\ /etc/opkg/distfeeds.conf logger -t custom-init \u0026#34;å·²é…ç½®å›½å†…è½¯ä»¶æºé•œåƒ\u0026#34; fi # 7. åˆ›å»ºåˆå§‹ç”¨æˆ·é…ç½®æ ‡å¿— touch /etc/.first_boot_complete logger -t custom-init \u0026#34;é¦–æ¬¡å¯åŠ¨é…ç½®å®Œæˆ\u0026#34; # 8. é‡å¯ç½‘ç»œæœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰ if [ \u0026#34;$NETWORK_CONFIGURED\u0026#34; = \u0026#34;true\u0026#34; ]; then /etc/init.d/network restart logger -t custom-init \u0026#34;ç½‘ç»œæœåŠ¡å·²é‡å¯\u0026#34; fi exit 0 ğŸ› ï¸ è„šæœ¬éƒ¨ç½²æ–¹æ³• æ–¹æ³•ä¸€ï¼šç¼–è¯‘æ—¶é›†æˆ 1 2 3 4 5 6 7 8 9 # åœ¨ç¼–è¯‘ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ mkdir -p files/etc/uci-defaults cat \u0026gt; files/etc/uci-defaults/99-custom-init \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh # ä½ çš„è„šæœ¬å†…å®¹ EOF # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x files/etc/uci-defaults/99-custom-init æ–¹æ³•äºŒï¼šé¦–æ¬¡å¯åŠ¨åä¸Šä¼  1 2 3 4 5 6 7 8 # é€šè¿‡ SCP ä¸Šä¼ è„šæœ¬ scp 99-custom-init root@192.168.1.1:/etc/uci-defaults/ # è®¾ç½®æƒé™å¹¶æ‰§è¡Œ ssh root@192.168.1.1 \u0026#34; chmod +x /etc/uci-defaults/99-custom-init ./etc/uci-defaults/99-custom-init \u0026#34; æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Luci ç•Œé¢ ç™»å½• Luci ç®¡ç†ç•Œé¢ è¿›å…¥ã€Œç³»ç»Ÿã€â†’ã€Œå¯åŠ¨é¡¹ã€ åœ¨ã€Œæœ¬åœ°å¯åŠ¨è„šæœ¬ã€ä¸­æ·»åŠ é…ç½® ä¿å­˜å¹¶æ‰§è¡Œ ğŸ” è„šæœ¬è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹è„šæœ¬æ‰§è¡Œæ—¥å¿— logread -e custom-init # æ‰‹åŠ¨æµ‹è¯•è„šæœ¬ chmod +x /etc/uci-defaults/99-custom-init sh -x /etc/uci-defaults/99-custom-init # æ£€æŸ¥é…ç½®ç»“æœ uci show network uci show system uci show firewall # éªŒè¯ç½‘ç»œé…ç½® ifconfig route -n âš™ï¸ é«˜çº§é…ç½®é€‰é¡¹ åŠ¨æ€ DNS é…ç½® 1 2 3 4 5 6 7 8 # æ£€æµ‹ WAN å£ IP å¹¶é…ç½® DDNS WAN_IP=$(uci get network.wan.ipaddr 2\u0026gt;/dev/null || ip addr show dev br-lan | grep \u0026#39;inet \u0026#39; | awk \u0026#39;{print $2}\u0026#39; | cut -d/ -f1) if [ -n \u0026#34;$WAN_IP\u0026#34; ]; then uci set ddns.myddns.ipaddr=\u0026#34;$WAN_IP\u0026#34; uci commit ddns logger -t custom-init \u0026#34;å·²é…ç½® DDNS IP: $WAN_IP\u0026#34; fi ç¡¬ä»¶ç‰¹å®šé…ç½® 1 2 3 4 5 6 7 8 9 10 # æ£€æµ‹ç¡¬ä»¶ç±»å‹å¹¶ä¼˜åŒ–é…ç½® CPU_CORES=$(nproc) MEMORY_KB=$(grep MemTotal /proc/meminfo | awk \u0026#39;{print $2}\u0026#39;) if [ \u0026#34;$CPU_CORES\u0026#34; -ge 4 ] \u0026amp;\u0026amp; [ \u0026#34;$MEMORY_KB\u0026#34; -ge 4000000 ]; then # é«˜æ€§èƒ½è®¾å¤‡ä¼˜åŒ– uci set system.@system[0].cronloglevel=\u0026#39;9\u0026#39; uci set uhttpd.main.limits=\u0026#39;100\u0026#39; logger -t custom-init \u0026#34;å·²å¯ç”¨é«˜æ€§èƒ½æ¨¡å¼é…ç½®\u0026#34; fi ğŸ’¾ äº”ã€é•œåƒæ‰©å®¹å¤„ç† ğŸ“ˆ é•œåƒæ‰©å®¹æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 1. è§£å‹ä¸‹è½½çš„é•œåƒæ–‡ä»¶ echo \u0026#34;è§£å‹é•œåƒæ–‡ä»¶...\u0026#34; gzip -kd immortalwrt-23.05.4-x86-64-generic-ext4-combined.img.gz # 2. å¢åŠ  2GB ç©ºé—´åˆ°é•œåƒ echo \u0026#34;æ‰©å±•é•œåƒå¤§å°...\u0026#34; dd if=/dev/zero bs=1M count=2048 \u0026gt;\u0026gt; immortalwrt-23.05.4-x86-64-generic-ext4-combined.img # 3. ä½¿ç”¨ parted è°ƒæ•´åˆ†åŒº echo \u0026#34;è°ƒæ•´åˆ†åŒºå¤§å°...\u0026#34; parted immortalwrt-23.05.4-x86-64-generic-ext4-combined.img \u0026lt;\u0026lt; EOF print resizepart 2 100% print quit EOF # 4. æ£€æŸ¥åˆ†åŒºä¿¡æ¯ echo \u0026#34;åˆ†åŒºè°ƒæ•´å®Œæˆï¼ŒéªŒè¯ç»“æœ:\u0026#34; fdisk -l immortalwrt-23.05.4-x86-64-generic-ext4-combined.img ğŸ› ï¸ æ‰€éœ€å·¥å…·å®‰è£… åœ¨ OpenWrt/iStoreOS ä¸Šï¼š 1 2 3 4 5 6 7 8 9 10 11 12 opkg update opkg install \\ parted \\ fdisk \\ losetup \\ resize2fs \\ e2fsprogs \\ openssh-sftp-server # éªŒè¯å·¥å…·å®‰è£… which parted \u0026amp;\u0026amp; echo \u0026#34;parted å·²å®‰è£…\u0026#34; || echo \u0026#34;parted æœªå®‰è£…\u0026#34; which resize2fs \u0026amp;\u0026amp; echo \u0026#34;resize2fs å·²å®‰è£…\u0026#34; || echo \u0026#34;resize2fs æœªå®‰è£…\u0026#34; åœ¨ Ubuntu/Debian ä¸Šï¼š 1 2 3 4 5 6 7 sudo apt update sudo apt install -y \\ parted \\ fdisk \\ dosfstools \\ e2fsprogs \\ qemu-utils ğŸ”„ è‡ªåŠ¨åŒ–æ‰©å®¹è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 #!/bin/bash # resize_image.sh - è‡ªåŠ¨æ‰©å®¹ OpenWrt/ImmortalWrt é•œåƒ set -e IMAGE_FILE=\u0026#34;$1\u0026#34; EXPAND_SIZE=\u0026#34;${2:-2048}\u0026#34; # é»˜è®¤æ‰©å±• 2GB if [ -z \u0026#34;$IMAGE_FILE\u0026#34; ] || [ ! -f \u0026#34;$IMAGE_FILE\u0026#34; ]; then echo \u0026#34;ç”¨æ³•: $0 \u0026lt;é•œåƒæ–‡ä»¶\u0026gt; [æ‰©å±•å¤§å°(MB)]\u0026#34; echo \u0026#34;ç¤ºä¾‹: $0 openwrt.img 2048\u0026#34; exit 1 fi echo \u0026#34;æ­£åœ¨å¤„ç†é•œåƒ: $IMAGE_FILE\u0026#34; echo \u0026#34;æ‰©å±•å¤§å°: ${EXPAND_SIZE}MB\u0026#34; # å¤‡ä»½åŸé•œåƒ BACKUP_FILE=\u0026#34;${IMAGE_FILE}.backup.$(date +%Y%m%d_%H%M%S)\u0026#34; echo \u0026#34;åˆ›å»ºå¤‡ä»½: $BACKUP_FILE\u0026#34; cp \u0026#34;$IMAGE_FILE\u0026#34; \u0026#34;$BACKUP_FILE\u0026#34; # æ‰©å±•é•œåƒæ–‡ä»¶ echo \u0026#34;æ‰©å±•é•œåƒæ–‡ä»¶...\u0026#34; dd if=/dev/zero bs=1M count=\u0026#34;$EXPAND_SIZE\u0026#34; \u0026gt;\u0026gt; \u0026#34;$IMAGE_FILE\u0026#34; # è°ƒæ•´åˆ†åŒºè¡¨ echo \u0026#34;è°ƒæ•´åˆ†åŒºè¡¨...\u0026#34; PARTITION_INFO=$(parted -s \u0026#34;$IMAGE_FILE\u0026#34; unit MB print) PARTITION_NUM=$(echo \u0026#34;$PARTITION_INFO\u0026#34; | grep -E \u0026#39;^ [2-9]\u0026#39; | wc -l) if [ \u0026#34;$PARTITION_NUM\u0026#34; -eq 0 ]; then echo \u0026#34;é”™è¯¯: æœªæ‰¾åˆ°å¯è°ƒæ•´çš„åˆ†åŒº\u0026#34; exit 1 fi # è°ƒæ•´æœ€åä¸€ä¸ªåˆ†åŒº parted -s \u0026#34;$IMAGE_FILE\u0026#34; resizepart 2 100% # æŒ‚è½½å¹¶è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿ echo \u0026#34;è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°...\u0026#34; LOOP_DEVICE=$(losetup -f --show -P \u0026#34;$IMAGE_FILE\u0026#34;) if [ -z \u0026#34;$LOOP_DEVICE\u0026#34; ]; then echo \u0026#34;é”™è¯¯: æ— æ³•è®¾ç½® loop è®¾å¤‡\u0026#34; exit 1 fi # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå¹¶è°ƒæ•´å¤§å° e2fsck -f \u0026#34;${LOOP_DEVICE}p2\u0026#34; resize2fs \u0026#34;${LOOP_DEVICE}p2\u0026#34; # æ¸…ç† losetup -d \u0026#34;$LOOP_DEVICE\u0026#34; echo \u0026#34;é•œåƒæ‰©å®¹å®Œæˆ!\u0026#34; echo \u0026#34;åŸé•œåƒå¤‡ä»½: $BACKUP_FILE\u0026#34; echo \u0026#34;æ–°é•œåƒå¤§å°: $(du -h \u0026#34;$IMAGE_FILE\u0026#34; | cut -f1)\u0026#34; ğŸ“Š ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç»™è„šæœ¬æ‰§è¡Œæƒé™ chmod +x resize_image.sh # æ‰©å±•é•œåƒ ./resize_image.sh immortalwrt.img 2048 # æˆ–è€…ç›´æ¥ä½¿ç”¨ä¸€è¡Œå‘½ä»¤ gzip -kd image.img.gz \u0026amp;\u0026amp; \\ dd if=/dev/zero bs=1M count=2048 \u0026gt;\u0026gt; image.img \u0026amp;\u0026amp; \\ parted -s image.img resizepart 2 100% \u0026amp;\u0026amp; \\ LOOP_DEV=$(losetup -f --show -P image.img) \u0026amp;\u0026amp; \\ e2fsck -f ${LOOP_DEV}p2 \u0026amp;\u0026amp; \\ resize2fs ${LOOP_DEV}p2 \u0026amp;\u0026amp; \\ losetup -d $LOOP_DEV ğŸ” éªŒè¯æ‰©å®¹ç»“æœ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥é•œåƒæ–‡ä»¶å¤§å° ls -lh immortalwrt-*.img # æ£€æŸ¥åˆ†åŒºä¿¡æ¯ fdisk -l immortalwrt-*.img # éªŒè¯æ–‡ä»¶ç³»ç»Ÿ losetup -f --show -P immortalwrt-*.img tune2fs -l /dev/loop0p2 | grep \u0026#39;Block count\u0026#39; losetup -d /dev/loop0 ğŸš€ å…­ã€å®‰è£…ä¸éƒ¨ç½² ğŸ”„ è½¯ä»¶æºä¼˜åŒ–é…ç½® é¦–æ¬¡å¯åŠ¨åå»ºè®®æ›´æ¢å›½å†…è½¯ä»¶æºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å¤‡ä»½åŸé…ç½® cp /etc/opkg/distfeeds.conf /etc/opkg/distfeeds.conf.bak # ä½¿ç”¨æ•™è‚²ç½‘é•œåƒæº cat \u0026gt; /etc/opkg/distfeeds.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; src/gz immortalwrt_core https://mirrors.cernet.edu.cn/immortalwrt/releases/23.05.4/targets/x86/64/packages src/gz immortalwrt_base https://mirrors.cernet.edu.cn/immortalwrt/releases/23.05.4/packages/x86_64/base src/gz immortalwrt_luci https://mirrors.cernet.edu.cn/immortalwrt/releases/23.05.4/packages/x86_64/luci src/gz immortalwrt_packages https://mirrors.cernet.edu.cn/immortalwrt/releases/23.05.4/packages/x86_64/packages src/gz immortalwrt_routing https://mirrors.cernet.edu.cn/immortalwrt/releases/23.05.4/packages/x86_64/routing src/gz immortalwrt_telephony https://mirrors.cernet.edu.cn/immortalwrt/releases/23.05.4/packages/x86_64/telephony EOF # æ›´æ–°è½¯ä»¶åˆ—è¡¨ opkg update # æµ‹è¯•è½¯ä»¶æº opkg list | head -10 ğŸ“Š ä¸€é”®åˆ†åŒºæ‰©å®¹å·¥å…· ä½¿ç”¨ sirpdboy çš„åˆ†åŒºæ‰©å®¹å·¥å…·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # ä¸€é”®å®‰è£…åˆ†åŒºæ‰©å®¹å·¥å…· wget -O install.sh https://cafe.cpolar.cn/wkdaily/OneKeyExpand/raw/branch/main/install.sh chmod +x install.sh ./install.sh # æˆ–è€…æ‰‹åŠ¨å®‰è£… opkg install luci-app-partexp # ä½¿ç”¨æ‰©å®¹å·¥å…· partexp # æˆ–è€…é€šè¿‡ Luci ç•Œé¢æ“ä½œ ğŸ’¾ ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤ ä½¿ç”¨ä¸€é”®å¤‡ä»½å·¥å…·ï¼š\n1 2 3 4 5 6 7 8 9 10 # å…‹éš†å¤‡ä»½å·¥å…·ä»“åº“ git clone https://github.com/wukongdaily/OpenBackRestore.git # æ‰§è¡Œå¤‡ä»½ï¼ˆä»… squashfs æ ¼å¼æœ‰æ•ˆï¼‰ cd OpenBackRestore chmod +x backup.sh ./backup.sh # å¤‡ä»½æ–‡ä»¶ä½ç½® ls -la /tmp/backup/ ğŸ–¥ï¸ ç‰©ç†æœºå®‰è£…æ–¹æ³• ä½¿ç”¨ DD å‘½ä»¤å†™å…¥ 1 2 3 4 5 6 7 8 9 # ç¡®è®¤ç£ç›˜è®¾å¤‡ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ fdisk -l # å†™å…¥é•œåƒï¼ˆå°† /dev/sdX æ›¿æ¢ä¸ºä½ çš„ç£ç›˜ï¼‰ dd if=immortalwrt.img of=/dev/sdX bs=4M status=progress # åŒæ­¥å¹¶éªŒè¯ sync fdisk -l /dev/sdX ä½¿ç”¨ Etcher å·¥å…· ä¸‹è½½ Balena Etcher é€‰æ‹©é•œåƒæ–‡ä»¶ é€‰æ‹©ç›®æ ‡ç£ç›˜ ç‚¹å‡» Flash å¼€å§‹å†™å…¥ ä½¿ç”¨ Ventoy å¯åŠ¨ å‡†å¤‡ Ventoy Uç›˜ å°†é•œåƒæ–‡ä»¶æ‹·è´åˆ° Uç›˜ ä» Uç›˜å¯åŠ¨é€‰æ‹©é•œåƒå®‰è£… â˜ï¸ è™šæ‹Ÿæœºéƒ¨ç½² Proxmox VE éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºè™šæ‹Ÿæœº qm create 100 --name immortalwrt --memory 512 --net0 virtio,bridge=vmbr0 # å¯¼å…¥ç£ç›˜ qm importdisk 100 immortalwrt.img local-lvm # é…ç½®è™šæ‹Ÿæœº qm set 100 --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-100-disk-0 qm set 100 --boot c --bootdisk scsi0 qm set 100 --serial0 socket --vga serial0 # å¯åŠ¨è™šæ‹Ÿæœº qm start 100 VMware/VirtualBox éƒ¨ç½² åˆ›å»ºæ–°è™šæ‹Ÿæœº é€‰æ‹© Linux 2.6.x 32-bit ä½¿ç”¨ç°æœ‰è™šæ‹Ÿç£ç›˜æ–‡ä»¶ è°ƒæ•´ç½‘ç»œè®¾ç½®ï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰ å¯åŠ¨å¹¶é…ç½® âš¡ ä¸ƒã€ä¼˜åŒ–ä¸æŠ€å·§ ğŸ¨ ä¸»é¢˜ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… Argon ä¸»é¢˜ opkg update opkg install \\ luci-theme-argon \\ luci-app-argon-config \\ luci-i18n-argon-config-zh-cn # è®¾ç½®é»˜è®¤ä¸»é¢˜ uci set luci.main.mediaurlbase=\u0026#39;/luci-static/argon\u0026#39; uci set luci.main.lang=\u0026#39;zh_cn\u0026#39; uci commit luci # é‡å¯ Luci æœåŠ¡ /etc/init.d/uhttpd restart ğŸ”§ æ€§èƒ½è°ƒä¼˜è®¾ç½® ç³»ç»Ÿå‚æ•°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ä¼˜åŒ– DNS è§£æ echo \u0026#34;options timeout:1 attempts:2 rotate\u0026#34; \u0026gt;\u0026gt; /etc/resolv.conf # å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ echo \u0026#34;fs.file-max = 524288\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf # ä¼˜åŒ–ç½‘ç»œå‚æ•° cat \u0026gt;\u0026gt; /etc/sysctl.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; net.core.rmem_max = 67108864 net.core.wmem_max = 67108864 net.core.netdev_max_backlog = 250000 net.core.somaxconn = 4096 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_tw_reuse = 1 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 EOF # åº”ç”¨é…ç½® sysctl -p å†…å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 # è°ƒæ•´ SWAP ä½¿ç”¨ç­–ç•¥ echo \u0026#34;vm.swappiness = 10\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf # æ¸…ç†å†…å­˜ç¼“å­˜è„šæœ¬ cat \u0026gt; /usr/bin/clearcache \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh sync echo 3 \u0026gt; /proc/sys/vm/drop_caches echo \u0026#34;å†…å­˜ç¼“å­˜å·²æ¸…ç†\u0026#34; EOF chmod +x /usr/bin/clearcache ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡æ˜¾ç¤º uci set luci.main.mediaurlbase=\u0026#39;/luci-static/argon\u0026#39; uci set luci.main.responsive=\u0026#39;1\u0026#39; uci commit luci # å¯ç”¨å“åº”å¼å¸ƒå±€ opkg install luci-compat # ç§»åŠ¨ç«¯ä¸“ç”¨ä¸»é¢˜è®¾ç½® if [ -f /usr/lib/lua/luci/view/argon/mobile.htm ]; then ln -sf /usr/lib/lua/luci/view/argon/mobile.htm /www/index.html fi ğŸ›¡ï¸ å®‰å…¨åŠ å›º SSH å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # ç¦ç”¨ root å¯†ç ç™»å½•ï¼ˆé¦–æ¬¡é…ç½®åï¼‰ uci set dropbear.@dropbear[0].RootLogin=\u0026#39;0\u0026#39; uci set dropbear.@dropbear[0].PasswordAuth=\u0026#39;off\u0026#39; uci commit dropbear /etc/init.d/dropbear restart # åˆ›å»ºæ™®é€šç”¨æˆ· useradd -m -s /bin/bash admin passwd admin # é…ç½® sudo æƒé™ opkg install sudo echo \u0026#34;admin ALL=(ALL) ALL\u0026#34; \u0026gt;\u0026gt; /etc/sudoers é˜²ç«å¢™åŠ å›º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ uci set uhttpd.main.listen_http=\u0026#39;0.0.0.0:80\u0026#39; uci set uhttpd.main.listen_https=\u0026#39;0.0.0.0:443\u0026#39; uci commit uhttpd # é…ç½®é˜²ç«å¢™è§„åˆ™ uci add firewall rule uci set firewall.@rule[-1].name=\u0026#39;Allow-WAN-HTTP\u0026#39; uci set firewall.@rule[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@rule[-1].proto=\u0026#39;tcp\u0026#39; uci set firewall.@rule[-1].dest_port=\u0026#39;80\u0026#39; uci set firewall.@rule[-1].target=\u0026#39;ACCEPT\u0026#39; uci add firewall rule uci set firewall.@rule[-1].name=\u0026#39;Allow-WAN-HTTPS\u0026#39; uci set firewall.@rule[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@rule[-1].proto=\u0026#39;tcp\u0026#39; uci set firewall.@rule[-1].dest_port=\u0026#39;443\u0026#39; uci set firewall.@rule[-1].target=\u0026#39;ACCEPT\u0026#39; uci commit firewall ğŸ“Š ç›‘æ§ä¸æ—¥å¿— ç³»ç»Ÿç›‘æ§è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®‰è£…ç›‘æ§å·¥å…· opkg install \\ luci-app-statistics \\ collectd \\ collectd-mod-cpu \\ collectd-mod-memory \\ collectd-mod-interface # é…ç½®æ•°æ®æ”¶é›† uci set luci_statistics.collectd_interval=10 uci set luci_statistics.rrdtool=1 uci commit luci_statistics # å¯åŠ¨æœåŠ¡ /etc/init.d/collectd enable /etc/init.d/collectd start æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # é…ç½®æ—¥å¿—è½®è½¬ cat \u0026gt; /etc/logrotate.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; /var/log/messages /var/log/daemon.log /var/log/system.log { daily rotate 7 missingok notifempty compress delaycompress sharedscripts postrotate /etc/init.d/rsyslog reload \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || true endscript } EOF # åˆ›å»ºæ—¥å¿—æ¸…ç†è„šæœ¬ cat \u0026gt; /usr/bin/cleanlogs \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh find /var/log -name \u0026#34;*.log\u0026#34; -mtime +7 -delete find /var/log -name \u0026#34;*.gz\u0026#34; -mtime +30 -delete echo \u0026#34;æ—¥å¿—æ–‡ä»¶å·²æ¸…ç†\u0026#34; EOF chmod +x /usr/bin/cleanlogs âš ï¸ å…«ã€æ³¨æ„äº‹é¡¹ ğŸ”´ é‡è¦è­¦å‘Š ğŸ’¾ å¤‡ä»½æ•°æ®: åˆ·æœºå‰åŠ¡å¿…å¤‡ä»½åŸæœ‰é…ç½® 1 2 3 4 # å¤‡ä»½å½“å‰é…ç½® sysupgrade -b /tmp/backup.tar.gz # æˆ–è€…æ‰‹åŠ¨å¤‡ä»½ tar -czf /tmp/config-backup.tar.gz /etc/config/ ğŸ”Œ ç”µæºç¨³å®š: ç¡®ä¿åˆ·æœºè¿‡ç¨‹ä¸­ä¸æ–­ç”µ ä½¿ç”¨ UPS è®¾å¤‡ é¿å…åœ¨ç”µåŠ›ä¸ç¨³å®šæ—¶æ“ä½œ ğŸ“¶ ç½‘ç»œè¿æ¥: ç¼–è¯‘å’Œä¸‹è½½éœ€è¦ç¨³å®šç½‘ç»œ ä½¿ç”¨æœ‰çº¿è¿æ¥ å‡†å¤‡å¤‡ç”¨ç½‘ç»œ âš¡ å…¼å®¹æ€§: ç¡®è®¤ç¡¬ä»¶å…¼å®¹æ€§å†åˆ·æœº æ£€æŸ¥ç½‘å¡é©±åŠ¨æ”¯æŒ éªŒè¯å­˜å‚¨æ§åˆ¶å™¨å…¼å®¹æ€§ âœ… æœ€ä½³å®è·µ ğŸ§ª æµ‹è¯•ç¯å¢ƒ: å…ˆåœ¨è™šæ‹Ÿæœºæµ‹è¯•æ–°å›ºä»¶ 1 2 # ä½¿ç”¨ QEMU æµ‹è¯• qemu-system-x86_64 -m 512 -hda immortalwrt.img -nographic ğŸ“ è®°å½•é…ç½®: è®°å½•æ‰€æœ‰è‡ªå®šä¹‰é…ç½® 1 2 3 # å¯¼å‡ºå½“å‰é…ç½® uci show \u0026gt; /root/uci-config-backup.txt opkg list-installed \u0026gt; /root/packages-backup.txt â° ç»´æŠ¤çª—å£: åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œæ›´æ–° å®‰æ’å‘¨æœ«æˆ–å¤œé—´ç»´æŠ¤ æå‰é€šçŸ¥ç”¨æˆ· ğŸ”§ é€æ­¥æ›´æ–°: æ¯æ¬¡åªæ›´æ”¹ä¸€ä¸ªé…ç½®é¡¹æµ‹è¯• ä¿®æ”¹å‰å¤‡ä»½é…ç½® æµ‹è¯•åå†è¿›è¡Œä¸‹ä¸€ä¸ªä¿®æ”¹ ğŸ› å¸¸è§é—®é¢˜è§£å†³ å¯åŠ¨å¤±è´¥é—®é¢˜ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— dmesg | tail -50 logread -e error # æ¢å¤æ¨¡å¼ 1. ä»å¤‡ä»½é•œåƒå¯åŠ¨ 2. ä½¿ç”¨æ¢å¤æ§åˆ¶å° 3. é‡æ–°åˆ·å†™å›ºä»¶ ç½‘ç»œå¼‚å¸¸é—®é¢˜ 1 2 3 4 5 6 7 8 # è¯Šæ–­ç½‘ç»œé—®é¢˜ ifconfig route -n ping -c 4 8.8.8.8 # é‡ç½®ç½‘ç»œé…ç½® /etc/init.d/network restart rm -f /etc/config/network \u0026amp;\u0026amp; firstboot -y ç©ºé—´ä¸è¶³é—®é¢˜ 1 2 3 4 5 6 7 # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h du -sh /overlay/* # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -rf /tmp/* opkg clean è½¯ä»¶å†²çªé—®é¢˜ 1 2 3 4 5 # æ’æŸ¥å†²çªè½¯ä»¶ opkg list-installed | grep -E \u0026#39;(dns|vpn|proxy)\u0026#39; # å®‰å…¨ç§»é™¤å†²çªåŒ… opkg remove --force-removal-of-dependent-packages \u0026lt;package-name\u0026gt; ğŸ“‹ ç¼–è¯‘æ£€æŸ¥æ¸…å• ç¡®è®¤ç›®æ ‡å¹³å°å’Œç‰ˆæœ¬ é€‰æ‹©éœ€è¦çš„è½¯ä»¶åŒ… é…ç½®é¦–æ¬¡å¯åŠ¨è„šæœ¬ å‡†å¤‡æ‰©å®¹æ‰€éœ€å·¥å…· å¤‡ä»½åŸæœ‰ç³»ç»Ÿå’Œé…ç½® å®‰æ’åˆé€‚çš„ç»´æŠ¤æ—¶é—´ å‡†å¤‡æ¢å¤æ–¹æ¡ˆ é€šçŸ¥ç›¸å…³ç”¨æˆ· ğŸ”§ æ•…éšœæ¢å¤æ–¹æ¡ˆ å¿«é€Ÿæ¢å¤æ­¥éª¤ è¿æ¥ä¸²å£æ§åˆ¶å° è¿›å…¥æ¢å¤æ¨¡å¼ é‡æ–°åˆ·å†™å›ºä»¶ æ¢å¤é…ç½®æ–‡ä»¶ ç´§æ€¥æ¢å¤å·¥å…· 1 2 3 4 5 # å‡†å¤‡æ¢å¤é•œåƒ wget https://downloads.immortalwrt.org/releases/23.05.4/targets/x86/64/immortalwrt-23.05.4-x86-64-generic-ext4-combined.img.gz # åˆ›å»ºæ¢å¤Uç›˜ dd if=immortalwrt.img of=/dev/sdX bs=4M status=progress ğŸ’¡ ä¸“ä¸šæç¤º: å»ºè®®åœ¨æŠ•å…¥ç”Ÿäº§ç¯å¢ƒå‰ï¼Œå…ˆåœ¨æµ‹è¯•è®¾å¤‡ä¸Šå……åˆ†éªŒè¯æ–°å›ºä»¶çš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§ã€‚å®šæœŸæ£€æŸ¥ ImmortalWrt çš„æ›´æ–°ï¼ŒåŠæ—¶è·å–å®‰å…¨è¡¥ä¸å’ŒåŠŸèƒ½æ”¹è¿›ã€‚\nHappy Building! ğŸ‰ ç¥æ‚¨ç¼–è¯‘é¡ºåˆ©ï¼\nğŸ“š æ‰©å±•èµ„æº ImmortalWrt å®˜æ–¹æ–‡æ¡£ OpenWrt ç¼–è¯‘æŒ‡å— Linux ç½‘ç»œé…ç½® ç³»ç»Ÿä¼˜åŒ–æŠ€å·§ â“ å¸¸è§é—®é¢˜è§£ç­” Q: ç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ€ä¹ˆåŠï¼Ÿ A: æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸ç¼ºå°‘ä¾èµ–åŒ…æˆ–é…ç½®é”™è¯¯ã€‚å¯ä»¥å°è¯• make -j1 V=s æ¥è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚\nQ: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰è½¯ä»¶åŒ…ï¼Ÿ A: åœ¨ package/ ç›®å½•ä¸‹åˆ›å»ºè‡ªå®šä¹‰è½¯ä»¶åŒ…ç›®å½•ï¼Œç¼–å†™ Makefileï¼Œç„¶ååœ¨ make menuconfig ä¸­é€‰æ‹©ã€‚\nQ: å›ºä»¶å¤ªå¤§æ— æ³•å†™å…¥æ€ä¹ˆåŠï¼Ÿ A: ç§»é™¤ä¸å¿…è¦çš„è½¯ä»¶åŒ…ï¼Œæˆ–è€…ä½¿ç”¨ squashfs æ ¼å¼çš„å›ºä»¶ï¼Œå®ƒæ”¯æŒ overlay åˆ†åŒºæ‰©å±•ã€‚\nQ: å¦‚ä½•æ›´æ–° ImmortalWrt ç³»ç»Ÿï¼Ÿ A: ä½¿ç”¨ sysupgrade å‘½ä»¤ï¼šsysupgrade -n /path/to/new-firmware.bin\nQ: å¿˜è®° Luci å¯†ç æ€ä¹ˆåŠï¼Ÿ A: é€šè¿‡ SSH ç™»å½•åä½¿ç”¨ passwd å‘½ä»¤é‡ç½®å¯†ç ï¼Œæˆ–è€…ä½¿ç”¨æ¢å¤æ¨¡å¼é‡è®¾ã€‚\n","date":"2024-12-15T18:38:28+08:00","image":"https://file.meimolihan.eu.org/img/openwrt-01.webp","permalink":"https://blog.meimolihan.eu.org/p/90bce903/","title":"ImmortalWrt ç³»ç»Ÿç¼–è¯‘ä¸å®šåˆ¶ ğŸ”ï¸"},{"content":"Markdown å†…å®¹æŠ˜å å®Œå…¨æŒ‡å— ğŸ“ ğŸŒ æ‰©å±•ä½ çš„ Markdown æŠ€èƒ½ï¼š Markdown é«˜çº§æ•™ç¨‹ â€” æŒæ¡æ›´å¤šä¸“ä¸šæ’ç‰ˆæŠ€å·§ï¼\nğŸ“‹ æ–‡ç« ç›®å½• âœ¨ Markdown æŠ˜å åŠŸèƒ½æ¦‚è¿° ğŸ› ï¸ åŸºç¡€æŠ˜å è¯­æ³•è¯¦è§£ 1. æ ‡å‡†æŠ˜å è¯­æ³• 2. å¸¦ç©ºè¡Œçš„æŠ˜å è¯­æ³• ğŸ¨ é«˜çº§æŠ˜å æ ·å¼æŠ€å·§ 1. è‡ªå®šä¹‰æŠ˜å å›¾æ ‡ä¸æ ·å¼ 2. åµŒå¥—æŠ˜å ç»“æ„ 3. é»˜è®¤å±•å¼€çŠ¶æ€è®¾ç½® ğŸ’¡ å®ç”¨åœºæ™¯ç¤ºä¾‹ 1. ä»£ç ç¤ºä¾‹æŠ˜å  2. é—®ç­”å†…å®¹éšè— 3. æ•°æ®è¡¨æ ¼æŠ˜å  4. å¤šçº§ç›®å½•ç»“æ„ âš ï¸ å…¼å®¹æ€§ä¸æ³¨æ„äº‹é¡¹ 1. å¹³å°å…¼å®¹æ€§æŒ‡å— 2. ç§»åŠ¨ç«¯é€‚é…å»ºè®® 3. å¯è®¿é—®æ€§è€ƒè™‘ ğŸš€ æ‰©å±•èµ„æºä¸å·¥å…· 1. åœ¨çº¿å·¥å…·æ¨è 2. å­¦ä¹ èµ„æºé“¾æ¥ ğŸ”§ æ•…éšœæ’é™¤ä¸æŠ€å·§ 1. å¸¸è§é—®é¢˜è§£å†³ 2. æœ€ä½³å®è·µå»ºè®® âœ¨ Markdown æŠ˜å åŠŸèƒ½æ¦‚è¿° Markdown æŠ˜å åŠŸèƒ½é€šè¿‡ HTML çš„ \u0026lt;details\u0026gt; å’Œ \u0026lt;summary\u0026gt; æ ‡ç­¾å®ç°ï¼Œèƒ½å¤Ÿå°†å†…å®¹ç»„ç»‡æˆå¯äº¤äº’çš„æŠ˜å åŒºå—ï¼Œæå¤§æå‡æ–‡æ¡£çš„å¯è¯»æ€§å’Œç”¨æˆ·ä½“éªŒï¼ğŸ¯\nğŸŒŸ æŠ˜å åŠŸèƒ½çš„ä¼˜åŠ¿ï¼š ğŸ“š å†…å®¹å±‚æ¬¡æ¸…æ™°ï¼šå°†å¤æ‚ä¿¡æ¯åˆ†å±‚å±•ç¤ºï¼Œé¿å…ä¿¡æ¯è¿‡è½½ ğŸ” é˜…è¯»ä½“éªŒä¼˜åŒ–ï¼šè¯»è€…å¯ä»¥è‡ªä¸»é€‰æ‹©å…³æ³¨çš„å†…å®¹æ·±åº¦ ğŸ¯ é‡ç‚¹çªå‡ºï¼šéšè—è¾…åŠ©ä¿¡æ¯ï¼Œçªå‡ºæ ¸å¿ƒå†…å®¹ ğŸ“± ç©ºé—´é«˜æ•ˆåˆ©ç”¨ï¼šç‰¹åˆ«é€‚åˆç§»åŠ¨è®¾å¤‡ä¸Šçš„å†…å®¹æµè§ˆ ğŸš€ é€‚ç”¨åœºæ™¯ï¼š æŠ€æœ¯æ–‡æ¡£ï¼šéšè—å†—é•¿çš„ä»£ç ç¤ºä¾‹å’Œé…ç½®ç»†èŠ‚ æ•™å­¦ææ–™ï¼šé€æ­¥å±•ç¤ºç­”æ¡ˆå’Œè§£å†³æ–¹æ¡ˆ é¡¹ç›®æ–‡æ¡£ï¼šç»„ç»‡å¤šå±‚çº§çš„åŠŸèƒ½è¯´æ˜ å¸¸è§é—®é¢˜è§£ç­”ï¼šéšè—è¯¦ç»†è§£ç­”ï¼Œé¼“åŠ±å…ˆæ€è€ƒ æ•°æ®åˆ†ææŠ¥å‘Šï¼šæŠ˜å è¯¦ç»†æ•°æ®è¡¨æ ¼ï¼Œå±•ç¤ºæ‘˜è¦ ğŸ’¡ ä½ çŸ¥é“å—ï¼Ÿ æŠ˜å åŠŸèƒ½ä¸ä»…æ”¹å–„è§†è§‰ä½“éªŒï¼Œè¿˜èƒ½æ˜¾è‘—æé«˜é•¿æ–‡æ¡£çš„å¯¼èˆªæ•ˆç‡ï¼Œè®©è¯»è€…å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„å†…å®¹éƒ¨åˆ†ã€‚\nğŸ› ï¸ åŸºç¡€æŠ˜å è¯­æ³•è¯¦è§£ 1. æ ‡å‡†æŠ˜å è¯­æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; \u0026lt;font color=\u0026#34;#FFD700\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt; ğŸ“‚ ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹ (æ ‡å‡†è¯­æ³•) \u0026lt;/font\u0026gt; \u0026lt;/summary\u0026gt; è¿™é‡Œæ˜¯æŠ˜å çš„è¯¦ç»†å†…å®¹... æ”¯æŒå¤šæ®µè½æ–‡æœ¬ã€ä»£ç å—ã€å›¾ç‰‡ç­‰æ‰€æœ‰Markdownå…ƒç´ ã€‚ ```python # ç¤ºä¾‹ä»£ç  def example_function(): print(\u0026#34;Hello from folded content!\u0026#34;) ``` ![ç¤ºä¾‹å›¾ç‰‡](https://example.com/image.jpg) - åˆ—è¡¨é¡¹ç›® - å¦ä¸€ä¸ªåˆ—è¡¨é¡¹ç›® \u0026gt; å¼•ç”¨å†…å®¹ä¹Ÿå¯ä»¥æ”¾åœ¨æŠ˜å åŒºå—ä¸­ \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ“‚ ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹ (æ ‡å‡†è¯­æ³•) è¿™é‡Œæ˜¯æŠ˜å çš„è¯¦ç»†å†…å®¹\u0026hellip; æ”¯æŒå¤šæ®µè½æ–‡æœ¬ã€ä»£ç å—ã€å›¾ç‰‡ç­‰æ‰€æœ‰Markdownå…ƒç´ ã€‚\n1 2 3 # ç¤ºä¾‹ä»£ç  def example_function(): print(\u0026#34;Hello from folded content!\u0026#34;) åˆ—è¡¨é¡¹ç›® å¦ä¸€ä¸ªåˆ—è¡¨é¡¹ç›® å¼•ç”¨å†…å®¹ä¹Ÿå¯ä»¥æ”¾åœ¨æŠ˜å åŒºå—ä¸­\n2. å¸¦ç©ºè¡Œçš„æŠ˜å è¯­æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; \u0026lt;font color=\u0026#34;#FFD700\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt; ğŸ“‚ ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹ (å¸¦ç©ºè¡Œè¯­æ³•) \u0026lt;/font\u0026gt; \u0026lt;/summary\u0026gt; \u0026lt;!-- è¿™é‡Œå¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œ --\u0026gt; æŸäº›Markdownè§£æå™¨è¦æ±‚summaryæ ‡ç­¾ä¸å†…å®¹ä¹‹é—´æœ‰ç©ºè¡Œï¼Œ è¿™æ ·æ‰èƒ½æ­£ç¡®è§£ææŠ˜å åŒºå—å†…çš„Markdownå†…å®¹ã€‚ **åŠ ç²—æ–‡æœ¬**ã€*æ–œä½“* å’Œ `è¡Œå†…ä»£ç ` éƒ½èƒ½æ­£å¸¸æ¸²æŸ“ã€‚ 1. æœ‰åºåˆ—è¡¨ 2. ç¬¬äºŒä¸ªé¡¹ç›® \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ“‚ ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å†…å®¹ (å¸¦ç©ºè¡Œè¯­æ³•) æŸäº›Markdownè§£æå™¨è¦æ±‚summaryæ ‡ç­¾ä¸å†…å®¹ä¹‹é—´æœ‰ç©ºè¡Œï¼Œ è¿™æ ·æ‰èƒ½æ­£ç¡®è§£ææŠ˜å åŒºå—å†…çš„Markdownå†…å®¹ã€‚\nåŠ ç²—æ–‡æœ¬ã€æ–œä½“ å’Œ è¡Œå†…ä»£ç  éƒ½èƒ½æ­£å¸¸æ¸²æŸ“ã€‚\næœ‰åºåˆ—è¡¨ ç¬¬äºŒä¸ªé¡¹ç›® ğŸ¨ é«˜çº§æŠ˜å æ ·å¼æŠ€å·§ 1. è‡ªå®šä¹‰æŠ˜å å›¾æ ‡ä¸æ ·å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 ```html \u0026lt;!-- ä½¿ç”¨ä¸åŒå›¾æ ‡å’Œæ ·å¼ --\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; ğŸ” \u0026lt;strong\u0026gt;æŸ¥çœ‹è¯¦ç»†åˆ†æ\u0026lt;/strong\u0026gt; \u0026lt;em\u0026gt;(ç‚¹å‡»å±•å¼€)\u0026lt;/em\u0026gt; \u0026lt;/summary\u0026gt; è¯¦ç»†åˆ†æå†…å®¹åœ¨è¿™é‡Œ... \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; âš ï¸ \u0026lt;span style=\u0026#34;color: red;\u0026#34;\u0026gt;é‡è¦æç¤º\u0026lt;/span\u0026gt; \u0026lt;/summary\u0026gt; è¿™é‡Œæ˜¯é‡è¦çš„æç¤ºä¿¡æ¯... \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; ğŸ“Š \u0026lt;code\u0026gt;æ•°æ®æŠ¥å‘Š\u0026lt;/code\u0026gt; - æ›´æ–°æ—¶é—´: 2024-03-20 \u0026lt;/summary\u0026gt; æœ€æ–°æ•°æ®æŠ¥å‘Šå†…å®¹... \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ” æŸ¥çœ‹è¯¦ç»†åˆ†æ (ç‚¹å‡»å±•å¼€) è¯¦ç»†åˆ†æå†…å®¹åœ¨è¿™é‡Œ\u0026hellip;\nâš ï¸ é‡è¦æç¤º è¿™é‡Œæ˜¯é‡è¦çš„æç¤ºä¿¡æ¯\u0026hellip;\nğŸ“Š æ•°æ®æŠ¥å‘Š - æ›´æ–°æ—¶é—´: 2024-03-20 æœ€æ–°æ•°æ®æŠ¥å‘Šå†…å®¹\u0026hellip;\n2. åµŒå¥—æŠ˜å ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“ é¡¹ç›®æ–‡æ¡£\u0026lt;/summary\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“‚ å®‰è£…æŒ‡å—\u0026lt;/summary\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ”§ ç³»ç»Ÿè¦æ±‚\u0026lt;/summary\u0026gt; - æ“ä½œç³»ç»Ÿ: Windows 10+ - å†…å­˜: 8GB RAM - å­˜å‚¨: 10GB å¯ç”¨ç©ºé—´ \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;âš¡ å¿«é€Ÿå®‰è£…\u0026lt;/summary\u0026gt; ```bash npm install -g my-package ``` \u0026lt;/details\u0026gt; \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“‚ ä½¿ç”¨æ•™ç¨‹\u0026lt;/summary\u0026gt; ä½¿ç”¨æ•™ç¨‹å†…å®¹... \u0026lt;/details\u0026gt; \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ“ é¡¹ç›®æ–‡æ¡£ ğŸ“‚ å®‰è£…æŒ‡å— ğŸ”§ ç³»ç»Ÿè¦æ±‚ æ“ä½œç³»ç»Ÿ: Windows 10+ å†…å­˜: 8GB RAM å­˜å‚¨: 10GB å¯ç”¨ç©ºé—´ âš¡ å¿«é€Ÿå®‰è£… 1 npm install -g my-package ğŸ“‚ ä½¿ç”¨æ•™ç¨‹ ä½¿ç”¨æ•™ç¨‹å†…å®¹\u0026hellip;\n3. é»˜è®¤å±•å¼€çŠ¶æ€è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ```html \u0026lt;details open\u0026gt; \u0026lt;summary\u0026gt;ğŸ“– é»˜è®¤å±•å¼€çš„ç« èŠ‚\u0026lt;/summary\u0026gt; è¿™ä¸ªæŠ˜å åŒºå—é»˜è®¤æ˜¯å±•å¼€çŠ¶æ€çš„ï¼Œ é€‚åˆæ”¾ç½®é‡è¦æˆ–åŸºç¡€å†…å®¹ã€‚ \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“– é»˜è®¤æŠ˜å çš„ç« èŠ‚\u0026lt;/summary\u0026gt; è¿™ä¸ªæŠ˜å åŒºå—é»˜è®¤æ˜¯æŠ˜å çŠ¶æ€çš„ï¼Œ é€‚åˆæ”¾ç½®è¡¥å……æˆ–é«˜çº§å†…å®¹ã€‚ \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ“– é»˜è®¤å±•å¼€çš„ç« èŠ‚ è¿™ä¸ªæŠ˜å åŒºå—é»˜è®¤æ˜¯å±•å¼€çŠ¶æ€çš„ï¼Œ é€‚åˆæ”¾ç½®é‡è¦æˆ–åŸºç¡€å†…å®¹ã€‚\nğŸ“– é»˜è®¤æŠ˜å çš„ç« èŠ‚ è¿™ä¸ªæŠ˜å åŒºå—é»˜è®¤æ˜¯æŠ˜å çŠ¶æ€çš„ï¼Œ é€‚åˆæ”¾ç½®è¡¥å……æˆ–é«˜çº§å†…å®¹ã€‚\nğŸ’¡ å®ç”¨åœºæ™¯ç¤ºä¾‹ 1. ä»£ç ç¤ºä¾‹æŠ˜å  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; \u0026lt;font color=\u0026#34;#007ACC\u0026#34;\u0026gt;ğŸ Python ç¤ºä¾‹ä»£ç \u0026lt;/font\u0026gt; \u0026lt;/summary\u0026gt; ```python def fibonacci(n): \u0026#34;\u0026#34;\u0026#34; ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—å‰né¡¹ \u0026#34;\u0026#34;\u0026#34; a, b = 0, 1 result = [] for _ in range(n): result.append(a) a, b = b, a + b return result # ä½¿ç”¨ç¤ºä¾‹ if __name__ == \u0026#34;__main__\u0026#34;: print(fibonacci(10)) # è¾“å‡º: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34] ``` **è¯´æ˜**: è¿™ä¸ªå‡½æ•°ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‰nä¸ªæ•°å­—ã€‚ \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ Python ç¤ºä¾‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 def fibonacci(n): \u0026#34;\u0026#34;\u0026#34; ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—å‰né¡¹ \u0026#34;\u0026#34;\u0026#34; a, b = 0, 1 result = [] for _ in range(n): result.append(a) a, b = b, a + b return result # ä½¿ç”¨ç¤ºä¾‹ if __name__ == \u0026#34;__main__\u0026#34;: print(fibonacci(10)) # è¾“å‡º: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34] è¯´æ˜: è¿™ä¸ªå‡½æ•°ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‰nä¸ªæ•°å­—ã€‚\n2. é—®ç­”å†…å®¹éšè— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; â“ é—®é¢˜: Markdown çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ \u0026lt;/summary\u0026gt; âœ… **ç­”æ¡ˆ**: Markdown å…·æœ‰ä»¥ä¸‹ä¸»è¦ä¼˜ç‚¹ï¼š - **æ˜“è¯»æ˜“å†™**: è¯­æ³•ç®€å•ç›´è§‚ï¼Œçº¯æ–‡æœ¬æ ¼å¼ - **è·¨å¹³å°å…¼å®¹**: å‡ ä¹æ‰€æœ‰å¹³å°éƒ½æ”¯æŒ - **çµæ´»è½¬æ¢**: å¯ä»¥è½¬æ¢ä¸º HTMLã€PDF ç­‰å¤šç§æ ¼å¼ - **ç‰ˆæœ¬å‹å¥½**: çº¯æ–‡æœ¬æ ¼å¼é€‚åˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ - **ç¤¾åŒºæ”¯æŒ**: æ‹¥æœ‰åºå¤§çš„ç”¨æˆ·ç¤¾åŒºå’Œä¸°å¯Œçš„å·¥å…·ç”Ÿæ€ \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; â“ é—®é¢˜: å¦‚ä½•åœ¨ Markdown ä¸­åˆ›å»ºè¡¨æ ¼ï¼Ÿ \u0026lt;/summary\u0026gt; âœ… **ç­”æ¡ˆ**: ä½¿ç”¨ä»¥ä¸‹è¯­æ³•åˆ›å»ºè¡¨æ ¼ï¼š ```markdown | æ ‡é¢˜1 | æ ‡é¢˜2 | æ ‡é¢˜3 | |-------|-------|-------| | å•å…ƒæ ¼ | å•å…ƒæ ¼ | å•å…ƒæ ¼ | | å•å…ƒæ ¼ | å•å…ƒæ ¼ | å•å…ƒæ ¼ | ``` \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nâ“ é—®é¢˜: Markdown çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ âœ… ç­”æ¡ˆ: Markdown å…·æœ‰ä»¥ä¸‹ä¸»è¦ä¼˜ç‚¹ï¼š\næ˜“è¯»æ˜“å†™: è¯­æ³•ç®€å•ç›´è§‚ï¼Œçº¯æ–‡æœ¬æ ¼å¼ è·¨å¹³å°å…¼å®¹: å‡ ä¹æ‰€æœ‰å¹³å°éƒ½æ”¯æŒ çµæ´»è½¬æ¢: å¯ä»¥è½¬æ¢ä¸º HTMLã€PDF ç­‰å¤šç§æ ¼å¼ ç‰ˆæœ¬å‹å¥½: çº¯æ–‡æœ¬æ ¼å¼é€‚åˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ ç¤¾åŒºæ”¯æŒ: æ‹¥æœ‰åºå¤§çš„ç”¨æˆ·ç¤¾åŒºå’Œä¸°å¯Œçš„å·¥å…·ç”Ÿæ€ â“ é—®é¢˜: å¦‚ä½•åœ¨ Markdown ä¸­åˆ›å»ºè¡¨æ ¼ï¼Ÿ âœ… ç­”æ¡ˆ: ä½¿ç”¨ä»¥ä¸‹è¯­æ³•åˆ›å»ºè¡¨æ ¼ï¼š\n1 2 3 4 | æ ‡é¢˜1 | æ ‡é¢˜2 | æ ‡é¢˜3 | |-------|-------|-------| | å•å…ƒæ ¼ | å•å…ƒæ ¼ | å•å…ƒæ ¼ | | å•å…ƒæ ¼ | å•å…ƒæ ¼ | å•å…ƒæ ¼ | 3. æ•°æ®è¡¨æ ¼æŠ˜å  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt; ğŸ“Š 2024å¹´ç¬¬ä¸€å­£åº¦é”€å”®æ•°æ® (ç‚¹å‡»å±•å¼€) \u0026lt;/summary\u0026gt; | äº§å“ç±»åˆ« | ä¸€æœˆé”€å”®é¢ | äºŒæœˆé”€å”®é¢ | ä¸‰æœˆé”€å”®é¢ | å­£åº¦æ€»è®¡ | |----------|------------|------------|------------|----------| | ç”µå­äº§å“ | $12,345 | $15,678 | $18,901 | $46,924 | | æœè£…é…é¥° | $8,901 | $9,876 | $10,123 | $28,900 | | å®¶å±…ç”¨å“ | $5,432 | $6,789 | $7,123 | $19,344 | | é£Ÿå“é¥®æ–™ | $15,678 | $16,789 | $17,890 | $50,357 | **æ€»ç»“**: ç¬¬ä¸€å­£åº¦æ€»é”€å”®é¢ä¸º $145,525ï¼ŒåŒæ¯”å¢é•¿ 12.3%ã€‚ \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ“Š 2024å¹´ç¬¬ä¸€å­£åº¦é”€å”®æ•°æ® (ç‚¹å‡»å±•å¼€) äº§å“ç±»åˆ« ä¸€æœˆé”€å”®é¢ äºŒæœˆé”€å”®é¢ ä¸‰æœˆé”€å”®é¢ å­£åº¦æ€»è®¡ ç”µå­äº§å“ $12,345 $15,678 $18,901 $46,924 æœè£…é…é¥° $8,901 $9,876 $10,123 $28,900 å®¶å±…ç”¨å“ $5,432 $6,789 $7,123 $19,344 é£Ÿå“é¥®æ–™ $15,678 $16,789 $17,890 $50,357 æ€»ç»“: ç¬¬ä¸€å­£åº¦æ€»é”€å”®é¢ä¸º $145,525ï¼ŒåŒæ¯”å¢é•¿ 12.3%ã€‚\n4. å¤šçº§ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 ```html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“ é¡¹ç›®æ–‡æ¡£ç›®å½•\u0026lt;/summary\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“‚ 1. ä»‹ç»\u0026lt;/summary\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“„ 1.1 é¡¹ç›®æ¦‚è¿°\u0026lt;/summary\u0026gt; é¡¹ç›®æ¦‚è¿°å†…å®¹... \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“„ 1.2 åŠŸèƒ½ç‰¹æ€§\u0026lt;/summary\u0026gt; åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨... \u0026lt;/details\u0026gt; \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“‚ 2. å®‰è£…æŒ‡å—\u0026lt;/summary\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“„ 2.1 ç³»ç»Ÿè¦æ±‚\u0026lt;/summary\u0026gt; ç³»ç»Ÿè¦æ±‚è¯¦æƒ…... \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“„ 2.2 å®‰è£…æ­¥éª¤\u0026lt;/summary\u0026gt; å®‰è£…æ­¥éª¤è¯´æ˜... \u0026lt;/details\u0026gt; \u0026lt;/details\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“‚ 3. ä½¿ç”¨æ•™ç¨‹\u0026lt;/summary\u0026gt; ä½¿ç”¨æ•™ç¨‹å†…å®¹... \u0026lt;/details\u0026gt; \u0026lt;/details\u0026gt; ``` æ¸²æŸ“æ•ˆæœï¼š\nğŸ“ é¡¹ç›®æ–‡æ¡£ç›®å½• ğŸ“‚ 1. ä»‹ç» ğŸ“„ 1.1 é¡¹ç›®æ¦‚è¿° é¡¹ç›®æ¦‚è¿°å†…å®¹\u0026hellip;\nğŸ“„ 1.2 åŠŸèƒ½ç‰¹æ€§ åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨\u0026hellip;\nğŸ“‚ 2. å®‰è£…æŒ‡å— ğŸ“„ 2.1 ç³»ç»Ÿè¦æ±‚ ç³»ç»Ÿè¦æ±‚è¯¦æƒ…\u0026hellip;\nğŸ“„ 2.2 å®‰è£…æ­¥éª¤ å®‰è£…æ­¥éª¤è¯´æ˜\u0026hellip;\nğŸ“‚ 3. ä½¿ç”¨æ•™ç¨‹ ä½¿ç”¨æ•™ç¨‹å†…å®¹\u0026hellip;\nâš ï¸ å…¼å®¹æ€§ä¸æ³¨æ„äº‹é¡¹ 1. å¹³å°å…¼å®¹æ€§æŒ‡å— å¹³å° æ”¯æŒæƒ…å†µ å¤‡æ³¨ GitHub âœ… å®Œå…¨æ”¯æŒ æ¨èä½¿ç”¨ GitLab âœ… å®Œå…¨æ”¯æŒ æ¨èä½¿ç”¨ Bitbucket âœ… å®Œå…¨æ”¯æŒ æ¨èä½¿ç”¨ VS Code âœ… å®Œå…¨æ”¯æŒ é¢„è§ˆæ¨¡å¼å¯ç”¨ Typora âœ… å®Œå…¨æ”¯æŒ å®æ—¶é¢„è§ˆ å¤šæ•°é™æ€ç½‘ç«™ç”Ÿæˆå™¨ âœ… æ”¯æŒ Hugo, Jekyll ç­‰ å¾®ä¿¡å…¬ä¼—å¹³å° âŒ ä¸æ”¯æŒ ä¼šè¿‡æ»¤ HTML æ ‡ç­¾ æŸäº›è®ºå›å¹³å° âš ï¸ éƒ¨åˆ†æ”¯æŒ éœ€è¦æµ‹è¯• 2. ç§»åŠ¨ç«¯é€‚é…å»ºè®® è§¦æ‘¸ç›®æ ‡å¤§å°ï¼šç¡®ä¿æ‘˜è¦åŒºåŸŸè¶³å¤Ÿå¤§ï¼Œä¾¿äºæ‰‹æŒ‡ç‚¹å‡» å†…å®¹é•¿åº¦ï¼šç§»åŠ¨ç«¯é¿å…è¿‡é•¿çš„æŠ˜å å†…å®¹ï¼Œè€ƒè™‘åˆ†é¡µ æ€§èƒ½è€ƒè™‘ï¼šé¿å…åµŒå¥—è¿‡å¤šå±‚çº§ï¼Œå½±å“ç§»åŠ¨è®¾å¤‡æ€§èƒ½ æµ‹è¯•éªŒè¯ï¼šåœ¨å¤šç§ç§»åŠ¨è®¾å¤‡å’Œæµè§ˆå™¨ä¸Šæµ‹è¯•æ•ˆæœ 3. å¯è®¿é—®æ€§è€ƒè™‘ é”®ç›˜å¯¼èˆªï¼šç¡®ä¿å¯ä»¥ä½¿ç”¨ Tab é”®å’Œ Enter é”®æ“ä½œæŠ˜å é¢æ¿ å±å¹•é˜…è¯»å™¨ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„æ‘˜è¦æ–‡æœ¬ï¼Œæ–¹ä¾¿å±å¹•é˜…è¯»å™¨ç”¨æˆ· ARIA å±æ€§ï¼šå¯ä»¥æ·»åŠ  ARIA å±æ€§å¢å¼ºå¯è®¿é—®æ€§ 1 2 3 4 \u0026lt;details aria-expanded=\u0026#34;false\u0026#34;\u0026gt; \u0026lt;summary role=\u0026#34;button\u0026#34; tabindex=\u0026#34;0\u0026#34;\u0026gt;ç« èŠ‚æ ‡é¢˜\u0026lt;/summary\u0026gt; å†…å®¹... \u0026lt;/details\u0026gt; ğŸš€ æ‰©å±•èµ„æºä¸å·¥å…· 1. åœ¨çº¿å·¥å…·æ¨è Markdown Live Preview - å®æ—¶é¢„è§ˆ Markdown æ•ˆæœ HTML to Markdown Converter - HTML è½¬ Markdown å·¥å…· Table Generator - Markdown è¡¨æ ¼ç”Ÿæˆå™¨ Markdown Cheat Sheet - é€ŸæŸ¥è¡¨ 2. å­¦ä¹ èµ„æºé“¾æ¥ Official Markdown Guide - å®˜æ–¹æŒ‡å— GitHub Markdown Documentation - GitHub æ–‡æ¡£ Advanced Markdown Techniques - é«˜çº§æŠ€å·§ Markdown Tutorial Interactive - äº¤äº’å¼æ•™ç¨‹ ğŸ”§ æ•…éšœæ’é™¤ä¸æŠ€å·§ 1. å¸¸è§é—®é¢˜è§£å†³ é—®é¢˜ï¼šæŠ˜å å†…å®¹ä¸æ˜¾ç¤º\næ£€æŸ¥æ˜¯å¦ç¼ºå°‘ç©ºè¡Œï¼ˆæŸäº›è§£æå™¨è¦æ±‚ summary åæœ‰ç©ºè¡Œï¼‰ éªŒè¯ HTML æ ‡ç­¾æ˜¯å¦æ­£ç¡®é—­åˆ é—®é¢˜ï¼šMarkdown åœ¨æŠ˜å åŒºå—å†…ä¸è§£æ\nç¡®ä¿ summary æ ‡ç­¾å’Œå†…å®¹ä¹‹é—´æœ‰ç©ºç™½è¡Œ å°è¯•ä½¿ç”¨æ›´ç®€å•çš„ Markdown è¯­æ³• é—®é¢˜ï¼šåµŒå¥—æŠ˜å ä¸æ­£å¸¸å·¥ä½œ\nå‡å°‘åµŒå¥—å±‚çº§ï¼ˆä¸€èˆ¬å»ºè®®ä¸è¶…è¿‡3å±‚ï¼‰ æ£€æŸ¥æ ‡ç­¾æ˜¯å¦æ­£ç¡®åµŒå¥—å’Œé—­åˆ 2. æœ€ä½³å®è·µå»ºè®® é€‚åº¦ä½¿ç”¨ï¼šä¸è¦è¿‡åº¦ä½¿ç”¨æŠ˜å åŠŸèƒ½ï¼Œé¿å…å½±å“é˜…è¯»æµç•…æ€§ æ˜ç¡®æ ‡è¯†ï¼šåœ¨æ‘˜è¦ä¸­æ¸…æ™°è¯´æ˜æŠ˜å å†…å®¹æ˜¯ä»€ä¹ˆ ä¿æŒç®€æ´ï¼šæ‘˜è¦æ–‡æœ¬åº”è¯¥ç®€çŸ­æ˜äº† æµ‹è¯•å…¼å®¹æ€§ï¼šåœ¨ç›®æ ‡å¹³å°ä¸Šæµ‹è¯•æŠ˜å æ•ˆæœ æä¾›å¤‡é€‰ï¼šå¯¹äºé‡è¦å†…å®¹ï¼Œè€ƒè™‘æä¾›éæŠ˜å ç‰ˆæœ¬ è¯­ä¹‰åŒ–ä½¿ç”¨ï¼šæ ¹æ®å†…å®¹é‡è¦æ€§å†³å®šæ˜¯å¦ä½¿ç”¨æŠ˜å  1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!-- å¥½çš„å®è·µ --\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ğŸ“Š ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ•°æ®è¡¨æ ¼\u0026lt;/summary\u0026gt; è¡¨æ ¼å†…å®¹... \u0026lt;/details\u0026gt; \u0026lt;!-- éœ€è¦æ”¹è¿›çš„å®è·µ --\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ç‚¹å‡»è¿™é‡Œ\u0026lt;/summary\u0026gt; é‡è¦å†…å®¹... \u0026lt;/details\u0026gt; ğŸ‰ æ€»ç»“ï¼šé€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²ç»å…¨é¢æŒæ¡äº† Markdown æŠ˜å åŠŸèƒ½çš„å„ä¸ªæ–¹é¢ã€‚ä»åŸºç¡€è¯­æ³•åˆ°é«˜çº§æŠ€å·§ï¼Œä»å®ç”¨ç¤ºä¾‹åˆ°å…¼å®¹æ€§è€ƒè™‘ï¼Œè¿™äº›çŸ¥è¯†å°†å¸®åŠ©ä½ åˆ›å»ºæ›´åŠ ä¸“ä¸šå’Œç”¨æˆ·å‹å¥½çš„æ–‡æ¡£ã€‚\nğŸ› ï¸ å®è·µå»ºè®®ï¼š\nä»ç®€å•çš„æŠ˜å å¼€å§‹ï¼Œé€æ­¥å°è¯•æ›´å¤æ‚çš„åµŒå¥—ç»“æ„ åœ¨ä¸åŒå¹³å°ä¸Šæµ‹è¯•ä½ çš„æŠ˜å å†…å®¹ å…³æ³¨å¯è®¿é—®æ€§ï¼Œç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è‰¯å¥½ä½“éªŒ æ ¹æ®å†…å®¹çš„é‡è¦æ€§å’Œå¤æ‚ç¨‹åº¦å†³å®šæ˜¯å¦ä½¿ç”¨æŠ˜å  ğŸ’ª ç°åœ¨å°±å¼€å§‹ä½¿ç”¨è¿™äº›æŠ€å·§ï¼Œè®©ä½ çš„ Markdown æ–‡æ¡£æ›´åŠ ç»“æ„æ¸…æ™°ã€äº¤äº’å‹å¥½å§ï¼\n","date":"2024-12-14T19:56:34+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3e3ebdf6/","title":"Markdown å†…å®¹æŠ˜å æŠ€å·§æŒ‡å— ğŸ“"},{"content":"Markdown ä¸‹åˆ’çº¿æ ·å¼å®Œå…¨æŒ‡å— ğŸ“ ğŸ”– æ‰©å±•ä½ çš„ Markdown æŠ€èƒ½ï¼š Markdown é«˜çº§æ•™ç¨‹ â€” æ¢ç´¢æ›´å¤š Markdown éšè—åŠŸèƒ½ï¼\nğŸ“‹ æ–‡ç« ç›®å½• ğŸ¨ Markdown ä¸‹åˆ’çº¿æ ·å¼æ¦‚è§ˆ ğŸ“ åŸºç¡€ä¸‹åˆ’çº¿æ ·å¼ 1. ä¸‹åˆ’è™šçº¿æ ·å¼ 2. å•å®çº¿ä¸‹åˆ’çº¿ 3. åŒä¸‹åˆ’çº¿æ ·å¼ 4. ç‚¹çŠ¶ä¸‹åˆ’çº¿ 5. ç€é‡å·æ ·å¼ âœ¨ é«˜çº§åˆ›æ„æ ·å¼ 1. æ³¢æµªä¸‹åˆ’çº¿ 2. æ¸å˜è‰²ä¸‹åˆ’çº¿ 3. åŠ¨ç”»ä¸‹åˆ’çº¿ ğŸ¯ å®ç”¨æŠ€å·§ä¸é…ç½® 1. é¢œè‰²é€‰æ‹©æŒ‡å— 2. çº¿å‹æ ·å¼å¤§å…¨ 3. å°ºå¯¸æ§åˆ¶æŠ€å·§ âš ï¸ å…¼å®¹æ€§æ³¨æ„äº‹é¡¹ ğŸ” æµè§ˆå™¨æ”¯æŒæƒ…å†µ ğŸ’¡ æœ€ä½³å®è·µå»ºè®® ğŸ¨ Markdown ä¸‹åˆ’çº¿æ ·å¼æ¦‚è§ˆ è™½ç„¶æ ‡å‡†çš„ Markdown è¯­æ³•æœ¬èº«ä¸ç›´æ¥æ”¯æŒä¸°å¯Œæ–‡æœ¬æ ·å¼ï¼Œä½†é€šè¿‡ç»“åˆ HTML å’Œ CSSï¼Œæˆ‘ä»¬å¯ä»¥ä¸º Markdown æ–‡æ¡£æ·»åŠ å„ç§ç²¾ç¾çš„ä¸‹åˆ’çº¿æ•ˆæœï¼âœ¨ è¿™äº›æŠ€å·§ç‰¹åˆ«é€‚ç”¨äºï¼š\nğŸ” çªå‡ºæ˜¾ç¤ºé‡è¦å†…å®¹ ğŸ¯ è§†è§‰å¼•å¯¼è¯»è€…æ³¨æ„åŠ› ğŸ“š åˆ›å»ºæŠ€æœ¯æ–‡æ¡£å’Œæ•™ç¨‹ âœ¨ å¢å¼ºæ–‡æ¡£çš„è§†è§‰å¸å¼•åŠ› ğŸ’¡ ä½ çŸ¥é“å—ï¼Ÿ åœ¨ä¼ ç»Ÿçš„æ’ç‰ˆä¸­ï¼Œä¸‹åˆ’çº¿æœ€åˆæ˜¯ä¸ºäº†æŒ‡ç¤ºå°åˆ·å·¥äººæ·»åŠ æ–œä½“è€Œå‘æ˜çš„ï¼Œåæ¥æ¼”å˜ä¸ºå¼ºè°ƒæ–‡å­—çš„é‡è¦æ–¹å¼ã€‚\nğŸ“ åŸºç¡€ä¸‹åˆ’çº¿æ ·å¼ 1. ä¸‹åˆ’è™šçº¿æ ·å¼ 1 \u0026lt;span style=\u0026#34;border-bottom: 2px dashed red;\u0026#34;\u0026gt;ä¸‹åˆ’è™šçº¿æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š ä¸‹åˆ’è™šçº¿ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nè¡¨ç¤ºå¯é€‰æˆ–éå¼ºåˆ¶å†…å®¹ æ ‡æ³¨éœ€è¦è¡¥å……çš„ä¿¡æ¯ åˆ›å»ºè½»æ¾ã€éæ­£å¼çš„å¼ºè°ƒæ•ˆæœ 2. å•å®çº¿ä¸‹åˆ’çº¿ 1 \u0026lt;span style=\u0026#34;border-bottom: 1px solid red;\u0026#34;\u0026gt;å•ä¸‹åˆ’çº¿æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š å•ä¸‹åˆ’çº¿ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nä¼ ç»Ÿçš„æ–‡å­—å¼ºè°ƒ è¶…é“¾æ¥çš„æ›¿ä»£æ ·å¼ éœ€è¦ç®€æ´å¼ºè°ƒçš„åœºåˆ 3. åŒä¸‹åˆ’çº¿æ ·å¼ 1 \u0026lt;span style=\u0026#34;border-bottom: thick double #32a1ce;\u0026#34;\u0026gt;åŒä¸‹åˆ’çº¿æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š åŒä¸‹åˆ’çº¿ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nè¡¨ç¤ºéå¸¸é‡è¦æˆ–å…³é”®çš„å†…å®¹ æ³•å¾‹æ–‡æ¡£ä¸­çš„ç‰¹å®šæœ¯è¯­ éœ€è¦å¼ºçƒˆè§†è§‰å¼ºè°ƒçš„æƒ…å†µ 4. ç‚¹çŠ¶ä¸‹åˆ’çº¿ 1 \u0026lt;span style=\u0026#34;border-bottom: 2px dotted red;\u0026#34;\u0026gt;ç‚¹çŠ¶ä¸‹åˆ’çº¿æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š ç‚¹çŠ¶ä¸‹åˆ’çº¿ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nè¡¨ç¤ºæ¦‚å¿µæˆ–æœ¯è¯­çš„å®šä¹‰ æ ‡æ³¨éœ€è¦è§£é‡Šçš„å†…å®¹ åˆ›å»ºä¼˜é›…çš„è£…é¥°æ•ˆæœ 5. ç€é‡å·æ ·å¼ 1 \u0026lt;span style=\u0026#34;border-bottom: 8px dotted red;\u0026#34;\u0026gt;ç€é‡å·æ ·å¼æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š ç€é‡å·æ ·å¼ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nç‰¹åˆ«é‡è¦çš„è­¦å‘Šæˆ–æç¤º éœ€è¦å¼ºçƒˆè§†è§‰å†²å‡»çš„å†…å®¹ æ ‡é¢˜æˆ–ç« èŠ‚çš„é‡ç‚¹æ ‡æ³¨ âœ¨ é«˜çº§åˆ›æ„æ ·å¼ 1. æ³¢æµªä¸‹åˆ’çº¿ 1 \u0026lt;span style=\u0026#34;border-bottom: 2px wavy blue;\u0026#34;\u0026gt;æ³¢æµªä¸‹åˆ’çº¿æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š æ³¢æµªä¸‹åˆ’çº¿ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nè¡¨ç¤ºå¹½é»˜æˆ–è½»æ¾çš„è¯­æ°” æ ‡æ³¨æ‹¼å†™é”™è¯¯æˆ–ä¿®æ”¹å»ºè®® æ·»åŠ è¶£å‘³æ€§çš„è§†è§‰å…ƒç´  2. æ¸å˜è‰²ä¸‹åˆ’çº¿ 1 \u0026lt;span style=\u0026#34;border-bottom: 3px solid; border-image: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet) 1;\u0026#34;\u0026gt;æ¸å˜è‰²ä¸‹åˆ’çº¿æ–‡æœ¬\u0026lt;/span\u0026gt; æ¸²æŸ“æ•ˆæœï¼š æ¸å˜è‰²ä¸‹åˆ’çº¿ç¤ºä¾‹æ–‡æœ¬\né€‚ç”¨åœºæ™¯ï¼š\nè®¾è®¡æ„Ÿå¼ºçš„æ ‡é¢˜å’Œæ ‡è¯­ å½©è™¹ä¸»é¢˜æˆ–å¤šå…ƒæ–‡åŒ–å†…å®¹ éœ€è¦çªå‡ºåˆ›æ„å’Œè§†è§‰å¸å¼•åŠ›çš„åœºåˆ 3. åŠ¨ç”»ä¸‹åˆ’çº¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;span class=\u0026#34;animated-underline\u0026#34;\u0026gt;æ‚¬åœæŸ¥çœ‹åŠ¨ç”»ä¸‹åˆ’çº¿æ•ˆæœ\u0026lt;/span\u0026gt; \u0026lt;style\u0026gt; .animated-underline { position: relative; display: inline-block; cursor: pointer; } .animated-underline::after { content: \u0026#39;\u0026#39;; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background: red; transition: width 0.3s ease; } .animated-underline:hover::after { width: 100%; } \u0026lt;/style\u0026gt; æ¸²æŸ“æ•ˆæœï¼š æ‚¬åœæŸ¥çœ‹åŠ¨ç”»ä¸‹åˆ’çº¿æ•ˆæœ\né€‚ç”¨åœºæ™¯ï¼š\näº¤äº’å¼æ•™ç¨‹å’Œæ–‡æ¡£ ç½‘ç«™å¯¼èˆªå’ŒæŒ‰é’®æ•ˆæœ éœ€è¦ç°ä»£æ„Ÿäº¤äº’è®¾è®¡çš„åœºåˆ ğŸ¯ å®ç”¨æŠ€å·§ä¸é…ç½® 1. é¢œè‰²é€‰æ‹©æŒ‡å— ğŸ¨ é¢œè‰²è¡¨ç¤ºæ–¹æ³•ä¸‰ç§æ–¹å¼ï¼š\n1 2 3 4 5 6 7 8 9 \u0026lt;!-- é¢œè‰²åç§° --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 2px solid red;\u0026#34;\u0026gt;çº¢è‰²ä¸‹åˆ’çº¿\u0026lt;/span\u0026gt; \u0026lt;!-- åå…­è¿›åˆ¶ --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 2px solid #ff0000;\u0026#34;\u0026gt;åå…­è¿›åˆ¶çº¢è‰²\u0026lt;/span\u0026gt; \u0026lt;!-- RGB/RGBA --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 2px solid rgb(255, 0, 0);\u0026#34;\u0026gt;RGBçº¢è‰²\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 2px solid rgba(255, 0, 0, 0.5);\u0026#34;\u0026gt;åŠé€æ˜çº¢è‰²\u0026lt;/span\u0026gt; 2. çº¿å‹æ ·å¼å¤§å…¨ æ ·å¼ ä»£ç  æ•ˆæœ å®çº¿ solid â€”â€”â€”â€” è™šçº¿ dashed - - - - ç‚¹çº¿ dotted Â·Â·Â·Â· åŒçº¿ double ======== å‡¹æ§½ groove 3Då‡¹é™·æ•ˆæœ å„çŠ¶ ridge 3Då‡¸èµ·æ•ˆæœ å†…åµŒ inset å†…åµŒ3Dæ•ˆæœ å¤–åµŒ outset å¤–å‡¸3Dæ•ˆæœ 3. å°ºå¯¸æ§åˆ¶æŠ€å·§ 1 2 3 4 5 6 7 8 \u0026lt;!-- åƒç´ å•ä½ --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 1px solid black;\u0026#34;\u0026gt;ç»†çº¿\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 3px solid black;\u0026#34;\u0026gt;ç²—çº¿\u0026lt;/span\u0026gt; \u0026lt;!-- ç›¸å¯¹å•ä½ --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: thin solid black;\u0026#34;\u0026gt;ç»†çº¿\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: medium solid black;\u0026#34;\u0026gt;ä¸­çº¿\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: thick solid black;\u0026#34;\u0026gt;ç²—çº¿\u0026lt;/span\u0026gt; âš ï¸ å…¼å®¹æ€§æ³¨æ„äº‹é¡¹ å¹³å°é™åˆ¶\nGitHub ç­‰å¹³å°ä¼šè¿‡æ»¤è‡ªå®šä¹‰ CSS æŸäº› Markdown è§£æå™¨ä¸æ”¯æŒ HTML ç§»åŠ¨ç«¯åº”ç”¨å¯èƒ½æ¸²æŸ“ä¸ä¸€è‡´ å¤‡ç”¨æ–¹æ¡ˆ\n1 2 3 \u0026lt;!-- æä¾›é™çº§æ–¹æ¡ˆ --\u0026gt; **é‡è¦å†…å®¹** \u0026lt;!-- åŒæ—¶ä½¿ç”¨ç²—ä½“ä½œä¸ºå¤‡ç”¨ --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 1px solid red;\u0026#34;\u0026gt;é‡è¦å†…å®¹\u0026lt;/span\u0026gt; æµ‹è¯•å»ºè®®\nåœ¨ç›®æ ‡å¹³å°ä¸Šæµ‹è¯•æ¸²æŸ“æ•ˆæœ å‡†å¤‡ä¸ä½¿ç”¨æ ·å¼çš„çº¯æ–‡æœ¬ç‰ˆæœ¬ è€ƒè™‘ä½¿ç”¨å¹³å°åŸç”Ÿå¼ºè°ƒæ–¹å¼ä½œä¸ºæ›¿ä»£ ğŸ” æµè§ˆå™¨æ”¯æŒæƒ…å†µ ç‰¹æ€§ Chrome Firefox Safari Edge åŸºç¡€è¾¹æ¡†æ ·å¼ âœ… âœ… âœ… âœ… æ¸å˜è‰²è¾¹æ¡† âœ… âœ… âœ… âœ… æ³¢æµªçº¿æ ·å¼ âœ… âœ… âœ… âœ… CSS åŠ¨ç”» âœ… âœ… âœ… âœ… RGBa é¢œè‰² âœ… âœ… âœ… âœ… ğŸ’¡ æç¤ºï¼šå¯¹äºä¼ä¸šç¯å¢ƒï¼Œè€ƒè™‘ç”¨æˆ·å¯èƒ½ä½¿ç”¨æ—§ç‰ˆæµè§ˆå™¨ï¼Œå»ºè®®æä¾›é™çº§æ–¹æ¡ˆã€‚\nğŸ’¡ æœ€ä½³å®è·µå»ºè®® âœ… è¿™æ ·åšï¼š 1 2 3 4 5 6 7 8 \u0026lt;!-- è¯­ä¹‰åŒ–ä½¿ç”¨ --\u0026gt; \u0026lt;span style=\u0026#34;border-bottom: 1px dotted #666;\u0026#34; title=\u0026#34;æœ¯è¯­å®šä¹‰\u0026#34;\u0026gt;ä¸“ä¸šæœ¯è¯­\u0026lt;/span\u0026gt; \u0026lt;!-- é€‚åº¦ä½¿ç”¨ --\u0026gt; ä»…åœ¨çœŸæ­£éœ€è¦å¼ºè°ƒçš„å†…å®¹ä¸Šä½¿ç”¨ç‰¹æ®Šä¸‹åˆ’çº¿ \u0026lt;!-- ä¿æŒä¸€è‡´æ€§ --\u0026gt; åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ç»Ÿä¸€çš„æ ·å¼è§„èŒƒ âŒ é¿å…è¿™æ ·ï¼š 1 2 3 4 5 6 7 8 \u0026lt;!-- è¿‡åº¦ä½¿ç”¨ --\u0026gt; æ¯æ®µéƒ½\u0026lt;span style=\u0026#34;border-bottom: 1px solid red;\u0026#34;\u0026gt;æ·»åŠ ä¸‹åˆ’çº¿\u0026lt;/span\u0026gt; \u0026lt;!-- å¯è®¿é—®æ€§å·® --\u0026gt; ä½¿ç”¨ä½å¯¹æ¯”åº¦çš„é¢œè‰²ç»„åˆ \u0026lt;!-- å¹³å°ç‰¹å®šä»£ç  --\u0026gt; ä¾èµ–ç‰¹å®šMarkè§£æå™¨çš„éæ ‡å‡†è¯­æ³• ğŸŒŸ ä¸“ä¸šå»ºè®®ï¼š å»ºç«‹æ ·å¼æŒ‡å—ï¼šä¸ºé¡¹ç›®å®šä¹‰ç»Ÿä¸€çš„ä¸‹åˆ’çº¿ä½¿ç”¨è§„èŒƒ è€ƒè™‘å¯è®¿é—®æ€§ï¼šç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦ç¬¦åˆ WCAG æ ‡å‡† æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…è¿‡å¤šä½¿ç”¨åŠ¨ç”»æ•ˆæœå½±å“æ€§èƒ½ å“åº”å¼è®¾è®¡ï¼šç¡®ä¿åœ¨ä¸åŒè®¾å¤‡ä¸Šéƒ½æœ‰è‰¯å¥½çš„æ˜¾ç¤ºæ•ˆæœ ğŸ‰ æ€»ç»“ï¼šé€šè¿‡å·§å¦™è¿ç”¨ CSS æ ·å¼ï¼Œä½ å¯ä»¥ä¸º Markdown æ–‡æ¡£æ·»åŠ å„ç§ç²¾ç¾çš„ä¸‹åˆ’çº¿æ•ˆæœã€‚è®°ä½ï¼Œå¥½çš„è®¾è®¡ä¸ä»…ä»…æ˜¯ç¾è§‚ï¼Œæ›´è¦è€ƒè™‘å®ç”¨æ€§ã€å¯è®¿é—®æ€§å’Œå…¼å®¹æ€§ã€‚\nğŸ› ï¸ å®è·µå»ºè®®ï¼šä»ç®€å•çš„æ ·å¼å¼€å§‹ï¼Œé€æ­¥å°è¯•æ›´å¤æ‚çš„æ•ˆæœã€‚æœ€é‡è¦çš„æ˜¯ä¿æŒä¸€è‡´æ€§ï¼Œç¡®ä¿æ ·å¼æœåŠ¡äºå†…å®¹ï¼Œè€Œä¸æ˜¯åˆ†æ•£è¯»è€…çš„æ³¨æ„åŠ›ã€‚\nç°åœ¨å°±å¼€å§‹å°è¯•è¿™äº›æŠ€å·§ï¼Œè®©ä½ çš„ Markdown æ–‡æ¡£æ›´åŠ ç”ŸåŠ¨å’Œä¸“ä¸šå§ï¼\n","date":"2024-12-14T19:50:08+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/95a96f43/","title":"Markdown ä¸‹åˆ’çº¿æ ·å¼å®Œå…¨æŒ‡å— ğŸ“"},{"content":"Markdown é“¾æ¥ä½¿ç”¨æŒ‡å— ğŸ”— ğŸ“š Markdown æ•™ç¨‹æ¨èï¼š Markdown å®˜æ–¹æŒ‡å— â€” ä¸€ç«™å¼æŒæ¡ Markdown è¯­æ³•ç²¾é«“ï¼\nğŸ“‹ æ–‡ç« ç›®å½• ğŸŒŸ Markdown é“¾æ¥åŠŸèƒ½æ¦‚è§ˆ ğŸ–±ï¸ å¸¦æ‚¬æµ®æç¤ºçš„é“¾æ¥ ğŸ”· åŠ ç²—é“¾æ¥æ ·å¼ ğŸ“š å¼•ç”¨å¼é“¾æ¥è¯¦è§£ ğŸ¯ é«˜çº§é“¾æ¥æŠ€å·§ ğŸ› ï¸ å®ç”¨å»ºè®®ä¸æœ€ä½³å®è·µ ğŸ” é“¾æ¥å¯è®¿é—®æ€§æŒ‡å— ğŸ“ æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ ğŸŒŸ Markdown é“¾æ¥åŠŸèƒ½æ¦‚è§ˆ Markdown ä½œä¸ºä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå…¶é“¾æ¥åŠŸèƒ½æ—¢å¼ºå¤§åˆçµæ´»ï¼âœ¨ å®ƒæ”¯æŒå¤šç§é“¾æ¥æ ¼å¼ï¼Œæ¯ç§éƒ½é’ˆå¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯è®¾è®¡ï¼š\nğŸ”¹ å†…è”é“¾æ¥ - æœ€ç›´æ¥çš„é“¾æ¥æ–¹å¼ï¼Œé€‚ç”¨äºç®€å•åœºæ™¯\nğŸ”¹ å¼•ç”¨å¼é“¾æ¥ - ä¿æŒæ–‡æ¡£æ•´æ´ï¼Œé€‚åˆå­¦æœ¯æˆ–æŠ€æœ¯æ–‡æ¡£\nğŸ”¹ è‡ªåŠ¨é“¾æ¥ - å¿«é€Ÿå°†URLè½¬æ¢ä¸ºå¯ç‚¹å‡»é“¾æ¥\nğŸ”¹ é«˜çº§é“¾æ¥ - æ”¯æŒé‚®ä»¶ã€ç”µè¯ã€é”šç‚¹ç­‰ç‰¹æ®ŠåŠŸèƒ½\næ— è®ºä½ æ˜¯å†™ä½œåšå®¢ã€æŠ€æœ¯æ–‡æ¡£è¿˜æ˜¯æ—¥å¸¸ç¬”è®°ï¼ŒæŒæ¡è¿™äº›é“¾æ¥æŠ€å·§éƒ½èƒ½è®©ä½ çš„å†…å®¹æ›´åŠ ä¸“ä¸šå’Œæ˜“è¯»ï¼\nğŸ–±ï¸ å¸¦æ‚¬æµ®æç¤ºçš„é“¾æ¥ ğŸ“ è¯­æ³•ç»“æ„ 1 [æ˜¾ç¤ºçš„é“¾æ¥æ–‡æœ¬](å®é™…URLåœ°å€ \u0026#34;æ‚¬æµ®æç¤ºæ–‡æœ¬\u0026#34;) ğŸ¯ å®ç”¨ç¤ºä¾‹ 1 [è®¿é—®ç™¾åº¦æœç´¢](https://www.baidu.com \u0026#34;ä¸­å›½æœ€å¤§çš„æœç´¢å¼•æ“\u0026#34;) ğŸ‘€ æ¸²æŸ“æ•ˆæœ è®¿é—®ç™¾åº¦æœç´¢ ğŸ’¡ ä¸“ä¸šæç¤ºï¼šæ‚¬æµ®æç¤ºï¼ˆTooltipï¼‰ä¸ä»…èƒ½æä¾›é¢å¤–ä¸Šä¸‹æ–‡ï¼Œè¿˜èƒ½æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚å½“ç”¨æˆ·é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºç®€çŸ­è¯´æ˜ï¼Œç‰¹åˆ«é€‚åˆè§£é‡Šé“¾æ¥å†…å®¹æˆ–è®¾ç½®è®¿é—®é¢„æœŸã€‚\nğŸš€ ä½¿ç”¨åœºæ™¯æ¨è å­¦æœ¯å¼•ç”¨ï¼šè¯´æ˜é“¾æ¥æ–‡çŒ®çš„ç›¸å…³æ€§ å¤–éƒ¨èµ„æºï¼šæç¤ºç”¨æˆ·å°†è·³è½¬åˆ°å¤–éƒ¨ç½‘ç«™ ä¸‹è½½é“¾æ¥ï¼šæ³¨æ˜æ–‡ä»¶ç±»å‹å’Œå¤§å° åŠŸèƒ½é“¾æ¥ï¼šè§£é‡Šé“¾æ¥çš„å…·ä½“ä½œç”¨ ğŸ”· åŠ ç²—é“¾æ¥æ ·å¼ ğŸ“ è¯­æ³•ç»“æ„ 1 **\u0026lt;https://example.com\u0026gt;** ğŸ¯ å®ç”¨ç¤ºä¾‹ 1 **\u0026lt;https://mp.weixin.qq.com\u0026gt;** ğŸ‘€ æ¸²æŸ“æ•ˆæœ https://mp.weixin.qq.com ğŸ’¡ è®¾è®¡æ€è€ƒï¼šåŠ ç²—é“¾æ¥ç›´æ¥æ˜¾ç¤ºåŸå§‹URLï¼Œé¿å…äº†ä¸Šä¸‹æ–‡è½¬æ¢çš„è®¤çŸ¥è´Ÿè·ã€‚é€‚åˆåœ¨æŠ€æœ¯æ–‡æ¡£ä¸­å¼ºè°ƒå…·ä½“çš„ç½‘å€ï¼Œæˆ–è€…å½“é“¾æ¥æœ¬èº«åŒ…å«é‡è¦ä¿¡æ¯æ—¶ä½¿ç”¨ã€‚\nğŸš€ é€‚ç”¨åœºæ™¯ APIæ–‡æ¡£ï¼šå¼ºè°ƒç«¯ç‚¹URL é…ç½®æŒ‡å—ï¼šçªå‡ºé‡è¦ç½‘å€ è”ç³»æ–¹å¼ï¼šç›´æ¥å±•ç¤ºç½‘ç«™åœ°å€ å‘½ä»¤è¡Œæ•™ç¨‹ï¼šæ˜¾ç¤ºéœ€è¦ç›´æ¥è¾“å…¥çš„URL ğŸ“š å¼•ç”¨å¼é“¾æ¥è¯¦è§£ ğŸ“ è¯­æ³•ç»“æ„ 1 2 3 [é“¾æ¥æ–‡æœ¬][å¼•ç”¨æ ‡è¯†ç¬¦] [å¼•ç”¨æ ‡è¯†ç¬¦]: å®é™…URL \u0026#34;å¯é€‰æç¤ºæ–‡æœ¬\u0026#34; ğŸ¯ å®Œæ•´ç¤ºä¾‹ 1 2 3 4 5 6 æ—©æ™¨å­¦ä¹  routineï¼šå…ˆæ‰“å¼€ [æ¯æ—¥è‹±è¯­å¬åŠ›][eudic-ting] ç»ƒä¹ å¬åŠ›ï¼Œé‡åˆ°ç”Ÿè¯å°±ç”¨ [æ¬§è·¯è¯å…¸][eudic-dict] æŸ¥è¯¢å¹¶æ”¶è—ï¼Œæœ€ååœ¨ [æ¡Œé¢å®¢æˆ·ç«¯][eudic-app] ä¸­å¤ä¹ è®°å¿†ã€‚ [eudic-ting]: https://dict.eudic.net/ting \u0026#34;ä¸“ä¸šçš„è‹±è¯­å¬åŠ›å­¦ä¹ å¹³å°\u0026#34; [eudic-dict]: https://dict.eudic.net/ \u0026#34;æƒå¨çš„å¤šè¯­ç§åœ¨çº¿è¯å…¸\u0026#34; [eudic-app]: https://www.eudic.net/v4/en/app/eudic \u0026#34;åŠŸèƒ½å¼ºå¤§çš„è¯å…¸å®¢æˆ·ç«¯\u0026#34; ğŸ‘€ æ¸²æŸ“æ•ˆæœ æ—©æ™¨å­¦ä¹  routineï¼šå…ˆæ‰“å¼€ æ¯æ—¥è‹±è¯­å¬åŠ› ç»ƒä¹ å¬åŠ›ï¼Œé‡åˆ°ç”Ÿè¯å°±ç”¨ æ¬§è·¯è¯å…¸ æŸ¥è¯¢å¹¶æ”¶è—ï¼Œæœ€ååœ¨ æ¡Œé¢å®¢æˆ·ç«¯ ä¸­å¤ä¹ è®°å¿†ã€‚\nğŸ’¡ ç»“æ„åŒ–ä¼˜åŠ¿ï¼šå¼•ç”¨å¼é“¾æ¥è®©æ–‡æ¡£ä¸»ä½“ä¿æŒç®€æ´ï¼ŒåŒæ—¶ä¾¿äºé›†ä¸­ç®¡ç†æ‰€æœ‰é“¾æ¥ã€‚ç‰¹åˆ«é€‚åˆï¼š\nğŸ“– é•¿ç¯‡æ–‡ç« æˆ–ä¹¦ç± ğŸ“Š å­¦æœ¯è®ºæ–‡å’ŒæŠ€æœ¯æ–‡æ¡£ ğŸ” å¤šæ¬¡é‡å¤ä½¿ç”¨åŒä¸€é“¾æ¥çš„åœºæ™¯ âœï¸ éœ€è¦é¢‘ç¹æ›´æ–°é“¾æ¥åœ°å€çš„æƒ…å†µ ğŸ› ï¸ å¼•ç”¨å¼é“¾æ¥ç®¡ç†æŠ€å·§ ç»Ÿä¸€ä½ç½®ï¼šå°†æ‰€æœ‰çš„é“¾æ¥å¼•ç”¨æ”¾åœ¨æ–‡æ¡£æœ«å°¾æˆ–ä¸“é—¨ç« èŠ‚ å‘½åè§„èŒƒï¼šä½¿ç”¨æœ‰æ„ä¹‰ä¸”ä¸€è‡´çš„æ ‡è¯†ç¬¦å‘½åè§„åˆ™ åˆ†ç»„ç®¡ç†ï¼šæŒ‰ç±»åˆ«æˆ–ç« èŠ‚å¯¹é“¾æ¥è¿›è¡Œåˆ†ç»„ æ³¨é‡Šè¯´æ˜ï¼šä¸ºå¤æ‚é“¾æ¥æ·»åŠ æ³¨é‡Šè¯´æ˜å…¶ç”¨é€” ğŸ¯ é«˜çº§é“¾æ¥æŠ€å·§ 1. ğŸ“‘ æ–‡æ¡£å†…é”šç‚¹è·³è½¬ 1 [è·³è½¬åˆ°ç»“è®ºéƒ¨åˆ†](#conclusion) éœ€è¦åœ¨ç›®æ ‡ä½ç½®å®šä¹‰ï¼š\u0026lt;a id=\u0026quot;conclusion\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\n2. ğŸ“ ç›¸å¯¹è·¯å¾„é“¾æ¥ 1 2 [æŸ¥çœ‹é¡¹ç›®è¯´æ˜](../README.md) [ä¸‹è½½ç”¨æˆ·æ‰‹å†Œ](./documents/manual.pdf) 3. ğŸ”¤ ç‰¹æ®Šå­—ç¬¦å¤„ç† 1 [æœç´¢\u0026#34;Markdownæ•™ç¨‹\u0026#34;](https://www.google.com/search?q=Markdown+tutorial) æ³¨æ„ï¼šåŒ…å«ç‰¹æ®Šå­—ç¬¦çš„URLå¯èƒ½éœ€è¦ç¼–ç å¤„ç†\n4. ğŸ“§ é‚®ä»¶é“¾æ¥ 1 [è”ç³»æˆ‘ä»¬](mailto:contact@example.com?subject=Feedback\u0026amp;body=Hello!) 5. ğŸ“ ç”µè¯é“¾æ¥ 1 [æ‹¨æ‰“å®¢æœ](tel:+8610123456789) 6. ğŸ”— é“¾æ¥å¢å¼ºå±æ€§ 1 [å¤–éƒ¨é“¾æ¥](https://example.com){:target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener noreferrer\u0026#34;} æ³¨æ„ï¼šæŸäº›Markdownå¤„ç†å™¨æ”¯æŒæ‰©å±•å±æ€§\nğŸ› ï¸ å®ç”¨å»ºè®®ä¸æœ€ä½³å®è·µ âœ… é“¾æ¥æ–‡æœ¬è®¾è®¡åŸåˆ™ æè¿°æ€§ä¼˜å…ˆ\n1 2 âœ… [æŸ¥çœ‹Markdownè¯­æ³•æŒ‡å—](https://example.com) âŒ [ç‚¹å‡»è¿™é‡Œ](https://example.com) é•¿åº¦é€‚ä¸­\nä¿æŒé“¾æ¥æ–‡æœ¬ç®€æ´ä½†ä¿¡æ¯å®Œæ•´ é¿å…å•ä¸ªå­—ç¬¦æˆ–è¿‡é•¿çš„æ–‡æœ¬ ä¸Šä¸‹æ–‡ç›¸å…³\nç¡®ä¿é“¾æ¥æ–‡æœ¬ä¸å‘¨å›´å†…å®¹è‡ªç„¶èåˆ æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ ğŸ”„ å·¥ä½œæµä¼˜åŒ– é“¾æ¥éªŒè¯\n1 2 # ä½¿ç”¨å·¥å…·æ£€æŸ¥é“¾æ¥æœ‰æ•ˆæ€§ npx check-links *.md æ‰¹é‡ç®¡ç†\nä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨çš„å¤šå…‰æ ‡åŠŸèƒ½æ‰¹é‡æ›´æ–°é“¾æ¥ å»ºç«‹é“¾æ¥åº“æˆ–æ•°æ®åº“ç®¡ç†å¸¸ç”¨é“¾æ¥ ç‰ˆæœ¬æ§åˆ¶\nå¯¹ç»å¸¸å˜åŒ–çš„é“¾æ¥ä½¿ç”¨é‡å®šå‘æœåŠ¡ è€ƒè™‘ä½¿ç”¨ç›¸å¯¹è·¯å¾„ä»¥é€‚åº”ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒ ğŸ” é“¾æ¥å¯è®¿é—®æ€§æŒ‡å— ğŸ‘ï¸ ä¸ºè§†è§‰éšœç¢ç”¨æˆ·ä¼˜åŒ– å±å¹•é˜…è¯»å™¨å‹å¥½\n1 2 âœ… [Markdownå®˜æ–¹æ–‡æ¡£ï¼šåœ¨æ–°çª—å£æ‰“å¼€](https://example.com) âŒ [ç‚¹å‡»è¿™é‡Œ](https://example.com) é¿å…URL-onlyæ–‡æœ¬\næä¾›æœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡ é¿å…ä½¿ç”¨\u0026quot;ç‚¹å‡»è¿™é‡Œ\u0026quot;ç­‰æ¨¡ç³Šè¡¨è¿° å¤–éƒ¨é“¾æ¥æ ‡è¯†\n1 [å¤–éƒ¨èµ„æºï¼šWebå†…å®¹å¯è®¿é—®æ€§æŒ‡å—](https://wcag.com) â†— ğŸŒ å›½é™…åŒ–è€ƒè™‘ å¤šè¯­è¨€æ”¯æŒ\nä¸ºä¸åŒè¯­è¨€ç”¨æˆ·æä¾›ç›¸åº”é“¾æ¥ è€ƒè™‘ä½¿ç”¨è¯­è¨€æ£€æµ‹é‡å®šå‘ æ–‡åŒ–é€‚åº”æ€§\nç¡®ä¿é“¾æ¥å†…å®¹ç¬¦åˆå½“åœ°æ³•è§„å’Œæ–‡åŒ–ä¹ æƒ¯ æä¾›æ›¿ä»£é“¾æ¥æˆ–é•œåƒç«™ç‚¹ ğŸ“ æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ âš ï¸ å¸¸è§æŠ€æœ¯é—®é¢˜ ç©ºæ ¼å¤„ç†\n1 2 # ç©ºæ ¼éœ€è¦ç¼–ç ä¸º %20 [æˆ‘çš„æ–‡æ¡£](https://example.com/my%20document.pdf) ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰\næ‹¬å·()éœ€è¦è½¬ä¹‰æˆ–åœ¨URLç¼–ç ä¸­å¤„ç† ä¸­æ–‡å­—ç¬¦å»ºè®®ä½¿ç”¨UTF-8ç¼–ç  è·¨å¹³å°å…¼å®¹æ€§\nä¸åŒMarkdownè§£æå™¨å¯èƒ½æœ‰ç»†å¾®å·®å¼‚ æµ‹è¯•åœ¨ç›®æ ‡å¹³å°ä¸Šçš„æ¸²æŸ“æ•ˆæœ â“ å¸¸è§é—®é¢˜è§£ç­” Q: é“¾æ¥åœ¨æŸäº›å¹³å°ä¸Šä¸å·¥ä½œæ€ä¹ˆåŠï¼Ÿ\nA: æ£€æŸ¥URLç¼–ç ï¼Œç¡®ä¿æ²¡æœ‰ç‰¹æ®Šå­—ç¬¦é—®é¢˜ï¼Œå°è¯•ä½¿ç”¨å¼•ç”¨å¼é“¾æ¥ã€‚\nQ: å¦‚ä½•ç®¡ç†å¤§é‡é“¾æ¥ï¼Ÿ\nA: å»ºè®®ä½¿ç”¨å¼•ç”¨å¼é“¾æ¥å¹¶é›†ä¸­ç®¡ç†ï¼Œæˆ–è€…è€ƒè™‘ä½¿ç”¨ä¸“ä¸šçš„æ–‡æ¡£å·¥å…·ã€‚\nQ: é‚®ä»¶é“¾æ¥å¦‚ä½•æ·»åŠ ä¸»é¢˜å’Œå†…å®¹ï¼Ÿ\nA: ä½¿ç”¨mailto:address?subject=ä¸»é¢˜\u0026amp;body=å†…å®¹æ ¼å¼ï¼Œæ³¨æ„URLç¼–ç ã€‚\nQ: å¦‚ä½•ç¡®ä¿å¤–éƒ¨é“¾æ¥çš„å®‰å…¨æ€§ï¼Ÿ\nA: æ·»åŠ rel=\u0026quot;noopener noreferrer\u0026quot;å±æ€§ï¼Œé¿å…æ ‡ç­¾é¡µæ“çºµæ”»å‡»ã€‚\nğŸ‰ æ€»ç»“ï¼šæŒæ¡Markdowné“¾æ¥çš„å„ç§æŠ€å·§èƒ½å¤Ÿæ˜¾è‘—æå‡æ–‡æ¡£è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚ä»åŸºç¡€çš„å†…è”é“¾æ¥åˆ°é«˜çº§çš„å¼•ç”¨å¼ç®¡ç†ï¼Œæ¯ç§æ–¹æ³•éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ã€‚è®°ä½ï¼šå¥½çš„é“¾æ¥è®¾è®¡ä¸ä»…è¦æŠ€æœ¯æ­£ç¡®ï¼Œæ›´è¦è€ƒè™‘ç”¨æˆ·ä½“éªŒå’Œå¯è®¿é—®æ€§ï¼\nğŸ’ª ç°åœ¨å°±å¼€å§‹å®è·µè¿™äº›æŠ€å·§ï¼Œè®©ä½ çš„Markdownæ–‡æ¡£æ›´åŠ ä¸“ä¸šå’Œæ˜“ç”¨å§ï¼\n","date":"2024-12-14T19:18:15+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/049cb582/","title":"Markdown é“¾æ¥ä½¿ç”¨æŒ‡å— ğŸ”—"},{"content":"Nginx-full å®‰è£…ä¸å¸è½½æŒ‡å— ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº† Nginx Web æœåŠ¡å™¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬å®‰è£…ã€é…ç½®ä¼˜åŒ–ã€æ—¥å¸¸ç»´æŠ¤ã€æ•…éšœæ’é™¤ä»¥åŠå®Œå…¨å¸è½½ã€‚ nginx-full ç‰ˆæœ¬åŒ…å« http_dav_module æ¨¡å—ï¼Œé€‚åˆæ­å»º WebDAV æœåŠ¡\nâœ¨ ç›®å½• âœ¨ Nginx ç®€ä»‹ ğŸ“¦ ä¸€ã€Nginx å®‰è£…æŒ‡å— âš™ï¸ äºŒã€Nginx ç»´æŠ¤å‘½ä»¤ ğŸ—‘ï¸ ä¸‰ã€Nginx å¸è½½æŒ‡å— ğŸ”§ å››ã€æ•…éšœæ’é™¤æŠ€å·§ ğŸš€ äº”ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ“Š å…­ã€ç›‘æ§ä¸ç»Ÿè®¡ ğŸ›¡ï¸ ä¸ƒã€å®‰å…¨æœ€ä½³å®è·µ ğŸ’¡ å…«ã€å®ç”¨æŠ€å·§ ğŸŒŸ Nginx ç®€ä»‹ Nginx (å‘éŸ³ä¸º \u0026ldquo;engine-x\u0026rdquo;) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç®€å•çš„é…ç½®æ–‡ä»¶å’Œä½èµ„æºæ¶ˆè€—è€Œé—»åã€‚å®ƒç”± Igor Sysoev åˆ›å»ºï¼Œæœ€åˆæ˜¯ä¸ºä¿„ç½—æ–¯çš„å¤§å‹ç½‘ç«™ Rambler.ru å¼€å‘çš„ã€‚\nğŸ¯ Nginx ä¸»è¦ç‰¹æ€§ï¼š é«˜æ€§èƒ½: äº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ¶æ„ï¼Œèƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ è´Ÿè½½å‡è¡¡: å†…ç½®å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³• åå‘ä»£ç†: å¼ºå¤§çš„åå‘ä»£ç†åŠŸèƒ½ ç¼“å­˜åŠ é€Ÿ: é™æ€å†…å®¹ç¼“å­˜å’ŒåŠ¨æ€å†…å®¹åŠ é€Ÿ é«˜å¯é æ€§: æä½çš„æ•…éšœç‡å’Œå¼ºå¤§çš„æ•…éšœè½¬ç§»èƒ½åŠ› æ¨¡å—åŒ–è®¾è®¡: ä¸°å¯Œçš„æ¨¡å—ç”Ÿæ€ç³»ç»Ÿ ğŸ“Š Nginx ä¸ Apache å¯¹æ¯”ï¼š ç‰¹æ€§ Nginx Apache æ¶æ„ äº‹ä»¶é©±åŠ¨ è¿›ç¨‹/çº¿ç¨‹é©±åŠ¨ å†…å­˜ä½¿ç”¨ è¾ƒä½ è¾ƒé«˜ å¹¶å‘å¤„ç† ä¼˜ç§€ è‰¯å¥½ é™æ€å†…å®¹ æå¿« å¿« åŠ¨æ€å†…å®¹ é€šè¿‡ FastCGI åŸç”Ÿæ”¯æŒ é…ç½®è¯­æ³• ç®€æ´ è¾ƒå¤æ‚ ğŸ“¦ ä¸€ã€Nginx å®‰è£…æŒ‡å— 1ï¸âƒ£ Ubuntu/Debian ç³»ç»Ÿçš„å®‰è£…æ–¹æ³• Ubuntu/Debian ç³»ç»Ÿ 1 2 3 4 5 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£… nginx-fullï¼ˆåŒ…å« WebDAV ç­‰å®Œæ•´æ¨¡å—ï¼‰ sudo apt install nginx-full -y ä»æºç ç¼–è¯‘å®‰è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å®‰è£…ç¼–è¯‘ä¾èµ– sudo apt install build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev -y # ä¸‹è½½æœ€æ–°æºç  wget http://nginx.org/download/nginx-1.24.0.tar.gz tar -zxvf nginx-1.24.0.tar.gz cd nginx-1.24.0 # é…ç½®ç¼–è¯‘é€‰é¡¹ ./configure \\ --prefix=/usr/local/nginx \\ --with-http_ssl_module \\ --with-http_v2_module \\ --with-http_stub_status_module \\ --with-http_gzip_static_module \\ --with-http_dav_module # ç¼–è¯‘å¹¶å®‰è£… make sudo make install 2ï¸âƒ£ éªŒè¯å®‰è£… 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ Nginx ç‰ˆæœ¬ nginx -v # æŸ¥çœ‹ç¼–è¯‘å‚æ•° nginx -V # æ£€æŸ¥å®‰è£…æ–‡ä»¶ä½ç½® which nginx whereis nginx 3ï¸âƒ£ æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # å¯åŠ¨ Nginx æœåŠ¡ sudo systemctl start nginx # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable nginx # é‡æ–°åŠ è½½ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ sudo systemctl daemon-reload 4ï¸âƒ£ é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 # å…è®¸ HTTP å’Œ HTTPS æµé‡ sudo ufw allow \u0026#39;Nginx Full\u0026#39; # æˆ–è€…åˆ†åˆ«å…è®¸ sudo ufw allow 80/tcp sudo ufw allow 443/tcp # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ sudo ufw status 5ï¸âƒ£ éªŒè¯å®‰è£…æˆåŠŸ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ Nginx æ˜¯å¦æ­£åœ¨è¿è¡Œ ps aux | grep nginx # æ£€æŸ¥ç«¯å£ç›‘å¬æƒ…å†µ sudo netstat -tulnp | grep :80 sudo ss -tulnp | grep :80 # æµ‹è¯•è®¿é—® curl -I http://localhost 6ï¸âƒ£ å‡çº§ Nginx 1 2 3 4 5 # Ubuntu/Debian ç³»ç»Ÿ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade nginx -y # é‡å¯æœåŠ¡ä½¿å‡çº§ç”Ÿæ•ˆ sudo systemctl restart nginx âš™ï¸ äºŒã€Nginx ç»´æŠ¤å‘½ä»¤ 1ï¸âƒ£ æœåŠ¡ç®¡ç†å‘½ä»¤ å‘½ä»¤ è¯´æ˜ ä½¿ç”¨åœºæ™¯ sudo systemctl start nginx å¯åŠ¨ Nginx æœåŠ¡ åˆæ¬¡å®‰è£…å sudo systemctl stop nginx åœæ­¢ Nginx æœåŠ¡ ç»´æŠ¤å‰ sudo systemctl restart nginx é‡å¯ Nginx æœåŠ¡ é…ç½®æ›´æ”¹å sudo systemctl reload nginx é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ ä¿®æ”¹é…ç½®å sudo systemctl status nginx æŸ¥çœ‹æœåŠ¡çŠ¶æ€ æ—¥å¸¸æ£€æŸ¥ sudo systemctl enable nginx è®¾ç½®å¼€æœºè‡ªå¯ ç³»ç»Ÿå¯åŠ¨é…ç½® sudo systemctl disable nginx ç¦ç”¨å¼€æœºè‡ªå¯ ä¸´æ—¶ç¦ç”¨ 2ï¸âƒ£ é…ç½®æ£€æŸ¥ä¸éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # æµ‹è¯•ç‰¹å®šé…ç½®æ–‡ä»¶ sudo nginx -t -c /etc/nginx/nginx.conf # æŸ¥çœ‹å®Œæ•´é…ç½® sudo nginx -T # æŸ¥çœ‹åŒ…å«çš„æ¨¡å— nginx -V 2\u0026gt;\u0026amp;1 | grep -- \u0026#39;--with-\u0026#39; # æ£€æŸ¥é…ç½®æ–‡ä»¶ç»“æ„ sudo nginx -T | grep -E \u0026#34;^(http|server|location)\u0026#34; 3ï¸âƒ£ è¿›ç¨‹ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ä¼˜é›…åœæ­¢ï¼ˆå¤„ç†å®Œå½“å‰è¯·æ±‚ï¼‰ sudo nginx -s quit # ç«‹å³åœæ­¢ sudo nginx -s stop # é‡æ–°åŠ è½½é…ç½® sudo nginx -s reload # é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ sudo nginx -s reopen # æŸ¥çœ‹ä¸»è¿›ç¨‹ID cat /var/run/nginx.pid # æŸ¥çœ‹æ‰€æœ‰Nginxè¿›ç¨‹ ps aux | grep nginx pgrep -lf nginx 4ï¸âƒ£ æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ˆå®æ—¶ç›‘æ§ï¼‰ sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è®¿é—®æ—¥å¿—ï¼ˆå®æ—¶ç›‘æ§ï¼‰ sudo tail -f /var/log/nginx/access.log # æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿— sudo grep \u0026#34;25/May/2023\u0026#34; /var/log/nginx/access.log # ä½¿ç”¨ journalctl æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— sudo journalctl -u nginx --since today sudo journalctl -u nginx --since \u0026#34;2023-05-25\u0026#34; --until \u0026#34;2023-05-26\u0026#34; # æ—¥å¿—è½®è½¬é…ç½® sudo nano /etc/logrotate.d/nginx # æ‰‹åŠ¨æ‰§è¡Œæ—¥å¿—è½®è½¬ sudo logrotate -f /etc/logrotate.d/nginx 5ï¸âƒ£ ç³»ç»Ÿæ£€æŸ¥ä¸ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯ç”¨ sudo systemctl is-enabled nginx # æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ sudo netstat -tulnp | grep :80 sudo ss -tulnp | grep :80 sudo lsof -i :80 # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• sudo find /etc/nginx -name \u0026#34;*.conf\u0026#34; -exec nginx -t -c {} \\; # é‡æ–°åŠ è½½ bash é…ç½® source ~/.bashrc # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h /var/log/nginx/ 6ï¸âƒ£ è¿æ¥å’Œæ€§èƒ½æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å½“å‰è¿æ¥æ•° netstat -an | grep :80 | wc -l # æŸ¥çœ‹NginxçŠ¶æ€ï¼ˆéœ€è¦å¯ç”¨stub_statusæ¨¡å—ï¼‰ curl http://localhost/nginx_status # æŸ¥çœ‹å·¥ä½œè¿›ç¨‹çŠ¶æ€ sudo watch -n 1 \u0026#34;ps aux --sort=-%cpu | grep nginx\u0026#34; # ç›‘æ§å†…å­˜ä½¿ç”¨ sudo watch -n 1 \u0026#34;free -h \u0026amp;\u0026amp; echo \u0026#39;---\u0026#39; \u0026amp;\u0026amp; ps aux --sort=-%mem | head -10\u0026#34; ğŸ—‘ï¸ ä¸‰ã€Nginx å¸è½½æŒ‡å— 1ï¸âƒ£ ä¸åŒç³»ç»Ÿçš„å¸è½½æ–¹æ³• Ubuntu/Debian ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœæ­¢NginxæœåŠ¡ sudo systemctl stop nginx # ç¦ç”¨å¼€æœºå¯åŠ¨ sudo systemctl disable nginx # åŸºæœ¬å¸è½½ï¼ˆä¿ç•™é…ç½®æ–‡ä»¶ï¼‰ sudo apt remove nginx -y # å½»åº•å¸è½½ï¼ˆåˆ é™¤é…ç½®æ–‡ä»¶ï¼‰ sudo apt remove --purge nginx -y # æ¸…ç†nginx-fullç‰ˆæœ¬ sudo apt remove --purge nginx-full -y sudo apt autoremove --purge -y CentOS/RHEL ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 # åœæ­¢æœåŠ¡ sudo systemctl stop nginx # ç¦ç”¨å¼€æœºå¯åŠ¨ sudo systemctl disable nginx # å¸è½½Nginx sudo yum remove nginx -y # æ¸…ç†æ®‹ç•™æ–‡ä»¶ sudo rm -rf /etc/nginx sudo rm -rf /var/log/nginx 2ï¸âƒ£ æ¸…ç†æ®‹ç•™æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ é™¤é…ç½®æ–‡ä»¶å’Œæ—¥å¿— sudo rm -rf /etc/nginx/ sudo rm -rf /var/log/nginx/ sudo rm -rf /var/cache/nginx/ # åˆ é™¤ç½‘ç«™æ–‡ä»¶ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ sudo rm -rf /var/www/html/ # åˆ é™¤å¯åŠ¨è„šæœ¬ sudo rm -f /etc/init.d/nginx sudo rm -f /lib/systemd/system/nginx.service # åˆ é™¤ç¬¦å·é“¾æ¥ sudo rm -f /usr/sbin/nginx 3ï¸âƒ£ æºç å®‰è£…çš„å¸è½½ 1 2 3 4 5 6 7 # å¦‚æœæ˜¯ä»æºç ç¼–è¯‘å®‰è£… cd /path/to/nginx/source sudo make uninstall # æˆ–è€…æ‰‹åŠ¨åˆ é™¤ sudo rm -rf /usr/local/nginx sudo rm -f /usr/bin/nginx 4ï¸âƒ£ éªŒè¯å¸è½½ç»“æœ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥æ˜¯å¦å·²å¸è½½ which nginx nginx -v # æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¿›ç¨‹è¿è¡Œ ps aux | grep nginx # æ£€æŸ¥ç«¯å£æ˜¯å¦é‡Šæ”¾ sudo netstat -tulnp | grep :80 5ï¸âƒ£ å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¸è½½å‰ï¼‰ 1 2 3 4 5 6 7 8 # å¤‡ä»½é…ç½®æ–‡ä»¶ sudo tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx/ # å¤‡ä»½ç½‘ç«™æ•°æ® sudo tar -czf website-backup-$(date +%Y%m%d).tar.gz /var/www/html/ # å¤‡ä»½æ—¥å¿—æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ sudo tar -czf nginx-logs-backup-$(date +%Y%m%d).tar.gz /var/log/nginx/ ğŸ”§ å››ã€æ•…éšœæ’é™¤æŠ€å·§ 1ï¸âƒ£ ç«¯å£å†²çªè§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ sudo lsof -i :80 sudo netstat -tulnp | grep :80 sudo ss -tulnp | grep :80 # ç»ˆæ­¢ç‰¹å®šè¿›ç¨‹ sudo kill -9 \u0026lt;PID\u0026gt; # æˆ–è€…ä½¿ç”¨pkill sudo pkill -9 nginx # æ£€æŸ¥å…¶ä»–å¯èƒ½å ç”¨ç«¯å£çš„æœåŠ¡ sudo systemctl stop apache2 # å¦‚æœå®‰è£…äº†Apache sudo systemctl stop lighttpd # å¦‚æœå®‰è£…äº†Lighttpd 2ï¸âƒ£ æƒé™é—®é¢˜ä¿®å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä¿®å¤æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /var/www/html sudo chmod -R 755 /var/www/html # ä¿®å¤æ—¥å¿—æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /var/log/nginx sudo chmod -R 755 /var/log/nginx # æ£€æŸ¥SELinuxçŠ¶æ€ï¼ˆCentOS/RHELï¼‰ sudo sestatus sudo setsebool -P httpd_can_network_connect 1 # æ£€æŸ¥AppArmorçŠ¶æ€ï¼ˆUbuntuï¼‰ sudo aa-status 3ï¸âƒ£ é…ç½®é”™è¯¯è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 # è¯¦ç»†é”™è¯¯ä¿¡æ¯ sudo nginx -t 2\u0026gt;\u0026amp;1 | grep error # æ£€æŸ¥ç‰¹å®šé…ç½®æ®µ sudo grep -n \u0026#34;server_name\u0026#34; /etc/nginx/sites-enabled/* # æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ sudo nginx -t 2\u0026gt;\u0026amp;1 | tee /tmp/nginx-test.log # ä½¿ç”¨è°ƒè¯•æ¨¡å¼ sudo nginx -t -c /etc/nginx/nginx.conf --debug 4ï¸âƒ£ å¸¸è§é”™è¯¯è§£å†³ 502 Bad Gateway é”™è¯¯ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ sudo systemctl status php-fpm # å¦‚æœæ˜¯PHPåº”ç”¨ sudo systemctl status tomcat # å¦‚æœæ˜¯Javaåº”ç”¨ # æ£€æŸ¥Socketæƒé™ ls -la /var/run/php/php-fpm.sock # è°ƒæ•´FastCGIè¶…æ—¶è®¾ç½® # åœ¨Nginxé…ç½®ä¸­æ·»åŠ ï¼š # fastcgi_read_timeout 300; 403 Forbidden é”™è¯¯ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç›®å½•æƒé™ ls -la /var/www/html/ # æ£€æŸ¥indexæ–‡ä»¶æ˜¯å¦å­˜åœ¨ ls -la /var/www/html/index.* # æ£€æŸ¥SELinux/AppArmor sudo ausearch -m avc --start recent # æŸ¥çœ‹SELinuxæ‹’ç»è®°å½• 404 Not Found é”™è¯¯ 1 2 3 4 5 6 7 8 # æ£€æŸ¥rootç›®å½•è®¾ç½® sudo nginx -T | grep -A5 -B5 \u0026#34;root\u0026#34; # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ sudo find /var/www -name \u0026#34;index.*\u0026#34; # æ£€æŸ¥try_filesé…ç½® sudo nginx -T | grep -A3 -B3 \u0026#34;try_files\u0026#34; 5ï¸âƒ£ æ—¥å¿—åˆ†ææŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 # å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log | grep -E \u0026#34;(error|emerg|crit)\u0026#34; # åˆ†æè®¿é—®æ—¥å¿—ä¸­çš„é”™è¯¯ sudo awk \u0026#39;$9 \u0026gt;= 400 {print $0}\u0026#39; /var/log/nginx/access.log # æŸ¥çœ‹æœ€å¸¸è§çš„é”™è¯¯é¡µé¢ sudo awk \u0026#39;$9 \u0026gt;= 400 {print $7}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr # åˆ†ææ…¢è¯·æ±‚ sudo awk \u0026#39;{if ($NF \u0026gt; 5) print $0}\u0026#39; /var/log/nginx/access.log | sort -k10 -nr ğŸš€ äº”ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1ï¸âƒ£ å·¥ä½œè¿›ç¨‹ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 # åœ¨ /etc/nginx/nginx.conf ä¸­è®¾ç½® worker_processes auto; # è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•° worker_cpu_affinity auto; # CPUäº²å’Œæ€§è®¾ç½® worker_rlimit_nofile 100000; # å·¥ä½œè¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ events { worker_connections 4096; # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•° multi_accept on; # åŒæ—¶æ¥å—å¤šä¸ªæ–°è¿æ¥ use epoll; # ä½¿ç”¨epolläº‹ä»¶æ¨¡å‹ï¼ˆLinuxï¼‰ } 2ï¸âƒ£ ç¼“å†²åŒºå’Œè¶…æ—¶ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 http { # ç¼“å†²åŒºä¼˜åŒ– client_body_buffer_size 128k; client_max_body_size 20m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # è¶…æ—¶è®¾ç½® client_body_timeout 12; client_header_timeout 12; keepalive_timeout 15; send_timeout 10; # TCPä¼˜åŒ– sendfile on; tcp_nopush on; tcp_nodelay on; } 3ï¸âƒ£ å¯ç”¨ Gzip å‹ç¼© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 gzip on; gzip_vary on; gzip_min_length 1024; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/atom+xml image/svg+xml; 4ï¸âƒ£ é…ç½®ç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # é™æ€æ–‡ä»¶ç¼“å­˜ location ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ { expires 30d; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; add_header Pragma \u0026#34;public\u0026#34;; add_header Vary \u0026#34;Accept-Encoding\u0026#34;; } # ç¦æ­¢ç¼“å­˜é…ç½® location ~* \\.(php|cgi|pl|py)$ { expires off; add_header Cache-Control \u0026#34;no-store, no-cache, must-revalidate\u0026#34;; } 5ï¸âƒ£ è¿æ¥é™åˆ¶å’Œè¯·æ±‚é¢‘ç‡æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 # é™åˆ¶è¿æ¥é¢‘ç‡ limit_conn_zone $binary_remote_addr zone=addr:10m; limit_conn addr 100; # é™åˆ¶è¯·æ±‚é¢‘ç‡ limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s; location /api/ { limit_req zone=one burst=20 nodelay; proxy_pass http://backend; } 6ï¸âƒ£ å†…æ ¸å‚æ•°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # ç¼–è¾‘ /etc/sysctl.conf echo \u0026#39; # æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ fs.file-max = 1000000 # TCPä¼˜åŒ– net.core.somaxconn = 65535 net.ipv4.tcp_max_syn_backlog = 65535 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_tw_reuse = 1 net.ipv4.tcp_tw_recycle = 0 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 # å†…å­˜ä¼˜åŒ– net.core.rmem_max = 16777216 net.core.wmem_max = 16777216 net.ipv4.tcp_rmem = 4096 87380 16777216 net.ipv4.tcp_wmem = 4096 65536 16777216 \u0026#39; | sudo tee -a /etc/sysctl.conf # åº”ç”¨é…ç½® sudo sysctl -p ğŸ“Š å…­ã€ç›‘æ§ä¸ç»Ÿè®¡ 1ï¸âƒ£ å®æ—¶ç›‘æ§å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å®æ—¶è¿æ¥æ•° sudo ngxtop # æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤ watch -n 1 \u0026#34;echo \u0026#39;å½“å‰è¿æ¥æ•°:\u0026#39; \u0026amp;\u0026amp; netstat -an | grep :80 | wc -l\u0026#34; # ç›‘æ§Nginxè¿›ç¨‹èµ„æºä½¿ç”¨ sudo htop -p $(pgrep nginx | tr \u0026#39;\\n\u0026#39; \u0026#39;,\u0026#39;) # å®æ—¶ç›‘æ§è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log | awk \u0026#39; { print strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;), $1, $7, $9, $NF \u0026#34;s\u0026#34; }\u0026#39; 2ï¸âƒ£ æ€§èƒ½ç»Ÿè®¡å’Œåˆ†æ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹Nginxè¿›ç¨‹çŠ¶æ€ sudo ps aux --sort=-%cpu | grep nginx # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ sudo pmap $(pgrep nginx | head -1) | tail -1 # ä½¿ç”¨vmstatç›‘æ§ç³»ç»Ÿæ€§èƒ½ vmstat 1 10 # ä½¿ç”¨iostatç›‘æ§ç£ç›˜IO iostat -dx 1 3ï¸âƒ£ å¯ç”¨çŠ¶æ€ç›‘æ§æ¨¡å— 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨Nginxé…ç½®ä¸­æ·»åŠ  server { listen 80; server_name localhost; location /nginx_status { stub_status on; access_log off; allow 127.0.0.1; deny all; } } 4ï¸âƒ£ ä½¿ç”¨ç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£…GoAccessï¼ˆå®æ—¶æ—¥å¿—åˆ†æï¼‰ sudo apt install goaccess -y # å®æ—¶ç›‘æ§è®¿é—®æ—¥å¿— goaccess /var/log/nginx/access.log -o /var/www/html/report.html --real-time-html # ä½¿ç”¨iftopç›‘æ§ç½‘ç»œæµé‡ sudo iftop -P -i eth0 # ä½¿ç”¨nethogsç›‘æ§è¿›ç¨‹ç½‘ç»œä½¿ç”¨ sudo nethogs eth0 5ï¸âƒ£ æ—¥å¿—åˆ†æè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # nginx-log-analyzer.sh LOG_FILE=\u0026#34;/var/log/nginx/access.log\u0026#34; echo \u0026#34;=== Nginx è®¿é—®æ—¥å¿—åˆ†æ ===\u0026#34; echo \u0026#34;åˆ†ææ—¶é—´: $(date)\u0026#34; echo \u0026#34;æ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; echo \u0026#34;\u0026#34; # æ€»è¯·æ±‚æ•° TOTAL_REQUESTS=$(wc -l \u0026lt; \u0026#34;$LOG_FILE\u0026#34;) echo \u0026#34;æ€»è¯·æ±‚æ•°: $TOTAL_REQUESTS\u0026#34; # æˆåŠŸè¯·æ±‚ï¼ˆ2xx/3xxï¼‰ SUCCESS_REQUESTS=$(awk \u0026#39;$9 ~ /^[23][0-9][0-9]$/ {count++} END {print count}\u0026#39; \u0026#34;$LOG_FILE\u0026#34;) SUCCESS_RATE=$(echo \u0026#34;scale=2; $SUCCESS_REQUESTS * 100 / $TOTAL_REQUESTS\u0026#34; | bc) echo \u0026#34;æˆåŠŸè¯·æ±‚ç‡: $SUCCESS_RATE%\u0026#34; # é”™è¯¯è¯·æ±‚ï¼ˆ4xx/5xxï¼‰ ERROR_REQUESTS=$(awk \u0026#39;$9 ~ /^[45][0-9][0-9]$/ {count++} END {print count}\u0026#39; \u0026#34;$LOG_FILE\u0026#34;) ERROR_RATE=$(echo \u0026#34;scale=2; $ERROR_REQUESTS * 100 / $TOTAL_REQUESTS\u0026#34; | bc) echo \u0026#34;é”™è¯¯è¯·æ±‚ç‡: $ERROR_RATE%\u0026#34; # æœ€é¢‘ç¹çš„è®¿é—®IP echo \u0026#34;\u0026#34; echo \u0026#34;å‰10ä¸ªæœ€é¢‘ç¹è®¿é—®çš„IP:\u0026#34; awk \u0026#39;{print $1}\u0026#39; \u0026#34;$LOG_FILE\u0026#34; | sort | uniq -c | sort -nr | head -10 # æœ€å—æ¬¢è¿çš„é¡µé¢ echo \u0026#34;\u0026#34; echo \u0026#34;å‰10ä¸ªæœ€å—æ¬¢è¿çš„é¡µé¢:\u0026#34; awk \u0026#39;{print $7}\u0026#39; \u0026#34;$LOG_FILE\u0026#34; | sort | uniq -c | sort -nr | head -10 ğŸ›¡ï¸ ä¸ƒã€å®‰å…¨æœ€ä½³å®è·µ 1ï¸âƒ£ åŸºç¡€å®‰å…¨åŠ å›º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # éšè—Nginxç‰ˆæœ¬å· server_tokens off; # é˜²æ­¢ç‚¹å‡»åŠ«æŒ add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34;; # å¯ç”¨XSSä¿æŠ¤ add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # é˜²æ­¢MIMEç±»å‹å—…æ¢ add_header X-Content-Type-Options \u0026#34;nosniff\u0026#34;; # å¯ç”¨HSTSï¼ˆHTTPSå¼ºåˆ¶ï¼‰ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; 2ï¸âƒ£ è®¿é—®æ§åˆ¶å’Œé™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # é™åˆ¶è¯·æ±‚æ–¹æ³• if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 405; } # ç¦æ­¢æ•æ„Ÿæ–‡ä»¶è®¿é—® location ~ /\\.(ht|git|svn) { deny all; return 404; } # é™åˆ¶ç‰¹å®šæ–‡ä»¶ç±»å‹çš„è®¿é—® location ~* \\.(log|txt|conf|sql|bak)$ { deny all; return 403; } 3ï¸âƒ£ SSL/TLS å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_session_tickets off; ssl_stapling on; ssl_stapling_verify on; 4ï¸âƒ£ é˜²æ­¢å¸¸è§æ”»å‡» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # é˜²æ­¢DDoSæ”»å‡» limit_req_zone $binary_remote_addr zone=req_limit:10m rate=10r/s; limit_conn_zone $binary_remote_addr zone=conn_limit:10m; # é˜²æ­¢SQLæ³¨å…¥ set $block_sql_injections 0; if ($query_string ~ \u0026#34;union.*select.*\\(\u0026#34;) { set $block_sql_injections 1; } if ($block_sql_injections = 1) { return 403; } # é˜²æ­¢ç›®å½•éå† if ($request_uri ~ \u0026#34;\\.\\./\u0026#34;) { return 403; } 5ï¸âƒ£ å®‰å…¨å¤´è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 # å†…å®¹å®‰å…¨ç­–ç•¥ add_header Content-Security-Policy \u0026#34;default-src \u0026#39;self\u0026#39;; script-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39; \u0026#39;unsafe-eval\u0026#39; https://cdn.example.com; style-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39; https://cdn.example.com;\u0026#34;; # æƒé™ç­–ç•¥å¤´ add_header Permissions-Policy \u0026#34;geolocation=(), microphone=(), camera=()\u0026#34;; # æ¨èäººç­–ç•¥ add_header Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34;; # ç‰¹æ€§ç­–ç•¥ add_header Feature-Policy \u0026#34;geolocation \u0026#39;none\u0026#39;; microphone \u0026#39;none\u0026#39;; camera \u0026#39;none\u0026#39;\u0026#34;; 6ï¸âƒ£ æ–‡ä»¶å’Œç›®å½•æƒé™ 1 2 3 4 5 6 7 8 9 10 11 12 # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /var/www/html sudo find /var/www/html -type d -exec chmod 755 {} \\; sudo find /var/www/html -type f -exec chmod 644 {} \\; # ä¿æŠ¤é…ç½®æ–‡ä»¶ sudo chmod 600 /etc/nginx/nginx.conf sudo chmod 600 /etc/nginx/sites-available/* # ä¿æŠ¤SSLè¯ä¹¦ sudo chmod 600 /etc/ssl/private/* sudo chmod 644 /etc/ssl/certs/* ğŸ’¡ å…«ã€å®ç”¨æŠ€å·§ 1ï¸âƒ£ å¿«é€Ÿæµ‹è¯•é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºæµ‹è¯•é…ç½® cat \u0026gt; test.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; server { listen 8080; server_name test.local; return 200 \u0026#34;Test successful!\\n\u0026#34;; } EOF # æµ‹è¯•é…ç½® sudo nginx -t -c test.conf # ä¸´æ—¶è¿è¡Œæµ‹è¯•é…ç½® sudo nginx -c $(pwd)/test.conf # æµ‹è¯•å®Œæ¯•ååœæ­¢ sudo nginx -s stop -c $(pwd)/test.conf 2ï¸âƒ£ å¤‡ä»½å’Œç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 # å¤‡ä»½ç°æœ‰é…ç½® sudo tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx/ # ä½¿ç”¨gitè¿›è¡Œé…ç½®ç‰ˆæœ¬æ§åˆ¶ sudo mkdir /etc/nginx/.git sudo git -C /etc/nginx/ init sudo git -C /etc/nginx/ add . sudo git -C /etc/nginx/ commit -m \u0026#34;Initial nginx config\u0026#34; # æ¯æ¬¡ä¿®æ”¹åæäº¤ sudo git -C /etc/nginx/ add . sudo git -C /etc/nginx/ commit -m \u0026#34;ä¿®æ”¹é…ç½®æè¿°\u0026#34; 3ï¸âƒ£ æ‰¹é‡æ“ä½œå’Œç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # æ‰¹é‡é‡è½½æ‰€æœ‰Nginxé…ç½® sudo find /etc/nginx/conf.d/ -name \u0026#34;*.conf\u0026#34; -exec sudo nginx -t -c {} \\; # æ‰¹é‡æ£€æŸ¥è¯­æ³•é”™è¯¯ for config in /etc/nginx/sites-enabled/*; do echo \u0026#34;æ£€æŸ¥é…ç½®: $config\u0026#34; sudo nginx -t -c \u0026#34;$config\u0026#34; 2\u0026gt;\u0026amp;1 | grep -E \u0026#34;(error|emerg|crit)\u0026#34; done # æ‰¹é‡å¤‡ä»½é…ç½®æ–‡ä»¶ sudo tar -czf nginx-config-$(date +%Y%m%d).tar.gz /etc/nginx/conf.d/ /etc/nginx/sites-available/ /etc/nginx/sites-enabled/ 4ï¸âƒ£ æ€§èƒ½æµ‹è¯•å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…· sudo apt install apache2-utils -y # å‹åŠ›æµ‹è¯• ab -n 1000 -c 100 http://localhost/ # ä½¿ç”¨wrkè¿›è¡Œæ›´é«˜çº§æµ‹è¯• wrk -t12 -c400 -d30s http://localhost/ # ä½¿ç”¨siegeè¿›è¡Œé•¿æ—¶é—´æµ‹è¯• siege -c100 -t1M http://localhost/ 5ï¸âƒ£ æ—¥å¿—åˆ†æå’Œç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 # å®æ—¶é”™è¯¯ç›‘æ§ sudo tail -f /var/log/nginx/error.log | grep -E --color=auto \u0026#34;(error|emerg|crit)\u0026#34; # ç»Ÿè®¡HTTPçŠ¶æ€ç  awk \u0026#39;{print $9}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -rn # åˆ†ææ…¢è¯·æ±‚ awk \u0026#39;($NF \u0026gt; 5){print $7, $NF}\u0026#39; /var/log/nginx/access.log | sort -k2 -rn | head -20 # ç”Ÿæˆè®¿é—®æŠ¥å‘Š goaccess /var/log/nginx/access.log -o /var/www/html/report.html --log-format=COMBINED 6ï¸âƒ£ è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #!/bin/bash # nginx-manager.sh case \u0026#34;$1\u0026#34; in start) sudo systemctl start nginx echo \u0026#34;Nginx started\u0026#34; ;; stop) sudo systemctl stop nginx echo \u0026#34;Nginx stopped\u0026#34; ;; restart) sudo systemctl restart nginx echo \u0026#34;Nginx restarted\u0026#34; ;; reload) sudo systemctl reload nginx echo \u0026#34;Nginx reloaded\u0026#34; ;; status) sudo systemctl status nginx ;; test) sudo nginx -t ;; monitor) watch -n 1 \u0026#34;echo \u0026#39;è¿æ¥æ•°:\u0026#39; \u0026amp;\u0026amp; netstat -an | grep :80 | wc -l \u0026amp;\u0026amp; echo \u0026#39;å†…å­˜ä½¿ç”¨:\u0026#39; \u0026amp;\u0026amp; ps aux | grep nginx | grep -v grep | awk \u0026#39;{print \\$4}\u0026#39;\u0026#34; ;; *) echo \u0026#34;Usage: $0 {start|stop|restart|reload|status|test|monitor}\u0026#34; exit 1 ;; esac 7ï¸âƒ£ Docker å®¹å™¨åŒ–éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # ä½¿ç”¨å®˜æ–¹Nginxé•œåƒ docker run -d \\ --name nginx \\ -p 80:80 \\ -p 443:443 \\ -v /path/to/nginx.conf:/etc/nginx/nginx.conf \\ -v /path/to/html:/usr/share/nginx/html \\ nginx:latest # ä½¿ç”¨Docker Compose cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; version: \u0026#39;3.8\u0026#39; services: nginx: image: nginx:latest ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf - ./html:/usr/share/nginx/html restart: unless-stopped EOF é€šè¿‡è¿™ä»½å®Œæ•´çš„ Nginx ç®¡ç†æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç†Ÿç»ƒåœ°å®‰è£…ã€é…ç½®ã€ç»´æŠ¤ã€ä¼˜åŒ–å’Œå¸è½½ Nginx æœåŠ¡å™¨ã€‚è®°å¾—åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ“ä½œå‰æ€»æ˜¯å¤‡ä»½é‡è¦é…ç½®ï¼ğŸ¯\nğŸ“š æ‰©å±•èµ„æº Nginx å®˜æ–¹æ–‡æ¡£ Nginx é…ç½®æŒ‡å— SSL å®éªŒå®¤æµ‹è¯•å·¥å…· Mozilla SSL é…ç½®ç”Ÿæˆå™¨ â“ å¸¸è§é—®é¢˜è§£ç­” Q: Nginx å’Œ Apache å“ªä¸ªæ›´å¥½ï¼Ÿ A: è¿™å–å†³äºå…·ä½“éœ€æ±‚ã€‚Nginx æ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼ŒApache æ›´é€‚åˆéœ€è¦å¤§é‡æ¨¡å—çš„åŠ¨æ€å†…å®¹å¤„ç†ã€‚\nQ: å¦‚ä½•è§£å†³ 502 Bad Gateway é”™è¯¯ï¼Ÿ A: æ£€æŸ¥åç«¯æœåŠ¡ï¼ˆå¦‚ PHP-FPMã€Tomcatï¼‰æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ£€æŸ¥ä»£ç†é…ç½®å’Œè¶…æ—¶è®¾ç½®ã€‚\nQ: Nginx æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ A: å·¥ä½œè¿›ç¨‹æ•°ã€è¿æ¥æ•°é™åˆ¶ã€ç¼“å†²åŒºå’Œç¼“å­˜è®¾ç½®ã€Gzip å‹ç¼©ã€å†…æ ¸å‚æ•°è°ƒä¼˜ã€‚\nQ: å¦‚ä½•é˜²æ­¢ DDoS æ”»å‡»ï¼Ÿ A: ä½¿ç”¨ limit_req å’Œ limit_conn æ¨¡å—é™åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œé…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œä½¿ç”¨ Cloudflare ç­‰ CDN æœåŠ¡ã€‚\nQ: SSL è¯ä¹¦é…ç½®è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ A: ä½¿ç”¨å¼ºå¯†ç å¥—ä»¶ï¼Œå¯ç”¨ HSTSï¼Œé…ç½® OCSP Staplingï¼Œå®šæœŸæ›´æ–°è¯ä¹¦ã€‚\n","date":"2024-12-13T18:28:31+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/92620cfd/","title":"Nginx-full å®‰è£…ä¸å¸è½½æŒ‡å— ğŸš€"},{"content":"Nginx å›¾åºŠæœåŠ¡éƒ¨ç½² ğŸ§ å…¨é¢æŒæ¡ Nginx Web æœåŠ¡å™¨çš„ç®¡ç†å‘½ä»¤ä¸å®æˆ˜éƒ¨ç½²æŠ€å·§\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ Nginx ç®€ä»‹ ğŸ“‹ ä¸€ã€ç‰ˆæœ¬ä¸å®‰è£…ç®¡ç† ğŸš€ äºŒã€æœåŠ¡æ§åˆ¶å‘½ä»¤ âš™ï¸ ä¸‰ã€é…ç½®æµ‹è¯•ä¸é‡è½½ ğŸ“Š å››ã€æ—¥å¿—ä¸ç›‘æ§ ğŸ› ï¸ äº”ã€é«˜çº§è°ƒè¯•å‘½ä»¤ ğŸ¯ å…­ã€å®æˆ˜æ¡ˆä¾‹ï¼šNginxå›¾åºŠæœåŠ¡éƒ¨ç½² ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ä¸æç¤º ğŸš¨ å…«ã€æ•…éšœæ’é™¤æŒ‡å— âœ¨ Nginx ç®€ä»‹ Nginx (å‘éŸ³ä¸º\u0026quot;engine x\u0026quot;) æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„å¼€æº Web æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€ä½å†…å­˜å ç”¨å’Œå“è¶Šçš„ç¨³å®šæ€§è‘—ç§°ã€‚å®ƒä¸ä»…å¯ä»¥ç”¨ä½œ HTTP/HTTPS æœåŠ¡å™¨ï¼Œè¿˜èƒ½ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ã€é‚®ä»¶ä»£ç†æœåŠ¡å™¨å’Œé€šç”¨ TCP/UDP ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚\nä¸»è¦ç‰¹æ€§ï¼š\nğŸš€ é«˜æ€§èƒ½ï¼šé‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œèƒ½å¤Ÿå¤„ç†æ•°ä¸‡ä¸ªå¹¶å‘è¿æ¥ ğŸ“¦ ä½å†…å­˜æ¶ˆè€—ï¼šç›¸æ¯”ä¼ ç»ŸæœåŠ¡å™¨ï¼Œå†…å­˜ä½¿ç”¨æ•ˆç‡æ›´é«˜ ğŸ”§ æ¨¡å—åŒ–è®¾è®¡ï¼šæ”¯æŒåŠ¨æ€æ¨¡å—åŠ è½½ï¼Œçµæ´»æ‰©å±•åŠŸèƒ½ âš–ï¸ è´Ÿè½½å‡è¡¡ï¼šæä¾›å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ”¯æŒå¥åº·æ£€æŸ¥ ğŸ”’ å®‰å…¨æ€§ï¼šæ”¯æŒ SSL/TLS åŠ å¯†ï¼Œå„ç§å®‰å…¨å¤´éƒ¨è®¾ç½® ğŸŒ åå‘ä»£ç†ï¼šå¼ºå¤§çš„åå‘ä»£ç†åŠŸèƒ½ï¼Œæ”¯æŒç¼“å­˜å’Œå‹ç¼© ğŸ“‹ ä¸€ã€ç‰ˆæœ¬ä¸å®‰è£…ç®¡ç† 1. æŸ¥çœ‹ Nginx ç‰ˆæœ¬ ğŸ” 1 nginx -v 2. æŸ¥çœ‹è¯¦ç»†ç‰ˆæœ¬å’Œç¼–è¯‘ä¿¡æ¯ ğŸ“¦ 1 nginx -V 3. å®‰è£… Nginx (Ubuntu/Debian) â¬‡ï¸ 1 2 sudo apt update sudo apt install nginx -y 4. å®‰è£… Nginx (CentOS/RHEL) â¬‡ï¸ 1 2 sudo yum install epel-release -y sudo yum install nginx -y 5. å‡çº§ Nginx ç‰ˆæœ¬ â¬†ï¸ 1 sudo apt upgrade nginx 6. å¸è½½ Nginxï¼ˆä¿ç•™é…ç½®æ–‡ä»¶ï¼‰ğŸ—‘ï¸ 1 sudo apt remove nginx nginx-common -y 7. å®Œå…¨å¸è½½ Nginxï¼ˆåˆ é™¤é…ç½®æ–‡ä»¶ï¼‰ğŸ”¥ 1 sudo apt remove --purge nginx nginx-common -y 8. å½»åº•æ¸…é™¤ Nginxï¼ˆåˆ é™¤æ‰€æœ‰ç›¸å…³æ–‡ä»¶ï¼‰ğŸ’¥ 1 sudo apt autoremove --purge nginx -y ğŸš€ äºŒã€æœåŠ¡æ§åˆ¶å‘½ä»¤ 1. å¯åŠ¨ Nginx æœåŠ¡ â–¶ï¸ 1 sudo systemctl start nginx 2. åœæ­¢ Nginx æœåŠ¡ â¹ï¸ 1 sudo systemctl stop nginx 3. é‡å¯ Nginx æœåŠ¡ ğŸ”„ 1 sudo systemctl restart nginx 4. æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€ ğŸ“Š 1 sudo systemctl status nginx 5. è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨ ğŸ“ˆ 1 sudo systemctl enable nginx 6. ç¦ç”¨å¼€æœºè‡ªåŠ¨å¯åŠ¨ ğŸ“‰ 1 sudo systemctl disable nginx 7. æ£€æŸ¥æ˜¯å¦å·²å¯ç”¨å¼€æœºå¯åŠ¨ âœ… 1 sudo systemctl is-enabled nginx 8. é‡æ–°åŠ è½½ Bash é…ç½® ğŸ”§ 1 source ~/.bashrc 9. æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„ Nginx è¿›ç¨‹ ğŸ‘€ 1 ps aux | grep nginx âš™ï¸ ä¸‰ã€é…ç½®æµ‹è¯•ä¸é‡è½½ 1. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡® ğŸ§ª 1 nginx -t 2. æŸ¥çœ‹ Nginx æœ€ç»ˆç”Ÿæ•ˆçš„é…ç½® ğŸ“ 1 nginx -T 3. é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ğŸ”„ 1 nginx -s reload 4. æµ‹è¯•ç‰¹å®šé…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡® ğŸ¯ 1 nginx -t -c /etc/nginx/conf.d/xunlei.conf 5. ä¼˜é›…åœæ­¢ Nginxï¼ˆå¤„ç†å®Œå½“å‰è¯·æ±‚ï¼‰ğŸ›‘ 1 nginx -s quit 6. ç«‹å³åœæ­¢ Nginx âš¡ 1 nginx -s stop 7. é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ ğŸ“‚ 1 nginx -s reopen ğŸ“Š å››ã€æ—¥å¿—ä¸ç›‘æ§ 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿— ğŸ“– 1 cat /var/log/nginx/error.log 2. å®æ—¶è·Ÿè¸ªé”™è¯¯æ—¥å¿— ğŸ¥ 1 sudo tail -f /var/log/nginx/error.log 3. æŸ¥çœ‹è®¿é—®æ—¥å¿— ğŸ“– 1 cat /var/log/nginx/access.log 4. å®æ—¶è·Ÿè¸ªè®¿é—®æ—¥å¿— ğŸ¥ 1 sudo tail -f /var/log/nginx/access.log 5. ä½¿ç”¨ journalctl æŸ¥çœ‹æ—¥å¿— ğŸ–¥ï¸ 1 sudo journalctl -u nginx 6. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰â° 1 sudo tail -f /var/log/nginx/access.log | awk \u0026#39;{print strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;), $0}\u0026#39; 7. æŸ¥çœ‹ 80 ç«¯å£å ç”¨æƒ…å†µ ğŸ” 1 netstat -tulnp | grep \u0026#34;:80\u0026#34; 8. æŸ¥çœ‹ 443 ç«¯å£å ç”¨æƒ…å†µ ğŸ” 1 netstat -tulnp | grep \u0026#34;:443\u0026#34; 9. ç›‘æ§ Nginx è¿æ¥æ•° ğŸ“ˆ 1 netstat -an | grep :80 | wc -l ğŸ› ï¸ äº”ã€é«˜çº§è°ƒè¯•å‘½ä»¤ 1. æŸ¥çœ‹ Nginx è¿›ç¨‹ä¿¡æ¯ ğŸ” 1 ps aux | grep nginx 2. æ£€æŸ¥é…ç½®æ–‡ä»¶åŒ…å«å…³ç³» ğŸ§© 1 nginx -T | grep include 3. æŸ¥çœ‹ç¼–è¯‘æ—¶æ¨¡å—ä¿¡æ¯ ğŸ“¦ 1 nginx -V 4. æ£€æŸ¥ç‰¹å®šè™šæ‹Ÿä¸»æœºé…ç½® ğŸ¯ 1 nginx -T | grep -A 20 -B 5 \u0026#34;server_name example.com\u0026#34; 5. æŸ¥çœ‹å½“å‰è¿æ¥æ•°ç»Ÿè®¡ ğŸ“Š 1 netstat -an | grep :80 | awk \u0026#39;{print $6}\u0026#39; | sort | uniq -c | sort -n 6. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ç›‘å¬ç«¯å£ ğŸ§ 1 nginx -T | grep \u0026#34;listen\u0026#34; 7. æŸ¥çœ‹æœåŠ¡å™¨åç§°é…ç½® ğŸŒ 1 nginx -T | grep \u0026#34;server_name\u0026#34; 8. è°ƒè¯•ç‰¹å®š IP çš„è¿æ¥ ğŸ” 1 tcpdump -i any -n host 192.168.1.100 and port 80 ğŸ¯ å…­ã€å®æˆ˜æ¡ˆä¾‹ï¼šNginxå›¾åºŠæœåŠ¡éƒ¨ç½² ğŸŒŸ æ¦‚è¿° æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä½¿ç”¨ Nginx éƒ¨ç½²ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„å›¾åºŠæœåŠ¡ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼çš„è®¿é—®å’Œä¸‹è½½ï¼Œå¹¶æä¾› SSL åŠ å¯†ä¿éšœå®‰å…¨æ€§ã€‚\nå›¾åºŠåœ°å€ç¤ºä¾‹ï¼š\næ ¹ç›®å½•: https://blog.mobufan.eu.org:666/ ç¤ºä¾‹å›¾ç‰‡: https://blog.mobufan.eu.org:666/img/tmdb-01.jpg ğŸš€ å¿«é€Ÿéƒ¨ç½²è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 # åˆ›å»ºå¿…è¦çš„ç›®å½• sudo mkdir -pm 755 /etc/nginx/conf.d /mnt/file/blog # åˆ›å»ºå¹¶é…ç½® Nginx å›¾åºŠæœåŠ¡ sudo tee /etc/nginx/conf.d/blog.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { # SSL ç›‘å¬é…ç½® listen 666 ssl; server_name blog.mobufan.eu.org; # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_ciphers HIGH:!aNULL:!MD5; # é™æ€æ–‡ä»¶å¤„ç† location ~ .*\\.(gif|jpg|lrc|txt|doc|pdf|rar|gz|zip|jpeg|png|mp4|mkv|html|yaml)$ { root /mnt/file/blog; # ç‰¹å®šæ–‡ä»¶ç±»å‹å¼ºåˆ¶ä¸‹è½½ if ($request_filename ~* ^.*?\\.(txt|doc|pdf|rar|gz|zip|lrc|docx|exe|xlsx|ppt|pptx|yaml)$){ add_header Content-Disposition attachment; } autoindex on; sendfile on; autoindex_localtime on; autoindex_format html; autoindex_exact_size off; charset utf-8,gbk; expires 24h; # æ€§èƒ½ä¼˜åŒ–é…ç½® client_max_body_size 10m; client_body_buffer_size 1280k; proxy_connect_timeout 900; proxy_send_timeout 900; proxy_read_timeout 900; } # å¤„ç†æ— åç¼€åæ–‡ä»¶ location ~* ^/[^.]+$ { root /mnt/file/blog; add_header Content-Disposition \u0026#34;attachment; filename=$uri\u0026#34;; autoindex on; sendfile on; autoindex_localtime on; autoindex_format html; autoindex_exact_size off; charset utf-8,gbk; expires 24h; } } EOF # é‡å¯ Nginx æœåŠ¡ sudo systemctl restart nginx ğŸ“ ç›®å½•ç»“æ„è®¾ç½® åˆ›å»ºå›¾åºŠç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 # åˆ›å»ºä¸»å›¾åºŠç›®å½• sudo mkdir -p /mnt/file/blog/{img,videos,documents,downloads} # è®¾ç½®æ­£ç¡®çš„æƒé™ sudo chown -R www-data:www-data /mnt/file/blog sudo chmod -R 755 /mnt/file/blog # åˆ›å»ºæµ‹è¯•æ–‡ä»¶ sudo touch /mnt/file/blog/img/tmdb-01.jpg ğŸ” SSL è¯ä¹¦é…ç½® ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆå¦‚æœè¿˜æ²¡æœ‰è¯ä¹¦ï¼‰ 1 2 3 4 5 6 7 8 # åˆ›å»ºè¯ä¹¦ç›®å½• sudo mkdir -p /etc/nginx/keyfile # ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \\ -keyout /etc/nginx/keyfile/key.pem \\ -out /etc/nginx/keyfile/cert.pem \\ -subj \u0026#34;/C=CN/ST=Beijing/L=Beijing/O=IT/CN=blog.mobufan.eu.org\u0026#34; âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£ ä¸»è¦é…ç½®åŠŸèƒ½ é…ç½®é¡¹ åŠŸèƒ½è¯´æ˜ æ¨èå€¼ ssl_protocols æ”¯æŒçš„ SSL åè®®ç‰ˆæœ¬ TLSv1 TLSv1.1 TLSv1.2 autoindex on å¯ç”¨ç›®å½•æµè§ˆ å¼€å¯ charset å­—ç¬¦ç¼–ç è®¾ç½® utf-8,gbk expires æµè§ˆå™¨ç¼“å­˜æ—¶é—´ 24h client_max_body_size æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å° 10m æ”¯æŒçš„æ–‡ä»¶ç±»å‹ å›¾ç‰‡: gif, jpg, jpeg, png æ–‡æ¡£: txt, doc, pdf, docx, ppt, pptx å‹ç¼©åŒ…: rar, gz, zip è§†é¢‘: mp4, mkv å…¶ä»–: lrc, yaml, html ğŸ› ï¸ é«˜çº§é…ç½®é€‰é¡¹ 1. æ·»åŠ é˜²ç›—é“¾ä¿æŠ¤ 1 2 3 4 5 # åœ¨ location å—ä¸­æ·»åŠ é˜²ç›—é“¾é…ç½® valid_referers none blocked server_names *.mobufan.eu.org; if ($invalid_referer) { return 403; } 2. å¯ç”¨ Gzip å‹ç¼© 1 2 3 4 # åœ¨ http æˆ– server å—ä¸­æ·»åŠ  gzip on; gzip_types image/jpeg image/png image/gif text/plain application/pdf; gzip_comp_level 6; 3. æ·»åŠ å®‰å…¨å¤´ 1 2 3 4 # å¢å¼ºå®‰å…¨æ€§ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. è°ƒæ•´ç¼“å†²åŒºå¤§å° 1 2 3 4 # åœ¨ http å—ä¸­è°ƒæ•´ client_body_buffer_size 128k; client_max_body_size 20m; large_client_header_buffers 4 256k; 2. å¯ç”¨ç¼“å­˜ä¼˜åŒ– 1 2 3 4 5 # é™æ€èµ„æºç¼“å­˜ location ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ { expires 30d; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } 3. è¿æ¥ä¼˜åŒ– 1 2 3 # ä¿æŒè¿æ¥è®¾ç½® keepalive_timeout 65; keepalive_requests 100; ğŸ› æ•…éšœæ’é™¤ 1. æ£€æŸ¥é…ç½®è¯­æ³• 1 sudo nginx -t 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿— 1 sudo tail -f /var/log/nginx/error.log 3. æ£€æŸ¥æ–‡ä»¶æƒé™ 1 2 3 4 5 6 # æ£€æŸ¥ç›®å½•æƒé™ ls -la /mnt/file/blog/ # ä¿®å¤æƒé™é—®é¢˜ sudo chown -R www-data:www-data /mnt/file/blog sudo chmod -R 755 /mnt/file/blog 4. æµ‹è¯• SSL è¯ä¹¦ 1 2 3 4 5 # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæ€§ openssl x509 -in /etc/nginx/keyfile/cert.pem -text -noout # æµ‹è¯• SSL è¿æ¥ curl -v -k https://blog.mobufan.eu.org:666/ ğŸ“Š ç›‘æ§å’Œç»´æŠ¤ 1. è®¾ç½®æ—¥å¿—è½®è½¬ 1 2 # æ£€æŸ¥ logrotate é…ç½® sudo nano /etc/logrotate.d/nginx 2. ç›‘æ§ç£ç›˜ä½¿ç”¨ 1 2 3 4 5 # è®¾ç½®ç£ç›˜ä½¿ç”¨ç›‘æ§ df -h /mnt/file/blog # è®¾ç½®è‡ªåŠ¨æ¸…ç†æ—§æ–‡ä»¶ find /mnt/file/blog -type f -mtime +30 -delete 3. å¤‡ä»½é…ç½® 1 2 # å¤‡ä»½ Nginx é…ç½® sudo tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx/ ğŸš€ éƒ¨ç½²éªŒè¯ 1. æµ‹è¯•å›¾åºŠåŠŸèƒ½ 1 2 3 4 5 6 7 8 # ä¸Šä¼ æµ‹è¯•æ–‡ä»¶ sudo cp /path/to/test-image.jpg /mnt/file/blog/img/ # æµ‹è¯•è®¿é—® curl -I https://blog.mobufan.eu.org:666/img/test-image.jpg # æµ‹è¯•ç›®å½•åˆ—è¡¨ curl -k https://blog.mobufan.eu.org:666/img/ 2. æ€§èƒ½æµ‹è¯• 1 2 3 4 5 # å®‰è£…æµ‹è¯•å·¥å…· sudo apt install apache2-utils # è¿›è¡Œå‹åŠ›æµ‹è¯• ab -n 1000 -c 10 https://blog.mobufan.eu.org:666/img/tmdb-01.jpg âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ å®šæœŸæ›´æ–° SSL è¯ä¹¦ ç›‘æ§å¼‚å¸¸è®¿é—® patterns è®¾ç½®æ–‡ä»¶ä¸Šä¼ é™åˆ¶ å®šæœŸæ£€æŸ¥æ–‡ä»¶å†…å®¹ å¯ç”¨è®¿é—®æ—¥å¿—åˆ†æ è€ƒè™‘æ·»åŠ èº«ä»½éªŒè¯ ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ä¸æç¤º 1. é…ç½®æ£€æŸ¥æµç¨‹ âœ… 1 2 3 4 5 # æ¨èçš„æ“ä½œé¡ºåº nginx -t # å…ˆæ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡® sudo nginx -T \u0026gt; nginx.conf # å¯¼å‡ºå½“å‰é…ç½®å¤‡ä»½ sudo systemctl restart nginx # å†é‡å¯æœåŠ¡ sudo systemctl status nginx # æœ€åç¡®è®¤çŠ¶æ€ 2. æ—¥å¿—è½®è½¬ ğŸ”„ 1 2 3 4 5 6 7 # ä½¿ç”¨ logrotate è‡ªåŠ¨ç®¡ç†æ—¥å¿— sudo logrotate -f /etc/logrotate.d/nginx # æ‰‹åŠ¨åˆ‡å‰²æ—¥å¿— sudo mv /var/log/nginx/access.log /var/log/nginx/access.log.$(date +%Y%m%d) sudo mv /var/log/nginx/error.log /var/log/nginx/error.log.$(date +%Y%m%d) sudo nginx -s reopen 3. æ€§èƒ½ç›‘æ§ ğŸ“ˆ 1 2 3 4 5 6 7 8 # ç›‘æ§ Nginx è¿æ¥æ•° watch -n 1 \u0026#34;netstat -an | grep :80 | wc -l\u0026#34; # æŸ¥çœ‹å‰10ä¸ªè®¿é—®æœ€å¤šçš„IP awk \u0026#39;{print $1}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 # æŸ¥çœ‹æœ€é¢‘ç¹è®¿é—®çš„URL awk \u0026#39;{print $7}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 4. å®‰å…¨æ£€æŸ¥ ğŸ”’ 1 2 3 4 5 6 7 8 # æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™ find /etc/nginx -type f -exec ls -la {} \\; # æ£€æŸ¥SSLé…ç½® sudo nginx -T | grep ssl_ # æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´ echo | openssl s_client -connect example.com:443 2\u0026gt;/dev/null | openssl x509 -noout -dates 5. å¤‡ä»½é…ç½® ğŸ“‚ 1 2 3 4 5 # å¤‡ä»½å½“å‰é…ç½® sudo tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx # å¯¼å‡ºå½“å‰ç”Ÿæ•ˆçš„é…ç½® sudo nginx -T \u0026gt; nginx-config-$(date +%Y%m%d).conf ğŸš¨ å…«ã€æ•…éšœæ’é™¤æŒ‡å— å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š ç«¯å£è¢«å ç”¨ âŒ\n1 2 3 4 # æŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ sudo lsof -i :80 # æˆ–è€… sudo netstat -tulnp | grep \u0026#34;:80\u0026#34; é…ç½®æ–‡ä»¶é”™è¯¯ ğŸ›\n1 2 3 4 # è¯¦ç»†æ£€æŸ¥é…ç½®é”™è¯¯ sudo nginx -t # æ£€æŸ¥ç‰¹å®šé…ç½®æ®µ sudo nginx -T | grep -A 10 -B 10 \u0026#34;error\u0026#34; æƒé™é—®é¢˜ ğŸ”\n1 2 3 4 5 # æ£€æŸ¥Nginxç”¨æˆ·æƒé™ sudo -u nginx stat /var/www/html # ä¿®å¤æ–‡ä»¶æƒé™ sudo chown -R nginx:nginx /var/www/html sudo chmod -R 755 /var/www/html æ¨¡å—ç¼ºå¤± ğŸ“¦\n1 2 3 4 # æŸ¥çœ‹å·²ç¼–è¯‘æ¨¡å— nginx -V 2\u0026gt;\u0026amp;1 | grep -- \u0026#39;--with-\u0026#39; # æŸ¥çœ‹åŠ¨æ€åŠ è½½çš„æ¨¡å— sudo nginx -T | grep \u0026#34;load_module\u0026#34; æ€§èƒ½é—®é¢˜ ğŸ¢\n1 2 3 4 # æ£€æŸ¥å·¥ä½œè¿›ç¨‹æ•°é‡ ps aux | grep nginx | grep -v grep | wc -l # ç›‘æ§æœåŠ¡å™¨çŠ¶æ€ sudo nginx -T | grep -i \u0026#34;status\u0026#34; SSLè¯ä¹¦é—®é¢˜ ğŸ”’\n1 2 3 4 # æ£€æŸ¥è¯ä¹¦é“¾ openssl s_client -connect example.com:443 -servername example.com # éªŒè¯è¯ä¹¦ openssl verify -CAfile /path/to/ca.crt /path/to/site.crt ğŸ’¡ æç¤ºï¼šä¿®æ”¹é…ç½®åï¼ŒåŠ¡å¿…ä½¿ç”¨ nginx -t æµ‹è¯•è¯­æ³•ï¼Œç„¶åå†é‡è½½é…ç½®ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®å˜æ›´ã€‚\nç´§æ€¥æ¢å¤æ­¥éª¤ ğŸ†˜ å¤‡ä»½å½“å‰é…ç½®ï¼šsudo cp -r /etc/nginx /etc/nginx.backup æ£€æŸ¥é…ç½®ï¼šsudo nginx -t å¦‚æœé…ç½®é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½ï¼šsudo cp -r /etc/nginx.backup/* /etc/nginx/ é‡å¯æœåŠ¡ï¼šsudo systemctl restart nginx æŸ¥çœ‹æ—¥å¿—ï¼šsudo tail -f /var/log/nginx/error.log é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å°†èƒ½å¤Ÿå…¨é¢æŒæ¡ Nginx çš„ç®¡ç†å‘½ä»¤å¹¶æˆåŠŸéƒ¨ç½²ä¸€ä¸ªé«˜æ€§èƒ½ã€å®‰å…¨çš„å›¾åºŠæœåŠ¡ã€‚è®°å¾—æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®å‚æ•°ï¼Œå¹¶å®šæœŸè¿›è¡Œç»´æŠ¤å’Œç›‘æ§ã€‚ğŸ¯\n","date":"2024-12-12T22:32:12+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/fc7f603d/","title":"Nginx å›¾åºŠæœåŠ¡éƒ¨ç½² ğŸ–¼ï¸"},{"content":"Vercel åšå®¢å›¾åºŠä½¿ç”¨æŒ‡å— ğŸŒŸ å¿«é€Ÿã€ç¨³å®šä¸”å…è´¹çš„å›¾ç‰‡æ‰˜ç®¡æ–¹æ¡ˆï¼Œå®Œç¾é€‚é…åšå®¢ä¸æ–‡æ¡£ç«™ç‚¹\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ–¼ï¸ å°é¢å›¾ç‰‡ ğŸ“¸ æˆªå›¾ç¤ºä¾‹ âœ‚ï¸ åˆ†å‰²çº¿ ğŸ’¡ ä½¿ç”¨å»ºè®® ğŸ¯ é€‚ç”¨åœºæ™¯ âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸŒ å…¨çƒCDNåŠ é€Ÿ â€“ åŸºäº Vercel è¾¹ç¼˜ç½‘ç»œï¼Œå®ç°å›¾ç‰‡æé€ŸåŠ è½½ ğŸ–¼ï¸ æ”¯æŒWebPæ ¼å¼ â€“ ä¸‹ä¸€ä»£å›¾åƒæ ¼å¼ï¼Œä½“ç§¯æ›´å°ç”»è´¨æ›´æ¸…æ™° ğŸš€ ç®€å•æ˜“ç”¨ â€“ ç›´é“¾å¼•ç”¨ï¼Œæ”¯æŒ Markdown å’Œ HTML å¤šç§åµŒå…¥æ–¹å¼ ğŸ”’ ç¨³å®šå¯é  â€“ åŸºäº Vercel å¹³å°ï¼Œæä¾›é«˜å¯ç”¨æ€§æœåŠ¡ ğŸ†“ å®Œå…¨å…è´¹ â€“ æ— æˆæœ¬ä½¿ç”¨ï¼Œæ— éœ€æ³¨å†Œæˆ–é…ç½® ğŸ“ åˆ†ç±»æ˜ç¡® â€“ æä¾›å°é¢ã€æˆªå›¾ã€åŠ¨å›¾ç­‰åˆ†ç±»å­˜å‚¨ ğŸ–¼ï¸ å°é¢å›¾ç‰‡ 1 ![](https://file.meimolihan.eu.org/img/git-01.webp) é€‚ç”¨äºæ–‡ç« é¡¶éƒ¨å°é¢ã€ç‰¹è‰²å›¾ç‰‡ç­‰åœºæ™¯ ğŸ“¸ æˆªå›¾ç¤ºä¾‹ 1 ![](https://file.meimolihan.eu.org/screenshot/uptime-kuma-005.webp) é€‚ç”¨äºæŠ€æœ¯æ–‡æ¡£ã€æ•™ç¨‹æ­¥éª¤å±•ç¤ºç­‰åœºæ™¯ âœ‚ï¸ åˆ†å‰²çº¿ 1 ![](https://file.meimolihan.eu.org/gif/gif-001.gif) é€‚ç”¨äºæ–‡ç« åˆ†åŒºã€è£…é¥°æ€§å…ƒç´ æˆ–åŠ¨æ€æ•ˆæœå±•ç¤º ğŸ’¡ ä½¿ç”¨å»ºè®® å›¾ç‰‡ä¼˜åŒ–ï¼šå»ºè®®ä¸Šä¼ å‰å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©ä¼˜åŒ–ï¼Œå¹³è¡¡è´¨é‡ä¸å¤§å° æ ¼å¼é€‰æ‹©ï¼šä¼˜å…ˆä½¿ç”¨ WebP æ ¼å¼ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½è¡¨ç° åˆ†ç±»å­˜å‚¨ï¼šæŒ‰ç”¨é€”å°†å›¾ç‰‡å­˜æ”¾åœ¨å¯¹åº”ç›®å½•ï¼Œä¾¿äºç®¡ç† å¤‡ä»½æ„è¯†ï¼šé‡è¦å›¾ç‰‡å»ºè®®æœ¬åœ°ä¿ç•™å¤‡ä»½ï¼Œè™½ç„¶æœåŠ¡ç¨³å®šä½†ä»éœ€è°¨æ… ğŸ¯ é€‚ç”¨åœºæ™¯ âœ… ä¸ªäººåšå®¢å›¾ç‰‡æ‰˜ç®¡ âœ… æŠ€æœ¯æ–‡æ¡£æˆªå›¾å±•ç¤º âœ… GitHub README å›¾ç‰‡å¼•ç”¨ âœ… é™æ€ç½‘ç«™åª’ä½“èµ„æº âœ… ä¸´æ—¶å›¾ç‰‡åˆ†äº«é“¾æ¥ ğŸ“ æç¤ºï¼šæœ¬å›¾åºŠæœåŠ¡åŸºäº Vercel å¹³å°æ­å»ºï¼Œæä¾›ç¨³å®šå…è´¹çš„å›¾ç‰‡å¤–é“¾æœåŠ¡ï¼Œé€‚åˆä¸ªäººåšå®¢å’Œå°å‹é¡¹ç›®ä½¿ç”¨ã€‚å¦‚éœ€å¤§é‡å­˜å‚¨æˆ–å•†ä¸šç”¨é€”ï¼Œè¯·è€ƒè™‘è‡ªå»ºå›¾åºŠæ–¹æ¡ˆã€‚\n","date":"2024-12-11T17:34:21+08:00","image":"https://file.meimolihan.eu.org/img/vercel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1794c866/","title":"Vercel åšå®¢å›¾åºŠä½¿ç”¨æŒ‡å— ğŸŒŸ"},{"content":"Certbot SSL è¯ä¹¦ç®¡ç† \u0026amp; DNSéªŒè¯ ğŸ” ğŸŒ è‡ªåŠ¨åŒ– SSL è¯ä¹¦ç®¡ç†ï¼Œä¸ºä½ çš„ç½‘ç«™æä¾›å…è´¹ HTTPS åŠ å¯†\nç›®å½• ğŸ”— Certbot ç®€ä»‹ ğŸ“¦ å®‰è£…ä¸é…ç½® ğŸ” DNS éªŒè¯ç”³è¯· ğŸ”„ è¯ä¹¦ç®¡ç† â° è‡ªåŠ¨ç»­ç­¾ ğŸ”§ æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µ ğŸ”— Certbot ç®€ä»‹ ğŸŒŸ ä»€ä¹ˆæ˜¯ Certbotï¼Ÿ Certbot æ˜¯ç”± Electronic Frontier Foundation (EFF) å¼€å‘çš„å¼€æºå·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç®¡ç†å’Œéƒ¨ç½² SSL/TLS è¯ä¹¦ã€‚ä¸ Let\u0026rsquo;s Encrypt åˆä½œï¼Œæä¾›å…è´¹çš„ SSL è¯ä¹¦æœåŠ¡ã€‚\nğŸ”— é‡è¦é“¾æ¥ ğŸŒ å®˜ç½‘: https://certbot.eff.org/ ğŸ“š æ–‡æ¡£: https://eff-certbot.readthedocs.io/ ğŸ‡¨ğŸ‡³ ä¸­æ–‡å®˜ç½‘: https://certbot.openssl.ac.cn/ ğŸ’» GitHub: https://github.com/certbot/certbot ğŸ¯ ä¸»è¦ç‰¹æ€§ âœ… å…è´¹ SSL è¯ä¹¦ âœ… è‡ªåŠ¨ç»­ç­¾ âœ… å¤šåŸŸåæ”¯æŒ âœ… é€šé…ç¬¦è¯ä¹¦ âœ… å¤šç§éªŒè¯æ–¹å¼ï¼ˆHTTPã€DNSã€TLS-SNIï¼‰ âœ… æ”¯æŒå¤šç§WebæœåŠ¡å™¨ï¼ˆNginxã€Apacheç­‰ï¼‰ âœ… è·¨å¹³å°æ”¯æŒï¼ˆLinuxã€Windowsã€macOSï¼‰ ğŸ“¦ å®‰è£…ä¸é…ç½® ğŸ§ ç³»ç»Ÿå®‰è£…å‘½ä»¤ Debian/Ubuntu 1 sudo apt update \u0026amp;\u0026amp; sudo apt install -y certbot python3-certbot-nginx ğŸ”´ CentOS/RHEL 1 sudo yum update \u0026amp;\u0026amp; sudo yum install -y certbot python3-certbot-nginx ğŸ”ï¸ Alpine Linux 1 sudo apk update \u0026amp;\u0026amp; sudo apk add certbot ğŸ§ Fedora 1 sudo dnf update \u0026amp;\u0026amp; sudo dnf install -y certbot python3-certbot-nginx ğŸ” éªŒè¯å®‰è£… 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç‰ˆæœ¬ certbot --version # æŸ¥çœ‹å¸®åŠ© certbot --help # æ£€æŸ¥æ’ä»¶ certbot plugins ğŸ“ ç›®å½•ç»“æ„ 1 2 3 4 5 /etc/letsencrypt/ â”œâ”€â”€ live/ # å½“å‰è¯ä¹¦ç¬¦å·é“¾æ¥ â”œâ”€â”€ archive/ # å†å²è¯ä¹¦å­˜æ¡£ â”œâ”€â”€ renewal/ # ç»­è®¢é…ç½® â””â”€â”€ keys/ # ç§é’¥æ–‡ä»¶ ğŸ” DNS éªŒè¯ç”³è¯· ğŸ¯ DNS éªŒè¯çš„ä¼˜åŠ¿ ğŸŒ æ”¯æŒé€šé…ç¬¦è¯ä¹¦ (*.example.com) ğŸ”§ æ— éœ€å¼€æ”¾æœåŠ¡å™¨ç«¯å£ ğŸš€ é€‚åˆå›½å†…ç½‘ç»œç¯å¢ƒ ğŸ”’ æ›´å®‰å…¨ï¼Œä¸éœ€è¦æš´éœ²æœåŠ¡å™¨åˆ°å…¬ç½‘ âš¡ éªŒè¯è¿‡ç¨‹æ›´å¿«ï¼Œæ— éœ€ç­‰å¾…HTTPè¯·æ±‚ ğŸ“ ç”³è¯·é€šé…ç¬¦è¯ä¹¦ 1 2 3 4 5 6 # ç”³è¯·é€šé…ç¬¦è¯ä¹¦ sudo certbot certonly --manual --preferred-challenges dns \\ -d \u0026#34;mobufan.eu.org\u0026#34; \\ -d \u0026#34;*.mobufan.eu.org\u0026#34; \\ --register-unsafely-without-email \\ --agree-tos ğŸ”§ DNS è®°å½•é…ç½®æ­¥éª¤ è·å– TXT è®°å½•ä¿¡æ¯\n1 2 3 4 5 # æ‰§è¡Œå‘½ä»¤å Certbot ä¼šæ˜¾ç¤ºï¼š # Please deploy a DNS TXT record under the name: # _acme-challenge.mobufan.eu.org # with the following value: # psR23wa2k5tVJws7gUhfwpVI5MclBOfvOaOmKyn51w8 æ·»åŠ  DNS è®°å½•\nç™»å½•åŸŸåæ§åˆ¶é¢æ¿ æ·»åŠ  TXT è®°å½•ï¼š åç§°: _acme-challenge å€¼: psR23wa2k5tVJws7gUhfwpVI5MclBOfvOaOmKyn51w8 TTL: 300 (5åˆ†é’Ÿ) ç­‰å¾… DNS ä¼ æ’­\n1 2 3 # éªŒè¯ DNS è®°å½• dig TXT _acme-challenge.mobufan.eu.org nslookup -type=TXT _acme-challenge.mobufan.eu.org å®ŒæˆéªŒè¯\nç­‰å¾… 2-5 åˆ†é’Ÿè®© DNS ç”Ÿæ•ˆ è¿”å›ç»ˆç«¯æŒ‰å›è½¦ç»§ç»­ ğŸ“Š è¯ä¹¦æ–‡ä»¶ä½ç½® 1 2 3 4 5 6 # è¯ä¹¦æ–‡ä»¶è·¯å¾„ /etc/letsencrypt/live/mobufan.eu.org/ â”œâ”€â”€ fullchain.pem # å®Œæ•´è¯ä¹¦é“¾ â”œâ”€â”€ privkey.pem # ç§é’¥æ–‡ä»¶ â”œâ”€â”€ cert.pem # è¯ä¹¦æ–‡ä»¶ â””â”€â”€ chain.pem # ä¸­é—´è¯ä¹¦ ğŸ”„ åŒæ­¥åˆ° Nginx 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»º SSL ç›®å½• sudo mkdir -p /etc/nginx/ssl # åŒæ­¥è¯ä¹¦åˆ° Nginx sudo cp /etc/letsencrypt/live/mobufan.eu.org/fullchain.pem /etc/nginx/ssl/cert.pem sudo cp /etc/letsencrypt/live/mobufan.eu.org/privkey.pem /etc/nginx/ssl/key.pem # è®¾ç½®æ­£ç¡®æƒé™ sudo chmod 644 /etc/nginx/ssl/cert.pem sudo chmod 600 /etc/nginx/ssl/key.pem sudo chown -R www-data:www-data /etc/nginx/ssl/ ğŸ”„ è¯ä¹¦ç®¡ç† ğŸ“‹ æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦ sudo certbot certificates # æŸ¥çœ‹è¯ä¹¦è¯¦æƒ… sudo openssl x509 -in /etc/letsencrypt/live/mobufan.eu.org/cert.pem -text -noout # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ sudo certbot certificates | grep -E \u0026#34;Certificate Name|Expiry\u0026#34; # æ£€æŸ¥è¯ä¹¦è¯¦ç»†ä¿¡æ¯ sudo openssl x509 -in /etc/letsencrypt/live/mobufan.eu.org/cert.pem -noout -dates ğŸ”„ æ‰‹åŠ¨ç»­ç­¾è¯ä¹¦ 1 2 3 4 5 6 7 8 # ç»­ç­¾æ‰€æœ‰è¯ä¹¦ sudo certbot renew # å¼ºåˆ¶ç»­ç­¾ç‰¹å®šè¯ä¹¦ sudo certbot renew --cert-name mobufan.eu.org --force-renewal # æµ‹è¯•ç»­ç­¾ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰ sudo certbot renew --dry-run ğŸ—‘ï¸ æ’¤é”€è¯ä¹¦ 1 2 3 4 5 # æ’¤é”€è¯ä¹¦ sudo certbot revoke --cert-path /etc/letsencrypt/live/mobufan.eu.org/cert.pem # æ’¤é”€å¹¶åˆ é™¤ sudo certbot delete --cert-name mobufan.eu.org ğŸ“¦ å¤‡ä»½è¯ä¹¦ 1 2 3 4 5 6 7 8 # å¤‡ä»½è¯ä¹¦æ–‡ä»¶ sudo tar -czvf ssl-backup-$(date +%Y%m%d).tar.gz /etc/letsencrypt/ # å¯¼å‡ºè¯ä¹¦å’Œç§é’¥ sudo cp -r /etc/letsencrypt/live/mobufan.eu.org/ ~/ssl-backup/ # å¤‡ä»½ç»­è®¢é…ç½® sudo cp -r /etc/letsencrypt/renewal/ ~/ssl-backup/renewal-config/ â° è‡ªåŠ¨ç»­ç­¾ ğŸ• è®¡åˆ’ä»»åŠ¡é…ç½® æ–¹æ³•ä¸€ï¼šç›´æ¥å‘½ä»¤æ–¹å¼ 1 2 3 4 5 6 7 8 9 10 # ç¼–è¾‘ crontab sudo crontab -e # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # æ¯å¤©å‡Œæ™¨ 1:05 è‡ªåŠ¨ç»­ç­¾ 5 1 * * * /usr/bin/certbot renew --quiet --renew-hook \u0026#34;sudo systemctl reload nginx\u0026#34; # æ¯å¤©å‡Œæ™¨ 1:35 åŒæ­¥è¯ä¹¦ 35 1 * * * /bin/cp /etc/letsencrypt/live/mobufan.eu.org/fullchain.pem /etc/nginx/ssl/cert.pem 36 1 * * * /bin/cp /etc/letsencrypt/live/mobufan.eu.org/privkey.pem /etc/nginx/ssl/key.pem æ–¹æ³•äºŒï¼šä½¿ç”¨è„šæœ¬æ–¹å¼ 1 2 3 # åˆ›å»ºç»­ç­¾è„šæœ¬ sudo mkdir -p /opt/scripts/ssl sudo nano /opt/scripts/ssl/certbot-renew.sh ğŸ“ æ™ºèƒ½ç»­ç­¾è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #!/bin/bash # ğŸ“ /opt/scripts/ssl/certbot-renew.sh LOG_FILE=\u0026#34;/var/log/certbot-renew.log\u0026#34; DOMAIN=\u0026#34;mobufan.eu.org\u0026#34; DAYS_BEFORE_EXPIRY=5 echo \u0026#34;$(date): å¼€å§‹æ£€æŸ¥è¯ä¹¦ç»­ç­¾\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # è·å–è¯ä¹¦è¿‡æœŸæ—¶é—´ EXPIRY_DATE=$(openssl x509 -enddate -noout -in /etc/letsencrypt/live/$DOMAIN/cert.pem | cut -d= -f2) EXPIRY_TIMESTAMP=$(date -d \u0026#34;$EXPIRY_DATE\u0026#34; +%s) CURRENT_TIMESTAMP=$(date +%s) DAYS_UNTIL_EXPIRY=$(( ($EXPIRY_TIMESTAMP - $CURRENT_TIMESTAMP) / 86400 )) echo \u0026#34;è¯ä¹¦æœ‰æ•ˆæœŸå‰©ä½™: $DAYS_UNTIL_EXPIRY å¤©\u0026#34; \u0026gt;\u0026gt; $LOG_FILE if [ $DAYS_UNTIL_EXPIRY -le $DAYS_BEFORE_EXPIRY ]; then echo \u0026#34;è¯ä¹¦å³å°†è¿‡æœŸï¼Œå¼€å§‹ç»­ç­¾...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # åœæ­¢ Nginx å¹¶æš‚æ—¶å…³é—­é˜²ç«å¢™ systemctl stop nginx iptables -F ip6tables -F # æ‰§è¡Œç»­ç­¾ if certbot renew --force-renewal; then echo \u0026#34;è¯ä¹¦ç»­ç­¾æˆåŠŸ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # åŒæ­¥åˆ° Nginx cp /etc/letsencrypt/live/$DOMAIN/fullchain.pem /etc/nginx/ssl/cert.pem cp /etc/letsencrypt/live/$DOMAIN/privkey.pem /etc/nginx/ssl/key.pem # é‡å¯ Nginx systemctl restart nginx echo \u0026#34;Nginx é‡å¯å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE else echo \u0026#34;è¯ä¹¦ç»­ç­¾å¤±è´¥\u0026#34; \u0026gt;\u0026gt; $LOG_FILE systemctl start nginx fi else echo \u0026#34;è¯ä¹¦ä»åœ¨æœ‰æ•ˆæœŸå†…ï¼Œæ— éœ€ç»­ç­¾\u0026#34; \u0026gt;\u0026gt; $LOG_FILE fi echo \u0026#34;$(date): è¯ä¹¦æ£€æŸ¥å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE ğŸ”§ è®¾ç½®è„šæœ¬æƒé™ 1 2 sudo chmod +x /opt/scripts/ssl/certbot-renew.sh sudo chown root:root /opt/scripts/ssl/certbot-renew.sh ğŸ“… æ·»åŠ è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 sudo crontab -e # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # æ¯å¤©å‡Œæ™¨ 1:25 æ‰§è¡Œç»­ç­¾è„šæœ¬ 25 1 * * * /opt/scripts/ssl/certbot-renew.sh \u0026gt;\u0026gt; /var/log/certbot-renew.log 2\u0026gt;\u0026amp;1 # æ¯å‘¨æ¸…ç†æ—§æ—¥å¿— 0 3 * * 0 find /var/log -name \u0026#34;certbot*.log\u0026#34; -mtime +30 -delete # æ¯æœˆæ£€æŸ¥è¯ä¹¦çŠ¶æ€ 0 2 1 * * /usr/bin/certbot certificates \u0026gt;\u0026gt; /var/log/certbot-status.log ğŸ”§ æ•…éšœæ’é™¤ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1. DNS éªŒè¯å¤±è´¥ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ DNS è®°å½• dig TXT _acme-challenge.mobufan.eu.org nslookup -type=TXT _acme-challenge.mobufan.eu.org # ä½¿ç”¨å…¶ä»–DNSæœåŠ¡å™¨éªŒè¯ dig @8.8.8.8 TXT _acme-challenge.mobufan.eu.org # æ‰‹åŠ¨éªŒè¯ certbot certonly --manual --preferred-challenges dns --debug 2. è¯ä¹¦ç»­ç­¾å¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ certbot renew --verbose # æ£€æŸ¥è¯ä¹¦çŠ¶æ€ certbot certificates # å¼ºåˆ¶ç»­ç­¾ certbot renew --force-renewal # æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ tail -f /var/log/letsencrypt/letsencrypt.log 3. æƒé™é—®é¢˜ 1 2 3 4 5 6 7 8 # ä¿®å¤è¯ä¹¦æ–‡ä»¶æƒé™ sudo chown -R root:root /etc/letsencrypt/ sudo chmod -R 755 /etc/letsencrypt/ sudo chmod 644 /etc/letsencrypt/live/*/fullchain.pem sudo chmod 600 /etc/letsencrypt/live/*/privkey.pem # æ£€æŸ¥Nginxç”¨æˆ·æƒé™ sudo chown -R www-data:www-data /etc/nginx/ssl/ 4. Nginx é…ç½®é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥ Nginx é…ç½® sudo nginx -t # é‡æ–°åŠ è½½ Nginx sudo systemctl reload nginx # æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿— tail -f /var/log/nginx/error.log # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status sudo iptables -L ğŸ“Š ç›‘æ§å’Œæ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹ Certbot æ—¥å¿— tail -f /var/log/letsencrypt/letsencrypt.log # æŸ¥çœ‹ç»­ç­¾æ—¥å¿— tail -f /var/log/certbot-renew.log # ç›‘æ§è¯ä¹¦æœ‰æ•ˆæœŸ echo \u0026#34;è¯ä¹¦æœ‰æ•ˆæœŸ:\u0026#34; openssl x509 -in /etc/letsencrypt/live/mobufan.eu.org/cert.pem -dates -noout # è®¾ç½®æ—¥å¿—è½®è½¬ sudo nano /etc/logrotate.d/certbot ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 # ä½¿ç”¨å¼ºç§é’¥ sudo openssl dhparam -out /etc/nginx/ssl/dhparam.pem 4096 # é…ç½®å®Œç¾çš„å‰å‘ä¿å¯† # åœ¨ Nginx é…ç½®ä¸­æ·»åŠ ï¼š # ssl_dhparam /etc/nginx/ssl/dhparam.pem; # å¯ç”¨HSTS add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubDomains; preload\u0026#34;; # ä½¿ç”¨å®‰å…¨çš„SSLåè®®å’Œå¯†ç å¥—ä»¶ ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384; ğŸ“¦ å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/bin/bash # è¯ä¹¦å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup/ssl/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR # å¤‡ä»½è¯ä¹¦æ–‡ä»¶ cp -r /etc/letsencrypt/live/ $BACKUP_DIR/ cp -r /etc/letsencrypt/renewal/ $BACKUP_DIR/ cp -r /etc/letsencrypt/archive/ $BACKUP_DIR/ # å¤‡ä»½ Nginx SSL é…ç½® cp -r /etc/nginx/ssl/ $BACKUP_DIR/nginx-ssl/ cp /etc/nginx/sites-available/* $BACKUP_DIR/nginx-config/ # åˆ›å»ºå‹ç¼©å¤‡ä»½åŒ… tar -czf $BACKUP_DIR/ssl-backup-full.tar.gz $BACKUP_DIR echo \u0026#34;å¤‡ä»½å®Œæˆ: $BACKUP_DIR\u0026#34; ğŸ”„ è‡ªåŠ¨åŒ–éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # å®Œæ•´çš„è¯ä¹¦éƒ¨ç½²è„šæœ¬ DOMAIN=\u0026#34;mobufan.eu.org\u0026#34; EMAIL=\u0026#34;admin@mobufan.eu.org\u0026#34; # ç”³è¯·è¯ä¹¦ certbot certonly --manual --preferred-challenges dns \\ -d \u0026#34;$DOMAIN\u0026#34; -d \u0026#34;*.$DOMAIN\u0026#34; \\ --email \u0026#34;$EMAIL\u0026#34; \\ --agree-tos --no-eff-email # æ£€æŸ¥ç”³è¯·ç»“æœ if [ $? -eq 0 ]; then # åˆ›å»ºSSLç›®å½• mkdir -p /etc/nginx/ssl # éƒ¨ç½²åˆ° Nginx cp /etc/letsencrypt/live/$DOMAIN/fullchain.pem /etc/nginx/ssl/cert.pem cp /etc/letsencrypt/live/$DOMAIN/privkey.pem /etc/nginx/ssl/key.pem # è®¾ç½®æƒé™ chmod 644 /etc/nginx/ssl/cert.pem chmod 600 /etc/nginx/ssl/key.pem chown -R www-data:www-data /etc/nginx/ssl/ # é‡è½½ Nginx systemctl reload nginx echo \u0026#34;âœ… è¯ä¹¦éƒ¨ç½²å®Œæˆ\u0026#34; else echo \u0026#34;âŒ è¯ä¹¦ç”³è¯·å¤±è´¥\u0026#34; exit 1 fi ğŸ“‹ å¥åº·æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/bin/bash # SSL å¥åº·æ£€æŸ¥è„šæœ¬ DOMAIN=\u0026#34;mobufan.eu.org\u0026#34; EXPIRY_THRESHOLD=30 ADMIN_EMAIL=\u0026#34;admin@example.com\u0026#34; # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ expiry_date=$(openssl x509 -enddate -noout -in /etc/letsencrypt/live/$DOMAIN/cert.pem | cut -d= -f2) expiry_timestamp=$(date -d \u0026#34;$expiry_date\u0026#34; +%s) current_timestamp=$(date +%s) days_until_expiry=$(( ($expiry_timestamp - $current_timestamp) / 86400 )) # æ£€æŸ¥è¯ä¹¦é“¾å®Œæ•´æ€§ chain_check=$(openssl verify -CAfile /etc/letsencrypt/live/$DOMAIN/chain.pem /etc/letsencrypt/live/$DOMAIN/cert.pem) if [ $days_until_expiry -le $EXPIRY_THRESHOLD ]; then echo \u0026#34;è­¦å‘Š: è¯ä¹¦å°†åœ¨ $days_until_expiry å¤©åè¿‡æœŸ\u0026#34; | mail -s \u0026#34;SSL è¯ä¹¦è­¦å‘Š - $DOMAIN\u0026#34; $ADMIN_EMAIL fi if [[ $chain_check != *\u0026#34;OK\u0026#34;* ]]; then echo \u0026#34;é”™è¯¯: è¯ä¹¦é“¾éªŒè¯å¤±è´¥ - $chain_check\u0026#34; | mail -s \u0026#34;SSL è¯ä¹¦é“¾é”™è¯¯ - $DOMAIN\u0026#34; $ADMIN_EMAIL fi # è¾“å‡ºçŠ¶æ€ä¿¡æ¯ echo \u0026#34;åŸŸå: $DOMAIN\u0026#34; echo \u0026#34;æœ‰æ•ˆæœŸå‰©ä½™: $days_until_expiry å¤©\u0026#34; echo \u0026#34;è¯ä¹¦é“¾æ£€æŸ¥: $chain_check\u0026#34; ğŸ¯ æç¤ºï¼šå»ºè®®å®šæœŸæ£€æŸ¥è¯ä¹¦çŠ¶æ€å¹¶æµ‹è¯•ç»­ç­¾æµç¨‹ã€‚ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯æ‰€æœ‰é…ç½®ã€‚\nğŸ“š æ‰©å±•èµ„æºï¼š\nLet\u0026rsquo;s Encrypt æ–‡æ¡£ SSL æµ‹è¯•å·¥å…· è¯ä¹¦é€æ˜åº¦æ—¥å¿— Mozilla SSL é…ç½®ç”Ÿæˆå™¨ ğŸ”§ ç»´æŠ¤å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æŸ¥çœ‹è¯ä¹¦çŠ¶æ€ sudo certbot certificates # æµ‹è¯•ç»­ç­¾ sudo certbot renew --dry-run # æ¸…ç†æ—§è¯ä¹¦ sudo certbot delete --cert-name example.com # æ›´æ–° Certbot sudo apt update \u0026amp;\u0026amp; sudo apt upgrade certbot # æ£€æŸ¥ç³»ç»Ÿå®šæ—¶ä»»åŠ¡çŠ¶æ€ systemctl status cron crontab -l # éªŒè¯SSLé…ç½® curl -Iv https://your-domain.com openssl s_client -connect your-domain.com:443 -servername your-domain.com ğŸ“ æ›´æ–°æ—¥å¿—ï¼š\n2024-01-01: åˆå§‹æ–‡æ¡£åˆ›å»º 2024-01-15: å¢åŠ DNSéªŒè¯è¯¦ç»†æ­¥éª¤ 2024-02-01: è¡¥å……æ•…éšœæ’é™¤å’Œæœ€ä½³å®è·µ ğŸ‘¥ è´¡çŒ®è€…ï¼š\næ„Ÿè°¢ Certbot å¼€å‘å›¢é˜Ÿ æ„Ÿè°¢ Let\u0026rsquo;s Encrypt æä¾›çš„å…è´¹è¯ä¹¦æœåŠ¡ âš ï¸ å…è´£å£°æ˜ï¼š æœ¬æ–‡æ¡£ä»…ä¾›å‚è€ƒï¼Œè¯·æ ¹æ®å®é™…ç¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚ä½¿ç”¨SSLè¯ä¹¦æ—¶è¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’ŒæœåŠ¡æ¡æ¬¾ã€‚\n","date":"2024-12-11T10:14:45+08:00","image":"https://file.meimolihan.eu.org/img/certbot-01.webp","permalink":"https://blog.meimolihan.eu.org/p/aba26129/","title":"Certbot SSL è¯ä¹¦ç®¡ç† \u0026 DNSéªŒè¯ğŸ”"},{"content":"Nginx æ–‡ä»¶æœåŠ¡å™¨ç¾åŒ–æŒ‡å— ğŸ¨ ğŸŒ æ‰“é€ ç¾è§‚å®ç”¨çš„æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæ”¯æŒå¤šç§ä¸»é¢˜åˆ‡æ¢\nâœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ Nginx æ–‡ä»¶æœåŠ¡å™¨ç¾åŒ–é…ç½®å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nğŸ¨ å¤šç§ä¸»é¢˜æ”¯æŒï¼šæä¾› Material Designã€Bootstrap 4 å’Œæš—è‰²ä¸»é¢˜ç­‰å¤šç§ç¾åŒ–æ–¹æ¡ˆ âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šåŒ…å« Gzip å‹ç¼©ã€ç¼“å­˜é…ç½®å’Œè¿æ¥ä¼˜åŒ–ï¼Œæå‡è®¿é—®é€Ÿåº¦ ğŸ”’ å®‰å…¨å¢å¼ºï¼šé…ç½® SSL åŠ å¯†ã€å®‰å…¨å¤´éƒ¨å’Œè®¿é—®æ§åˆ¶ï¼Œä¿æŠ¤æ•°æ®å®‰å…¨ ğŸ“± å“åº”å¼è®¾è®¡ï¼šä¸»é¢˜é€‚é…å„ç§è®¾å¤‡å±å¹•ï¼Œç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯å‡æœ‰è‰¯å¥½ä½“éªŒ ğŸ”§ æ˜“äºéƒ¨ç½²ï¼šæä¾›ä¸€é”®å®‰è£…è„šæœ¬å’Œè¯¦ç»†é…ç½®è¯´æ˜ï¼Œå¿«é€Ÿä¸Šæ‰‹ ğŸ› ï¸ é«˜åº¦å¯å®šåˆ¶ï¼šå¯æ ¹æ®éœ€è¦è‡ªå®šä¹‰ä¸»é¢˜å’Œé…ç½®ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ ğŸ“– ç›®å½•å¯¼èˆª ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ“¦ Nginx å®‰è£… ğŸ”§ åŸºç¡€é…ç½® ğŸ¨ ä¸»é¢˜ç¾åŒ– âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ”’ å®‰å…¨é…ç½® ğŸ” æ•…éšœæ’é™¤ ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸš€ ä¸€é”®å®‰è£…è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/bin/bash # ğŸ¯ Nginx æ–‡ä»¶æœåŠ¡å™¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬ echo \u0026#34;å¼€å§‹å®‰è£… Nginx æ–‡ä»¶æœåŠ¡å™¨...\u0026#34; # å®‰è£… Nginx sudo apt update sudo apt install nginx libnginx-mod-http-fancyindex -y # åˆ›å»ºç›®å½•ç»“æ„ sudo mkdir -p /etc/nginx/{conf.d,keyfile} /mnt/file /www/theme # è®¾ç½®æƒé™ sudo chmod -R 755 /mnt/file /www/theme sudo chown -R www-data:www-data /mnt/file /www/theme echo \u0026#34;âœ… å®‰è£…å®Œæˆï¼\u0026#34; ğŸ“¦ Nginx å®‰è£… ğŸ§ Debian/Ubuntu å®‰è£… 1 2 3 4 5 6 7 8 9 10 # å®‰è£… Nginx å’Œ fancyindex æ¨¡å— sudo apt install nginx libnginx-mod-http-fancyindex -y # å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl start nginx sudo systemctl enable nginx # éªŒè¯å®‰è£… nginx -v systemctl status nginx ğŸ”§ éªŒè¯æ¨¡å—å®‰è£… 1 2 3 4 5 # æ£€æŸ¥ fancyindex æ¨¡å— nginx -V 2\u0026gt;\u0026amp;1 | grep fancyindex # æŸ¥çœ‹å·²åŠ è½½æ¨¡å— nginx -T | grep load_module ğŸ”§ åŸºç¡€é…ç½® ğŸ“ åŸºç¡€æ–‡ä»¶æœåŠ¡å™¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # /etc/nginx/conf.d/file-server.conf server { listen 80; server_name files.example.com; root /mnt/file; # å¼€å¯ç›®å½•åˆ—è¡¨ autoindex on; autoindex_localtime on; autoindex_exact_size off; # ä¸­æ–‡æ”¯æŒ charset utf-8,gbk; # æ–‡ä»¶ä¸‹è½½è®¾ç½® location ~* \\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx)$ { add_header Content-Disposition attachment; } } ğŸ”’ SSL å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # /etc/nginx/conf.d/ssl-file-server.conf server { listen 443 ssl http2; server_name files.example.com; # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; ssl_prefer_server_ciphers off; # HSTS å®‰å…¨å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; root /mnt/file; autoindex on; # ... å…¶ä»–é…ç½®åŒä¸Š } ğŸ”„ HTTP é‡å®šå‘åˆ° HTTPS 1 2 3 4 5 server { listen 80; server_name files.example.com; return 301 https://$server_name$request_uri; } ğŸ¨ ä¸»é¢˜ç¾åŒ– ğŸŒŸ Material Design ä¸»é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # ä¸‹è½½ Material Design ä¸»é¢˜ sudo mkdir -p /www/theme/material cd /www/theme/material sudo git clone https://github.com/fraoustin/Nginx-Fancyindex-Theme.git material-theme # é…ç½® Nginx sudo tee /etc/nginx/conf.d/material-theme.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name material.example.com; ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; root /mnt/file; fancyindex on; fancyindex_localtime on; fancyindex_exact_size off; fancyindex_name_length 255; fancyindex_header \u0026#34;/theme/material-theme/header.html\u0026#34;; fancyindex_footer \u0026#34;/theme/material-theme/footer.html\u0026#34;; fancyindex_ignore \u0026#34;theme\u0026#34;; charset utf-8,gbk; } EOF ğŸ¨ Bootstrap 4 ä¸»é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # ä¸‹è½½ Bootstrap ä¸»é¢˜ cd /www/theme sudo wget -O bootstrap-theme.tar.gz https://github.com/llorephie/ngx-fancyindex-theme-bootstrap/archive/refs/tags/4.0.0-1.tar.gz sudo tar -xzf bootstrap-theme.tar.gz sudo mv ngx-fancyindex-theme-bootstrap-4.0.0-1 bootstrap-theme sudo rm bootstrap-theme.tar.gz # é…ç½® Nginx sudo tee /etc/nginx/conf.d/bootstrap-theme.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name bootstrap.example.com; ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; root /mnt/file; fancyindex on; fancyindex_localtime on; fancyindex_exact_size off; fancyindex_name_length 255; fancyindex_header \u0026#34;/theme/bootstrap-theme/_index/header.html\u0026#34;; fancyindex_footer \u0026#34;/theme/bootstrap-theme/_index/footer.html\u0026#34;; fancyindex_ignore \u0026#34;theme\u0026#34;; charset utf-8,gbk; } EOF ğŸŒ™ æš—è‰²ä¸»é¢˜é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # ä¸‹è½½æš—è‰²ä¸»é¢˜ cd /www/theme sudo wget -O dark-theme.zip https://github.com/Naereen/Nginx-Fancyindex-Theme/archive/master.zip sudo unzip dark-theme.zip sudo mv Nginx-Fancyindex-Theme-master/Nginx-Fancyindex-Theme-dark/ dark-theme sudo rm -rf Nginx-Fancyindex-Theme-master dark-theme.zip # é…ç½® Nginx sudo tee /etc/nginx/conf.d/dark-theme.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name dark.example.com; ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; root /mnt/file; fancyindex on; fancyindex_localtime on; fancyindex_exact_size off; fancyindex_name_length 255; fancyindex_header \u0026#34;/theme/dark-theme/header.html\u0026#34;; fancyindex_footer \u0026#34;/theme/dark-theme/footer.html\u0026#34;; fancyindex_ignore \u0026#34;theme\u0026#34;; charset utf-8,gbk; } EOF âš¡ æ€§èƒ½ä¼˜åŒ– ğŸš€ ç¼“å­˜å’Œå‹ç¼©é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # /etc/nginx/nginx.conf ä¸­çš„ http å— http { # å¯ç”¨ Gzip å‹ç¼© gzip on; gzip_vary on; gzip_min_length 1024; gzip_types text/plain text/css application/json application/javascript text/xml application/xml; # é™æ€æ–‡ä»¶ç¼“å­˜ open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # ç¼“å†²åŒºä¼˜åŒ– client_body_buffer_size 128k; client_max_body_size 100m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; } ğŸ“Š è¿æ¥ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 server { # ... å…¶ä»–é…ç½® # è¿æ¥è¶…æ—¶è®¾ç½® keepalive_timeout 65; send_timeout 30; client_body_timeout 30; client_header_timeout 30; # æ–‡ä»¶ä¼ è¾“ä¼˜åŒ– sendfile on; tcp_nopush on; tcp_nodelay on; } ğŸ”’ å®‰å…¨é…ç½® ğŸ›¡ï¸ å®‰å…¨å¤´éƒ¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 server { # ... å…¶ä»–é…ç½® # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Referrer-Policy \u0026#34;strict-origin\u0026#34;; # éšè—æœåŠ¡å™¨ä¿¡æ¯ server_tokens off; # é™åˆ¶è¯·æ±‚æ–¹æ³• if ($request_method !~ ^(GET|HEAD|POST)$) { return 444; } } ğŸ” è®¿é—®æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 server { # ... å…¶ä»–é…ç½® # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶ location ~ /\\. { deny all; return 404; } # é™åˆ¶ç‰¹å®šæ–‡ä»¶ç±»å‹è®¿é—® location ~* \\.(log|conf|env)$ { deny all; return 403; } # åŸºæœ¬è®¤è¯ä¿æŠ¤ location /admin { auth_basic \u0026#34;Restricted Area\u0026#34;; auth_basic_user_file /etc/nginx/.htpasswd; } } ğŸ“ åˆ›å»ºå¯†ç æ–‡ä»¶ 1 2 3 4 5 6 # åˆ›å»ºè®¤è¯æ–‡ä»¶ sudo sh -c \u0026#34;echo -n \u0026#39;username:\u0026#39; \u0026gt;\u0026gt; /etc/nginx/.htpasswd\u0026#34; sudo sh -c \u0026#34;openssl passwd -apr1 \u0026gt;\u0026gt; /etc/nginx/.htpasswd\u0026#34; # éªŒè¯æ–‡ä»¶ cat /etc/nginx/.htpasswd ğŸ” æ•…éšœæ’é™¤ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1. é…ç½®è¯­æ³•æ£€æŸ¥ 1 2 3 4 5 6 7 8 # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ sudo nginx -T # é‡æ–°åŠ è½½é…ç½® sudo systemctl reload nginx 2. æƒé™é—®é¢˜ä¿®å¤ 1 2 3 4 5 6 # ä¿®å¤æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /mnt/file sudo chmod -R 755 /mnt/file # ä¿®å¤ä¸»é¢˜æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /www/theme 3. æ—¥å¿—æŸ¥çœ‹ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log # å®æ—¶ç›‘æ§ sudo watch -n 1 \u0026#39;netstat -tulpn | grep nginx\u0026#39; ğŸ”§ è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 # è¯¦ç»†è°ƒè¯•æ¨¡å¼ sudo nginx -t -c /etc/nginx/nginx.conf # æ£€æŸ¥æ¨¡å—åŠ è½½ sudo nginx -V 2\u0026gt;\u0026amp;1 | grep -E \u0026#39;(fancyindex|module)\u0026#39; # æµ‹è¯• SSL é…ç½® sudo openssl s_client -connect localhost:443 -servername files.example.com ğŸ“Š æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ Nginx è¿›ç¨‹çŠ¶æ€ sudo systemctl status nginx sudo ps aux | grep nginx # ç›‘æ§è¿æ¥æ•° sudo netstat -an | grep :443 | wc -l # æŸ¥çœ‹å†…å­˜ä½¿ç”¨ sudo pmap $(pgrep nginx | head -1) | tail -1 ğŸ¯ æç¤ºï¼šå»ºè®®å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’Œä¸»é¢˜æ–‡ä»¶ã€‚ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯é…ç½®ã€‚\nğŸ“š æ¨èèµ„æºï¼š\nNginx å®˜æ–¹æ–‡æ¡£ fancyindex æ¨¡å—æ–‡æ¡£ SSL é…ç½®ç”Ÿæˆå™¨ å®‰å…¨å¤´æ£€æŸ¥å·¥å…· ğŸ”§ ç»´æŠ¤å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 # å¤‡ä»½é…ç½® sudo tar -czvf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx/ /www/theme/ # æ›´æ–°ä¸»é¢˜ cd /www/theme/material-theme \u0026amp;\u0026amp; sudo git pull # æ—¥å¿—è½®è½¬ sudo logrotate -f /etc/logrotate.d/nginx é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªç¾è§‚ä¸”åŠŸèƒ½å¼ºå¤§çš„ Nginx æ–‡ä»¶æœåŠ¡å™¨ã€‚å¦‚æœåœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚\n","date":"2024-12-10T17:54:18+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f9370243/","title":"Nginx æ–‡ä»¶æœåŠ¡å™¨ç¾åŒ–æŒ‡å— ğŸ¨"},{"content":"Docker éƒ¨ç½² XiaoMusic å°çˆ±éŸ³ç®±æ’­æ”¾æœ¬åœ°éŸ³ä¹ ğŸµ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² XiaoMusic 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ XiaoMusic 1. åˆå§‹è®¾ç½®ä¸é…ç½® âš™ï¸ 2. ä½¿ç”¨æŠ€å·§ä¸è¯­éŸ³å£ä»¤ ğŸ—£ï¸ 3. æ›´æ–°éŸ³ä¹åˆ—è¡¨ ğŸ”„ 4. æ”¯æŒçš„éŸ³ä¹æ ¼å¼ä¸è®¾å¤‡ ğŸ“‹ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ¶ å¯èˆªéŸ³ä¹ï¼Œç•…äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ XiaoMusic å®˜ç½‘åœ°å€ï¼š https://xdocs.hanxi.cc/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/hanxi/xiaomusic ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/hanxi/xiaomusic XiaoMusic æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå®ƒå…è®¸æ‚¨é€šè¿‡å°çˆ±éŸ³ç®±æ’­æ”¾æœ¬åœ°éŸ³ä¹æ–‡ä»¶ï¼Œå¹¶åœ¨éŸ³ä¹ä¸å­˜åœ¨æ—¶è‡ªåŠ¨ä»ç½‘ç»œä¸‹è½½ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å°†æ‚¨çš„ NAS æˆ–æœåŠ¡å™¨è½¬å˜ä¸ºä¸ªäººéŸ³ä¹æµåª’ä½“æœåŠ¡ä¸­å¿ƒï¼Œè®©å°çˆ±éŸ³ç®±æ‘†è„±å¹³å°ç‰ˆæƒé™åˆ¶ï¼Œç•…äº«ä¸ªäººéŸ³ä¹åº“ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸµ æœ¬åœ°éŸ³ä¹æ’­æ”¾ æ”¯æŒæ’­æ”¾ NAS æˆ–æœ¬åœ°å­˜å‚¨ä¸­çš„éŸ³ä¹æ–‡ä»¶ æ‘†è„±å¹³å°ç‰ˆæƒé™åˆ¶ï¼Œäº«å—ä¸ªäººéŸ³ä¹æ”¶è— ğŸŒ è‡ªåŠ¨ä¸‹è½½ å½“æœ¬åœ°æ²¡æœ‰è¯·æ±‚çš„æ­Œæ›²æ—¶ï¼Œè‡ªåŠ¨ä»å“”å“©å“”å“©æˆ– YouTube ä¸‹è½½ æ— ç¼è¡¥å……éŸ³ä¹åº“ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ ğŸ™ï¸ è¯­éŸ³æ§åˆ¶ æ”¯æŒé€šè¿‡å°çˆ±éŸ³ç®±è¯­éŸ³æŒ‡ä»¤æ§åˆ¶æ’­æ”¾ ä¿æŒåŸæœ‰çš„è¯­éŸ³äº¤äº’ä½“éªŒ ğŸ“± Web ç®¡ç† æä¾›ç›´è§‚çš„ Web ç•Œé¢è¿›è¡Œç®¡ç†å’Œé…ç½® æ–¹ä¾¿è¿œç¨‹ç®¡ç†å’Œç›‘æ§ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² ä½¿ç”¨ Docker ç®€åŒ–å®‰è£…å’Œç»´æŠ¤è¿‡ç¨‹ å¿«é€Ÿéƒ¨ç½²ï¼Œæ˜“äºå‡çº§å’Œç»´æŠ¤ ğŸ”„ å¤šæ ¼å¼æ”¯æŒ æ”¯æŒ MP3ã€FLACã€WAVã€APEã€OGGã€M4A ç­‰å¤šç§éŸ³é¢‘æ ¼å¼ å…¼å®¹å¤§å¤šæ•°éŸ³é¢‘æ–‡ä»¶æ ¼å¼ ğŸ³ ä¸€ã€Docker éƒ¨ç½² XiaoMusic 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/xiaomusic \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: xiaomusic: image: m.daocloud.io/docker.io/hanxi/xiaomusic ## å›½å†…é•œåƒ ## image: hanxi/xiaomusic ## å›½å¤–é•œåƒ container_name: xiaomusic restart: unless-stopped ports: - 8393:8090 volumes: - /mnt/file/music:/app/music - ./conf:/app/conf environment: XIAOMUSIC_PUBLIC_PORT: 8393 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ XiaoMusic 1. åˆå§‹è®¾ç½®ä¸é…ç½® âš™ï¸ è®¿é—® Web ç•Œé¢: åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:8393 ç™»å½•å°ç±³è´¦å·: åœ¨è®¾ç½®é¡µé¢è¾“å…¥æ‚¨çš„å°ç±³è´¦å·å’Œå¯†ç  é€‰æ‹©è®¾å¤‡: ç³»ç»Ÿä¼šè‡ªåŠ¨è·å–æ‚¨çš„å°çˆ±éŸ³ç®±è®¾å¤‡åˆ—è¡¨ï¼Œé€‰æ‹©è¦æ§åˆ¶çš„è®¾å¤‡ é…ç½®ä¸‹è½½æº: å¯é€‰æ‹© bilisearch:ï¼ˆå“”å“©å“”å“©ï¼‰æˆ– ytsearch:ï¼ˆYouTubeï¼‰ä½œä¸ºä¸‹è½½æº 2. ä½¿ç”¨æŠ€å·§ä¸è¯­éŸ³å£ä»¤ ğŸ—£ï¸ XiaoMusic æ”¯æŒä¸°å¯Œçš„è¯­éŸ³æ§åˆ¶å£ä»¤ï¼š\nè¯­éŸ³æŒ‡ä»¤ åŠŸèƒ½æè¿° ä½¿ç”¨ç¤ºä¾‹ æ’­æ”¾æ­Œæ›² æ’­æ”¾æœ¬åœ°çš„æ­Œæ›² \u0026ldquo;æ’­æ”¾æ­Œæ›²\u0026rdquo; æ’­æ”¾æ­Œæ›²+æ­Œå æ’­æ”¾æŒ‡å®šæ­Œæ›² \u0026ldquo;æ’­æ”¾æ­Œæ›²å‘¨æ°ä¼¦æ™´å¤©\u0026rdquo; ä¸Šä¸€é¦–/ä¸‹ä¸€é¦– åˆ‡æ¢æ›²ç›® \u0026ldquo;ä¸‹ä¸€é¦–\u0026rdquo; æ’­æ”¾æ¨¡å¼æ§åˆ¶ åˆ‡æ¢æ’­æ”¾æ¨¡å¼ \u0026ldquo;å•æ›²å¾ªç¯\u0026rdquo;/\u0026ldquo;å…¨éƒ¨å¾ªç¯\u0026rdquo;/\u0026ldquo;éšæœºæ’­æ”¾\u0026rdquo; åœæ­¢æ’­æ”¾ åœæ­¢æ’­æ”¾ \u0026ldquo;åœæ­¢æ’­æ”¾\u0026quot;æˆ–\u0026quot;å…³æœº\u0026rdquo; åˆ·æ–°åˆ—è¡¨ åˆ·æ–°éŸ³ä¹åˆ—è¡¨ \u0026ldquo;åˆ·æ–°åˆ—è¡¨\u0026rdquo; æ’­æ”¾åˆ—è¡¨ æ’­æ”¾æŒ‡å®šæ­Œå• \u0026ldquo;æ’­æ”¾åˆ—è¡¨æˆ‘çš„æœ€çˆ±\u0026rdquo; æ”¶è—ç®¡ç† ç®¡ç†æ”¶è—æ­Œæ›² \u0026ldquo;åŠ å…¥æ”¶è—\u0026rdquo;/\u0026ldquo;å–æ¶ˆæ”¶è—\u0026rdquo; 3. æ›´æ–°éŸ³ä¹åˆ—è¡¨ ğŸ”„ å‘ /mnt/file/music æ–‡ä»¶å¤¹æ·»åŠ æ–°çš„éŸ³ä¹æ–‡ä»¶ é‡å¯ xiaomusic å®¹å™¨ï¼šdocker restart xiaomusic åœ¨ XiaoMusic Web åå°è¿›è¡Œæ“ä½œï¼š ç‚¹å‡»\u0026quot;è®¾ç½®\u0026quot; ç‚¹å‡»\u0026quot;é‡æ–°æ‹‰å–è®¾ç½®æ•°æ®\u0026quot; ç‚¹å‡»\u0026quot;æ‹‰å–æœ€æ–°çš„éŸ³ä¹åˆ—è¡¨\u0026quot; ç‚¹å‡»\u0026quot;åˆ·æ–°éŸ³ä¹æ ‡ç­¾\u0026quot; 4. æ”¯æŒçš„éŸ³ä¹æ ¼å¼ä¸è®¾å¤‡ ğŸ“‹ æ”¯æŒçš„éŸ³ä¹æ ¼å¼ï¼š MP3 FLAC WAV APE OGG M4A æ³¨æ„: éƒ¨åˆ†è®¾å¤‡å‹å·ï¼ˆå¦‚ L05Bã€L05Cï¼‰å¯èƒ½ä¸æ”¯æŒ FLAC æ ¼å¼ã€‚\næµ‹è¯•æ”¯æŒçš„è®¾å¤‡å‹å·ï¼š å‹å· è®¾å¤‡åç§° L06A å°çˆ±éŸ³ç®± L07A Redmiå°çˆ±éŸ³ç®± Play S12/S12A å°ç±³AIéŸ³ç®± LX5A å°çˆ±éŸ³ç®± ä¸‡èƒ½é¥æ§ç‰ˆ LX05 å°çˆ±éŸ³ç®±Playï¼ˆ2019æ¬¾ï¼‰ LX06 å°çˆ±éŸ³ç®±Pro LX01 å°çˆ±éŸ³ç®±mini L05B å°çˆ±éŸ³ç®±Play L05C å°ç±³å°çˆ±éŸ³ç®±Play å¢å¼ºç‰ˆ åŠå…¶ä»–å¤šç§å‹å· ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://xiaomusic.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/xiaomusic.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name xiaomusic.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 10M; location / { proxy_pass http://localhost:8393; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; proxy_http_version 1.1; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx \u0026ndash;\nğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/xiaomusic # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop xiaomusic # åœæ­¢å®¹å™¨ docker start xiaomusic # å¯åŠ¨å®¹å™¨ docker restart xiaomusic # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm xiaomusic # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f xiaomusic # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it xiaomusic bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ docker exec -it xiaomusic sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect xiaomusic # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats xiaomusic # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs xiaomusic # æŸ¥çœ‹æ—¥å¿— docker logs -f xiaomusic # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 xiaomusic # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t xiaomusic # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ¶ å¯èˆªéŸ³ä¹ï¼Œç•…äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† XiaoMusicï¼Œè®©å°çˆ±éŸ³ç®±ç„•å‘æ–°ç”Ÿï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸµ è§£æ”¾éŸ³ä¹ æ‘†è„±å¹³å°ç‰ˆæƒé™åˆ¶ï¼Œè®©å°çˆ±éŸ³ç®±æ’­æ”¾ä½ çè—çš„ä¸ªäººéŸ³ä¹æ”¶è—\nğŸ—£ï¸ è¯­éŸ³æ§åˆ¶ ä¿æŒåŸæœ‰çš„è¯­éŸ³äº¤äº’ä½“éªŒï¼Œé€šè¿‡ç®€å•å£ä»¤æ§åˆ¶éŸ³ä¹æ’­æ”¾\nğŸŒ æ™ºèƒ½è¡¥å…… è‡ªåŠ¨ä»ç½‘ç»œä¸‹è½½ç¼ºå¤±çš„æ­Œæ›²ï¼Œæ— ç¼æ‰©å±•ä½ çš„éŸ³ä¹åº“\nğŸ“± è¿œç¨‹ç®¡ç† é€šè¿‡ Web ç•Œé¢éšæ—¶éšåœ°ç®¡ç†éŸ³ä¹å’Œé…ç½®è®¾ç½®\néŸ³ä¹æ˜¯ç”Ÿæ´»çš„èƒŒæ™¯éŸ³ï¼Œä¹Ÿæ˜¯æƒ…æ„Ÿçš„å‚¬åŒ–å‰‚ã€‚æ„¿ XiaoMusic æˆä¸ºä½ ä¸å°çˆ±éŸ³ç®±ä¹‹é—´çš„éŸ³ä¹æ¡¥æ¢ï¼Œè®©ç§‘æŠ€çœŸæ­£æœåŠ¡äºä½ çš„ä¸ªäººå–œå¥½å’Œç”Ÿæ´»æ–¹å¼ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå”¤é†’ä½ çš„å°çˆ±éŸ³ç®±ï¼Œè®©å®ƒçœŸæ­£æˆä¸ºä½ çš„ç§äººéŸ³ä¹ç®¡å®¶ï¼ğŸ§\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ XiaoMusic å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ŒéŸ³ä¹ç›¸ä¼´ï¼ğŸ‰\n","date":"2024-12-09T08:59:38+08:00","image":"https://file.meimolihan.eu.org/img/xiaomusic-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f9e0387e/","title":"Docker éƒ¨ç½² XiaoMusic å°çˆ±éŸ³ç®±æ’­æ”¾æœ¬åœ°éŸ³ä¹  ğŸµ"},{"content":"Certbot SSL è¯ä¹¦ç®¡ç† \u0026amp; Cloudflare API éªŒè¯ ğŸ” ğŸŒ ä½¿ç”¨ Cloudflare DNS API è‡ªåŠ¨éªŒè¯å’Œç»­ç­¾ SSL è¯ä¹¦ï¼Œæ— éœ€å¼€æ”¾æœåŠ¡å™¨ç«¯å£ - å®‰å…¨ã€é«˜æ•ˆã€è‡ªåŠ¨åŒ–çš„è¯ä¹¦ç®¡ç†è§£å†³æ–¹æ¡ˆ\nğŸ“‹ ç›®å½• ğŸ¯ ç®€ä»‹ ğŸ“¦ å®‰è£…é…ç½® ğŸ”‘ Cloudflare API è®¾ç½® ğŸ“ è¯ä¹¦ç”³è¯· âš¡ è‡ªåŠ¨ç»­ç­¾ ğŸ”§ ç»´æŠ¤ç®¡ç† ğŸ—‘ï¸ å®Œå…¨å¸è½½ ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ ç®€ä»‹ Certbot æ˜¯ç”± EFF (Electronic Frontier Foundation) å¼€å‘çš„å…è´¹å¼€æºå·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç®¡ç†å’Œéƒ¨ç½² Let\u0026rsquo;s Encrypt SSL è¯ä¹¦ã€‚\nğŸŒŸ Cloudflare API éªŒè¯çš„ä¼˜åŠ¿ âœ… æ— éœ€å¼€æ”¾ç«¯å£ï¼šä¸éœ€è¦å¼€æ”¾ 80/443 ç«¯å£ï¼Œå¢å¼ºæœåŠ¡å™¨å®‰å…¨æ€§ âœ… æ”¯æŒé€šé…ç¬¦ï¼šå¯ä»¥ç”³è¯· *.example.com é€šé…ç¬¦è¯ä¹¦ï¼Œä¿æŠ¤æ‰€æœ‰å­åŸŸå âœ… å®Œå…¨è‡ªåŠ¨åŒ–ï¼šæ”¯æŒæ— äººå€¼å®ˆè‡ªåŠ¨ç»­ç­¾ï¼Œå‡å°‘äººå·¥å¹²é¢„ âœ… å®‰å…¨å¯é ï¼šä½¿ç”¨ API Token è€Œéå…¨å±€å¯†é’¥ï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™ âœ… DNS éªŒè¯ï¼šé€šè¿‡ DNS TXT è®°å½•éªŒè¯åŸŸåæ‰€æœ‰æƒï¼Œé€‚ç”¨äºå„ç§æœåŠ¡å™¨ç¯å¢ƒ âœ… å¤šåŸŸåæ”¯æŒï¼šå•å¼ è¯ä¹¦å¯åŒ…å«å¤šä¸ªåŸŸåå’Œé€šé…ç¬¦ ğŸ”— ç›¸å…³é“¾æ¥ ğŸŒ Certbot å®˜ç½‘: https://certbot.eff.org/ ğŸ“š Cloudflare API æ–‡æ¡£: https://developers.cloudflare.com/api/ ğŸ¯ ä¸­æ–‡æŒ‡å—: https://certbot.openssl.ac.cn/ ğŸ“– Let\u0026rsquo;s Encrypt æ–‡æ¡£: https://letsencrypt.org/docs/ ğŸ™ GitHub ä»“åº“: https://github.com/certbot/certbot ğŸ“¦ å®‰è£…é…ç½® ğŸ§ å®‰è£… Certbot å’Œ Cloudflare æ’ä»¶ Ubuntu/Debian ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 # æ›´æ–°ç³»ç»ŸåŒ…åˆ—è¡¨ sudo apt update # å®‰è£… Certbot å’Œ Cloudflare DNS æ’ä»¶ sudo apt install -y certbot python3-certbot-dns-cloudflare # éªŒè¯å®‰è£… certbot --version python3 -c \u0026#34;import certbot_dns_cloudflare; print(\u0026#39;âœ… Cloudflare plugin installed\u0026#39;)\u0026#34; CentOS/RHEL ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 # å¯ç”¨ EPEL ä»“åº“ sudo yum install -y epel-release # æˆ–è€…å¯¹äº CentOS 8/RHEL 8 sudo dnf install -y epel-release # å®‰è£… Certbot å’Œ Cloudflare DNS æ’ä»¶ sudo yum install -y certbot python3-certbot-dns-cloudflare # æˆ–è€…ä½¿ç”¨ pip å®‰è£… sudo pip3 install certbot certbot-dns-cloudflare ä½¿ç”¨ Snap å®‰è£…ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å®‰è£… Snap sudo apt install -y snapd # ç¡®ä¿ Snap æ˜¯æœ€æ–°çš„ sudo snap install core sudo snap refresh core # å®‰è£… Certbot sudo snap install --classic certbot # åˆ›å»ºç¬¦å·é“¾æ¥ sudo ln -s /snap/bin/certbot /usr/bin/certbot # å®‰è£… Cloudflare DNS æ’ä»¶ sudo snap set certbot trust-plugin-with-root=ok sudo snap install certbot-dns-cloudflare # éªŒè¯å®‰è£… certbot --version ğŸ“ åˆ›å»ºé…ç½®ç›®å½• 1 2 3 4 5 6 7 # åˆ›å»ºé…ç½®ç›®å½• sudo mkdir -p /etc/letsencrypt sudo chmod 700 /etc/letsencrypt # åˆ›å»ºæ—¥å¿—ç›®å½• sudo mkdir -p /var/log/letsencrypt sudo chmod 755 /var/log/letsencrypt ğŸ”‘ Cloudflare API è®¾ç½® ğŸ¯ è·å– Cloudflare API Token ç™»å½• Cloudflare æ§åˆ¶å°: https://dash.cloudflare.com/ è¿›å…¥ API Tokens: ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å›¾æ ‡ â†’ My Profile â†’ API Tokens åˆ›å»º Token: ç‚¹å‡» \u0026ldquo;Create Token\u0026rdquo; â†’ ä½¿ç”¨ \u0026ldquo;Edit zone DNS\u0026rdquo; æ¨¡æ¿ é…ç½®æƒé™: æƒé™: Zone - DNS - Edit èµ„æº: Include - All zones (æˆ–æŒ‡å®šç‰¹å®šåŸŸå) åˆ›å»ºå¹¶ä¿å­˜ Token: å¤åˆ¶ç”Ÿæˆçš„ API Token ğŸ“ åˆ›å»ºé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»º Cloudflare é…ç½®æ–‡ä»¶ sudo tee /etc/letsencrypt/cloudflare.ini \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # Cloudflare API credentials used by Certbot dns_cloudflare_api_token = YOUR_API_TOKEN_HERE EOF # è®¾ç½®ä¸¥æ ¼æƒé™ sudo chmod 600 /etc/letsencrypt/cloudflare.ini sudo chown root:root /etc/letsencrypt/cloudflare.ini # éªŒè¯é…ç½®æ–‡ä»¶ sudo cat /etc/letsencrypt/cloudflare.ini âš ï¸ é‡è¦:\nä½¿ç”¨ API Token æ—¶åªéœ€é…ç½® dns_cloudflare_api_tokenï¼Œä¸éœ€è¦ dns_cloudflare_api_key å’Œ dns_cloudflare_email å°† YOUR_API_TOKEN_HERE æ›¿æ¢ä¸ºå®é™…çš„ API Token ç¡®ä¿é…ç½®æ–‡ä»¶æƒé™ä¸º 600ï¼Œé˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å– ğŸ“ è¯ä¹¦ç”³è¯· ğŸš€ ç”³è¯·é€šé…ç¬¦è¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 11 # ç”³è¯·é€šé…ç¬¦è¯ä¹¦ sudo certbot certonly \\ --dns-cloudflare \\ --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini \\ --dns-cloudflare-propagation-seconds 60 \\ --preferred-challenges dns-01 \\ -d \u0026#34;example.com\u0026#34; \\ -d \u0026#34;*.example.com\u0026#34; \\ --register-unsafely-without-email \\ --agree-tos \\ --non-interactive ğŸ“‹ å‚æ•°è¯´æ˜ --dns-cloudflare: ä½¿ç”¨ Cloudflare DNS éªŒè¯ --dns-cloudflare-credentials: æŒ‡å®šå‡­è¯æ–‡ä»¶è·¯å¾„ --dns-cloudflare-propagation-seconds 60: ç­‰å¾… DNS ä¼ æ’­çš„æ—¶é—´ï¼ˆç§’ï¼‰ --preferred-challenges dns-01: ä¼˜å…ˆä½¿ç”¨ DNS æŒ‘æˆ˜éªŒè¯ -d: æŒ‡å®šåŸŸåï¼ˆæ”¯æŒå¤šä¸ªåŸŸåï¼‰ --register-unsafely-without-email: ä¸æä¾›é‚®ç®±ï¼ˆå¯é€‰ï¼‰ --agree-tos: åŒæ„æœåŠ¡æ¡æ¬¾ --non-interactive: éäº¤äº’æ¨¡å¼ï¼Œé€‚åˆè„šæœ¬è¿è¡Œ ğŸ¯ ç”³è¯·å¤šåŸŸåè¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 # ç”³è¯·åŒ…å«å¤šä¸ªåŸŸåçš„è¯ä¹¦ sudo certbot certonly \\ --dns-cloudflare \\ --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini \\ -d \u0026#34;example.com\u0026#34; \\ -d \u0026#34;www.example.com\u0026#34; \\ -d \u0026#34;api.example.com\u0026#34; \\ -d \u0026#34;*.staging.example.com\u0026#34; \\ --register-unsafely-without-email \\ --agree-tos âœ… éªŒè¯ç”³è¯·ç»“æœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ sudo certbot certificates # æ£€æŸ¥è¯ä¹¦æ–‡ä»¶ sudo ls -la /etc/letsencrypt/live/example.com/ # éªŒè¯è¯ä¹¦å†…å®¹ sudo openssl x509 -in /etc/letsencrypt/live/example.com/cert.pem -text -noout | head -20 # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ sudo openssl x509 -in /etc/letsencrypt/live/example.com/cert.pem -noout -dates # éªŒè¯è¯ä¹¦é“¾ sudo openssl verify -CAfile /etc/letsencrypt/live/example.com/chain.pem /etc/letsencrypt/live/example.com/cert.pem âš¡ è‡ªåŠ¨ç»­ç­¾ ğŸ• è®¡åˆ’ä»»åŠ¡é…ç½® æ–¹æ³•ä¸€ï¼šç®€å•ç»­ç­¾å‘½ä»¤ 1 2 3 4 5 6 7 8 9 # ç¼–è¾‘ crontab sudo crontab -e # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # æ¯å¤©å‡Œæ™¨ 2:30 è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚æœè¯ä¹¦30å¤©å†…è¿‡æœŸï¼‰ 30 2 * * * /usr/bin/certbot renew --quiet --renew-hook \u0026#34;systemctl reload nginx\u0026#34; # æˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„ 30 2 * * * /usr/bin/certbot renew --quiet --renew-hook \u0026#34;/bin/systemctl reload nginx\u0026#34; æ–¹æ³•äºŒï¼šæ™ºèƒ½ç»­ç­¾è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # åˆ›å»ºæ™ºèƒ½ç»­ç­¾è„šæœ¬ sudo tee /usr/local/bin/certbot-renew-smart.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # æ™ºèƒ½è¯ä¹¦ç»­ç­¾è„šæœ¬ DOMAIN=\u0026#34;example.com\u0026#34; LOG_FILE=\u0026#34;/var/log/certbot-renew.log\u0026#34; CONFIG_FILE=\u0026#34;/etc/letsencrypt/cloudflare.ini\u0026#34; NGINX_CONFIG=\u0026#34;/etc/nginx/sites-available/default\u0026#34; echo \u0026#34;$(date): å¼€å§‹è¯ä¹¦ç»­ç­¾æ£€æŸ¥\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ£€æŸ¥è¯ä¹¦æ˜¯å¦å­˜åœ¨ if [ ! -f \u0026#34;/etc/letsencrypt/live/$DOMAIN/cert.pem\u0026#34; ]; then echo \u0026#34;é”™è¯¯: è¯ä¹¦æ–‡ä»¶ä¸å­˜åœ¨\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ EXPIRY_DAYS=$(sudo certbot certificates | grep -A 3 \u0026#34;$DOMAIN\u0026#34; | grep \u0026#34;EXPIRY\u0026#34; | awk \u0026#39;{print $6}\u0026#39; | cut -d\u0026#39;)\u0026#39; -f1) if [ -z \u0026#34;$EXPIRY_DAYS\u0026#34; ] || [ \u0026#34;$EXPIRY_DAYS\u0026#34; -le 10 ]; then echo \u0026#34;è¯ä¹¦å³å°†è¿‡æœŸï¼ˆå‰©ä½™ ${EXPIRY_DAYS:-æœªçŸ¥} å¤©ï¼‰ï¼Œå°è¯•ç»­ç­¾...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ‰§è¡Œç»­ç­¾ if sudo certbot renew --dns-cloudflare --dns-cloudflare-credentials $CONFIG_FILE --force-renewal; then echo \u0026#34;è¯ä¹¦ç»­ç­¾æˆåŠŸ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ£€æŸ¥ Nginx é…ç½®è¯­æ³• if sudo nginx -t; then # é‡è½½ Nginx sudo systemctl reload nginx echo \u0026#34;Nginx é…ç½®å·²é‡è½½\u0026#34; \u0026gt;\u0026gt; $LOG_FILE else echo \u0026#34;é”™è¯¯: Nginx é…ç½®æµ‹è¯•å¤±è´¥\u0026#34; \u0026gt;\u0026gt; $LOG_FILE fi else echo \u0026#34;è¯ä¹¦ç»­ç­¾å¤±è´¥\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi else echo \u0026#34;è¯ä¹¦æœ‰æ•ˆæœŸå‰©ä½™ ${EXPIRY_DAYS} å¤©ï¼Œæ— éœ€ç»­ç­¾\u0026#34; \u0026gt;\u0026gt; $LOG_FILE fi echo \u0026#34;$(date): è¯ä¹¦æ£€æŸ¥å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE EOF # è®¾ç½®è„šæœ¬æƒé™ sudo chmod +x /usr/local/bin/certbot-renew-smart.sh sudo chown root:root /usr/local/bin/certbot-renew-smart.sh ğŸ“… æ·»åŠ è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 6 7 8 # ç¼–è¾‘ root çš„ crontab sudo crontab -e # æ·»åŠ æ™ºèƒ½ç»­ç­¾ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œï¼‰ 0 3 * * * /usr/local/bin/certbot-renew-smart.sh \u0026gt;\u0026gt; /var/log/certbot-renew.log 2\u0026gt;\u0026amp;1 # æ·»åŠ æ—¥å¿—æ¸…ç†ä»»åŠ¡ï¼ˆæ¯æœˆæ¸…ç†ä¸€æ¬¡æ—§æ—¥å¿—ï¼‰ 0 2 1 * * find /var/log -name \u0026#34;certbot*.log\u0026#34; -mtime +30 -delete ğŸ”” ç»­ç­¾é€šçŸ¥é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ·»åŠ é‚®ä»¶é€šçŸ¥åŠŸèƒ½åˆ°ç»­ç­¾è„šæœ¬ sudo tee -a /usr/local/bin/certbot-renew-smart.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # å‘é€é€šçŸ¥å‡½æ•° send_notification() { local subject=\u0026#34;$1\u0026#34; local message=\u0026#34;$2\u0026#34; # ä½¿ç”¨ mail å‘½ä»¤å‘é€é‚®ä»¶ echo \u0026#34;$message\u0026#34; | mail -s \u0026#34;$subject\u0026#34; admin@example.com # æˆ–è€…ä½¿ç”¨å…¶ä»–é€šçŸ¥æ–¹å¼ï¼ˆå¦‚ Slackã€Telegram ç­‰ï¼‰ } # åœ¨é€‚å½“ä½ç½®æ·»åŠ é€šçŸ¥ if [ $? -eq 0 ]; then send_notification \u0026#34;è¯ä¹¦ç»­ç­¾æˆåŠŸ\u0026#34; \u0026#34;åŸŸå $DOMAIN çš„ SSL è¯ä¹¦å·²æˆåŠŸç»­ç­¾ã€‚\u0026#34; else send_notification \u0026#34;è¯ä¹¦ç»­ç­¾å¤±è´¥\u0026#34; \u0026#34;åŸŸå $DOMAIN çš„ SSL è¯ä¹¦ç»­ç­¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ã€‚\u0026#34; fi EOF ğŸ”§ ç»´æŠ¤ç®¡ç† ğŸ“‹ å¸¸ç”¨ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦ sudo certbot certificates # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ sudo openssl x509 -in /etc/letsencrypt/live/example.com/cert.pem -noout -dates # æµ‹è¯•ç»­ç­¾ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰ sudo certbot renew --dry-run # å¼ºåˆ¶ç»­ç­¾ç‰¹å®šè¯ä¹¦ sudo certbot renew --cert-name example.com --force-renewal # æŸ¥çœ‹ Certbot æ—¥å¿— sudo tail -f /var/log/letsencrypt/letsencrypt.log # æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯ sudo certbot show --cert-name example.com ğŸ”„ æ‰‹åŠ¨åŒæ­¥è¯ä¹¦åˆ° Web æœåŠ¡å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # åŒæ­¥è¯ä¹¦åˆ° Nginx sudo cp -f /etc/letsencrypt/live/example.com/fullchain.pem /etc/nginx/ssl/example.com.crt sudo cp -f /etc/letsencrypt/live/example.com/privkey.pem /etc/nginx/ssl/example.com.key # è®¾ç½®æ­£ç¡®æƒé™ sudo chmod 644 /etc/nginx/ssl/example.com.crt sudo chmod 600 /etc/nginx/ssl/example.com.key sudo chown www-data:www-data /etc/nginx/ssl/example.com.* # æµ‹è¯• Nginx é…ç½® sudo nginx -t # é‡è½½ Nginx sudo systemctl reload nginx # å¯¹äº Apache sudo cp -f /etc/letsencrypt/live/example.com/fullchain.pem /etc/ssl/certs/example.com.crt sudo cp -f /etc/letsencrypt/live/example.com/privkey.pem /etc/ssl/private/example.com.key sudo systemctl reload apache2 ğŸ—‘ï¸ æ’¤é”€å’Œåˆ é™¤è¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 # æ’¤é”€è¯ä¹¦ sudo certbot revoke --cert-path /etc/letsencrypt/live/example.com/cert.pem --reason superseded # åˆ é™¤è¯ä¹¦é…ç½® sudo certbot delete --cert-name example.com # æ‰‹åŠ¨åˆ é™¤è¯ä¹¦æ–‡ä»¶ sudo rm -rf /etc/letsencrypt/archive/example.com sudo rm -rf /etc/letsencrypt/live/example.com sudo rm -rf /etc/letsencrypt/renewal/example.com.conf ğŸ” æ•…éšœæ’é™¤å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥ DNS è§£æ dig TXT _acme-challenge.example.com # è°ƒè¯•æ¨¡å¼è¿è¡Œ Certbot sudo certbot --debug --verbose certonly --dns-cloudflare --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini -d example.com # æ£€æŸ¥ Cloudflare API è¿æ¥ curl -X GET \u0026#34;https://api.cloudflare.com/client/v4/zones\u0026#34; \\ -H \u0026#34;Authorization: Bearer YOUR_API_TOKEN\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; # æ£€æŸ¥è¯ä¹¦é€æ˜åº¦æ—¥å¿— curl \u0026#34;https://crt.sh/?q=example.com\u0026amp;output=json\u0026#34; | jq . ğŸ—‘ï¸ å®Œå…¨å¸è½½ ğŸ”„ å¸è½½ Certbot 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # åœæ­¢æ‰€æœ‰ Certbot ç›¸å…³è¿›ç¨‹ sudo systemctl stop certbot.timer sudo systemctl disable certbot.timer # å¸è½½è½¯ä»¶åŒ…ï¼ˆAPTï¼‰ sudo apt remove --purge -y certbot python3-certbot-dns-cloudflare # å¸è½½è½¯ä»¶åŒ…ï¼ˆSnapï¼‰ sudo snap remove certbot certbot-dns-cloudflare sudo rm -f /usr/bin/certbot # æ¸…ç†é…ç½®æ–‡ä»¶ sudo rm -rf /etc/letsencrypt/ sudo rm -rf /var/lib/letsencrypt/ sudo rm -rf /var/log/letsencrypt/ # æ¸…ç† Cron ä»»åŠ¡ sudo crontab -l | grep -v certbot | sudo crontab - # åˆ é™¤è„šæœ¬æ–‡ä»¶ sudo rm -f /usr/local/bin/certbot-renew-smart.sh # æ¸…ç†æ®‹ç•™åŒ… sudo apt autoremove -y sudo apt clean ğŸ“Š éªŒè¯å¸è½½ 1 2 3 4 5 6 7 # æ£€æŸ¥æ˜¯å¦å®Œå…¨å¸è½½ which certbot || echo \u0026#34;âœ… Certbot å·²å¸è½½\u0026#34; ls /etc/letsencrypt 2\u0026gt;/dev/null || echo \u0026#34;âœ… é…ç½®ç›®å½•å·²æ¸…ç†\u0026#34; ps aux | grep certbot | grep -v grep || echo \u0026#34;âœ… æ—  Certbot è¿›ç¨‹\u0026#34; # æ£€æŸ¥å·²å®‰è£…çš„ Python æ¨¡å— python3 -c \u0026#34;import certbot_dns_cloudflare\u0026#34; 2\u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;âŒ Cloudflare æ’ä»¶ä»åœ¨\u0026#34; || echo \u0026#34;âœ… Cloudflare æ’ä»¶å·²ç§»é™¤\u0026#34; ğŸ’¡ æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®šæœŸè½®æ¢ API Tokenï¼ˆæ¯3-6ä¸ªæœˆï¼‰ # ä¸ºæ¯ä¸ªåŸŸååˆ›å»ºå•ç‹¬çš„ API Tokenï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™ # ä½¿ç”¨å¼ºæƒé™ä¿æŠ¤å¯†é’¥æ–‡ä»¶ sudo chmod 600 /etc/letsencrypt/cloudflare.ini sudo chmod 700 /etc/letsencrypt/live/ sudo chmod 755 /etc/letsencrypt/archive/ # å®šæœŸå¤‡ä»½è¯ä¹¦å’Œé…ç½® sudo tar -czvf /backup/letsencrypt-backup-$(date +%Y%m%d).tar.gz /etc/letsencrypt/ # ç›‘æ§è¯ä¹¦ç›®å½•çš„æ›´æ”¹ sudo apt install -y auditd sudo auditctl -w /etc/letsencrypt/ -p wa -k letsencrypt ğŸ“Š ç›‘æ§å’Œå‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # è¯ä¹¦è¿‡æœŸç›‘æ§è„šæœ¬ #!/bin/bash DOMAIN=\u0026#34;example.com\u0026#34; WARNING_DAYS=14 ADMIN_EMAIL=\u0026#34;admin@example.com\u0026#34; EXPIRY_DATE=$(sudo openssl x509 -in /etc/letsencrypt/live/$DOMAIN/cert.pem -enddate -noout | cut -d= -f2) EXPIRY_TS=$(date -d \u0026#34;$EXPIRY_DATE\u0026#34; +%s) CURRENT_TS=$(date +%s) DAYS_LEFT=$(( (EXPIRY_TS - CURRENT_TS) / 86400 )) if [ $DAYS_LEFT -le $WARNING_DAYS ]; then SUBJECT=\u0026#34;SSL è¯ä¹¦è¿‡æœŸè­¦å‘Š: $DOMAIN\u0026#34; MESSAGE=\u0026#34;åŸŸå $DOMAIN çš„ SSL è¯ä¹¦å°†åœ¨ $DAYS_LEFT å¤©åè¿‡æœŸï¼ˆ$EXPIRY_DATEï¼‰ã€‚è¯·åŠæ—¶ç»­ç­¾ã€‚\u0026#34; echo \u0026#34;$MESSAGE\u0026#34; | mail -s \u0026#34;$SUBJECT\u0026#34; \u0026#34;$ADMIN_EMAIL\u0026#34; # å¯é€‰: å‘é€åˆ° Slack æˆ–å…¶å®ƒé€šçŸ¥ç³»ç»Ÿ # curl -X POST -H \u0026#39;Content-type: application/json\u0026#39; \\ # --data \u0026#34;{\\\u0026#34;text\\\u0026#34;:\\\u0026#34;$MESSAGE\\\u0026#34;}\u0026#34; \\ # https://hooks.slack.com/services/XXX/XXX/XXX fi ğŸ”§ é«˜çº§æ•…éšœæ’é™¤æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥ Let\u0026#39;s Encrypt é€Ÿç‡é™åˆ¶ # è®¿é—®: https://letsencrypt.org/docs/rate-limits/ # ä½¿ç”¨æš‚å­˜ç¯å¢ƒæµ‹è¯• sudo certbot certonly --test-cert --dns-cloudflare \\ --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini \\ -d example.com # æ£€æŸ¥è¯ä¹¦é€æ˜åº¦æ—¥å¿— curl -s \u0026#34;https://crt.sh/?q=example.com\u0026amp;output=json\u0026#34; | jq -r \u0026#39;.[] | select(.name_value | contains(\u0026#34;example.com\u0026#34;)) | .not_after\u0026#39; | head -1 # æ‰‹åŠ¨æ·»åŠ  DNS è®°å½•è¿›è¡ŒéªŒè¯ # è·å–éœ€è¦æ·»åŠ çš„ TXT è®°å½• sudo certbot certonly --manual --preferred-challenges dns -d example.com --dry-run ğŸ“ æ›´æ–°å’Œç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®šæœŸæ›´æ–° Certbot sudo apt update \u0026amp;\u0026amp; sudo apt upgrade certbot python3-certbot-dns-cloudflare # æˆ–è€…ä½¿ç”¨ Snap æ›´æ–° sudo snap refresh certbot # æ£€æŸ¥æ’ä»¶å…¼å®¹æ€§ python3 -c \u0026#34;import pkg_resources; print(\u0026#39;Cloudflare plugin version:\u0026#39;, pkg_resources.get_distribution(\u0026#39;certbot-dns-cloudflare\u0026#39;).version)\u0026#34; # éªŒè¯é…ç½®è¯­æ³• sudo certbot renew --dry-run --dns-cloudflare --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini # æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ä¸­çš„ Certbot ç›¸å…³é”™è¯¯ sudo journalctl -u certbot | tail -50 ğŸŒ å¤šæœåŠ¡å™¨è¯ä¹¦åŒæ­¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # ä½¿ç”¨ rsync åŒæ­¥è¯ä¹¦åˆ°å¤šä¸ªæœåŠ¡å™¨ #!/bin/bash SERVERS=(\u0026#34;server1.example.com\u0026#34; \u0026#34;server2.example.com\u0026#34;) DOMAIN=\u0026#34;example.com\u0026#34; for SERVER in \u0026#34;${SERVERS[@]}\u0026#34;; do echo \u0026#34;åŒæ­¥è¯ä¹¦åˆ° $SERVER...\u0026#34; rsync -avz -e \u0026#34;ssh -p 22\u0026#34; \\ /etc/letsencrypt/live/$DOMAIN/ \\ user@$SERVER:/etc/letsencrypt/live/$DOMAIN/ ssh user@$SERVER \u0026#34;sudo systemctl reload nginx\u0026#34; done ğŸ¯ æç¤º: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ‰€æœ‰é…ç½®ã€‚å®šæœŸæ£€æŸ¥æ—¥å¿—å’Œè¯ä¹¦çŠ¶æ€ï¼Œç¡®ä¿è‡ªåŠ¨åŒ–æµç¨‹æ­£å¸¸è¿è¡Œã€‚\nğŸ“š æ‰©å±•é˜…è¯»:\nLet\u0026rsquo;s Encrypt é€Ÿç‡é™åˆ¶ Cloudflare API æœ€ä½³å®è·µ SSL è¯ä¹¦é€æ˜åº¦æ—¥å¿— Certbot å®˜æ–¹æ–‡æ¡£ ğŸ”§ ç´§æ€¥æ¢å¤:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¦‚æœè‡ªåŠ¨ç»­ç­¾å¤±è´¥ï¼Œæ‰‹åŠ¨æ‰§è¡Œ sudo /usr/local/bin/certbot-renew-smart.sh # æ£€æŸ¥ Nginx é…ç½® sudo nginx -t # ä¸´æ—¶æ¢å¤æ—§è¯ä¹¦ï¼ˆå¦‚æœæœ‰å¤‡ä»½ï¼‰ sudo cp -rf /backup/letsencrypt-backup/live/example.com/ /etc/letsencrypt/live/ sudo systemctl reload nginx # ç´§æ€¥æƒ…å†µä¸‹ç”³è¯·æ–°è¯ä¹¦ sudo certbot certonly --dns-cloudflare \\ --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini \\ -d example.com --force-renewal ğŸ’¡ ä¸“ä¸šå»ºè®®:\nä½¿ç”¨è¯ä¹¦ç›‘æ§æœåŠ¡å¦‚ SSL Labs å®šæœŸæ£€æŸ¥è¯ä¹¦é…ç½® å®æ–½è¯ä¹¦é’‰æ‰ (Certificate Pinning) å¢å¼ºå®‰å…¨æ€§ è€ƒè™‘ä½¿ç”¨åŒå‘ TLS (mTLS) å¯¹äºå†…éƒ¨æœåŠ¡ å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡å’Œæ¸—é€æµ‹è¯• å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©ä½¿ç”¨ Certbot å’Œ Cloudflare API ç®¡ç† SSL è¯ä¹¦ï¼ğŸ”\n","date":"2024-12-08T11:16:03+08:00","image":"https://file.meimolihan.eu.org/img/certbot-01.webp","permalink":"https://blog.meimolihan.eu.org/p/7e7d4e81/","title":"Certbot SSL è¯ä¹¦ç®¡ç† \u0026 Cloudflare APIéªŒè¯ ğŸ”"},{"content":"CS2 CFGæ–‡ä»¶ ä¸ªäººCFGè·¯å¾„ï¼š 1 C:\\Program Files (x86)\\Steam\\steamapps\\common\\Counter-Strike Global Offensive\\game\\csgo\\cfg 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• // CS2 CFGé¢„è®¾ // Config Preset V2.3 by Purp1e // ç¼–è¾‘æ—¥æœŸï¼š2023/10/26 // å“”å“©å“”å“©ï¼šhttps://space.bilibili.com/73115492 // ä½¿ç”¨è¯´æ˜ï¼šhttps://config.upup.cool/ // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç›®å½• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // 0. ç½‘ç»œ/å¸§æ•°æ® // 1. é¼ æ ‡è®¾ç½® // 2. å‡†æ˜Ÿ\u0026amp;æŒæªè®¾ç½® // 3. è§†é¢‘è®¾ç½® // 4. é”®ä½ç»‘å®š // 5. å¿«é€Ÿä¹°æª // 6. åŸºç¡€è®¾ç½® // 7. å£°éŸ³è®¾ç½® // 8. HUDè®¾ç½® // 9. å‡†æ˜Ÿå‚æ•° // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ 0. ç½‘ç»œ/å¸§æ•°æ® â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ cl_hud_telemetry_serverrecvmargin_graph_show 0 // æ˜¾ç¤ºç½‘ç»œ/å¸§æ—¶é—´æ•°æ®å›¾è¡¨ \u0026lt;0. ä¸æ˜¾ç¤º 1. å¦‚æœæ¡ä»¶æ¶åŠ£ 2. æ€»æ˜¯\u0026gt; cl_hud_telemetry_frametime_show 1 // æ˜¾ç¤ºå¸§ç”Ÿæˆæ—¶é—´åŠFPS \u0026lt;0.ä»ä¸ 1. å¦‚æœæ¡ä»¶æ¶åŠ£ 2.æ€»æ˜¯\u0026gt; cl_hud_telemetry_frametime_poor 100.000000 // å¸§ç”Ÿæˆæ—¶é—´è­¦å‘Šé˜ˆå€¼=100ms cl_hud_telemetry_net_misdelivery_show 1 // æ˜¾ç¤ºä¸¢åŒ…/å‘é€é”™è¯¯ç‡LOSS \u0026lt;0.ä»ä¸ 1. å¦‚æœæ¡ä»¶æ¶åŠ£ 2.æ€»æ˜¯\u0026gt; cl_hud_telemetry_net_misdelivery_poor 5 // æ•°æ®åŒ…å‘é€æ•…éšœè­¦å‘Šé˜ˆå€¼=5ä¸ª cl_hud_telemetry_ping_show 1 // æ˜¾ç¤ºå»¶è¿Ÿ \u0026lt;0.ä»ä¸ 1. å¦‚æœæ¡ä»¶æ¶åŠ£ 2.æ€»æ˜¯\u0026gt; cl_hud_telemetry_ping_poor 100 // å»¶è¿Ÿè­¦å‘Šé˜ˆå€¼=100ms cl_net_buffer_ticks 0 // æ•°æ®åŒ…ä¸¢å¤±ç¼“å†² \u0026lt;0.å…³é—­ 1.1ä¸ªæ•°æ®åŒ… 2.2ä¸ªæ•°æ®åŒ…\u0026gt; // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 è®¾ç½®é»˜è®¤æ­¦å™¨ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ // ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ 1. é¼ æ ‡è®¾ç½® ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ sensitivity 2.22 // é¼ æ ‡çµæ•åº¦ DPIï¼š400 x çµæ•åº¦ï¼š2.22 = eDPIï¼š2.22*400=888 zoom_sensitivity_ratio 1 // å¼€é•œæ—¶çµæ•åº¦ m_rawinput 1 // åŸå§‹é¼ æ ‡è¾“å…¥ m_customaccel 0 // é¼ æ ‡åŠ é€Ÿ \u0026lt;0.å…³é—­ 3.å¼€å¯\u0026gt; m_customaccel_exponent 1.05 // é¼ æ ‡åŠ é€Ÿå€¼ \u0026lt;é¼ æ ‡åŠ é€Ÿå¼€å¯åæœ‰æ•ˆ\u0026gt; m_yaw 0.022 // é»˜è®¤xè½´é€Ÿåº¦ \u0026lt;å¯ç”¨äºæ‹‰ä¼¸è¡¥å¿ 16:10-\u0026gt;0.020 4:3-\u0026gt;0.0165 5:4-\u0026gt;0.016\u0026gt; // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† 1. é¼ æ ‡è®¾ç½® ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ 2. å‡†æ˜Ÿ\u0026amp;æŒæªè®¾ç½® â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ // å‡†æ˜Ÿå‚æ•°æ”¾åœ¨crosshair.cfgä¸­ | æ³¨æ„åŒæ ·æ›¿æ¢åé¢çš„æŠ•æ·ç‰©å‡†æ˜Ÿä¸­çš„`exec crosshair.cfg` exec crosshair.cfg crosshair 1 // å¼€å¯å‡†æ˜Ÿ cl_crosshair_recoil 0 // å‡†æ˜Ÿè·ŸéšåååŠ› \u0026lt;1.å¼€å¯ 0.å…³é—­\u0026gt; cl_show_observer_crosshair 2 // [è§‚å¯Ÿæ—¶]æ˜¾ç¤ºç©å®¶æ‰€ç”¨å‡†æ˜Ÿ\u0026lt;0.å¦ 1.å¥½å‹åŠé˜Ÿå‹ 2.æ‰€æœ‰äºº\u0026gt; r_drawtracers_firstperson 1 // ç¬¬ä¸€äººç§°è§†è§’æ˜¾ç¤ºå­å¼¹è½¨è¿¹ \u0026lt;1.å¼€å¯ 0.å…³é—­\u0026gt; //æŒæªå‚æ•° viewmodel_presetpos 1 // æŒæªè§†è§’é¢„è®¾ \u0026lt;1.é»˜è®¤ 2.å†™å® 3.ç»å…¸\u0026gt; cl_prefer_lefthanded 0 // åå¥½å·¦æ‰‹æŒæª å¤æ´»ååˆ·æ–° \u0026lt;1.æ˜¯ 0.å¦\u0026gt; //â”€â”€â”€â”€â”€â”€â”€ è‡ªå®šä¹‰æŒæªè§†è§’å‚æ•°æ”¾åœ¨æ­¤å¤„â†“ è¿™æ˜¯ä¸€ç»„æ¯”è¾ƒå¥½çœ‹çš„æŒæªå‚æ•°ï¼ˆæœªå¼€å¯ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€ // viewmodel_fov \u0026#34;62\u0026#34; // viewmodel_offset_x \u0026#34;2.5\u0026#34; // viewmodel_offset_y \u0026#34;2\u0026#34; // viewmodel_offset_z \u0026#34;-2\u0026#34; // viewmodel_presetpos \u0026#34;0\u0026#34; // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 è®¾ç½®é»˜è®¤æ­¦å™¨ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ mp_ct_default_melee weapon_knife // CT é»˜è®¤è¿‘æˆ˜æ­¦å™¨ä¸ºåˆ€å­ ğŸ”ª mp_ct_default_secondary weapon_usp_silencer // CT é»˜è®¤æ¬¡è¦æ­¦å™¨ä¸ºUSPæ¶ˆéŸ³æ‰‹æª ğŸ”« mp_ct_default_primary weapon_m4a1_silencer // CT é»˜è®¤ä¸»è¦æ­¦å™¨ä¸ºM4A1æ¶ˆéŸ³æ­¥æª ğŸ¹ mp_t_default_melee weapon_knife // T é»˜è®¤è¿‘æˆ˜æ­¦å™¨ä¸ºåˆ€å­ ğŸ”ª mp_t_default_secondary weapon_glock // T é»˜è®¤æ¬¡è¦æ­¦å™¨ä¸ºæ ¼æ´›å…‹æ‰‹æª ğŸ”« mp_t_default_primary weapon_ak47 // T é»˜è®¤ä¸»è¦æ­¦å™¨ä¸ºAK47æ­¥æª ğŸ¦… // â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ 2. æŒæªè®¾ç½® â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ // ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ 3. è§†é¢‘è®¾ç½® ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ //â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ å…¶å®ƒè§†é¢‘è®¾ç½®æ¸¸æˆä¸­æˆ–video.txtä¸­æ›´æ”¹ â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ mat_monitorgamma \u0026#34;2.6\u0026#34; // ä¼½é©¬è®¾ç½® äº®åº¦ è¶Šå°è¶Šäº® \u0026lt;1.6~2.6 é»˜è®¤2.2=110% 2=100%\u0026gt; r_fullscreen_gamma \u0026#34;2.6\u0026#34; // ä¼½é©¬è®¾ç½® äº®åº¦ è¶Šå°è¶Šäº® \u0026lt;1.6~2.6 é»˜è®¤2.2=110% 2=100%\u0026gt; mat_monitorgamma_tv_enabled \u0026#34;0\u0026#34; // æ˜¾ç¤ºæ¨¡å¼ \u0026lt;1.ç”µè§† 0.ç”µè„‘å±å¹•\u0026gt; mat_powersavingsmode \u0026#34;0\u0026#34; // å…³é—­èŠ‚èƒ½æ¨¡å¼ mat_queue_mode \u0026#34;2\u0026#34; // å¤šæ ¸CPUå¼€å¯ r_drawtracers_firstperson \u0026#34;1\u0026#34; // æ‰“å¼€æ›³å…‰å¼¹é“ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; r_dynamic \u0026#34;1\u0026#34; // æ‰“å¼€åŠ¨æ€å…‰ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt;é“å…·çˆ†å¼€å’Œå¼€æªç¬é—´æ‰å¸§å‡å°‘ï¼Œä½†ä¼šå½±å“æˆ˜å±€\u0026gt; cl_interp_ratio \u0026#34;1\u0026#34; // è®¾ç½®æ’å€¼æ¯”ç‡ä¸º1ï¼Œæ„å‘³ç€ä½¿ç”¨æœ€ä½çš„æ’å€¼æ¯”ç‡ã€‚ cl_interp \u0026#34;0.015625\u0026#34; // æ’å€¼æ—¶é—´å†³å®šäº†æ¸¸æˆå¼•æ“å¤„ç†ç½‘ç»œæ•°æ®çš„æ—¶é—´é—´éš” cl_interp_hermite \u0026#34;0\u0026#34; // å¯ç”¨Hermiteæ’å€¼ \u0026lt;0.å…³é—­ 1.å¼€å¯\u0026gt; // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† 3. è§†é¢‘è®¾ç½® ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ 4. é”®ä½ç»‘å®š â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 åŸºæœ¬é”®ä½ç»‘å®š â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ binddefaults; // é‡ç½®æ‰€æœ‰æŒ‰é”®ï¼Œä»¥é˜²é”®ä½å†²çªï¼ŒbindæŒ‡ä»¤å¿…é¡»æ”¾åœ¨ä¹‹åâ†“ // exec \u0026#34;chatwheel.cfg\u0026#34;; // åŠ è½½èŠå¤©è½®ç›˜è®¾ç½®\u0026lt;æ ‡è®°åŠŸèƒ½\u0026gt; æœªå¼€å¯ // alias mute \u0026#34;toggle volume 0 1\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;mute\u0026#34; ä¸ºï¼šåˆ‡æ¢é™éŸ³(æœªç»‘å®šæŒ‰é”®) // bind \u0026#34;home\u0026#34; \u0026#34;exec hlae.cfg\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;Home\u0026#34; ä¸ºï¼šåŠ è½½hlae.cfg // bind \u0026#34;mouse5\u0026#34; \u0026#34;exec auto.cfg\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;mouse5\u0026#34;é¼ æ ‡å‰ä¾§é”® ä¸ºï¼šåŠ è½½auto.cfg æŒ‰mouse5é”®æ—¶ï¼Œè‡ªåŠ¨åŠ è½½auto.cfg é…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤æˆ–è®¾ç½®ã€‚ bind \u0026#34;ins\u0026#34; \u0026#34;exec auto.cfg\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;Insert\u0026#34; ä¸ºï¼šåŠ è½½auto.cfg æŒ‰Inserté”®æ—¶ï¼Œè‡ªåŠ¨åŠ è½½auto.cfg é…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤æˆ–è®¾ç½®ã€‚ bind \u0026#34;del\u0026#34; \u0026#34;exec practice.cfg\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;delete\u0026#34; ä¸ºï¼šåŠ è½½practice.cfg\u0026lt;è·‘å›¾cfg\u0026gt; bind \u0026#34;mouse3\u0026#34; \u0026#34;player_ping\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;mouse3\u0026#34;é¼ æ ‡ä¸­é”® ä¸ºï¼šæ ‡è®°ä½ç½®ï¼Œæ¯”èŠå¤©è½®ç›˜æ›´æ–¹ä¾¿ï¼ŒæŒ‰ä¸‹ä¸ç”¨ç§»åŠ¨é¼ æ ‡å°±å¯ä»¥æ ‡è®° bind \u0026#34;alt\u0026#34; \u0026#34;noclip\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;Alt\u0026#34; ä¸ºï¼šé£è¡Œ alias \u0026#34;pt\u0026#34; \u0026#34;exec practice\u0026#34; // ç»‘å®šæŒ‰é”®\u0026#34;`\u0026#34;æ³¢æµªé”® ä¸ºï¼šè¿›å…¥æ§åˆ¶å°ï¼Œè¾“å…¥\u0026#34;pt\u0026#34;è½½å…¥è·‘å›¾cfg bind \u0026#34;H\u0026#34; \u0026#34;+voicerecord\u0026#34;;\t// ç»‘å®šæŒ‰é”®\u0026#34;H\u0026#34; ä¸ºï¼šä½¿ç”¨éº¦å…‹é£ bind \u0026#34;mouse4\u0026#34; \u0026#34;+voicerecord\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;mouse4\u0026#34;é¼ æ ‡åä¾§é”® ä¸ºï¼šä½¿ç”¨éº¦å…‹é£ bind \u0026#34;F10\u0026#34; \u0026#34;callvote\u0026#34; // ç»‘å®šæŒ‰é”®\u0026#34;F10\u0026#34; ä¸ºï¼šæŠ•ç¥¨æŠ€æœ¯æš‚åœ bind \u0026#34;f\u0026#34; \u0026#34;+lookatweapon;r_cleardecals\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;F\u0026#34; ä¸ºï¼šæ¸…è¡€è¿¹ bind \u0026#34;a\u0026#34; \u0026#34;+moveleft;r_cleardecals\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;A\u0026#34; ä¸ºï¼šæ¸…è¡€è¿¹ bind \u0026#34;d\u0026#34; \u0026#34;+moveright;r_cleardecals\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;D\u0026#34; ä¸ºï¼šæ¸…è¡€è¿¹ bind \u0026#34;shift\u0026#34; \u0026#34;+speed;r_cleardecals\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;shift\u0026#34; ä¸ºï¼šæ¸…è¡€è¿¹ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 ä¸€é”®å¤§è·³ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias +cjump \u0026#34;+jump;+duck\u0026#34;; // å®šä¹‰ \u0026#34;+cjump\u0026#34; åˆ«åï¼ŒåŒæ—¶æŒ‰ä¸‹è·³è·ƒé”®å’Œè¹²ä¼é”® alias -cjump \u0026#34;-jump;-duck\u0026#34;; // å®šä¹‰ \u0026#34;-cjump\u0026#34; åˆ«åï¼ŒåŒæ—¶æ¾å¼€è·³è·ƒé”®å’Œè¹²ä¼é”® bind \u0026#34;space\u0026#34; \u0026#34;+cjump\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;ç©ºæ ¼é”®\u0026#34;ä¸ºï¼š ä¸€é”®å¤§è·³ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 ä¸€é”®è·‘è·³ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias \u0026#34;+runthrow\u0026#34; \u0026#34;+forward;+jump\u0026#34;; // æŒ‰ä½ \u0026#34;j\u0026#34; é”®æ—¶ï¼Œè§¦å‘å‰è¿›å’Œè·³è·ƒåŠ¨ä½œ ğŸƒâ€â™‚ï¸ğŸª‚ alias \u0026#34;-runthrow\u0026#34; \u0026#34;-jump;-forward\u0026#34;; // æ¾å¼€ \u0026#34;j\u0026#34; é”®æ—¶ï¼Œåœæ­¢è·³è·ƒåŠ¨ä½œ â›”ï¸ğŸƒâ€â™‚ï¸ğŸª‚ bind \u0026#34;j\u0026#34; \u0026#34;+runthrow;+throwaction\u0026#34;; // ç»‘å®šæŒ‰é”® \u0026#34;j\u0026#34;ä¸ºï¼š ä¸€é”®è·‘è·³ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 ä¸€é”®è·³æŠ• â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias jumpthrow \u0026#34;-attack;-attack2\u0026#34;; // å®šä¹‰\u0026#34;jumpthrow\u0026#34;å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åœæ­¢ä½¿ç”¨ä¸»è¦æ”»å‡»å’Œæ¬¡è¦æ”»å‡»ï¼Œç”¨äºè¿›è¡Œ\u0026#34;jumpthrow\u0026#34;æŠ€å·§ bind \u0026#34;v\u0026#34; \u0026#34;+jump;-jump;jumpthrow\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;v\u0026#34;ä¸ºï¼š ä¸€é”®è·³æŠ• // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 åŒé”®æŠ•æ· â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias +throw \u0026#34;+attack;+attack2\u0026#34;; // æŒ‰ä¸‹attacké¼ æ ‡å·¦é”®å’Œattack2é¼ æ ‡å³é”®ï¼Œæ‰§è¡ŒåŒé”®æŠ•æ·ï¼ˆæ‰‹é›·ã€çƒŸé›¾å¼¹ã€é—ªå…‰å¼¹æˆ–ç‡ƒçƒ§ç“¶ç­‰ï¼‰ alias -throw \u0026#34;-attack;-attack2\u0026#34;; // æ¾å¼€attacké¼ æ ‡å·¦é”®å’Œattack2é¼ æ ‡å³é”®ï¼Œè¿˜åŸåŒé”®çš„åŸæœ¬åŠŸèƒ½ bind \u0026#34;mouse3\u0026#34; \u0026#34;+throw\u0026#34;; // ç»‘å®šæŒ‰é”®\u0026#34;é¼ æ ‡å·¦é”®\u0026#34;å’Œ\u0026#34;é¼ æ ‡å³é”®\u0026#34;ä¸ºï¼š æ‰”æŠ•æ·ç‰© // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 ä¸€é”®æ£€è§† â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias +inspect \u0026#34;+reload;-reload\u0026#34; // è®¾ç½®ä¸€ä¸ª inspectï¼ˆæ£€æŸ¥ï¼‰çš„åˆ«åï¼Œåœ¨æŒ‰ä½ r é”®æ—¶æ‰§è¡Œ +reload å’Œ -reload å‘½ä»¤ alias -inspect \u0026#34;+lookatweapon;-lookatweapon\u0026#34; // è®¾ç½® inspect ç»“æŸæ—¶çš„åˆ«åï¼Œåœæ­¢é‡æ–°åŠ è½½æ­¦å™¨å’Œåœæ­¢æŸ¥çœ‹æ­¦å™¨ bind \u0026#34;r\u0026#34; \u0026#34;+inspect\u0026#34; // ç»‘å®šæŒ‰\u0026#34;R\u0026#34;é”®ä¸ºï¼š æ£€è§†æ­¦å™¨ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 ä¸€é”®æ€¥åœ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;w\u0026#34; \u0026#34;+forward;clear\u0026#34; // å°† \u0026#34;w\u0026#34; é”®ç»‘å®šä¸ºå‘å‰ç§»åŠ¨ï¼Œå¹¶æ¸…é™¤å…¶ä»–è¾“å…¥ã€‚ bind \u0026#34;s\u0026#34; \u0026#34;+back;clear\u0026#34; // å°† \u0026#34;s\u0026#34; é”®ç»‘å®šä¸ºå‘åç§»åŠ¨ï¼Œå¹¶æ¸…é™¤å…¶ä»–è¾“å…¥ã€‚ bind \u0026#34;a\u0026#34; \u0026#34;+left;clear\u0026#34; // å°† \u0026#34;a\u0026#34; é”®ç»‘å®šä¸ºå‘å·¦ç§»åŠ¨ï¼Œå¹¶æ¸…é™¤å…¶ä»–è¾“å…¥ã€‚ bind \u0026#34;d\u0026#34; \u0026#34;+right;clear\u0026#34; // å°† \u0026#34;d\u0026#34; é”®ç»‘å®šä¸ºå‘å³ç§»åŠ¨ï¼Œå¹¶æ¸…é™¤å…¶ä»–è¾“å…¥ã€‚ bind \u0026#34;shift\u0026#34; \u0026#34;+sprint;clear\u0026#34; // å°† \u0026#34;shift\u0026#34; é”®ç»‘å®šä¸ºåŠ é€Ÿå¥”è·‘ï¼Œå¹¶æ¸…é™¤å…¶ä»–è¾“å…¥ã€‚ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ é‡æ‰”ä¸Šä¸€é¢—æŠ•æ·ç‰© â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;n\u0026#34; \u0026#34;sv_rethrow_last_grenade\u0026#34; // ç»‘å®šæŒ‰é”® \u0026#34;n\u0026#34; ä¸ºï¼šé‡æ‰”ä¸Šä¸€é¢—æŠ•æ·ç‰© // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 å›ºå®šæ»šè½®è·³ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind mwheelup +jump; // æ»šè½®å‘ä¸Šè·³è·ƒ bind mwheeldown +jump; // æ»šè½®å‘ä¸‹è·³è·ƒ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 æ£€è§†é˜Ÿå‹è£…å¤‡ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ cl_teamid_overhead_mode 1 // è®¾ç½®ä¸ºæ˜¾ç¤ºå›¢é˜Ÿå¤´é¡¶çš„æ¨¡å¼ alias show show1 // è®¾ç½®åˆ«å \u0026#34;show\u0026#34; å¹¶ç»‘å®šåˆ° alt æŒ‰é”® alias show1 \u0026#34;+cl_show_team_equipment;alias show show2\u0026#34; // show2åˆ«åæ‰§è¡Œçš„å‘½ä»¤ alias show2 \u0026#34;-cl_show_team_equipment;alias show show1\u0026#34; // show1åˆ«åæ‰§è¡Œçš„å‘½ä»¤ bind \u0026#34;alt\u0026#34; \u0026#34;show\u0026#34; // ç»‘å®šæŒ‰\u0026#34;Alt\u0026#34;é”®ä¸ºï¼šæ£€è§†é˜Ÿå‹è£…å¤‡ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 å¿«é€Ÿæ‰”åŒ… â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias \u0026#34;+dropC4\u0026#34; \u0026#34;slot5\u0026#34; // å½“æŒ‰ä¸‹\u0026#34;C\u0026#34;é”®æ—¶ï¼Œæ‰§è¡Œ\u0026#34;slot5\u0026#34;å‘½ä»¤ alias \u0026#34;-dropC4\u0026#34; \u0026#34;drop\u0026#34; // å½“é‡Šæ”¾\u0026#34;C\u0026#34;é”®æ—¶ï¼Œæ‰§è¡Œ\u0026#34;drop\u0026#34;å‘½ä»¤ bind \u0026#34;C\u0026#34; \u0026#34;+dropC4\u0026#34; // ç»‘å®šæŒ‰\u0026#34;C\u0026#34;é”®ä¸ºï¼šå¿«é€Ÿæ‰”åŒ… // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2ä¸€é”®é€€æ¬¾ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias \u0026#34;refundall\u0026#34; \u0026#34;sellback 0;sellback 1;sellback 2;sellback 3;sellback 4;sellback 5;sellback 6;sellback 7;sellback 8;sellback 9;sellback 10;sellback 11;sellback 12;sellback 13;sellback 14;sellback 15;sellback 16;sellback 17;sellback 18;sellback 19;sellback 20;sellback 21;sellback 22;sellback 23;sellback 24;sellback 25;sellback 26;sellback 27;sellback 28;sellback 29;sellback 30;sellback 31;sellback 32;sellback 33;sellback 34;sellback 35;play ui\\panorama\\itemtile_click_02.vsnd_c\u0026#34; bind backspace refundall // ç»‘å®šæŒ‰\u0026#34;åˆ é™¤\u0026#34;é”®ä¸ºï¼šä¸€é”®é€€æ¬¾ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2é’»çƒŸé›¾å¼¹ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;F5\u0026#34; \u0026#34;host_framerate 0\u0026#34; // å½“æŒ‰ä¸‹ F5 é”®æ—¶ï¼Œæ¸¸æˆçš„å¸§ç‡å°†è¢«è®¾ç½®ä¸º 0ï¼Œæ„å‘³ç€æ¸¸æˆç”»é¢å°†ä¼šæš‚åœï¼Œæ²¡æœ‰åŠ¨ç”»æ•ˆæœã€‚ bind \u0026#34;F6\u0026#34; \u0026#34;host_framerate 0.1\u0026#34; // å½“æŒ‰ä¸‹ F6 é”®æ—¶ï¼Œæ¸¸æˆçš„å¸§ç‡å°†è¢«è®¾ç½®ä¸º 0.1ï¼Œè¿™æ„å‘³ç€æ¸¸æˆç”»é¢å°†ä¼šä»¥éå¸¸ä½çš„é€Ÿåº¦æ’­æ”¾ï¼Œå‡ ä¹æ˜¯é™æ­¢çš„ã€‚ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 å¿«é€Ÿåˆ‡é“å…· â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ åˆ‡é—ª â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;z\u0026#34; \u0026#34;+cflash\u0026#34;; // ç»‘å®šæŒ‰ \u0026#34;z\u0026#34; é”®ä¸ºï¼šåˆ‡é—ªå…‰å¼¹ alias +cflash\u0026#34;slot3\u0026#34;; // å½“æŒ‰ä¸‹ \u0026#34;z\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°ä¸»æ­¦å™¨ï¼ˆslot3ï¼‰ alias -cflash\u0026#34;slot7\u0026#34;; // å½“é‡Šæ”¾ \u0026#34;z\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°é—ªå…‰å¼¹ï¼ˆslot7ï¼‰ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ åˆ‡é›· â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;x\u0026#34; \u0026#34;+yfire\u0026#34;; // ç»‘å®šæŒ‰ \u0026#34;x\u0026#34; é”®ä¸ºï¼šåˆ‡æ‰‹æ¦´å¼¹ alias +yfire\u0026#34;slot3\u0026#34;; // å½“æŒ‰ä¸‹ \u0026#34;x\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°ä¸»æ­¦å™¨ï¼ˆslot3ï¼‰ alias -yfire\u0026#34;slot6\u0026#34;; // å½“é‡Šæ”¾ \u0026#34;x\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°æ‰‹æ¦´å¼¹ï¼ˆslot6ï¼‰ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ åˆ‡çƒŸ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;y\u0026#34; \u0026#34;+zsmoke\u0026#34;; // ç»‘å®šæŒ‰ \u0026#34;y\u0026#34; é”®ä¸ºï¼šåˆ‡çƒŸé›¾å¼¹ alias +zsmoke\u0026#34;slot3\u0026#34;; // å½“æŒ‰ä¸‹ \u0026#34;y\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°ä¸»æ­¦å™¨ï¼ˆslot3ï¼‰ alias -zsmoke\u0026#34;slot8\u0026#34;; // å½“é‡Šæ”¾ \u0026#34;y\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°çƒŸé›¾å¼¹ï¼ˆslot8ï¼‰ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ åˆ‡ç« â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;u\u0026#34; \u0026#34;+xfire\u0026#34;; // ç»‘å®šæŒ‰ \u0026#34;u\u0026#34; é”®ä¸ºï¼šåˆ‡ç‡ƒçƒ§å¼¹ alias +xfire\u0026#34;slot3\u0026#34;; // å½“æŒ‰ä¸‹ \u0026#34;u\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°ä¸»æ­¦å™¨ï¼ˆslot3ï¼‰ alias -xfire\u0026#34;slot10\u0026#34;; // å½“é‡Šæ”¾ \u0026#34;u\u0026#34; é”®æ—¶ï¼Œåˆ‡æ¢åˆ°ç‡ƒçƒ§å¼¹ï¼ˆslot10ï¼‰ // é¼ æ ‡æŒ‰é”®åâ¡ï¸ mouse1é¼ æ ‡å³é”®â¬…ï¸ â¡ï¸ mouse2é¼ æ ‡å·¦é”®â¬…ï¸ â¡ï¸ mouse3é¼ æ ‡ä¸­é”®åŠŸèƒ½é”®â¬…ï¸ â¡ï¸ mouse4é¼ æ ‡åä¾§é”®â¬…ï¸ â¡ï¸mouse5é¼ æ ‡å‰ä¾§é”®â¬…ï¸ â¡ï¸mwheelupé¼ æ ‡æ»šè½®ä¸Š â¬…ï¸ â¡ï¸mwheeldowné¼ æ ‡æ»šè½®ä¸‹â¬…ï¸ â¡ï¸space ç©ºæ ¼é”®â¬…ï¸ â¡ï¸enterå›è½¦é”®â¬…ï¸ // â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ 4. é”®ä½ç»‘å®š â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ // ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ 5. å¿«é€Ÿä¹°æª ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ bind kp_0 \u0026#34;buy ak47;buy m4a1;buy vesthelm;buy m4a1_silencer; \u0026#34; // å°é”®ç›˜ \u0026#34;0\u0026#34; AKæˆ–M4+å…¨ç”² bind kp_1 \u0026#34;buy vest; \u0026#34; // å°é”®ç›˜ \u0026#34;1\u0026#34; åŠç”² bind kp_2 \u0026#34;buy vesthelm; \u0026#34; // å°é”®ç›˜ \u0026#34;2\u0026#34; å…¨ç”² bind kp_3 \u0026#34;buy flashbang; \u0026#34; // å°é”®ç›˜ \u0026#34;3\u0026#34; é—ªå…‰ bind kp_4 \u0026#34;buy hegrenade; \u0026#34; // å°é”®ç›˜ \u0026#34;4\u0026#34; æ‰‹é›· bind kp_5 \u0026#34;buy smokegrenade; \u0026#34; // å°é”®ç›˜ \u0026#34;5\u0026#34; çƒŸé›¾ bind kp_6 \u0026#34;buy molotov;buy Incgrenade; \u0026#34; // å°é”®ç›˜ \u0026#34;6\u0026#34; ç‡ƒçƒ§ç“¶ bind kp_7 \u0026#34;buy defuser; \u0026#34; // å°é”®ç›˜ \u0026#34;7\u0026#34; é›·é’³ bind kp_8 \u0026#34;buy molotov;buy Incgrenade;buy smokegrenade;buy hegrenade;buy flashbang;buy defuser; \u0026#34; // å°é”®ç›˜ \u0026#34;8\u0026#34; é›·ç«å¥—é¤ bind kp_9 \u0026#34;buy hegrenade;buy defuser; \u0026#34; // å°é”®ç›˜ \u0026#34;9\u0026#34; é›·é’³+æ‰‹é›· bind kp_plus \u0026#34;buy bizon;buy vest;buy vesthelm; \u0026#34; // å°é”®ç›˜ \u0026#34;+\u0026#34; é‡ç‰›+åŠç”²+å…¨ç”² bind kp_minus \u0026#34;buy galilar; buy famas;buy vest;buy vesthelm; \u0026#34; // å°é”®ç›˜ \u0026#34;-\u0026#34; ä¼½åˆ©+æ³•é©¬æ–¯+åŠç”²+å…¨ç”² bind kp_multiply \u0026#34;buy negev;buy vest;buy vesthelm; \u0026#34; // å°é”®ç›˜ \u0026#34;*\u0026#34; å†…æ ¼å¤«+åŠç”²+å…¨ç”² bind kp_divide \u0026#34;buy mac10;buy mp9;buy vest;buy vesthelm; \u0026#34; // å°é”®ç›˜ \u0026#34;/\u0026#34; å¹é£æœº+å°èœœèœ‚+åŠç”²+å…¨ç”² bind kp_del \u0026#34;buy deagle;buy vest;buy vesthelm \u0026#34; // å°é”®ç›˜ \u0026#34;.\u0026#34; æ²™é¹°+åŠç”²+å…¨ç”² bind kp_enter \u0026#34;buy awp;buy vest;buy vesthelm; \u0026#34; // å°é”®ç›˜ \u0026#34;å›è½¦\u0026#34; å¤§ç‹™+åŠç”²+å…¨ç”² // â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ æ‰‹æªé¢„è®¾ â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ // ğŸ‘‰P250æ‰‹æªï¼šbuy p250; ğŸ‘ˆğŸ‘‰FN57æ‰‹æªï¼šbuy fn57; ğŸ‘ˆğŸ‘‰cz75åŠè‡ªåŠ¨æ‰‹æªï¼šbuy cz75; ğŸ‘ˆğŸ‘‰TEC9å¤ªå¯è€ï¼šbuy tec9;ğŸ‘ˆğŸ‘‰åŒæªï¼šbuy elite; ğŸ‘ˆğŸ‘‰æ²™æ¼ ä¹‹é¹°ï¼šbuy deagle;ğŸ‘ˆğŸ‘‰R8æ‰‹æªï¼šbuy Revolver; ğŸ‘ˆ // â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ å†²é”‹æªé¢„è®¾ â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ // ğŸ‘‰MAC-10å†²é”‹æªï¼šbuy mac10; ğŸ‘ˆğŸ‘‰MP9å†²é”‹æªï¼šbuy mp9; ğŸ‘ˆğŸ‘‰MP7å†²é”‹æªï¼šbuy mp7; ğŸ‘ˆğŸ‘‰MP5å†²é”‹æªï¼šbuy mp5sd;ğŸ‘ˆğŸ‘‰UMP45å†²é”‹æªï¼šbuy ump45;ğŸ‘ˆğŸ‘‰P90å†²é”‹æªï¼šbuy p90; ğŸ‘ˆğŸ‘‰é‡ç‰›å†²é”‹æªï¼šbuy bizon; ğŸ‘ˆ // â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ æ­¥æªé¢„è®¾ â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ // ğŸ‘‰AK-47æ­¥æªï¼šbuy ak47; ğŸ‘ˆğŸ‘‰M4A4æ­¥æªï¼šbuy m4a1; ğŸ‘ˆğŸ‘‰M4A1æ­¥æªï¼šbuy m4a1_silencer;ğŸ‘ˆğŸ‘‰ä¼½åˆ©ï¼šbuy galilar; ğŸ‘ˆğŸ‘‰æ³•é©¬æ–¯ï¼šbuy famas; ğŸ‘ˆğŸ‘‰AUGæ­¥æªï¼šbuy aug; ğŸ‘ˆğŸ‘‰SG553æ­¥æªï¼šbuy sg556; ğŸ‘ˆğŸ‘‰é¸Ÿç‹™ï¼šbuy ssg08;ğŸ‘ˆğŸ‘‰åŒªè¿ç‹™ï¼šbuy g3sg1; ğŸ‘‰è­¦è¿ç‹™ï¼šbuy scar20; ğŸ‘ˆğŸ‘‰å¤§ç‹™æ­¥æªï¼šbuy awp;ğŸ‘ˆ // â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ é‡å‹æ­¦å™¨é¢„è®¾ â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ // ğŸ‘‰è¶…æ–°æ˜Ÿéœ°å¼¹æªï¼šbuy nova; ğŸ‘ˆğŸ‘‰è¿å–·ï¼šbuy xm1014; ğŸ‘ˆğŸ‘‰è­¦å–·ï¼šbuy mag7; ğŸ‘ˆğŸ‘‰å†…æ ¼å¤«ï¼šbuy negev; ğŸ‘ˆğŸ‘‰M249æœºæªï¼šbuy m249; ğŸ‘ˆğŸ‘‰åŒªå–·ï¼šbuy sawedoff ğŸ‘ˆ // â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ é“å…·é¢„è®¾ â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ // ğŸ‘‰çƒŸé›¾å¼¹ï¼šbuy smokegrenade;ğŸ‘ˆğŸ‘‰é—ªå…‰å¼¹ï¼šbuy flashbang;ğŸ‘ˆğŸ‘‰æ‰‹é›·ï¼šbuy hegrenade; ğŸ‘ˆğŸ‘‰ç‡ƒçƒ§ç“¶ï¼šbuy molotov; ğŸ‘ˆğŸ‘‰ç‡ƒçƒ§å¼¹ï¼šbuy Incgrenade;ğŸ‘ˆğŸ‘‰è¯±é¥µå¼¹ï¼šbuy decoy; ğŸ‘ˆğŸ‘‰ç”µå‡»æªï¼šbuy taser; ğŸ‘ˆğŸ‘‰åŠç”²ï¼šbuy vest; ğŸ‘ˆğŸ‘‰å…¨ç”²ï¼šbuy vesthelm; ğŸ‘ˆğŸ‘‰é›·é’³ï¼š buy defuser;ğŸ‘ˆ // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† 5. å¿«é€Ÿä¹°æª ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ 6. åŸºç¡€è®¾ç½® â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ con_enable 1 // å¼€å¯æ§åˆ¶å°[ä¸ç”¨æ”¹] fps_max 0 // æœ€å¤§å¸§æ•° fps_max_menu 60 // ä¸»ç•Œé¢æœ€å¤§å¸§æ•° engine_no_focus_sleep 50 // çª—å£å¤±ç„¦/åœ¨åå°æ—¶æ‰å¸§çœç”µ \u0026lt;50é»˜è®¤ 0å…³é—­\u0026gt; rate 786432 // ç½‘ç»œå¸¦å®½æ‹‰æ»¡ å•ä½BPS cl_playerspray_auto_apply 1 // å¿«é€Ÿæ¶‚é¸¦ï¼ˆæŒ‰é”®é‡Šæ”¾æ—¶åº”ç”¨ï¼‰ \u0026lt;1.æ˜¯ 0.å¦\u0026gt; cl_cmdrate 128 // è®¾ç½®tickrateï¼Œå¯åŠ¨é¡¹ä¹Ÿéœ€ -tickrate 128 cl_updaterate 128 // å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é¢‘ç‡ï¼Œä»¥åˆ·æ–°å¹¶æ¥æ”¶æ–°çš„æ¸¸æˆçŠ¶æ€å’Œç©å®¶è¾“å…¥ cl_autowepswitch 0 // å…³é—­è‡ªåŠ¨æ¢ä¸Šæ¡èµ·çš„æ­¦å™¨ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; cl_autohelp 0 // ç¦ç”¨æ¸¸æˆæç¤º \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt;ï¼ˆåˆ‡æ¢å•å‘/ä¸‰è¿å‘æç¤ºï¼‰ cl_showpos 0 // ä¸æ˜¾ç¤ºä½ç½®é€Ÿåº¦ä¿¡æ¯ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; cl_use_opens_buy_menu 0 // å…³é—­Eé”®æ‰“å¼€è´­ä¹°èœå• \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; cl_crosshair_friendly_warning 1 // ç„å‡†é˜Ÿå‹æ—¶å åŠ ç‰¹æ®Šå‡†æ˜Ÿ \u0026lt;0.ä¸æ˜¾ç¤º 1.ä»…ä½¿ç”¨é»˜è®¤å‡†æ˜Ÿæ—¶æ˜¾ç¤º 3.ä¸€ç›´æ˜¾ç¤º\u0026gt; cl_teamid_overhead_mode 2 // éš”å¢™æ˜¾ç¤ºé˜Ÿå‹ä½ç½® \u0026lt;0.ä¸æ˜¾ç¤º 1.é€è§†é˜Ÿå‹ä½ç½® 2.é€è§†é˜Ÿå‹ä½ç½®ä¸è£…å¤‡\u0026gt; cl_teammate_colors_show 1 // ç«æŠ€æ¨¡å¼é˜Ÿå‹é¢œè‰² \u0026lt;0.ä¸æ˜¾ç¤º 1.æ˜¾ç¤ºé¢œè‰² 2.æ˜¾ç¤ºé¢œè‰²+è‹±æ–‡é¦–å­—æ¯\u0026gt; cl_hud_playercount_pos 0 // è¿·ä½ è®¡åˆ†æ¿ä½ç½® \u0026lt;0.å±å¹•é¡¶ç«¯ 1.å±å¹•åº•ç«¯\u0026gt; cl_hud_playercount_showcount 0 // è¿·ä½ è®¡åˆ†æ¿æ ·å¼ \u0026lt;0.æ˜¾ç¤ºç©å®¶å¤´åƒ 1.åªæ˜¾ç¤ºç©å®¶æ•°\u0026gt; cl_radar_square_with_scoreboard 0 // åˆ‡æ¢è®¡åˆ†æ¿å¤–è§‚ \u0026lt;0.åœ†å½¢ 1.æ–¹å½¢\u0026gt; spec_replay_autostart 0 // å…³é—­è¢«å‡»æ€å›æ”¾ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; mm_dedicated_search_maxping 350 // æœ€å¤§åŒ¹é…å»¶è¿Ÿms // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ è·‘å›¾ç›¸å…³å‚æ•° â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ gameinstructor_enable 0 // å…³é—­æ¸¸æˆæ•™å­¦ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; cl_showloadout 1 // æ€»æ˜¯æ˜¾ç¤ºç‰©å“æ  \u0026lt;1.æ˜¯ 0.å¦\u0026gt; cl_spec_follow_grenade_key 0 // æ‰‹é›·è¿½è¸ªé”® \u0026lt;0.å·¦ALT 1.å·¦SHIFT 2.è£…å¼¹é”®(R)\u0026gt; cl_dm_buyrandomweapons 0 // å…³é—­æ­»æ–—éšæœºä¹°æª \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ æ˜¾ç¤ºå¸§ç‡å»¶è¿Ÿ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ cl_showfps 0\t// å³ä¸Šè§’æ˜¾ç¤ºæ¸¸æˆä¸­çš„å¸§ç‡ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; å·¦ä¸Šè§’çº¢è‰²fpsæ˜¾ç¤ºï¼ˆæœ‰ç‚¹ç¢çœ¼ï¼š0.å…³é—­ï¼‰ cq_netgraph 0 // å³ä¸Šè§’æ˜¾ç¤ºæ¸¸æˆä¸­çš„å»¶è¿Ÿ \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; cq_netgraph_problem_show_auto 0 // å…³é—­ç½‘ç»œé—®é¢˜è‡ªåŠ¨æ˜¾ç¤º \u0026lt;0.å…³é—­-1.å¼€å¯\u0026gt; // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ æ˜¾ç¤ºç½‘ç»œå‚æ•° â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ net_graph 1 // æ˜¾ç¤ºç½‘ç»œå‚æ•° \u0026lt;1.æ˜¾ç¤º 0.éšè—\u0026gt; net_graphpos 2 // ç½‘ç»œå‚æ•°æ°´å¹³ä½ç½® \u0026lt;1.å³ 2.ä¸­ 3.å·¦\u0026gt; net_graphheight 0 // ç«–ç›´æ–¹å‘é«˜åº¦ è®¾ç½®ä¸º 0 å°†éšè—ç½‘ç»œå›¾ï¼Œè°ƒæ•´å‚æ•°çš„æ˜¾ç¤ºé«˜åº¦ net_graphproportionalfont 1 // å­—ä½“å¤§å° \u0026lt;0.å°å· 1.å¤§å·\u0026gt; // â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ 6. åŸºç¡€è®¾ç½® â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ // ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ 7. å£°éŸ³è®¾ç½® ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ // â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ éŸ³é‡ [1=100%][0.5=50%] â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£â‡£ volume 0.8 // ä¸»éŸ³é‡ snd_menumusic_volume 0.00 // ä¸»èœå•éŸ³ä¹éŸ³é‡ snd_roundstart_volume 0.03 // å›åˆå¼€å§‹éŸ³é‡ snd_roundaction_volume 0.03 // å›åˆå¼€å§‹è¡ŒåŠ¨éŸ³é‡ snd_roundend_volume 0.03 // å›åˆç»“æŸéŸ³é‡ snd_mapobjective_volume 0.12 // ç‚¸å¼¹/äººè´¨éŸ³é‡ snd_tensecondwarning_volume 0.08 // åç§’è­¦å‘ŠéŸ³é‡ snd_deathcamera_volume 0.08 // æ­»äº¡è§†è§’éŸ³é‡ snd_mvp_volume 0.08 // MVP éŸ³é‡ snd_mute_mvp_music_live_players 1 // å½“åŒæ–¹å›¢é˜Ÿæˆå‘˜éƒ½å­˜æ´»æ—¶å…³é—­ MVP éŸ³ä¹ \u0026lt;0.å…³é—­ï¼Œ1.å¼€å¯\u0026gt; snd_dzmusic_volume 0.1 // å¤´å·ç‰¹è®­éŸ³é‡ snd_mute_losefocus 0 // å½“æ¸¸æˆå¤„äºèƒŒæ™¯æ—¶æ’­æ”¾éŸ³é¢‘ \u0026lt;0.åå°æ’­æ”¾å£°éŸ³ï¼Œ1.åå°é™éŸ³\u0026gt; snd_voipvolume 0.5 // é˜Ÿå‹è¯­éŸ³äº¤æµéŸ³é‡ snd_front_headphone_position 45.0 // è€³æœºä¼˜åŒ–_å‰æ–¹ç«‹ä½“å£°è€³æœºä½ç½®ä¸º45.0 snd_rear_headphone_position 90.0 // è€³æœºä¼˜åŒ–_åæ–¹ç«‹ä½“å£°è€³æœºä½ç½®ä¸º90.0 snd_headphone_pan_exponent 1.2 // è€³æœºä¼˜åŒ–_ç«‹ä½“å£°è€³æœºå¹³ç§»æŒ‡æ•°ä¸º1.2 snd_headphone_pan_radial_weight 0.5 // è€³æœºä¼˜åŒ–_ç«‹ä½“å£°è€³æœºå¾„å‘å¹³ç§»æƒé‡ä¸º0.5 snd_mixahead 0.05 // è€³æœºä¼˜åŒ–_æ··éŸ³æå‰é‡ä¸º0.05 snd_headphone_eq 1 // å‡è¡¡å™¨ç®€ä»‹ \u0026lt;0.è‡ªç„¶ 1.æ¸…è„† 2.å¹³æ»‘\u0026gt; snd_spatialize_lerp 0.55 // å·¦å³å£°é“ç‹¬ç«‹ç™¾åˆ†æ¯” snd_steamaudio_enable_perspective_correction 0 // é€è§†çŸ«æ­£ \u0026lt;0.å¦ 1.æ˜¯\u0026gt; voice_always_sample_mic 0 // ç®€åŒ–æ¨é€å¹¶è¿æ¥ \u0026lt;0.å¦ 1.æ˜¯\u0026gt; voice_positional 0 // å…³é—­ VOIP å®šä½[ä¸ç”¨æ”¹] voice_modenable 1 // å¯ç”¨è¯­éŸ³[ä¸ç”¨æ”¹] voice_enable 1 // æŒ‰é”®é€šè¯[ä¸ç”¨æ”¹] cl_player_ping_mute 0 // ç©å®¶æ ‡è®° \u0026lt;0.æ˜¾ç¤ºå¹¶æ’­æ”¾å£°éŸ³ 1.æ— å£°æ˜¾ç¤º 2.ç¦ç”¨\u0026gt; cl_mute_enemy_team 0 // å°†æ•Œæ–¹é™éŸ³ \u0026lt;0.å¦ 1.æ˜¯\u0026gt; cl_mute_all_but_friends_and_party 0 // é™¤å¥½å‹å¤–ä¸€å¾‹é™éŸ³ \u0026lt;0.å¦ 1.ä»…åœ¨éç«æŠ€æ¨¡å¼ä¸­ç”Ÿæ•ˆ 2.æ€»æ˜¯\u0026gt; cl_allow_animated_avatars 0 // å…è®¸ä½¿ç”¨StramåŠ¨æ€å¤´åƒ \u0026lt;0.å¦ 1.æ˜¯\u0026gt; cl_hide_avatar_images 0 // éšè—å¤´åƒå›¾ç‰‡ \u0026lt;0.å…¨éƒ¨æ˜¾ç¤º 1.å…¨éƒ¨éšè— 2.åªæ˜¾ç¤ºå¥½å‹\u0026gt; cl_sanitize_player_names 0 // æ¸…ç†ç©å®¶åç§° \u0026lt;0.å¦ 1.æ˜¯\u0026gt; // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† 7. å£°éŸ³è®¾ç½® ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ 8. HUDè®¾ç½® â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ åŸºæœ¬HUD â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ cl_color 1 // é˜Ÿä¼ä¸­é¢œè‰² \u0026lt;0.é»„è‰² 1.ç´«è‰² 2.ç»¿è‰² 3.è“è‰² 4.æ©™è‰²\u0026gt; cl_hud_color 4 // è®¾ç½®HUDé¢œè‰² \u0026lt;0.é»˜è®¤ 1.ç™½è‰² 2.æ·¡è“è‰² 3.è“è‰² 4.ç´«è‰² 5.çº¢è‰² 6.æ©™è‰² 7.é»„è‰² 8.ç»¿è‰² 9.æ·¡ç»¿è‰² 10.ç²‰çº¢è‰²\u0026gt; cl_hud_background_alpha 0.0000 // HUDé€æ˜åº¦ \u0026lt;0.5=50% 1=100%\u0026gt; cl_hud_healthammo_style 0 // ç”Ÿå‘½å€¼å’Œå¼¹è¯æ ·å¼ \u0026lt;0.é»˜è®¤ 1.ç®€çº¦\u0026gt; cl_hud_radar_scale 1.3 // é›·è¾¾å¤§å° \u0026lt;0.8-1.3\u0026gt; é›·è¾¾å¤§å°ï¼Œè°ƒåˆ°æœ€å¤§:1.3 cl_radar_scale 0.38 // é›·è¾¾ç¼©æ”¾ \u0026lt;0.38\u0026gt; é›·è¾¾æ˜¾ç¤ºåœ°å›¾èŒƒå›´ï¼Œæ•°å­—è¶Šå°æ˜¾ç¤ºåœ°å›¾èŒƒå›´è¶Šå¤§ cl_radar_icon_scale_min 0.4 // é›·è¾¾äººç‰©æ ‡ç‚¹å¤§å° \u0026lt;0.4\u0026gt; ç½®æ˜¾ç¤ºé˜Ÿå‹é‚£äº›ç‚¹ç‚¹çš„å¤§å°ï¼Œä¸€èˆ¬0.4 cl_radar_rotate 0 // é›·è¾¾æ—‹è½¬ \u0026lt;0ä¸æ—‹è½¬ï¼Œ1æ—‹è½¬\u0026gt; cl_radar_always_centered 0 // é›·è¾¾å±…ä¸­ \u0026lt;0ä¸ºå…³é—­ï¼ˆå¯ä»¥çœ‹åˆ°å®Œæ•´åœ°å›¾ï¼‰1ä¸ºå¼€å¯ï¼ˆè‡ªå·±åœ¨é›·è¾¾å±…ä¸­æ˜¾ç¤ºï¼‰\u0026gt; cl_teamcounter_playercount_instead_of_avatars 1 // ç©å®¶å¤§è®¡æ•° \u0026lt;0.æ˜¾ç¤ºç©å®¶å¤´åƒ 1.æ˜¾ç¤ºæ•°å­—\u0026gt; hud_showtargetid 1 // æ˜¾ç¤ºé˜Ÿå‹/æ•Œäººid åœ¨æ¸¸æˆç•Œé¢ä¸Šæ˜¾ç¤ºç›®æ ‡çš„IDä¿¡æ¯ã€‚å°†å…¶è®¾ç½®ä¸º 1 å¯ä»¥å¼€å¯ç›®æ ‡IDçš„æ˜¾ç¤º hud_scaling 0.95 // HUDç¼©æ”¾ \u0026lt;0.5~0.95 é»˜è®¤0.95 æ•´ä½“hudæ¯”ä¾‹ï¼Œè°ƒåˆ°æœ€å¤§:0.95\u0026gt; safezonex 1 // HUDæ°´å¹³å æ¯” è®¾ç½®ä¸º 1 å¯ä»¥ä½¿æ°´å¹³å®‰å…¨åŒºåŸŸæœ€å¤§åŒ–ï¼Œä»¥ç¡®ä¿å±å¹•ä¸Šçš„å…ƒç´ ä¸ä¼šè¢«è£å‰ªã€‚ safezoney 1 // HUDç«–ç›´å æ¯” è®¾ç½®ä¸º 1 å¯ä»¥æœ€å¤§åŒ–å‚ç›´å®‰å…¨åŒºåŸŸï¼Œä»¥ç¡®ä¿å±å¹•ä¸Šçš„å…ƒç´ ä¸ä¼šè¢«è£å‰ªã€‚ ui_steam_overlay_notification_position \u0026#34;topright\u0026#34; // steamé€šçŸ¥å‡ºç°åœ¨å±å¹•çš„å³ä¸Šè§’ï¼š\u0026#34;topright\u0026#34;ï¼Œç§»åŠ¨åˆ°å±å¹•çš„å·¦ä¸‹è§’ï¼š\u0026#34;bottomleft\u0026#34; ui_steam_overlay_notification_position_horz 0 // ç¤¾åŒºé€šçŸ¥æ°´å¹³åç§» ui_steam_overlay_notification_position_vert 0 // ç¤¾åŒºé€šçŸ¥å‚ç›´åç§» // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ å½©è™¹HUD â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ alias \u0026#34;blue\u0026#34; \u0026#34;cl_hud_color 4\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºè“è‰² ğŸ’™ alias \u0026#34;purple\u0026#34; \u0026#34;cl_hud_color 5\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºç´«è‰² ğŸ’œ alias \u0026#34;red\u0026#34; \u0026#34;cl_hud_color 6\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºçº¢è‰² â¤ï¸ alias \u0026#34;green\u0026#34; \u0026#34;cl_hud_color 9\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºç»¿è‰² ğŸ’š alias \u0026#34;orange\u0026#34; \u0026#34;cl_hud_color 7\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºæ©™è‰² ğŸ§¡ alias \u0026#34;white\u0026#34; \u0026#34;cl_hud_color 1\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºç™½è‰² ğŸ¤ alias \u0026#34;yellow\u0026#34; \u0026#34;cl_hud_color 8\u0026#34; // å°† HUD é¢œè‰²è®¾ä¸ºé»„è‰² ğŸ’› bind \u0026#34;w\u0026#34; \u0026#34;+forward;blue\u0026#34; // å½“æŒ‰ä¸‹ w é”®æ—¶è§¦å‘å‰è¿›åŠ¨ä½œä»¥åŠå°† HUD é¢œè‰²è®¾ä¸ºè“è‰² ğŸš¶ğŸ”µ bind \u0026#34;s\u0026#34; \u0026#34;+back;purple\u0026#34; // å½“æŒ‰ä¸‹ s é”®æ—¶è§¦å‘åé€€åŠ¨ä½œä»¥åŠå°† HUD é¢œè‰²è®¾ä¸ºç´«è‰² ğŸš¶â¬…ï¸ğŸŸ£ bind \u0026#34;d\u0026#34; \u0026#34;+right;red\u0026#34; // å½“æŒ‰ä¸‹ d é”®æ—¶è§¦å‘å‘å³ç§»åŠ¨åŠ¨ä½œä»¥åŠå°† HUD é¢œè‰²è®¾ä¸ºçº¢è‰² ğŸš¶â¡ï¸â¤ï¸ bind \u0026#34;a\u0026#34; \u0026#34;+left;green\u0026#34; // å½“æŒ‰ä¸‹ a é”®æ—¶è§¦å‘å‘å·¦ç§»åŠ¨åŠ¨ä½œä»¥åŠå°† HUD é¢œè‰²è®¾ä¸ºç»¿è‰² ğŸš¶â¬…ï¸ğŸ’š bind \u0026#34;f\u0026#34; \u0026#34;+lookatweapon;yellow\u0026#34; // å½“æŒ‰ä¸‹ f é”®æ—¶è§¦å‘æŸ¥çœ‹æ­¦å™¨åŠ¨ä½œä»¥åŠå°† HUD é¢œè‰²è®¾ä¸ºé»„è‰² ğŸš¶â€â™‚ï¸ğŸ”ğŸ’› // â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ 8. HUDè®¾ç½® â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸â¬†ï¸ // ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ 9. Nikoå‡†æ˜Ÿ-çº¢è‰²åœ†ç‚¹ ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ crosshair 1 // å¼€å¯å‡†æ˜Ÿ \u0026lt;0å…³é—­/1å¼€å¯\u0026gt; cl_crosshairstyle 2; // å‡†æ˜Ÿé£æ ¼ \u0026lt;0é»˜è®¤,1é»˜è®¤é™æ€,2ç»å…¸,3ç»å…¸åŠ¨æ€,4ç»å…¸é™æ€\u0026gt; cl_crosshair_friendly_warning 1; // å‡†æ˜Ÿé˜Ÿå‹ä¼¤å®³è­¦å‘Š \u0026lt;0å…³é—­/1å¼€å¯\u0026gt; cl_crosshair_recoil 0; // è·ŸéšåååŠ› \u0026lt;0å…³é—­/1å¼€å¯\u0026gt; cl_crosshair_drawoutline 1; //è½®å»“çº¿ï¼š è®¾ç½®ä¸º1ä»¥æ˜¾ç¤ºå‡†æ˜Ÿè½®å»“çº¿ï¼Œæˆ–è®¾ç½®ä¸º0ä»¥éšè—è½®å»“çº¿ã€‚ cl_crosshairalpha 255; //é€æ˜åº¦ï¼š è°ƒæ•´é€æ˜åº¦çš„å€¼ï¼ŒèŒƒå›´æ˜¯0åˆ°255ã€‚ cl_crosshaircolor 5; //é¢œè‰²ç±»å‹ï¼š 0è¡¨ç¤ºé»˜è®¤ï¼Œ1åˆ°5è¡¨ç¤ºè‡ªå®šä¹‰é¢œè‰²ã€‚ cl_crosshaircolor_b 0; //è“è‰²é€šé“å€¼ï¼š èŒƒå›´æ˜¯0åˆ°255 cl_crosshaircolor_g 0; //ç»¿è‰²é€šé“å€¼ï¼š èŒƒå›´æ˜¯0åˆ°255 cl_crosshaircolor_r 139; //çº¢è‰²é€šé“å€¼ï¼š èŒƒå›´æ˜¯0åˆ°255 cl_crosshairdot 1; //ä¸­å¿ƒçš„å°ç‚¹ï¼š è®¾ç½®ä¸º1ä»¥æ˜¾ç¤º è®¾ç½®ä¸º0ä»¥éšè—ç‚¹ã€‚ cl_crosshairgap -4; //ä¸­å¿ƒå’Œè¾¹ç¼˜é—´éš™ï¼š æ•°å€¼å¯ä»¥ä¸ºæ­£è´Ÿã€‚ cl_crosshairsize 0.5; //å‡†æ˜Ÿçš„å¤§å°ï¼š åœ†å½¢ï¼š0.5ï¼Œæ–¹å½¢ï¼š0 cl_crosshairstyle 4; //å‡†æ˜Ÿçš„æ ·å¼ï¼š 0è¡¨ç¤ºé»˜è®¤ï¼Œ1è¡¨ç¤ºCS1.6æ ·å¼ï¼Œ2è¡¨ç¤ºåŠ¨æ€å‡†æ˜Ÿï¼Œ3è¡¨ç¤ºé€æ¸æ”¶ç¼©çš„å‡†æ˜Ÿï¼Œ4è¡¨ç¤ºå¢é•¿/å‡å°çš„å‡†æ˜Ÿï¼Œ5è¡¨ç¤ºåŠ¨æ€æ ·å¼ cl_crosshairthickness 1; //çº¿æ¡çš„ç²—ç»†ï¼š æ•°å€¼å¯ä»¥æ˜¯ä»»æ„éè´Ÿæ•´æ•°ã€‚ cl_crosshair_sniper_width 1; //ç‹™å‡»æªå‡†æ˜Ÿçš„å®½åº¦ï¼š æ•°å€¼å¯ä»¥æ˜¯ä»»æ„éè´Ÿæ•´æ•°ã€‚ // â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ CS2 æŠ•æ·ç‰©å‡†æ˜Ÿ â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸â¬‡ï¸ bind \u0026#34;mouse5\u0026#34; \u0026#34;toggle cl_crosshairsize 0.1 1000;\u0026#34; // ç»‘å®šæŒ‰é”®\u0026#34;mouse5\u0026#34;é¼ æ ‡å‰ä¾§é”®ä¸ºï¼š æŠ•æ·ç‰©å‡†æ˜Ÿï¼š 0.1 1000ï¼ˆ0.1ä¸ºä½ çš„å‡†æ˜Ÿé•¿åº¦ï¼‰ // æ§åˆ¶å°è·å–å‡†æ˜Ÿå‚æ•°æŒ‡ä»¤ï¼šecho ;echo \u0026#34;==================== å‡†æ˜Ÿå‚æ•° ====================\u0026#34;;echo ;sv_max_allowed_developer 2;developer 2;con_filter_enable 1;con_filter_text cl_crosshair;host_writeconfig;con_filter_text cl_fix;host_writeconfig;developer 0;con_filter_enable 0; // ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† 9. Nikoå‡†æ˜Ÿ-çº¢è‰²åœ†ç‚¹ ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘† // å†™å…¥configï¼Œå®ç°è‡ªåŠ¨åŠ è½½ host_writeconfig; // host_writeconfigç”¨äºå°†å½“å‰æœåŠ¡å™¨é…ç½®å†™å…¥é…ç½®æ–‡ä»¶configä¸­ã€‚é€šè¿‡è¿è¡Œ host_writeconfigï¼Œé…ç½®æ–‡ä»¶å°†è¢«æ›´æ–°ä¸ºå½“å‰æœåŠ¡å™¨çš„è®¾ç½®ã€‚ // è¾“å‡ºæ§åˆ¶å°æç¤º clear echo \u0026#34;â–ˆâ–€â–€â–ˆ â–ˆ â–ˆ â–ˆâ–€â–€â–ˆ â–ˆâ–€â–€â–ˆ â–„â–ˆ â–ˆâ–€â–€â–€ â–ˆâ–€â–€ â–ˆâ–€â–€ â–ˆâ–€â–€â–€ â–„â–ˆ â–€â–€â–€â–ˆ\u0026#34; echo \u0026#34;â–ˆâ–„â–„â–ˆ â–ˆ â–ˆ â–ˆâ–„â–„â–€ â–ˆâ–„â–„â–ˆ â–ˆ â–ˆâ–€â–€â–€ â–ˆ â–ˆâ–€â–€ â–ˆ â–€â–ˆ â–ˆ â–ˆ \u0026#34; echo \u0026#34;â–ˆ â–€â–„â–„â–€ â–ˆ â–ˆ â–ˆ â–„â–ˆâ–„ â–ˆâ–„â–„â–„ â–€â–€â–€ â–€ â–€â–€â–€â–€ â–„â–ˆâ–„ â–ˆ â–ˆ \u0026#34; echo \u0026#34;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0026#34; echo \u0026#34;â”€â”€â”€â”€ åŠ è½½è®¾ç½®[auto.cfg]\t: exec auto \u0026#34; echo \u0026#34;â”€â”€â”€â”€ è·‘å›¾,ç»ƒä¹ é“å…· : exec practice \u0026#34; echo \u0026#34;â”€â”€â”€â”€ å¯¹æª,SOLO : exec solo \u0026#34; echo \u0026#34;â”€â”€â”€â”€ è§‚æˆ˜,è§‚çœ‹DEMO,GOTV : exec demo \u0026#34; echo \u0026#34;â”€â”€â”€â”€ HLAEç›¸å…³è®¾ç½® : exec hlae \u0026#34; echo \u0026#34;â”€â”€â”€â”€ åœ°å›¾ä¸­åŠ è½½è®¾ç½®[auto.cfg] : Inserté”® \u0026#34; echo \u0026#34;â”€â”€â”€â”€ åœ°å›¾ä¸­ä¸€é”®è·‘å›¾[practice.cfg]\t: Deleteé”® \u0026#34; echo \u0026#34;â”€â”€â”€â”€ åœ°å›¾ä¸­åŠ è½½CFG[hlae.cfg]\t: Homeé”® \u0026#34; echo \u0026#34;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\u0026#34; ","date":"2024-12-07T23:08:30+08:00","image":"https://file.meimolihan.eu.org/img/csgo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/cs2-cfg%E6%96%87%E4%BB%B6/","title":"CS2 CFGæ–‡ä»¶"},{"content":"acme.sh + Nginx è‡ªåŠ¨åŒ– SSL è¯ä¹¦ä¸é«˜æ€§èƒ½ Web æœåŠ¡ ğŸš€ ğŸ” å…¨é¢æŒ‡å—ï¼šè‡ªåŠ¨åŒ– SSL è¯ä¹¦ç®¡ç† + é«˜æ€§èƒ½ Web æœåŠ¡å™¨é…ç½®\nğŸ“– ç›®å½•å¯¼èˆª ğŸ¯ acme.sh å®‰è£…é…ç½® ğŸ” SSL è¯ä¹¦ç®¡ç† ğŸ§ Nginx å®‰è£…é…ç½® ğŸ”„ åå‘ä»£ç†é…ç½® âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ”§ ç»´æŠ¤ç®¡ç† ğŸ’¡ æœ€ä½³å®è·µ ğŸš¨ æ•…éšœæ’é™¤ ğŸ¯ acme.sh å®‰è£…é…ç½® ğŸŒŸ ç®€ä»‹ acme.sh æ˜¯ä¸€ä¸ªçº¯ Shell ç¼–å†™çš„ ACME åè®®å®¢æˆ·ç«¯ï¼Œç”¨äºè‡ªåŠ¨åŒ– SSL/TLS è¯ä¹¦çš„ç”³è¯·å’Œç»­ç­¾ã€‚å®ƒæ”¯æŒå¤šç§ DNS æä¾›å•†å’ŒéªŒè¯æ–¹å¼ï¼Œæ˜¯å®ç° HTTPS è‡ªåŠ¨åŒ–çš„ç†æƒ³å·¥å…·ã€‚\nğŸ“¦ å®‰è£… acme.sh 1 2 3 4 5 6 7 8 9 10 # æ–¹æ³•ä¸€ï¼šä½¿ç”¨ curl å®‰è£…ï¼ˆæ¨èï¼‰ curl https://get.acme.sh | sh -s email=meimolihan@live.com # æ–¹æ³•äºŒï¼šä½¿ç”¨ wget å®‰è£… wget -O - https://get.acme.sh | sh -s email=meimolihan@live.com # æ–¹æ³•ä¸‰ï¼šGit clone å®‰è£… git clone --depth 1 https://github.com/acmesh-official/acme.sh.git cd acme.sh ./acme.sh --install -m meimolihan@live.com ğŸ”§ åŸºæœ¬é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # é‡æ–°åŠ è½½ Shell é…ç½® source ~/.bashrc # åˆ›å»ºåˆ«å alias acme.sh=~/.acme.sh/acme.sh # æŸ¥çœ‹ç‰ˆæœ¬ acme.sh -v # è®¾ç½®é»˜è®¤ CAï¼ˆæ¨è Let\u0026#39;s Encryptï¼‰ acme.sh --set-default-ca --server letsencrypt ğŸ¯ æ”¯æŒçš„è¯ä¹¦é¢å‘æœºæ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Let\u0026#39;s Encryptï¼ˆé»˜è®¤ï¼‰ acme.sh --set-default-ca --server letsencrypt # Buypass acme.sh --set-default-ca --server buypass # ZeroSSL acme.sh --set-default-ca --server zerossl # SSL.com acme.sh --set-default-ca --server ssl.com # Google PublicCA acme.sh --set-default-ca --server google ğŸ” SSL è¯ä¹¦ç®¡ç† ğŸŒ Cloudflare DNS éªŒè¯ 1 2 3 4 5 6 7 8 9 # è®¾ç½® Cloudflare API Token export CF_Token=\u0026#34;1suZKPmVHyHlFJIDv6DsCYS-q_YUeATGZIQo8W8B\u0026#34; export CF_Zone_ID=\u0026#34;382fc112abf99c7994ceaedd4844a243\u0026#34; # ç”³è¯·é€šé…ç¬¦è¯ä¹¦ acme.sh --issue --dns dns_cf \\ -d \u0026#34;mobufan.eu.org\u0026#34; \\ -d \u0026#34;*.mobufan.eu.org\u0026#34; \\ --keylength ec-256 ğŸ“ è¯ä¹¦å®‰è£… 1 2 3 4 5 6 7 8 9 # åˆ›å»ºè¯ä¹¦ç›®å½• sudo mkdir -p /etc/nginx/keyfile sudo chmod 755 /etc/nginx/keyfile # å®‰è£…è¯ä¹¦åˆ° Nginx acme.sh --install-cert -d mobufan.eu.org \\ --key-file /etc/nginx/keyfile/key.pem \\ --fullchain-file /etc/nginx/keyfile/cert.pem \\ --reloadcmd \u0026#34;systemctl reload nginx\u0026#34; ğŸ”„ è¯ä¹¦ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦ acme.sh --list # æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ acme.sh --info -d mobufan.eu.org # æ‰‹åŠ¨ç»­ç­¾è¯ä¹¦ acme.sh --renew -d mobufan.eu.org --force # æ’¤é”€è¯ä¹¦ acme.sh --remove -d mobufan.eu.org acme.sh --remove -d \u0026#34;*.mobufan.eu.org\u0026#34; # å¼€å¯è‡ªåŠ¨æ›´æ–° acme.sh --upgrade --auto-upgrade â° è‡ªåŠ¨ç»­ç­¾é…ç½® 1 2 3 4 5 # æŸ¥çœ‹è‡ªåŠ¨ç»­ç­¾ä»»åŠ¡ crontab -l # æ·»åŠ è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ (crontab -l; echo \u0026#39;10 20 * * * \u0026#34;/root/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/root/.acme.sh\u0026#34; \u0026gt; /dev/null\u0026#39;) | crontab - ğŸ§ Nginx å®‰è£…é…ç½® ğŸ“¦ å®‰è£… Nginx 1 2 3 4 5 6 7 8 9 10 # Debian/Ubuntu sudo apt update \u0026amp;\u0026amp; sudo apt install -y nginx # å¯åŠ¨å¹¶å¯ç”¨å¼€æœºè‡ªå¯ sudo systemctl start nginx sudo systemctl enable nginx # éªŒè¯å®‰è£… nginx -v systemctl status nginx ğŸ”§ åŸºæœ¬ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # å¯åŠ¨ Nginx sudo systemctl start nginx # åœæ­¢ Nginx sudo systemctl stop nginx # é‡å¯ Nginx sudo systemctl restart nginx # é‡æ–°åŠ è½½é…ç½® sudo systemctl reload nginx sudo nginx -s reload # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ sudo systemctl status nginx # å¯ç”¨å¼€æœºè‡ªå¯ sudo systemctl enable nginx ğŸ“Š æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 # æŸ¥çœ‹é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log # ä½¿ç”¨ journalctl æŸ¥çœ‹æ—¥å¿— sudo journalctl -u nginx -f ğŸ—‘ï¸ å¸è½½ Nginx 1 2 3 4 5 6 # å®Œå…¨å¸è½½ Nginx sudo apt remove --purge nginx nginx-common -y sudo apt autoremove -y # æ¸…ç†é…ç½®æ–‡ä»¶å’Œæ—¥å¿— sudo rm -rf /etc/nginx /var/log/nginx ğŸ”„ åå‘ä»£ç†é…ç½® ğŸ¯ åŸºæœ¬åå‘ä»£ç†é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # /etc/nginx/conf.d/xunlei.conf server { listen 5553 ssl; listen [::]:5553 ssl; server_name xunlei.mobufan.eu.org; # SSL é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_session_timeout 5m; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers on; location / { proxy_pass http://10.10.10.245:2345; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # å¯ç”¨ WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 60s; proxy_send_timeout 60s; proxy_read_timeout 60s; } } ğŸ›¡ï¸ å®‰å…¨å¢å¼ºé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®‰å…¨å¤´éƒ¨é…ç½® add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34;; # é™åˆ¶è¯·æ±‚æ–¹æ³• if ($request_method !~ ^(GET|HEAD|POST)$) { return 405; } # éšè—æœåŠ¡å™¨ä¿¡æ¯ server_tokens off; ğŸ“ é…ç½®æ–‡ä»¶ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½ Nginx é…ç½® sudo tar -czvf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx/ # æ¢å¤é…ç½® sudo tar -xzvf nginx-backup-20231201.tar.gz -C / # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t -c /etc/nginx/nginx.conf # æµ‹è¯•ç‰¹å®šé…ç½®æ–‡ä»¶ sudo nginx -t -c /etc/nginx/conf.d/xunlei.conf âš¡ æ€§èƒ½ä¼˜åŒ– ğŸš€ Nginx æ€§èƒ½è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # /etc/nginx/nginx.conf events { worker_connections 1024; multi_accept on; use epoll; } http { # å¯ç”¨ Gzip å‹ç¼© gzip on; gzip_vary on; gzip_min_length 1024; gzip_types text/plain text/css application/json application/javascript text/xml application/xml; # ç¼“å†²åŒºä¼˜åŒ– client_body_buffer_size 128k; client_max_body_size 100m; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # è¶…æ—¶è®¾ç½® keepalive_timeout 65; send_timeout 30; client_body_timeout 30; client_header_timeout 30; # æ–‡ä»¶ä¼ è¾“ä¼˜åŒ– sendfile on; tcp_nopush on; tcp_nodelay on; } ğŸ“Š ç›‘æ§å’Œè°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ Nginx è¿›ç¨‹ ps aux | grep nginx # æŸ¥çœ‹è¿æ¥çŠ¶æ€ netstat -tuln | grep nginx # å®æ—¶ç›‘æ§è¿æ¥æ•° watch -n 1 \u0026#34;netstat -an | grep :443 | wc -l\u0026#34; # å‹åŠ›æµ‹è¯• ab -n 1000 -c 100 https://xunlei.mobufan.eu.org:5553/ ğŸ”§ ç»´æŠ¤ç®¡ç† ğŸ“‹ æ—¥å¸¸ç»´æŠ¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash # nginx-maintenance.sh LOG_FILE=\u0026#34;/var/log/nginx-maintenance.log\u0026#34; echo \u0026#34;$(date): å¼€å§‹ Nginx ç»´æŠ¤\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ CERT_EXPIRY=$(openssl x509 -enddate -noout -in /etc/nginx/keyfile/cert.pem | cut -d= -f2) echo \u0026#34;è¯ä¹¦è¿‡æœŸæ—¶é—´: $CERT_EXPIRY\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ£€æŸ¥ Nginx é…ç½® if ! nginx -t; then echo \u0026#34;Nginx é…ç½®æ£€æŸ¥å¤±è´¥\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi # é‡è½½ Nginx systemctl reload nginx echo \u0026#34;Nginx é‡è½½å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE echo \u0026#34;$(date): ç»´æŠ¤å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE ğŸ”„ è‡ªåŠ¨åŒ–å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/bin/bash # backup-nginx.sh BACKUP_DIR=\u0026#34;/backup/nginx/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR # å¤‡ä»½é…ç½® cp -r /etc/nginx $BACKUP_DIR/ cp -r /var/log/nginx $BACKUP_DIR/logs/ # å¤‡ä»½è¯ä¹¦ cp -r /etc/nginx/keyfile $BACKUP_DIR/certs/ # åˆ›å»ºå‹ç¼©åŒ… tar -czf $BACKUP_DIR/nginx-backup.tar.gz $BACKUP_DIR echo \u0026#34;å¤‡ä»½å®Œæˆ: $BACKUP_DIR/nginx-backup.tar.gz\u0026#34; ğŸ¯ è®¡åˆ’ä»»åŠ¡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # ç¼–è¾‘ crontab sudo crontab -e # æ·»åŠ ä»¥ä¸‹ä»»åŠ¡ï¼š # æ¯å¤©å‡Œæ™¨å¤‡ä»½ 0 2 * * * /usr/local/bin/backup-nginx.sh # æ¯å‘¨ç»´æŠ¤ 0 3 * * 0 /usr/local/bin/nginx-maintenance.sh # ç›‘æ§è¯ä¹¦è¿‡æœŸ 0 8 * * * /usr/local/bin/check-cert-expiry.sh ğŸ’¡ æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 # å®šæœŸæ›´æ–°è½¯ä»¶ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade nginx # æ£€æŸ¥æ–‡ä»¶æƒé™ sudo find /etc/nginx -type f -exec chmod 644 {} \\; sudo find /etc/nginx -type d -exec chmod 755 {} \\; sudo chmod 600 /etc/nginx/keyfile/key.pem # é˜²ç«å¢™é…ç½® sudo ufw allow 443/tcp comment \u0026#39;Nginx HTTPS\u0026#39; sudo ufw allow 80/tcp comment \u0026#39;Nginx HTTP\u0026#39; ğŸ“Š ç›‘æ§å‘Šè­¦ 1 2 3 4 5 6 7 8 #!/bin/bash # check-nginx-status.sh STATUS=$(systemctl is-active nginx) if [ \u0026#34;$STATUS\u0026#34; != \u0026#34;active\u0026#34; ]; then echo \u0026#34;Nginx æœåŠ¡å¼‚å¸¸: $STATUS\u0026#34; | mail -s \u0026#34;Nginx æœåŠ¡å‘Šè­¦\u0026#34; admin@example.com systemctl restart nginx fi ğŸš¨ æ•…éšœæ’é™¤ ğŸ” å¸¸è§é—®é¢˜è§£å†³ 1. è¯ä¹¦ç”³è¯·å¤±è´¥ 1 2 3 4 5 6 # è°ƒè¯•æ¨¡å¼è¿è¡Œ acme.sh acme.sh --issue --dns dns_cf -d mobufan.eu.org --debug # æ£€æŸ¥ DNS è§£æ dig mobufan.eu.org dig TXT _acme-challenge.mobufan.eu.org 2. Nginx å¯åŠ¨å¤±è´¥ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥é…ç½®è¯­æ³• nginx -t # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ nginx -T # æ£€æŸ¥ç«¯å£å ç”¨ sudo lsof -i :80 sudo lsof -i :443 3. SSL è¯ä¹¦é—®é¢˜ 1 2 3 4 5 # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæ€§ openssl x509 -in /etc/nginx/keyfile/cert.pem -text -noout # æµ‹è¯• SSL è¿æ¥ openssl s_client -connect xunlei.mobufan.eu.org:5553 -servername xunlei.mobufan.eu.org 4. æ€§èƒ½é—®é¢˜ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ Nginx å·¥ä½œè¿›ç¨‹ ps aux | grep nginx # ç›‘æ§è¿æ¥çŠ¶æ€ ss -tuln | grep nginx # æ£€æŸ¥ç³»ç»Ÿèµ„æº top -p $(pgrep -d\u0026#39;,\u0026#39; nginx) ğŸ“ è¯Šæ–­å·¥å…· 1 2 3 4 5 6 7 8 9 # å®‰è£…è¯Šæ–­å·¥å…· sudo apt install -y net-tools lsof dnsutils # ç½‘ç»œè¯Šæ–­ ping mobufan.eu.org traceroute mobufan.eu.org # SSL æµ‹è¯• curl -vI https://mobufan.eu.org ğŸ”§ ç´§æ€¥æ¢å¤ 1 2 3 4 5 6 7 8 9 # æ¢å¤å¤‡ä»½é…ç½® sudo cp -f /backup/nginx/nginx.conf /etc/nginx/ sudo cp -f /backup/nginx/keyfile/* /etc/nginx/keyfile/ # é‡å¯æœåŠ¡ sudo systemctl restart nginx # å¼ºåˆ¶ç»­ç­¾è¯ä¹¦ acme.sh --renew -d mobufan.eu.org --force ğŸ“‹ æ—¥å¿—åˆ†æ 1 2 3 4 5 6 7 8 # å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿— tail -f /var/log/nginx/error.log # åˆ†æè®¿é—®æ—¥å¿— awk \u0026#39;{print $1}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 # æŸ¥æ‰¾é”™è¯¯è¯·æ±‚ grep -E \u0026#39;50[0-9]|40[0-9]\u0026#39; /var/log/nginx/access.log | head -20 ğŸ“š æ–‡æ¡£å’Œèµ„æº ğŸ“– acme.sh æ–‡æ¡£: https://github.com/acmesh-official/acme.sh/wiki ğŸŒ Nginx æ–‡æ¡£: https://nginx.org/en/docs/ ğŸ”§ SSL é…ç½®ç”Ÿæˆå™¨: https://ssl-config.mozilla.org/ ğŸ›¡ï¸ å®‰å…¨å¤´æ£€æŸ¥: https://securityheaders.com/ ğŸ“Š æ€§èƒ½ä¼˜åŒ–æŒ‡å—: https://www.nginx.com/blog/tuning-nginx/ ğŸ¯ æç¤º: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰å……åˆ†æµ‹è¯•æ‰€æœ‰é…ç½®ã€‚å®šæœŸæ£€æŸ¥æ—¥å¿—å’Œç›‘æ§çŠ¶æ€ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œã€‚\nğŸš€ æ‰©å±•åŠŸèƒ½:\nğŸ”„ è´Ÿè½½å‡è¡¡é…ç½® ğŸŒ CDN é›†æˆ ğŸ“Š è®¿é—®æ—¥å¿—åˆ†æ ğŸ›¡ï¸ WAF é˜²ç«å¢™ ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ– ğŸ“ æ•…éšœæ”¯æŒ:\n1 2 3 4 # ç´§æ€¥æ¢å¤å‘½ä»¤ sudo systemctl restart nginx sudo acme.sh --renew -d mobufan.eu.org --force sudo cp -f /backup/nginx/keyfile/* /etc/nginx/keyfile/ å¸Œæœ›è¿™ä»½å®Œæ•´çš„ acme.sh + Nginx æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ„å»ºå®‰å…¨ã€é«˜æ€§èƒ½çš„ Web æœåŠ¡ï¼ğŸ‰\n","date":"2024-12-07T20:54:09+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ce7f8125/","title":"acme.sh + Nginx è‡ªåŠ¨åŒ– SSL è¯ä¹¦ä¸é«˜æ€§èƒ½ Web æœåŠ¡ ğŸš€"},{"content":"Markdown è„šæ³¨ä½¿ç”¨æŒ‡å— ğŸ“ ğŸŒŸ ä¸ºä½ çš„ Markdown æ–‡æ¡£æ·»åŠ ä¸“ä¸šæ³¨é‡Šå’Œå‚è€ƒæ–‡çŒ®\nç›®å½• ğŸ“– ç®€ä»‹ ğŸ¯ åŸºæœ¬è¯­æ³• âœ¨ ç¤ºä¾‹æ¼”ç¤º ğŸš€ é«˜çº§ç”¨æ³• ğŸ’¡ å®ç”¨æŠ€å·§ âš ï¸ å…¼å®¹æ€§è¯´æ˜ ğŸ“‹ æœ€ä½³å®è·µ â“ å¸¸è§é—®é¢˜è§£ç­” ğŸ› ï¸ å·¥å…·æ¨è ğŸ“– ç®€ä»‹ è„šæ³¨æ˜¯ Markdown ä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸æ‚¨ä¸ºæ–‡æ¡£å†…å®¹æ·»åŠ æ³¨é‡Šã€å‚è€ƒæ–‡çŒ®å’Œè¡¥å……è¯´æ˜ï¼Œè€Œä¸ä¼šæ‰“æ–­ä¸»è¦çš„é˜…è¯»æµç¨‹ã€‚è„šæ³¨é€šå¸¸æ˜¾ç¤ºåœ¨é¡µé¢åº•éƒ¨æˆ–ç« èŠ‚æœ«å°¾ï¼Œä¸ºè¯»è€…æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\nğŸŒŸ ä¸»è¦ç‰¹ç‚¹ âœ… æ— å¹²æ‰°é˜…è¯»ï¼šä¿æŒæ­£æ–‡æµç•…æ€§ âœ… çµæ´»å®šä½ï¼šè„šæ³¨å¯ä»¥æ”¾åœ¨æ–‡æ¡£ä»»æ„ä½ç½® âœ… ä¸°å¯Œæ ¼å¼ï¼šæ”¯æŒæ–‡æœ¬æ ¼å¼åŒ– âœ… å¹¿æ³›å…¼å®¹ï¼šå¤šæ•°å¹³å°æ”¯æŒ âœ… æ˜“äºç®¡ç†ï¼šæ ‡è¯†ç¬¦ç³»ç»Ÿæ¸…æ™° ğŸ¯ åŸºæœ¬è¯­æ³• 1. åˆ›å»ºè„šæ³¨å¼•ç”¨ åœ¨æ­£æ–‡ä¸­éœ€è¦æ·»åŠ æ³¨é‡Šçš„ä½ç½®æ’å…¥è„šæ³¨æ ‡è®°ï¼š\n1 æ­£æ–‡å†…å®¹[^è„šæ³¨æ ‡è¯†ç¬¦]ç»§ç»­æ­£æ–‡å†…å®¹ã€‚ 2. å®šä¹‰è„šæ³¨å†…å®¹ åœ¨æ–‡æ¡£çš„ä»»æ„ä½ç½®ï¼ˆé€šå¸¸åœ¨æ–‡æœ«ï¼‰å®šä¹‰è„šæ³¨çš„å…·ä½“å†…å®¹ï¼š\n1 [^è„šæ³¨æ ‡è¯†ç¬¦]: è„šæ³¨çš„è¯¦ç»†è§£é‡Šå†…å®¹ã€‚ âœ¨ ç¤ºä¾‹æ¼”ç¤º å¤è¯—æ³¨é‡Šç¤ºä¾‹ 1 2 3 4 5 å±æ¥¼[^1]é«˜ç™¾å°º[^2]ï¼Œæ‰‹å¯æ‘˜æ˜Ÿè¾°[^3]ã€‚ [^1]: é«˜æ¥¼ï¼Œè¿™é‡ŒæŒ‡å±±é¡¶çš„å¯ºåº™ [^2]: è™šæŒ‡ï¼Œä¸æ˜¯å®æ•°ï¼Œè¿™é‡Œå½¢å®¹æ¥¼å¾ˆé«˜ [^3]: å¤©ä¸Šçš„æ˜Ÿæ˜Ÿç»Ÿç§° å®é™…æ•ˆæœï¼š\nå±æ¥¼1é«˜ç™¾å°º2ï¼Œæ‰‹å¯æ‘˜æ˜Ÿè¾°3ã€‚\nğŸš€ é«˜çº§ç”¨æ³• 1. ä½¿ç”¨å•è¯ä½œä¸ºæ ‡è¯†ç¬¦ 1 2 3 Markdown[^note]æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ã€‚ [^note]: ç”±John Gruberäº2004å¹´åˆ›å»º æ•ˆæœï¼š Markdown4æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ã€‚\n2. å¤šè¡Œè„šæ³¨å†…å®¹ 1 2 3 4 5 äººå·¥æ™ºèƒ½[^AI]æ­£åœ¨æ”¹å˜ä¸–ç•Œã€‚ [^AI]: äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼‰ æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œ è‡´åŠ›äºåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œéœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿã€‚ æ•ˆæœï¼š äººå·¥æ™ºèƒ½5æ­£åœ¨æ”¹å˜ä¸–ç•Œã€‚\n3. åŒ…å«æ ¼å¼çš„è„šæ³¨ 1 2 3 4 5 HTML[^html]æ˜¯ç½‘é¡µçš„åŸºç¡€ã€‚ [^html]: **è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€**ï¼ˆHyperText Markup Languageï¼‰ ä½¿ç”¨`\u0026lt;tags\u0026gt;`æ¥å®šä¹‰æ–‡æ¡£ç»“æ„ å‚è§[W3Cæ ‡å‡†](https://www.w3.org) æ•ˆæœï¼š HTML6æ˜¯ç½‘é¡µçš„åŸºç¡€ã€‚\nğŸ’¡ å®ç”¨æŠ€å·§ 1. è„šæ³¨ä½ç½®ç®¡ç† 1 2 3 4 5 6 \u0026lt;!-- å°†è„šæ³¨é›†ä¸­åœ¨æ–‡æ¡£æœ«å°¾ --\u0026gt; ## å‚è€ƒæ–‡çŒ® [^1]: ç¬¬ä¸€ä¸ªè„šæ³¨ [^2]: ç¬¬äºŒä¸ªè„šæ³¨ [^3]: ç¬¬ä¸‰ä¸ªè„šæ³¨ 2. é‡å¤å¼•ç”¨åŒä¸€ä¸ªè„šæ³¨ 1 2 3 Python[^py]å’ŒJavaScript[^py]éƒ½æ˜¯æµè¡Œè¯­è¨€ã€‚ [^py]: é«˜çº§ç¼–ç¨‹è¯­è¨€ æ•ˆæœï¼š Python7å’ŒJavaScript7éƒ½æ˜¯æµè¡Œè¯­è¨€ã€‚\n3. å­¦æœ¯å¼•ç”¨æ ·å¼ 1 2 3 ç ”ç©¶è¡¨æ˜[^smith2023]è¿™ä¸ªç°è±¡å¾ˆæ™®éã€‚ [^smith2023]: Smith, J. (2023). *ç ”ç©¶æ ‡é¢˜*. æœŸåˆŠå, å·(æœŸ), é¡µç . 4. è„šæ³¨ä¸­çš„é“¾æ¥å’Œä»£ç  1 2 3 4 ä½¿ç”¨[^api]è¿›è¡Œå¼€å‘ã€‚ [^api]: å‚è§APIæ–‡æ¡£ï¼šhttps://example.com/api ç¤ºä¾‹ä»£ç ï¼š`const response = await fetch(url)` âš ï¸ å…¼å®¹æ€§è¯´æ˜ æ”¯æŒçš„å¹³å° å¹³å° æ”¯æŒæƒ…å†µ å¤‡æ³¨ GitHub âœ… å®Œå…¨æ”¯æŒ åœ¨READMEå’ŒGitHub Pagesä¸­å·¥ä½œè‰¯å¥½ GitLab âœ… å®Œå…¨æ”¯æŒ Bitbucket âœ… å®Œå…¨æ”¯æŒ VS Code âœ… é¢„è§ˆæ”¯æŒ éœ€è¦å®‰è£…Markdowné¢„è§ˆæ’ä»¶ Typora âœ… å®Œå…¨æ”¯æŒ å®æ—¶æ¸²æŸ“ å¤§å¤šæ•°é™æ€ç½‘ç«™ç”Ÿæˆå™¨ âœ… æ”¯æŒ Hugo, Jekyll, Hexoç­‰ ä¸æ”¯æŒçš„å¹³å° å¹³å° æ”¯æŒæƒ…å†µ æ›¿ä»£æ–¹æ¡ˆ å¾®ä¿¡å…¬ä¼—å¹³å° âŒ ä¸æ”¯æŒ ä½¿ç”¨æ‹¬å·æ³¨é‡Šï¼š(æ³¨ï¼šå†…å®¹) éƒ¨åˆ†åœ¨çº¿ç¼–è¾‘å™¨ âŒ å¯èƒ½ä¸æ”¯æŒ æ£€æŸ¥ç¼–è¾‘å™¨æ–‡æ¡£ æŸäº›ç§»åŠ¨åº”ç”¨ âŒ å¯èƒ½ä¸æ”¯æŒ ä½¿ç”¨ä¸Šæ ‡æ•°å­—å’Œæ–‡æœ«æ³¨é‡Š ğŸ“‹ æœ€ä½³å®è·µ 1. ä¿æŒè„šæ³¨ç®€æ´ 1 2 3 4 5 âŒ è¿‡äºå†—é•¿ï¼š [^long]: è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„è„šæ³¨ï¼ŒåŒ…å«äº†å¤§é‡å¯èƒ½ä¸æ˜¯ç»å¯¹å¿…è¦çš„ä¿¡æ¯ï¼Œè¯»è€…å¯èƒ½ä¸ä¼šé˜…è¯»è¿™ä¹ˆé•¿çš„è¡¥å……å†…å®¹ï¼Œå»ºè®®å°†é‡è¦ä¿¡æ¯æ”¾åœ¨æ­£æ–‡ä¸­ã€‚ âœ… ç®€æ´æ˜äº†ï¼š [^short]: ç®€è¦çš„è¡¥å……è¯´æ˜ã€‚è¯¦ç»†å†…å®¹è§å‚è€ƒèµ„æ–™ã€‚ 2. ç»Ÿä¸€æ ‡è¯†ç¬¦é£æ ¼ 1 2 3 4 5 6 7 # æ¨èä½¿ç”¨æ•°å­— [^1]: ç¬¬ä¸€ä¸ªè„šæ³¨ [^2]: ç¬¬äºŒä¸ªè„šæ³¨ # æˆ–è€…ä½¿ç”¨æè¿°æ€§å•è¯ [^definition]: å®šä¹‰è¯´æ˜ [^reference]: å‚è€ƒæ–‡çŒ® 3. ç»„ç»‡è„šæ³¨ä½ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœ¨ç« èŠ‚æœ«å°¾æ”¾ç½®è„šæ³¨ ## ç« èŠ‚æ ‡é¢˜ æ­£æ–‡å†…å®¹[^1]ç»§ç»­æ­£æ–‡ã€‚ [^1]: æœ¬ç« èŠ‚ç›¸å…³è„šæ³¨ --- # åœ¨æ–‡æ¡£æœ«å°¾é›†ä¸­ç®¡ç† ## å‚è€ƒæ–‡çŒ®å’Œæ³¨é‡Š [^1]: ç¬¬ä¸€ä¸ªè„šæ³¨ [^2]: ç¬¬äºŒä¸ªè„šæ³¨ [^3]: ç¬¬ä¸‰ä¸ªè„šæ³¨ 4. é€‚åº¦ä½¿ç”¨åŸåˆ™ 1 2 3 4 5 âŒ è¿‡åº¦ä½¿ç”¨ï¼š è¿™å¥è¯[^1]æœ‰å¤ªå¤š[^2]è„šæ³¨[^3]å½±å“[^4]é˜…è¯»[^5]ä½“éªŒ[^6]ã€‚ âœ… é€‚åº¦ä½¿ç”¨ï¼š é‡è¦æ¦‚å¿µ[^important]å’Œå¼•ç”¨[^citation]ä½¿ç”¨è„šæ³¨ï¼Œæ™®é€šè¯´æ˜èå…¥æ­£æ–‡ã€‚ â“ å¸¸è§é—®é¢˜è§£ç­” Q1: è„šæ³¨ä¼šè‡ªåŠ¨ç¼–å·å—ï¼Ÿ A: æ˜¯çš„ï¼Œå¤§å¤šæ•°Markdownå¤„ç†å™¨ä¼šè‡ªåŠ¨æŒ‰å‡ºç°é¡ºåºç¼–å·ã€‚\nQ2: å¯ä»¥åœ¨è¡¨æ ¼ä¸­ä½¿ç”¨è„šæ³¨å—ï¼Ÿ A: æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†æŸäº›æ¸²æŸ“å™¨å¯èƒ½ä¸æ”¯æŒã€‚å»ºè®®é¿å…åœ¨å¤æ‚ç»“æ„ä¸­ä½¿ç”¨ã€‚\nQ3: è„šæ³¨æ”¯æŒåµŒå¥—å—ï¼Ÿ A: æ ‡å‡†Markdownä¸æ”¯æŒè„šæ³¨åµŒå¥—ã€‚\nQ4: å¦‚ä½•è‡ªå®šä¹‰è„šæ³¨æ ·å¼ï¼Ÿ A: éœ€è¦é€šè¿‡CSSæ¥è‡ªå®šä¹‰æ ·å¼ï¼ˆåœ¨æ”¯æŒHTMLè¾“å‡ºçš„ç¯å¢ƒä¸­ï¼‰ã€‚\n1 2 3 4 5 6 7 .footnote { font-size: 0.9em; color: #666; border-top: 1px solid #eee; padding-top: 1em; margin-top: 2em; } Q5: è„šæ³¨æœ‰æ•°é‡é™åˆ¶å—ï¼Ÿ A: ä¸€èˆ¬æ²¡æœ‰ç¡¬æ€§é™åˆ¶ï¼Œä½†å»ºè®®ä¿æŒåˆç†æ•°é‡ä»¥ç¡®ä¿å¯è¯»æ€§ã€‚\nğŸ› ï¸ å·¥å…·æ¨è 1. è„šæ³¨ç®¡ç†å·¥å…· Zotero - å‚è€ƒæ–‡çŒ®ç®¡ç† ğŸ†“ Mendeley - å­¦æœ¯å¼•ç”¨ç®¡ç† ğŸ†“ Citavi - ä¸“ä¸šæ–‡çŒ®ç®¡ç† ğŸ’° EndNote - ç§‘ç ”æ–‡çŒ®ç®¡ç† ğŸ’° 2. Markdownç¼–è¾‘å™¨ Typora - ä¼˜ç§€çš„è„šæ³¨æ”¯æŒ ğŸ’° Obsidian - çŸ¥è¯†ç®¡ç†ä¸­çš„è„šæ³¨åŠŸèƒ½ ğŸ†“ VS Code + Markdown All in One æ’ä»¶ ğŸ†“ HackMD - å®æ—¶åä½œMarkdownç¼–è¾‘å™¨ ğŸ†“ 3. åœ¨çº¿æ ¡éªŒå·¥å…· Markdownlint - æ£€æŸ¥Markdownè¯­æ³• Grammarly - è¯­æ³•å’Œé£æ ¼æ£€æŸ¥ Hemingway Editor - å¯è¯»æ€§åˆ†æ ğŸ“ æ€»ç»“ é€šè¿‡åˆç†ä½¿ç”¨è„šæ³¨ï¼Œæ‚¨å¯ä»¥è®©Markdownæ–‡æ¡£æ›´åŠ ä¸“ä¸šå’Œæ˜“è¯»ï¼è®°å¾—éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š\né€‚åº¦ä½¿ç”¨ - ä¸è¦è¿‡åº¦ä¾èµ–è„šæ³¨ ä¿æŒç®€æ´ - è„šæ³¨å†…å®¹è¦ç²¾ç‚¼ ç»Ÿä¸€é£æ ¼ - ä¿æŒæ ‡è¯†ç¬¦ä¸€è‡´æ€§ åˆç†å¸ƒå±€ - é›†ä¸­ç®¡ç†è„šæ³¨ä½ç½® æµ‹è¯•å…¼å®¹æ€§ - ç¡®ä¿ç›®æ ‡å¹³å°æ”¯æŒ å¸Œæœ›è¿™ç¯‡æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ä½¿ç”¨Markdownè„šæ³¨åŠŸèƒ½ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿æ¢è®¨ï¼ğŸ˜Š\nğŸ“‹ æ–‡æ¡£ä¿¡æ¯ï¼š\næœ€åæ›´æ–°ï¼š2024å¹´1æœˆ ä½œè€…ï¼šMarkdownçˆ±å¥½è€… è®¸å¯è¯ï¼šCC BY-SA 4.0 ğŸ”— ç›¸å…³èµ„æºï¼š\nCommonMarkè§„èŒƒ GitHub MarkdownæŒ‡å— Markdownæ•™ç¨‹ âœ¨ æç¤ºï¼šåœ¨ä¸åŒå¹³å°ä¸Šæµ‹è¯•è„šæ³¨æ˜¾ç¤ºæ•ˆæœï¼Œç¡®ä¿æœ€ç»ˆå‘ˆç°ç¬¦åˆé¢„æœŸï¼\né«˜æ¥¼ï¼Œè¿™é‡ŒæŒ‡å±±é¡¶çš„å¯ºåº™\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nè™šæŒ‡ï¼Œä¸æ˜¯å®æ•°ï¼Œè¿™é‡Œå½¢å®¹æ¥¼å¾ˆé«˜\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nå¤©ä¸Šçš„æ˜Ÿæ˜Ÿç»Ÿç§°\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nç”±John Gruberäº2004å¹´åˆ›å»º\u0026#160;\u0026#x21a9;\u0026#xfe0e;\näººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼‰\næ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œ\nè‡´åŠ›äºåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œéœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼ˆHyperText Markup Languageï¼‰\nä½¿ç”¨\u0026lt;tags\u0026gt;æ¥å®šä¹‰æ–‡æ¡£ç»“æ„\nå‚è§ W3Cæ ‡å‡† \u0026#160;\u0026#x21a9;\u0026#xfe0e;\né«˜çº§ç¼–ç¨‹è¯­è¨€\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-12-07T20:53:10+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0e8c48fe/","title":"Markdown è„šæ³¨ä½¿ç”¨æŒ‡å—ğŸ“"},{"content":"Typecho åšå®¢ Butterflyä¸»é¢˜ \u0026amp; å¤©æ°”æ—¶é’Ÿæ•™ç¨‹ å“”å“©å“”å“©è§†é¢‘æ•™ç¨‹ å…¶ä¸­æ—¶é’Ÿå’Œé£å¤©æ°”keyå’Œæ—¶é’Ÿé«˜å¾·åœ°å›¾webæœåŠ¡keyæœ€å¥½è‡ªå·±å»ç”³è¯·å¯¹åº”çš„api keyï¼Œé»˜è®¤ä½¿ç”¨æˆ‘è‡ªå·±çš„ï¼Œå¯èƒ½ä¼šè¢«é™åˆ¶ï¼Œä¸ä¿è¯å¯é æ€§\næ—¶é’Ÿå’Œé£å¤©æ°”key ç”³è¯·åœ°å€: https://id.qweather.com/#/login æˆ‘çš„å’Œé£å¤©æ°”è´¦å·ï¼š496338740@qq.com å¯†ç ï¼šå°å­©å+ç”Ÿ ç»‘å®šæ‰‹æœºï¼š136\næˆ‘çš„æ—¶é’Ÿå’Œé£å¤©æ°”keyï¼š6c59d6c6a76a4841a8e30b93e4cc38b1\nç™»å½•åè¿›å…¥æ§åˆ¶å° åˆ›å»ºåº”ç”¨ å¡«å†™åº”ç”¨åç§°å’Œkeyåç§°éšæ„ é€‰æ‹©WebApi å¤åˆ¶key æ—¶é’Ÿé«˜å¾·åœ°å›¾webæœåŠ¡key ç”³è¯·åœ°å€: https://lbs.amap.com/ æˆ‘çš„é«˜å¾·åœ°å›¾webæœåŠ¡è´¦å·ï¼šæ”¯ä»˜å®æ‰«ç  ç»‘å®šæ‰‹æœºï¼š136\næˆ‘çš„æ—¶é’Ÿé«˜å¾·åœ°å›¾webæœåŠ¡keyï¼š6faa489a78be3b1b97a722b4b0cb2dfb\nç™»å½•åè¿›å…¥æ§åˆ¶å° åˆ›å»ºåº”ç”¨ï¼Œåç§°éšæ„ï¼Œç±»å‹é€‰å…¶ä»– ç‚¹å‡»æ·»åŠ , keyåç§°éšæ„ï¼ŒæœåŠ¡å¹³å°é€‰æ‹©WebæœåŠ¡,ç‚¹å‡»æäº¤ å¤åˆ¶key hexoåšå®¢-butterflyä¸»é¢˜-å¤©æ°”æ—¶é’Ÿæ•™ç¨‹ ç»™hexo-theme-butterflyæ·»åŠ  ä¾§è¾¹æ ç”µå­é’Ÿ 1. å¦‚æœæœ‰å®‰è£…åº—é•¿çš„æ’ä»¶ç‰ˆä¾§è¾¹æ ç”µå­é’Ÿï¼ˆä¸åº—é•¿çš„ç”µå­é’Ÿå†²çªï¼‰ï¼Œåœ¨åšå®¢æ ¹ç›®å½•[Blogroot]ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹æŒ‡ä»¤ 1 2 # å¸è½½åŸç‰ˆç”µå­é’Ÿ npm uninstall hexo-butterfly-clock 2. å®‰è£…æ’ä»¶,åœ¨åšå®¢æ ¹ç›®å½•[Blogroot]ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š 1 npm install hexo-butterfly-clock-anzhiyu --save 3. æ·»åŠ é…ç½®ä¿¡æ¯ï¼Œä»¥ä¸‹ä¸ºå†™æ³•ç¤ºä¾‹ åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlæˆ–è€…ä¸»é¢˜é…ç½®æ–‡ä»¶_config.butterfly.ymlä¸­æ·»åŠ \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # electric_clock # see https://anzhiy.cn/posts/fc18.html electric_clock: enable: true # å¼€å…³ priority: 5 #è¿‡æ»¤å™¨ä¼˜å…ˆæƒ enable_page: all # åº”ç”¨é¡µé¢ exclude: # - /posts/ # - /about/ layout: # æŒ‚è½½å®¹å™¨ç±»å‹ type: class name: sticky_layout index: 0 loading: https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif #åŠ è½½åŠ¨ç”»è‡ªå®šä¹‰ clock_css: https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css clock_js: https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.js ip_api: https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0 qweather_key: # å’Œé£å¤©æ°”key gaud_map_key: # é«˜å¾—åœ°å›¾webæœåŠ¡key default_rectangle: false # å¼€å¯åå°†ä¸€ç›´æ˜¾ç¤ºrectangleä½ç½®çš„å¤©æ°”ï¼Œå¦åˆ™å°†è·å–è®¿é—®è€…çš„åœ°ç†ä½ç½®ä¸å¤©æ°” rectangle: 112.6534116,27.96920845 # è·å–è®¿é—®è€…ä½ç½®å¤±è´¥æ—¶ä¼šæ˜¾ç¤ºè¯¥ä½ç½®çš„å¤©æ°”ï¼ŒåŒæ—¶è¯¥ä½ç½®ä¸ºå¼€å¯default_rectangleåçš„ä½ç½® å…¶ä¸­æ—¶é’Ÿå’Œé£å¤©æ°”keyå’Œæ—¶é’Ÿé«˜å¾·åœ°å›¾webæœåŠ¡keyæœ€å¥½è‡ªå·±å»ç”³è¯·å¯¹åº”çš„api keyï¼Œé»˜è®¤ä½¿ç”¨æˆ‘è‡ªå·±çš„ï¼Œå¯èƒ½ä¼šè¢«é™åˆ¶ï¼Œä¸ä¿è¯å¯é æ€§\næ—¶é’Ÿå’Œé£å¤©æ°”keyç”³è¯·åœ°å€: https://id.qweather.com/#/login ç™»å½•åè¿›å…¥æ§åˆ¶å° åˆ›å»ºåº”ç”¨ å¡«å†™åº”ç”¨åç§°å’Œkeyåç§°éšæ„ é€‰æ‹©WebApi å¤åˆ¶key æˆ‘çš„æ—¶é’Ÿå’Œé£å¤©æ°”keyï¼š6c59d6c6a76a4841a8e30b93e4cc38b1 æ—¶é’Ÿé«˜å¾·åœ°å›¾webæœåŠ¡key ç”³è¯·åœ°å€: https://lbs.amap.com/ ç™»å½•åè¿›å…¥æ§åˆ¶å° åˆ›å»ºåº”ç”¨ï¼Œåç§°éšæ„ï¼Œç±»å‹é€‰å…¶ä»– ç‚¹å‡»æ·»åŠ , keyåç§°éšæ„ï¼ŒæœåŠ¡å¹³å°é€‰æ‹©WebæœåŠ¡,ç‚¹å‡»æäº¤ å¤åˆ¶key æˆ‘çš„æ—¶é’Ÿé«˜å¾·åœ°å›¾webæœåŠ¡keyï¼š6faa489a78be3b1b97a722b4b0cb2dfb 4. å‚æ•°é‡Šä¹‰ å‚æ•° å¤‡é€‰å€¼/ç±»å‹ é‡Šä¹‰ priority number ã€å¯é€‰ã€‘è¿‡æ»¤å™¨ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ï¼Œæ‰§è¡Œè¶Šæ—©ï¼Œé»˜è®¤ä¸º10ï¼Œé€‰å¡« enable true / false ã€å¿…é€‰ã€‘æ§åˆ¶å¼€å…³ enable_page path ã€å¯é€‰ã€‘å¡«å†™æƒ³è¦åº”ç”¨çš„é¡µé¢,å¦‚æ ¹ç›®å½•å°±å¡«\u0026rsquo;/\u0026rsquo;ï¼Œåˆ†ç±»é¡µé¢å°±å¡«\u0026rsquo;/categories/\u0026rsquo;ã€‚è‹¥è¦åº”ç”¨äºæ‰€æœ‰é¡µé¢ï¼Œå°±å¡«allï¼Œé»˜è®¤ä¸ºall exclude path ã€å¯é€‰ã€‘å¡«å†™æƒ³è¦å±è”½çš„é¡µé¢ï¼Œå¯ä»¥å¤šä¸ªã€‚å†™æ³•è§ç¤ºä¾‹ã€‚åŸç†æ˜¯å°†å±è”½é¡¹çš„å†…å®¹é€ä¸ªæ”¾åˆ°å½“å‰è·¯å¾„å»åŒ¹é…ï¼Œè‹¥å½“å‰è·¯å¾„åŒ…å«ä»»ä¸€å±è”½é¡¹ï¼Œåˆ™ä¸ä¼šæŒ‚è½½ã€‚ layout.type id / class ã€å¯é€‰ã€‘æŒ‚è½½å®¹å™¨ç±»å‹ï¼Œå¡«å†™idæˆ–classï¼Œä¸å¡«åˆ™é»˜è®¤ä¸ºid layout.name text ã€å¿…é€‰ã€‘æŒ‚è½½å®¹å™¨åç§° layout.index 0 å’Œæ­£æ•´æ•° ã€å¯é€‰ã€‘å‰ææ˜¯layout.typeä¸ºclassï¼Œå› ä¸ºåŒä¸€é¡µé¢å¯èƒ½æœ‰å¤šä¸ªclassï¼Œæ­¤é¡¹ç”¨æ¥ç¡®è®¤ç©¶ç«Ÿæ’åœ¨ç¬¬å‡ ä¸ªé¡ºä½ loading URL ã€å¯é€‰ã€‘ç”µå­é’ŸåŠ è½½åŠ¨ç”»çš„å›¾ç‰‡ clock_css URL ã€å¯é€‰ã€‘ç”µå­é’Ÿæ ·å¼CDNèµ„æº clock_js URL ã€å¯é€‰ã€‘ç”µå­é’Ÿæ‰§è¡Œè„šæœ¬CDNèµ„æº ip_api URL ã€å¯é€‰ã€‘è·å–æ—¶é’ŸIPçš„API qweather_key string ã€å¯é€‰ã€‘å’Œé£å¤©æ°”key gaud_map_key string ã€å¯é€‰ã€‘é«˜å¾·åœ°å›¾webæœåŠ¡key default_rectangle - ã€å¯é€‰ã€‘æ­¤å‚æ•°æè¿°ç¼ºå¤±ï¼Œè¯·ç¡®è®¤å…·ä½“å«ä¹‰ rectangle - ã€å¯é€‰ã€‘æ­¤å‚æ•°æè¿°ç¼ºå¤±ï¼Œè¯·ç¡®è®¤å…·ä½“å«ä¹‰ ","date":"2024-12-07T20:52:39+08:00","image":"https://file.meimolihan.eu.org/img/weather-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3ac7d313/","title":"Typecho åšå®¢ Butterflyä¸»é¢˜ \u0026 å¤©æ°”æ—¶é’Ÿæ•™ç¨‹"},{"content":"Docker éƒ¨ç½² IPTV Allinone ç›´æ’­æº ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IPTV Allinone 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ IPTV Allinone 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç›´æ’­ï¼Œç²¾å½©æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Allone/iptv-allinone ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/youshandefeiyang/allinone IPTV Allinone æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç›´æ’­æºèšåˆå·¥å…·ï¼Œé›†æˆäº†å¤šä¸ªç›´æ’­å¹³å°ï¼ˆå¦‚æ–—é±¼ã€è™ç‰™ã€æŠ–éŸ³ç­‰ï¼‰çš„ç›´æ’­æºï¼Œå¹¶æ”¯æŒé«˜æ¸…ç”»è´¨æ’­æ”¾ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ IPTV Allinoneï¼Œäº«å—ç¨³å®šã€ä¸°å¯Œçš„ç›´æ’­å†…å®¹ä½“éªŒã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“º å¤šå¹³å°èšåˆ èšåˆå¤šä¸ªç›´æ’­å¹³å°çš„ç›´æ’­æº ä¸€ç«™è§‚çœ‹å¤šä¸ªå¹³å°å†…å®¹ï¼Œæ— éœ€é¢‘ç¹åˆ‡æ¢ ğŸ¬ é«˜æ¸…ç”»è´¨ æ”¯æŒ 4K åŠæ›´é«˜ç”»è´¨çš„ç›´æ’­æº æä¾›é«˜æ¸…è§‚çœ‹ä½“éªŒ âš¡ å®æ—¶æ›´æ–° ç›´æ’­æºå®æ—¶æ›´æ–°å’Œç»´æŠ¤ ç¡®ä¿é¢‘é“çš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ ğŸŒ å¤šæ ¼å¼æ”¯æŒ æ”¯æŒ M3U å’Œ TEXT æ ¼å¼è¾“å‡º å…¼å®¹å„ç§æ’­æ”¾å™¨å’Œè®¾å¤‡ ğŸ”§ çµæ´»é…ç½® æ”¯æŒå‚æ•°åŒ–é…ç½®å’Œè‡ªå®šä¹‰ æ ¹æ®éœ€æ±‚è°ƒæ•´æ’­æ”¾å‚æ•° ğŸ“± å¤šè®¾å¤‡å…¼å®¹ æ”¯æŒå„ç§è®¾å¤‡å’Œæ’­æ”¾å™¨ åœ¨æ‰‹æœºã€ç”µè„‘ã€ç”µè§†ä¸Šå‡å¯è§‚çœ‹ ğŸ”„ è‡ªåŠ¨æ›´æ–° æ”¯æŒé€šè¿‡ Watchtower è‡ªåŠ¨æ›´æ–° ä¿æŒé•œåƒå’ŒåŠŸèƒ½çš„æœ€æ–°çŠ¶æ€ ğŸ¯ æ™ºèƒ½ä¼˜åŒ– æ”¯æŒé¢‘é“èšåˆå’Œæ ¼å¼ä¼˜åŒ– æå‡è§‚çœ‹ä½“éªŒå’Œå…¼å®¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IPTV Allinone 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/iptv-allinone \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: allinone: container_name: allinone image: youshandefeiyang/allinone:latest restart: always ports: - \u0026#34;35455:35455\u0026#34; privileged: true watchtower: container_name: watchtower image: containrrr/watchtower:latest restart: always volumes: - /var/run/docker.sock:/var/run/docker.sock command: --schedule \u0026#34;0 0 2 * * *\u0026#34; --cleanup allinone EOF âš ï¸ æ³¨æ„ï¼šAllinone é¡¹ç›®éœ€è¦ç”Ÿæˆ AES å¯†é’¥å¹¶é€šè¿‡ Telegram æœºå™¨äººè·å– Userid å’Œ Token æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚å…·ä½“æ­¥éª¤ï¼š\nè®¿é—® https://imgtool.v1.mk/allinone.html ç”Ÿæˆ AES å¯†é’¥ é€šè¿‡ Telegram è”ç³» @newallinone_bot è·å– Userid å’Œ Token ä½¿ç”¨è·å–çš„å‡­è¯é…ç½®å®¹å™¨ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ IPTV Allinone 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:35455 åŸŸåè®¿é—®ï¼š https://allinone.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œç¡®è®¤æ˜¾ç¤º\u0026quot;è¯·æ±‚æˆåŠŸï¼\u0026quot; ä½¿ç”¨ä»¥ä¸‹æ ¼å¼çš„ URL è®¿é—®ä¸åŒçš„ç›´æ’­æºï¼š IPTV èšåˆï¼šhttp://IP:35455/tv.m3u è™ç‰™ä¸€èµ·çœ‹ï¼šhttp://IP:35455/huyayqk.m3u æ–—é±¼ä¸€èµ·çœ‹ï¼šhttp://IP:35455/douyuyqk.m3u BiliBili ç”Ÿæ´»ï¼šhttp://IP:35455/bililive.m3u YY è½®æ’­ï¼šhttp://IP:35455/yylunbo.m3u å°†ç›¸åº”çš„ M3U é“¾æ¥æ·»åŠ åˆ°æ”¯æŒçš„æ’­æ”¾å™¨ä¸­ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://allinone.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/allinone.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name allinone.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:35455; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªç›´æ’­ï¼Œç²¾å½©æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† IPTV Allinone ç›´æ’­æºæœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“º å¤šæºèšåˆ ç•…äº«å¤šä¸ªç›´æ’­å¹³å°çš„ä¸°å¯Œå†…å®¹ï¼Œä¸€ç«™å¼è§‚çœ‹æ— éœ€åˆ‡æ¢\nğŸ¬ é«˜æ¸…ä½“éªŒ æ”¯æŒ 4K åŠæ›´é«˜ç”»è´¨çš„ç›´æ’­æºï¼Œäº«å—éœ‡æ’¼çš„è§†è§‰ç››å®´\nğŸŒ å¤šç«¯å…¼å®¹ åœ¨å„ç§è®¾å¤‡å’Œæ’­æ”¾å™¨ä¸Šæµç•…è§‚çœ‹ï¼Œéšæ—¶éšåœ°äº«å—ç›´æ’­ä¹è¶£\nç›´æ’­ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ç²¾å½©å†…å®¹å®æ—¶ç›¸ä¼´çš„äº’åŠ¨æ—…ç¨‹ã€‚æ„¿ IPTV Allinone æˆä¸ºä½ å¯é çš„ç›´æ’­ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªç²¾å½©èµ›äº‹å’Œå¨±ä¹èŠ‚ç›®çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒè§‚çœ‹ï¼Œç•…äº«ç›´æ’­â€”â€”æ„å»ºä½ ä¸ªæ€§åŒ–çš„ç”µè§†å¨±ä¹ä¸­å¿ƒå§ï¼ğŸ‰\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ IPTV Allinone å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§‚å½±æ„‰å¿«ï¼Œç²¾å½©ä¸æ–­ï¼ğŸ¬\n","date":"2024-12-07T20:51:58+08:00","image":"https://file.meimolihan.eu.org/img/iptv-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4fc46354/","title":"Docker éƒ¨ç½² IPTV Allinone ç›´æ’­æº ğŸ³"},{"content":"Proxmox VE å®‰è£… FnOS å®Œå…¨æŒ‡å— ğŸ§ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Proxmox VE (PVE) è™šæ‹ŸåŒ–å¹³å°ä¸Šå®‰è£…é£ç‰› FnOS NAS ç³»ç»Ÿï¼Œæä¾›ä¸€ä¸ªå®Œæ•´çš„å®¶åº­æˆ–ä¼ä¸šçº§å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ¶µç›–ç¡¬ä»¶ç›´é€šå’Œæ ¸æ˜¾è™šæ‹ŸåŒ–ç­‰é«˜çº§é…ç½®ã€‚\nğŸ“š ç›®å½•å¯¼èˆª âœ¨ FnOS ç®€ä»‹ ğŸš€ å‡†å¤‡å·¥ä½œ ğŸ”§ åˆ›å»ºè™šæ‹Ÿæœº ğŸ› ï¸ å®‰è£… FnOS âš™ï¸ ç¡¬ä»¶ç›´é€šé…ç½® ğŸ” FnOS åŸºæœ¬é…ç½® ğŸ›¡ï¸ å®‰å…¨å’Œå¤‡ä»½ ğŸ”§ æ•…éšœæ’é™¤ âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ’¾ å¤‡ä»½ä¸æ¢å¤ ğŸ¯ æ€»ç»“ âœ¨ FnOS ç®€ä»‹ FnOS (é£ç‰›ç§æœ‰äº‘) æ˜¯ä¸€ä¸ªåŸºäº Linux (Debian) çš„å›½äº§å¼€æº NAS æ“ä½œç³»ç»Ÿã€‚å®ƒä»¥æ­£ç‰ˆå…è´¹ã€ç¡¬ä»¶å…¼å®¹æ€§å¥½ã€æ€§èƒ½å‡ºè‰²è‘—ç§°ï¼Œæä¾›æ–‡ä»¶å­˜å‚¨ã€æ•°æ®å¤‡ä»½ã€åª’ä½“æœåŠ¡ã€Docker æ”¯æŒç­‰ä¸°å¯ŒåŠŸèƒ½ã€‚é€šè¿‡ PVE è™šæ‹ŸåŒ–å¹³å°éƒ¨ç½²ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºå¹¶ä¿è¯ç³»ç»Ÿçš„éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚\nğŸ‚ é£ç‰› FnOS ç‰¹è‰²åŠŸèƒ½ï¼š\nğŸ¯ å…è´¹æ­£ç‰ˆ: ä¸ªäººç”¨æˆ·å¯å…è´¹ä½¿ç”¨ï¼Œæ— éœ€æ‹…å¿ƒç‰ˆæƒé—®é¢˜ ğŸ–¥ï¸ ç¡¬ä»¶å…¼å®¹æ€§å¥½: æ”¯æŒä¸»æµ X86 ç¡¬ä»¶ï¼Œé—²ç½®çš„ NAS å’Œ PC å‡å¯å®‰è£… ğŸ”„ åŠŸèƒ½æŒç»­æ›´æ–°: è¿‘æœŸç‰ˆæœ¬å¢åŠ äº†é˜²ç«å¢™ã€DLNA æœåŠ¡ã€ç«¯å£å·è‡ªå®šä¹‰ã€SMART æ·±åº¦æ£€æµ‹ã€å­˜å‚¨ç©ºé—´æ‰©å®¹ç­‰åŠŸèƒ½ ğŸ¬ å¼ºå¤§çš„åª’ä½“ä¸­å¿ƒ: æ”¯æŒç¡¬è§£ï¼Œå¹¶æ¨å‡ºäº†ç‹¬ç«‹çš„é£ç‰›å½±è§†æ‰‹æœºç‰ˆ App ğŸ“Š ç›¸å†Œç®¡ç†: æ™ºèƒ½ç›¸å†Œåˆ†ç±»å’Œç®¡ç†åŠŸèƒ½ ğŸ¤– Docker æ”¯æŒ: å†…ç½® Docker å¼•æ“ï¼Œæ”¯æŒå®¹å™¨åŒ–åº”ç”¨ ğŸŒ å®˜æ–¹ç¤¾åŒºæ”¯æŒ: æ‹¥æœ‰å®˜æ–¹å¸®åŠ©ä¸­å¿ƒå’Œå®Œå–„çš„ç¤¾åŒºæ”¯æŒ å®˜æ–¹èµ„æºï¼š\nğŸ–¥ï¸ å®˜ç½‘ä¸‹è½½ï¼šhttps://www.fnnas.com/download ğŸ”§ ç®¡ç†åå°ï¼šhttps://æœåŠ¡å™¨IP:5666 (é»˜è®¤ä½¿ç”¨ HTTPS) ğŸ’¬ å®˜æ–¹ç¤¾åŒºï¼šhttps://club.fnnas.com/ ğŸ“š å¸®åŠ©ä¸­å¿ƒï¼šhttps://help.fnnas.com/ ğŸš€ å‡†å¤‡å·¥ä½œ 1ï¸âƒ£ ä¸‹è½½ FnOS é•œåƒ è®¿é—® FnOS å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ ISO å®‰è£…é•œåƒã€‚\n1 2 3 4 5 # ç¤ºä¾‹ï¼šä½¿ç”¨ wget ä¸‹è½½ FnOS é•œåƒï¼ˆè¯·ä»¥å®˜ç½‘æœ€æ–°é“¾æ¥ä¸ºå‡†ï¼‰ wget https://www.fnnas.com/download/fnos-0.9.9-937.iso # éªŒè¯é•œåƒå®Œæ•´æ€§ï¼ˆå¦‚æœå®˜ç½‘æä¾›äº†æ ¡éªŒç ï¼‰ sha256sum fnos-0.9.9-937.iso 2ï¸âƒ£ ä¸Šä¼ é•œåƒåˆ° PVE ç™»å½• PVE Web ç®¡ç†ç•Œé¢ (https://ä½ çš„PVEä¸»æœºIP:8006) é€‰æ‹©å·¦ä¾§çš„å­˜å‚¨åº“ï¼ˆå¦‚ localï¼‰ ç‚¹å‡»\u0026quot;ISO é•œåƒ\u0026quot; \u0026gt; \u0026ldquo;ä¸Šä¼ \u0026rdquo; é€‰æ‹©ä¸‹è½½çš„ FnOS é•œåƒæ–‡ä»¶ ç­‰å¾…ä¸Šä¼ å®Œæˆ 3ï¸âƒ£ ç¡¬ä»¶å‡†å¤‡æ£€æŸ¥ âœ… ç¡®è®¤ CPU æ”¯æŒè™šæ‹ŸåŒ–ï¼ˆIntel VT-x æˆ– AMD-Vï¼‰ âœ… ç¡®è®¤ä¸»æ¿ BIOS ä¸­å¼€å¯è™šæ‹ŸåŒ–æ”¯æŒ âœ… å‡†å¤‡è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼ˆç³»ç»Ÿç›˜+æ•°æ®ç›˜ï¼‰ âœ… ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š ğŸ”§ åˆ›å»ºè™šæ‹Ÿæœº 1ï¸âƒ£ åŸºæœ¬è™šæ‹Ÿæœºé…ç½® é€šè¿‡ PVE Web ç•Œé¢åˆ›å»ºæ–°è™šæ‹Ÿæœºï¼š\nå¸¸è§„è®¾ç½®ï¼š\nèŠ‚ç‚¹: é€‰æ‹©æ‚¨çš„ PVE èŠ‚ç‚¹ VM ID: åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IDï¼ˆå¦‚ 101ï¼‰ åç§°: FnOS-NAS æ“ä½œç³»ç»Ÿï¼š\né€‰æ‹© ISO é•œåƒ: é€‰æ‹©ä¸Šä¼ çš„ FnOS é•œåƒ å®¢æˆ·æœºæ“ä½œç³»ç»Ÿ: Linux ç‰ˆæœ¬: 6.x - 2.6 Kernelï¼ˆFnOS åŸºäº Debianï¼‰ ç³»ç»Ÿè®¾ç½®ï¼š\næœºå™¨: q35 (é‡è¦: ä¸ºåç»­ç¡¬ä»¶ç›´é€šå‡†å¤‡) BIOS: OVMF (UEFI) (é‡è¦: æ¨èä½¿ç”¨ï¼ŒåŒæ—¶è®°å¾—æ·»åŠ  EFI å­˜å‚¨) æ˜¾å¡: é»˜è®¤å³å¯ï¼Œåç»­ä¼šä¿®æ”¹ å‹¾é€‰ QEMU Agent é€‰é¡¹ 2ï¸âƒ£ ç£ç›˜é…ç½® ç³»ç»Ÿç›˜é…ç½®ï¼š\næ€»çº¿/è®¾å¤‡: SCSI å­˜å‚¨: é€‰æ‹©é«˜é€Ÿå­˜å‚¨ï¼ˆå¦‚ SSDï¼‰ ç£ç›˜å¤§å° (GB): 64 (é£ç‰›å®˜æ–¹å»ºè®®ç³»ç»Ÿç›˜ 64G) ç¼“å­˜: Write back (ä¸å®‰å…¨) æˆ– No cache (æ¨èï¼Œæ›´å®‰å…¨) å‹¾é€‰ SSD ä»¿çœŸ (æ¨è) æ•°æ®ç›˜è§„åˆ’ï¼š\nå»ºè®®ï¼šæ•°æ®ç›˜é€šè¿‡ç¡¬ç›˜ç›´é€šæ–¹å¼æ·»åŠ ï¼Œæ€§èƒ½æ›´å¥½ï¼Œç®¡ç†æ›´ç›´æ¥ã€‚ä¸‹æ–‡ä¼šè¯¦ç»†è¯´æ˜ã€‚ 3ï¸âƒ£ CPU å’Œå†…å­˜é…ç½® 1 2 3 4 # å»ºè®®é…ç½®ï¼š - CPUï¼š4 æ ¸å¿ƒæˆ–ä»¥ä¸Šï¼ˆæ ¹æ®éœ€æ±‚ï¼‰ï¼Œç±»åˆ«é€‰æ‹© `host` - å†…å­˜ï¼š8GB æˆ–ä»¥ä¸Šï¼ˆECC å†…å­˜æ›´ä½³ï¼‰ï¼Œå»ºè®® 4G èµ·æ­¥ - Ballooningï¼šå¯æ ¹æ®éœ€è¦å¯ç”¨ï¼ˆå…è®¸åŠ¨æ€å†…å­˜è°ƒæ•´ï¼‰ 4ï¸âƒ£ ç½‘ç»œé…ç½® 1 2 3 4 5 # ç½‘ç»œå»ºè®®ï¼š - ç½‘æ¡¥ï¼šé€‰æ‹©é€‚å½“çš„ç½‘æ¡¥ï¼ˆå¦‚ vmbr0ï¼‰ - æ¨¡å‹ï¼šVirtIO (åŠè™šæ‹ŸåŒ–) (æ€§èƒ½æœ€å¥½) - VLAN æ ‡ç­¾ï¼šæ ¹æ®éœ€è¦é…ç½® - é˜²ç«å¢™ï¼šæ ¹æ®éœ€è¦é…ç½® 5ï¸âƒ£ ç¡®è®¤é…ç½®å¹¶åˆ›å»º æ£€æŸ¥æ‰€æœ‰é…ç½®æ— è¯¯åï¼Œç‚¹å‡» å®Œæˆ åˆ›å»ºè™šæ‹Ÿæœºã€‚å…ˆä¸è¦å¯åŠ¨ã€‚\nğŸ› ï¸ å®‰è£… FnOS 1ï¸âƒ£ å¯åŠ¨å®‰è£… é€‰æ‹©åˆ›å»ºçš„ FnOS è™šæ‹Ÿæœº ç‚¹å‡»\u0026quot;å¯åŠ¨\u0026quot; ç‚¹å‡»\u0026quot;æ§åˆ¶å°\u0026ldquo;è¿›å…¥å®‰è£…ç•Œé¢ 2ï¸âƒ£ å®‰è£…è¿‡ç¨‹ å®‰è£…è¿‡ç¨‹é€šå¸¸æ¯”è¾ƒç®€å•ï¼Œéµå¾ªå›¾å½¢åŒ–ç•Œé¢æŒ‡å¼•å³å¯ï¼š\né€‰æ‹©è¯­è¨€ï¼šä¸­æ–‡æˆ–è‹±æ–‡ é”®ç›˜å¸ƒå±€ï¼šæ ¹æ®åœ°åŒºé€‰æ‹© å®‰è£…ç›®æ ‡ï¼šé€‰æ‹©ä¹‹å‰åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜ï¼ˆä¾‹å¦‚ QEMU HARDDISKï¼‰ ç½‘ç»œé…ç½®ï¼šé€šå¸¸ä½¿ç”¨ DHCP è·å– IP åœ°å€å³å¯ï¼Œå®‰è£…å®Œæˆåå¯åœ¨ FnOS Web ç•Œé¢ä¸­ä¿®æ”¹ä¸ºé™æ€ IPã€‚ ç¡®è®¤å®‰è£…ï¼šå¼€å§‹å®‰è£…ç³»ç»Ÿï¼Œç­‰å¾…è¿›åº¦å®Œæˆã€‚ å®‰è£…å®Œæˆï¼šæç¤ºå®‰è£…æˆåŠŸåï¼Œç³»ç»Ÿä¼šè¦æ±‚é‡å¯ã€‚åœ¨é‡å¯å‰ï¼Œéœ€è¦åœ¨ PVE ä¸­ç§»é™¤å®‰è£… ISO é•œåƒï¼ˆåœ¨è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®ä¸­åˆ†ç¦»æˆ–åˆ é™¤ CD/DVD é©±åŠ¨å™¨ï¼‰ï¼Œå¦åˆ™ä¼šå†æ¬¡è¿›å…¥å®‰è£…ç•Œé¢ã€‚ 3ï¸âƒ£ åˆå§‹è®¾ç½® é¦–æ¬¡è®¿é—®ï¼šç³»ç»Ÿé‡å¯åï¼Œæ§åˆ¶å°æˆ–å®‰è£…æç¤ºä¼šæ˜¾ç¤º Web ç®¡ç†ç•Œé¢çš„è®¿é—®åœ°å€ï¼ˆé€šå¸¸æ˜¯ https://\u0026lt;IP\u0026gt;:5666ï¼‰ã€‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥åœ°å€ã€‚ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼šæŒ‰ç…§ç½‘é¡µæŒ‡å¼•ï¼Œè®¾ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ã€‚ è¿›å…¥ç³»ç»Ÿï¼šå®Œæˆåˆå§‹åŒ–åï¼Œå³å¯è¿›å…¥ FnOS çš„ä¸»ç•Œé¢ã€‚ âš™ï¸ ç¡¬ä»¶ç›´é€šé…ç½® è¿™æ˜¯æå‡è™šæ‹Ÿæœºæ€§èƒ½å’Œä½“éªŒçš„å…³é”®æ­¥éª¤ï¼Œä¸»è¦åŒ…æ‹¬ç¡¬ç›˜ç›´é€šå’Œæ ¸æ˜¾ç›´é€šã€‚\n1ï¸âƒ£ SATA æ§åˆ¶å™¨æˆ–ç¡¬ç›˜ç›´é€š ç›®çš„ï¼šè®© FnOS è™šæ‹Ÿæœºç›´æ¥ç®¡ç†ç‰©ç†ç¡¬ç›˜ï¼Œé¿å…é€šè¿‡ PVE è™šæ‹Ÿå±‚ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒç¡¬ç›˜ä¼‘çœ ç­‰åŠŸèƒ½ã€‚\næ–¹æ³•ä¸€ï¼šç›´é€šæ•´ä¸ª SATA æ§åˆ¶å™¨ï¼ˆæ¨èï¼‰\n1 2 3 4 5 6 # åœ¨ PVE Shell ä¸‹æŸ¥çœ‹ç£ç›˜æ§åˆ¶å™¨æ ‡è¯† ls -l /dev/disk/by-id/ # è¾“å‡ºä¸­æ‰¾åˆ°ä½ çš„ SATA æ§åˆ¶å™¨æˆ–å•å—ç¡¬ç›˜çš„æ ‡è¯†ï¼Œé€šå¸¸ä»¥ `ata-` å¼€å¤´ # ç„¶ååœ¨è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®ä¸­æ·»åŠ  PCI è®¾å¤‡ qm set \u0026lt;VMID\u0026gt; -sata2 /dev/disk/by-id/ata-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx æ–¹æ³•äºŒï¼šåœ¨ Web ç•Œé¢æ·»åŠ  PCI è®¾å¤‡\nåœ¨ PVE èŠ‚ç‚¹ Shell ä¸­ï¼Œä½¿ç”¨ ls /dev/disk/by-id/ æ‰¾åˆ°è¦ç›´é€šçš„ç¡¬ç›˜ IDã€‚ ç¼–è¾‘ FnOS è™šæ‹Ÿæœºçš„ç¡¬ä»¶é…ç½®ï¼Œç‚¹å‡»\u0026quot;æ·»åŠ \u0026rdquo; -\u0026gt; \u0026ldquo;PCI è®¾å¤‡\u0026rdquo;ã€‚ åœ¨\u0026quot;è®¾å¤‡\u0026quot;ä¸‹æ‹‰èœå•ä¸­ï¼Œé€‰æ‹©æ‚¨æ‰¾åˆ°çš„ç¡¬ç›˜æ ‡è¯†ï¼ˆå¦‚ ata-XXXï¼‰ã€‚ é‡è¦ï¼šå‹¾é€‰ æ‰€æœ‰åŠŸèƒ½ å’Œ PCI-Express é€‰é¡¹ã€‚ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot;ã€‚ é‡å¯ FnOS è™šæ‹Ÿæœºåï¼Œåœ¨ FnOS Web ç®¡ç†ç•Œé¢çš„\u0026quot;å­˜å‚¨\u0026quot; -\u0026gt; \u0026ldquo;ç¡¬ç›˜\u0026quot;ä¸­åº”è¯¥èƒ½çœ‹åˆ°ç›´é€šçš„ç¡¬ç›˜ï¼Œç„¶åå°±å¯ä»¥åˆ›å»ºå­˜å‚¨ç©ºé—´äº†ã€‚\n2ï¸âƒ£ Intel æ ¸æ˜¾è™šæ‹ŸåŒ–ç›´é€š (SR-IOV) ç›®çš„ï¼šè®© FnOS è™šæ‹Ÿæœºä½¿ç”¨æ ¸æ˜¾è¿›è¡Œè§†é¢‘ç¡¬ä»¶è§£ç å’Œç¼–ç ï¼Œå¤§å¹…æå‡å½±è§†åº”ç”¨å’Œ Docker å®¹å™¨çš„è½¬ç æ€§èƒ½ã€‚\nå‰æï¼š\nç¡®è®¤ CPU å’ŒèŠ¯ç‰‡ç»„æ”¯æŒ SR-IOVï¼ˆIntel è¾ƒæ–°çš„ CPU é€šå¸¸æ”¯æŒï¼‰ã€‚ åœ¨ä¸»æ¿ BIOS ä¸­å¼€å¯ VT-d è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚ æ“ä½œæ­¥éª¤ï¼ˆæ¦‚è¦ï¼‰ï¼š\nå®‰è£…æ ¸æ˜¾è™šæ‹ŸåŒ–é©±åŠ¨ï¼šæœ‰ç¼–è¯‘å®‰è£…å’Œå®‰è£…åŒ…ä¸¤ç§æ–¹æ¡ˆï¼Œæ–°æ‰‹æ¨èä½¿ç”¨æ–¹æ¡ˆäºŒï¼ˆMoetaYuko æä¾›çš„ backports åŒ…ï¼‰ã€‚ ä¿®æ”¹ PVE å†…æ ¸å‚æ•°ï¼šç¼–è¾‘ /etc/default/grubï¼Œåœ¨ GRUB_CMDLINE_LINUX_DEFAULT è¡Œæ·»åŠ  intel_iommu=on i915.enable_guc=3 i915.max_vfs=3ã€‚ æ›´æ–°å¼•å¯¼å¹¶é‡å¯ï¼šè¿è¡Œ update-grub å’Œ update-initramfs -uï¼Œç„¶åé‡å¯ PVEã€‚ éªŒè¯é©±åŠ¨å¹¶æ‹†åˆ†è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰ï¼šä½¿ç”¨ dkms status å’Œ dmesg | grep -e DMAR -e IOMMU éªŒè¯ã€‚é€šè¿‡ echo \u0026quot;devices/pci0000:00/0000:00:02.0/sriov_numvfs = 3\u0026quot; \u0026gt; /etc/sysfs.conf è®¾ç½®æ‹†åˆ†æ•°é‡ï¼ˆä¾‹å¦‚æ‹†åˆ†æˆ3ä¸ªè™šæ‹Ÿæ˜¾å¡ï¼‰ã€‚ å°†è™šæ‹Ÿæ˜¾å¡ç›´é€šç»™è™šæ‹Ÿæœºï¼š åœ¨ FnOS è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®ä¸­\u0026quot;æ·»åŠ \u0026rdquo; -\u0026gt; \u0026ldquo;PCI è®¾å¤‡\u0026rdquo; é€‰æ‹©æ‹†åˆ†å‡ºçš„è™šæ‹Ÿæ˜¾å¡ï¼ˆæ³¨æ„ï¼šä¸è¦é€‰æ‹©åŸç”Ÿæ ¸æ˜¾ 00:02.0ï¼‰ã€‚ é‡è¦ï¼šä¸è¦å‹¾é€‰ Primary GPUï¼Œä¸è¦å‹¾é€‰ All Functionsï¼Œè¦å‹¾é€‰ PCI-Expressã€‚ åŒæ—¶ï¼Œå°†\u0026quot;æ˜¾ç¤º\u0026quot;è®¾ç½®ä¸º virtio-gpuã€‚ éªŒè¯ç›´é€šï¼šå¯åŠ¨ FnOS è™šæ‹Ÿæœºï¼Œé€šè¿‡ SSH ç™»å½• FnOSï¼Œè¿è¡Œ ls /dev/dri å‘½ä»¤ã€‚å¦‚æœèƒ½çœ‹åˆ° card1 ç­‰è®¾å¤‡ï¼Œåˆ™è¡¨ç¤ºæ ¸æ˜¾ç›´é€šæˆåŠŸã€‚éšåå³å¯åœ¨é£ç‰›å½±è§†ç­‰åº”ç”¨çš„è®¾ç½®ä¸­å¼€å¯ç¡¬ä»¶è§£ç ã€‚ æ³¨æ„ï¼šAMD æ ¸æ˜¾ç›®å‰ä¸æ”¯æŒè™šæ‹ŸåŒ–æ‹†åˆ†ï¼Œåªèƒ½è¿›è¡Œä¼ ç»Ÿç›´é€šï¼ˆç‹¬å æ¨¡å¼ï¼ŒPVE ä¸»æœºå°†æ— æ³•ä½¿ç”¨æ˜¾å¡è¾“å‡ºï¼‰ã€‚\nğŸ” FnOS åŸºæœ¬é…ç½® 1ï¸âƒ£ å­˜å‚¨é…ç½® åˆ›å»ºå­˜å‚¨ç©ºé—´ï¼š\nç™»å½• FnOS Web ç•Œé¢ã€‚ è¿›å…¥\u0026quot;å­˜å‚¨\u0026quot; \u0026gt; \u0026ldquo;å­˜å‚¨ç©ºé—´\u0026quot;ã€‚ ç‚¹å‡»\u0026rdquo;ç«‹å³åˆ›å»º\u0026quot;ï¼Œé€‰æ‹©å·²ç›´é€šçš„ç‰©ç†ç¡¬ç›˜ã€‚ é€‰æ‹©é˜µåˆ—æ¨¡å¼ï¼ˆå¦‚å•ç›˜ Basicï¼Œå¤šç›˜å¯é€‰æ‹© RAID æ¨¡å¼å¦‚ RAID 1 æˆ– Linearï¼‰ã€‚ å®Œæˆåˆ›å»ºã€‚ åˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ï¼š\nè¿›å…¥\u0026quot;å­˜å‚¨\u0026quot; \u0026gt; \u0026ldquo;å…±äº«æ–‡ä»¶å¤¹\u0026quot;ã€‚ åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹ï¼Œå¹¶è®¾ç½®è®¿é—®æƒé™ã€‚ 2ï¸âƒ£ ç½‘ç»œé…ç½® é™æ€ IPï¼šå»ºè®®åœ¨\u0026rdquo;ç³»ç»Ÿè®¾ç½®\u0026quot; \u0026gt; \u0026ldquo;ç½‘ç»œ\u0026ldquo;ä¸­ï¼Œå°†ç½‘ç»œé…ç½®ä» DHCP æ›´æ”¹ä¸ºé™æ€ IPï¼Œä¾¿äºè®¿é—®å’Œç®¡ç†ã€‚ ç«¯å£è‡ªå®šä¹‰ï¼šæ–°ç‰ˆæœ¬çš„ FnOS æ”¯æŒåœ¨\u0026rdquo;ç³»ç»Ÿè®¾ç½®\u0026rdquo; \u0026gt; \u0026ldquo;å®‰å…¨æ€§\u0026ldquo;ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡çš„è®¿é—®ç«¯å£ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚ 3ï¸âƒ£ æœåŠ¡é…ç½® æ–‡ä»¶æœåŠ¡ï¼šåœ¨\u0026rdquo;æœåŠ¡\u0026ldquo;ä¸­å¯ç”¨æ‰€éœ€çš„æ–‡ä»¶å…±äº«åè®®ï¼Œå¦‚ SMBã€AFPã€FTP ç­‰ã€‚ åª’ä½“æœåŠ¡ï¼šå®‰è£…\u0026rdquo;é£ç‰›å½±è§†\u0026ldquo;åº”ç”¨ï¼Œå¹¶è®¾ç½®åª’ä½“åº“ã€‚å¦‚æœå·²æˆåŠŸç›´é€šæ ¸æ˜¾ï¼Œè®°å¾—åœ¨è®¾ç½®ä¸­å¼€å¯ç¡¬ä»¶è§£ç ã€‚ Dockerï¼šFnOS å†…ç½® Docker æ”¯æŒï¼Œä½ å¯ä»¥åœ¨\u0026rdquo;åº”ç”¨å•†åº—\u0026ldquo;å®‰è£… Docker åº”ç”¨ï¼Œæˆ–é€šè¿‡å‘½ä»¤è¡Œç®¡ç†ã€‚ 4ï¸âƒ£ å®‰å…¨é…ç½® é˜²ç«å¢™ï¼šæ–°ç‰ˆæœ¬çš„ FnOS å†…ç½®äº†é˜²ç«å¢™åŠŸèƒ½ï¼Œå¯ä»¥åœ¨\u0026rdquo;ç³»ç»Ÿè®¾ç½®\u0026rdquo; \u0026gt; \u0026ldquo;å®‰å…¨æ€§\u0026ldquo;ä¸­é…ç½®è§„åˆ™ã€‚ SSL è¯ä¹¦ï¼šå¯ä»¥ä¸ºä½ çš„ FnOS åŸŸåä¸Šä¼  SSL è¯ä¹¦ï¼Œå¹¶å¼€å¯\u0026rdquo;å¼ºåˆ¶ HTTPS\u0026quot;ã€‚ ğŸ›¡ï¸ å®‰å…¨å’Œå¤‡ä»½ 1ï¸âƒ£ FnOS ç³»ç»Ÿæ›´æ–° å®šæœŸæ£€æŸ¥å¹¶æ›´æ–° FnOS ç³»ç»Ÿï¼Œä»¥è·å–æ–°åŠŸèƒ½å’Œå®‰å…¨æ€§è¡¥ä¸ã€‚æ³¨æ„ï¼šå°½é‡é¿å…åœ¨ FnOS ç³»ç»Ÿå†…ä½¿ç”¨ apt upgrade ç­‰å‘½ä»¤æ‰‹åŠ¨å‡çº§ç³»ç»Ÿä¾èµ–ï¼Œä»¥å…ä¸é£ç‰›å®˜æ–¹ç»´æŠ¤çš„ä¾èµ–å‘ç”Ÿå†²çªï¼Œå¯¼è‡´æ›´æ–°å¤±è´¥æˆ–ç³»ç»Ÿä¸ç¨³å®šã€‚\n2ï¸âƒ£ PVE è™šæ‹Ÿæœºå¤‡ä»½ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨ PVE å¤‡ä»½åŠŸèƒ½ä¿æŠ¤ FnOS è™šæ‹Ÿæœº # åˆ›å»ºå¤‡ä»½è®¡åˆ’ï¼š 1. é€‰æ‹© FnOS è™šæ‹Ÿæœº 2. ç‚¹å‡»\u0026#34;å¤‡ä»½\u0026#34; -\u0026gt; \u0026#34;ç«‹å³å¤‡ä»½\u0026#34; 3. æˆ–åˆ›å»ºå¤‡ä»½è®¡åˆ’ï¼š - é¢‘ç‡ï¼šæ¯æ—¥/æ¯å‘¨ - ä¿ç•™ç­–ç•¥ï¼šä¿ç•™æœ€è¿‘ 7 ä¸ªå¤‡ä»½ - å‹ç¼©ï¼šå¯ç”¨ - æ¨¡å¼ï¼šå¿«ç…§æ¨¡å¼ ğŸ”§ æ•…éšœæ’é™¤ â“ å¸¸è§é—®é¢˜ æ ¸æ˜¾ç›´é€šåæ— æ³•ç¡¬è§£ï¼š\næ£€æŸ¥ç‚¹ï¼šç¡®è®¤åœ¨ PVE ä¸­æ·»åŠ çš„æ˜¯è™šæ‹Ÿæ˜¾å¡ï¼ˆVFï¼‰è€Œéç‰©ç†æ˜¾å¡ï¼ˆPFï¼‰ã€‚åœ¨è™šæ‹Ÿæœºé…ç½®ä¸­æ£€æŸ¥ PCI è®¾å¤‡è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼ˆå‹¿å‹¾é€‰ Primary GPU å’Œ All Functionsï¼Œéœ€å‹¾é€‰ PCI-Expressï¼‰ã€‚ åœ¨ FnOS å†…æ£€æŸ¥ï¼šSSH ç™»å½• FnOSï¼Œè¿è¡Œ ls /dev/driã€‚æˆåŠŸåˆ™åº”çœ‹åˆ° card1 ç­‰è®¾å¤‡ã€‚ ç¡¬ç›˜æ— æ³•ä¼‘çœ ï¼š\nFnOS æ–°ç‰ˆæœ¬ï¼ˆå¦‚ 0.9.10+ï¼‰ä½¿ç”¨äº†æ›´ä¸¥æ ¼çš„ SMART ä¿¡æ¯æ¥åˆ¤æ–­ä¼‘çœ ï¼Œä¸æ”¯æŒ SMART çš„ç¡¬ä»¶å¯èƒ½æ— æ³•æ˜¾ç¤ºä¼‘çœ æ—¥å¿—ã€‚è¯·ç¡®ä¿ä½¿ç”¨æ”¯æŒ SMART çš„ç¡¬ç›˜å¹¶é€šè¿‡ç›´é€šæ–¹å¼è¿æ¥ã€‚ ç³»ç»Ÿæ›´æ–°å¤±è´¥ï¼š\né€šå¸¸æ˜¯ç”±äºæ‰‹åŠ¨æ‰§è¡Œ apt upgrade å¯¼è‡´ä¾èµ–å†²çªã€‚å°è¯•åœ¨ç»ˆç«¯æ‰§è¡Œ sudo -i åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œç„¶åæ‰§è¡Œ apt --fix-broken install æ¥ä¿®å¤ä¾èµ–é—®é¢˜ã€‚ è™šæ‹Ÿæœºæ— æ³•å¯åŠ¨ï¼š\næ£€æŸ¥è™šæ‹Ÿæœºé…ç½®ï¼ˆqm config \u0026lt;VMID\u0026gt;ï¼‰ï¼Œç¡®è®¤ BIOS è®¾ç½®ä¸º OVMFï¼Œæœºå™¨ç±»å‹ä¸º q35ã€‚ ğŸ› è¯Šæ–­å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # åœ¨ PVE Shell ä¸­æŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€ qm status \u0026lt;VMID\u0026gt; # æŸ¥çœ‹è™šæ‹Ÿæœºå¯åŠ¨æ—¥å¿— qm start \u0026lt;VMID\u0026gt; --console # åœ¨ FnOS SSH ä¸­æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— journalctl -xe # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h âš¡ æ€§èƒ½ä¼˜åŒ– 1ï¸âƒ£ PVE ä¸»æœºä¼˜åŒ– 1 2 3 4 # è°ƒæ•´å†…æ ¸å‚æ•° echo \u0026#39;vm.swappiness=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.vfs_cache_pressure=50\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p 2ï¸âƒ£ è™šæ‹Ÿæœºä¼˜åŒ– 1 2 3 4 # å¯ç”¨ CPU ç±»å‹å’Œå†…å­˜æ°”çƒé©±åŠ¨ # åœ¨è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š cpu: host balloon: 1024 3ï¸âƒ£ å­˜å‚¨ä¼˜åŒ– 1 2 3 4 5 6 # ä½¿ç”¨ VirtIO SCSI æ§åˆ¶å™¨ scsihw: virtio-scsi-single # å¯ç”¨ discard/trim æ”¯æŒ discard: on ssd: 1 ğŸ’¾ å¤‡ä»½ä¸æ¢å¤ 1ï¸âƒ£ é…ç½®æ–‡ä»¶å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # FnOS é…ç½®å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup/fnos\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) mkdir -p $BACKUP_DIR/$DATE # å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ tar -czf $BACKUP_DIR/$DATE/fnos-config.tar.gz \\ /etc/fnos \\ /etc/samba \\ /etc/network/interfaces echo \u0026#34;FnOS é…ç½®å¤‡ä»½å®Œæˆ: $BACKUP_DIR/$DATE\u0026#34; 2ï¸âƒ£ å®Œæ•´ç³»ç»Ÿå¤‡ä»½ 1 2 # ä½¿ç”¨ PVE å¤‡ä»½åŠŸèƒ½ qm backup \u0026lt;VMID\u0026gt; \u0026lt;storage\u0026gt; --mode stop --compress zstd ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„æŒ‡å¯¼ï¼Œæ‚¨åº”è¯¥å·²ç»æˆåŠŸåœ¨ PVE ä¸Šéƒ¨ç½²äº†åŠŸèƒ½å®Œå–„çš„ FnOS ç³»ç»Ÿï¼š\nâœ… å®Œæˆçš„ä»»åŠ¡ï¼š ç¯å¢ƒå‡†å¤‡ï¼šä¸‹è½½å¹¶ä¸Šä¼  FnOS é•œåƒåˆ° PVEã€‚ è™šæ‹Ÿæœºåˆ›å»ºï¼šæ­£ç¡®é…ç½®è™šæ‹Ÿæœºå‚æ•°ï¼ˆq35, OVMFï¼‰ã€‚ ç³»ç»Ÿå®‰è£…ï¼šå®Œæˆ FnOS çš„å®‰è£…å’Œåˆå§‹è®¾ç½®ã€‚ ç¡¬ä»¶ç›´é€šï¼šé…ç½®äº†ç¡¬ç›˜ç›´é€šå’Œ Intel æ ¸æ˜¾è™šæ‹ŸåŒ–ç›´é€šï¼Œæå¤§æå‡æ€§èƒ½ä¸åŠŸèƒ½ã€‚ ç³»ç»Ÿé…ç½®ï¼šè®¾ç½®äº†å­˜å‚¨ã€ç½‘ç»œå’Œåº”ç”¨ã€‚ å®‰å…¨ä¸å¤‡ä»½ï¼šäº†è§£äº†æ›´æ–°æ³¨æ„äº‹é¡¹å’Œå¤‡ä»½ç­–ç•¥ã€‚ ğŸŒŸ æœ€ä½³å®è·µï¼š å®šæœŸå¤‡ä»½ï¼šåˆ©ç”¨ PVE çš„å¤‡ä»½åŠŸèƒ½å®šæœŸå¤‡ä»½è™šæ‹Ÿæœºã€‚ ç¨³å®šä¼˜å…ˆï¼šé¿å…åœ¨ FnOS å†…æ‰‹åŠ¨å‡çº§ç³»ç»Ÿä¾èµ–ã€‚ ç¤¾åŒºæ”¯æŒï¼šé‡åˆ°é—®é¢˜å¯è®¿é—®é£ç‰›å®˜æ–¹ç¤¾åŒºå¯»æ±‚å¸®åŠ©ã€‚ æ–‡æ¡£ç»´æŠ¤ï¼šè®°å½•æ‚¨çš„ç¡¬ä»¶ç›´é€šé…ç½®å’Œé‡è¦è®¾ç½®å˜æ›´ã€‚ ğŸ”§ åç»­æ­¥éª¤ï¼š æ¢ç´¢åº”ç”¨ï¼šåœ¨åº”ç”¨å•†åº—å®‰è£…æ›´å¤šæ‰€éœ€åº”ç”¨ï¼Œå¦‚ Dockerã€è¿…é›·ã€åŒæ­¥å·¥å…·ç­‰ã€‚ è¿œç¨‹è®¿é—®ï¼šé…ç½®å®‰å…¨çš„è¿œç¨‹è®¿é—®æ–¹å¼ï¼ˆå¦‚ DDNS æˆ– Tailscaleï¼‰ã€‚ åª’ä½“åº“å»ºè®¾ï¼šæ•´ç†å¹¶å¯¼å…¥ä½ çš„å½±è§†ã€ç…§ç‰‡èµ„æºï¼Œäº«å—ç¡¬è§£å¸¦æ¥çš„æµç•…æ’­æ”¾ä½“éªŒã€‚ ç°åœ¨ï¼Œæ‚¨çš„ FnOS NAS ç³»ç»Ÿå·²ç»å‡†å¤‡å°±ç»ªï¼Œå°½æƒ…äº«å—é«˜æ•ˆã€å®‰å…¨çš„ç§æœ‰äº‘å­˜å‚¨å’Œåª’ä½“æœåŠ¡å§ï¼ğŸš€\nğŸ“ æŠ€æœ¯æ”¯æŒ å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š\næŸ¥çœ‹æ—¥å¿—ï¼šé¦–å…ˆæ£€æŸ¥ PVE å’Œ FnOS çš„ç³»ç»Ÿæ—¥å¿—ã€‚ ç¤¾åŒºæ”¯æŒï¼šè®¿é—® é£ç‰›å®˜æ–¹ç¤¾åŒº æœç´¢æˆ–æé—®ã€‚ å®˜æ–¹æ–‡æ¡£ï¼šæŸ¥é˜… é£ç‰›å¸®åŠ©ä¸­å¿ƒ ã€‚ å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©æ­å»ºå±äºè‡ªå·±çš„å®¶åº­NASç³»ç»Ÿï¼\n","date":"2024-12-07T20:51:21+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/beb17394/","title":"Proxmox VE å®‰è£… FnOS å®Œå…¨æŒ‡å— ğŸ§"},{"content":"Docker éƒ¨ç½² Speedtest å†…ç½‘æµ‹é€ŸæœåŠ¡ âš¡ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Speedtest 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. è¿›è¡Œç½‘ç»œæµ‹é€Ÿ ğŸ“Š ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç½‘ç»œæµ‹é€Ÿï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Speedtest-Go-ZH å®˜ç½‘åœ°å€ï¼š https://www.speedtest.net/zh-Hans ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/xiaoxinpro/speedtest-go-zh ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/chishin/speedtest-go-zh Speedtest-Go-ZH æ˜¯ä¸€æ¬¾åŸºäº Docker çš„å†…ç½‘æµ‹é€ŸæœåŠ¡ï¼Œä¸“é—¨ä¸ºä¸­æ–‡ç”¨æˆ·ä¼˜åŒ–ï¼Œæä¾›å‡†ç¡®ã€å¿«é€Ÿçš„ç½‘ç»œé€Ÿåº¦æµ‹è¯•åŠŸèƒ½ã€‚å®ƒå¯ä»¥å¸®åŠ©æ‚¨æµ‹é‡å±€åŸŸç½‘å†…çš„ç½‘ç»œæ€§èƒ½ï¼ŒåŒ…æ‹¬ä¸‹è½½é€Ÿåº¦ã€ä¸Šä¼ é€Ÿåº¦å’Œç½‘ç»œå»¶è¿Ÿï¼Œæ˜¯ç½‘ç»œç®¡ç†å‘˜å’Œå®¶åº­ç”¨æˆ·çš„ç†æƒ³å·¥å…·ã€‚ğŸŒ\né¡¹ç›®åœ°å€:\né»˜è®¤è®¿é—®åœ°å€: http://æœåŠ¡å™¨IP:7878\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âš¡ ç²¾å‡†æµ‹é€Ÿ æµ‹é‡ä¸‹è½½ã€ä¸Šä¼ é€Ÿåº¦å’Œç½‘ç»œå»¶è¿Ÿ æä¾›å‡†ç¡®çš„ç½‘ç»œæ€§èƒ½æ•°æ® ğŸ¯ ä¸­æ–‡ä¼˜åŒ– ä¸“ä¸ºä¸­æ–‡ç”¨æˆ·è®¾è®¡ ç•Œé¢å‹å¥½ï¼Œæ“ä½œç®€å• ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker ä¸€é”®éƒ¨ç½² ç®€å•æ˜“ç”¨ï¼Œå¿«é€Ÿä¸Šæ‰‹ ğŸ“Š å®æ—¶ç»“æœ å³æ—¶æ˜¾ç¤ºæµ‹é€Ÿç»“æœ å¿«é€Ÿè·å–ç½‘ç»œæ€§èƒ½æ•°æ® ğŸ”§ é…ç½®çµæ´» æ”¯æŒè‡ªå®šä¹‰é…ç½® å¯æ ¹æ®éœ€æ±‚è°ƒæ•´å‚æ•° ğŸŒ å†…ç½‘æµ‹è¯• ä¸“æ³¨äºå±€åŸŸç½‘æµ‹è¯• å‡†ç¡®è¯„ä¼°å†…éƒ¨ç½‘ç»œæ€§èƒ½ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Speedtest 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -p /mnt/mydisk/home/speedtest \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: speedtest-go-zh: container_name: speedtest image: chishin/speedtest-go-zh:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;7878:8989\u0026#34; volumes: - ./config:/app/config environment: - TZ=Asia/Shanghai healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8989\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:7878 IPè®¿é—®: http://æœåŠ¡å™¨IP:7878 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. è¿›è¡Œç½‘ç»œæµ‹é€Ÿ ğŸ“Š æ‰“å¼€æµ‹é€Ÿé¡µé¢\nåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Speedtest é¡µé¢ ç‚¹å‡»\u0026quot;å¼€å§‹æµ‹é€Ÿ\u0026quot;æŒ‰é’® æŸ¥çœ‹æµ‹é€Ÿç»“æœ\nğŸ“¥ ä¸‹è½½é€Ÿåº¦ (Download) ğŸ“¤ ä¸Šä¼ é€Ÿåº¦ (Upload) â±ï¸ ç½‘ç»œå»¶è¿Ÿ (Ping) ğŸ“ˆ æŠ–åŠ¨ (Jitter) åˆ†æç»“æœ\nå¯¹æ¯”ä¸åŒæ—¶é—´æ®µçš„æµ‹é€Ÿç»“æœ è¯†åˆ«ç½‘ç»œæ€§èƒ½é—®é¢˜ ä¼˜åŒ–ç½‘ç»œé…ç½® ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://speedtest.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/speedtest.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name speedtest.example.com; # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:7878; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/speedtest # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop speedtest docker start speedtest docker restart speedtest # åˆ é™¤å®¹å™¨ docker rm speedtest docker rm -f speedtest # è¿›å…¥å®¹å™¨Shell docker exec -it speedtest sh docker exec -it speedtest bash # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect speedtest docker stats speedtest # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs speedtest docker logs -f speedtest docker logs --tail 100 speedtest docker logs -t speedtest 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi chishin/speedtest-go-zh:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªç½‘ç»œæµ‹é€Ÿï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Speedtest å†…ç½‘æµ‹é€ŸæœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ éšæ—¶éšåœ° ç²¾å‡†æµ‹é‡ç½‘ç»œæ€§èƒ½ï¼Œæ— è®ºæ˜¯å±€åŸŸç½‘è¿˜æ˜¯äº’è”ç½‘è¿æ¥ï¼Œéƒ½èƒ½è·å¾—å‡†ç¡®çš„æµ‹é€Ÿæ•°æ®\nğŸ“Š å®Œå…¨æŒæ§ ç½‘ç»œè´¨é‡çŠ¶å†µï¼Œå®æ—¶ç›‘æ§ä¸‹è½½é€Ÿåº¦ã€ä¸Šä¼ é€Ÿåº¦å’Œç½‘ç»œå»¶è¿Ÿï¼ŒåŠæ—¶å‘ç°ç½‘ç»œé—®é¢˜\nğŸ”§ ç®€å•æ˜“ç”¨ ä¸€é”®éƒ¨ç½²çš„æµ‹é€Ÿå¹³å°ï¼Œæ— éœ€å¤æ‚é…ç½®å³å¯å¼€å§‹ä¸“ä¸šçº§çš„ç½‘ç»œæ€§èƒ½æµ‹è¯•\nğŸŒ å¤šåœºæ™¯åº”ç”¨ é€‚ç”¨äºå®¶åº­ç½‘ç»œã€ä¼ä¸šå†…ç½‘ã€æœåŠ¡å™¨å¸¦å®½ç­‰å„ç§åœºæ™¯çš„æ€§èƒ½è¯„ä¼°\nç½‘ç»œæ˜¯æ•°å­—ä¸–ç•Œçš„è¡€è„‰ï¼Œé€Ÿåº¦æ˜¯ä½“éªŒçš„å…³é”®ã€‚æ„¿ Speedtest æˆä¸ºä½ ç½‘ç»œä¼˜åŒ–çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ è¯Šæ–­ç½‘ç»œé—®é¢˜ï¼Œä¼˜åŒ–ç½‘ç»œé…ç½®ï¼Œäº«å—æµç•…çš„ç½‘ç»œä½“éªŒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç²¾å‡†æµ‹é‡ï¼Œä¼˜åŒ–ç½‘ç»œâ€”â€”æ„å»ºä½ é«˜æ•ˆç¨³å®šçš„ç½‘ç»œç¯å¢ƒå§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Speedtest-Go-ZH é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æµ‹é€Ÿæ„‰å¿«ï¼Œç½‘ç»œç•…é€šï¼ğŸ‰\n","date":"2024-12-07T20:49:07+08:00","image":"https://file.meimolihan.eu.org/img/speedtest-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9a9425f3/","title":"Docker éƒ¨ç½² Speedtest å†…ç½‘æµ‹é€ŸæœåŠ¡ âš¡"},{"content":"Docker éƒ¨ç½² Home Assistant æ™ºèƒ½å®¶å±…ç³»ç»Ÿ ğŸ  ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Home Assistant 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Home Assistant 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ  å¯èˆªæ™ºèƒ½ï¼ŒæŒæ§æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Home Assistant å®˜ç½‘åœ°å€ï¼š https://www.home-assistant.io/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/home-assistant/developers.home-assistant Home Assistant æ˜¯ä¸€æ¬¾å¼€æºçš„æ™ºèƒ½å®¶å±…å¹³å°ï¼Œä¸“æ³¨äºæœ¬åœ°åŒ–æ§åˆ¶å’Œéšç§ä¿æŠ¤ã€‚å®ƒå¯ä»¥é›†æˆæ•°åƒç§æ™ºèƒ½è®¾å¤‡ï¼Œè®©æ‚¨åœ¨ä¸€ä¸ªç»Ÿä¸€çš„ç•Œé¢ä¸­æ§åˆ¶æ‰€æœ‰æ™ºèƒ½å®¶å±…è®¾å¤‡ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ Home Assistantï¼Œå®ç°æ™ºèƒ½å®¶å±…çš„é›†ä¸­ç®¡ç†å’Œè‡ªåŠ¨åŒ–æ§åˆ¶ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ  ç»Ÿä¸€æ§åˆ¶ é›†æˆå¤šç§æ™ºèƒ½å®¶å±…è®¾å¤‡ ä¸€ä¸ªå¹³å°æ§åˆ¶æ‰€æœ‰æ™ºèƒ½è®¾å¤‡ ğŸ”’ æœ¬åœ°åŒ–è¿è¡Œ æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ ä¿æŠ¤éšç§ï¼Œå‡å°‘å¯¹å¤–éƒ¨äº‘æœåŠ¡çš„ä¾èµ– ğŸ¤– è‡ªåŠ¨åŒ– å¼ºå¤§çš„è‡ªåŠ¨åŒ–è§„åˆ™å¼•æ“ æ ¹æ®æ¡ä»¶è‡ªåŠ¨è§¦å‘è®¾å¤‡åŠ¨ä½œ ğŸ“± ç§»åŠ¨åº”ç”¨ æ”¯æŒ iOS å’Œ Android åº”ç”¨ éšæ—¶éšåœ°æ§åˆ¶æ™ºèƒ½å®¶å±… ğŸŒ ç¤¾åŒºæ”¯æŒ åºå¤§çš„å¼€å‘è€…ç¤¾åŒºå’Œæ’ä»¶ç”Ÿæ€ æŒç»­çš„åŠŸèƒ½æ›´æ–°å’Œæ‰©å±• ğŸ¨ é«˜åº¦å¯å®šåˆ¶ è‡ªå®šä¹‰ç•Œé¢å’Œä»ªè¡¨ç›˜ æ ¹æ®ä¸ªäººå–œå¥½å®šåˆ¶ç•Œé¢ âš¡ å®æ—¶å“åº” æœ¬åœ°ç½‘ç»œå†…å¿«é€Ÿå“åº” è®¾å¤‡æ§åˆ¶å‡ ä¹æ— å»¶è¿Ÿ ğŸ”Œ å¹¿æ³›å…¼å®¹ æ”¯æŒ 1000+ ç§è®¾å¤‡å’ŒæœåŠ¡ å…¼å®¹ä¸»æµæ™ºèƒ½å®¶å±…å“ç‰Œ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Home Assistant 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 mkdir -p /mnt/mydisk/home/homeassistant \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: homeassistant: container_name: homeassistant image: ghcr.io/home-assistant/home-assistant:stable restart: always network_mode: host volumes: - ./config:/config - /etc/localtime:/etc/localtime:ro environment: - TZ=Asia/Shanghai EOF âš ï¸ æ³¨æ„ï¼šHome Assistant ä½¿ç”¨ network_mode: host ä»¥ä¾¿æ›´å¥½åœ°å‘ç°å’Œæ§åˆ¶æœ¬åœ°ç½‘ç»œä¸­çš„è®¾å¤‡ã€‚\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Home Assistant 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8123 åŸŸåè®¿é—®ï¼š https://homeassistant.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·å’Œè®¾ç½®å¯†ç  è®¾ç½®å®¶åº­åç§°ã€ä½ç½®å’Œæ—¶åŒºç­‰ä¿¡æ¯ å¼€å§‹æ·»åŠ å’Œé…ç½®æ™ºèƒ½è®¾å¤‡ åˆ›å»ºè‡ªåŠ¨åŒ–è§„åˆ™å’Œåœºæ™¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://homeassistant.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/homeassistant.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name homeassistant.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8123; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ  å¯èˆªæ™ºèƒ½ï¼ŒæŒæ§æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Home Assistant æ™ºèƒ½å®¶å±…ç³»ç»Ÿï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¤– ç»Ÿä¸€æ§åˆ¶ åœ¨ä¸€ä¸ªå¹³å°ä¸Šé›†æˆå’Œç®¡ç†æ‰€æœ‰æ™ºèƒ½è®¾å¤‡ï¼Œå‘Šåˆ«ç¢ç‰‡åŒ–çš„æ§åˆ¶ä½“éªŒ\nğŸ”’ éšç§ä¿æŠ¤ æœ¬åœ°åŒ–è¿è¡Œç¡®ä¿ä½ çš„å®¶åº­æ•°æ®ä¸ä¼šä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹äº‘æœåŠ¡\nâš¡ æ™ºèƒ½è‡ªåŠ¨åŒ– åˆ›å»ºå¤æ‚çš„è‡ªåŠ¨åŒ–åœºæ™¯ï¼Œè®©å®¶å±…è®¾å¤‡æ™ºèƒ½å“åº”ä½ çš„ç”Ÿæ´»æ¨¡å¼\nğŸŒ è¿œç¨‹è®¿é—® éšæ—¶éšåœ°é€šè¿‡å®‰å…¨è¿æ¥æ§åˆ¶å®¶ä¸­çš„æ™ºèƒ½è®¾å¤‡\næ™ºèƒ½å®¶å±…ä¸ä»…æ˜¯ç§‘æŠ€çš„å±•ç¤ºï¼Œæ›´æ˜¯ç”Ÿæ´»å“è´¨çš„æå‡ã€‚æ„¿ Home Assistant æˆä¸ºä½ æ™ºèƒ½å®¶å±…ç”Ÿæ€çš„æ ¸å¿ƒï¼Œè®©ç§‘æŠ€çœŸæ­£æœåŠ¡äºä½ çš„æ—¥å¸¸ç”Ÿæ´»ï¼Œåˆ›é€ æ›´åŠ èˆ’é€‚ã€ä¾¿æ·ã€å®‰å…¨çš„å®¶å±…ç¯å¢ƒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ‰“é€ å±äºä½ è‡ªå·±çš„æ™ºèƒ½å®¶å±…ç³»ç»Ÿï¼Œè®©å®¶æ›´æ‡‚ä½ ï¼ğŸ’¡\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Home Assistant å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸é›†æˆæ”¯æŒã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ ç¤¾åŒºè®ºå› å¯»æ±‚å¸®åŠ©ã€‚\nç¥ä½ æ™ºèƒ½å®¶å±…ä¹‹æ—…æ„‰å¿«ï¼Œç”Ÿæ´»æ›´æ™ºèƒ½ï¼ğŸ‰\n","date":"2024-12-07T20:47:33+08:00","image":"https://file.meimolihan.eu.org/img/homeassistant-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c7be727e/","title":"Docker éƒ¨ç½² Home Assistant æ™ºèƒ½å®¶å±…ç³»ç»Ÿ ğŸ "},{"content":"åå…­è¿›åˆ¶é¢œè‰²ä»£ç å¤§å…¨ ğŸ¨ Halo åšå®¢æ— æ³•é¢„è§ˆé¢œè‰²ï¼Œè¯·ç§»æ­¥é•œåƒç«™ Hexo åšå®¢ âœ¨ ç›®å½• âœ¨ è‰²å½©ä½¿ç”¨åŸåˆ™ ğŸ”´ çº¢è‰²ç³» - æ¿€æƒ…ä¸è­¦å‘Š ğŸŸ  æ©™è‰²ç³» - æ´»åŠ›ä¸æ³¨æ„ ğŸŸ¡ é»„è‰²ç³» - æ˜äº®ä¸æç¤º ğŸŸ¢ ç»¿è‰²ç³» - æˆåŠŸä¸è‡ªç„¶ ğŸ”µ é’è‰²ç³» - æ¸…æ–°ä¸å†·é™ ğŸ”· è“è‰²ç³» - ä¿¡ä»»ä¸ç¨³å®š ğŸŸ£ ç´«è‰²ç³» - å¥¢åä¸åˆ›æ„ ğŸ’– ç²‰è‰²ç³» - æ¸©æŸ”ä¸æµªæ¼« âšª ç™½è‰²ç³» - çº¯å‡€ä¸ç®€æ´ âš« ç°è‰²ç³» - ä¸­æ€§ä¸å¹³è¡¡ ğŸŸ¤ æ£•è‰²ç³» - æ¸©æš–ä¸è‡ªç„¶ ğŸ¨ ä½¿ç”¨å»ºè®® ğŸš€ ä½¿ç”¨æŠ€å·§ âœ¨ è‰²å½©ä½¿ç”¨åŸåˆ™ è®¾è®¡åŸºç¡€åŸåˆ™ ğŸ¯ ä¸€è‡´æ€§ - åœ¨æ•´ä¸ªé¡¹ç›®ä¸­ä¿æŒé¢œè‰²ä½¿ç”¨çš„ä¸€è‡´æ€§ ğŸ‘ï¸ å¯è®¿é—®æ€§ - ç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦ç¬¦åˆ WCAG 2.1 æ ‡å‡† ğŸ¨ è¯­ä¹‰åŒ– - ä½¿ç”¨é¢œè‰²ä¼ è¾¾æ˜ç¡®çš„å«ä¹‰å’Œä¿¡æ¯ âš–ï¸ é€‚åº¦æ€§ - é¿å…è¿‡åº¦ä½¿ç”¨é²œè‰³é¢œè‰²é€ æˆè§†è§‰ç–²åŠ³ ğŸ“± å“åº”å¼ - åœ¨ä¸åŒè®¾å¤‡ä¸Šæµ‹è¯•é¢œè‰²æ˜¾ç¤ºæ•ˆæœ å¯¹æ¯”åº¦æ£€æŸ¥æ ‡å‡† æ–‡æœ¬å¤§å° AA æ ‡å‡† AAA æ ‡å‡† æ­£å¸¸æ–‡æœ¬ 4.5:1 7:1 å¤§æ–‡æœ¬ 3:1 4.5:1 è‰²å½©å¿ƒç†å­¦ç®€è¦æŒ‡å— ğŸ”´ çº¢è‰²: ç´§æ€¥ã€æ¿€æƒ…ã€å±é™©ã€é‡è¦ ğŸŸ  æ©™è‰²: æ´»åŠ›ã€æ¸©æš–ã€å‹å¥½ã€åˆ›æ„ ğŸŸ¡ é»„è‰²: å¿«ä¹ã€è­¦ç¤ºã€èƒ½é‡ã€ä¹è§‚ ğŸŸ¢ ç»¿è‰²: æˆåŠŸã€è‡ªç„¶ã€å®‰å…¨ã€æˆé•¿ ğŸ”µ è“è‰²: ä¿¡ä»»ã€ç¨³å®šã€ä¸“ä¸šã€å†·é™ ğŸŸ£ ç´«è‰²: å¥¢åã€åˆ›æ„ã€ç¥ç§˜ã€æ™ºæ…§ âš« é»‘ç™½ç°: ä¸­æ€§ã€ä¸“ä¸šã€ç®€æ´ã€ç°ä»£ ğŸŒˆ é¢œè‰²åˆ†ç±»æŒ‡å— ğŸ”´ çº¢è‰²ç³» - æ¿€æƒ…ä¸è­¦å‘Š çº¢è‰²ç³»é¢œè‰²å¸¸ç”¨äºè¡¨ç¤ºé‡è¦è­¦å‘Šã€é”™è¯¯æç¤ºæˆ–éœ€è¦ç«‹å³æ³¨æ„çš„å†…å®¹ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” æµ…ä¸‰æ–‡é±¼ #FFA07A æŸ”å’Œæé†’ ä¸‰æ–‡é±¼ #FA8072 æ¬¡è¦è­¦å‘Š é»‘é²‘ #E9967A ä¸­ç­‰è­¦å‘Š è½»çŠç‘š #F08080 è½»å¾®è­¦å‘Š å°ç¬¬å®‰çº¢ #CD5C5C é‡è¦æç¤º èµ¤çº¢ #DC143C ä¸¥é‡è­¦å‘Š è€ç«ç – #B22222 é”™è¯¯æç¤º çº¢è‰² #FF0000 ç´§æ€¥è­¦å‘Š æ·±çº¢ #8B0000 æœ€é«˜çº§åˆ«è­¦å‘Š ğŸŸ  æ©™è‰²ç³» - æ´»åŠ›ä¸æ³¨æ„ æ©™è‰²ç³»é€‚åˆç”¨äºå¸å¼•æ³¨æ„åŠ›ï¼Œè¡¨ç¤ºéœ€è¦æ³¨æ„ä½†éç´§æ€¥çš„å†…å®¹ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” çŠç‘š #FF7F50 æ¸©å’Œæé†’ ç•ªèŒ„ #FF6347 æ³¨æ„äº‹é¡¹ æ©™çº¢è‰² #FF4500 é‡è¦æç¤º é‡‘ #FFD700 è­¦å‘Šæ¡†é¦–é€‰ æ©™å­ #FFA500 ä¸€èˆ¬è­¦å‘Š æ·±æ©™è‰² #FF8C00 ä¸­åº¦è­¦å‘Š ğŸŸ¡ é»„è‰²ç³» - æ˜äº®ä¸æç¤º é»„è‰²ç³»é€‚åˆç”¨äºæç¤ºã€æ³¨æ„æˆ–é«˜äº®æ˜¾ç¤ºå†…å®¹ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” æµ…é»„è‰² #FFFFE0 æŸ”å’Œæç¤º æŸ æª¬é›ªçºº #FFFACD è½»å¾®æç¤º æµ…é‡‘é»„è‰² #FAFAD2 ä¸€èˆ¬æç¤º æœ¨ç“œé­ #FFEFD5 æ¸©é¦¨æé†’ è«å¡è¾› #FFE4B5 ä¸­æ€§æç¤º æ¡ƒæ‰‘ #FFDAB9 å‹å¥½æç¤º æ·¡é‡‘é»„è‰² #EEE8AA è½»åº¦è­¦å‘Š é»„è¤è‰² #F0E68C ä¸€èˆ¬è­¦å‘Š é»‘è‰²å¡å…¶è‰² #BDB76B ä¸­åº¦è­¦å‘Š é»„è‰² #FFFF00 æ˜æ˜¾è­¦å‘Š ğŸŸ¢ ç»¿è‰²ç³» - æˆåŠŸä¸è‡ªç„¶ ç»¿è‰²ç³»å¸¸ç”¨äºè¡¨ç¤ºæˆåŠŸã€å®ŒæˆçŠ¶æ€æˆ–ä¸è‡ªç„¶ç›¸å…³çš„å†…å®¹ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” è‰åªç»¿ #7CFC00 æˆåŠŸæç¤º é»„ç»¿è‰² #7FFF00 ç§¯æåé¦ˆ æŸ æª¬ç»¿ #32CD32 æˆåŠŸå®Œæˆ é…¸æ©™ #00FF00 é«˜äº®æˆåŠŸ æ£®æ—ç»¿ #228B22 æ­£æ–‡å¼ºè°ƒ ç»¿è‰² #008000 ä¸€èˆ¬æˆåŠŸ æ·±ç»¿è‰² #006400 æ·±è‰²æˆåŠŸæç¤º é»„ç»¿è‰² #ADFF2F æ–°é²œå†…å®¹ é»„ç»¿è‰² #9ACD32 æ›´æ–°æç¤º æ˜¥ç»¿è‰² #00FF7F æ–°åŠŸèƒ½ ğŸ”µ é’è‰²ç³» - æ¸…æ–°ä¸å†·é™ é’è‰²ç³»é¢œè‰²ç»™äººä¸€ç§æ¸…æ–°ã€å†·é™çš„æ„Ÿè§‰ï¼Œé€‚åˆç”¨äºç§‘æŠ€ã€åŒ»ç–—æˆ–æ°´ç›¸å…³ä¸»é¢˜çš„è®¾è®¡ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” æµ…è“ #E0FFFF æŸ”å’ŒèƒŒæ™¯ é’è‰²/æ°´è‰² #00FFFF é«˜äº®æ˜¾ç¤º è“æ™¶ #7FFFD4 æ¸…æ–°å…ƒç´  æµ·è“å®çŸ³ #66CDAA æµ·æ´‹ä¸»é¢˜ æµ…ç»¿è‰² #AFEEEE æŸ”å’Œæç¤º ç»¿æ¾çŸ³ #40E0D0 é†’ç›®å…ƒç´  ä¸­ç»¿æ¾çŸ³ #48D1CC å¹³è¡¡è®¾è®¡ æ·±è“ç»¿ #00CED1 æ·±åº¦å…ƒç´  æµ…æµ·ç»¿ #20B2AA æµ·æ´‹ä¸»é¢˜ å†›æ ¡è“ #5F9EA0 ä¸“ä¸šè®¾è®¡ æ·±é’ #008B8B é‡ç‚¹å†…å®¹ è“ç»¿ #008080 ç¨³é‡è®¾è®¡ ğŸ”· è“è‰²ç³» - ä¿¡ä»»ä¸ç¨³å®š è“è‰²ç³»ä¼ è¾¾ä¿¡ä»»ã€ç¨³å®šå’Œä¸“ä¸šæ„Ÿï¼Œæ˜¯ä¼ä¸šã€ç§‘æŠ€å’Œé‡‘èé¢†åŸŸå¸¸ç”¨çš„é¢œè‰²ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” ç²‰è“è‰² #B0E0E6 æŸ”å’ŒèƒŒæ™¯ æµ…è“ #ADD8E6 æ¸…æ–°ç•Œé¢ å¤©è“è‰² #87CEFA å¤©ç©ºä¸»é¢˜ å¤©è“è‰² #87CEEB æ˜äº®å…ƒç´  æ·±å¤©è“ #00BFFF é†’ç›®æŒ‰é’® äº®é’¢è“ #B0C4DE ä¸“ä¸šç•Œé¢ é“å¥‡è“ #1E90FF é“¾æ¥é¢œè‰² çŸ¢è½¦èŠè“ #6495ED æ¸©å’Œå¼ºè°ƒ é’¢è“ #4682B4 ä¼ä¸šè®¾è®¡ å®è“ #4169E1 çš‡å®¶é£æ ¼ çº¯è“ #0000FF ä¼ ç»Ÿè“è‰² ä¸­è“ #0000CD ä¸­ç­‰å¼ºè°ƒ æ·±è“ #00008B æ·±åº¦å…ƒç´  æµ·å†›è“ #000080 æ­£å¼è®¾è®¡ åˆå¤œè“ #191970 æ·±è‰²èƒŒæ™¯ ä¸­çŸ³æ¿è“ #7B68EE ç´«è‰²è°ƒè“ çŸ³æ¿è“ #6A5ACD æ¸©å’Œç´«è‰²è“ æ·±çŸ³æ¿è“ #483D8B æ·±åº¦è“ç´« ğŸŸ£ ç´«è‰²ç³» - å¥¢åä¸åˆ›æ„ ç´«è‰²ç³»ä¼ è¾¾å¥¢åã€åˆ›æ„å’Œç¥ç§˜æ„Ÿï¼Œé€‚åˆè‰ºæœ¯ã€ç¾å®¹å’Œé«˜æ¡£å“ç‰Œè®¾è®¡ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” è–°è¡£è‰ #E6E6FA æŸ”å’ŒèƒŒæ™¯ è“Ÿ #D8BFD8 æ·¡ç´«è‰²è°ƒ æå­ #DDA0DD æ¸©å’Œç´«è‰² ç´«ç½—å…° #EE82EE é†’ç›®å…ƒç´  å…°èŠ± #DA70D6 å¥³æ€§è®¾è®¡ æ´‹çº¢/ç´«çº¢ #FF00FF é«˜å¯¹æ¯”åº¦ ä¸­å…°èŠ± #BA55D3 å¹³è¡¡ç´«è‰² ä¸­ç´«è‰² #9370DB é€šç”¨ç´«è‰² è“ç´« #8A2BE2 é†’ç›®å¼ºè°ƒ æš—ç´« #9400D3 æ·±åº¦ç´«è‰² æš—å…°èŠ± #9932CC ç´«è‰²å¼ºè°ƒ æ·±æ´‹çº¢ #8B008B æ·±è‰²èƒŒæ™¯ ç´«è‰² #800080 ç»å…¸ç´«è‰² é›é’ #4B0082 æœ€æ·±ç´«è‰² ğŸ’– ç²‰çº¢è‰²ç³» - æ¸©æŸ”ä¸æµªæ¼« ç²‰çº¢è‰²ç³»ä¼ è¾¾æ¸©æŸ”ã€æµªæ¼«å’Œå¥³æ€§åŒ–çš„æ„Ÿè§‰ï¼Œé€‚åˆç¾å®¹ã€æ—¶å°šå’Œçˆ±æƒ…ä¸»é¢˜è®¾è®¡ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” ç²‰è‰² #FFC0CB æŸ”å’ŒèƒŒæ™¯ æµ…ç²‰çº¢ #FFB6C1 æ¸©æŸ”å…ƒç´  äº®ç²‰çº¢ #FF69B4 é†’ç›®å¼ºè°ƒ æ·±ç²‰çº¢ #FF1493 å¼ºçƒˆå¼ºè°ƒ æµ…ç´«çº¢ #DB7093 æŸ”å’Œç´«ç²‰ ä¸­ç´«çº¢ #C71585 æ·±åº¦ç²‰ç´« âšª ç™½è‰²ç³» - çº¯å‡€ä¸ç®€æ´ ç™½è‰²ç³»é¢œè‰²æä¾›çº¯å‡€ã€ç®€æ´çš„èƒŒæ™¯ï¼Œé€‚åˆç”¨äºå†…å®¹å±•ç¤ºå’Œåˆ›é€ ç©ºé—´æ„Ÿã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” çº¯ç™½ #FFFFFF ä¸»è¦èƒŒæ™¯ é›ªç™½ #FFFAFA æŸ”å’ŒèƒŒæ™¯ ç”˜éœ²ç™½ #F0FFF0 æ·¡ç»¿è°ƒç™½ è–„è·ç™½ #F5FFFA æ·¡é’è°ƒç™½ å¤©è“ç™½ #F0FFFF æ·¡è“è°ƒç™½ çˆ±ä¸½ä¸è“ #F0F8FF ææ·¡è“è‰² å¹½çµç™½ #F8F8FF æ·¡ç´«è°ƒç™½ çƒŸç™½ #F5F5F5 æ¬¡èƒŒæ™¯è‰² è´å£³ç™½ #FFF5EE æ·¡ç²‰è°ƒç™½ ç±³è‰² #F5F5DC æ¸©æš–èƒŒæ™¯ è€èŠ±è¾¹ #FDF5E6 å¤å¤èƒŒæ™¯ èŠ±ç™½ #FFFAF0 æŸ”å’ŒèƒŒæ™¯ è±¡ç‰™ç™½ #FFFFF0 æ·¡é»„è°ƒç™½ å¤è‘£ç™½ #FAEBD7 æ¸©æš–ç™½ éº»å¸ƒç™½ #FAF0E6 è‡ªç„¶èƒŒæ™¯ è–°è¡£è‰è…®çº¢ #FFF0F5 æ·¡ç²‰çº¢ è¿·é›¾ç«ç‘° #FFE4E1 æ·¡ç«ç‘°è‰² âš« ç°è‰²ç³» - ä¸­æ€§ä¸å¹³è¡¡ ç°è‰²ç³»æä¾›ä¸­æ€§çš„èƒŒæ™¯å’Œæ–‡æœ¬é¢œè‰²ï¼Œé€‚åˆåˆ›é€ å±‚æ¬¡æ„Ÿå’Œä¸“ä¸šæ„Ÿã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” æ©æ–¯ä¼¯å‹’ç° #DCDCDC æ·¡ç°èƒŒæ™¯ æµ…ç° #D3D3D3 æ¬¡è¦èƒŒæ™¯ é“¶ç° #C0C0C0 è¾¹æ¡†åˆ†éš” æ·±ç° #A9A9A9 æ¬¡è¦æ–‡æœ¬ æ ‡å‡†ç° #808080 æ­£æ–‡æ–‡æœ¬ æš—ç° #696969 å¼ºè°ƒæ–‡æœ¬ æµ…çŸ³æ¿ç° #778899 è“ç°è‰²è°ƒ çŸ³æ¿ç° #708090 ä¸“ä¸šç°è‰² æ·±çŸ³æ¿ç° #2F4F4F æ·±è‰²èƒŒæ™¯ çº¯é»‘ #000000 ä¸»è¦æ–‡æœ¬ ğŸŸ¤ æ£•è‰²ç³» - æ¸©æš–ä¸è‡ªç„¶ æ£•è‰²ç³»ä¼ è¾¾æ¸©æš–ã€è‡ªç„¶å’Œç¨³é‡çš„æ„Ÿè§‰ï¼Œé€‚åˆè‡ªç„¶ã€ä¼ ç»Ÿå’Œèˆ’é€‚ä¸»é¢˜çš„è®¾è®¡ã€‚\né¢„è§ˆ é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  æ¨èç”¨é€” ç‰ç±³ä¸ #FFF8DC æ·¡é»„èƒŒæ™¯ æä»ç™½ #FFEBCD æ¸©æš–èƒŒæ™¯ æµ“æ±¤è‰² #FFE4C4 æ·¡æ©™èƒŒæ™¯ çº³ç“¦éœç™½ #FFDEAD æ¸©æš–ç±³è‰² å°éº¦è‰² #F5DEB3 è‡ªç„¶èƒŒæ™¯ æµ…æ£•è‰² #DEB887 ä¸­ç­‰æ£•è‰² æ£•è¤è‰² #D2B48C ä¸­æ€§æ£•è‰² ç«ç‘°è¤ #BC8F8F ç²‰æ£•è‰²è°ƒ æ²™æ£•è‰² #F4A460 é†’ç›®æ£•è‰² é‡‘èŠè‰² #DAA520 é‡‘é»„æ£•è‰² ç§˜é²è‰² #CD853F æ¸©æš–æ£•è‰² å·§å…‹åŠ›è‰² #D2691E æ·±å·§å…‹åŠ› éæ£•è‰² #8B4513 æ·±æ£•è‰² èµ­è‰² #A0522D çº¢æ£•è‰² æ£•è‰² #A52A2A æ ‡å‡†æ£•è‰² æ —è‰² #800000 æ·±çº¢æ£•è‰² ğŸ¯ ä½¿ç”¨å»ºè®® ä¸€è‡´æ€§ - åœ¨æ•´ä¸ªé¡¹ç›®æˆ–æ–‡æ¡£ä¸­ä½¿ç”¨ä¸€è‡´çš„é¢œè‰²ç¼–ç ç³»ç»Ÿ å¯è®¿é—®æ€§ - ç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦ç¬¦åˆWCAGæ ‡å‡†ï¼Œä¾¿äºè‰²ç›²ç”¨æˆ·é˜…è¯» è¯­ä¹‰åŒ– - ä½¿ç”¨é¢œè‰²ä¼ è¾¾æ„ä¹‰ï¼ˆçº¢è‰²è¡¨ç¤ºè­¦å‘Šï¼Œç»¿è‰²è¡¨ç¤ºæˆåŠŸç­‰ï¼‰ é€‚åº¦ä½¿ç”¨ - é¿å…è¿‡åº¦ä½¿ç”¨é²œè‰³é¢œè‰²ï¼Œä»¥å…é€ æˆè§†è§‰ç–²åŠ³ æµ‹è¯• - åœ¨ä¸åŒè®¾å¤‡å’Œç…§æ˜æ¡ä»¶ä¸‹æµ‹è¯•é¢œè‰²æ˜¾ç¤ºæ•ˆæœ ğŸ”§ å®ç”¨æŠ€å·§ CSSä¸­ä½¿ç”¨é¢œè‰² 1 2 3 4 5 6 .warning-box { background-color: #FFD700; /* é‡‘è‰²èƒŒæ™¯ */ color: #8B0000; /* æ·±çº¢è‰²æ–‡å­— */ padding: 12px; border-radius: 5px; } Markdownä¸­ä½¿ç”¨é¢œè‰² 1 2 \u0026lt;span style=\u0026#34;color:#228B22;\u0026#34;\u0026gt;ç»¿è‰²æ–‡å­—\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;background-color:#FFD700; padding:5px;\u0026#34;\u0026gt;é»„è‰²èƒŒæ™¯\u0026lt;/span\u0026gt; å¸Œæœ›è¿™ä¸ªé¢œè‰²ä»£ç å¤§å…¨èƒ½å¸®åŠ©æ‚¨åœ¨è®¾è®¡å’Œå¼€å‘ä¸­é€‰æ‹©åˆé€‚çš„é¢œè‰²ï¼ğŸ¨\n","date":"2024-12-07T20:45:42+08:00","image":"https://file.meimolihan.eu.org/img/rgb-01.webp","permalink":"https://blog.meimolihan.eu.org/p/56223359/","title":"åå…­è¿›åˆ¶é¢œè‰²ä»£ç å¤§å…¨ ğŸ¨"},{"content":"Docker éƒ¨ç½²çˆ±ç›¼ç½‘ç›˜æœç´¢ ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²çˆ±ç›¼ç½‘ç›˜æœç´¢ 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨çˆ±ç›¼ç½‘ç›˜æœç´¢ 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. æœç´¢æŠ€å·§ ğŸ¯ 3. é«˜çº§åŠŸèƒ½ ğŸ”§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæœç´¢ï¼Œèµ„æºæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/unilei/aipan-netdisk-search ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/fooololo/aipan-netdisk-search/tags çˆ±ç›¼ç½‘ç›˜æœç´¢ æ˜¯ä¸€ä¸ªåŸºäº Docker çš„ç½‘ç›˜èµ„æºæœç´¢å¼•æ“ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€ŸæŸ¥æ‰¾å„ç±»ç½‘ç›˜å…±äº«èµ„æºã€‚é€šè¿‡ç®€å•çš„éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥æ­å»ºè‡ªå·±çš„ç½‘ç›˜æœç´¢æœåŠ¡ï¼Œæ–¹ä¾¿åœ°æŸ¥æ‰¾å’Œè®¿é—®ç½‘ç»œä¸Šçš„å…±äº«æ–‡ä»¶èµ„æºã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ” é«˜æ•ˆæœç´¢ å¿«é€Ÿæ£€ç´¢ç½‘ç›˜å…±äº«èµ„æº ç²¾å‡†å®šä½æ‰€éœ€æ–‡ä»¶ ğŸŒ Web ç•Œé¢ ç›´è§‚çš„æµè§ˆå™¨æ“ä½œç•Œé¢ æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œéšæ—¶éšåœ°è®¿é—® ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² ä½¿ç”¨ Docker ç®€åŒ–å®‰è£…å’Œç»´æŠ¤ ä¸€é”®éƒ¨ç½²ï¼Œå¿«é€Ÿä¸Šæ‰‹ âš¡ è½»é‡çº§ èµ„æºå ç”¨ä½ï¼Œè¿è¡Œç¨³å®š é€‚åˆå„ç§ç¡¬ä»¶ç¯å¢ƒ ğŸ”„ è‡ªåŠ¨æ›´æ–° æ”¯æŒå®šæœŸæ›´æ–°æœç´¢ç´¢å¼• ä¿æŒæœç´¢å†…å®¹æ–°é²œåº¦ ğŸ“± å“åº”å¼è®¾è®¡ é€‚é…å„ç§è®¾å¤‡å±å¹• æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘å‡å¯ä½¿ç”¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½²çˆ±ç›¼ç½‘ç›˜æœç´¢ 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mkdir -p /mnt/mydisk/home/aipan \u0026amp;\u0026amp; cd $_ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: aipan: image: fooololo/aipan-netdisk-search:latest container_name: aipan network_mode: bridge restart: unless-stopped ports: - 5055:3000 environment: - TZ=Asia/Shanghai logging: options: max-size: 5m max-file: \u0026#34;5\u0026#34; EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨çˆ±ç›¼ç½‘ç›˜æœç´¢ 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:5055 åŸŸåè®¿é—®: https://aipan.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. æœç´¢æŠ€å·§ ğŸ¯ åŸºç¡€æœç´¢\nåœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯ ç‚¹å‡»æœç´¢æŒ‰é’®æˆ–æŒ‰å›è½¦é”® ç²¾ç¡®æœç´¢\nä½¿ç”¨å…·ä½“æ–‡ä»¶åè¿›è¡Œç²¾ç¡®æœç´¢ å°è¯•ä½¿ç”¨ä¸åŒå…³é”®è¯ç»„åˆ ä½¿ç”¨å¼•å·è¿›è¡ŒçŸ­è¯­æœç´¢ æ–‡ä»¶ç±»å‹ç­›é€‰\nåˆ©ç”¨æ–‡ä»¶æ‰©å±•åç­›é€‰ç‰¹å®šç±»å‹æ–‡ä»¶ å¦‚ .pdf, .mp4, .zip ç­‰ 3. é«˜çº§åŠŸèƒ½ ğŸ”§ åŠŸèƒ½ æ“ä½œæ–¹å¼ è¯´æ˜ ğŸ“Š ç»“æœæ’åº æŒ‰ç›¸å…³åº¦/æ—¶é—´æ’åº ä¼˜åŒ–æœç´¢ç»“æœå±•ç¤º ğŸ” é«˜çº§ç­›é€‰ ä½¿ç”¨ç­›é€‰æ¡ä»¶ ç²¾ç¡®æŸ¥æ‰¾æ‰€éœ€èµ„æº ğŸ“ åˆ†ç±»æµè§ˆ æŒ‰æ–‡ä»¶ç±»å‹åˆ†ç±» å¿«é€Ÿæµè§ˆç‰¹å®šç±»å‹æ–‡ä»¶ â­ æ”¶è—åŠŸèƒ½ æ ‡è®°é‡è¦èµ„æº æ–¹ä¾¿åç»­å¿«é€Ÿè®¿é—® ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://aipan.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/aipan.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name aipan.example.com; # ğŸŒ æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ€§èƒ½ä¼˜åŒ– sendfile on; tcp_nopush on; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 10G; location / { proxy_pass http://localhost:5055; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_http_version 1.1; # è¶…æ—¶è®¾ç½® proxy_read_timeout 120s; proxy_connect_timeout 120s; # ç¼“å†²è®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; proxy_max_temp_file_size 0; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/aipan # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop aipan # åœæ­¢å®¹å™¨ docker start aipan # å¯åŠ¨å®¹å™¨ docker restart aipan # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm aipan # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f aipan # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it aipan bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ docker exec -it aipan sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect aipan # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats aipan # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs aipan # æŸ¥çœ‹æ—¥å¿— docker logs -f aipan # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 aipan # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t aipan # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæœç´¢ï¼Œèµ„æºæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†çˆ±ç›¼ç½‘ç›˜æœç´¢æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ” é«˜æ•ˆæ£€ç´¢ å¿«é€Ÿå®šä½å…¨ç½‘ç›˜èµ„æºï¼Œç²¾å‡†æ‰¾åˆ°æ‰€éœ€æ–‡ä»¶å†…å®¹\nğŸŒ ä¾¿æ·è®¿é—® é€šè¿‡å‹å¥½çš„ Web ç•Œé¢éšæ—¶éšåœ°æœç´¢å’Œè®¿é—®èµ„æº\nğŸ³ è½»æ¾ç»´æŠ¤ å®¹å™¨åŒ–éƒ¨ç½²ç®€åŒ–è¿ç»´ï¼Œè‡ªåŠ¨æ›´æ–°ä¿æŒæœåŠ¡ç¨³å®š\næœç´¢ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸ä¿¡æ¯èµ„æºç›¸ä¼´çš„å‘ç°æ—…ç¨‹ã€‚æ„¿çˆ±ç›¼ç½‘ç›˜æœç´¢æˆä¸ºä½ å¾—åŠ›çš„èµ„æºå‘ç°åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡ä¿¡æ¯è·å–å’Œèµ„æºæ•´ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ™ºèƒ½æœç´¢ï¼Œèµ„æºæ— å¿§â€”â€”æ„å»ºä½ é«˜æ•ˆä¾¿æ·çš„ä¿¡æ¯è·å–å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ çˆ±ç›¼ç½‘ç›˜æœç´¢å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æœç´¢é¡ºåˆ©ï¼Œèµ„æºä¸°å¯Œï¼ğŸ‰\n","date":"2024-12-07T20:42:44+08:00","image":"https://file.meimolihan.eu.org/img/aipan-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0e7ee7c0/","title":"Docker éƒ¨ç½²çˆ±ç›¼ç½‘ç›˜æœç´¢ ğŸ”"},{"content":"acme.sh + Cloudflare SSL è¯ä¹¦ç®¡ç† ğŸ” ğŸ” è‡ªåŠ¨åŒ–ç®¡ç†æ³›åŸŸå SSL è¯ä¹¦ï¼Œæ”¯æŒå¤šçº§å­åŸŸåå®‰å…¨åŠ å¯†\nâœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ acme.sh æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”è½»é‡çš„ ACME åè®®å®¢æˆ·ç«¯ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nğŸš€ å®Œå…¨è‡ªåŠ¨åŒ–ï¼šæ”¯æŒè¯ä¹¦è‡ªåŠ¨ç”³è¯·ã€æ›´æ–°å’Œéƒ¨ç½² ğŸ”’ å®‰å…¨å¯é ï¼šæ”¯æŒ ECCã€RSA å¤šç§å¯†é’¥ç±»å‹ï¼Œé›†æˆ OCSP Stapling ğŸŒ å¤šåŸŸåæ”¯æŒï¼šæ”¯æŒæ³›åŸŸåè¯ä¹¦å’Œå¤šåŸŸå SAN è¯ä¹¦ ğŸ“¦ æ˜“äºéƒ¨ç½²ï¼šä¸€é”®å®‰è£…ï¼Œç®€å•é…ç½®å³å¯ä½¿ç”¨ ğŸ”„ æŒç»­ç»´æŠ¤ï¼šæ´»è·ƒçš„å¼€æºç¤¾åŒºï¼Œå®šæœŸæ›´æ–°å’Œç»´æŠ¤ ğŸ›¡ï¸ é›¶ä¾èµ–ï¼šçº¯ Shell ç¼–å†™ï¼Œæ— éœ€é¢å¤–ä¾èµ–ç¯å¢ƒ ğŸ’¡ å¤šæ¨¡å¼éªŒè¯ï¼šæ”¯æŒ DNSã€HTTPã€TLS-ALPN ç­‰å¤šç§éªŒè¯æ–¹å¼ ğŸ“– ç›®å½•å¯¼èˆª ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ“¦ acme.sh å®‰è£… ğŸ”‘ Cloudflare API é…ç½® ğŸ“ è¯ä¹¦ç”³è¯· ğŸ“ è¯ä¹¦éƒ¨ç½² âš¡ è‡ªåŠ¨ç»´æŠ¤ ğŸ”§ æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µ ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸŒŸ ä¸€ç«™å¼å®‰è£…è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/bin/bash # ğŸš€ acme.sh å¿«é€Ÿå®‰è£…å’Œé…ç½®è„šæœ¬ echo \u0026#34;å¼€å§‹å®‰è£… acme.sh...\u0026#34; curl https://get.acme.sh | sh -s email=meimolihan@live.com echo \u0026#34;é…ç½®ç¯å¢ƒ...\u0026#34; source ~/.bashrc alias acme.sh=~/.acme.sh/acme.sh echo \u0026#34;è®¾ç½®é»˜è®¤ CA...\u0026#34; acme.sh --set-default-ca --server letsencrypt echo \u0026#34;å®‰è£…å®Œæˆï¼ç‰ˆæœ¬ä¿¡æ¯ï¼š\u0026#34; acme.sh -v ğŸ“¦ acme.sh å®‰è£… ğŸ§ å®‰è£…æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 # æ–¹æ³•ä¸€ï¼šå›½é™…æºå®‰è£…ï¼ˆæ¨èï¼‰ curl https://get.acme.sh | sh -s email=meimolihan@live.com # æ–¹æ³•äºŒï¼šå›½å†…æºå®‰è£… curl https://gitcode.net/cert/cn-acme.sh/-/raw/master/install.sh?inline=false | sh -s email=meimolihan@live.com # æ–¹æ³•ä¸‰ï¼šGit å…‹éš†å®‰è£… git clone --depth 1 https://github.com/acmesh-official/acme.sh.git cd acme.sh ./acme.sh --install -m meimolihan@live.com ğŸ”§ å®‰è£…åé…ç½® 1 2 3 4 5 6 7 8 9 10 11 # é‡æ–°åŠ è½½ Shell é…ç½® source ~/.bashrc # åˆ›å»ºåˆ«åæ–¹ä¾¿ä½¿ç”¨ alias acme.sh=~/.acme.sh/acme.sh # éªŒè¯å®‰è£… acme.sh -v # è®¾ç½®è‡ªåŠ¨å‡çº§ acme.sh --upgrade --auto-upgrade ğŸ¯ æ”¯æŒçš„è¯ä¹¦é¢å‘æœºæ„ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„ CA acme.sh --list-server # è®¾ç½®é»˜è®¤ CA acme.sh --set-default-ca --server letsencrypt # Let\u0026#39;s Encrypt acme.sh --set-default-ca --server buypass # Buypass acme.sh --set-default-ca --server zerossl # ZeroSSL acme.sh --set-default-ca --server ssl.com # SSL.com acme.sh --set-default-ca --server google # Google Public CA ğŸ”‘ Cloudflare API é…ç½® ğŸŒ è·å– Cloudflare API Token ç™»å½• Cloudflare: https://dash.cloudflare.com/ è¿›å…¥ API Tokens: å³ä¸Šè§’ç”¨æˆ·å›¾æ ‡ â†’ My Profile â†’ API Tokens åˆ›å»º Token: ä½¿ç”¨æ¨¡æ¿ \u0026ldquo;Edit zone DNS\u0026rdquo; æƒé™: Zone - DNS - Edit èµ„æº: Include - All zones (æˆ–æŒ‡å®šåŸŸå) ä¿å­˜ Token: å¤åˆ¶ç”Ÿæˆçš„ API Token ğŸ“ é…ç½®ç¯å¢ƒå˜é‡ 1 2 3 4 5 6 7 8 9 # è®¾ç½® Cloudflare API Token export CF_Token=\u0026#34;your_cloudflare_api_token_here\u0026#34; # å¯é€‰ï¼šè®¾ç½® Zone IDï¼ˆå¦‚æœç®¡ç†å¤šä¸ªåŒºåŸŸï¼‰ export CF_Zone_ID=\u0026#34;your_zone_id_here\u0026#34; # éªŒè¯é…ç½® echo \u0026#34;CF_Token: $CF_Token\u0026#34; echo \u0026#34;CF_Zone_ID: $CF_Zone_ID\u0026#34; ğŸ”’ å®‰å…¨é…ç½®å»ºè®® 1 2 3 4 5 6 7 8 9 # åˆ›å»ºä¸“ç”¨é…ç½®æ–‡ä»¶ mkdir -p ~/.acme.sh/conf cat \u0026gt; ~/.acme.sh/conf/cloudflare.env \u0026lt;\u0026lt; EOF CF_Token=\u0026#34;your_cloudflare_api_token_here\u0026#34; CF_Zone_ID=\u0026#34;your_zone_id_here\u0026#34; EOF # è®¾ç½®ä¸¥æ ¼æƒé™ chmod 600 ~/.acme.sh/conf/cloudflare.env ğŸ“ è¯ä¹¦ç”³è¯· ğŸ¯ ç”³è¯·æ³›åŸŸåè¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 11 # ç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼ˆæ”¯æŒå¤šçº§å­åŸŸåï¼‰ acme.sh --issue --dns dns_cf \\ -d \u0026#34;mobufan.eu.org\u0026#34; \\ -d \u0026#34;*.mobufan.eu.org\u0026#34; \\ --keylength ec-256 # ä½¿ç”¨ RSA å¯†é’¥ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰ acme.sh --issue --dns dns_cf \\ -d \u0026#34;mobufan.eu.org\u0026#34; \\ -d \u0026#34;*.mobufan.eu.org\u0026#34; \\ --keylength 2048 ğŸ“Š ç”³è¯·å¤šä¸ªåŸŸå 1 2 3 4 5 6 7 # åŒæ—¶ç”³è¯·å¤šä¸ªåŸŸåè¯ä¹¦ acme.sh --issue --dns dns_cf \\ -d \u0026#34;example.com\u0026#34; \\ -d \u0026#34;*.example.com\u0026#34; \\ -d \u0026#34;test.org\u0026#34; \\ -d \u0026#34;*.test.org\u0026#34; \\ --keylength ec-256 ğŸ” è°ƒè¯•æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 # å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†è¿‡ç¨‹ acme.sh --issue --dns dns_cf \\ -d \u0026#34;mobufan.eu.org\u0026#34; \\ -d \u0026#34;*.mobufan.eu.org\u0026#34; \\ --debug # æ›´è¯¦ç»†çš„è°ƒè¯• acme.sh --issue --dns dns_cf \\ -d \u0026#34;mobufan.eu.org\u0026#34; \\ -d \u0026#34;*.mobufan.eu.org\u0026#34; \\ --debug 2 ğŸ“ è¯ä¹¦éƒ¨ç½² ğŸ—‚ï¸ åˆ›å»ºè¯ä¹¦ç›®å½• 1 2 3 4 5 6 7 # åˆ›å»º Nginx è¯ä¹¦ç›®å½• sudo mkdir -p /etc/nginx/ssl sudo chmod 755 /etc/nginx/ssl # åˆ›å»ºå…¶ä»–æœåŠ¡è¯ä¹¦ç›®å½• sudo mkdir -p /etc/ssl/private sudo chmod 700 /etc/ssl/private ğŸ“‹ å®‰è£…è¯ä¹¦åˆ° Nginx 1 2 3 4 5 6 7 8 9 # å®‰è£…è¯ä¹¦å¹¶è®¾ç½®è‡ªåŠ¨é‡è½½ acme.sh --install-cert -d mobufan.eu.org \\ --key-file /etc/nginx/ssl/key.pem \\ --fullchain-file /etc/nginx/ssl/cert.pem \\ --reloadcmd \u0026#34;systemctl reload nginx\u0026#34; # éªŒè¯è¯ä¹¦å®‰è£… ls -la /etc/nginx/ssl/ openssl x509 -in /etc/nginx/ssl/cert.pem -noout -text ğŸ”„ å¤šæœåŠ¡éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 # éƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡ acme.sh --install-cert -d mobufan.eu.org \\ --key-file /etc/nginx/ssl/key.pem \\ --fullchain-file /etc/nginx/ssl/cert.pem \\ --reloadcmd \u0026#34;systemctl reload nginx\u0026#34; acme.sh --install-cert -d mobufan.eu.org \\ --key-file /etc/apache2/ssl/key.pem \\ --fullchain-file /etc/apache2/ssl/cert.pem \\ --reloadcmd \u0026#34;systemctl reload apache2\u0026#34; ğŸ“Š è¯ä¹¦æ ¼å¼è½¬æ¢ 1 2 3 4 5 6 7 8 9 10 # è½¬æ¢ä¸º PKCS12 æ ¼å¼ï¼ˆç”¨äº Java åº”ç”¨ï¼‰ openssl pkcs12 -export \\ -in /etc/nginx/ssl/cert.pem \\ -inkey /etc/nginx/ssl/key.pem \\ -out /etc/nginx/ssl/cert.p12 \\ -passout pass:password # è½¬æ¢ä¸º DER æ ¼å¼ openssl x509 -in /etc/nginx/ssl/cert.pem \\ -outform der -out /etc/nginx/ssl/cert.der âš¡ è‡ªåŠ¨ç»´æŠ¤ ğŸ• è‡ªåŠ¨ç»­ç­¾é…ç½® 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰è®¡åˆ’ä»»åŠ¡ crontab -l # æ·»åŠ è‡ªåŠ¨ç»­ç­¾ä»»åŠ¡ (crontab -l; echo \u0026#39;0 0 * * * \u0026#34;/root/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/root/.acme.sh\u0026#34; \u0026gt; /dev/null\u0026#39;) | crontab - # éªŒè¯è®¡åˆ’ä»»åŠ¡ crontab -l | grep acme ğŸ“‹ è¯ä¹¦ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦ acme.sh --list # æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯ acme.sh --info -d mobufan.eu.org # æ‰‹åŠ¨ç»­ç­¾è¯ä¹¦ acme.sh --renew -d mobufan.eu.org --force # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ openssl x509 -in /etc/nginx/ssl/cert.pem -noout -dates # æ’¤é”€è¯ä¹¦ acme.sh --remove -d mobufan.eu.org acme.sh --revoke -d mobufan.eu.org ğŸ”„ æ›´æ–°å’Œç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–° acme.sh acme.sh --upgrade # å…³é—­è‡ªåŠ¨æ›´æ–° acme.sh --upgrade --auto-upgrade 0 # é‡æ–°å¯ç”¨è‡ªåŠ¨æ›´æ–° acme.sh --upgrade --auto-upgrade 1 # å¸è½½ acme.sh acme.sh --uninstall ğŸ”§ æ•…éšœæ’é™¤ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1. DNS éªŒè¯å¤±è´¥ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ DNS è®°å½• dig TXT _acme-challenge.mobufan.eu.org # æ‰‹åŠ¨éªŒè¯ DNS nslookup -type=TXT _acme-challenge.mobufan.eu.org # æ£€æŸ¥ Cloudflare API è¿æ¥ curl -X GET \u0026#34;https://api.cloudflare.com/client/v4/zones\u0026#34; \\ -H \u0026#34;Authorization: Bearer $CF_Token\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; 2. æƒé™é—®é¢˜ 1 2 3 4 5 6 7 # ä¿®å¤è¯ä¹¦æ–‡ä»¶æƒé™ sudo chmod 644 /etc/nginx/ssl/cert.pem sudo chmod 600 /etc/nginx/ssl/key.pem sudo chown root:root /etc/nginx/ssl/*.pem # ä¿®å¤ acme.sh ç›®å½•æƒé™ chmod 700 ~/.acme.sh/ 3. ç»­ç­¾å¤±è´¥ 1 2 3 4 5 6 7 8 # å¼ºåˆ¶ç»­ç­¾ acme.sh --renew -d mobufan.eu.org --force # è°ƒè¯•æ¨¡å¼ç»­ç­¾ acme.sh --renew -d mobufan.eu.org --debug # æ£€æŸ¥æ—¥å¿— tail -f ~/.acme.sh/acme.sh.log ğŸ“Š ç›‘æ§å’Œæ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹ acme.sh æ—¥å¿— tail -f ~/.acme.sh/acme.sh.log # æŸ¥çœ‹è¯ä¹¦çŠ¶æ€ acme.sh --list # ç›‘æ§è¯ä¹¦è¿‡æœŸ openssl x509 -in /etc/nginx/ssl/cert.pem -noout -dates # è®¾ç½®ç›‘æ§å‘Šè­¦ #!/bin/bash EXPIRY_DAYS=$(openssl x509 -in /etc/nginx/ssl/cert.pem -checkend 864000 | grep -c \u0026#34;will expire\u0026#34;) if [ $EXPIRY_DAYS -eq 1 ]; then echo \u0026#34;è¯ä¹¦å³å°†è¿‡æœŸ\u0026#34; | mail -s \u0026#34;è¯ä¹¦å‘Šè­¦\u0026#34; admin@example.com fi ğŸ’¡ æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨ ECC è¯ä¹¦ï¼ˆæ›´å®‰å…¨æ›´é«˜æ•ˆï¼‰ acme.sh --issue --dns dns_cf -d mobufan.eu.org --keylength ec-256 # å®šæœŸè½®æ¢ API Token # æ¯ 3-6 ä¸ªæœˆæ›´æ–°ä¸€æ¬¡ Cloudflare API Token # å¤‡ä»½è¯ä¹¦å’Œé…ç½® sudo tar -czvf /backup/ssl-certs-$(date +%Y%m%d).tar.gz /etc/nginx/ssl/ ~/.acme.sh/ # è®¾ç½®æ–‡ä»¶æƒé™ sudo find /etc/nginx/ssl -type f -exec chmod 644 {} \\; sudo find /etc/nginx/ssl -type f -name \u0026#34;*.pem\u0026#34; -exec chmod 600 {} \\; ğŸ“ˆ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 # ä½¿ç”¨ OCSP Stapling sudo openssl ocsp -noverify \\ -issuer /etc/nginx/ssl/chain.pem \\ -cert /etc/nginx/ssl/cert.pem \\ -url http://ocsp.int-x3.letsencrypt.org # ç”Ÿæˆ DH å‚æ•° sudo openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048 ğŸ”„ è‡ªåŠ¨åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/bin/bash # auto-renew-cert.sh DOMAIN=\u0026#34;mobufan.eu.org\u0026#34; LOG_FILE=\u0026#34;/var/log/acme-renew.log\u0026#34; echo \u0026#34;$(date): å¼€å§‹è¯ä¹¦ç»­ç­¾æ£€æŸ¥\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ EXPIRY_DAYS=$(acme.sh --list | grep \u0026#34;$DOMAIN\u0026#34; | awk \u0026#39;{print $6}\u0026#39;) if [ -z \u0026#34;$EXPIRY_DAYS\u0026#34; ] || [ \u0026#34;$EXPIRY_DAYS\u0026#34; -lt 5 ]; then echo \u0026#34;è¯ä¹¦å³å°†è¿‡æœŸï¼Œæ‰§è¡Œç»­ç­¾...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE acme.sh --renew -d $DOMAIN --force echo \u0026#34;è¯ä¹¦ç»­ç­¾å®Œæˆ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE else echo \u0026#34;è¯ä¹¦æœ‰æ•ˆæœŸå‰©ä½™ ${EXPIRY_DAYS} å¤©ï¼Œæ— éœ€ç»­ç­¾\u0026#34; \u0026gt;\u0026gt; $LOG_FILE fi ğŸ“ Docker ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Docker æ–¹å¼ä½¿ç”¨ acme.sh docker run --rm -it \\ -v \u0026#34;/etc/ssl/acme\u0026#34;:/acme.sh \\ -e \u0026#34;CF_Token=your_token_here\u0026#34; \\ -e \u0026#34;CF_Zone_ID=your_zone_id\u0026#34; \\ neilpang/acme.sh \\ --issue -d mobufan.eu.org --dns dns_cf # ä½¿ç”¨ä»£ç† docker run --rm -it \\ -v \u0026#34;/etc/ssl/acme\u0026#34;:/acme.sh \\ -e \u0026#34;CF_Token=your_token_here\u0026#34; \\ -e \u0026#34;http_proxy=http://proxy:1080\u0026#34; \\ -e \u0026#34;https_proxy=http://proxy:1080\u0026#34; \\ neilpang/acme.sh \\ --issue -d mobufan.eu.org --dns dns_cf --debug ğŸ¯ æç¤º: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰å……åˆ†æµ‹è¯•æ‰€æœ‰é…ç½®ã€‚å®šæœŸæ£€æŸ¥è¯ä¹¦çŠ¶æ€å’Œæ—¥å¿—ï¼Œç¡®ä¿è‡ªåŠ¨åŒ–æµç¨‹æ­£å¸¸è¿è¡Œã€‚\nğŸ“š æ‰©å±•èµ„æº:\nacme.sh å®˜æ–¹æ–‡æ¡£ Cloudflare API æ–‡æ¡£ Let\u0026rsquo;s Encrypt æ–‡æ¡£ SSL æœ€ä½³å®è·µ ğŸ”§ ç´§æ€¥æ¢å¤:\n1 2 3 4 5 6 7 8 9 10 11 # è¯ä¹¦ç»­ç­¾å¤±è´¥æ—¶æ‰‹åŠ¨å¤„ç† acme.sh --renew -d mobufan.eu.org --force --debug # æ¢å¤å¤‡ä»½è¯ä¹¦ sudo tar -xzvf /backup/ssl-certs-20231201.tar.gz -C / # é‡æ–°å®‰è£…è¯ä¹¦ acme.sh --install-cert -d mobufan.eu.org \\ --key-file /etc/nginx/ssl/key.pem \\ --fullchain-file /etc/nginx/ssl/cert.pem \\ --reloadcmd \u0026#34;systemctl reload nginx\u0026#34; ","date":"2024-12-07T20:39:28+08:00","image":"https://file.meimolihan.eu.org/img/ssl-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2ebbe23e/","title":"acme.sh + Cloudflare SSL è¯ä¹¦ç®¡ç† ğŸ”"},{"content":" ä¸€ ã€OpenClash é…ç½®æ–‡ä»¶ ä½œè€…åœ°å€ï¼šhttps://github.com/qichiyuhub/rule/tree/master/config/Clash æ•™ç¨‹åœ°å€ï¼šhttps://www.youtube.com/watch?v=hCe4bmMwq7M\u0026amp;ab_channel=%E4%B8%83%E5%B0%BA%E5%AE%87 OpenClash é…ç½®æ–‡ä»¶ä¸‹è½½ï¼šhttps://blog.mobufan.eu.org:666/download/clash/openclash\nä¸Šä¼ åˆ°ï¼š/etc/config æ›¿æ¢æ‰OpenClash\näºŒ ã€yaml é…ç½®æ–‡ä»¶ ä½œè€… yaml é…ç½®æ–‡ä»¶ä¸‹è½½ï¼šhttps://blog.mobufan.eu.org:666/download/clash/configfull.yaml æˆ‘çš„ yaml é…ç½®æ–‡ä»¶ä¸‹è½½ï¼šhttps://blog.mobufan.eu.org:666/download/clash/my.yaml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 # æœºåœºè®¢é˜…ï¼Œåç§°ä¸èƒ½é‡å¤ proxy-providers: Airport_mojie: type: http interval: 1800 health-check: enable: true url: https://www.gstatic.com/generate_204 interval: 300 proxy: ğŸŸ¢ ç›´è¿ url: \u0026#34;https://mojie.app/api/v1/client/subscribe?token=bb301ac8771cc24847cde8c4f071d1e1\u0026#34; Airport_dijia: type: http interval: 1800 health-check: enable: true url: https://www.gstatic.com/generate_204 interval: 300 proxy: ğŸŸ¢ ç›´è¿ url: \u0026#34;https://sub1.114514000000.xyz/api/v1/client/subscribe?token=q7654s7n10c297pmfj5pv0v4rgpnj4b8\u0026#34; # ç”¨äºä¸‹è½½è®¢é˜…æ—¶æŒ‡å®šUA global-ua: clash # å…¨å±€é…ç½® port: 7890 socks-port: 7891 redir-port: 7892 mixed-port: 7893 tproxy-port: 7894 ipv6: false allow-lan: true unified-delay: true tcp-concurrent: true geodata-mode: false # GEO æ–‡ä»¶åŠ è½½æ¨¡å¼ï¼ˆstandardï¼šæ ‡å‡†åŠ è½½å™¨/memconservativeï¼šä¸“ä¸ºå†…å­˜å—é™ (å°å†…å­˜) è®¾å¤‡ä¼˜åŒ–çš„åŠ è½½å™¨ (é»˜è®¤å€¼)ï¼‰ geodata-loader: standard geo-auto-update: true geo-update-interval: 48 geox-url: geoip: \u0026#34;https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat\u0026#34; geosite: \u0026#34;https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat\u0026#34; mmdb: \u0026#34;https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb\u0026#34; asn: \u0026#34;https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb\u0026#34; # æ§åˆ¶é¢æ¿ external-controller: 0.0.0.0:9090 secret: \u0026#34;\u0026#34; external-ui: ui external-ui-url: \u0026#34;https://ghp.ci/https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip\u0026#34; # åŒ¹é…è¿›ç¨‹ always/strict/off find-process-mode: strict global-client-fingerprint: chrome keep-alive-idle: 600 keep-alive-interval: 30 # ç­–ç•¥ç»„é€‰æ‹©å’Œfakeipç¼“å­˜ profile: store-selected: true store-fake-ip: true # æµé‡å—…æ¢ sniffer: enable: true sniff: HTTP: ports: [80, 8080-8880] override-destination: true TLS: ports: [443, 8443] QUIC: ports: [443, 8443] force-domain: - +.v2ex.com skip-domain: - \u0026#34;Mijia Cloud\u0026#34; - \u0026#34;dlg.io.mi.com\u0026#34; - \u0026#34;+.push.apple.com\u0026#34; - \u0026#34;+.apple.com\u0026#34; # ä»£ç†æ¨¡å¼ tun: enable: true stack: mixed mtu: 9000 dns-hijack: - \u0026#34;any:53\u0026#34; - \u0026#34;tcp://any:53\u0026#34; auto-route: true auto-redirect: true auto-detect-interface: true # DNSæ¨¡å— dns: enable: true listen: 0.0.0.0:1053 ipv6: false respect-rules: true # æ¨¡å¼åˆ‡æ¢ redir-host / fake-ip enhanced-mode: fake-ip fake-ip-range: 28.0.0.1/8 # æ¨¡å¼åˆ‡æ¢ whitelist/blacklist # é»‘åå•æ¨¡å¼è¡¨ç¤ºå¦‚æœåŒ¹é…æˆåŠŸåˆ™ä¸è¿”å› Fake-IP, ç™½åå•æ¨¡å¼æ—¶åªæœ‰åŒ¹é…æˆåŠŸæ‰è¿”å› Fake-IP fake-ip-filter-mode: blacklist fake-ip-filter: - \u0026#34;+.lan\u0026#34; - \u0026#34;+.local\u0026#34; - geosite:private - geosite:cn default-nameserver: - 223.5.5.5 - 119.29.29.29 proxy-server-nameserver: - 223.5.5.5 - 119.29.29.29 nameserver: - 223.5.5.5 - 119.29.29.29 nameserver-policy: \u0026#34;rule-set:private_domain,cn_domain\u0026#34;: - 223.5.5.5 - 119.29.29.29 \u0026#34;rule-set:geolocation-!cn\u0026#34;: - \u0026#34;https://dns.cloudflare.com/dns-query\u0026#34; - \u0026#34;https://dns.google/dns-query\u0026#34; proxies: - name: \u0026#34;ğŸŸ¢ ç›´è¿\u0026#34; type: direct udp: true # é”šç‚¹ pr: \u0026amp;pr {type: select, proxies: [ğŸš€ èŠ‚ç‚¹é€‰æ‹©, ğŸ”¯ é¦™æ¸¯æ•…è½¬, ğŸ”¯ æ—¥æœ¬æ•…è½¬, â™»ï¸ é¦™æ¸¯è‡ªåŠ¨, â™»ï¸ æ—¥æœ¬è‡ªåŠ¨, â™»ï¸ ç¾å›½è‡ªåŠ¨, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ğŸŸ¢ ç›´è¿]} # ç­–ç•¥ç»„ ï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼šurl-testï¼‰ proxy-groups: - {name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©, type: url-test, proxies: [ğŸ”¯ é¦™æ¸¯æ•…è½¬, ğŸ”¯ æ—¥æœ¬æ•…è½¬, â™»ï¸ é¦™æ¸¯è‡ªåŠ¨, â™»ï¸ æ—¥æœ¬è‡ªåŠ¨, â™»ï¸ ç¾å›½è‡ªåŠ¨, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ğŸŸ¢ ç›´è¿]} - {name: ğŸ“¹ YouTube,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ€ Google,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ¤– ChatGPT,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ‘¨ğŸ¿â€ğŸ’» GitHub,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ¬ OneDrive,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸªŸ Microsoft,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸµ TikTok,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ“² Telegram,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ¥ NETFLIX,!!merge \u0026lt;\u0026lt;: *pr} - {name: âœˆï¸ Speedtest,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ’¶ PayPal,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ Apple, type: select, proxies: [ğŸŸ¢ ç›´è¿, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]} - {name: ğŸ¯ å…¨çƒç›´è¿, type: select, proxies: [ğŸŸ¢ ç›´è¿, ğŸš€ èŠ‚ç‚¹é€‰æ‹©]} - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼,!!merge \u0026lt;\u0026lt;: *pr} - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, type: select, include-all: true, filter: \u0026#34;(?i)æ¸¯|hk|hongkong|hong kong\u0026#34;} - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, type: select, include-all: true, filter: \u0026#34;(?i)æ—¥|jp|japan\u0026#34;} - {name: ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, type: select, include-all: true, filter: \u0026#34;(?i)ç¾|us|unitedstates|united states\u0026#34;} - {name: ğŸ”¯ é¦™æ¸¯æ•…è½¬, type: fallback, include-all: true, tolerance: 20, interval: 300, filter: \u0026#34;(?=.*(æ¸¯|HK|(?i)Hong))^((?!(å°|æ—¥|éŸ©|æ–°|æ·±|ç¾)).)*$\u0026#34;} - {name: ğŸ”¯ æ—¥æœ¬æ•…è½¬, type: fallback, include-all: true, tolerance: 20, interval: 300, filter: \u0026#34;(?=.*(æ—¥|JP|(?i)Japan))^((?!(æ¸¯|å°|éŸ©|æ–°|ç¾)).)*$\u0026#34; } - {name: â™»ï¸ é¦™æ¸¯è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: \u0026#34;(?=.*(æ¸¯|HK|(?i)Hong))^((?!(å°|æ—¥|éŸ©|æ–°|æ·±|ç¾)).)*$\u0026#34;} - {name: â™»ï¸ æ—¥æœ¬è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: \u0026#34;(?=.*(æ—¥|JP|(?i)Japan))^((?!(æ¸¯|å°|éŸ©|æ–°|ç¾)).)*$\u0026#34; } - {name: â™»ï¸ ç¾å›½è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: \u0026#34;(?=.*(ç¾|US|(?i)States|America))^((?!(æ¸¯|å°|æ—¥|éŸ©|æ–°)).)*$\u0026#34;} - {name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: \u0026#34;^((?!(ç›´è¿)).)*$\u0026#34;} - {name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, type: select, include-all: true} rules: - RULE-SET,private_domain,ğŸŸ¢ ç›´è¿ - RULE-SET,apple_domain,ğŸ Apple - RULE-SET,proxylite,ğŸš€ èŠ‚ç‚¹é€‰æ‹© - RULE-SET,ai,ğŸ¤– ChatGPT - RULE-SET,github_domain,ğŸ‘¨ğŸ¿â€ğŸ’» GitHub - RULE-SET,youtube_domain,ğŸ“¹ YouTube - RULE-SET,google_domain,ğŸ€ Google - RULE-SET,onedrive_domain,ğŸ¬ OneDrive - RULE-SET,microsoft_domain,ğŸªŸ Microsoft - RULE-SET,tiktok_domain,ğŸµ TikTok - RULE-SET,speedtest_domain,âœˆï¸ Speedtest - RULE-SET,telegram_domain,ğŸ“² Telegram - RULE-SET,netflix_domain,ğŸ¥ NETFLIX - RULE-SET,paypal_domain,ğŸ’¶ PayPal - RULE-SET,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹© - RULE-SET,cn_domain,ğŸ¯ å…¨çƒç›´è¿ - RULE-SET,google_ip,ğŸ€ Google,no-resolve - RULE-SET,netflix_ip,ğŸ¥ NETFLIX,no-resolve - RULE-SET,telegram_ip,ğŸ“² Telegram,no-resolve - RULE-SET,cn_ip,ğŸ¯ å…¨çƒç›´è¿ - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼ rule-anchor: ip: \u0026amp;ip {type: http, interval: 86400, behavior: ipcidr, format: mrs} domain: \u0026amp;domain {type: http, interval: 86400, behavior: domain, format: mrs} qcy: \u0026amp;qcy {type: http, interval: 86400, behavior: domain, format: text} class: \u0026amp;class {type: http, interval: 86400, behavior: classical, format: text} rule-providers: private_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs\u0026#34;} proxylite: {!!merge \u0026lt;\u0026lt;: *qcy, url: \u0026#34;https://raw.githubusercontent.com/qcyhub/rule/master/ProxyLite.list\u0026#34;} ai: {!!merge \u0026lt;\u0026lt;: *qcy, url: \u0026#34;https://raw.githubusercontent.com/qcyhub/rule/master/AI.list\u0026#34;} youtube_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs\u0026#34;} google_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs\u0026#34;} github_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs\u0026#34;} telegram_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs\u0026#34;} netflix_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.mrs\u0026#34;} paypal_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/paypal.mrs\u0026#34;} onedrive_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/onedrive.mrs\u0026#34;} microsoft_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs\u0026#34;} apple_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/apple-cn.mrs\u0026#34;} speedtest_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/ookla-speedtest.mrs\u0026#34;} tiktok_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.mrs\u0026#34;} gfw_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.mrs\u0026#34;} geolocation-!cn: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs\u0026#34;} cn_domain: {!!merge \u0026lt;\u0026lt;: *domain, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs\u0026#34;} cn_ip: {!!merge \u0026lt;\u0026lt;: *ip, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs\u0026#34;} google_ip: {!!merge \u0026lt;\u0026lt;: *ip, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs\u0026#34;} telegram_ip: {!!merge \u0026lt;\u0026lt;: *ip, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs\u0026#34;} netflix_ip: {!!merge \u0026lt;\u0026lt;: *ip, url: \u0026#34;https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.mrs\u0026#34;} ä¸‰ ã€OpenClash æ‚Ÿç©ºæ›´æ–°è„šæœ¬ï¼ˆéœ€è¦ç§‘å­¦ç½‘ç»œï¼‰ 1 wget -O /tmp/all.run https://cdn.jsdelivr.net/gh/wukongdaily/allinonescript@main/all/all.run \u0026amp;\u0026amp; chmod +x /tmp/all.run \u0026amp;\u0026amp; /tmp/all.run ","date":"2024-12-07T20:35:14+08:00","image":"https://file.meimolihan.eu.org/img/openclash-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2dece2e0/","title":"OpenClash é…ç½®æ–‡ä»¶"},{"content":"Caddy è´Ÿè½½å‡è¡¡ mtab æ ‡ç­¾é¡µï¼šhttps://mtab.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ## caddy è´Ÿè½½å‡è¡¡ è´Ÿè½½è½®è¯¢ mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/mtab.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/mtab.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/mtab.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; https://mtab.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy /* http://10.10.10.245:9200 http://10.10.10.247:9200 { header_up Host {http.reverse_proxy.upstream.hostport} lb_policy round_robin ## ä¾æ¬¡è½®è¯¢æ¯æ¡ä¸Šæ¸¸ } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload ","date":"2024-12-07T20:31:36+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2eef35d3/","title":"Caddy è´Ÿè½½å‡è¡¡"},{"content":"Nginx è´Ÿè½½å‡è¡¡é…ç½®æŒ‡å— ğŸ”„ ğŸš€ å…¨é¢æŒæ¡ Nginx è´Ÿè½½å‡è¡¡é…ç½®ï¼Œæ„å»ºé«˜å¯ç”¨ã€é«˜æ€§èƒ½çš„ Web æœåŠ¡æ¶æ„\nâœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ Nginx è´Ÿè½½å‡è¡¡æä¾›ä»¥ä¸‹å¼ºå¤§åŠŸèƒ½ï¼š\nâš¡ é«˜æ€§èƒ½å¤„ç†ï¼šåŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ¶æ„ï¼Œè½»æ¾å¤„ç†æ•°ä¸‡å¹¶å‘è¿æ¥ ğŸ”„ å¤šç§ç®—æ³•ï¼šæ”¯æŒè½®è¯¢ã€åŠ æƒè½®è¯¢ã€IPå“ˆå¸Œã€æœ€å°‘è¿æ¥ç­‰å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³• ğŸ›¡ï¸ é«˜å¯ç”¨æ€§ï¼šæ”¯æŒå¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œç¡®ä¿æœåŠ¡æŒç»­å¯ç”¨ ğŸ“Š çµæ´»é…ç½®ï¼šæ”¯æŒå››å±‚å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ ğŸ” å®æ—¶ç›‘æ§ï¼šæä¾›çŠ¶æ€ç›‘æ§å’Œæ—¥å¿—è®°å½•ï¼Œä¾¿äºæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ– ğŸŒ å¤šåè®®æ”¯æŒï¼šæ”¯æŒ HTTPã€HTTPSã€TCPã€UDP ç­‰å¤šç§åè®® ğŸ’¡ æ˜“äºæ‰©å±•ï¼šç®€å•é…ç½®å³å¯æ·»åŠ æˆ–ç§»é™¤åç«¯æœåŠ¡å™¨ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±• ğŸ“– ç›®å½•å¯¼èˆª ğŸ”¥ çƒ­å¤‡è´Ÿè½½å‡è¡¡ ğŸ”„ è½®è¯¢è´Ÿè½½å‡è¡¡ âš–ï¸ åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ ğŸ” IP Hash è´Ÿè½½å‡è¡¡ ğŸ“ åŸºäºç‰¹å®šèµ„æºçš„è´Ÿè½½å‡è¡¡ ğŸŒ åŸºäºä¸åŒåŸŸåçš„è´Ÿè½½å‡è¡¡ ğŸ”„ å¸¦æœ‰ URL é‡å†™çš„è´Ÿè½½å‡è¡¡ ğŸŒ å››å±‚è´Ÿè½½å‡è¡¡ ğŸ’¡ è´Ÿè½½å‡è¡¡å‚æ•°è¯¦è§£ ğŸ› ï¸ é«˜çº§é…ç½®æŠ€å·§ ğŸ” ç›‘æ§å’Œè°ƒè¯• ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥ ğŸ“Š è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æŒ‡å— ğŸ”¥ ä¸€ã€çƒ­å¤‡è´Ÿè½½å‡è¡¡ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰ çƒ­å¤‡æ¨¡å¼ï¼šå½“ä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œè‡ªåŠ¨å¯ç”¨å¤‡ä»½æœåŠ¡å™¨æä¾›æœåŠ¡ã€‚è¯·æ±‚å¤„ç†é¡ºåºï¼šAAAAAA çªç„¶ A æŒ‚äº†ï¼ŒBBBBBBBBBBBB\u0026hellip;\n1. åˆ›å»º mtab é…ç½®æ–‡ä»¶ mtab ä¹¦ç­¾é¡µï¼š https://mtab.mobufan.eu.org:5553 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 ## nginx åå‘ä»£ç†+è´Ÿè½½å‡è¡¡: mtab ä¹¦ç­¾é¡µ upstream mysvr { server 10.10.10.245:9200; ## è´Ÿè½½å‡è¡¡-çƒ­å¤‡æ¨¡å¼ï¼šæœ‰2å°æœåŠ¡å™¨ï¼Œä¸€å°æœåŠ¡å™¨å®•æœºæ—¶ï¼Œæ‰å¯ç”¨ç¬¬äºŒå°æœåŠ¡å™¨æä¾›æœåŠ¡ server 10.10.10.247:9200 backup; ## çƒ­å¤‡ } server { ## ç›‘å¬5553ç«¯å£ï¼Œå¹¶å¯ç”¨SSL listen 5553 ssl; listen [::]:5553 ssl; ## æ›¿æ¢ä¸ºä½ çš„åŸŸå server_name mtab.mobufan.eu.org; ## æŒ‡å®š SSL è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶çš„è·¯å¾„ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; location / { ## æŒ‡å®šåå‘ä»£ç†çš„æœåŠ¡åœ°å€ proxy_pass http://mysvr; ## è´Ÿè½½å‡è¡¡ å˜é‡åœ°å€ï¼ˆä¸èƒ½å’Œå…¶å®ƒæœåŠ¡å™¨ç›¸åŒï¼‰ add_header backendIP $upstream_addr; ## è´Ÿè½½å‡è¡¡ èŠ‚ç‚¹IP add_header backendCode $upstream_status; ## è´Ÿè½½å‡è¡¡ å“åº”çŠ¶æ€ç  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; #å¼€å¯ç¼“å­˜ # ä½¿ç”¨ HTTP/1.1 åè®®ä¸åç«¯æœåŠ¡å™¨é€šä¿¡ proxy_http_version 1.1; client_max_body_size 20000m; } } 2. åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶ sudo nginx -t # é‡æ–°åŠ è½½é…ç½® sudo nginx -s reload # æŸ¥çœ‹ Nginx çŠ¶æ€ sudo systemctl status nginx 3. éªŒè¯è´Ÿè½½å‡è¡¡ è®¿é—®ï¼šhttps://mtab.mobufan.eu.org:5553\næ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œé€‰æ‹©ç½‘ç»œé€‰é¡¹å¡ï¼Œæ‰¾åˆ° mtab.mobufan.eu.org è¯·æ±‚ï¼ŒæŸ¥çœ‹å“åº”å¤´ä¸­çš„ backendIP å’Œ backendCode å­—æ®µã€‚\nğŸ”„ äºŒã€è½®è¯¢è´Ÿè½½å‡è¡¡ è½®è¯¢ï¼šNginx é»˜è®¤ç­–ç•¥ï¼Œæƒé‡é»˜è®¤ä¸º 1ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„é¡ºåºï¼šABABABABAB\u0026hellip;\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 upstream backend_servers { # é»˜è®¤æƒé‡ä¸º1 server 127.0.0.1:7878; server 192.168.10.121:3333; } server { listen 8081; # ç›‘å¬ç«¯å£ server_name 127.0.0.1; # ç›‘å¬åœ°å€ location / { proxy_pass http://backend_servers; # è¯·æ±‚è½¬å‘ backend_servers å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } âš–ï¸ ä¸‰ã€åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ åŠ æƒè½®è¯¢ï¼šæ ¹æ®é…ç½®çš„æƒé‡å¤§å°åˆ†å‘ä¸åŒæ•°é‡çš„è¯·æ±‚ã€‚ä¸‹é¢æœåŠ¡å™¨çš„è¯·æ±‚é¡ºåºä¸ºï¼šABBABBABBABBABB\u0026hellip;\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 upstream backend_servers { server 127.0.0.1:7878 weight=1; server 192.168.10.121:3333 weight=2; server 192.168.10.122:4444 weight=3; } server { listen 8081; # ç›‘å¬ç«¯å£ server_name 127.0.0.1; # ç›‘å¬åœ°å€ location / { proxy_pass http://backend_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # æ·»åŠ å“åº”å¤´æ˜¾ç¤ºåç«¯æœåŠ¡å™¨ä¿¡æ¯ add_header X-Backend $upstream_addr; } } ğŸ” å››ã€IP Hash è´Ÿè½½å‡è¡¡ ip_hash: Nginx ä¼šè®©ç›¸åŒçš„å®¢æˆ·ç«¯ IP è¯·æ±‚ç›¸åŒçš„æœåŠ¡å™¨ï¼Œé€‚ç”¨äºéœ€è¦ä¼šè¯ä¿æŒçš„åœºæ™¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 upstream backend_servers { ip_hash; # åŸºäºå®¢æˆ·ç«¯IPçš„å“ˆå¸Œç®—æ³• server 127.0.0.1:7878; server 192.168.10.121:3333; server 192.168.10.122:4444; } server { listen 8081; server_name 127.0.0.1; # å¯ç”¨è®¿é—®æ—¥å¿—è®°å½•è´Ÿè½½å‡è¡¡ä¿¡æ¯ access_log /var/log/nginx/loadbalancer.access.log upstreamlog; location / { proxy_pass http://backend_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # ä¼šè¯è¶…æ—¶è®¾ç½® proxy_connect_timeout 30s; proxy_send_timeout 30s; proxy_read_timeout 30s; } } ğŸ“ äº”ã€åŸºäºç‰¹å®šèµ„æºçš„è´Ÿè½½å‡è¡¡ é€šè¿‡å¤šä¸ª upstream åˆ†æˆå¤šä¸ªæœåŠ¡å™¨ç»„ï¼Œå°†ä¸åŒçš„è¯·æ±‚åˆ†æµåˆ°ä¸åŒçš„æœåŠ¡å™¨ç»„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 # å®šä¹‰æ—¥å¿—æ ¼å¼ log_format upstreamlog \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34; \u0026#39; \u0026#39;upstream: $upstream_addr \u0026#39; \u0026#39;upstream_status: $upstream_status \u0026#39; \u0026#39;request_time: $request_time\u0026#39;; # è§†é¢‘æœåŠ¡å™¨ç»„ upstream video_servers { server 127.0.0.1:7878 weight=1; server 192.168.10.121:3333 weight=2; } # æ–‡ä»¶æœåŠ¡å™¨ç»„ upstream file_servers { server 192.3.2.1:7878 weight=1; server 192.3.2.2:3333 weight=2; } server { listen 8081; server_name 127.0.0.1; access_log /var/log/nginx/access.log upstreamlog; # è§†é¢‘è¯·æ±‚è·¯ç”± location /video/ { proxy_pass http://video_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # è§†é¢‘ä¼ è¾“ä¼˜åŒ– proxy_buffering on; proxy_buffer_size 128k; proxy_buffers 4 256k; proxy_busy_buffers_size 256k; } # æ–‡ä»¶è¯·æ±‚è·¯ç”± location /file/ { proxy_pass http://file_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # å¤§æ–‡ä»¶ä¼ è¾“ä¼˜åŒ– client_max_body_size 100M; proxy_request_buffering off; } } ğŸŒ å…­ã€åŸºäºä¸åŒåŸŸåçš„è´Ÿè½½å‡è¡¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # è§†é¢‘æœåŠ¡å™¨ç»„ upstream video_servers { server 127.0.0.1:7878 weight=1; server 192.168.10.121:3333 weight=2; } # æ–‡ä»¶æœåŠ¡å™¨ç»„ upstream file_servers { server 192.3.2.1:7878 weight=1; server 192.3.2.2:3333 weight=2; } # è§†é¢‘åŸŸåæœåŠ¡å™¨ server { listen 80; server_name video.example.com; location / { proxy_pass http://video_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # æ·»åŠ CORSå¤´éƒ¨ add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods \u0026#39;GET, POST, OPTIONS\u0026#39;; add_header Access-Control-Allow-Headers \u0026#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#39;; } } # æ–‡ä»¶åŸŸåæœåŠ¡å™¨ server { listen 80; server_name file.example.com; location / { proxy_pass http://file_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # æ–‡ä»¶ä¸‹è½½ä¼˜åŒ– proxy_max_temp_file_size 0; proxy_buffering off; } } ğŸ”„ ä¸ƒã€å¸¦æœ‰ URL é‡å†™çš„è´Ÿè½½å‡è¡¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 upstream backend_servers{ server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003; } server { listen 80; server_name localhost; # URLé‡å†™è§„åˆ™ location /file/ { rewrite ^(/file/.*) /server/$1 last; } location /api/ { rewrite ^/api/(.*)$ /$1 break; proxy_pass http://backend_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; } location / { proxy_pass http://backend_servers; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; # å¥åº·æ£€æŸ¥ proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; } } ğŸŒ å…«ã€å››å±‚è´Ÿè½½å‡è¡¡ æ³¨æ„ï¼šå››å±‚è´Ÿè½½å‡è¡¡éœ€è¦åœ¨ stream æ¨¡å—ä¸­é…ç½®ï¼Œé€šå¸¸ç”¨äº TCP/UDP è´Ÿè½½å‡è¡¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # åœ¨nginx.confçš„mainä¸Šä¸‹æ–‡ä¸­æ·»åŠ  stream { # å®šä¹‰æ—¥å¿—æ ¼å¼ log_format basic \u0026#39;$remote_addr [$time_local] \u0026#39; \u0026#39;$protocol $status $bytes_sent $bytes_received \u0026#39; \u0026#39;$session_time \u0026#34;$upstream_addr\u0026#34;\u0026#39;; access_log /var/log/nginx/stream.access.log basic; # RedisæœåŠ¡å™¨ç»„ upstream redis_backend { server 192.168.200.146:6379 weight=1; server 192.168.200.146:6378 weight=2; } # TomcatæœåŠ¡å™¨ç»„ upstream tomcat_backend { server 192.168.200.146:8080; server 192.168.200.147:8080 backup; } # MySQLæœåŠ¡å™¨ç»„ upstream mysql_backend { server 192.168.200.148:3306; server 192.168.200.149:3306 backup; } # Redisè´Ÿè½½å‡è¡¡ server { listen 6379; proxy_pass redis_backend; proxy_timeout 1s; proxy_connect_timeout 1s; } # Tomcatè´Ÿè½½å‡è¡¡ server { listen 8080; proxy_pass tomcat_backend; proxy_timeout 3s; } # MySQLè´Ÿè½½å‡è¡¡ server { listen 3306; proxy_pass mysql_backend; proxy_timeout 5s; } } ğŸ’¡ ä¹ã€è´Ÿè½½å‡è¡¡å‚æ•°è¯¦è§£ 1. æœåŠ¡å™¨çŠ¶æ€å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 upstream backend_servers { # åŸºæœ¬å‚æ•° server backend1.example.com:8080 weight=5; # æƒé‡ server backend2.example.com:8080 max_fails=3; # æœ€å¤§å¤±è´¥æ¬¡æ•° server backend3.example.com:8080 fail_timeout=30s; # å¤±è´¥è¶…æ—¶ # é«˜çº§å‚æ•° server backup1.example.com:8080 backup; # å¤‡ä»½æœåŠ¡å™¨ server down1.example.com:8080 down; # æ ‡è®°ä¸ºæ°¸ä¹…ä¸å¯ç”¨ server slow1.example.com:8080 slow_start=30s; # æ…¢å¯åŠ¨æ—¶é—´ # ä¿æŒæ´»åŠ¨è¿æ¥ keepalive 32; # è¿æ¥æ± å¤§å° keepalive_timeout 60s; # è¿æ¥è¶…æ—¶æ—¶é—´ } 2. å¥åº·æ£€æŸ¥é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 upstream backend_servers { server 192.168.1.10:8080; server 192.168.1.11:8080; # å¥åº·æ£€æŸ¥å‚æ•° check interval=3000 rise=2 fall=5 timeout=1000 type=http; check_http_send \u0026#34;HEAD /health HTTP/1.0\\r\\n\\r\\n\u0026#34;; check_http_expect_alive http_2xx http_3xx; # ä¼šè¯ä¿æŒ sticky cookie srv_id expires=1h domain=.example.com path=/; } 3. è¶…æ—¶å’Œç¼“å†²è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 upstream backend_servers { server 192.168.1.10:8080; server 192.168.1.11:8080; } server { location / { proxy_pass http://backend_servers; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 5s; # è¿æ¥è¶…æ—¶ proxy_send_timeout 10s; # å‘é€è¶…æ—¶ proxy_read_timeout 30s; # è¯»å–è¶…æ—¶ # ç¼“å†²è®¾ç½® proxy_buffering on; # å¯ç”¨ç¼“å†² proxy_buffer_size 4k; # ç¼“å†²åŒºå¤§å° proxy_buffers 8 4k; # ç¼“å†²æ•°é‡å’Œå¤§å° proxy_busy_buffers_size 8k; # å¿™ç¢Œæ—¶ç¼“å†²åŒºå¤§å° # å…¶ä»–ä¼˜åŒ– proxy_redirect off; # ç¦ç”¨é‡å®šå‘ proxy_http_version 1.1; # ä½¿ç”¨HTTP/1.1 proxy_set_header Connection \u0026#34;\u0026#34;; # æ¸…ç©ºè¿æ¥å¤´ } } ğŸ› ï¸ åã€é«˜çº§é…ç½®æŠ€å·§ 1. åŠ¨æ€è´Ÿè½½å‡è¡¡ 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨DNSè§£æå®ç°åŠ¨æ€æœåŠ¡å‘ç° resolver 8.8.8.8 1.1.1.1 valid=30s; upstream dynamic_backend { zone upstream_dynamic 64k; server service.example.com:8080 resolve; # å®šæœŸè§£æDNS resolver_timeout 30s; } 2. æ•…éšœè½¬ç§»é…ç½® 1 2 3 4 5 6 7 8 9 10 upstream backend_servers { server primary.example.com:8080; server secondary.example.com:8080 backup; server tertiary.example.com:8080 backup; # æ•…éšœè½¬ç§»ç­–ç•¥ proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; proxy_next_upstream_tries 3; proxy_next_upstream_timeout 10s; } 3. æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 upstream backend_servers { server 192.168.1.10:8080; server 192.168.1.11:8080; # è¿æ¥æ± é…ç½® keepalive 32; keepalive_requests 100; keepalive_timeout 60s; # æœ€å°‘è¿æ¥ç®—æ³• least_conn; } server { location / { proxy_pass http://backend_servers; # ç¼“å†²ä¼˜åŒ– proxy_buffers 16 32k; proxy_buffer_size 64k; # ç¼“å­˜ä¼˜åŒ– proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off; proxy_cache my_cache; proxy_cache_valid 200 302 10m; proxy_cache_valid 404 1m; } } ğŸ” åä¸€ã€ç›‘æ§å’Œè°ƒè¯• 1. å¯ç”¨çŠ¶æ€é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # NginxçŠ¶æ€é¡µé¢ server { listen 8080; server_name localhost; location /nginx_status { stub_status on; access_log off; allow 127.0.0.1; deny all; } } # ä¸Šæ¸¸çŠ¶æ€é¡µé¢ï¼ˆéœ€è¦nginx-upstream-statusæ¨¡å—ï¼‰ server { listen 8081; server_name localhost; location /upstream_status { upstream_status; access_log off; allow 127.0.0.1; deny all; } } 2. æ—¥å¿—é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å®šä¹‰ä¸Šæ¸¸æ—¥å¿—æ ¼å¼ log_format upstream_log \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34; \u0026#39; \u0026#39;upstream: $upstream_addr \u0026#39; \u0026#39;upstream_status: $upstream_status \u0026#39; \u0026#39;request_time: $request_time \u0026#39; \u0026#39;upstream_response_time: $upstream_response_time \u0026#39; \u0026#39;upstream_connect_time: $upstream_connect_time\u0026#39;; # åº”ç”¨æ—¥å¿—æ ¼å¼ server { access_log /var/log/nginx/access.log upstream_log; error_log /var/log/nginx/error.log warn; } 3. å®æ—¶ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #!/bin/bash # monitor_upstream.sh - ç›‘æ§Nginxä¸Šæ¸¸æœåŠ¡å™¨çŠ¶æ€ LOG_FILE=\u0026#34;/var/log/nginx/upstream_monitor.log\u0026#34; UPSTREAM_NAME=\u0026#34;backend_servers\u0026#34; echo \u0026#34;$(date): å¼€å§‹ç›‘æ§ä¸Šæ¸¸æœåŠ¡å™¨ $UPSTREAM_NAME\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # æ£€æŸ¥NginxçŠ¶æ€ if ! systemctl is-active --quiet nginx; then echo \u0026#34;$(date): NginxæœåŠ¡æœªè¿è¡Œ\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi # è·å–ä¸Šæ¸¸æœåŠ¡å™¨çŠ¶æ€ UPSTREAM_STATUS=$(curl -s http://localhost:8081/upstream_status | grep $UPSTREAM_NAME) if [ -z \u0026#34;$UPSTREAM_STATUS\u0026#34; ]; then echo \u0026#34;$(date): æ— æ³•è·å–ä¸Šæ¸¸æœåŠ¡å™¨çŠ¶æ€\u0026#34; \u0026gt;\u0026gt; $LOG_FILE else echo \u0026#34;$(date): ä¸Šæ¸¸æœåŠ¡å™¨çŠ¶æ€ - $UPSTREAM_STATUS\u0026#34; \u0026gt;\u0026gt; $LOG_FILE fi # æ£€æŸ¥æ˜¯å¦æœ‰æœåŠ¡å™¨å®•æœº if echo \u0026#34;$UPSTREAM_STATUS\u0026#34; | grep -q \u0026#34;down\u0026#34;; then echo \u0026#34;$(date): è­¦å‘Šï¼šæœ‰ä¸Šæ¸¸æœåŠ¡å™¨å®•æœº\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # å‘é€è­¦æŠ¥ echo \u0026#34;Nginxä¸Šæ¸¸æœåŠ¡å™¨å®•æœºè­¦æŠ¥: $UPSTREAM_STATUS\u0026#34; | mail -s \u0026#34;Nginxè­¦æŠ¥\u0026#34; admin@example.com fi ğŸš¨ åäºŒã€å¸¸è§é—®é¢˜æ’æŸ¥ 1. åŸºç¡€æ£€æŸ¥å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥Nginxé…ç½®è¯­æ³• nginx -t # æ£€æŸ¥Nginxè¿›ç¨‹çŠ¶æ€ ps aux | grep nginx # æ£€æŸ¥ç›‘å¬ç«¯å£ netstat -tulnp | grep nginx ss -tulnp | grep nginx # æ£€æŸ¥é”™è¯¯æ—¥å¿— tail -f /var/log/nginx/error.log # æ£€æŸ¥è®¿é—®æ—¥å¿— tail -f /var/log/nginx/access.log 2. è´Ÿè½½å‡è¡¡çŠ¶æ€æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 # æµ‹è¯•è´Ÿè½½å‡è¡¡åˆ†é… for i in {1..10}; do curl -s http://example.com/ | grep \u0026#34;Server IP\u0026#34; done # æ£€æŸ¥ä¸Šæ¸¸æœåŠ¡å™¨å¥åº·çŠ¶æ€ curl http://localhost:8081/upstream_status # æ£€æŸ¥NginxçŠ¶æ€é¡µé¢ curl http://localhost:8080/nginx_status 3. æ€§èƒ½é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥è¿æ¥æ•° netstat -an | grep :80 | wc -l # æ£€æŸ¥æ´»åŠ¨è¿æ¥æ•° nginx -T 2\u0026gt;/dev/null | grep active_connections # æ£€æŸ¥è¯·æ±‚ç‡ goaccess /var/log/nginx/access.log -a # æ£€æŸ¥å“åº”æ—¶é—´ cat /var/log/nginx/access.log | awk \u0026#39;{print $NF}\u0026#39; | sort -n | uniq -c ğŸ“Š åä¸‰ã€è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æŒ‡å— ç­–ç•¥ç±»å‹ é€‚ç”¨åœºæ™¯ ä¼˜ç‚¹ ç¼ºç‚¹ è½®è¯¢ æœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘ï¼Œæ— çŠ¶æ€æœåŠ¡ ç®€å•æ˜“ç”¨ï¼Œå…¬å¹³åˆ†é… æ— æ³•è€ƒè™‘æœåŠ¡å™¨è´Ÿè½½å·®å¼‚ åŠ æƒè½®è¯¢ æœåŠ¡å™¨æ€§èƒ½å·®å¼‚æ˜æ˜¾ è€ƒè™‘æœåŠ¡å™¨æ€§èƒ½å·®å¼‚ï¼Œåˆç†åˆ†é…è´Ÿè½½ é…ç½®ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦äº†è§£æœåŠ¡å™¨æ€§èƒ½ IP Hash éœ€è¦ä¼šè¯ä¿æŒçš„åº”ç”¨ ç¡®ä¿åŒä¸€å®¢æˆ·ç«¯è®¿é—®åŒä¸€æœåŠ¡å™¨ï¼Œä¿æŒä¼šè¯ æœåŠ¡å™¨å®•æœºä¼šå½±å“éƒ¨åˆ†ç”¨æˆ·ï¼Œæ‰©å±•æ€§å—é™ æœ€å°‘è¿æ¥ è¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚å¤§ åŠ¨æ€åˆ†é…ï¼Œè€ƒè™‘å½“å‰è´Ÿè½½ï¼Œæ›´åˆç† éœ€è¦ç»´æŠ¤è¿æ¥æ•°çŠ¶æ€ï¼Œç¨å¾®å¢åŠ å¼€é”€ URL Hash ç¼“å­˜ä¼˜åŒ–åœºæ™¯ æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œå‡å°‘é‡å¤è®¡ç®— é…ç½®å¤æ‚ï¼Œéœ€è¦é¢å¤–æ¨¡å—æ”¯æŒ å“åº”æ—¶é—´ å¯¹å“åº”é€Ÿåº¦æ•æ„Ÿçš„åº”ç”¨ ä¼˜å…ˆé€‰æ‹©å“åº”å¿«çš„æœåŠ¡å™¨ï¼Œæå‡ç”¨æˆ·ä½“éªŒ éœ€è¦å®æ—¶ç›‘æ§å“åº”æ—¶é—´ï¼Œå¢åŠ å¼€é”€ é€‰æ‹©å»ºè®® ä¸€èˆ¬Webåº”ç”¨ï¼šä½¿ç”¨åŠ æƒè½®è¯¢æˆ–æœ€å°‘è¿æ¥ç®—æ³• ä¼šè¯æ•æ„Ÿåº”ç”¨ï¼šä½¿ç”¨IP Hashç®—æ³•ä¿æŒä¼šè¯ä¸€è‡´æ€§ APIç½‘å…³ï¼šä½¿ç”¨è½®è¯¢æˆ–å“åº”æ—¶é—´ç®—æ³•ï¼Œç¡®ä¿å…¬å¹³å’Œå¿«é€Ÿå“åº” ç¼“å­˜æœåŠ¡å™¨ï¼šä½¿ç”¨URL Hashç®—æ³•ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡ é«˜å¯ç”¨é›†ç¾¤ï¼šç»“åˆå¤‡ä»½æœåŠ¡å™¨å’Œå¥åº·æ£€æŸ¥ï¼Œç¡®ä¿æœåŠ¡è¿ç»­æ€§ é…ç½®ç¤ºä¾‹ï¼šæœ€å°‘è¿æ¥ç®—æ³• 1 2 3 4 5 6 7 8 9 10 upstream backend_servers { least_conn; # æœ€å°‘è¿æ¥ç®—æ³• server 192.168.1.10:8080 weight=3; server 192.168.1.11:8080 weight=2; server 192.168.1.12:8080 weight=1; # å¥åº·æ£€æŸ¥ check interval=3000 rise=2 fall=5 timeout=1000; } ğŸš€ é€šè¿‡åˆç†é…ç½® Nginx è´Ÿè½½å‡è¡¡ï¼Œæ‚¨å¯ä»¥æ„å»ºé«˜å¯ç”¨ã€é«˜æ€§èƒ½çš„ Web æœåŠ¡æ¶æ„ï¼Œç¡®ä¿æœåŠ¡çš„ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§ã€‚æ ¹æ®æ‚¨çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶å®šæœŸç›‘æ§å’Œä¼˜åŒ–é…ç½®ï¼\nğŸ’¡ æç¤ºï¼š\nå®šæœŸæ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶å†µå’Œè´Ÿè½½å‡è¡¡æ•ˆæœ æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œå‚æ•° å¯ç”¨ç›‘æ§å’Œæ—¥å¿—è®°å½•ï¼Œä¾¿äºæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ– åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰å……åˆ†æµ‹è¯•æ‰€æœ‰é…ç½® ğŸ“š æ‰©å±•èµ„æºï¼š\nNginx å®˜æ–¹æ–‡æ¡£ Nginx è´Ÿè½½å‡è¡¡æŒ‡å— Nginx æ€§èƒ½ä¼˜åŒ–æŠ€å·§ è´Ÿè½½å‡è¡¡ç®—æ³•æ¯”è¾ƒ ","date":"2024-12-07T20:30:52+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/18e18333/","title":"Nginx è´Ÿè½½å‡è¡¡é…ç½®æŒ‡å— ğŸ”„"},{"content":"Windows ç»ˆç«¯ç¾åŒ–å®Œå…¨æŒ‡å— ğŸ¨ âœ¨ å…¨é¢æŒ‡å¯¼å¦‚ä½•å°†Windowså‘½ä»¤è¡Œç•Œé¢å˜å¾—æ—¢ç¾è§‚åˆé«˜æ•ˆï¼Œå¤§å¹…æå‡å¼€å‘ä½“éªŒå’Œå·¥ä½œæ•ˆç‡\nğŸ“‹ ç›®å½• ğŸŒŸ ç¾åŒ–æ•ˆæœé¢„è§ˆ ğŸ“¦ å®‰è£…å¿…è¦å·¥å…· âš™ï¸ é…ç½®ç¾åŒ–ç¯å¢ƒ ğŸ¨ ä¸»é¢˜é€‰æ‹©ä¸å®šåˆ¶ ğŸ”§ é«˜çº§é…ç½®æŠ€å·§ ğŸš€ æ•ˆç‡æå‡åŠŸèƒ½ ğŸ› å¸¸è§é—®é¢˜è§£å†³ ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®® ğŸŒŸ ç¾åŒ–æ•ˆæœé¢„è§ˆ ç¾åŒ–åçš„CMDå°†å…·å¤‡ä»¥ä¸‹å¢å¼ºç‰¹æ€§ï¼š\nğŸŒˆ å½©è‰²æç¤ºç¬¦ - ä¸åŒçŠ¶æ€æ˜¾ç¤ºä¸åŒé¢œè‰² ğŸ“Š GitçŠ¶æ€é›†æˆ - å®æ—¶æ˜¾ç¤ºåˆ†æ”¯å’Œä¿®æ”¹çŠ¶æ€ â° æ—¶é—´æ˜¾ç¤º - å½“å‰æ—¶é—´ä¿¡æ¯ ğŸ“ è·¯å¾„ç¼©å†™ - æ™ºèƒ½è·¯å¾„æ˜¾ç¤º âŒ é”™è¯¯æŒ‡ç¤º - å‘½ä»¤å¤±è´¥æ—¶æ˜æ˜¾æç¤º âš¡ ç®¡ç†å‘˜æƒé™æç¤º - rootæƒé™è§†è§‰åŒºåˆ† ğŸ”„ å®æ—¶çŠ¶æ€æ›´æ–° - åŠ¨æ€åæ˜ ç³»ç»ŸçŠ¶æ€ ğŸ¯ ä¸Šä¸‹æ–‡æ„ŸçŸ¥ - æ ¹æ®å½“å‰ç›®å½•æ˜¾ç¤ºç›¸å…³ä¿¡æ¯ ğŸ“¦ å®‰è£…å¿…è¦å·¥å…· 1. ğŸ–¥ï¸ å®‰è£… Windows Terminalï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 # æ–¹æ³•1: ä»Microsoft Storeå®‰è£…ï¼ˆæœ€ç®€å•ï¼‰ # æœç´¢ \u0026#34;Windows Terminal\u0026#34; å¹¶å®‰è£… # æ–¹æ³•2: ä½¿ç”¨wingetï¼ˆåŒ…ç®¡ç†å™¨ï¼‰ winget install Microsoft.WindowsTerminal # æ–¹æ³•3: ä»GitHubå‘å¸ƒé¡µæ‰‹åŠ¨å®‰è£… # è®¿é—®: https://github.com/microsoft/terminal/releases # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„.msixbundleæ–‡ä»¶ 2. ğŸ¯ å®‰è£… oh-my-posh 1 2 3 4 5 6 7 8 # æ–¹æ³•1: ä½¿ç”¨wingetå®‰è£…ï¼ˆæ¨èï¼‰ winget install JanDeDobbeleer.OhMyPosh -s winget # æ–¹æ³•2: ä½¿ç”¨PowerShellå®‰è£… Install-Module oh-my-posh -Scope CurrentUser -Force # æ–¹æ³•3: ä»Microsoft Storeå®‰è£… # æœç´¢ \u0026#34;oh-my-posh\u0026#34; å¹¶å®‰è£… 3. âš¡ å®‰è£… Clinkï¼ˆå¢å¼ºCMDï¼‰ 1 2 3 4 5 6 7 8 # ä»å®˜ç½‘ä¸‹è½½: https://chrisant996.github.io/clink/ # æˆ–ä»GitHubå‘å¸ƒé¡µä¸‹è½½: https://github.com/chrisant996/clink/releases # å®‰è£…æ­¥éª¤: # 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Clinkå®‰è£…åŒ… # 2. è¿è¡Œå®‰è£…ç¨‹åº # 3. é€‰æ‹©\u0026#34;Add Clink to the default command prompt\u0026#34;é€‰é¡¹ # 4. å®Œæˆå®‰è£… âš™ï¸ é…ç½®ç¾åŒ–ç¯å¢ƒ ğŸ“ åˆ›å»º Clink é…ç½®æ–‡ä»¶ æ‰¾åˆ°Clinkå®‰è£…ç›®å½•\né»˜è®¤ä½ç½®: C:\\Program Files (x86)\\clink\\ æˆ–è‡ªå®šä¹‰å®‰è£…è·¯å¾„ åˆ›å»º oh-my-posh.lua æ–‡ä»¶\n1 2 3 4 5 -- åŸºç¡€é…ç½® - ä½¿ç”¨é»˜è®¤ä¸»é¢˜ load(io.popen(\u0026#39;oh-my-posh init cmd\u0026#39;):read(\u0026#34;*a\u0026#34;))() -- é«˜çº§é…ç½® - æŒ‡å®šè‡ªå®šä¹‰ä¸»é¢˜ -- load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%USERPROFILE%\\\\.poshthemes\\\\my-theme.omp.json\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() æ–‡ä»¶ä¿å­˜ä½ç½®\nè·¯å¾„: Clinkå®‰è£…ç›®å½•\\oh-my-posh.lua ç¤ºä¾‹: C:\\Program Files (x86)\\clink\\oh-my-posh.lua ğŸ”„ è‡ªåŠ¨åŠ è½½é…ç½® åœ¨Clinkå®‰è£…ç›®å½•ä¸‹çš„ clink.lua æ–‡ä»¶ä¸­æ·»åŠ ï¼š\n1 2 3 4 5 -- åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ dofile(io.popen(\u0026#39;echo %CLINK_DIR%\u0026#39;):read(\u0026#34;*a\u0026#34;)..\u0026#34;\\\\oh-my-posh.lua\u0026#34;) -- æˆ–è€…ç›´æ¥æŒ‡å®šè·¯å¾„ -- dofile(\u0026#34;C:\\\\Program Files (x86)\\\\clink\\\\oh-my-posh.lua\u0026#34;) ğŸ¨ ä¸»é¢˜é€‰æ‹©ä¸å®šåˆ¶ ğŸŒˆ æµè§ˆå¯ç”¨ä¸»é¢˜ 1 2 3 4 5 6 7 # æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ä¸»é¢˜ oh-my-posh get themes # é¢„è§ˆç‰¹å®šä¸»é¢˜ oh-my-posh get theme atomic # åœ¨çº¿æµè§ˆä¸»é¢˜: https://ohmyposh.dev/docs/themes ğŸ“Š å¸¸ç”¨ä¸»é¢˜æ¨è ä¸»é¢˜åç§° é£æ ¼ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ æ€§èƒ½å½±å“ atomic ç°ä»£ç®€çº¦ï¼Œè‰²å½©ä¸°å¯Œ æ—¥å¸¸å¼€å‘ ä¸­ç­‰ powerline ç»å…¸Powerlineé£æ ¼ ä¼ ç»Ÿç”¨æˆ· ä½ paradox ç®€æ´ä¿¡æ¯æ˜¾ç¤º æç®€ä¸»ä¹‰ å¾ˆä½ material Material Designé£æ ¼ è®¾è®¡çˆ±å¥½è€… ä¸­ç­‰ negligible æç®€ï¼Œå ç”¨ç©ºé—´å° ä½é…ç½®æœºå™¨ éå¸¸ä½ âš™ï¸ è‡ªå®šä¹‰ä¸»é¢˜é…ç½® åˆ›å»ºè‡ªå®šä¹‰ä¸»é¢˜\n1 2 # å¤åˆ¶ä¸»é¢˜æ–‡ä»¶åˆ°ç”¨æˆ·ç›®å½• oh-my-posh get theme atomic \u0026gt; \u0026#34;$HOME\\.poshthemes\\my-custom.omp.json\u0026#34; ç¼–è¾‘è‡ªå®šä¹‰ä¸»é¢˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 { \u0026#34;$schema\u0026#34;: \u0026#34;https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/schema.json\u0026#34;, \u0026#34;final_space\u0026#34;: true, \u0026#34;blocks\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;prompt\u0026#34;, \u0026#34;alignment\u0026#34;: \u0026#34;left\u0026#34;, \u0026#34;segments\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;session\u0026#34;, \u0026#34;style\u0026#34;: \u0026#34;diamond\u0026#34;, \u0026#34;background\u0026#34;: \u0026#34;#007ACC\u0026#34;, \u0026#34;foreground\u0026#34;: \u0026#34;#FFFFFF\u0026#34;, \u0026#34;template\u0026#34;: \u0026#34;{{ if .Admin }}âš¡{{ else }}âœ{{ end }}\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;path\u0026#34;, \u0026#34;style\u0026#34;: \u0026#34;powerline\u0026#34;, \u0026#34;background\u0026#34;: \u0026#34;#4EC9B0\u0026#34;, \u0026#34;foreground\u0026#34;: \u0026#34;#000000\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;style\u0026#34;: \u0026#34;folder\u0026#34; } }, { \u0026#34;type\u0026#34;: \u0026#34;git\u0026#34;, \u0026#34;style\u0026#34;: \u0026#34;powerline\u0026#34;, \u0026#34;background\u0026#34;: \u0026#34;#FFB900\u0026#34;, \u0026#34;foreground\u0026#34;: \u0026#34;#000000\u0026#34; } ] } ] } ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜\n1 load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%USERPROFILE%\\\\.poshthemes\\\\my-custom.omp.json\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() \u0026ndash;\nğŸ”§ é«˜çº§é…ç½®æŠ€å·§ âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 -- åœ¨oh-my-posh.luaä¸­æ·»åŠ æ€§èƒ½ä¼˜åŒ– os.setlocale(\u0026#39;C\u0026#39;, \u0026#39;time\u0026#39;) -- ç¦ç”¨ä¸éœ€è¦çš„æ¨¡å—ä»¥æé«˜æ€§èƒ½ load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%USERPROFILE%\\\\.poshthemes\\\\atomic.omp.json\u0026#34; --shell cmd\u0026#39;):read(\u0026#34;*a\u0026#34;))() -- å‡å°‘åˆ·æ–°é¢‘ç‡ clink.set_default_settings({ prompt_async = false, prompt_spacing = false }) ğŸ¯ å¤šç¯å¢ƒé…ç½®æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -- æ ¹æ®æ¡ä»¶åŠ è½½ä¸åŒé…ç½® local function get_theme() local computer_name = os.getenv(\u0026#34;COMPUTERNAME\u0026#34;) local username = os.getenv(\u0026#34;USERNAME\u0026#34;) if computer_name == \u0026#34;WORK_PC\u0026#34; then return \u0026#34;C:\\\\Users\\\\\u0026#34; .. username .. \u0026#34;\\\\.poshthemes\\\\work-theme.omp.json\u0026#34; elseif computer_name == \u0026#34;HOME_PC\u0026#34; then return \u0026#34;C:\\\\Users\\\\\u0026#34; .. username .. \u0026#34;\\\\.poshthemes\\\\home-theme.omp.json\u0026#34; else return \u0026#34;C:\\\\Users\\\\\u0026#34; .. username .. \u0026#34;\\\\.poshthemes\\\\default.omp.json\u0026#34; end end load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;\u0026#39; .. get_theme() .. \u0026#39;\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() ğŸ“Š GitçŠ¶æ€ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -- æ·»åŠ GitçŠ¶æ€æ£€æŸ¥ä¼˜åŒ– local function setup_git_prompt() -- è®¾ç½®GitçŠ¶æ€æ£€æŸ¥é—´éš” os.execute(\u0026#39;git config --global oh-my-posh.status false\u0026#39;) -- ä»…åœ¨æœ‰.gitç›®å½•çš„æ–‡ä»¶å¤¹ä¸­æ£€æŸ¥GitçŠ¶æ€ clink.prompt.register_filter(function() if io.open(\u0026#34;.git\u0026#34;) or io.open(\u0026#34;../.git\u0026#34;) then return true end return false end) end setup_git_prompt() ğŸš€ æ•ˆç‡æå‡åŠŸèƒ½ âŒ¨ï¸ Clinkå¼ºå¤§åŠŸèƒ½é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 -- å¯ç”¨é«˜çº§Tabè¡¥å…¨ clink.install_api() clink.set_default_settings({ match.expand_environment = true, colorize_input = true, exec.enable = true, history.shared = true, history.time_format = \u0026#34;{%H:%M:%S} \u0026#34; }) -- æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤è¡¥å…¨ clink.argmatcher(\u0026#34;git\u0026#34;) :addarg({ \u0026#34;add\u0026#34;, \u0026#34;commit\u0026#34;, \u0026#34;push\u0026#34;, \u0026#34;pull\u0026#34;, \u0026#34;status\u0026#34;, \u0026#34;branch\u0026#34;, \u0026#34;checkout\u0026#34;, \u0026#34;merge\u0026#34;, \u0026#34;log\u0026#34;, \u0026#34;clone\u0026#34; }) clink.argmatcher(\u0026#34;docker\u0026#34;) :addarg({ \u0026#34;ps\u0026#34;, \u0026#34;images\u0026#34;, \u0026#34;build\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;stop\u0026#34;, \u0026#34;start\u0026#34;, \u0026#34;restart\u0026#34;, \u0026#34;logs\u0026#34;, \u0026#34;exec\u0026#34; }) ğŸ“ å‘½ä»¤åˆ«åè®¾ç½® åœ¨Clinkå®‰è£…ç›®å½•åˆ›å»ºæˆ–ç¼–è¾‘ clink_inputrc æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # å¸¸ç”¨å‘½ä»¤åˆ«å $if cmd # Gitå¿«æ·æ–¹å¼ F1: \u0026#34;git status\u0026#34; F2: \u0026#34;git add . \u0026amp;\u0026amp; git commit -m \\\u0026#34;update\\\u0026#34;\u0026#34; F3: \u0026#34;git push origin HEAD\u0026#34; # å¼€å‘å‘½ä»¤ F4: \u0026#34;npm run dev\u0026#34; F5: \u0026#34;docker-compose up -d\u0026#34; F6: \u0026#34;docker-compose down\u0026#34; # ç³»ç»Ÿå‘½ä»¤ F7: \u0026#34;cls\u0026#34; F8: \u0026#34;systeminfo\u0026#34; # è‡ªå®šä¹‰åˆ«å Alt+g: \u0026#34;git\u0026#34; Alt+d: \u0026#34;docker\u0026#34; Alt+n: \u0026#34;npm\u0026#34; $endif ğŸ”„ å†å²å‘½ä»¤å¢å¼º 1 2 3 4 5 6 7 8 9 10 11 12 -- å¯ç”¨é«˜çº§å†å²å‘½ä»¤åŠŸèƒ½ clink.set_default_settings({ history.save = true, history.max_lines = 5000, history.dupe_mode = \u0026#34;erase\u0026#34;, history.show_time = true }) -- è®¾ç½®å†å²å‘½ä»¤æœç´¢å¿«æ·é”® clink.register_match_generator(function(line) -- è‡ªå®šä¹‰å†å²æœç´¢é€»è¾‘ end) ğŸ› å¸¸è§é—®é¢˜è§£å†³ âŒ é—®é¢˜1: oh-my-poshå‘½ä»¤æœªæ‰¾åˆ° è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥oh-my-poshå®‰è£…è·¯å¾„ where oh-my-posh # å¦‚æœæœªæ‰¾åˆ°ï¼Œé‡æ–°å®‰è£… winget install JanDeDobbeleer.OhMyPosh -s winget # æ·»åŠ ç¯å¢ƒå˜é‡ setx PATH \u0026#34;%PATH%;%LOCALAPPDATA%\\Programs\\oh-my-posh\\bin\u0026#34; # æˆ–è€…åœ¨PowerShellä¸­ä¸´æ—¶æ·»åŠ è·¯å¾„ $env:Path += \u0026#34;;$env:LOCALAPPDATA\\Programs\\oh-my-posh\\bin\u0026#34; âŒ é—®é¢˜2: ä¸»é¢˜æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•åŠ è½½ è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºä¸»é¢˜ç›®å½• mkdir \u0026#34;$HOME\\.poshthemes\u0026#34; -Force # ä¸‹è½½é»˜è®¤ä¸»é¢˜é›† oh-my-posh get themes # ä¸‹è½½ç‰¹å®šä¸»é¢˜ oh-my-posh get theme atomic \u0026gt; \u0026#34;$HOME\\.poshthemes\\atomic.omp.json\u0026#34; # æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡® Test-Path \u0026#34;$HOME\\.poshthemes\\atomic.omp.json\u0026#34; âŒ é—®é¢˜3: æ€§èƒ½ç¼“æ…¢æˆ–å“åº”å»¶è¿Ÿ è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 7 8 9 10 11 -- ä½¿ç”¨æ›´è½»é‡çº§çš„ä¸»é¢˜ load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%USERPROFILE%\\\\.poshthemes\\\\negligible.omp.json\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() -- ç¦ç”¨ä¸éœ€è¦çš„æç¤ºæ®µ -- åœ¨ä¸»é¢˜JSONæ–‡ä»¶ä¸­ç§»é™¤ä¸å¿…è¦çš„segments -- å¢åŠ åˆ·æ–°é—´éš” clink.set_default_settings({ prompt_async = true, prompt_delay = 500 }) âŒ é—®é¢˜4: é¢œè‰²æ˜¾ç¤ºå¼‚å¸¸æˆ–ä¹±ç  è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 7 8 # æ£€æŸ¥æ§åˆ¶å°å±æ€§ # å³é”®æ ‡é¢˜æ  -\u0026gt; å±æ€§ -\u0026gt; é¢œè‰² -\u0026gt; é€‰æ‹©\u0026#34;å±å¹•æ–‡å­—\u0026#34; # å¯ç”¨è™šæ‹Ÿç»ˆç«¯åºåˆ— reg add HKCU\\Console /v VirtualTerminalLevel /t REG_DWORD /d 1 /f # æˆ–è€…åœ¨Windows Terminalä¸­è®¾ç½® # ç¼–è¾‘settings.jsonï¼Œç¡®ä¿supportsApplicationApiä¸ºtrue âŒ é—®é¢˜5: Clinkæœªè‡ªåŠ¨åŠ è½½ è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 7 8 # æ£€æŸ¥Clinkå®‰è£… clink --version # æ‰‹åŠ¨æ³¨å…¥Clinkåˆ°cmd clink inject # æˆ–è€…é‡æ–°è¿è¡ŒClinkå®‰è£…ç¨‹åº # ç¡®ä¿é€‰æ‹©\u0026#34;Add Clink to the default command prompt\u0026#34; ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®® ğŸ¯ é’ˆå¯¹ä¸åŒä½¿ç”¨åœºæ™¯çš„é…ç½® 1. å¼€å‘ç¯å¢ƒ ğŸ–¥ï¸\n1 2 -- æ˜¾ç¤ºGitçŠ¶æ€ã€ç¼–ç¨‹è¯­è¨€ç‰ˆæœ¬ã€ç¯å¢ƒä¿¡æ¯ load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%LOCALAPPDATA%\\\\Programs\\\\oh-my-posh\\\\themes\\\\powerline.omp.json\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() 2. æœåŠ¡å™¨ç®¡ç† ğŸ—„ï¸\n1 2 -- ç®€æ´æ˜¾ç¤ºï¼Œé‡ç‚¹åœ¨è¿æ¥ä¿¡æ¯ã€ç³»ç»ŸçŠ¶æ€ load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%LOCALAPPDATA%\\\\Programs\\\\oh-my-posh\\\\themes\\\\paradox.omp.json\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() 3. æ—¥å¸¸åŠå…¬ä½¿ç”¨ ğŸ“Š\n1 2 -- å¹³è¡¡ç¾è§‚ä¸æ€§èƒ½ï¼Œæ˜¾ç¤ºæ—¶é—´ã€è·¯å¾„ã€åŸºæœ¬çŠ¶æ€ load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;%LOCALAPPDATA%\\\\Programs\\\\oh-my-posh\\\\themes\\\\atomic.omp.json\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() ğŸŒˆ é¢œè‰²æ–¹æ¡ˆæ¨è æ·±è‰²ä¸»é¢˜ ğŸŒ™\nOne Half Dark - ä¸“ä¸šå¼€å‘è€…çš„é€‰æ‹© Material Dark - ç°ä»£åŒ–è®¾è®¡ Solarized Dark - æŠ¤çœ¼èˆ’é€‚ æµ…è‰²ä¸»é¢˜ â˜€ï¸\nOne Half Light - æ¸…æ™°çš„æ—¥é—´ä¸»é¢˜ Solarized Light - å¹³è¡¡çš„äº®è‰²æ–¹æ¡ˆ GitHub Light - ç±»ä¼¼äºGitHubçš„ç•Œé¢ âš¡ æ€§èƒ½ä¸ç¾è§‚çš„å¹³è¡¡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 -- è½»é‡çº§é«˜æ€§èƒ½é…ç½® local light_config = [[ { \u0026#34;final_space\u0026#34;: true, \u0026#34;console_title\u0026#34;: false, \u0026#34;blocks\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;prompt\u0026#34;, \u0026#34;alignment\u0026#34;: \u0026#34;left\u0026#34;, \u0026#34;segments\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;path\u0026#34;, \u0026#34;style\u0026#34;: \u0026#34;powerline\u0026#34;, \u0026#34;background\u0026#34;: \u0026#34;#61AFEF\u0026#34;, \u0026#34;foreground\u0026#34;: \u0026#34;#000000\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;style\u0026#34;: \u0026#34;folder\u0026#34;, \u0026#34;enable_hyperlink\u0026#34;: false } }, { \u0026#34;type\u0026#34;: \u0026#34;git\u0026#34;, \u0026#34;style\u0026#34;: \u0026#34;powerline\u0026#34;, \u0026#34;background\u0026#34;: \u0026#34;#98C379\u0026#34;, \u0026#34;foreground\u0026#34;: \u0026#34;#000000\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;status\u0026#34;: false } } ] } ] } ]] -- ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶åŠ è½½é…ç½® local temp_file = os.tmpname()..\u0026#34;.omp.json\u0026#34; local file = io.open(temp_file, \u0026#34;w\u0026#34;) if file then file:write(light_config) file:close() load(io.popen(\u0026#39;oh-my-posh init cmd --config \u0026#34;\u0026#39; .. temp_file .. \u0026#39;\u0026#34;\u0026#39;):read(\u0026#34;*a\u0026#34;))() os.remove(temp_file) end ğŸ”„ ç»´æŠ¤ä¸æ›´æ–° ğŸ“… å®šæœŸæ›´æ–°å·¥å…· 1 2 3 4 5 6 7 8 # æ›´æ–° oh-my-posh winget upgrade JanDeDobbeleer.OhMyPosh # æ›´æ–° Windows Terminal winget upgrade Microsoft.WindowsTerminal # æ£€æŸ¥ Clink æ›´æ–° # è®¿é—®: https://github.com/chrisant996/clink/releases ğŸ’¾ é…ç½®å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 6 7 # å¤‡ä»½é…ç½® Copy-Item \u0026#34;$HOME\\.poshthemes\u0026#34; \u0026#34;D:\\Backup\\terminal-config\\\u0026#34; -Recurse Copy-Item \u0026#34;C:\\Program Files (x86)\\clink\\*\u0026#34; \u0026#34;D:\\Backup\\clink-config\\\u0026#34; -Recurse # æ¢å¤é…ç½® Copy-Item \u0026#34;D:\\Backup\\terminal-config\\*\u0026#34; \u0026#34;$HOME\\.poshthemes\\\u0026#34; -Recurse Copy-Item \u0026#34;D:\\Backup\\clink-config\\*\u0026#34; \u0026#34;C:\\Program Files (x86)\\clink\\\u0026#34; -Recurse ğŸ’¡ ä¸“ä¸šæç¤º: å»ºè®®å®šæœŸæ›´æ–°oh-my-poshå’ŒClinkä»¥è·å¾—æœ€æ–°åŠŸèƒ½å’Œæ€§èƒ½æ”¹è¿›ã€‚å§‹ç»ˆå¤‡ä»½ä½ çš„é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·åœ¨é‡æ–°å®‰è£…ç³»ç»Ÿæˆ–æ›´æ¢ç”µè„‘æ—¶å¯ä»¥å¿«é€Ÿæ¢å¤ä½ çš„ä¸ªæ€§åŒ–è®¾ç½®ã€‚\nğŸ“ ç‰ˆæœ¬ä¿¡æ¯:\næœ¬æ–‡æ¡£æœ€åæ›´æ–°: 2024å¹´1æœˆ é€‚ç”¨ç³»ç»Ÿ: Windows 10/11 æµ‹è¯•å·¥å…·ç‰ˆæœ¬: oh-my-posh v19, Clink v1.6, Windows Terminal v1.19 ğŸ†˜ è·å–å¸®åŠ©:\noh-my-poshæ–‡æ¡£: https://ohmyposh.dev Clinkæ–‡æ¡£: https://chrisant996.github.io/clink Windows Terminalæ–‡æ¡£: https://docs.microsoft.com/windows/terminal ğŸ‰ ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼å¸Œæœ›è¿™ä¸ªç¾åŒ–æŒ‡å—èƒ½å¤§å¹…æå‡ä½ çš„å‘½ä»¤è¡Œä½“éªŒï¼\n","date":"2024-12-07T20:30:14+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/88d031f0/","title":"Windows ç»ˆç«¯ç¾åŒ– ğŸ¨"},{"content":"Nginx å¸¸ç”¨å‘½ä»¤å¤§å…¨ ğŸ§ å…¨é¢æ•´ç† Nginx Web æœåŠ¡å™¨çš„æ—¥å¸¸ç®¡ç†å‘½ä»¤ï¼Œæ¶µç›–å®‰è£…ã€é…ç½®ã€è°ƒè¯•å’Œæ•…éšœæ’é™¤ç­‰æ“ä½œ\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ Nginx ç®€ä»‹ ğŸ“‹ ä¸€ã€ç‰ˆæœ¬ä¸å®‰è£…ç®¡ç† ğŸš€ äºŒã€æœåŠ¡æ§åˆ¶å‘½ä»¤ âš™ï¸ ä¸‰ã€é…ç½®æµ‹è¯•ä¸é‡è½½ ğŸ“Š å››ã€æ—¥å¿—ä¸ç›‘æ§ ğŸ› ï¸ äº”ã€é«˜çº§è°ƒè¯•å‘½ä»¤ ğŸ’¡ å®ç”¨æŠ€å·§ä¸æç¤º ğŸš¨ æ•…éšœæ’é™¤æŒ‡å— âœ¨ Nginx ç®€ä»‹ Nginx (å‘éŸ³ä¸º\u0026quot;engine x\u0026quot;) æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„å¼€æº Web æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€ä½å†…å­˜å ç”¨å’Œå“è¶Šçš„ç¨³å®šæ€§è‘—ç§°ã€‚å®ƒä¸ä»…å¯ä»¥ç”¨ä½œ HTTP/HTTPS æœåŠ¡å™¨ï¼Œè¿˜èƒ½ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ã€é‚®ä»¶ä»£ç†æœåŠ¡å™¨å’Œé€šç”¨ TCP/UDP ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚\nä¸»è¦ç‰¹æ€§ï¼š\nğŸš€ é«˜æ€§èƒ½ï¼šé‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œèƒ½å¤Ÿå¤„ç†æ•°ä¸‡ä¸ªå¹¶å‘è¿æ¥ ğŸ“¦ ä½å†…å­˜æ¶ˆè€—ï¼šç›¸æ¯”ä¼ ç»ŸæœåŠ¡å™¨ï¼Œå†…å­˜ä½¿ç”¨æ•ˆç‡æ›´é«˜ ğŸ”§ æ¨¡å—åŒ–è®¾è®¡ï¼šæ”¯æŒåŠ¨æ€æ¨¡å—åŠ è½½ï¼Œçµæ´»æ‰©å±•åŠŸèƒ½ âš–ï¸ è´Ÿè½½å‡è¡¡ï¼šæä¾›å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ”¯æŒå¥åº·æ£€æŸ¥ ğŸ”’ å®‰å…¨æ€§ï¼šæ”¯æŒ SSL/TLS åŠ å¯†ï¼Œå„ç§å®‰å…¨å¤´éƒ¨è®¾ç½® ğŸŒ åå‘ä»£ç†ï¼šå¼ºå¤§çš„åå‘ä»£ç†åŠŸèƒ½ï¼Œæ”¯æŒç¼“å­˜å’Œå‹ç¼© ğŸ“‹ ä¸€ã€ç‰ˆæœ¬ä¸å®‰è£…ç®¡ç† 1. æŸ¥çœ‹ Nginx ç‰ˆæœ¬ ğŸ” 1 nginx -v 2. æŸ¥çœ‹è¯¦ç»†ç‰ˆæœ¬å’Œç¼–è¯‘ä¿¡æ¯ ğŸ“¦ 1 nginx -V 3. å®‰è£… Nginx (Ubuntu/Debian) â¬‡ï¸ 1 2 sudo apt update sudo apt install nginx -y 4. å®‰è£… Nginx (CentOS/RHEL) â¬‡ï¸ 1 2 sudo yum install epel-release -y sudo yum install nginx -y 5. å‡çº§ Nginx ç‰ˆæœ¬ â¬†ï¸ 1 sudo apt upgrade nginx 6. å¸è½½ Nginxï¼ˆä¿ç•™é…ç½®æ–‡ä»¶ï¼‰ğŸ—‘ï¸ 1 sudo apt remove nginx nginx-common -y 7. å®Œå…¨å¸è½½ Nginxï¼ˆåˆ é™¤é…ç½®æ–‡ä»¶ï¼‰ğŸ”¥ 1 sudo apt remove --purge nginx nginx-common -y 8. å½»åº•æ¸…é™¤ Nginxï¼ˆåˆ é™¤æ‰€æœ‰ç›¸å…³æ–‡ä»¶ï¼‰ğŸ’¥ 1 sudo apt autoremove --purge nginx -y ğŸš€ äºŒã€æœåŠ¡æ§åˆ¶å‘½ä»¤ 1. å¯åŠ¨ Nginx æœåŠ¡ â–¶ï¸ 1 sudo systemctl start nginx 2. åœæ­¢ Nginx æœåŠ¡ â¹ï¸ 1 sudo systemctl stop nginx 3. é‡å¯ Nginx æœåŠ¡ ğŸ”„ 1 sudo systemctl restart nginx 4. æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€ ğŸ“Š 1 sudo systemctl status nginx 5. è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨ ğŸ“ˆ 1 sudo systemctl enable nginx 6. ç¦ç”¨å¼€æœºè‡ªåŠ¨å¯åŠ¨ ğŸ“‰ 1 sudo systemctl disable nginx 7. æ£€æŸ¥æ˜¯å¦å·²å¯ç”¨å¼€æœºå¯åŠ¨ âœ… 1 sudo systemctl is-enabled nginx 8. é‡æ–°åŠ è½½ Bash é…ç½® ğŸ”§ 1 source ~/.bashrc 9. æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„ Nginx è¿›ç¨‹ ğŸ‘€ 1 ps aux | grep nginx âš™ï¸ ä¸‰ã€é…ç½®æµ‹è¯•ä¸é‡è½½ 1. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡® ğŸ§ª 1 nginx -t 2. æŸ¥çœ‹ Nginx æœ€ç»ˆç”Ÿæ•ˆçš„é…ç½® ğŸ“ 1 nginx -T 3. é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ğŸ”„ 1 nginx -s reload 4. æµ‹è¯•ç‰¹å®šé…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡® ğŸ¯ 1 nginx -t -c /etc/nginx/conf.d/xunlei.conf 5. ä¼˜é›…åœæ­¢ Nginxï¼ˆå¤„ç†å®Œå½“å‰è¯·æ±‚ï¼‰ğŸ›‘ 1 nginx -s quit 6. ç«‹å³åœæ­¢ Nginx âš¡ 1 nginx -s stop 7. é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ ğŸ“‚ 1 nginx -s reopen ğŸ“Š å››ã€æ—¥å¿—ä¸ç›‘æ§ 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿— ğŸ“– 1 cat /var/log/nginx/error.log 2. å®æ—¶è·Ÿè¸ªé”™è¯¯æ—¥å¿— ğŸ¥ 1 sudo tail -f /var/log/nginx/error.log 3. æŸ¥çœ‹è®¿é—®æ—¥å¿— ğŸ“– 1 cat /var/log/nginx/access.log 4. å®æ—¶è·Ÿè¸ªè®¿é—®æ—¥å¿— ğŸ¥ 1 sudo tail -f /var/log/nginx/access.log 5. ä½¿ç”¨ journalctl æŸ¥çœ‹æ—¥å¿— ğŸ–¥ï¸ 1 sudo journalctl -u nginx 6. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰â° 1 sudo tail -f /var/log/nginx/access.log | awk \u0026#39;{print strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;), $0}\u0026#39; 7. æŸ¥çœ‹ 80 ç«¯å£å ç”¨æƒ…å†µ ğŸ” 1 netstat -tulnp | grep \u0026#34;:80\u0026#34; 8. æŸ¥çœ‹ 443 ç«¯å£å ç”¨æƒ…å†µ ğŸ” 1 netstat -tulnp | grep \u0026#34;:443\u0026#34; 9. ç›‘æ§ Nginx è¿æ¥æ•° ğŸ“ˆ 1 netstat -an | grep :80 | wc -l ğŸ› ï¸ äº”ã€é«˜çº§è°ƒè¯•å‘½ä»¤ 1. æŸ¥çœ‹ Nginx è¿›ç¨‹ä¿¡æ¯ ğŸ” 1 ps aux | grep nginx 2. æ£€æŸ¥é…ç½®æ–‡ä»¶åŒ…å«å…³ç³» ğŸ§© 1 nginx -T | grep include 3. æŸ¥çœ‹ç¼–è¯‘æ—¶æ¨¡å—ä¿¡æ¯ ğŸ“¦ 1 nginx -V 4. æ£€æŸ¥ç‰¹å®šè™šæ‹Ÿä¸»æœºé…ç½® ğŸ¯ 1 nginx -T | grep -A 20 -B 5 \u0026#34;server_name example.com\u0026#34; 5. æŸ¥çœ‹å½“å‰è¿æ¥æ•°ç»Ÿè®¡ ğŸ“Š 1 netstat -an | grep :80 | awk \u0026#39;{print $6}\u0026#39; | sort | uniq -c | sort -n 6. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ç›‘å¬ç«¯å£ ğŸ§ 1 nginx -T | grep \u0026#34;listen\u0026#34; 7. æŸ¥çœ‹æœåŠ¡å™¨åç§°é…ç½® ğŸŒ 1 nginx -T | grep \u0026#34;server_name\u0026#34; 8. è°ƒè¯•ç‰¹å®š IP çš„è¿æ¥ ğŸ” 1 tcpdump -i any -n host 192.168.1.100 and port 80 ğŸ’¡ å®ç”¨æŠ€å·§ä¸æç¤º 1. é…ç½®æ£€æŸ¥æµç¨‹ âœ… 1 2 3 4 5 # æ¨èçš„æ“ä½œé¡ºåº nginx -t # å…ˆæ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡® sudo nginx -T \u0026gt; nginx.conf # å¯¼å‡ºå½“å‰é…ç½®å¤‡ä»½ sudo systemctl restart nginx # å†é‡å¯æœåŠ¡ sudo systemctl status nginx # æœ€åç¡®è®¤çŠ¶æ€ 2. æ—¥å¿—è½®è½¬ ğŸ”„ 1 2 3 4 5 6 7 # ä½¿ç”¨ logrotate è‡ªåŠ¨ç®¡ç†æ—¥å¿— sudo logrotate -f /etc/logrotate.d/nginx # æ‰‹åŠ¨åˆ‡å‰²æ—¥å¿— sudo mv /var/log/nginx/access.log /var/log/nginx/access.log.$(date +%Y%m%d) sudo mv /var/log/nginx/error.log /var/log/nginx/error.log.$(date +%Y%m%d) sudo nginx -s reopen 3. æ€§èƒ½ç›‘æ§ ğŸ“ˆ 1 2 3 4 5 6 7 8 # ç›‘æ§ Nginx è¿æ¥æ•° watch -n 1 \u0026#34;netstat -an | grep :80 | wc -l\u0026#34; # æŸ¥çœ‹å‰10ä¸ªè®¿é—®æœ€å¤šçš„IP awk \u0026#39;{print $1}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 # æŸ¥çœ‹æœ€é¢‘ç¹è®¿é—®çš„URL awk \u0026#39;{print $7}\u0026#39; /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10 4. å®‰å…¨æ£€æŸ¥ ğŸ”’ 1 2 3 4 5 6 7 8 # æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™ find /etc/nginx -type f -exec ls -la {} \\; # æ£€æŸ¥SSLé…ç½® sudo nginx -T | grep ssl_ # æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´ echo | openssl s_client -connect example.com:443 2\u0026gt;/dev/null | openssl x509 -noout -dates 5. å¤‡ä»½é…ç½® ğŸ“‚ 1 2 3 4 5 # å¤‡ä»½å½“å‰é…ç½® sudo tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx # å¯¼å‡ºå½“å‰ç”Ÿæ•ˆçš„é…ç½® sudo nginx -T \u0026gt; nginx-config-$(date +%Y%m%d).conf ğŸš¨ æ•…éšœæ’é™¤æŒ‡å— å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š ç«¯å£è¢«å ç”¨ âŒ\n1 2 3 4 # æŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ sudo lsof -i :80 # æˆ–è€… sudo netstat -tulnp | grep \u0026#34;:80\u0026#34; é…ç½®æ–‡ä»¶é”™è¯¯ ğŸ›\n1 2 3 4 # è¯¦ç»†æ£€æŸ¥é…ç½®é”™è¯¯ sudo nginx -t # æ£€æŸ¥ç‰¹å®šé…ç½®æ®µ sudo nginx -T | grep -A 10 -B 10 \u0026#34;error\u0026#34; æƒé™é—®é¢˜ ğŸ”\n1 2 3 4 5 # æ£€æŸ¥Nginxç”¨æˆ·æƒé™ sudo -u nginx stat /var/www/html # ä¿®å¤æ–‡ä»¶æƒé™ sudo chown -R nginx:nginx /var/www/html sudo chmod -R 755 /var/www/html æ¨¡å—ç¼ºå¤± ğŸ“¦\n1 2 3 4 # æŸ¥çœ‹å·²ç¼–è¯‘æ¨¡å— nginx -V 2\u0026gt;\u0026amp;1 | grep -- \u0026#39;--with-\u0026#39; # æŸ¥çœ‹åŠ¨æ€åŠ è½½çš„æ¨¡å— sudo nginx -T | grep \u0026#34;load_module\u0026#34; æ€§èƒ½é—®é¢˜ ğŸ¢\n1 2 3 4 # æ£€æŸ¥å·¥ä½œè¿›ç¨‹æ•°é‡ ps aux | grep nginx | grep -v grep | wc -l # ç›‘æ§æœåŠ¡å™¨çŠ¶æ€ sudo nginx -T | grep -i \u0026#34;status\u0026#34; SSLè¯ä¹¦é—®é¢˜ ğŸ”’\n1 2 3 4 # æ£€æŸ¥è¯ä¹¦é“¾ openssl s_client -connect example.com:443 -servername example.com # éªŒè¯è¯ä¹¦ openssl verify -CAfile /path/to/ca.crt /path/to/site.crt ğŸ’¡ æç¤ºï¼šä¿®æ”¹é…ç½®åï¼ŒåŠ¡å¿…ä½¿ç”¨ nginx -t æµ‹è¯•è¯­æ³•ï¼Œç„¶åå†é‡è½½é…ç½®ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®å˜æ›´ã€‚\nç´§æ€¥æ¢å¤æ­¥éª¤ ğŸ†˜ å¤‡ä»½å½“å‰é…ç½®ï¼šsudo cp -r /etc/nginx /etc/nginx.backup æ£€æŸ¥é…ç½®ï¼šsudo nginx -t å¦‚æœé…ç½®é”™è¯¯ï¼Œæ¢å¤å¤‡ä»½ï¼šsudo cp -r /etc/nginx.backup/* /etc/nginx/ é‡å¯æœåŠ¡ï¼šsudo systemctl restart nginx æŸ¥çœ‹æ—¥å¿—ï¼šsudo tail -f /var/log/nginx/error.log å¸Œæœ›è¿™ä»½å®Œæ•´çš„ Nginx å‘½ä»¤æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç†æ‚¨çš„ Web æœåŠ¡å™¨ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·å‚è€ƒ Nginx å®˜æ–¹æ–‡æ¡£ æˆ–ç¤¾åŒºèµ„æºã€‚\n","date":"2024-12-07T20:28:13+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/553bea14/","title":"Nginx å¸¸ç”¨å‘½ä»¤å¤§å…¨ ğŸ§"},{"content":"Docker éƒ¨ç½² IPTV-Sources ç›´æ’­æºæ”¶é›†æœåŠ¡ ğŸ“º ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IPTV-Sources 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ IPTV-Sources 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. ä¸»è¦åŠŸèƒ½ ğŸ¯ 3. å¯¼å‡ºç›´æ’­æº ğŸ’¾ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç›´æ’­æºç®¡ç†ï¼Œæ¢ç´¢æ— é™è§†ç•Œ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/HerbertHe/iptv-sources ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/herberthe0229/iptv-sources IPTV-Sources æ˜¯ä¸€æ¬¾è‡ªåŠ¨åŒ–çš„ç›´æ’­æºæ”¶é›†å’Œç®¡ç†æœåŠ¡ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºèšåˆã€éªŒè¯å’Œæ•´ç†ç›´æ’­æºã€‚å®ƒæä¾›ç®€å•æ˜“ç”¨çš„ Web ç•Œé¢ï¼Œæ”¯æŒè‡ªåŠ¨æ›´æ–°å’Œå®šæ—¶ä»»åŠ¡ï¼Œå¸®åŠ©ç”¨æˆ·è·å–é«˜è´¨é‡ã€ç¨³å®šçš„ç›´æ’­æºã€‚ğŸŒ\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”„ è‡ªåŠ¨æ”¶é›† ä»å¤šä¸ªæ¥æºè‡ªåŠ¨è·å–ç›´æ’­æº æ— éœ€æ‰‹åŠ¨æ”¶é›†ï¼ŒèŠ‚çœæ—¶é—´ âœ… æºéªŒè¯ è‡ªåŠ¨æ£€æµ‹å’ŒéªŒè¯ç›´æ’­æºæœ‰æ•ˆæ€§ ç¡®ä¿ç›´æ’­æºè´¨é‡ï¼Œå‡å°‘æ— æ•ˆé“¾æ¥ ğŸ“Š åˆ†ç±»ç®¡ç† æŒ‰ç±»å‹å’Œåœ°åŒºå¯¹ç›´æ’­æºè¿›è¡Œåˆ†ç±» æ–¹ä¾¿æŸ¥æ‰¾å’Œç®¡ç† â° å®šæ—¶æ›´æ–° æ”¯æŒå®šæ—¶è‡ªåŠ¨æ›´æ–°ç›´æ’­æº ä¿æŒç›´æ’­æºæ–°é²œåº¦ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker ä¸€é”®éƒ¨ç½²ï¼Œç®€å•æ˜“ç”¨ å¿«é€Ÿéƒ¨ç½²ï¼Œæ˜“äºç»´æŠ¤ ğŸŒ Web ç•Œé¢ æä¾›å‹å¥½çš„ Web ç®¡ç†ç•Œé¢ ç›´è§‚æ˜“ç”¨ï¼Œæ— éœ€å‘½ä»¤è¡Œæ“ä½œ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IPTV-Sources 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/iptv-sources \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: iptv-sources: image: herberthe0229/iptv-sources:latest container_name: iptv-sources ports: - \u0026#34;4000:8080\u0026#34; # ğŸŒ ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ volumes: - ./data:/app/data # ğŸ’¾ æ•°æ®æŒä¹…åŒ–ç›®å½• environment: - TZ=Asia/Shanghai # â° æ—¶åŒºè®¾ç½® restart: unless-stopped # ğŸ”„ è‡ªåŠ¨é‡å¯ healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8080\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ IPTV-Sources 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:4000 åŸŸåè®¿é—®: https://iptv-sources.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. ä¸»è¦åŠŸèƒ½ ğŸ¯ åŠŸèƒ½ æ“ä½œæ–¹å¼ è¯´æ˜ ğŸ“¡ ç›´æ’­æºç®¡ç† Web ç•Œé¢æ“ä½œ æŸ¥çœ‹ã€ç­›é€‰å’Œç®¡ç†ç›´æ’­æº âœ… æºéªŒè¯ è‡ªåŠ¨æ£€æµ‹ æ ‡è®°æ— æ•ˆæºï¼Œç¡®ä¿è´¨é‡ ğŸ”„ è‡ªåŠ¨æ›´æ–° å®šæ—¶ä»»åŠ¡/æ‰‹åŠ¨è§¦å‘ ä¿æŒç›´æ’­æºæ–°é²œåº¦ âš™ï¸ é…ç½®ç®¡ç† ç•Œé¢è®¾ç½® è‡ªå®šä¹‰æ›´æ–°é¢‘ç‡å’Œç­›é€‰è§„åˆ™ 3. å¯¼å‡ºç›´æ’­æº ğŸ’¾ M3U æ ¼å¼å¯¼å‡º\né€‚ç”¨äºå¤§å¤šæ•°æ’­æ”¾å™¨ åŒ…å«é¢‘é“ä¿¡æ¯å’Œåˆ†ç»„ TXT æ ¼å¼å¯¼å‡º\nç®€å•åˆ—è¡¨æ ¼å¼ é€‚ç”¨äºç‰¹å®šåº”ç”¨ API è®¿é—®\né€šè¿‡ REST API è·å–ç›´æ’­æº æ”¯æŒç­›é€‰å’Œåˆ†é¡µ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://iptv-sources.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/iptv-sources.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name iptv-sources.example.com; # ğŸŒ è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; # å®‰å…¨å¤´éƒ¨ add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ€§èƒ½ä¼˜åŒ– sendfile on; tcp_nopush on; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://localhost:4000; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; # ç¼“å†²è®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; proxy_max_temp_file_size 0; } # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/iptv-sources # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop iptv-sources # åœæ­¢å®¹å™¨ docker start iptv-sources # å¯åŠ¨å®¹å™¨ docker restart iptv-sources # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm iptv-sources # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f iptv-sources # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it iptv-sources sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect iptv-sources # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats iptv-sources # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs iptv-sources # æŸ¥çœ‹æ—¥å¿— docker logs -f iptv-sources # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 iptv-sources # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t iptv-sources # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— ## å¥åº·æ£€æŸ¥ docker inspect --format=\u0026#39;{{.State.Health.Status}}\u0026#39; iptv-sources 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªç›´æ’­æºç®¡ç†ï¼Œæ¢ç´¢æ— é™è§†ç•Œ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† IPTV-Sources ç›´æ’­æºæ”¶é›†æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“º éšæ—¶éšåœ° è·å–é«˜è´¨é‡ç›´æ’­æºï¼Œè‡ªåŠ¨ä»å¤šä¸ªæ¥æºèšåˆã€éªŒè¯å’Œæ•´ç†ï¼Œç¡®ä¿ç¨³å®šå¯é çš„è§‚çœ‹ä½“éªŒ\nğŸ”„ å®Œå…¨è‡ªä¸» æŒæ§ç›´æ’­æºè´¨é‡ï¼Œè‡ªåŠ¨è¿‡æ»¤æ— æ•ˆé“¾æ¥ï¼Œå®šæ—¶æ›´æ–°ä¿æŒæºçš„æ–°é²œåº¦å’Œå¯ç”¨æ€§\nğŸ” éšç§å®‰å…¨ æ‰€æœ‰æ•°æ®å¤„ç†åœ¨æœ¬åœ°å®Œæˆï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œä¿éšœä¸ªäººè§‚çœ‹åå¥½å’Œéšç§\nâš¡ é«˜æ•ˆä¾¿æ· ç®€å•æ˜“ç”¨çš„ Web ç•Œé¢ï¼Œæ— éœ€å¤æ‚æ“ä½œå³å¯ç®¡ç†å¤§é‡ç›´æ’­æºï¼Œæå‡ä½¿ç”¨æ•ˆç‡\nå½±éŸ³æ— ç•Œï¼Œæºéšå¿ƒåŠ¨ã€‚æ„¿ IPTV-Sources æˆä¸ºä½ å®¶åº­å¨±ä¹çš„å¾—åŠ›åŠ©æ‰‹ï¼Œæ‰“ç ´é¢‘é“é™åˆ¶ï¼Œå¼€å¯è§†å¬æ–°ä½“éªŒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ•´ç†æ”¶è—ï¼Œå‘ç°ç²¾å½©â€”â€”æ„å»ºä½ ä¸“å±çš„é«˜æ¸…ç›´æ’­æºåº“å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ IPTV-Sources é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§‚çœ‹æ„‰å¿«ï¼Œç²¾å½©ä¸æ–­ï¼ğŸ‰\n","date":"2024-12-07T20:24:56+08:00","image":"https://file.meimolihan.eu.org/img/iptv-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ca8d60d7/","title":"Docker éƒ¨ç½² IPTV-Sources ç›´æ’­æºæ”¶é›†æœåŠ¡ ğŸ“º"},{"content":"Caddy é…ç½®æ–‡ä»¶åŒæ­¥ ä¸€ ã€1panel è®¡åˆ’ä»»åŠ¡ï¼ˆcaddyé…ç½®åŒæ­¥ï¼‰ï¼ˆæš‚æ—¶å¼ƒç”¨ï¼‰ 1 ã€åœ¨ Ubuntu ä¸»æœºshellç»ˆç«¯ åˆ›å»ºè„šæœ¬ğŸ’¡\u0026lsquo;EOF\u0026rsquo; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 mkdir -p /mnt/mydisk/my-sh/rsync \u0026amp;\u0026amp; touch /mnt/mydisk/my-sh/rsync/caddy-rsync.sh \u0026amp;\u0026amp; chmod +x /mnt/mydisk/my-sh/rsync/caddy-rsync.sh \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/my-sh/rsync/caddy-rsync.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # è·å–å¼€å§‹æ—¶é—´ start_time=$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) start_timestamp=$(date +%s) echo \u0026#34;åŒæ­¥å¼€å§‹ï¼š$start_time\u0026#34; # æ£€æŸ¥æ˜¯å¦å®‰è£…äº†rsync if ! command -v rsync \u0026amp;\u0026gt; /dev/null; then echo \u0026#34;rsyncæœªå®‰è£…ï¼Œæ­£åœ¨å°è¯•å®‰è£…...\u0026#34; sudo apt-get update if sudo apt-get install -y rsync; then echo \u0026#34;rsyncå®‰è£…æˆåŠŸ\u0026#34; else echo \u0026#34;rsyncå®‰è£…å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å®‰è£…åå†è¯•\u0026#34; \u0026gt;\u0026amp;2 exit 1 fi else echo \u0026#34;rsyncå·²å®‰è£…ï¼Œæ— éœ€é‡æ–°å®‰è£…\u0026#34; fi ##---------------------- ä½ è¦ä¿®æ”¹çš„åœ°æ–¹ ----------------------## # å®šä¹‰æºç›®å½• source_dir=\u0026#34;/mnt/mydisk/home/\u0026#34; # å®šä¹‰ç›®æ ‡ç›®å½•æ•°ç»„ target_dirs=( \u0026#34;/mnt/Ubuntu-NFS/home/\u0026#34; # åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šçš„ç›®æ ‡ç›®å½• ) ##---------------------- ä½ è¦ä¿®æ”¹çš„åœ°æ–¹ ----------------------## # å‡½æ•°ç”¨äºåŒæ­¥ç›®å½•å¹¶è®¡ç®—ä¼ è¾“å®Œæˆåº¦ sync_and_check() { local source_dir=$1 local target_dir=$2 local dir_name=$3 # æ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»º if [ ! -d \u0026#34;$target_dir\u0026#34; ]; then echo \u0026#34;ç›®æ ‡ç›®å½• $target_dir ä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»º...\u0026#34; mkdir -p \u0026#34;$target_dir\u0026#34; if [ $? -ne 0 ]; then echo \u0026#34;åˆ›å»ºç›®æ ‡ç›®å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™ã€‚\u0026#34; \u0026gt;\u0026amp;2 return 1 fi fi # æ‰§è¡ŒåŒæ­¥æ“ä½œ rsync -avhzp --progress --delete \u0026#34;$source_dir\u0026#34; \u0026#34;$target_dir\u0026#34; 2\u0026gt;\u0026amp;1 local rsync_status=$? # è®¡ç®—æºç›®å½•å’Œç›®æ ‡ç›®å½•çš„æ–‡ä»¶å¤§å° local source_size=$(du -sb \u0026#34;$source_dir\u0026#34; | cut -f1) local target_size=$(du -sb \u0026#34;$target_dir\u0026#34; | cut -f1) # è®¡ç®—ä¼ è¾“å®Œæˆåº¦ local completion if [ \u0026#34;$target_size\u0026#34; -gt 0 ] \u0026amp;\u0026amp; [ \u0026#34;$source_size\u0026#34; -gt 0 ]; then completion=$(awk \u0026#34;BEGIN {printf \\\u0026#34;%.2f\\\u0026#34;, ($target_size / $source_size) * 100}\u0026#34;) else completion=\u0026#34;0.00\u0026#34; fi # è¾“å‡ºç»“æœ if [ $rsync_status -eq 0 ]; then echo \u0026#34;åŒæ­¥æ“ä½œæˆåŠŸå®Œæˆï¼ˆ$dir_nameï¼‰ï¼š\u0026#34; echo \u0026#34;- ä¼ è¾“å®Œæˆåº¦: ${completion}%\u0026#34; else echo \u0026#34;åŒæ­¥å¤±è´¥ï¼ˆ$dir_nameï¼‰ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚\u0026#34; fi } # å¾ªç¯éå†æ‰€æœ‰ç›®æ ‡ç›®å½•å¹¶åŒæ­¥ for index in \u0026#34;${!target_dirs[@]}\u0026#34;; do target_dir=\u0026#34;${target_dirs[$index]}\u0026#34; dir_name=\u0026#34;è·¯å¾„$((index + 1))\u0026#34; sync_and_check \u0026#34;$source_dir\u0026#34; \u0026#34;$target_dir\u0026#34; \u0026#34;$dir_name\u0026#34; done echo \u0026#34;--------------------------------\u0026#34; echo \u0026#34;åŒæ­¥å¼€å§‹ï¼š$start_time\u0026#34; echo \u0026#34;--------------------------------\u0026#34; # è·å–ç»“æŸæ—¶é—´ end_time=$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) end_timestamp=$(date +%s) echo \u0026#34;åŒæ­¥å®Œæˆï¼š$end_time\u0026#34; echo \u0026#34;--------------------------------\u0026#34; # è®¡ç®—æ€»ç”¨æ—¶ total_time=$((end_timestamp - start_timestamp)) echo \u0026#34;è„šæœ¬æ‰§è¡Œæ€»ç”¨æ—¶ï¼š$total_time ç§’\u0026#34; echo \u0026#34;--------------------------------\u0026#34; echo \u0026#34;æºç›®å½•è·¯å¾„ ï¼š$source_dir\u0026#34; echo \u0026#34;ç›®æ ‡ç›®å½•åˆ—è¡¨ï¼š\u0026#34; printf \u0026#39; %s\\n\u0026#39; \u0026#34;${target_dirs[@]}\u0026#34; echo \u0026#34;--------------------------------\u0026#34; EOF 2 ã€1panel è®¡åˆ’ä»»åŠ¡ï¼ˆcaddyé…ç½®åŒæ­¥ï¼‰ 1 /mnt/mydisk/my-sh/rsync/caddy-rsync.sh äºŒ ã€Linux è®¡åˆ’ä»»åŠ¡ï¼ˆcaddyé…ç½®åŒæ­¥ï¼‰ï¼ˆæ­£åœ¨ä½¿ç”¨ï¼‰ 1 ã€æ·»åŠ è®¡åˆ’ä»»åŠ¡ï¼ˆè¿½åŠ å‘½ä»¤ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 ## æ¯æ—¥02:10åŒæ­¥ caddy é™æ€ç›®å½• { crontab -l; echo \u0026#34;\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;## æ¯æ—¥02:10åŒæ­¥ caddy é™æ€ç›®å½•\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;10 2 * * * mkdir -p /mnt/ARS2-NFS/åå‘ä»£ç†/caddy-bak/html \u0026amp;\u0026amp; rsync -avhzp --progress --delete /var/www/html/* /mnt/ARS2-NFS/åå‘ä»£ç†/caddy-bak/html/\u0026#34;; } | crontab - ## æ¯æ—¥02:15,åŒæ­¥ caddy é…ç½®æ–‡ä»¶ç›®å½• { crontab -l; echo \u0026#34;\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;## æ¯æ—¥02:15,åŒæ­¥ caddy é…ç½®æ–‡ä»¶ç›®å½•\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;15 2 * * * mkdir -p /mnt/ARS2-NFS/åå‘ä»£ç†/caddy-bak/caddy \u0026amp;\u0026amp; rsync -avhzp --progress --delete /usr/local/caddy/* /mnt/ARS2-NFS/åå‘ä»£ç†/caddy-bak/caddy/\u0026#34;; } | crontab - crontab -l ## æŸ¥çœ‹æ˜¯å¦æˆåŠŸ 2 ã€åˆ—å‡ºå½“å‰ç”¨æˆ·çš„Cronä»»åŠ¡ 1 crontab -l 3 ã€ç¼–è¾‘Cronä»»åŠ¡ 1 crontab -e 4 ã€åˆ é™¤å½“å‰ç”¨æˆ·çš„æ‰€æœ‰Cronä»»åŠ¡ 1 crontab -r ","date":"2024-12-07T20:24:08+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/48321631/","title":"Caddy é…ç½®æ–‡ä»¶åŒæ­¥"},{"content":"TMDB Hosts è‡ªåŠ¨æ›´æ–°ä¸åŒæ­¥ DnsParse è„šæœ¬ \u0026amp; æœ¬åœ°ç‰ˆ ğŸŒŸ æœ¬æ–‡ä»‹ç»ä¸€å¥—ç”¨äºè‡ªåŠ¨æ›´æ–° TMDB ç›¸å…³åŸŸåçš„ DNS è§£æè®°å½•ï¼Œå¹¶å°†å…¶åŒæ­¥åˆ°å¸¸ç”¨åª’ä½“æœåŠ¡ï¼ˆå¦‚ Embyã€Nastoolsï¼‰çš„æœ¬åœ°è„šæœ¬å·¥å…·é›†ã€‚æ‰€æœ‰è„šæœ¬å‡å¯ç›´æ¥åœ¨æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ä¾èµ–è¿œç¨‹èµ„æºã€‚\nğŸ±GitHubé¡¹ç›®åœ°å€ï¼š https://github.com/myzhongqiang/DNS-TMDB/tree/main ğŸ“– ç›®å½•å¯¼èˆª âœ¨ è„šæœ¬ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ å®‰è£… Python3 ğŸ”§ DnsParse.py æœ¬åœ°é…ç½® â° è®¡åˆ’ä»»åŠ¡è®¾ç½® ğŸ“‹ æŸ¥çœ‹æ‰§è¡Œç»“æœ âœ¨ è„šæœ¬ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸŒ å¤š DNS æä¾›å•†æ”¯æŒï¼šä½¿ç”¨å¤šä¸ªå…¬å…± DNS è§£ææœåŠ¡è·å–æœ€æ–°çš„ IP åœ°å€ï¼Œæé«˜è§£ææˆåŠŸç‡ã€‚ ğŸ“ æ™ºèƒ½ IP ç­›é€‰ï¼šè‡ªåŠ¨ Ping æµ‹è¯•æ‰€æœ‰è§£æåˆ°çš„ IPï¼Œä»…ä¿ç•™å¯è¿é€šçš„é«˜è´¨é‡ IPã€‚ ğŸ’¾ æ— æŸæ›´æ–° Hostsï¼šé‡‡ç”¨æ ‡è®°å—ï¼ˆ###start### ä¸ ###end###ï¼‰æ–¹å¼æ›´æ–°ï¼Œä¿ç•™åŸæœ‰ hosts å†…å®¹ã€‚ ğŸ“‚ å¤šæœåŠ¡åŒæ­¥ï¼šæ”¯æŒå°†æ›´æ–°åçš„ hosts æ–‡ä»¶è‡ªåŠ¨åŒæ­¥åˆ° Emby å’Œ Nastools çš„é…ç½®ç›®å½•ã€‚ â° å®Œå…¨æœ¬åœ°åŒ–ï¼šæ‰€æœ‰è„šæœ¬å’Œé…ç½®å‡å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ— éœ€ç½‘ç»œè®¿é—®å³å¯æ‰§è¡Œã€‚ ğŸ å®‰è£… Python3 1 sudo apt update \u0026amp;\u0026amp; sudo apt install python3 -y ğŸ”§ DnsParse.py æœ¬åœ°é…ç½® ä¸‹è½½æˆ–åˆ›å»ºè„šæœ¬ ç›´æ¥ä¸‹è½½ï¼š DnsParse.py ä¸‹è½½ æ‰‹åŠ¨åˆ›å»ºè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 mkdir -p /mnt/mydisk/my-sh/hosts \u0026amp;\u0026amp; touch /mnt/mydisk/my-sh/hosts/DnsParse.py \u0026amp;\u0026amp; chmod +x /mnt/mydisk/my-sh/hosts/DnsParse.py \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/my-sh/hosts/DnsParse.py \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; import datetime import json import platform import requests from subprocess import Popen, PIPE # dnsè§£æç”¨åˆ°çš„api api = \u0026#34;http://api.ip33.com/dns/resolver\u0026#34; # å¾…è§£æçš„åŸŸå hosts = [\u0026#34;api.themoviedb.org\u0026#34;, \u0026#34;image.tmdb.org\u0026#34;, \u0026#34;www.themoviedb.org\u0026#34;] # dnsæœåŠ¡å•† dnsProvider = [\u0026#34;156.154.70.1\u0026#34;, \u0026#34;208.67.222.222\u0026#34;] # hostæ–‡ä»¶çš„ä½ç½® hostLocate = \u0026#34;/etc/hosts\u0026#34; # æ‰¹é‡ping def pingBatch(ips): if ips is not None and type(ips) == list: for ip in ips[:]: # ä½¿ç”¨[:]å¤åˆ¶ipsåˆ—è¡¨ï¼Œä»¥é¿å…åœ¨è¿­ä»£æ—¶ä¿®æ”¹åŸåˆ—è¡¨ result = pingIp(ip) if not result: ips.remove(ip) # ping ipè¿”å›ipæ˜¯å¦è¿é€š def pingIp(ip) -\u0026gt; bool: try: ping_process = Popen([\u0026#34;ping\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;1\u0026#34;, ip], stdout=PIPE, stderr=PIPE) ping_output, ping_error = ping_process.communicate() if ping_process.returncode == 0: print(f\u0026#34;[âˆš] IP:{ip} å¯ä»¥pingé€š\u0026#34;) return True else: print(f\u0026#34;[Ã—] IP:{ip} æ— æ³•pingé€š\u0026#34;) return False except Exception as e: print(f\u0026#34;Ping IP:{ip} å‡ºé”™ï¼š{str(e)}\u0026#34;) return False # è¿”å›hostå¯¹åº”domainçš„è§£æç»“æœåˆ—è¡¨ def analysis(domain, dns) -\u0026gt; list: params = { \u0026#34;domain\u0026#34;: domain, \u0026#34;type\u0026#34;: \u0026#34;A\u0026#34;, \u0026#34;dns\u0026#34;: dns } headers = { \u0026#34;User-Agent\u0026#34;: \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36 Edg/117.0.2045.60\u0026#34; } try: response = requests.post(url=api, data=params, headers=headers) ipDics = json.loads(response.text)[\u0026#34;record\u0026#34;] ips = [dic[\u0026#34;ip\u0026#34;] for dic in ipDics] return ips except Exception as e: print(\u0026#34;è§£ædnså‡ºé”™ï¼š\u0026#34;) print(e) # å†™å…¥hostä¿¡æ¯ def hostWritor(hostDic): platInfo = platform.platform().UPER() if \u0026#34;LINUX\u0026#34; in platInfo: hostFile = \u0026#34;/etc/hosts\u0026#34; else: print(\u0026#34;æœªèƒ½è¯†åˆ«å½“å‰æ“ä½œç³»ç»Ÿï¼Œä¸”ç”¨æˆ·æœªæŒ‡å®šhostæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼\u0026#34;) return origin = \u0026#34;\u0026#34; with open(hostFile, \u0026#34;r\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) as f: # ä¹‹å‰æ˜¯å¦å·²ç»å†™è¿‡dnsä¿¡æ¯ flag = False for eachLine in f.readlines(): if r\u0026#34;###start###\u0026#34; in eachLine: flag = True elif r\u0026#34;###end###\u0026#34; in eachLine: flag = False else: if not flag: origin = origin + eachLine # å†™å…¥æ–°çš„hostè®°å½• origin = origin.strip() origin = origin + \u0026#34;\\n###start###\\n\u0026#34; for eachHost in hostDic: for eachIp in hostDic[eachHost]: origin = origin + eachIp + \u0026#34;\\t\u0026#34; + eachHost + \u0026#34;\\n\u0026#34; origin = origin + \u0026#34;###æœ€åæ›´æ–°æ—¶é—´:%s###\\n\u0026#34; % datetime.datetime.now().strftime(\u0026#39;%Y-%m-%d %H:%M:%S\u0026#39;) origin = origin + \u0026#34;###end###\\n\u0026#34; with open(hostFile, \u0026#34;w\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) as f: f.write(origin) if __name__ == \u0026#39;__main__\u0026#39;: resultDic = {} for host in hosts: for dns in dnsProvider: records = analysis(host, dns) pingBatch(records) if records is not None and len(records) \u0026gt; 0: if host not in resultDic: resultDic[host] = records else: resultDic[host] += records hostWritor(resultDic) EOF æŸ¥çœ‹è„šæœ¬å†…å®¹ 1 cat /mnt/mydisk/my-sh/hosts/DnsParse.py æŸ¥è¯¢ Python3 å®‰è£…è·¯å¾„ 1 which python3 Debian ç³»ç»Ÿé€šå¸¸å®‰è£…åœ¨ï¼š/usr/bin/python3\næ‰§è¡Œè„šæœ¬ 1 /usr/bin/python3 /mnt/mydisk/my-sh/hosts/DnsParse.py è¯·å°† /usr/bin/python3 æ›¿æ¢ä¸ºæ‚¨ç³»ç»Ÿä¸Š which python3 æŸ¥è¯¢å¾—åˆ°çš„å®é™…è·¯å¾„ï¼› å°† /mnt/mydisk/my-sh/hosts/DnsParse.py ä¿®æ”¹ä¸ºæ‚¨å®é™…å­˜æ”¾ DnsParse.py æ–‡ä»¶çš„è·¯å¾„ã€‚\nâ° è®¡åˆ’ä»»åŠ¡è®¾ç½® ä»¥ä¸‹å‘½ä»¤å°†è‡ªåŠ¨è®¾ç½®è®¡åˆ’ä»»åŠ¡ï¼Œå®ç°æ¯å¤©è‡ªåŠ¨æ›´æ–° hosts å¹¶åŒæ­¥åˆ°ç›¸å…³æœåŠ¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æ·»åŠ ç©ºè¡Œå’Œæ³¨é‡Š { crontab -l; echo \u0026#34;\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;## æ·»åŠ æ›´æ–°hostsæ–‡ä»¶å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹ååˆ†æ‰§è¡Œ\u0026#34;; } | crontab - # æ·»åŠ TMDB hostsæ›´æ–°ä»»åŠ¡ { crontab -l; echo \u0026#34;10 1 * * * /usr/bin/python3 /mnt/mydisk/my-sh/hosts/DnsParse.py\u0026#34;; } | crontab - # æ·»åŠ ç©ºè¡Œå’Œæ³¨é‡Š { crontab -l; echo \u0026#34;\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;## åŒæ­¥hostsåˆ°embyï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹åäº”åˆ†æ‰§è¡Œ\u0026#34;; } | crontab - # æ·»åŠ embyåŒæ­¥ä»»åŠ¡ { crontab -l; echo \u0026#34;15 1 * * * rsync -avhzp --progress --delete /etc/hosts /mnt/mydisk/home/emby-amilys/config/hosts\u0026#34;; } | crontab - # æ·»åŠ ç©ºè¡Œå’Œæ³¨é‡Š { crontab -l; echo \u0026#34;\u0026#34;; } | crontab - { crontab -l; echo \u0026#34;## åŒæ­¥hostsåˆ°nastoolsï¼Œæ¯å¤©å‡Œæ™¨ä¸€ç‚¹äºŒååˆ†æ‰§è¡Œ\u0026#34;; } | crontab - # æ·»åŠ nastoolsåŒæ­¥ä»»åŠ¡ { crontab -l; echo \u0026#34;20 1 * * * rsync -avhzp --progress --delete /etc/hosts /mnt/mydisk/home/nastools/config/hosts\u0026#34;; } | crontab - # æŸ¥çœ‹å·²è®¾ç½®çš„è®¡åˆ’ä»»åŠ¡ crontab -l æ‰‹åŠ¨ç¼–è¾‘è®¡åˆ’ä»»åŠ¡ 1 crontab -e ä½¿ç”¨æ­¤å‘½ä»¤å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘å’Œè°ƒæ•´è®¡åˆ’ä»»åŠ¡è®¾ç½®ã€‚\nğŸ“‹ æŸ¥çœ‹æ‰§è¡Œç»“æœ æ£€æŸ¥ hosts æ›´æ–°æ˜¯å¦æˆåŠŸ 1 cat /etc/hosts æ£€æŸ¥åŒæ­¥åˆ° Emby çš„ hosts æ–‡ä»¶ 1 cat /mnt/mydisk/home/emby-amilys/config/hosts æ£€æŸ¥åŒæ­¥åˆ° Nastools çš„ hosts æ–‡ä»¶ 1 cat /mnt/mydisk/home/nastools/config/hosts è¯·å°†ä¸Šè¿°è·¯å¾„æ›¿æ¢ä¸ºæ‚¨å®é™…çš„ Emby å’Œ Nastools é…ç½®ç›®å½•è·¯å¾„ã€‚\nğŸ’¡ æç¤ºï¼šé¦–æ¬¡è¿è¡Œå‰è¯·ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼Œå¹¶ä¸”ç›¸å…³ç›®å½•å­˜åœ¨ã€‚å¯æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚è·¯å¾„è¯·æ ¹æ®æ‚¨çš„å®é™…ç¯å¢ƒè¿›è¡Œç›¸åº”è°ƒæ•´ã€‚\n","date":"2024-12-07T20:14:59+08:00","image":"https://file.meimolihan.eu.org/img/tmdb-01.webp","permalink":"https://blog.meimolihan.eu.org/p/92f30729/","title":"TMDB Hosts è‡ªåŠ¨æ›´æ–°ä¸åŒæ­¥ DnsParse è„šæœ¬ \u0026 æœ¬åœ°ç‰ˆ ğŸŒŸ"},{"content":"Nginx + Caddy æ–‡ä»¶æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— ğŸš€ ğŸŒŸ æ¦‚è¿° æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ Nginx å’Œ Caddy æ­å»ºé«˜æ€§èƒ½çš„æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚\nğŸ“‹ éƒ¨ç½²æ¶æ„ 1 ç”¨æˆ·è¯·æ±‚ â†’ Nginx (è´Ÿè½½å‡è¡¡) â†’ Caddy (æ–‡ä»¶æœåŠ¡) ğŸ”§ Caddy æ–‡ä»¶æœåŠ¡å™¨éƒ¨ç½² Caddy éƒ¨ç½²æ–‡ä»¶ä¸‹è½½æœåŠ¡å™¨æ•™ç¨‹ï¼š\nhttps://t.mobufan.eu.org:666/archives/911/#cl-2 âš¡ Nginx åå‘ä»£ç†é…ç½® Nginx ä¸‹è½½æœåŠ¡åœ°å€ï¼š https://file.mobufan.eu.org:666 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # åˆ›å»ºé…ç½®ç›®å½•å’Œæ–‡ä»¶ mkdir -pm 755 /etc/nginx/conf.d touch /etc/nginx/conf.d/file.conf # ç”Ÿæˆ Nginx é…ç½®æ–‡ä»¶ cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026gt; /etc/nginx/conf.d/file.conf ## nginx åå‘ä»£ç†+è´Ÿè½½å‡è¡¡: caddy ä¸‹è½½æœåŠ¡ upstream mysvr1 { server 10.10.10.245:11300; ## è´Ÿè½½å‡è¡¡-çƒ­å¤‡æ¨¡å¼ï¼šæœ‰2å°æœåŠ¡å™¨ï¼Œä¸€å°æœåŠ¡å™¨å®•æœºæ—¶ï¼Œæ‰å¯ç”¨ç¬¬äºŒå°æœåŠ¡å™¨æä¾›æœåŠ¡ server 10.10.10.247:11300 backup; ## çƒ­å¤‡ } server { ## ç›‘å¬666ç«¯å£ï¼Œå¹¶å¯ç”¨SSL listen 666 ssl; listen [::]:666 ssl; ## æ›¿æ¢ä¸ºä½ çš„åŸŸå server_name file.mobufan.eu.org; ## SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_ciphers HIGH:!aNULL:!MD5; location / { ## åå‘ä»£ç†åˆ°è´Ÿè½½å‡è¡¡ç»„ proxy_pass http://mysvr1; ## æ·»åŠ è°ƒè¯•å¤´ä¿¡æ¯ add_header backendIP $upstream_addr; add_header backendCode $upstream_status; ## ä¼ é€’å¿…è¦çš„å¤´ä¿¡æ¯ proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; ## å¼€å¯ç¼“å­˜ proxy_http_version 1.1; } } EOF # é‡å¯ Nginx æœåŠ¡ sudo systemctl restart nginx ğŸ“ æ–‡ä»¶è·¯å¾„ç®¡ç† 1. æœ¬åœ°æ–‡ä»¶å­˜å‚¨è·¯å¾„ 1 /mnt/file 2. è¿›å…¥æ–‡ä»¶ç›®å½• 1 cd /mnt/file \u0026amp;\u0026amp; ls -la 3. æ–‡ä»¶ä¸‹è½½ç¤ºä¾‹ ç®€å•ä¸‹è½½ï¼ˆä¸‹è½½åˆ°å½“å‰ç›®å½•ï¼‰:\n1 curl -# -O https://file.mobufan.eu.org:666/my-sh/rsync/hosts.sh æŒ‡å®šç›®å½•å’Œæ–‡ä»¶åä¸‹è½½:\n1 2 mkdir -p /mnt/test curl -# -L -o /mnt/test/hosts.sh https://file.mobufan.eu.org:666/my-sh/rsync/hosts.sh æ·»åŠ æ‰§è¡Œæƒé™:\n1 2 chmod +x /mnt/test/hosts.sh ls -la /mnt/test/ ğŸ› ï¸ é«˜çº§é…ç½®é€‰é¡¹ 1. æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 # åœ¨ location / å—ä¸­æ·»åŠ ä»¥ä¸‹é…ç½® proxy_buffer_size 128k; proxy_buffers 4 256k; proxy_busy_buffers_size 256k; proxy_temp_file_write_size 256k; 2. å®‰å…¨å¢å¼ºé…ç½® 1 2 3 4 # é™åˆ¶æ–‡ä»¶å¤§å°å’Œä¸‹è½½é€Ÿåº¦ client_max_body_size 10G; limit_rate_after 100m; limit_rate 10m; 3. æ—¥å¿—è®°å½•é…ç½® 1 2 3 4 5 6 7 # æ·»åŠ è®¿é—®æ—¥å¿—æ ¼å¼ log_format download \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#39; \u0026#39;\u0026#34;$request\u0026#34; $status $body_bytes_sent \u0026#39; \u0026#39;\u0026#34;$http_referer\u0026#34; \u0026#34;$http_user_agent\u0026#34; \u0026#39; \u0026#39;\u0026#34;$upstream_addr\u0026#34; \u0026#34;$upstream_status\u0026#34;\u0026#39;; access_log /var/log/nginx/download.access.log download; ğŸ” æ•…éšœæ’æŸ¥ 1. æ£€æŸ¥ Nginx é…ç½® 1 sudo nginx -t 2. æŸ¥çœ‹ Nginx çŠ¶æ€ 1 sudo systemctl status nginx 3. ç›‘æ§å®æ—¶æ—¥å¿— 1 2 tail -f /var/log/nginx/access.log tail -f /var/log/nginx/error.log 4. æµ‹è¯•ä¸‹è½½åŠŸèƒ½ 1 2 3 4 5 # æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ curl -I https://file.mobufan.eu.org:666/my-sh/rsync/hosts.sh # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ time curl -o /dev/null https://file.mobufan.eu.org:666/my-sh/rsync/hosts.sh ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®® å¯ç”¨ Gzip å‹ç¼© - å‡å°‘ä¼ è¾“æ•°æ®é‡ é…ç½®ç¼“å­˜ - æé«˜é‡å¤è®¿é—®é€Ÿåº¦ ä½¿ç”¨ CDN - åŠ é€Ÿå…¨çƒè®¿é—® ç›‘æ§ç³»ç»Ÿèµ„æº - ç¡®ä¿æœåŠ¡å™¨ç¨³å®šè¿è¡Œ å®šæœŸæ¸…ç†æ—¥å¿— - é¿å…ç£ç›˜ç©ºé—´ä¸è¶³ ğŸ“Š ç›‘æ§å’Œç»´æŠ¤ 1. è®¾ç½®ç›‘æ§å‘Šè­¦ 1 2 3 4 5 6 7 8 # ç›‘æ§ç£ç›˜ç©ºé—´ df -h /mnt/file # ç›‘æ§å†…å­˜ä½¿ç”¨ free -h # ç›‘æ§ç½‘ç»œæµé‡ iftop -i eth0 2. è‡ªåŠ¨åŒ–å¤‡ä»½ 1 2 3 4 # åˆ›å»ºå¤‡ä»½è„šæœ¬ #!/bin/bash tar -czf /backup/file-server-$(date +%Y%m%d).tar.gz /mnt/file find /backup -name \u0026#34;file-server-*.tar.gz\u0026#34; -mtime +30 -delete ğŸ¯ ä½¿ç”¨åœºæ™¯ è¿™ä¸ªæ–‡ä»¶æœåŠ¡å™¨æ¶æ„é€‚ç”¨äºï¼š\nğŸ¢ ä¼ä¸šå†…éƒ¨æ–‡ä»¶å…±äº« ğŸŒ å…¬å¼€è½¯ä»¶åˆ†å‘ ğŸ“¦ å¤§æ–‡ä»¶ä¸‹è½½æœåŠ¡ ğŸ”„ å¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡ ğŸ›¡ï¸ é«˜å¯ç”¨æ€§éƒ¨ç½² é€šè¿‡è¿™ä¸ªå®Œæ•´çš„ Nginx + Caddy æ–‡ä»¶æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥æ­å»ºä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ–‡ä»¶ä¸‹è½½æœåŠ¡ï¼ğŸ‰\n","date":"2024-12-07T20:13:04+08:00","image":"https://file.meimolihan.eu.org/img/caddy-nginx-file-01.webp","permalink":"https://blog.meimolihan.eu.org/p/600ae821/","title":"Nginx + Caddy æ–‡ä»¶æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— ğŸš€"},{"content":"Proxmox VE æŒ‚è½½ NTFS æ•°æ®ç¡¬ç›˜ ğŸ–¥ï¸ ğŸ“– ç›®å½• ğŸŒŸ æ¦‚è¿° ğŸ“‹ å‰ææ¡ä»¶ ğŸš€ æŒ‚è½½æ­¥éª¤ âš™ï¸ é…ç½®æ°¸ä¹…æŒ‚è½½ ğŸ–¥ï¸ PVE Web ç•Œé¢é…ç½® ğŸ› ï¸ æ•…éšœæ’é™¤ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”§ é«˜çº§é…ç½® ğŸ“Š ä½¿ç”¨æŠ€å·§ ğŸ’¾ ç£ç›˜å¥åº·ç›‘æ§ ğŸŒŸ æ¦‚è¿° æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Proxmox VE (PVE) ä¸­æŒ‚è½½å·²åŒ…å«æ•°æ®çš„ NTFS æ ¼å¼ç¡¬ç›˜ï¼Œè€Œæ— éœ€æ ¼å¼åŒ–æˆ–ä¸¢å¤±æ•°æ®ã€‚é€šè¿‡æ­¤æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å°†ç°æœ‰ Windows ç¡¬ç›˜ç›´æ¥ç”¨ä½œ PVE å­˜å‚¨ã€‚\næ•™ç¨‹å‚è€ƒ:\næ–‡å­—æ•™ç¨‹ è§†é¢‘æ•™ç¨‹ ğŸ“‹ å‰ææ¡ä»¶ Proxmox VE å·²å®‰è£…å¹¶è¿è¡Œ åŒ…å«æ•°æ®çš„ NTFS æ ¼å¼ç¡¬ç›˜ ç¡¬ç›˜å·²æ­£ç¡®è¿æ¥åˆ° PVE æœåŠ¡å™¨ ç®¡ç†å‘˜æƒé™ ğŸš€ æŒ‚è½½æ­¥éª¤ 1. æŸ¥çœ‹æ‰€æœ‰ç£ç›˜ 1 lsblk 2. æŸ¥çœ‹ç‰¹å®šç£ç›˜çš„è¯¦ç»†ä¿¡æ¯ 1 lsblk -f /dev/sda 3. å®‰è£… NTFS æ”¯æŒåŒ… PVE é»˜è®¤ä¸è¯†åˆ« NTFS æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦å®‰è£… ntfs-3g åŒ…ï¼š\n1 apt update \u0026amp;\u0026amp; apt install ntfs-3g -y 4. åˆ›å»ºæŒ‚è½½ç‚¹å¹¶ä¿®å¤ NTFS æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœéœ€è¦ï¼‰ 1 2 mkdir -p /mnt/ntfs # åˆ›å»ºæŒ‚è½½ç›®å½• ntfsfix /dev/sda1 # ä¿®å¤NTFSæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœå¿…è¦ï¼‰ 5. æŒ‚è½½ NTFS åˆ†åŒº 1 mount -t ntfs-3g /dev/sda1 /mnt/ntfs # æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹æŒ‚è½½ 6. éªŒè¯æŒ‚è½½æ˜¯å¦æˆåŠŸ 1 2 cd /mnt/ntfs \u0026amp;\u0026amp; ls -la df -h # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 7. å–æ¶ˆæŒ‚è½½ï¼ˆå¦‚æœéœ€è¦ï¼‰ 1 umount /dev/sda1 âš™ï¸ é…ç½®æ°¸ä¹…æŒ‚è½½ 1. æŸ¥çœ‹åˆ†åŒºçš„ UUID ä½¿ç”¨ UUID è€Œéè®¾å¤‡åï¼ˆå¦‚ /dev/sda1ï¼‰å¯ä»¥é¿å…è®¾å¤‡åå˜åŒ–å¯¼è‡´çš„é—®é¢˜ï¼š\n1 blkid 2. ç¼–è¾‘ fstab æ–‡ä»¶ 1 nano /etc/fstab 3. æ·»åŠ è‡ªåŠ¨æŒ‚è½½é…ç½® åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®æ‚¨çš„å®é™…æƒ…å†µä¿®æ”¹ UUID å’ŒæŒ‚è½½ç‚¹ï¼‰ï¼š\n1 2 3 4 5 # NTFS æ•°æ®ç›˜ UUID=47B29C2C34E7F600 /mnt/ntfs ntfs-3g defaults,nofail,x-systemd.device-timeout=15s 0 0 # EXT4 æ•°æ®ç›˜ï¼ˆå¦‚æœ‰ï¼‰ UUID=50a66a71-8fcd-42a5-a9ca-0cc06fa733e6 /mnt/mydisk ext4 defaults,nofail,x-systemd.device-timeout=15s 0 0 å‚æ•°è¯´æ˜:\ndefaults: ä½¿ç”¨é»˜è®¤æŒ‚è½½å‚æ•° nofail: ç³»ç»Ÿå¯åŠ¨æ—¶å¦‚æœè®¾å¤‡ä¸å­˜åœ¨ä¸ä¼šæŠ¥é”™ x-systemd.device-timeout=15s: è®¾ç½®è®¾å¤‡æ£€æµ‹è¶…æ—¶æ—¶é—´ä¸º15ç§’ 4. æµ‹è¯• fstab é…ç½® 1 mount -a å¦‚æœæ²¡æœ‰ä»»ä½•é”™è¯¯è¾“å‡ºï¼Œè¯´æ˜é…ç½®æ­£ç¡®ã€‚\nğŸ–¥ï¸ PVE Web ç•Œé¢é…ç½® 1. æ·»åŠ ç›®å½•å­˜å‚¨ ç™»å½• PVE Web ç®¡ç†ç•Œé¢ é€‰æ‹©\u0026quot;æ•°æ®ä¸­å¿ƒ\u0026quot; â†’ \u0026ldquo;å­˜å‚¨\u0026rdquo; â†’ \u0026ldquo;æ·»åŠ \u0026rdquo; â†’ \u0026ldquo;ç›®å½•\u0026rdquo; å¡«å†™é…ç½®ä¿¡æ¯ï¼š ID: è‡ªå®šä¹‰å­˜å‚¨åç§°ï¼ˆå¦‚ \u0026ldquo;ntfs-storage\u0026rdquo;ï¼‰ ç›®å½•: /mnt/ntfsï¼ˆæ‚¨ä¹‹å‰åˆ›å»ºçš„æŒ‚è½½ç‚¹ï¼‰ å†…å®¹: å…¨é€‰æˆ–æ ¹æ®éœ€æ±‚é€‰æ‹© 2. å®Œæˆé…ç½® ä¿å­˜åï¼Œæ‚¨å¯ä»¥åœ¨å­˜å‚¨åˆ—è¡¨ä¸­çœ‹åˆ°æ–°æ·»åŠ çš„ NTFS å­˜å‚¨ï¼Œå¹¶å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨å®ƒã€‚\nğŸ› ï¸ æ•…éšœæ’é™¤ 1. æŒ‚è½½å¤±è´¥ å¦‚æœæŒ‚è½½å¤±è´¥ï¼Œå°è¯•ä»¥ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 5 # å¼ºåˆ¶ä¿®å¤ NTFS æ–‡ä»¶ç³»ç»Ÿ ntfsfix -d /dev/sda1 # å°è¯•ä»¥è¯»å†™æ¨¡å¼æŒ‚è½½ mount -t ntfs-3g /dev/sda1 /mnt/ntfs -o rw 2. fstab é…ç½®é”™è¯¯ å¦‚æœç³»ç»Ÿå¯åŠ¨å¤±è´¥ due to fstab é”™è¯¯ï¼š\nä½¿ç”¨ Live CD å¯åŠ¨ æŒ‚è½½ PVE ç³»ç»Ÿåˆ†åŒº ä¿®å¤ /etc/fstab æ–‡ä»¶ 3. æƒé™é—®é¢˜ å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼š\n1 2 3 # æ›´æ”¹æŒ‚è½½ç‚¹æƒé™ chmod 755 /mnt/ntfs chown root:root /mnt/ntfs âš ï¸ æ³¨æ„äº‹é¡¹ æ•°æ®å¤‡ä»½: åœ¨è¿›è¡Œä»»ä½•ç£ç›˜æ“ä½œå‰ï¼ŒåŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ® å®‰å…¨ç§»é™¤: åœ¨ç‰©ç†æ–­å¼€ç¡¬ç›˜å‰ï¼Œç¡®ä¿å·²æ­£ç¡®å¸è½½ å…¼å®¹æ€§: æŸäº› NTFS ç‰¹æ€§å¯èƒ½ä¸è¢«å®Œå…¨æ”¯æŒ æ€§èƒ½: NTFS åœ¨ Linux ä¸‹çš„æ€§èƒ½å¯èƒ½ä¸å¦‚åŸç”Ÿæ–‡ä»¶ç³»ç»Ÿ ç£ç›˜æ ‡è¯†: ä½¿ç”¨ UUID è€Œéè®¾å¤‡åï¼ˆå¦‚ /dev/sda1ï¼‰å¯ä»¥é¿å…è®¾å¤‡åå˜åŒ–å¯¼è‡´çš„é—®é¢˜ ğŸ”§ é«˜çº§é…ç½® 1. æŒ‚è½½é€‰é¡¹ä¼˜åŒ– 1 2 # åœ¨ /etc/fstab ä¸­ä½¿ç”¨æ›´å¤šæŒ‚è½½é€‰é¡¹ UUID=47B29C2C34E7F600 /mnt/ntfs ntfs-3g defaults,uid=1000,gid=1000,umask=0022,nofail,x-systemd.device-timeout=15s 0 0 2. åˆ›å»ºå¤šä¸ªæŒ‚è½½ç‚¹ å¦‚æœæ‚¨æœ‰å¤šä¸ªåˆ†åŒºï¼š\n1 mkdir -p /mnt/{ntfs1,ntfs2,ext4} ğŸ“Š ä½¿ç”¨æŠ€å·§ 1. å¿«é€Ÿè®¿é—® åˆ›å»ºç¬¦å·é“¾æ¥ä»¥ä¾¿å¿«é€Ÿè®¿é—®ï¼š\n1 ln -s /mnt/ntfs /root/ntfs-drive 2. å¤‡ä»½è„šæœ¬ åˆ›å»ºè‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼š\n1 2 3 #!/bin/bash # å¤‡ä»½ NTFS ç›˜ä¸­çš„é‡è¦æ•°æ® rsync -av --progress /mnt/ntfs/Important/ /backup/ntfs-backup/ ğŸ’¾ ç£ç›˜å¥åº·ç›‘æ§ ä¸ºç¡®ä¿æ‚¨çš„ NTFS ç¡¬ç›˜å¥åº·è¿è¡Œï¼Œå»ºè®®å®šæœŸæ£€æŸ¥ç£ç›˜çŠ¶æ€ï¼š\n1. å®‰è£… smartmontools 1 apt install smartmontools 2. å¯ç”¨ç£ç›˜ SMART åŠŸèƒ½ 1 smartctl -s on /dev/sda # å¯ç”¨SMART 3. æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ 1 2 smartctl -H /dev/sda # æ£€æŸ¥å¥åº·çŠ¶æ€ smartctl -a /dev/sda # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ 4. å®šæœŸç›‘æ§ PVE ä» 4.3 ç‰ˆæœ¬å¼€å§‹é›†æˆäº† smartmontoolsï¼Œé»˜è®¤æ¯ 30 åˆ†é’Ÿæ‰«æä¸€æ¬¡ç£ç›˜é”™è¯¯å’Œè­¦å‘Šï¼Œå¹¶åœ¨æ£€æµ‹åˆ°é—®é¢˜æ—¶å‘ root å‘é€é‚®ä»¶ã€‚\n5. NTFS æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ å¯¹äº NTFS æ–‡ä»¶ç³»ç»Ÿæœ¬èº«çš„å¥åº·ï¼Œå¯ä»¥è€ƒè™‘åœ¨ Windows ç¯å¢ƒä¸‹ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š\nchkdsk: Windows è‡ªå¸¦çš„ç£ç›˜æ£€æŸ¥å·¥å…· StorDiag.exe: Windows 10 ä¸­çš„å­˜å‚¨å’Œæ–‡ä»¶ç³»ç»Ÿè¯Šæ–­å·¥å…·ï¼Œå¯ç”¨äºè¯†åˆ« NTFS æ–‡ä»¶ç³»ç»ŸæŸå ğŸ’¡ æç¤ºï¼šè™½ç„¶è¿™äº› Windows å·¥å…·æ›´é€‚ç”¨äº NTFS æ–‡ä»¶ç³»ç»Ÿï¼Œä½†å»ºè®®è°¨æ…ä½¿ç”¨ï¼Œå¹¶åœ¨æ“ä½œå‰å¤‡ä»½é‡è¦æ•°æ®ã€‚\né€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ¨ Proxmox VE ä¸­æŒ‚è½½å’Œä½¿ç”¨ NTFS æ ¼å¼çš„æ•°æ®ç¡¬ç›˜ï¼Œå¹¶ç¡®ä¿å…¶å¥åº·è¿è¡Œã€‚å¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚ğŸ¯\n","date":"2024-12-07T20:12:23+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/1fcff53c/","title":"Proxmox VE æŒ‚è½½ NTFS æ•°æ®ç¡¬ç›˜ ğŸ–¥ï¸"},{"content":"Caddy V2 å®Œå…¨æŒ‡å— ğŸš€ ğŸŒ ç°ä»£åŒ–çš„è‡ªåŠ¨ HTTPS Web æœåŠ¡å™¨å’Œåå‘ä»£ç† - ç®€å•ã€å®‰å…¨ã€é«˜æ•ˆçš„WebæœåŠ¡è§£å†³æ–¹æ¡ˆ\nğŸ“‹ ç›®å½• ğŸ¯ Caddy V2 ç®€ä»‹ ğŸ³ Docker å®‰è£… ğŸ“ é…ç½®æ–‡ä»¶è¯¦è§£ ğŸ” åå‘ä»£ç†é…ç½® ğŸ“ Web æœåŠ¡é…ç½® ğŸ”’ HTTPS é…ç½® âš™ï¸ é«˜çº§é…ç½® ğŸ”§ æ•…éšœæ’é™¤ ğŸ¯ Caddy V2 ç®€ä»‹ Caddy 2 æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¼€æºWebæœåŠ¡å™¨ï¼Œä½¿ç”¨Goè¯­è¨€ç¼–å†™ï¼Œä»¥å…¶ç®€å•æ€§å’Œè‡ªåŠ¨HTTPSåŠŸèƒ½è€Œé—»åã€‚\nğŸŒŸ ä¸»è¦ç‰¹æ€§ ğŸ”’ è‡ªåŠ¨ HTTPSï¼šè‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ SSL è¯ä¹¦ï¼ˆLet\u0026rsquo;s Encrypté›†æˆï¼‰ âš¡ ç®€å•é…ç½®ï¼šç®€æ´æ˜“æ‡‚çš„ Caddyfile è¯­æ³•ï¼ŒJSONé…ç½®é€‰é¡¹ ğŸš€ é«˜æ€§èƒ½ï¼šåŸºäº Go è¯­è¨€å¼€å‘ï¼Œå†…å­˜å ç”¨ä½ï¼Œå¹¶å‘èƒ½åŠ›å¼º ğŸ”§ æ¨¡å—åŒ–ï¼šæ”¯æŒä¸°å¯Œçš„æ‰©å±•åŠŸèƒ½å’Œä¸­é—´ä»¶ ğŸ“¦ é›¶ä¾èµ–ï¼šå•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— éœ€é¢å¤–è¿è¡Œæ—¶ ğŸŒ HTTP/3 æ”¯æŒï¼šåŸç”Ÿæ”¯æŒHTTP/3 (QUIC)åè®® ğŸ†š ç‰ˆæœ¬åŒºåˆ« Caddy V1ï¼šæ—§ç‰ˆæœ¬ï¼Œé…ç½®è¯­æ³•ä¸åŒï¼Œå·²åœæ­¢ç»´æŠ¤ Caddy V2ï¼šæ–°ç‰ˆæœ¬ï¼Œå®Œå…¨é‡å†™ï¼Œé…ç½®æ›´çµæ´»ï¼Œæœ¬æ•™ç¨‹é€‚ç”¨ ğŸ† é€‚ç”¨åœºæ™¯ ä¸ªäººç½‘ç«™ï¼šç®€å•é…ç½®ï¼Œè‡ªåŠ¨HTTPS API ç½‘å…³ï¼šçµæ´»çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ é™æ€ç½‘ç«™ï¼šé«˜æ•ˆçš„æ–‡ä»¶æœåŠ¡ å¾®æœåŠ¡æ¶æ„ï¼šæœåŠ¡å‘ç°å’ŒåŠ¨æ€é…ç½® å¼€å‘ç¯å¢ƒï¼šå¿«é€Ÿæ­å»ºæœ¬åœ°HTTPSç¯å¢ƒ ğŸ³ Docker å®‰è£… ğŸ“¦ åŸºç¡€å®‰è£…å‘½ä»¤ 1 2 3 4 5 6 docker run -d --name=CaddyV2 \\ --net=host \\ -v /path/to/caddy/data:/data \\ -v /path/to/caddy/config:/config \\ -v /path/to/Caddyfile:/etc/caddy/Caddyfile \\ caddy:latest ğŸ¯ æ¨èå®‰è£…é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/bin/bash # ğŸš€ Caddy V2 Docker å®‰è£…è„šæœ¬ CADDY_NAME=\u0026#34;CaddyV2\u0026#34; DATA_DIR=\u0026#34;/docker/caddy/data\u0026#34; CONFIG_DIR=\u0026#34;/docker/caddy/config\u0026#34; CADDYFILE=\u0026#34;/docker/caddy/Caddyfile\u0026#34; WWW_DIR=\u0026#34;/www\u0026#34; # åˆ›å»ºç›®å½• mkdir -p ${DATA_DIR} ${CONFIG_DIR} ${WWW_DIR} touch ${CADDYFILE} # è¿è¡Œå®¹å™¨ docker run -d --name=${CADDY_NAME} \\ --restart=unless-stopped \\ --net=host \\ -v ${DATA_DIR}:/data \\ -v ${CONFIG_DIR}:/config \\ -v ${CADDYFILE}:/etc/caddy/Caddyfile \\ -v ${WWW_DIR}:/www \\ # ç½‘ç«™æ–‡ä»¶ç›®å½• caddy:latest echo \u0026#34;âœ… Caddy V2 å®‰è£…å®Œæˆï¼\u0026#34; echo \u0026#34;ğŸ“ æ•°æ®ç›®å½•: ${DATA_DIR}\u0026#34; echo \u0026#34;ğŸ“ é…ç½®ç›®å½•: ${CONFIG_DIR}\u0026#34; echo \u0026#34;ğŸ“„ é…ç½®æ–‡ä»¶: ${CADDYFILE}\u0026#34; echo \u0026#34;ğŸŒ ç½‘ç«™ç›®å½•: ${WWW_DIR}\u0026#34; ğŸ”§ ç«¯å£æ˜ å°„æ–¹å¼ï¼ˆæ›¿ä»£ host ç½‘ç»œï¼‰ 1 2 3 4 5 6 7 8 docker run -d --name=CaddyV2 \\ -p 80:80 -p 443:443 -p 443:443/udp \\ # HTTP/3 éœ€è¦ UDP 443 -p 2019:2019 \\ # ç®¡ç†ç«¯å£ï¼ˆå¯é€‰ï¼‰ -v /docker/caddy/data:/data \\ -v /docker/caddy/config:/config \\ -v /docker/caddy/Caddyfile:/etc/caddy/Caddyfile \\ -v /www:/www \\ caddy:latest ğŸ³ Docker Compose éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 version: \u0026#39;3.7\u0026#39; services: caddy: image: caddy:latest container_name: caddy restart: unless-stopped ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; - \u0026#34;443:443/udp\u0026#34; volumes: - ./data:/data - ./config:/config - ./Caddyfile:/etc/caddy/Caddyfile - /www:/www networks: - caddy-network networks: caddy-network: driver: bridge ğŸ“ é…ç½®æ–‡ä»¶è¯¦è§£ Caddy 2 æ”¯æŒä¸¤ç§é…ç½®æ ¼å¼ï¼šCaddyfileï¼ˆäººç±»å¯è¯»ï¼‰å’ŒJSONï¼ˆæœºå™¨å¯è¯»ï¼‰ã€‚\nğŸ¨ ä¸»é…ç½®æ–‡ä»¶ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { # å…¨å±€é…ç½®å— http_port 80 https_port 443 order reverse_proxy before file_server auto_https disable_redirects # ç¦ç”¨è‡ªåŠ¨HTTPSé‡å®šå‘ log { output file /data/access.log { roll_size 100mb roll_keep 10 } format json } } # å¯¼å…¥å…¶ä»–é…ç½®æ–‡ä»¶ import /etc/caddy/conf.d/*.conf ğŸ“ é…ç½®æ–‡ä»¶ç»„ç»‡å»ºè®® 1 2 3 4 5 6 7 /etc/caddy/ â”œâ”€â”€ Caddyfile # ä¸»é…ç½®æ–‡ä»¶ â””â”€â”€ conf.d/ # å­é…ç½®ç›®å½• â”œâ”€â”€ proxy.conf # åå‘ä»£ç†é…ç½® â”œâ”€â”€ static.conf # é™æ€æ–‡ä»¶æœåŠ¡ â”œâ”€â”€ api.conf # API æœåŠ¡é…ç½® â””â”€â”€ security.conf # å®‰å…¨ç›¸å…³é…ç½® ğŸ”„ åŠ¨æ€é…ç½®ï¼ˆAPIé©±åŠ¨ï¼‰ Caddy 2 æä¾›äº†ç®¡ç†APIï¼Œæ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°ï¼š\n1 2 3 4 5 6 7 8 9 # å¯ç”¨ç®¡ç†APIï¼ˆé»˜è®¤ç›‘å¬2019ç«¯å£ï¼‰ { admin localhost:2019 } # ä½¿ç”¨APIæ›´æ–°é…ç½® curl -X POST \u0026#34;http://localhost:2019/load\u0026#34; \\ -H \u0026#34;Content-Type: text/caddyfile\u0026#34; \\ --data-binary @Caddyfile ğŸ” åå‘ä»£ç†é…ç½® ğŸ¯ åŸºç¡€åå‘ä»£ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä»£ç†åˆ°æœ¬åœ°æœåŠ¡ hass.example.com { reverse_proxy localhost:8123 } # ä»£ç†åˆ°è¿œç¨‹æœåŠ¡ api.example.com { reverse_proxy https://backend-api:3000 } # å¸¦è·¯å¾„çš„åå‘ä»£ç† app.example.com { reverse_proxy /api/* localhost:3000 reverse_proxy /* localhost:8080 } âš™ï¸ é«˜çº§ä»£ç†é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 service.example.com { # è´Ÿè½½å‡è¡¡ reverse_proxy { to server1:8080 server2:8080 server3:8080 lb_policy round_robin # å¥åº·æ£€æŸ¥ health_uri /health health_interval 30s health_timeout 5s # è¢«åŠ¨å¥åº·æ£€æŸ¥ fail_duration 30s max_fails 3 } # å¤´éƒ¨ä¿®æ”¹ header_up X-Real-IP {remote_host} header_up X-Forwarded-Proto {scheme} header_down Strict-Transport-Security \u0026#34;max-age=31536000;\u0026#34; # è¶…æ—¶è®¾ç½® reverse_proxy { to backend:8080 transport http { dial_timeout 10s tls_timeout 10s response_header_timeout 30s } } } ğŸ”§ WebSocket ä»£ç† 1 2 3 4 5 6 7 8 9 10 11 12 ws.example.com { reverse_proxy localhost:3000 { # WebSocket æ”¯æŒ header_up Connection {\u0026gt;Connection} header_up Upgrade {\u0026gt;Upgrade} # WebSocket ç‰¹å®šé…ç½® transport http { keepalive off # WebSocket éœ€è¦å…³é—­ keepalive } } } ğŸ”„ æœåŠ¡å‘ç°é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 service.example.com { reverse_proxy { # Docker Swarm æœåŠ¡å‘ç° to docker-swarm:service-name:8080 # Kubernetes æœåŠ¡å‘ç° # to kubernetes:default:service-name:8080 # DNS æœåŠ¡å‘ç° # to srv://_http._tcp.service.example.com } } ğŸ“ Web æœåŠ¡é…ç½® ğŸ¯ é™æ€æ–‡ä»¶æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 www.example.com { # æ–‡ä»¶æœåŠ¡ root * /www/example file_server # å¯ç”¨å‹ç¼© encode gzip zstd # ç›®å½•æµè§ˆï¼ˆå¯é€‰ï¼‰ file_server browse { hide .gitignore .htaccess } # è‡ªå®šä¹‰é”™è¯¯é¡µé¢ handle_errors { @404 { expression {http.error.status_code} == 404 } rewrite @404 /404.html file_server } } ğŸ›¡ï¸ å®‰å…¨å¢å¼ºé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 static.example.com { root * /www/static file_server # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY X-XSS-Protection \u0026#34;1; mode=block\u0026#34; Referrer-Policy \u0026#34;no-referrer-when-downgrade\u0026#34; Permissions-Policy \u0026#34;geolocation=(), microphone=(), camera=()\u0026#34; } # ç¼“å­˜æ§åˆ¶ header Cache-Control \u0026#34;public, max-age=3600\u0026#34; # é˜²æ­¢ MIME ç±»å‹æ··æ·†æ”»å‡» header Content-Type \u0026#34;{http.response.header.Content-Type}\u0026#34; # éšè—æœåŠ¡å™¨ä¿¡æ¯ header -Server } ğŸ“„ å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 spa.example.com { root * /www/spa file_server # SPA è·¯ç”±æ”¯æŒ try_files {path} {path}/ /index.html # å®¢æˆ·ç«¯è·¯ç”±æ”¯æŒ @clientRoute { not file path_regexp .*\\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ } rewrite @clientRoute /index.html } ğŸ“Š æ—¥å¿—è®°å½• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ¯ä¸ªç«™ç‚¹çš„è®¿é—®æ—¥å¿— blog.example.com { root * /www/blog file_server log { output file /data/access-blog.log { roll_size 100mb roll_keep 5 roll_local_time } format json { time_format \u0026#34;iso8601\u0026#34; time_local } } } ğŸ”’ HTTPS é…ç½® ğŸ¯ è‡ªåŠ¨ HTTPSï¼ˆé»˜è®¤ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸè¯ä¹¦ # é»˜è®¤ä¼šé‡å®šå‘HTTPåˆ°HTTPS example.com { reverse_proxy localhost:3000 } # é€šé…ç¬¦è¯ä¹¦ *.example.com { tls { dns cloudflare {env.CLOUDFLARE_API_TOKEN} } reverse_proxy localhost:3000 } ğŸ“ æ‰‹åŠ¨æŒ‡å®šè¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 https://example.com:444 { tls /path/to/cert.pem /path/to/key.pem reverse_proxy localhost:3000 } # ä½¿ç”¨ACMEæŒ‘æˆ˜ example.com { tls { ca https://acme-staging-v02.api.letsencrypt.org/directory dns cloudflare {env.CLOUDFLARE_API_TOKEN} } reverse_proxy localhost:3000 } ğŸŒ HTTP é‡å®šå‘åˆ° HTTPS 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ˜¾å¼é‡å®šå‘ http://example.com { redir https://{host}{uri} permanent } https://example.com { reverse_proxy localhost:3000 } # æˆ–è€…ä½¿ç”¨è‡ªåŠ¨HTTPSé‡å®šå‘ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ example.com { reverse_proxy localhost:3000 } ğŸš« çº¯ HTTP æœåŠ¡ 1 2 3 4 5 6 7 http://example.com:8080 { root * /www/http file_server # ç¦ç”¨TLS tls off } ğŸ” å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ 1 2 3 4 5 6 7 8 9 10 secure.example.com { tls /path/to/cert.pem /path/to/key.pem { client_auth { mode require_and_verify trusted_ca_cert_file /path/to/client-ca.crt } } reverse_proxy localhost:3000 } âš™ï¸ é«˜çº§é…ç½® ğŸ” èº«ä»½éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 admin.example.com { # Basic è®¤è¯ basicauth /admin/* { admin $2y$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx user2 $2y$10$yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy } # JWT è®¤è¯ jwt { primary yes allow sub user1 user2 secret {env.JWT_SECRET} } reverse_proxy localhost:3000 } ğŸ“Š é«˜çº§æ—¥å¿—é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 { log { # è®¿é—®æ—¥å¿— output file /data/access.log { roll_size 1gb roll_keep 10 roll_local_time roll_uncompressed } format json { time_format \u0026#34;iso8601\u0026#34; time_local } # é”™è¯¯æ—¥å¿— output file /data/error.log { roll_size 50mb roll_keep 5 roll_local_time } level ERROR } } âš¡ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 { # ç¼“å†²åŒºå¤§å° buffers { read 4096 write 4096 } # è¿æ¥è¶…æ—¶ timeouts { read 30s write 30s idle 2m graceful_shutdown 15s } # å‹ç¼©è®¾ç½® encode { gzip { level 6 min_length 256 } zstd } # é™æ€èµ„æºç¼“å­˜ file_server { cache { max_age 1h } } } ğŸ”„ é‡å†™å’Œé‡å®šå‘è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 example.com { # URL é‡å†™ rewrite /old/path /new/path # æ­£åˆ™é‡å†™ rewrite /user/(\\w+) /profile?name={1} # æ¡ä»¶é‡å®šå‘ @mobile { header User-Agent *mobile* } redir @mobile /mobile{uri} # æ°¸ä¹…é‡å®šå‘ redir https://new.example.com{uri} permanent # åŸºäºæŸ¥è¯¢å‚æ•°çš„é‡å®šå‘ @withToken { query token=* } redir @withToken /auth{uri} } ğŸ§© ä¸­é—´ä»¶å’Œæ’ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 example.com { # å¯ç”¨CORS header Access-Control-Allow-Origin * header Access-Control-Allow-Methods \u0026#34;GET, POST, OPTIONS\u0026#34; header Access-Control-Allow-Headers \u0026#34;Content-Type, Authorization\u0026#34; # é€Ÿç‡é™åˆ¶ rate_limit { zone rate_limit_zone 10 1s key {remote_host} } # IPç™½åå• @whitelist { remote_ip 192.168.1.0/24 10.0.0.0/8 } respond @whitelist 403 reverse_proxy localhost:3000 } ğŸ”§ æ•…éšœæ’é™¤ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1. ç«¯å£è¢«å ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥ç«¯å£å ç”¨ sudo lsof -i :80 sudo lsof -i :443 # åœæ­¢å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹ Caddy ç«¯å£ { http_port 8080 https_port 8443 } # æˆ–è€…æ€æ­»å ç”¨è¿›ç¨‹ sudo kill -9 $(sudo lsof -t -i:80) 2. è¯ä¹¦ç”³è¯·å¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥ DNS è§£æ dig example.com nslookup example.com # æ£€æŸ¥é˜²ç«å¢™ sudo ufw status sudo firewall-cmd --list-all # æ£€æŸ¥ACMEæŒ‘æˆ˜ç›®å½•æƒé™ ls -la /www/.well-known/acme-challenge/ # ä½¿ç”¨æš‚å­˜ç¯å¢ƒæµ‹è¯• { acme_ca https://acme-staging-v02.api.letsencrypt.org/directory } 3. æƒé™é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /path/to/www # ä¿®å¤æƒé™ sudo chown -R www-data:www-data /path/to/www sudo chmod -R 755 /path/to/www # æ£€æŸ¥SELinux/AppArmor sudo sestatus sudo aa-status ğŸ“ æ—¥å¿—æŸ¥çœ‹å’Œè°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs CaddyV2 docker logs -f CaddyV2 # å®æ—¶æ—¥å¿— # æŸ¥çœ‹è®¿é—®æ—¥å¿— tail -f /docker/caddy/data/access.log # æŸ¥çœ‹é”™è¯¯æ—¥å¿— docker exec CaddyV2 cat /data/caddy.log # å¯ç”¨è°ƒè¯•æ¨¡å¼ { debug } # æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡ docker run -e CADDY_DEBUG=true ... caddy:latest ğŸ” é…ç½®éªŒè¯å’Œæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 # éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³• docker exec CaddyV2 caddy validate --config /etc/caddy/Caddyfile # é‡æ–°åŠ è½½é…ç½® docker exec CaddyV2 caddy reload --config /etc/caddy/Caddyfile # æµ‹è¯•é…ç½® docker exec CaddyV2 caddy adapt --config /etc/caddy/Caddyfile # æ£€æŸ¥å½“å‰è¿è¡Œé…ç½® curl http://localhost:2019/config/ | jq . ğŸš€ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats CaddyV2 # æŸ¥çœ‹è¿æ¥æ•° docker exec CaddyV2 caddy metrics # å®æ—¶ç›‘æ§ watch -n 1 \u0026#39;docker stats CaddyV2 --no-stream\u0026#39; # å‹åŠ›æµ‹è¯• ab -n 1000 -c 100 https://example.com/ ğŸ”„ ç»´æŠ¤å’Œæ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ›´æ–° Caddy docker pull caddy:latest docker stop CaddyV2 docker rm CaddyV2 # é‡æ–°è¿è¡Œå®‰è£…å‘½ä»¤ # å¤‡ä»½é…ç½® tar -czvf caddy-backup-$(date +%Y%m%d).tar.gz /docker/caddy/ # æ¢å¤é…ç½® tar -xzvf caddy-backup-20231201.tar.gz -C / # æ¸…ç†æ—§è¯ä¹¦å’Œæ•°æ® docker exec CaddyV2 caddy cleanup ğŸ¯ æç¤ºï¼šCaddy V2 çš„é…ç½®éå¸¸çµæ´»ï¼Œå»ºè®®ä»ç®€å•é…ç½®å¼€å§‹ï¼Œé€æ­¥æ·»åŠ å¤æ‚åŠŸèƒ½ã€‚å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’Œè¯ä¹¦æ•°æ®ã€‚\nğŸ“š æ¨èèµ„æºï¼š\nCaddy å®˜æ–¹æ–‡æ¡£ Caddyfile è¯­æ³• ç¤¾åŒºè®ºå› GitHub ä»“åº“ Caddy æ’ä»¶å¸‚åœº ğŸ”§ ç»´æŠ¤å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹Caddyç‰ˆæœ¬ docker exec CaddyV2 caddy version # åˆ—å‡ºå·²å®‰è£…æ’ä»¶ docker exec CaddyV2 caddy list-modules # æ£€æŸ¥è¯ä¹¦çŠ¶æ€ docker exec CaddyV2 caddy validate --config /etc/caddy/Caddyfile # å¼ºåˆ¶æ›´æ–°è¯ä¹¦ docker exec CaddyV2 caddy reload --force ğŸ’¡ æœ€ä½³å®è·µï¼š\nä½¿ç”¨Docker Composeç®¡ç†Caddyå®¹å™¨ å°†é…ç½®å’Œæ•°æ®ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœº å®šæœŸå¤‡ä»½è¯ä¹¦å’Œé…ç½® ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯ å¯ç”¨é€‚å½“çš„æ—¥å¿—è®°å½•å’Œç›‘æ§ å®šæœŸæ›´æ–°Caddyåˆ°æœ€æ–°ç‰ˆæœ¬ ğŸŒ ç¤¾åŒºæ”¯æŒï¼š\né‡åˆ°é—®é¢˜æ—¶ï¼Œå¯ä»¥åœ¨ Caddyç¤¾åŒºè®ºå› å¯»æ±‚å¸®åŠ© æŸ¥çœ‹ GitHub Issues äº†è§£å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ å‚ä¸Caddyå¼€å‘ï¼Œè´¡çŒ®ä»£ç æˆ–æ–‡æ¡£ å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©ä½¿ç”¨Caddy V2æ­å»ºå’Œç®¡ç†WebæœåŠ¡ï¼ğŸš€\n","date":"2024-12-07T20:11:46+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ae5bb0c8/","title":"Caddy V2 å®Œå…¨æŒ‡å— ğŸš€"},{"content":"Caddy é…ç½®æ–‡ä»¶ \u0026amp; æ— æ³¨é‡Šåˆ›å»º ä¸€ ã€Caddy ä¸»é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 touch /usr/local/caddy/Caddyfile \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/Caddyfile \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/Caddyfile ## caddy ä¸»é…ç½®æ–‡ä»¶ { http_port 86 https_port 6663 order webdav before file_server } ## å¼•ç”¨å…¶å®ƒç›®å½•çš„é…ç½®æ–‡ä»¶ import /usr/local/caddy/conf.d/*.conf EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload äºŒ ã€æˆ‘çš„ caddy ä¸ªäººé…ç½®æ–‡ä»¶ 1 ã€pve è™šæ‹Ÿæœº pve è™šæ‹Ÿæœºï¼šhttps://pve.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/pve.conf ## caddy åå‘ä»£ç† PVE è™šæ‹Ÿæœº https://pve.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy https://10.10.10.254:8006 { transport http { tls_insecure_skip_verify } } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 2 ã€ikuai ä¸»è·¯ç”± ikuai ä¸»è·¯ç”±ï¼šhttps://ik.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/ik.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/ik.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/ik.conf ## caddy åå‘ä»£ç† ikuai ä¸»è·¯ç”± https://ik.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.253:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 3 ã€ars2 æ—è·¯ç”± ars2 è½¯è·¯ç”±ï¼šhttps://ars2.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/ars2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/ars2.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/ars2.conf ## caddy åå‘ä»£ç† ars2 æ—è·¯ç”± https://ars2.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.251:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 4 ã€istoreos-1 æ—è·¯ç”± istoreos-1 è½¯è·¯ç”±ï¼šhttps://istoreos1.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/istoreos-1.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/istoreos-1.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/istoreos-1.conf ## caddy åå‘ä»£ç† istoreos-1 æ—è·¯ç”± https://istoreos1.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.252:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 5 ã€istoreos-2 æ—è·¯ç”± istoreos-2 è½¯è·¯ç”±ï¼šhttps://istoreos2.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/istoreos-2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/istoreos-2.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/istoreos-2.conf ## caddy åå‘ä»£ç† istoreos-2 æ—è·¯ç”± https://istoreos2.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.243:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 6 ã€emby-debian åª’ä½“æœåŠ¡å™¨ï¼ˆè‡ªå®šä¹‰é™æ€é¡µï¼‰ emby-debian åª’ä½“æœåŠ¡å™¨ï¼šhttps://emby1.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/emby-debian.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/emby-debian.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/emby-debian.conf ## caddy åå‘ä»£ç† emby-debian åª’ä½“æœåŠ¡å™¨ https://emby1.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8896 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°emby.htmlé¡µé¢ rewrite * /jellyfin-6663.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 7 ã€emby-ars2 åª’ä½“æœåŠ¡å™¨ emby-ars2 åª’ä½“æœåŠ¡å™¨ï¼šhttps://emby2.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/emby-ars2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/emby-ars2.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/emby-ars2.conf ## caddy åå‘ä»£ç† emby-ars2 åª’ä½“æœåŠ¡å™¨ https://emby2.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.251:8896 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 8 ã€jellyfin-ars2 åª’ä½“æœåŠ¡å™¨ jellyfin-ars2 åª’ä½“æœåŠ¡å™¨ï¼šhttps://jellyfin251.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/jellyfin-ars2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/jellyfin-ars2.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/jellyfin-ars2.conf ## caddy åå‘ä»£ç† jellyfin251 åª’ä½“æœåŠ¡å™¨ https://jellyfin251.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.251:8096 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 9 ã€jellyfin-debian åª’ä½“æœåŠ¡å™¨ jellyfin-debian åª’ä½“æœåŠ¡å™¨ï¼šhttps://jellyfin245.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/jellyfin-debian.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/jellyfin-debian.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/jellyfin-debian.conf ## caddy åå‘ä»£ç† jellyfin245 åª’ä½“æœåŠ¡å™¨ https://jellyfin245.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8096 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 10 ã€caddy-webdav æ–‡ä»¶æœåŠ¡ webdav æ–‡ä»¶æœåŠ¡ï¼šhttps://file.meimolihan.eu.org:6663\nç»ˆç«¯ç”Ÿæˆ12345çš„å¯†ç å‘½ä»¤ï¼š/usr/local/caddy/caddy hash-password --plaintext 12345 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/webdav.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/webdav.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/webdav.conf ## caddy åå‘ä»£ç† WebDAV æœåŠ¡ https://file.meimolihan.eu.org:6663 { ## è®¾ç½® /mnt ä¸ºå¯è¢«è®¿é—®ç›®å½•ï¼ˆå¯è‡ªè¡Œä¿®æ”¹ï¼‰ root * /mnt encode gzip ## ç»ˆç«¯ç”Ÿæˆ12345çš„å¯†ç å‘½ä»¤ï¼š/usr/local/caddy/caddy hash-password --plaintext 12345 ## ç”¨æˆ·åï¼šadminï¼ˆå¯è‡ªå®šä¹‰ï¼‰ basic_auth { admin $2a$14$yI/KQg2h5rQkXao4lzRMC.Rx5t3bRuGyCYkvEeiJyc9hUrYt0USsi } ## æŒ‡å®šè¯ä¹¦è·¯å¾„ï¼Œç»å¯¹è·¯å¾„ä¸º/usr/local/caddy/ssl/private.keyç­‰äºssl/private.key tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key route { rewrite /webdav /webdav/ webdav /webdav/* { ## è®¿é—®WebDAVæœåŠ¡çš„å‰ç¼€ prefix /webdav } ## å¯ç”¨å½“å‰ç›®å½•çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å…è®¸æµè§ˆæ–‡ä»¶åˆ—è¡¨ file_server browse } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 11 ã€caddy é™æ€é¡µ caddy é™æ€é¡µï¼šhttps://jingtai.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/jingtai.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/jingtai.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/jingtai.conf ## åå‘ä»£ç† caddy é™æ€é¡µ https://jingtai.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key ## å®šä¹‰ index.html æ–‡ä»¶è·¯å¾„ root * /var/www/html/web ## å¯åŠ¨é™æ€èµ„æº file_server browse ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 12 ã€caddy æ–‡ä»¶æœåŠ¡ caddy æ–‡ä»¶æœåŠ¡ï¼šhttps://wenjian.meimolihan.eu.org:6663\næ–‡ä»¶è·¯å¾„ï¼šcd /usr/local/caddy/wenjian \u0026amp;\u0026amp; ls 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d /usr/local/caddy/wenjian \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/wenjian.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/wenjian.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/wenjian.conf ## caddy æ–‡ä»¶æœåŠ¡ https://wenjian.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key ## å®šä¹‰æ–‡ä»¶æœåŠ¡è·¯å¾„/usr/local/caddyè·¯å¾„ä¸‹ä¸è¦æœ‰index.htmlæ–‡ä»¶ root * /usr/local/caddy/wenjian ## å¯ç”¨å½“å‰ç›®å½•çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å…è®¸æµè§ˆæ–‡ä»¶åˆ—è¡¨ file_server browse ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 13 ã€halo åšå®¢ halo åšå®¢å‰å°ï¼šhttps://www.meimolihan.eu.org:6663 halo åšå®¢åå°ï¼šhttps://www.meimolihan.eu.org:6663/console\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/halo.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/halo.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/halo.conf ## åå‘ä»£ç† halo åšå®¢ https://www.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8090 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 14 ã€é‡å®šå‘ baidu é‡å®šå‘ baiduï¼šhttps://baidu.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/baidu.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/baidu.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/baidu.conf ## é‡å®šå‘åˆ° baidu https://baidu.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key redir https://baidu.com{uri} ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 15 ã€nascab æ–‡ä»¶æµè§ˆå™¨ nascab æ–‡ä»¶æµè§ˆå™¨ï¼šhttps://nascab.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/nascab.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/nascab.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/nascab.conf ## åå‘ä»£ç† nascab æ–‡ä»¶æµè§ˆå™¨ https://nascab.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:5388 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 16 ã€npm åå‘ä»£ç† npm åå‘ä»£ç†ï¼šhttps://npm.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/npm.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/npm.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/npm.conf ## åå‘ä»£ç† npm åå‘ä»£ç† https://npm.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:81 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html # æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 17 ã€nastools åˆ®å‰Šå™¨ nastools åˆ®å‰Šå™¨ï¼šhttps://nastools.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/nastools.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/nastools.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/nastools.conf ## åå‘ä»£ç† nastools åˆ®å‰Šå™¨ https://nastools.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:3000 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 18 ã€sun-panel å¯¼èˆªé¡µ sun-panel å¯¼èˆªé¡µï¼šhttps://sun.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/sun-panel.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/sun-panel.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/sun-panel.conf ## åå‘ä»£ç† sun-panel å¯¼èˆªé¡µ https://sun.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:3002 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 19 ã€xunlei ä¸‹è½½å™¨ xunlei ä¸‹è½½ï¼šhttps://xunlei.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/xunlei.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/xunlei.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/xunlei.conf ## åå‘ä»£ç† xunlei ä¸‹è½½å™¨ https://xunlei.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:2345 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 20 ã€ittools å·¥å…·ç®± ittools å·¥å…·ç®±ï¼šhttps://ittools.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/ittools.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/ittools.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/ittools.conf # åå‘ä»£ç† ittools å·¥å…·ç®± https://ittools.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8088 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 21 ã€1panel é¢æ¿ 1panel é¢æ¿ï¼šhttps://1panel.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/1panel.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/1panel.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; /usr/local/caddy/conf.d/1panel.conf ## åå‘ä»£ç† 1panel é¢æ¿ https://1panel.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:10086 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload ","date":"2024-12-07T20:11:18+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ecbb81d6/","title":"Caddy é…ç½®æ–‡ä»¶ \u0026 æ— æ³¨é‡Šåˆ›å»º"},{"content":"Caddy é…ç½®æ–‡ä»¶ \u0026amp; æœ‰æ³¨é‡Šåˆ›å»º ä¸€ ã€Caddy ä¸»é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 touch /usr/local/caddy/Caddyfile \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/Caddyfile \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/Caddyfile \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy ä¸»é…ç½®æ–‡ä»¶ { http_port 86 https_port 6663 order webdav before file_server } ## å¼•ç”¨å…¶å®ƒç›®å½•çš„é…ç½®æ–‡ä»¶ import /usr/local/caddy/conf.d/*.conf EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload äºŒ ã€æˆ‘çš„ caddy ä¸ªäººé…ç½®æ–‡ä»¶ 1 ã€pve è™šæ‹Ÿæœº pve è™šæ‹Ÿæœºï¼šhttps://pve.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d /var/www/html/web \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/pve.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† PVE è™šæ‹Ÿæœº https://pve.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy https://10.10.10.254:8006 { transport http { tls_insecure_skip_verify } } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 2 ã€ikuai ä¸»è·¯ç”± ikuai ä¸»è·¯ç”±ï¼šhttps://ik.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/ik.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/ik.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/ik.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† ikuai ä¸»è·¯ç”± https://ik.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.253:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 3 ã€ars2 æ—è·¯ç”± ars2 è½¯è·¯ç”±ï¼šhttps://ars2.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/ars2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/ars2.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/ars2.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† ars2 æ—è·¯ç”± https://ars2.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.251:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 4 ã€istoreos-1 æ—è·¯ç”± istoreos-1 è½¯è·¯ç”±ï¼šhttps://istoreos1.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/istoreos-1.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/istoreos-1.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/istoreos-1.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† istoreos-1 æ—è·¯ç”± https://istoreos1.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.252:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 5 ã€istoreos-2 æ—è·¯ç”± istoreos-2 è½¯è·¯ç”±ï¼šhttps://istoreos2.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/istoreos-2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/istoreos-2.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/istoreos-2.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† istoreos-2 æ—è·¯ç”± https://istoreos2.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.243:80 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 6 ã€emby-debian åª’ä½“æœåŠ¡å™¨ï¼ˆè‡ªå®šä¹‰é™æ€é¡µï¼‰ emby-debian åª’ä½“æœåŠ¡å™¨ï¼šhttps://emby1.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/emby-debian.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/emby-debian.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/emby-debian.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† emby-debian åª’ä½“æœåŠ¡å™¨ https://emby1.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8896 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°emby.htmlé¡µé¢ rewrite * /jellyfin-6663.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 7 ã€emby-ars2 åª’ä½“æœåŠ¡å™¨ emby-ars2 åª’ä½“æœåŠ¡å™¨ï¼šhttps://emby2.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/emby-ars2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/emby-ars2.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/emby-ars2.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† emby-ars2 åª’ä½“æœåŠ¡å™¨ https://emby2.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.251:8896 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 8 ã€jellyfin-ars2 åª’ä½“æœåŠ¡å™¨ jellyfin-ars2 åª’ä½“æœåŠ¡å™¨ï¼šhttps://jellyfin251.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/jellyfin-ars2.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/jellyfin-ars2.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/jellyfin-ars2.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† jellyfin251 åª’ä½“æœåŠ¡å™¨ https://jellyfin251.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.251:8096 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 9 ã€jellyfin-debian åª’ä½“æœåŠ¡å™¨ jellyfin-debian åª’ä½“æœåŠ¡å™¨ï¼šhttps://jellyfin245.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/jellyfin-debian.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/jellyfin-debian.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/jellyfin-debian.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† jellyfin245 åª’ä½“æœåŠ¡å™¨ https://jellyfin245.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8096 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 10 ã€caddy-webdav æ–‡ä»¶æœåŠ¡ webdav æ–‡ä»¶æœåŠ¡ï¼šhttps://file.meimolihan.eu.org:6663\nç»ˆç«¯ç”Ÿæˆ12345çš„å¯†ç å‘½ä»¤ï¼š/usr/local/caddy/caddy hash-password --plaintext 12345 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/webdav.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/webdav.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/webdav.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† WebDAV æœåŠ¡ https://file.meimolihan.eu.org:6663 { ## è®¾ç½® /mnt ä¸ºå¯è¢«è®¿é—®ç›®å½•ï¼ˆå¯è‡ªè¡Œä¿®æ”¹ï¼‰ root * /mnt encode gzip ## ç»ˆç«¯ç”Ÿæˆ12345çš„å¯†ç å‘½ä»¤ï¼š/usr/local/caddy/caddy hash-password --plaintext 12345 ## ç”¨æˆ·åï¼šadminï¼ˆå¯è‡ªå®šä¹‰ï¼‰ basic_auth { admin $2a$14$yI/KQg2h5rQkXao4lzRMC.Rx5t3bRuGyCYkvEeiJyc9hUrYt0USsi } ## æŒ‡å®šè¯ä¹¦è·¯å¾„ï¼Œç»å¯¹è·¯å¾„ä¸º/usr/local/caddy/ssl/private.keyç­‰äºssl/private.key tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key route { rewrite /webdav /webdav/ webdav /webdav/* { ## è®¿é—®WebDAVæœåŠ¡çš„å‰ç¼€ prefix /webdav } ## å¯ç”¨å½“å‰ç›®å½•çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å…è®¸æµè§ˆæ–‡ä»¶åˆ—è¡¨ file_server browse } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 11 ã€caddy é™æ€é¡µ caddy é™æ€é¡µï¼šhttps://jingtai.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d /var/www/html/web \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/jingtai.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/jingtai.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/jingtai.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† caddy é™æ€é¡µ https://jingtai.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key ## å®šä¹‰ index.html æ–‡ä»¶è·¯å¾„ root * /var/www/html/web ## å¯åŠ¨é™æ€èµ„æº file_server browse ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 12 ã€caddy æ–‡ä»¶æœåŠ¡ caddy æ–‡ä»¶æœåŠ¡ï¼šhttps://wenjian.meimolihan.eu.org:6663\næ–‡ä»¶è·¯å¾„ï¼šcd /usr/local/caddy/wenjian \u0026amp;\u0026amp; ls 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d /usr/local/caddy/wenjian \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/wenjian.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/wenjian.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/wenjian.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy æ–‡ä»¶æœåŠ¡ https://wenjian.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key ## å®šä¹‰æ–‡ä»¶æœåŠ¡è·¯å¾„/usr/local/caddyè·¯å¾„ä¸‹ä¸è¦æœ‰index.htmlæ–‡ä»¶ root * /usr/local/caddy/wenjian ## å¯ç”¨å½“å‰ç›®å½•çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å…è®¸æµè§ˆæ–‡ä»¶åˆ—è¡¨ file_server browse ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 13 ã€halo åšå®¢ halo åšå®¢å‰å°ï¼šhttps://www.meimolihan.eu.org:6663 halo åšå®¢åå°ï¼šhttps://www.meimolihan.eu.org:6663/console\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/halo.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/halo.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/halo.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† halo åšå®¢ https://www.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8090 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 14 ã€é‡å®šå‘ baidu é‡å®šå‘ baiduï¼šhttps://baidu.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/baidu.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/baidu.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/baidu.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## é‡å®šå‘åˆ° baidu https://baidu.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key redir https://baidu.com{uri} ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 15 ã€nascab æ–‡ä»¶æµè§ˆå™¨ nascab æ–‡ä»¶æµè§ˆå™¨ï¼šhttps://nascab.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/nascab.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/nascab.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/nascab.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† nascab æ–‡ä»¶æµè§ˆå™¨ https://nascab.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:5388 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 16 ã€npm åå‘ä»£ç† npm åå‘ä»£ç†ï¼šhttps://npm.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/npm.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/npm.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/npm.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† npm åå‘ä»£ç† https://npm.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:81 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html # æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 17 ã€nastools åˆ®å‰Šå™¨ nastools åˆ®å‰Šå™¨ï¼šhttps://nastools.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/nastools.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/nastools.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/nastools.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† nastools åˆ®å‰Šå™¨ https://nastools.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:3000 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 18 ã€sun-panel å¯¼èˆªé¡µ sun-panel å¯¼èˆªé¡µï¼šhttps://sun.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/sun-panel.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/sun-panel.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/sun-panel.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† sun-panel å¯¼èˆªé¡µ https://sun.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:3002 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 19 ã€xunlei ä¸‹è½½å™¨ xunlei ä¸‹è½½ï¼šhttps://xunlei.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/xunlei.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/xunlei.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/xunlei.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† xunlei ä¸‹è½½å™¨ https://xunlei.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:2345 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 20 ã€ittools å·¥å…·ç®± ittools å·¥å…·ç®±ï¼šhttps://ittools.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/ittools.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/ittools.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/ittools.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # åå‘ä»£ç† ittools å·¥å…·ç®± https://ittools.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:8088 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload 21 ã€1panel é¢æ¿ 1panel é¢æ¿ï¼šhttps://1panel.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/1panel.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/1panel.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/1panel.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## åå‘ä»£ç† 1panel é¢æ¿ https://1panel.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy http://10.10.10.245:10086 { header_up Host {http.reverse_proxy.upstream.hostport} } ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html ## å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload ","date":"2024-12-07T20:10:47+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/856f9120/","title":"Caddy é…ç½®æ–‡ä»¶ \u0026 æœ‰æ³¨é‡Šåˆ›å»º"},{"content":"Caddy æ­å»º webdav æœåŠ¡å™¨ ğŸ–¥ï¸ âœ¨ Caddy æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¼€æº Web æœåŠ¡å™¨ï¼Œä»¥å…¶é…ç½®ç®€å•ã€è‡ªåŠ¨ HTTPS å’Œé«˜åº¦å¯æ‰©å±•æ€§è€Œè‘—ç§°ã€‚å®ƒå‡­å€Ÿç®€æ´çš„ Caddyfile é…ç½®è¯­æ³•å’Œå†…ç½®çš„è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ï¼ˆé€šè¿‡ Let\u0026rsquo;s Encryptï¼‰ï¼Œè®©ç”¨æˆ·èƒ½å¿«é€Ÿéƒ¨ç½²å„ç§ç½‘ç»œæœåŠ¡ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Caddy å¿«é€Ÿæ­å»ºä¸€ä¸ªå®‰å…¨ã€é«˜æ•ˆçš„ WebDAV æœåŠ¡å™¨ï¼Œå®ç°è·¨è®¾å¤‡çš„æ–‡ä»¶å…±äº«ä¸ç®¡ç†ã€‚\nğŸ”§ WebDAVï¼ˆWeb Distributed Authoring and Versioningï¼‰ æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„æ‰©å±•ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç½‘ç»œç›´æ¥ç¼–è¾‘å’Œç®¡ç†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚å®ƒç›¸å½“äºâ€œç½‘ç»œç£ç›˜â€ï¼Œæ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€åˆ›å»ºç›®å½•ç­‰æ“ä½œï¼Œå¹¶å…·æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ï¼ˆå¦‚ Windows èµ„æºç®¡ç†å™¨ã€macOS Finder ç­‰å‡å¯ç›´æ¥æŒ‚è½½ï¼‰ã€‚\nğŸ“‹ æ–‡ç« ç›®å½• âœ¨ Caddy ä¸ WebDAV ç®€ä»‹ ğŸ“¦ ä¸€ã€Ubuntu å®‰è£…äºŒè¿›åˆ¶ Caddy 1. åˆ›å»º Caddy ç›®å½• 2. ä¸‹è½½ Caddy 3. ä¸Šä¼ å¹¶é‡å‘½å Caddy 4. èµ‹äºˆæ‰§è¡Œæƒé™ 5. å‡çº§ Caddy ç‰ˆæœ¬ 6. æŸ¥çœ‹æ¨¡å—åˆ—è¡¨ 7. æ·»åŠ åŒ…å‡çº§ 8. æŸ¥çœ‹ç‰ˆæœ¬ 9. æŸ¥çœ‹é»˜è®¤ç«¯å£ âš™ï¸ äºŒã€åˆ›å»º WebDAV æ–‡ä»¶æœåŠ¡é…ç½® 1. Windows æŒ‚è½½æ–¹å¼ 2. ç”Ÿæˆå¯†ç å¹¶åˆ›å»ºé…ç½®æ–‡ä»¶ ğŸ’» ä¸‰ã€Windows å¼€æœºè‡ªåŠ¨æŒ‚è½½ Samba å’Œ WebDAV 1. æŸ¥çœ‹ Samba é…ç½® 2. åˆ›å»ºå¼€æœºè‡ªå¯åŠ¨è„šæœ¬ 3. æ‰“å¼€è‡ªå¯åŠ¨ç›®å½• âœ¨ Caddy ä¸ WebDAV ç®€ä»‹ Caddy æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æº Web æœåŠ¡å™¨ï¼Œä¸ Nginx æˆ– Apache ç›¸æ¯”ï¼Œå®ƒçš„æœ€å¤§ä¼˜åŠ¿åœ¨äºé…ç½®ç®€å•ä¸”é»˜è®¤æ”¯æŒè‡ªåŠ¨ HTTPSã€‚é€šè¿‡å…¶æ’ä»¶ç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾æ‰©å±•åŠŸèƒ½ï¼Œä¾‹å¦‚æ­å»º WebDAV æœåŠ¡ã€‚\nğŸ” WebDAV çš„ä¼˜åŠ¿ï¼š\nè·¨å¹³å°æ”¯æŒï¼šWindowsã€macOSã€Linux ç­‰ç³»ç»Ÿå‡å¯ç›´æ¥æŒ‚è½½ä½¿ç”¨ï¼› æ•°æ®å®‰å…¨ï¼šé…åˆ Caddy å¯è½»æ¾å¯ç”¨ HTTPS åŠ å¯†ä¼ è¾“ï¼› æ“ä½œç®€ä¾¿ï¼šåƒæ“ä½œæœ¬åœ°ç£ç›˜ä¸€æ ·ç®¡ç†è¿œç¨‹æ–‡ä»¶ã€‚ ğŸ“¦ ä¸€ã€Ubuntu å®‰è£…äºŒè¿›åˆ¶ Caddy 1. åˆ›å»º Caddy å­˜æ”¾ç›®å½•ï¼ˆåŒ…æ‹¬è¯ä¹¦å­˜æ”¾ç›®å½•ï¼‰ 1 mkdir -p /usr/local/caddy/ssl \u0026amp;\u0026amp; cd /usr/local/caddy 2. ä¸‹è½½ Caddy åˆ° Caddy å®˜ç½‘ ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¹³å°é€‰æ‹© Linux amd64ï¼‰ï¼Œé€‰ä¸­å¸¦æœ‰ WebDAV æ’ä»¶çš„å¯æ‰§è¡Œç¨‹åºï¼Œç‚¹å‡»ä¸‹è½½ã€‚\n3. å°†ä¸‹è½½å¥½çš„ Caddy ç¨‹åºä¸Šä¼ åˆ° /usr/local/caddy ç›®å½•ä¸­å¹¶é‡å‘½å 1 cd /usr/local/caddy \u0026amp;\u0026amp; mv caddy_linux_* caddy 4. èµ‹äºˆæ‰§è¡Œæƒé™ 1 chmod u+x /usr/local/caddy/caddy 5. å‡çº§ Caddy ç‰ˆæœ¬ 1 cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy upgrade 6. æŸ¥çœ‹å½“å‰äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«çš„éæ ‡å‡†æ¨¡å—çš„åŒ…ååˆ—è¡¨ 1 cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy list-modules --packages 7. äºŒè¿›åˆ¶ Caddy å‡çº§å‘½ä»¤ 1 cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy add-package github.com/caddyserver/caddy/v2 8. æŸ¥çœ‹ Caddy ç‰ˆæœ¬ 1 cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy version 9. æŸ¥çœ‹ Caddy é»˜è®¤ç«¯å£ Caddy é»˜è®¤ç®¡ç†ç«¯å£ä¸º 2019ï¼Œå¯ç”¨äºæ£€æŸ¥è¿è¡ŒçŠ¶æ€ï¼š\n1 curl localhost:2019 âš™ï¸ äºŒã€åˆ›å»º WebDAV æ–‡ä»¶æœåŠ¡é…ç½®æ–‡ä»¶ WebDAV æ–‡ä»¶æœåŠ¡åœ°å€ï¼šhttps://file.meimolihan.eu.org:6663\n1. Windows æŒ‚è½½æ–¹å¼ åœ¨ Windows ä¸­ï¼Œå¯ä»¥é€šè¿‡èµ„æºç®¡ç†å™¨ç›´æ¥æŒ‚è½½ WebDAVï¼š\næ‰“å¼€â€œæ­¤ç”µè„‘â€ â†’ å³é”®â€œç½‘ç»œâ€ â†’ â€œæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨â€ï¼› è¾“å…¥ä»¥ä¸‹åœ°å€å¹¶è®¾ç½®å‡­æ®ï¼š 1 https://file.meimolihan.eu.org:6663/webdav 2. ç”Ÿæˆå¯†ç å¹¶åˆ›å»ºé…ç½®æ–‡ä»¶ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”ŸæˆåŠ å¯†å¯†ç ï¼ˆç¤ºä¾‹æ˜æ–‡å¯†ç ä¸º 12345ï¼‰ï¼š\n1 /usr/local/caddy/caddy hash-password --plaintext 12345 åˆ›å»º WebDAV é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/webdav.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/webdav.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/webdav.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## caddy åå‘ä»£ç† WebDAV æœåŠ¡ https://file.meimolihan.eu.org:6663 { ## è®¾ç½® /mnt ä¸ºå¯è¢«è®¿é—®ç›®å½•ï¼ˆå¯è‡ªè¡Œä¿®æ”¹ï¼‰ root * /mnt encode gzip ## ç»ˆç«¯ç”Ÿæˆ12345çš„å¯†ç å‘½ä»¤ï¼š/usr/local/caddy/caddy hash-password --plaintext 12345 ## ç”¨æˆ·åï¼šadminï¼ˆå¯è‡ªå®šä¹‰ï¼‰ basic_auth { admin $2a$14$yI/KQg2h5rQkXao4lzRMC.Rx5t3bRuGyCYkvEeiJyc9hUrYt0USsi } ## æŒ‡å®šè¯ä¹¦è·¯å¾„ï¼Œç»å¯¹è·¯å¾„ä¸º/usr/local/caddy/ssl/private.keyç­‰äºssl/private.key tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key route { rewrite /webdav /webdav/ webdav /webdav/* { ## è®¿é—®WebDAVæœåŠ¡çš„å‰ç¼€ prefix /webdav } ## å¯ç”¨å½“å‰ç›®å½•çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œå¹¶å…è®¸æµè§ˆæ–‡ä»¶åˆ—è¡¨ file_server browse } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload ğŸ’» ä¸‰ã€Windows å¼€æœºè‡ªåŠ¨æŒ‚è½½ Samba å’Œ WebDAV 1. æŸ¥çœ‹ Samba é…ç½®æ–‡ä»¶ åœ¨ Linux ç«¯æŸ¥çœ‹ Samba å…±äº«é…ç½®ï¼š\n1 cat /etc/samba/smb.conf 2. åœ¨ Windows åˆ›å»ºå¼€æœºè‡ªå¯åŠ¨è„šæœ¬ åˆ›å»ºä¸€ä¸ª .bat è„šæœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆæ ¹æ®å®é™…ä¿®æ”¹ IPã€å…±äº«åå’Œå¯†ç ï¼‰ï¼š\n1 2 3 4 net use Z: \\\\10.10.10.254\\PVE-mydisk yifan0719 /user:root net use Y: \\\\10.10.10.245\\Debian yifan0719 /user:admin net use X: \\\\10.10.10.254\\PVE-ntfs yifan0719 /user:root net use W: https://file.meimolihan.eu.org:6663/webdav /user:admin yifan0719 3. æ‰“å¼€å¼€æœºè‡ªå¯åŠ¨ç›®å½• åœ¨ Windows ä¸­æŒ‰ä¸‹ Win + Rï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯æ‰“å¼€è‡ªå¯åŠ¨æ–‡ä»¶å¤¹ï¼š\n1 shell:startup å°†ä¸Šè¿° .bat è„šæœ¬æ”¾å…¥è¯¥æ–‡ä»¶å¤¹å³å¯å®ç°å¼€æœºè‡ªåŠ¨æŒ‚è½½ã€‚\nğŸ‰ æ€»ç»“ï¼šé€šè¿‡ Caddy æ­å»º WebDAV æœåŠ¡ä¸ä»…é…ç½®ç®€å•ï¼Œè€Œä¸”å®‰å…¨æ€§é«˜ï¼ˆè‡ªåŠ¨ HTTPSï¼‰ï¼Œç»“åˆ Windows çš„å¼€æœºè‡ªåŠ¨æŒ‚è½½åŠŸèƒ½ï¼Œå¯ä»¥å®ç°ä¾¿æ·çš„è·¨è®¾å¤‡æ–‡ä»¶ç®¡ç†ã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼\n","date":"2024-12-07T20:10:09+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/20641dd6/","title":"Caddy æ­å»º webdav æœåŠ¡å™¨ ğŸ–¥ï¸"},{"content":"Nginx æ­å»º WebDAV æœåŠ¡å™¨ ğŸ–¥ï¸ ğŸ“– ç›®å½•å¯¼èˆª âœ¨ WebDAV ç®€ä»‹ä¸ä¼˜åŠ¿ ğŸš€ ä¸€ã€WebDAV æœåŠ¡å™¨éƒ¨ç½² âš™ï¸ äºŒã€SSL è¯ä¹¦é…ç½® ğŸ“± ä¸‰ã€å®¢æˆ·ç«¯è¿æ¥æŒ‡å— ğŸ”’ å››ã€å®‰å…¨åŠ å›º ğŸ› ï¸ äº”ã€ç»´æŠ¤ä¸ç®¡ç† ğŸ› å…­ã€æ•…éšœæ’é™¤ ğŸŒ ä¸ƒã€é«˜çº§åŠŸèƒ½ ğŸ“Š æ€»ç»“ âœ¨ WebDAV ç®€ä»‹ä¸ä¼˜åŠ¿ WebDAV (Web Distributed Authoring and Versioning) æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„æ‰©å±•ï¼Œå…è®¸ç”¨æˆ·è¿œç¨‹ç¼–è¾‘å’Œç®¡ç†æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸŒ è·¨å¹³å°è®¿é—®ï¼šæ”¯æŒ Windowsã€macOSã€Linuxã€iOS å’Œ Android ğŸ”’ å®‰å…¨ä¼ è¾“ï¼šæ”¯æŒ SSL/TLS åŠ å¯†ï¼Œä¿éšœæ•°æ®ä¼ è¾“å®‰å…¨ ğŸ“ æ–‡ä»¶ç®¡ç†ï¼šæ”¯æŒä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€ç§»åŠ¨ã€å¤åˆ¶ç­‰æ“ä½œ ğŸ‘¥ æƒé™æ§åˆ¶ï¼šæ”¯æŒç”¨æˆ·è®¤è¯å’Œè®¿é—®æƒé™ç®¡ç† âš¡ é«˜æ€§èƒ½ï¼šåŸºäº Nginxï¼Œæä¾›é«˜æ•ˆçš„æ–‡ä»¶æœåŠ¡æ€§èƒ½ ğŸ”„ ç‰ˆæœ¬æ§åˆ¶ï¼šæ”¯æŒæ–‡ä»¶ç‰ˆæœ¬ç®¡ç†å’Œå†²çªè§£å†³ ğŸ’¾ å¤§æ–‡ä»¶æ”¯æŒï¼šæ— æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œé€‚åˆå¤§å‹æ–‡ä»¶ä¼ è¾“ ğŸ“Š é…é¢ç®¡ç†ï¼šæ”¯æŒç£ç›˜ç©ºé—´é…é¢é™åˆ¶ ğŸš€ ä¸€ã€WebDAV æœåŠ¡å™¨éƒ¨ç½² 1ï¸âƒ£ å®‰è£… Nginx with WebDAV æ¨¡å— 1 2 3 4 5 6 7 8 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… nginx-fullï¼ˆåŒ…å« WebDAV æ¨¡å—ï¼‰ sudo apt update \u0026amp;\u0026amp; sudo apt install nginx-full -y # éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ nginx -V | grep dav # æ£€æŸ¥ Nginx ç‰ˆæœ¬å’Œæ¨¡å— nginx -v 2ï¸âƒ£ è®¾ç½®ç›®å½•æƒé™ 1 2 3 4 5 6 7 8 9 10 11 12 13 # è®¾ç½®å…±äº«ç›®å½•æ‰€æœ‰æƒç»™ Nginx ç”¨æˆ· sudo chown -R www-data:www-data /mnt # è®¾ç½®é€‚å½“çš„ç›®å½•æƒé™ sudo chmod -R 755 /mnt # éªŒè¯æƒé™è®¾ç½® ls -la /mnt/ # åˆ›å»ºä¸“é—¨çš„ WebDAV ç›®å½•ï¼ˆå¯é€‰ï¼‰ sudo mkdir -p /mnt/webdav sudo chown www-data:www-data /mnt/webdav sudo chmod 755 /mnt/webdav 3ï¸âƒ£ åˆ›å»ºç”¨æˆ·è®¤è¯æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»º WebDAV é…ç½®ç›®å½• sudo mkdir -p /etc/webdav # åˆ›å»ºç”¨æˆ·è®¤è¯æ–‡ä»¶ï¼ˆç”¨æˆ·å: admin, å¯†ç : 123456ï¼‰ sudo sh -c \u0026#39;echo -n \u0026#34;admin:\u0026#34; \u0026gt; /etc/webdav/.credentials.list\u0026#39; sudo sh -c \u0026#39;openssl passwd -apr1 123456 \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; # è®¾ç½®è®¤è¯æ–‡ä»¶æƒé™ sudo chmod 600 /etc/webdav/.credentials.list # éªŒè¯è®¤è¯æ–‡ä»¶ cat /etc/webdav/.credentials.list # æ·»åŠ å¤šä¸ªç”¨æˆ·ï¼ˆå¯é€‰ï¼‰ sudo sh -c \u0026#39;echo -n \u0026#34;user1:\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; sudo sh -c \u0026#39;openssl passwd -apr1 \u0026#34;password1\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; 4ï¸âƒ£ åˆ›å»º Nginx WebDAV é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 # åˆ›å»º WebDAV é…ç½®æ–‡ä»¶ sudo tee /etc/nginx/conf.d/webdav.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { # ç›‘å¬ 666 ç«¯å£å¹¶å¯ç”¨ SSL listen 666 ssl http2; listen [::]:666 ssl http2; # æœåŠ¡å™¨åç§° server_name webdav.mobufan.eu.org; # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; # SSL åè®®é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SSHA256:DHE-RSA-AES256-GCM-SHA384; # å­—ç¬¦ç¼–ç è®¾ç½® charset utf-8; # å¯ç”¨ç›®å½•åˆ—è¡¨æ˜¾ç¤º autoindex on; # WebDAV æ ¹ç›®å½• root /mnt; # è®¤è¯é…ç½® auth_basic \u0026#34;WebDAV Authentication\u0026#34;; auth_basic_user_file /etc/webdav/.credentials.list; # WebDAV æ–¹æ³•æ”¯æŒ dav_methods PUT DELETE MKCOL COPY MOVE; dav_ext_methods PROPFIND OPTIONS; # æ–‡ä»¶æƒé™è®¾ç½® dav_access user:rw group:rw all:r; # å®¢æˆ·ç«¯è®¾ç½® client_body_temp_path /tmp; client_max_body_size 0; # å…è®¸åˆ›å»ºç›®å½• create_full_put_path on; # å®‰å…¨å¤´è®¾ç½® add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options DENY always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; # é”™è¯¯é¡µé¢å¤„ç† error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; internal; } # é™åˆ¶ç‰¹å®šæ–‡ä»¶ç±»å‹çš„è®¿é—®ï¼ˆå¯é€‰ï¼‰ location ~* \\.(php|asp|aspx|jsp)$ { deny all; return 403; } } EOF # è®¾ç½®é…ç½®æ–‡ä»¶æƒé™ sudo chmod 644 /etc/nginx/conf.d/webdav.conf 5ï¸âƒ£ é‡å¯ Nginx æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡å¯ Nginx æœåŠ¡ sudo systemctl restart nginx # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # å¯ç”¨ Nginx å¼€æœºè‡ªå¯ sudo systemctl enable nginx âš™ï¸ äºŒã€SSL è¯ä¹¦é…ç½® 1ï¸âƒ£ ä½¿ç”¨ Let\u0026rsquo;s Encrypt è·å–å…è´¹è¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£… Certbot sudo apt install certbot python3-certbot-nginx -y # è·å– SSL è¯ä¹¦ï¼ˆéœ€è¦åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨ï¼‰ sudo certbot --nginx -d webdav.mobufan.eu.org # è®¾ç½®è¯ä¹¦è‡ªåŠ¨ç»­æœŸ sudo crontab -l | { cat; echo \u0026#34;0 12 * * * /usr/bin/certbot renew --quiet\u0026#34;; } | sudo crontab - # éªŒè¯è¯ä¹¦çŠ¶æ€ sudo certbot certificates 2ï¸âƒ£ æ‰‹åŠ¨é…ç½® SSL è¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºè¯ä¹¦ç›®å½• sudo mkdir -p /etc/nginx/keyfile # æ”¾ç½®è¯ä¹¦æ–‡ä»¶ï¼ˆå‡è®¾å·²æœ‰è¯ä¹¦æ–‡ä»¶ï¼‰ sudo cp /path/to/your/cert.pem /etc/nginx/keyfile/cert.pem sudo cp /path/to/your/key.pem /etc/nginx/keyfile/key.pem # è®¾ç½®è¯ä¹¦æ–‡ä»¶æƒé™ sudo chmod 600 /etc/nginx/keyfile/* sudo chown www-data:www-data /etc/nginx/keyfile/* # éªŒè¯è¯ä¹¦æ–‡ä»¶ sudo openssl x509 -in /etc/nginx/keyfile/cert.pem -text -noout ğŸ“± ä¸‰ã€å®¢æˆ·ç«¯è¿æ¥æŒ‡å— 1ï¸âƒ£ Windows è¿æ¥ æ‰“å¼€\u0026quot;æ­¤ç”µè„‘\u0026quot; å³é”®ç‚¹å‡»\u0026quot;æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨\u0026quot; è¾“å…¥åœ°å€: https://webdav.mobufan.eu.org:666 å‹¾é€‰\u0026quot;ä½¿ç”¨å…¶ä»–å‡­æ®è¿æ¥\u0026quot; è¾“å…¥ç”¨æˆ·å: adminï¼Œå¯†ç : 123456 å‘½ä»¤è¡Œæ–¹å¼:\n1 net use * https://webdav.mobufan.eu.org:666 /user:admin 123456 2ï¸âƒ£ macOS è¿æ¥ æ‰“å¼€\u0026quot;è®¿è¾¾\u0026quot; ç‚¹å‡»\u0026quot;å‰å¾€\u0026quot; â†’ \u0026ldquo;è¿æ¥æœåŠ¡å™¨\u0026rdquo; è¾“å…¥åœ°å€: https://webdav.mobufan.eu.org:666 è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  å‘½ä»¤è¡Œæ–¹å¼:\n1 2 3 4 5 # å®‰è£… WebDAV å®¢æˆ·ç«¯ brew install cadaver # è¿æ¥ WebDAV æœåŠ¡å™¨ cadaver https://webdav.mobufan.eu.org:666 3ï¸âƒ£ Linux è¿æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®‰è£… davfs2 å®¢æˆ·ç«¯ sudo apt install davfs2 -y # åˆ›å»ºæŒ‚è½½ç‚¹ sudo mkdir /mnt/webdav # æŒ‚è½½ WebDAV å…±äº« sudo mount -t davfs https://webdav.mobufan.eu.org:666 /mnt/webdav # è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  # å¸è½½å…±äº« sudo umount /mnt/webdav 4ï¸âƒ£ ç§»åŠ¨ç«¯è¿æ¥ (ESæ–‡ä»¶æµè§ˆå™¨) æ‰“å¼€ ESæ–‡ä»¶æµè§ˆå™¨ ç‚¹å‡»\u0026quot;æœåŠ¡\u0026quot; â†’ \u0026ldquo;æ–°å»º\u0026rdquo; â†’ \u0026ldquo;WebDAV\u0026rdquo; é…ç½®è¿æ¥ä¿¡æ¯: æœåŠ¡å™¨: webdav.mobufan.eu.org:666 ç”¨æˆ·å: admin å¯†ç : 123456 å‹¾é€‰\u0026quot;HTTPS\u0026quot; 5ï¸âƒ£ ä½¿ç”¨ curl æµ‹è¯•è¿æ¥ 1 2 3 4 5 6 7 8 # æµ‹è¯• WebDAV è¿æ¥ curl -X PROPFIND https://webdav.mobufan.eu.org:666 -u admin:123456 # ä¸Šä¼ æ–‡ä»¶ curl -T localfile.txt https://webdav.mobufan.eu.org:666/ -u admin:123456 # ä¸‹è½½æ–‡ä»¶ curl -o localfile.txt https://webdav.mobufan.eu.org:666/remotefile.txt -u admin:123456 ğŸ”’ å››ã€å®‰å…¨åŠ å›º 1ï¸âƒ£ é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯ç”¨ UFW é˜²ç«å¢™ sudo ufw enable # å¼€æ”¾ SSH ç«¯å£ sudo ufw allow 22/tcp # å¼€æ”¾ WebDAV ç«¯å£ sudo ufw allow 666/tcp # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ sudo ufw status verbose # é™åˆ¶ç‰¹å®š IP è®¿é—®ï¼ˆå¯é€‰ï¼‰ sudo ufw allow from 192.168.1.0/24 to any port 666 2ï¸âƒ£ é™åˆ¶è®¿é—® IP 1 2 3 4 5 6 7 8 9 10 11 # åœ¨ Nginx é…ç½®ä¸­æ·»åŠ  IP é™åˆ¶ location / { allow 192.168.1.0/24; allow 10.10.10.0/24; deny all; # æˆ–è€…ä½¿ç”¨ geo æ¨¡å— # if ($remote_addr !~ \u0026#34;^(192\\.168\\.1|10\\.10\\.10)\u0026#34;) { # return 403; # } } 3ï¸âƒ£ å¢å¼ºè®¤è¯å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç  sudo sh -c \u0026#39;echo -n \u0026#34;admin:\u0026#34; \u0026gt; /etc/webdav/.credentials.list\u0026#39; sudo sh -c \u0026#39;openssl passwd -apr1 \u0026#34;StrongPassword123!\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; # å®šæœŸæ›´æ¢å¯†ç  # å»ºè®®æ¯æœˆæ›´æ¢ä¸€æ¬¡å¯†ç  # ä½¿ç”¨ fail2ban é˜²æ­¢æš´åŠ›ç ´è§£ sudo apt install fail2ban -y # åˆ›å»º WebDAV fail2ban é…ç½® sudo tee /etc/fail2ban/jail.d/webdav.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [nginx-webdav] enabled = true port = http,https,666 filter = nginx-auth logpath = /var/log/nginx/access.log maxretry = 3 bantime = 3600 findtime = 600 EOF 4ï¸âƒ£ å…¶ä»–å®‰å…¨æªæ–½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # éšè— Nginx ç‰ˆæœ¬ä¿¡æ¯ server_tokens off; # é™åˆ¶è¯·æ±‚æ–¹æ³• if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|PROPFIND|OPTIONS|MKCOL)$) { return 405; } # é™åˆ¶è¯·æ±‚å¤§å° client_max_body_size 10G; client_body_buffer_size 128k; # è®¾ç½®å®‰å…¨å¤´ add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubdomains; preload\u0026#34;; add_header X-Content-Type-Options nosniff; add_header X-Frame-Options DENY; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; ğŸ› ï¸ äº”ã€ç»´æŠ¤ä¸ç®¡ç† 1ï¸âƒ£ Nginx æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹ Nginx çŠ¶æ€ sudo systemctl status nginx # é‡å¯ Nginx sudo systemctl restart nginx # é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ sudo systemctl reload nginx # æŸ¥çœ‹ Nginx æ—¥å¿— sudo tail -f /var/log/nginx/access.log sudo tail -f /var/log/nginx/error.log # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t 2ï¸âƒ£ å‡çº§ Nginx 1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å‡çº§ Nginx sudo apt upgrade nginx-full -y # éªŒè¯ç‰ˆæœ¬ nginx -v # æŸ¥çœ‹å·²å®‰è£…çš„æ¨¡å— nginx -V 3ï¸âƒ£ ç›‘æ§ç£ç›˜ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h /mnt # è®¾ç½®ç£ç›˜é…é¢ï¼ˆå¦‚æœéœ€è¦ï¼‰ # å®‰è£…é…é¢å·¥å…· sudo apt install quota -y # å¯ç”¨é…é¢ sudo edquota -u www-data # ç›‘æ§å¤§æ–‡ä»¶ find /mnt -type f -size +100M -exec ls -lh {} \\; 4ï¸âƒ£ æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # è®¾ç½®æ—¥å¿—è½®è½¬ sudo tee /etc/logrotate.d/nginx-webdav \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /var/log/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts postrotate if [ -f /var/run/nginx.pid ]; then kill -USR1 `cat /var/run/nginx.pid` fi endscript } EOF ğŸ› å…­ã€æ•…éšœæ’é™¤ 1ï¸âƒ£ å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬ sudo netstat -tuln | grep :666 # æµ‹è¯• SSL è¯ä¹¦ openssl s_client -connect webdav.mobufan.eu.org:666 -servername webdav.mobufan.eu.org # æµ‹è¯• WebDAV è¿æ¥ curl -X PROPFIND https://webdav.mobufan.eu.org:666 -u admin:password # æ£€æŸ¥æ–‡ä»¶æƒé™ namei -l /mnt/somefile.txt # æ£€æŸ¥ SELinux/AppArmor çŠ¶æ€ sudo sestatus # SELinux sudo aa-status # AppArmor # ä¸´æ—¶ç¦ç”¨ SELinux/AppArmor è¿›è¡Œæµ‹è¯• sudo setenforce 0 # SELinux sudo aa-complain /usr/sbin/nginx # AppArmor 2ï¸âƒ£ æ—¥å¿—åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è®¤è¯æ—¥å¿— sudo grep webdav /var/log/nginx/access.log # å®æ—¶ç›‘æ§è¿æ¥ sudo ngxtop # æŸ¥æ‰¾é”™è¯¯å’Œè­¦å‘Š sudo grep -E \u0026#34;(error|warn)\u0026#34; /var/log/nginx/error.log # æŸ¥çœ‹æœ€è¿‘è®¿é—® sudo tail -n 100 /var/log/nginx/access.log | awk \u0026#39;{print $1, $4, $7, $9}\u0026#39; 3ï¸âƒ£ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # åœ¨ Nginx é…ç½®ä¸­æ·»åŠ æ€§èƒ½ä¼˜åŒ– http { # ç¼“å†²åŒºå’Œè¶…æ—¶è®¾ç½® client_body_buffer_size 128k; client_max_body_size 0; client_header_timeout 3m; client_body_timeout 3m; send_timeout 3m; # è¿æ¥è®¾ç½® keepalive_timeout 65; keepalive_requests 100; # æ–‡ä»¶ä¼ è¾“ä¼˜åŒ– sendfile on; tcp_nopush on; tcp_nodelay on; # Gzip å‹ç¼© gzip on; gzip_vary on; gzip_min_length 1024; gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json; # ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; } ğŸŒ ä¸ƒã€é«˜çº§åŠŸèƒ½ 1ï¸âƒ£ å¤šç”¨æˆ·æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºå¤šä¸ªç”¨æˆ· sudo sh -c \u0026#39;echo -n \u0026#34;user1:\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; sudo sh -c \u0026#39;openssl passwd -apr1 \u0026#34;password1\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; sudo sh -c \u0026#39;echo -n \u0026#34;user2:\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; sudo sh -c \u0026#39;openssl passwd -apr1 \u0026#34;password2\u0026#34; \u0026gt;\u0026gt; /etc/webdav/.credentials.list\u0026#39; # ä¸ºç”¨æˆ·åˆ›å»ºä¸“å±ç›®å½• sudo mkdir -p /mnt/user1 /mnt/user2 sudo chown www-data:www-data /mnt/user1 /mnt/user2 sudo chmod 755 /mnt/user1 /mnt/user2 2ï¸âƒ£ ç›®å½•æƒé™æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å¯¹ä¸åŒç›®å½•è®¾ç½®ä¸åŒæƒé™ location /public { dav_access user:rw group:r all:r; auth_basic off; } location /private { dav_access user:rw group: none; auth_basic \u0026#34;Private Area\u0026#34;; auth_basic_user_file /etc/webdav/.credentials.list; } # ç”¨æˆ·ä¸“å±ç›®å½• location /user1 { alias /mnt/user1; auth_basic \u0026#34;User1 Area\u0026#34;; auth_basic_user_file /etc/webdav/.credentials.list; # é™åˆ¶åªæœ‰ user1 å¯ä»¥è®¿é—® if ($remote_user != \u0026#34;user1\u0026#34;) { return 403; } } 3ï¸âƒ£ å¸¦å®½é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # é™åˆ¶ä¸‹è½½é€Ÿåº¦ location /large-files { limit_rate 1m; # é™åˆ¶ä¸º 1MB/s } # é™åˆ¶ä¸Šä¼ é€Ÿåº¦ client_body_timeout 300s; client_header_timeout 300s; client_body_in_file_only clean; client_body_buffer_size 256k; # æŒ‰ç”¨æˆ·é™åˆ¶å¸¦å®½ map $remote_user $user_rate { default 1m; \u0026#34;admin\u0026#34; 10m; \u0026#34;user1\u0026#34; 2m; } server { # ... limit_rate $user_rate; } 4ï¸âƒ£ è‡ªå®šä¹‰é”™è¯¯é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 # è‡ªå®šä¹‰é”™è¯¯é¡µé¢ error_page 400 /error/400.html; error_page 401 /error/401.html; error_page 403 /error/403.html; error_page 404 /error/404.html; error_page 500 502 503 504 /error/50x.html; location /error { internal; alias /usr/share/nginx/html/error; } ğŸ“Š æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²ç»æˆåŠŸéƒ¨ç½²äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Nginx WebDAV æœåŠ¡å™¨ï¼š\nâœ… ç¯å¢ƒå‡†å¤‡ï¼šå®‰è£… Nginx with WebDAV æ¨¡å— âœ… æƒé™é…ç½®ï¼šè®¾ç½®é€‚å½“çš„æ–‡ä»¶å’Œç›®å½•æƒé™ âœ… ç”¨æˆ·è®¤è¯ï¼šåˆ›å»ºå®‰å…¨çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ âœ… SSL åŠ å¯†ï¼šé…ç½® HTTPS åŠ å¯†è¿æ¥ âœ… å®¢æˆ·ç«¯è¿æ¥ï¼šæ”¯æŒå¤šç§å®¢æˆ·ç«¯è®¿é—® âœ… å®‰å…¨åŠ å›ºï¼šå¢å¼ºæœåŠ¡å™¨å®‰å…¨æ€§ âœ… ç»´æŠ¤ç®¡ç†ï¼šæ—¥å¸¸ç»´æŠ¤å’Œæ•…éšœæ’é™¤ âœ… é«˜çº§åŠŸèƒ½ï¼šå¤šç”¨æˆ·æ”¯æŒã€æƒé™æ§åˆ¶å’Œæ€§èƒ½ä¼˜åŒ– ç°åœ¨ä½ å¯ä»¥é€šè¿‡ WebDAV åè®®å®‰å…¨åœ°è®¿é—®å’Œç®¡ç†è¿œç¨‹æ–‡ä»¶äº†ï¼ğŸŒğŸ“‚\nğŸ’¡ æç¤ºï¼š\nå®šæœŸæ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—å’Œæ›´æ–°è½¯ä»¶åŒ…ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç å’Œå®šæœŸæ›´æ¢å¯†ç çš„ç­–ç•¥ è€ƒè™‘è®¾ç½®è‡ªåŠ¨å¤‡ä»½æœºåˆ¶ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± ç›‘æ§æœåŠ¡å™¨æ€§èƒ½ï¼Œæ ¹æ®éœ€æ±‚è°ƒæ•´é…ç½®å‚æ•° å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡å’Œæ¼æ´æ‰«æ ğŸ“š æ‰©å±•é˜…è¯»ï¼š\nNginx å®˜æ–¹æ–‡æ¡£ WebDAV åè®®è§„èŒƒ Let\u0026rsquo;s Encrypt æ–‡æ¡£ Fail2ban é…ç½®æŒ‡å— ","date":"2024-12-07T20:09:36+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/01db29e7/","title":"Nginx æ­å»º WebDAV æœåŠ¡å™¨ ğŸ–¥ï¸"},{"content":"Nginx \u0026amp; Caddy é‡å®šå‘é…ç½®æŒ‡å— ğŸŒ ğŸ”€ æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Nginx å’Œ Caddy æœåŠ¡å™¨å®ç°é«˜æ•ˆçš„é‡å®šå‘é…ç½®ï¼ŒåŒ…æ‹¬ HTTPS æ”¯æŒå’Œé”™è¯¯å¤„ç†ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ”„ ä¸€ã€Nginx é‡å®šå‘é…ç½® ğŸš€ äºŒã€Caddy é‡å®šå‘é…ç½® âš™ï¸ ä¸‰ã€SSLè¯ä¹¦é…ç½® ğŸ”§ å››ã€é”™è¯¯å¤„ç†é…ç½® ğŸ“Š äº”ã€æ€§èƒ½ä¼˜åŒ– âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ” çµæ´»é‡å®šå‘ï¼šæ”¯æŒå¤šç§é‡å®šå‘æ–¹å¼ï¼ˆ301æ°¸ä¹…/302ä¸´æ—¶ï¼‰ ğŸ”’ SSLåŠ å¯†ï¼šè‡ªåŠ¨å¤„ç†HTTPSè¯ä¹¦å’ŒåŠ å¯†è¿æ¥ âš¡ é«˜æ€§èƒ½ï¼šè½»é‡çº§é…ç½®ï¼Œé«˜æ•ˆå¤„ç†è¯·æ±‚è½¬å‘ ğŸ›¡ï¸ é”™è¯¯å¤„ç†ï¼šå®Œå–„çš„é”™è¯¯é¡µé¢å’Œæ•…éšœæ¢å¤æœºåˆ¶ ğŸ“ æ¨¡å—åŒ–é…ç½®ï¼šæ”¯æŒé…ç½®æ–‡ä»¶åˆ†ç¦»ï¼Œä¾¿äºç®¡ç†ç»´æŠ¤ ğŸ”„ ä¸€ã€Nginx é‡å®šå‘é…ç½® 1. ğŸ“ åŸºç¡€é‡å®šå‘é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # åˆ›å»ºå¹¶ç¼–è¾‘Nginxé…ç½®æ–‡ä»¶ touch /etc/nginx/conf.d/123.conf \u0026amp;\u0026amp; cat \u0026gt; /etc/nginx/conf.d/123.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { ## ç›‘å¬ç«¯å£ listen 5553 ssl; ## æ›¿æ¢ä¸ºä½ çš„åŸŸå server_name 123.mobufan.eu.org; ## æŒ‡å®š SSL è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶çš„è·¯å¾„ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ## è¦è·³è½¬çš„ç½‘å€ ## è®¿é—®ï¼šhttps://123.mobufan.eu.org:5553 ## è·³è½¬åˆ°ï¼šhttps://404.mobufan.eu.org:5553 return 301 https://404.mobufan.eu.org:5553$request_uri; } EOF 2. âš¡ é…ç½®ç”Ÿæ•ˆå‘½ä»¤ 1 2 3 4 5 6 7 8 # æ£€æŸ¥Nginxé…ç½®è¯­æ³• nginx -t # é‡æ–°åŠ è½½Nginxé…ç½® nginx -s reload # æˆ–è€…ä½¿ç”¨systemctl systemctl reload nginx 3. ğŸ”§ é«˜çº§é‡å®šå‘é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 server { listen 80; server_name example.com; # æ°¸ä¹…é‡å®šå‘åˆ°HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name example.com; # é‡å®šå‘åˆ°æ–°åŸŸå return 301 https://newdomain.com$request_uri; # æˆ–è€…é‡å®šå‘ç‰¹å®šè·¯å¾„ location /old-path { return 301 https://$server_name/new-path; } } ğŸš€ äºŒã€Caddy é‡å®šå‘é…ç½® 1. ğŸ“ åŸºç¡€é‡å®šå‘é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºCaddyé…ç½®ç›®å½•å’Œæ–‡ä»¶ mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; \\ touch /usr/local/caddy/conf.d/baidu.conf \u0026amp;\u0026amp; \\ chmod u+x /usr/local/caddy/conf.d/baidu.conf \u0026amp;\u0026amp; \\ cat \u0026gt; /usr/local/caddy/conf.d/baidu.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## é‡å®šå‘åˆ° baidu https://baidu.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key redir https://baidu.com{uri} ## é”™è¯¯å¤„ç† handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html ## æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html file_server } } EOF 2. âš¡ é…ç½®ç”Ÿæ•ˆå‘½ä»¤ 1 2 3 4 5 6 7 8 # æ ¼å¼åŒ–Caddyé…ç½® cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite # é‡æ–°åŠ è½½Caddyé…ç½® cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy reload # æˆ–è€…ä½¿ç”¨systemctl systemctl reload caddy 3. ğŸ”§ é«˜çº§é‡å®šå‘é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¤šåŸŸåé‡å®šå‘ https://site1.example.com:6663, https://site2.example.com:6663 { redir https://newdomain.com{uri} permanent } # æ¡ä»¶é‡å®šå‘ https://example.com:6663 { @old { path /old/* } redir @old https://example.com/new{path} permanent } # ä¸´æ—¶é‡å®šå‘ https://temp.example.com:6663 { redir https://othersite.com{uri} temporary } âš™ï¸ ä¸‰ã€SSLè¯ä¹¦é…ç½® 1. ğŸ“ è¯ä¹¦æ–‡ä»¶ç®¡ç† 1 2 3 4 5 6 7 # åˆ›å»ºè¯ä¹¦ç›®å½•ï¼ˆNginxï¼‰ mkdir -p /etc/nginx/keyfile chmod 700 /etc/nginx/keyfile # åˆ›å»ºè¯ä¹¦ç›®å½•ï¼ˆCaddyï¼‰ mkdir -p /usr/local/caddy/ssl chmod 700 /usr/local/caddy/ssl 2. ğŸ” è¯ä¹¦æƒé™è®¾ç½® 1 2 3 4 5 6 7 # è®¾ç½®è¯ä¹¦æ–‡ä»¶æƒé™ chmod 600 /etc/nginx/keyfile/cert.pem chmod 600 /etc/nginx/keyfile/key.pem # æˆ–è€…å¯¹äºCaddy chmod 600 /usr/local/caddy/ssl/full_chain.pem chmod 600 /usr/local/caddy/ssl/private.key 3. ğŸ“œ è¯ä¹¦è‡ªåŠ¨ç»­æœŸ 1 2 3 4 5 # ä½¿ç”¨certbotè‡ªåŠ¨ç»­æœŸï¼ˆNginxï¼‰ certbot renew --nginx --quiet # Caddyè‡ªåŠ¨å¤„ç†è¯ä¹¦ç»­æœŸï¼ˆå†…ç½®åŠŸèƒ½ï¼‰ # æ— éœ€é¢å¤–é…ç½®ï¼ŒCaddyä¼šè‡ªåŠ¨ç®¡ç†è¯ä¹¦ ğŸ”§ å››ã€é”™è¯¯å¤„ç†é…ç½® 1. ğŸš¨ Nginxé”™è¯¯é¡µé¢é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 server { listen 5553 ssl; server_name 123.mobufan.eu.org; # é”™è¯¯é¡µé¢é…ç½® error_page 404 /404.html; error_page 500 502 503 504 /50x.html; location = /404.html { root /var/www/html; internal; } location = /50x.html { root /var/www/html; internal; } } 2. ğŸ›¡ï¸ Caddyé”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 https://example.com:6663 { # è‡ªå®šä¹‰é”™è¯¯å¤„ç† handle_errors { @404 { expression {http.error.status_code} == 404 } rewrite @404 /404.html file_server } } 3. ğŸ“‹ é”™è¯¯æ—¥å¿—é…ç½® 1 2 3 4 5 # æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿— tail -f /var/log/nginx/error.log # æŸ¥çœ‹Caddyé”™è¯¯æ—¥å¿— journalctl -u caddy -f ğŸ“Š äº”ã€æ€§èƒ½ä¼˜åŒ– 1. âš¡ Nginxæ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 server { listen 5553 ssl; # æ€§èƒ½ä¼˜åŒ–è®¾ç½® keepalive_timeout 65; keepalive_requests 100; sendfile on; tcp_nopush on; tcp_nodelay on; # SSLä¼˜åŒ– ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; } 2. ğŸš€ Caddyæ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 https://example.com:6663 { # æ€§èƒ½ä¼˜åŒ– encode zstd gzip header { # ç¼“å­˜æ§åˆ¶ Cache-Control \u0026#34;public, max-age=3600\u0026#34; } } 3. ğŸ“ˆ ç›‘æ§å’Œè°ƒä¼˜ 1 2 3 4 5 6 7 8 # ç›‘æ§Nginxæ€§èƒ½ nginx -T # ç›‘æ§CaddyçŠ¶æ€ curl localhost:2019/metrics # å‹åŠ›æµ‹è¯• ab -n 1000 -c 100 https://example.com:6663/ âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ 1. ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 10 # å®šæœŸæ›´æ–°SSLè¯ä¹¦ certbot renew --dry-run # æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™ find /etc/nginx/ -name \u0026#34;*.conf\u0026#34; -exec chmod 644 {} \\; find /usr/local/caddy/conf.d/ -name \u0026#34;*.conf\u0026#34; -exec chmod 644 {} \\; # é˜²ç«å¢™é…ç½® ufw allow 5553/tcp ufw allow 6663/tcp 2. ğŸ› ï¸ æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥Nginxé…ç½® nginx -t # æ£€æŸ¥Caddyé…ç½® caddy validate # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status nginx systemctl status caddy # ç«¯å£å ç”¨æ£€æŸ¥ netstat -tulnp | grep -E \u0026#39;(5553|6663)\u0026#39; 3. ğŸ“‹ æœ€ä½³å®è·µ âœ… æ€»æ˜¯ä½¿ç”¨HTTPSé‡å®šå‘ âœ… é…ç½®åˆé€‚çš„HTTPçŠ¶æ€ç ï¼ˆ301/302ï¼‰ âœ… è®¾ç½®æ­£ç¡®çš„é”™è¯¯å¤„ç†é¡µé¢ âœ… å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶ âœ… ç›‘æ§é‡å®šå‘æ€§èƒ½ âœ… æµ‹è¯•é‡å®šå‘é€»è¾‘ 4. ğŸ†˜ å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 # è¯ä¹¦é—®é¢˜ openssl verify -CAfile /path/to/ca-bundle.pem /path/to/certificate.pem # é‡å®šå‘å¾ªç¯æ£€æŸ¥ curl -I -L http://example.com # DNSè§£ææ£€æŸ¥ dig example.com nslookup example.com ğŸ¯ é…ç½®å®Œæˆæ£€æŸ¥æ¸…å• Nginx/Caddy é…ç½®æ–‡ä»¶å·²åˆ›å»º SSL è¯ä¹¦è·¯å¾„æ­£ç¡®é…ç½® é‡å®šå‘é€»è¾‘æµ‹è¯•é€šè¿‡ é”™è¯¯é¡µé¢é…ç½®å®Œæˆ é˜²ç«å¢™ç«¯å£å·²å¼€æ”¾ æœåŠ¡é‡å¯å¹¶ç”Ÿæ•ˆ é‡å®šå‘åŠŸèƒ½æµ‹è¯•æ­£å¸¸ ğŸ’¡ æç¤ºï¼šé…ç½®å®Œæˆåå»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•é‡å®šå‘ï¼š\n1 2 curl -I https://123.mobufan.eu.org:5553 curl -I https://baidu.meimolihan.eu.org:6663 é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨å¯ä»¥å®ç°é«˜æ•ˆã€å®‰å…¨çš„Webé‡å®šå‘æœåŠ¡ï¼Œç¡®ä¿ç”¨æˆ·è®¿é—®ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ï¼ ğŸŒğŸ”€\n","date":"2024-12-07T20:08:42+08:00","image":"https://file.meimolihan.eu.org/img/caddy-nginx-file-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e736986f/","title":"Nginx \u0026 Caddy é‡å®šå‘é…ç½®æŒ‡å— ğŸŒ"},{"content":"Nginx \u0026amp; Caddy é”™è¯¯é¡µé¢æ‹¦æˆªé…ç½®æŒ‡å— ğŸ›¡ï¸ ğŸš¨ æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•é…ç½® Nginx å’Œ Caddy æœåŠ¡å™¨çš„é”™è¯¯é¡µé¢æ‹¦æˆªåŠŸèƒ½ï¼Œæä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºï¼Œæå‡ç½‘ç«™ç”¨æˆ·ä½“éªŒã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ› ï¸ ä¸€ã€Nginx é”™è¯¯é¡µé¢é…ç½® ğŸš€ äºŒã€Caddy é”™è¯¯é¡µé¢é…ç½® ğŸ¨ ä¸‰ã€é”™è¯¯é¡µé¢è®¾è®¡ âš™ï¸ å››ã€é«˜çº§é…ç½®æŠ€å·§ ğŸ” äº”ã€æµ‹è¯•ä¸è°ƒè¯• âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ¯ é”™è¯¯æ‹¦æˆªï¼šè‡ªåŠ¨æ•è·å’Œå¤„ç†å„ç§HTTPé”™è¯¯çŠ¶æ€ç  ğŸ¨ è‡ªå®šä¹‰é¡µé¢ï¼šæ”¯æŒå®Œå…¨è‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢è®¾è®¡ ğŸ”§ çµæ´»é…ç½®ï¼šå¯æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹è®¾ç½®ä¸åŒå¤„ç†æ–¹å¼ âš¡ é«˜æ€§èƒ½ï¼šè½»é‡çº§é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸å½±å“æ­£å¸¸è¯·æ±‚ ğŸ“± å“åº”å¼è®¾è®¡ï¼šé”™è¯¯é¡µé¢é€‚é…å„ç§è®¾å¤‡å±å¹• ğŸ› ï¸ ä¸€ã€Nginx é”™è¯¯é¡µé¢é…ç½® 1. ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 server { ## ç›‘å¬5553ç«¯å£ï¼Œå¹¶å¯ç”¨SSL listen 5553 ssl; listen [::]:5553 spcsl; ## æ›¿æ¢ä¸ºä½ çš„åŸŸå server_name xunlei.mobufan.eu.org; ## æŒ‡å®š SSL è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶çš„è·¯å¾„ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; location / { ## æŒ‡å®šåå‘ä»£ç†çš„æœåŠ¡åœ°å€ proxy_pass http://10.10.10.245:2345; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_buffering on; #å¼€å¯ç¼“å­˜ # ä½¿ç”¨ HTTP/1.1 åè®®ä¸åç«¯æœåŠ¡å™¨é€šä¿¡ proxy_http_version 1.1; client_max_body_size 20000m; } ## é”™è¯¯å¤„ç†é…ç½® charset utf-8; # æŒ‡å®šç¼–ç  error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /var/www/html; # å†…éƒ¨ä½ç½®ï¼Œé˜²æ­¢ç›´æ¥è®¿é—® internal; # è®¾ç½®é”™è¯¯é¡µé¢çš„MIMEç±»å‹ default_type text/html; # ç¦ç”¨ä»£ç†ç¼“å­˜é”™è¯¯é¡µé¢ proxy_no_cache 1; proxy_cache_bypass 1; } } 2. ğŸ”§ é”™è¯¯å¤„ç†éƒ¨åˆ†è¯¦è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ## é”™è¯¯å¤„ç†é…ç½® charset utf-8; # ç¡®ä¿æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡ error_page 404 /404.html; error_page 500 502 503 504 /50x.html; # 404é”™è¯¯é¡µé¢é…ç½® location = /404.html { root /var/www/html; internal; # è®¾ç½®ç¼“å­˜æ§åˆ¶ add_header Cache-Control \u0026#34;no-cache, no-store, must-revalidate\u0026#34;; } # 50xé”™è¯¯é¡µé¢é…ç½® location = /50x.html { root /var/www/html; internal; # å…è®¸è·¨åŸŸè®¿é—®ï¼ˆå¦‚æœéœ€è¦ï¼‰ add_header Access-Control-Allow-Origin \u0026#34;*\u0026#34;; } 3. âš¡ é…ç½®ç”Ÿæ•ˆå‘½ä»¤ 1 2 3 4 5 6 7 8 # æ£€æŸ¥Nginxé…ç½®è¯­æ³• sudo nginx -t # é‡æ–°åŠ è½½Nginxé…ç½® sudo nginx -s reload # æˆ–è€…ä½¿ç”¨systemctl sudo systemctl reload nginx ğŸš€ äºŒã€Caddy é”™è¯¯é¡µé¢é…ç½® 1. ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 https://xunlei.meimolihan.eu.org:6663 { encode gzip tls ssl/full_chain.pem ssl/private.key # åå‘ä»£ç†é…ç½® reverse_proxy http://10.10.10.245:2345 { header_up Host {http.reverse_proxy.upstream.hostport} header_up X-Real-IP {remote_host} } ## é”™è¯¯å¤„ç†é…ç½® handle_errors { ## å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°å¯¹åº”çš„é”™è¯¯é¡µé¢ @404 expression {http.error.status_code} == 404 @50x expression {http.error.status_code} \u0026gt;= 500 \u0026amp;\u0026amp; {http.error.status_code} \u0026lt; 600 # 404é”™è¯¯å¤„ç† handle @404 { rewrite * /404.html root * /var/www/html file_server header Content-Type \u0026#34;text/html; charset=utf-8\u0026#34; } # 50xé”™è¯¯å¤„ç† handle @50x { rewrite * /50x.html root * /var/www/html file_server header Content-Type \u0026#34;text/html; charset=utf-8\u0026#34; header Cache-Control \u0026#34;no-cache\u0026#34; } } } 2. ğŸ”§ é”™è¯¯å¤„ç†éƒ¨åˆ†è¯¦è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ## é”™è¯¯å¤„ç†é…ç½® handle_errors { ## åŸºäºé”™è¯¯ä»£ç çš„è·¯ç”± @404 expression {http.error.status_code} == 404 @500 expression {http.error.status_code} == 500 @502 expression {http.error.status_code} == 502 @503 expression {http.error.status_code} == 503 @504 expression {http.error.status_code} == 504 ## é€šç”¨é”™è¯¯å¤„ç† rewrite * /error.html?code={http.error.status_code} root * /var/www/html file_server header Content-Type \u0026#34;text/html; charset=utf-8\u0026#34; ## å¯ä»¥æ·»åŠ æ›´å¤šè‡ªå®šä¹‰å¤´ header X-Error \u0026#34;Handled by Caddy\u0026#34; } 3. âš¡ é…ç½®ç”Ÿæ•ˆå‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 # æ ¼å¼åŒ–Caddyé…ç½® sudo caddy fmt --overwrite /etc/caddy/Caddyfile # é‡æ–°åŠ è½½Caddyé…ç½® sudo systemctl reload caddy # æˆ–è€…ä½¿ç”¨Caddy API curl -X POST http://localhost:2019/load \\ -H \u0026#34;Content-Type: text/caddyfile\u0026#34; \\ --data-binary @/etc/caddy/Caddyfile ğŸ¨ ä¸‰ã€é”™è¯¯é¡µé¢è®¾è®¡ 1. ğŸ“ åˆ›å»ºé”™è¯¯é¡µé¢æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 # åˆ›å»ºé”™è¯¯é¡µé¢ç›®å½• sudo mkdir -p /var/www/html # åˆ›å»º50x.htmlé”™è¯¯é¡µé¢ sudo tee /var/www/html/50x.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;æœåŠ¡å™¨é”™è¯¯ - 500\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: \u0026#39;Segoe UI\u0026#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; } .error-container { background: rgba(255, 255, 255, 0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px); } h1 { font-size: 4rem; margin: 0; } p { font-size: 1.2rem; } .home-btn { background: white; color: #667eea; padding: 0.8rem 2rem; text-decoration: none; border-radius: 2rem; display: inline-block; margin-top: 1rem; transition: transform 0.3s; } .home-btn:hover { transform: translateY(-2px); } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;error-container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;500\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æŠ±æ­‰ï¼ŒæœåŠ¡å™¨é‡åˆ°äº†æ„å¤–é”™è¯¯ã€‚è¯·ç¨åå†è¯•ã€‚\u0026lt;/p\u0026gt; \u0026lt;a href=\u0026#34;/\u0026#34; class=\u0026#34;home-btn\u0026#34;\u0026gt;è¿”å›é¦–é¡µ\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF 2. ğŸ“± å“åº”å¼é”™è¯¯é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # åˆ›å»º404.htmlé¡µé¢ sudo tee /var/www/html/404.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;é¡µé¢æœªæ‰¾åˆ° - 404\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; /* å“åº”å¼è®¾è®¡ */ @media (max-width: 768px) { .error-container { margin: 1rem; padding: 1rem; } h1 { font-size: 3rem; } } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- é¡µé¢å†…å®¹ --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF âš™ï¸ å››ã€é«˜çº§é…ç½®æŠ€å·§ 1. ğŸ”„ åŸºäºä½ç½®çš„é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 # Nginx - æ ¹æ®ä¸åŒè·¯å¾„è®¾ç½®ä¸åŒé”™è¯¯é¡µé¢ location /api/ { error_page 500 /api/50x.html; proxy_pass http://backend; } location /static/ { error_page 404 /static/404.html; root /var/www/static; } 2. ğŸ“Š é”™è¯¯æ—¥å¿—è®°å½• 1 2 3 4 5 6 7 8 9 10 11 12 13 # Nginxé”™è¯¯æ—¥å¿—é…ç½® error_log /var/log/nginx/error.log warn; # åœ¨serverå—ä¸­æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½• server { # è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯ error_page 404 = @404_error; location @404_error { access_log /var/log/nginx/404.log; return 404; } } 3. ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # é”™è¯¯é¡µé¢ç¼“å­˜ä¼˜åŒ– location = /50x.html { root /var/www/html; internal; # é€‚å½“ç¼“å­˜é”™è¯¯é¡µé¢ expires 1h; add_header Cache-Control \u0026#34;public\u0026#34;; # å¯ç”¨gzipå‹ç¼© gzip on; gzip_types text/html; } ğŸ” äº”ã€æµ‹è¯•ä¸è°ƒè¯• 1. ğŸ§ª æµ‹è¯•é”™è¯¯é¡µé¢ 1 2 3 4 5 6 7 8 # æµ‹è¯•404é”™è¯¯ curl -I http://localhost/nonexistent-page # æµ‹è¯•500é”™è¯¯ï¼ˆæ¨¡æ‹Ÿåç«¯é”™è¯¯ï¼‰ curl -X POST http://localhost/api/test-error # æµ‹è¯•SSLé”™è¯¯ curl -k https://localhost:6663 2. ğŸ“‹ è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿— tail -f /var/log/nginx/error.log # æŸ¥çœ‹Caddyæ—¥å¿— journalctl -u caddy -f # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• nginx -t caddy validate # æµ‹è¯•é”™è¯¯é¡µé¢å†…å®¹ curl http://localhost/50x.html 3. ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /var/www/html/50x.html # æ£€æŸ¥ç›®å½•å­˜åœ¨æ€§ [ -d /var/www/html ] \u0026amp;\u0026amp; echo \u0026#34;ç›®å½•å­˜åœ¨\u0026#34; || echo \u0026#34;ç›®å½•ä¸å­˜åœ¨\u0026#34; # æ£€æŸ¥æœåŠ¡çŠ¶æ€ systemctl status nginx systemctl status caddy âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ 1. ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chmod 644 /var/www/html/50x.html chown www-data:www-data /var/www/html/50x.html # é˜²æ­¢é”™è¯¯é¡µé¢ä¿¡æ¯æ³„éœ² # åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é¿å…æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ 2. ğŸ“Š æ€§èƒ½è€ƒè™‘ âœ… é”™è¯¯é¡µé¢åº”è¯¥è½»é‡çº§ï¼Œé¿å…å¤§é‡èµ„æºåŠ è½½ âœ… é€‚å½“ç¼“å­˜é”™è¯¯é¡µé¢ï¼Œä½†ä¸è¦ç¼“å­˜å¤ªä¹… âœ… ç¡®ä¿é”™è¯¯å¤„ç†ä¸ä¼šå½±å“æ­£å¸¸è¯·æ±‚æ€§èƒ½ 3. ğŸ¯ ç”¨æˆ·ä½“éªŒå»ºè®® å‹å¥½çš„é”™è¯¯æ¶ˆæ¯ï¼šæä¾›æ¸…æ™°ã€å‹å¥½çš„é”™è¯¯è¯´æ˜ å¯¼èˆªé€‰é¡¹ï¼šåŒ…å«è¿”å›é¦–é¡µæˆ–è”ç³»æ”¯æŒçš„é“¾æ¥ å“ç‰Œä¸€è‡´æ€§ï¼šé”™è¯¯é¡µé¢è®¾è®¡ä¸ç½‘ç«™é£æ ¼ä¸€è‡´ å¤šè¯­è¨€æ”¯æŒï¼šæ ¹æ®éœ€è¦æä¾›å¤šè¯­è¨€é”™è¯¯é¡µé¢ 4. ğŸ†˜ ç´§æ€¥æ¢å¤ å¦‚æœé…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 # å¿«é€Ÿæ¢å¤Nginx sudo nginx -s stop sudo cp /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf sudo nginx # å¿«é€Ÿæ¢å¤Caddy sudo systemctl stop caddy sudo cp /etc/caddy/Caddyfile.backup /etc/caddy/Caddyfile sudo systemctl start caddy ğŸ¯ é…ç½®å®Œæˆæ£€æŸ¥æ¸…å• Nginx/Caddy é”™è¯¯é¡µé¢é…ç½®å®Œæˆ é”™è¯¯é¡µé¢HTMLæ–‡ä»¶å·²åˆ›å»ºå¹¶æµ‹è¯• æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒè®¾ç½®æ­£ç¡® é…ç½®è¯­æ³•æ£€æŸ¥é€šè¿‡ é”™è¯¯å¤„ç†åŠŸèƒ½æµ‹è¯•æ­£å¸¸ æ—¥å¿—è®°å½•é…ç½®æ­£ç¡® å¤‡ä»½é…ç½®æ–‡ä»¶å·²åˆ›å»º ğŸ’¡ æç¤ºï¼šé…ç½®å®Œæˆåå»ºè®®è¿›è¡Œå…¨é¢çš„é”™è¯¯æµ‹è¯•ï¼š\n1 2 3 # æµ‹è¯•å„ç§é”™è¯¯çŠ¶æ€ç  curl -o /dev/null -s -w \u0026#34;%{http_code}\\n\u0026#34; http://localhost/nonexistent curl -o /dev/null -s -w \u0026#34;%{http_code}\\n\u0026#34; http://localhost/api/error é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨çš„ç½‘ç«™å°†èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§é”™è¯¯æƒ…å†µï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒï¼ ğŸš€ğŸ›¡ï¸\n","date":"2024-12-07T20:07:04+08:00","image":"https://file.meimolihan.eu.org/img/caddy-nginx-file-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dc7e2674/","title":"Nginx \u0026 Caddy é”™è¯¯é¡µé¢æ‹¦æˆªé…ç½®æŒ‡å— ğŸ›¡ï¸"},{"content":"Caddy åä»£å†…ç½‘ http https ä¸€ ã€Caddy åä»£å†…ç½‘ http 1 2 3 4 5 6 7 8 9 10 11 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/xunlei.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/xunlei.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/xunlei.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; https://xunlei.meimolihan.eu.org:6663 { encode gzip tls ssl/full_chain.pem ssl/private.key reverse_proxy http://10.10.10.245:2345 { header_up Host {http.reverse_proxy.upstream.hostport} ## httpè¯·æ±‚å¤´ } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload äºŒ ã€Caddy åä»£å†…ç½‘ https æµ‹è¯•ç½‘å€ï¼šhttps://pve.meimolihan.eu.org:6663\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/pve.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ä»£ç† PVE è™šæ‹Ÿæœº https://pve.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy https://10.10.10.254:8006 { transport http { tls_insecure_skip_verify } } # é”™è¯¯å¤„ç† handle_errors { # å°†æ‰€æœ‰é”™è¯¯é‡å®šå‘åˆ°50x.htmlé¡µé¢ rewrite * /50x.html # æŒ‡å®šé”™è¯¯é¡µé¢çš„æ ¹ç›®å½• root * /var/www/html # å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œç”¨äºæä¾›é”™è¯¯é¡µé¢ file_server } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload ä¸‰ ã€Caddy å®˜æ–¹çš„åŠæ³•ï¼ˆå¤±è´¥ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 mkdir -pm 755 /usr/local/caddy/conf.d \u0026amp;\u0026amp; touch /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; chmod u+x /usr/local/caddy/conf.d/pve.conf \u0026amp;\u0026amp; cat \u0026gt; /usr/local/caddy/conf.d/pve.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; https://pve.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy https://10.10.10.254:8006 { header_up Host {upstream_hostport} ## httpsè¯·æ±‚å¤´ } } EOF cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy fmt --overwrite \u0026amp;\u0026amp; ./caddy reload å®˜æ–¹è§£é‡ŠHTTPS ç”±äºï¼ˆå¤§å¤šæ•°ï¼‰æ ‡å¤´åœ¨ä»£ç†æ—¶ä¿ç•™å…¶åŸå§‹å€¼ï¼Œå› æ­¤åœ¨ä»£ç†åˆ° HTTPS æ—¶é€šå¸¸éœ€è¦Hostä½¿ç”¨é…ç½®çš„ä¸Šæ¸¸åœ°å€è¦†ç›–æ ‡å¤´ï¼Œä»¥ä¾¿Hostæ ‡å¤´ä¸ TLS ServerName å€¼åŒ¹é…ï¼š\né»˜è®¤æƒ…å†µä¸‹X-Forwarded-Hostä»ä¼šä¼ é€’æ ‡å¤´ï¼Œå› æ­¤å¦‚æœä¸Šæ¸¸éœ€è¦çŸ¥é“åŸå§‹æ ‡å¤´å€¼ï¼Œåˆ™å¯èƒ½ä»ä¼šä½¿ç”¨è¯¥æ ‡å¤´ã€‚Host\n1 2 3 reverse_proxy https://example.com { header_up Host {upstream_hostport} } ","date":"2024-12-07T20:06:00+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/70a5ab63/","title":"Caddy åä»£å†…ç½‘ http https"},{"content":"Nginx éƒ¨ç½²æ–‡ä»¶æœåŠ¡å™¨ ğŸš€ ğŸ“ å¿«é€Ÿæ­å»ºé«˜æ•ˆç¨³å®šçš„æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæ”¯æŒå†…ç½‘å¤–ç½‘è®¿é—®\nâœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸŒ å¤šåè®®æ”¯æŒ - åŒæ—¶æ”¯æŒHTTPå’ŒHTTPSè®¿é—® ğŸ“‚ ç›®å½•æµè§ˆ - è‡ªåŠ¨ç”Ÿæˆç¾è§‚çš„æ–‡ä»¶ç›®å½•åˆ—è¡¨ ğŸ”’ å®‰å…¨åŠ å¯† - æ”¯æŒSSL/TLSåŠ å¯†ä¼ è¾“ ğŸ¨ ä¸»é¢˜å®šåˆ¶ - å¯è‡ªå®šä¹‰é¡µé¢å¤´éƒ¨å’Œåº•éƒ¨ ğŸ“± å“åº”å¼è®¾è®¡ - é€‚é…å„ç§è®¾å¤‡è®¿é—® âš¡ é«˜æ€§èƒ½ - åŸºäºNginxçš„é«˜æ•ˆé™æ€æ–‡ä»¶æœåŠ¡ ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡ 1. Debian/Ubuntu å®‰è£… Nginx 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£…Nginx sudo apt update \u0026amp;\u0026amp; sudo apt install nginx -y # å¯åŠ¨NginxæœåŠ¡ sudo systemctl start nginx # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable nginx # éªŒè¯å®‰è£… nginx -v 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ 1 2 3 4 5 # æŸ¥çœ‹NginxçŠ¶æ€ sudo systemctl status nginx # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t ğŸŒ å¸¦åŸŸåHTTPSæ–‡ä»¶æœåŠ¡ ç¤ºä¾‹åœ°å€ï¼šhttps://wenjian.mobufan.eu.org:5553\nğŸ“ åˆ›å»ºæ–‡ä»¶ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»ºæ–‡ä»¶åˆ†äº«ç›®å½• sudo mkdir -p /etc/nginx/wenjian sudo chmod 755 /etc/nginx/wenjian # åˆ›å»ºè¯´æ˜æ–‡ä»¶ sudo tee /etc/nginx/wenjian/æ–‡ä»¶è¯´æ˜.txt \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; --------- å…±äº«ç›®å½•è¯´æ˜ --------- æ–‡ä»¶åˆ†äº«ç›®å½•ï¼š/etc/nginx/wenjian ç»ˆç«¯æŸ¥çœ‹å‘½ä»¤ï¼šcd /etc/nginx/wenjian \u0026amp;\u0026amp; ls æ”¯æŒæ ¼å¼ï¼šæ‰€æœ‰æ–‡ä»¶ç±»å‹ç›´æ¥ä¸‹è½½ ------------------------------- EOF # æŸ¥çœ‹åˆ›å»ºçš„æ–‡ä»¶ cat /etc/nginx/wenjian/æ–‡ä»¶è¯´æ˜.txt ğŸ”§ é…ç½®Nginx HTTPSæ–‡ä»¶æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # åˆ›å»ºé…ç½®ç›®å½• sudo mkdir -p /etc/nginx/conf.d # åˆ›å»ºé…ç½®æ–‡ä»¶ sudo tee /etc/nginx/conf.d/file.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; server_name file.mobufan.eu.org; # SSLè¯ä¹¦é…ç½®ï¼ˆéœ€è¦æå‰è·å–è¯ä¹¦ï¼‰ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # æ–‡ä»¶æœåŠ¡é…ç½® location / { root /mnt/file; charset utf-8,gbk; # å¯ç”¨ç›®å½•åˆ—è¡¨ autoindex on; autoindex_exact_size off; autoindex_localtime on; # æ–‡ä»¶ä¸‹è½½è®¾ç½® if ($request_filename ~* \\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx)$) { add_header Content-Disposition \u0026#39;attachment\u0026#39;; } } } EOF ğŸ”„ åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶ sudo nginx -t # é‡å¯NginxæœåŠ¡ sudo systemctl restart nginx # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ sudo systemctl status nginx ğŸ  å†…ç½‘æ–‡ä»¶æœåŠ¡éƒ¨ç½² ç¤ºä¾‹åœ°å€ï¼šhttp://10.10.10.245:1515\nğŸ“‚ åˆ›å»ºå†…ç½‘æ–‡ä»¶æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åˆ›å»ºå†…ç½‘æ–‡ä»¶ç›®å½• sudo mkdir -p /etc/nginx/wenjian sudo chmod 755 /etc/nginx/wenjian # åˆ›å»ºå†…ç½‘é…ç½®æ–‡ä»¶ sudo tee /etc/nginx/conf.d/internal.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 1515; server_name localhost; location / { root /etc/nginx/wenjian; autoindex on; autoindex_exact_size off; autoindex_localtime on; charset utf-8,gbk; # ç¦ç”¨ç¼“å­˜ add_header Cache-Control no-store; } } EOF ğŸ¨ é«˜çº§ç¾åŒ–é…ç½® ä½¿ç”¨Fancyindexä¸»é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # åˆ›å»ºä¸»é¢˜ç›®å½• sudo mkdir -p /etc/nginx/theme/fancyindex # åˆ›å»ºå¤´éƒ¨æ–‡ä»¶ sudo tee /etc/nginx/theme/fancyindex/header.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;æ–‡ä»¶å…±äº«æœåŠ¡\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; margin: 40px; } h1 { color: #333; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;ğŸ“ æ–‡ä»¶å…±äº«ç›®å½•\u0026lt;/h1\u0026gt; \u0026lt;hr\u0026gt; EOF # åˆ›å»ºåº•éƒ¨æ–‡ä»¶ sudo tee /etc/nginx/theme/fancyindex/footer.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;hr\u0026gt; \u0026lt;footer\u0026gt; \u0026lt;p\u0026gt;Â© 2024 æ–‡ä»¶å…±äº«æœåŠ¡ - Powered by Nginx\u0026lt;/p\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF ç¾åŒ–é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 server { listen 80; server_name fileserver.local; root /mnt/files; # ç¾åŒ–ç´¢å¼•é…ç½® fancyindex on; fancyindex_localtime on; fancyindex_exact_size off; fancyindex_name_length 255; fancyindex_header \u0026#34;/theme/fancyindex/header.html\u0026#34;; fancyindex_footer \u0026#34;/theme/fancyindex/footer.html\u0026#34;; fancyindex_ignore \u0026#34;theme\u0026#34;; # æ–‡ä»¶ç±»å‹å›¾æ ‡æ˜¾ç¤º fancyindex_show_type on; } ğŸ”’ SSLè¯ä¹¦é…ç½® è·å–SSLè¯ä¹¦ 1 2 3 4 5 6 7 # ä½¿ç”¨Let\u0026#39;s Encryptè·å–å…è´¹è¯ä¹¦ï¼ˆéœ€è¦åŸŸåï¼‰ sudo apt install certbot python3-certbot-nginx -y sudo certbot --nginx -d your-domain.com # æˆ–è€…æ‰‹åŠ¨é…ç½®è¯ä¹¦ç›®å½• sudo mkdir -p /etc/nginx/ssl sudo chmod 700 /etc/nginx/ssl âš™ï¸ æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åœ¨nginx.confä¸­æ·»åŠ ä¼˜åŒ–é…ç½® http { # æ–‡ä»¶ä¼ è¾“ä¼˜åŒ– sendfile on; tcp_nopush on; tcp_nodelay on; # è¿æ¥è¶…æ—¶è®¾ç½® keepalive_timeout 65; # æ–‡ä»¶ç¼“å­˜è®¾ç½® open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # Gzipå‹ç¼© gzip on; gzip_types text/plain text/css application/json application/javascript text/xml; } ğŸš¨ å¸¸è§é—®é¢˜è§£å†³ 1. æƒé™é—®é¢˜ 1 2 3 # è®¾ç½®æ­£ç¡®çš„ç›®å½•æƒé™ sudo chown -R www-data:www-data /mnt/file sudo chmod -R 755 /mnt/file 2. ç«¯å£å†²çª 1 2 3 4 5 # æŸ¥çœ‹ç«¯å£å ç”¨ sudo netstat -tulnp | grep :666 # ä¿®æ”¹é˜²ç«å¢™è§„åˆ™ sudo ufw allow 666/tcp 3. ä¸­æ–‡ä¹±ç  1 2 # åœ¨é…ç½®ä¸­æ·»åŠ å­—ç¬¦é›†è®¾ç½® charset utf-8,gbk; ğŸ“Š ç›‘æ§ä¸æ—¥å¿— 1 2 3 4 5 6 7 8 # æŸ¥çœ‹è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log # æŸ¥çœ‹é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # å®æ—¶ç›‘æ§è¿æ¥æ•° sudo nginx -T | grep worker_connections ğŸ”§ ç»´æŠ¤å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ sudo nginx -s reload # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # åœæ­¢æœåŠ¡ sudo systemctl stop nginx # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ nginx -V ğŸ’¡ æç¤ºï¼šéƒ¨ç½²å®Œæˆåï¼Œå»ºè®®å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶ï¼Œç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶åŠæ—¶æ›´æ–°Nginxç‰ˆæœ¬ä»¥ç¡®ä¿å®‰å…¨æ€§ã€‚\nHappy File Sharing! ğŸ‰ ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼\n","date":"2024-12-07T20:04:35+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/015df0d0/","title":"Nginx éƒ¨ç½²æ–‡ä»¶æœåŠ¡å™¨ ğŸš€"},{"content":"Caddy éƒ¨ç½²é™æ€ç½‘ç«™ ğŸŒ ğŸš€ å¿«é€Ÿæ­å»ºé«˜æ€§èƒ½é™æ€ç½‘ç«™ï¼Œæ”¯æŒHTTPSè‡ªåŠ¨åŠ å¯†å’Œç°ä»£åŒ–åŠŸèƒ½\nğŸ“– ç›®å½•å¯¼èˆª ğŸ“¦ Caddy å®‰è£…ä¸é…ç½® ğŸŒ åŸŸåé™æ€ç«™ç‚¹éƒ¨ç½² ğŸ  å†…ç½‘é™æ€ç«™ç‚¹éƒ¨ç½² ğŸ”§ é«˜çº§é…ç½®æŠ€å·§ âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ”’ å®‰å…¨åŠ å›º ğŸ› æ•…éšœæ’é™¤ ğŸ’¡ å®ç”¨æŠ€å·§ ğŸ“¦ Caddy å®‰è£…ä¸é…ç½® ğŸ§ Ubuntu ç³»ç»Ÿå®‰è£… 1. åˆ›å»ºç›®å½•ç»“æ„ 1 2 3 # åˆ›å»ºCaddyä¸»ç›®å½•å’ŒSSLè¯ä¹¦ç›®å½• sudo mkdir -p /usr/local/caddy/ssl cd /usr/local/caddy 2. ä¸‹è½½CaddyæœåŠ¡å™¨ æ¨èæ–¹æ³•ï¼šä½¿ç”¨å®˜æ–¹è„šæœ¬å®‰è£…\n1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬ sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https curl curl -1sLf \u0026#39;https://dl.cloudsmith.io/public/caddy/stable/gpg.key\u0026#39; | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg curl -1sLf \u0026#39;https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt\u0026#39; | sudo tee /etc/apt/sources.list.d/caddy-stable.list sudo apt update sudo apt install caddy # æˆ–è€…æ‰‹åŠ¨ä¸‹è½½ç‰¹å®šç‰ˆæœ¬ï¼ˆåŒ…å«WebDAVæ’ä»¶ï¼‰ wget \u0026#34;https://caddyserver.com/api/download?os=linux\u0026amp;arch=amd64\u0026amp;p=github.com%2Fcaddyserver%2Freplace-response\u0026amp;p=github.com%2Fcaddyserver%2Fwebdav\u0026#34; -O caddy sudo chmod +x caddy 3. éªŒè¯å®‰è£… 1 2 3 4 5 6 7 8 # æ£€æŸ¥Caddyç‰ˆæœ¬ caddy version # æŸ¥çœ‹å·²å®‰è£…çš„æ’ä»¶ caddy list-modules # æ£€æŸ¥Caddyè¿è¡ŒçŠ¶æ€ sudo systemctl status caddy 4. åˆ›å»ºç³»ç»ŸæœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶ sudo tee /etc/systemd/system/caddy.service \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Unit] Description=Caddy HTTP/2 web server Documentation=https://caddyserver.com/docs/ After=network.target [Service] User=www-data Group=www-data ExecStart=/usr/bin/caddy run --config /etc/caddy/Caddyfile ExecReload=/usr/bin/caddy reload --config /etc/caddy/Caddyfile TimeoutStopSec=5s LimitNOFILE=1048576 LimitNPROC=512 PrivateTmp=true ProtectSystem=full AmbientCapabilities=CAP_NET_BIND_SERVICE [Install] WantedBy=multi-user.target EOF # é‡æ–°åŠ è½½systemdé…ç½® sudo systemctl daemon-reload sudo systemctl enable caddy sudo systemctl start caddy ğŸŒ åŸŸåé™æ€ç«™ç‚¹éƒ¨ç½² ğŸ“ åˆ›å»ºç½‘ç«™ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 # åˆ›å»ºç½‘ç«™æ ¹ç›®å½• sudo mkdir -p /var/www/html/web sudo chown -R www-data:www-data /var/www/html sudo chmod -R 755 /var/www/html # åˆ›å»ºæ—¥å¿—ç›®å½• sudo mkdir -p /var/log/caddy sudo chown -R www-data:www-data /var/log/caddy ğŸ¨ åˆ›å»ºç¤ºä¾‹é™æ€é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 # åˆ›å»ºç²¾ç¾çš„é¦–é¡µ sudo tee /var/www/html/web/index.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;ğŸ¯ å¢¨ä¸å‡¡ - é™æ€ç½‘ç«™ç¤ºä¾‹\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: \u0026#39;Segoe UI\u0026#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; color: #333; } .container { background: rgba(255, 255, 255, 0.95); padding: 3rem; border-radius: 15px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); text-align: center; max-width: 600px; width: 90%; backdrop-filter: blur(10px); } h1 { color: #4a5568; margin-bottom: 1.5rem; font-size: 2.5rem; } .path-info { background: #f7fafc; padding: 1.5rem; border-radius: 8px; margin: 2rem 0; border-left: 4px solid #4299e1; font-family: \u0026#39;Courier New\u0026#39;, monospace; word-break: break-all; } .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 2rem 0; } .feature { background: #ebf8ff; padding: 1rem; border-radius: 8px; font-size: 0.9rem; } .emoji { font-size: 2rem; margin-bottom: 0.5rem; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;ğŸš€ æ¬¢è¿è®¿é—®é™æ€ç½‘ç«™\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;path-info\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;ğŸ“ ç½‘ç«™è·¯å¾„:\u0026lt;/strong\u0026gt;\u0026lt;br\u0026gt; /var/www/html/web/index.html \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;features\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;feature\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;emoji\u0026#34;\u0026gt;âš¡\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;é«˜æ€§èƒ½\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;feature\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;emoji\u0026#34;\u0026gt;ğŸ”’\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;HTTPSåŠ å¯†\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;feature\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;emoji\u0026#34;\u0026gt;ğŸ“±\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;å“åº”å¼è®¾è®¡\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;feature\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;emoji\u0026#34;\u0026gt;ğŸ¨\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;ç°ä»£ç•Œé¢\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p\u0026gt;âœ¨ ç”± \u0026lt;strong\u0026gt;Caddy Server\u0026lt;/strong\u0026gt; æä¾›æ”¯æŒ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF ğŸ”§ é…ç½®CaddyåŸŸåç«™ç‚¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # åˆ›å»ºCaddyé…ç½®ç›®å½• sudo mkdir -p /etc/caddy/conf.d # åˆ›å»ºåŸŸåç«™ç‚¹é…ç½® sudo tee /etc/caddy/conf.d/jingtai.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ğŸ¯ é™æ€ç½‘ç«™é…ç½® - å¸¦åŸŸåHTTPS jingtai.meimolihan.eu.org:6663 { # å¯ç”¨Gzipå‹ç¼© encode gzip zstd # SSLè¯ä¹¦é…ç½®ï¼ˆCaddyæ”¯æŒè‡ªåŠ¨SSLï¼‰ tls { ciphers TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 curves x25519 secp521r1 secp384r1 alpn http/1.1 h2 } # è®¾ç½®ç½‘ç«™æ ¹ç›®å½• root * /var/www/html/web # å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨å’Œç›®å½•æµè§ˆ file_server browse # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY X-XSS-Protection \u0026#34;1; mode=block\u0026#34; Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains; preload\u0026#34; Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34; Permissions-Policy \u0026#34;geolocation=(), microphone=(), camera=()\u0026#34; } # æ—¥å¿—é…ç½® log { output file /var/log/caddy/jingtai.access.log { roll_size 100MB roll_keep 10 roll_keep_for 2160h } format json } # é”™è¯¯å¤„ç† handle_errors { @404 { expression {http.error.status_code} == 404 } rewrite @404 /404.html file_server } } EOF ğŸ”„ åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # åˆ›å»ºä¸»Caddyfile sudo tee /etc/caddy/Caddyfile \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # å…¨å±€é…ç½® { # ç®¡ç†æ¥å£ï¼ˆå¯é€‰ï¼‰ admin off # è‡ªåŠ¨HTTPS auto_https disable_redirects # æ—¥å¿— log { level INFO } } # å¯¼å…¥å„ä¸ªç«™ç‚¹é…ç½® import conf.d/*.conf EOF # æ ¼å¼åŒ–é…ç½®æ–‡ä»¶ sudo caddy fmt --overwrite /etc/caddy/Caddyfile # é‡æ–°åŠ è½½Caddyé…ç½® sudo systemctl reload caddy # æ£€æŸ¥é…ç½®è¯­æ³• sudo caddy validate --config /etc/caddy/Caddyfile ğŸ  å†…ç½‘é™æ€ç«™ç‚¹éƒ¨ç½² ğŸ“‚ åˆ›å»ºå†…ç½‘ç«™ç‚¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # åˆ›å»ºå†…ç½‘æµ‹è¯•é¡µé¢ sudo tee /var/www/html/web/internal.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;ğŸ  å†…ç½‘æµ‹è¯•é¡µé¢\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; margin: 40px; background: #f0f4f8; } .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); } h1 { color: #2c5282; } .info { background: #ebf8ff; padding: 15px; border-radius: 5px; margin: 15px 0; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;ğŸ  å†…ç½‘é™æ€ç½‘ç«™æµ‹è¯•\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;info\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;ğŸ“ è®¿é—®åœ°å€:\u0026lt;/strong\u0026gt; http://10.10.10.247:9300\u0026lt;br\u0026gt; \u0026lt;strong\u0026gt;ğŸ“ æ–‡ä»¶è·¯å¾„:\u0026lt;/strong\u0026gt; /var/www/html/web/internal.html \u0026lt;/div\u0026gt; \u0026lt;p\u0026gt;è¿™æ˜¯ä¸€ä¸ªå†…ç½‘æµ‹è¯•é¡µé¢ï¼Œä»…åœ¨å†…ç½‘ç¯å¢ƒä¸­å¯è®¿é—®ã€‚\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF ğŸ”§ é…ç½®å†…ç½‘ç«™ç‚¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # åˆ›å»ºå†…ç½‘ç«™ç‚¹é…ç½® sudo tee /etc/caddy/conf.d/internal.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ğŸ  å†…ç½‘é™æ€ç½‘ç«™é…ç½® :9300 { # å¯ç”¨Gzipå‹ç¼© encode gzip # è®¾ç½®ç½‘ç«™æ ¹ç›®å½• root * /var/www/html/web # å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨ file_server # é»˜è®¤é¡µé¢é…ç½® try_files {path} /internal.html # å†…ç½‘è®¿é—®é™åˆ¶ @blocked { not remote_ip 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 } respond @blocked 403 \u0026#34;Forbidden\u0026#34; # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY } } EOF ğŸš€ å¯åŠ¨å†…ç½‘æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # é‡æ–°åŠ è½½é…ç½® sudo systemctl reload caddy # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status caddy # æµ‹è¯•å†…ç½‘è®¿é—® curl -I http://10.10.10.247:9300 # æŸ¥çœ‹ç›‘å¬ç«¯å£ sudo ss -tuln | grep 9300 ğŸ”§ é«˜çº§é…ç½®æŠ€å·§ ğŸ”„ å¤šç«™ç‚¹é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # åˆ›å»ºå¤šä¸ªç«™ç‚¹é…ç½® sudo tee /etc/caddy/conf.d/multiple.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ç«™ç‚¹1 - ä¸»ç«™ç‚¹ site1.example.com { root * /var/www/site1 file_server encode gzip } # ç«™ç‚¹2 - åšå®¢ blog.example.com { root * /var/www/blog file_server encode gzip # é‡å†™è§„åˆ™ try_files {path} /index.html } # ç«™ç‚¹3 - API api.example.com { reverse_proxy /api/* localhost:3000 # é™åˆ¶è¯·æ±‚å¤§å° request_body { max_size 10MB } } EOF ğŸŒ è™šæ‹Ÿä¸»æœºé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¤šä¸ªåŸŸåæŒ‡å‘åŒä¸€ä¸ªç½‘ç«™ sudo tee /etc/caddy/conf.d/vhost.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ğŸŒ è™šæ‹Ÿä¸»æœºé…ç½® site1.example.com, site2.example.com, www.site1.example.com { root * /var/www/html/sites file_server encode gzip # é‡å®šå‘åˆ°ä¸»åŸŸå @primary host site1.example.com redir @primary https://site1.example.com{uri} permanent } EOF ğŸ“Š æ—¥å¿—é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # è¯¦ç»†æ—¥å¿—é…ç½® sudo tee /etc/caddy/conf.d/logging.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ğŸ“Š é«˜çº§æ—¥å¿—é…ç½® :2015 { log { output file /var/log/caddy/access.log { roll_size 100MB roll_keep 10 roll_keep_for 720h } format json { time_format \u0026#34;2006-01-02T15:04:05Z07:00\u0026#34; } } } EOF âš¡ æ€§èƒ½ä¼˜åŒ– ğŸš€ å¯ç”¨HTTP/3 1 2 3 4 5 6 7 8 # åœ¨å…¨å±€é…ç½®ä¸­æ·»åŠ  { servers { protocol { experimental_http3 } } } ğŸ“¦ é™æ€èµ„æºç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ·»åŠ ç¼“å­˜é…ç½® @static { path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot } header @static Cache-Control \u0026#34;public, max-age=31536000, immutable\u0026#34; # å‹ç¼©é…ç½® encode { gzip zstd min_length 256 } ğŸ”„ è´Ÿè½½å‡è¡¡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ reverse_proxy /api/* { to server1:8080 server2:8080 server3:8080 lb_policy round_robin health_check /health health_interval 30s health_timeout 5s # ä¿æŒè¿æ¥ transport http { keepalive 30s keepalive_interval 10s keepalive_idle_conns 100 } } ğŸ”’ å®‰å…¨åŠ å›º ğŸ›¡ï¸ å®‰å…¨å¤´éƒ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å¢å¼ºå®‰å…¨å¤´éƒ¨ header { # é˜²æ­¢MIMEç±»å‹æ··æ·† X-Content-Type-Options \u0026#34;nosniff\u0026#34; # é˜²æ­¢ç‚¹å‡»åŠ«æŒ X-Frame-Options \u0026#34;DENY\u0026#34; # XSSä¿æŠ¤ X-XSS-Protection \u0026#34;1; mode=block\u0026#34; # HSTS Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains; preload\u0026#34; # å¼•ç”¨ç­–ç•¥ Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34; # æƒé™ç­–ç•¥ Permissions-Policy \u0026#34;geolocation=(), microphone=(), camera=()\u0026#34; # å†…å®¹å®‰å…¨ç­–ç•¥ Content-Security-Policy \u0026#34;default-src \u0026#39;self\u0026#39;; script-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39; https://cdn.example.com; style-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39; https://cdn.example.com; img-src \u0026#39;self\u0026#39; data: https:;\u0026#34; } ğŸ” è®¿é—®æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # IPè®¿é—®é™åˆ¶ @blocked { not remote_ip 192.168.1.0/24 10.10.10.0/24 } respond @blocked 403 \u0026#34;Forbidden\u0026#34; # åŸºæœ¬è®¤è¯ basicauth /admin/* { admin $2y$10$AbCdEfGhIjKlMnOpQrStUvWxYzAbCdEfGhIjKlMnOpQrStUv } # é€Ÿç‡é™åˆ¶ @rate_limit { remote_ip 192.168.1.0/24 } limit_rate @rate_limit 100k ğŸ› æ•…éšœæ’é™¤ ğŸ” å¸¸è§é—®é¢˜è§£å†³ ç«¯å£è¢«å ç”¨\n1 2 3 4 5 # æ£€æŸ¥ç«¯å£å ç”¨ sudo netstat -tulnp | grep :6663 # ç»ˆæ­¢å ç”¨è¿›ç¨‹ sudo fuser -k 6663/tcp æƒé™é—®é¢˜\n1 2 3 4 5 6 7 8 9 # ä¿®å¤æ–‡ä»¶æƒé™ sudo chown -R www-data:www-data /var/www/html sudo chmod -R 755 /var/www/html # æ£€æŸ¥SELinuxçŠ¶æ€ getenforce # ä¸´æ—¶ç¦ç”¨SELinuxï¼ˆå¦‚éœ€ï¼‰ sudo setenforce 0 é…ç½®é”™è¯¯\n1 2 3 4 5 # æ£€æŸ¥é…ç½®è¯­æ³• sudo caddy validate --config /etc/caddy/Caddyfile # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ sudo caddy run --config /etc/caddy/Caddyfile --adapter caddyfile ğŸ“‹ æ—¥å¿—æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹Caddyæ—¥å¿— sudo journalctl -u caddy -f # æŸ¥çœ‹è®¿é—®æ—¥å¿— sudo tail -f /var/log/caddy/access.log # å®æ—¶ç›‘æ§é”™è¯¯ sudo tail -f /var/log/caddy/*.log | grep -i error # æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨ sudo top -p $(pgrep caddy) ğŸ’¡ å®ç”¨æŠ€å·§ ğŸ¯ ä¸€é”®éƒ¨ç½²è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 #!/bin/bash # ğŸš€ Caddyé™æ€ç½‘ç«™ä¸€é”®éƒ¨ç½²è„šæœ¬ set -e echo \u0026#34;å¼€å§‹éƒ¨ç½²é™æ€ç½‘ç«™...\u0026#34; # å®‰è£…Caddy echo \u0026#34;å®‰è£…Caddy...\u0026#34; sudo apt update sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https curl curl -1sLf \u0026#39;https://dl.cloudsmith.io/public/caddy/stable/gpg.key\u0026#39; | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg curl -1sLf \u0026#39;https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt\u0026#39; | sudo tee /etc/apt/sources.list.d/caddy-stable.list sudo apt update sudo apt install caddy # åˆ›å»ºç½‘ç«™ç›®å½• echo \u0026#34;åˆ›å»ºç½‘ç«™ç›®å½•...\u0026#34; sudo mkdir -p /var/www/html/web sudo chown -R www-data:www-data /var/www/html sudo chmod -R 755 /var/www/html # åˆ›å»ºç¤ºä¾‹é¡µé¢ echo \u0026#34;åˆ›å»ºç¤ºä¾‹é¡µé¢...\u0026#34; sudo tee /var/www/html/web/index.html \u0026lt;\u0026lt;\u0026#39;HTML\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Welcome\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt;body{font-family:Arial,sans-serif;margin:40px;text-align:center}\u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;ğŸš€ ç½‘ç«™éƒ¨ç½²æˆåŠŸ!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;ä½ çš„é™æ€ç½‘ç«™å·²ç»æˆåŠŸéƒ¨ç½²\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; HTML # åˆ›å»ºCaddyé…ç½® echo \u0026#34;åˆ›å»ºCaddyé…ç½®...\u0026#34; sudo mkdir -p /etc/caddy/conf.d sudo tee /etc/caddy/Caddyfile \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { admin off auto_https disable_redirects } :80 { root * /var/www/html/web file_server encode gzip } EOF # å¯åŠ¨æœåŠ¡ echo \u0026#34;å¯åŠ¨CaddyæœåŠ¡...\u0026#34; sudo systemctl enable caddy sudo systemctl start caddy echo \u0026#34;âœ… éƒ¨ç½²å®Œæˆ! ç½‘ç«™å·²å¯åŠ¨\u0026#34; ğŸ”„ è‡ªåŠ¨æ›´æ–°è¯ä¹¦ 1 2 3 4 5 6 7 8 # ä½¿ç”¨Caddyå†…ç½®çš„è‡ªåŠ¨SSL # Caddyä¼šè‡ªåŠ¨å¤„ç†è¯ä¹¦çš„è·å–å’Œç»­æœŸ # æ‰‹åŠ¨ç»­æœŸæ£€æŸ¥ sudo caddy renew # æŸ¥çœ‹è¯ä¹¦çŠ¶æ€ sudo caddy validate ğŸ“Š ç›‘æ§çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹CaddyçŠ¶æ€ sudo systemctl status caddy # æŸ¥çœ‹æ´»åŠ¨è¿æ¥ sudo ss -tulpn | grep caddy # æŸ¥çœ‹èµ„æºä½¿ç”¨ sudo ps aux | grep caddy # ç›‘æ§è®¿é—®æ—¥å¿— sudo tail -f /var/log/caddy/access.log | jq \u0026#39;.\u0026#39; ğŸ’¡ ä¸“ä¸šæç¤º: Caddyçš„è‡ªåŠ¨HTTPSåŠŸèƒ½è®©å®ƒæˆä¸ºéƒ¨ç½²é™æ€ç½‘ç«™çš„ç»ä½³é€‰æ‹©ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨å®Œæ•´çš„Caddyfileé…ç½®ï¼Œå¹¶å®šæœŸæ£€æŸ¥æ—¥å¿—ä»¥ç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œã€‚\n","date":"2024-12-07T20:03:25+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/44e3f377/","title":"Caddy éƒ¨ç½²é™æ€ç½‘ç«™ ğŸŒ"},{"content":"Nginx éƒ¨ç½²é™æ€ç½‘ç«™ ğŸŒ ğŸ“– ç›®å½•å¯¼èˆª ğŸŒŸ ç®€ä»‹ ğŸ” ä¸€ã€é…ç½®å¸¦åŸŸåçš„é™æ€é¡µé¢ï¼ˆHTTPSï¼‰ ğŸŒ äºŒã€é…ç½®å†…ç½‘é™æ€é¡µé¢ï¼ˆHTTPï¼‰ ğŸ”§ ä¸‰ã€é«˜çº§é…ç½®é€‰é¡¹ ğŸ“Š å››ã€ç›‘æ§å’Œç»´æŠ¤ ğŸ”’ äº”ã€å®‰å…¨åŠ å›ºå»ºè®® ğŸš€ å…­ã€æ€§èƒ½ä¼˜åŒ– ğŸ› ä¸ƒã€æ•…éšœæ’é™¤ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨é…ç½® Nginx æœåŠ¡å™¨æ¥æ‰˜ç®¡é™æ€ç½‘é¡µï¼ŒåŒ…æ‹¬å¸¦åŸŸåçš„ HTTPS è®¿é—®å’Œå†…ç½‘ HTTP è®¿é—®ä¸¤ç§æ–¹å¼ã€‚Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç®€å•çš„é…ç½®å’Œä½èµ„æºæ¶ˆè€—è€Œé—»åã€‚\nğŸ” ä¸€ã€é…ç½®å¸¦åŸŸåçš„é™æ€é¡µé¢ï¼ˆHTTPSï¼‰ è®¿é—®åœ°å€ï¼š https://jingtai.mobufan.eu.org:5553 1. åˆ›å»º HTML é™æ€é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 mkdir -p /var/www/html/web \u0026amp;\u0026amp; \\ touch /var/www/html/web/index.html \u0026amp;\u0026amp; \\ cat \u0026gt; /var/www/html/web/index.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE HTML\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;@å¢¨ä¸å‡¡ - é™æ€é¡µé¢\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; * { margin: 0; padding: 0; box-sizing: border-box; } html { height: 100%; } body { background: #000000; height: 100%; font-family: \u0026#39;Arial\u0026#39;, sans-serif; display: flex; justify-content: center; align-items: center; } .container { text-align: center; padding: 2rem; background: rgba(255, 255, 255, 0.1); border-radius: 10px; box-shadow: 0 0 20px rgba(200, 0, 255, 0.5); } .title { font-size: 2.5rem; color: #ff0037; margin-bottom: 1rem; text-shadow: 0 0 10px rgba(255, 0, 55, 0.7); } .path { font-size: 1.2rem; color: #e6fafd; padding: 1rem; border: 2px dashed rgb(200, 0, 255); border-radius: 5px; background: rgba(230, 250, 253, 0.1); } .footer { margin-top: 2rem; color: #888; font-size: 0.9rem; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;title\u0026#34;\u0026gt;æ¬¢è¿è®¿é—®é™æ€é¡µé¢\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;path\u0026#34;\u0026gt;é™æ€é¡µè·¯å¾„: /var/www/html/web/index.html\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;footer\u0026#34;\u0026gt;@å¢¨ä¸å‡¡ Â· åŸºäº Nginx æ„å»º\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF 2. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 touch /etc/nginx/conf.d/jingtai.conf \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/jingtai.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { ## ç›‘å¬5553ç«¯å£ï¼Œå¯ç”¨SSL listen 5553 ssl; listen [::]:5553 ssl; ## åŸŸåé…ç½® server_name jingtai.mobufan.eu.org; ## SSLè¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ## SSLä¼˜åŒ–é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ## å­—ç¬¦ç¼–ç  charset utf-8; ## æ ¹ç›®å½•é…ç½® root /var/www/html/web; index index.html; ## è®¿é—®æ—¥å¿— access_log /var/log/nginx/jingtai.access.log; error_log /var/log/nginx/jingtai.error.log; location / { try_files $uri $uri/ =404; ## å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; add_header X-Content-Type-Options \u0026#34;nosniff\u0026#34; always; add_header Referrer-Policy \u0026#34;no-referrer-when-downgrade\u0026#34; always; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; } ## ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶ location ~ /\\. { deny all; access_log off; log_not_found off; } ## ç¼“å­˜é™æ€èµ„æº location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } } EOF 3. åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡å¯NginxæœåŠ¡ sudo systemctl restart nginx # æŸ¥çœ‹NginxçŠ¶æ€ sudo systemctl status nginx # æ£€æŸ¥ç«¯å£ç›‘å¬æƒ…å†µ sudo netstat -tuln | grep :5553 ğŸŒ äºŒã€é…ç½®å†…ç½‘é™æ€é¡µé¢ï¼ˆHTTPï¼‰ è®¿é—®åœ°å€ï¼š http://10.10.10.245:1414\n1. åˆ›å»º HTML é™æ€é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 mkdir -p /var/www/html/web \u0026amp;\u0026amp; \\ touch /var/www/html/web/index.html \u0026amp;\u0026amp; \\ cat \u0026gt; /var/www/html/web/index.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE HTML\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;@å¢¨ä¸å‡¡ - å†…ç½‘é™æ€é¡µé¢\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; * { margin: 0; padding: 0; box-sizing: border-box; } html { height: 100%; } body { background: #1a1a1a; height: 100%; font-family: \u0026#39;Arial\u0026#39;, sans-serif; display: flex; justify-content: center; align-items: center; color: #fff; } .container { text-align: center; padding: 2rem; background: rgba(0, 0, 0, 0.7); border-radius: 10px; border: 2px solid #4a4a4a; max-width: 90%; } .title { font-size: 2rem; color: #4dc0ff; margin-bottom: 1rem; } .path { font-size: 1.1rem; color: #ccc; padding: 1rem; border: 1px dashed #4dc0ff; border-radius: 5px; margin: 1rem 0; background: rgba(77, 192, 255, 0.1); } .info { margin-top: 1.5rem; font-size: 0.9rem; color: #888; } .ip-address { color: #4dc0ff; font-weight: bold; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;title\u0026#34;\u0026gt;å†…ç½‘é™æ€é¡µé¢æœåŠ¡\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;path\u0026#34;\u0026gt;é™æ€é¡µè·¯å¾„: /var/www/html/web/index.html\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;info\u0026#34;\u0026gt; \u0026lt;p\u0026gt;æœåŠ¡å™¨IP: \u0026lt;span class=\u0026#34;ip-address\u0026#34;\u0026gt;10.10.10.245\u0026lt;/span\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;è®¿é—®ç«¯å£: \u0026lt;span class=\u0026#34;ip-address\u0026#34;\u0026gt;1414\u0026lt;/span\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;@å¢¨ä¸å‡¡ Â· å†…ç½‘æœåŠ¡\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF 2. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 touch /etc/nginx/conf.d/web.conf \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/web.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { ## ç›‘å¬1414ç«¯å£ listen 1414 default_server; listen [::]:1414 default_server; ## æœåŠ¡å™¨åç§°ï¼ˆå¯é€‰ï¼‰ server_name _; ## å­—ç¬¦ç¼–ç  charset utf-8; ## æ ¹ç›®å½•é…ç½® root /var/www/html/web; index index.html; ## è®¿é—®æ—¥å¿— access_log /var/log/nginx/web.access.log; error_log /var/log/nginx/web.error.log; location / { try_files $uri $uri/ =404; ## å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; add_header X-Content-Type-Options \u0026#34;nosniff\u0026#34; always; } ## ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶ location ~ /\\. { deny all; access_log off; log_not_found off; } ## ç¼“å­˜é™æ€èµ„æº location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } ## é™åˆ¶è®¿é—®ï¼ˆå¯é€‰ï¼Œå¯æ ¹æ®éœ€è¦é…ç½®å†…ç½‘IPæ®µï¼‰ # allow 10.10.10.0/24; # deny all; } EOF 3. åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡å¯NginxæœåŠ¡ sudo systemctl restart nginx # æŸ¥çœ‹NginxçŠ¶æ€ sudo systemctl status nginx # æ£€æŸ¥ç«¯å£ç›‘å¬æƒ…å†µ sudo netstat -tuln | grep :1414 ğŸ”§ ä¸‰ã€é«˜çº§é…ç½®é€‰é¡¹ 1. å¯ç”¨ Gzip å‹ç¼© åœ¨ /etc/nginx/nginx.conf çš„ http å—ä¸­æ·»åŠ ï¼š\n1 2 3 4 5 6 gzip on; gzip_vary on; gzip_min_length 1024; gzip_proxied expired no-cache no-store private auth; gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json; gzip_disable \u0026#34;MSIE [1-6]\\.\u0026#34;; 2. æ·»åŠ è‡ªå®šä¹‰é”™è¯¯é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # åˆ›å»ºé”™è¯¯é¡µé¢ç›®å½• mkdir -p /var/www/html/errors # åˆ›å»ºè‡ªå®šä¹‰404é¡µé¢ cat \u0026gt; /var/www/html/errors/404.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;é¡µé¢æœªæ‰¾åˆ° - 404\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #f8f9fa; color: #343a40; } h1 { font-size: 50px; color: #dc3545; } a { color: #007bff; text-decoration: none; } a:hover { text-decoration: underline; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;404\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;æŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ã€‚\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;è¿”å›é¦–é¡µ\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF åœ¨ Nginx é…ç½®ä¸­æ·»åŠ é”™è¯¯é¡µé¢å¤„ç†ï¼š\n1 2 3 4 5 error_page 404 /errors/404.html; location = /errors/404.html { internal; root /var/www/html; } 3. æ·»åŠ è®¿é—®é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 ## é™åˆ¶ç‰¹å®šIPæ®µè®¿é—® location / { allow 10.10.10.0/24; allow 192.168.1.0/24; deny all; ## å…¶ä»–é…ç½®... } ## æˆ–è€…æ·»åŠ åŸºç¡€è®¤è¯ location /admin/ { auth_basic \u0026#34;Restricted Area\u0026#34;; auth_basic_user_file /etc/nginx/.htpasswd; } åˆ›å»ºå¯†ç æ–‡ä»¶ï¼š\n1 2 3 4 5 # å®‰è£…htpasswdå·¥å…· sudo apt-get install apache2-utils # åˆ›å»ºç”¨æˆ·å’Œå¯†ç  sudo htpasswd -c /etc/nginx/.htpasswd username ğŸ“Š å››ã€ç›‘æ§å’Œç»´æŠ¤ 1. æŸ¥çœ‹è®¿é—®æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 # å®æ—¶æŸ¥çœ‹è®¿é—®æ—¥å¿— tail -f /var/log/nginx/jingtai.access.log # æŸ¥çœ‹é”™è¯¯æ—¥å¿— tail -f /var/log/nginx/jingtai.error.log # ç»Ÿè®¡è®¿é—®é‡ awk \u0026#39;{print $1}\u0026#39; /var/log/nginx/jingtai.access.log | sort | uniq -c | sort -nr | head -10 # æŸ¥çœ‹æœ€å¸¸è®¿é—®çš„é¡µé¢ awk \u0026#39;{print $7}\u0026#39; /var/log/nginx/jingtai.access.log | sort | uniq -c | sort -nr | head -10 2. æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£…ç›‘æ§å·¥å…· sudo apt-get install htop iotop iftop # æŸ¥çœ‹Nginxè¿›ç¨‹ ps aux | grep nginx # æŸ¥çœ‹æœåŠ¡å™¨è¿æ¥çŠ¶æ€ netstat -an | grep :5553 # ç›‘æ§Nginxæ€§èƒ½ nginx -T # æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ top -p $(pgrep nginx | head -1) 3. å®šæœŸç»´æŠ¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆ›å»ºç»´æŠ¤è„šæœ¬ cat \u0026gt; /usr/local/bin/nginx-maintenance.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # æ—¥å¿—è½®è½¬ logrotate /etc/logrotate.d/nginx # æ¸…ç†æ—§æ—¥å¿—ï¼ˆä¿ç•™30å¤©ï¼‰ find /var/log/nginx -name \u0026#34;*.log\u0026#34; -type f -mtime +30 -delete # æµ‹è¯•é…ç½® nginx -t # å¹³æ»‘é‡è½½é…ç½® nginx -s reload echo \u0026#34;Nginx maintenance completed at $(date)\u0026#34; EOF chmod +x /usr/local/bin/nginx-maintenance.sh # æ·»åŠ åˆ°cronå®šæœŸæ‰§è¡Œ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;0 2 * * * /usr/local/bin/nginx-maintenance.sh\u0026#34;) | crontab - ğŸ”’ äº”ã€å®‰å…¨åŠ å›ºå»ºè®® ä¿æŒæ›´æ–°ï¼šå®šæœŸæ›´æ–° Nginx å’Œç³»ç»Ÿè½¯ä»¶åŒ…\n1 sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y æœ€å°æƒé™ï¼šä½¿ç”¨érootç”¨æˆ·è¿è¡ŒNginxå·¥ä½œè¿›ç¨‹\n1 user www-data; é˜²ç«å¢™é…ç½®ï¼šåªå¼€æ”¾å¿…è¦çš„ç«¯å£\n1 2 3 sudo ufw allow 5553/tcp sudo ufw allow 1414/tcp sudo ufw enable ç¦ç”¨æœåŠ¡å™¨ä»¤ç‰Œï¼šåœ¨nginx.confä¸­æ·»åŠ  server_tokens off;\né™åˆ¶è¯·æ±‚å¤§å°ï¼šè®¾ç½® client_max_body_size é˜²æ­¢å¤§æ–‡ä»¶ä¸Šä¼ æ”»å‡»\n1 client_max_body_size 10M; å®šæœŸå¤‡ä»½ï¼šå¤‡ä»½é…ç½®æ–‡ä»¶å’Œç½‘ç«™å†…å®¹\n1 2 3 4 5 # å¤‡ä»½Nginxé…ç½® tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /etc/nginx/ # å¤‡ä»½ç½‘ç«™å†…å®¹ tar -czf web-backup-$(date +%Y%m%d).tar.gz /var/www/html/ ä½¿ç”¨å®‰å…¨åè®®ï¼šç¦ç”¨ä¸å®‰å…¨çš„SSL/TLSåè®®å’Œå¯†ç å¥—ä»¶\n1 2 ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384; ğŸš€ å…­ã€æ€§èƒ½ä¼˜åŒ– 1. å¯ç”¨ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 # åœ¨httpå—ä¸­æ·»åŠ  proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m; # åœ¨serveræˆ–locationå—ä¸­ä½¿ç”¨ location ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ { proxy_cache my_cache; proxy_cache_valid 200 302 1h; proxy_cache_valid 404 1m; add_header X-Cache-Status $upstream_cache_status; } 2. è°ƒæ•´å·¥ä½œè¿›ç¨‹ 1 2 3 4 5 6 7 8 # æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´ worker_processes auto; # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•° events { worker_connections 1024; multi_accept on; } 3. å¯ç”¨Keepalive 1 2 3 # åœ¨httpå—ä¸­æ·»åŠ  keepalive_timeout 65; keepalive_requests 100; ğŸ› ä¸ƒã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥Nginxé…ç½®è¯­æ³• sudo nginx -t # æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æ£€æŸ¥ç«¯å£å ç”¨ sudo netstat -tulnp | grep :5553 # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /var/www/html/web/ # æ£€æŸ¥SELinuxçŠ¶æ€ï¼ˆå¦‚æœå¯ç”¨ï¼‰ getenforce sestatus 2. æ€§èƒ½é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹Nginxè¿æ¥çŠ¶æ€ netstat -an | grep :5553 | wc -l # æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½ uptime # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ free -h # æŸ¥çœ‹ç£ç›˜I/O iostat -x 1 3. æ—¥å¿—åˆ†æå·¥å…· 1 2 3 4 5 6 7 8 # å®‰è£…æ—¥å¿—åˆ†æå·¥å…· sudo apt-get install goaccess # åˆ†æè®¿é—®æ—¥å¿— goaccess /var/log/nginx/jingtai.access.log -o /var/www/html/report.html --log-format=COMBINED # å®æ—¶ç›‘æ§ goaccess /var/log/nginx/jingtai.access.log -o /var/www/html/realtime.html --real-time-html --log-format=COMBINED ğŸš€ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨å·²ç»æˆåŠŸéƒ¨ç½²äº†å®‰å…¨ã€é«˜æ•ˆçš„é™æ€ç½‘é¡µæœåŠ¡ã€‚æ— è®ºæ˜¯é€šè¿‡åŸŸåHTTPSè®¿é—®è¿˜æ˜¯å†…ç½‘HTTPè®¿é—®ï¼Œéƒ½èƒ½æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼\nğŸ’¡ æç¤ºï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œæ ¹æ®å®é™…è®¿é—®æƒ…å†µè°ƒæ•´é…ç½®å‚æ•°ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ç›‘æ§å·¥å…·ï¼ˆå¦‚Prometheus + Grafanaï¼‰è¿›è¡ŒæŒç»­ç›‘æ§ã€‚\n","date":"2024-12-07T20:02:47+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/441b9317/","title":"Nginx éƒ¨ç½²é™æ€ç½‘ç«™ ğŸŒ"},{"content":"Nginx ç›®å½•ç»“æ„ä¸é…ç½®æ–‡ä»¶è¯¦è§£ ğŸ—‚ï¸ ğŸ“– ç›®å½•å¯¼èˆª ğŸŒŸ Nginx é…ç½®æ–‡ä»¶æ¶æ„æ¦‚è¿° ğŸ“‹ é…ç½®æ–‡ä»¶ç»“æ„æ€»è§ˆ ğŸ”§ ä¸€ã€Nginx ä¸»é…ç½®æ–‡ä»¶ ğŸŒ äºŒã€Nginx ç«™ç‚¹é…ç½®æ–‡ä»¶ ğŸ¯ ä¸‰ã€è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ ğŸ“ å››ã€Nginx ç½‘é¡µç›®å½•ç»“æ„ ğŸ› ï¸ äº”ã€å®ç”¨ç®¡ç†è„šæœ¬ ğŸ” å…­ã€æ•…éšœæ’æŸ¥æŒ‡å— ğŸ¯ æœ€ä½³å®è·µå»ºè®® ğŸŒŸ Nginx é…ç½®æ–‡ä»¶æ¶æ„æ¦‚è¿° Nginx é‡‡ç”¨æ¨¡å—åŒ–çš„é…ç½®æ–‡ä»¶ç»“æ„ï¼Œè®©æ‚¨èƒ½å¤Ÿè½»æ¾ç®¡ç†å’Œç»´æŠ¤å¤æ‚çš„æœåŠ¡å™¨é…ç½®ã€‚Nginx çš„é…ç½®ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nğŸ—ï¸ æ¨¡å—åŒ–è®¾è®¡ï¼šé…ç½®æ–‡ä»¶åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤ ğŸ”§ å±‚æ¬¡ç»“æ„ï¼šé‡‡ç”¨æŒ‡ä»¤å—çš„æ–¹å¼ç»„ç»‡é…ç½®ï¼Œæ¸…æ™°æ˜“æ‡‚ âš¡ é«˜æ€§èƒ½ï¼šé…ç½®æ–‡ä»¶åœ¨å¯åŠ¨æ—¶åŠ è½½ï¼Œè¿è¡Œæ—¶æ— éœ€é‡æ–°è§£æ ğŸ”’ å®‰å…¨æ€§ï¼šæ”¯æŒå¤šç§å®‰å…¨é…ç½®é€‰é¡¹å’Œè®¿é—®æ§åˆ¶ ğŸ“Š çµæ´»æ€§ï¼šæ”¯æŒæ¡ä»¶åˆ¤æ–­ã€å˜é‡ä½¿ç”¨å’Œè‡ªå®šä¹‰é…ç½® ğŸ“‹ é…ç½®æ–‡ä»¶ç»“æ„æ€»è§ˆ 1 2 3 4 5 6 7 8 9 10 11 /etc/nginx/ â”œâ”€â”€ nginx.conf # ä¸»é…ç½®æ–‡ä»¶ â”œâ”€â”€ conf.d/ # è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç›®å½• â”œâ”€â”€ sites-available/ # å¯ç”¨ç«™ç‚¹é…ç½® â”œâ”€â”€ sites-enabled/ # å¯ç”¨ç«™ç‚¹é…ç½®ï¼ˆç¬¦å·é“¾æ¥ï¼‰ â”œâ”€â”€ modules-enabled/ # å¯ç”¨æ¨¡å—é…ç½® â”œâ”€â”€ mime.types # MIMEç±»å‹æ˜ å°„ â”œâ”€â”€ proxy_params # ä»£ç†å‚æ•°é…ç½® â”œâ”€â”€ ssl_params # SSLå‚æ•°é…ç½® â”œâ”€â”€ fastcgi_params # FastCGIå‚æ•°é…ç½® â””â”€â”€ snippets/ # é…ç½®ç‰‡æ®µ å…³é”®ç›®å½•è¯´æ˜ nginx.conf: ä¸»é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«å…¨å±€è®¾ç½®å’Œå¼•å…¥å…¶ä»–é…ç½® conf.d/: å­˜æ”¾è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æŒ‰åŠŸèƒ½åˆ†ç±» sites-available/: æ‰€æœ‰å¯ç”¨çš„ç«™ç‚¹é…ç½®æ–‡ä»¶ sites-enabled/: å®é™…å¯ç”¨çš„ç«™ç‚¹é…ç½®ï¼ˆç¬¦å·é“¾æ¥åˆ° sites-availableï¼‰ snippets/: å­˜æ”¾å¯é‡ç”¨çš„é…ç½®ç‰‡æ®µ ğŸ”§ ä¸€ã€Nginx ä¸»é…ç½®æ–‡ä»¶ ä¸»é…ç½®æ–‡ä»¶ä½ç½® 1 /etc/nginx/nginx.conf ä¼˜åŒ–åçš„ä¸»é…ç½®æ–‡ä»¶ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 # è¿è¡Œç”¨æˆ·å’Œç»„ user www-data; # å·¥ä½œè¿›ç¨‹æ•°ï¼ˆå»ºè®®è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°ï¼‰ worker_processes auto; # PIDæ–‡ä»¶ä½ç½® pid /run/nginx.pid; # é”™è¯¯æ—¥å¿—è®¾ç½® error_log /var/log/nginx/error.log warn; # åŠ è½½åŠ¨æ€æ¨¡å— include /etc/nginx/modules-enabled/*.conf; # äº‹ä»¶æ¨¡å—é…ç½® events { # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•° worker_connections 1024; # ä½¿ç”¨epollé«˜æ•ˆå¤„ç†è¿æ¥ï¼ˆLinuxï¼‰ use epoll; # å¤šè¿æ¥æ¥å—å¤„ç† multi_accept on; # è¿æ¥å¤„ç†ä¼˜åŒ– accept_mutex on; accept_mutex_delay 100ms; } # HTTPæ¨¡å—é…ç½® http { # åŸºæœ¬è®¾ç½® sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # æœåŠ¡å™¨åç§°å“ˆå¸Œè¡¨å¤§å° server_names_hash_bucket_size 64; server_names_hash_max_size 2048; # MIMEç±»å‹é…ç½® include /etc/nginx/mime.types; default_type application/octet-stream; # SSLé…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_session_tickets off; ssl_stapling on; ssl_stapling_verify on; # è§£æå™¨é…ç½® resolver 8.8.8.8 1.1.1.1 valid=300s; resolver_timeout 5s; # æ—¥å¿—æ ¼å¼ log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; log_format json escape=json \u0026#39;{\u0026#34;time\u0026#34;: \u0026#34;$time_local\u0026#34;, \u0026#39; \u0026#39;\u0026#34;remote_addr\u0026#34;: \u0026#34;$remote_addr\u0026#34;, \u0026#39; \u0026#39;\u0026#34;remote_user\u0026#34;: \u0026#34;$remote_user\u0026#34;, \u0026#39; \u0026#39;\u0026#34;request\u0026#34;: \u0026#34;$request\u0026#34;, \u0026#39; \u0026#39;\u0026#34;status\u0026#34;: \u0026#34;$status\u0026#34;, \u0026#39; \u0026#39;\u0026#34;body_bytes_sent\u0026#34;: \u0026#34;$body_bytes_sent\u0026#34;, \u0026#39; \u0026#39;\u0026#34;http_referer\u0026#34;: \u0026#34;$http_referer\u0026#34;, \u0026#39; \u0026#39;\u0026#34;http_user_agent\u0026#34;: \u0026#34;$http_user_agent\u0026#34;, \u0026#39; \u0026#39;\u0026#34;http_x_forwarded_for\u0026#34;: \u0026#34;$http_x_forwarded_for\u0026#34;}\u0026#39;; access_log /var/log/nginx/access.log main; # Gzipå‹ç¼© gzip on; gzip_vary on; gzip_min_length 1024; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/atom+xml image/svg+xml; # æ–‡ä»¶ç¼“å­˜ä¼˜åŒ– open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; # å®¢æˆ·ç«¯é™åˆ¶ client_max_body_size 100M; client_body_buffer_size 128k; client_header_buffer_size 1k; large_client_header_buffers 4 4k; # è¶…æ—¶è®¾ç½® client_body_timeout 12; client_header_timeout 12; send_timeout 10; # åŒ…å«å…¶ä»–é…ç½® include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } é…ç½®æ–‡ä»¶ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æŸ¥çœ‹ä¸»é…ç½® cat /etc/nginx/nginx.conf # ç¼–è¾‘é…ç½® sudo nano /etc/nginx/nginx.conf # å¤‡ä»½é…ç½® sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup.$(date +%Y%m%d) # æ¸…ç†æ³¨é‡Šå’Œç©ºè¡Œï¼ˆç”Ÿäº§ç¯å¢ƒè°¨æ…ä½¿ç”¨ï¼‰ grep -Ev \u0026#39;#|^$\u0026#39; /etc/nginx/nginx.conf.backup | sudo tee /etc/nginx/nginx.conf # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t # é‡æ–°åŠ è½½é…ç½® sudo nginx -s reload # å®Œå…¨é‡å¯Nginx sudo systemctl restart nginx ğŸŒ äºŒã€Nginx ç«™ç‚¹é…ç½®æ–‡ä»¶ é»˜è®¤ç«™ç‚¹é…ç½®ä½ç½® 1 2 /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default ä¼˜åŒ–åçš„é»˜è®¤ç«™ç‚¹é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 server { # ç›‘å¬ç«¯å£é…ç½® listen 80 default_server; listen [::]:80 default_server; # æœåŠ¡å™¨åç§°ï¼ˆå¯ä½¿ç”¨é€šé…ç¬¦ï¼‰ server_name _; # æ ¹ç›®å½•è®¾ç½® root /var/www/html; # é»˜è®¤ç´¢å¼•æ–‡ä»¶ index index.html index.htm index.nginx-debian.html; # è®¿é—®æ—¥å¿— access_log /var/log/nginx/host.access.log main; # é”™è¯¯æ—¥å¿— error_log /var/log/nginx/host.error.log warn; # æ ¹è·¯å¾„å¤„ç† location / { # å°è¯•æä¾›è¯·æ±‚çš„æ–‡ä»¶ï¼Œå¦åˆ™è¿”å›404 try_files $uri $uri/ =404; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-Content-Type-Options \u0026#34;nosniff\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; add_header Referrer-Policy \u0026#34;no-referrer-when-downgrade\u0026#34; always; } # é™æ€æ–‡ä»¶ç¼“å­˜è®¾ç½® location ~* \\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ { expires 30d; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; add_header Access-Control-Allow-Origin \u0026#34;*\u0026#34;; # æ—¥å¿—è®°å½•å…³é—­ access_log off; log_not_found off; } # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶ location ~ /\\. { deny all; access_log off; log_not_found off; } # ç¦æ­¢è®¿é—®å¸¸è§æ•æ„Ÿæ–‡ä»¶ location ~* (\\.env|composer\\.json|composer\\.lock|package\\.json|package-lock\\.json|\\.git|\\.svn|\\.htaccess) { deny all; access_log off; log_not_found off; } # è‡ªå®šä¹‰é”™è¯¯é¡µé¢ error_page 404 /404.html; location = /404.html { internal; root /var/www/html; } error_page 500 502 503 504 /50x.html; location = /50x.html { internal; root /var/www/html; } # PHPå¤„ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰ location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php8.1-fpm.sock; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } ç«™ç‚¹é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¯ç”¨ç«™ç‚¹ï¼ˆåˆ›å»ºç¬¦å·é“¾æ¥ï¼‰ sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/ # ç¦ç”¨ç«™ç‚¹ï¼ˆåˆ é™¤ç¬¦å·é“¾æ¥ï¼‰ sudo rm /etc/nginx/sites-enabled/example.com # åˆ—å‡ºæ‰€æœ‰å¯ç”¨ç«™ç‚¹ ls -la /etc/nginx/sites-available/ # åˆ—å‡ºæ‰€æœ‰å¯ç”¨ç«™ç‚¹ ls -la /etc/nginx/sites-enabled/ # æµ‹è¯•ç«™ç‚¹é…ç½® sudo nginx -t # é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ sudo nginx -s reload ğŸ¯ ä¸‰ã€è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ è‡ªå®šä¹‰é…ç½®ç›®å½• 1 /etc/nginx/conf.d/ åå‘ä»£ç†é…ç½®ç¤ºä¾‹ï¼ˆxunlei.confï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 # è¿…é›·åå‘ä»£ç†é…ç½® server { # SSLç›‘å¬ç«¯å£ listen 5553 ssl http2; listen [::]:5553 ssl http2; # åŸŸåè®¾ç½® server_name xunlei.mobufan.eu.org; # SSLè¯ä¹¦é…ç½® ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; # SSLä¼˜åŒ–é…ç½® ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_session_tickets off; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers on; # å®‰å…¨å¤´è®¾ç½® add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34; always; # è®¿é—®æ—¥å¿— access_log /var/log/nginx/xunlei.access.log main; error_log /var/log/nginx/xunlei.error.log warn; # åå‘ä»£ç†è®¾ç½® location / { # åç«¯æœåŠ¡å™¨åœ°å€ proxy_pass http://10.10.10.245:2345; # ä»£ç†å¤´è®¾ç½® proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 30s; proxy_send_timeout 30s; proxy_read_timeout 30s; # ç¼“å†²è®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 4k; proxy_busy_buffers_size 8k; # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 20G; } # å¥åº·æ£€æŸ¥ç«¯ç‚¹ location /nginx_status { stub_status on; access_log off; allow 127.0.0.1; allow 10.10.10.0/24; deny all; } # åŸºç¡€è®¤è¯ä¿æŠ¤ï¼ˆå¯é€‰ï¼‰ location /admin { auth_basic \u0026#34;Restricted Area\u0026#34;; auth_basic_user_file /etc/nginx/.htpasswd; # ä»£ç†è®¾ç½®åŒä¸Š proxy_pass http://10.10.10.245:2345; include /etc/nginx/proxy_params; } } è‡ªå®šä¹‰é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶ sudo nano /etc/nginx/conf.d/myapp.conf # æ£€æŸ¥é…ç½®è¯­æ³• sudo nginx -t -c /etc/nginx/conf.d/myapp.conf # é‡è½½é…ç½® sudo nginx -s reload # æŸ¥çœ‹æ‰€æœ‰è‡ªå®šä¹‰é…ç½® ls -la /etc/nginx/conf.d/ # ç¦ç”¨é…ç½®æ–‡ä»¶ï¼ˆé‡å‘½åï¼‰ sudo mv /etc/nginx/conf.d/myapp.conf /etc/nginx/conf.d/myapp.conf.disabled # å¯ç”¨é…ç½®æ–‡ä»¶ sudo mv /etc/nginx/conf.d/myapp.conf.disabled /etc/nginx/conf.d/myapp.conf ğŸ“ å››ã€Nginx ç½‘é¡µç›®å½•ç»“æ„ é»˜è®¤ç½‘é¡µç›®å½• 1 2 3 4 5 # Ubuntu/Debian ç³»ç»Ÿ /var/www/html/ # CentOS/RHEL ç³»ç»Ÿ /usr/share/nginx/html/ ç›®å½•ç»“æ„ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /var/www/ â”œâ”€â”€ html/ # é»˜è®¤ç½‘ç«™æ ¹ç›®å½• â”‚ â”œâ”€â”€ index.html # é»˜è®¤é¦–é¡µ â”‚ â”œâ”€â”€ 404.html # 404é”™è¯¯é¡µé¢ â”‚ â”œâ”€â”€ 50x.html # 50xé”™è¯¯é¡µé¢ â”‚ â””â”€â”€ assets/ # é™æ€èµ„æºç›®å½• â”‚ â”œâ”€â”€ css/ # CSSæ ·å¼æ–‡ä»¶ â”‚ â”œâ”€â”€ js/ # JavaScriptæ–‡ä»¶ â”‚ â”œâ”€â”€ images/ # å›¾ç‰‡æ–‡ä»¶ â”‚ â””â”€â”€ fonts/ # å­—ä½“æ–‡ä»¶ â”œâ”€â”€ example.com/ # è™šæ‹Ÿä¸»æœºç›®å½• â”‚ â””â”€â”€ public_html/ # ç½‘ç«™æ ¹ç›®å½• â””â”€â”€ logs/ # ç½‘ç«™æ—¥å¿—ç›®å½•ï¼ˆå¯é€‰ï¼‰ â”œâ”€â”€ access.log # è®¿é—®æ—¥å¿— â””â”€â”€ error.log # é”™è¯¯æ—¥å¿— ç›®å½•ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # è¿›å…¥ç½‘é¡µç›®å½• cd /var/www/html/ # æŸ¥çœ‹ç›®å½•å†…å®¹ ls -la # è®¾ç½®æ­£ç¡®çš„æƒé™ sudo chown -R www-data:www-data /var/www/html/ sudo chmod -R 755 /var/www/html/ # åˆ›å»ºæ–°çš„ç«™ç‚¹ç›®å½• sudo mkdir -p /var/www/example.com/public_html # è®¾ç½®é€‚å½“çš„æƒé™ sudo chown -R www-data:www-data /var/www/example.com/ sudo chmod -R 755 /var/www/example.com/ # åˆ›å»ºæ—¥å¿—ç›®å½• sudo mkdir -p /var/log/nginx/example.com/ sudo chown -R www-data:www-data /var/log/nginx/example.com/ ğŸ› ï¸ äº”ã€å®ç”¨ç®¡ç†è„šæœ¬ é…ç½®å¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/bash # nginx-backup.sh BACKUP_DIR=\u0026#34;/backup/nginx/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR echo \u0026#34;ğŸ”§ å¼€å§‹å¤‡ä»½Nginxé…ç½®...\u0026#34; # å¤‡ä»½æ‰€æœ‰é…ç½® cp -r /etc/nginx/ $BACKUP_DIR/ cp /var/log/nginx/error.log $BACKUP_DIR/ # å¤‡ä»½ç½‘ç«™å†…å®¹ tar -czf $BACKUP_DIR/www-backup.tar.gz /var/www/html/ echo \u0026#34;âœ… Nginxé…ç½®å·²å¤‡ä»½åˆ°: $BACKUP_DIR\u0026#34; echo \u0026#34;ğŸ“Š å¤‡ä»½å†…å®¹:\u0026#34; ls -la $BACKUP_DIR/ # æ·»åŠ åˆ°cronå®šæœŸæ‰§è¡Œ # 0 2 * * * /path/to/nginx-backup.sh å¿«é€Ÿé…ç½®æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/bin/bash # nginx-check.sh echo \u0026#34;ğŸ” æ£€æŸ¥Nginxé…ç½®...\u0026#34; sudo nginx -t echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“Š å½“å‰è¿è¡ŒçŠ¶æ€:\u0026#34; sudo systemctl status nginx --no-pager -l echo \u0026#34;\u0026#34; echo \u0026#34;ğŸŒ ç›‘å¬ç«¯å£:\u0026#34; sudo netstat -tulnp | grep nginx echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“ˆ å·¥ä½œè¿›ç¨‹:\u0026#34; ps aux | grep nginx | grep -v grep echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“‚ é…ç½®æ–‡ä»¶åŒ…å«:\u0026#34; sudo nginx -T 2\u0026gt;/dev/null | grep -E \u0026#34;(include|conf.d|sites)\u0026#34; | head -10 æ—¥å¿—åˆ†æè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/bin/bash # nginx-log-analyzer.sh LOG_FILE=\u0026#34;${1:-/var/log/nginx/access.log}\u0026#34; if [ ! -f \u0026#34;$LOG_FILE\u0026#34; ]; then echo \u0026#34;âŒ æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: $LOG_FILE\u0026#34; exit 1 fi echo \u0026#34;ğŸ“Š åˆ†ææ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; echo \u0026#34;==========================================\u0026#34; # æ€»è¯·æ±‚æ•° TOTAL_REQUESTS=$(wc -l \u0026lt; \u0026#34;$LOG_FILE\u0026#34;) echo \u0026#34;æ€»è¯·æ±‚æ•°: $TOTAL_REQUESTS\u0026#34; # æœ€é¢‘ç¹çš„IP echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ” æœ€é¢‘ç¹è®¿é—®çš„IP:\u0026#34; awk \u0026#39;{print $1}\u0026#39; \u0026#34;$LOG_FILE\u0026#34; | sort | uniq -c | sort -nr | head -10 # æœ€é¢‘ç¹çš„URL echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ” æœ€é¢‘ç¹è®¿é—®çš„URL:\u0026#34; awk \u0026#39;{print $7}\u0026#39; \u0026#34;$LOG_FILE\u0026#34; | sort | uniq -c | sort -nr | head -10 # å“åº”çŠ¶æ€ç ç»Ÿè®¡ echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“Š å“åº”çŠ¶æ€ç ç»Ÿè®¡:\u0026#34; awk \u0026#39;{print $9}\u0026#39; \u0026#34;$LOG_FILE\u0026#34; | sort | uniq -c | sort -nr # å¸¦å®½ä½¿ç”¨ echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ’¾ å¸¦å®½ä½¿ç”¨æƒ…å†µ:\u0026#34; awk \u0026#39;{sum += $10} END {print \u0026#34;æ€»ä¼ è¾“æ•°æ®: \u0026#34; sum/1024/1024 \u0026#34; MB\u0026#34;}\u0026#39; \u0026#34;$LOG_FILE\u0026#34; ğŸ” å…­ã€æ•…éšœæ’æŸ¥æŒ‡å— å¸¸è§é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # æ£€æŸ¥é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æ£€æŸ¥è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log # æ£€æŸ¥é…ç½®åŒ…å«å…³ç³» sudo nginx -T | grep -E \u0026#34;(include|conf.d|sites)\u0026#34; # æ£€æŸ¥ç«¯å£å†²çª sudo lsof -i :80 -i :443 # æ£€æŸ¥æ–‡ä»¶æƒé™ namei -l /var/www/html/index.html # æ£€æŸ¥SELinuxçŠ¶æ€ getenforce sestatus # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status sudo firewall-cmd --list-all æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®æ—¶è¿æ¥ç›‘æ§ sudo ngxtop # æŸ¥çœ‹å·¥ä½œè¿›ç¨‹ ps aux | grep nginx # ç›‘æ§èµ„æºä½¿ç”¨ top -p $(pgrep -d\u0026#39;,\u0026#39; nginx) # æŸ¥çœ‹è¿æ¥çŠ¶æ€ netstat -an | grep :80 | awk \u0026#39;{print $6}\u0026#39; | sort | uniq -c # å®æ—¶ç›‘æ§è®¿é—®æ—¥å¿— tail -f /var/log/nginx/access.log | awk \u0026#39;{print $1, $4, $7, $9}\u0026#39; # æ£€æŸ¥ç¼“æ…¢è¯·æ±‚ sudo grep \u0026#34;upstream timed out\u0026#34; /var/log/nginx/error.log è°ƒè¯•æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # è¯¦ç»†è°ƒè¯•æ¨¡å¼ sudo nginx -t -c /etc/nginx/nginx.conf -g \u0026#34;daemon off; master_process off;\u0026#34; # æ£€æŸ¥ç‰¹å®šé…ç½® sudo nginx -T | grep -A 10 -B 5 \u0026#34;server_name example.com\u0026#34; # æµ‹è¯•é‡å®šå‘ curl -I http://example.com # æµ‹è¯•SSLè¿æ¥ openssl s_client -connect example.com:443 -servername example.com # æ£€æŸ¥HTTPå¤´ curl -I -H \u0026#34;Host: example.com\u0026#34; http://localhost # å‹åŠ›æµ‹è¯• ab -n 1000 -c 100 http://example.com/ ğŸ¯ æœ€ä½³å®è·µå»ºè®® æ¨¡å—åŒ–é…ç½®: å°†ä¸åŒåŠŸèƒ½åˆ†ç¦»åˆ°ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­\n1 2 3 4 5 6 7 8 9 10 # æŒ‰åŠŸèƒ½åˆ†ç¦»é…ç½® /etc/nginx/ â”œâ”€â”€ conf.d/ â”‚ â”œâ”€â”€ security.conf # å®‰å…¨é…ç½® â”‚ â”œâ”€â”€ compression.conf # å‹ç¼©é…ç½® â”‚ â”œâ”€â”€ caching.conf # ç¼“å­˜é…ç½® â”‚ â””â”€â”€ logging.conf # æ—¥å¿—é…ç½® â””â”€â”€ sites-available/ â”œâ”€â”€ example.com # ä¸»ç«™ç‚¹ â””â”€â”€ api.example.com # APIç«™ç‚¹ å®šæœŸå¤‡ä»½: ä¿®æ”¹é…ç½®å‰æ€»æ˜¯è¿›è¡Œå¤‡ä»½\n1 2 3 4 5 6 7 8 # åˆ›å»ºé…ç½®å¤‡ä»½ sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup.$(date +%Y%m%d) # ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ cd /etc/nginx sudo git init sudo git add . sudo git commit -m \u0026#34;Initial nginx configuration\u0026#34; ç‰ˆæœ¬æ§åˆ¶: å¯¹é…ç½®æ–‡ä»¶ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬ç®¡ç†\n1 2 3 4 5 6 7 8 # åˆå§‹åŒ–Gitä»“åº“ sudo git init /etc/nginx # æ·»åŠ æ‰€æœ‰é…ç½®æ–‡ä»¶ sudo git add /etc/nginx/ # æäº¤æ›´æ”¹ sudo git commit -m \u0026#34;Update nginx configuration\u0026#34; å®‰å…¨åŠ å›º: å®šæœŸæ›´æ–°å’Œæ£€æŸ¥å®‰å…¨é…ç½®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰å…¨å¤´éƒ¨é…ç½® add_header X-Frame-Options \u0026#34;SAMEORIGIN\u0026#34; always; add_header X-Content-Type-Options \u0026#34;nosniff\u0026#34; always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; add_header Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34; always; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # éšè—æœåŠ¡å™¨ä¿¡æ¯ server_tokens off; # é™åˆ¶è¯·æ±‚å¤§å° client_max_body_size 10M; # é™åˆ¶è¯·æ±‚æ–¹æ³• if ($request_method !~ ^(GET|HEAD|POST)$) { return 405; } æ€§èƒ½ç›‘æ§: è®¾ç½®ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®‰è£…ç›‘æ§å·¥å…· sudo apt-get install nginx-module-njs # å¯ç”¨çŠ¶æ€æ¨¡å— location /nginx_status { stub_status on; access_log off; allow 127.0.0.1; deny all; } # ä½¿ç”¨Prometheusç›‘æ§ location /metrics { stub_status on; access_log off; } æ—¥å¿—ç®¡ç†: åˆç†é…ç½®æ—¥å¿—è½®è½¬å’Œå­˜å‚¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # é…ç½®æ—¥å¿—è½®è½¬ sudo nano /etc/logrotate.d/nginx # ç¤ºä¾‹é…ç½® /var/log/nginx/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data adm sharedscripts postrotate if [ -f /var/run/nginx.pid ]; then kill -USR1 `cat /var/run/nginx.pid` fi endscript } å®šæœŸæ›´æ–°: ä¿æŒNginxå’Œç³»ç»Ÿçš„æœ€æ–°çŠ¶æ€\n1 2 3 4 5 6 7 8 # æ›´æ–°ç³»ç»ŸåŒ… sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y # æ£€æŸ¥Nginxç‰ˆæœ¬ nginx -v # æŸ¥çœ‹å¯ç”¨æ›´æ–° apt list --upgradable | grep nginx é€šè¿‡è¿™ä»½è¯¦ç»†çš„Nginxç›®å½•ç»“æ„å’Œé…ç½®æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œç®¡ç†NginxæœåŠ¡å™¨é…ç½®ï¼ğŸš€\n","date":"2024-12-07T20:02:04+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5996c035/","title":"Nginx ç›®å½•ç»“æ„ä¸é…ç½®æ–‡ä»¶è¯¦è§£ ğŸ—‚ï¸"},{"content":"Linux æ–‡ä»¶åˆ é™¤-æ³¨é‡Šå’Œç©ºè¡Œ 1 ã€é¦–å…ˆå¤‡ä»½è¦ä¿®æ”¹çš„æ–‡ä»¶ 1 cp default default-bak 2 ã€åˆ é™¤å½“å‰ç›®å½•ä¸‹default-bakæ–‡ä»¶ï¼Œè¾“å‡ºåˆ°defaultæ–‡ä»¶ 1 grep -Ev \u0026#39;#|^$\u0026#39; default-bak \u0026gt; default 3 ã€å°†å»é™¤æ³¨é‡Šå’Œç©ºè¡Œçš„å†…å®¹å†™å…¥åˆ°webdav.conf åé¢è·Ÿæ–‡ä»¶è·¯å¾„ 1 cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;/^[[:space:]]*#/d;/^[[:space:]]*$/d\u0026#39; \u0026gt; å®Œæ•´çš„å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 touch ~/pve.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;/^[[:space:]]*#/d;/^[[:space:]]*$/d\u0026#39; \u0026gt; ~/pve.conf # è®¾ç½®/mnt ä¸ºå¯ä»¥è¢«è®¿é—®çš„ç›®å½•ï¼Œå¯è‡ªè¡Œä¿®æ”¹ä¸ºæƒ³è¦è®¿é—®çš„ç›®å½• https://file.meimolihan.eu.org:6663 { root * /mnt encode gzip # åœ¨Caddyç›®å½•ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¯†ç ï¼Œæ­¤å¤„ä»¥12345ä¸ºä¾‹ # /usr/local/caddy/caddy hash-password --plaintext 12345 basic_auth { admin $2a$14$yZXju.olCFqnybbcXmOfyuA64uPlejIBQVNgd9e7epWJrnB/aT57K } # æŒ‡å®šè¯ä¹¦æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œç»å¯¹è·¯å¾„ä¸º/usr/local/caddy/sslï¼Œæ­¤å¤„ä½¿ç”¨Caddyfileæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ˆ/usr/local/caddyï¼‰çš„ç›¸å¯¹è·¯å¾„ tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key route { rewrite /webdav /webdav/ webdav /webdav/* { # è®¿é—®WebDAVæœåŠ¡çš„å‰ç¼€ prefix /webdav } # HTTPæ–‡ä»¶æœåŠ¡ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶ file_server browse } } EOF 4 ã€å°†å»é™¤æ³¨é‡Šå’Œç©ºè¡Œçš„å†…å®¹å†™å…¥åˆ°~/pve.confï¼ˆä¿ç•™ç¬¬ä¸€è¡Œï¼‰ åé¢è·Ÿæ–‡ä»¶è·¯å¾„ 1 cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; ä¿ç•™ç¬¬ä¸€è¡Œï¼Œå®Œæ•´çš„å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 touch ~/pve.conf \u0026amp;\u0026amp; cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; | sed \u0026#39;1!{/^[[:space:]]*#/d;/^[[:space:]]*$/d}\u0026#39; \u0026gt; ~/pve.conf # è®¾ç½®/mnt ä¸ºå¯ä»¥è¢«è®¿é—®çš„ç›®å½•ï¼Œå¯è‡ªè¡Œä¿®æ”¹ä¸ºæƒ³è¦è®¿é—®çš„ç›®å½• https://file.meimolihan.eu.org:6663 { root * /mnt encode gzip # åœ¨Caddyç›®å½•ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¯†ç ï¼Œæ­¤å¤„ä»¥12345ä¸ºä¾‹ # /usr/local/caddy/caddy hash-password --plaintext 12345 basic_auth { admin $2a$14$yZXju.olCFqnybbcXmOfyuA64uPlejIBQVNgd9e7epWJrnB/aT57K } # æŒ‡å®šè¯ä¹¦æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œç»å¯¹è·¯å¾„ä¸º/usr/local/caddy/sslï¼Œæ­¤å¤„ä½¿ç”¨Caddyfileæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ˆ/usr/local/caddyï¼‰çš„ç›¸å¯¹è·¯å¾„ tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key route { rewrite /webdav /webdav/ webdav /webdav/* { # è®¿é—®WebDAVæœåŠ¡çš„å‰ç¼€ prefix /webdav } # HTTPæ–‡ä»¶æœåŠ¡ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶ file_server browse } } EOF ","date":"2024-12-07T20:01:26+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c400fb39/","title":"Linux æ–‡ä»¶åˆ é™¤-æ³¨é‡Šå’Œç©ºè¡Œ"},{"content":"Linux ç«¯å£å ç”¨æŸ¥çœ‹æŒ‡å— ğŸ” ğŸ“– ç›®å½•å¯¼èˆª ğŸŒŸ ç®€ä»‹ ğŸ“¦ 1. å®‰è£…ç½‘ç»œå·¥å…· ğŸ“Š 2. æŸ¥çœ‹ç«¯å£å ç”¨çš„å¤šç§æ–¹æ³• ğŸ” 3. ç²¾ç¡®æŸ¥çœ‹ç«¯å£å ç”¨ ğŸ¯ 4. å®ç”¨ç¤ºä¾‹ ğŸ“‹ 5. è¾“å‡ºç»“æœè§£è¯» ğŸ’¡ 6. é«˜çº§æŠ€å·§ ğŸ› ï¸ 7. å®ç”¨è„šæœ¬ âš ï¸ 8. æ³¨æ„äº‹é¡¹ ğŸ”„ 9. æ•…éšœæ’é™¤ ğŸ“š 10. æ‰©å±•å­¦ä¹  ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†ä»‹ç»åœ¨ Linux ç³»ç»Ÿä¸­æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µçš„å¤šç§æ–¹æ³•ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè¯†åˆ«å’Œç®¡ç†ç½‘ç»œè¿æ¥ã€‚æ— è®ºæ˜¯æ’æŸ¥ç½‘ç»œé—®é¢˜ã€æ£€æŸ¥æœåŠ¡çŠ¶æ€è¿˜æ˜¯å®‰å…¨å®¡è®¡ï¼ŒæŒæ¡ç«¯å£æŸ¥çœ‹æŠ€å·§éƒ½æ˜¯ç³»ç»Ÿç®¡ç†å‘˜çš„å¿…å¤‡æŠ€èƒ½ã€‚\nğŸ“¦ 1. å®‰è£…ç½‘ç»œå·¥å…· å®‰è£… net-tools åŒ… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Debian/Ubuntu ç³»ç»Ÿ sudo apt update \u0026amp;\u0026amp; sudo apt install -y net-tools # CentOS/RHEL ç³»ç»Ÿ sudo yum install -y net-tools # æˆ–è€…ä½¿ç”¨æ›´ç°ä»£çš„æ›¿ä»£æ–¹æ¡ˆ sudo apt install -y iproute2 # å®‰è£… lsof å·¥å…· sudo apt install -y lsof # å®‰è£…ç½‘ç»œè¯Šæ–­å·¥å…·é›† sudo apt install -y net-tools iproute2 lsof nmap tcpdump éªŒè¯å·¥å…·å®‰è£… 1 2 3 4 5 # æ£€æŸ¥å·¥å…·æ˜¯å¦å®‰è£…æˆåŠŸ which netstat \u0026amp;\u0026amp; echo \u0026#34;netstat å·²å®‰è£…\u0026#34; || echo \u0026#34;netstat æœªå®‰è£…\u0026#34; which ss \u0026amp;\u0026amp; echo \u0026#34;ss å·²å®‰è£…\u0026#34; || echo \u0026#34;ss æœªå®‰è£…\u0026#34; which lsof \u0026amp;\u0026amp; echo \u0026#34;lsof å·²å®‰è£…\u0026#34; || echo \u0026#34;lsof æœªå®‰è£…\u0026#34; which nmap \u0026amp;\u0026amp; echo \u0026#34;nmap å·²å®‰è£…\u0026#34; || echo \u0026#34;nmap æœªå®‰è£…\u0026#34; ğŸ“Š 2. æŸ¥çœ‹ç«¯å£å ç”¨çš„å¤šç§æ–¹æ³• æ–¹æ³•ä¸€ï¼šä½¿ç”¨ netstat å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹æ‰€æœ‰ TCP å’Œ UDP ç«¯å£ç›‘å¬æƒ…å†µ sudo netstat -tulnp # ä»…æŸ¥çœ‹ TCP ç«¯å£ sudo netstat -tlnp # ä»…æŸ¥çœ‹ UDP ç«¯å£ sudo netstat -ulnp # æŸ¥çœ‹æ‰€æœ‰è¿æ¥ï¼ˆåŒ…æ‹¬å·²å»ºç«‹çš„ï¼‰ sudo netstat -anp # æŸ¥çœ‹ IPv4 è¿æ¥ sudo netstat -4 -tulnp # æŸ¥çœ‹ IPv6 è¿æ¥ sudo netstat -6 -tulnp å‚æ•°è¯´æ˜ï¼š\n-tï¼šTCP åè®® -uï¼šUDP åè®® -lï¼šä»…æ˜¾ç¤ºç›‘å¬ä¸­çš„ç«¯å£ -nï¼šä»¥æ•°å­—æ ¼å¼æ˜¾ç¤ºï¼ˆä¸è§£æä¸»æœºåå’ŒæœåŠ¡åï¼‰ -pï¼šæ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ -aï¼šæ˜¾ç¤ºæ‰€æœ‰è¿æ¥ï¼ˆç›‘å¬å’Œéç›‘å¬ï¼‰ -4ï¼šä»…æ˜¾ç¤º IPv4 è¿æ¥ -6ï¼šä»…æ˜¾ç¤º IPv6 è¿æ¥ æ–¹æ³•äºŒï¼šä½¿ç”¨ ss å‘½ä»¤ï¼ˆæ¨èï¼Œæ›´ç°ä»£ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æŸ¥çœ‹æ‰€æœ‰ç«¯å£ç›‘å¬æƒ…å†µ sudo ss -tulnp # æŸ¥çœ‹ TCP ç«¯å£ sudo ss -tlnp # æŸ¥çœ‹ UDP ç«¯å£ sudo ss -ulnp # æŸ¥çœ‹æ‰€æœ‰è¿æ¥ï¼ˆåŒ…æ‹¬å·²å»ºç«‹çš„ï¼‰ sudo ss -anp # æŸ¥çœ‹ IPv4 è¿æ¥ sudo ss -4 -tulnp # æŸ¥çœ‹ IPv6 è¿æ¥ sudo ss -6 -tulnp # æŸ¥çœ‹ç›‘å¬ç«¯å£å¹¶æŒ‰ç«¯å£å·æ’åº sudo ss -tulnp | sort -n -k 4 -t : æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ lsof å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œè¿æ¥ sudo lsof -i # æŸ¥çœ‹ç‰¹å®šç«¯å£ sudo lsof -i :8090 # æŸ¥çœ‹ TCP è¿æ¥ sudo lsof -i TCP # æŸ¥çœ‹ UDP è¿æ¥ sudo lsof -i UDP # æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„ç½‘ç»œè¿æ¥ sudo lsof -i -a -p \u0026lt;PID\u0026gt; # æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„ç½‘ç»œè¿æ¥ sudo lsof -i -u \u0026lt;username\u0026gt; æ–¹æ³•å››ï¼šä½¿ç”¨ nmap å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # æ‰«ææœ¬åœ°ä¸»æœºå¼€æ”¾ç«¯å£ sudo nmap -sS -O 127.0.0.1 # æ‰«æç‰¹å®šç«¯å£èŒƒå›´ sudo nmap -p 1-1000 127.0.0.1 # å¿«é€Ÿæ‰«æå¸¸ç”¨ç«¯å£ sudo nmap -F 127.0.0.1 # æ‰«æç‰¹å®šç«¯å£ sudo nmap -p 22,80,443,3306,8080,8090 127.0.0.1 ğŸ” 3. ç²¾ç¡®æŸ¥çœ‹ç«¯å£å ç”¨ æŸ¥çœ‹æ‰€æœ‰ç›‘å¬åœ¨ 0.0.0.0 çš„ç«¯å£ 1 2 3 4 5 6 7 8 # ä½¿ç”¨ netstat sudo netstat -tulnp | grep \u0026#34;0.0.0.0\u0026#34; # ä½¿ç”¨ ss å‘½ä»¤ sudo ss -tulnp | grep \u0026#34;0.0.0.0\u0026#34; # æŸ¥çœ‹ç›‘å¬åœ¨æ‰€æœ‰æ¥å£çš„ç«¯å£ sudo ss -tulnp | grep -E \u0026#34;0.0.0.0|\\*:\\*\u0026#34; ç²¾ç¡®æŸ¥çœ‹ 8090 ç«¯å£å ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨ netstat sudo netstat -tulnp | grep \u0026#34;:8090\u0026#34; # ä½¿ç”¨ ss å‘½ä»¤ sudo ss -tulnp | grep \u0026#34;:8090\u0026#34; # ä½¿ç”¨ lsof å‘½ä»¤ sudo lsof -i :8090 # ä½¿ç”¨ nmap å‘½ä»¤ sudo nmap -p 8090 127.0.0.1 æŸ¥çœ‹ç‰¹å®šåè®®çš„ç«¯å£ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ TCP 8090 ç«¯å£ sudo netstat -tlnp | grep \u0026#34;:8090\u0026#34; # æŸ¥çœ‹ UDP 8090 ç«¯å£ sudo netstat -ulnp | grep \u0026#34;:8090\u0026#34; # æŸ¥çœ‹ SCTP ç«¯å£ï¼ˆå¦‚æœæ”¯æŒï¼‰ sudo netstat -slnp 2\u0026gt;/dev/null | grep \u0026#34;:8090\u0026#34; || echo \u0026#34;SCTP å¯èƒ½ä¸æ”¯æŒ\u0026#34; ğŸ¯ 4. å®ç”¨ç¤ºä¾‹ ç¤ºä¾‹ 1ï¼šæŸ¥çœ‹æ‰€æœ‰ HTTP ç›¸å…³ç«¯å£ 1 2 3 4 5 # æŸ¥çœ‹å¸¸ç”¨ Web ç«¯å£ sudo netstat -tulnp | grep -E \u0026#34;:80|:443|:8080|:8090|:8000|:3000\u0026#34; # æˆ–è€…ä½¿ç”¨ ss å‘½ä»¤ sudo ss -tulnp | grep -E \u0026#34;:80|:443|:8080|:8090|:8000|:3000\u0026#34; ç¤ºä¾‹ 2ï¼šæŸ¥çœ‹æ•°æ®åº“ç«¯å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å¸¸ç”¨æ•°æ®åº“ç«¯å£ sudo netstat -tlnp | grep -E \u0026#34;:3306|:5432|:27017|:6379\u0026#34; # MySQL/MariaDB sudo netstat -tlnp | grep \u0026#34;:3306\u0026#34; # PostgreSQL sudo netstat -tlnp | grep \u0026#34;:5432\u0026#34; # MongoDB sudo netstat -tlnp | grep \u0026#34;:27017\u0026#34; # Redis sudo netstat -tlnp | grep \u0026#34;:6379\u0026#34; ç¤ºä¾‹ 3ï¼šæŸ¥çœ‹ SSH ç«¯å£ 1 2 3 4 sudo netstat -tlnp | grep \u0026#34;:22\u0026#34; # æˆ–è€…æŸ¥çœ‹ sshd è¿›ç¨‹ sudo ss -tlnp | grep sshd ç¤ºä¾‹ 4ï¼šæŒ‰è¿›ç¨‹åæŸ¥æ‰¾ç«¯å£ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥æ‰¾ nginx ä½¿ç”¨çš„ç«¯å£ sudo netstat -tulnp | grep nginx # æŸ¥æ‰¾ Apache ä½¿ç”¨çš„ç«¯å£ sudo netstat -tulnp | grep apache # ä½¿ç”¨ pgrep + lsof sudo lsof -i -P -n | grep $(pgrep nginx) # ä½¿ç”¨ ss æŒ‰è¿›ç¨‹åè¿‡æ»¤ sudo ss -tulnp | grep -E \u0026#34;(nginx|apache|httpd)\u0026#34; ğŸ“‹ 5. è¾“å‡ºç»“æœè§£è¯» å…¸å‹çš„ netstat -tulnp è¾“å‡ºç¤ºä¾‹ï¼š\n1 2 3 4 5 Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1234/sshd tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 5678/nginx tcp6 0 0 :::443 :::* LISTEN 5678/nginx udp 0 0 0.0.0.0:68 0.0.0.0:* 91011/dhclient å„å­—æ®µå«ä¹‰ï¼š\nProtoï¼šåè®®ç±»å‹ï¼ˆTCP/UDPï¼‰ Recv-Qï¼šæ¥æ”¶é˜Ÿåˆ—ä¸­çš„å­—èŠ‚æ•° Send-Qï¼šå‘é€é˜Ÿåˆ—ä¸­çš„å­—èŠ‚æ•° Local Addressï¼šæœ¬åœ°åœ°å€å’Œç«¯å£ Foreign Addressï¼šè¿œç¨‹åœ°å€å’Œç«¯å£ Stateï¼šè¿æ¥çŠ¶æ€ï¼ˆLISTEN, ESTABLISHED, TIME_WAIT ç­‰ï¼‰ PID/Program nameï¼šè¿›ç¨‹IDå’Œç¨‹åºåç§° å¸¸è§è¿æ¥çŠ¶æ€ï¼š\nLISTENï¼šç«¯å£æ­£åœ¨ç›‘å¬è¿æ¥ ESTABLISHEDï¼šå·²å»ºç«‹è¿æ¥ TIME_WAITï¼šè¿æ¥æ­£åœ¨å…³é—­ CLOSE_WAITï¼šè¿œç¨‹ç«¯å·²å…³é—­è¿æ¥ SYN_SENTï¼šæ­£åœ¨å°è¯•å»ºç«‹è¿æ¥ ğŸ’¡ 6. é«˜çº§æŠ€å·§ å®æ—¶ç›‘æ§ç«¯å£å˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # æ¯2ç§’åˆ·æ–°ä¸€æ¬¡ç«¯å£çŠ¶æ€ watch -n 2 \u0026#39;sudo netstat -tulnp | head -20\u0026#39; # å®æ—¶ç›‘æ§ç‰¹å®šç«¯å£ watch -n 1 \u0026#39;sudo netstat -tulnp | grep \u0026#34;:8090\u0026#34;\u0026#39; # ä½¿ç”¨ ss å‘½ä»¤å®æ—¶ç›‘æ§ watch -n 2 \u0026#39;sudo ss -tulnp\u0026#39; # ä½¿ç”¨é¡¶éƒ¨é£æ ¼çš„å®æ—¶ç›‘æ§ sudo apt install -y nethogs sudo nethogs æŸ¥çœ‹å»ºç«‹è¿æ¥çš„ç«¯å£ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ‰€æœ‰å·²å»ºç«‹çš„è¿æ¥ sudo netstat -tnp | grep ESTABLISHED # æŸ¥çœ‹è¿æ¥åˆ°ç‰¹å®šç«¯å£çš„å®¢æˆ·ç«¯ sudo netstat -tnp | grep :8090 | grep ESTABLISHED # æŸ¥çœ‹å¤–éƒ¨è¿æ¥åˆ°æœ¬æœºçš„è¿æ¥ sudo netstat -anp | grep ESTABLISHED | grep -v 127.0.0.1 # ç»Ÿè®¡è¿æ¥æ•° sudo netstat -an | grep ESTABLISHED | wc -l æŒ‰ç«¯å£å·æ’åºæŸ¥çœ‹ 1 2 3 4 5 6 7 8 # æŒ‰ç«¯å£å·æ’åº sudo netstat -tulnp | sort -n -k 4 -t : # ä½¿ç”¨ ss å‘½ä»¤å¹¶æŒ‰ç«¯å£æ’åº sudo ss -tulnp | sort -n -k 4 -t : # æŒ‰è¿›ç¨‹IDæ’åº sudo netstat -tulnp | sort -n -k 7 -t / æŸ¥çœ‹ç«¯å£ä½¿ç”¨ç»Ÿè®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ç«¯å£ä½¿ç”¨æ¦‚å†µ sudo netstat -s # æŸ¥çœ‹ TCP ç»Ÿè®¡ä¿¡æ¯ sudo netstat -st # æŸ¥çœ‹ UDP ç»Ÿè®¡ä¿¡æ¯ sudo netstat -su # æŸ¥çœ‹ç½‘ç»œæ¥å£ç»Ÿè®¡ sudo netstat -i # æŸ¥çœ‹è·¯ç”±è¡¨ sudo netstat -r ğŸ› ï¸ 7. å®ç”¨è„šæœ¬ åˆ›å»ºç«¯å£æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #!/bin/bash # port_check.sh # æ£€æŸ¥æ˜¯å¦æä¾›äº†ç«¯å£å‚æ•° if [ $# -eq 0 ]; then echo \u0026#34;ç”¨æ³•: $0 \u0026lt;ç«¯å£å·\u0026gt;\u0026#34; echo \u0026#34;ç¤ºä¾‹: $0 8090\u0026#34; exit 1 fi PORT=$1 echo \u0026#34;=== æ£€æŸ¥ç«¯å£ $PORT å ç”¨æƒ…å†µ ===\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;1. netstat ç»“æœ:\u0026#34; sudo netstat -tulnp | grep \u0026#34;:$PORT\u0026#34; || echo \u0026#34;æœªæ‰¾åˆ°ç›¸å…³è¿›ç¨‹\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;2. ss å‘½ä»¤ç»“æœ:\u0026#34; sudo ss -tulnp | grep \u0026#34;:$PORT\u0026#34; || echo \u0026#34;æœªæ‰¾åˆ°ç›¸å…³è¿›ç¨‹\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;3. lsof ç»“æœ:\u0026#34; sudo lsof -i :$PORT || echo \u0026#34;æœªæ‰¾åˆ°ç›¸å…³è¿›ç¨‹\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;4. nmap æ‰«æç»“æœ:\u0026#34; sudo nmap -p $PORT 127.0.0.1 | grep \u0026#34;$PORT/\u0026#34; || echo \u0026#34;ç«¯å£æœªå¼€æ”¾\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;5. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™:\u0026#34; # æ£€æŸ¥ iptables sudo iptables -L -n | grep \u0026#34;dpt:$PORT\u0026#34; || echo \u0026#34;æ— ç›¸å…³ iptables è§„åˆ™\u0026#34; # æ£€æŸ¥ ufw sudo ufw status | grep \u0026#34;$PORT\u0026#34; || echo \u0026#34;æ— ç›¸å…³ ufw è§„åˆ™\u0026#34; ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 chmod +x port_check.sh sudo ./port_check.sh 8090 ç«¯å£æ‰«æè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/bin/bash # port_scan.sh # å®šä¹‰è¦æ‰«æçš„ç«¯å£èŒƒå›´ PORTS=\u0026#34;22 80 443 3306 5432 6379 27017 8080 8090 9000\u0026#34; echo \u0026#34;å¼€å§‹æ‰«æå¸¸ç”¨ç«¯å£...\u0026#34; echo \u0026#34;\u0026#34; for port in $PORTS; do result=$(sudo netstat -tulnp 2\u0026gt;/dev/null | grep \u0026#34;:$port \u0026#34; || echo \u0026#34;å…³é—­\u0026#34;) if [[ $result != \u0026#34;å…³é—­\u0026#34; ]]; then echo \u0026#34;ç«¯å£ $port: å¼€æ”¾ - $result\u0026#34; else echo \u0026#34;ç«¯å£ $port: å…³é—­\u0026#34; fi done echo \u0026#34;\u0026#34; echo \u0026#34;æ‰«æå®Œæˆ!\u0026#34; ç½‘ç»œè¿æ¥ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/bin/bash # network_monitor.sh echo \u0026#34;å¼€å§‹ç½‘ç»œè¿æ¥ç›‘æ§ï¼ŒæŒ‰ Ctrl+C åœæ­¢...\u0026#34; echo \u0026#34;\u0026#34; # è®¾ç½®åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ INTERVAL=2 while true; do clear echo \u0026#34;=== ç½‘ç»œè¿æ¥ç›‘æ§ - $(date) ===\u0026#34; echo \u0026#34;\u0026#34; # æ˜¾ç¤ºç›‘å¬ç«¯å£ echo \u0026#34;ç›‘å¬ä¸­çš„ç«¯å£:\u0026#34; sudo netstat -tulnp | grep LISTEN | head -10 echo \u0026#34;\u0026#34; echo \u0026#34;å»ºç«‹çš„è¿æ¥:\u0026#34; sudo netstat -tnp | grep ESTABLISHED | head -10 echo \u0026#34;\u0026#34; echo \u0026#34;æŒ‰ Ctrl+C åœæ­¢ç›‘æ§\u0026#34; sleep $INTERVAL done âš ï¸ 8. æ³¨æ„äº‹é¡¹ æƒé™è¦æ±‚ï¼šæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯éœ€è¦ root æƒé™\n1 2 3 4 # ä½¿ç”¨ sudo è·å–æƒé™ sudo netstat -tulnp sudo ss -tulnp sudo lsof -i IPv6 åœ°å€ï¼šæ³¨æ„ :: è¡¨ç¤º IPv6 çš„æ‰€æœ‰åœ°å€ï¼Œç›¸å½“äº IPv4 çš„ 0.0.0.0\nç«¯å£çŠ¶æ€ï¼š\nLISTENï¼šç«¯å£æ­£åœ¨ç›‘å¬è¿æ¥ ESTABLISHEDï¼šå·²å»ºç«‹è¿æ¥ TIME_WAITï¼šè¿æ¥æ­£åœ¨å…³é—­ CLOSE_WAITï¼šè¿œç¨‹ç«¯å·²å…³é—­è¿æ¥ å·¥å…·é€‰æ‹©ï¼š\nnetstatï¼šä¼ ç»Ÿå·¥å…·ï¼ŒåŠŸèƒ½å…¨é¢ ssï¼šæ›´å¿«é€Ÿï¼Œæ¨èä½¿ç”¨ lsofï¼šåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ä»¶å’Œå…¶ä»–èµ„æº nmapï¼šä¸“ä¸šçš„ç«¯å£æ‰«æå·¥å…· å®‰å…¨è€ƒè™‘ï¼š\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨ç«¯å£æ‰«æ æ³¨æ„ä¸è¦è¿åç»„ç»‡çš„å®‰å…¨æ”¿ç­– æ•æ„Ÿç«¯å£çš„æ‰«æå¯èƒ½éœ€è¦é¢å¤–æˆæƒ ğŸ”„ 9. æ•…éšœæ’é™¤ å¦‚æœå‘½ä»¤ä¸å­˜åœ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æ£€æŸ¥ net-tools æ˜¯å¦å®‰è£… which netstat || echo \u0026#34;netstat æœªå®‰è£…\u0026#34; # å®‰è£…å¿…è¦çš„å·¥å…·åŒ… if ! command -v netstat \u0026amp;\u0026gt; /dev/null; then echo \u0026#34;å®‰è£… net-tools...\u0026#34; sudo apt update \u0026amp;\u0026amp; sudo apt install -y net-tools fi if ! command -v ss \u0026amp;\u0026gt; /dev/null; then echo \u0026#34;å®‰è£… iproute2...\u0026#34; sudo apt update \u0026amp;\u0026amp; sudo apt install -y iproute2 fi if ! command -v lsof \u0026amp;\u0026gt; /dev/null; then echo \u0026#34;å®‰è£… lsof...\u0026#34; sudo apt update \u0026amp;\u0026amp; sudo apt install -y lsof fi å¦‚æœçœ‹ä¸åˆ°è¿›ç¨‹ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨ sudo è·å–å®Œæ•´æƒé™ sudo netstat -tulnp sudo ss -tulnp sudo lsof -i # æ£€æŸ¥æƒé™é—®é¢˜ ls -l /proc/$(pgrep sshd)/exe # ç¤ºä¾‹ï¼šæ£€æŸ¥ sshd è¿›ç¨‹æƒé™ # æ£€æŸ¥ AppArmor/SELinux é™åˆ¶ sudo aa-status # AppArmor sudo sestatus # SELinux å¦‚æœç«¯å£æ˜¾ç¤ºä½†æœåŠ¡ä¸å¯ç”¨ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ sudo iptables -L -n | grep \u0026lt;ç«¯å£å·\u0026gt; # æ£€æŸ¥æœåŠ¡æ˜¯å¦çœŸæ­£ç›‘å¬ sudo lsof -i :\u0026lt;ç«¯å£å·\u0026gt; # å°è¯•æœ¬åœ°è¿æ¥ telnet 127.0.0.1 \u0026lt;ç«¯å£å·\u0026gt; # æˆ–è€…ä½¿ç”¨ netcat nc -zv 127.0.0.1 \u0026lt;ç«¯å£å·\u0026gt; ğŸ“š 10. æ‰©å±•å­¦ä¹  æŸ¥çœ‹ç«¯å£å¯¹åº”çš„æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ /etc/services ä¸­çš„ç«¯å£å®šä¹‰ grep \u0026#34;8090\u0026#34; /etc/services # æˆ–è€…ä½¿ç”¨ getent getent services 8090 # æŸ¥çœ‹æ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡ç«¯å£ less /etc/services # æœç´¢ç‰¹å®šæœåŠ¡ grep -i \u0026#34;http\u0026#34; /etc/services æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ iptables è§„åˆ™ sudo iptables -L -n -v # æŸ¥çœ‹ NAT è§„åˆ™ sudo iptables -t nat -L -n -v # æŸ¥çœ‹ ufw çŠ¶æ€ sudo ufw status verbose # æŸ¥çœ‹ firewalld sudo firewall-cmd --list-all # æŸ¥çœ‹ç«¯å£è½¬å‘è§„åˆ™ sudo iptables -t nat -L PREROUTING -n -v ç½‘ç»œè¯Šæ–­å·¥å…· 1 2 3 4 5 6 7 8 9 10 # å®‰è£…é¢å¤–ç½‘ç»œå·¥å…· sudo apt install -y \\ netcat-openbsd \\ # netcat å·¥å…· traceroute \\ # è·¯ç”±è·Ÿè¸ª mtr \\ # é«˜çº§è·¯ç”±è·Ÿè¸ª tcpdump \\ # ç½‘ç»œæŠ“åŒ… wireshark \\ # å›¾å½¢åŒ–æŠ“åŒ…å·¥å…· iftop \\ # å¸¦å®½ç›‘æ§ nload \\ # ç½‘ç»œè´Ÿè½½ç›‘æ§ bmon # å¸¦å®½ç›‘æ§å’Œé€Ÿç‡ä¼°è®¡ ç½‘ç»œæ€§èƒ½æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 # å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…· sudo apt install -y \\ iperf3 \\ # ç½‘ç»œæ€§èƒ½æµ‹è¯• speedtest-cli \\ # ç½‘é€Ÿæµ‹è¯• netperf \\ # ç½‘ç»œæ€§èƒ½æµ‹è¯• sockperf # å¥—æ¥å­—æ€§èƒ½æµ‹è¯• # ä½¿ç”¨ iperf3 æµ‹è¯•å¸¦å®½ # æœåŠ¡å™¨ç«¯: iperf3 -s # å®¢æˆ·ç«¯: iperf3 -c \u0026lt;æœåŠ¡å™¨IP\u0026gt; ğŸš€ é€šè¿‡æŒæ¡è¿™äº›ç«¯å£æŸ¥çœ‹æŠ€å·§ï¼Œæ‚¨å°†èƒ½å¤Ÿå¿«é€Ÿè¯Šæ–­ç½‘ç»œé—®é¢˜ã€æ’æŸ¥ç«¯å£å†²çªï¼Œå¹¶æ›´å¥½åœ°ç®¡ç†æ‚¨çš„ Linux ç³»ç»ŸæœåŠ¡ï¼æ— è®ºæ˜¯å¼€å‘è°ƒè¯•è¿˜æ˜¯ç³»ç»Ÿç»´æŠ¤ï¼Œè¿™äº›æŠ€èƒ½éƒ½å°†å¤§å¤§æé«˜æ‚¨çš„å·¥ä½œæ•ˆç‡ã€‚\n","date":"2024-12-07T20:00:22+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4ea2cbfe/","title":"Linux ç«¯å£å ç”¨æŸ¥çœ‹æŒ‡å— ğŸ”"},{"content":"Nginx ç½‘ç«™ç»´æŠ¤é¡µé…ç½®å®Œå…¨æŒ‡å— ğŸ› ï¸ ğŸ“– ç›®å½•å¯¼èˆª âœ¨ ç»´æŠ¤é¡µåŠŸèƒ½ç®€ä»‹ ğŸš€ ä¸€ã€åˆ›å»ºç»´æŠ¤é¡µé¢ç›®å½•å’Œæ–‡ä»¶ âš™ï¸ äºŒã€é…ç½® Nginx é”™è¯¯é¡µé¢ ğŸ¨ ä¸‰ã€é«˜çº§ç»´æŠ¤é¡µé¢é…ç½® ğŸ”§ å››ã€Nginx ç»´æŠ¤å‘½ä»¤ ğŸ›¡ï¸ äº”ã€å®‰å…¨åŠ å›ºé…ç½® ğŸ“Š æ€»ç»“ âœ¨ ç»´æŠ¤é¡µåŠŸèƒ½ç®€ä»‹ ç½‘ç«™ç»´æŠ¤é¡µé¢æ˜¯åœ¨æœåŠ¡å™¨ç»´æŠ¤ã€å‡çº§æˆ–å‡ºç°æ•…éšœæ—¶å‘ç”¨æˆ·å±•ç¤ºçš„å‹å¥½ç•Œé¢ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸš§ å‹å¥½æç¤ºï¼šå‘ŠçŸ¥ç”¨æˆ·ç½‘ç«™æ­£åœ¨ç»´æŠ¤ä¸­ï¼Œæå‡ç”¨æˆ·ä½“éªŒ â° é¢„è®¡æ—¶é—´ï¼šæä¾›ç»´æŠ¤å®Œæˆçš„å¤§è‡´æ—¶é—´ï¼Œç®¡ç†ç”¨æˆ·é¢„æœŸ ğŸ“ è”ç³»æ–¹å¼ï¼šæä¾›æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼ï¼Œæ–¹ä¾¿ç”¨æˆ·å’¨è¯¢ ğŸ¨ å“ç‰Œå±•ç¤ºï¼šä¿æŒå“ç‰Œä¸€è‡´æ€§ï¼Œå³ä½¿åœ¨ç»´æŠ¤æœŸé—´ ğŸ”§ å¿«é€Ÿéƒ¨ç½²ï¼šç®€å•é…ç½®å³å¯å¯ç”¨ï¼Œæ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç  ğŸ“± å“åº”å¼è®¾è®¡ï¼šé€‚é…å„ç§è®¾å¤‡å±å¹•å°ºå¯¸ ğŸŒ å¤šè¯­è¨€æ”¯æŒï¼šæ”¯æŒå¤šç§è¯­è¨€ï¼Œæ»¡è¶³å›½é™…åŒ–éœ€æ±‚ ğŸš€ ä¸€ã€åˆ›å»ºç»´æŠ¤é¡µé¢ç›®å½•å’Œæ–‡ä»¶ 1ï¸âƒ£ åˆ›å»º HTML ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºç½‘ç«™æ ¹ç›®å½• sudo mkdir -p /var/www/html # åˆ›å»ºé”™è¯¯é¡µé¢ç›®å½• sudo mkdir -p /var/www/html/errors # è®¾ç½®ç›®å½•æƒé™ sudo chown -R www-data:www-data /var/www/html sudo chmod -R 755 /var/www/html # åˆ›å»ºæ—¥å¿—ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ sudo mkdir -p /var/log/nginx sudo chown -R www-data:www-data /var/log/nginx 2ï¸âƒ£ åˆ›å»ºæ ‡å‡†é”™è¯¯é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 # åˆ›å»º 40x é”™è¯¯é¡µé¢ (å®¢æˆ·ç«¯é”™è¯¯) sudo tee /var/www/html/40x.html \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;400 Bad Request - è¯·æ±‚é”™è¯¯\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: \u0026#39;Segoe UI\u0026#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100vh; display: flex; justify-content: center; align-items: center; color: white; text-align: center; margin: 0; padding: 20px; } .container { background: rgba(255, 255, 255, 0.1); padding: 3rem; border-radius: 15px; backdrop-filter: blur(10px); max-width: 600px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); } h1 { font-size: 4rem; margin: 0; color: #ff6b6b; } h2 { margin-top: 0; font-weight: 300; } p { line-height: 1.6; margin-bottom: 2rem; } .btn { display: inline-block; padding: 12px 24px; background: #4ecdc4; color: white; text-decoration: none; border-radius: 25px; transition: all 0.3s ease; margin: 0 10px 10px 0; } .btn:hover { background: #45b7aa; transform: translateY(-2px); } @media (max-width: 600px) { .container { padding: 2rem; } h1 { font-size: 3rem; } .btn { display: block; margin: 10px 0; } } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;400\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;ç³Ÿç³•ï¼è¯·æ±‚é”™è¯¯\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æœåŠ¡å™¨æ— æ³•ç†è§£æ‚¨çš„è¯·æ±‚ï¼Œå¯èƒ½æ˜¯è¯­æ³•æ ¼å¼ä¸æ­£ç¡®ã€‚\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;è¯·æ£€æŸ¥æ‚¨çš„è¾“å…¥æˆ–ç¨åå†è¯•ã€‚\u0026lt;/p\u0026gt; \u0026lt;a href=\u0026#34;/\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;è¿”å›é¦–é¡µ\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;mailto:support@example.com\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;è”ç³»æ”¯æŒ\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;javascript:location.reload()\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;åˆ·æ–°é¡µé¢\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF # åˆ›å»º 50x é”™è¯¯é¡µé¢ (æœåŠ¡å™¨é”™è¯¯) sudo tee /var/www/html/50x.html \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;503 Service Unavailable - æœåŠ¡ç»´æŠ¤ä¸­\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: \u0026#39;Segoe UI\u0026#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); height: 100vh; display: flex; justify-content: center; align-items: center; color: white; text-align: center; margin: 0; padding: 20px; } .container { background: rgba(255, 255, 255, 0.1); padding: 3rem; border-radius: 15px; backdrop-filter: blur(10px); max-width: 600px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); } h1 { font-size: 4rem; margin: 0; color: #ffeaa7; } h2 { margin-top: 0; font-weight: 300; } p { line-height: 1.6; margin-bottom: 2rem; } .progress { background: rgba(255, 255, 255, 0.2); height: 10px; border-radius: 5px; overflow: hidden; margin: 2rem 0; } .progress-bar { height: 100%; width: 75%; background: #74b9ff; border-radius: 5px; animation: progress 2s ease-in-out infinite; } @keyframes progress { 0% { width: 75%; } 50% { width: 85%; } 100% { width: 75%; } } .btn { display: inline-block; padding: 12px 24px; background: #6c5ce7; color: white; text-decoration: none; border-radius: 25px; transition: all 0.3s ease; margin: 0 10px 10px 0; } .btn:hover { background: #5c4bc0; transform: translateY(-2px); } @media (max-width: 600px) { .container { padding: 2rem; } h1 { font-size: 3rem; } .btn { display: block; margin: 10px 0; } } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;503\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;ç½‘ç«™ç»´æŠ¤ä¸­\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æˆ‘ä»¬æ­£åœ¨å¯¹ç½‘ç«™è¿›è¡Œç»´æŠ¤å‡çº§ï¼Œä»¥æä¾›æ›´å¥½çš„æœåŠ¡ä½“éªŒã€‚\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;progress\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;progress-bar\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p\u0026gt;é¢„è®¡å®Œæˆæ—¶é—´: ä»Šå¤© 18:00\u0026lt;/p\u0026gt; \u0026lt;a href=\u0026#34;javascript:location.reload()\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;åˆ·æ–°é¡µé¢\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;mailto:support@example.com\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;è”ç³»æ”¯æŒ\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;/status\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;æŸ¥çœ‹çŠ¶æ€é¡µ\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF âš™ï¸ äºŒã€é…ç½® Nginx é”™è¯¯é¡µé¢ 1ï¸âƒ£ è¿…é›·æœåŠ¡åå‘ä»£ç†é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 # åˆ›å»ºè¿…é›·æœåŠ¡é…ç½®æ–‡ä»¶ sudo tee /etc/nginx/conf.d/xunlei.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { # ç›‘å¬ 5553 ç«¯å£å¹¶å¯ç”¨ SSL listen 5553 ssl http2; listen [::]:5553 ssl http2; # æœåŠ¡å™¨åç§° server_name xunlei.mobufan.eu.org; # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; # SSL åè®®é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384; # SSL ä¼šè¯è®¾ç½® ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_session_tickets off; # å­—ç¬¦ç¼–ç è®¾ç½® charset utf-8; # æ ¹ç›®å½•è®¾ç½® root /var/www/html; # å¯ç”¨ç›®å½•åˆ—è¡¨æ˜¾ç¤º autoindex off; # è®¿é—®æ—¥å¿—è®¾ç½® access_log /var/log/nginx/xunlei.access.log; error_log /var/log/nginx/xunlei.error.log; # åå‘ä»£ç†é…ç½® location / { # åå‘ä»£ç†åˆ°è¿…é›·æœåŠ¡ proxy_pass http://10.10.10.245:2345; # ä»£ç†å¤´è®¾ç½® proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 30s; proxy_send_timeout 30s; proxy_read_timeout 30s; # ç¼“å†²åŒºè®¾ç½® proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 16k; proxy_busy_buffers_size 24k; # ç¦ç”¨ä»£ç†ç¼“å­˜ proxy_cache off; # å¯ç”¨ Websocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µé¢é…ç½® error_page 400 401 402 403 404 /40x.html; error_page 500 502 503 504 /50x.html; # 40x é”™è¯¯é¡µé¢ä½ç½® location = /40x.html { root /var/www/html; internal; access_log off; log_not_found off; } # 50x é”™è¯¯é¡µé¢ä½ç½® location = /50x.html { root /var/www/html; internal; access_log off; log_not_found off; } # å¥åº·æ£€æŸ¥ç«¯ç‚¹ location /nginx-health { access_log off; return 200 \u0026#34;healthy\\n\u0026#34;; add_header Content-Type text/plain; } # å®‰å…¨å¤´è®¾ç½® add_header X-Frame-Options DENY always; add_header X-Content-Type-Options nosniff always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # ç¦ç”¨éšè—æ–‡ä»¶è®¿é—® location ~ /\\. { deny all; access_log off; log_not_found off; } # é™åˆ¶è®¿é—®æ•æ„Ÿæ–‡ä»¶ location ~* (\\.env|composer\\.json|composer\\.lock|package\\.json|package-lock\\.json|\\.git|\\.svn|\\.htaccess) { deny all; access_log off; log_not_found off; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ { expires 30d; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; add_header Access-Control-Allow-Origin \u0026#34;*\u0026#34;; access_log off; log_not_found off; } } EOF 2ï¸âƒ£ é‡å¯ Nginx æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo nginx -t # é‡å¯ Nginx æœåŠ¡ sudo systemctl restart nginx # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status nginx # æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼‰ sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log ğŸ¨ ä¸‰ã€é«˜çº§ç»´æŠ¤é¡µé¢é…ç½® 1ï¸âƒ£ å¤šè¯­è¨€ç»´æŠ¤é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 # åˆ›å»ºè‹±æ–‡ç»´æŠ¤é¡µé¢ sudo tee /var/www/html/maintenance-en.html \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Maintenance Mode\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: \u0026#39;Segoe UI\u0026#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100vh; display: flex; justify-content: center; align-items: center; color: white; text-align: center; margin: 0; padding: 20px; } .container { background: rgba(255, 255, 255, 0.1); padding: 3rem; border-radius: 15px; backdrop-filter: blur(10px); max-width: 600px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); } h1 { font-size: 4rem; margin: 0; color: #ff6b6b; } p { line-height: 1.6; margin-bottom: 2rem; } .btn { display: inline-block; padding: 12px 24px; background: #4ecdc4; color: white; text-decoration: none; border-radius: 25px; transition: all 0.3s ease; margin: 0 10px 10px 0; } .btn:hover { background: #45b7aa; transform: translateY(-2px); } @media (max-width: 600px) { .container { padding: 2rem; } h1 { font-size: 3rem; } .btn { display: block; margin: 10px 0; } } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;503\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;We\u0026#39;re currently performing maintenance. Please check back later.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;Estimated completion time: Today 18:00 (UTC+8)\u0026lt;/p\u0026gt; \u0026lt;a href=\u0026#34;javascript:location.reload()\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;Refresh Page\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;mailto:support@example.com\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;Contact Support\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;/status\u0026#34; class=\u0026#34;btn\u0026#34;\u0026gt;Status Page\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF 2ï¸âƒ£ å®šæ—¶ç»´æŠ¤é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 # åˆ›å»ºç»´æŠ¤æ¨¡å¼å¼€å…³è„šæœ¬ sudo tee /usr/local/bin/maintenance-mode.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # ç»´æŠ¤æ¨¡å¼å¼€å…³è„šæœ¬ MAINTENANCE_CONF=\u0026#34;/etc/nginx/snippets/maintenance.conf\u0026#34; MAINTENANCE_FLAG=\u0026#34;/tmp/nginx-maintenance.flag\u0026#34; case \u0026#34;$1\u0026#34; in on) echo \u0026#34;Enabling maintenance mode...\u0026#34; # åˆ›å»ºç»´æŠ¤æ¨¡å¼é…ç½® sudo tee $MAINTENANCE_CONF \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;MAINT\u0026#39; # ç»´æŠ¤æ¨¡å¼é…ç½® error_page 503 @maintenance; location @maintenance { rewrite ^(.*)$ /50x.html break; } # è¿”å›503çŠ¶æ€ç  return 503; MAINT touch $MAINTENANCE_FLAG sudo systemctl reload nginx echo \u0026#34;Maintenance mode enabled\u0026#34; ;; off) echo \u0026#34;Disabling maintenance mode...\u0026#34; rm -f $MAINTENANCE_CONF $MAINTENANCE_FLAG sudo systemctl reload nginx echo \u0026#34;Maintenance mode disabled\u0026#34; ;; status) if [ -f $MAINTENANCE_FLAG ]; then echo \u0026#34;Maintenance mode is ON\u0026#34; else echo \u0026#34;Maintenance mode is OFF\u0026#34; fi ;; *) echo \u0026#34;Usage: $0 {on|off|status}\u0026#34; exit 1 ;; esac EOF # è®¾ç½®è„šæœ¬æƒé™ sudo chmod +x /usr/local/bin/maintenance-mode.sh # åˆ›å»º snippets ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ sudo mkdir -p /etc/nginx/snippets # æµ‹è¯•ç»´æŠ¤æ¨¡å¼è„šæœ¬ sudo /usr/local/bin/maintenance-mode.sh status 3ï¸âƒ£ åŸºäº IP çš„ç»´æŠ¤æ¨¡å¼ä¾‹å¤– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºåŸºäº IP çš„ç»´æŠ¤æ¨¡å¼ä¾‹å¤–é…ç½® sudo tee /etc/nginx/snippets/maintenance-whitelist.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # å…è®¸ç‰¹å®š IP è®¿é—®ï¼ˆç®¡ç†å‘˜å’Œæµ‹è¯•äººå‘˜ï¼‰ geo $maintenance_whitelist { default 0; # æ·»åŠ å…è®¸è®¿é—®çš„ IP åœ°å€ 192.168.1.100 1; # ç®¡ç†å‘˜ IP 10.0.0.50 1; # æµ‹è¯•ç¯å¢ƒ IP # æ›´å¤š IP... } # æ ¹æ® IP ç™½åå•å†³å®šæ˜¯å¦æ˜¾ç¤ºç»´æŠ¤é¡µé¢ map $maintenance_whitelist $maintenance_pass { 0 $maintenance_mode; # éç™½åå•IPå—ç»´æŠ¤æ¨¡å¼å½±å“ 1 0; # ç™½åå•IPä¸å—å½±å“ } EOF ğŸ”§ å››ã€Nginx ç»´æŠ¤å‘½ä»¤ 1ï¸âƒ£ å¸¸ç”¨ç»´æŠ¤å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æ£€æŸ¥ Nginx é…ç½®è¯­æ³• sudo nginx -t # é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ sudo systemctl reload nginx # å®Œå…¨é‡å¯ Nginx sudo systemctl restart nginx # æŸ¥çœ‹ Nginx çŠ¶æ€ sudo systemctl status nginx # æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log # æŸ¥çœ‹ Nginx è¿›ç¨‹ ps aux | grep nginx # æ£€æŸ¥ç«¯å£ç›‘å¬ sudo netstat -tulnp | grep nginx 2ï¸âƒ£ æ€§èƒ½ç›‘æ§å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®æ—¶ç›‘æ§ Nginx è®¿é—®æ—¥å¿— sudo tail -f /var/log/nginx/access.log | awk \u0026#39;{print $1, $4, $7, $9}\u0026#39; # ç›‘æ§é”™è¯¯æ—¥å¿— sudo tail -f /var/log/nginx/error.log # æŸ¥çœ‹è¿æ¥çŠ¶æ€ sudo netstat -an | grep :5553 | awk \u0026#39;{print $6}\u0026#39; | sort | uniq -c # ä½¿ç”¨ ngxtop ç›‘æ§ï¼ˆéœ€è¦å®‰è£…ï¼‰ sudo ngxtop # æ£€æŸ¥ Nginx é…ç½®åŒ…å« sudo nginx -T # æŸ¥çœ‹å·¥ä½œè¿›ç¨‹çŠ¶æ€ sudo systemctl status nginx --no-pager -l ğŸ›¡ï¸ äº”ã€å®‰å…¨åŠ å›ºé…ç½® 1ï¸âƒ£ å¢å¼ºå®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # åˆ›å»ºå®‰å…¨é…ç½®æ–‡ä»¶ sudo tee /etc/nginx/snippets/security.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # å®‰å…¨å¤´è®¾ç½® add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; add_header X-Frame-Options DENY always; add_header X-Content-Type-Options nosniff always; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34; always; add_header Referrer-Policy \u0026#34;strict-origin\u0026#34; always; add_header Permissions-Policy \u0026#34;geolocation=(), microphone=(), camera=()\u0026#34; always; # éšè— Nginx ç‰ˆæœ¬å· server_tokens off; # é™åˆ¶è¯·æ±‚æ–¹æ³• if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 405; } # é™åˆ¶è¯·æ±‚å¤§å° client_max_body_size 10m; client_body_buffer_size 128k; # é™åˆ¶è¶…æ—¶æ—¶é—´ client_body_timeout 30s; client_header_timeout 30s; keepalive_timeout 65s; send_timeout 30s; # é™åˆ¶è¿æ¥é€Ÿç‡ limit_conn_zone $binary_remote_addr zone=addr:10m; limit_conn addr 10; # é™åˆ¶è¯·æ±‚é€Ÿç‡ limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s; limit_req zone=one burst=20 nodelay; EOF 2ï¸âƒ£ é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¯ç”¨ UFW é˜²ç«å¢™ sudo ufw enable # å¼€æ”¾å¿…è¦ç«¯å£ sudo ufw allow 22/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 443/tcp # HTTPS sudo ufw allow 5553/tcp # è¿…é›·æœåŠ¡ # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ sudo ufw status verbose # æ‹’ç»æ‰€æœ‰å…¶ä»–å…¥ç«™è¿æ¥ sudo ufw default deny incoming # å…è®¸æ‰€æœ‰å‡ºç«™è¿æ¥ sudo ufw default allow outgoing # é™åˆ¶æš´åŠ›ç ´è§£æ”»å‡» sudo ufw limit ssh 3ï¸âƒ£ SSL å®‰å…¨å¼ºåŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # åˆ›å»º SSL ä¼˜åŒ–é…ç½® sudo tee /etc/nginx/snippets/ssl-params.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # SSL å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384; ssl_ecdh_curve secp384r1; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_session_tickets off; ssl_stapling on; ssl_stapling_verify on; resolver 8.8.8.8 8.8.4.4 valid=300s; resolver_timeout 5s; add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubDomains; preload\u0026#34;; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; EOF ğŸ“Š æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²ç»æˆåŠŸé…ç½®äº† Nginx ç½‘ç«™ç»´æŠ¤é¡µé¢å’Œç›¸å…³è®¾ç½®ï¼š\nâœ… åˆ›å»ºç»´æŠ¤é¡µé¢ï¼šè®¾è®¡äº†ç¾è§‚çš„ 40x å’Œ 50x é”™è¯¯é¡µé¢ï¼Œæ”¯æŒå“åº”å¼è®¾è®¡ âœ… é…ç½® Nginxï¼šè®¾ç½®äº†åå‘ä»£ç†å’Œé”™è¯¯é¡µé¢é‡å®šå‘ï¼ŒåŒ…æ‹¬å¥åº·æ£€æŸ¥ç«¯ç‚¹ âœ… é«˜çº§åŠŸèƒ½ï¼šå®ç°äº†å¤šè¯­è¨€æ”¯æŒå’ŒåŸºäº IP çš„ç»´æŠ¤æ¨¡å¼ä¾‹å¤– âœ… å®‰å…¨åŠ å›ºï¼šå¢å¼ºäº†æœåŠ¡å™¨çš„å®‰å…¨æ€§é…ç½®ï¼ŒåŒ…æ‹¬ SSL å¼ºåŒ–å’Œå®‰å…¨å¤´è®¾ç½® âœ… ç»´æŠ¤å·¥å…·ï¼šåˆ›å»ºäº†ç»´æŠ¤æ¨¡å¼ç®¡ç†è„šæœ¬å’Œç›‘æ§å‘½ä»¤ âœ… é˜²ç«å¢™é…ç½®ï¼šè®¾ç½®äº†é€‚å½“çš„é˜²ç«å¢™è§„åˆ™ä¿æŠ¤æœåŠ¡å™¨ ç°åœ¨ä½ çš„ç½‘ç«™åœ¨ç»´æŠ¤æˆ–å‡ºç°é”™è¯¯æ—¶èƒ½å¤Ÿå‘ç”¨æˆ·å±•ç¤ºå‹å¥½çš„ç•Œé¢ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼ğŸ‰\nğŸ’¡ æç¤ºï¼š\nå®šæœŸæµ‹è¯•ç»´æŠ¤é¡µé¢ç¡®ä¿å…¶æ­£å¸¸å·¥ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œé‡å¤§æ›´æ–°ä¹‹å‰ è€ƒè™‘ä¸ºä¸åŒçš„æœåŠ¡åˆ›å»ºç‰¹å®šçš„ç»´æŠ¤é¡µé¢ï¼Œæä¾›æ›´ç²¾ç¡®çš„çŠ¶æ€ä¿¡æ¯ ä½¿ç”¨ç›‘æ§å·¥å…·å®šæœŸæ£€æŸ¥æœåŠ¡å™¨æ€§èƒ½å’Œå®‰å…¨æ€§ å®šæœŸæ›´æ–° SSL è¯ä¹¦å’Œå®‰å…¨é…ç½®ä»¥ä¿æŒæœ€ä½³å®‰å…¨æ€§ ","date":"2024-12-07T19:59:41+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/7c9205e3/","title":"Nginx ç½‘ç«™ç»´æŠ¤é¡µé…ç½®æŒ‡å— ğŸ› ï¸"},{"content":"Caddy éƒ¨ç½²æ–‡ä»¶æœåŠ¡å™¨ ğŸ“‚ ğŸ“– ç›®å½•å¯¼èˆª ğŸŒŸ ç®€ä»‹ ğŸ”§ ä¸€ã€Debian/Ubuntu å®‰è£… Caddy ğŸš€ äºŒã€Debian éƒ¨ç½²æ–‡ä»¶ä¸‹è½½æœåŠ¡ ğŸ“¥ ä¸‰ã€æ–‡ä»¶ä¸‹è½½å‘½ä»¤ âš–ï¸ å››ã€è´Ÿè½½å‡è¡¡é…ç½® ğŸ”’ äº”ã€å®‰å…¨åŠ å›º ğŸ› å…­ã€æ•…éšœæ’é™¤ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ Caddy æœåŠ¡å™¨éƒ¨ç½²é«˜æ€§èƒ½çš„æ–‡ä»¶ä¸‹è½½æœåŠ¡ï¼Œå¹¶é…ç½®è´Ÿè½½å‡è¡¡ã€‚Caddy æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ web æœåŠ¡å™¨ï¼Œä»¥å…¶ç®€å•çš„é…ç½®ã€è‡ªåŠ¨ HTTPS å’Œé«˜æ€§èƒ½è€Œé—»åã€‚\næœåŠ¡ä¿¡æ¯ï¼š\nå¤–éƒ¨è®¿é—®åœ°å€ï¼šhttps://file.meimolihan.eu.org:888 å†…éƒ¨æœåŠ¡åœ°å€ï¼šhttp://10.10.10.245:11300 å’Œ http://10.10.10.247:11300 æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼š/mnt/ARS2-NFS/file/ ğŸ”§ ä¸€ã€Debian/Ubuntu å®‰è£… Caddy 1. å®‰è£… Caddy 1 2 3 4 5 6 7 8 # æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£… Caddy sudo apt update \u0026amp;\u0026amp; sudo apt install caddy -y # éªŒè¯å®‰è£… caddy version # æŸ¥çœ‹ Caddy çŠ¶æ€ sudo systemctl status caddy 2. å¸è½½ Caddy 1 2 3 4 5 6 # åœæ­¢å¹¶å¸è½½ Caddy sudo systemctl stop caddy sudo apt remove caddy -y # æ¸…ç†é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ sudo rm -rf /etc/caddy /var/lib/caddy 3. åˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ 1 2 3 4 5 6 # åˆ›å»º Windows æ–‡ä»¶ç›®å½• sudo mkdir -p /usr/share/caddy/windows # è®¾ç½®æƒé™ sudo chown -R www-data:www-data /usr/share/caddy sudo chmod -R 755 /usr/share/caddy 4. æ–‡ä»¶åŒæ­¥ 1 2 3 4 # åŒæ­¥æ–‡ä»¶åˆ°ä¸‹è½½ç›®å½• rsync -avhzp --progress --delete \\ \u0026#34;/mnt/ARS2-NFS/é˜¿é‡Œäº‘ç›˜/æ•™ç¨‹æ–‡ä»¶/Winç³»ç»Ÿ/å…¨è‡ªåŠ¨è·å–hostIP/windowsè‡ªåŠ¨å†™å…¥hosts(éœ€è¦ç®¡ç†å‘˜æƒé™)_24.8.30_v1.1.zip\u0026#34; \\ /usr/share/caddy/windows/ ğŸš€ äºŒã€Debian éƒ¨ç½²æ–‡ä»¶ä¸‹è½½æœåŠ¡ 1. åˆ›å»ºæ–‡ä»¶ç›®å½• 1 2 3 4 5 6 7 # åˆ›å»ºæ–‡ä»¶ä¸‹è½½ç›®å½• sudo mkdir -p /mnt/ARS2-NFS/file sudo mkdir -p /mnt/file # è®¾ç½®æƒé™ sudo chown -R www-data:www-data /mnt/ARS2-NFS/file /mnt/file sudo chmod -R 755 /mnt/ARS2-NFS/file /mnt/file 2. é…ç½® Caddyfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 # åˆ›å»ºå¹¶é…ç½® Caddyfile sudo tee /etc/caddy/Caddyfile \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # å…¨å±€é…ç½® { # å…³é—­ç®¡ç†æ¥å£ admin off # è‡ªåŠ¨ HTTPS é…ç½® auto_https disable_redirects # æ—¥å¿—é…ç½® log { output file /var/log/caddy/access.log { roll_size 100MB roll_keep 10 roll_keep_for 720h } format json } } # æ–‡ä»¶ä¸‹è½½æœåŠ¡ - ç«¯å£ 11300 :11300 { # å¯ç”¨ gzip å‹ç¼© encode gzip zstd # æŒ‡å®šé™æ€æ–‡ä»¶æ ¹ç›®å½• root * /mnt/file/ # å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨åŠŸèƒ½ï¼Œæ”¯æŒç›®å½•æµè§ˆ file_server browse # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY X-XSS-Protection \u0026#34;1; mode=block\u0026#34; } # è®¾ç½®é»˜è®¤æ–‡ä»¶ç±»å‹ä¸ºä¸‹è½½ header Content-Type application/octet-stream # å…è®¸è·¨åŸŸè¯·æ±‚ï¼ˆå¯é€‰ï¼‰ header Access-Control-Allow-Origin \u0026#34;*\u0026#34; # ç¦ç”¨ç¼“å­˜ï¼Œç¡®ä¿æ€»æ˜¯è·å–æœ€æ–°æ–‡ä»¶ header Cache-Control \u0026#34;no-cache, no-store, must-revalidate\u0026#34; # æ—¥å¿—é…ç½® log { output file /var/log/caddy/download.log format json } } # HTTPS æ–‡ä»¶æœåŠ¡ - ç«¯å£ 888 file.meimolihan.eu.org:888 { # å¯ç”¨ gzip å‹ç¼© encode gzip zstd # æŒ‡å®šé™æ€æ–‡ä»¶æ ¹ç›®å½• root * /mnt/ARS2-NFS/file/ # å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨åŠŸèƒ½ï¼Œæ”¯æŒç›®å½•æµè§ˆ file_server browse # TLS é…ç½® tls { ciphers TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 curves x25519 secp521r1 secp384r1 alpn http/1.1 h2 } # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY X-XSS-Protection \u0026#34;1; mode=block\u0026#34; Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; } # è®¾ç½®é»˜è®¤æ–‡ä»¶ç±»å‹ä¸ºä¸‹è½½ header Content-Type application/octet-stream # å…è®¸è·¨åŸŸè¯·æ±‚ï¼ˆå¯é€‰ï¼‰ header Access-Control-Allow-Origin \u0026#34;*\u0026#34; # ç¦ç”¨ç¼“å­˜ header Cache-Control \u0026#34;no-cache, no-store, must-revalidate\u0026#34; # æ—¥å¿—é…ç½® log { output file /var/log/caddy/https_download.log format json } # åŸºæœ¬è®¤è¯ï¼ˆå¯é€‰ï¼‰ # basicauth /download/* { # user1 $2y$10$AbCdEfGhIjKlMnOpQrStUvWxYzAbCdEfGhIjKlMnOpQrStUv # } } EOF 3. ç®¡ç† Caddy æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æŸ¥çœ‹é…ç½®æ–‡ä»¶ cat /etc/caddy/Caddyfile # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• sudo caddy validate --config /etc/caddy/Caddyfile # é‡å¯ Caddy æœåŠ¡ sudo systemctl restart caddy # æŸ¥çœ‹ Caddy çŠ¶æ€ sudo systemctl status caddy # å¯ç”¨å¼€æœºè‡ªå¯ sudo systemctl enable caddy # é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ sudo systemctl reload caddy # åœæ­¢æœåŠ¡ sudo systemctl stop caddy # æŸ¥çœ‹æ—¥å¿— sudo tail -f /var/log/caddy/access.log 4. åˆ›å»ºæµ‹è¯•æ–‡ä»¶ 1 2 3 4 5 6 # åˆ›å»ºæµ‹è¯•æ–‡ä»¶ echo \u0026#34;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶\u0026#34; | sudo tee /mnt/file/test.txt echo \u0026#34;è¿™æ˜¯å¦ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶\u0026#34; | sudo tee /mnt/ARS2-NFS/file/sample.txt # åˆ›å»ºå¤§æ–‡ä»¶æµ‹è¯•ï¼ˆ100MBï¼‰ sudo dd if=/dev/zero of=/mnt/file/largefile.bin bs=1M count=100 ğŸ“¥ ä¸‰ã€æ–‡ä»¶ä¸‹è½½å‘½ä»¤ 1. æœ¬åœ°è·¯å¾„æ“ä½œ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ–‡ä»¶ç›®å½• ls -la /mnt/ARS2-NFS/file/ # è¿›å…¥ç›®å½• cd /mnt/ARS2-NFS/file/ # æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ find /mnt/ARS2-NFS/file/ -type f | head -10 2. æ–‡ä»¶ä¸‹è½½å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ç®€å•ä¸‹è½½ï¼ˆä¸‹è½½åˆ°å½“å‰ç›®å½•ï¼‰ curl -# -O https://file.meimolihan.eu.org:888/test.txt # æŒ‡å®šä¸‹è½½ç›®å½•å’Œæ–‡ä»¶å mkdir -p ~/downloads \u0026amp;\u0026amp; curl -# -L -o ~/downloads/test.txt https://file.meimolihan.eu.org:888/test.txt # ä¸‹è½½å¤§æ–‡ä»¶å¹¶æ˜¾ç¤ºè¿›åº¦ curl -# -L -o ~/downloads/largefile.bin https://file.meimolihan.eu.org:888/largefile.bin # ä½¿ç”¨ wget ä¸‹è½½ wget -O ~/downloads/test.txt https://file.meimolihan.eu.org:888/test.txt # æ‰¹é‡ä¸‹è½½è„šæœ¬ #!/bin/bash files=(\u0026#34;file1.txt\u0026#34; \u0026#34;file2.txt\u0026#34; \u0026#34;file3.zip\u0026#34;) for file in \u0026#34;${files[@]}\u0026#34;; do echo \u0026#34;ä¸‹è½½: $file\u0026#34; curl -# -L -o \u0026#34;/tmp/$file\u0026#34; \u0026#34;https://file.meimolihan.eu.org:888/$file\u0026#34; done 3. è®¾ç½®æ–‡ä»¶æƒé™ 1 2 3 4 5 6 # ä¸ºä¸‹è½½çš„è„šæœ¬æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ chmod +x ~/downloads/DnsParse.py # æ‰¹é‡è®¾ç½®æƒé™ find ~/downloads -name \u0026#34;*.sh\u0026#34; -exec chmod +x {} \\; find ~/downloads -name \u0026#34;*.py\u0026#34; -exec chmod +x {} \\; âš–ï¸ å››ã€è´Ÿè½½å‡è¡¡é…ç½® 1. è´Ÿè½½å‡è¡¡å™¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # åˆ›å»ºè´Ÿè½½å‡è¡¡é…ç½® sudo tee /etc/caddy/load-balancer.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # è´Ÿè½½å‡è¡¡é…ç½® :888 { # å®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨ reverse_proxy { to 10.10.10.245:11300 10.10.10.247:11300 # è´Ÿè½½å‡è¡¡ç­–ç•¥ lb_policy round_robin # å¥åº·æ£€æŸ¥ health_uri /health health_interval 30s health_timeout 5s health_status 200 } # TLS é…ç½® tls { ciphers TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 curves x25519 secp521r1 secp384r1 } # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY X-XSS-Protection \u0026#34;1; mode=block\u0026#34; Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; } } EOF 2. åç«¯æœåŠ¡å™¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # åœ¨æ¯ä¸ªåç«¯æœåŠ¡å™¨ä¸Šé…ç½® sudo tee /etc/caddy/backend.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; :11300 { # å¯ç”¨ gzip å‹ç¼© encode gzip # æŒ‡å®šé™æ€æ–‡ä»¶æ ¹ç›®å½• root * /mnt/ARS2-NFS/file/ # å¯ç”¨æ–‡ä»¶æœåŠ¡å™¨åŠŸèƒ½ file_server browse # å¥åº·æ£€æŸ¥ç«¯ç‚¹ handle /health { respond 200 \u0026#34;Healthy\u0026#34; } # å®‰å…¨å¤´éƒ¨ header { X-Content-Type-Options nosniff X-Frame-Options DENY } } EOF 3. åŒæ­¥æ–‡ä»¶å†…å®¹ 1 2 3 4 5 # ä½¿ç”¨ rsync åŒæ­¥æ–‡ä»¶å†…å®¹ rsync -avh --delete /mnt/ARS2-NFS/file/ user@10.10.10.247:/mnt/ARS2-NFS/file/ # è®¾ç½®å®šæ—¶åŒæ­¥ï¼ˆå¯é€‰ï¼‰ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;0 2 * * * rsync -avh --delete /mnt/ARS2-NFS/file/ user@10.10.10.247:/mnt/ARS2-NFS/file/\u0026#34;) | crontab - ğŸ”’ äº”ã€å®‰å…¨åŠ å›º 1. é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # å¯ç”¨ UFW é˜²ç«å¢™ sudo ufw enable # å¼€æ”¾å¿…è¦ç«¯å£ sudo ufw allow 22/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 443/tcp # HTTPS sudo ufw allow 888/tcp # æ–‡ä»¶æœåŠ¡ç«¯å£ sudo ufw allow 11300/tcp # å†…éƒ¨æœåŠ¡ç«¯å£ # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ sudo ufw status verbose 2. è®¿é—®æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»º IP ç™½åå•é…ç½® sudo tee /etc/caddy/whitelist.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # IP ç™½åå•é…ç½® @whitelist { remote_ip 192.168.1.0/24 10.10.10.0/24 } # åªå…è®¸ç™½åå• IP è®¿é—®ç®¡ç†æ¥å£ handle /admin/* { @blocked not remote_ip 192.168.1.100 10.10.10.50 respond @blocked 403 } EOF 3. é€Ÿç‡é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºé€Ÿç‡é™åˆ¶é…ç½® sudo tee /etc/caddy/rate-limit.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # é€Ÿç‡é™åˆ¶é…ç½® @rate_limit { remote_ip 192.168.1.0/24 } limit_rate @rate_limit 100k # è¯·æ±‚é€Ÿç‡é™åˆ¶ rate_limit { zone rate_limit_zone 10m 10r/s key $remote_ip } EOF ğŸ› å…­ã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æ£€æŸ¥ Caddy çŠ¶æ€ sudo systemctl status caddy # æŸ¥çœ‹é”™è¯¯æ—¥å¿— sudo tail -f /var/log/caddy/access.log sudo journalctl -u caddy -f # æµ‹è¯•ç«¯å£è®¿é—® curl -I http://localhost:11300 curl -I https://file.meimolihan.eu.org:888 # æ£€æŸ¥ç«¯å£å ç”¨ sudo netstat -tulnp | grep :11300 sudo netstat -tulnp | grep :888 # æ£€æŸ¥æ–‡ä»¶æƒé™ namei -l /mnt/ARS2-NFS/file/test.txt # æµ‹è¯•æ–‡ä»¶ä¸‹è½½ curl -O http://localhost:11300/test.txt 2. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å¯ç”¨å†…å­˜ç¼“å­˜ï¼ˆåœ¨å¤§å†…å­˜æœåŠ¡å™¨ä¸Šï¼‰ sudo tee /etc/caddy/cache.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ç¼“å­˜é…ç½® cache { memory { capacity 256MB ttl 1h } # é™æ€èµ„æºç¼“å­˜ match_path /static/* /downloads/* } EOF # è°ƒæ•´ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶ echo \u0026#34;fs.file-max = 100000\u0026#34; | sudo tee -a /etc/sysctl.conf echo \u0026#34;* soft nofile 100000\u0026#34; | sudo tee -a /etc/security/limits.conf echo \u0026#34;* hard nofile 100000\u0026#34; | sudo tee -a /etc/security/limits.conf 3. ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # åˆ›å»ºç›‘æ§è„šæœ¬ sudo tee /usr/local/bin/monitor-caddy.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # Caddy æœåŠ¡ç›‘æ§è„šæœ¬ LOG_FILE=\u0026#34;/var/log/caddy/access.log\u0026#34; ERROR_LOG=\u0026#34;/var/log/caddy/error.log\u0026#34; echo \u0026#34;=== Caddy æœåŠ¡ç›‘æ§ ===\u0026#34; echo \u0026#34;å½“å‰æ—¶é—´: $(date)\u0026#34; echo \u0026#34;\u0026#34; # æ£€æŸ¥æœåŠ¡çŠ¶æ€ if systemctl is-active --quiet caddy; then echo \u0026#34;âœ… Caddy æœåŠ¡è¿è¡Œæ­£å¸¸\u0026#34; else echo \u0026#34;âŒ Caddy æœåŠ¡æœªè¿è¡Œ\u0026#34; echo \u0026#34;å°è¯•å¯åŠ¨æœåŠ¡...\u0026#34; sudo systemctl start caddy sleep 2 if systemctl is-active --quiet caddy; then echo \u0026#34;âœ… Caddy æœåŠ¡å·²å¯åŠ¨\u0026#34; else echo \u0026#34;âŒ å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—\u0026#34; fi fi echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“Š è¿æ¥ç»Ÿè®¡:\u0026#34; netstat -an | grep :11300 | awk \u0026#39;{print $6}\u0026#39; | sort | uniq -c netstat -an | grep :888 | awk \u0026#39;{print $6}\u0026#39; | sort | uniq -c echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“ˆ æœ€è¿‘è®¿é—®:\u0026#34; tail -n 10 $LOG_FILE | awk \u0026#39;{print $1, $4, $7, $9}\u0026#39; echo \u0026#34;\u0026#34; echo \u0026#34;âš ï¸ æœ€è¿‘é”™è¯¯:\u0026#34; tail -n 5 $ERROR_LOG 2\u0026gt;/dev/null || echo \u0026#34;æ— é”™è¯¯æ—¥å¿—\u0026#34; EOF # è®¾ç½®è„šæœ¬æƒé™ sudo chmod +x /usr/local/bin/monitor-caddy.sh # æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;*/5 * * * * /usr/local/bin/monitor-caddy.sh \u0026gt;\u0026gt; /var/log/caddy/monitor.log\u0026#34;) | crontab - é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»æˆåŠŸéƒ¨ç½²äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„ Caddy æ–‡ä»¶ä¸‹è½½æœåŠ¡ï¼Œå¹¶é…ç½®äº†è´Ÿè½½å‡è¡¡ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆæä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nâœ… é«˜æ€§èƒ½ï¼šCaddy æä¾›ä¼˜å¼‚çš„é™æ€æ–‡ä»¶æœåŠ¡æ€§èƒ½ âœ… è‡ªåŠ¨ HTTPSï¼šæ— éœ€æ‰‹åŠ¨é…ç½® SSL è¯ä¹¦ âœ… è´Ÿè½½å‡è¡¡ï¼šæ”¯æŒå¤šå°æœåŠ¡å™¨åˆ†æ‹…è´Ÿè½½ âœ… æ˜“äºç®¡ç†ï¼šç®€æ´çš„é…ç½®æ–‡ä»¶æ ¼å¼ âœ… å®‰å…¨åŠ å›ºï¼šå†…ç½®å®‰å…¨åŠŸèƒ½å’Œè®¿é—®æ§åˆ¶ æ‚¨ç°åœ¨å¯ä»¥é€šè¿‡ https://file.meimolihan.eu.org:888 è®¿é—®æ–‡ä»¶ä¸‹è½½æœåŠ¡äº†ï¼ğŸ‰\nğŸ’¡ æç¤ºï¼š\nå®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä»¥ç›‘æ§æœåŠ¡çŠ¶æ€ ä½¿ç”¨è´Ÿè½½å‡è¡¡æ—¶ç¡®ä¿åç«¯æœåŠ¡å™¨æ–‡ä»¶åŒæ­¥ è€ƒè™‘è®¾ç½®å®šæœŸå¤‡ä»½é‡è¦æ–‡ä»¶ ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼Œé¿å…å­˜å‚¨ä¸è¶³ ","date":"2024-12-07T19:59:03+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/188a8d4f/","title":"Caddy éƒ¨ç½²æ–‡ä»¶æœåŠ¡å™¨ ğŸ“‚"},{"content":"acme.sh + Caddy å®Œå…¨æŒ‡å— ğŸš€ ğŸŒ ç°ä»£åŒ–çš„ Web æœåŠ¡å™¨ä¸è‡ªåŠ¨åŒ– SSL è¯ä¹¦ç®¡ç†\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸ“¦ Caddy å®‰è£…é…ç½® ğŸ” SSL è¯ä¹¦ç®¡ç† ğŸ”„ åå‘ä»£ç†é…ç½® âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ”§ ç»´æŠ¤ç®¡ç† ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸŒŸ ä¸€ç«™å¼å®‰è£…è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/bash # ğŸš€ Caddy + acme.sh å¿«é€Ÿéƒ¨ç½²è„šæœ¬ echo \u0026#34;å¼€å§‹å®‰è£… Caddy å’Œ acme.sh...\u0026#34; # åˆ›å»ºç›®å½• sudo mkdir -p /usr/local/caddy/{ssl,conf.d} /var/www/html sudo chmod -R 755 /usr/local/caddy /var/www/html # ä¸‹è½½ Caddy cd /usr/local/caddy wget -O caddy \u0026#34;https://caddyserver.com/api/download?os=linux\u0026amp;arch=amd64\u0026amp;p=github.com%2Fcaddyserver%2Fcaddy/v2\u0026#34; chmod +x caddy # å®‰è£… acme.sh curl https://get.acme.sh | sh -s email=meimolihan@live.com source ~/.bashrc echo \u0026#34;å®‰è£…å®Œæˆï¼\u0026#34; ğŸ“¦ Caddy å®‰è£…é…ç½® ğŸ§ å®‰è£… Caddy 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»ºå®‰è£…ç›®å½• sudo mkdir -p /usr/local/caddy cd /usr/local/caddy # ä¸‹è½½ Caddyï¼ˆåŒ…å«å¸¸ç”¨æ¨¡å—ï¼‰ wget -O caddy \u0026#34;https://caddyserver.com/api/download?os=linux\u0026amp;arch=amd64\u0026amp;p=github.com%2Fcaddyserver%2Fcaddy/v2\u0026amp;p=github.com%2Fcaddyserver%2Fwebdav\u0026#34; # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x caddy # éªŒè¯å®‰è£… ./caddy version ğŸ”§ åŸºæœ¬ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æŸ¥çœ‹ç‰ˆæœ¬ ./caddy version # åˆ—å‡ºå·²å®‰è£…æ¨¡å— ./caddy list-modules # éªŒè¯é…ç½®æ–‡ä»¶ ./caddy validate # æ ¼å¼åŒ–é…ç½®æ–‡ä»¶ ./caddy fmt --overwrite # é‡æ–°åŠ è½½é…ç½® ./caddy reload # å¯åŠ¨ Caddy ./caddy start # åœæ­¢ Caddy ./caddy stop # è¿è¡Œ Caddyï¼ˆå‰å°ï¼‰ ./caddy run ğŸ“ ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 /usr/local/caddy/ â”œâ”€â”€ caddy # Caddy äºŒè¿›åˆ¶æ–‡ä»¶ â”œâ”€â”€ Caddyfile # ä¸»é…ç½®æ–‡ä»¶ â”œâ”€â”€ ssl/ # SSL è¯ä¹¦ç›®å½• â”‚ â”œâ”€â”€ full_chain.pem â”‚ â””â”€â”€ private.key â””â”€â”€ conf.d/ # å­é…ç½®æ–‡ä»¶ç›®å½• â””â”€â”€ *.conf # å„ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶ ğŸš€ å¼€æœºè‡ªå¯åŠ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åˆ›å»ºå¯åŠ¨è„šæœ¬ sudo tee /etc/systemd/system/caddy.service \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Unit] Description=Caddy Web Server After=network.target [Service] Type=simple User=root WorkingDirectory=/usr/local/caddy ExecStart=/usr/local/caddy/caddy run --config /usr/local/caddy/Caddyfile Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target EOF # å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ sudo systemctl daemon-reload sudo systemctl enable caddy sudo systemctl start caddy ğŸ” SSL è¯ä¹¦ç®¡ç† ğŸ“¦ å®‰è£… acme.sh 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£… acme.sh curl https://get.acme.sh | sh -s email=meimolihan@live.com # æˆ–è€…ä½¿ç”¨å›½å†…é•œåƒ curl https://gitcode.net/cert/cn-acme.sh/-/raw/master/install.sh?inline=false | sh -s email=meimolihan@live.com # é‡æ–°åŠ è½½é…ç½® source ~/.bashrc # éªŒè¯å®‰è£… acme.sh --version ğŸŒ Cloudflare DNS éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 # è®¾ç½® Cloudflare API Token export CF_Token=\u0026#34;XMzEDoVjTvJJuzbjn0GO2RMxOfbKN5X369qUqvFT\u0026#34; export CF_Zone_ID=\u0026#34;382fc112abf99c7994ceaedd4844a243\u0026#34; # è®¾ç½®é»˜è®¤ CA acme.sh --set-default-ca --server letsencrypt # ç”³è¯·æ³›åŸŸåè¯ä¹¦ acme.sh --issue --dns dns_cf \\ -d \u0026#34;meimolihan.eu.org\u0026#34; \\ -d \u0026#34;*.meimolihan.eu.org\u0026#34; \\ --keylength ec-256 ğŸ“ è¯ä¹¦å®‰è£… 1 2 3 4 5 # å®‰è£…è¯ä¹¦åˆ° Caddy acme.sh --install-cert -d meimolihan.eu.org \\ --key-file /usr/local/caddy/ssl/private.key \\ --fullchain-file /usr/local/caddy/ssl/full_chain.pem \\ --reloadcmd \u0026#34;cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy reload\u0026#34; ğŸ”„ è¯ä¹¦ç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹è¯ä¹¦åˆ—è¡¨ acme.sh --list # æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ acme.sh --info -d meimolihan.eu.org # æ‰‹åŠ¨ç»­ç­¾ acme.sh --renew -d meimolihan.eu.org --force # è®¾ç½®è‡ªåŠ¨æ›´æ–° acme.sh --upgrade --auto-upgrade # æ’¤é”€è¯ä¹¦ acme.sh --revoke -d meimolihan.eu.org acme.sh --remove -d meimolihan.eu.org â° è‡ªåŠ¨ç»­ç­¾é…ç½® 1 2 3 4 5 # æ·»åŠ è®¡åˆ’ä»»åŠ¡ (crontab -l; echo \u0026#39;10 20 * * * \u0026#34;/root/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/root/.acme.sh\u0026#34; \u0026gt; /dev/null\u0026#39;) | crontab - # éªŒè¯è®¡åˆ’ä»»åŠ¡ crontab -l | grep acme ğŸ”„ åå‘ä»£ç†é…ç½® ğŸ¯ ä¸»é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 # /usr/local/caddy/Caddyfile { http_port 86 https_port 6663 order reverse_proxy before file_server } import /usr/local/caddy/conf.d/*.conf ğŸŒ åå‘ä»£ç†ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # /usr/local/caddy/conf.d/proxy.conf # PVE ç®¡ç†ç•Œé¢ https://pve.meimolihan.eu.org:6663 { encode gzip tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key reverse_proxy https://10.10.10.254:8006 { transport http { tls_insecure_skip_verify } header_up Host {http.reverse_proxy.upstream.hostport} } # é”™è¯¯å¤„ç† handle_errors { rewrite * /50x.html root * /var/www/html file_server } } # WebDAV æ–‡ä»¶æœåŠ¡ https://file.meimolihan.eu.org:6663 { root * /mnt encode gzip # Basic è®¤è¯ basic_auth { admin $2a$14$yZXju.olCFqnybbcXmOfyuA64uPlejIBQVNgd9e7epWJrnB/aT57K } tls /usr/local/caddy/ssl/full_chain.pem /usr/local/caddy/ssl/private.key route { rewrite /webdav /webdav/ webdav /webdav/* { prefix /webdav } file_server browse } } ğŸ›¡ï¸ å®‰å…¨å¤´éƒ¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # å®‰å…¨å¢å¼ºé…ç½® header { Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains; preload\u0026#34; X-Content-Type-Options \u0026#34;nosniff\u0026#34; X-Frame-Options \u0026#34;DENY\u0026#34; X-XSS-Protection \u0026#34;1; mode=block\u0026#34; Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34; Permissions-Policy \u0026#34;fullscreen=(self)\u0026#34; } # éšè—æœåŠ¡å™¨ä¿¡æ¯ server_tokens off ğŸ“Š è´Ÿè½½å‡è¡¡é…ç½® 1 2 3 4 5 6 7 8 9 # è´Ÿè½½å‡è¡¡ç¤ºä¾‹ https://api.example.com:6663 { reverse_proxy { to server1:8080 server2:8080 server3:8080 lb_policy round_robin health_uri /health health_interval 30s } } âš¡ æ€§èƒ½ä¼˜åŒ– ğŸš€ Caddy æ€§èƒ½è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å…¨å±€æ€§èƒ½é…ç½® { # è¿æ¥é™åˆ¶ servers { max_connections 1000 } # ç¼“å†²åŒºå¤§å° buffers { read 4096 write 4096 } # è¶…æ—¶è®¾ç½® timeouts { read 30s write 30s idle 60s } } ğŸ“¦ å‹ç¼©å’Œç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Gzip å‹ç¼© encode gzip # é™æ€èµ„æºç¼“å­˜ header /assets/* { Cache-Control \u0026#34;public, max-age=31536000\u0026#34; } # ä»£ç†ç¼“å­˜ reverse_proxy { @static { path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 } header @static Cache-Control \u0026#34;public, max-age=31536000\u0026#34; } ğŸ” ç›‘æ§å’Œæ—¥å¿— 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ Caddy æ—¥å¿— journalctl -u caddy -f # å®æ—¶ç›‘æ§è¿æ¥æ•° watch -n 1 \u0026#34;netstat -an | grep :6663 | wc -l\u0026#34; # æ€§èƒ½æµ‹è¯• ab -n 1000 -c 100 https://pve.meimolihan.eu.org:6663/ ğŸ”§ ç»´æŠ¤ç®¡ç† ğŸ“‹ å¤‡ä»½å’Œæ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # backup-caddy.sh BACKUP_DIR=\u0026#34;/backup/caddy/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR # å¤‡ä»½é…ç½®å’Œè¯ä¹¦ cp -r /usr/local/caddy $BACKUP_DIR/ cp -r /var/www/html $BACKUP_DIR/html/ # åˆ›å»ºå‹ç¼©åŒ… tar -czf $BACKUP_DIR/caddy-backup.tar.gz $BACKUP_DIR echo \u0026#34;å¤‡ä»½å®Œæˆ: $BACKUP_DIR/caddy-backup.tar.gz\u0026#34; ğŸ› ï¸ æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥é…ç½®è¯­æ³• cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy validate # è°ƒè¯•æ¨¡å¼è¿è¡Œ cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy run --debug # æ£€æŸ¥è¯ä¹¦çŠ¶æ€ openssl x509 -in /usr/local/caddy/ssl/full_chain.pem -noout -dates # æ£€æŸ¥ç«¯å£å ç”¨ sudo lsof -i :6663 sudo netstat -tulnp | grep :6663 ğŸ”„ æ›´æ–°å’Œç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 # æ›´æ–° Caddy cd /usr/local/caddy wget -O caddy.new \u0026#34;https://caddyserver.com/api/download?os=linux\u0026amp;arch=amd64\u0026#34; mv caddy.new caddy chmod +x caddy ./caddy reload # æ›´æ–° acme.sh acme.sh --upgrade # æ¸…ç†æ—§æ—¥å¿— find /var/log -name \u0026#34;caddy*\u0026#34; -mtime +30 -delete ğŸ’¡ æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 # å®šæœŸæ›´æ–°è½¯ä»¶ cd /usr/local/caddy \u0026amp;\u0026amp; wget -O caddy \u0026#34;https://caddyserver.com/api/download?os=linux\u0026amp;arch=amd64\u0026#34; acme.sh --upgrade # æ–‡ä»¶æƒé™è®¾ç½® chmod 755 /usr/local/caddy chmod 600 /usr/local/caddy/ssl/private.key chmod 644 /usr/local/caddy/ssl/full_chain.pem # é˜²ç«å¢™é…ç½® ufw allow 6663/tcp comment \u0026#39;Caddy HTTPS\u0026#39; ufw allow 86/tcp comment \u0026#39;Caddy HTTP\u0026#39; ğŸ“Š ç›‘æ§å‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # monitor-caddy.sh # æ£€æŸ¥æœåŠ¡çŠ¶æ€ if ! systemctl is-active --quiet caddy; then echo \u0026#34;Caddy æœåŠ¡å¼‚å¸¸\u0026#34; | mail -s \u0026#34;Caddy æœåŠ¡å‘Šè­¦\u0026#34; admin@example.com systemctl restart caddy fi # æ£€æŸ¥è¯ä¹¦è¿‡æœŸ EXPIRY_DAYS=$(openssl x509 -in /usr/local/caddy/ssl/full_chain.pem -checkend 864000 | grep -c \u0026#34;will expire\u0026#34;) if [ $EXPIRY_DAYS -eq 1 ]; then echo \u0026#34;SSL è¯ä¹¦å³å°†è¿‡æœŸ\u0026#34; | mail -s \u0026#34;è¯ä¹¦å‘Šè­¦\u0026#34; admin@example.com fi ğŸ”§ è‡ªåŠ¨åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 #!/bin/bash # renew-certificates.sh # ç»­ç­¾è¯ä¹¦ acme.sh --renew-all --force # é‡è½½ Caddy cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy reload # è®°å½•æ—¥å¿— echo \u0026#34;$(date): è¯ä¹¦ç»­ç­¾å®Œæˆ\u0026#34; \u0026gt;\u0026gt; /var/log/caddy-renew.log ğŸ“ æ–‡æ¡£å’Œèµ„æº ğŸŒ Caddy å®˜ç½‘: https://caddyserver.com/ ğŸ“š Caddy æ–‡æ¡£: https://caddyserver.com/docs/ ğŸ”§ acme.sh æ–‡æ¡£: https://github.com/acmesh-official/acme.sh/wiki ğŸ›¡ï¸ SSL é…ç½®ç”Ÿæˆå™¨: https://ssl-config.mozilla.org/ ğŸ¯ æç¤º: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰å……åˆ†æµ‹è¯•æ‰€æœ‰é…ç½®ã€‚å®šæœŸæ£€æŸ¥æ—¥å¿—å’Œç›‘æ§çŠ¶æ€ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œã€‚\nğŸš€ æ‰©å±•åŠŸèƒ½:\nğŸ”„ å¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ ğŸŒ CDN é›†æˆ ğŸ“Š è®¿é—®æ—¥å¿—åˆ†æ ğŸ›¡ï¸ WAF é˜²ç«å¢™ ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ– ğŸ“ ç´§æ€¥æ¢å¤:\n1 2 3 4 5 6 7 8 9 # æœåŠ¡å¼‚å¸¸æ—¶é‡å¯ systemctl restart caddy # è¯ä¹¦é—®é¢˜é‡æ–°ç”³è¯· acme.sh --renew -d meimolihan.eu.org --force # é…ç½®å›æ»š cp /backup/caddy/Caddyfile /usr/local/caddy/ cd /usr/local/caddy \u0026amp;\u0026amp; ./caddy reload ","date":"2024-12-07T19:58:10+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3f86df76/","title":"acme.sh + Caddy å®Œå…¨æŒ‡å— ğŸš€"},{"content":"Docker éƒ¨ç½² Nginx å®Œå…¨æŒ‡å— ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nginx 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Nginx 1. åŸºæœ¬ä½¿ç”¨å’Œæµ‹è¯• ğŸ§ª 2. å¸¸ç”¨å‘½ä»¤ ğŸ“‹ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒ å¯èˆªç½‘ç»œï¼Œè¿æ¥æ— é™ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nginx 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 # åˆ›å»º Nginx éƒ¨ç½²ç›®å½•ç»“æ„ mkdir -p /mnt/mydisk/home/nginx/{html,logs,conf.d,keyfile,nginx} # åˆ›å»º Nginx ä¸»é…ç½®æ–‡ä»¶ cat \u0026gt; /mnt/mydisk/home/nginx/nginx/nginx.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; user www-data; worker_processes auto; pid /run/nginx.pid; error_log /var/log/nginx/error.log warn; include /etc/nginx/modules-enabled/*.conf; events { worker_connections 1024; use epoll; multi_accept on; } http { sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; include /etc/nginx/mime.types; default_type application/octet-stream; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log /var/log/nginx/access.log main; gzip on; gzip_vary on; gzip_min_length 1024; gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json; include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } EOF # åˆ›å»º Docker Compose æ–‡ä»¶ cat \u0026gt; /mnt/mydisk/home/nginx/docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: nginx: container_name: nginx image: nginx:alpine restart: unless-stopped network_mode: bridge ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./keyfile:/etc/nginx/keyfile:ro - ./conf.d:/etc/nginx/conf.d:ro - ./html:/usr/share/nginx/html:rw - ./logs:/var/log/nginx:rw - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro environment: - TZ=Asia/Shanghai privileged: false healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;nginx\u0026#34;, \u0026#34;-t\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 cd /mnt/mydisk/home/nginx \u0026amp;\u0026amp; docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Nginx 1. åŸºæœ¬ä½¿ç”¨å’Œæµ‹è¯• ğŸ§ª 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯• Nginx é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡® docker exec nginx nginx -t # é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰ docker exec nginx nginx -s reload # æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€ docker logs nginx # æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ netstat -tuln | grep \u0026#34;:80\\|:443\u0026#34; 2. å¸¸ç”¨å‘½ä»¤ ğŸ“‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åœæ­¢ Nginx å®¹å™¨ docker stop nginx # å¯åŠ¨ Nginx å®¹å™¨ docker start nginx # é‡å¯ Nginx å®¹å™¨ docker restart nginx # è¿›å…¥ Nginx å®¹å™¨ docker exec -it nginx sh # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker stats nginx # å¤‡ä»½ Nginx é…ç½® tar -czf nginx-backup-$(date +%Y%m%d).tar.gz /mnt/mydisk/home/nginx/conf.d /mnt/mydisk/home/nginx/nginx/nginx.conf ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # åˆ›å»ºåå‘ä»£ç†é…ç½®æ–‡ä»¶ cat \u0026gt; /mnt/mydisk/home/nginx/conf.d/reverse-proxy.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name example.com; return 301 https://$host$request_uri; } server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name example.com; ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; location / { proxy_pass http://åç«¯æœåŠ¡IP:ç«¯å£; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_connect_timeout 60s; proxy_send_timeout 60s; proxy_read_timeout 60s; proxy_buffering on; proxy_buffer_size 4k; proxy_buffers 8 4k; proxy_cache off; } location /robots.txt { return 200 \u0026#34;User-agent: *\\nDisallow: /\u0026#34;; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶ docker exec nginx nginx -t # é‡æ–°åŠ è½½é…ç½® docker exec nginx nginx -s reload # é‡å¯å®¹å™¨ä½¿é…ç½®ç”Ÿæ•ˆ docker restart nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒ å¯èˆªç½‘ç»œï¼Œè¿æ¥æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Nginx æœåŠ¡å™¨ï¼Œå¹¶æŒæ¡äº†åå‘ä»£ç†é…ç½®å’Œå®¹å™¨ç»´æŠ¤çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸš€ é«˜æ•ˆéƒ¨ç½² å¿«é€Ÿæ­å»ºé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨å’Œåå‘ä»£ç†ï¼Œä¸ºå„ç§åº”ç”¨æä¾›ç¨³å®šçš„ç½‘ç»œæœåŠ¡\nğŸ”’ å®‰å…¨åŠ å›º é…ç½® SSL åŠ å¯†å’Œå®‰å…¨å¤´éƒ¨ï¼Œä¿æŠ¤ä½ çš„ç½‘ç«™å’Œåº”ç”¨ç¨‹åºå…å—å¸¸è§ç½‘ç»œæ”»å‡»\nğŸ“Š çµæ´»æ‰©å±• åˆ©ç”¨ Docker çš„å®¹å™¨åŒ–ä¼˜åŠ¿ï¼Œè½»æ¾æ‰©å±•å’Œç®¡ç†å¤šä¸ª Nginx å®ä¾‹\nğŸŒ å…¨çƒè®¿é—® é€šè¿‡åå‘ä»£ç†å®ç°å†…ç½‘æœåŠ¡çš„å…¬ç½‘è®¿é—®ï¼Œæ‰“ç ´ç½‘ç»œè¾¹ç•Œé™åˆ¶\nNginx ä¸ä»…æ˜¯ç½‘ç»œçš„æ¡¥æ¢ï¼Œæ›´æ˜¯ç°ä»£äº’è”ç½‘æ¶æ„çš„åŸºçŸ³ã€‚æ„¿è¿™ä»½æŒ‡å—å¸®åŠ©ä½ æ„å»ºç¨³å®šã€é«˜æ•ˆã€å®‰å…¨çš„ç½‘ç»œæœåŠ¡ï¼Œè®©ä½ çš„åº”ç”¨åœ¨æ•°å­—ä¸–ç•Œä¸­ç•…é€šæ— é˜»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç”¨ Nginx æ­å»ºä½ çš„ç½‘ç»œå¸å›½ï¼Œè¿æ¥æ¯ä¸€ä¸ªæ•°å­—èŠ‚ç‚¹ï¼ğŸŒ\nğŸ“Œ æŒç»­å­¦ä¹ ï¼šå»ºè®®å…³æ³¨ Nginx å®˜æ–¹æ–‡æ¡£ å’Œ åšå®¢ ï¼Œæ·±å…¥äº†è§£é«˜çº§é…ç½®å’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ Nginx ç¤¾åŒºè®ºå› æˆ–ç›¸å…³æŠ€æœ¯ç¤¾åŒºå¯»æ±‚å¸®åŠ©ã€‚\nç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼Œç½‘ç»œç•…é€šï¼ğŸ‰\n","date":"2024-12-07T19:57:10+08:00","image":"https://file.meimolihan.eu.org/img/nginx-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8786d8f7/","title":"Docker éƒ¨ç½² Nginx å®Œå…¨æŒ‡å— ğŸ³"},{"content":"Docker éƒ¨ç½² mTab ä¹¦ç­¾ç®¡ç†ç³»ç»Ÿ ğŸ“š ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² mTab 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åˆå§‹è®¾ç½®æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªä¹¦ç­¾ï¼Œæ•ˆç‡æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ mTab å®˜ç½‘åœ°å€ï¼š https://mtab.cc/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/tsxcw/mtab ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/itushan/mtab mTab æ˜¯ä¸€ä¸ªå¼€æºçš„ç°ä»£åŒ–ä¹¦ç­¾ç®¡ç†ç³»ç»Ÿï¼Œæä¾›ä¼˜é›…çš„ç•Œé¢å’Œå¼ºå¤§çš„ä¹¦ç­¾ç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸ªäººæˆ–å›¢é˜Ÿçš„ä¹¦ç­¾ç®¡ç†å¹³å°ï¼Œå®ç°è·¨è®¾å¤‡åŒæ­¥å’Œé«˜æ•ˆçš„ä¹¦ç­¾ç»„ç»‡ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ ç°ä»£åŒ–ç•Œé¢ ç®€æ´ç¾è§‚çš„ç”¨æˆ·ç•Œé¢è®¾è®¡ æä¾›ä¼˜é›…çš„ä¹¦ç­¾æµè§ˆä½“éªŒ ğŸ”– æ™ºèƒ½åˆ†ç±» æ”¯æŒæ ‡ç­¾ã€æ–‡ä»¶å¤¹ç­‰å¤šç»´åº¦åˆ†ç±» çµæ´»ç»„ç»‡å’Œç®¡ç†ä¹¦ç­¾ ğŸ” å¼ºå¤§æœç´¢ å¿«é€Ÿå…¨æ–‡æœç´¢ä¹¦ç­¾å†…å®¹ å¿«é€Ÿå®šä½æ‰€éœ€ä¹¦ç­¾èµ„æº ğŸ“± å“åº”å¼è®¾è®¡ å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ è·¨è®¾å¤‡ä¸€è‡´çš„ä½¿ç”¨ä½“éªŒ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ æ”¯æŒå›¢é˜Ÿåä½œå’Œæƒé™ç®¡ç† é€‚åˆä¸ªäººå’Œå›¢é˜Ÿä½¿ç”¨ ğŸ“‚ å¯¼å…¥å¯¼å‡º æ”¯æŒæµè§ˆå™¨ä¹¦ç­¾å¯¼å…¥å¯¼å‡º æ–¹ä¾¿æ•°æ®è¿ç§»å’Œå¤‡ä»½ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² ä½¿ç”¨ Docker ç®€åŒ–å®‰è£…å’Œç»´æŠ¤ å¿«é€Ÿéƒ¨ç½²å’Œå‡çº§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² mTab 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 mkdir -p /mnt/mydisk/home/mtab \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: mysql8: image: mysql:8.0 container_name: mtab_sql restart: always ports: - \u0026#34;9201:3306\u0026#34; volumes: - ./mysql:/var/lib/mysql environment: MYSQL_ROOT_PASSWORD: mtab_root_password MYSQL_DATABASE: mtab MYSQL_USER: mtab_user MYSQL_PASSWORD: mtab_password TZ: Asia/Shanghai networks: - mtab-network mtab-app: container_name: mtab image: itushan/mtab:latest restart: always ports: - \u0026#34;9200:80\u0026#34; volumes: - ./app:/app - ./uploads:/app/uploads environment: MYSQL_HOST: mtab_sql MYSQL_USER: mtab_user MYSQL_PORT: 3306 MYSQL_PASSWORD: mtab_password MYSQL_DATABASE: mtab ADMIN_USER: admin ADMIN_PASSWORD: your_secure_password_here depends_on: - mysql8 networks: - mtab-network networks: mtab-network: driver: bridge EOF ğŸ” å®‰å…¨æç¤ºï¼šéƒ¨ç½²åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼Œå»ºè®®ä½¿ç”¨å¯†ç ç®¡ç†å™¨ç”Ÿæˆå¼ºå¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:9200 IPè®¿é—®: http://æœåŠ¡å™¨IP:9200 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. åˆå§‹è®¾ç½®æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼š ç”¨æˆ·åï¼šadmin å¯†ç ï¼šyour_secure_password_here ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  é…ç½®ç³»ç»ŸåŸºæœ¬è®¾ç½® å¯¼å…¥æµè§ˆå™¨ä¹¦ç­¾æˆ–å¼€å§‹æ·»åŠ æ–°ä¹¦ç­¾ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://bookmarks.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/mtab.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name bookmarks.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:9200; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/mtab # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop mtab docker start mtab docker restart mtab # åˆ é™¤å®¹å™¨ docker rm mtab docker rm -f mtab # è¿›å…¥å®¹å™¨Shell docker exec -it mtab sh docker exec -it mtab bash # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect mtab docker stats mtab # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs mtab docker logs -f mtab docker logs --tail 100 mtab docker logs -t mtab 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 5 docker images docker rmi itushan/mtab:latest docker rmi mysql:8.0 docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªä¹¦ç­¾ï¼Œæ•ˆç‡æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† mTab ä¹¦ç­¾ç®¡ç†ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“š æ™ºèƒ½ç®¡ç† ä¼˜é›…åœ°ç»„ç»‡å’Œåˆ†ç±»æ‰€æœ‰ä¹¦ç­¾ï¼Œæ‰“é€ ä¸ªäººçŸ¥è¯†ç®¡ç†ä½“ç³»\nğŸŒ è·¨è®¾å¤‡åŒæ­¥ éšæ—¶éšåœ°è®¿é—®ä½ çš„ä¹¦ç­¾æ”¶è—ï¼Œå®ç°å¤šè®¾å¤‡æ— ç¼è¡”æ¥\nğŸ” é«˜æ•ˆæ£€ç´¢ å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€èµ„æºï¼Œæå‡å·¥ä½œå’Œå­¦ä¹ æ•ˆç‡\nä¹¦ç­¾ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸çŸ¥è¯†ç§¯ç´¯ç›¸ä¼´çš„æˆé•¿æ—…ç¨‹ã€‚æ„¿ mTab æˆä¸ºä½ å¾—åŠ›çš„çŸ¥è¯†ç®¡ç†åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡ä¿¡æ¯æ”¶é›†å’Œèµ„æºæ•´ç†çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæœ‰åºç®¡ç†ï¼Œé«˜æ•ˆè®¿é—®â€”â€”æ„å»ºä½ ä¸ªæ€§åŒ–çš„çŸ¥è¯†å®åº“å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ mTab å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œæ•ˆç‡å€å¢ï¼ğŸ‰\n","date":"2024-12-07T19:53:47+08:00","image":"https://file.meimolihan.eu.org/img/mtab-01.webp","permalink":"https://blog.meimolihan.eu.org/p/80c8d4ad/","title":"Docker éƒ¨ç½² mTab ä¹¦ç­¾ç®¡ç†ç³»ç»Ÿ ğŸ“š"},{"content":"Linux å¸¸ç”¨è„šæœ¬é›†åˆ ğŸ§ ğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ å®‰è£…åŸºç¡€ç»„ä»¶ ğŸ§ ä¸€ã€Linux å¼€æœºä¿¡æ¯æ˜¾ç¤ºè„šæœ¬ ğŸ§ äºŒã€Linux ç³»ç»Ÿæ¸…ç†è„šæœ¬ ğŸ”„ ä¸‰ã€ç›®å½•åŒæ­¥è„šæœ¬ ğŸ“¦ å››ã€ç›®å½•å¤‡ä»½è„šæœ¬ ğŸ¦ äº”ã€ç§‘æŠ€ Lion è„šæœ¬ ğŸ”§ å…­ã€Proxmox VE ä¼˜åŒ–è„šæœ¬ ğŸ§ ä¸ƒã€Linux è¿ç»´è„šæœ¬ å®‰è£…åŸºç¡€ç»„ä»¶ ğŸ”§ æ ¹æ®æ‚¨çš„ç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„å‘½ä»¤ï¼š 1 2 3 4 5 6 7 8 # ğŸ§ Debian/Ubuntu ç³»ç»Ÿ sudo apt update -y \u0026amp;\u0026amp; sudo apt install -y curl wget sudo # ğŸ”´ CentOS/RHEL ç³»ç»Ÿ sudo yum update -y \u0026amp;\u0026amp; sudo yum install -y curl wget sudo # ğŸ”ï¸ Alpine Linux ç³»ç»Ÿ sudo apk update \u0026amp;\u0026amp; sudo apk add curl wget sudo ä¸€ã€Linux å¼€æœºä¿¡æ¯æ˜¾ç¤ºè„šæœ¬ ğŸ§ âœ¨ ä¼˜é›…æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€ä¿¡æ¯ï¼Œè®©ä½ çš„ Linux ç»ˆç«¯å¼€æœºæ›´æœ‰èŒƒå„¿ï¼\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/install/check.sh) äºŒã€Linux ç³»ç»Ÿæ¸…ç†è„šæœ¬ ğŸ§ Linux ç³»ç»Ÿä¸€é”®æ¸…ç†è„šæœ¬ï¼Œå¯æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€è½¯ä»¶åŒ…ç¼“å­˜ã€ç³»ç»Ÿæ—¥å¿—å’Œç”¨æˆ·ç¼“å­˜ï¼Œæ”¯æŒå¤šç§å‘è¡Œç‰ˆã€‚\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/linux/clean_system.sh) ä¸‰ã€ç›®å½• \u0026amp; æ–‡ä»¶/åŒæ­¥è„šæœ¬ ğŸ”„ ä½¿ç”¨rsyncå°†æºç›®å½•å†…å®¹å®æ—¶åŒæ­¥åˆ°å¤šä¸ªç›®æ ‡ç›®å½•ï¼Œå¹¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»Ÿä¾èµ–å’Œç›®å½•å­˜åœ¨æ€§ï¼Œæä¾›è¯¦ç»†çš„è¿›åº¦åé¦ˆå’ŒçŠ¶æ€æŠ¥å‘Šã€‚ æ–‡ä»¶åŒæ­¥åŠ  -fï¼Œæºä¸ç›®æ ‡éƒ½ä¸åŠ æ–œæ ã€å†™å…¨è·¯å¾„ï¼ˆå«æ–‡ä»¶åï¼‰ã€‚\nç›®å½•åŒæ­¥ä¸åŠ  -fï¼Œæºä¸ç›®æ ‡éƒ½ä¸åŠ æ–œæ ï¼Œè„šæœ¬è‡ªåŠ¨åœ¨å†…éƒ¨è¡¥ / åšå†…å®¹é•œåƒã€‚\n1 2 3 4 5 # åŒæ­¥ç›®å½• bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) /æºç›®å½• /ç›®æ ‡ç›®å½•1 /ç›®æ ‡ç›®å½•2 # åŒæ­¥æ–‡ä»¶ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/sync/rsync.sh) -f /æºæ–‡ä»¶ /ç›®æ ‡æ–‡ä»¶1 /ç›®æ ‡æ–‡ä»¶2 å››ã€ç›®å½•å¤‡ä»½å‹ç¼©è„šæœ¬ å°†æŒ‡å®šæºç›®å½•å‹ç¼©æ‰“åŒ…å¹¶ä¿å­˜åˆ°ç›®æ ‡ä½ç½®ï¼ŒåŒæ—¶è‡ªåŠ¨æ¸…ç†æ—§çš„å¤‡ä»½æ–‡ä»¶å¹¶æä¾›å¸¦é¢œè‰²æ ‡è®°çš„æ‰§è¡ŒçŠ¶æ€åé¦ˆã€‚\n1 2 3 4 5 # å®Œæ•´ç›®å½•å¤‡ä»½è„šæœ¬ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/universal_backup.sh) /æºç›®å½• /å¤‡ä»½ç›®å½• ä¿ç•™æ•°é‡ # å­ç›®å½•åˆ†ç¦»å¤‡ä»½ bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/backup/directory_backup.sh) /æºç›®å½• /å¤‡ä»½ç›®å½• ä¿ç•™æ•°é‡ äº”ã€ç§‘æŠ€ Lion è„šæœ¬å·¥å…·ç®± ğŸ¦ ğŸš€ ä¸“ä¸ºLinuxæœåŠ¡å™¨è®¾è®¡çš„å…¨èƒ½ç®¡ç†å·¥å…·ï¼Œè®©æœåŠ¡å™¨ç®¡ç†å˜å¾—ç®€å•é«˜æ•ˆï¼\n1 bash \u0026lt;(curl -sL kejilion.sh) docker install å…­ã€Proxmox VE ä¼˜åŒ–è„šæœ¬ğŸ”§ 1 wget -q -O /root/pve_source.tar.gz \u0026#39;https://bbs.x86pi.cn/file/topic/2023-11-28/file/01ac88d7d2b840cb88c15cb5e19d4305b2.gz\u0026#39; \u0026amp;\u0026amp; tar zxvf /root/pve_source.tar.gz \u0026amp;\u0026amp; /root/./pve_source 1 2 # Gitee ä»“åº“ wget -q -O /root/pve_source.tar.gz \u0026#39;https://gitee.com/meimolihan/script/raw/master/sh/pve/pve_source.tar.gz\u0026#39; \u0026amp;\u0026amp; tar zxvf /root/pve_source.tar.gz \u0026amp;\u0026amp; /root/./pve_source ä¸ƒã€Linux è¿ç»´è„šæœ¬ ğŸ§ Linux åŒå±äº¤äº’å¼ç³»ç»Ÿç®¡ç†å·¥å…·è„šæœ¬ï¼Œå¯è‡ªåŠ¨æ£€æµ‹åŒ…ç®¡ç†å™¨å¹¶å®‰è£…å¿…è¦å·¥å…·ï¼Œæä¾›è¿›ç¨‹ã€ç£ç›˜ã€ç½‘ç»œã€æ—¥å¿—ã€ç”¨æˆ·ã€å®‰å…¨ã€ç³»ç»Ÿä¿¡æ¯ã€è®¡åˆ’ä»»åŠ¡ç­‰å¤šç»´åº¦ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·é€šè¿‡èœå•é€‰æ‹©æ‰§è¡Œå¯¹åº”è¿ç»´æ“ä½œã€‚\n1 bash \u0026lt;(curl -sL gitee.com/meimolihan/script/raw/master/sh/upkeep/upkeep.sh) ","date":"2024-12-07T19:52:27+08:00","image":"https://file.meimolihan.eu.org/img/shell-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a9472c12/","title":"Linux å¸¸ç”¨è„šæœ¬é›†åˆ ğŸ§"},{"content":"Proxmox VE è™šæ‹Ÿæœºè¿ç§»æŒ‡å— ğŸ”„ ğŸš€ å°†è™šæ‹Ÿæœºä»AèŠ‚ç‚¹è¿ç§»åˆ°BèŠ‚ç‚¹çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…å«å¤šç§è¿ç§»æ–¹å¼å’Œè¯¦ç»†æ“ä½œæ­¥éª¤\nğŸ“– ç›®å½•å¯¼èˆª ğŸ¯ è¿ç§»å‰å‡†å¤‡ ğŸ“¦ AèŠ‚ç‚¹æ“ä½œ ğŸ“¥ BèŠ‚ç‚¹æ“ä½œ âš™ï¸ è¿ç§»åé…ç½® ğŸ”§ éªŒè¯ä¸æµ‹è¯• ğŸ’¡ æ›¿ä»£æ–¹æ¡ˆ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ¯ è¿ç§»å‰å‡†å¤‡ ğŸ“Š ç¯å¢ƒä¿¡æ¯ é¡¹ç›® AèŠ‚ç‚¹ BèŠ‚ç‚¹ IPåœ°å€ 10.10.10.254 10.10.10.1 è™šæ‹ŸæœºID 100 105 å­˜å‚¨ç±»å‹ LVM LVM âœ… å‰ç½®æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åœ¨AèŠ‚ç‚¹æ£€æŸ¥è™šæ‹ŸæœºçŠ¶æ€ qm status 100 # åœ¨BèŠ‚ç‚¹æ£€æŸ¥ç›®æ ‡IDæ˜¯å¦å¯ç”¨ qm list | grep 105 # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping -c 4 10.10.10.1 # æ£€æŸ¥å­˜å‚¨ç©ºé—´ pvesm status # æ£€æŸ¥CPUå…¼å®¹æ€§ï¼ˆé‡è¦ï¼ï¼‰ qm config 100 | grep cpu qm config 105 | grep cpu # ç¡®ä¿BèŠ‚ç‚¹æœ‰ç›¸åŒæˆ–å…¼å®¹çš„CPUç±»å‹ # æ£€æŸ¥PVEç‰ˆæœ¬å…¼å®¹æ€§ pveversion -v ğŸ“¦ AèŠ‚ç‚¹æ“ä½œ 1. ğŸ“ ä¼ è¾“è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½åŸé…ç½®æ–‡ä»¶ cp /etc/pve/qemu-server/100.conf /etc/pve/qemu-server/100.conf.backup # ä¼ è¾“é…ç½®æ–‡ä»¶åˆ°BèŠ‚ç‚¹ scp /etc/pve/qemu-server/100.conf root@10.10.10.1:/etc/pve/qemu-server/105.conf # ğŸ” éªŒè¯ä¼ è¾“ç»“æœ ssh root@10.10.10.1 \u0026#34;ls -la /etc/pve/qemu-server/105.conf\u0026#34; # æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦æœ‰éœ€è¦ä¿®æ”¹çš„è·¯å¾„æˆ–å¼•ç”¨ ssh root@10.10.10.1 \u0026#34;cat /etc/pve/qemu-server/105.conf\u0026#34; 2. ğŸ’¾ å¯¼å‡ºè™šæ‹Ÿæœºç£ç›˜é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 # åœæ­¢è™šæ‹Ÿæœºï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰ qm stop 100 \u0026amp;\u0026amp; echo \u0026#34;VM stopped successfully\u0026#34; || echo \u0026#34;Failed to stop VM\u0026#34; # ä½¿ç”¨ddå¯¼å‡ºLVMå·ä¸ºrawæ ¼å¼ dd if=/dev/pve/vm-100-disk-0 of=/tmp/vm-100-disk-0.raw bs=1M status=progress # ğŸ“Š æ£€æŸ¥å¯¼å‡ºæ–‡ä»¶ ls -lh /tmp/vm-100-disk-0.raw file /tmp/vm-100-disk-0.raw # è®¡ç®—æ ¡éªŒå’Œï¼ˆå¯é€‰ï¼Œç”¨äºéªŒè¯å®Œæ•´æ€§ï¼‰ md5sum /tmp/vm-100-disk-0.raw \u0026gt; /tmp/vm-100-disk-0.raw.md5 3. ğŸ“¤ ä¼ è¾“ç£ç›˜é•œåƒåˆ°BèŠ‚ç‚¹ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨scpä¼ è¾“rawæ–‡ä»¶ï¼ˆé€‚åˆå°æ–‡ä»¶ï¼‰ scp /tmp/vm-100-disk-0.raw root@10.10.10.1:/tmp/vm-105-disk-0.raw # ğŸš€ ä½¿ç”¨rsyncï¼ˆæ¨èï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ å’Œå‹ç¼©ï¼‰ rsync -avz --progress /tmp/vm-100-disk-0.raw root@10.10.10.1:/tmp/vm-105-disk-0.raw # ä¼ è¾“æ ¡éªŒæ–‡ä»¶ scp /tmp/vm-100-disk-0.raw.md5 root@10.10.10.1:/tmp/ # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆä¼ è¾“å®Œæˆåï¼‰ rm -f /tmp/vm-100-disk-0.raw /tmp/vm-100-disk-0.raw.md5 ğŸ“¥ BèŠ‚ç‚¹æ“ä½œ 1. ğŸ“¥ å¯¼å…¥ç£ç›˜é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥æ¥æ”¶åˆ°çš„æ–‡ä»¶å®Œæ•´æ€§å’Œå¤§å° ls -lh /tmp/vm-105-disk-0.raw # éªŒè¯MD5æ ¡éªŒå’Œï¼ˆå¦‚æœä¼ è¾“äº†æ ¡éªŒæ–‡ä»¶ï¼‰ md5sum -c /tmp/vm-105-disk-0.raw.md5 # å¯¼å…¥ç£ç›˜åˆ°LVMå­˜å‚¨ qm importdisk 105 /tmp/vm-105-disk-0.raw local # ğŸ”„ æŸ¥çœ‹å¯¼å…¥è¿›åº¦ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰ tail -f /var/log/syslog | grep import # æ£€æŸ¥å¯¼å…¥ç»“æœ ls -la /dev/pve/ | grep 105 2. âš™ï¸ é…ç½®è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å½“å‰é…ç½® qm config 105 # é™„åŠ æ–°å¯¼å…¥çš„ç£ç›˜ qm set 105 --ide0 local:105/vm-105-disk-0.raw # ğŸ¯ å¯é€‰ï¼šè½¬æ¢ä¸ºæ›´é«˜æ•ˆçš„æ ¼å¼ qemu-img convert -f raw -O qcow2 /dev/pve/vm-105-disk-0 /dev/pve/vm-105-disk-0.qcow2 qm set 105 --ide0 local:105/vm-105-disk-0.qcow2 # è®¾ç½®å¯åŠ¨é¡ºåºï¼ˆç¡®ä¿ä»ç¡¬ç›˜å¯åŠ¨ï¼‰ qm set 105 --boot order=ide0 âš™ï¸ è¿ç§»åé…ç½® 1. ğŸ”§ æ¸…ç†å’Œä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm -f /tmp/vm-105-disk-0.raw /tmp/vm-105-disk-0.raw.md5 # ç¼–è¾‘è™šæ‹Ÿæœºé…ç½® nano /etc/pve/qemu-server/105.conf # ğŸ› ï¸ éœ€è¦ä¿®æ”¹çš„é…ç½®é¡¹ï¼š # - åˆ é™¤æ—§çš„ç£ç›˜å¼•ç”¨ # - æ›´æ–°ç½‘ç»œMACåœ°å€ # - è°ƒæ•´ç¡¬ä»¶é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ # - æ£€æŸ¥å¹¶æ›´æ–°CPUç±»å‹è®¾ç½® 2. ğŸŒ ç½‘ç»œé…ç½®æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹å½“å‰ç½‘ç»œé…ç½® qm config 105 | grep net # ç§»é™¤æ—§çš„MACåœ°å€ qm set 105 --delete net0 # æ·»åŠ æ–°çš„ç½‘ç»œè®¾å¤‡ï¼ˆä¼šè‡ªåŠ¨ç”Ÿæˆæ–°MACï¼‰ qm set 105 --net0 virtio,bridge=vmbr0 # æˆ–è€…æ‰‹åŠ¨æŒ‡å®šMACåœ°å€ï¼ˆå¦‚æœéœ€è¦ä¿æŒç›¸åŒï¼‰ qm set 105 --net0 virtio,bridge=vmbr0,mac=XX:XX:XX:XX:XX:XX # é…ç½®å…¶ä»–ç½‘ç»œæ¥å£ï¼ˆå¦‚æœæœ‰å¤šä¸ªï¼‰ for i in {1..3}; do qm set 105 --net$i virtio,bridge=vmbr$i done 3. ğŸ’¾ å­˜å‚¨ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç£ç›˜æ ¼å¼ qemu-img info /dev/pve/vm-105-disk-0 # è½¬æ¢ä¸ºqcow2æ ¼å¼ï¼ˆèŠ‚çœç©ºé—´ï¼‰ qemu-img convert -f raw -O qcow2 /dev/pve/vm-105-disk-0 /dev/pve/vm-105-disk-0.qcow2 # æ›´æ–°é…ç½®æ–‡ä»¶ä½¿ç”¨æ–°æ ¼å¼ qm set 105 --ide0 local:105/vm-105-disk-0.qcow2 # è°ƒæ•´ç£ç›˜ç¼“å­˜ç­–ç•¥ï¼ˆæå‡æ€§èƒ½ï¼‰ qm set 105 --cache writeback ğŸ”§ éªŒè¯ä¸æµ‹è¯• 1. âœ… é…ç½®éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® qm config 105 # éªŒè¯ç£ç›˜å®Œæ•´æ€§ qemu-img check /dev/pve/vm-105-disk-0 # æ£€æŸ¥ç½‘ç»œé…ç½® cat /etc/pve/qemu-server/105.conf | grep net # éªŒè¯CPUå…¼å®¹æ€§ qm config 105 | grep cpu 2. ğŸš€ å¯åŠ¨æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯åŠ¨è™šæ‹Ÿæœº qm start 105 # ç›‘æ§å¯åŠ¨è¿‡ç¨‹ qm monitor 105 # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— tail -f /var/log/syslog | grep 105 # æ£€æŸ¥è¿è¡ŒçŠ¶æ€ qm status 105 # å°è¯•è¿æ¥åˆ°æ§åˆ¶å° qm terminal 105 3. ğŸ“Š æ€§èƒ½æµ‹è¯• 1 2 3 4 5 6 7 8 # æµ‹è¯•ç£ç›˜I/Oæ€§èƒ½ qm guest exec 105 -- fio --name=test --filename=/tmp/test --size=1G --readwrite=randread --ioengine=libaio --direct=1 # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ qm guest exec 105 -- ping -c 4 8.8.8.8 # æµ‹è¯•å†…å­˜æ€§èƒ½ qm guest exec 105 -- sysbench memory --memory-block-size=1K --memory-total-size=10G run ğŸ’¡ æ›¿ä»£æ–¹æ¡ˆ ğŸ”„ ä½¿ç”¨PVEå†…ç½®è¿ç§»å·¥å…·ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 # åœ¨çº¿è¿ç§»ï¼ˆéœ€è¦å…±äº«å­˜å‚¨ï¼‰ qm migrate 100 10.10.10.1 --online # ç¦»çº¿è¿ç§» qm migrate 100 10.10.10.1 # å¸¦å¸¦å®½é™åˆ¶çš„è¿ç§»ï¼ˆé¿å…å½±å“ç”Ÿäº§ç½‘ç»œï¼‰ qm migrate 100 10.10.10.1 --bwlimit 50 # è¿ç§»ç‰¹å®šç£ç›˜ qm migrate 100 10.10.10.1 --with-local-disks ğŸ“¦ ä½¿ç”¨å¤‡ä»½/æ¢å¤æ–¹å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœ¨AèŠ‚ç‚¹åˆ›å»ºå¤‡ä»½ï¼ˆåœæ­¢VMï¼‰ vzdump 100 --compress zstd --mode stop --storage local # åœ¨AèŠ‚ç‚¹åˆ›å»ºå¤‡ä»½ï¼ˆåœ¨çº¿å¤‡ä»½ï¼Œéœ€è¦QEMU Guest Agentï¼‰ vzdump 100 --compress zstd --mode snapshot --storage local # ä¼ è¾“å¤‡ä»½æ–‡ä»¶åˆ°BèŠ‚ç‚¹ scp /var/lib/vz/dump/vzdump-qemu-100-*.vma.zst root@10.10.10.1:/var/lib/vz/dump/ # åœ¨BèŠ‚ç‚¹æ¢å¤å¤‡ä»½ qm restore 105 /var/lib/vz/dump/vzdump-qemu-100-*.vma.zst # æ¢å¤æ—¶æŒ‡å®šå­˜å‚¨ qm restore 105 /var/lib/vz/dump/vzdump-qemu-100-*.vma.zst -storage local-lvm ğŸ³ ä½¿ç”¨å®¹å™¨åŒ–æ–¹æ¡ˆï¼ˆLXCï¼‰ 1 2 3 4 5 # å¯¹äºLXCå®¹å™¨ï¼Œè¿ç§»æ›´ç®€å• pct migrate 100 10.10.10.1 --restart # è¿ç§»ç‰¹å®šå®¹å™¨ pct migrate 100 10.10.10.1 --restart --target-storage local-lvm âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ“‹ å…¼å®¹æ€§æ£€æŸ¥ï¼šç¡®ä¿Aã€BèŠ‚ç‚¹ç¡¬ä»¶å’Œè½¯ä»¶ç‰ˆæœ¬å…¼å®¹ ğŸ’¾ å­˜å‚¨ç©ºé—´ï¼šç¡®è®¤BèŠ‚ç‚¹æœ‰è¶³å¤Ÿå­˜å‚¨ç©ºé—´ â° åœæœºæ—¶é—´ï¼šè§„åˆ’åˆé€‚çš„ç»´æŠ¤çª—å£è¿›è¡Œè¿ç§» ğŸ”’ å®‰å…¨è€ƒè™‘ï¼šä¼ è¾“è¿‡ç¨‹ä¸­è€ƒè™‘ä½¿ç”¨åŠ å¯†è¿æ¥ ğŸ“Š æ€§èƒ½å½±å“ï¼šå¤§è§„æ¨¡è¿ç§»å¯èƒ½å½±å“ç½‘ç»œæ€§èƒ½ ğŸ”„ å›æ»šè®¡åˆ’ï¼šå§‹ç»ˆä¿ç•™åŸè™šæ‹Ÿæœºç›´åˆ°æ–°è™šæ‹Ÿæœºç¨³å®šè¿è¡Œ ğŸ”§ æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¦‚æœè¿ç§»å¤±è´¥ï¼Œæ£€æŸ¥æ—¥å¿— tail -f /var/log/syslog journalctl -u pvedaemon -f # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ traceroute 10.10.10.1 mtr 10.10.10.1 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® iptables -L -n nft list ruleset # æ£€æŸ¥å­˜å‚¨çŠ¶æ€ pvesm status lvs vgs pvs # æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ pvecm status ğŸ”„ å›æ»šæ­¥éª¤ 1 2 3 4 5 6 # å¦‚æœè¿ç§»å¤±è´¥ï¼Œæ¢å¤åŸè™šæ‹Ÿæœº qm start 100 # æ¸…ç†BèŠ‚ç‚¹ä¸Šçš„å¤±è´¥è¿ç§» qm destroy 105 --purge rm -f /etc/pve/qemu-server/105.conf ğŸ¯ æç¤ºï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒè¿›è¡Œæ¼”ç»ƒã€‚å¤§è§„æ¨¡è¿ç§»æ—¶è€ƒè™‘åˆ†æ‰¹æ¬¡è¿›è¡Œï¼Œå¹¶ç¡®ä¿æœ‰å®Œæ•´çš„å›æ»šæ–¹æ¡ˆã€‚\nğŸ“š æ‰©å±•é˜…è¯»ï¼š\nPVEå®˜æ–¹è¿ç§»æ–‡æ¡£ å­˜å‚¨è¿ç§»æŒ‡å— æ•…éšœæ’é™¤æ‰‹å†Œ CPUå…¼å®¹æ€§è®¾ç½® è¿ç§»å®Œæˆæ£€æŸ¥æ¸…å•ï¼š\nè™šæ‹Ÿæœºé…ç½®æ–‡ä»¶å·²æ­£ç¡®ä¼ è¾“ ç£ç›˜æ•°æ®å®Œæ•´æ— è¯¯ ç½‘ç»œé…ç½®å·²æ›´æ–° è™šæ‹Ÿæœºå¯åŠ¨æ­£å¸¸ æœåŠ¡è¿è¡Œæ­£å¸¸ æ€§èƒ½æµ‹è¯•é€šè¿‡ åŸè™šæ‹Ÿæœºå·²å¤‡ä»½ï¼ˆä¿ç•™è‡³å°‘24å°æ—¶ï¼‰ ","date":"2024-12-07T19:51:58+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/583991ad/","title":"Proxmox VE è™šæ‹Ÿæœºè¿ç§»æŒ‡å— ğŸ”„"},{"content":"Docker éƒ¨ç½² WordPress åšå®¢ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² WordPress 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ WordPress 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åˆå§‹è®¾ç½® âš™ï¸ 3. ä¸»é¢˜å’Œæ’ä»¶å®‰è£… ğŸ¨ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå†…å®¹åˆ›ä½œï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ WordPress å®˜ç½‘åœ°å€ï¼š https://cn.wordpress.org/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/WordPress/WordPress ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/_/wordpress WordPress æ˜¯å…¨çƒæœ€å—æ¬¢è¿çš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰ï¼Œé€šè¿‡ Docker éƒ¨ç½²å¯ä»¥å¿«é€Ÿæ­å»ºä¸ªäººåšå®¢ã€ä¼ä¸šç½‘ç«™æˆ–ç”µå­å•†åŠ¡å¹³å°ã€‚æœ¬æŒ‡å—æä¾›å®Œæ•´çš„éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ Nginx åå‘ä»£ç†ã€æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å†…å®¹ç®¡ç† å…¨çƒæœ€å—æ¬¢è¿çš„å†…å®¹ç®¡ç†ç³»ç»Ÿ åŠŸèƒ½ä¸°å¯Œï¼Œç”Ÿæ€å®Œå–„ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker ä¸€é”®éƒ¨ç½² å¿«é€Ÿæ­å»ºï¼Œæ˜“äºç»´æŠ¤ ğŸ“± å“åº”å¼è®¾è®¡ æ”¯æŒå¤šç§è®¾å¤‡è®¿é—® æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘å®Œç¾é€‚é… ğŸ”Œ æ’ä»¶ç”Ÿæ€ æµ·é‡æ’ä»¶å’Œä¸»é¢˜é€‰æ‹© åŠŸèƒ½æ— é™æ‰©å±• âš¡ æ€§èƒ½ä¼˜åŒ– æ”¯æŒç¼“å­˜å’Œ CDN åŠ é€Ÿ å¿«é€ŸåŠ è½½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ”’ å®‰å…¨å¯é  å®šæœŸå®‰å…¨æ›´æ–°å’Œç¤¾åŒºæ”¯æŒ ä¿éšœç½‘ç«™å®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² WordPress 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 mkdir -p /mnt/mydisk/home/wordpress \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: # MySQL æ•°æ®åº“æœåŠ¡ db: image: mysql:5.7 volumes: - ./mysql:/var/lib/mysql restart: unless-stopped environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress networks: - wordpress-network # WordPress åº”ç”¨æœåŠ¡ wordpress: depends_on: - db image: wordpress:latest volumes: - ./html:/var/www/html - ./html/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini ports: - \u0026#34;8686:80\u0026#34; restart: unless-stopped environment: WORDPRESS_DB_HOST: db WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress WORDPRESS_DB_NAME: wordpress networks: - wordpress-network networks: wordpress-network: driver: bridge EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ WordPress 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8686 åå°ç®¡ç†: http://localhost:8686/wp-admin/ åŸŸåè®¿é—®: https://wordpress.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åˆå§‹è®¾ç½® âš™ï¸ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ é€‰æ‹©è¯­è¨€ï¼ˆå»ºè®®é€‰æ‹©ä¸­æ–‡ï¼‰ å¡«å†™æ•°æ®åº“ä¿¡æ¯ï¼ˆä½¿ç”¨ docker-compose.yml ä¸­çš„é…ç½®ï¼‰ è®¾ç½®ç½‘ç«™æ ‡é¢˜å’Œç®¡ç†å‘˜è´¦æˆ· å®Œæˆå®‰è£…å¹¶ç™»å½•åå° 3. ä¸»é¢˜å’Œæ’ä»¶å®‰è£… ğŸ¨ å®‰è£… Argon ä¸»é¢˜ 1 2 3 4 5 # ä¸‹è½½å¹¶å®‰è£… Argon ä¸»é¢˜ cd /mnt/mydisk/home/wordpress/html/wp-content/themes wget https://github.com/solstice23/argon-theme/releases/latest/download/argon.zip unzip argon.zip rm argon.zip å®‰è£… QPlayer2 éŸ³ä¹æ’­æ”¾å™¨æ’ä»¶ 1 2 3 4 5 # ä¸‹è½½å¹¶å®‰è£… QPlayer2 æ’ä»¶ cd /mnt/mydisk/home/wordpress/html/wp-content/plugins wget https://github.com/moeshin/QPlayer2-WordPress/archive/refs/heads/master.zip unzip master.zip rm master.zip ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://wordpress.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/wordpress.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name wordpress.example.com; # SSL è¯ä¹¦é…ç½® ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; # TLS å®‰å…¨é…ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256; ssl_prefer_server_ciphers off; # å®‰å…¨å“åº”å¤´ add_header Strict-Transport-Security \u0026#34;max-age=31536000\u0026#34; always; add_header X-Content-Type-Options nosniff always; add_header X-Frame-Options SAMEORIGIN always; # åå‘ä»£ç†é…ç½® location / { proxy_pass http://localhost:8686; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # è¶…æ—¶è®¾ç½® proxy_connect_timeout 300s; proxy_send_timeout 300s; proxy_read_timeout 300s; } # é”™è¯¯é¡µé¢ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/wordpress # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop wordpress # åœæ­¢WordPresså®¹å™¨ docker stop wordpress_db # åœæ­¢æ•°æ®åº“å®¹å™¨ docker start wordpress # å¯åŠ¨WordPresså®¹å™¨ docker restart wordpress # é‡å¯WordPresså®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm wordpress # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f wordpress # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it wordpress bash # ä½¿ç”¨bashè¿›å…¥WordPresså®¹å™¨ docker exec -it wordpress_db bash # ä½¿ç”¨bashè¿›å…¥æ•°æ®åº“å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect wordpress # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats wordpress # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs wordpress # æŸ¥çœ‹æ—¥å¿— docker logs -f wordpress # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 wordpress # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t wordpress # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå†…å®¹åˆ›ä½œï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† WordPress åšå®¢ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° å‘å¸ƒå’Œåˆ†äº«å†…å®¹ï¼Œæ— è®ºæ˜¯ä¸ªäººéšç¬”ã€æŠ€æœ¯åšå®¢è¿˜æ˜¯å•†ä¸šç½‘ç«™ï¼Œéƒ½èƒ½è½»æ¾æ­å»º\nğŸ“ å®Œå…¨è‡ªä¸» æŒæ§å†…å®¹åˆ›ä½œå¹³å°ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ŒçœŸæ­£æ‹¥æœ‰è‡ªå·±çš„æ•°å­—ç©ºé—´\nğŸ” éšç§å®‰å…¨ æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œè‡ªå®šä¹‰å®‰å…¨ç­–ç•¥ï¼Œä¿éšœå†…å®¹å’Œä¸ªäººä¿¡æ¯çš„å®‰å…¨\nğŸ¨ æ— é™æ‰©å±• æµ·é‡ä¸»é¢˜å’Œæ’ä»¶é€‰æ‹©ï¼Œæ ¹æ®éœ€æ±‚å®šåˆ¶åŠŸèƒ½ï¼Œæ‰“é€ ç‹¬ä¸€æ— äºŒçš„ç½‘ç«™ä½“éªŒ\nå†…å®¹ä¸ºç‹ï¼Œåˆ›æ„æ— é™ã€‚æ„¿ WordPress æˆä¸ºä½ è¡¨è¾¾æ€æƒ³ã€åˆ†äº«çŸ¥è¯†çš„å¾—åŠ›å¹³å°ï¼Œé™ªä¼´ä½ åœ¨å†…å®¹åˆ›ä½œçš„æ—…ç¨‹ä¸­ä¸æ–­æˆé•¿ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œä¹¦å†™æ•…äº‹ï¼Œåˆ†äº«è§è§£â€”â€”æ„å»ºä½ ç‹¬ä¸€æ— äºŒçš„æ•°å­—å®¶å›­å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ WordPress å®˜æ–¹æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸å®‰å…¨è¡¥ä¸ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ WordPress ä¸­æ–‡è®ºå› å¯»æ±‚å¸®åŠ©ã€‚\nç¥ä½ åˆ›ä½œæ„‰å¿«ï¼Œçµæ„Ÿä¸æ–­ï¼ğŸ‰\n","date":"2024-12-07T19:51:18+08:00","image":"https://file.meimolihan.eu.org/img/wordpress-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c6c71bf1/","title":"Docker éƒ¨ç½² WordPress åšå®¢ ğŸ³"},{"content":"Emby TV ç ´è§£ç‰ˆä¸‹è½½ â¬ ä¸€ ã€ Emby-tv ç ´è§£ç‰ˆä¸‹è½½ 1 ã€ğŸ§‘â€ğŸ’»ç™»å½•è®ºå› è®ºå›åœ°å€ï¼šhttps://www.openos.org/threads/2024-05-15embyv3-3-87-v2-1-09gtv.5231/\nç”¨æˆ·åï¼šmeimolihan å¯†ç ï¼šå°å­©å+ç”Ÿ é‚®ç®±ï¼šmeimolihan@live.com\n2 ã€â¬ä¸‹è½½armeabi-v7a, arm64-v8a: æ–‡ä»¶åï¼šEmby_for_Android_TV_2.1.09g_arm_K.apk\narmeabi-v7a, arm64-v8a: ä¸‹è½½åœ°å€ï¼šhttps://devuploads.com/uhmbsdcbvkwr ä¸‹è½½åœ°å€ï¼šhttps://mega4upload.com/5euf0ga60iaj ä¸‹è½½åœ°å€ï¼šhttps://dropgalaxy.vip/new0ufo3zlj2 x86, x86_64: ä¸‹è½½åœ°å€ï¼šhttps://devuploads.com/afsy61w74hdu ä¸‹è½½åœ°å€ï¼šhttps://mega4upload.com/eolxeenos3la ä¸‹è½½åœ°å€ï¼šhttps://dropgalaxy.vip/31ai0ppiksk8 äºŒ ã€å®‰è£…emby-tvç ´è§£ç‰ˆ åˆ©ç”¨ç›’å­åŠ©æ‰‹è¿æ¥ç”µè§†ADBå®‰è£…\nâ¤ï¸ ç›’å­åŠ©æ‰‹è·³è½¬é“¾æ¥ï¼šhttps://www.mobufan.xyz:4443/archives/tvhelper\n","date":"2024-12-07T19:47:03+08:00","image":"https://file.meimolihan.eu.org/img/emby-01.webp","permalink":"https://blog.meimolihan.eu.org/p/82425ee8/","title":"Emby TV ç ´è§£ç‰ˆä¸‹è½½ â¬"},{"content":"Docker éƒ¨ç½² TVHelper â€” æ‚Ÿç©ºç›’å­åŠ©æ‰‹ ğŸ“¦ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² TVHelper 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ TVHelper 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ“¦ å¯èˆªç®¡ç†ï¼ŒæŒæ§æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/wukongdaily/tvhelper-docker ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/wukongdaily/box TVHelper ï¼ˆæ‚Ÿç©ºç›’å­åŠ©æ‰‹ï¼‰æ˜¯ä¸€æ¬¾ä¸“ä¸ºå®‰å“ç”µè§†ç›’å­è®¾è®¡çš„ Docker åŒ– ADBï¼ˆAndroid Debug Bridgeï¼‰ç®¡ç†å·¥å…·ã€‚å®ƒå¯ä»¥è®©æ‚¨ä½¿ç”¨ç”µè„‘ã€NAS ç­‰èƒ½è¿è¡Œ Docker çš„è®¾å¤‡æ¥è½»æ¾ç®¡ç†ç”µè§†ç›’å­ï¼Œæä¾›ä¸€é”®åº”ç”¨å®‰è£…ã€NTP æœåŠ¡å™¨ä¿®æ”¹ã€è®¾å¤‡è°ƒè¯•ç­‰åŠŸèƒ½ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ TVHelperï¼Œå®ç°å¯¹ç”µè§†ç›’å­çš„ä¾¿æ·ç®¡ç†ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“¦ åº”ç”¨ç®¡ç† æ”¯æŒä¸€é”®æ‰¹é‡å®‰è£…ä¸»æœºä¸ŠæŒ‡å®šç›®å½•çš„å…¨éƒ¨ APK ç®€åŒ–åº”ç”¨éƒ¨ç½²è¿‡ç¨‹ï¼Œæé«˜æ•ˆç‡ â° æ—¶é—´åŒæ­¥ ä¸€é”®ä¿®æ”¹å®‰å“åŸç”Ÿç”µè§†ç›’å­/TV çš„ NTP æœåŠ¡å™¨åœ°å€ ç¡®ä¿è®¾å¤‡æ—¶é—´å‡†ç¡®ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ ğŸ”§ è®¾å¤‡è°ƒè¯• æä¾›å®Œæ•´çš„ ADB è°ƒè¯•åŠŸèƒ½ æ–¹ä¾¿è®¾å¤‡æ•…éšœæ’æŸ¥å’Œç³»ç»Ÿä¼˜åŒ– ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² æ”¯æŒ Docker Compose å’Œ Docker CLI ä¸€é”®éƒ¨ç½² éƒ¨ç½²ç®€å•ï¼Œç¯å¢ƒä¸€è‡´ï¼Œæ˜“äºç»´æŠ¤ ğŸ“º æµåª’ä½“æ”¯æŒ ä¸ºå›½è¡Œ Sony ç”µè§†å®‰è£…æµè¡Œçš„æµåª’ä½“åº”ç”¨ æ‰©å±•ç”µè§†åŠŸèƒ½ï¼Œä¸°å¯Œå¨±ä¹ä½“éªŒ ğŸ—ï¸ å¤šæ¶æ„å…¼å®¹ å…¼å®¹ ARMv7/ARM64/x86_64 ç­‰å¤šç§ç¡¬ä»¶å¹³å° é€‚ç”¨èŒƒå›´å¹¿ï¼Œçµæ´»æ€§å¼º ğŸ” è¿œç¨‹è®¿é—® æ”¯æŒ SSH è¿œç¨‹ç®¡ç†å®¹å™¨ æ–¹ä¾¿è¿›è¡Œé«˜çº§è°ƒè¯•å’Œè½¯ä»¶æ›´æ–° ğŸ³ ä¸€ã€Docker éƒ¨ç½² TVHelper 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/tvhelper \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: tvhelper: container_name: tvhelper image: wukongdaily/box:latest restart: always ports: - \u0026#34;2288:80\u0026#34; # Web ç•Œé¢è®¿é—®ç«¯å£ - \u0026#34;2299:22\u0026#34; # SSH è®¿é—®ç«¯å£ volumes: - ./data:/tvhelper/shells/data # APK æ–‡ä»¶å­˜å‚¨ç›®å½• environment: - TZ=Asia/Shanghai # è®¾ç½®æ—¶åŒº EOF ğŸ’¡ æç¤ºï¼šä½ å¯ä»¥ä½¿ç”¨ Docker é•œåƒåŠ é€Ÿæºæ¥æ‹‰å–é•œåƒï¼š\n1 docker pull dockerproxy.com/wukongdaily/box:latest 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ TVHelper 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:2288 ç½‘ç»œè®¿é—®ï¼š http://æœåŠ¡å™¨IP:2288 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ å‡†å¤‡ APK æ–‡ä»¶ï¼šå°†éœ€è¦å®‰è£…çš„ APK æ–‡ä»¶æ”¾åœ¨ä¸»æœºçš„ ./data ç›®å½•ä¸‹ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ˜ å°„åˆ°å®¹å™¨å†…çš„ /tvhelper/shells/data ç›®å½•ã€‚ è®¿é—® Web ç•Œé¢ï¼šæ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ã€‚ SSH è®¿é—®ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚éœ€ä½¿ç”¨ SSH ç®¡ç†å®¹å™¨ï¼š 1 ssh root@æœåŠ¡å™¨IP -p 2299 SSH é»˜è®¤ç”¨æˆ·åï¼šrootï¼Œå¯†ç ï¼špasswordã€‚ è¿è¡Œä¸»è„šæœ¬ï¼šåœ¨å®¹å™¨ Shell æˆ– SSH ä¸­æ‰§è¡Œä¸»è„šæœ¬ï¼š 1 ./tv.sh ç®¡ç†è®¾å¤‡ï¼šæŒ‰ç…§è„šæœ¬æç¤ºæ“ä½œï¼Œå¦‚ä¿®æ”¹ç›’å­çš„ NTP æœåŠ¡å™¨åœ°å€ã€æ‰¹é‡å®‰è£… APK ç­‰ã€‚ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/tvhelper # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop tvhelper # åœæ­¢å®¹å™¨ docker start tvhelper # å¯åŠ¨å®¹å™¨ docker restart tvhelper # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it tvhelper sh # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it tvhelper sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect tvhelper # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats tvhelper # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs tvhelper # æŸ¥çœ‹æ—¥å¿— docker logs -f tvhelper # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 tvhelper # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t tvhelper # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ“¦ å¯èˆªç®¡ç†ï¼ŒæŒæ§æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† TVHelperï¼ˆæ‚Ÿç©ºç›’å­åŠ©æ‰‹ï¼‰ï¼ŒæŒæ¡äº†é€šè¿‡ ADB è½»æ¾ç®¡ç†ç”µè§†ç›’å­çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“º ä¾¿æ·ç®¡ç† ä¸€é”®æ‰¹é‡å®‰è£…ã€æ›´æ–°ç”µè§†ç›’å­åº”ç”¨ï¼Œå‘Šåˆ«ç¹ççš„æ‰‹åŠ¨æ“ä½œ\nâ° æ—¶é—´åŒæ­¥ è½»æ¾ä¿®æ”¹ NTP æœåŠ¡å™¨åœ°å€ï¼Œç¡®ä¿è®¾å¤‡æ—¶é—´å‡†ç¡®ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§\nğŸ”§ é«˜æ•ˆè°ƒè¯• é€šè¿‡å®Œæ•´çš„ ADB åŠŸèƒ½å¿«é€Ÿæ’æŸ¥è®¾å¤‡é—®é¢˜ï¼Œä¼˜åŒ–ç”µè§†ç›’å­æ€§èƒ½\nğŸŒ è¿œç¨‹æ§åˆ¶ éšæ—¶éšåœ°é€šè¿‡ Web ç•Œé¢æˆ– SSH ç®¡ç†ä½ çš„ç”µè§†è®¾å¤‡ï¼Œæ‰“ç ´ç©ºé—´é™åˆ¶\nTVHelper ä¸ä»…æ˜¯å·¥å…·ï¼Œæ›´æ˜¯è¿æ¥ä½ ä¸æ™ºèƒ½ç”µè§†è®¾å¤‡çš„ä¾¿æ·æ¡¥æ¢ã€‚æ„¿è¿™ä¸ªåŠ©æ‰‹è®©ä½ å¯¹ç”µè§†ç›’å­çš„ç®¡ç†å˜å¾—æ›´åŠ ç®€å•ã€é«˜æ•ˆï¼Œå……åˆ†é‡Šæ”¾è®¾å¤‡çš„æ½œåœ¨èƒ½åŠ›ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè½»æ¾ç®¡ç†ä½ çš„ç”µè§†ç›’å­ï¼Œäº«å—æ›´æ™ºèƒ½çš„å¤§å±ä½“éªŒï¼ğŸ–¥ï¸\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ TVHelper å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œç®¡ç†è‡ªå¦‚ï¼ğŸ‰\n","date":"2024-12-07T19:46:04+08:00","image":"https://file.meimolihan.eu.org/img/tvhelper-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dcf62082/","title":"Docker éƒ¨ç½² TVHelper â€” æ‚Ÿç©ºç›’å­åŠ©æ‰‹ ğŸ“¦"},{"content":"Emby UIç¾åŒ–æ’ä»¶åŠç›¸å…³ CSS JS æ–‡ä»¶ æœ¬æ•™ç¨‹é€‚ç”¨äºdockerå®¹å™¨å®‰è£…çš„embyæœåŠ¡ç«¯ï¼Œå…¶ä»–æœåŠ¡ç«¯æˆ‘æ²¡æœ‰åšè¿‡æµ‹è¯•ã€‚ æœ¬é¡¹ç›®ä¼šä¸ºä½ çš„embyå®‰è£…ä¸€ä¸ªå¯è‡ªå®šä¹‰cssã€jsçš„æ’ä»¶ï¼Œæ’ä»¶å®‰è£…å¥½ä¹‹åå¡«å…¥ç›¸åº”çš„cssæˆ–jsæ–‡ä»¶ï¼Œå³å¯ç¾åŒ–ä½ çš„embyå®¢æˆ·ç«¯ç•Œé¢ï¼Œé¡¹ç›®æ¥è‡ªäºgithubï¼Œæˆ‘åªæ˜¯åšäº†ç§»æ¤å’Œè„šæœ¬çš„æ›´æ”¹ã€‚åŸæ¥çš„æ’ä»¶è„šæœ¬å®‰è£…å¥½ä¹‹åæ²¡æœ‰åŠæ³•å®ç°å¸è½½åˆ é™¤æ“ä½œï¼Œæˆ‘å†æ¬¡åŸºç¡€ä¸Šå¯¹è„šæœ¬è¿›è¡Œäº†æ›´æ–°ï¼Œå®ç°å¯ä»¥ä¸€é”®å®‰è£…ï¼Œä¸€é”®å¸è½½ç­‰åŠŸèƒ½ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬é¡¹ç›®å…¶å®ä»½ä¸¤éƒ¨åˆ†ã€‚ ç¬¬ä¸€éƒ¨åˆ†æ˜¯æ’ä»¶çš„å®‰è£…ï¼Œæ’ä»¶è‡ªèº«å¹¶æ²¡æœ‰ç¾åŒ–åŠŸèƒ½ï¼Œéœ€è¦ç¾åŒ–åŠŸèƒ½éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰csså’Œjsã€‚ ç¬¬äºŒéƒ¨åˆ†æ˜¯æˆ‘åœ¨ç½‘ä¸Šæ”¶é›†äº†å¤§ä½¬å·²ç»åšå¥½çš„csså’Œjsï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨å®‰è£…å¥½æ’ä»¶åå¡«å…¥å³å¯ç›´æ¥ä½¿ç”¨ã€‚\nè¯¦ç»†è§†é¢‘å®‰è£…æ•™ç¨‹ï¼š https://www.bilibili.com/video/BV1yz42127YH/ ä¸€ ã€Debian æœåŠ¡å™¨å®‰è£…æ’ä»¶ 1 ã€æ’ä»¶ä¸€é”®å®‰è£…è„šæœ¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 # ä¸»åœ°å€ï¼š bash -c \u0026#34;$(curl -sLk https://xn--tkrq60cewc.top/ssh/CustomCssJS.sh)\u0026#34; # å¤‡ç”¨åœ°å€1ï¼š bash -c \u0026#34;$(curl -sLk https://tvbox.zybapi.com/Js/CustomCssJS.sh)\u0026#34; # å¤‡ç”¨åœ°å€2ï¼š wget -O script.sh --no-check-certificate https://tvbox.zybapi.com/Js/CustomCssJS.sh \u0026amp;\u0026amp; bash script.sh # å®¹å™¨åç§° emby-amilys 2 ã€ç½‘é¡µæœåŠ¡ç«¯åŠå®¢æˆ·ç«¯å®‰è£…æ–¹æ³• ä¸€é”®è„šæœ¬å®‰è£…ä¹‹åï¼Œåœ¨embyåå°æ‰¾åˆ°Custom Css and JavaScripæ’ä»¶ï¼Œåœ¨é‡Œé¢å¡«å…¥ç›¸åº”çš„csså’Œjsæ–‡ä»¶ï¼Œç„¶åå›åˆ°å‰ç«¯ä¸»é¡µåˆ·æ–°ç½‘é¡µå³å¯å‘ˆç° windowå®¢æˆ·ç«¯ä¿®æ”¹æ•™ç¨‹ å¤åˆ¶CustomCssJS.jsæ–‡ä»¶åˆ°electronapp\\pluginsç›®å½•ä¸‹é¢ï¼Œç„¶åé‡å¯ä¸€ä¸‹embyå®¢æˆ·ç«¯\n3 ã€å®‰å“å®¢æˆ·ç«¯å®‰è£…åæ•™ç¨‹ åœ¨å®‰å“å®¢æˆ·ç«¯éœ€è¦ä¿®æ”¹apkæ–‡ä»¶åç„¶åé‡æ–°æ‰“åŒ…apkæ–‡ä»¶ å®‰è£…ä¿®æ”¹å¥½çš„apkæ–‡ä»¶å³å¯\nå…·ä½“æ“ä½œä¸ºï¼š å¤åˆ¶CustomCssJS.jsæ–‡ä»¶åˆ°assets\\www\\modulesç›®å½•ä¸‹ ä¿®æ”¹assets\\www\\app.jsï¼Œåœ¨å‡½æ•°start()ä¸­Promise.all(list.map(loadPlugin))å‰æ–°å¢list.push(\u0026quot;./modules/CustomCssJS.js\u0026quot;), ä¿®æ”¹assets\\www\\native\\android\\apphost.jsï¼Œå°†features.restrictedpluginsè®¾ä¸ºfalse 4 ã€å¤§ä½¬ç¾åŒ–åˆé›† åœ°å€ï¼šhttps://github.com/jackloves111/EMBY.JS.CSS/tree/main\näºŒ ã€æ’ä»¶ä½¿ç”¨ï¼ˆæˆ‘åœ¨ä½¿ç”¨çš„ï¼‰é€‚é…4.8.5æ­£å¼ç‰ˆå’Œ4.9.0.16æµ‹è¯•ç‰ˆ 1 ã€éšè—æ²¡æœ‰å¤´åƒçš„æ¼”å‘˜å’Œåˆ¶ä½œäººå‘˜.js ä½œè€…åœ°å€ï¼šhttps://github.com/newday-life/emby-front-end-mod/tree/main/actorPlus actorPlus.jsæ–‡ä»¶ ç‚¹å‡»ä¸‹è½½ï¼šhttps://file.mobufan.eu.org:666/downloads/emby/actorPlus.js\n2 ã€ä¸»é¡µè½®æ’­å¤§å›¾ç‰ˆ 2.0 è‡ªç”¨é…ç½®-æ–°.js ä½œè€…åœ°å€ï¼šhttps://github.com/jackloves111/EMBY.JS.CSS/blob/main è‡ªç”¨é…ç½®-æ–°.jsä¸‹è½½ï¼šhttps://file.mobufan.eu.org:666/downloads/emby/my.js\n3 ã€emby-misty é€‚é…æ‰‹æœº ä½œè€…åœ°å€ï¼šhttps://github.com/jackloves111/EMBY.JS.CSS/tree/main/ ç‚¹å‡»ä¸‹è½½ï¼šhttps://file.mobufan.eu.org:666/downloads/emby/emby-misty.js ç‚¹å‡»ä¸‹è½½ï¼šhttps://file.mobufan.eu.org:666/downloads/emby/emby-misty.css\n4 ã€lunbo å½“æ¨ªå±æ—¶ï¼Œéšè—æˆ‘çš„åª’ä½“ï¼Œä»¥å…å’Œå¤§å›¾åª’ä½“é‡å¤ 1 2 3 4 5 6 7 8 9 /*å½“æ¨ªå±æ—¶ï¼Œéšè—æˆ‘çš„åª’ä½“ï¼Œä»¥å…å’Œå¤§å›¾åª’ä½“é‡å¤*/ @media not all and (max-width: 50em) { .section0 { display: none; } .cardLibText { display: none; } } ","date":"2024-12-07T19:43:15+08:00","image":"https://file.meimolihan.eu.org/img/emby-01.webp","permalink":"https://blog.meimolihan.eu.org/p/46ed0e7f/","title":"Emby UIç¾åŒ–æ’ä»¶åŠç›¸å…³ CSS JS æ–‡ä»¶"},{"content":"Linux æ–‡ä»¶ç›®å½•ç»“æ„å®Œå…¨æŒ‡å— ğŸ§ Linux æ–‡ä»¶ç›®å½•ç»“æ„æ˜¯ä»»ä½• Linux ç³»ç»Ÿçš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚å®ƒä¸ºç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„æ–‡ä»¶å’Œç›®å½•ç»„ç»‡æ–¹å¼ï¼Œä½¿å¾—ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼è®¿é—®å’Œç®¡ç†æ–‡ä»¶ã€‚ä¸ Windows ç³»ç»Ÿä¸åŒï¼ŒLinux çš„æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨å•ä¸€çš„æ ‘å½¢ç»“æ„ï¼Œä»æ ¹ç›®å½•ï¼ˆ/ï¼‰å¼€å§‹ï¼Œæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•éƒ½åœ¨å…¶ä¸‹ã€‚ç†è§£è¿™ä¸€ç»“æ„ä¸ä»…å¯¹äºç³»ç»Ÿç®¡ç†å‘˜è‡³å…³é‡è¦ï¼Œå¯¹äºæ™®é€šç”¨æˆ·ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©æ›´æœ‰æ•ˆåœ°ç®¡ç†æ–‡ä»¶å’Œè§£å†³é—®é¢˜ã€‚\nğŸ“– ç›®å½•å¯¼èˆª ğŸ“ æ ¹ç›®å½•ï¼ˆ/ï¼‰ ğŸ“Š è¯¦ç»†ç›®å½•è¯´æ˜ 1. /bin - åŸºæœ¬å‘½ä»¤ç›®å½• 2. /sbin - ç³»ç»Ÿç®¡ç†å‘½ä»¤ 3. /etc - é…ç½®æ–‡ä»¶ç›®å½• 4. /dev - è®¾å¤‡æ–‡ä»¶ç›®å½• 5. /tmp - ä¸´æ—¶æ–‡ä»¶ç›®å½• 6. /home - ç”¨æˆ·ä¸»ç›®å½• 7. /var - å¯å˜æ•°æ®ç›®å½• 8. /usr - ç”¨æˆ·ç¨‹åºç›®å½• 9. /opt - é™„åŠ è½¯ä»¶ç›®å½• 10. /mnt \u0026amp; /media - æŒ‚è½½ç›®å½• 11. /boot - å¯åŠ¨ç›®å½• 12. /lib - åº“æ–‡ä»¶ç›®å½• 13. /proc - è¿›ç¨‹ä¿¡æ¯ç›®å½• 14. /sys - ç³»ç»Ÿä¿¡æ¯ç›®å½• 15. /root - rootç”¨æˆ·ç›®å½• ğŸ”— ç‰¹æ®Šç›®å½•å’Œé“¾æ¥ ğŸ’¡ å®ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ ğŸš¨ æ³¨æ„äº‹é¡¹ ğŸ¯ æ€»ç»“ ğŸŒŸ æ¸©é¦¨æç¤º ğŸ“ æ ¹ç›®å½•ï¼ˆ/ï¼‰ æ ¹ç›®å½•ï¼ˆ/ï¼‰æ˜¯ Linux æ–‡ä»¶ç³»ç»Ÿçš„é¡¶å±‚ç›®å½•ã€‚æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•éƒ½ä»è¿™é‡Œå¼€å§‹ï¼Œå½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚æ ¹ç›®å½•ä¸‹çš„æ¯ä¸ªå­ç›®å½•éƒ½æœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½å’Œç”¨é€”ã€‚\nç›®å½• è¯´æ˜ é‡è¦æ€§ /bin åŸºæœ¬ç”¨æˆ·å‘½ä»¤ â­â­â­â­â­ /sbin ç³»ç»Ÿç®¡ç†å‘½ä»¤ â­â­â­â­â­ /etc ç³»ç»Ÿé…ç½®æ–‡ä»¶ â­â­â­â­â­ /dev è®¾å¤‡æ–‡ä»¶ â­â­â­â­ /tmp ä¸´æ—¶æ–‡ä»¶ â­â­â­ /home ç”¨æˆ·ä¸»ç›®å½• â­â­â­â­â­ /var å¯å˜æ•°æ®æ–‡ä»¶ â­â­â­â­ /usr ç”¨æˆ·çº§åº”ç”¨ç¨‹åº â­â­â­â­â­ /opt é™„åŠ è½¯ä»¶åŒ… â­â­â­ /mnt ä¸´æ—¶æŒ‚è½½ç‚¹ â­â­â­ /media å¯ç§»åŠ¨è®¾å¤‡æŒ‚è½½ â­â­â­ /boot å¯åŠ¨æ–‡ä»¶ â­â­â­â­ /lib ç³»ç»Ÿåº“æ–‡ä»¶ â­â­â­â­ /proc è¿›ç¨‹ä¿¡æ¯ â­â­â­â­ /sys ç³»ç»Ÿä¿¡æ¯ â­â­â­ /root rootç”¨æˆ·ç›®å½• â­â­â­â­ ğŸ“Š è¯¦ç»†ç›®å½•è¯´æ˜ 1. /bin - åŸºæœ¬å‘½ä»¤ç›®å½• ğŸ› ï¸ åŒ…å«ç³»ç»Ÿå¯åŠ¨å’Œå•ç”¨æˆ·æ¨¡å¼ä¸‹ä½¿ç”¨çš„åŸºæœ¬å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤æ˜¯ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ‰€å¿…éœ€çš„ã€‚\nå¸¸è§å‘½ä»¤ï¼š\nls - åˆ—å‡ºç›®å½•å†…å®¹ cp - å¤åˆ¶æ–‡ä»¶ mv - ç§»åŠ¨æ–‡ä»¶ rm - åˆ é™¤æ–‡ä»¶ cat - æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ echo - è¾“å‡ºæ–‡æœ¬ ğŸ’¡ è¿™äº›å‘½ä»¤é€šå¸¸æ˜¯é™æ€é“¾æ¥çš„ï¼Œç¡®ä¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ä¸ä¾èµ–äºå…¶ä»–åº“æ–‡ä»¶ã€‚\n2. /sbin - ç³»ç»Ÿç®¡ç†å‘½ä»¤ âš™ï¸ åŒ…å«ç³»ç»Ÿç®¡ç†å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤é€šå¸¸éœ€è¦è¶…çº§ç”¨æˆ·æƒé™æ‰§è¡Œã€‚\nå¸¸è§å‘½ä»¤ï¼š\nifconfig - ç½‘ç»œé…ç½® reboot - é‡å¯ç³»ç»Ÿ shutdown - å…³é—­ç³»ç»Ÿ fdisk - ç£ç›˜åˆ†åŒº mkfs - åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ 3. /etc - é…ç½®æ–‡ä»¶ç›®å½• ğŸ“‹ åŒ…å«æ‰€æœ‰çš„ç³»ç»Ÿå…¨å±€é…ç½®æ–‡ä»¶ã€‚\né‡è¦æ–‡ä»¶ï¼š\n/etc/passwd - ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ /etc/fstab - æ–‡ä»¶ç³»ç»ŸæŒ‚è½½è¡¨ /etc/hosts - ä¸»æœºåè§£æ /etc/hostname - ç³»ç»Ÿä¸»æœºå /etc/network/interfaces - ç½‘ç»œé…ç½® 4. /dev - è®¾å¤‡æ–‡ä»¶ç›®å½• ğŸ’¾ åŒ…å«è®¾å¤‡æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¡¨ç¤ºç³»ç»Ÿä¸­çš„å„ç§ç¡¬ä»¶è®¾å¤‡ã€‚\nå¸¸è§è®¾å¤‡ï¼š\n/dev/sda - ç¬¬ä¸€å—ç¡¬ç›˜ /dev/tty - ç»ˆç«¯è®¾å¤‡ /dev/null - ç©ºè®¾å¤‡ /dev/random - éšæœºæ•°ç”Ÿæˆå™¨ 5. /tmp - ä¸´æ—¶æ–‡ä»¶ç›®å½• ğŸ—‘ï¸ ç”¨äºå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šåœ¨æ¯æ¬¡å¯åŠ¨æ—¶æ¸…ç†æ­¤ç›®å½•ã€‚\nâš ï¸ æ³¨æ„ï¼šæ­¤ç›®å½•é€šå¸¸å¯¹æ‰€æœ‰ç”¨æˆ·å¯è¯»å†™ï¼Œéœ€æ³¨æ„æ–‡ä»¶å®‰å…¨ã€‚\n6. /home - ç”¨æˆ·ä¸»ç›®å½• ğŸ‘¨â€ğŸ’» æ¯ä¸ªç”¨æˆ·åœ¨æ­¤ç›®å½•ä¸‹æœ‰ç‹¬ç«‹çš„å­ç›®å½•ã€‚\nå…¸å‹ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 /home/ â”œâ”€â”€ username1/ â”‚ â”œâ”€â”€ Documents/ â”‚ â”œâ”€â”€ Downloads/ â”‚ â”œâ”€â”€ Pictures/ â”‚ â””â”€â”€ .bashrc â””â”€â”€ username2/ â”œâ”€â”€ Documents/ â””â”€â”€ .profile 7. /var - å¯å˜æ•°æ®ç›®å½• ğŸ“Š å­˜æ”¾ç³»ç»Ÿè¿è¡Œæ—¶äº§ç”Ÿçš„å¯å˜æ•°æ®ã€‚\né‡è¦å­ç›®å½•ï¼š\n/var/log - ç³»ç»Ÿæ—¥å¿— /var/mail - ç”¨æˆ·é‚®ä»¶ /var/spool - é˜Ÿåˆ—æ–‡ä»¶ /var/cache - ç¼“å­˜æ–‡ä»¶ /var/www - WebæœåŠ¡å™¨æ–‡ä»¶ 8. /usr - ç”¨æˆ·ç¨‹åºç›®å½• ğŸ¯ å­˜æ”¾ç”¨æˆ·çº§åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶ã€‚\nå­ç›®å½•ç»“æ„ï¼š\n/usr/bin - ç”¨æˆ·å‘½ä»¤ /usr/sbin - ç³»ç»Ÿç®¡ç†å‘½ä»¤ /usr/lib - åº“æ–‡ä»¶ /usr/share - å…±äº«æ•°æ® /usr/local - æœ¬åœ°å®‰è£…è½¯ä»¶ 9. /opt - é™„åŠ è½¯ä»¶ç›®å½• ğŸ“¦ ç”¨äºå®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…ã€‚\nç¤ºä¾‹ï¼š\n/opt/google/chrome - Chromeæµè§ˆå™¨ /opt/jetbrains/idea - IntelliJ IDEA 10. /mnt \u0026amp; /media - æŒ‚è½½ç›®å½• ğŸ”— /mnt - æ‰‹åŠ¨æŒ‚è½½ç‚¹ /media - è‡ªåŠ¨æŒ‚è½½å¯ç§»åŠ¨è®¾å¤‡ 11. /boot - å¯åŠ¨ç›®å½• ğŸš€ åŒ…å«å¯åŠ¨åŠ è½½ç¨‹åºå’Œå†…æ ¸æ–‡ä»¶ã€‚\né‡è¦æ–‡ä»¶ï¼š\nvmlinuz - Linuxå†…æ ¸ initrd.img - åˆå§‹RAMç£ç›˜ grub/ - GRUBå¼•å¯¼ç¨‹åº 12. /lib - åº“æ–‡ä»¶ç›®å½• ğŸ“š åŒ…å«ç³»ç»Ÿåº“æ–‡ä»¶å’Œå†…æ ¸æ¨¡å—ã€‚\n13. /proc - è¿›ç¨‹ä¿¡æ¯ç›®å½• ğŸ” è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…å«ç³»ç»Ÿå’Œè¿›ç¨‹ä¿¡æ¯ã€‚\né‡è¦æ–‡ä»¶ï¼š\n/proc/cpuinfo - CPUä¿¡æ¯ /proc/meminfo - å†…å­˜ä¿¡æ¯ /proc/uptime - è¿è¡Œæ—¶é—´ 14. /sys - ç³»ç»Ÿä¿¡æ¯ç›®å½• âš™ï¸ è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œæä¾›ç³»ç»Ÿè®¾å¤‡å’Œå†…æ ¸ä¿¡æ¯ã€‚\n15. /root - rootç”¨æˆ·ç›®å½• ğŸ‘‘ è¶…çº§ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚\nğŸ”— ç‰¹æ®Šç›®å½•å’Œé“¾æ¥ ç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ åˆ›å»ºç¬¦å·é“¾æ¥ï¼š\n1 ln -s /path/to/target /path/to/link å¸¸è§ç¬¦å·é“¾æ¥ï¼š\n/bin/sh â†’ /bin/bash /etc/localtime â†’ /usr/share/zoneinfo/Region/City å…¶ä»–é‡è¦ç›®å½• ç›®å½• è¯´æ˜ /run è¿è¡Œæ—¶æ•°æ® /srv æœåŠ¡æ•°æ® /lost+found æ¢å¤çš„æ–‡ä»¶ ğŸ’¡ å®ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ 1. è·¯å¾„ç®¡ç†æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å½“å‰ç›®å½• pwd # åˆ‡æ¢ç›®å½• cd /path/to/directory # è¿”å›ä¸Šçº§ç›®å½• cd .. # è¿”å›å®¶ç›®å½• cd ~ 2. æƒé™ç®¡ç† 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ–‡ä»¶æƒé™ ls -la # ä¿®æ”¹æ–‡ä»¶æƒé™ chmod 755 filename # ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€… chown user:group filename 3. ç£ç›˜ç©ºé—´ç®¡ç† 1 2 3 4 5 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h # æŸ¥çœ‹ç›®å½•å¤§å° du -sh /path/to/directory 4. æŸ¥æ‰¾æ–‡ä»¶ 1 2 3 4 5 6 7 8 # æŒ‰åç§°æŸ¥æ‰¾ find / -name \u0026#34;filename\u0026#34; # æŒ‰ç±»å‹æŸ¥æ‰¾ find / -type f -name \u0026#34;*.conf\u0026#34; # æŒ‰å¤§å°æŸ¥æ‰¾ find / -size +100M ğŸš¨ æ³¨æ„äº‹é¡¹ ä¸è¦éšæ„åˆ é™¤ç³»ç»Ÿæ–‡ä»¶ - ç‰¹åˆ«æ˜¯ /bin, /sbin, /etc ä¸­çš„æ–‡ä»¶ å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶ - æ¸…ç† /tmp å’Œ /var/tmp ç›‘æ§ç£ç›˜ç©ºé—´ - ç‰¹åˆ«å…³æ³¨ /var å’Œ /home çš„å¢é•¿ å¤‡ä»½é‡è¦æ•°æ® - å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’Œä¸ªäººæ•°æ® ç†è§£æƒé™ç³»ç»Ÿ - æ­£ç¡®è®¾ç½®æ–‡ä»¶å’Œç›®å½•æƒé™ ğŸ¯ æ€»ç»“ Linux æ–‡ä»¶ç›®å½•ç»“æ„æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„å±‚æ¬¡åŒ–ç³»ç»Ÿï¼Œæ¯ä¸ªç›®å½•éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”ï¼š\nç³»ç»Ÿæ ¸å¿ƒï¼š/bin, /sbin, /etc, /lib ç”¨æˆ·æ•°æ®ï¼š/home, /root è¿è¡Œæ—¶æ•°æ®ï¼š/var, /tmp, /run è½¯ä»¶èµ„æºï¼š/usr, /opt è®¾å¤‡ç®¡ç†ï¼š/dev, /proc, /sys æŒ‚è½½ç‚¹ï¼š/mnt, /media ç†è§£è¿™ä¸ªç»“æ„å°†å¸®åŠ©æ‚¨ï¼š\nâœ… æ›´æœ‰æ•ˆåœ°ç®¡ç†ç³»ç»Ÿ âœ… å¿«é€Ÿå®šä½æ–‡ä»¶å’Œé…ç½® âœ… è§£å†³ç³»ç»Ÿé—®é¢˜ âœ… ä¼˜åŒ–ç£ç›˜ç©ºé—´ä½¿ç”¨ âœ… æé«˜å·¥ä½œæ•ˆç‡ è®°ä½ï¼šåœ¨ Linux ä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼ ğŸ§\nğŸŒŸ æ¸©é¦¨æç¤º å­¦ä¹ å‘½ä»¤ï¼šç†Ÿç»ƒæŒæ¡ ls, cd, pwd, find ç­‰åŸºæœ¬å‘½ä»¤ ç†è§£æƒé™ï¼šæŒæ¡æ–‡ä»¶æƒé™å’Œæ‰€æœ‰è€…çš„æ¦‚å¿µ å®šæœŸå¤‡ä»½ï¼šé‡è¦æ•°æ®ä¸€å®šè¦å®šæœŸå¤‡ä»½ è°¨æ…æ“ä½œï¼šç‰¹åˆ«æ˜¯ä½¿ç”¨ root æƒé™æ—¶ æŒç»­å­¦ä¹ ï¼šLinux æ–‡ä»¶ç³»ç»Ÿæœ‰å¾ˆå¤šé«˜çº§ç‰¹æ€§å€¼å¾—æ¢ç´¢ ç°åœ¨æ‚¨å·²ç»æŒæ¡äº† Linux æ–‡ä»¶ç›®å½•ç»“æ„çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œå¼€å§‹æ¢ç´¢æ‚¨çš„ Linux ç³»ç»Ÿå§ï¼ğŸš€\n","date":"2024-12-07T19:42:35+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/afae1856/","title":"Linux æ–‡ä»¶ç›®å½•ç»“æ„å®Œå…¨æŒ‡å— ğŸ§"},{"content":"Docker Compose ç¼–æ’è¯´æ˜ ğŸ³ ğŸ“– ç›®å½•å¯¼èˆª âœ¨ Docker Compose ç‰¹ç‚¹ä¸ä¼˜åŠ¿ ğŸš€ ä¸€ã€å¿«é€Ÿåˆ›å»º Docker Compose æ–‡ä»¶ ğŸ“ äºŒã€Docker Compose æ–‡ä»¶è¯¦ç»†è¯´æ˜ âš™ï¸ ä¸‰ã€é…ç½®é¡¹è¯¦è§£ 1ï¸âƒ£ Docker é‡å¯ç­–ç•¥ 2ï¸âƒ£ ç«¯å£æ˜ å°„ 3ï¸âƒ£ å·æ˜ å°„ 4ï¸âƒ£ ç¯å¢ƒå˜é‡ 5ï¸âƒ£ ç½‘ç»œæ¨¡å¼ 6ï¸âƒ£ ä¸»æœºæ˜ å°„ 7ï¸âƒ£ å®¹å™¨ä¸»æœºå ğŸ› ï¸ å››ã€é«˜çº§é…ç½®ç¤ºä¾‹ ğŸ’¡ äº”ã€å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸš¦ å…­ã€å¸¸ç”¨å‘½ä»¤ ğŸ¯ ä¸ƒã€æ•…éšœæ’é™¤ä¸è°ƒè¯• ğŸ“š æ€»ç»“ âœ¨ Docker Compose ç‰¹ç‚¹ä¸ä¼˜åŠ¿ Docker Compose æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nğŸ—ï¸ ç®€åŒ–éƒ¨ç½²ï¼šä½¿ç”¨ YAML æ–‡ä»¶å®šä¹‰å¤šå®¹å™¨åº”ç”¨ï¼Œä¸€é”®éƒ¨ç½² ğŸ”„ ç¯å¢ƒä¸€è‡´æ€§ï¼šç¡®ä¿å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒçš„ä¸€è‡´æ€§ ğŸ“‹ å£°æ˜å¼é…ç½®ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†åº”ç”¨æœåŠ¡ã€ç½‘ç»œå’Œå· âš¡ å¿«é€Ÿå¯åŠ¨ï¼šä¸€æ¡å‘½ä»¤å³å¯å¯åŠ¨æ•´ä¸ªåº”ç”¨æ ˆ ğŸ”— æœåŠ¡ä¾èµ–ï¼šè‡ªåŠ¨å¤„ç†æœåŠ¡é—´çš„ä¾èµ–å…³ç³»å’Œå¯åŠ¨é¡ºåº ğŸŒ ç½‘ç»œç®¡ç†ï¼šè‡ªåŠ¨åˆ›å»ºå®¹å™¨ç½‘ç»œï¼Œæ–¹ä¾¿æœåŠ¡é—´é€šä¿¡ ğŸ“¦ ç‰ˆæœ¬æ§åˆ¶ï¼šé…ç½®æ–‡ä»¶å¯çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ ğŸ”§ çµæ´»æ‰©å±•ï¼šæ”¯æŒå¤šç¯å¢ƒé…ç½®å’Œæ‰©å±•å­—æ®µ ğŸ“Š èµ„æºç®¡ç†ï¼šå¯é™åˆ¶å®¹å™¨ä½¿ç”¨çš„ CPU å’Œå†…å­˜èµ„æº ğŸš€ ä¸€ã€å¿«é€Ÿåˆ›å»º Docker Compose æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ– docker-compose.yml æ–‡ä»¶ mkdir -p /mnt/mydisk/home/toolbox \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; /mnt/mydisk/home/toolbox/docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„æœåŠ¡é…ç½® EOF # å¯åŠ¨æœåŠ¡ cd /mnt/mydisk/home/toolbox \u0026amp;\u0026amp; docker-compose up -d ğŸ“ äºŒã€Docker Compose æ–‡ä»¶è¯¦ç»†è¯´æ˜ åŸºæœ¬ç»“æ„ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 version: \u0026#34;3.8\u0026#34; # ä½¿ç”¨çš„ Docker Compose æ–‡ä»¶ç‰ˆæœ¬ services: # å®šä¹‰æœåŠ¡ toolbox: # æœåŠ¡åç§°(å¯è‡ªå®šä¹‰) container_name: toolbox # å®¹å™¨åç§°(å¯è‡ªå®šä¹‰) image: cleverest/toolbox:latest # é•œåƒç‰ˆæœ¬ restart: unless-stopped # é‡å¯ç­–ç•¥ network_mode: bridge # ç½‘ç»œæ¨¡å¼ ports: # ç«¯å£æ˜ å°„ - \u0026#34;8383:80\u0026#34; # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ volumes: # å·æ˜ å°„ - /var/run/docker.sock:/var/run/docker.sock # Docker å¼•æ“äº¤äº’ - ./app/data:/app/data # ç›¸å¯¹è·¯å¾„æ˜ å°„ - /mnt:/mnt # ç»å¯¹è·¯å¾„æ˜ å°„ environment: # ç¯å¢ƒå˜é‡ - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® - PUID=1000 # ç”¨æˆ·ID - PGID=1000 # ç”¨æˆ·ç»„ID extra_hosts: # ä¸»æœºæ˜ å°„ - \u0026#34;api.telegram.org:149.154.167.220\u0026#34; - \u0026#34;api.tmdb.org:18.66.102.107\u0026#34; hostname: toolbox # å®¹å™¨ä¸»æœºå command: [\u0026#34;--debug\u0026#34;] # è¦†ç›–é»˜è®¤å¯åŠ¨å‘½ä»¤ depends_on: # æœåŠ¡ä¾èµ– - database - redis database: # å¦ä¸€ä¸ªæœåŠ¡ç¤ºä¾‹ image: postgres:13 environment: - POSTGRES_DB=mydb - POSTGRES_USER=user - POSTGRES_PASSWORD=pass volumes: - db_data:/var/lib/postgresql/data volumes: # å®šä¹‰å‘½åå· db_data: âš™ï¸ ä¸‰ã€é…ç½®é¡¹è¯¦è§£ 1ï¸âƒ£ Docker é‡å¯ç­–ç•¥ 1 2 3 4 restart: \u0026#34;no\u0026#34; # âŒ å®¹å™¨é€€å‡ºæ—¶ä¸é‡å¯ï¼ˆé»˜è®¤å€¼ï¼‰ restart: always # ğŸ”„ æ€»æ˜¯é‡å¯å®¹å™¨ï¼ˆæ— è®ºé€€å‡ºçŠ¶æ€ï¼‰ restart: on-failure # âš ï¸ ä»…åœ¨éé›¶é€€å‡ºçŠ¶æ€æ—¶é‡å¯ restart: unless-stopped # ğŸ›‘ é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯ 2ï¸âƒ£ ç«¯å£æ˜ å°„ 1 2 3 4 5 6 ports: - \u0026#34;8383:80\u0026#34; # å°†å®¿ä¸»æœºçš„8383ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„80ç«¯å£ - \u0026#34;8443:443\u0026#34; # å°†å®¿ä¸»æœºçš„8443ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„443ç«¯å£ - \u0026#34;9000:9000/tcp\u0026#34; # æŒ‡å®šTCPåè®® - \u0026#34;9000:9000/udp\u0026#34; # æŒ‡å®šUDPåè®® - \u0026#34;49100-49200:3000-3100\u0026#34; # ç«¯å£èŒƒå›´æ˜ å°„ 3ï¸âƒ£ å·æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 volumes: # ç»‘å®šæŒ‚è½½ï¼ˆä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„ï¼‰ - /host/path:/container/path # ç»å¯¹è·¯å¾„ - ./relative/path:/container/path # ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºComposeæ–‡ä»¶ï¼‰ # å‘½åå·ï¼ˆéœ€è¦åœ¨é¡¶å±‚volumeséƒ¨åˆ†å®šä¹‰ï¼‰ - named_volume:/container/path # åŒ¿åå·ï¼ˆä¸æ¨èï¼Œéš¾ä»¥ç®¡ç†ï¼‰ - /container/path # åªè¯»æŒ‚è½½ - /host/path:/container/path:ro 4ï¸âƒ£ ç¯å¢ƒå˜é‡ 1 2 3 4 5 6 7 8 9 10 11 12 environment: - TZ=Asia/Shanghai # è®¾ç½®æ—¶åŒº - PUID=1000 # è®¾ç½®ç”¨æˆ·ID - PGID=1000 # è®¾ç½®ç»„ID - DEBUG=true # å¸ƒå°”å€¼ - MAX_CONNECTIONS=100 # æ•°å­—å€¼ # æˆ–è€…ä½¿ç”¨å­—å…¸æ ¼å¼ environment: TZ: Asia/Shanghai PUID: 1000 PGID: 1000 5ï¸âƒ£ ç½‘ç»œæ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ä½¿ç”¨é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œ network_mode: bridge # ä½¿ç”¨ä¸»æœºç½‘ç»œï¼ˆå®¹å™¨ç›´æ¥ä½¿ç”¨ä¸»æœºç½‘ç»œæ ˆï¼‰ network_mode: host # ä½¿ç”¨å…¶ä»–å®¹å™¨çš„ç½‘ç»œæ ˆ network_mode: service:service_name # ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œï¼ˆæ¨èç”¨äºå¤šå®¹å™¨åº”ç”¨ï¼‰ networks: - frontend - backend # åœ¨æ–‡ä»¶åº•éƒ¨å®šä¹‰ç½‘ç»œ networks: frontend: driver: bridge backend: driver: bridge internal: true # å†…éƒ¨ç½‘ç»œï¼Œä¸å¯¹å¤–æš´éœ² 6ï¸âƒ£ ä¸»æœºæ˜ å°„ 1 2 3 4 extra_hosts: - \u0026#34;api.telegram.org:149.154.167.220\u0026#34; # åŸŸå:IP - \u0026#34;api.tmdb.org:18.66.102.107\u0026#34; - \u0026#34;local.example.com:127.0.0.1\u0026#34; 7ï¸âƒ£ å®¹å™¨ä¸»æœºå 1 2 hostname: my-container # è®¾ç½®å®¹å™¨ä¸»æœºå domainname: example.com # è®¾ç½®å®¹å™¨åŸŸå ğŸ› ï¸ å››ã€é«˜çº§é…ç½®ç¤ºä¾‹ èµ„æºé™åˆ¶ 1 2 3 4 5 6 7 8 deploy: resources: limits: memory: 2G # ğŸ’ª å†…å­˜é™åˆ¶ï¼ˆæ ¹æ®éœ€æ±‚è°ƒæ•´ï¼‰ cpus: \u0026#39;2.0\u0026#39; # âš¡ CPUé™åˆ¶ reservations: memory: 512M # ğŸ›Œ å†…å­˜ä¿ç•™ cpus: \u0026#39;1.0\u0026#39; # ğŸ”‹ CPUä¿ç•™ å¥åº·æ£€æŸ¥ 1 2 3 4 5 6 healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:3000/health\u0026#34;] interval: 30s timeout: 10s retries: 3 start_period: 40s æ—¥å¿—é…ç½® 1 2 3 4 5 logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;200k\u0026#34; max-file: \u0026#34;10\u0026#34; ğŸ’¡ äº”ã€å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ 1. ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # å¼•ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶ env_file: - .env - .env.production # .env æ–‡ä»¶ç¤ºä¾‹ TZ=Asia/Shanghai PUID=1000 PGID=1000 DB_HOST=database DB_PORT=5432 2. å¤šç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 # docker-compose.yml version: \u0026#34;3.8\u0026#34; services: app: image: myapp:${TAG:-latest} ports: - \u0026#34;${HOST_PORT}:8080\u0026#34; environment: - DB_HOST=${DB_HOST} 1 2 3 4 5 6 # ä½¿ç”¨ä¸åŒçš„ç¯å¢ƒå˜é‡æ–‡ä»¶ # å¼€å‘ç¯å¢ƒ docker-compose -f docker-compose.yml -f docker-compose.dev.yml up # ç”Ÿäº§ç¯å¢ƒ docker-compose -f docker-compose.yml -f docker-compose.prod.yml up 3. æ‰©å±•é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä½¿ç”¨æ‰©å±•å­—æ®µé¿å…é‡å¤é…ç½® x-common-environment: \u0026amp;common-env TZ: Asia/Shanghai PUID: 1000 PGID: 1000 services: app1: environment: \u0026lt;\u0026lt;: *common-env SPECIFIC_VAR: value1 app2: environment: \u0026lt;\u0026lt;: *common-env SPECIFIC_VAR: value2 ğŸš¦ å…­ã€å¸¸ç”¨å‘½ä»¤ å¯åŠ¨æœåŠ¡ 1 2 3 4 5 6 7 8 # å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°æ¨¡å¼ï¼‰ docker-compose up -d # å¯åŠ¨ç‰¹å®šæœåŠ¡ docker-compose up -d service_name # å¼ºåˆ¶é‡æ–°åˆ›å»ºå®¹å™¨ docker-compose up -d --force-recreate åœæ­¢æœåŠ¡ 1 2 3 4 5 6 7 8 # åœæ­¢æ‰€æœ‰æœåŠ¡ docker-compose down # åœæ­¢æœåŠ¡ä½†ä¿ç•™å· docker-compose down --volumes # åœæ­¢æœåŠ¡å¹¶åˆ é™¤æ‰€æœ‰èµ„æº docker-compose down --rmi all --volumes --remove-orphans æŸ¥çœ‹çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs docker-compose logs -f # å®æ—¶æ—¥å¿— docker-compose logs service_name # ç‰¹å®šæœåŠ¡æ—¥å¿— # æŸ¥çœ‹æœåŠ¡èµ„æºä½¿ç”¨æƒ…å†µ docker-compose top ç®¡ç†æœåŠ¡ 1 2 3 4 5 6 7 8 # é‡å¯æœåŠ¡ docker-compose restart # ç¼©æ”¾æœåŠ¡å®ä¾‹æ•° docker-compose up -d --scale service_name=3 # æ‰§è¡Œå‘½ä»¤ in å®¹å™¨ docker-compose exec service_name command ğŸ¯ ä¸ƒã€æ•…éšœæ’é™¤ä¸è°ƒè¯• 1. éªŒè¯é…ç½®æ–‡ä»¶ 1 2 # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• docker-compose config 2. æŸ¥çœ‹è¯¦ç»†æ—¥å¿— 1 2 3 4 5 # æŸ¥çœ‹è¯¦ç»†æ—¥å¿— docker-compose logs --tail=100 -f # æŸ¥çœ‹å®¹å™¨å†…éƒ¨ docker-compose exec service_name sh 3. æ¸…ç†èµ„æº 1 2 3 4 5 6 7 8 # æ¸…ç†æœªä½¿ç”¨çš„èµ„æº docker-compose down --remove-orphans # æ¸…ç†æ‰€æœ‰åœæ­¢çš„å®¹å™¨ docker container prune # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ docker image prune ğŸ“š æ€»ç»“ Docker Compose æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–å¤šå®¹å™¨åº”ç”¨çš„ç®¡ç†å’Œéƒ¨ç½²ã€‚é€šè¿‡åˆç†çš„é…ç½®å’Œæœ€ä½³å®è·µï¼Œä½ å¯ä»¥è½»æ¾ç®¡ç†å¤æ‚çš„åº”ç”¨ç¯å¢ƒã€‚\nå…³é”®è¦ç‚¹ï¼š\nâœ… ä½¿ç”¨å£°æ˜å¼ YAML æ–‡ä»¶å®šä¹‰æœåŠ¡ âœ… åˆç†é…ç½®ç½‘ç»œã€å·å’Œç¯å¢ƒå˜é‡ âœ… åˆ©ç”¨å¤šç¯å¢ƒé…ç½®æé«˜çµæ´»æ€§ âœ… å®æ–½èµ„æºé™åˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ âœ… å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„èµ„æº å¿«ä¹ç¼–æ’ï¼ ğŸš€âœ¨\nğŸ’¡ æç¤ºï¼šå§‹ç»ˆå°†ä½ çš„ docker-compose.yml æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä»¥ä¾¿è·Ÿè¸ªæ›´æ”¹å’Œåä½œå¼€å‘ã€‚å®šæœŸæ›´æ–° Docker é•œåƒä»¥ç¡®ä¿å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚\n","date":"2024-12-07T19:40:52+08:00","image":"https://file.meimolihan.eu.org/img/docker-compose-01.webp","permalink":"https://blog.meimolihan.eu.org/p/294bdc54/","title":"Docker Compose ç¼–æ’è¯´æ˜ ğŸ³"},{"content":"Markdown åµŒå…¥è§†é¢‘ Markdown åµŒå…¥è§†é¢‘é“¾æ¥ 1 \u0026lt;video src=\u0026#34;https://blog.mobufan.eu.org:666/video/å’Œé£å¤©æ°”æ—¶é’Ÿæ’ä»¶å®‰è£….mp4\u0026#34; controls=\u0026#34;controls\u0026#34; width=\u0026#34;650\u0026#34; height=\u0026#34;300\u0026#34;\u0026gt;\u0026lt;/video\u0026gt; Markdown åµŒå…¥å“”å“©å“”å“©è§†é¢‘ è·å¾—å“”å“©å“”å“©è§†é¢‘åµŒå…¥ä»£ç æ–¹æ³• å“”å“©å“”å“©ç‚¹å‡»åˆ†äº«æŒ‰é’®ï¼Œç‚¹å‡»åµŒå…¥ä»£ç ï¼Œä¼šè‡ªåŠ¨å¤åˆ¶å†…å®¹ å“”å“©å“”å“©è§†é¢‘åµŒå…¥å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š \u0026lt;iframe src=\u0026quot;//player.bilibili.com/player.html?isOutside=true\u0026amp;aid=327623069\u0026amp;bvid=BV1JA411h7Gw\u0026amp;cid=171385214\u0026amp;p=1\u0026quot; scrolling=\u0026quot;no\u0026quot; border=\u0026quot;0\u0026quot; frameborder=\u0026quot;no\u0026quot; framespacing=\u0026quot;0\u0026quot; allowfullscreen=\u0026quot;true\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026quot;\nä¸€ ã€é¦–å…ˆå°†ä¸Šé¢çš„ä»£ç æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ˆæ–¹ä¾¿ç†è§£ï¼‰ ç¬¬ä¸€éƒ¨åˆ† ã€è§†é¢‘é“¾æ¥å‚æ•°éƒ¨åˆ† åŸè§†é¢‘é“¾æ¥å‚æ•°éƒ¨åˆ†ï¼š \u0026lt;iframe src=\u0026quot;//player.bilibili.com/player.htmlï¼ŸisOutside=true\u0026amp;aid=327623069\u0026amp;bvid=BV1JA411h7Gw\u0026amp;cid=171385214\u0026amp;p=1\u0026quot;\nå°†è§†é¢‘é“¾æ¥å‚æ•°éƒ¨åˆ†ï¼Œåœ¨ç¬¬ä¸€ä¸ªåŒå¼•å·é‡Œé¢æœ€åä¸ç”¨åŠ ç©ºæ ¼æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 \u0026amp;high_quality=1\u0026amp;danmaku=0\u0026amp;autoplay=0 æ·»åŠ çš„å†…å®¹è¯´æ˜å¦‚ä¸‹ï¼š high_quality\t1 æœ€é«˜ç”»è´¨ 0 æœ€ä½ç”»è´¨ danmaku\t1 æ‰“å¼€å¼¹å¹• 0 å…³é—­å¼¹å¹• autoplay\t1 æ‰“å¼€è‡ªåŠ¨æ’­æ”¾ 0 å…³é—­è‡ªåŠ¨æ’­æ”¾ è¿™æ˜¯ã€Šè§†é¢‘é“¾æ¥å‚æ•°ã€‹ä¿®æ”¹åçš„æ ·å­\n\u0026lt;iframe src=\u0026quot;//player.bilibili.com/player.html?isOutside=true\u0026amp;aid=327623069\u0026amp;bvid=BV1JA411h7Gw\u0026amp;cid=171385214\u0026amp;p=1\u0026amp;high_quality=1\u0026amp;danmaku=0\u0026amp;autoplay=0\u0026quot;\nç¬¬äºŒéƒ¨åˆ† ã€iframe å‚æ•°éƒ¨åˆ† åŸè§†é¢‘çš„ \u0026ldquo;iframe\u0026rdquo; å‚æ•°: scrolling=\u0026quot;no\u0026quot; border=\u0026quot;0\u0026quot; frameborder=\u0026quot;no\u0026quot; framespacing=\u0026quot;0\u0026quot; allowfullscreen=\u0026quot;true\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt; å°†ä¸Šé¢çš„iframe å‚æ•°ï¼Œåœ¨ \u0026quot;true\u0026quot; åé¢ åŠ ç©ºæ ¼ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š 1 sandbox=\u0026#34;allow-top-navigation allow-same-origin allow-forms allow-scripts\u0026#34; width=\u0026#34;100%\u0026#34; height=\u0026#34;446\u0026#34; æ·»åŠ çš„å†…å®¹è¯´æ˜å¦‚ä¸‹ï¼š allowfullscreen å…è®¸å…¨å± **true **å…è®¸ **false **ä¸å…è®¸ width å®½åº¦åƒç´  height é«˜åº¦åƒç´  sandbox=\u0026ldquo;allow-top-navigation allow-same-origin allow-forms allow-scripts \u0026ldquo;ç¦æ­¢å¼¹å‡ºç½‘é¡µ è¿™æ˜¯ã€Šiframe å‚æ•°ã€‹ä¿®æ”¹åçš„æ ·å­\nscrolling=\u0026quot;no\u0026quot; border=\u0026quot;0\u0026quot; frameborder=\u0026quot;no\u0026quot; framespacing=\u0026quot;0\u0026quot; allowfullscreen=\u0026quot;true\u0026quot; sandbox=\u0026quot;allow-top-navigation allow-same-origin allow-forms allow-scripts\u0026quot; width=\u0026quot;100%\u0026quot; height=\u0026quot;446\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\näºŒ ã€ åˆå¹¶ä¸¤æ®µä¸­é—´åŠ ç©ºæ ¼ä¿®æ”¹åçš„ä»£ç ï¼š \u0026lt;iframe src=\u0026quot;//player.bilibili.com/player.html?isOutside=true\u0026amp;aid=327623069\u0026amp;bvid=BV1JA411h7Gw\u0026amp;cid=171385214\u0026amp;p=1\u0026amp;high_quality=1\u0026amp;danmaku=0\u0026amp;autoplay=0\u0026quot; scrolling=\u0026quot;no\u0026quot; border=\u0026quot;0\u0026quot; frameborder=\u0026quot;no\u0026quot; framespacing=\u0026quot;0\u0026quot; allowfullscreen=\u0026quot;true\u0026quot; sandbox=\u0026quot;allow-top-navigation allow-same-origin allow-forms allow-scripts\u0026quot; width=\u0026quot;100%\u0026quot; height=\u0026quot;446\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\næˆ‘æ˜¯ã€ŠMarkdown è§†é¢‘è¯­æ³•ã€‹ç¤ºä¾‹ï¼š\n","date":"2024-12-07T17:47:10+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/markdown-%E5%B5%8C%E5%85%A5%E8%A7%86%E9%A2%91/","title":"Markdown åµŒå…¥è§†é¢‘"},{"content":"Docker éƒ¨ç½² Docker-UI å®¹å™¨ç®¡ç†ç³»ç»Ÿ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Docker-UI 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç®¡ç†ï¼ŒæŒæ§æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/gohutool/docker.ui ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/jonnyan404/docker-ui Docker-UI æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Docker å®¹å™¨ Web ç®¡ç†ç•Œé¢ï¼Œæä¾›ç›´è§‚çš„å›¾å½¢åŒ–ç•Œé¢æ¥ç®¡ç† Docker å®¹å™¨ã€é•œåƒã€ç½‘ç»œå’Œå·ã€‚é€šè¿‡ç®€å•çš„éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾ç›‘æ§å’Œç®¡ç†æ‚¨çš„ Docker ç¯å¢ƒï¼Œæ— éœ€è®°å¿†å¤æ‚çš„å‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ–¥ï¸ å¯è§†åŒ–ç®¡ç† é€šè¿‡ Web ç•Œé¢è½»æ¾ç®¡ç† Docker èµ„æº æ— éœ€è®°å¿†å¤æ‚å‘½ä»¤è¡ŒæŒ‡ä»¤ ğŸ“Š å®æ—¶ç›‘æ§ å®æ—¶æŸ¥çœ‹å®¹å™¨çŠ¶æ€ã€èµ„æºä½¿ç”¨æƒ…å†µå’Œæ—¥å¿— å…¨é¢æŒæ¡ Docker ç¯å¢ƒçŠ¶æ€ ğŸ”„ ä¾¿æ·æ“ä½œ ä¸€é”®å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œåˆ é™¤å®¹å™¨ ç®€åŒ–å®¹å™¨ç®¡ç†æ“ä½œ ğŸ—ï¸ é•œåƒç®¡ç† æµè§ˆæœ¬åœ°é•œåƒã€æ‹‰å–æ–°é•œåƒå’Œåˆ é™¤æ— ç”¨é•œåƒ æ–¹ä¾¿é•œåƒç»´æŠ¤å’Œæ¸…ç† ğŸŒ ç½‘ç»œç®¡ç† æŸ¥çœ‹å’Œç®¡ç† Docker ç½‘ç»œé…ç½® ç›´è§‚ç®¡ç†ç½‘ç»œè®¾ç½® ğŸ’¾ å·ç®¡ç† ç®¡ç† Docker æ•°æ®å·å’Œç»‘å®šæŒ‚è½½ ç®€åŒ–æ•°æ®æŒä¹…åŒ–ç®¡ç† ğŸ”’ å®‰å…¨è®¿é—® æä¾›åŸºæœ¬çš„èº«ä»½éªŒè¯ä¿æŠ¤ ä¿éšœç®¡ç†ç•Œé¢å®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Docker-UI 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 mkdir -p /mnt/mydisk/home/docker-ui \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: docker-ui: container_name: docker-ui image: jonnyan404/docker-ui:latest restart: unless-stopped ports: - \u0026#34;8999:8999\u0026#34; volumes: - /var/run/docker.sock:/var/run/docker.sock environment: - TZ=Asia/Shanghai EOF ğŸ” å®‰å…¨æç¤ºï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8999 IPè®¿é—®: http://æœåŠ¡å™¨IP:8999 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼š ç”¨æˆ·åï¼šginghan å¯†ç ï¼š123456 ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  å¼€å§‹ç®¡ç† Docker å®¹å™¨ã€é•œåƒå’Œç½‘ç»œ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://docker.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/docker-ui.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name docker.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8999; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/docker-ui # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop docker-ui docker start docker-ui docker restart docker-ui # åˆ é™¤å®¹å™¨ docker rm docker-ui docker rm -f docker-ui # è¿›å…¥å®¹å™¨Shell docker exec -it docker-ui sh docker exec -it docker-ui bash # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect docker-ui docker stats docker-ui # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs docker-ui docker logs -f docker-ui docker logs --tail 100 docker-ui docker logs -t docker-ui 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi jonnyan404/docker-ui:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªç®¡ç†ï¼ŒæŒæ§æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Docker-UI å®¹å™¨ç®¡ç†ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ–¥ï¸ å¯è§†åŒ–ç®¡ç† é€šè¿‡ç›´è§‚çš„ Web ç•Œé¢è½»æ¾ç®¡ç†æ‰€æœ‰ Docker èµ„æºï¼Œå‘Šåˆ«å¤æ‚å‘½ä»¤è¡Œ\nğŸ“Š å®æ—¶ç›‘æ§ å…¨é¢æŒæ¡å®¹å™¨çŠ¶æ€å’Œèµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°å¹¶è§£å†³é—®é¢˜\nâš¡ ä¾¿æ·æ“ä½œ ä¸€é”®å®Œæˆå®¹å™¨å¯åœã€é•œåƒç®¡ç†ç­‰æ—¥å¸¸è¿ç»´ä»»åŠ¡\nç®¡ç†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸å®¹å™¨æŠ€æœ¯ç›¸ä¼´çš„è¿ç»´è‰ºæœ¯ã€‚æ„¿ Docker-UI æˆä¸ºä½ å¾—åŠ›çš„è¿ç»´åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å®¹å™¨ç®¡ç†å’ŒæœåŠ¡ç»´æŠ¤çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå¯è§†åŒ–è¿ç»´ï¼Œé«˜æ•ˆç®¡ç†â€”â€”æ„å»ºä½ ç¨³å®šå¯é çš„å®¹å™¨ç¯å¢ƒå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Docker-UI å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è¿ç»´æ„‰å¿«ï¼Œç®¡ç†æœ‰æˆï¼ğŸ‰\n","date":"2024-12-07T16:54:02+08:00","image":"https://file.meimolihan.eu.org/img/dicker-02.webp","permalink":"https://blog.meimolihan.eu.org/p/e8c56c51/","title":"Docker éƒ¨ç½² Docker-UI å®¹å™¨ç®¡ç†ç³»ç»Ÿ ğŸ³"},{"content":"Docker éƒ¨ç½² AutoCompose å®¹å™¨è½¬ Compose æ–‡ä»¶ç”Ÿæˆå™¨ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€å®‰è£… Docker AutoCompose 1. æ‹‰å– Docker AutoCompose é•œåƒ ğŸ“¦ ğŸš€ äºŒã€ä½¿ç”¨ Docker AutoCompose 1. åŸºæœ¬ç”¨æ³•ï¼šåœ¨ç»ˆç«¯æ˜¾ç¤º Compose é…ç½® ğŸ’» 2. é«˜çº§ç”¨æ³•ï¼šä¿å­˜åˆ°æ–‡ä»¶ ğŸ’¾ 3. ç”Ÿæˆå¤šä¸ªå®¹å™¨çš„ Compose é…ç½® ğŸ”§ ğŸ”§ ä¸‰ã€ç»´æŠ¤å‘½ä»¤ 1. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå®¹å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Red5d/docker-autocompose Docker AutoCompose æ˜¯ä¸€ä¸ªå®ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å°†æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨åå‘å·¥ç¨‹ä¸º Docker Compose é…ç½®æ–‡ä»¶ã€‚è¿™å¯¹äºä»ç°æœ‰å®¹å™¨é‡å»ºç¯å¢ƒã€å¤‡ä»½å®¹å™¨é…ç½®æˆ–è¿ç§»å®¹å™¨éå¸¸æœ‰ç”¨ã€‚\næ³¨æ„ï¼šè¿™ä¸æ˜¯ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ Docker Compose å®¹å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œéœ€è¦åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”„ åå‘å·¥ç¨‹ å°†è¿è¡Œä¸­çš„å®¹å™¨è½¬æ¢ä¸º Compose é…ç½® å¿«é€Ÿä»ç°æœ‰å®¹å™¨ç”Ÿæˆé…ç½®æ–‡ä»¶ ğŸ³ å®¹å™¨å…¼å®¹ æ”¯æŒå„ç§ Docker å®¹å™¨ç±»å‹ å¹¿æ³›é€‚ç”¨äºä¸åŒåº”ç”¨åœºæ™¯ ğŸ“ é…ç½®å¯¼å‡º ç”Ÿæˆæ ‡å‡†çš„ docker-compose.yml æ–‡ä»¶ ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œåˆ†äº« âš¡ å¿«é€Ÿä½¿ç”¨ ç®€å•çš„å‘½ä»¤è¡Œæ“ä½œ æ— éœ€å¤æ‚é…ç½®ï¼Œå³è£…å³ç”¨ ğŸ”§ çµæ´»è¾“å‡º æ”¯æŒç»ˆç«¯æ˜¾ç¤ºæˆ–ä¿å­˜åˆ°æ–‡ä»¶ é€‚åº”ä¸åŒä½¿ç”¨éœ€æ±‚ ğŸ³ ä¸€ã€å®‰è£… Docker AutoCompose 1. æ‹‰å– Docker AutoCompose é•œåƒ ğŸ“¦ 1 docker pull ghcr.io/red5d/docker-autocompose:latest ğŸš€ äºŒã€ä½¿ç”¨ Docker AutoCompose 1. åŸºæœ¬ç”¨æ³•ï¼šåœ¨ç»ˆç«¯æ˜¾ç¤º Compose é…ç½® ğŸ’» 1 2 # è¯­æ³•ï¼šdocker run --rm -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/red5d/docker-autocompose [å®¹å™¨åç§°] docker run --rm -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/red5d/docker-autocompose npm ç¤ºä¾‹è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 services: npm: image: jc21/nginx-proxy-manager:latest container_name: npm restart: unless-stopped ports: - \u0026#34;80:80\u0026#34; - \u0026#34;81:81\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./data:/data - ./letsencrypt:/etc/letsencrypt environment: - DB_SQLITE_FILE=/data/database.sqlite 2. é«˜çº§ç”¨æ³•ï¼šä¿å­˜åˆ°æ–‡ä»¶ ğŸ’¾ 1 2 # åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•å¹¶ç”Ÿæˆ docker-compose.yml æ–‡ä»¶ cd /mnt \u0026amp;\u0026amp; docker run --rm -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/red5d/docker-autocompose npm \u0026gt; docker-compose.yml éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶ï¼š\n1 cat /mnt/docker-compose.yml 3. ç”Ÿæˆå¤šä¸ªå®¹å™¨çš„ Compose é…ç½® ğŸ”§ 1 2 # ä¸ºå¤šä¸ªå®¹å™¨ç”Ÿæˆç»Ÿä¸€çš„ Compose æ–‡ä»¶ cd /mnt \u0026amp;\u0026amp; docker run --rm -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/red5d/docker-autocompose npm wordpress mysql \u0026gt; docker-compose.yml 1 2 3 # ä¸ºæ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆé…ç½® CONTAINERS=$(docker ps --format \u0026#34;{{.Names}}\u0026#34; | tr \u0026#39;\\n\u0026#39; \u0026#39; \u0026#39;) cd /mnt \u0026amp;\u0026amp; docker run --rm -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/red5d/docker-autocompose $CONTAINERS \u0026gt; docker-compose.yml ğŸ”§ ä¸‰ã€ç»´æŠ¤å‘½ä»¤ 1. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker images # åˆ é™¤æŒ‡å®šé•œåƒ docker rmi ghcr.io/red5d/docker-autocompose:latest # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ docker image prune -a -f # æ‹‰å–æœ€æ–°é•œåƒ docker pull ghcr.io/red5d/docker-autocompose:latest ğŸŒŸ å¯èˆªå®¹å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æŒæ¡äº† Docker AutoCompose çš„å¼ºå¤§åŠŸèƒ½ï¼Œèƒ½å¤Ÿå°†è¿è¡Œä¸­çš„å®¹å™¨å¿«é€Ÿè½¬æ¢ä¸ºæ ‡å‡†çš„ Docker Compose é…ç½®æ–‡ä»¶ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ”„ è½»æ¾è¿ç§» å°†ç°æœ‰å®¹å™¨é…ç½®è½¬åŒ–ä¸ºå¯ç‰ˆæœ¬æ§åˆ¶çš„ä»£ç ï¼Œå®ç°ç¯å¢ƒçš„ä¸€è‡´æ€§å’Œå¯é‡å¤éƒ¨ç½²\nğŸ“ é«˜æ•ˆå¤‡ä»½ å¿«é€Ÿå¤‡ä»½å®¹å™¨é…ç½®ï¼Œé˜²æ­¢é…ç½®ä¸¢å¤±ï¼Œç¡®ä¿æœåŠ¡æ¢å¤çš„å¯é æ€§\nğŸ”§ çµæ´»ç®¡ç† é€šè¿‡æ ‡å‡†åŒ–é…ç½®ç®€åŒ–å®¹å™¨ç®¡ç†ï¼Œæå‡è¿ç»´æ•ˆç‡å’Œç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§\nâš¡ å³è£…å³ç”¨ ç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ— éœ€å¤æ‚å®‰è£…ï¼Œéšæ—¶éšåœ°ç”Ÿæˆ Compose é…ç½®\nå®¹å™¨åŒ–æŠ€æœ¯çš„é­…åŠ›åœ¨äºå…¶å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚æ„¿ Docker AutoCompose æˆä¸ºä½ å®¹å™¨ç®¡ç†æ—…ç¨‹ä¸­çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œæ§åˆ¶ Docker ç¯å¢ƒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè§„èŒƒé…ç½®ï¼Œç®€åŒ–ç®¡ç†â€”â€”æ„å»ºä½ é«˜æ•ˆå¯é çš„å®¹å™¨åŒ–å·¥ä½œæµå§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Docker AutoCompose é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œç®¡ç†é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T16:53:15+08:00","image":"https://file.meimolihan.eu.org/img/dicker-02.webp","permalink":"https://blog.meimolihan.eu.org/p/e7a54827/","title":"Docker éƒ¨ç½² AutoCompose å®¹å™¨è½¬ Compose æ–‡ä»¶ç”Ÿæˆå™¨ ğŸ³"},{"content":"Windows æ‰¹é‡ä¿®æ”¹æ–‡ä»¶å æ‰¹é‡ä¿®æ”¹æ–‡ä»¶åä¸‹è½½ç½‘å€ï¼šhttps://www.binfensoft.cn/archives/420 æŸ¥çœ‹å½±ç‰‡è¯¦ç»†ä¿¡æ¯ï¼šhttps://thetvdb.com/search æ ¼å¼ï¼š 1 å‡¡äººæ­Œ_S01E# æ ¹æ®æ–‡ä»¶åè‡ªåŠ¨è¡¥é½ï¼Œå»æ‰ âœ”ï¸\né¢„è§ˆæ•ˆæœ\næ‰§è¡Œä¿®æ”¹\n","date":"2024-12-07T16:52:04+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/d9a17bcf/","title":"Windows æ‰¹é‡ä¿®æ”¹æ–‡ä»¶å"},{"content":"Linux NFS æŒ‚è½½ä¸è®¡åˆ’ä»»åŠ¡ç®¡ç†æŒ‡å— ğŸ“… ğŸš€ è‡ªåŠ¨åŒ– NFS æŒ‚è½½å’Œæ–‡ä»¶åŒæ­¥ï¼Œå®ç°è·¨æœåŠ¡å™¨æ–‡ä»¶å…±äº«å’Œå¤‡ä»½\nğŸ“– ç›®å½•å¯¼èˆª ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸ“ NFS æŒ‚è½½è„šæœ¬ â° è®¡åˆ’ä»»åŠ¡é…ç½® ğŸ”„ æ–‡ä»¶åŒæ­¥ç­–ç•¥ ğŸ”§ æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸ“ åˆ›å»ºè„šæœ¬ç›®å½• 1 2 3 4 5 6 # åˆ›å»ºè„šæœ¬å­˜æ”¾ç›®å½• mkdir -p /mnt/mydisk/my-sh/{nfs,sync,backup} chmod -R 755 /mnt/mydisk/my-sh/ # æŸ¥çœ‹ç›®å½•ç»“æ„ tree /mnt/mydisk/my-sh/ -L 2 ğŸ“ NFS æŒ‚è½½è„šæœ¬ ğŸ§ Debian NFS æŒ‚è½½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 #!/bin/bash # ğŸ“ ä½ç½®: /mnt/mydisk/my-sh/nfs/debian-nfs.sh echo \u0026#34;ğŸš€ å¼€å§‹æŒ‚è½½ NFS å…±äº«...\u0026#34; echo \u0026#34;==========================================\u0026#34; # å®šä¹‰é¢œè‰²è¾“å‡º RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color # åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• mount_points=( \u0026#34;/mnt/ARS2-NFS\u0026#34; \u0026#34;/mnt/PVE-NFS\u0026#34; \u0026#34;/mnt/Ubuntu-NFS\u0026#34; ) for mount_point in \u0026#34;${mount_points[@]}\u0026#34;; do if [ ! -d \u0026#34;$mount_point\u0026#34; ]; then mkdir -p \u0026#34;$mount_point\u0026#34; chmod 755 \u0026#34;$mount_point\u0026#34; echo -e \u0026#34;${GREEN}âœ… åˆ›å»ºç›®å½•: $mount_point${NC}\u0026#34; else echo -e \u0026#34;${BLUE}ğŸ“ ç›®å½•å·²å­˜åœ¨: $mount_point${NC}\u0026#34; fi done # NFS æœåŠ¡å™¨é…ç½® declare -A nfs_servers=( [\u0026#34;ARS2\u0026#34;]=\u0026#34;10.10.10.251:/mnt/mydisk\u0026#34; [\u0026#34;PVE\u0026#34;]=\u0026#34;10.10.10.254:/mnt/ntfs\u0026#34; [\u0026#34;Ubuntu\u0026#34;]=\u0026#34;10.10.10.247:/mnt/mydisk\u0026#34; ) # æŒ‚è½½å‡½æ•° mount_nfs_share() { local name=$1 local server=$2 local mount_point=$3 # æ£€æŸ¥æ˜¯å¦å·²æŒ‚è½½ if mountpoint -q \u0026#34;$mount_point\u0026#34;; then echo -e \u0026#34;${YELLOW}âš ï¸ $name å·²æŒ‚è½½ï¼Œå…ˆå¸è½½...${NC}\u0026#34; umount -f \u0026#34;$mount_point\u0026#34; 2\u0026gt;/dev/null sleep 2 fi # æ‰§è¡ŒæŒ‚è½½ echo -e \u0026#34;${BLUE}ğŸ”— æŒ‚è½½ $name: $server â†’ $mount_point${NC}\u0026#34; if mount -t nfs -o rw,soft,timeo=30,retry=3 \u0026#34;$server\u0026#34; \u0026#34;$mount_point\u0026#34;; then echo -e \u0026#34;${GREEN}âœ… $name æŒ‚è½½æˆåŠŸ${NC}\u0026#34; # éªŒè¯æŒ‚è½½ df -hT | grep \u0026#34;$mount_point\u0026#34; return 0 else echo -e \u0026#34;${RED}âŒ $name æŒ‚è½½å¤±è´¥${NC}\u0026#34; return 1 fi } # æ‰§è¡ŒæŒ‚è½½ mount_nfs_share \u0026#34;ARS2\u0026#34; \u0026#34;${nfs_servers[ARS2]}\u0026#34; \u0026#34;/mnt/ARS2-NFS\u0026#34; mount_nfs_share \u0026#34;PVE\u0026#34; \u0026#34;${nfs_servers[PVE]}\u0026#34; \u0026#34;/mnt/PVE-NFS\u0026#34; mount_nfs_share \u0026#34;Ubuntu\u0026#34; \u0026#34;${nfs_servers[Ubuntu]}\u0026#34; \u0026#34;/mnt/Ubuntu-NFS\u0026#34; echo \u0026#34;==========================================\u0026#34; echo -e \u0026#34;${GREEN}ğŸ‰ NFS æŒ‚è½½å®Œæˆï¼${NC}\u0026#34; echo \u0026#34;å½“å‰æŒ‚è½½çŠ¶æ€:\u0026#34; df -hT | grep -E \u0026#34;nfs|Filesystem\u0026#34; ğŸ”§ è®¾ç½®è„šæœ¬æƒé™ 1 2 3 4 5 6 # åˆ›å»ºå¹¶è®¾ç½®è„šæœ¬æƒé™ touch /mnt/mydisk/my-sh/nfs/debian-nfs.sh chmod +x /mnt/mydisk/my-sh/nfs/debian-nfs.sh # æµ‹è¯•è„šæœ¬æ‰§è¡Œ /mnt/mydisk/my-sh/nfs/debian-nfs.sh â° è®¡åˆ’ä»»åŠ¡é…ç½® ğŸ“… Crontab é…ç½® 1 2 3 4 # ç¼–è¾‘å½“å‰ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ crontab -e # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š ğŸ• è®¡åˆ’ä»»åŠ¡ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59) # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23) # â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥ (1 - 31) # â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆ (1 - 12) # â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ˜ŸæœŸ (0 - 6) (å‘¨æ—¥æ˜¯ 0) # â”‚ â”‚ â”‚ â”‚ â”‚ # â”‚ â”‚ â”‚ â”‚ â”‚ # * * * * * è¦æ‰§è¡Œçš„å‘½ä»¤ # ğŸ“… æ¯å¤©å‡Œæ™¨1ç‚¹æŒ‚è½½NFS 0 1 * * * /mnt/mydisk/my-sh/nfs/debian-nfs.sh \u0026gt;\u0026gt; /var/log/nfs-mount.log 2\u0026gt;\u0026amp;1 # ğŸ”„ æ¯30åˆ†é’Ÿæ£€æŸ¥NFSæŒ‚è½½çŠ¶æ€ */30 * * * * /mnt/mydisk/my-sh/nfs/check-nfs.sh \u0026gt;\u0026gt; /var/log/nfs-check.log 2\u0026gt;\u0026amp;1 # ğŸ’¾ æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œæ–‡ä»¶åŒæ­¥ 0 2 * * * /mnt/mydisk/my-sh/sync/sync-all.sh \u0026gt;\u0026gt; /var/log/nfs-sync.log 2\u0026gt;\u0026amp;1 # ğŸ§¹ æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†æ—§æ—¥å¿— 0 3 * * 0 find /var/log -name \u0026#34;nfs-*.log\u0026#34; -mtime +7 -delete ğŸ“Š è®¡åˆ’ä»»åŠ¡ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å½“å‰è®¡åˆ’ä»»åŠ¡ crontab -l # ç¼–è¾‘è®¡åˆ’ä»»åŠ¡ crontab -e # åˆ é™¤æ‰€æœ‰è®¡åˆ’ä»»åŠ¡ crontab -r # æŸ¥çœ‹cronæ—¥å¿— tail -f /var/log/syslog | grep cron # æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ crontab -u username -l ğŸ” NFS çŠ¶æ€æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/bash # ğŸ“ ä½ç½®: /mnt/mydisk/my-sh/nfs/check-nfs.sh echo \u0026#34;ğŸ” æ£€æŸ¥ NFS æŒ‚è½½çŠ¶æ€: $(date)\u0026#34; echo \u0026#34;================================\u0026#34; mount_points=(\u0026#34;/mnt/ARS2-NFS\u0026#34; \u0026#34;/mnt/PVE-NFS\u0026#34; \u0026#34;/mnt/Ubuntu-NFS\u0026#34;) for mount_point in \u0026#34;${mount_points[@]}\u0026#34;; do if mountpoint -q \u0026#34;$mount_point\u0026#34;; then echo \u0026#34;âœ… $mount_point: å·²æŒ‚è½½\u0026#34; # æ£€æŸ¥å¯å†™æ€§ touch \u0026#34;$mount_point/.write_test\u0026#34; 2\u0026gt;/dev/null \u0026amp;\u0026amp; rm -f \u0026#34;$mount_point/.write_test\u0026#34; \u0026amp;\u0026amp; \\ echo \u0026#34; ğŸ“ å¯å†™å…¥\u0026#34; || echo \u0026#34; ğŸ”’ åªè¯»\u0026#34; else echo \u0026#34;âŒ $mount_point: æœªæŒ‚è½½\u0026#34; # å°è¯•é‡æ–°æŒ‚è½½ echo \u0026#34; ğŸ”„ å°è¯•é‡æ–°æŒ‚è½½...\u0026#34; /mnt/mydisk/my-sh/nfs/debian-nfs.sh fi done echo \u0026#34;================================\u0026#34; ğŸ”„ æ–‡ä»¶åŒæ­¥ç­–ç•¥ ğŸ“ ç›®å½•åŒæ­¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #!/bin/bash # ğŸ“ ä½ç½®: /mnt/mydisk/my-sh/sync/sync-all.sh echo \u0026#34;ğŸ”„ å¼€å§‹æ–‡ä»¶åŒæ­¥: $(date)\u0026#34; echo \u0026#34;==========================================\u0026#34; # åŒæ­¥åˆ° Ubuntu echo \u0026#34;ğŸ“¤ åŒæ­¥åˆ° Ubuntu...\u0026#34; rsync -avhzp --progress --delete \\ --exclude=\u0026#39;*.tmp\u0026#39; \\ --exclude=\u0026#39;.cache/\u0026#39; \\ --exclude=\u0026#39;.trash/\u0026#39; \\ /mnt/mydisk/my-sh/ /mnt/Ubuntu-NFS/my-sh/ \\ \u0026gt;\u0026gt; /var/log/sync-ubuntu.log 2\u0026gt;\u0026amp;1 # åŒæ­¥åˆ° PVE echo \u0026#34;ğŸ“¤ åŒæ­¥åˆ° PVE...\u0026#34; rsync -avhzp --progress --delete \\ --exclude=\u0026#39;*.tmp\u0026#39; \\ --exclude=\u0026#39;.cache/\u0026#39; \\ --exclude=\u0026#39;.trash/\u0026#39; \\ /mnt/mydisk/my-sh/ /mnt/PVE-NFS/my-sh/ \\ \u0026gt;\u0026gt; /var/log/sync-pve.log 2\u0026gt;\u0026amp;1 echo \u0026#34;==========================================\u0026#34; echo \u0026#34;ğŸ“Š åŒæ­¥å®Œæˆç»Ÿè®¡:\u0026#34; echo \u0026#34;Ubuntu åŒæ­¥æ—¥å¿—: /var/log/sync-ubuntu.log\u0026#34; echo \u0026#34;PVE åŒæ­¥æ—¥å¿—: /var/log/sync-pve.log\u0026#34; echo \u0026#34;æœ€ååŒæ­¥æ—¶é—´: $(date)\u0026#34; echo \u0026#34;==========================================\u0026#34; ğŸ¯ å®æ—¶åŒæ­¥ç›‘æ§ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/bin/bash # ğŸ“ ä½ç½®: /mnt/mydisk/my-sh/sync/monitor-sync.sh # ç›‘æ§æ–‡ä»¶å˜åŒ–å¹¶å®æ—¶åŒæ­¥ inotifywait -m -r -e create,modify,delete /mnt/mydisk/my-sh/ | while read path action file; do echo \u0026#34;ğŸ“ æ£€æµ‹åˆ°å˜åŒ–: $path$file â†’ $action\u0026#34; # åŒæ­¥åˆ° Ubuntu rsync -avhz --delete \u0026#34;$path$file\u0026#34; \u0026#34;/mnt/Ubuntu-NFS/my-sh/${path#/mnt/mydisk/my-sh/}\u0026#34; # åŒæ­¥åˆ° PVE rsync -avhz --delete \u0026#34;$path$file\u0026#34; \u0026#34;/mnt/PVE-NFS/my-sh/${path#/mnt/mydisk/my-sh/}\u0026#34; echo \u0026#34;âœ… å®æ—¶åŒæ­¥å®Œæˆ: $(date)\u0026#34; done ğŸ”§ æ•…éšœæ’é™¤ ğŸ› å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 1. æ£€æŸ¥ NFS æœåŠ¡çŠ¶æ€ systemctl status nfs-server # NFS æœåŠ¡å™¨ systemctl status rpcbind # RPC æœåŠ¡ # 2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½® ufw status # Ubuntu firewall-cmd --list-all # CentOS # 3. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping 10.10.10.251 telnet 10.10.10.251 2049 # NFS ç«¯å£ # 4. æ‰‹åŠ¨æµ‹è¯•æŒ‚è½½ mount -t nfs -o rw 10.10.10.251:/mnt/mydisk /mnt/test # 5. æŸ¥çœ‹æŒ‚è½½è¯¦æƒ… showmount -e 10.10.10.251 # æŸ¥çœ‹å¯æŒ‚è½½ç›®å½• nfsstat -m # æŸ¥çœ‹ NFS ç»Ÿè®¡ä¿¡æ¯ ğŸ“ æ—¥å¿—æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„ NFS ç›¸å…³æ¶ˆæ¯ tail -f /var/log/syslog | grep nfs journalctl -u nfs-server -f # æŸ¥çœ‹æŒ‚è½½æ—¥å¿— tail -f /var/log/nfs-mount.log # æŸ¥çœ‹åŒæ­¥æ—¥å¿— tail -f /var/log/sync-ubuntu.log ğŸ”„ è‡ªåŠ¨ä¿®å¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash # ğŸ“ ä½ç½®: /mnt/mydisk/my-sh/nfs/repair-nfs.sh echo \u0026#34;ğŸ”§ å¼€å§‹ NFS æ•…éšœä¿®å¤...\u0026#34; echo \u0026#34;==========================================\u0026#34; # å¼ºåˆ¶å¸è½½æ‰€æœ‰ NFS æŒ‚è½½ umount -f /mnt/ARS2-NFS 2\u0026gt;/dev/null umount -f /mnt/PVE-NFS 2\u0026gt;/dev/null umount -f /mnt/Ubuntu-NFS 2\u0026gt;/dev/null # æ¸…ç†æ®‹ç•™æŒ‚è½½ sleep 2 # é‡æ–°æŒ‚è½½ /mnt/mydisk/my-sh/nfs/debian-nfs.sh # éªŒè¯ä¿®å¤ç»“æœ if mountpoint -q /mnt/ARS2-NFS \u0026amp;\u0026amp; mountpoint -q /mnt/PVE-NFS \u0026amp;\u0026amp; mountpoint -q /mnt/Ubuntu-NFS; then echo \u0026#34;âœ… NFS ä¿®å¤æˆåŠŸ\u0026#34; exit 0 else echo \u0026#34;âŒ NFS ä¿®å¤å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥\u0026#34; exit 1 fi ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ é…ç½®ä¼˜åŒ–å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 # 1. ä½¿ç”¨æ›´ç¨³å®šçš„æŒ‚è½½é€‰é¡¹ mount -t nfs -o rw,soft,timeo=30,retry=3,nolock # 2. é…ç½®è‡ªåŠ¨æŒ‚è½½ (/etc/fstab) # 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs rw,soft,timeo=30,retry=3 0 0 # 3. è®¾ç½®å¼€æœºè‡ªå¯åŠ¨æŒ‚è½½ echo \u0026#34;/mnt/mydisk/my-sh/nfs/debian-nfs.sh\u0026#34; \u0026gt;\u0026gt; /etc/rc.local # 4. é…ç½®ç›‘æ§å‘Šè­¦ # å½“ NFS æŒ‚è½½å¤±è´¥æ—¶å‘é€é‚®ä»¶é€šçŸ¥ ğŸ“Š ç›‘æ§å’Œå‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 #!/bin/bash # ğŸ“ ä½ç½®: /mnt/mydisk/my-sh/nfs/monitor-nfs.sh # æ£€æŸ¥æŒ‚è½½çŠ¶æ€å¹¶å‘é€å‘Šè­¦ if ! mountpoint -q /mnt/ARS2-NFS || ! mountpoint -q /mnt/PVE-NFS || ! mountpoint -q /mnt/Ubuntu-NFS; then # å‘é€é‚®ä»¶å‘Šè­¦ echo \u0026#34;NFS æŒ‚è½½å¼‚å¸¸ï¼Œè¯·ç«‹å³æ£€æŸ¥ï¼\u0026#34; | mail -s \u0026#34;NFS å‘Šè­¦\u0026#34; admin@example.com # æˆ–è€…ä½¿ç”¨ Webhook é€šçŸ¥ curl -X POST -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{\u0026#34;text\u0026#34;:\u0026#34;NFS æŒ‚è½½å¼‚å¸¸\u0026#34;}\u0026#39; \\ https://hooks.example.com/alert fi ğŸ”’ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 1. é™åˆ¶ NFS è®¿é—®æƒé™ # åœ¨ /etc/exports ä¸­é…ç½®åªå…è®¸ç‰¹å®š IP è®¿é—® # 2. ä½¿ç”¨é˜²ç«å¢™è§„åˆ™ ufw allow from 10.10.10.0/24 to any port nfs # 3. å®šæœŸæ£€æŸ¥æŒ‚è½½ç‚¹æƒé™ find /mnt/*-NFS -type d -exec chmod 755 {} \\; find /mnt/*-NFS -type f -exec chmod 644 {} \\; # 4. é…ç½®æ—¥å¿—è½®è½¬ cat \u0026gt; /etc/logrotate.d/nfs-sync \u0026lt;\u0026lt; EOF /var/log/nfs-*.log { daily rotate 7 missingok notifempty compress delaycompress create 644 root root } EOF ğŸ¯ æç¤ºï¼šå»ºè®®å®šæœŸæµ‹è¯• NFS æŒ‚è½½çš„ç¨³å®šæ€§å’ŒåŒæ­¥åŠŸèƒ½çš„å¯é æ€§ã€‚ç”Ÿäº§ç¯å¢ƒä¸­åº”è€ƒè™‘ä½¿ç”¨é«˜å¯ç”¨æ–¹æ¡ˆå’Œå®šæœŸå¤‡ä»½é‡è¦æ•°æ®ã€‚\nğŸ“š æ‰©å±•é˜…è¯»ï¼š\nNFS å®˜æ–¹æ–‡æ¡£ rsync é«˜çº§ç”¨æ³• crontab è¯­æ³•æŒ‡å— ","date":"2024-12-07T16:50:43+08:00","image":"https://file.meimolihan.eu.org/img/nfs-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5b355da6/","title":"Linux NFS æŒ‚è½½ä¸è®¡åˆ’ä»»åŠ¡ç®¡ç†æŒ‡å— ğŸ“…"},{"content":"Docker éƒ¨ç½² Emby å¼€å¿ƒç‰ˆ amilys å¤§ä½¬å®šåˆ¶ç‰ˆ ğŸ¬ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Emby 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Emby 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åˆå§‹è®¾ç½®æŒ‡å— âš™ï¸ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ¬ å¯èˆªå½±éŸ³ï¼Œç•…äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/amilys/emby-crx ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/amilys/embyserver Emby æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„åª’ä½“æœåŠ¡å™¨è½¯ä»¶ï¼Œå¯ä»¥å°†æ‚¨çš„ä¸ªäººåª’ä½“åº“ï¼ˆç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹ã€ç…§ç‰‡ï¼‰è½¬æ¢æˆç²¾ç¾çš„æµåª’ä½“ä½“éªŒã€‚amilys å¤§ä½¬çš„å¼€å¿ƒç‰ˆæä¾›äº†é¢å¤–çš„åŠŸèƒ½å’Œä¼˜åŒ–ï¼Œè®©æ‚¨çš„åª’ä½“ä½“éªŒæ›´åŠ å®Œç¾ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¥ åª’ä½“ç®¡ç† è‡ªåŠ¨æ•´ç†ç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹å’Œç…§ç‰‡ ä¸€ç«™å¼ç®¡ç†æ‰€æœ‰åª’ä½“å†…å®¹ ğŸ“± å¤šç«¯æ”¯æŒ æ”¯æŒç½‘é¡µã€æ‰‹æœºã€ç”µè§†ã€æ¸¸æˆæœºç­‰å¤šç§è®¾å¤‡ éšæ—¶éšåœ°äº«å—åª’ä½“å†…å®¹ ğŸ”„ å®æ—¶è½¬ç  æ ¹æ®è®¾å¤‡èƒ½åŠ›è‡ªåŠ¨è°ƒæ•´è§†é¢‘è´¨é‡å’Œæ ¼å¼ é€‚åº”ä¸åŒç½‘ç»œç¯å¢ƒå’Œè®¾å¤‡æ€§èƒ½ ğŸ¨ ç²¾ç¾ç•Œé¢ ç›´è§‚æ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œæ”¯æŒå¤šç§ä¸»é¢˜ æä¾›æ„‰æ‚¦çš„ç”¨æˆ·ä½“éªŒ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ åˆ›å»ºå¤šä¸ªç”¨æˆ·å¹¶è®¾ç½®ä¸åŒæƒé™ é€‚åˆå®¶åº­æˆ–å°å›¢ä½“ä½¿ç”¨ ğŸ“Š æ’­æ”¾ç»Ÿè®¡ è®°å½•è§‚çœ‹å†å²å’Œæ’­æ”¾è¿›åº¦ æ–¹ä¾¿ç»­æ’­å’Œå†…å®¹æ¨è ğŸŒ è¿œç¨‹è®¿é—® é€šè¿‡äº’è”ç½‘éšæ—¶éšåœ°è®¿é—®æ‚¨çš„åª’ä½“åº“ æ‰“ç ´åœ°åŸŸé™åˆ¶ï¼Œéšæ—¶éšåœ°è®¿é—® ğŸ³ ä¸€ã€Docker éƒ¨ç½² Emby 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 mkdir -p /mnt/mydisk/home/emby-amilys \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: emby: container_name: emby-amilys image: amilys/embyserver:latest restart: unless-stopped network_mode: bridge ports: - 8896:8096 - 8920:8920 # å¯é€‰ï¼šHTTPSç«¯å£ volumes: - ./config:/config - ./metadata:/metadata - ./config/hosts:/etc/hosts - /mnt/ARS2-NFS/nas/link:/media/video # åª’ä½“ç›®å½• - /mnt/ARS2-NFS/nas/music:/media/music # éŸ³ä¹ç›®å½• - /mnt/ARS2-NFS/nas/photos:/media/photos # ç…§ç‰‡ç›®å½• environment: - UID=0 - GID=0 - GIDLIST=100,101 - TZ=Asia/Shanghai devices: - /dev/dri:/dev/dri # ç¡¬ä»¶åŠ é€Ÿ deploy: resources: limits: memory: 8G reservations: memory: 1G EOF ğŸ” å®‰å…¨æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨åè¯·ä¿®æ”¹é»˜è®¤å¯†ç ï¼Œä½¿ç”¨å¼ºå¯†ç å¹¶å®šæœŸæ›´æ¢\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Emby 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8896 åŸŸåè®¿é—®: https://emby.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. åˆå§‹è®¾ç½®æŒ‡å— âš™ï¸ è®¿é—®ä¸Šè¿°åœ°å€ é€‰æ‹©è¯­è¨€ï¼ˆæ¨èä¸­æ–‡ï¼‰ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼ˆå»ºè®®ä¸è¦ä½¿ç”¨é»˜è®¤è´¦æˆ·ï¼‰ æ·»åŠ åª’ä½“åº“ï¼š ç”µå½±ï¼šæŒ‡å‘ /media/video/Movies ç”µè§†å‰§ï¼šæŒ‡å‘ /media/video/TV Shows éŸ³ä¹ï¼šæŒ‡å‘ /media/music ç…§ç‰‡ï¼šæŒ‡å‘ /media/photos é…ç½®å…ƒæ•°æ®ä¸‹è½½é€‰é¡¹ è®¾ç½®ç½‘ç»œå’Œè¿œç¨‹è®¿é—® ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://emby.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/emby.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name emby.example.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 20G; location / { proxy_pass http://localhost:8896; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; proxy_pass http://localhost:8896; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/emby-amilys # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop emby-amilys # åœæ­¢å®¹å™¨ docker start emby-amilys # å¯åŠ¨å®¹å™¨ docker restart emby-amilys # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm emby-amilys # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f emby-amilys # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it emby-amilys bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ docker exec -it emby-amilys sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect emby-amilys # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats emby-amilys # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs emby-amilys # æŸ¥çœ‹æ—¥å¿— docker logs -f emby-amilys # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 emby-amilys # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t emby-amilys # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ¬ å¯èˆªå½±éŸ³ï¼Œç•…äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Emby å¼€å¿ƒç‰ˆï¼ˆamilys å¤§ä½¬å®šåˆ¶ç‰ˆï¼‰ï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¥ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨æ•´ç†ç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹å’Œç…§ç‰‡ï¼Œæ‰“é€ ä¸ªäººä¸“å±åª’ä½“åº“\nğŸ“± å¤šç«¯ç•…äº« åœ¨æ‰‹æœºã€å¹³æ¿ã€ç”µè§†å’Œç”µè„‘ç­‰å„ç§è®¾å¤‡ä¸Šæ— ç¼è§‚çœ‹åª’ä½“å†…å®¹\nğŸŒ è¿œç¨‹è®¿é—® éšæ—¶éšåœ°é€šè¿‡äº’è”ç½‘è®¿é—®ä½ çš„åª’ä½“åº“ï¼Œæ‰“ç ´åœ°åŸŸé™åˆ¶\nâš¡ é«˜æ•ˆè½¬ç  æ™ºèƒ½é€‚é…ä¸åŒè®¾å¤‡å’Œç½‘ç»œç¯å¢ƒï¼Œæä¾›æµç•…çš„æ’­æ”¾ä½“éªŒ\nå½±éŸ³å¨±ä¹ä¸ä»…æ˜¯æ¶ˆé£ï¼Œæ›´æ˜¯ç”Ÿæ´»çš„è°ƒå‘³å‰‚ã€‚æ„¿ Emby æˆä¸ºä½ ä¸ªäººåª’ä½“ä¸–ç•Œçš„ä¸­å¿ƒï¼Œè®©æ¯ä¸€éƒ¨ç”µå½±ã€æ¯ä¸€é¦–éŸ³ä¹éƒ½èƒ½ä»¥æœ€ä½³æ–¹å¼å‘ˆç°ï¼Œä¸ºä½ çš„ç”Ÿæ´»å¢æ·»æ›´å¤šè‰²å½©å’Œä¹è¶£ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ„å»ºä½ çš„ç§äººå½±éŸ³å¤©å ‚ï¼Œäº«å—æè‡´çš„åª’ä½“ä½“éªŒï¼ğŸŒŸ\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Emby å®˜æ–¹æ›´æ–° å’Œ amilys å¤§ä½¬çš„é¡¹ç›® ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è§‚å½±æ„‰å¿«ï¼Œåª’ä½“ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼ğŸ‰\n","date":"2024-12-07T16:48:06+08:00","image":"https://file.meimolihan.eu.org/img/emby-01.webp","permalink":"https://blog.meimolihan.eu.org/p/6a416ac3/","title":"Docker éƒ¨ç½² Emby å¼€å¿ƒç‰ˆ amilys å¤§ä½¬å®šåˆ¶ç‰ˆ ğŸ¬"},{"content":"Proxmox VE è‡ªåŠ¨å¤‡ä»½è™šæ‹Ÿæœº ä¸€ ã€PVE åå°é…ç½®è‡ªåŠ¨å¤‡ä»½01 äºŒ ã€PVE åå°é…ç½®è‡ªåŠ¨å¤‡ä»½02 ","date":"2024-12-07T16:47:28+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/4bc146fc/","title":"Proxmox VE è‡ªåŠ¨å¤‡ä»½è™šæ‹Ÿæœº"},{"content":"Docker éƒ¨ç½² Plex åª’ä½“æœåŠ¡å™¨ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Plex 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Plex 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåª’ä½“ï¼Œå¨±ä¹æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Plex å®˜ç½‘åœ°å€ï¼š https://www.plex.tv/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/plexinc/pms-docker ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/plexinc/pms-docker Plex æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„åª’ä½“æœåŠ¡å™¨è½¯ä»¶ï¼Œèƒ½å¤Ÿå°†æ‚¨çš„ä¸ªäººåª’ä½“åº“ï¼ˆç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹ã€ç…§ç‰‡ç­‰ï¼‰ç»„ç»‡æˆç²¾ç¾çš„æµåª’ä½“å†…å®¹ï¼Œå¹¶é€šè¿‡å„ç§è®¾å¤‡è¿›è¡Œè®¿é—®å’Œæ’­æ”¾ã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œ Plexï¼Œå®ç°å®¶åº­åª’ä½“ä¸­å¿ƒçš„é›†ä¸­ç®¡ç†å’Œè·¨è®¾å¤‡è®¿é—®ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¬ å¤šåª’ä½“æ”¯æŒ æ”¯æŒç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹ã€ç…§ç‰‡ç­‰å¤šç§åª’ä½“ç±»å‹ ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ä¸ªäººåª’ä½“å†…å®¹ ğŸŒ è·¨å¹³å°è®¿é—® æ”¯æŒ Webã€ç§»åŠ¨ç«¯ã€æ™ºèƒ½ç”µè§†ã€æ¸¸æˆæœºç­‰å¤šç§è®¾å¤‡ éšæ—¶éšåœ°äº«å—åª’ä½“å†…å®¹ âš¡ æ™ºèƒ½è½¬ç  å®æ—¶è½¬ç é€‚åº”ä¸åŒè®¾å¤‡å’Œç½‘ç»œç¯å¢ƒ ä¿è¯æµç•…çš„æ’­æ”¾ä½“éªŒ ğŸ“Š å…ƒæ•°æ®æŠ“å– è‡ªåŠ¨è·å–åª’ä½“ä¿¡æ¯å’Œå°é¢è‰ºæœ¯ ç¾åŒ–åª’ä½“åº“ç•Œé¢å±•ç¤º ğŸ‘¥ å¤šç”¨æˆ·ç®¡ç† æ”¯æŒåˆ›å»ºå¤šä¸ªç”¨æˆ·å¹¶è®¾ç½®ä¸åŒæƒé™ é€‚åˆå®¶åº­å…±äº«ä½¿ç”¨ ğŸ”’ è¿œç¨‹è®¿é—® æ”¯æŒå®‰å…¨çš„è¿œç¨‹è®¿é—®é…ç½® åœ¨å¤–ä¹Ÿèƒ½è®¿é—®å®¶åº­åª’ä½“ ğŸ¨ ç¾è§‚ç•Œé¢ ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢è®¾è®¡ æä¾›å‡ºè‰²çš„ç”¨æˆ·ä½“éªŒ ğŸ“± ç¦»çº¿åŒæ­¥ æ”¯æŒç§»åŠ¨è®¾å¤‡ç¦»çº¿ä¸‹è½½å†…å®¹ æ–¹ä¾¿æ— ç½‘ç»œç¯å¢ƒä¸‹è§‚çœ‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Plex 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mkdir -p /mnt/mydisk/home/plex \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: plex: container_name: plex image: plexinc/pms-docker:latest restart: always ports: - \u0026#34;32400:32400/tcp\u0026#34; volumes: - ./config:/config - ./transcode:/transcode - /path/to/your/media:/data # âš ï¸ æ›¿æ¢ä¸ºæ‚¨çš„åª’ä½“æ–‡ä»¶è·¯å¾„ environment: - TZ=Asia/Shanghai - PLEX_CLAIM=claim-XXXXXXXXXXXXX # âš ï¸ æ›¿æ¢ä¸ºæ‚¨çš„ Plex Claim Token EOF âš ï¸ é‡è¦æç¤ºï¼š\nå°† /path/to/your/media æ›¿æ¢ä¸ºæ‚¨å®é™…çš„åª’ä½“æ–‡ä»¶å­˜å‚¨è·¯å¾„ è®¿é—® https://www.plex.tv/claim è·å– Plex Claim Token å¹¶æ›¿æ¢ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Plex 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:32400/web åŸŸåè®¿é—®ï¼š https://plex.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŒ‰ç…§å‘å¯¼å®Œæˆåˆå§‹è®¾ç½® ç™»å½•æ‚¨çš„ Plex è´¦æˆ·æˆ–åˆ›å»ºæ–°è´¦æˆ· å‘½åæ‚¨çš„ Plex æœåŠ¡å™¨ æ·»åŠ åª’ä½“åº“ï¼ˆç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹ç­‰ï¼‰ å¼€å§‹äº«å—æ‚¨çš„åª’ä½“å†…å®¹ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://plex.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/plex.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name plex.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:32400; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªåª’ä½“ï¼Œå¨±ä¹æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Plex åª’ä½“æœåŠ¡å™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ é›†ä¸­ç®¡ç† å°†æ•£è½çš„å½±è§†ã€éŸ³ä¹ã€ç…§ç‰‡èµ„æºæ•´åˆæˆç²¾ç¾çš„åª’ä½“åº“ï¼Œæ‰“é€ ä¸“å±å®¶åº­å¨±ä¹ä¸­å¿ƒ\nğŸŒ å¤šç«¯ç•…äº« åœ¨ä»»ä½•è®¾å¤‡ä¸Šæµç•…æ’­æ”¾åª’ä½“å†…å®¹ï¼Œæ™ºèƒ½è½¬ç ç¡®ä¿æœ€ä½³è§‚çœ‹ä½“éªŒ\nğŸ“Š æ™ºèƒ½æ•´ç† è‡ªåŠ¨è·å–å…ƒæ•°æ®å’Œè‰ºæœ¯å°é¢ï¼Œè®©åª’ä½“åº“æ—¢ç¾è§‚åˆäº•äº•æœ‰æ¡\nåª’ä½“ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸å½±éŸ³å¨±ä¹ç›¸ä¼´çš„ç²¾å½©æ—…ç¨‹ã€‚æ„¿ Plex æˆä¸ºä½ å¯é çš„åª’ä½“ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å®¶åº­è§‚å½±å’ŒéŸ³ä¹æ¬£èµçš„ç¾å¥½æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒè§‚å½±ï¼Œç•…äº«éŸ³ä¹â€”â€”æ„å»ºä½ ä¸ªæ€§åŒ–çš„å®¶åº­å¨±ä¹ç”Ÿæ€ç³»ç»Ÿå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Plex å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯é€šè¿‡ Plex å®˜æ–¹è®ºå› è·å–å¸®åŠ©ã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè§‚å½±ä½“éªŒæ›´ä¸Šä¸€å±‚æ¥¼ï¼ğŸ‰\n","date":"2024-12-07T16:45:26+08:00","image":"https://file.meimolihan.eu.org/img/plex-01.webp","permalink":"https://blog.meimolihan.eu.org/p/cba030ed/","title":"Docker éƒ¨ç½² Plex åª’ä½“æœåŠ¡å™¨ ğŸ³"},{"content":"Docker éƒ¨ç½² Media Server Tools åª’ä½“æœåŠ¡å™¨å·¥å…· ğŸ¬ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Media Server Tools 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. é…ç½®æ–‡ä»¶è®¾ç½® âš™ï¸ 2. æœåŠ¡ç®¡ç† ğŸ”§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåª’ä½“ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/sleikang/media_server_tools ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/sleikang/media_server_tools Media Server Tools æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åª’ä½“æœåŠ¡å™¨è¾…åŠ©å·¥å…·ï¼Œä¸“é—¨è®¾è®¡ç”¨äºä¸ Jellyfin å’Œ Emby åª’ä½“æœåŠ¡å™¨é…åˆä½¿ç”¨ã€‚å®ƒæä¾›äº†è‡ªåŠ¨æ›´æ–°åª’ä½“åº“å…ƒæ•°æ®ã€ç®¡ç†å‰§é›†åˆ†ç»„ã€åŒæ­¥è±†ç“£è¯„åˆ†ç­‰å¤šç§å®ç”¨åŠŸèƒ½ï¼Œæå¤§åœ°æå‡äº†åª’ä½“æœåŠ¡å™¨çš„ç®¡ç†æ•ˆç‡ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”„ è‡ªåŠ¨å…ƒæ•°æ®æ›´æ–° è‡ªåŠ¨æ›´æ–°åª’ä½“åº“å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€æ¦‚è¿°ã€è¯„åˆ†ç­‰ï¼‰ ä¿æŒåª’ä½“ä¿¡æ¯æœ€æ–°ä¸”å‡†ç¡® ğŸŒ å¤šæœåŠ¡å™¨æ”¯æŒ æ”¯æŒ Jellyfinã€Embyã€Plex å¤šç§åª’ä½“æœåŠ¡å™¨ å…¼å®¹ä¸»æµåª’ä½“æœåŠ¡å™¨ ğŸ“Š API é›†æˆ é›†æˆ TMDB å’Œè±†ç“£ APIï¼Œè·å–ä¸°å¯Œçš„åª’ä½“ä¿¡æ¯ æä¾›ä¸°å¯Œçš„åª’ä½“å…ƒæ•°æ® âš¡ å¤šçº¿ç¨‹å¤„ç† å¤šçº¿ç¨‹å¤„ç†åª’ä½“ä¿¡æ¯æ›´æ–° æé«˜å¤„ç†æ•ˆç‡ï¼ŒèŠ‚çœæ—¶é—´ â° å®šæœŸè‡ªåŠ¨æ›´æ–° æ”¯æŒå®šæ—¶è‡ªåŠ¨æ›´æ–°åª’ä½“ä¿¡æ¯ æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œè‡ªåŠ¨åŒ–è¿è¡Œ ğŸš« è‡ªå®šä¹‰æ’é™¤ æ”¯æŒè‡ªå®šä¹‰æ’é™¤è·¯å¾„å’Œç‰¹å®šåª’ä½“ çµæ´»æ§åˆ¶æ›´æ–°èŒƒå›´ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Media Server Tools 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 mkdir -p /mnt/mydisk/home/media-tools \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: media-tools: container_name: media-tools image: sleikang/media_server_tools:latest restart: unless-stopped volumes: - ./log:/app/log - ./config:/app/config environment: - TZ=Asia/Shanghai EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. é…ç½®æ–‡ä»¶è®¾ç½® âš™ï¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 mkdir -p config \u0026amp;\u0026amp; \\ cat \u0026gt; config/config.yaml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; api: jellyfin: host: \u0026#34;http://æœåŠ¡å™¨IP:8096\u0026#34; userid: \u0026#34;æ‚¨çš„ç”¨æˆ·ID\u0026#34; key: \u0026#34;æ‚¨çš„APIå¯†é’¥\u0026#34; emby: host: \u0026#34;http://æœåŠ¡å™¨IP:8896\u0026#34; userid: \u0026#34;æ‚¨çš„ç”¨æˆ·ID\u0026#34; key: \u0026#34;æ‚¨çš„APIå¯†é’¥\u0026#34; tmdb: key: \u0026#34;æ‚¨çš„TMDB_APIå¯†é’¥\u0026#34; douban: key: \u0026#34;æ‚¨çš„è±†ç“£APIå¯†é’¥\u0026#34; system: mediaserver: \u0026#34;Emby\u0026#34; threadnum: 10 updatetitle: True updateoverview: False updatetime: 12 EOF ğŸ”§ é…ç½®è¯´æ˜: è¯·æ ¹æ®æ‚¨çš„å®é™…åª’ä½“æœåŠ¡å™¨ä¿¡æ¯ä¿®æ”¹ä¸Šè¿°é…ç½®\n2. æœåŠ¡ç®¡ç† ğŸ”§ 1 2 3 4 5 # é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ docker-compose restart # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs -f ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è¯´æ˜: Media Server Tools æ—  Web ç•Œé¢ï¼Œé€šå¸¸æ— éœ€åå‘ä»£ç†é…ç½®\n1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 # æ­¤æœåŠ¡æ— éœ€Webç•Œé¢ï¼Œè·³è¿‡Nginxé…ç½® echo \u0026#34;Media Server Tools æ— Webç•Œé¢ï¼Œæ— éœ€é…ç½®Nginxåå‘ä»£ç†\u0026#34; 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 # æ— éœ€æ“ä½œ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/media-tools # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop media-tools docker start media-tools docker restart media-tools # åˆ é™¤å®¹å™¨ docker rm media-tools docker rm -f media-tools # è¿›å…¥å®¹å™¨Shell docker exec -it media-tools sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect media-tools docker stats media-tools # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs media-tools docker logs -f media-tools docker logs --tail 100 media-tools docker logs -t media-tools 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi sleikang/media_server_tools:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªåª’ä½“ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Media Server Tools åª’ä½“æœåŠ¡å™¨å·¥å…·ï¼Œä¸ºä½ çš„åª’ä½“åº“ç®¡ç†æä¾›äº†å¼ºå¤§çš„è¾…åŠ©åŠŸèƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨æ›´æ–°åª’ä½“åº“å…ƒæ•°æ®ï¼Œä¿æŒå½±ç‰‡ä¿¡æ¯çš„æœ€æ–°å’Œå‡†ç¡®ï¼Œæå‡åª’ä½“åº“è´¨é‡\nğŸ”„ æ— ç¼é›†æˆ å®Œç¾é…åˆ Jellyfin å’Œ Emby åª’ä½“æœåŠ¡å™¨ï¼Œå¢å¼ºç°æœ‰åª’ä½“æœåŠ¡å™¨çš„åŠŸèƒ½\nâš¡ é«˜æ•ˆè¿è¡Œ å¤šçº¿ç¨‹å¤„ç†æœºåˆ¶ï¼Œå¿«é€Ÿå®Œæˆå¤§æ‰¹é‡åª’ä½“ä¿¡æ¯çš„æ›´æ–°å’ŒåŒæ­¥\nğŸŒ ä¸°å¯Œæ•°æ® é›†æˆ TMDB å’Œè±†ç“£ APIï¼Œè·å–å…¨é¢çš„åª’ä½“ä¿¡æ¯å’Œè¯„åˆ†æ•°æ®\nåª’ä½“æ˜¯æ•°å­—ç”Ÿæ´»çš„ç²¾å½©ç¯‡ç« ï¼Œç®¡ç†æ˜¯å“è´¨ä½“éªŒçš„ä¿éšœã€‚æ„¿ Media Server Tools æˆä¸ºä½ åª’ä½“åº“ç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ ç»´æŠ¤ä¸€ä¸ªæ•´æ´ã€å‡†ç¡®ã€ä¸°å¯Œçš„åª’ä½“æ”¶è—ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œä¼˜åŒ–ç®¡ç†ï¼Œæå‡ä½“éªŒâ€”â€”æ„å»ºä½ å®Œç¾çš„åª’ä½“å¨±ä¹ä¸­å¿ƒå§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Media Server Tools é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œåª’ä½“ç®¡ç†é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T16:44:53+08:00","image":"https://file.meimolihan.eu.org/img/emby-jellyfin-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ef18f349/","title":"Docker éƒ¨ç½² Media Server Tools åª’ä½“æœåŠ¡å™¨å·¥å…· ğŸ¬"},{"content":"NASTools åª’ä½“åº“ç›®å½•ç»“æ„è§„èŒƒ ğŸ¬ ğŸ—‚ï¸ ä¸º NAS Tools å’Œåª’ä½“æœåŠ¡å™¨ä¼˜åŒ–çš„æ ‡å‡†åŒ–ç›®å½•ç»“æ„\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ ç‰¹æ€§ä»‹ç» ğŸ¯ ç›®å½•ç»“æ„æ¦‚è¿° ğŸ“ FnOS åª’ä½“åº“ç»“æ„ ğŸš€ å¿«é€Ÿåˆ›å»ºè„šæœ¬ ğŸ¬ ç”µå½±ç›®å½•è§„èŒƒ ğŸ“º ç”µè§†å‰§ç›®å½•è§„èŒƒ ğŸ° åŠ¨ç”»ç›®å½•è§„èŒƒ ğŸ’¡ æœ€ä½³å®è·µ âœ¨ ç‰¹æ€§ä»‹ç» NAS åª’ä½“åº“ç›®å½•ç»“æ„è§„èŒƒæä¾›ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸ¯ æ ‡å‡†åŒ–ç®¡ç†ï¼šç»Ÿä¸€å‘½åè§„åˆ™ï¼Œä¾¿äºåª’ä½“æœåŠ¡å™¨è¯†åˆ«å’Œåˆ®å‰Š ğŸ”„ è‡ªåŠ¨åŒ–æ”¯æŒï¼šå®Œç¾é€‚é… NAS Tools ç­‰è‡ªåŠ¨åŒ–å·¥å…· ğŸ“Š åˆ†ç±»æ¸…æ™°ï¼šæŒ‰ç±»å‹ã€åœ°åŒºã€è¯­è¨€å¤šç»´åº¦åˆ†ç±» ğŸš€ é«˜æ•ˆæ•´ç†ï¼šç¡¬é“¾æ¥æŠ€æœ¯èŠ‚çœç©ºé—´ï¼Œæé«˜æ•´ç†æ•ˆç‡ ğŸŒ å¤šè¯­è¨€æ”¯æŒï¼šæ”¯æŒä¸­è‹±æ–‡åª’ä½“å†…å®¹ç®¡ç† ğŸ”§ æ˜“äºç»´æŠ¤ï¼šç»“æ„åŒ–è®¾è®¡ä¾¿äºå¤‡ä»½å’Œè¿ç§» ğŸ¯ ç›®å½•ç»“æ„æ¦‚è¿° ğŸ“Š åª’ä½“åº“è®¾è®¡åŸåˆ™ æ ‡å‡†åŒ–ï¼šç¬¦åˆ NAS Tools å’Œåª’ä½“æœåŠ¡å™¨è¯†åˆ«è§„èŒƒ åˆ†ç±»æ¸…æ™°ï¼šæŒ‰ç±»å‹ã€åœ°åŒºã€è¯­è¨€å¤šç»´åº¦åˆ†ç±» æ‰©å±•æ€§å¼ºï¼šæ”¯æŒæœªæ¥æ–°å¢åª’ä½“ç±»å‹ ç»´æŠ¤æ–¹ä¾¿ï¼šæ˜“äºç®¡ç†å’Œå¤‡ä»½ è‡ªåŠ¨åŒ–å‹å¥½ï¼šé€‚é…è‡ªåŠ¨åŒ–å·¥å…·çš„å·¥ä½œæµç¨‹ ğŸ“ FnOS åª’ä½“åº“ç»“æ„ ğŸŒ³ å®Œæ•´ç›®å½•æ ‘ 1 2 3 4 5 6 7 8 9 10 11 /vol2/1000/media/ â”œâ”€â”€ ğŸ“¥ downloads/ # ä¸‹è½½ç›®å½• â”œâ”€â”€ ğŸ”— link/ # ç¡¬é“¾æ¥ç›®å½•ï¼ˆNAS Toolsä½¿ç”¨ï¼‰ â”‚ â”œâ”€â”€ ğŸ¥ movie/ # ç”µå½±ç¡¬é“¾æ¥ â”‚ â”‚ â”œâ”€â”€ åè¯­ç”µå½±/ # ä¸­æ–‡ç”µå½± â”‚ â”‚ â””â”€â”€ å¤–è¯­ç”µå½±/ # å¤–å›½ç”µå½± â”‚ â”œâ”€â”€ ğŸ“º tv/ # ç”µè§†å‰§ç¡¬é“¾æ¥ â”‚ â”‚ â””â”€â”€ å›½äº§å‰§/ # å›½äº§ç”µè§†å‰§ â”‚ â””â”€â”€ ğŸ° cartoons/ # åŠ¨ç”»ç¡¬é“¾æ¥ â”œâ”€â”€ ğŸ¥ movie/ # ç”µå½±åª’ä½“åº“ â””â”€â”€ ğŸ“º tv/ # ç”µè§†å‰§åª’ä½“åº“ ğŸ¨ ä¼˜åŒ–åçš„ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /vol2/1000/å…‰å½±é›†/ â”œâ”€â”€ ğŸ“¥ ä¸‹è½½åŒº/ # åŸå§‹ä¸‹è½½æ–‡ä»¶ â”œâ”€â”€ ğŸ”§ æ•´ç†åŒº/ # NAS Toolså¤„ç†åŒº â”‚ â”œâ”€â”€ ğŸ¥ ç”µå½±/ â”‚ â”‚ â”œâ”€â”€ åè¯­ç”µå½±/ â”‚ â”‚ â””â”€â”€ å¤–è¯­ç”µå½±/ â”‚ â”œâ”€â”€ ğŸ“º å‰§é›†/ â”‚ â””â”€â”€ ğŸ° åŠ¨ç”»/ â””â”€â”€ ğŸ  åª’ä½“åº“/ # æœ€ç»ˆåª’ä½“åº“ï¼ˆJellyfin/Plexï¼‰ â”œâ”€â”€ ğŸ¥ ç”µå½±/ â”‚ â”œâ”€â”€ åè¯­ç”µå½±/ â”‚ â””â”€â”€ å¤–è¯­ç”µå½±/ â”œâ”€â”€ ğŸ“º å‰§é›†/ â”‚ â”œâ”€â”€ å›½äº§å‰§/ â”‚ â”œâ”€â”€ æ—¥éŸ©å‰§/ â”‚ â””â”€â”€ æ¬§ç¾å‰§/ â””â”€â”€ ğŸ° åŠ¨ç”»/ â”œâ”€â”€ åè¯­åŠ¨ç”»/ â””â”€â”€ å¤–è¯­åŠ¨ç”»/ ğŸš€ å¿«é€Ÿåˆ›å»ºè„šæœ¬ ğŸ“ ä¸€é”®åˆ›å»ºç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # ğŸ¬ åª’ä½“åº“ç›®å½•åˆ›å»ºè„šæœ¬ BASE_DIR=\u0026#34;/vol2/1000/å…‰å½±é›†\u0026#34; echo \u0026#34;ğŸ¯ å¼€å§‹åˆ›å»ºåª’ä½“åº“ç›®å½•ç»“æ„...\u0026#34; # åˆ›å»ºä¸»ç›®å½• mkdir -p \u0026#34;${BASE_DIR}\u0026#34; \u0026amp;\u0026amp; cd \u0026#34;${BASE_DIR}\u0026#34; # åˆ›å»ºä¸‰çº§ç›®å½•ç»“æ„ mkdir -pm 755 \\ \u0026#34;ä¸‹è½½åŒº\u0026#34; \\ \u0026#34;æ•´ç†åŒº/ç”µå½±/åè¯­ç”µå½±\u0026#34; \\ \u0026#34;æ•´ç†åŒº/ç”µå½±/å¤–è¯­ç”µå½±\u0026#34; \\ \u0026#34;æ•´ç†åŒº/å‰§é›†/å›½äº§å‰§\u0026#34; \\ \u0026#34;æ•´ç†åŒº/å‰§é›†/æ—¥éŸ©å‰§\u0026#34; \\ \u0026#34;æ•´ç†åŒº/å‰§é›†/æ¬§ç¾å‰§\u0026#34; \\ \u0026#34;æ•´ç†åŒº/åŠ¨ç”»/åè¯­åŠ¨ç”»\u0026#34; \\ \u0026#34;æ•´ç†åŒº/åŠ¨ç”»/å¤–è¯­åŠ¨ç”»\u0026#34; \\ \u0026#34;åª’ä½“åº“/ç”µå½±/åè¯­ç”µå½±\u0026#34; \\ \u0026#34;åª’ä½“åº“/ç”µå½±/å¤–è¯­ç”µå½±\u0026#34; \\ \u0026#34;åª’ä½“åº“/å‰§é›†/å›½äº§å‰§\u0026#34; \\ \u0026#34;åª’ä½“åº“/å‰§é›†/æ—¥éŸ©å‰§\u0026#34; \\ \u0026#34;åª’ä½“åº“/å‰§é›†/æ¬§ç¾å‰§\u0026#34; \\ \u0026#34;åª’ä½“åº“/åŠ¨ç”»/åè¯­åŠ¨ç”»\u0026#34; \\ \u0026#34;åª’ä½“åº“/åŠ¨ç”»/å¤–è¯­åŠ¨ç”»\u0026#34; # è®¾ç½®æƒé™ chmod -R 755 \u0026#34;${BASE_DIR}\u0026#34; # éªŒè¯åˆ›å»ºç»“æœ echo \u0026#34;âœ… ç›®å½•åˆ›å»ºå®Œæˆï¼\u0026#34; tree -L 3 \u0026#34;${BASE_DIR}\u0026#34; ğŸ”§ æƒé™è®¾ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/bin/bash # ğŸ” åª’ä½“åº“æƒé™è®¾ç½®è„šæœ¬ MEDIA_DIR=\u0026#34;/vol2/1000/å…‰å½±é›†\u0026#34; USER=\u0026#34;media\u0026#34; GROUP=\u0026#34;media\u0026#34; # è®¾ç½®ç”¨æˆ·ç»„ chown -R ${USER}:${GROUP} \u0026#34;${MEDIA_DIR}\u0026#34; # è®¾ç½®ç›®å½•æƒé™ find \u0026#34;${MEDIA_DIR}\u0026#34; -type d -exec chmod 755 {} \\; # è®¾ç½®æ–‡ä»¶æƒé™ find \u0026#34;${MEDIA_DIR}\u0026#34; -type f -exec chmod 644 {} \\; # è®¾ç½®å¯æ‰§è¡Œæƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰ chmod +x \u0026#34;${MEDIA_DIR}/è„šæœ¬\u0026#34;/*.sh 2\u0026gt;/dev/null echo \u0026#34;âœ… æƒé™è®¾ç½®å®Œæˆï¼\u0026#34; ğŸ¬ ç”µå½±ç›®å½•è§„èŒƒ ğŸ“ ç”µå½±å‘½åè§„èŒƒ 1 2 3 4 5 6 7 # æ ‡å‡†ç”µå½±ç›®å½•ç»“æ„ åª’ä½“åº“/ç”µå½±/åè¯­ç”µå½±/ â””â”€â”€ ç”µå½±åç§° (å¹´ä»½) [åˆ†è¾¨ç‡][ç¼–ç ] â”œâ”€â”€ ç”µå½±åç§° (å¹´ä»½) [åˆ†è¾¨ç‡][ç¼–ç ].mkv â”œâ”€â”€ ç”µå½±åç§° (å¹´ä»½) [åˆ†è¾¨ç‡][ç¼–ç ].chs.srt â”œâ”€â”€ ç”µå½±åç§° (å¹´ä»½) [åˆ†è¾¨ç‡][ç¼–ç ].eng.srt â””â”€â”€ poster.jpg ğŸ¯ ç¤ºä¾‹ç»“æ„ 1 2 3 4 5 6 7 åª’ä½“åº“/ç”µå½±/åè¯­ç”µå½±/ â””â”€â”€ æµæµªåœ°çƒ2 (2023) [4K][HDR] â”œâ”€â”€ æµæµªåœ°çƒ2 (2023) [4K][HDR].mkv â”œâ”€â”€ æµæµªåœ°çƒ2 (2023) [4K][HDR].chs.srt â”œâ”€â”€ æµæµªåœ°çƒ2 (2023) [4K][HDR].eng.srt â”œâ”€â”€ poster.jpg â””â”€â”€ fanart.jpg ğŸŒ å¤šè¯­è¨€æ”¯æŒ 1 2 3 4 5 6 7 åª’ä½“åº“/ç”µå½±/å¤–è¯­ç”µå½±/ â”œâ”€â”€ English Movies/ â”‚ â””â”€â”€ Inception (2010) [1080p] â”œâ”€â”€ Japanese Movies/ â”‚ â””â”€â”€ å›ã®åã¯ã€‚ (2016) [4K] â””â”€â”€ Korean Movies/ â””â”€â”€ ê¸°ìƒì¶© (2019) [1080p] ğŸ“º ç”µè§†å‰§ç›®å½•è§„èŒƒ ğŸ“ ç”µè§†å‰§å‘½åè§„èŒƒ 1 2 3 4 5 6 7 8 9 # æ ‡å‡†ç”µè§†å‰§ç›®å½•ç»“æ„ åª’ä½“åº“/å‰§é›†/å›½äº§å‰§/ â””â”€â”€ å‰§é›†åç§° (å¹´ä»½) â”œâ”€â”€ Season 01 â”‚ â”œâ”€â”€ å‰§é›†åç§° S01E01 é›†æ•°æ ‡é¢˜.mkv â”‚ â”œâ”€â”€ å‰§é›†åç§° S01E01.chs.srt â”‚ â””â”€â”€ ... â”œâ”€â”€ Season 02 â””â”€â”€ poster.jpg ğŸ¯ ç¤ºä¾‹ç»“æ„ 1 2 3 4 5 6 7 8 9 10 åª’ä½“åº“/å‰§é›†/å›½äº§å‰§/ â””â”€â”€ ä¸‰ä½“ (2023) â”œâ”€â”€ Season 01 â”‚ â”œâ”€â”€ ä¸‰ä½“ S01E01 ç§‘å­¦è¾¹ç•Œ.mkv â”‚ â”œâ”€â”€ ä¸‰ä½“ S01E01.chs.srt â”‚ â”œâ”€â”€ ä¸‰ä½“ S01E02.mkv â”‚ â””â”€â”€ ... â”œâ”€â”€ Season 02 â”œâ”€â”€ poster.jpg â””â”€â”€ banner.jpg ğŸŒ å›½é™…å‰§é›†åˆ†ç±» 1 2 3 4 5 6 7 8 9 åª’ä½“åº“/å‰§é›†/ â”œâ”€â”€ å›½äº§å‰§/ â”œâ”€â”€ æ—¥éŸ©å‰§/ â”‚ â”œâ”€â”€ éŸ©å‰§/ â”‚ â””â”€â”€ æ—¥å‰§/ â””â”€â”€ æ¬§ç¾å‰§/ â”œâ”€â”€ ç¾å‰§/ â”œâ”€â”€ è‹±å‰§/ â””â”€â”€ å…¶ä»–/ ğŸ° åŠ¨ç”»ç›®å½•è§„èŒƒ ğŸ“ åŠ¨ç”»å‘½åè§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 # åŠ¨ç”»ç”µå½±å’Œå‰§é›†åˆ†ç±» åª’ä½“åº“/åŠ¨ç”»/ â”œâ”€â”€ åè¯­åŠ¨ç”»/ â”‚ â”œâ”€â”€ ç”µå½±/ â”‚ â””â”€â”€ å‰§é›†/ â””â”€â”€ å¤–è¯­åŠ¨ç”»/ â”œâ”€â”€ æ—¥æœ¬åŠ¨ç”»/ â”‚ â”œâ”€â”€ ç”µå½±/ â”‚ â””â”€â”€ å‰§é›†/ â”œâ”€â”€ æ¬§ç¾åŠ¨ç”»/ â””â”€â”€ å…¶ä»–/ ğŸ¯ ç¤ºä¾‹ç»“æ„ 1 2 3 4 5 6 åª’ä½“åº“/åŠ¨ç”»/å¤–è¯­åŠ¨ç”»/æ—¥æœ¬åŠ¨ç”»/ç”µå½±/ â””â”€â”€ åƒã¨åƒå°‹ã®ç¥éš ã— (2001) [4K] â”œâ”€â”€ åƒã¨åƒå°‹ã®ç¥éš ã— (2001) [4K].mkv â”œâ”€â”€ åƒã¨åƒå°‹ã®ç¥éš ã— (2001) [4K].jpn.srt â”œâ”€â”€ åƒã¨åƒå°‹ã®ç¥éš ã— (2001) [4K].chs.srt â””â”€â”€ poster.jpg ğŸ’¡ æœ€ä½³å®è·µ ğŸ¯ NAS Tools é…ç½®å»ºè®® 1 2 3 4 5 6 7 8 # NAS Toolsç›®å½•æ˜ å°„é…ç½®ç¤ºä¾‹ version: \u0026#39;3\u0026#39; services: nastools: volumes: - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº:/downloads - /vol2/1000/å…‰å½±é›†/æ•´ç†åŒº:/media - /vol2/1000/å…‰å½±é›†/åª’ä½“åº“:/library ğŸ”„ ç¡¬é“¾æ¥ç­–ç•¥ 1 2 3 4 # ä½¿ç”¨ç¡¬é“¾æ¥èŠ‚çœç©ºé—´ /media/æ•´ç†åŒº/ç”µå½±/åè¯­ç”µå½±/æµæµªåœ°çƒ2 (2023)/ç”µå½±æ–‡ä»¶.mkv â¬‡ï¸ ç¡¬é“¾æ¥ /library/åª’ä½“åº“/ç”µå½±/åè¯­ç”µå½±/æµæµªåœ°çƒ2 (2023)/ç”µå½±æ–‡ä»¶.mkv ğŸ“Š ç›‘æ§å’Œç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®šæœŸæ¸…ç†è„šæœ¬ #!/bin/bash # ğŸ§¹ åª’ä½“åº“ç»´æŠ¤è„šæœ¬ MEDIA_DIR=\u0026#34;/vol2/1000/å…‰å½±é›†\u0026#34; # æ¸…ç†ç©ºç›®å½• find \u0026#34;${MEDIA_DIR}\u0026#34; -type d -empty -delete # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ find \u0026#34;${MEDIA_DIR}\u0026#34; -name \u0026#34;*.nfo\u0026#34; -mtime +30 -delete find \u0026#34;${MEDIA_DIR}\u0026#34; -name \u0026#34;*.tmp\u0026#34; -delete # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ find \u0026#34;${MEDIA_DIR}\u0026#34; -name \u0026#34;*.mkv\u0026#34; -exec ffmpeg -v error -i {} -f null - 2\u0026gt;error.log \\; echo \u0026#34;âœ… åª’ä½“åº“ç»´æŠ¤å®Œæˆï¼\u0026#34; ğŸš€ è‡ªåŠ¨åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åª’ä½“åº“å¥åº·æ£€æŸ¥ #!/bin/bash # ğŸ©º åª’ä½“åº“å¥åº·æ£€æŸ¥è„šæœ¬ check_directory() { local dir=$1 if [ ! -d \u0026#34;$dir\u0026#34; ]; then echo \u0026#34;âŒ ç›®å½•ç¼ºå¤±: $dir\u0026#34; return 1 fi echo \u0026#34;âœ… ç›®å½•æ­£å¸¸: $dir\u0026#34; return 0 } # æ£€æŸ¥å…³é”®ç›®å½• check_directory \u0026#34;/vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº\u0026#34; check_directory \u0026#34;/vol2/1000/å…‰å½±é›†/æ•´ç†åŒº\u0026#34; check_directory \u0026#34;/vol2/1000/å…‰å½±é›†/åª’ä½“åº“\u0026#34; # æ£€æŸ¥æƒé™ find \u0026#34;/vol2/1000/å…‰å½±é›†\u0026#34; -name \u0026#34;*.mkv\u0026#34; ! -perm 644 -exec echo \u0026#34;âš ï¸ æ–‡ä»¶æƒé™å¼‚å¸¸: {}\u0026#34; \\; ğŸ¬ æç¤ºï¼šè‰¯å¥½çš„ç›®å½•ç»“æ„æ˜¯åª’ä½“åº“ç®¡ç†çš„åŸºçŸ³ã€‚å»ºè®®å®šæœŸå¤‡ä»½ç›®å½•ç»“æ„é…ç½®ï¼Œå¹¶åœ¨æ–°å¢åª’ä½“ç±»å‹æ—¶åŠæ—¶æ›´æ–°è§„èŒƒã€‚\nğŸ“š æ¨èå·¥å…·ï¼š\nNAS Tools - è‡ªåŠ¨åŒ–åª’ä½“ç®¡ç† Jellyfin - åª’ä½“æœåŠ¡å™¨ Plex - åª’ä½“æœåŠ¡å™¨ TinyMediaManager - åª’ä½“ä¿¡æ¯åˆ®å‰Š ğŸ”§ æ•…éšœæ’é™¤ï¼š\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç›®å½•å¤§å° du -sh /vol2/1000/å…‰å½±é›†/* # æ£€æŸ¥inodeä½¿ç”¨ df -i /vol2/1000/ # æŸ¥æ‰¾é‡å¤æ–‡ä»¶ fdupes -r /vol2/1000/å…‰å½±é›†/ ğŸ’¡ æ‰©å±•å»ºè®®ï¼š\nå®šæœŸä½¿ç”¨ rsync å¤‡ä»½åª’ä½“åº“å…ƒæ•°æ®å’Œç›®å½•ç»“æ„ è€ƒè™‘ä½¿ç”¨ ZFS æˆ– Btrfs æ–‡ä»¶ç³»ç»Ÿä»¥è·å¾—æ›´å¥½çš„æ•°æ®å®Œæ•´æ€§ä¿æŠ¤ ä¸ºä¸åŒç±»å‹çš„åª’ä½“è®¾ç½®ä¸åŒçš„å¤‡ä»½ç­–ç•¥ ä½¿ç”¨ç›‘æ§å·¥å…·å¦‚ inotifywait ç›‘æ§åª’ä½“åº“å˜åŒ– ","date":"2024-12-07T16:44:07+08:00","image":"https://file.meimolihan.eu.org/img/nastools-01.webp","permalink":"https://blog.meimolihan.eu.org/p/08fb4009/","title":"NASTools åª’ä½“åº“ç›®å½•ç»“æ„è§„èŒƒ ğŸ¬"},{"content":"Linux æŸ¥çœ‹æ‰€æœ‰ NFS æœåŠ¡å™¨æŒ‚è½½ç›®å½• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 touch /mnt/mydisk/my-sh/nfs/check_nfs_shares.sh \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/my-sh/nfs/check_nfs_shares.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # å®šä¹‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰ IP åœ°å€çš„æ•°ç»„ IPs=(\u0026#34;10.10.10.242\u0026#34; \u0026#34;10.10.10.245\u0026#34; \u0026#34;10.10.10.246\u0026#34; \u0026#34;10.10.10.247\u0026#34; \u0026#34;10.10.10.254\u0026#34;) # éå†æ•°ç»„ä¸­çš„æ¯ä¸ª IP åœ°å€ for IP in \u0026#34;${IPs[@]}\u0026#34;; do # è¾“å‡ºå¼€å§‹çš„åˆ†éš”çº¿ echo \u0026#34;----------------\u0026#34; # æ‰§è¡Œ showmount å‘½ä»¤å¹¶æ•è·è¾“å‡ºå’Œé”™è¯¯ output=$(showmount -e $IP 2\u0026gt;\u0026amp;1) # æ£€æŸ¥è¾“å‡ºä¸­æ˜¯å¦åŒ…å«ç‰¹å®šçš„ RPC é”™è¯¯ä¿¡æ¯ if echo \u0026#34;$output\u0026#34; | grep -q \u0026#34;clnt_create: RPC: Unable to receive\u0026#34;; then # å¦‚æœåŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å’Œ IP åœ°å€ echo -e \u0026#34;IP: $IP \\E[1;31må…³æœºçŠ¶æ€\\E[0m\u0026#34; else # å¦‚æœä¸åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œè¾“å‡º IP åœ°å€å’ŒæœåŠ¡å™¨å·²å¯åŠ¨ä¿¡æ¯ echo -e \u0026#34;IP: $IP \\E[1;32mNFSæŒ‚è½½ç›®å½•ï¼š\\E[0m\u0026#34; # è¾“å‡º NFS å¯¼å‡ºåˆ—è¡¨ï¼Œç§»é™¤ \u0026#34;Export list for\u0026#34; éƒ¨åˆ†ï¼Œå¹¶è®¾ç½®ä¸ºç»¿è‰² echo \u0026#34;$output\u0026#34; | grep -v \u0026#34;$IP:\u0026#34; | sed \u0026#39;s/^Export list for //\u0026#39; | while read -r line; do echo -e \u0026#34;\\E[1;32m$line\\E[0m\u0026#34; done fi # è¾“å‡ºç»“æŸçš„åˆ†éš”çº¿ echo \u0026#34;----------------\u0026#34; done EOF chmod +x /mnt/mydisk/my-sh/nfs/check_nfs_shares.sh \u0026amp;\u0026amp; /mnt/mydisk/my-sh/nfs/check_nfs_shares.sh ","date":"2024-12-07T16:42:40+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2733514d/","title":"Linux æŸ¥çœ‹æ‰€æœ‰ NFS æœåŠ¡å™¨æŒ‚è½½ç›®å½•"},{"content":"Proxmox VE æ ¸å¿ƒç›®å½•ç»“æ„è¯¦è§£ ğŸ“ ğŸ—‚ï¸ æ·±å…¥æ¢ç´¢ Proxmox VE çš„æ ¸å¿ƒç›®å½•ç»“æ„ï¼ŒåŠ©ä½ é«˜æ•ˆç®¡ç†è™šæ‹ŸåŒ–ç¯å¢ƒï¼\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ ç‰¹æ€§ç®€ä»‹ ğŸ¯ æ ¸å¿ƒç›®å½•æ¦‚è§ˆ ğŸ“€ ISO é•œåƒç›®å½• ğŸ³ å®¹å™¨æ¨¡æ¿ç›®å½• ğŸ–¥ï¸ è™šæ‹Ÿæœºé•œåƒç›®å½• ğŸ’¾ å¤‡ä»½æ–‡ä»¶ç›®å½• ğŸ”§ å…¶ä»–é‡è¦ç›®å½• ğŸ’¡ ç®¡ç†æŠ€å·§ä¸æ—¥å¸¸ç»´æŠ¤ âœ¨ ç‰¹æ€§ç®€ä»‹ Proxmox VE (PVE) æ˜¯ä¸€ä¸ªåŸºäº Debian Linux çš„å¼€æºè™šæ‹ŸåŒ–å¹³å°ï¼Œå®ƒæ•´åˆäº† KVM è™šæ‹ŸåŒ–å’Œ LXC å®¹å™¨æŠ€æœ¯ã€‚å…¶ç›®å½•ç»“æ„è®¾è®¡æ—¨åœ¨ï¼š\né›†ä¸­ç®¡ç†ï¼šé€šè¿‡ Web GUI æˆ– CLI ç»Ÿä¸€ç®¡ç†è™šæ‹Ÿæœºã€å®¹å™¨ã€å­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºã€‚ çµæ´»å­˜å‚¨ï¼šæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼ˆåŒ…æ‹¬æœ¬åœ°å­˜å‚¨å¦‚ ZFSã€LVM-Thinï¼Œå…±äº«å­˜å‚¨å¦‚ NFSã€CIFSã€iSCSIï¼Œä»¥åŠåˆ†å¸ƒå¼å­˜å‚¨å¦‚ Cephï¼‰ã€‚ é«˜å¯ç”¨æ€§ï¼šæ”¯æŒé›†ç¾¤å’Œé«˜å¯ç”¨ï¼ˆHAï¼‰åŠŸèƒ½ã€‚ å¤‡ä»½ä¸æ¢å¤ï¼šæä¾›å®Œæ•´çš„è™šæ‹Ÿæœºå¤‡ä»½å’Œæ¢å¤è§£å†³æ–¹æ¡ˆã€‚ ğŸ¯ æ ¸å¿ƒç›®å½•æ¦‚è§ˆ PVE çš„ä¸»è¦æ•°æ®å’Œé…ç½®å­˜å‚¨åœ¨ä»¥ä¸‹å‡ ä¸ªå…³é”®ä½ç½®ï¼š\nç›®å½•è·¯å¾„ ä¸»è¦åŠŸèƒ½ å¤‡æ³¨ /var/lib/vz/ é»˜è®¤å­˜å‚¨è™šæ‹Ÿç¯å¢ƒç›¸å…³æ•°æ®ï¼ˆISO, æ¨¡æ¿, å¤‡ä»½ç­‰ï¼‰ é‡è¦ï¼å¸¸éœ€è§„åˆ’è¾ƒå¤§ç©ºé—´æˆ–è¿ç§»è‡³ç‹¬ç«‹å­˜å‚¨ /etc/pve/ å­˜å‚¨ PVE é›†ç¾¤åŠèŠ‚ç‚¹é…ç½®ï¼ˆåŸºäº pmxcfs æ–‡ä»¶ç³»ç»Ÿï¼‰ é…ç½®åœ¨é›†ç¾¤å†…èŠ‚ç‚¹é—´è‡ªåŠ¨åŒæ­¥ /usr/share/pve-manager/ PVE Web ç®¡ç†ç•Œé¢ç›¸å…³æ–‡ä»¶ /var/log/ ç³»ç»ŸåŠ PVE ç›¸å…³æ—¥å¿—æ–‡ä»¶ æ’æŸ¥é—®é¢˜çš„é‡è¦ä¾æ® ğŸ“Š /var/lib/vz/ ç›®å½•ç»“æ„ 1 2 3 4 5 6 /var/lib/vz/ â”œâ”€â”€ template/ # æ¨¡æ¿æ–‡ä»¶ â”‚ â”œâ”€â”€ iso/ # ISO é•œåƒæ–‡ä»¶ â”‚ â””â”€â”€ cache/ # LXC å®¹å™¨æ¨¡æ¿ â”œâ”€â”€ images/ # è™šæ‹Ÿæœºç£ç›˜é•œåƒ (å¦‚æœä½¿ç”¨æœ¬åœ°å­˜å‚¨) â””â”€â”€ dump/ # å¤‡ä»½æ–‡ä»¶ (é»˜è®¤å¤‡ä»½ä½ç½®) ğŸ“€ ISO é•œåƒç›®å½• ISO é•œåƒé€šå¸¸å­˜æ”¾åœ¨ /var/lib/vz/template/iso/ ç›®å½•ä¸‹ï¼Œç”¨äºåˆ›å»ºè™šæ‹Ÿæœºã€‚\nğŸ” æŸ¥çœ‹ä¸ç®¡ç† ISO é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # è¿›å…¥ ISO é•œåƒç›®å½• cd /var/lib/vz/template/iso # æŸ¥çœ‹æ‰€æœ‰ ISO æ–‡ä»¶ï¼ˆè¯¦ç»†ä¿¡æ¯å¹¶æŒ‰å¤§å°æ’åºï¼‰ ls -lh *.iso | sort -k5hr # ç»Ÿè®¡ ISO æ–‡ä»¶æ•°é‡å’Œæ€»å¤§å° find /var/lib/vz/template/iso/ -name \u0026#34;*.iso\u0026#34; | wc -l du -sh /var/lib/vz/template/iso/ # ä¸Šä¼ æ–°çš„ ISO é•œåƒï¼ˆä¾‹å¦‚é€šè¿‡ SCPï¼‰ scp your-image.iso root@pve-host:/var/lib/vz/template/iso/ # è®¾ç½®æ­£ç¡®çš„æƒé™ chmod 644 /var/lib/vz/template/iso/your-image.iso # æ¸…ç†æ—§çš„ ISO æ–‡ä»¶ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ find /var/lib/vz/template/iso/ -name \u0026#34;*.iso\u0026#34; -mtime +365 -delete ğŸ³ å®¹å™¨æ¨¡æ¿ç›®å½• LXC å®¹å™¨æ¨¡æ¿é€šå¸¸å­˜æ”¾åœ¨ /var/lib/vz/template/cache/ ç›®å½•ä¸‹ï¼Œæ ¼å¼ä¸º *.tar.gz æˆ– *.tar.xzã€‚\nğŸ” æŸ¥çœ‹ä¸ç®¡ç†å®¹å™¨æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # è¿›å…¥å®¹å™¨æ¨¡æ¿ç›®å½• cd /var/lib/vz/template/cache # æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶ ls -lah *.tar.gz *.tar.xz # æŸ¥çœ‹æ¨¡æ¿è¯¦ç»†ä¿¡æ¯ ls -lh *.tar.* | awk \u0026#39;{print $5, $9}\u0026#39; | sort -h # ä½¿ç”¨ PVE å·¥å…·ç®¡ç†æ¨¡æ¿ pveam update # æ›´æ–°æ¨¡æ¿åˆ—è¡¨ pveam available --section system # åˆ—å‡ºå¯ç”¨æ¨¡æ¿ pveam download local alpine-3.18-default_20230628_amd64.tar.xz # ä¸‹è½½æ¨¡æ¿ # åˆ é™¤æ—§æ¨¡æ¿ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ rm /var/lib/vz/template/cache/old-template.tar.gz ğŸ–¥ï¸ è™šæ‹Ÿæœºé•œåƒç›®å½• è™šæ‹Ÿæœºçš„ç£ç›˜é•œåƒæ–‡ä»¶ï¼ˆå¦‚ qcow2ã€raw æ ¼å¼ï¼‰çš„å­˜æ”¾ä½ç½®å–å†³äºä½ é…ç½®çš„å­˜å‚¨ã€‚\nå¦‚æœä½¿ç”¨ PVE é»˜è®¤çš„ local å­˜å‚¨ï¼ˆåŸºäºç›®å½•ï¼‰ï¼Œé€šå¸¸ä¼šåœ¨ /var/lib/vz/images/\u0026lt;VM-ID\u0026gt;/ ä¸‹ã€‚ å¦‚æœä½¿ç”¨å…¶ä»–å­˜å‚¨ç±»å‹ï¼ˆå¦‚ ZFS, LVM, NFS, Ceph RBD ç­‰ï¼‰ï¼Œåˆ™ä¼šæœ‰ä¸åŒçš„è·¯å¾„å’Œè¡¨ç°æ–¹å¼ã€‚ ğŸ” æŸ¥çœ‹ä¸ç®¡ç†è™šæ‹Ÿæœºç£ç›˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿæœºç›®å½•ï¼ˆå¦‚æœä½¿ç”¨ local å­˜å‚¨ï¼‰ ls -la /var/lib/vz/images/ # æŸ¥çœ‹ç‰¹å®šè™šæ‹Ÿæœºçš„ç£ç›˜æ–‡ä»¶ï¼ˆå‡è®¾ VM ID ä¸º 101ï¼‰ ls -lh /var/lib/vz/images/101/ # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ du -sh /var/lib/vz/images/* | sort -hr # ä½¿ç”¨ qemu-img å·¥å…·æ£€æŸ¥ç£ç›˜ä¿¡æ¯ï¼ˆç¤ºä¾‹ï¼‰ qemu-img info /var/lib/vz/images/101/vm-101-disk-0.qcow2 # è°ƒæ•´ç£ç›˜å¤§å°ï¼ˆç¤ºä¾‹ï¼Œæ“ä½œå‰åŠ¡å¿…å¤‡ä»½ï¼ï¼‰ qemu-img resize /var/lib/vz/images/101/vm-101-disk-0.qcow2 +10G ğŸ’¾ å¤‡ä»½æ–‡ä»¶ç›®å½• PVE çš„å¤‡ä»½æ–‡ä»¶ï¼ˆç”± vzdump åˆ›å»ºï¼‰é»˜è®¤å­˜å‚¨åœ¨ /var/lib/vz/dump/ ç›®å½•ä¸‹ï¼Œæ ¼å¼ä¸º vzdump-*.vma.zst (æˆ– .lzo, .gz)ã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®ä¸“é—¨çš„å¤‡ä»½å­˜å‚¨ã€‚\nğŸ” æŸ¥çœ‹ä¸ç®¡ç†å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è¿›å…¥å¤‡ä»½ç›®å½• cd /var/lib/vz/dump # æŸ¥çœ‹æ‰€æœ‰å¤‡ä»½æ–‡ä»¶ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰ ls -lht *.vma* | head -10 # æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æ€»å¤§å° du -sh /var/lib/vz/dump/ # æ‰‹åŠ¨åˆ›å»ºå¤‡ä»½ï¼ˆåœæ­¢æ¨¡å¼å¤‡ä»½ VM 101ï¼Œä½¿ç”¨ zstd å‹ç¼©ï¼‰ vzdump 101 --compress zstd --mode stop # åˆ é™¤æ—§å¤‡ä»½ï¼ˆåˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½æ–‡ä»¶ï¼‰ find /var/lib/vz/dump/ -name \u0026#34;vzdump-*\u0026#34; -mtime +30 -delete PVE æ”¯æŒå¤šç§å¤‡ä»½æ¨¡å¼ï¼š\nåœæ­¢æ¨¡å¼ (Stop): ä¸€è‡´æ€§é«˜ï¼Œä½†è™šæ‹Ÿæœºéœ€åœæœºã€‚ æŒ‚èµ·æ¨¡å¼ (Suspend): å…¼å®¹æ€§å¥½ï¼Œä½†åœæœºæ—¶é—´è¾ƒé•¿ã€‚ å¿«ç…§æ¨¡å¼ (Snapshot): åœæœºæ—¶é—´çŸ­ï¼Œæ¨èä½¿ç”¨ï¼ˆéœ€è¦å­˜å‚¨æ”¯æŒæˆ–ä½¿ç”¨ Proxmox VE å®æ—¶å¤‡ä»½ï¼‰ã€‚ ğŸ”§ å…¶ä»–é‡è¦ç›®å½• âš™ï¸ é…ç½®æ–‡ä»¶ç›®å½• /etc/pve/ æ­¤ç›®å½•åŸºäºé›†ç¾¤æ–‡ä»¶ç³»ç»Ÿ (pmxcfs)ï¼Œé…ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹é—´è‡ªåŠ¨åŒæ­¥ã€‚\n1 2 3 4 5 6 7 8 /etc/pve/ â”œâ”€â”€ nodes/ # å„èŠ‚ç‚¹å•ç‹¬é…ç½® â”‚ â””â”€â”€ \u0026lt;node-name\u0026gt;/ â”œâ”€â”€ qemu-server/ # è™šæ‹Ÿæœº (QEMU/KVM) é…ç½®æ–‡ä»¶ (.conf) â”œâ”€â”€ lxc/ # å®¹å™¨ (LXC) é…ç½®æ–‡ä»¶ (.conf) â”œâ”€â”€ storage.cfg # å­˜å‚¨é…ç½® â”œâ”€â”€ user.cfg # ç”¨æˆ·æƒé™é…ç½® â””â”€â”€ firewall/ # é˜²ç«å¢™é…ç½® æŸ¥çœ‹é…ç½®ç¤ºä¾‹ï¼š\n1 2 3 cat /etc/pve/qemu-server/101.conf # æŸ¥çœ‹ ID ä¸º 101 çš„è™šæ‹Ÿæœºé…ç½® cat /etc/pve/lxc/102.conf # æŸ¥çœ‹ ID ä¸º 102 çš„å®¹å™¨é…ç½® cat /etc/pve/storage.cfg # æŸ¥çœ‹å­˜å‚¨é…ç½® ğŸ“ æ—¥å¿—æ–‡ä»¶ç›®å½• /var/log/ æ—¥å¿—æ˜¯æ’æŸ¥é—®é¢˜çš„é‡è¦å·¥å…·ã€‚\n1 2 3 4 5 /var/log/ â”œâ”€â”€ pveproxy/ # Web è®¿é—®æ—¥å¿— â”œâ”€â”€ pvedaemon/ # PVE æœåŠ¡æ—¥å¿— â”œâ”€â”€ syslog # ç³»ç»Ÿæ—¥å¿— â””â”€â”€ daemon.log # å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— æŸ¥çœ‹æ—¥å¿—ç¤ºä¾‹ï¼š\n1 2 tail -f /var/log/syslog | grep pve # å®æ—¶æŸ¥çœ‹ PVE ç›¸å…³ç³»ç»Ÿæ—¥å¿— journalctl -u pveproxy -f # å®æ—¶æŸ¥çœ‹ Web æœåŠ¡æ—¥å¿— ğŸ” å®‰å…¨ç›¸å…³ç›®å½• SSL è¯ä¹¦: /etc/pve/nodes/\u0026lt;node-name\u0026gt;/pve-ssl.pem ç”¨æˆ·é…ç½®: /etc/pve/user.cfg é˜²ç«å¢™é…ç½®: /etc/pve/firewall/ ğŸ’¡ ç®¡ç†æŠ€å·§ä¸æ—¥å¸¸ç»´æŠ¤ ğŸ¯ æ—¥å¸¸ç»´æŠ¤å‘½ä»¤ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹æ•´ä½“å­˜å‚¨ä½¿ç”¨æƒ…å†µ df -h /var/lib/vz/ pvesm status # æŸ¥çœ‹å·²é…ç½®çš„å­˜å‚¨çŠ¶æ€ # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆè°¨æ…æ“ä½œï¼‰ find /var/lib/vz/ -name \u0026#34;*.tmp\u0026#34; -delete # ç›‘æ§ç›®å½•å˜åŒ–ï¼ˆéœ€è¦ inotify-toolsï¼‰ inotifywait -m /var/lib/vz/template/iso/ ğŸ› ï¸ å®ç”¨è„šæœ¬ç¤ºä¾‹ï¼šå­˜å‚¨ç©ºé—´ç›‘æ§è­¦æŠ¥ 1 2 3 4 5 6 #!/bin/bash THRESHOLD=90 USAGE=$(df /var/lib/vz/ | awk \u0026#39;NR==2 {print $5}\u0026#39; | sed \u0026#39;s/%//\u0026#39;) if [ $USAGE -gt $THRESHOLD ]; then echo \u0026#34;PVE å­˜å‚¨ç©ºé—´è­¦å‘Š: ä½¿ç”¨ç‡å·²è¾¾ $USAGE% | $(date)\u0026#34; | mail -s \u0026#34;PVE Storage Alert on $(hostname)\u0026#34; admin@example.com fi ğŸ”„ è¿ç§»å’Œä¼˜åŒ– 1 2 3 4 5 # ä½¿ç”¨ rsync è¿ç§» ISO æ–‡ä»¶åˆ°æ–°å­˜å‚¨ï¼ˆå‡è®¾æ–°å­˜å‚¨æŒ‚è½½åœ¨ /new-storageï¼‰ rsync -av --progress /var/lib/vz/template/iso/ /new-storage/iso/ # è®¾ç½®å®šæœŸæ¸…ç†ä»»åŠ¡ï¼ˆä¾‹å¦‚æ¯å‘¨æ—¥å‡Œæ™¨ 2 ç‚¹æ¸…ç† 30 å¤©å‰çš„å¤‡ä»½ï¼‰ echo \u0026#34;0 2 * * 0 find /var/lib/vz/dump/ -name \\\u0026#34;vzdump-*\\\u0026#34; -mtime +30 -delete\u0026#34; \u0026gt;\u0026gt; /etc/crontab âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ æ“ä½œè°¨æ…ï¼šåœ¨å¯¹ç”Ÿäº§ç¯å¢ƒçš„ä»»ä½•æ–‡ä»¶è¿›è¡Œåˆ é™¤æˆ–ä¿®æ”¹æ“ä½œå‰ï¼ŒåŠ¡å¿…ç¡®è®¤æ“ä½œå½±å“å¹¶åšå¥½å¤‡ä»½ã€‚ å­˜å‚¨è§„åˆ’ï¼š/var/lib/vz é»˜è®¤ç©ºé—´æœ‰é™ï¼Œå»ºè®®æ ¹æ®å®é™…éœ€æ±‚è§„åˆ’å­˜å‚¨ï¼Œæˆ–ä½¿ç”¨ PVE çš„å­˜å‚¨åŠŸèƒ½å°†æ•°æ®ç›®å½•é…ç½®åˆ°æ›´å¤§å®¹é‡çš„ç‹¬ç«‹å­˜å‚¨ä¸Šã€‚ å¤‡ä»½ç­–ç•¥ï¼šä¸ä»…è¦å¤‡ä»½è™šæ‹Ÿæœºï¼Œä¹Ÿè¦è€ƒè™‘å¤‡ä»½ PVE èŠ‚ç‚¹çš„å…³é”®é…ç½®ï¼ˆå¦‚ /etc/pve ç›®å½•ä¸‹çš„é…ç½®ï¼Œå°½ç®¡å®ƒä»¬åœ¨é›†ç¾¤ä¸­åŒæ­¥ï¼Œä½†ä»å»ºè®®é¢å¤–å¤‡ä»½ï¼‰ã€‚Proxmox Backup Server (PBS) æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ æƒé™ç®¡ç†ï¼šä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•æƒé™æ—¶éœ€å°å¿ƒï¼Œé”™è¯¯çš„æƒé™å¯èƒ½å¯¼è‡´ PVE æœåŠ¡æ— æ³•æ­£å¸¸è®¿é—®èµ„æºã€‚ ğŸ¯ æç¤ºï¼šç†Ÿæ‚‰ PVE çš„ç›®å½•ç»“æ„æ˜¯é«˜æ•ˆç®¡ç†çš„åŸºç¡€ã€‚å®šæœŸæ£€æŸ¥å…³é”®ç›®å½•çš„ä½¿ç”¨æƒ…å†µï¼Œåˆç†è§„åˆ’å­˜å‚¨ï¼Œå¹¶åˆ¶å®šå®Œå–„çš„å¤‡ä»½ç­–ç•¥ï¼Œæ˜¯ä¿æŒ PVE ç¯å¢ƒç¨³å®šè¿è¡Œçš„å…³é”®ã€‚\nğŸ“š æ‰©å±•é˜…è¯»ï¼š\nProxmox VE å®˜æ–¹æ–‡æ¡£ - Storage Proxmox VE å®˜æ–¹æ–‡æ¡£ - Backup and Restore Proxmox VE å®˜æ–¹æ–‡æ¡£ - File System Layout å¸Œæœ›è¿™ä»½è¯¦è§£èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œç®¡ç†ä½ çš„ Proxmox VE ç¯å¢ƒï¼\n","date":"2024-12-07T16:42:12+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/2cedc9ea/","title":"Proxmox VE åŸºæœ¬ç›®å½•ç»“æ„è¯¦è§£ ğŸ“"},{"content":"iStoreOS é…ç½® iSCSI å­˜å‚¨åŠ Windows å®¢æˆ·ç«¯è¿æ¥æŒ‡å— ğŸ–¥ï¸ iSCSI å…è®¸ä½ åœ¨ç½‘ç»œä¸Šå…±äº«å—è®¾å¤‡ï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒä½¿ç”¨æœ¬åœ°ç¡¬ç›˜ä¸€æ ·ä½¿ç”¨è¿™äº›å…±äº«å­˜å‚¨ã€‚ä¸‹é¢æ˜¯ iStoreOS ä¸Šé…ç½® iSCSI æœåŠ¡ç«¯åŠ Windows å®¢æˆ·ç«¯è¿æ¥çš„è¯¦ç»†æŒ‡å—ã€‚\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ iSCSI ç®€ä»‹ä¸ä¼˜åŠ¿ ğŸ”§ iStoreOS æœåŠ¡ç«¯é…ç½® ğŸ–¥ï¸ Windows å®¢æˆ·ç«¯è¿æ¥ âš™ï¸ é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ”’ å®‰å…¨åŠ å›ºå»ºè®® ğŸ› æ•…éšœæ’é™¤ ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤ âœ¨ iSCSI ç®€ä»‹ä¸ä¼˜åŠ¿ iSCSI (Internet Small Computer System Interface) æ˜¯ä¸€ç§åŸºäº IP ç½‘ç»œçš„å­˜å‚¨åè®®ï¼Œå®ƒå…è®¸åœ¨ IP ç½‘ç»œä¸Šä¼ è¾“ SCSI å‘½ä»¤ï¼Œå°†è¿œç¨‹å­˜å‚¨è®¾å¤‡æ˜ å°„ä¸ºæœ¬åœ°å—è®¾å¤‡ã€‚\næˆæœ¬æ•ˆç›Šï¼šåˆ©ç”¨ç°æœ‰ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œæ— éœ€ä¸“é—¨æ„å»ºæ˜‚è´µçš„å…‰çº¤é€šé“ç½‘ç»œã€‚ çµæ´»æ€§ï¼šæ–¹ä¾¿æ‰©å±•å­˜å‚¨å®¹é‡ï¼Œå¯åœ¨ä¸åŒæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°é—´å®ç°å­˜å‚¨å…±äº«ã€‚ åº”ç”¨åœºæ™¯ï¼šå¸¸ç”¨äºæ•°æ®ä¸­å¿ƒæœåŠ¡å™¨å­˜å‚¨æ‰©å±•å’Œä¼ä¸šçº§åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“å­˜å‚¨ï¼‰ã€‚ ğŸ”§ iStoreOS æœåŠ¡ç«¯é…ç½® ğŸ“¦ 1. å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ… iStoreOS åŸºäº OpenWRTï¼Œå¯ä»¥ä½¿ç”¨ opkg åŒ…ç®¡ç†å™¨å®‰è£…æ‰€éœ€è½¯ä»¶ã€‚\n1 2 3 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… tgtï¼ˆiSCSI ç›®æ ‡è½¯ä»¶ï¼‰å’Œå†…æ ¸æ¨¡å— opkg update opkg install tgt kmod-scsi-core ğŸ“‚ 2. å‡†å¤‡å­˜å‚¨è®¾å¤‡ ç¡®ä¿ä½ æœ‰ä¸€å—ç£ç›˜ï¼ˆå¦‚ /dev/sda1ï¼‰å¯ç”¨äºå…±äº«ã€‚ä½¿ç”¨ df -h æˆ– lsblk æŸ¥çœ‹å¯ç”¨ç£ç›˜å’Œåˆ†åŒºã€‚\n1 2 3 4 # æŸ¥çœ‹ç£ç›˜æŒ‚è½½æƒ…å†µ df -h # æˆ–æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯ lsblk âš™ï¸ 3. é…ç½® iSCSI ç›®æ ‡æœåŠ¡ iSCSI ç›®æ ‡çš„é…ç½®é€šå¸¸ä½äº /etc/config/tgtã€‚ä½ å¯ä»¥ç›´æ¥ç¼–è¾‘æ­¤æ–‡ä»¶æˆ–ä½¿ç”¨ uci å‘½ä»¤ï¼ˆå¦‚æœ iStoreOS æ”¯æŒï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆ›å»ºæˆ–ç¼–è¾‘ tgt é…ç½®æ–‡ä»¶ cat \u0026gt; /etc/config/tgt \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # å…¨å±€é€‰é¡¹ config options \u0026#39;tgt\u0026#39; option iothreads \u0026#39;2\u0026#39; # I/O çº¿ç¨‹æ•°ï¼Œå¯æ ¹æ® CPU æ ¸å¿ƒè°ƒæ•´ # å®šä¹‰ç¬¬ä¸€ä¸ª iSCSI ç›®æ ‡ config target 1 option name \u0026#39;iqn.2024-09.com.istoreos:storage.disk1\u0026#39; # ç›®æ ‡ IQN åç§°ï¼Œéœ€å”¯ä¸€ # å¯é€‰é¡¹ï¼šå…è®¸è®¿é—®çš„å®¢æˆ·ç«¯ IP èŒƒå›´ list allow_address \u0026#39;192.168.1.0/24\u0026#39; # å®šä¹‰ç¬¬ä¸€ä¸ªç›®æ ‡ä¸‹çš„ LUNï¼ˆé€»è¾‘å•å…ƒï¼‰ config lun 1_1 option device \u0026#39;/dev/sda1\u0026#39; # è¦å…±äº«çš„ç‰©ç†è®¾å¤‡è·¯å¾„ option target \u0026#39;1\u0026#39; # å…³è”çš„ç›®æ ‡ ID # å¯é€‰ï¼šé…ç½® CHAP è®¤è¯ï¼ˆå¼ºçƒˆå»ºè®®å¯ç”¨ï¼‰ config account list target \u0026#39;1\u0026#39; # å…³è”çš„ç›®æ ‡ ID option user \u0026#39;admin\u0026#39; # CHAP ç”¨æˆ·å option password \u0026#39;yifan0719\u0026#39; # CHAP å¯†ç ï¼Œè¯·ä½¿ç”¨å¼ºå¯†ç  EOF å…³é”®å‚æ•°è¯´æ˜ï¼š\nIQN åç§°æ ¼å¼ï¼šiqn.yyyy-mm.reverse.domain.name:optional.identifierã€‚ deviceï¼šè¦å…±äº«çš„å—è®¾å¤‡ï¼ˆå¦‚ /dev/sda1ï¼‰æˆ–æ–‡ä»¶ï¼ˆéœ€é¢„å…ˆåˆ›å»ºï¼‰ã€‚ CHAP è®¤è¯ï¼šå¼ºçƒˆå»ºè®®å¯ç”¨ä»¥æé«˜å®‰å…¨æ€§ã€‚ ğŸ”„ 4. å¯åŠ¨å¹¶éªŒè¯æœåŠ¡ é…ç½®å®Œæˆåï¼Œå¯åŠ¨ tgt æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ã€‚\n1 2 3 4 5 6 # å¯åŠ¨ tgt æœåŠ¡ service tgt start # è®¾ç½®å¼€æœºè‡ªå¯ service tgt enable # æ£€æŸ¥æœåŠ¡çŠ¶æ€ service tgt status ä½¿ç”¨ tgtadm å‘½ä»¤éªŒè¯ç›®æ ‡æ˜¯å¦å‘å¸ƒæˆåŠŸï¼š\n1 2 # æŸ¥çœ‹å®šä¹‰çš„ iSCSI ç›®æ ‡ tgtadm --mode target --op show é¢„æœŸè¾“å‡ºåº”æ˜¾ç¤ºä½ å®šä¹‰çš„ Target IQN å’Œ LUN ä¿¡æ¯ã€‚\nğŸ”¥ 5. é˜²ç«å¢™é…ç½® iSCSI æœåŠ¡é»˜è®¤ä½¿ç”¨ TCP ç«¯å£ 3260ã€‚ç¡®ä¿é˜²ç«å¢™å…è®¸å®¢æˆ·ç«¯è®¿é—®æ­¤ç«¯å£ã€‚\n1 2 3 # å…è®¸ iSCSI ç«¯å£ï¼ˆ3260/TCPï¼‰çš„è®¿é—®ï¼ˆç¤ºä¾‹ï¼Œå…·ä½“å‘½ä»¤å–å†³äºä½ çš„é˜²ç«å¢™ï¼‰ iptables -A INPUT -p tcp --dport 3260 -s 192.168.1.0/24 -j ACCEPT # ç„¶åè®°å¾—ä¿å­˜é˜²ç«å¢™è§„åˆ™ ğŸ–¥ï¸ Windows å®¢æˆ·ç«¯è¿æ¥ Windows ç³»ç»Ÿé€šå¸¸è‡ªå¸¦ iSCSI å‘èµ·ç¨‹åºï¼Œä½†å¯èƒ½éœ€è¦å¯ç”¨ã€‚\nâš™ï¸ 1. å¯åŠ¨ iSCSI å‘èµ·ç¨‹åºå¹¶é…ç½® Initiator Name æŒ‰ Win + Rï¼Œè¾“å…¥ iscsicpl.exe å¹¶å›è½¦ã€‚ å¦‚æœé¦–æ¬¡ä½¿ç”¨ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæç¤ºå¯åŠ¨ Microsoft iSCSI æœåŠ¡ï¼Œé€‰æ‹©æ˜¯ã€‚ åœ¨ iSCSI å‘èµ·ç¨‹åºå±æ€§ çª—å£ä¸­ï¼Œè½¬åˆ° Configuration é€‰é¡¹å¡ã€‚ è®°å½•æˆ–ä¿®æ”¹ Initiator Nameã€‚Windows ä¼šæä¾›ä¸€ä¸ªé»˜è®¤åç§°ï¼Œå…¶æ ¼å¼é€šå¸¸ä¸º iqn.1991-05.com.microsoft:[hostname]ï¼Œä½ ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸ºä¸€ä¸ªç¬¦åˆæ ¼å¼çš„å”¯ä¸€åç§°ã€‚æ­¤åç§°éœ€ä¸ iStoreOS ä¸Šè®¾ç½®çš„ ACLï¼ˆå¦‚æœé…ç½®äº†çš„è¯ï¼‰åŒ¹é…ã€‚ ğŸ” 2. å‘ç°ç›®æ ‡ åœ¨ Discovery é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡» Discover Portal\u0026hellip;ã€‚ åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥ä½ çš„ iStoreOS çš„ IP åœ°å€ã€‚ç«¯å£ä¿æŒé»˜è®¤çš„ 3260ã€‚ç‚¹å‡» OKã€‚ ğŸ”— 3. è¿æ¥ç›®æ ‡å¹¶é…ç½® CHAP è½¬åˆ° Targets é€‰é¡¹å¡ã€‚åœ¨ Discovered targets åˆ—è¡¨ä¸­ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°åœ¨ iStoreOS ä¸Šé…ç½®çš„ Target IQNï¼ŒçŠ¶æ€ä¸º Inactiveã€‚ é€‰ä¸­è¯¥ç›®æ ‡ï¼Œç‚¹å‡» Connectï¼Œç„¶åç‚¹å‡» OKã€‚æ­¤æ—¶çŠ¶æ€åº”å˜ä¸º Connectedã€‚ å¦‚æœä½ åœ¨ iStoreOS ä¸Šé…ç½®äº† CHAP è®¤è¯ï¼Œéœ€è¦è¿›ä¸€æ­¥è®¾ç½®ï¼š åœ¨ Targets é€‰é¡¹å¡ï¼Œé€‰ä¸­å·²è¿æ¥çš„ç›®æ ‡ï¼Œç‚¹å‡» Propertiesã€‚ åœ¨ Properties çª—å£ä¸­ï¼Œç‚¹å‡» Configure CHAP\u0026hellip;ã€‚ é€‰ä¸­ Use CHAP to authenticateã€‚ åœ¨ Name ä¸­è¾“å…¥ iStoreOS ä¸Šè®¾ç½®çš„ CHAP ç”¨æˆ·åï¼ˆå¦‚ adminï¼‰ã€‚ åœ¨ Target secret ä¸­è¾“å…¥å¯¹åº”çš„å¯†ç ï¼ˆå¦‚ yifan0719ï¼‰ã€‚ ç‚¹å‡» OK ä¿å­˜ã€‚ ğŸ’¾ 4. åˆå§‹åŒ–å’Œä½¿ç”¨ç£ç›˜ è¿æ¥æˆåŠŸåï¼ŒWindows ä¼šå°† iSCSI ç£ç›˜è¯†åˆ«ä¸ºæ–°çš„ç‰©ç†ç£ç›˜ã€‚\næ‰“å¼€ ç£ç›˜ç®¡ç†ï¼ˆWin + R è¾“å…¥ diskmgmt.mscï¼‰ã€‚ ç³»ç»Ÿé€šå¸¸ä¼šæç¤ºä½ åˆå§‹åŒ–æ–°ç£ç›˜ã€‚é€‰æ‹©åˆ†åŒºæ ·å¼ï¼ˆMBR æˆ– GPTï¼Œæ¨è GPT for large disksï¼‰ã€‚ åˆå§‹åŒ–åï¼Œç£ç›˜çŠ¶æ€å˜ä¸º Online å’Œ Unallocatedã€‚ å³é”®ç‚¹å‡»æœªåˆ†é…ç©ºé—´ï¼Œé€‰æ‹© New Simple Volume\u0026hellip;ï¼ŒæŒ‰ç…§å‘å¯¼åˆ›å»ºåˆ†åŒºã€æ ¼å¼åŒ–ï¼ˆé€‰æ‹©æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ NTFSï¼‰å¹¶åˆ†é…é©±åŠ¨å™¨å·ã€‚ å®Œæˆåï¼Œå³å¯åœ¨ æ–‡ä»¶èµ„æºç®¡ç†å™¨ ä¸­åƒä½¿ç”¨æœ¬åœ°ç£ç›˜ä¸€æ ·ä½¿ç”¨è¯¥ç½‘ç»œå­˜å‚¨ã€‚ âš™ï¸ é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ¯ å¤šç›®æ ‡ä¸å¤š LUN é…ç½® ä½ å¯ä»¥åœ¨ /etc/config/tgt ä¸­å®šä¹‰å¤šä¸ªç›®æ ‡å’Œ LUNã€‚\n1 2 3 4 5 6 7 8 9 10 11 # ç¤ºä¾‹ï¼šæ·»åŠ ç¬¬äºŒä¸ªç›®æ ‡å’Œä½¿ç”¨æ–‡ä»¶æ˜ åƒ config target 2 option name \u0026#39;iqn.2024-09.com.istoreos:storage.disk2\u0026#39; list allow_address \u0026#39;192.168.1.50\u0026#39; # åªå…è®¸ç‰¹å®š IP è®¿é—® config lun 2_1 option target \u0026#39;2\u0026#39; # ä½¿ç”¨æ–‡ä»¶ä½œä¸ºå­˜å‚¨åç«¯ï¼ˆéœ€é¢„å…ˆåˆ›å»ºï¼‰ option device \u0026#39;/path/to/backend-file.img\u0026#39; # å¯é€‰ï¼šæŒ‡å®š LUN ç¼–å· option lun \u0026#39;1\u0026#39; åˆ›å»ºæ–‡ä»¶åç«¯ï¼š\n1 2 # åˆ›å»ºä¸€ä¸ª 10GB çš„ç©ºæ–‡ä»¶ä½œä¸ºå­˜å‚¨åç«¯ dd if=/dev/zero of=/path/to/backend-file.img bs=1G count=10 ğŸš€ æ€§èƒ½ä¼˜åŒ–å‚æ•° åœ¨ /etc/config/tgt çš„å…¨å±€é€‰é¡¹æˆ–ç‰¹å®šç›®æ ‡ä¸­è°ƒæ•´å‚æ•°ï¼š\n1 2 3 4 5 6 config options \u0026#39;tgt\u0026#39; option iothreads \u0026#39;4\u0026#39; # æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ I/O çº¿ç¨‹ option nop_interval \u0026#39;5\u0026#39; # NOP-Out è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰ï¼Œç”¨äºè¿æ¥ä¿æ´» config target 1 # ç›®æ ‡ç‰¹å®šé€‰é¡¹ option queue_depth \u0026#39;32\u0026#39; # é˜Ÿåˆ—æ·±åº¦ï¼Œæé«˜å¹¶å‘ I/O ç½‘ç»œä¼˜åŒ–ï¼ˆåœ¨ iStoreOS ç³»ç»Ÿè®¾ç½®ä¸­è€ƒè™‘ï¼‰ï¼š\nJumbo Framesï¼šå¦‚æœç½‘ç»œè®¾å¤‡ï¼ˆäº¤æ¢æœºã€ç½‘å¡ï¼‰æ”¯æŒï¼Œå¯å¯ç”¨å·¨å¸§ï¼ˆMTU 9000ï¼‰ä»¥æå‡å¤§æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚ ä¸“ç”¨ç½‘ç»œï¼šä¸º iSCSI æµé‡åˆ’åˆ†ç‹¬ç«‹çš„ VLAN æˆ–ç‰©ç†ç½‘ç»œï¼Œä»¥å‡å°‘å…¶ä»–æµé‡çš„å¹²æ‰°ã€‚ ğŸ”’ å®‰å…¨åŠ å›ºå»ºè®® ä½¿ç”¨å¼º CHAP å¯†ç ï¼šé¿å…ä½¿ç”¨é»˜è®¤æˆ–ç®€å•å¯†ç ã€‚å®šæœŸæ›´æ¢å¯†ç ã€‚ 1 2 # ç¤ºä¾‹ï¼šä½¿ç”¨ apg ç”Ÿæˆå¼ºå¯†ç ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ apg -m 12 -n 1 ç½‘ç»œéš”ç¦»ï¼šä½¿ç”¨é˜²ç«å¢™è§„åˆ™ä¸¥æ ¼é™åˆ¶ä»…å…è®¸æˆæƒçš„å®¢æˆ·ç«¯ IP åœ°å€è®¿é—® iSCSI ç«¯å£ 3260ã€‚ IP è¿‡æ»¤ï¼šåœ¨ tgt é…ç½®ä¸­ä½¿ç”¨ allow_address åˆ—è¡¨è¿›ä¸€æ­¥é™åˆ¶è®¿é—®æº IPã€‚ ç¦ç”¨æœªä½¿ç”¨çš„ç›®æ ‡ï¼šå¦‚æœä¸ä½¿ç”¨æŸä¸ªç›®æ ‡ï¼Œæœ€å¥½å°†å…¶é…ç½®æ³¨é‡Šæˆ–åˆ é™¤ï¼Œè€Œä¸æ˜¯ä»…ä»…åœæ­¢æœåŠ¡ã€‚ ğŸ› æ•…éšœæ’é™¤ ğŸ” iStoreOS ç«¯æ£€æŸ¥ æœåŠ¡çŠ¶æ€ï¼šç¡®è®¤ tgt æœåŠ¡æ­£åœ¨è¿è¡Œï¼šservice tgt statusã€‚ ç›®æ ‡å¯è§æ€§ï¼šä½¿ç”¨ tgtadm --mode target --op show ç¡®è®¤ç›®æ ‡å·²æ­£ç¡®é…ç½®ä¸” LUN çŠ¶æ€æ­£å¸¸ã€‚ æ—¥å¿—æŸ¥çœ‹ï¼šä½¿ç”¨ logread | grep tgt æˆ– journalctl -u tgtï¼ˆå–å†³äºç³»ç»Ÿï¼‰æŸ¥çœ‹æœåŠ¡æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ã€‚ ç«¯å£ç›‘å¬ï¼šç¡®è®¤ tgt æ­£åœ¨ç›‘å¬ 3260 ç«¯å£ï¼šnetstat -tlnp | grep 3260 æˆ– ss -tlnp | grep 3260ã€‚ é˜²ç«å¢™ï¼šç¡®è®¤é˜²ç«å¢™å·²æ”¾è¡Œ 3260 ç«¯å£ï¼šiptables -L -n | grep 3260ã€‚ ğŸ” Windows ç«¯æ£€æŸ¥ ç½‘ç»œè¿é€šæ€§ï¼šåœ¨ Windows å‘½ä»¤æç¤ºç¬¦ä¸­ ping iStoreOS çš„ IP åœ°å€ï¼šping \u0026lt;iStoreOS_IP\u0026gt;ã€‚ å‘èµ·ç¨‹åºæœåŠ¡ï¼šç¡®ä¿ Microsoft iSCSI Initiator Service æ­£åœ¨è¿è¡Œã€‚ å‘ç°ç›®æ ‡ï¼šåœ¨ iSCSI å‘èµ·ç¨‹åº çš„ Discovery é€‰é¡¹å¡ä¸­ï¼Œç¡®è®¤å·²æ·»åŠ æ­£ç¡®çš„ iStoreOS é—¨æˆ·åœ°å€ã€‚ CHAP è®¤è¯ï¼šä»”ç»†æ ¸å¯¹ CHAP ç”¨æˆ·åå’Œå¯†ç ï¼Œå¤§å°å†™æ•æ„Ÿï¼Œç¡®ä¿ä¸ iStoreOS é…ç½®å®Œå…¨ä¸€è‡´ã€‚ è¿æ¥çŠ¶æ€ï¼šåœ¨ Targets é€‰é¡¹å¡ï¼ŒæŸ¥çœ‹ç›®æ ‡çŠ¶æ€æ˜¯å¦ä¸º Connectedã€‚ Windows æ—¥å¿—ï¼šæ£€æŸ¥ äº‹ä»¶æŸ¥çœ‹å™¨ ä¸­çš„ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºæ—¥å¿—ï¼Œç­›é€‰ä¸ iSCSI æˆ–ç£ç›˜ç›¸å…³çš„é”™è¯¯äº‹ä»¶ã€‚ ğŸ” å¸¸è§é—®é¢˜ æ— æ³•å‘ç°ç›®æ ‡ï¼šæ£€æŸ¥ç½‘ç»œè¿é€šæ€§ã€é˜²ç«å¢™ã€iStoreOS ä¸Š tgt æœåŠ¡çŠ¶æ€åŠé…ç½®æ˜¯å¦æ­£ç¡®ã€‚ è¿æ¥å¤±è´¥æˆ–è®¤è¯é”™è¯¯ï¼šä»”ç»†æ£€æŸ¥ CHAP é…ç½®ï¼ˆç”¨æˆ·åã€å¯†ç ã€Secretï¼‰åœ¨ iStoreOS å’Œ Windows ç«¯æ˜¯å¦å®Œå…¨ä¸€è‡´ã€‚ ç£ç›˜æœªå‡ºç°åœ¨ç£ç›˜ç®¡ç†ï¼šå°è¯•åœ¨ ç£ç›˜ç®¡ç† ä¸­æ“ä½œ \u0026ldquo;Rescan Disks\u0026rdquo; æˆ–é‡å¯ Windows çš„ iSCSI Initiator Serviceã€‚ æ€§èƒ½å·®ï¼šæ£€æŸ¥ç½‘ç»œå¸¦å®½ã€å»¶è¿Ÿã€æ˜¯å¦å¯ç”¨å·¨å¸§ã€iSCSI å‚æ•°ä¼˜åŒ–ï¼ˆé˜Ÿåˆ—æ·±åº¦ç­‰ï¼‰ã€‚ ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤ ğŸ‘€ åŸºæœ¬ç›‘æ§ iStoreOS è¿æ¥çŠ¶æ€ï¼šå®šæœŸä½¿ç”¨ tgtadm --mode conn --op show --tid \u0026lt;TID\u0026gt; æŸ¥çœ‹æ´»åŠ¨è¿æ¥ã€‚ Windows æ€§èƒ½è®¡æ•°å™¨ï¼šåœ¨ ä»»åŠ¡ç®¡ç†å™¨ â†’ æ€§èƒ½ é€‰é¡¹å¡æˆ– èµ„æºç›‘è§†å™¨ ä¸­ç›‘æ§ iSCSI ç£ç›˜çš„ I/O æ´»åŠ¨ã€‚ ğŸ”„ å®šæœŸç»´æŠ¤ å¤‡ä»½é…ç½®ï¼šå®šæœŸå¤‡ä»½ /etc/config/tgt æ–‡ä»¶ã€‚ 1 cp /etc/config/tgt /etc/config/tgt.backup.$(date +%Y%m%d) æ›´æ–°è½¯ä»¶ï¼šå®šæœŸæ›´æ–° iStoreOS å’Œ tgt è½¯ä»¶åŒ…ä»¥è·å–å®‰å…¨è¡¥ä¸å’ŒåŠŸèƒ½æ›´æ–°ã€‚ 1 opkg update \u0026amp;\u0026amp; opkg list-upgradable | cut -f 1 -d \u0026#39; \u0026#39; | xargs opkg upgrade ç£ç›˜å¥åº·ï¼šç›‘æ§å…±äº«ç£ç›˜çš„ SMART çŠ¶æ€å’Œå¯ç”¨ç©ºé—´ã€‚ 1 2 smartctl -a /dev/sda1 # éœ€è¦å®‰è£… smartmontools df -h /dev/sda1 éµå¾ªæœ¬æŒ‡å—ï¼Œä½ åº”è¯¥èƒ½åœ¨ iStoreOS ä¸ŠæˆåŠŸé…ç½® iSCSI å­˜å‚¨æœåŠ¡ï¼Œå¹¶ä½¿å…¶åœ¨ Windows å®¢æˆ·ç«¯ä¸Šå¯ç”¨ã€‚è®°å¾—ä¼˜å…ˆå¯ç”¨ CHAP è®¤è¯å’Œç½‘ç»œè®¿é—®æ§åˆ¶ä»¥ä¿éšœå®‰å…¨ã€‚\n","date":"2024-12-07T16:41:41+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/413dbbb5/","title":"iStoreOS é…ç½® iSCSI å­˜å‚¨åŠ Windows å®¢æˆ·ç«¯è¿æ¥æŒ‡å— ğŸ–¥ï¸"},{"content":"Linux é…ç½® Samba æœåŠ¡ä¸€é”®è„šæœ¬ï¼ˆæœ¬åœ°ï¼‰ğŸ§ å¿«é€Ÿä¸ºä¸åŒ Linux å‘è¡Œç‰ˆé…ç½® Samba å…±äº«æœåŠ¡çš„è‡ªåŠ¨åŒ–è„šæœ¬åˆé›†ï¼ğŸš€\nğŸŒŸ ç›®å½•å¯¼èˆª ğŸŒŸ è„šæœ¬ç‰¹ç‚¹ ğŸ“‹ ä½¿ç”¨å‰é¡»çŸ¥ ğŸ¯ Debian Samba é…ç½®è„šæœ¬ ğŸ¦ Ubuntu Samba é…ç½®è„šæœ¬ ğŸ”§ PVE Samba é…ç½®è„šæœ¬ ğŸ© CentOS Samba é…ç½®è„šæœ¬ ğŸ”ï¸ Alpine Linux Samba é…ç½®è„šæœ¬ ğŸ” éªŒè¯ä¸æ’æŸ¥ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ†˜ å¸¸è§é—®é¢˜ ğŸŒŸ è„šæœ¬ç‰¹ç‚¹ ğŸ” å®‰å…¨è®¤è¯ï¼šæ‰€æœ‰å…±äº«å‡éœ€è¦ç”¨æˆ·åå¯†ç è®¤è¯ ğŸ macOS ä¼˜åŒ–ï¼šå®Œç¾æ”¯æŒ Apple ç”Ÿæ€ç³»ç»Ÿï¼ˆTime Machineã€æ–‡ä»¶ç¼–ç ç­‰ï¼‰ ğŸ“ çµæ´»é…ç½®ï¼šå¯è‡ªå®šä¹‰å…±äº«è·¯å¾„ã€æƒé™å’Œç”¨æˆ·è®¾ç½® âš¡ ä¸€é”®éƒ¨ç½²ï¼šç®€åŒ–å¤æ‚é…ç½®è¿‡ç¨‹ï¼Œå¿«é€Ÿæ­å»ºæ–‡ä»¶å…±äº«æœåŠ¡ ğŸ›¡ï¸ æƒé™æ§åˆ¶ï¼šç²¾ç»†çš„ç”¨æˆ·å’Œç›®å½•æƒé™ç®¡ç† ğŸ”„ å¤šç‰ˆæœ¬æ”¯æŒï¼šé€‚é…ä¸»æµ Linux å‘è¡Œç‰ˆ ğŸ¯ å¼€ç®±å³ç”¨ï¼šé¢„é…ç½®ä¼˜åŒ–å‚æ•°ï¼Œæ— éœ€å¤æ‚è°ƒè¯• ğŸ”§ æ˜“äºæ‰©å±•ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œå¯æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰ä¿®æ”¹ ğŸ“‹ ä½¿ç”¨å‰é¡»çŸ¥ âš ï¸ æ‰€æœ‰è„šæœ¬é»˜è®¤ä½¿ç”¨ç”¨æˆ·å: adminï¼Œå¯†ç : yifan0719ï¼ˆå»ºè®®é¦–æ¬¡ä½¿ç”¨åç«‹å³ä¿®æ”¹ï¼‰ ğŸ‘‘ è„šæœ¬éœ€è¦ä»¥ root æƒé™ è¿è¡Œï¼ˆä½¿ç”¨ sudo æˆ– root ç”¨æˆ·ï¼‰ ğŸ’¾ è¿è¡Œè„šæœ¬å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ® ğŸ”§ è„šæœ¬ä¼šä¿®æ”¹ç³»ç»Ÿ Samba é…ç½®ï¼Œè¯·ç¡®ä¿äº†è§£ç›¸å…³é£é™© ğŸŒ ç¡®ä¿ç³»ç»Ÿå·²è¿æ¥ç½‘ç»œï¼Œä»¥ä¾¿ä¸‹è½½å®‰è£…æ‰€éœ€è½¯ä»¶åŒ… ğŸ” ä¸åŒå‘è¡Œç‰ˆå¯èƒ½å­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œè¯·é€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„è„šæœ¬ ä¸€ã€ğŸ¯ Debian Samba é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #!/bin/bash # Debian Samba ä¸€é”®é…ç½®è„šæœ¬ echo \u0026#34;ğŸš€ å¼€å§‹å®‰è£…å’Œé…ç½® Samba æœåŠ¡...\u0026#34; apt update \u0026amp;\u0026amp; apt install samba -y mkdir -pm 755 /mnt \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [Debian] comment = mysamba path = /mnt browseable = yes writeable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root password required = yes available = yes fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr MYENDMARK # ä¿®æ”¹ your_password ä¸º samba å…±äº«å¯†ç  useradd admin 2\u0026gt;/dev/null (echo your_password; echo your_password) | smbpasswd -a -s admin systemctl restart smbd systemctl enable smbd echo \u0026#34;âœ… Debian Samba é…ç½®å®Œæˆï¼\u0026#34; æ‰§è¡Œæ–¹å¼ï¼š\n1 chmod +x debian_smb.sh \u0026amp;\u0026amp; ./debian_smb.sh äºŒã€ğŸ¦ Ubuntu Samba é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #!/bin/bash # Ubuntu Samba ä¸€é”®é…ç½®è„šæœ¬ echo \u0026#34;ğŸš€ å¼€å§‹å®‰è£…å’Œé…ç½® Samba æœåŠ¡...\u0026#34; sudo apt update \u0026amp;\u0026amp; sudo apt install samba -y sudo mkdir -pm 755 /mnt \u0026amp;\u0026amp; sudo cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [Ubuntu] comment = mysamba path = /mnt browseable = yes writeable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root password required = yes available = yes fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr MYENDMARK # ä¿®æ”¹ your_password ä¸º samba å…±äº«å¯†ç  useradd admin 2\u0026gt;/dev/null (echo your_password; echo your_password) | sudo smbpasswd -a -s admin sudo systemctl restart smbd sudo systemctl enable smbd echo \u0026#34;âœ… Ubuntu Samba é…ç½®å®Œæˆï¼\u0026#34; æ‰§è¡Œæ–¹å¼ï¼š\n1 chmod +x ubuntu_smb.sh \u0026amp;\u0026amp; sudo ./ubuntu_smb.sh ä¸‰ã€ğŸ”§ PVE (Proxmox VE) Samba é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #!/bin/bash # PVE Samba ä¸€é”®é…ç½®è„šæœ¬ - åŒå…±äº«ç›®å½•ç‰ˆ echo \u0026#34;ğŸš€ å¼€å§‹å®‰è£…å’Œé…ç½® Samba æœåŠ¡...\u0026#34; apt update \u0026amp;\u0026amp; apt install samba -y mkdir -pm 755 /mnt/ntfs \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [local] comment = PVE Local Storage path = /var/lib/vz/ browseable = yes writeable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root password required = yes available = yes fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no [PVE-ntfs] comment = NTFS External Storage path = /mnt/ntfs browseable = yes writeable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root password required = yes available = yes fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no MYENDMARK # ä¿®æ”¹ your_password ä¸º samba å…±äº«å¯†ç  useradd admin 2\u0026gt;/dev/null (echo your_password; echo your_password) | smbpasswd -a -s admin systemctl restart smbd systemctl enable smbd echo \u0026#34;âœ… PVE Samba é…ç½®å®Œæˆï¼\u0026#34; æ‰§è¡Œæ–¹å¼ï¼š\n1 chmod +x pve_smb.sh \u0026amp;\u0026amp; ./pve_smb.sh å››ã€ğŸ© CentOS Samba é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/bin/bash # CentOS Samba ä¸€é”®é…ç½®è„šæœ¬ echo \u0026#34;ğŸš€ å¼€å§‹å®‰è£…å’Œé…ç½® Samba æœåŠ¡...\u0026#34; yum update -y \u0026amp;\u0026amp; yum install samba samba-client -y mkdir -pm 755 /mnt \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; [CentOS] comment = CentOS Samba Share path = /mnt browseable = yes writeable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root password required = yes available = yes fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr MYENDMARK # ä¿®æ”¹ your_password ä¸º samba å…±äº«å¯†ç  useradd admin 2\u0026gt;/dev/null (echo your_password; echo your_password) | smbpasswd -a -s admin systemctl restart smb systemctl enable smb firewall-cmd --permanent --add-service=samba firewall-cmd --reload echo \u0026#34;âœ… CentOS Samba é…ç½®å®Œæˆï¼\u0026#34; æ‰§è¡Œæ–¹å¼ï¼š\n1 chmod +x centos_smb.sh \u0026amp;\u0026amp; ./centos_smb.sh äº”ã€ğŸ”ï¸ Alpine Linux Samba é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #!/bin/ash # Alpine Linux Samba ä¸€é”®é…ç½®è„šæœ¬ echo \u0026#34;ğŸš€ å¼€å§‹å®‰è£…å’Œé…ç½® Samba æœåŠ¡...\u0026#34; apk update \u0026amp;\u0026amp; apk add samba shadow mkdir -pm 755 /mnt \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [Alpine] comment = Alpine Samba Share path = /mnt browseable = yes writeable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root password required = yes available = yes fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr MYENDMARK # ä¿®æ”¹ your_password ä¸º samba å…±äº«å¯†ç  useradd admin 2\u0026gt;/dev/null (echo your_password; echo your_password) | smbpasswd -a -s admin rc-service samba start rc-update add samba echo \u0026#34;âœ… Alpine Linux Samba é…ç½®å®Œæˆï¼\u0026#34; æ‰§è¡Œæ–¹å¼ï¼š\n1 chmod +x alpine_smb.sh \u0026amp;\u0026amp; ./alpine_smb.sh ğŸ” éªŒè¯ä¸æ’æŸ¥ è„šæœ¬æ‰§è¡Œå®Œæˆåï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ Samba æœåŠ¡çŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ systemctl status smbd # Debian/Ubuntu/PVE systemctl status smb # CentOS rc-service samba status # Alpine # æŸ¥çœ‹å…±äº«åˆ—è¡¨ smbclient -L localhost -U admin # æµ‹è¯•è¿æ¥ smbclient //localhost/ShareName -U admin # æŸ¥çœ‹é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡® testparm # æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ï¼ˆå®æ—¶ç›‘æ§ï¼‰ tail -f /var/log/samba/log.smbd âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”’ é¦–æ¬¡è¿è¡Œåè¯·åŠæ—¶æ›´æ”¹é»˜è®¤å¯†ç ï¼šsmbpasswd -a admin ğŸŒ ç¡®ä¿é˜²ç«å¢™å…è®¸ Samba æµé‡ï¼ˆé€šå¸¸ç«¯å£ 139ã€445ï¼‰ ğŸ“‚ æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å…±äº«ç›®å½•è·¯å¾„å’Œæƒé™è®¾ç½® ğŸ‘¥ å¯æ·»åŠ å¤šä¸ªç”¨æˆ·å¹¶è®¾ç½®ä¸åŒæƒé™ï¼šuseradd + smbpasswd -a ğŸ’¾ é‡è¦æ•°æ®è¯·å®šæœŸå¤‡ä»½ï¼Œè„šæœ¬ä¼šä¿®æ”¹ç³»ç»Ÿé…ç½® ğŸ”„ å¦‚éœ€æ›´æ–°é…ç½®ï¼Œä¿®æ”¹ /etc/samba/smb.conf åé‡å¯æœåŠ¡ï¼šsystemctl restart smbd ğŸ–¥ï¸ Windows è¿æ¥å¯èƒ½éœ€è¦å¯ç”¨ SMB1 åè®®ï¼ˆä¸å»ºè®®ï¼‰æˆ–è°ƒæ•´å®¢æˆ·ç«¯è®¾ç½® ğŸ†˜ å¸¸è§é—®é¢˜ Q: è„šæœ¬æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ\nA: æ£€æŸ¥ç½‘ç»œè¿æ¥ã€æƒé™å’Œç³»ç»Ÿå…¼å®¹æ€§ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯ã€‚å¯å°è¯•æ‰‹åŠ¨æ‰§è¡Œæ¯æ¡å‘½ä»¤å®šä½é—®é¢˜ã€‚\nQ: å¦‚ä½•æ·»åŠ æ–°ç”¨æˆ·ï¼Ÿ\nA: ä½¿ç”¨ useradd æ–°ç”¨æˆ·å å’Œ smbpasswd -a æ–°ç”¨æˆ·å å‘½ä»¤ï¼Œç„¶ååœ¨ smb.conf ä¸­æ·»åŠ ç›¸åº”æƒé™ã€‚\nQ: å¦‚ä½•ä¿®æ”¹å…±äº«é…ç½®ï¼Ÿ\nA: ç¼–è¾‘ /etc/samba/smb.conf æ–‡ä»¶åé‡å¯ Samba æœåŠ¡ï¼šsystemctl restart smbd\nQ: Windows æ— æ³•è¿æ¥æ€ä¹ˆåŠï¼Ÿ\nA: æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼Œç¡®ä¿ SMB åè®®ç‰ˆæœ¬å…¼å®¹ã€‚Windows 10/11 å¯èƒ½éœ€è¦å¯ç”¨ SMB å®¢æˆ·ç«¯åŠŸèƒ½ã€‚\nQ: macOS è¿æ¥å‡ºç°é—®é¢˜ï¼Ÿ\nA: ç¡®ä¿ä½¿ç”¨äº†è„šæœ¬ä¸­çš„ fruit ç›¸å…³é…ç½®ï¼Œè¿™äº›é€‰é¡¹ä¸“é—¨ä¼˜åŒ–äº† macOS å…¼å®¹æ€§ã€‚\nQ: å¦‚ä½•å¸è½½ Samba æœåŠ¡ï¼Ÿ\nA: ä½¿ç”¨å‘è¡Œç‰ˆå¯¹åº”çš„åŒ…ç®¡ç†å‘½ä»¤å¸è½½ï¼ˆå¦‚ apt remove sambaï¼‰ï¼Œå¹¶å¤‡ä»½é‡è¦æ•°æ®ã€‚\nQ: æƒé™é…ç½®ä¸ç”Ÿæ•ˆï¼Ÿ\nA: æ£€æŸ¥ç›®å½•æƒé™å’Œ SELinux/AppArmor è®¾ç½®ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´å®‰å…¨ç­–ç•¥æˆ–ä½¿ç”¨ chcon å‘½ä»¤ã€‚\nå¸Œæœ›è¿™äº›è„šæœ¬èƒ½å¸®åŠ©æ‚¨å¿«é€Ÿæ­å»º Samba æ–‡ä»¶å…±äº«æœåŠ¡ï¼å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿äº¤æµè®¨è®ºã€‚ğŸŠ\nğŸ’¡ æç¤ºï¼šæœ¬æ–‡æ¡£ä¸­çš„è„šæœ¬ä¼šæŒç»­æ›´æ–°ï¼Œè¯·è®¿é—®é¡¹ç›®é¡µé¢è·å–æœ€æ–°ç‰ˆæœ¬ã€‚\n","date":"2024-12-07T16:41:01+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f94ec4a1/","title":"Linux é…ç½® Samba æœåŠ¡ä¸€é”®è„šæœ¬ï¼ˆæœ¬åœ°ï¼‰ğŸ§"},{"content":"Windows å¸¸ç”¨å‘½ä»¤å¤§å…¨ ğŸªŸ ğŸš€ æŒæ¡ Windows å‘½ä»¤è¡Œï¼Œæå‡ç³»ç»Ÿç®¡ç†å’Œè¿ç»´æ•ˆç‡çš„å¼ºå¤§å·¥å…·é›†\nâœ¨ ç‰¹ç‚¹ä¸ä¼˜åŠ¿ âš¡ é«˜æ•ˆç®¡ç†: å¿«é€Ÿå®Œæˆæ–‡ä»¶æ“ä½œã€ç³»ç»Ÿé…ç½®å’Œç½‘ç»œç®¡ç† ğŸ”§ å¼ºå¤§åŠŸèƒ½: æä¾›å›¾å½¢ç•Œé¢æ— æ³•å®ç°çš„æ·±åº¦ç³»ç»Ÿæ§åˆ¶ ğŸ“Š è‡ªåŠ¨åŒ–èƒ½åŠ›: é€šè¿‡æ‰¹å¤„ç†è„šæœ¬å®ç°é‡å¤ä»»åŠ¡è‡ªåŠ¨åŒ– ğŸŒ ç½‘ç»œè¯Šæ–­: å†…ç½®ä¸°å¯Œçš„ç½‘ç»œæµ‹è¯•å’Œæ•…éšœæ’æŸ¥å·¥å…· ğŸ’» è¿œç¨‹ç®¡ç†: æ”¯æŒè¿œç¨‹ç³»ç»Ÿç®¡ç†å’Œç»´æŠ¤ ğŸ“‹ ç›®å½• ğŸ”° åŸºç¡€å‘½ä»¤ ğŸ“ æ–‡ä»¶å’Œç›®å½•ç®¡ç† âš™ï¸ ç³»ç»Ÿç®¡ç† ğŸŒ ç½‘ç»œç›¸å…³å‘½ä»¤ ğŸ’¾ ç£ç›˜ç®¡ç† ğŸ‘¥ ç”¨æˆ·ç®¡ç† ğŸ”§ å…¶ä»–å®ç”¨å‘½ä»¤ ğŸ“œ æ‰¹å¤„ç†è„šæœ¬ ğŸ’¡ ä½¿ç”¨æŠ€å·§ ğŸš€ é«˜çº§åŠŸèƒ½ ğŸ”° åŸºç¡€å‘½ä»¤ ğŸ“‚ dir - ç›®å½•åˆ—è¡¨ ç”¨é€”: æ˜¾ç¤ºç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•\nåŠŸèƒ½: æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ã€è¿‡æ»¤æ–‡ä»¶ç±»å‹ã€æ’åºæ˜¾ç¤º\n1 2 3 4 5 6 dir C:\\Users dir /s *.txt # é€’å½’æœç´¢æ‰€æœ‰txtæ–‡ä»¶ dir /a:h # æ˜¾ç¤ºéšè—æ–‡ä»¶ dir /o:d # æŒ‰æ—¥æœŸæ’åº dir /q # æ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰è€… dir /w # å®½åˆ—è¡¨æ ¼å¼æ˜¾ç¤º ğŸ“ cd / chdir - åˆ‡æ¢ç›®å½• ç”¨é€”: æ›´æ”¹å½“å‰ç›®å½•æˆ–æ˜¾ç¤ºå½“å‰ç›®å½•\n1 2 3 4 5 6 cd C:\\Windows # åˆ‡æ¢åˆ°Windowsç›®å½• cd .. # è¿”å›ä¸Šçº§ç›®å½• cd \\ # è¿”å›æ ¹ç›®å½• cd /d D:\\Projects # åˆ‡æ¢é©±åŠ¨å™¨å¹¶ç›®å½• pushd C:\\Temp # ä¿å­˜å½“å‰ç›®å½•å¹¶åˆ‡æ¢ popd # è¿”å›ä¿å­˜çš„ç›®å½• ğŸ“‹ copy - æ–‡ä»¶å¤åˆ¶ ç”¨é€”: å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®\n1 2 3 4 5 copy file.txt D:\\Backup\\ copy *.txt D:\\TextFiles\\ copy file1.txt + file2.txt combined.txt # åˆå¹¶æ–‡ä»¶ copy /y source.txt destination.txt # è¦†ç›–ä¸æç¤º copy /v source.txt destination.txt # éªŒè¯å¤åˆ¶ç»“æœ ğŸšš move - æ–‡ä»¶ç§»åŠ¨/é‡å‘½å ç”¨é€”: ç§»åŠ¨æ–‡ä»¶æˆ–é‡å‘½åæ–‡ä»¶/ç›®å½•\n1 2 3 move file.txt D:\\NewLocation\\ move oldname.txt newname.txt # é‡å‘½åæ–‡ä»¶ move /y source.txt D:\\Destination\\ # å¼ºåˆ¶ç§»åŠ¨ ğŸ—‘ï¸ del / erase - åˆ é™¤æ–‡ä»¶ ç”¨é€”: åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶\n1 2 3 4 5 del file.txt del *.tmp # åˆ é™¤æ‰€æœ‰tmpæ–‡ä»¶ del /s /q *.log # é€’å½’é™é»˜åˆ é™¤æ—¥å¿—æ–‡ä»¶ del /f read-only.txt # å¼ºåˆ¶åˆ é™¤åªè¯»æ–‡ä»¶ del /a:h hidden.txt # åˆ é™¤éšè—æ–‡ä»¶ ğŸ“ md / mkdir - åˆ›å»ºç›®å½• ç”¨é€”: åˆ›å»ºæ–°ç›®å½•\n1 2 3 4 md NewFolder md \u0026#34;Folder with spaces\u0026#34; md D:\\Projects\\NewProject md Sub1\\Sub2\\Sub3 # åˆ›å»ºå¤šçº§ç›®å½• âŒ rd / rmdir - åˆ é™¤ç›®å½• ç”¨é€”: åˆ é™¤ç›®å½•\n1 2 3 rd OldFolder rd /s /q TempFolder # é€’å½’é™é»˜åˆ é™¤ç›®å½• rd .\\EmptyFolder # åˆ é™¤ç©ºç›®å½• ğŸ“ æ–‡ä»¶å’Œç›®å½•ç®¡ç† ğŸ·ï¸ attrib - æ–‡ä»¶å±æ€§ ç”¨é€”: æ˜¾ç¤ºæˆ–æ›´æ”¹æ–‡ä»¶å±æ€§\n1 2 3 4 5 attrib +r file.txt # è®¾ç½®åªè¯»å±æ€§ attrib +h secret.txt # è®¾ç½®éšè—å±æ€§ attrib -s system.txt # ç§»é™¤ç³»ç»Ÿå±æ€§ attrib /s *.docx # é€’å½’å¤„ç†æ‰€æœ‰docxæ–‡ä»¶ attrib +s +h SystemFolder # è®¾ç½®ç³»ç»Ÿå’Œéšè—å±æ€§ ğŸ”„ xcopy - é«˜çº§å¤åˆ¶ ç”¨é€”: å¤åˆ¶æ–‡ä»¶å’Œç›®å½•æ ‘\n1 2 3 4 xcopy C:\\Source D:\\Backup /s /e xcopy *.* D:\\Backup /d:01-01-2023 # å¤åˆ¶æŒ‡å®šæ—¥æœŸåçš„æ–‡ä»¶ xcopy /c /h /r /y Source Dest # æŒç»­å¤åˆ¶ï¼ŒåŒ…å«éšè—æ–‡ä»¶ xcopy /exclude:exclude.txt Source Dest # æ’é™¤æŒ‡å®šæ–‡ä»¶ ğŸš€ robocopy - å¼ºå¤§å¤åˆ¶å·¥å…· ç”¨é€”: å¯é çš„æ–‡ä»¶å¤åˆ¶å·¥å…·ï¼ˆæ¨èç”¨äºå¤§é‡æ–‡ä»¶å¤åˆ¶ï¼‰\n1 2 3 4 5 robocopy C:\\Source D:\\Backup /mir # é•œåƒå¤åˆ¶ robocopy /s /z /mt:16 Source Dest # å¤šçº¿ç¨‹å¤åˆ¶ robocopy /log:copy.log Source Dest # è®°å½•æ—¥å¿— robocopy /maxage:7 Source Dest # å¤åˆ¶7å¤©å†…çš„æ–‡ä»¶ robocopy /min:1024 Source Dest # å¤åˆ¶å¤§äº1KBçš„æ–‡ä»¶ ğŸŒ³ tree - ç›®å½•æ ‘ ç”¨é€”: å›¾å½¢æ–¹å¼æ˜¾ç¤ºç›®å½•ç»“æ„\n1 2 3 4 tree C:\\Projects tree /f # æ˜¾ç¤ºæ–‡ä»¶å tree /a # ä½¿ç”¨ASCIIå­—ç¬¦ tree /a /f \u0026gt; tree.txt # è¾“å‡ºåˆ°æ–‡ä»¶ âœï¸ ren / rename - é‡å‘½å ç”¨é€”: é‡å‘½åæ–‡ä»¶å’Œç›®å½•\n1 2 3 4 ren oldname.txt newname.txt ren \u0026#34;old name.txt\u0026#34; \u0026#34;new name.txt\u0026#34; ren *.txt *.bak # æ‰¹é‡é‡å‘½å ren *.html *.htm # æ›´æ”¹æ‰©å±•å ğŸ” where - æŸ¥æ‰¾æ–‡ä»¶ ç”¨é€”: åœ¨è·¯å¾„ä¸­æŸ¥æ‰¾æ–‡ä»¶\n1 2 3 where notepad.exe # æŸ¥æ‰¾notepadä½ç½® where /r C:\\Windows *.exe # é€’å½’æŸ¥æ‰¾ where /q python.exe \u0026amp;\u0026amp; echo Pythonå·²å®‰è£… # æ¡ä»¶æ‰§è¡Œ âš™ï¸ ç³»ç»Ÿç®¡ç† ğŸ“Š tasklist - è¿›ç¨‹åˆ—è¡¨ ç”¨é€”: æ˜¾ç¤ºå½“å‰è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹\n1 2 3 4 5 tasklist tasklist /svc # æ˜¾ç¤ºæœåŠ¡ä¿¡æ¯ tasklist /fi \u0026#34;IMAGENAME eq chrome.exe\u0026#34; # è¿‡æ»¤è¿›ç¨‹ tasklist /fo csv \u0026gt; processes.csv # å¯¼å‡ºä¸ºCSV tasklist /v # è¯¦ç»†ä¿¡æ¯ âš¡ taskkill - ç»ˆæ­¢è¿›ç¨‹ ç”¨é€”: ç»ˆæ­¢è¿è¡Œçš„è¿›ç¨‹\n1 2 3 4 taskkill /im notepad.exe # æŒ‰æ˜ åƒåç»ˆæ­¢ taskkill /pid 1234 /f # å¼ºåˆ¶ç»ˆæ­¢æŒ‡å®šPID taskkill /fi \u0026#34;STATUS eq NOT RESPONDING\u0026#34; # ç»ˆæ­¢æ— å“åº”è¿›ç¨‹ taskkill /t /im chrome.exe # ç»ˆæ­¢è¿›ç¨‹æ ‘ ğŸ› ï¸ chkdsk - ç£ç›˜æ£€æŸ¥ ç”¨é€”: æ£€æŸ¥ç£ç›˜å¹¶ä¿®å¤æ–‡ä»¶ç³»ç»Ÿé”™è¯¯\n1 2 3 4 chkdsk C: /f # æ£€æŸ¥å¹¶ä¿®å¤Cç›˜ chkdsk /r # å®šä½åæ‰‡åŒºå¹¶æ¢å¤å¯è¯»ä¿¡æ¯ chkdsk /scan # åœ¨çº¿æ‰«æ chkdsk /spotfix # ç°åœºä¿®å¤ ğŸ” sfc - ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥ ç”¨é€”: æ‰«æå¹¶ä¿®å¤ç³»ç»Ÿæ–‡ä»¶\n1 2 3 4 sfc /scannow # ç«‹å³æ‰«æå¹¶ä¿®å¤ sfc /verifyonly # åªæ‰«æä¸ä¿®å¤ sfc /scanfile=file.txt # æ‰«ææŒ‡å®šæ–‡ä»¶ sfc /scanonce # ä¸‹æ¬¡å¯åŠ¨æ—¶æ‰«æ â» shutdown - å…³æœºç®¡ç† ç”¨é€”: å…³æœºã€é‡å¯æˆ–æ³¨é”€è®¡ç®—æœº\n1 2 3 4 5 6 shutdown /s /t 0 # ç«‹å³å…³æœº shutdown /r /t 60 # 60ç§’åé‡å¯ shutdown /l # æ³¨é”€ shutdown /a # å–æ¶ˆå…³æœº shutdown /h /f # ä¼‘çœ å¹¶å¼ºåˆ¶å…³é—­åº”ç”¨ shutdown /m \\\\remote-pc /r # é‡å¯è¿œç¨‹è®¡ç®—æœº â„¹ï¸ systeminfo - ç³»ç»Ÿä¿¡æ¯ ç”¨é€”: æ˜¾ç¤ºè®¡ç®—æœºçš„è¯¦ç»†é…ç½®ä¿¡æ¯\n1 2 3 4 systeminfo systeminfo /fo csv # CSVæ ¼å¼è¾“å‡º systeminfo /s remote-pc # è¿œç¨‹è®¡ç®—æœºä¿¡æ¯ systeminfo /u domain\\user /p password # æŒ‡å®šå‡­æ® ğŸ“Š wmic - Windowsç®¡ç†å·¥å…· ç”¨é€”: å¼ºå¤§çš„ç³»ç»Ÿç®¡ç†å‘½ä»¤è¡Œå·¥å…·\n1 2 3 4 wmic computersystem get model # è·å–è®¡ç®—æœºå‹å· wmic diskdrive get size # è·å–ç£ç›˜å¤§å° wmic process get name,processid # è·å–è¿›ç¨‹ä¿¡æ¯ wmic product get name,version # è·å–å®‰è£…çš„ç¨‹åº ğŸŒ ç½‘ç»œç›¸å…³å‘½ä»¤ ğŸŒ ipconfig - IPé…ç½® ç”¨é€”: æ˜¾ç¤ºTCP/IPç½‘ç»œé…ç½®å€¼\n1 2 3 4 5 6 7 ipconfig # åŸºæœ¬ä¿¡æ¯ ipconfig /all # è¯¦ç»†ä¿¡æ¯ ipconfig /release # é‡Šæ”¾IPåœ°å€ ipconfig /renew # ç»­è®¢IPåœ°å€ ipconfig /flushdns # æ¸…é™¤DNSç¼“å­˜ ipconfig /displaydns # æ˜¾ç¤ºDNSç¼“å­˜ ipconfig /showclassid # æ˜¾ç¤ºDHCPç±»ID ğŸ“¡ ping - ç½‘ç»œæµ‹è¯• ç”¨é€”: æµ‹è¯•ç½‘ç»œè¿æ¥\n1 2 3 4 5 ping google.com ping 192.168.1.1 -t # æŒç»­ping ping -n 10 example.com # æŒ‡å®šæ¬¡æ•° ping -l 1024 target.com # æŒ‡å®šæ•°æ®åŒ…å¤§å° ping -f target.com # è®¾ç½®ä¸åˆ†æ®µæ ‡å¿— ğŸ—ºï¸ tracert - è·¯ç”±è·Ÿè¸ª ç”¨é€”: è·Ÿè¸ªæ•°æ®åŒ…è·¯å¾„\n1 2 3 4 tracert google.com tracert -d target.com # ä¸è§£æåœ°å€ä¸ºä¸»æœºå tracert -h 30 target.com # æŒ‡å®šæœ€å¤§è·³æ•° tracert -w 1000 target.com # è®¾ç½®è¶…æ—¶æ—¶é—´(æ¯«ç§’) ğŸ“Š netstat - ç½‘ç»œç»Ÿè®¡ ç”¨é€”: æ˜¾ç¤ºç½‘ç»œè¿æ¥å’Œç»Ÿè®¡ä¿¡æ¯\n1 2 3 4 5 6 netstat -an # æ‰€æœ‰è¿æ¥å’Œç«¯å£ netstat -b # æ˜¾ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ netstat -s # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ netstat -o # æ˜¾ç¤ºè¿›ç¨‹ID netstat -r # æ˜¾ç¤ºè·¯ç”±è¡¨ netstat -e # æ˜¾ç¤ºä»¥å¤ªç½‘ç»Ÿè®¡ä¿¡æ¯ ğŸ” nslookup - DNSæŸ¥è¯¢ ç”¨é€”: æŸ¥è¯¢DNSä¿¡æ¯\n1 2 3 4 5 nslookup google.com nslookup -type=mx example.com # æŸ¥è¯¢MXè®°å½• nslookup -debug example.com # è°ƒè¯•æ¨¡å¼ nslookup -type=soa example.com # æŸ¥è¯¢SOAè®°å½• nslookup -timeout=10 example.com # è®¾ç½®è¶…æ—¶ ğŸ‘¥ net - ç½‘ç»œå‘½ä»¤é›† ç”¨é€”: å¤šç§ç½‘ç»œç®¡ç†åŠŸèƒ½\n1 2 3 4 5 6 7 net user # æ˜¾ç¤ºç”¨æˆ·è´¦æˆ· net share # æ˜¾ç¤ºå…±äº«èµ„æº net start # æ˜¾ç¤ºè¿è¡ŒæœåŠ¡ net stop service-name # åœæ­¢æœåŠ¡ net use # æ˜¾ç¤ºç½‘ç»œè¿æ¥ net view # æ˜¾ç¤ºç½‘ç»œèµ„æº net config # æ˜¾ç¤ºé…ç½®ä¿¡æ¯ ğŸŒ netsh - ç½‘ç»œé…ç½® ç”¨é€”: ç½‘ç»œé…ç½®å‘½ä»¤è¡Œå·¥å…·\n1 2 3 4 netsh interface show config # æ˜¾ç¤ºæ¥å£é…ç½® netsh firewall show config # æ˜¾ç¤ºé˜²ç«å¢™é…ç½® netsh wlan show profiles # æ˜¾ç¤ºWiFié…ç½® netsh advfirewall dump # å¯¼å‡ºé˜²ç«å¢™é…ç½® ğŸ’¾ ç£ç›˜ç®¡ç† ğŸ›ï¸ diskpart - ç£ç›˜åˆ†åŒº ç”¨é€”: ç£ç›˜åˆ†åŒºç®¡ç†å·¥å…·\n1 2 3 4 5 6 7 diskpart # è¿›å…¥äº¤äº’æ¨¡å¼ list disk # åˆ—å‡ºç£ç›˜ select disk 0 # é€‰æ‹©ç£ç›˜ list partition # åˆ—å‡ºåˆ†åŒº create partition primary # åˆ›å»ºä¸»åˆ†åŒº format fs=ntfs quick # å¿«é€Ÿæ ¼å¼åŒ–ä¸ºNTFS clean # æ¸…é™¤ç£ç›˜ ğŸ’½ format - ç£ç›˜æ ¼å¼åŒ– ç”¨é€”: æ ¼å¼åŒ–ç£ç›˜\n1 2 3 4 format D: /fs:ntfs # æ ¼å¼åŒ–ä¸ºNTFS format /q # å¿«é€Ÿæ ¼å¼åŒ– format /v:MyDrive # è®¾ç½®å·æ ‡ format /a:64k # è®¾ç½®åˆ†é…å•å…ƒå¤§å° ğŸ“€ diskcopy - ç£ç›˜å¤åˆ¶ ç”¨é€”: å¤åˆ¶æ•´ä¸ªç£ç›˜å†…å®¹\n1 diskcopy A: B: # å¤åˆ¶Aç›˜åˆ°Bç›˜ ğŸ·ï¸ vol - å·æ ‡æ˜¾ç¤º ç”¨é€”: æ˜¾ç¤ºç£ç›˜å·æ ‡å’Œåºåˆ—å·\n1 vol C: âœï¸ label - å·æ ‡ç®¡ç† ç”¨é€”: åˆ›å»ºã€æ›´æ”¹æˆ–åˆ é™¤ç£ç›˜å·æ ‡\n1 2 label C: SystemDrive label D: DataDrive ğŸ“ˆ defrag - ç£ç›˜ç¢ç‰‡æ•´ç† ç”¨é€”: æ•´ç†ç£ç›˜ç¢ç‰‡\n1 2 3 defrag C: /a # åˆ†æç¢ç‰‡ defrag C: /o # ä¼˜åŒ– defrag C: /v # æ˜¾ç¤ºè¯¦ç»†æŠ¥å‘Š ğŸ‘¥ ç”¨æˆ·ç®¡ç† ğŸ‘¤ net user - ç”¨æˆ·è´¦æˆ·ç®¡ç† ç”¨é€”: æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹ç”¨æˆ·è´¦æˆ·\n1 2 3 4 5 net user # æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ· net user john Password123 /add # æ·»åŠ ç”¨æˆ· net user john /delete # åˆ é™¤ç”¨æˆ· net user john /active:no # ç¦ç”¨ç”¨æˆ· net user john /logonpasswordchg:yes # å…è®¸æ›´æ”¹å¯†ç  ğŸ‘¥ net localgroup - æœ¬åœ°ç»„ç®¡ç† ç”¨é€”: æ·»åŠ ã€æ˜¾ç¤ºæˆ–ä¿®æ”¹æœ¬åœ°ç»„\n1 2 3 4 net localgroup # æ˜¾ç¤ºæ‰€æœ‰æœ¬åœ°ç»„ net localgroup administrators john /add # æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜ç»„ net localgroup users john /delete # ä»ç”¨æˆ·ç»„åˆ é™¤ net localgroup \u0026#34;Power Users\u0026#34; /add # æ·»åŠ åˆ°ç‰¹æƒç”¨æˆ·ç»„ ğŸ”„ runas - ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œ ç”¨é€”: ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œç¨‹åº\n1 2 3 runas /user:administrator cmd.exe runas /savecred /user:admin notepad.exe # ä¿å­˜å‡­æ® runas /profile /user:domain\\user program.exe # åŠ è½½ç”¨æˆ·é…ç½®æ–‡ä»¶ ğŸ” cacls / icacls - æƒé™ç®¡ç† ç”¨é€”: æ˜¾ç¤ºæˆ–ä¿®æ”¹æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨\n1 2 3 4 icacls file.txt /grant User:(F) # æˆäºˆå®Œå…¨æ§åˆ¶ icacls folder /inheritance:r # ç¦ç”¨ç»§æ‰¿ icacls file.txt /remove User # ç§»é™¤ç”¨æˆ·æƒé™ cacls file.txt /e /g User:R # ç¼–è¾‘æƒé™ï¼Œæˆäºˆè¯»å–æƒé™ ğŸ”§ å…¶ä»–å®ç”¨å‘½ä»¤ ğŸ“¢ echo - æ¶ˆæ¯æ˜¾ç¤º ç”¨é€”: æ˜¾ç¤ºæ¶ˆæ¯æˆ–æ§åˆ¶å‘½ä»¤å›æ˜¾\n1 2 3 4 5 6 echo Hello World! echo %PATH% # æ˜¾ç¤ºç¯å¢ƒå˜é‡ echo off # å…³é—­å‘½ä»¤å›æ˜¾ echo on # å¼€å¯å‘½ä»¤å›æ˜¾ echo. # è¾“å‡ºç©ºè¡Œ echo %DATE% %TIME% # æ˜¾ç¤ºæ—¥æœŸæ—¶é—´ ğŸ“„ type - æ–‡ä»¶å†…å®¹æ˜¾ç¤º ç”¨é€”: æ˜¾ç¤ºæ–‡ä»¶å†…å®¹\n1 2 3 4 type file.txt type *.log # æ˜¾ç¤ºå¤šä¸ªæ–‡ä»¶å†…å®¹ type nul \u0026gt; newfile.txt # åˆ›å»ºç©ºæ–‡ä»¶ type con \u0026gt; file.txt # ä»æ§åˆ¶å°è¾“å…¥åˆ›å»ºæ–‡ä»¶ ğŸ” find - æ–‡æœ¬æœç´¢ ç”¨é€”: åœ¨æ–‡ä»¶ä¸­æœç´¢æ–‡æœ¬\n1 2 3 4 5 find \u0026#34;error\u0026#34; log.txt find /i \u0026#34;warning\u0026#34; *.log # ä¸åŒºåˆ†å¤§å°å†™ find /c \u0026#34;success\u0026#34; file.txt # ç»Ÿè®¡å‡ºç°æ¬¡æ•° find /v \u0026#34;test\u0026#34; file.txt # æ˜¾ç¤ºä¸åŒ…å«æ–‡æœ¬çš„è¡Œ findstr /n \u0026#34;pattern\u0026#34; file.txt # æ˜¾ç¤ºè¡Œå· ğŸ”„ sort - æ–‡æœ¬æ’åº ç”¨é€”: æ’åºè¾“å…¥æ–‡æœ¬\n1 2 3 4 sort file.txt sort /r file.txt # åå‘æ’åº sort /+n file.txt # ä»ç¬¬nåˆ—å¼€å§‹æ’åº sort /unique file.txt # å»é™¤é‡å¤è¡Œ âš–ï¸ fc - æ–‡ä»¶æ¯”è¾ƒ ç”¨é€”: æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶å·®å¼‚\n1 2 3 4 fc file1.txt file2.txt fc /b file1.bin file2.bin # äºŒè¿›åˆ¶æ¯”è¾ƒ fc /n file1.txt file2.txt # æ˜¾ç¤ºè¡Œå· fc /l file1.txt file2.txt # ASCIIæ¨¡å¼æ¯”è¾ƒ ğŸ§¹ cls - æ¸…å± ç”¨é€”: æ¸…é™¤å‘½ä»¤è¡Œçª—å£\n1 cls ğŸ’¬ prompt - æç¤ºç¬¦å®šåˆ¶ ç”¨é€”: è‡ªå®šä¹‰å‘½ä»¤æç¤ºç¬¦\n1 2 3 4 prompt $p$g # æ˜¾ç¤ºè·¯å¾„å’Œ\u0026gt; prompt $t$g # æ˜¾ç¤ºæ—¶é—´å’Œ\u0026gt; prompt $u@$h$g # æ˜¾ç¤ºç”¨æˆ·@ä¸»æœº\u0026gt; prompt $+$g # æ˜¾ç¤ºæ¨é€ç›®å½•æ·±åº¦ ğŸ“ set - ç¯å¢ƒå˜é‡ ç”¨é€”: æ˜¾ç¤ºã€è®¾ç½®æˆ–åˆ é™¤ç¯å¢ƒå˜é‡\n1 2 3 4 5 set # æ˜¾ç¤ºæ‰€æœ‰å˜é‡ set PATH=%PATH%;C:\\NewPath # æ·»åŠ è·¯å¾„ set MYVAR=value # è®¾ç½®å˜é‡ set /a result=10+5 # æ•°å­¦è®¡ç®— set /p input=è¯·è¾“å…¥: # ç”¨æˆ·è¾“å…¥ ğŸ“œ æ‰¹å¤„ç†è„šæœ¬ ğŸ¯ æ‰¹å¤„ç†åŸºç¡€ 1 2 3 4 @echo off rem è¿™æ˜¯ä¸€ä¸ªæ‰¹å¤„ç†è„šæœ¬ç¤ºä¾‹ echo è„šæœ¬å¼€å§‹æ‰§è¡Œ pause âš™ï¸ å¸¸ç”¨æ‰¹å¤„ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @echo off # å…³é—­å›æ˜¾ title æˆ‘çš„è„šæœ¬ # è®¾ç½®çª—å£æ ‡é¢˜ color 0a # è®¾ç½®é¢œè‰²(èƒŒæ™¯0,æ–‡å­—a) set /p name=è¯·è¾“å…¥å§“å: # ç”¨æˆ·è¾“å…¥ echo ä½ å¥½, %name%! if exist file.txt ( echo æ–‡ä»¶å­˜åœ¨ ) else ( echo æ–‡ä»¶ä¸å­˜åœ¨ ) for %%i in (*.txt) do echo %%i # å¾ªç¯å¤„ç† goto :label # è·³è½¬åˆ°æ ‡ç­¾ :label exit /b 0 # é€€å‡ºè„šæœ¬ ğŸš€ å®ç”¨æ‰¹å¤„ç†ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @echo off chcp 65001 \u0026gt;nul # è®¾ç½®UTF-8ç¼–ç  echo ğŸš€ ç³»ç»Ÿä¼˜åŒ–è„šæœ¬ echo. rem æ¸…ç†ä¸´æ—¶æ–‡ä»¶ echo ğŸ“ æ¸…ç†ä¸´æ—¶æ–‡ä»¶... del /q /f %temp%\\*.* 2\u0026gt;nul rd /s /q %temp% 2\u0026gt;nul rem æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ echo ğŸ“Š ç³»ç»Ÿä¿¡æ¯: systeminfo | findstr /C:\u0026#34;OS åç§°\u0026#34; /C:\u0026#34;ç‰©ç†å†…å­˜\u0026#34; rem å¤‡ä»½é‡è¦æ–‡ä»¶ echo ğŸ“¦ å¤‡ä»½æ–‡ä»¶... xcopy \u0026#34;C:\\Important\u0026#34; \u0026#34;D:\\Backup\\Important\u0026#34; /s /e /y echo. echo âœ… è„šæœ¬æ‰§è¡Œå®Œæˆ! timeout /t 5 exit ğŸ”„ é«˜çº§æ‰¹å¤„ç†æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @echo off setlocal enabledelayedexpansion rem é”™è¯¯å¤„ç† if errorlevel 1 ( echo é”™è¯¯å‘ç”Ÿ! exit /b 1 ) rem æ•°ç»„å¤„ç† set array[0]=ç¬¬ä¸€ä¸ªå…ƒç´  set array[1]=ç¬¬äºŒä¸ªå…ƒç´  for /l %%i in (0,1,1) do ( echo !array[%%i]! ) rem å‡½æ•°å®šä¹‰ call :my_function \u0026#34;å‚æ•°\u0026#34; goto :eof :my_function echo å‡½æ•°æ”¶åˆ°å‚æ•°: %~1 exit /b 0 ğŸ’¡ ä½¿ç”¨æŠ€å·§ ğŸ¨ ç¾åŒ–å‘½ä»¤è¡Œ 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨é¢œè‰² color 0a # é»‘åº•ç»¿å­— color 1f # è“åº•ç™½å­— # è®¾ç½®çª—å£å¤§å° mode con: cols=100 lines=40 # è‡ªå®šä¹‰æç¤ºç¬¦ prompt [$t]$p$g # ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ echo â–‘â–’â–“â–ˆ è¿›åº¦æ¡ â–ˆâ–“â–’â–‘ ğŸ”§ å¿«æ·é”®æŠ€å·§ F7 - æŸ¥çœ‹å‘½ä»¤å†å² F8 - æœç´¢å†å²å‘½ä»¤ Tab - è‡ªåŠ¨è¡¥å…¨è·¯å¾„ â†‘/â†“ - æµè§ˆå‘½ä»¤å†å² Ctrl + C - ç»ˆæ­¢å½“å‰å‘½ä»¤ Ctrl + A - ç§»åŠ¨åˆ°è¡Œé¦– Ctrl + E - ç§»åŠ¨åˆ°è¡Œå°¾ Ctrl + â†/â†’ - æŒ‰å•è¯ç§»åŠ¨ ğŸ“š å­¦ä¹ èµ„æº å¸®åŠ©ç³»ç»Ÿ: åœ¨ä»»ä½•å‘½ä»¤ååŠ  /? æŸ¥çœ‹å¸®åŠ© 1 2 dir /? xcopy /? å‘½ä»¤å‚è€ƒ: ä½¿ç”¨ help å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ 1 2 help help | more # åˆ†é¡µæ˜¾ç¤º åœ¨çº¿æ–‡æ¡£: è®¿é—® Microsoft å®˜æ–¹æ–‡æ¡£è·å–è¯¦ç»†ä¿¡æ¯ ğŸš€ é«˜çº§åŠŸèƒ½ ğŸ”„ PowerShell é›†æˆ ç”¨é€”: åœ¨CMDä¸­ä½¿ç”¨PowerShellå‘½ä»¤\n1 2 powershell \u0026#34;Get-Process | Sort-Object CPU -Descending | Select-Object -First 5\u0026#34; powershell \u0026#34;Get-Service | Where-Object {$_.Status -eq \u0026#39;Running\u0026#39;}\u0026#34; ğŸ“Š æ€§èƒ½ç›‘æ§ ç”¨é€”: ç³»ç»Ÿæ€§èƒ½ç›‘æ§å‘½ä»¤\n1 2 3 typeperf \u0026#34;\\Processor(_Total)\\% Processor Time\u0026#34; -sc 10 # ç›‘æ§CPUä½¿ç”¨ç‡ perfmon # æ‰“å¼€æ€§èƒ½ç›‘è§†å™¨ logman create counter MyLog -c \u0026#34;\\Memory\\Available MBytes\u0026#34; # åˆ›å»ºæ€§èƒ½è®¡æ•°å™¨ ğŸ”§ æ³¨å†Œè¡¨æ“ä½œ ç”¨é€”: å‘½ä»¤è¡Œæ³¨å†Œè¡¨ç¼–è¾‘\n1 2 3 reg query \u0026#34;HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\u0026#34; # æŸ¥è¯¢æ³¨å†Œè¡¨ reg add \u0026#34;HKCU\\Software\\MyApp\u0026#34; /v Setting /t REG_SZ /d Value # æ·»åŠ æ³¨å†Œè¡¨é¡¹ reg export \u0026#34;HKCU\\Software\\MyApp\u0026#34; backup.reg # å¯¼å‡ºæ³¨å†Œè¡¨ ğŸŒ è¿œç¨‹ç®¡ç† ç”¨é€”: è¿œç¨‹ç³»ç»Ÿç®¡ç†å‘½ä»¤\n1 2 3 psexec \\\\remote-pc cmd.exe # è¿œç¨‹æ‰§è¡Œå‘½ä»¤ sc \\\\remote-pc queryex state= all # æŸ¥è¯¢è¿œç¨‹æœåŠ¡ wmic /node:\u0026#34;remote-pc\u0026#34; process get name # è¿œç¨‹è¿›ç¨‹ç®¡ç† ğŸ’¡ ä¸“ä¸šæç¤º:\nä½¿ç”¨ \u0026gt; nul 2\u0026gt;\u0026amp;1 é‡å®šå‘è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ åœ¨æ‰¹å¤„ç†è„šæœ¬ä¸­ä½¿ç”¨ setlocal enabledelayedexpansion å¤„ç†å˜é‡ ä½¿ç”¨ %ERRORLEVEL% æ£€æŸ¥ä¸Šä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œç»“æœ å¯¹äºå¤æ‚ä»»åŠ¡ï¼Œè€ƒè™‘ä½¿ç”¨ PowerShell è„šæœ¬æ›¿ä»£æ‰¹å¤„ç† ğŸ›¡ï¸ å®‰å…¨è­¦å‘Š:\nè°¨æ…ä½¿ç”¨ç³»ç»Ÿçº§å‘½ä»¤ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ åœ¨æ‰§è¡Œç ´åæ€§æ“ä½œå‰å§‹ç»ˆè¿›è¡Œå¤‡ä»½ ä½¿ç”¨æœ€å°æƒé™åŸåˆ™è¿è¡Œå‘½ä»¤ ","date":"2024-12-07T16:40:05+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/8a86eb6f/","title":"Windows å¸¸ç”¨å‘½ä»¤å¤§å…¨ ğŸªŸ"},{"content":"Windows å’Œ Linux ç³»ç»Ÿä¿®æ”¹ Hosts å®Œå…¨æŒ‡å— ğŸŒ ğŸ“Œ å¯¼èˆªç›®å½•\nğŸš€ ä¸€ã€Windows å…¨è‡ªåŠ¨è·å– hostIP ğŸ§ äºŒã€Linux ä¿®æ”¹ hosts ğŸ” ä¸‰ã€hosts æŸ¥è¯¢ç½‘å€æ¨è âš™ï¸ å››ã€Linux æ“ä½œè¯¦è§£ ğŸ’¡ äº”ã€æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ ğŸš€ ä¸€ã€Windows å…¨è‡ªåŠ¨è·å– hostIP ä½œè€…å“”å“©å“”å“©ï¼š ç‚¹å‡»è§‚çœ‹è§†é¢‘æ•™ç¨‹ hostIP å·¥å…·ä¸‹è½½ï¼š hostIPv3.0.zip âœ¨ å·¥å…·ç‰¹ç‚¹ï¼š\nğŸ”„ å…¨è‡ªåŠ¨æ›´æ–°ï¼šä¸€é”®è·å–æœ€æ–° hostIPï¼Œæ— éœ€æ‰‹åŠ¨æŸ¥è¯¢å’Œæ›¿æ¢ï¼› ğŸ›¡ï¸ å®‰å…¨å¯é ï¼šå†…ç½®æ ¡éªŒæœºåˆ¶ï¼Œé¿å…å›  hosts é”™è¯¯å¯¼è‡´ç½‘ç»œé—®é¢˜ï¼› ğŸ“… å®šæœŸç»´æŠ¤ï¼šä½œè€…æŒç»­æ›´æ–°ï¼Œé€‚é…å¸¸è§ç½‘ç«™ï¼ˆå¦‚ TMDBã€GitHub ç­‰ï¼‰ã€‚ ğŸ§ äºŒã€Linux ä¿®æ”¹ hosts ğŸ” ä¸‰ã€hosts æŸ¥è¯¢ç½‘å€æ¨è IPAddressï¼šhttps://www.ipaddress.com/\nğŸ“Œ æä¾›å‡†ç¡®çš„åŸŸåè§£æ IPï¼Œæ”¯æŒæ‰¹é‡æŸ¥è¯¢ã€‚ DNSCheckerï¼šhttps://dnschecker.org/country/cn/\nğŸŒ å¯æŒ‰å›½å®¶/åœ°åŒºç­›é€‰ IPï¼Œé€‚åˆä¼˜åŒ–è®¿é—®é€Ÿåº¦ã€‚ âš™ï¸ å››ã€Linux æ“ä½œè¯¦è§£ 1. æŸ¥çœ‹å½“å‰ hosts é…ç½® 1 cat /etc/hosts 2. ç¼–è¾‘ hosts æ–‡ä»¶ï¼ˆä½¿ç”¨ nano ç¼–è¾‘å™¨ï¼‰ 1 sudo nano /etc/hosts 3. è¦†ç›–å†™å…¥ hostsï¼ˆé€‚ç”¨äºæ‰¹é‡æ›´æ–°ï¼‰ 1 2 3 4 5 6 sudo tee /etc/hosts \u0026lt;\u0026lt;EOF 108.156.46.129 api.themoviedb.org 18.172.153.86 api.tmdb.org 79.127.213.216 image.tmdb.org 3.160.150.29 www.themoviedb.org EOF 4. è¿½åŠ å†…å®¹åˆ° hostsï¼ˆä¿ç•™åŸæœ‰é…ç½®ï¼‰ 1 2 3 4 sudo tee -a /etc/hosts \u0026lt;\u0026lt;EOF 108.156.46.56 api.themoviedb.org 108.156.46.80 api.themoviedb.org EOF 5. é‡å¯ç½‘ç»œæœåŠ¡ï¼ˆç”Ÿæ•ˆé…ç½®ï¼‰ 1 sudo systemctl restart networking ğŸ’¡ äº”ã€æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ âš ï¸ æ“ä½œå‰å¤‡ä»½ï¼ 1 sudo cp /etc/hosts /etc/hosts.bak â“ å¸¸è§é—®é¢˜ æƒé™ä¸è¶³ï¼šæ‰€æœ‰ä¿®æ”¹æ“ä½œéœ€åŠ  sudoï¼› ç”Ÿæ•ˆå»¶è¿Ÿï¼šéƒ¨åˆ†ç³»ç»Ÿéœ€åˆ·æ–° DNS ç¼“å­˜ï¼ˆå¦‚ sudo systemd-resolve --flush-cachesï¼‰ï¼› æ ¼å¼é”™è¯¯ï¼šæ¯è¡Œåªèƒ½åŒ…å«ä¸€ä¸ª IP å’Œä¸€ä¸ªåŸŸåï¼Œç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦åˆ†éš”ã€‚ ğŸ”§ é«˜çº§æŠ€å·§ ä½¿ç”¨ dig æˆ– nslookup æ‰‹åŠ¨éªŒè¯ IP æ˜¯å¦æœ‰æ•ˆï¼› å®šæœŸæ¸…ç†æ— æ•ˆæ¡ç›®ï¼Œé¿å… hosts æ–‡ä»¶è¿‡å¤§å½±å“è§£ææ•ˆç‡ã€‚ ğŸ“Œ æ€»ç»“ï¼šæ— è®ºæ˜¯ Windows è¿˜æ˜¯ Linuxï¼Œä¿®æ”¹ hosts éƒ½æ˜¯ä¼˜åŒ–ç½‘ç»œè®¿é—®çš„å¸¸ç”¨æ‰‹æ®µã€‚Windows ç”¨æˆ·æ¨èä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼ŒLinux ç”¨æˆ·å¯é€šè¿‡å‘½ä»¤è¡Œçµæ´»ç®¡ç†ã€‚è®°å¾—å®šæœŸæ›´æ–° IP åœ°å€å“¦ï¼ğŸ¯\n","date":"2024-12-07T16:38:57+08:00","image":"https://file.meimolihan.eu.org/img/linux-windows-01.webp","permalink":"https://blog.meimolihan.eu.org/p/092fee7e/","title":"Windows å’Œ Linux ç³»ç»Ÿä¿®æ”¹ Hosts å®Œå…¨æŒ‡å— ğŸŒ"},{"content":"iStoreOS å®‰è£… OpenClash å®Œæ•´æŒ‡å— ğŸ”§ ğŸŒ OpenClash æ˜¯ OpenWrt ç³»ç»Ÿä¸ŠåŠŸèƒ½å¼ºå¤§çš„ä»£ç†å®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šç§ä»£ç†åè®®ï¼Œæä¾›ä¸°å¯Œçš„æµé‡æ§åˆ¶åŠŸèƒ½ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ“¦ ä¸€ã€å®‰è£…ç³»ç»Ÿä¾èµ– ğŸš€ äºŒã€å®‰è£… OpenClash ğŸ”§ 1ã€æ‰‹åŠ¨å®‰è£… OpenClash âš¡ 2ã€ä¸€é”®å®‰è£… OpenClash ğŸ³ ä¸‰ã€Docker æ·»åŠ ä»£ç† âš™ï¸ 1. OpenClash é…ç½® ğŸ‹ 2. docker-compose.yml é…ç½® âš ï¸ å››ã€æ³¨æ„äº‹é¡¹ ğŸ“¦ ä¸€ã€å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆæ ¹æ®é˜²ç«å¢™ç±»å‹ï¼‰ 1. ğŸ›¡ï¸ iptables é˜²ç«å¢™ä¾èµ–å®‰è£…ï¼ˆiStoreOSï¼‰ 1 2 opkg update \u0026amp;\u0026amp; opkg install bash iptables dnsmasq-full curl ca-bundle ipset ip-full iptables-mod-tproxy iptables-mod-extra ruby ruby-yaml kmod-tun kmod-inet-diag unzip luci-compat luci luci-base opkg install /tmp/openclash.ipk 2. ğŸ” ä¾èµ–åŒ…åŠŸèƒ½è¯´æ˜ ä¾èµ–åŒ… åŠŸèƒ½è¯´æ˜ dnsmasq-full å®Œæ•´çš„ DNS æœåŠ¡å™¨åŠŸèƒ½ ğŸŒ iptables / nftables é˜²ç«å¢™æ ¸å¿ƒç»„ä»¶ ğŸ”¥ curl ç½‘ç»œæ•°æ®ä¼ è¾“å·¥å…· ğŸ“¡ ruby-yaml YAML é…ç½®æ–‡ä»¶è§£æ ğŸ“„ kmod-tun éš§é“è®¾å¤‡å†…æ ¸æ¨¡å— ğŸš‡ luci-compat Luci ç•Œé¢å…¼å®¹å±‚ ğŸ–¥ï¸ ğŸš€ äºŒã€å®‰è£… OpenClash ğŸ”§ 1ã€æ‰‹åŠ¨å®‰è£… OpenClash 1 2 3 4 5 # ä½¿ç”¨ wget ä¸‹è½½ wget -O /tmp/openclash.ipk https://github.com/vernesong/OpenClash/releases/download/v0.47.028/luci-app-openclash_0.47.028_all.ipk # é€šè¿‡ opkg å®‰è£…ä¸‹è½½çš„ ipk æ–‡ä»¶ opkg install /tmp/openclash.ipk âš¡ 2ã€ä¸€é”®å®‰è£… OpenClash 1 2 3 4 5 6 7 8 # æˆ–è€…ç›´æ¥ä½¿ç”¨ URL å®‰è£… opkg install https://github.com/vernesong/OpenClash/releases/download/v0.46.014-beta/luci-app-openclash_0.46.014-beta_all.ipk # æ£€æŸ¥ OpenClash æ˜¯å¦å®‰è£…æˆåŠŸ opkg list-installed | grep openclash # æ£€æŸ¥æœåŠ¡çŠ¶æ€ /etc/init.d/openclash status ğŸ³ ä¸‰ã€Docker æ·»åŠ ä»£ç† âš™ï¸ 1. OpenClash é…ç½® ğŸ‹ 2. docker-compose.yml é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 services: cloudsaver: image: jiangrui1994/cloudsaver:latest container_name: cloud-saver network_mode: bridge restart: on-failure ports: - 8008:8008 volumes: - ./cloudsaver/data:/app/data - ./cloudsaver/config:/app/config environment: - http_proxy=http://10.10.10.252:7893 - https_proxy=http://10.10.10.252:7893 - HTTP_PROXY=http://10.10.10.252:7893 - HTTPS_PROXY=http://10.10.10.252:7893 - no_proxy=localhost,127.0.0.1,172.17.0.0/16 - NO_PROXY=localhost,127.0.0.1,172.17.0.0/16 # å¦‚æœä»£ç†éœ€è¦è®¤è¯ï¼Œæ ¼å¼åº”ä¸ºï¼šhttp://ç”¨æˆ·å:å¯†ç @10.10.10.252:7893 âš ï¸ å››ã€æ³¨æ„äº‹é¡¹ 1. ğŸ”’ ç³»ç»Ÿå…¼å®¹æ€§ âœ… ç¡®è®¤ OpenWrt ç‰ˆæœ¬ä¸ OpenClash å…¼å®¹ ğŸ“¦ æ£€æŸ¥ç³»ç»Ÿæ¶æ„ï¼ˆx86ã€ARMã€MIPSç­‰ï¼‰ ğŸ’¾ ç¡®ä¿æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼ˆè‡³å°‘20MBç©ºé—²ï¼‰ 2. ğŸŒ ç½‘ç»œè¦æ±‚ ğŸ”„ å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥ ğŸŒ éƒ¨åˆ†ä¾èµ–éœ€è¦è®¿é—®å¤–éƒ¨è½¯ä»¶æº â±ï¸ ä¸‹è½½æ—¶é—´å¯èƒ½è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾… 3. ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 # å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°è¯•æ›´æ–°è½¯ä»¶æº opkg update # æ£€æŸ¥ä¾èµ–å…³ç³» opkg check-dependencies luci-app-openclash # æŸ¥çœ‹å®‰è£…æ—¥å¿— logread | grep openclash 4. ğŸ“‹ å®‰è£…åé…ç½® ğŸš€ é¦–æ¬¡å¯åŠ¨ï¼š\n1 2 3 4 5 # å¯åŠ¨ OpenClash æœåŠ¡ /etc/init.d/openclash start # è®¾ç½®å¼€æœºè‡ªå¯ /etc/init.d/openclash enable ğŸŒ Web ç•Œé¢è®¿é—®ï¼š\nç™»å½• Luci ç•Œé¢ åœ¨\u0026quot;æœåŠ¡\u0026quot;èœå•ä¸­æ‰¾åˆ° OpenClash è¿›è¡ŒèŠ‚ç‚¹é…ç½®å’Œè§„åˆ™è®¾ç½® ğŸ“ é…ç½®æ–‡ä»¶ï¼š\nä¸»é…ç½®æ–‡ä»¶ï¼š/etc/config/openclash è§„åˆ™ç›®å½•ï¼š/etc/openclash/ 5. ğŸ†˜ æ•…éšœæ’é™¤ å¦‚æœé‡åˆ°é—®é¢˜ï¼š\nğŸ” æ£€æŸ¥æ—¥å¿—ï¼šlogread | grep clash ğŸ”„ é‡å¯æœåŠ¡ï¼š/etc/init.d/openclash restart ğŸ“‹ éªŒè¯é…ç½®ï¼š/etc/init.d/openclash check ğŸ—‘ï¸ é‡æ–°å®‰è£…ï¼šå…ˆå¸è½½å†é‡æ–°å®‰è£… ğŸ¯ å®Œæˆå®‰è£…æ£€æŸ¥æ¸…å• ç¡®è®¤é˜²ç«å¢™ç±»å‹ï¼ˆiptables/nftablesï¼‰ğŸ›¡ï¸ å®‰è£…å¿…è¦çš„ç³»ç»Ÿä¾èµ– ğŸ“¦ ä¸‹è½½æ­£ç¡®ç‰ˆæœ¬çš„ OpenClash IPK â¬‡ï¸ æˆåŠŸå®‰è£… OpenClash åŒ… âœ… å¯åŠ¨ OpenClash æœåŠ¡ ğŸš€ é€šè¿‡ Web ç•Œé¢è¿›è¡Œé…ç½® ğŸŒ ğŸ’¡ æç¤ºï¼šå®‰è£…å®Œæˆåå»ºè®®é‡å¯ OpenWrt ç³»ç»Ÿä»¥ç¡®ä¿æ‰€æœ‰ç»„ä»¶æ­£ç¡®åŠ è½½ï¼š\n1 reboot é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ¨ OpenWrt ä¸Šå®‰è£…å’Œé…ç½® OpenClashï¼Œäº«å—æ›´åŠ è‡ªç”±å’Œå®‰å…¨çš„ç½‘ç»œä½“éªŒï¼ ğŸŒğŸš€\n","date":"2024-12-07T16:38:18+08:00","image":"https://file.meimolihan.eu.org/img/openclash-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9490325f/","title":"iStoreOS å®‰è£… OpenClash å®Œæ•´æŒ‡å— ğŸ”§"},{"content":"iStoreOS åˆ¤æ–­é˜²ç«å¢™ç‰ˆæœ¬ é€šè¿‡sshè¿æ¥ iStoreOS è¡Œæ‰§â€¬å‘½ä»¤åˆ¤æ–­ï¼š å¦‚æœâ€®æ­£èƒ½â€¬å¸¸åˆ—å‡ºè§„åˆ™ï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨çš„æ˜¯iptables 1 iptables -L å¦‚æœèƒ½æ­£â€®åˆ—å¸¸â€¬å‡ºè§„åˆ™ï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨çš„æ˜¯nftables 1 nft list ruleset ","date":"2024-12-07T16:37:32+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b9e86516/","title":"iStoreOS åˆ¤æ–­é˜²ç«å¢™ç‰ˆæœ¬"},{"content":"Typecho æ–‡ç« å¯¼å‡º æ’ä»¶ä¸‹è½½åœ°å€ï¼šhttps://github.com/ShiinaKin/Typecho-Plugin-Tp2MD\nä½¿ç”¨è¯´æ˜ï¼š\nä¸‹è½½æ’ä»¶ï¼Œè§£å‹åæ–‡ä»¶å¤¹é‡å‘½åä¸º Tp2MDï¼Œä¸Šä¼ è‡³æ’ä»¶ç›®å½•å¹¶å¯ç”¨ï¼Œç„¶åæŒ‰è¯´æ˜æ“ä½œã€‚ åå°è®¾ç½®keyï¼šBR4wOgh6Tc\nå¤‡ä»½ç›®å½•åŠ è¯»å†™æƒé™ 1 chmod -R 777 /mnt/mydisk/home/typecho/typecho/usr/plugins/Tp2MD/output ç½‘é¡µæ‰“å¼€é“¾æ¥è‡ªåŠ¨å¤‡ä»½ https://t.mobufan.eu.org:666/Tp2MD?action=save\u0026key=BR4wOgh6Tc å‹ç¼©å¤‡ä»½æ–‡ä»¶ 1 2 cd /mnt/mydisk/home/typecho/typecho/usr/plugins/Tp2MD/output zip -r 2024-11-06-15-35-19.zip 2024-11-06-15-35-19 æ³¨æ„ï¼š ä½¿ç”¨å‰åŠ¡å¿… å¤‡ä»½ å¤‡ä»½ å¤‡ä»½ è¯·åœ¨æœ¬æ’ä»¶çš„è®¾ç½®å†…å¡«å†™Token, å¯åœ¨ ä¸ªäººä¸­å¿ƒ-ä¸ªäººä»¤ç‰Œ ç”Ÿæˆ, å¿…è¦æƒé™: æ–‡ç« ç®¡ç†, é¡µé¢ç®¡ç† ç”±äºHaloç›®å‰æ²¡æœ‰å¾ˆå¥½çš„åŠæ³•åˆ¤æ–­æ–‡ç« çš„slugæ˜¯å¦é‡å¤, è¯·ä¸è¦é‡å¤å¯¼å…¥ å¯¼å…¥åˆ° halo åšå®¢ å®‰è£…ã€ŠTypechoæ–‡ç« å¯¼å…¥ã€‹æ’ä»¶ ","date":"2024-12-07T16:17:24+08:00","image":"https://file.meimolihan.eu.org/img/typecho-01.webp","permalink":"https://blog.meimolihan.eu.org/p/330aaa6b/","title":"Typecho æ–‡ç« å¯¼å‡º"},{"content":"Docker éƒ¨ç½² Aria2 Pro ä¸‹è½½å™¨ ğŸš€ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Aria2 Pro 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Aria2 Pro 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é…ç½®è¿æ¥ âš™ï¸ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸš€ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Aria2 Pro å®˜ç½‘åœ°å€ï¼š https://aria2.github.io/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/P3TERX/Aria2-Pro-Docker ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/p3terx/aria2-pro Aria2 Pro æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œä¸‹è½½å·¥å…·ï¼Œæ”¯æŒå¤šåè®®ä¸‹è½½ï¼ŒåŒ…æ‹¬ HTTP/HTTPSã€FTPã€SFTPã€BitTorrent å’Œ Metalinkã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œå¯ä»¥è½»æ¾æ­å»ºé«˜æ€§èƒ½çš„ä¸‹è½½æœåŠ¡å™¨ï¼Œé…åˆ AriaNg Web ç•Œé¢æä¾›ç›´è§‚çš„ç®¡ç†ä½“éªŒã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âš¡ å¤šåè®®æ”¯æŒ æ”¯æŒ HTTP/HTTPSã€FTPã€SFTPã€BitTorrent å’Œ Metalink ä¸€ç«™å¼ä¸‹è½½è§£å†³æ–¹æ¡ˆ ğŸš€ é«˜é€Ÿä¸‹è½½ å¤šè¿æ¥å¹¶å‘ä¸‹è½½ï¼Œæœ€å¤§åŒ–åˆ©ç”¨å¸¦å®½ æå‡ä¸‹è½½é€Ÿåº¦ï¼ŒèŠ‚çœæ—¶é—´ ğŸ’¾ è½»é‡é«˜æ•ˆ èµ„æºå ç”¨ä½ï¼Œæ€§èƒ½ä¼˜å¼‚ èŠ‚çœç³»ç»Ÿèµ„æºï¼Œç¨³å®šè¿è¡Œ ğŸ”„ æ–­ç‚¹ç»­ä¼  æ”¯æŒä¸‹è½½ä»»åŠ¡æ–­ç‚¹ç»­ä¼  ç½‘ç»œä¸­æ–­åæ— éœ€é‡æ–°ä¸‹è½½ ğŸŒ è¿œç¨‹æ§åˆ¶ å¯é€šè¿‡ JSON-RPC å’Œ XML-RPC æ¥å£è¿œç¨‹æ§åˆ¶ æ–¹ä¾¿è¿œç¨‹ç®¡ç†ä¸‹è½½ä»»åŠ¡ ğŸ“Š ç®¡ç†ç•Œé¢ é…åˆ AriaNg æä¾›ç¾è§‚çš„ Web ç®¡ç†ç•Œé¢ ç›´è§‚æ˜“ç”¨ï¼Œæ— éœ€å‘½ä»¤è¡Œæ“ä½œ ğŸ”§ é«˜åº¦å¯å®šåˆ¶ ä¸°å¯Œçš„é…ç½®é€‰é¡¹æ»¡è¶³å„ç§éœ€æ±‚ é€‚åº”ä¸åŒä¸‹è½½åœºæ™¯å’Œéœ€æ±‚ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Aria2 Pro 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 mkdir -p /mnt/mydisk/home/aria2-pro \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: aria2-pro: container_name: aria2-pro image: p3terx/aria2-pro:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;6800:6800\u0026#34; # RPC ç«¯å£ - \u0026#34;6888:6888\u0026#34; # BT ç›‘å¬ç«¯å£ - \u0026#34;6888:6888/udp\u0026#34; # BT UDP ç«¯å£ volumes: - ./config:/config - /mnt/ARS2-NFS/downloads/aria2-pro:/downloads environment: - PUID=0 - PGID=0 - RPC_SECRET=haoyong # RPC è¿æ¥å¯†é’¥ - RPC_PORT=6800 - LISTEN_PORT=6888 - IPV6_MODE=true - TZ=Asia/Shanghai ariang: container_name: ariang image: p3terx/ariang:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;6880:6880\u0026#34; # Webç•Œé¢ç«¯å£ environment: - TZ=Asia/Shanghai depends_on: - aria2-pro EOF ğŸ”‘ RPC è¿æ¥å¯†é’¥: haoyong\nğŸ“ ä¸‹è½½è·¯å¾„: /mnt/ARS2-NFS/downloads/aria2-pro\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Aria2 Pro 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:6880 åŸŸåè®¿é—®: https://aria2.example.comï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é…ç½®è¿æ¥ âš™ï¸ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ç‚¹å‡»å·¦ä¾§èœå• \u0026ldquo;Aria2 è®¾ç½®\u0026rdquo; é…ç½®è¿æ¥ä¿¡æ¯ï¼š RPC åœ°å€: http://æœåŠ¡å™¨IP:6800/jsonrpc RPC åè®®: HTTP RPC å¯†é’¥: haoyong ç‚¹å‡» \u0026ldquo;é‡æ–°è¿æ¥\u0026rdquo; æµ‹è¯•è¿æ¥ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://aria2.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/aria2.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name aria2.example.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 20G; location / { proxy_pass http://localhost:6880; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; proxy_pass http://localhost:6880; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/aria2-pro # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop aria2-pro ariang # åœæ­¢å®¹å™¨ docker start aria2-pro ariang # å¯åŠ¨å®¹å™¨ docker restart aria2-pro ariang # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm aria2-pro ariang # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f aria2-pro ariang # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it aria2-pro bash # ä½¿ç”¨bashè¿›å…¥aria2-proå®¹å™¨ docker exec -it aria2-pro sh # ä½¿ç”¨shè¿›å…¥aria2-proå®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect aria2-pro # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats aria2-pro # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs aria2-pro # æŸ¥çœ‹æ—¥å¿— docker logs -f aria2-pro # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 aria2-pro # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t aria2-pro # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸš€ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Aria2 Pro ä¸‹è½½å™¨ï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ æé€Ÿä¸‹è½½ äº«å—å¤šåè®®å¹¶å‘ä¸‹è½½å¸¦æ¥çš„æè‡´é€Ÿåº¦ä½“éªŒï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç½‘ç»œå¸¦å®½\nğŸŒ è¿œç¨‹ç®¡ç† éšæ—¶éšåœ°é€šè¿‡ Web ç•Œé¢æ·»åŠ å’Œç®¡ç†ä¸‹è½½ä»»åŠ¡ï¼Œæ‰“ç ´æ—¶ç©ºé™åˆ¶\nğŸ’¾ ç¨³å®šå¯é  ä¾æ‰˜å®¹å™¨åŒ–éƒ¨ç½²ç¡®ä¿ä¸‹è½½ç¯å¢ƒç¨³å®šï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ä¸ä¸¢è¿›åº¦\nğŸ”’ å®‰å…¨åŠ å¯† é€šè¿‡ HTTPS åŠ å¯†è¿æ¥ä¿æŠ¤ä½ çš„ä¸‹è½½éšç§å’Œä¼ è¾“å®‰å…¨\nä¸‹è½½ä¸ä»…æ˜¯è·å–èµ„æºçš„æ–¹å¼ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„é«˜æ•ˆåŠ©æ‰‹ã€‚æ„¿ Aria2 Pro æˆä¸ºä½ å¯é çš„ä¸‹è½½ä¼™ä¼´ï¼Œè®©ä½ çš„æ¯ä¸€æ¬¡èµ„æºè·å–éƒ½å˜å¾—ç®€å•ã€å¿«é€Ÿã€ç¨³å®šã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé‡Šæ”¾ä½ çš„ç½‘ç»œæ½œèƒ½ï¼Œä½“éªŒæé€Ÿä¸‹è½½çš„ç•…å¿«æ„Ÿå—ï¼ğŸ’¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Aria2 Pro å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¸‹è½½æ„‰å¿«ï¼Œèµ„æºæ»¡è½½ï¼ğŸ‰\n","date":"2024-12-07T16:16:14+08:00","image":"https://file.meimolihan.eu.org/img/aria2-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c65e5301/","title":"Docker éƒ¨ç½² Aria2 Pro ä¸‹è½½å™¨ ğŸš€"},{"content":"Docker éƒ¨ç½² Emby å®˜æ–¹ç‰ˆåª’ä½“æœåŠ¡å™¨ ğŸ¬ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Emby 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Emby 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåª’ä½“ï¼Œå¨±ä¹æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Emby å®˜ç½‘åœ°å€ï¼š https://emby.media/docker-server.html ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/emby/embyserver Emby å®˜æ–¹ç‰ˆ æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„åª’ä½“æœåŠ¡å™¨è½¯ä»¶ï¼Œå¯ä»¥å°†æ‚¨çš„ä¸ªäººåª’ä½“åº“ï¼ˆç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹ã€ç…§ç‰‡ï¼‰è½¬æ¢æˆç²¾ç¾çš„æµåª’ä½“ä½“éªŒã€‚\né€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç¨³å®šå¯é çš„åª’ä½“æœåŠ¡å™¨ï¼Œæ”¯æŒå…¨å¹³å°è®¿é—®å’Œæ™ºèƒ½è½¬ç åŠŸèƒ½ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¥ ä¸“ä¸šåª’ä½“ç®¡ç† è‡ªåŠ¨æ•´ç†ç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹å’Œç…§ç‰‡ æ™ºèƒ½è¯†åˆ«å…ƒæ•°æ®ï¼Œç”Ÿæˆç²¾ç¾åª’ä½“åº“ ğŸ“± å…¨å¹³å°æ”¯æŒ æ”¯æŒç½‘é¡µã€æ‰‹æœºã€ç”µè§†ã€æ¸¸æˆæœºç­‰å¤šç§è®¾å¤‡ éšæ—¶éšåœ°äº«å—åª’ä½“å†…å®¹ ğŸ”„ æ™ºèƒ½è½¬ç  æ ¹æ®è®¾å¤‡èƒ½åŠ›è‡ªåŠ¨è°ƒæ•´è§†é¢‘æ ¼å¼å’Œç ç‡ ä¼˜åŒ–æ’­æ”¾ä½“éªŒï¼ŒèŠ‚çœå¸¦å®½ ğŸ¨ ç¾è§‚ç•Œé¢ ç°ä»£åŒ–ç”¨æˆ·ç•Œé¢ï¼Œæ”¯æŒä¸»é¢˜å®šåˆ¶ ä¸ªæ€§åŒ–è§‚çœ‹ä½“éªŒ ğŸ‘¥ å¤šç”¨æˆ·ç³»ç»Ÿ åˆ›å»ºå¤šä¸ªç”¨æˆ·å¹¶è®¾ç½®ä¸åŒæƒé™ é€‚åˆå®¶åº­å…±äº«ä½¿ç”¨ ğŸ“Š è§‚çœ‹ç»Ÿè®¡ è®°å½•è§‚çœ‹å†å²å’Œæ’­æ”¾è¿›åº¦ æ–¹ä¾¿ç»­æ’­å’Œç®¡ç† ğŸŒ è¿œç¨‹è®¿é—® é€šè¿‡äº’è”ç½‘éšæ—¶éšåœ°è®¿é—®åª’ä½“åº“ æ‰“ç ´åœ°åŸŸé™åˆ¶ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Emby 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 mkdir -p /mnt/mydisk/home/emby \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: emby-server: container_name: emby-server image: emby/embyserver:latest restart: unless-stopped network_mode: bridge ports: - 8996:8096 # Webç•Œé¢ç«¯å£ - 8920:8920 # HTTPSç«¯å£ï¼ˆå¯é€‰ï¼‰ volumes: - ./config:/config # é…ç½®æ–‡ä»¶ç›®å½• - ./metadata:/metadata # å…ƒæ•°æ®ç›®å½• - /mnt/ARS2-NFS/nas/link:/media/video # è§†é¢‘åª’ä½“ç›®å½• - /mnt/ARS2-NFS/nas/music:/media/music # éŸ³ä¹ç›®å½•ï¼ˆå¯é€‰ï¼‰ - /mnt/ARS2-NFS/nas/photos:/media/photos # ç…§ç‰‡ç›®å½•ï¼ˆå¯é€‰ï¼‰ environment: - UID=1000 # å»ºè®®ä½¿ç”¨å®é™…ç”¨æˆ·ID - GID=1000 # å»ºè®®ä½¿ç”¨å®é™…ç”¨æˆ·ç»„ID - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® - UMASK_SET=022 # æ–‡ä»¶æƒé™æ©ç  deploy: resources: limits: memory: 8G reservations: memory: 1G devices: - /dev/dri:/dev/dri # ç¡¬ä»¶åŠ é€Ÿè®¾å¤‡ extra_hosts: - \u0026#34;api.themoviedb.org:13.224.161.90\u0026#34; - \u0026#34;image.tmdb.org:108.138.246.49\u0026#34; - \u0026#34;www.themoviedb.org:54.192.151.79\u0026#34; - \u0026#34;themoviedb.org:99.84.238.136\u0026#34; - \u0026#34;api4.thetvdb.com:13.225.142.99\u0026#34; EOF ğŸ” å®‰å…¨æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼Œå»ºè®®ä½¿ç”¨å¼ºå¯†ç å¹¶å®šæœŸæ›´æ¢\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Emby 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8996 å±€åŸŸç½‘è®¿é—®ï¼š http://10.10.10.245:8996 åŸŸåè®¿é—®ï¼š https://emby.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ é€‰æ‹©è¯­è¨€ï¼ˆæ¨èä¸­æ–‡ï¼‰ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· æ·»åŠ åª’ä½“åº“ï¼š ç”µå½±ï¼šæŒ‡å‘ /media/video/Movies ç”µè§†å‰§ï¼šæŒ‡å‘ /media/video/TV Shows éŸ³ä¹ï¼šæŒ‡å‘ /media/musicï¼ˆå¦‚å·²æŒ‚è½½ï¼‰ ç…§ç‰‡ï¼šæŒ‡å‘ /media/photosï¼ˆå¦‚å·²æŒ‚è½½ï¼‰ é…ç½®å…ƒæ•°æ®ä¸‹è½½å™¨ï¼ˆæ¨èTMDBå’ŒTVDBï¼‰ è®¾ç½®ç½‘ç»œå’Œè¿œç¨‹è®¿é—®é€‰é¡¹ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://emby.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/emby.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name emby.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name emby.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 20G; location / { proxy_pass http://127.0.0.1:8996; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; proxy_connect_timeout 300s; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; proxy_pass http://127.0.0.1:8996; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªåª’ä½“ï¼Œå¨±ä¹æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Emby å®˜æ–¹ç‰ˆåª’ä½“æœåŠ¡å™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ ä¸“ä¸šç®¡ç† æ‰“é€ ç²¾ç¾çš„ä¸ªäººåª’ä½“åº“ï¼Œæ™ºèƒ½æ•´ç†ç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹å’Œç…§ç‰‡èµ„æº\nğŸŒ å…¨å¹³å°ç•…äº« åœ¨ä»»ä½•è®¾å¤‡ä¸Šæµç•…æ’­æ”¾åª’ä½“å†…å®¹ï¼Œæ™ºèƒ½è½¬ç ç¡®ä¿æœ€ä½³è§‚çœ‹ä½“éªŒ\nğŸ“Š æ™ºèƒ½ä¼˜åŒ– è‡ªåŠ¨è·å–å…ƒæ•°æ®å’Œè‰ºæœ¯å°é¢ï¼Œè®©åª’ä½“åº“æ—¢ç¾è§‚åˆäº•äº•æœ‰æ¡\nåª’ä½“ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸å½±éŸ³å¨±ä¹ç›¸ä¼´çš„ç²¾å½©æ—…ç¨‹ã€‚æ„¿ Emby æˆä¸ºä½ å¯é çš„åª’ä½“ç®¡å®¶ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å®¶åº­è§‚å½±å’ŒéŸ³ä¹æ¬£èµçš„ç¾å¥½æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéšå¿ƒè§‚å½±ï¼Œç•…äº«éŸ³ä¹â€”â€”æ„å»ºä½ ä¸ªæ€§åŒ–çš„å®¶åº­å¨±ä¹ç”Ÿæ€ç³»ç»Ÿå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Emby å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯é€šè¿‡ Emby å®˜æ–¹ç¤¾åŒº è·å–å¸®åŠ©ã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè§‚å½±ä½“éªŒæ›´ä¸Šä¸€å±‚æ¥¼ï¼ğŸ‰\n","date":"2024-12-07T16:15:14+08:00","image":"https://file.meimolihan.eu.org/img/emby-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a864fecb/","title":"Docker éƒ¨ç½² Emby å®˜æ–¹ç‰ˆåª’ä½“æœåŠ¡å™¨ ğŸ¬"},{"content":"Sun-Panel cssæºç  ä¸æœ«å¤§ä½¬åšå®¢ï¼šhttps://blog.ymz.icu/archives/sun-panelym-nav-zi-ding-yi-cssjs-yuan-ma-si-lu\nSun-Panel_é¼ æ ‡æ‚¬åœåŠ¨ç”»+é¼ æ ‡æ–°å…‰æ ‡æ ·å¼+å¡ç‰‡èƒŒæ™¯çº¿æ¡æ ·å¼+ç½‘é¡µè®¡æ—¶å™¨ï¼ˆæˆ‘ä½¿ç”¨ä¸­çš„ï¼‰ æœåŠ¡å™¨ä¸»æœºshellè¾“å…¥ä»¥ä¸‹å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 touch /mnt/mydisk/home/sun-panel/config/custom/index.css \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/home/sun-panel/config/custom/index.css \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /*é¼ æ ‡æ‚¬åœåŠ¨ç”» */ /* å½“é¼ æ ‡æ‚¬åœåœ¨å›¾æ ‡ä¿¡æ¯æ¡†ä¸Šæ—¶è§¦å‘åŠ¨ç”» */ /* è¯¦ç»†å›¾æ ‡æ‘‡æ™ƒåŠ¨ç”» */ .icon-info-box .rounded-2xl:hover { background: rgba(42, 42, 42, 0.7) !important;/* èƒŒæ™¯é¢œè‰²å˜æˆæ·±ç°è‰² */ -webkit-animation: info-shake-bounce .5s alternate !important; -moz-animation: info-shake-bounce .5s alternate !important; -o-animation: info-shake-bounce .5s alternate !important; animation: info-shake-bounce .5s alternate !important; } /* å°å›¾æ ‡æ‘‡æ™ƒåŠ¨ç”» */ .icon-small-box .rounded-2xl:hover { background: rgba(42, 42, 42, 0.7) !important;/* èƒŒæ™¯é¢œè‰²å˜æˆæ·±ç°è‰² */ -webkit-animation: small-shake-bounce .5s alternate !important; -moz-animation: small-shake-bounce .5s alternate !important; -o-animation: small-shake-bounce .5s alternate !important; animation: small-shake-bounce .5s alternate !important; } /* å®šä¹‰æ‘‡è¯¦ç»†å›¾æ ‡æ™ƒå¼¹è·³åŠ¨ç”»çš„å…³é”®å¸§ */ @keyframes info-shake-bounce { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(10deg); } 50% { transform: rotate(-10deg); } 75% { transform: rotate(2.5deg); } 85% { transform: rotate(-2.5deg); } } /* å®šä¹‰æ‘‡å°å›¾æ ‡æ™ƒå¼¹è·³åŠ¨ç”»çš„å…³é”®å¸§ */ @keyframes small-shake-bounce { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(15deg); } 50% { transform: rotate(-15deg); } 75% { transform: rotate(5deg); } 85% { transform: rotate(5deg); } } /* è‡ªå®šä¹‰é¼ æ ‡æ–°å…‰æ ‡æ ·å¼ */ body { cursor: url(https://cdn.custom-cursor.com/db/4828/32/arrow2747.png), default !important; } /* è‡ªå®šä¹‰é¼ æ ‡æ‚¬æµ®å…‰æ ‡ */ .cursor-pointer { cursor: url(https://cdn.custom-cursor.com/db/4827/32/arrow2747.png), auto !important; } /* å¡ç‰‡èƒŒæ™¯çº¿æ¡æ ·å¼ BY é¦™æ°´ [äºŒç¾¤å¤§ä½¬æä¾›] */ /* ä¼ªå…ƒç´ åˆ›å»ºèƒŒæ™¯çº¿æ¡æ ·å¼ */ .w-full .font-semibold:before { position: absolute; /* è®¾ç½®ä¸ºç»å¯¹å®šä½ */ width: 93px; /* å®½åº¦ä¸º93åƒç´  */ display: block; /* è®¾ç½®ä¸ºå—çº§å…ƒç´  */ height: 75px; /* é«˜åº¦ä¸º75åƒç´  */ content: \u0026#34;\u0026#34;; /* ä¼ªå…ƒç´ å†…å®¹ä¸ºç©º */ border-radius: 50%; /* è¾¹æ¡†åŠå¾„ä¸º50%ï¼Œå½¢æˆåœ†å½¢ */ z-index: -1; /* è®¾ç½®å±‚çº§ä¸º-1ï¼Œå°†å…¶æ”¾åœ¨å†…å®¹ä¹‹å */ right: -27px; /* è·ç¦»å³è¾¹-27åƒç´ çš„ä½ç½® */ top: -35px; /* è·ç¦»é¡¶éƒ¨-35åƒç´ çš„ä½ç½® */ background: #ffffff3b; /* èƒŒæ™¯é¢œè‰²ä¸ºæ·¡ç™½è‰²å¸¦é€æ˜åº¦çš„3b */ box-shadow: -8px 21px 0 #ffffff1a; /* è®¾ç½®é˜´å½±æ•ˆæœï¼Œæ°´å¹³åç§»-8pxï¼Œå‚ç›´åç§»21pxï¼Œé¢œè‰²ä¸ºæ·¡ç™½è‰²å¸¦é€æ˜åº¦çš„1a */ } /* ä¼ªå…ƒç´ åˆ›å»ºå¦ä¸€ç§èƒŒæ™¯çº¿æ¡æ ·å¼ */ .w-full .font-semibold:after { position: absolute; /* è®¾ç½®ä¸ºç»å¯¹å®šä½ */ width: 40px; /* å®½åº¦ä¸º40åƒç´  */ display: block; /* è®¾ç½®ä¸ºå—çº§å…ƒç´  */ height: 40px; /* é«˜åº¦ä¸º40åƒç´  */ border: 4px solid #ffffff3b; /* è¾¹æ¡†ä¸º4åƒç´ çš„å®çº¿ï¼Œé¢œè‰²ä¸ºæ·¡ç™½è‰²å¸¦é€æ˜åº¦çš„3b */ content: \u0026#34;\u0026#34;; /* ä¼ªå…ƒç´ å†…å®¹ä¸ºç©º */ border-radius: 50%; /* è¾¹æ¡†åŠå¾„ä¸º50%ï¼Œå½¢æˆåœ†å½¢ */ top: -19px; /* è·ç¦»é¡¶éƒ¨-19åƒç´ çš„ä½ç½® */ right: 48px; /* è·ç¦»å³è¾¹48åƒç´ çš„ä½ç½® */ z-index: -1; /* è®¾ç½®å±‚çº§ä¸º-1ï¼Œå°†å…¶æ”¾åœ¨å†…å®¹ä¹‹å */ } /* è®¾ç½®å›¾æ ‡ä¿¡æ¯æ¡†çš„åœ†è§’æ ·å¼ */ .icon-info-box .rounded-2xl { position: relative; /* è®¾ç½®ä¸ºç›¸å¯¹å®šä½ */ border-radius: 15px; /* è®¾ç½®è¾¹æ¡†åŠå¾„ä¸º15åƒç´ ï¼Œå½¢æˆåœ†è§’ */ overflow: hidden; /* è¶…å‡ºéƒ¨åˆ†éšè— */ -webkit-backdrop-filter: blur(10px); /* ä½¿ç”¨Webkitå‰ç¼€çš„èƒŒæ™¯æ»¤é•œï¼Œæ¨¡ç³Šç¨‹åº¦ä¸º10åƒç´  */ backdrop-filter: blur(10px); /* èƒŒæ™¯æ»¤é•œï¼Œæ¨¡ç³Šç¨‹åº¦ä¸º10åƒç´  */ } function siteTime() { window.setTimeout(siteTime, 1000); var seconds = 1000; var minutes = seconds * 60; var hours = minutes * 60; var days = hours * 24; var years = days * 365; var targetDate = new Date(2025, 01, 28); // æ³¨æ„æœˆä»½æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥11è¡¨ç¤º12æœˆ var today = new Date(); var diff = today - targetDate; // è®¡ç®—å·²è¿è¡Œçš„å¹´æ•° var totalYears = Math.floor(diff / years); // è®¡ç®—å‰©ä½™æ—¶é—´ var remainingTime = diff % years; var diffDays = Math.floor(remainingTime / days); remainingTime %= days; var diffHours = Math.floor(remainingTime / hours); remainingTime %= hours; var diffMinutes = Math.floor(remainingTime / minutes); remainingTime %= minutes; var diffSeconds = Math.floor(remainingTime / seconds); document.getElementById(\u0026#34;sitetime\u0026#34;).innerHTML = \u0026#34;ç½‘é¡µå·²è¿è¥ \u0026#34; + totalYears + \u0026#34; å¹´ \u0026#34; + diffDays + \u0026#34; å¤© \u0026#34; + diffHours + \u0026#34; å°æ—¶ \u0026#34; + diffMinutes + \u0026#34; åˆ†é’Ÿ \u0026#34; + diffSeconds + \u0026#34; ç§’\u0026#34;; } siteTime(); EOF *æµè§ˆå™¨æ¸…ç©ºç¼“å­˜ï¼Œåˆ·æ–°åè§æ•ˆæœ\n1 ã€Sun-Panel_é¼ æ ‡æ‚¬åœåŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /*é¼ æ ‡æ‚¬åœåŠ¨ç”» */ /* å½“é¼ æ ‡æ‚¬åœåœ¨å›¾æ ‡ä¿¡æ¯æ¡†ä¸Šæ—¶è§¦å‘åŠ¨ç”» */ /* è¯¦ç»†å›¾æ ‡æ‘‡æ™ƒåŠ¨ç”» */ .icon-info-box .rounded-2xl:hover { background: rgba(42, 42, 42, 0.7) !important;/* èƒŒæ™¯é¢œè‰²å˜æˆæ·±ç°è‰² */ -webkit-animation: info-shake-bounce .5s alternate !important; -moz-animation: info-shake-bounce .5s alternate !important; -o-animation: info-shake-bounce .5s alternate !important; animation: info-shake-bounce .5s alternate !important; } /* å°å›¾æ ‡æ‘‡æ™ƒåŠ¨ç”» */ .icon-small-box .rounded-2xl:hover { background: rgba(42, 42, 42, 0.7) !important;/* èƒŒæ™¯é¢œè‰²å˜æˆæ·±ç°è‰² */ -webkit-animation: small-shake-bounce .5s alternate !important; -moz-animation: small-shake-bounce .5s alternate !important; -o-animation: small-shake-bounce .5s alternate !important; animation: small-shake-bounce .5s alternate !important; } /* å®šä¹‰æ‘‡è¯¦ç»†å›¾æ ‡æ™ƒå¼¹è·³åŠ¨ç”»çš„å…³é”®å¸§ */ @keyframes info-shake-bounce { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(10deg); } 50% { transform: rotate(-10deg); } 75% { transform: rotate(2.5deg); } 85% { transform: rotate(-2.5deg); } } /* å®šä¹‰æ‘‡å°å›¾æ ‡æ™ƒå¼¹è·³åŠ¨ç”»çš„å…³é”®å¸§ */ @keyframes small-shake-bounce { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(15deg); } 50% { transform: rotate(-15deg); } 75% { transform: rotate(5deg); } 85% { transform: rotate(5deg); } } 2 ã€è‡ªå®šä¹‰é¼ æ ‡æ–°å…‰æ ‡æ ·å¼ 1 2 3 4 5 6 7 8 9 /* è‡ªå®šä¹‰é¼ æ ‡æ–°å…‰æ ‡æ ·å¼ */ body { cursor: url(https://cdn.custom-cursor.com/db/4828/32/arrow2747.png), default !important; } /* è‡ªå®šä¹‰é¼ æ ‡æ‚¬æµ®å…‰æ ‡ */ .cursor-pointer { cursor: url(https://cdn.custom-cursor.com/db/4827/32/arrow2747.png), auto !important; } 3 ã€å¡ç‰‡èƒŒæ™¯çº¿æ¡æ ·å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /* å¡ç‰‡èƒŒæ™¯çº¿æ¡æ ·å¼ BY é¦™æ°´ [äºŒç¾¤å¤§ä½¬æä¾›] */ /* ä¼ªå…ƒç´ åˆ›å»ºèƒŒæ™¯çº¿æ¡æ ·å¼ */ .w-full .font-semibold:before { position: absolute; /* è®¾ç½®ä¸ºç»å¯¹å®šä½ */ width: 93px; /* å®½åº¦ä¸º93åƒç´  */ display: block; /* è®¾ç½®ä¸ºå—çº§å…ƒç´  */ height: 75px; /* é«˜åº¦ä¸º75åƒç´  */ content: \u0026#34;\u0026#34;; /* ä¼ªå…ƒç´ å†…å®¹ä¸ºç©º */ border-radius: 50%; /* è¾¹æ¡†åŠå¾„ä¸º50%ï¼Œå½¢æˆåœ†å½¢ */ z-index: -1; /* è®¾ç½®å±‚çº§ä¸º-1ï¼Œå°†å…¶æ”¾åœ¨å†…å®¹ä¹‹å */ right: -27px; /* è·ç¦»å³è¾¹-27åƒç´ çš„ä½ç½® */ top: -35px; /* è·ç¦»é¡¶éƒ¨-35åƒç´ çš„ä½ç½® */ background: #ffffff3b; /* èƒŒæ™¯é¢œè‰²ä¸ºæ·¡ç™½è‰²å¸¦é€æ˜åº¦çš„3b */ box-shadow: -8px 21px 0 #ffffff1a; /* è®¾ç½®é˜´å½±æ•ˆæœï¼Œæ°´å¹³åç§»-8pxï¼Œå‚ç›´åç§»21pxï¼Œé¢œè‰²ä¸ºæ·¡ç™½è‰²å¸¦é€æ˜åº¦çš„1a */ } /* ä¼ªå…ƒç´ åˆ›å»ºå¦ä¸€ç§èƒŒæ™¯çº¿æ¡æ ·å¼ */ .w-full .font-semibold:after { position: absolute; /* è®¾ç½®ä¸ºç»å¯¹å®šä½ */ width: 40px; /* å®½åº¦ä¸º40åƒç´  */ display: block; /* è®¾ç½®ä¸ºå—çº§å…ƒç´  */ height: 40px; /* é«˜åº¦ä¸º40åƒç´  */ border: 4px solid #ffffff3b; /* è¾¹æ¡†ä¸º4åƒç´ çš„å®çº¿ï¼Œé¢œè‰²ä¸ºæ·¡ç™½è‰²å¸¦é€æ˜åº¦çš„3b */ content: \u0026#34;\u0026#34;; /* ä¼ªå…ƒç´ å†…å®¹ä¸ºç©º */ border-radius: 50%; /* è¾¹æ¡†åŠå¾„ä¸º50%ï¼Œå½¢æˆåœ†å½¢ */ top: -19px; /* è·ç¦»é¡¶éƒ¨-19åƒç´ çš„ä½ç½® */ right: 48px; /* è·ç¦»å³è¾¹48åƒç´ çš„ä½ç½® */ z-index: -1; /* è®¾ç½®å±‚çº§ä¸º-1ï¼Œå°†å…¶æ”¾åœ¨å†…å®¹ä¹‹å */ } 4 ã€ç½‘é¡µè®¡æ—¶å™¨ å±•ç¤ºæ­¤å†…å®¹éœ€è¦åœ¨Sun-Panelè‡ªå®šä¹‰é¡µè„šåŠ ä¸Šæ­¤ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 \u0026lt;span id=\u0026#34;sitetime\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; function siteTime() { window.setTimeout(siteTime, 1000); var seconds = 1000; var minutes = seconds * 60; var hours = minutes * 60; var days = hours * 24; var years = days * 365; var targetDate = new Date(2023, 11, 18); // æ³¨æ„æœˆä»½æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥11è¡¨ç¤º12æœˆ var today = new Date(); var diff = today - targetDate; // è®¡ç®—å·²è¿è¡Œçš„å¹´æ•° var totalYears = Math.floor(diff / years); // è®¡ç®—å‰©ä½™æ—¶é—´ var remainingTime = diff % years; var diffDays = Math.floor(remainingTime / days); remainingTime %= days; var diffHours = Math.floor(remainingTime / hours); remainingTime %= hours; var diffMinutes = Math.floor(remainingTime / minutes); remainingTime %= minutes; var diffSeconds = Math.floor(remainingTime / seconds); document.getElementById(\u0026#34;sitetime\u0026#34;).innerHTML = \u0026#34;ç½‘é¡µå·²è¿è¥ \u0026#34; + totalYears + \u0026#34; å¹´ \u0026#34; + diffDays + \u0026#34; å¤© \u0026#34; + diffHours + \u0026#34; å°æ—¶ \u0026#34; + diffMinutes + \u0026#34; åˆ†é’Ÿ \u0026#34; + diffSeconds + \u0026#34; ç§’\u0026#34;; } siteTime(); ","date":"2024-12-07T16:14:38+08:00","image":"https://file.meimolihan.eu.org/img/docker-sun-panel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/69afd588/","title":"Sun-Panel cssæºç "},{"content":"Sun-Panel jsæºç  ** æ’ä»¶é›†åœ°å€ï¼šhttps://github.com/hslr-s/sun-panel-js-plugins ** ** Sun-Panelï¼šhttps://doc.sun-panel.top/zh_cn **\nä¸€ ã€æ˜¾ç¤ºæ¦‚è§ˆå¿«é€Ÿè·³è½¬\u0026ndash;æœåŠ¡å™¨ä¸»æœºshellè¾“å…¥ä»¥ä¸‹å‘½ä»¤ åˆ›å»ºjsæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 touch /mnt/mydisk/home/sun-panel/config/custom/index.js \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/home/sun-panel/config/custom/index.js \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; (function () { // =========== Config Start =========== // ------------------------------------ // è·ç¦»æ»šåŠ¨åç§»é‡ const scrollOffset = 80 // æ˜¾ç¤ºé£æ ¼( auto:è‡ªåŠ¨(é»˜è®¤) | mobile:å·¦ä¸Šè§’æ˜¾ç¤ºè§¦å‘æŒ‰é’®-ç§»åŠ¨ç«¯é£æ ¼ | sidebar:å¸¸æ€æ˜¾ç¤ºä¾§æ ) const displayStyle = \u0026#39;auto\u0026#39; // ç§»åŠ¨ç«¯å®½åº¦å®šä¹‰ const mobileWidth = 800 const SunPanelTOCDomIdName = \u0026#39;sun-panel-toc-dom\u0026#39; // å·¦ä¸Šè§’æŒ‰é’® SVG å›¾æ ‡ const svgTocMobileBtn = \u0026#39;\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;currentColor\u0026#34; d=\u0026#34;M17.5 4.5c-1.95 0-4.05.4-5.5 1.5c-1.45-1.1-3.55-1.5-5.5-1.5c-1.45 0-2.99.22-4.28.79C1.49 5.62 1 6.33 1 7.14v11.28c0 1.3 1.22 2.26 2.48 1.94c.98-.25 2.02-.36 3.02-.36c1.56 0 3.22.26 4.56.92c.6.3 1.28.3 1.87 0c1.34-.67 3-.92 4.56-.92c1 0 2.04.11 3.02.36c1.26.33 2.48-.63 2.48-1.94V7.14c0-.81-.49-1.52-1.22-1.85c-1.28-.57-2.82-.79-4.27-.79M21 17.23c0 .63-.58 1.09-1.2.98c-.75-.14-1.53-.2-2.3-.2c-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5c.92 0 1.83.09 2.7.28c.46.1.8.51.8.98z\u0026#34;/\u0026gt;\u0026lt;path fill=\u0026#34;currentColor\u0026#34; d=\u0026#34;M13.98 11.01c-.32 0-.61-.2-.71-.52c-.13-.39.09-.82.48-.94c1.54-.5 3.53-.66 5.36-.45c.41.05.71.42.66.83s-.42.71-.83.66c-1.62-.19-3.39-.04-4.73.39c-.08.01-.16.03-.23.03m0 2.66c-.32 0-.61-.2-.71-.52c-.13-.39.09-.82.48-.94c1.53-.5 3.53-.66 5.36-.45c.41.05.71.42.66.83s-.42.71-.83.66c-1.62-.19-3.39-.04-4.73.39a1 1 0 0 1-.23.03m0 2.66c-.32 0-.61-.2-.71-.52c-.13-.39.09-.82.48-.94c1.53-.5 3.53-.66 5.36-.45c.41.05.71.42.66.83s-.42.7-.83.66c-1.62-.19-3.39-.04-4.73.39a1 1 0 0 1-.23.03\u0026#34;/\u0026gt;\u0026lt;/svg\u0026gt;\u0026#39; // ------------------------------------ // =========== Config End =========== // æ»šåŠ¨å®¹å™¨çš„ç±»å const scrollContainerElementClassName = \u0026#39;.scroll-container\u0026#39; // ä¸€äº›å‡½æ•° const isMobile = () =\u0026gt; { if (displayStyle === \u0026#39;mobile\u0026#39;) { return true } else if (displayStyle === \u0026#39;pc\u0026#39;) { return false } const width = window.innerWidth return width \u0026lt; mobileWidth } function createDom() { // æ£€æµ‹æ˜¯å¦å·²ç»å­˜åœ¨TOC DOMï¼Œå­˜åœ¨åˆ™åˆ é™¤ (function () { const element = document.getElementById(SunPanelTOCDomIdName) if (element) { element.remove() } })() const SunPanelTOCDom = document.createElement(\u0026#39;div\u0026#39;) SunPanelTOCDom.id = SunPanelTOCDomIdName document.body.appendChild(SunPanelTOCDom) // ========= Add style start ========= const style = document.createElement(\u0026#39;style\u0026#39;) const SunPanelTOCDomStyleId = `#${SunPanelTOCDomIdName}` style.textContent = ` ${SunPanelTOCDomStyleId} #toc-mobile-btn { top: 20px !important; left: 20px !important; position: fixed; width: 46px; height: 46px; background-color: #2a2a2a6b; color: white; border-radius: 0.5rem; display: flex; justify-content: center; align-items: center; cursor: pointer; } ${SunPanelTOCDomStyleId} .hidden { display: none !important; } ${SunPanelTOCDomStyleId} #toc-sidebar { width: 40px; padding: 10px; position: fixed; top: 0; left: 0; height: 100%; overflow: hidden; display: flex; flex-direction: column; justify-content: center; transition: width 0.3s ease, background-color 0.3s ease; border-top-right-radius: 20px; border-bottom-right-radius: 20px; background-color: none; } ${SunPanelTOCDomStyleId} .toc-mobile-btn-svg-container{ width:21px; height:21px; } ${SunPanelTOCDomStyleId} .toc-sidebar-expansion { width: 200px !important; display: flex; background-color: rgb(42 42 42 / 90%); box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2); } ${SunPanelTOCDomStyleId} #toc-sidebar .toc-sidebar-box { width: 500px; } ${SunPanelTOCDomStyleId} .title-bar-box { display: flex; align-items: center; position: relative; cursor: pointer; } ${SunPanelTOCDomStyleId} .title-bar-slip { width: 20px; height: 6px; background-color: white; border-radius: 4px; margin: 15px 0; transition: height 0.3s ease, width 0.3s ease; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5); } ${SunPanelTOCDomStyleId} .title-bar-title { opacity: 0; white-space: nowrap; transition: opacity 0.3s ease, transform 0.3s ease, margin-left 0.3s ease; font-size: 14px; color: white; } ${SunPanelTOCDomStyleId} .toc-sidebar-expansion .title-bar-title { opacity: 1; margin-left: 10px; } ${SunPanelTOCDomStyleId} .toc-sidebar-expansion .title-bar-slip { box-shadow: none; } ${SunPanelTOCDomStyleId} .toc-sidebar-expansion .title-bar-box:hover .title-bar-slip { width: 40px; } ${SunPanelTOCDomStyleId} .toc-sidebar-expansion .title-bar-box:hover .title-bar-title { font-size: 20px; } ` // æ·»åŠ æ ·å¼åˆ°æ–‡æ¡£å¤´éƒ¨ SunPanelTOCDom.appendChild(style) // ========= Add style end ========= // æ·»åŠ ç§»åŠ¨ç«¯èœå•æŒ‰é’® const tocMobileBtn = document.createElement(\u0026#39;div\u0026#39;) tocMobileBtn.id = \u0026#39;toc-mobile-btn\u0026#39; tocMobileBtn.classList.add(\u0026#39;backdrop-blur-[2px]\u0026#39;) SunPanelTOCDom.appendChild(tocMobileBtn) const tocMobileBtnSvgcContainer = document.createElement(\u0026#39;div\u0026#39;) tocMobileBtnSvgcContainer.innerHTML = svgTocMobileBtn tocMobileBtnSvgcContainer.classList.add(\u0026#39;toc-mobile-btn-svg-container\u0026#39;) tocMobileBtn.appendChild(tocMobileBtnSvgcContainer) // åˆ›å»ºä¾§è¾¹æ å®¹å™¨ const sidebar = document.createElement(\u0026#39;div\u0026#39;) sidebar.id = \u0026#39;toc-sidebar\u0026#39; const sidebarBox = document.createElement(\u0026#39;div\u0026#39;) sidebarBox.className = \u0026#39;toc-sidebar-box\u0026#39; // æŸ¥è¯¢å‡ºæ‰€æœ‰ç±»ååŒ…å« item-group-index- çš„å…ƒç´  const items = document.querySelectorAll(\u0026#39;[class*=\u0026#34;item-group-index-\u0026#34;]\u0026#39;) // éå†å¹¶æ‰“å°æ¯ä¸ªå…ƒç´ çš„å®Œæ•´ç±»å items.forEach((item) =\u0026gt; { item.classList.forEach((className) =\u0026gt; { if (className.startsWith(\u0026#39;item-group-index-\u0026#39;)) { const titleBarBox = document.createElement(\u0026#39;div\u0026#39;) titleBarBox.className = \u0026#39;title-bar-box\u0026#39; // titleBarBox.href = `#${item.id}` titleBarBox.dataset.groupClassName = className // ç›®å½•æ¡ const titleBarSlip = document.createElement(\u0026#39;div\u0026#39;) titleBarSlip.className = \u0026#39;title-bar-slip\u0026#39; // åˆ›å»ºä¸€ä¸ªé“¾æ¥ const titleBarTitle = document.createElement(\u0026#39;div\u0026#39;) titleBarTitle.className = \u0026#39;title-bar-title\u0026#39; // è·å–å­å…ƒç´ ä¸­ class=\u0026#34;group-title\u0026#34; çš„å†…å®¹ const titleElement = item.querySelector(\u0026#39;.group-title\u0026#39;) const titleText = titleElement ? titleElement.textContent : item.id titleBarTitle.textContent = titleText titleBarBox.appendChild(titleBarSlip) titleBarBox.appendChild(titleBarTitle) sidebarBox.appendChild(titleBarBox) } }) }) sidebar.appendChild(sidebarBox) // å°†ä¾§è¾¹æ æ·»åŠ åˆ°é¡µé¢ä¸­ SunPanelTOCDom.appendChild(sidebar) function mobileHideSidebar() { sidebar.classList.remove(\u0026#39;toc-sidebar-expansion\u0026#39;) sidebar.classList.add(\u0026#39;hidden\u0026#39;) } function hideSidebar() { sidebar.classList.remove(\u0026#39;toc-sidebar-expansion\u0026#39;) } function showSidebar() { sidebar.classList.add(\u0026#39;toc-sidebar-expansion\u0026#39;) sidebar.classList.remove(\u0026#39;hidden\u0026#39;) } // ---------------- // ç›‘å¬å®½åº¦å˜åŒ–å¼€å§‹ // ---------------- function debounce(func, wait) { let timeout return function (...args) { clearTimeout(timeout) timeout = setTimeout(() =\u0026gt; { func.apply(this, args) }, wait) } } function handleResize() { if (isMobile()) { tocMobileBtn.classList.remove(\u0026#39;hidden\u0026#39;) sidebar.classList.add(\u0026#39;hidden\u0026#39;) } else { tocMobileBtn.classList.add(\u0026#39;hidden\u0026#39;) sidebar.classList.remove(\u0026#39;hidden\u0026#39;) } } // ä½¿ç”¨é˜²æŠ–å‡½æ•°åŒ…è£…ä½ çš„å¤„ç†å‡½æ•° const debouncedHandleResize = debounce(handleResize, 200) // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ window.addEventListener(\u0026#39;resize\u0026#39;, debouncedHandleResize) // é¦–æ¬¡è§¦å‘ handleResize() // ---------------- // ç›‘å¬å®½åº¦å˜åŒ–ç»“æŸ // ---------------- // ç›‘å¬ç§»åŠ¨ç«¯æŒ‰é’®ç‚¹å‡» tocMobileBtn.addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; { if (sidebar.classList.contains(\u0026#39;toc-sidebar-expansion\u0026#39;)) { // éšè— mobileHideSidebar() } else { // æ˜¾ç¤º showSidebar() } }) // ç›‘å¬TOCæ å¤±å»hover sidebar.addEventListener(\u0026#39;mouseleave\u0026#39;, () =\u0026gt; { if (isMobile()) { // éšè— mobileHideSidebar() } else { hideSidebar() } }) // ç›‘å¬TOCæ è·å¾—hover sidebar.addEventListener(\u0026#39;mouseenter\u0026#39;, () =\u0026gt; { showSidebar() }) // ç›‘å¬TOCç‚¹å‡»äº‹ä»¶ document.querySelectorAll(\u0026#39;.title-bar-box\u0026#39;).forEach((box) =\u0026gt; { box.addEventListener(\u0026#39;click\u0026#39;, function (event) { // æ£€æŸ¥è§¦å‘äº‹ä»¶çš„å…ƒç´ æ˜¯å¦æœ‰ \u0026#39;data-groupClassName\u0026#39; å±æ€§ if (this.dataset.groupClassName) { // è·å– \u0026#39;data-groupClass\u0026#39; å±æ€§çš„å€¼ const groupClassName = this.dataset.groupClassName // ä½¿ç”¨å±æ€§å€¼ä½œä¸ºé€‰æ‹©å™¨æŸ¥è¯¢å¯¹åº”çš„å…ƒç´  const targetElement = document.querySelector(`.${groupClassName}`) if (targetElement) { // è·å–ç›®æ ‡å…ƒç´ çš„ \u0026#39;top\u0026#39; åæ ‡ const targetTop = targetElement.offsetTop const scrollContainerElement = document.querySelector(scrollContainerElementClassName) if (scrollContainerElement) { scrollContainerElement.scrollTo({ top: targetTop - scrollOffset, behavior: \u0026#39;smooth\u0026#39;, // å¹³æ»‘æ»šåŠ¨ }) } } } }) }) } // åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨åˆ†ç»„ï¼Œä¸å­˜åœ¨å°†å®šæ—¶ç›‘å¬ const items = document.querySelectorAll(\u0026#39;[class*=\u0026#34;item-group-index-\u0026#34;]\u0026#39;) if (items.length \u0026gt; 0) { createDom() return } const interval = setInterval(() =\u0026gt; { const items = document.querySelectorAll(\u0026#39;[class*=\u0026#34;item-group-index-\u0026#34;]\u0026#39;) if (items.length \u0026gt; 0) { createDom() clearInterval(interval) } }, 1000) })() EOF Sun-Panelä¸ªæ€§åŒ–è®¾ç½®\u0026ndash;è‡ªå®šä¹‰é¡µè„šï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ 1 \u0026lt;script src=\u0026#34;/custom/index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; äºŒ ã€é¡µé¢é›ªèŠ±ç‰¹æ•ˆ åˆ›å»ºxuehua.jsæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 touch /mnt/mydisk/home/sun-panel/config/custom/xuehua.js \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/home/sun-panel/config/custom/xuehua.js \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; function snow() { // 1ã€å®šä¹‰ä¸€ç‰‡é›ªèŠ±æ¨¡æ¿ var flake = document.createElement(\u0026#39;div\u0026#39;); // å®šä¹‰é›ªèŠ±å­—ç¬¦ â„â‰â…â†âœ»âœ¼â‡âˆâŠâœ¥âœº flake.innerHTML = \u0026#39;â„\u0026#39;; flake.style.cssText = \u0026#39;position:absolute;color:#fff;\u0026#39;; //è·å–é¡µé¢çš„é«˜åº¦ ç›¸å½“äºé›ªèŠ±ä¸‹è½ç»“æŸæ—¶Yè½´çš„ä½ç½® var documentHieght = window.innerHeight; //è·å–é¡µé¢çš„å®½åº¦ï¼Œåˆ©ç”¨è¿™ä¸ªæ•°æ¥ç®—å‡ºï¼Œé›ªèŠ±å¼€å§‹æ—¶leftçš„å€¼ var documentWidth = window.innerWidth; //å®šä¹‰ç”Ÿæˆä¸€ç‰‡é›ªèŠ±çš„æ¯«ç§’æ•°ï¼Œä¸å»ºè®®ä½äº100 var millisec =200; //2ã€è®¾ç½®ç¬¬ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå‘¨æœŸæ€§å®šæ—¶å™¨ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆmillisecï¼‰ç”Ÿæˆä¸€ç‰‡é›ªèŠ±ï¼› setInterval(function() { //é¡µé¢åŠ è½½ä¹‹åï¼Œå®šæ—¶å™¨å°±å¼€å§‹å·¥ä½œ //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ å¼€å§‹ æ—¶leftçš„å€¼ï¼Œç›¸å½“äºå¼€å§‹æ—¶Xè½´çš„ä½ç½® var startLeft = Math.random() * documentWidth; //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ ç»“æŸ æ—¶leftçš„å€¼ï¼Œç›¸å½“äºç»“æŸæ—¶Xè½´çš„ä½ç½® var endLeft = Math.random() * documentWidth; //éšæœºç”Ÿæˆé›ªèŠ±å¤§å° var flakeSize = 3 + 20 * Math.random(); //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½æŒç»­æ—¶é—´ï¼Œæ—¶é—´è¶Šå¤§ä¸‹è½è¶Šæ…¢ var durationTime = 6000 + 10000 * Math.random(); //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ å¼€å§‹ æ—¶çš„é€æ˜åº¦ var startOpacity = 0.7 + 0.3 * Math.random(); //éšæœºç”Ÿæˆé›ªèŠ±ä¸‹è½ ç»“æŸ æ—¶çš„é€æ˜åº¦ var endOpacity = 0.2 + 0.2 * Math.random(); //å…‹éš†ä¸€ä¸ªé›ªèŠ±æ¨¡æ¿ var cloneFlake = flake.cloneNode(true); //ç¬¬ä¸€æ¬¡ä¿®æ”¹æ ·å¼ï¼Œå®šä¹‰å…‹éš†å‡ºæ¥çš„é›ªèŠ±çš„æ ·å¼ cloneFlake.style.cssText += ` left: ${startLeft}px; opacity: ${startOpacity}; font-size:${flakeSize}px; top:-25px; transition:${durationTime}ms;`; //æ‹¼æ¥åˆ°é¡µé¢ä¸­ document.body.appendChild(cloneFlake); //è®¾ç½®ç¬¬äºŒä¸ªå®šæ—¶å™¨ï¼Œä¸€æ¬¡æ€§å®šæ—¶å™¨ï¼Œ //å½“ç¬¬ä¸€ä¸ªå®šæ—¶å™¨ç”Ÿæˆé›ªèŠ±ï¼Œå¹¶åœ¨é¡µé¢ä¸Šæ¸²æŸ“å‡ºæ¥åï¼Œä¿®æ”¹é›ªèŠ±çš„æ ·å¼ï¼Œè®©é›ªèŠ±åŠ¨èµ·æ¥ï¼› setTimeout(function() { //ç¬¬äºŒæ¬¡ä¿®æ”¹æ ·å¼ cloneFlake.style.cssText += ` left: ${endLeft}px; top:${documentHieght}px; opacity:${endOpacity};`; //4ã€è®¾ç½®ç¬¬ä¸‰ä¸ªå®šæ—¶å™¨ï¼Œå½“é›ªèŠ±è½ä¸‹åï¼Œåˆ é™¤é›ªèŠ±ã€‚ setTimeout(function() { cloneFlake.remove(); }, durationTime); }, 0); }, millisec); } snow(); EOF Sun-Panelä¸ªæ€§åŒ–è®¾ç½®\u0026ndash;è‡ªå®šä¹‰é¡µè„šï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ 1 \u0026lt;script src=\u0026#34;/custom/xuehua.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ä¸‰ ã€mp4è§†é¢‘å£çº¸ åˆ›å»ºjsæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 touch /mnt/mydisk/home/sun-panel/config/custom/mp4.js \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/home/sun-panel/config/custom/mp4.js \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, (event) =\u0026gt; { // ç”¨äºæ·»åŠ è§†é¢‘èƒŒæ™¯çš„å‡½æ•° const addVideoBackground = (wallpaperDiv) =\u0026gt; { // åˆ›å»ºvideoå…ƒç´  const video = document.createElement(\u0026#39;video\u0026#39;); // è®¾ç½®è§†é¢‘å±æ€§ video.autoplay = true; // ä½¿ç”¨å±æ€§è€Œä¸æ˜¯setAttributeï¼Œå› ä¸ºautoplayæ˜¯ä¸€ä¸ªå¸ƒå°”å±æ€§ video.loop = true; video.muted = true; video.playsInline = true; // æ³¨æ„è¿™é‡Œæ˜¯é©¼å³°å¼å†™æ³•ï¼Œä½†åœ¨HTMLä¸­åº”ä½¿ç”¨playsinline // åº”ç”¨CSSæ ·å¼åˆ°videoå…ƒç´  video.style.position = \u0026#39;absolute\u0026#39;; video.style.top = \u0026#39;0\u0026#39;; video.style.left = \u0026#39;0\u0026#39;; video.style.width = \u0026#39;100%\u0026#39;; video.style.height = \u0026#39;100%\u0026#39;; video.style.objectFit = \u0026#39;cover\u0026#39;; // å®šä¹‰å¤šä¸ªè§†é¢‘æº const videoSources = [ \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-01.mp4\u0026#39;, \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-02.mp4\u0026#39;, \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-03.mp4\u0026#39;, \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-04.mp4\u0026#39;, \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-05.mp4\u0026#39;, // \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-06.mp4\u0026#39;, // \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-07.mp4\u0026#39;, // \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-08.mp4\u0026#39;, // \u0026#39;/uploads/%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8-09.mp4\u0026#39; // åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šçš„è§†é¢‘æº ]; // ä»è§†é¢‘æºæ•°ç»„ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª const randomSource = videoSources[Math.floor(Math.random() * videoSources.length)]; // åˆ›å»ºsourceå…ƒç´ å¹¶è®¾ç½®éšæœºé€‰æ‹©çš„è§†é¢‘æº const source = document.createElement(\u0026#39;source\u0026#39;); source.src = randomSource; source.type = \u0026#39;video/mp4\u0026#39;; // å°†sourceå…ƒç´ æ·»åŠ åˆ°videoå…ƒç´ ä¸­ video.appendChild(source); // ç›‘å¬è§†é¢‘åŠ è½½å…ƒæ•°æ®äº‹ä»¶ï¼Œå°è¯•æ’­æ”¾è§†é¢‘ video.addEventListener(\u0026#39;loadedmetadata\u0026#39;, () =\u0026gt; { video.play().catch((error) =\u0026gt; { // å¦‚æœæ’­æ”¾å¤±è´¥ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚æ˜¾ç¤ºä¸€ä¸ªå¤‡ç”¨å›¾ç‰‡æˆ–æ¶ˆæ¯ console.error(\u0026#39;è§†é¢‘æ’­æ”¾å¤±è´¥:\u0026#39;, error); }); }); // å°†videoå…ƒç´ æ·»åŠ åˆ°æŒ‡å®šçš„wallpaperDivä¸­ wallpaperDiv.appendChild(video); }; // ä½¿ç”¨MutationObserverç›‘è§†DOMå˜åŒ– const observer = new MutationObserver((mutationsList, observer) =\u0026gt; { // æŸ¥æ‰¾åŒ¹é…çš„.cover.wallpaperå…ƒç´  const wallpaperDiv = document.querySelector(\u0026#39;.cover.wallpaper\u0026#39;); if (wallpaperDiv \u0026amp;\u0026amp; !wallpaperDiv.querySelector(\u0026#39;video\u0026#39;)) { // æ·»åŠ è§†é¢‘èƒŒæ™¯ addVideoBackground(wallpaperDiv); // æ³¨æ„ï¼šæˆ‘ä»¬ä¸å†æ–­å¼€è§‚å¯Ÿè€…ï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿç»§ç»­ç›‘è§†æœªæ¥çš„å˜åŒ– } }); // å¯åŠ¨è§‚å¯Ÿè€…ç›‘è§†document.bodyçš„å˜åŒ– observer.observe(document.body, { childList: true, subtree: true }); }); EOF Sun-Panelä¸ªæ€§åŒ–è®¾ç½®\u0026ndash;è‡ªå®šä¹‰é¡µè„šï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ 1 \u0026lt;script src=\u0026#34;/custom/mp4.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; å›› ã€ç‚¹å‡»ç‰¹æ•ˆ-æ•£å¼€ åˆ›å»ºjsæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 touch /mnt/mydisk/home/sun-panel/config/custom/dianji.js \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/home/sun-panel/config/custom/dianji.js \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; class Circle { constructor({ origin, speed, color, angle, context }) { this.origin = origin; // åˆå§‹ä½ç½® this.position = { ...this.origin }; // å½“å‰ä½ç½® this.color = color; // é¢œè‰² this.speed = speed; // é€Ÿåº¦ this.angle = angle; // è§’åº¦ this.context = context; // ç»˜åˆ¶ä¸Šä¸‹æ–‡ this.renderCount = 0; // æ¸²æŸ“è®¡æ•° } draw() { // ç»˜åˆ¶åœ†å½¢ this.context.fillStyle = this.color; this.context.beginPath(); this.context.arc(this.position.x, this.position.y, 2, 0, Math.PI * 2); this.context.fill(); } move() { // ç§»åŠ¨åœ†å½¢ this.position.x = (Math.sin(this.angle) * this.speed) + this.position.x; this.position.y = (Math.cos(this.angle) * this.speed) + this.position.y + (this.renderCount * 0.3); this.renderCount++; } } class Boom { constructor({ origin, context, circleCount = 10, area }) { this.origin = origin; // åˆå§‹ä½ç½® this.context = context; // ç»˜åˆ¶ä¸Šä¸‹æ–‡ this.circleCount = circleCount; // åœ†å½¢æ•°é‡ this.area = area; // åŒºåŸŸ this.stop = false; // åœæ­¢æ ‡å¿— this.circles = []; // åœ†å½¢æ•°ç»„ } randomArray(range) { // ä»æ•°ç»„ä¸­éšæœºå–å€¼ const length = range.length; const randomIndex = Math.floor(length * Math.random()); return range[randomIndex]; } randomColor() { // éšæœºç”Ÿæˆé¢œè‰² const range = [\u0026#39;8\u0026#39;, \u0026#39;9\u0026#39;, \u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;, \u0026#39;C\u0026#39;, \u0026#39;D\u0026#39;, \u0026#39;E\u0026#39;, \u0026#39;F\u0026#39;]; return \u0026#39;#\u0026#39; + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) + this.randomArray(range); } randomRange(start, end) { // åœ¨èŒƒå›´å†…ç”Ÿæˆéšæœºæ•° return (end - start) * Math.random() + start; } init() { // åˆå§‹åŒ–Boomå¯¹è±¡ for (let i = 0; i \u0026lt; this.circleCount; i++) { const circle = new Circle({ context: this.context, origin: this.origin, color: this.randomColor(), angle: this.randomRange(Math.PI - 1, Math.PI + 1), speed: this.randomRange(1, 6) }); this.circles.push(circle); } } move() { // ç§»åŠ¨æ‰€æœ‰åœ†å½¢ï¼Œå¹¶æ£€æµ‹æ˜¯å¦è¶…å‡ºåŒºåŸŸ this.circles.forEach((circle, index) =\u0026gt; { if (circle.position.x \u0026gt; this.area.width || circle.position.y \u0026gt; this.area.height) { return this.circles.splice(index, 1); } circle.move(); }); if (this.circles.length === 0) { this.stop = true; } } draw() { // ç»˜åˆ¶æ‰€æœ‰åœ†å½¢ this.circles.forEach(circle =\u0026gt; circle.draw()); } } class CursorSpecialEffects { constructor() { // é¼ æ ‡ç‰¹æ•ˆä¸»ç±» this.computerCanvas = document.createElement(\u0026#39;canvas\u0026#39;); // è®¡ç®—ç”¨Canvas this.renderCanvas = document.createElement(\u0026#39;canvas\u0026#39;); // æ¸²æŸ“ç”¨Canvas this.computerContext = this.computerCanvas.getContext(\u0026#39;2d\u0026#39;); // è®¡ç®—ç”¨ä¸Šä¸‹æ–‡ this.renderContext = this.renderCanvas.getContext(\u0026#39;2d\u0026#39;); // æ¸²æŸ“ç”¨ä¸Šä¸‹æ–‡ this.globalWidth = window.innerWidth; // å…¨å±€å®½åº¦ this.globalHeight = window.innerHeight; // å…¨å±€é«˜åº¦ this.booms = []; // Boomå¯¹è±¡æ•°ç»„ this.running = false; // è¿è¡Œæ ‡å¿— } handleMouseDown(e) { // å¤„ç†é¼ æ ‡ç‚¹å‡»äº‹ä»¶ const boom = new Boom({ origin: { x: e.clientX, y: e.clientY }, context: this.computerContext, area: { width: this.globalWidth, height: this.globalHeight } }); boom.init(); this.booms.push(boom); this.running || this.run(); } handlePageHide() { // å¤„ç†é¡µé¢éšè—äº‹ä»¶ this.booms = []; this.running = false; } init() { // åˆå§‹åŒ–æ–¹æ³• const style = this.renderCanvas.style; style.position = \u0026#39;fixed\u0026#39;; style.top = style.left = 0; style.zIndex = \u0026#39;999999999999999999999999999999999999999999\u0026#39;; style.pointerEvents = \u0026#39;none\u0026#39;; style.width = this.renderCanvas.width = this.computerCanvas.width = this.globalWidth; style.height = this.renderCanvas.height = this.computerCanvas.height = this.globalHeight; document.body.append(this.renderCanvas); window.addEventListener(\u0026#39;mousedown\u0026#39;, this.handleMouseDown.bind(this)); window.addEventListener(\u0026#39;pagehide\u0026#39;, this.handlePageHide.bind(this)); } run() { // è¿è¡Œæ–¹æ³• this.running = true; if (this.booms.length === 0) { return this.running = false; } requestAnimationFrame(this.run.bind(this)); this.computerContext.clearRect(0, 0, this.globalWidth, this.globalHeight); this.renderContext.clearRect(0, 0, this.globalWidth, this.globalHeight); this.booms.forEach((boom, index) =\u0026gt; { if (boom.stop) { return this.booms.splice(index, 1); } boom.move(); boom.draw(); }); this.renderContext.drawImage(this.computerCanvas, 0, 0, this.globalWidth, this.globalHeight); } } const cursorSpecialEffects = new CursorSpecialEffects(); cursorSpecialEffects.init(); EOF Sun-Panelä¸ªæ€§åŒ–è®¾ç½®\u0026ndash;è‡ªå®šä¹‰é¡µè„šï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ 1 \u0026lt;script src=\u0026#34;/custom/dianji.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; äº” ã€ç‚¹å‡»ç‰¹æ•ˆ-çƒŸèŠ± ç‚¹å‡»çƒŸèŠ±æ•ˆæœjsæ’ä»¶åœ°å€ï¼šhttps://github.com/hslr-s/sun-panel-js-plugins/tree/master/clickFireworksEffects åˆ›å»ºyanhua.jsæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 touch /mnt/mydisk/home/sun-panel/config/custom/index.js \u0026amp;\u0026amp; cat \u0026gt; /mnt/mydisk/home/sun-panel/config/custom/yanhua.js \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; function clickFireworksEffects() { let balls = []; let longPressed = false; let longPress; let multiplier = 0; let width, height; let origin; let normal; let ctx; const colours = [\u0026#34;#F73859\u0026#34;, \u0026#34;#14FFEC\u0026#34;, \u0026#34;#00E0FF\u0026#34;, \u0026#34;#FF99FE\u0026#34;, \u0026#34;#FAF15D\u0026#34;]; const canvas = document.createElement(\u0026#34;canvas\u0026#34;); document.body.appendChild(canvas); canvas.setAttribute(\u0026#34;style\u0026#34;, \u0026#34;width: 100%; height: 100%; top: 0; left: 0; z-index: 99999; position: fixed; pointer-events: none;\u0026#34;); const pointer = document.createElement(\u0026#34;span\u0026#34;); pointer.classList.add(\u0026#34;pointer\u0026#34;); document.body.appendChild(pointer); if (canvas.getContext \u0026amp;\u0026amp; window.addEventListener) { ctx = canvas.getContext(\u0026#34;2d\u0026#34;); updateSize(); window.addEventListener(\u0026#39;resize\u0026#39;, updateSize, false); loop(); window.addEventListener(\u0026#34;mousedown\u0026#34;, function(e) { pushBalls(randBetween(10, 20), e.clientX, e.clientY); document.body.classList.add(\u0026#34;is-pressed\u0026#34;); longPress = setTimeout(function(){ document.body.classList.add(\u0026#34;is-longpress\u0026#34;); longPressed = true; }, 500); }, false); window.addEventListener(\u0026#34;mouseup\u0026#34;, function(e) { clearInterval(longPress); if (longPressed == true) { document.body.classList.remove(\u0026#34;is-longpress\u0026#34;); pushBalls(randBetween(50 + Math.ceil(multiplier), 100 + Math.ceil(multiplier)), e.clientX, e.clientY); longPressed = false; } document.body.classList.remove(\u0026#34;is-pressed\u0026#34;); }, false); window.addEventListener(\u0026#34;mousemove\u0026#34;, function(e) { let x = e.clientX; let y = e.clientY; pointer.style.top = y + \u0026#34;px\u0026#34;; pointer.style.left = x + \u0026#34;px\u0026#34;; }, false); } else { console.log(\u0026#34;canvas or addEventListener is unsupported!\u0026#34;); } function updateSize() { canvas.width = window.innerWidth * 2; canvas.height = window.innerHeight * 2; canvas.style.width = window.innerWidth + \u0026#39;px\u0026#39;; canvas.style.height = window.innerHeight + \u0026#39;px\u0026#39;; ctx.scale(2, 2); width = (canvas.width = window.innerWidth); height = (canvas.height = window.innerHeight); origin = { x: width / 2, y: height / 2 }; normal = { x: width / 2, y: height / 2 }; } class Ball { constructor(x = origin.x, y = origin.y) { this.x = x; this.y = y; this.angle = Math.PI * 2 * Math.random(); if (longPressed == true) { this.multiplier = randBetween(14 + multiplier, 15 + multiplier); } else { this.multiplier = randBetween(6, 12); } this.vx = (this.multiplier + Math.random() * 0.5) * Math.cos(this.angle); this.vy = (this.multiplier + Math.random() * 0.5) * Math.sin(this.angle); this.r = randBetween(8, 12) + 3 * Math.random(); this.color = colours[Math.floor(Math.random() * colours.length)]; } update() { this.x += this.vx - normal.x; this.y += this.vy - normal.y; normal.x = -2 / window.innerWidth * Math.sin(this.angle); normal.y = -2 / window.innerHeight * Math.cos(this.angle); this.r -= 0.3; this.vx *= 0.9; this.vy *= 0.9; } } function pushBalls(count = 1, x = origin.x, y = origin.y) { for (let i = 0; i \u0026lt; count; i++) { balls.push(new Ball(x, y)); } } function randBetween(min, max) { return Math.floor(Math.random() * max) + min; } function loop() { ctx.fillStyle = \u0026#34;rgba(255, 255, 255, 0)\u0026#34;; ctx.clearRect(0, 0, canvas.width, canvas.height); for (let i = 0; i \u0026lt; balls.length; i++) { let b = balls[i]; if (b.r \u0026lt; 0) continue; ctx.fillStyle = b.color; ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2, false); ctx.fill(); b.update(); } if (longPressed == true) { multiplier += 0.2; } else if (!longPressed \u0026amp;\u0026amp; multiplier \u0026gt;= 0) { multiplier -= 0.4; } removeBall(); requestAnimationFrame(loop); } function removeBall() { for (let i = 0; i \u0026lt; balls.length; i++) { let b = balls[i]; if (b.x + b.r \u0026lt; 0 || b.x - b.r \u0026gt; width || b.y + b.r \u0026lt; 0 || b.y - b.r \u0026gt; height || b.r \u0026lt; 0) { balls.splice(i, 1); } } } } clickFireworksEffects();//è°ƒç”¨ç‰¹æ•ˆå‡½æ•° EOF Sun-Panelä¸ªæ€§åŒ–è®¾ç½®\u0026ndash;è‡ªå®šä¹‰é¡µè„šï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ 1 \u0026lt;script src=\u0026#34;/custom/yanhua.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; æµè§ˆå™¨æ¸…ç©ºç¼“å­˜ï¼Œåˆ·æ–°åè§æ•ˆæœ ","date":"2024-12-07T16:13:51+08:00","image":"https://file.meimolihan.eu.org/img/docker-sun-panel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/78f12ce9/","title":"Sun-Panel jsæºç "},{"content":"LXC å®¹å™¨ä¸­ç›´é€š Intel æ ¸å¿ƒæ˜¾å¡ ğŸ–¥ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸŒŸ æ¦‚è¿°ä¸ç‰¹ç‚¹ ğŸ“‹ å‰ææ¡ä»¶ ğŸ”§ é…ç½®æ­¥éª¤ ğŸ–¥ï¸ æ£€æŸ¥å®¿ä¸»æœºæ˜¾å¡çŠ¶æ€ ğŸ“¦ åˆ›å»ºæˆ–é€‰æ‹© LXC å®¹å™¨ âš™ï¸ é…ç½® LXC å®¹å™¨ç›´é€š ğŸ”„ é‡å¯ LXC å®¹å™¨ âœ… éªŒè¯å®¹å™¨å†…æ˜¾å¡ç›´é€š ğŸ“¥ å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ… ğŸ³ Docker å®¹å™¨ä¸­ä½¿ç”¨ GPU ğŸ”§ å®‰è£… Docker âš™ï¸ é…ç½® Docker ä½¿ç”¨ GPU âœ… éªŒè¯ Docker GPU è®¿é—® ğŸŒ TUN è®¾å¤‡é…ç½®ï¼ˆå¯é€‰ï¼‰ ğŸ› ï¸ æ•…éšœæ’é™¤ ğŸ”’ æƒé™é—®é¢˜ ğŸ’¾ é©±åŠ¨é—®é¢˜ ğŸš€ æ€§èƒ½ä¼˜åŒ– ğŸ“Š æ€§èƒ½æµ‹è¯• ğŸ¬ FFmpeg ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• ğŸ“ˆ ç›‘æ§ GPU ä½¿ç”¨æƒ…å†µ ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ“ å¸¸ç”¨å‘½ä»¤å‚è€ƒ ğŸ“¦ LXC å®¹å™¨ç®¡ç† ğŸ–¥ï¸ GPU çŠ¶æ€æ£€æŸ¥ ğŸŒŸ æ¦‚è¿°ä¸ç‰¹ç‚¹ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Proxmox VE çš„ LXC å®¹å™¨ä¸­ç›´é€š Intel æ ¸å¿ƒæ˜¾å¡ï¼Œä½¿æ‚¨èƒ½å¤Ÿåœ¨ Docker å®¹å™¨ä¸­è½»æ¾ä½¿ç”¨ GPU åŠ é€ŸåŠŸèƒ½ï¼ˆå¦‚ Frigateã€Jellyfin ç­‰åº”ç”¨ï¼‰ã€‚\nâœ¨ ä¸»è¦åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸš€ ç¡¬ä»¶åŠ é€Ÿ: å……åˆ†åˆ©ç”¨ Intel æ ¸æ˜¾è¿›è¡Œè§†é¢‘è½¬ç å’Œå¤„ç† ğŸ”„ èµ„æºéš”ç¦»: åœ¨ä¿æŒå®¹å™¨è½»é‡åŒ–çš„åŒæ—¶äº«å—ç¡¬ä»¶åŠ é€Ÿ ğŸ³ Docker é›†æˆ: æ— ç¼æ”¯æŒ Docker å®¹å™¨ä½¿ç”¨ GPU èµ„æº âš¡ æ€§èƒ½å“è¶Š: ç›¸æ¯”è½¯ä»¶ç¼–ç ï¼Œæ€§èƒ½æå‡æ˜¾è‘— ğŸ”§ é…ç½®çµæ´»: æ”¯æŒå¤šç§åº”ç”¨åœºæ™¯å’Œé…ç½®æ–¹å¼ ğŸ“‹ å‰ææ¡ä»¶ ç¡®ä¿æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nâœ… Proxmox VE å·²å®‰è£…å¹¶æ­£å¸¸è¿è¡Œ âœ… Intel æ ¸å¿ƒæ˜¾å¡ï¼ˆå¦‚ N5105 çš„ UHD Graphicsã€iGPU ç­‰ï¼‰ âœ… å·²åˆ›å»º LXC å®¹å™¨ï¼ˆæœ¬æŒ‡å—ä»¥å®¹å™¨ ID 110 ä¸ºä¾‹ï¼‰ âœ… ç³»ç»Ÿå·²æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ ğŸ”§ é…ç½®æ­¥éª¤ ğŸ–¥ï¸ æ£€æŸ¥å®¿ä¸»æœºæ˜¾å¡çŠ¶æ€ 1 2 # æŸ¥çœ‹æ˜¾å¡è®¾å¤‡ä¿¡æ¯ lspci | grep VGA é¢„æœŸè¾“å‡ºï¼š\n1 00:02.0 VGA compatible controller: Intel Corporation JasperLake [UHD Graphics] (rev 01) 1 2 # æ£€æŸ¥é©±åŠ¨æ˜¯å¦æ­£ç¡®åŠ è½½ ls /dev/dri/ é¢„æœŸè¾“å‡ºï¼š\n1 by-path card0 renderD128 ğŸ“¦ åˆ›å»ºæˆ–é€‰æ‹© LXC å®¹å™¨ åœ¨ PVE Web ç•Œé¢ä¸­ï¼š\nåˆ›å»ºæ–°çš„ LXC å®¹å™¨æˆ–é€‰æ‹©ç°æœ‰å®¹å™¨ é‡è¦: å–æ¶ˆå‹¾é€‰ \u0026ldquo;æ— ç‰¹æƒå®¹å™¨\u0026rdquo;ï¼ˆåˆ›å»ºç‰¹æƒå®¹å™¨ï¼‰ é€‰æ‹©é€‚åˆçš„æ¨¡æ¿ï¼ˆæ¨è Ubuntu æˆ– Debianï¼‰ è®°ä¸‹å®¹å™¨ IDï¼ˆæœ¬ä¾‹ä¸­ä½¿ç”¨ 110ï¼‰ âš™ï¸ é…ç½® LXC å®¹å™¨ç›´é€š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ç¼–è¾‘ LXC å®¹å™¨é…ç½®æ–‡ä»¶ cat \u0026gt;\u0026gt; /etc/pve/lxc/110.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # å…è®¸å®¹å™¨è®¿é—®è®¾å¤‡ lxc.cgroup2.devices.allow: c 10:200 rwm lxc.cgroup2.devices.allow: c 226:0 rwm lxc.cgroup2.devices.allow: c 226:128 rwm lxc.cgroup2.devices.allow: c 29:0 rwm # æŒ‚è½½è®¾å¤‡åˆ°å®¹å™¨ lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir lxc.mount.entry: /dev/fb0 dev/fb0 none bind,optional,create=file lxc.mount.entry: /dev/net/tun dev/net/tun none bind,optional,create=file # å®‰å…¨é…ç½® lxc.apparmor.profile: unconfined lxc.cgroup.devices.allow: a lxc.cap.drop: EOF ğŸ”„ é‡å¯ LXC å®¹å™¨ 1 2 3 4 5 # é‡å¯å®¹å™¨ä½¿é…ç½®ç”Ÿæ•ˆ pct stop 110 \u0026amp;\u0026amp; pct start 110 # æŸ¥çœ‹å¯åŠ¨çŠ¶æ€ pct status 110 âœ… éªŒè¯å®¹å™¨å†…æ˜¾å¡ç›´é€š è¿›å…¥å®¹å™¨å¹¶éªŒè¯ï¼š\n1 2 3 4 5 6 7 8 9 # è¿›å…¥å®¹å™¨ pct enter 110 # æ£€æŸ¥è®¾å¤‡æ˜¯å¦å­˜åœ¨ ls -la /dev/dri/ # æ£€æŸ¥ PCI è®¾å¤‡ï¼ˆéœ€è¦å®‰è£… pciutilsï¼‰ apt update \u0026amp;\u0026amp; apt install -y pciutils lspci | grep VGA é¢„æœŸè¾“å‡ºï¼š\n1 2 card0 renderD128 00:02.0 VGA compatible controller: Intel Corporation JasperLake [UHD Graphics] (rev 01) ğŸ“¥ å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ… åœ¨å®¹å™¨å†…å®‰è£… GPU ç›¸å…³å·¥å…·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # æ›´æ–°å¹¶å®‰è£…å·¥å…· apt update \u0026amp;\u0026amp; apt install -y \\ intel-gpu-tools \\ va-driver-all \\ vainfo \\ ffmpeg \\ mesa-utils # éªŒè¯ VA-API åŠŸèƒ½ vainfo # æ£€æŸ¥ OpenGL æ”¯æŒ glxinfo -B | grep -E \u0026#34;(OpenGL|Renderer)\u0026#34; ğŸ³ Docker å®¹å™¨ä¸­ä½¿ç”¨ GPU ğŸ”§ å®‰è£… Docker åœ¨ LXC å®¹å™¨å†…å®‰è£… Dockerï¼š\n1 2 3 4 5 6 7 8 9 10 # å®‰è£… Docker curl -fsSL https://get.docker.com -o get-docker.sh sh get-docker.sh # æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ usermod -aG docker $USER newgrp docker # éªŒè¯å®‰è£… docker version âš™ï¸ é…ç½® Docker ä½¿ç”¨ GPU åˆ›å»º Docker å®¹å™¨æ—¶æŒ‚è½½ GPU è®¾å¤‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # docker-compose.yml ç¤ºä¾‹ï¼ˆJellyfinï¼‰ version: \u0026#39;3.8\u0026#39; services: jellyfin: image: jellyfin/jellyfin container_name: jellyfin privileged: true network_mode: host restart: unless-stopped devices: - /dev/dri/renderD128:/dev/dri/renderD128 - /dev/dri/card0:/dev/dri/card0 volumes: - ./config:/config - ./cache:/cache - /path/to/media:/media:ro environment: - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility âœ… éªŒè¯ Docker GPU è®¿é—® 1 2 3 4 5 6 7 8 9 # è¿è¡Œæµ‹è¯•å®¹å™¨éªŒè¯ GPU è®¿é—® docker run --rm --device=/dev/dri/renderD128 \\ intel/vaapi:latest vainfo # æµ‹è¯• FFmpeg ç¡¬ä»¶åŠ é€Ÿ docker run --rm --device=/dev/dri/renderD128 \\ jrottenberg/ffmpeg:vaapi \\ -hwaccel vaapi -hwaccel_device /dev/dri/renderD128 \\ -i input.mp4 -c:v h264_vaapi -b:v 5M output.mp4 ğŸŒ TUN è®¾å¤‡é…ç½®ï¼ˆå¯é€‰ï¼‰ å¦‚æœéœ€è¦ä½¿ç”¨ VPN æˆ–ç½‘ç»œå·¥å…·ï¼Œè¿˜éœ€é…ç½® TUN è®¾å¤‡ï¼š\n1 2 3 4 5 6 # æ·»åŠ  TUN è®¾å¤‡æ”¯æŒåˆ° LXC é…ç½® echo \u0026#34;lxc.cgroup2.devices.allow: c 10:200 rwm\u0026#34; \u0026gt;\u0026gt; /etc/pve/lxc/110.conf echo \u0026#34;lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file\u0026#34; \u0026gt;\u0026gt; /etc/pve/lxc/110.conf # é‡å¯å®¹å™¨ç”Ÿæ•ˆ pct restart 110 ğŸ› ï¸ æ•…éšœæ’é™¤ ğŸ”’ æƒé™é—®é¢˜ å¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼Œå°è¯•åœ¨å®¹å™¨å†…ä¿®å¤ï¼š\n1 2 3 4 5 6 7 8 9 10 # æ›´æ”¹è®¾å¤‡æƒé™ chmod 666 /dev/dri/renderD128 chmod 666 /dev/dri/card0 # æˆ–è€…æ·»åŠ ç”¨æˆ·åˆ°è§†é¢‘ç»„ usermod -aG video $USER newgrp video # æ£€æŸ¥ç”¨æˆ·ç»„ groups $USER ğŸ’¾ é©±åŠ¨é—®é¢˜ å¦‚æœæ˜¾å¡æœªæ­£ç¡®è¯†åˆ«ï¼Œå®‰è£… Intel é©±åŠ¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # å¯¹äº Ubuntu/Debian ç³»ç»Ÿ apt install -y \\ intel-media-va-driver-non-free \\ libmfx1 \\ libva-drm2 \\ libva-x11-2 # è®¾ç½®ç¯å¢ƒå˜é‡ echo \u0026#39;export LIBVA_DRIVER_NAME=iHD\u0026#39; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#39;export DEVICE_DRIVER_NAME=iHD\u0026#39; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc ğŸš€ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 # åœ¨å®¿ä¸»æœºä¸Šè®¾ç½® GPU é¢‘ç‡ governor echo performance \u0026gt; /sys/class/drm/card0/device/power_dpm_force_performance_level # æ£€æŸ¥å½“å‰é¢‘ç‡æ¨¡å¼ cat /sys/class/drm/card0/device/power_dpm_force_performance_level # åœ¨å®¹å™¨å†…è®¾ç½®ç¯å¢ƒå˜é‡ä¼˜åŒ–æ€§èƒ½ export VAAPI_MPEG4_ENABLED=true export VAAPI_MPEG2_ENABLED=true ğŸ“Š æ€§èƒ½æµ‹è¯• ğŸ¬ FFmpeg ç¡¬ä»¶åŠ é€Ÿæµ‹è¯• 1 2 3 4 5 6 7 8 9 # æµ‹è¯•è§†é¢‘è½¬ç æ€§èƒ½ ffmpeg -hwaccel vaapi -hwaccel_device /dev/dri/renderD128 \\ -hwaccel_output_format vaapi \\ -i input.mp4 -c:v h264_vaapi -b:v 5M -maxrate 5M -bufsize 10M \\ -vf \u0026#39;format=nv12|vaapi,hwupload\u0026#39; output.mp4 # æŸ¥çœ‹ç¼–ç ä¿¡æ¯ ffmpeg -hwaccel vaapi -hwaccel_device /dev/dri/renderD128 \\ -i input.mp4 -c:v h264_vaapi -b:v 5M -f null - 2\u0026gt;\u0026amp;1 | grep -E \u0026#34;(fps|speed)\u0026#34; ğŸ“ˆ ç›‘æ§ GPU ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 # å®æ—¶ç›‘æ§ GPU ä½¿ç”¨ intel_gpu_top # æŸ¥çœ‹ GPU é¢‘ç‡ cat /sys/class/drm/card0/device/gt_cur_freq_mhz # ç›‘æ§æ¸©åº¦ cat /sys/class/drm/card0/device/hwmon/hwmon*/temp1_input ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ” å®¹å™¨æƒé™: ç‰¹æƒå®¹å™¨å…·æœ‰è¾ƒé«˜æƒé™ï¼Œè¯·ä»…åœ¨å¯ä¿¡ç¯å¢ƒä½¿ç”¨ ğŸ“Š èµ„æºé™åˆ¶: è®¾ç½®é€‚å½“çš„ CPUã€å†…å­˜å’Œ GPU èµ„æºé™åˆ¶ ğŸŒ ç½‘ç»œéš”ç¦»: è€ƒè™‘ä½¿ç”¨å•ç‹¬çš„ç½‘ç»œå‘½åç©ºé—´å’Œé˜²ç«å¢™è§„åˆ™ ğŸ”„ å®šæœŸæ›´æ–°: ä¿æŒé©±åŠ¨ã€å†…æ ¸å’Œå®¹å™¨è½¯ä»¶æœ€æ–°çŠ¶æ€ ğŸ“ æ—¥å¿—ç›‘æ§: å¯ç”¨å¹¶å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼Œç›‘æ§å¼‚å¸¸æ´»åŠ¨ 1 2 3 4 5 # è®¾ç½®èµ„æºé™åˆ¶ç¤ºä¾‹ pct set 110 -memory 2048 -cores 2 -mpool 0.5 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ pct status 110 ğŸ“ å¸¸ç”¨å‘½ä»¤å‚è€ƒ ğŸ“¦ LXC å®¹å™¨ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ pct list # è¿›å…¥å®¹å™¨æ§åˆ¶å° pct enter 110 # é‡å¯å®¹å™¨ pct restart 110 # æŸ¥çœ‹å®¹å™¨é…ç½® pct config 110 # å¤‡ä»½å®¹å™¨ pct shutdown 110 \u0026amp;\u0026amp; vzdump 110 --mode stop --compress zstd ğŸ–¥ï¸ GPU çŠ¶æ€æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹ GPU ä¿¡æ¯ intel_gpu_frequency # æ£€æŸ¥ VA-API åŠŸèƒ½ vainfo --display drm --device /dev/dri/renderD128 # æŸ¥çœ‹é©±åŠ¨ä¿¡æ¯ modinfo i915 # æ£€æŸ¥ GPU è´Ÿè½½ cat /sys/class/drm/card0/device/gpu_busy_percent # æŸ¥çœ‹æ˜¾å­˜ä¿¡æ¯ cat /sys/class/drm/card0/device/mem_info_vram_total cat /sys/class/drm/card0/device/mem_info_vram_used é€šè¿‡éµå¾ªæœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨ Proxmox VE çš„ LXC å®¹å™¨ä¸­æˆåŠŸç›´é€š Intel æ ¸å¿ƒæ˜¾å¡ï¼Œå¹¶åœ¨ Docker å®¹å™¨ä¸­ä½¿ç”¨ GPU åŠ é€ŸåŠŸèƒ½ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚ğŸ¯\nğŸ’¡ å°è´´å£« ğŸ”„ å®šæœŸæ›´æ–° Intel æ˜¾å¡é©±åŠ¨ä»¥è·å¾—æœ€ä½³æ€§èƒ½ ğŸ“Š ä½¿ç”¨ç›‘æ§å·¥å…·è§‚å¯Ÿ GPU ä½¿ç”¨æƒ…å†µï¼Œåˆç†åˆ†é…èµ„æº ğŸ³ è€ƒè™‘ä½¿ç”¨ Docker èµ„æºé™åˆ¶é¿å…å•ä¸ªå®¹å™¨å ç”¨å…¨éƒ¨ GPU èµ„æº ğŸ”§ æ ¹æ®å…·ä½“åº”ç”¨è°ƒæ•´ç¼–ç å‚æ•°å’Œç¡¬ä»¶åŠ é€Ÿè®¾ç½® ","date":"2024-12-07T16:09:57+08:00","image":"https://file.meimolihan.eu.org/img/pve-Intel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/3ca633be/","title":"LXC å®¹å™¨ä¸­ç›´é€š Intel æ ¸å¿ƒæ˜¾å¡ ğŸ–¥ï¸"},{"content":"Proxmox VE è‡ªå®šä¹‰ LXC å®¹å™¨æ¨¡æ¿åˆ›å»ºæŒ‡å— ğŸ³ ğŸš€ åˆ›å»ºå¯é‡å¤ä½¿ç”¨çš„è‡ªå®šä¹‰å®¹å™¨æ¨¡æ¿ï¼Œå¤§å¹…æé«˜éƒ¨ç½²æ•ˆç‡ï¼\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ æ¨¡æ¿åˆ›å»ºæµç¨‹æ¦‚è§ˆ ğŸ“¦ åˆ›å»ºåŸºç¡€å®¹å™¨ ğŸ–¥ï¸ é€šè¿‡Webç•Œé¢åˆ›å»º âŒ¨ï¸ é€šè¿‡å‘½ä»¤è¡Œåˆ›å»º ğŸš€ å¯åŠ¨å®¹å™¨ âš™ï¸ å®¹å™¨åˆå§‹åŒ–é…ç½® ğŸ”§ ç³»ç»Ÿæ›´æ–°ä¸åŸºç¡€é…ç½® ğŸ³ Dockerå®‰è£…ï¼ˆå¯é€‰ï¼‰ ğŸŒ ç½‘ç»œé…ç½® ğŸ§¹ æ¸…ç†å®¹å™¨ ğŸ—‘ï¸ æ¸…ç†ç³»ç»Ÿæ–‡ä»¶ ğŸ”„ é‡ç½®ç³»ç»Ÿé…ç½® ğŸ“¦ æ¸…ç†ç”¨æˆ·æ•°æ® ğŸ’¾ å¤‡ä»½ä¸æ¨¡æ¿åˆ¶ä½œ ğŸ“¤ åˆ›å»ºå¤‡ä»½ ğŸ¯ è½¬æ¢ä¸ºæ¨¡æ¿ ğŸ“‹ éªŒè¯æ¨¡æ¿ ğŸš€ ä½¿ç”¨æ¨¡æ¿åˆ›å»ºå®¹å™¨ ğŸ–¥ï¸ Webç•Œé¢åˆ›å»º âŒ¨ï¸ å‘½ä»¤è¡Œåˆ›å»º ğŸ”§ é«˜çº§é…ç½® âš¡ ç‰¹æƒå®¹å™¨é…ç½® ğŸ”„ åº”ç”¨é…ç½® ğŸ“Š æ€§èƒ½ä¼˜åŒ–é…ç½® ğŸ’¡ æœ€ä½³å®è·µ ğŸ“ æ¨¡æ¿ç®¡ç† ğŸ”„ å®šæœŸæ›´æ–°æ¨¡æ¿ ğŸ“Š æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶ ğŸ›¡ï¸ å®‰å…¨å»ºè®® ğŸš€ å¿«é€Ÿéƒ¨ç½²ç¤ºä¾‹ ğŸ¯ æ¨¡æ¿åˆ›å»ºæµç¨‹æ¦‚è§ˆ 1 2 3 4 5 6 7 graph TD A[åˆ›å»ºåŸºç¡€LXCå®¹å™¨] --\u0026gt; B[åˆå§‹åŒ–é…ç½®] B --\u0026gt; C[å®‰è£…æ‰€éœ€è½¯ä»¶] C --\u0026gt; D[æ¸…ç†å®¹å™¨] D --\u0026gt; E[å¤‡ä»½å®¹å™¨] E --\u0026gt; F[è½¬æ¢ä¸ºæ¨¡æ¿] F --\u0026gt; G[ä½¿ç”¨æ¨¡æ¿åˆ›å»ºæ–°å®¹å™¨] ğŸ“¦ åˆ›å»ºåŸºç¡€å®¹å™¨ ğŸ–¥ï¸ é€šè¿‡Webç•Œé¢åˆ›å»º ç™»å½•PVEç®¡ç†ç•Œé¢ é€‰æ‹©èŠ‚ç‚¹ â†’ åˆ›å»ºCT é€‰æ‹©Ubuntuæ¨¡æ¿ï¼ˆå¦‚ï¼šubuntu-22.04-standardï¼‰ é…ç½®åŸºæœ¬å‚æ•°ï¼š å®¹å™¨IDï¼š110 ä¸»æœºåï¼štemplate-ubuntu å¯†ç ï¼šè®¾ç½®rootå¯†ç  ç£ç›˜ï¼šè‡³å°‘10GB CPUï¼š2æ ¸å¿ƒ å†…å­˜ï¼š1024MB ç½‘ç»œï¼šæŒ‰éœ€é…ç½® âŒ¨ï¸ é€šè¿‡å‘½ä»¤è¡Œåˆ›å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹å¯ç”¨æ¨¡æ¿ pveam available --section system # ä¸‹è½½Ubuntuæ¨¡æ¿ pveam download local ubuntu-22.04-standard_20220601_amd64.tar.zst # åˆ›å»ºå®¹å™¨ pct create 110 \\ local:vztmpl/ubuntu-22.04-standard_20220601_amd64.tar.zst \\ --rootfs local-lvm:10 \\ --ostype ubuntu \\ --hostname template-ubuntu \\ --memory 1024 \\ --swap 512 \\ --cores 2 \\ --password your_secure_password \\ --net0 name=eth0,bridge=vmbr0,ip=dhcp ğŸš€ å¯åŠ¨å®¹å™¨ 1 2 3 4 5 6 7 8 # å¯åŠ¨å®¹å™¨ pct start 110 # æŸ¥çœ‹çŠ¶æ€ pct status 110 # è¿›å…¥å®¹å™¨ pct enter 110 âš™ï¸ å®¹å™¨åˆå§‹åŒ–é…ç½® ğŸ”§ ç³»ç»Ÿæ›´æ–°ä¸åŸºç¡€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # è¿›å…¥å®¹å™¨ pct enter 110 # æ›´æ–°ç³»ç»Ÿ apt update \u0026amp;\u0026amp; apt upgrade -y # å®‰è£…å¸¸ç”¨å·¥å…· apt install -y \\ curl wget vim nano \\ git htop net-tools \\ sudo rsync cron # é…ç½®æ—¶åŒº timedatectl set-timezone Asia/Shanghai # é…ç½®è¯­è¨€ç¯å¢ƒ apt install -y locales locale-gen en_US.UTF-8 zh_CN.UTF-8 ğŸ³ Dockerå®‰è£…ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®‰è£…Docker curl -fsSL https://get.docker.com -o get-docker.sh sh get-docker.sh # é…ç½®Dockerï¼ˆéç‰¹æƒå®¹å™¨éœ€è¦ï¼‰ mkdir -p /etc/docker cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt; EOF { \u0026#34;storage-driver\u0026#34;: \u0026#34;vfs\u0026#34;, \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;10m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;3\u0026#34; } } EOF ğŸŒ ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # é…ç½®SSHï¼ˆå¯é€‰ï¼‰ apt install -y openssh-server sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/\u0026#39; /etc/ssh/sshd_config systemctl restart sshd # é…ç½®é™æ€IPï¼ˆç¤ºä¾‹ï¼‰ cat \u0026gt;\u0026gt; /etc/network/interfaces \u0026lt;\u0026lt; EOF # auto eth0 # iface eth0 inet static # address 192.168.1.100/24 # gateway 192.168.1.1 EOF ğŸ§¹ æ¸…ç†å®¹å™¨ ğŸ—‘ï¸ æ¸…ç†ç³»ç»Ÿæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # æ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜ apt autoremove -y apt clean apt autoclean # æ¸…ç†æ—¥å¿—æ–‡ä»¶ find /var/log -type f -name \u0026#34;*.log\u0026#34; -exec truncate -s 0 {} \\; rm -rf /var/log/*.gz /var/log/*.old /var/log/apt/* # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -rf /tmp/* /var/tmp/* ğŸ”„ é‡ç½®ç³»ç»Ÿé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ¸…é™¤æœºå™¨IDï¼ˆé‡è¦ï¼ï¼‰ rm -f /etc/machine-id /var/lib/dbus/machine-id # æ¸…é™¤ä¸»æœºåé…ç½® rm -f /etc/hostname echo \u0026#34;localhost\u0026#34; \u0026gt; /etc/hostname # æ¸…é™¤DNSé…ç½® rm -f /etc/resolv.conf # æ¸…é™¤SSHä¸»æœºå¯†é’¥ï¼ˆå¦‚æœå®‰è£…äº†SSHï¼‰ rm -f /etc/ssh/ssh_host_* # æ¸…é™¤å‘½ä»¤å†å² history -c rm -f /root/.bash_history # æ¸…é™¤APTåˆ—è¡¨ rm -rf /var/lib/apt/lists/* ğŸ“¦ æ¸…ç†ç”¨æˆ·æ•°æ® 1 2 3 4 5 6 # æ¸…ç†ç”¨æˆ·æ–‡ä»¶ rm -rf /root/.cache /root/.npm /root/.docker # æ¸…ç†ç³»ç»Ÿç¼“å­˜ sync echo 3 \u0026gt; /proc/sys/vm/drop_caches ğŸ’¾ å¤‡ä»½ä¸æ¨¡æ¿åˆ¶ä½œ ğŸ“¤ åˆ›å»ºå¤‡ä»½ 1 2 3 4 5 6 7 8 # åœæ­¢å®¹å™¨ pct stop 110 # åˆ›å»ºå¤‡ä»½ï¼ˆä¼šç”Ÿæˆåœ¨ /var/lib/vz/dump/ï¼‰ vzdump 110 --compress zstd --mode stop # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ ls -la /var/lib/vz/dump/vzdump-lxc-110-*.tar.zst ğŸ¯ è½¬æ¢ä¸ºæ¨¡æ¿ 1 2 3 4 5 6 7 8 9 # ç§»åŠ¨å¤‡ä»½æ–‡ä»¶åˆ°æ¨¡æ¿ç›®å½• mv /var/lib/vz/dump/vzdump-lxc-110-*.tar.zst \\ /var/lib/vz/template/cache/homelab-ubuntu-22.04-standard.tar.zst # è®¾ç½®æ­£ç¡®çš„æƒé™ chmod 644 /var/lib/vz/template/cache/homelab-ubuntu-22.04-standard.tar.zst # æ›´æ–°æ¨¡æ¿åˆ—è¡¨ pveam update ğŸ“‹ éªŒè¯æ¨¡æ¿ 1 2 3 4 5 # æŸ¥çœ‹å¯ç”¨æ¨¡æ¿ pveam list local # åº”è¯¥èƒ½çœ‹åˆ°æ–°åˆ›å»ºçš„æ¨¡æ¿ # homelab-ubuntu-22.04-standard.tar.zst ğŸš€ ä½¿ç”¨æ¨¡æ¿åˆ›å»ºå®¹å™¨ ğŸ–¥ï¸ Webç•Œé¢åˆ›å»º åˆ›å»ºæ–°CTå®¹å™¨ é€‰æ‹©æ¨¡æ¿ï¼šhomelab-ubuntu-22.04-standard é…ç½®å®¹å™¨å‚æ•° å¯åŠ¨å¹¶éªŒè¯ âŒ¨ï¸ å‘½ä»¤è¡Œåˆ›å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿åˆ›å»ºæ–°å®¹å™¨ pct create 111 \\ local:vztmpl/homelab-ubuntu-22.04-standard.tar.zst \\ --rootfs local-lvm:10 \\ --ostype ubuntu \\ --hostname my-app \\ --memory 2048 \\ --cores 2 \\ --net0 name=eth0,bridge=vmbr0,ip=dhcp # å¯åŠ¨å®¹å™¨ pct start 111 # è¿›å…¥å®¹å™¨éªŒè¯ pct exec 111 -- hostname pct exec 111 -- apt list --installed | wc -l ğŸ”§ é«˜çº§é…ç½® âš¡ ç‰¹æƒå®¹å™¨é…ç½® 1 2 3 4 # ç¼–è¾‘å®¹å™¨é…ç½®æ–‡ä»¶ nano /etc/pve/lxc/111.conf # æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼‰ ğŸ¯ å®Œæ•´ç‰¹æƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cat \u0026gt;\u0026gt; /etc/pve/lxc/111.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # è®¾å¤‡æƒé™é…ç½® lxc.cgroup2.devices.allow: c 10:200 rwm lxc.cgroup2.devices.allow: c 226:0 rwm lxc.cgroup2.devices.allow: c 226:128 rwm lxc.cgroup2.devices.allow: c 29:0 rwm # è®¾å¤‡æŒ‚è½½ç‚¹ lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir lxc.mount.entry: /dev/fb0 dev/fb0 none bind,optional,create=file lxc.mount.entry: /dev/net/tun dev/net/tun none bind,optional,create=file # å®‰å…¨é…ç½® lxc.apparmor.profile: unconfined lxc.cgroup.devices.allow: a lxc.cap.drop: EOF ğŸ”„ åº”ç”¨é…ç½® 1 2 3 4 5 # é‡å¯å®¹å™¨ä½¿é…ç½®ç”Ÿæ•ˆ pct restart 111 # éªŒè¯é…ç½® pct config 111 ğŸ“Š æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 # æ·»åŠ CPUå’Œå†…å­˜é™åˆ¶ echo \u0026#34;lxc.cgroup2.cpu.max: 200000 1000000\u0026#34; \u0026gt;\u0026gt; /etc/pve/lxc/111.conf echo \u0026#34;lxc.cgroup2.memory.max: 2147483648\u0026#34; \u0026gt;\u0026gt; /etc/pve/lxc/111.conf echo \u0026#34;lxc.cgroup2.memory.swap.max: 1073741824\u0026#34; \u0026gt;\u0026gt; /etc/pve/lxc/111.conf ğŸ’¡ æœ€ä½³å®è·µ ğŸ“ æ¨¡æ¿ç®¡ç† 1 2 3 4 5 6 7 8 # åˆ›å»ºæ¨¡æ¿ç®¡ç†è„šæœ¬ cat \u0026gt; /usr/local/bin/manage-templates.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash # æ¨¡æ¿ç®¡ç†è„šæœ¬ echo \u0026#34;å¯ç”¨æ¨¡æ¿:\u0026#34; pveam list local | grep homelab EOF chmod +x /usr/local/bin/manage-templates.sh ğŸ”„ å®šæœŸæ›´æ–°æ¨¡æ¿ 1 2 3 4 5 6 7 8 # åˆ›å»ºæ¨¡æ¿æ›´æ–°è„šæœ¬ cat \u0026gt; /etc/cron.weekly/update-templates \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash # æ¯å‘¨æ›´æ–°åŸºç¡€æ¨¡æ¿ pveam update apt update \u0026amp;\u0026amp; apt upgrade -y EOF chmod +x /etc/cron.weekly/update-templates ğŸ“Š æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 # ä½¿ç”¨æ—¥æœŸæ ‡è®°æ¨¡æ¿ç‰ˆæœ¬ BACKUP_DATE=$(date +%Y%m%d) mv homelab-ubuntu-22.04-standard.tar.zst \\ homelab-ubuntu-22.04-standard_${BACKUP_DATE}.tar.zst ğŸ›¡ï¸ å®‰å…¨å»ºè®® 1 2 3 4 5 6 7 # æ¨¡æ¿å®‰å…¨æ£€æŸ¥æ¸…å•ï¼š # âœ… æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ… # âœ… æ›´æ”¹é»˜è®¤å¯†ç  # âœ… ç§»é™¤ä¸å¿…è¦çš„æœåŠ¡ # âœ… é…ç½®é˜²ç«å¢™è§„åˆ™ # âœ… ç¦ç”¨root SSHç™»å½•ï¼ˆå¦‚é€‚ç”¨ï¼‰ # âœ… é…ç½®æ—¥å¿—è½®è½¬ ğŸš€ å¿«é€Ÿéƒ¨ç½²ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 # æ‰¹é‡åˆ›å»ºå®¹å™¨çš„ç¤ºä¾‹è„šæœ¬ for i in {112..115}; do pct create $i \\ local:vztmpl/homelab-ubuntu-22.04-standard.tar.zst \\ --rootfs local-lvm:10 \\ --hostname app-$i \\ --memory 1024 \\ --cores 1 done ğŸ¯ æç¤ºï¼šè‡ªå®šä¹‰æ¨¡æ¿å¯ä»¥æ˜¾è‘—æé«˜éƒ¨ç½²æ•ˆç‡ï¼Œä½†è®°å¾—å®šæœŸæ›´æ–°æ¨¡æ¿ä»¥åŒ…å«æœ€æ–°çš„å®‰å…¨è¡¥ä¸ã€‚å»ºè®®ä¸ºä¸åŒçš„ç”¨é€”åˆ›å»ºä¸“é—¨çš„æ¨¡æ¿ï¼ˆå¦‚ï¼šWebæœåŠ¡å™¨æ¨¡æ¿ã€æ•°æ®åº“æ¨¡æ¿ç­‰ï¼‰ã€‚\nâœ¨ æ¨¡æ¿åˆ›å»ºçš„ä¼˜åŠ¿ âš¡ å¿«é€Ÿéƒ¨ç½²: å‡ åˆ†é’Ÿå†…å³å¯éƒ¨ç½²é¢„é…ç½®çš„å®¹å™¨ ğŸ”§ ä¸€è‡´æ€§: ç¡®ä¿æ‰€æœ‰å®¹å™¨å…·æœ‰ç›¸åŒçš„é…ç½®å’Œç¯å¢ƒ ğŸ“Š å¯é‡å¤æ€§: å‡å°‘äººä¸ºé”™è¯¯ï¼Œæé«˜éƒ¨ç½²å¯é æ€§ ğŸ›¡ï¸ å®‰å…¨æ€§: å¯ä»¥é¢„å…ˆé…ç½®å®‰å…¨è®¾ç½®å’Œæ›´æ–° ğŸ“¦ æ ‡å‡†åŒ–: ä¿ƒè¿›å›¢é˜Ÿåä½œå’Œè¿ç»´æ ‡å‡†åŒ– ğŸ“š æ‰©å±•é˜…è¯»ï¼š\nPVE LXCå®¹å™¨æ–‡æ¡£ LXCé…ç½®å‚æ•° å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é«˜æ•ˆåˆ›å»ºå’Œç®¡ç†PVE LXCå®¹å™¨æ¨¡æ¿ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚ğŸš€\n","date":"2024-12-07T16:09:14+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/1b97a613/","title":"Proxmox VE è‡ªå®šä¹‰ LXC å®¹å™¨æ¨¡æ¿åˆ›å»º ğŸ³"},{"content":"Proxmox VE å®‰è£…ä¸é…ç½® LXC å®¹å™¨ ğŸ§ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»åœ¨ Proxmox VE (PVE) ä¸­å®‰è£…å’Œé…ç½® LXC å®¹å™¨çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æ¨¡æ¿æ¢æºã€å®¹å™¨åˆ›å»ºå’Œæ ¸æ˜¾ç›´é€šç­‰é«˜çº§é…ç½®ï¼ŒåŠ©æ‚¨é«˜æ•ˆéƒ¨ç½²è½»é‡çº§å®¹å™¨ç¯å¢ƒã€‚\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ æ¦‚è¿° ğŸ“‹ å‰ææ¡ä»¶ ğŸ”„ ä¸€ã€CT æ¨¡æ¿æ¢æº ğŸ“¦ äºŒã€ä¸‹è½½ CT æ¨¡æ¿ ğŸ› ï¸ ä¸‰ã€åˆ›å»º LXC å®¹å™¨ âš™ï¸ å››ã€å®¹å™¨åˆå§‹åŒ–é…ç½® ğŸ® äº”ã€æ ¸æ˜¾ç›´é€šé…ç½® âœ… å…­ã€æ ¸æ˜¾ç›´é€šéªŒè¯ ğŸ³ ä¸ƒã€Docker å®‰è£…ä¸é…ç½® ğŸš€ å…«ã€ä½¿ç”¨ Terraform ç®¡ç† LXC å®¹å™¨ ğŸ’¡ æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜ âœ¨ æ¦‚è¿° LXC (Linux Containers) æ˜¯ä¸€ç§è½»é‡çº§æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå…è®¸åœ¨å•ä¸ª Linux ä¸»æœºä¸Šè¿è¡Œå¤šä¸ªéš”ç¦»çš„ Linux ç³»ç»Ÿï¼ˆå®¹å™¨ï¼‰ã€‚ç›¸æ¯”å®Œæ•´è™šæ‹Ÿæœº (KVM)ï¼ŒLXC å®¹å™¨å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nâš¡ é«˜æ€§èƒ½ï¼šæ¥è¿‘åŸç”Ÿç³»ç»Ÿçš„æ€§èƒ½è¡¨ç° ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼šç§’çº§å¯åŠ¨å’Œåœæ­¢ ğŸ’¾ ä½èµ„æºå¼€é”€ï¼šå†…å­˜å’Œç£ç›˜å ç”¨æ›´å°‘ ğŸ—ï¸ è‰¯å¥½éš”ç¦»æ€§ï¼šæä¾›è¿›ç¨‹ã€ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿéš”ç¦» ğŸ”§ çµæ´»é…ç½®ï¼šå¯ç²¾ç»†æ§åˆ¶èµ„æºåˆ†é…å’Œè®¾å¤‡è®¿é—® åœ¨ Proxmox VE (PVE) ä¸­ä½¿ç”¨ LXC å®¹å™¨éå¸¸é€‚åˆéƒ¨ç½²å„ç§åº”ç”¨ï¼Œå¦‚ï¼š\nğŸ³ Docker ç¯å¢ƒï¼šä½œä¸º Docker å®¿ä¸»ç¯å¢ƒè¿è¡Œå®¹å™¨åŒ–åº”ç”¨ ğŸŒ Web æœåŠ¡å™¨ï¼šéƒ¨ç½² Nginxã€Apache ç­‰ Web æœåŠ¡ ğŸ—„ï¸ æ•°æ®åº“æœåŠ¡ï¼šè¿è¡Œ MySQLã€PostgreSQL ç­‰æ•°æ®åº“ ğŸ“¦ åº”ç”¨æµ‹è¯•ä¸å¼€å‘ï¼šæä¾›éš”ç¦»çš„å¼€å‘æµ‹è¯•ç¯å¢ƒ ğŸ“º åª’ä½“æœåŠ¡å™¨ï¼šå®‰è£… Jellyfinã€Plex ç­‰åª’ä½“æœåŠ¡ ğŸ¤– è‡ªåŠ¨åŒ–å·¥å…·ï¼šè¿è¡Œ Home Assistantã€Node-RED ç­‰æ™ºèƒ½å®¶å±…å¹³å° ğŸ“‹ å‰ææ¡ä»¶ åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nâœ… å·²å®‰è£… Proxmox VEï¼šå»ºè®®ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼ˆå¦‚ PVE 8.xï¼‰ âœ… ç½‘ç»œè¿æ¥ï¼šPVE ä¸»æœºå¯è®¿é—®äº’è”ç½‘ä»¥ä¸‹è½½æ¨¡æ¿å’Œè½¯ä»¶åŒ… âœ… å­˜å‚¨ç©ºé—´ï¼šè‡³å°‘æœ‰ 10GB ä»¥ä¸Šçš„å¯ç”¨ç£ç›˜ç©ºé—´ç”¨äºå®¹å™¨å­˜å‚¨ âœ… æƒé™ï¼šå…·æœ‰ PVE å®¿ä¸»æœºçš„ root è®¿é—®æƒé™ âœ… åŸºç¡€çŸ¥è¯†ï¼šäº†è§£ Linux åŸºæœ¬å‘½ä»¤å’Œç½‘ç»œæ¦‚å¿µ ğŸ”„ ä¸€ã€CT æ¨¡æ¿æ¢æº âš ï¸ æ³¨æ„ï¼šä¸ºäº†åœ¨å›½å†…è·å¾—æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ï¼Œå»ºè®®å°†é»˜è®¤çš„ CT æ¨¡æ¿æºæ›¿æ¢ä¸ºå›½å†…é•œåƒæºï¼ˆå¦‚æ¸…åå¤§å­¦é•œåƒç«™ï¼‰ã€‚\n1. å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back 2. æ›¿æ¢ä¸ºå›½å†…é•œåƒæºï¼ˆæ¸…åå¤§å­¦é•œåƒç«™ï¼‰ 1 sed -i \u0026#39;s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g\u0026#39; /usr/share/perl5/PVE/APLInfo.pm 3. é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ 1 systemctl restart pvedaemon.service æç¤ºï¼šæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–å›½å†…é•œåƒæºï¼Œå¦‚ä¸­ç§‘å¤§é•œåƒæºï¼ˆhttps://mirrors.ustc.edu.cn/proxmox/ï¼‰ã€‚\nğŸ“¦ äºŒã€ä¸‹è½½ CT æ¨¡æ¿ 1. æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ¨¡æ¿ 1 pveam available --section system 2. ä¸‹è½½æŒ‡å®šæ¨¡æ¿ï¼ˆä»¥ Ubuntu 22.04 ä¸ºä¾‹ï¼‰ 1 pveam download local ubuntu-22.04-standard_22.04-1_amd64.tar.zst 3. æŸ¥çœ‹å·²ä¸‹è½½æ¨¡æ¿ 1 pveam list local æç¤ºï¼šæ¨¡æ¿ä¸‹è½½é€Ÿåº¦ç»æ¢æºåé€šå¸¸ä¼šå¤§å¹…æå‡ã€‚æ‚¨ä¹Ÿå¯ä»¥ä¸‹è½½å…¶ä»–ç³»ç»Ÿæ¨¡æ¿ï¼Œå¦‚ Debianã€CentOS æˆ– Alpine Linuxã€‚\nğŸ› ï¸ ä¸‰ã€åˆ›å»º LXC å®¹å™¨ æ‚¨å¯ä»¥é€šè¿‡ Web ç•Œé¢æˆ–å‘½ä»¤è¡Œåˆ›å»º LXC å®¹å™¨ã€‚\né€šè¿‡ Web ç•Œé¢åˆ›å»º ç™»å½• PVE ç®¡ç†ç•Œé¢ é€‰æ‹©èŠ‚ç‚¹ â†’ ç‚¹å‡»\u0026quot;åˆ›å»ºCT\u0026quot; å¡«å†™å®¹å™¨åŸºæœ¬ä¿¡æ¯ï¼š å®¹å™¨ IDï¼šå”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ 102ï¼‰ ä¸»æœºåï¼šå®¹å™¨çš„ä¸»æœºåï¼ˆå¦‚ my-containerï¼‰ å¯†ç ï¼šè®¾ç½® root ç”¨æˆ·å¯†ç  æ— ç‰¹æƒçš„å®¹å™¨ï¼šå–æ¶ˆå‹¾é€‰ï¼ˆå¦‚éœ€ä½¿ç”¨ç‰¹æƒå®¹å™¨ï¼Œä¾‹å¦‚ä¸ºäº†è¿è¡Œ Dockerï¼‰ é€‰æ‹©\u0026quot;æ¨¡æ¿\u0026quot;ï¼š å­˜å‚¨ï¼šé€‰æ‹©å­˜å‚¨ä½ç½®ï¼ˆå¦‚ localï¼‰ æ¨¡æ¿ï¼šé€‰æ‹©å·²ä¸‹è½½çš„æ¨¡æ¿ï¼ˆå¦‚ Ubuntu 22.04ï¼‰ é…ç½®\u0026quot;ç£ç›˜\u0026quot;ï¼š å­˜å‚¨ï¼šé€‰æ‹©ç£ç›˜å­˜å‚¨ä½ç½®ï¼ˆå¦‚ local-lvmï¼‰ ç£ç›˜å¤§å° (GB)ï¼šæ ¹æ®éœ€æ±‚è®¾ç½®ï¼ˆå¦‚ 50ï¼‰ é…ç½®\u0026quot;CPU\u0026quot;ï¼š æ ¸å¿ƒæ•°ï¼šåˆ†é… CPU æ ¸å¿ƒæ•°é‡ï¼ˆå¦‚ 4ï¼‰ é…ç½®\u0026quot;å†…å­˜\u0026quot;ï¼š å†…å­˜ (MiB)ï¼šåˆ†é…å†…å­˜å¤§å°ï¼ˆå¦‚ 2048ï¼‰ äº¤æ¢ (MiB)ï¼šåˆ†é…äº¤æ¢ç©ºé—´å¤§å°ï¼ˆå¦‚ 2048ï¼‰ é…ç½®\u0026quot;ç½‘ç»œ\u0026quot;ï¼š IPv4/CIDRï¼šè®¾ç½®é™æ€ IPï¼ˆå¦‚ 192.168.1.2/24ï¼‰æˆ–é€‰æ‹© DHCP æ¡¥æ¥ï¼šé€‰æ‹©ç½‘ç»œæ¡¥æ¥ï¼ˆå¦‚ vmbr0ï¼‰ ç½‘å…³ (IPv4)ï¼šè®¾ç½®ç½‘å…³åœ°å€ï¼ˆå¦‚ 192.168.1.1ï¼‰ ç‚¹å‡»\u0026quot;å®Œæˆ\u0026quot;åˆ›å»ºå®¹å™¨ã€‚ é€šè¿‡å‘½ä»¤è¡Œåˆ›å»º 1 2 3 4 5 6 7 8 9 10 pct create \u0026lt;CT_ID\u0026gt; \\ local:vztmpl/\u0026lt;template_name\u0026gt;.tar.zst \\ --rootfs local-lvm:\u0026lt;disk_size\u0026gt; \\ --ostype \u0026lt;os_type\u0026gt; \\ --hostname \u0026lt;hostname\u0026gt; \\ --memory \u0026lt;memory_size\u0026gt; \\ --swap \u0026lt;swap_size\u0026gt; \\ --cores \u0026lt;cpu_cores\u0026gt; \\ --password \u0026lt;root_password\u0026gt; \\ --net0 name=eth0,bridge=vmbr0,ip=\u0026lt;ip_address\u0026gt;/\u0026lt;cidr\u0026gt;,gw=\u0026lt;gateway\u0026gt; ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 pct create 102 \\ local:vztmpl/ubuntu-22.04-standard_22.04-1_amd64.tar.zst \\ --rootfs local-lvm:50 \\ --ostype ubuntu \\ --hostname my-container \\ --memory 2048 \\ --swap 2048 \\ --cores 4 \\ --password my_secure_password \\ --net0 name=eth0,bridge=vmbr0,ip=192.168.1.2/24,gw=192.168.1.1 âš™ï¸ å››ã€å®¹å™¨åˆå§‹åŒ–é…ç½® å®¹å™¨åˆ›å»ºåï¼Œå¯åŠ¨å¹¶è¿›å…¥å®¹å™¨è¿›è¡Œåˆå§‹åŒ–è®¾ç½®ã€‚\n1 2 3 4 5 # å¯åŠ¨å®¹å™¨ pct start \u0026lt;CT_ID\u0026gt; # è¿›å…¥å®¹å™¨æ§åˆ¶å° pct enter \u0026lt;CT_ID\u0026gt; åœ¨å®¹å™¨å†…ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\næ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…å¸¸ç”¨å·¥å…·ï¼š\n1 2 apt update \u0026amp;\u0026amp; apt upgrade -y apt install -y curl wget vim nano git htop net-tools sudo rsync cron é…ç½®æ—¶åŒºï¼š\n1 timedatectl set-timezone Asia/Shanghai (å¯é€‰) é…ç½® SSH æœåŠ¡ï¼š\n1 2 3 apt install -y openssh-server sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/\u0026#39; /etc/ssh/sshd_config systemctl restart sshd ğŸ® äº”ã€æ ¸æ˜¾ç›´é€šé…ç½® ğŸ’¡ å¦‚æœéœ€è¦åœ¨ LXC å®¹å™¨å†…ä½¿ç”¨å®¿ä¸»æœºçš„ Intel æ ¸æ˜¾è¿›è¡Œç¡¬ä»¶åŠ é€Ÿï¼ˆä¾‹å¦‚ç”¨äº Jellyfinã€Plex åª’ä½“è½¬ç ï¼Œæˆ– Frigate AI è®¡ç®—ï¼‰ï¼Œéœ€è¦è¿›è¡Œæ ¸æ˜¾ç›´é€šé…ç½®ã€‚\n1. æ£€æŸ¥å®¿ä¸»æœºæ˜¾å¡è®¾å¤‡ä¿¡æ¯ 1 2 lspci | grep VGA ls -l /dev/dri è®°ä¸‹è®¾å¤‡ä¿¡æ¯ï¼ˆå¦‚ card0 å’Œ renderD128ï¼‰ã€‚\n2. ç¼–è¾‘å®¹å™¨é…ç½®æ–‡ä»¶ï¼ˆä»¥å®¹å™¨ ID 102 ä¸ºä¾‹ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 cat \u0026gt;\u0026gt; /etc/pve/lxc/102.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # è®¾å¤‡æƒé™é…ç½® lxc.cgroup2.devices.allow: c 226:0 rwm lxc.cgroup2.devices.allow: c 226:128 rwm # è®¾å¤‡æŒ‚è½½é…ç½® (æ–¹æ³•ä¸€ï¼šä½¿ç”¨ mknod å’ŒæŒ‚è½½è„šæœ¬) # éœ€è¦é…åˆ autodev å’Œ hook è„šæœ¬ä½¿ç”¨ lxc.autodev: 1 lxc.hook.autodev: /var/lib/lxc/102/mount_hook.sh # å®‰å…¨é…ç½® lxc.apparmor.profile: unconfined lxc.cgroup2.devices.allow: a lxc.cap.drop: EOF æˆ–è€…ï¼Œä½¿ç”¨å¦ä¸€ç§æŒ‚è½½æ–¹å¼ï¼ˆæ–¹æ³•äºŒï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 cat \u0026gt;\u0026gt; /etc/pve/lxc/102.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # è®¾å¤‡æƒé™é…ç½® lxc.cgroup2.devices.allow: c 226:0 rwm lxc.cgroup2.devices.allow: c 226:128 rwm # è®¾å¤‡æŒ‚è½½é…ç½® (æ–¹æ³•äºŒï¼šç›´æ¥ç»‘å®šæŒ‚è½½) lxc.mount.entry: /dev/dri/card0 dev/dri/card0 none bind,optional,create=file lxc.mount.entry: /dev/dri/renderD128 dev/dri/renderD128 none bind,optional,create=file # å®‰å…¨é…ç½® lxc.apparmor.profile: unconfined lxc.cgroup2.devices.allow: a lxc.cap.drop: EOF 3. (å¦‚æœä½¿ç”¨æ–¹æ³•ä¸€) åˆ›å»ºæŒ‚è½½è„šæœ¬ åˆ›å»ºæ–‡ä»¶ /var/lib/lxc/102/mount_hook.sh å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 #!/bin/bash mkdir -p ${LXC_ROOTFS_MOUNT}/dev/dri mknod -m 666 ${LXC_ROOTFS_MOUNT}/dev/dri/card0 c 226 0 mknod -m 666 ${LXC_ROOTFS_MOUNT}/dev/dri/renderD128 c 226 128 ç„¶åèµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼š\n1 chmod +x /var/lib/lxc/102/mount_hook.sh 4. é‡å¯å®¹å™¨ä½¿é…ç½®ç”Ÿæ•ˆ 1 pct restart 102 âœ… å…­ã€æ ¸æ˜¾ç›´é€šéªŒè¯ è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ŒéªŒè¯æ ¸æ˜¾è®¾å¤‡æ˜¯å¦å·²æˆåŠŸæŒ‚è½½å¹¶å¯è®¿é—®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 # è¿›å…¥å®¹å™¨ pct enter 102 # æ£€æŸ¥ /dev/dri ç›®å½• ls -l /dev/dri # å®‰è£…éªŒè¯å·¥å…·ï¼ˆå¯é€‰ï¼‰ apt update \u0026amp;\u0026amp; apt install -y vainfo intel-gpu-tools # æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯ï¼ˆå¦‚æœé©±åŠ¨å·²å®‰è£…ï¼‰ vainfo å¦‚æœé…ç½®æˆåŠŸï¼Œls -l /dev/dri åº”èƒ½çœ‹åˆ° card0 å’Œ renderD128 è®¾å¤‡æ–‡ä»¶ã€‚\nğŸ³ ä¸ƒã€Docker å®‰è£…ä¸é…ç½® åœ¨ LXC å®¹å™¨å†…å®‰è£… Docker ä¾¿äºè¿è¡Œå®¹å™¨åŒ–åº”ç”¨ã€‚\n1. å®‰è£… Docker 1 2 3 4 5 6 7 8 9 # è¿›å…¥å®¹å™¨ pct enter \u0026lt;CT_ID\u0026gt; # å®‰è£… Docker curl -fsSL https://get.docker.com -o get-docker.sh sh get-docker.sh # æ·»åŠ ç”¨æˆ·åˆ° docker ç»„ï¼ˆä¾‹å¦‚å½“å‰ç”¨æˆ· rootï¼‰ usermod -aG docker root 2. (éç‰¹æƒå®¹å™¨å¯èƒ½éœ€è¦) é…ç½® Docker å­˜å‚¨é©±åŠ¨ 1 2 3 4 5 6 7 mkdir -p /etc/docker cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt; EOF { \u0026#34;storage-driver\u0026#34;: \u0026#34;vfs\u0026#34; } EOF systemctl restart docker 3. å®‰è£… Docker Compose 1 2 curl -L \u0026#34;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose 4. éªŒè¯ Docker å®‰è£… 1 2 docker version docker run hello-world ğŸš€ å…«ã€ä½¿ç”¨ Terraform ç®¡ç† LXC å®¹å™¨ å¯¹äºéœ€è¦è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç†å¤§é‡åŸºç¡€è®¾æ–½çš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ Terraform åŠå…¶ Proxmox Provider æ¥ä»¥ä»£ç  (IaC) çš„æ–¹å¼ç®¡ç† LXC å®¹å™¨ã€‚\n1. åŸºæœ¬ Terraform é…ç½®ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ª main.tf æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 terraform { required_providers { proxmox = { source = \u0026#34;telmate/proxmox\u0026#34; version = \u0026#34;~\u0026gt; 2.9.0\u0026#34; } } } provider \u0026#34;proxmox\u0026#34; { pm_tls_insecure = true pm_api_url = \u0026#34;https://your-pve-server:8006/api2/json\u0026#34; pm_user = \u0026#34;terraform-prov@pve\u0026#34; pm_password = \u0026#34;your_terraform_user_password\u0026#34; # pm_otp = \u0026#34;\u0026#34; # å¦‚æœå¯ç”¨äº†åŒå› ç´ è®¤è¯ } resource \u0026#34;proxmox_lxc\u0026#34; \u0026#34;lxc-example\u0026#34; { target_node = \u0026#34;your-pve-node\u0026#34; hostname = \u0026#34;terraform-lxc\u0026#34; ostemplate = \u0026#34;local:vztmpl/ubuntu-22.04-standard_22.04-1_amd64.tar.zst\u0026#34; password = \u0026#34;container_root_password\u0026#34; unprivileged = false # å¦‚æœå®¹å™¨éœ€è¦ç‰¹æƒåˆ™è®¾ç½®ä¸º false features { nesting = true # å…è®¸åœ¨å®¹å™¨å†…è¿è¡Œ Docker ç­‰å…¶ä»–å®¹å™¨ } rootfs { storage = \u0026#34;local-lvm\u0026#34; size = \u0026#34;50G\u0026#34; } network { name = \u0026#34;eth0\u0026#34; bridge = \u0026#34;vmbr0\u0026#34; ip = \u0026#34;192.168.1.10/24\u0026#34; gw = \u0026#34;192.168.1.1\u0026#34; } cores = 4 memory = 2048 swap = 2048 } 2. åˆå§‹åŒ–å¹¶åº”ç”¨é…ç½® 1 2 3 terraform init terraform plan terraform apply ä½¿ç”¨ Terraform å¯ä»¥è½»æ¾å®ç°å®¹å™¨ç®¡ç†çš„è‡ªåŠ¨åŒ–ã€ç‰ˆæœ¬æ§åˆ¶å’Œå¯é‡å¤æ€§ã€‚\nğŸ’¡ æœ€ä½³å®è·µä¸å¸¸è§é—®é¢˜ ğŸ”§ æœ€ä½³å®è·µ èµ„æºé™åˆ¶ï¼šä¸ºå®¹å™¨è®¾ç½®åˆé€‚çš„ CPUã€å†…å­˜å’Œç£ç›˜é™åˆ¶ï¼Œé¿å…å•ä¸ªå®¹å™¨æ¶ˆè€—è¿‡å¤šä¸»æœºèµ„æºã€‚ å®šæœŸæ›´æ–°ï¼šå®šæœŸæ›´æ–°å®¹å™¨å†…çš„ç³»ç»Ÿå’Œåº”ç”¨è½¯ä»¶ï¼Œä»¥è·å–å®‰å…¨è¡¥ä¸å’Œæ–°åŠŸèƒ½ã€‚ å¤‡ä»½ç­–ç•¥ï¼šä½¿ç”¨ PVE çš„å¤‡ä»½åŠŸèƒ½å®šæœŸå¤‡ä»½é‡è¦å®¹å™¨ã€‚ ä½¿ç”¨éç‰¹æƒå®¹å™¨ï¼šå¦‚æœå®‰å…¨å…è®¸ï¼Œä¼˜å…ˆä½¿ç”¨éç‰¹æƒå®¹å™¨ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚ æ¨¡æ¿åŒ–ç®¡ç†ï¼šåˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿ï¼Œæ ‡å‡†åŒ–å’Œå¿«é€Ÿéƒ¨ç½²å¸¸ç”¨ç¯å¢ƒã€‚ âŒ å¸¸è§é—®é¢˜ å®¹å™¨å¯åŠ¨å¤±è´¥\nåŸå› ï¼šé…ç½®é”™è¯¯ã€èµ„æºä¸è¶³æˆ–æ¨¡æ¿é—®é¢˜ã€‚ è§£å†³ï¼šæ£€æŸ¥å®¹å™¨é…ç½®æ–‡ä»¶ (/etc/pve/lxc/\u0026lt;CT_ID\u0026gt;.conf)ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— (journalctl -xe)ã€‚ ç½‘ç»œæ— æ³•è¿æ¥\nåŸå› ï¼šIP å†²çªã€ç½‘å…³æˆ– DNS é…ç½®é”™è¯¯ã€‚ è§£å†³ï¼šæ£€æŸ¥å®¹å™¨ç½‘ç»œé…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤ç½‘å…³å’Œ DNS æ˜¯å¦å¯è¾¾ã€‚ æ ¸æ˜¾è®¾å¤‡åœ¨å®¹å™¨å†…æ— æ³•è®¿é—®\nåŸå› ï¼šè®¾å¤‡æƒé™ä¸è¶³æˆ–æŒ‚è½½é…ç½®é”™è¯¯ã€‚ è§£å†³ï¼šç¡®è®¤å®¹å™¨æ˜¯å¦ä¸ºç‰¹æƒå®¹å™¨ï¼Œæ£€æŸ¥ lxc.cgroup2.devices.allow å’ŒæŒ‚è½½æ¡ç›®æ˜¯å¦æ­£ç¡®ã€‚å°è¯•åœ¨å®¹å™¨å†…æ‰‹åŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ï¼ˆå¦‚ mknod -m 666 /dev/dri/card0 c 226 0ï¼‰ã€‚ Docker åœ¨ LXC å®¹å™¨å†…æ— æ³•è¿è¡Œ\nåŸå› ï¼šé€šå¸¸ç”±äºå®¹å™¨æƒé™ä¸è¶³æˆ–ç¼ºå°‘å¿…è¦çš„å†…æ ¸æ¨¡å—ã€‚ è§£å†³ï¼šç¡®ä¿åˆ›å»ºå®¹å™¨æ—¶å–æ¶ˆå‹¾é€‰\u0026quot;æ— ç‰¹æƒçš„å®¹å™¨\u0026quot;ï¼ˆå³åˆ›å»ºç‰¹æƒå®¹å™¨ï¼‰ã€‚åœ¨å®¹å™¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨ nesting é€‰é¡¹ï¼š 1 2 # åœ¨ /etc/pve/lxc/\u0026lt;CT_ID\u0026gt;.conf ä¸­æ·»åŠ  features: nesting=1 CT æ¨¡æ¿ä¸‹è½½ç¼“æ…¢\nè§£å†³ï¼šç¡®ä¿å·²æ­£ç¡®æ›¿æ¢å›½å†…é•œåƒæºï¼Œå¹¶é‡å¯äº† pvedaemon æœåŠ¡ã€‚ å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©åœ¨ PVE ä¸­éƒ¨ç½²å’Œç®¡ç† LXC å®¹å™¨ï¼å¦‚æœ‰æ›´å¤æ‚é—®é¢˜ï¼Œè¯·å‚è€ƒ PVE å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚\n","date":"2024-12-07T16:08:30+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/5a025a39/","title":"Proxmox VE å®‰è£…ä¸é…ç½® LXC å®¹å™¨ ğŸ§"},{"content":"Proxmox VE é•œåƒ img è½¬ CT æ¨¡æ¿æŒ‡å— ğŸ”„ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•å°† iStoreOS ç­‰ IMG æ ¼å¼çš„é•œåƒè½¬æ¢ä¸º Proxmox VE (PVE) å¯ç”¨çš„ LXC å®¹å™¨æ¨¡æ¿ï¼Œå®ç°æ›´è½»é‡çº§çš„éƒ¨ç½²å’Œæ›´é«˜æ•ˆçš„èµ„æºåˆ©ç”¨ã€‚\nğŸ“– å¯¼èˆªç›®å½• ğŸŒŸ é•œåƒè½¬æ¢æ¦‚è¿° ğŸ“¥ å‡†å¤‡å·¥ä½œ ğŸ”„ é•œåƒè½¬æ¢æ­¥éª¤ ğŸ“¦ åˆ›å»º LXC å®¹å™¨ âš™ï¸ å®¹å™¨é«˜çº§é…ç½® ğŸ¯ åˆå§‹åŒ–ä¸è®¾ç½® ğŸš€ ä½¿ç”¨æŠ€å·§ä¸ä¼˜åŒ– âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥ ğŸŒŸ ä¸€ã€é•œåƒè½¬æ¢æ¦‚è¿° å°† IMG é•œåƒè½¬æ¢ä¸º PVE LXC å®¹å™¨æ¨¡æ¿çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼š\nèµ„æºæ•ˆç‡ âš¡: LXC å®¹å™¨ç›¸æ¯”å®Œæ•´è™šæ‹Ÿæœºï¼ˆKVMï¼‰èµ„æºå¼€é”€æ›´å°ï¼Œå¯åŠ¨æ›´å¿«ã€‚ ç®¡ç†ä¾¿åˆ© ğŸ› ï¸: ä¸ PVE ç®¡ç†å¹³å°æ— ç¼é›†æˆï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ã€‚ çµæ´»æ€§ ğŸ”„: å¯ä»¥çµæ´»é…ç½®ç½‘ç»œã€å­˜å‚¨å’Œç¡¬ä»¶è®¿é—®ã€‚ é€‚ç”¨åœºæ™¯ï¼š\nè¿è¡Œ iStoreOSã€OpenWrt ç­‰åµŒå…¥å¼ç³»ç»Ÿ éƒ¨ç½²è½»é‡çº§ç½‘ç»œæœåŠ¡ï¼ˆå¦‚ DNSã€DHCP æœåŠ¡å™¨ï¼‰ éœ€è¦ç›´æ¥è®¿é—®å®¿ä¸»ç¡¬ä»¶ï¼ˆå¦‚ç½‘å¡ã€USB è®¾å¤‡ï¼‰çš„åº”ç”¨ âš ï¸ æ³¨æ„ï¼šå¹¶éæ‰€æœ‰ IMG é•œåƒéƒ½é€‚åˆè½¬æ¢ä¸º LXC å®¹å™¨ã€‚å¦‚æœé•œåƒå†…æ ¸ä¸ PVE å®¿ä¸»å†…æ ¸ä¸å…¼å®¹ï¼Œæˆ–éœ€è¦ç‰¹å®šå†…æ ¸æ¨¡å—ï¼Œå¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚\nğŸ“¥ äºŒã€å‡†å¤‡å·¥ä½œ åœ¨å¼€å§‹è½¬æ¢å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ PVE ç³»ç»Ÿå·²å°±ç»ªã€‚\nå®‰è£…å¿…è¦å·¥å…·ï¼š\n1 2 # æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…å¿…è¦å·¥å…· sudo apt update \u0026amp;\u0026amp; sudo apt install -y curl wget gzip nbd-client ä¸‹è½½ iStoreOS é•œåƒï¼š\n1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºç›®å½•å¹¶ä¸‹è½½é•œåƒ mkdir -p /mnt/pve/sda/istore \u0026amp;\u0026amp; cd /mnt/pve/sda/istore # ä½¿ç”¨å›½å†…æºä¸‹è½½ï¼ˆç¤ºä¾‹é“¾æ¥ï¼Œè¯·æ›¿æ¢ä¸ºæœ€æ–°ç‰ˆï¼‰ wget -c -O istoreos.img.gz \\ \u0026#34;https://fw0.koolcenter.com/iStoreOS/x86_64/istoreos-22.03.7-2024080210-x86-64-squashfs-combined.img.gz\u0026#34; # è§£å‹é•œåƒæ–‡ä»¶ gzip -kd istoreos.img.gz echo -e \u0026#34;âœ… ä¸‹è½½å®Œæˆï¼æ–‡ä»¶ä¿¡æ¯ï¼š\u0026#34; ls -la /mnt/pve/sda/istore/istoreos.img* æ£€æŸ¥ PVE å­˜å‚¨ï¼š ç¡®è®¤ä½ çš„ PVE æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´å­˜æ”¾é•œåƒå’Œç”Ÿæˆçš„æ¨¡æ¿ã€‚æ¨¡æ¿é€šå¸¸å­˜æ”¾åœ¨ /var/lib/vz/template/cache ç›®å½•ã€‚\n1 df -h /var/lib/vz/template/cache ğŸ”„ ä¸‰ã€é•œåƒè½¬æ¢æ­¥éª¤ è½¬æ¢è¿‡ç¨‹ä¸»è¦æ¶‰åŠæŒ‚è½½ IMG é•œåƒå’Œæ‰“åŒ…å…¶æ–‡ä»¶ç³»ç»Ÿã€‚\nåŠ è½½ NBD å†…æ ¸æ¨¡å—å¹¶è¿æ¥é•œåƒï¼š NBD (Network Block Device) å…è®¸æˆ‘ä»¬å°†é•œåƒæ–‡ä»¶ä½œä¸ºå—è®¾å¤‡æŒ‚è½½ã€‚\n1 2 3 4 # åŠ è½½ nbd å†…æ ¸æ¨¡å— modprobe nbd # å°†é•œåƒæ–‡ä»¶è¿æ¥åˆ° /dev/nbd0 è®¾å¤‡ qemu-nbd -c /dev/nbd0 -f raw /mnt/pve/sda/istore/istoreos.img æŸ¥çœ‹åˆ†åŒºä¿¡æ¯å¹¶æŒ‚è½½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹é•œåƒçš„åˆ†åŒºä¿¡æ¯ echo -e \u0026#34;ğŸ“Š åˆ†åŒºä¿¡æ¯ï¼š\u0026#34; fdisk -l /dev/nbd0 # æˆ–ä½¿ç”¨ lsblk -f /dev/nbd0 # åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½åˆ†åŒºï¼ˆé€šå¸¸æ˜¯ç¬¬äºŒä¸ªåˆ†åŒºï¼Œå¦‚ nbd0p2ï¼‰ mkdir -p /mnt/istoreos_root mount /dev/nbd0p2 /mnt/istoreos_root # æ ¹æ®å®é™…åˆ†åŒºè°ƒæ•´ # æ£€æŸ¥æŒ‚è½½ç»“æœ echo -e \u0026#34;âœ… æŒ‚è½½æˆåŠŸï¼æ ¹æ–‡ä»¶ç³»ç»Ÿå†…å®¹ï¼š\u0026#34; ls /mnt/istoreos_root | head -10 åˆ›å»º CT æ¨¡æ¿ï¼š å°†æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä¸º PVE å¯è¯†åˆ«çš„æ¨¡æ¿ã€‚\n1 2 3 4 5 6 7 # è¿›å…¥æŒ‚è½½ç‚¹å¹¶æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿ cd /mnt/istoreos_root tar --numeric-owner -czvf /var/lib/vz/template/cache/istoreos.rootfs.tar.gz . # éªŒè¯æ¨¡æ¿æ–‡ä»¶ echo -e \u0026#34;ğŸ“¦ æ¨¡æ¿åˆ›å»ºå®Œæˆï¼æ–‡ä»¶ä¿¡æ¯ï¼š\u0026#34; du -sh /var/lib/vz/template/cache/istoreos.rootfs.tar.gz æ¸…ç†ä¸´æ—¶èµ„æºï¼š\n1 2 3 4 5 6 # å¸è½½å¹¶æ–­å¼€è¿æ¥ cd /tmp # ç¡®ä¿ä¸åœ¨æŒ‚è½½ç›®å½•å†… umount /mnt/istoreos_root/ qemu-nbd -d /dev/nbd0 rmdir /mnt/istoreos_root echo -e \u0026#34;ğŸ§¹ ä¸´æ—¶èµ„æºæ¸…ç†å®Œæˆï¼\u0026#34; ğŸ“¦ å››ã€åˆ›å»º LXC å®¹å™¨ ä½¿ç”¨è½¬æ¢å¥½çš„æ¨¡æ¿åˆ›å»º LXC å®¹å™¨ã€‚\nä½¿ç”¨ pct å‘½ä»¤åˆ›å»ºå®¹å™¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºå®¹å™¨ï¼ˆID 106ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ pct create 106 \\ /var/lib/vz/template/cache/istoreos.rootfs.tar.gz \\ # æ¨¡æ¿è·¯å¾„ --rootfs local-lvm:8 \\ # ä½¿ç”¨ local-lvm å­˜å‚¨ï¼Œåˆ†é… 8GB ç£ç›˜ç©ºé—´ --ostype unmanaged \\ # æ“ä½œç³»ç»Ÿç±»å‹ --hostname iStoreOS-LXC \\ # å®¹å™¨ä¸»æœºå --arch amd64 \\ # æ¶æ„ --cores 2 \\ # åˆ†é… 2 ä¸ª CPU æ ¸å¿ƒ --memory 1024 \\ # åˆ†é… 1024MB å†…å­˜ --swap 0 \\ # ç¦ç”¨äº¤æ¢åˆ†åŒº -net0 bridge=vmbr0,name=eth0 # ç½‘ç»œé…ç½®ï¼Œæ¡¥æ¥åˆ° vmbr0ï¼Œæ¥å£å eth0 echo -e \u0026#34;âœ… å®¹å™¨åˆ›å»ºå‘½ä»¤å·²æ‰§è¡Œï¼\u0026#34; å‚æ•°è¯´æ˜ï¼š\n106: å®¹å™¨ IDï¼ŒPVE ä¸­å”¯ä¸€ï¼Œå¯è‡ªå®šä¹‰ã€‚ local:vztmpl/istoreos.rootfs.tar.gz: æŒ‡å®šæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚ --rootfs local-lvm:8: ä½¿ç”¨ local-lvm å­˜å‚¨ï¼Œåˆ†é… 8GB ç£ç›˜ç©ºé—´ã€‚ä½ å¯ä»¥åœ¨ PVE ç½‘é¡µç«¯æŸ¥çœ‹å¯ç”¨å­˜å‚¨åç§°ã€‚ --ostype unmanaged: å¯¹äºè‡ªå®šä¹‰æ¨¡æ¿ï¼Œé€šå¸¸ä½¿ç”¨ unmanagedã€‚ -net0 bridge=vmbr0,name=eth0: ç½‘ç»œé…ç½®ï¼Œæ¡¥æ¥åˆ° vmbr0ï¼Œæ¥å£å eth0ã€‚ é€šè¿‡ PVE ç½‘é¡µç•Œé¢åˆ›å»ºï¼š\nè®¿é—® PVE ç½‘é¡µç®¡ç†ç•Œé¢ã€‚ å³é”®ç‚¹å‡»ä½ çš„ PVE èŠ‚ç‚¹ï¼Œé€‰æ‹© \u0026ldquo;Create CT\u0026rdquo;ã€‚ åœ¨ \u0026ldquo;Template\u0026rdquo; æ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½åœ¨ \u0026ldquo;Local\u0026rdquo; å­˜å‚¨ä¸‹æ‰¾åˆ°åˆšæ‰ç”Ÿæˆçš„ istoreos.rootfs.tar.gz æ¨¡æ¿ã€‚ åç»­æ­¥éª¤æ ¹æ®éœ€æ±‚é…ç½®ç¡¬ä»¶å‚æ•°å³å¯ã€‚ âš™ï¸ äº”ã€å®¹å™¨é«˜çº§é…ç½® å¯¹äº iStoreOSã€OpenWrt ç­‰ç³»ç»Ÿï¼Œé€šå¸¸éœ€è¦ä¸€äº›ç‰¹æ®Šé…ç½®ä»¥ç¡®ä¿ç¡¬ä»¶è®¿é—®å’ŒåŠŸèƒ½æ­£å¸¸ã€‚\nç¼–è¾‘å®¹å™¨é…ç½®æ–‡ä»¶ï¼š å®¹å™¨çš„é…ç½®æ–‡ä»¶ä½äº /etc/pve/lxc/\u0026lt;CTID\u0026gt;.confï¼ˆä¾‹å¦‚ /etc/pve/lxc/106.confï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ç¼–è¾‘å®¹å™¨é…ç½®æ–‡ä»¶ï¼ˆå°† 106 æ›¿æ¢ä¸ºä½ çš„å®¹å™¨ IDï¼‰ cat \u0026gt;\u0026gt; /etc/pve/lxc/106.conf \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # ğŸ¯ ç¡¬ä»¶ç›´é€šä¸æƒé™é…ç½® lxc.cgroup2.devices.allow: c 10:200 rwm # å…è®¸ tun è®¾å¤‡ lxc.cgroup2.devices.allow: c 226:0 rwm # å…è®¸ ttyUSB ç­‰ lxc.cgroup2.devices.allow: c 29:0 rwm # å…è®¸ fb0 ç­‰ # ğŸ“ æŒ‚è½½ç‚¹ï¼ˆæ ¹æ®éœ€è¦å¯ç”¨ï¼‰ # lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir # æ˜¾å¡ # lxc.mount.entry: /dev/net/tun dev/net/tun none bind,optional,create=file # TUN/TAP # ğŸ”“ æƒé™é…ç½®ï¼ˆå…è®¸å®¹å™¨æ›´å¤šæƒé™ï¼Œè°¨æ…ä½¿ç”¨ï¼‰ lxc.apparmor.profile: unconfined lxc.cgroup.devices.allow: a lxc.cap.drop: EOF echo -e \u0026#34;âœ… å®¹å™¨é«˜çº§é…ç½®å·²æ›´æ–°ï¼\u0026#34; é…ç½®è¯´æ˜ï¼š\nlxc.cgroup2.devices.allow: å…è®¸å®¹å™¨è®¿é—®ç‰¹å®šè®¾å¤‡ã€‚ lxc.mount.entry: å°†å®¿ä¸»è®¾å¤‡æŒ‚è½½åˆ°å®¹å™¨å†…ï¼ˆå¦‚æ˜¾å¡ã€USB è®¾å¤‡ï¼‰ã€‚ lxc.apparmor.profile: unconfined å’Œ lxc.cap.drop:: æ”¾å®½æƒé™é™åˆ¶ï¼Œè§£å†³æŸäº›æœåŠ¡å¯åŠ¨é—®é¢˜ï¼Œä½†ä¼šé™ä½å®‰å…¨æ€§ï¼Œè¯·æ ¹æ®å®é™…éœ€è¦æ·»åŠ ã€‚ å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–ï¼ˆå¯é€‰ï¼‰ï¼š å¦‚æœéœ€è¦åœ¨ LXC å®¹å™¨å†…å†è¿è¡Œ Docker æˆ–å…¶ä»–å®¹å™¨ï¼Œéœ€å¯ç”¨åµŒå¥—è™šæ‹ŸåŒ–ã€‚\n1 2 # ç¼–è¾‘å®¹å™¨é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œ echo \u0026#34;features: nesting=1\u0026#34; \u0026gt;\u0026gt; /etc/pve/lxc/106.conf ğŸ¯ å…­ã€åˆå§‹åŒ–ä¸è®¾ç½® å®¹å™¨åˆ›å»ºå¹¶é…ç½®å®Œæˆåï¼Œå°±å¯ä»¥å¯åŠ¨å¹¶ä½¿ç”¨äº†ã€‚\nå¯åŠ¨å®¹å™¨ï¼š\n1 2 3 pct start 106 pct status 106 echo -e \u0026#34;ğŸš€ å®¹å™¨å·²å¯åŠ¨ï¼\u0026#34; è¿›å…¥å®¹å™¨å¹¶é…ç½®ç½‘ç»œï¼š\n1 2 3 4 5 # è¿›å…¥å®¹å™¨æ§åˆ¶å° pct enter 106 # åœ¨å®¹å™¨å†…ç¼–è¾‘ç½‘ç»œé…ç½®ï¼ˆiStoreOS/OpenWrt é€šå¸¸ä½¿ç”¨ /etc/config/networkï¼‰ vi /etc/config/network ç½‘ç»œé…ç½®ç¤ºä¾‹ï¼ˆæ ¹æ®ä½ çš„ç½‘ç»œç¯å¢ƒè°ƒæ•´ï¼‰ï¼š\n1 2 3 4 5 6 7 8 config interface \u0026#39;lan\u0026#39; option type \u0026#39;bridge\u0026#39; option ifname \u0026#39;eth0\u0026#39; # å¯¹åº”åˆ›å»ºå®¹å™¨æ—¶çš„ name=eth0 option proto \u0026#39;static\u0026#39; option ipaddr \u0026#39;192.168.1.100\u0026#39; # è®¾ç½®å®¹å™¨é™æ€ IP option netmask \u0026#39;255.255.255.0\u0026#39; option gateway \u0026#39;192.168.1.1\u0026#39; # ä½ çš„ä¸»è·¯ç”±ç½‘å…³ option dns \u0026#39;192.168.1.1 8.8.8.8\u0026#39; # DNS æœåŠ¡å™¨ ä¿å­˜é€€å‡ºåï¼Œé‡å¯ç½‘ç»œï¼š\n1 2 3 4 5 6 # åœ¨å®¹å™¨å†…æ‰§è¡Œ /etc/init.d/network restart # æˆ–è€… service network restart # é€€å‡ºå®¹å™¨ exit é€šè¿‡ Web ç•Œé¢è®¿é—®ï¼š\nåœ¨æµè§ˆå™¨ä¸­è®¿é—®ä½ ä¸ºå®¹å™¨è®¾ç½®çš„ IP åœ°å€ï¼ˆä¾‹å¦‚ http://192.168.1.100ï¼‰ã€‚ ä½ åº”è¯¥èƒ½çœ‹åˆ° iStoreOS çš„ç™»å½•ç•Œé¢ã€‚ æ ¹æ®æç¤ºè¿›è¡Œåˆå§‹è®¾ç½®ï¼Œå¦‚ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ã€é…ç½®ç½‘ç»œæ¥å£ç­‰ã€‚ ğŸš€ ä¸ƒã€ä½¿ç”¨æŠ€å·§ä¸ä¼˜åŒ– èµ„æºè°ƒæ•´ ğŸ”§: å®¹å™¨è¿è¡Œåï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´èµ„æºï¼ˆéœ€å®¹å™¨æ”¯æŒï¼‰ï¼š 1 2 3 pct set 106 -memory 512 # å°†å†…å­˜è°ƒæ•´ä¸º 512MB pct set 106 -cores 1 # å°† CPU æ ¸å¿ƒè°ƒæ•´ä¸º 1 ä¸ª pct resize 106 rootfs +2G # ç»™æ ¹ç£ç›˜æ‰©å®¹ 2GB å¤‡ä»½ä¸æ¢å¤ ğŸ’¾: å®šæœŸå¤‡ä»½å®¹å™¨é…ç½®ï¼š 1 2 3 4 # å¤‡ä»½å®¹å™¨é…ç½® cd /etc/pve/lxc/ cp 106.conf 106.conf.backup # ä½¿ç”¨ PVE ç½‘é¡µç«¯æˆ– `vzdump` å‘½ä»¤è¿›è¡Œå®Œæ•´å¤‡ä»½ å¼€æœºè‡ªå¯ ğŸ”Œ: è®¾ç½®å®¹å™¨åœ¨ PVE å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼š 1 pct set 106 -onboot 1 ç›‘æ§çŠ¶æ€ ğŸ“Š: ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç›‘æ§å®¹å™¨çŠ¶æ€ï¼š 1 2 pct list # æŸ¥çœ‹å®¹å™¨åˆ—è¡¨ pct top 106 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼ˆç±»ä¼¼ topï¼‰ âš ï¸ å…«ã€å¸¸è§é—®é¢˜æ’æŸ¥ â“ å®¹å™¨å¯åŠ¨å¤±è´¥ï¼š\næŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š 1 2 pct config 106 # æŸ¥çœ‹å®¹å™¨é…ç½® journalctl -u pve-container@106 # æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿— æ£€æŸ¥é…ç½®ï¼šç¡®è®¤ /etc/pve/lxc/106.conf ä¸­è¯­æ³•æ­£ç¡®ï¼Œæ²¡æœ‰é‡å¤æˆ–å†²çªçš„é€‰é¡¹ã€‚ â“ ç½‘ç»œä¸é€šï¼š\næ£€æŸ¥å®¹å™¨å†…éƒ¨ç½‘ç»œé…ç½®ï¼š 1 2 pct exec 106 -- ip addr show # æŸ¥çœ‹å®¹å™¨å†… IP åœ°å€åˆ†é… pct exec 106 -- ping -c 4 192.168.1.1 # åœ¨å®¹å™¨å†…å°è¯• ping ç½‘å…³ æ£€æŸ¥ PVE é˜²ç«å¢™ï¼šç¡®è®¤ PVE å®¿ä¸»æœºçš„é˜²ç«å¢™æ²¡æœ‰é˜»æ­¢ç›¸å…³æµé‡ã€‚ â“ æ— æ³•è®¿é—® Web ç•Œé¢ï¼š\nç¡®è®¤å®¹å™¨å†… Web æœåŠ¡å·²å¯åŠ¨ï¼ˆpct exec 106 -- netstat -tulpnï¼‰ã€‚ ç¡®è®¤é…ç½®çš„ IP åœ°å€ä¸å®¿ä¸»ç½‘ç»œåœ¨åŒä¸€ç½‘æ®µä¸”æ— å†²çªã€‚ â“ æ¨¡æ¿åˆ¶ä½œå¤±è´¥ï¼ˆä¾‹å¦‚æŒ‚è½½ç‚¹ç¹å¿™ï¼‰ï¼š\n1 2 3 4 # å¼ºåˆ¶æ¸…ç† umount /mnt/istoreos_root 2\u0026gt;/dev/null || true qemu-nbd -d /dev/nbd0 2\u0026gt;/dev/null || true rm -f /var/lib/vz/template/cache/istoreos.rootfs.tar.gz # åˆ é™¤æœ‰é—®é¢˜çš„æ¨¡æ¿é‡æ–°åˆ¶ä½œ âœ¨ æ­å–œï¼å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ ç°åœ¨åº”è¯¥å·²ç»æˆåŠŸåœ°å°† iStoreOS IMG é•œåƒè½¬æ¢ä¸ºäº† PVE LXC å®¹å™¨ï¼Œå¹¶å®Œæˆäº†åŸºæœ¬çš„é…ç½®ã€‚ç°åœ¨å¯ä»¥å¼€å§‹ä½“éªŒåœ¨ LXC å®¹å™¨ä¸­è¿è¡Œ iStoreOS çš„è½»é‡çº§å’Œä¾¿æ·æ€§äº†ï¼\né‡è¦æç¤ºï¼šæ“ä½œå‰åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ï¼Œå¹¶ç¡®ä¿ç†è§£æ¯ä¸ªå‘½ä»¤çš„ä½œç”¨ã€‚å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¯·å……åˆ†æµ‹è¯•ã€‚\n","date":"2024-12-07T16:07:41+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/28f02402/","title":"Proxmox VE é•œåƒ img è½¬ CT æ¨¡æ¿æŒ‡å— ğŸ”„"},{"content":"Proxmox VE å®‰è£… iStoreOS æŒ‡å— ğŸ–¥ï¸ ğŸŒŸ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Proxmox VE (PVE) è™šæ‹ŸåŒ–å¹³å°ä¸Šå®‰è£…å’Œé…ç½® iStoreOSï¼ˆåŸºäº OpenWRTï¼‰ï¼Œå¸®åŠ©ä½ æ‰“é€ é«˜æ•ˆã€ç¨³å®šçš„å®¶åº­æˆ–ä¼ä¸šè½¯è·¯ç”±è§£å†³æ–¹æ¡ˆã€‚\nğŸ“‹ ç›®å½• ğŸŒŸ æ¦‚è¿° âš¡ iStoreOS ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ› ï¸ å®‰è£…å‰å‡†å¤‡ ğŸš€ å®‰è£…æ­¥éª¤ 1. åˆ›å»ºè™šæ‹Ÿæœº 2. ä¸‹è½½ iStoreOS é•œåƒ 3. éªŒè¯ä¸‹è½½ 4. è½¬æ¢å¹¶å¯¼å…¥ç£ç›˜ 5. é…ç½®è™šæ‹Ÿæœºå­˜å‚¨ 6. è®¾ç½®å¯åŠ¨é¡ºåº 7. å¯åŠ¨å¹¶é…ç½® iStoreOS 8. ç½‘ç»œé…ç½® 9. é‡å¯åº”ç”¨é…ç½® ğŸ”§ åˆå§‹è®¾ç½® âš™ï¸ é«˜çº§é…ç½® æ€§èƒ½ä¼˜åŒ– å¤šç½‘å¡é…ç½® å¤‡ä»½é…ç½® ğŸ› ï¸ æ•…éšœæ’é™¤ ğŸ”’ å®‰å…¨åŠ å›º ğŸ“Š ç›‘æ§å’Œç»´æŠ¤ ğŸ¯ ä½¿ç”¨æŠ€å·§ âœ… æ€»ç»“ ğŸŒŸ æ¦‚è¿° iStoreOS æ˜¯åŸºäº OpenWRT å¼€å‘çš„è½¯è·¯ç”±ç³»ç»Ÿï¼Œä¸“ä¸ºå®¶åº­å’Œå°å‹ä¼ä¸šç¯å¢ƒè®¾è®¡ï¼Œæä¾›äº†å‹å¥½çš„ç”¨æˆ·ç•Œé¢å’Œä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ã€‚ç»“åˆ Proxmox VE è™šæ‹ŸåŒ–å¹³å°ï¼Œä½ å¯ä»¥çµæ´»åœ°éƒ¨ç½²å’Œç®¡ç†ä½ çš„ç½‘ç»œæœåŠ¡ã€‚\nâš¡ iStoreOS ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ–¥ï¸ ç›´è§‚çš„ Web ç®¡ç†ç•Œé¢ï¼šåŸºäº LuCI çš„ç°ä»£åŒ–è®¾è®¡ï¼Œæ“ä½œç®€å•æ˜“ç”¨ ğŸ“¦ ä¸°å¯Œçš„è½¯ä»¶ä¸­å¿ƒï¼šé¢„ç½®å¤šç§å®ç”¨æ’ä»¶ï¼Œä¸€é”®å®‰è£…å„ç±»åº”ç”¨ ğŸ”’ å¼ºå¤§çš„é˜²ç«å¢™åŠŸèƒ½ï¼šæ”¯æŒå¤šç§å®‰å…¨ç­–ç•¥å’Œè®¿é—®æ§åˆ¶ ğŸŒ å¤šWANè´Ÿè½½å‡è¡¡ï¼šæ”¯æŒå¤šæ¡å®½å¸¦çº¿è·¯çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§» ğŸ“¡ æ— çº¿ç®¡ç†åŠŸèƒ½ï¼šå®Œæ•´çš„æ— çº¿ç½‘ç»œç®¡ç†å’Œè®¿å®¢ç½‘ç»œæ”¯æŒ ğŸ”„ å®šæ—¶ä»»åŠ¡ä¸è‡ªåŠ¨åŒ–ï¼šæ”¯æŒè®¡åˆ’ä»»åŠ¡å’Œè‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œ ğŸ’¾ USBè®¾å¤‡æ”¯æŒï¼šå®Œå–„çš„USBè®¾å¤‡æ”¯æŒï¼ˆ3G/4G modemã€å­˜å‚¨è®¾å¤‡ç­‰ï¼‰ ğŸ“Š å®æ—¶æµé‡ç›‘æ§ï¼šå†…ç½®æµé‡ç»Ÿè®¡å’Œå®æ—¶ç›‘æ§åŠŸèƒ½ ğŸ› ï¸ å®‰è£…å‰å‡†å¤‡ ç³»ç»Ÿè¦æ±‚ âœ… å·²å®‰è£… Proxmox VE 7.x æˆ–æ›´é«˜ç‰ˆæœ¬ âœ… è‡³å°‘ 2GB å†…å­˜ï¼ˆæ¨è 4GB+ ä»¥è·å¾—æ›´å¥½ä½“éªŒï¼‰ âœ… 10GB å¯ç”¨å­˜å‚¨ç©ºé—´ï¼ˆå»ºè®® SSD ä»¥è·å¾—æ›´ä½³æ€§èƒ½ï¼‰ âœ… åŒç½‘å¡æˆ–ä»¥ä¸Šï¼ˆæ¨èï¼‰ç”¨äº WAN/LAN åˆ†ç¦» âœ… ç¨³å®šçš„äº’è”ç½‘è¿æ¥ä»¥ä¸‹è½½é•œåƒå’Œè½¯ä»¶åŒ… ğŸš€ å®‰è£…æ­¥éª¤ 1. åˆ›å»ºè™šæ‹Ÿæœº åœ¨ PVE Web ç•Œé¢ä¸­ï¼š\nç‚¹å‡»å³ä¸Šè§’\u0026quot;åˆ›å»ºè™šæ‹Ÿæœº\u0026quot; åç§°ï¼šiStoreOSï¼ˆå¯è‡ªå®šä¹‰ï¼‰ æ“ä½œç³»ç»Ÿï¼šä¸ä½¿ç”¨ä»»ä½•ä»‹è´¨ï¼ˆæˆ‘ä»¬ç¨åæ‰‹åŠ¨æ·»åŠ ç£ç›˜ï¼‰ ç³»ç»Ÿï¼šé»˜è®¤è®¾ç½®ï¼ˆBIOS æˆ– UEFI å‡å¯ï¼‰ ç£ç›˜ï¼šå…ˆåˆ é™¤é»˜è®¤ç£ç›˜ï¼ˆåé¢ä¼šæ‰‹åŠ¨æ·»åŠ ï¼‰ CPUï¼šè‡³å°‘ 2 æ ¸å¿ƒï¼ˆæ¨è 4 æ ¸å¿ƒä»¥è·å¾—æ›´å¥½æ€§èƒ½ï¼‰ å†…å­˜ï¼šè‡³å°‘ 1024MBï¼ˆæ¨è 2048MB æˆ–ä»¥ä¸Šï¼‰ ç½‘ç»œï¼švmbr0ï¼ˆæ¡¥æ¥åˆ°ç‰©ç†ç½‘å¡ï¼Œæ¨¡å‹é€‰æ‹© VirtIO ä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼‰ 2. ä¸‹è½½ iStoreOS é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®‰è£…å¿…è¦å·¥å…·ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ sudo apt update \u0026amp;\u0026amp; sudo apt install -y curl wget # åˆ›å»ºå­˜å‚¨ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ mkdir -p /var/lib/vz/template/iso # ä¸‹è½½ iStoreOS é•œåƒåˆ° ISO ç›®å½• wget -c -O /var/lib/vz/template/iso/iStoreOS.img.gz \\ https://fw0.koolcenter.com/iStoreOS/x86_64/istoreos-22.03.7-2024080210-x86-64-squashfs-combined.img.gz # å¤‡ç”¨ä¸‹è½½æºï¼ˆå¦‚æœä¸»æºé€Ÿåº¦æ…¢ï¼‰ # wget -c -O /var/lib/vz/template/iso/iStoreOS.img.gz \\ # https://cdn.jsdelivr.net/gh/haiibo/OpenWrt@gh-pages/iStoreOS/x86_64/istoreos-22.03.7-2024080210-x86-64-squashfs-combined.img.gz 3. éªŒè¯ä¸‹è½½ 1 2 3 4 5 6 7 8 9 # è§£å‹é•œåƒæ–‡ä»¶ gzip -kd /var/lib/vz/template/iso/iStoreOS.img.gz # æ£€æŸ¥æ–‡ä»¶å¤§å°å’Œå®Œæ•´æ€§ sudo du -sh /var/lib/vz/template/iso/iStoreOS.img ls -la /var/lib/vz/template/iso/iStoreOS.img* # éªŒè¯æ–‡ä»¶ç±»å‹ file /var/lib/vz/template/iso/iStoreOS.img 4. è½¬æ¢å¹¶å¯¼å…¥ç£ç›˜ æ ¹æ®æ‚¨çš„ PVE å­˜å‚¨é…ç½®é€‰æ‹©ç›¸åº”å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹PVEå­˜å‚¨é…ç½® pvesm status # å¦‚æœ local-lvm å­˜åœ¨ï¼ˆé»˜è®¤å®‰è£…æ–¹å¼ï¼‰ï¼š qm importdisk 100 /var/lib/vz/template/iso/iStoreOS.img local-lvm # å¦‚æœåªæœ‰ local å­˜å‚¨ï¼ˆåˆå¹¶åˆ†åŒºåï¼‰ï¼š qm importdisk 100 /var/lib/vz/template/iso/iStoreOS.img local ğŸ’¡ æ³¨æ„ï¼šå°† 100 æ›¿æ¢ä¸ºæ‚¨å®é™…åˆ›å»ºçš„è™šæ‹Ÿæœº ID\n5. é…ç½®è™šæ‹Ÿæœºå­˜å‚¨ åœ¨ PVE Web ç•Œé¢ä¸­ï¼š\né€‰æ‹©æ‚¨çš„è™šæ‹Ÿæœº (100) è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ æ‚¨ä¼šçœ‹åˆ°æ–°æ·»åŠ çš„æœªä½¿ç”¨ç£ç›˜ï¼ˆå¤§å°çº¦ 500MB-1GBï¼‰ ç‚¹å‡»\u0026quot;ç¼–è¾‘\u0026quot;å¹¶é€‰æ‹©ï¼š æ€»çº¿ï¼šSATA æˆ– VirtIO Blockï¼ˆæ¨è VirtIO ä»¥è·å¾—æ›´å¥½æ€§èƒ½ï¼‰ ç¼“å­˜ï¼šWrite backï¼ˆæ¨èï¼‰æˆ– Noneï¼ˆæ›´å®‰å…¨ï¼‰ 6. è®¾ç½®å¯åŠ¨é¡ºåº è¿›å…¥\u0026quot;é€‰é¡¹\u0026quot;é€‰é¡¹å¡ é€‰æ‹©\u0026quot;å¼•å¯¼é¡ºåº\u0026quot; ç¡®ä¿æ–°æ·»åŠ çš„ç£ç›˜ä¸ºç¬¬ä¸€å¯åŠ¨é¡¹ å–æ¶ˆé€‰æ‹©å…¶ä»–å¯åŠ¨é¡¹ï¼ˆå¦‚CD-ROMï¼‰ å‹¾é€‰\u0026quot;ä»…é™ç¬¬ä¸€æ¬¡\u0026quot;ä»¥æ–¹ä¾¿åç»­å¯åŠ¨ 7. å¯åŠ¨å¹¶é…ç½® iStoreOS 1 2 3 4 5 6 7 8 # å¯åŠ¨è™šæ‹Ÿæœº qm start 100 # æŸ¥çœ‹å¯åŠ¨çŠ¶æ€ qm status 100 # è¿›å…¥è™šæ‹Ÿæœºæ§åˆ¶å°ï¼ˆç­‰å¾…å‡ åˆ†é’Ÿè®©ç³»ç»Ÿå®Œå…¨å¯åŠ¨ï¼‰ qm terminal 100 8. ç½‘ç»œé…ç½® åœ¨ iStoreOS æ§åˆ¶å°ä¸­ï¼š\n1 2 3 4 5 # æŸ¥çœ‹ç½‘ç»œæ¥å£ ip addr # ç¼–è¾‘ç½‘ç»œé…ç½® vi /etc/config/network ä¿®æ”¹ç½‘ç»œé…ç½®ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æŒ‰ \u0026#39;i\u0026#39; è¿›å…¥ç¼–è¾‘æ¨¡å¼ # ä¿®æ”¹ LAN å£é…ç½®ï¼ˆæ ¹æ®æ‚¨çš„ç½‘ç»œç¯å¢ƒè°ƒæ•´ï¼‰ config interface \u0026#39;lan\u0026#39; option proto \u0026#39;static\u0026#39; option device \u0026#39;br-lan\u0026#39; option ipaddr \u0026#39;192.168.1.1\u0026#39; # ä¿®æ”¹ä¸ºæ‚¨çš„LAN IP option netmask \u0026#39;255.255.255.0\u0026#39; option gateway \u0026#39;192.168.1.254\u0026#39; # ä¿®æ”¹ä¸ºæ‚¨çš„ç½‘å…³ option dns \u0026#39;223.5.5.5 8.8.8.8\u0026#39; # DNSæœåŠ¡å™¨ # æŒ‰ ESCï¼Œç„¶åè¾“å…¥ :wq ä¿å­˜é€€å‡º 9. é‡å¯åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 # é‡å¯ç½‘ç»œæœåŠ¡ /etc/init.d/network restart # æˆ–è€…å®Œå…¨é‡å¯ç³»ç»Ÿ reboot # é€€å‡ºæ§åˆ¶å°å›åˆ°PVE æŒ‰ Ctrl+O ç„¶å Ctrl+C ğŸ”§ åˆå§‹è®¾ç½® è®¿é—® Web ç®¡ç†ç•Œé¢ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ iStoreOS çš„ IP åœ°å€ï¼ˆé»˜è®¤ï¼š192.168.1.1ï¼‰ ç”¨æˆ·åï¼šroot å¯†ç ï¼špassword ï¼ˆé¦–æ¬¡ç™»å½•åä¼šè¦æ±‚ä¿®æ”¹ï¼‰ åŸºæœ¬é…ç½®æ­¥éª¤ ğŸ” ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼šç³»ç»Ÿç®¡ç† â†’ ç®¡ç†å‘˜å¯†ç  ğŸŒ é…ç½® WAN å£ï¼šç½‘ç»œ â†’ æ¥å£ â†’ WANï¼ˆæ ¹æ®æ‚¨çš„ç½‘ç»œç±»å‹ï¼šDHCP/PPPoE/é™æ€IPï¼‰ ğŸ“¡ è®¾ç½®æ— çº¿ç½‘ç»œï¼šç½‘ç»œ â†’ æ— çº¿ï¼ˆå¦‚æœä½¿ç”¨æ— çº¿åŠŸèƒ½ï¼‰ ğŸ“¦ æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼šç³»ç»Ÿ â†’ è½¯ä»¶åŒ… â†’ æ›´æ–°åˆ—è¡¨ ğŸ”Œ å®‰è£…æ‰€éœ€æ’ä»¶ï¼šiStore â†’ è½¯ä»¶ä¸­å¿ƒé€‰æ‹©éœ€è¦çš„æ’ä»¶ âš™ï¸ é«˜çº§é…ç½® æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨ PVE ä¸­ä¼˜åŒ–è™šæ‹Ÿæœºé…ç½® qm set 100 --cpu host,flags=+aes qm set 100 --args \u0026#34;-cpu host,-migratable\u0026#34; qm set 100 --machine q35 qm set 100 --bios ovmf qm set 100 --efidisk0 local-lvm:4,format=qcow2 # å¯ç”¨CPUé™åˆ¶ï¼ˆå¯é€‰ï¼‰ qm set 100 --cpulimit 2 # å¯ç”¨Ballooningå†…å­˜ï¼ˆåŠ¨æ€å†…å­˜ç®¡ç†ï¼‰ qm set 100 --balloon 1 å¤šç½‘å¡é…ç½® å¦‚æœæ‚¨æœ‰å¤šä¸ªç‰©ç†ç½‘å¡ï¼š\n1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹å¯ç”¨ç½‘ç»œæ¡¥æ¥ cat /etc/network/interfaces # æ·»åŠ é¢å¤–ç½‘å¡ï¼ˆæ ¹æ®å®é™…ç½‘å¡æ•°é‡è°ƒæ•´ï¼‰ qm set 100 --net1 virtio,bridge=vmbr1,tag=10 qm set 100 --net2 virtio,bridge=vmbr2,tag=20 # åœ¨iStoreOSä¸­é…ç½®VLAN # ç½‘ç»œ â†’ äº¤æ¢æœº â†’ åˆ›å»ºVLAN å¤‡ä»½é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨ iStoreOS ä¸­å¤‡ä»½é…ç½® sysupgrade -b /tmp/backup.tar.gz # ä¸‹è½½å¤‡ä»½æ–‡ä»¶åˆ°æœ¬åœ° scp root@192.168.1.1:/tmp/backup.tar.gz . # åœ¨ PVE ä¸­å¤‡ä»½æ•´ä¸ªè™šæ‹Ÿæœº vzdump 100 --compress zstd --mode snapshot # è®¾ç½®å®šæœŸè‡ªåŠ¨å¤‡ä»½ï¼ˆç¼–è¾‘cronä»»åŠ¡ï¼‰ crontab -e # æ·»åŠ ï¼š0 2 * * 7 vzdump 100 --compress zstd --mode snapshot --storage local ğŸ› ï¸ æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜è§£å†³ æ— æ³•å¯åŠ¨ 1 2 3 4 5 6 7 8 # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® qm config 100 # é‡ç½®å¯åŠ¨é¡ºåº qm set 100 --boot order=sata0 # æ£€æŸ¥é•œåƒå®Œæ•´æ€§ md5sum /var/lib/vz/template/iso/iStoreOS.img ç½‘ç»œè¿æ¥é—®é¢˜ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç½‘ç»œæ¡¥æ¥é…ç½® cat /etc/network/interfaces # é‡å¯ PVE ç½‘ç»œ systemctl restart networking # æ£€æŸ¥è™šæ‹Ÿæœºç½‘ç»œè®¾ç½® qm config 100 | grep net Web ç•Œé¢æ— æ³•è®¿é—® 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ iStoreOS ç½‘ç»œé…ç½® uci show network # é‡å¯ç½‘ç»œæœåŠ¡ /etc/init.d/network restart # æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ uci show firewall # ä¸´æ—¶å…³é—­é˜²ç«å¢™ï¼ˆè°ƒè¯•ç”¨ï¼‰ /etc/init.d/firewall stop æ—¥å¿—æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— logread # æ£€æŸ¥å†…æ ¸æ¶ˆæ¯ dmesg # æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ ifstatus lan ifstatus wan # æ£€æŸ¥è¿›ç¨‹çŠ¶æ€ ps aux | grep dnsmasq ps aux | grep firewall ğŸ”’ å®‰å…¨åŠ å›º åŸºæœ¬å®‰å…¨æªæ–½ æ›´æ”¹é»˜è®¤å¯†ç ï¼šé¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹ æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®šæœŸæ£€æŸ¥å¹¶å®‰è£…æ›´æ–° ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡ï¼šå…³é—­ä¸éœ€è¦çš„ç½‘ç»œæœåŠ¡ é…ç½®é˜²ç«å¢™è§„åˆ™ï¼šé™åˆ¶ä¸å¿…è¦çš„å…¥ç«™è¿æ¥ è®¾ç½® SSH å¯†é’¥è®¤è¯ï¼šç¦ç”¨å¯†ç ç™»å½•ï¼Œä½¿ç”¨å¯†é’¥è®¤è¯ å®‰å…¨é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ç¦ç”¨ root SSH ç™»å½•ï¼ˆå…ˆåˆ›å»ºæ™®é€šç”¨æˆ·ï¼ï¼‰ uci set sshd.@sshd[0].PermitRootLogin=\u0026#39;no\u0026#39; uci commit sshd /etc/init.d/sshd restart # é…ç½®é˜²ç«å¢™è§„åˆ™ uci set firewall.@zone[0].input=\u0026#39;REJECT\u0026#39; uci set firewall.@zone[0].output=\u0026#39;ACCEPT\u0026#39; uci set firewall.@zone[0].forward=\u0026#39;REJECT\u0026#39; uci commit firewall /etc/init.d/firewall reload # æ›´æ”¹SSHç«¯å£ uci set sshd.@sshd[0].Port=\u0026#39;2222\u0026#39; uci commit sshd /etc/init.d/sshd restart # å®‰è£…fail2bané˜²æ­¢æš´åŠ›ç ´è§£ opkg update opkg install fail2ban ğŸ“Š ç›‘æ§å’Œç»´æŠ¤ ç³»ç»Ÿç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨ top htop # ç›‘æ§ç½‘ç»œæµé‡ iftop nload -u m # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ df -h lsblk # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ uptime cat /proc/loadavg å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ›´æ–°è½¯ä»¶åŒ… opkg update opkg list-upgradable | cut -f 1 -d \u0026#39; \u0026#39; | xargs opkg upgrade # æ¸…ç†æ—§å†…æ ¸å’Œç¼“å­˜ opkg clean rm -rf /tmp/luci-* rm -rf /tmp/opkg-lists/ # æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å¤§å° logread -l 1000 # é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜ /etc/init.d/sysfi restart ğŸ¯ ä½¿ç”¨æŠ€å·§ æ’ä»¶å®‰è£… iStoreOS æä¾›äº†ä¸°å¯Œçš„æ’ä»¶ï¼š\n1 2 3 4 5 6 7 # é€šè¿‡ Web ç•Œé¢å®‰è£…æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ opkg update opkg install luci-app-ddns # åŠ¨æ€DNS opkg install luci-app-upnp # UPnPæ”¯æŒ opkg install luci-app-wireguard # WireGuard VPN opkg install luci-app-adblock # å¹¿å‘Šå±è”½ opkg install luci-app-sqm # æµé‡æ•´å½¢ ç£ç›˜æ‰©å®¹ å¦‚æœéœ€è¦æ›´å¤šå­˜å‚¨ç©ºé—´ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœ¨ PVE ä¸­æ‰©å±•ç£ç›˜ qm resize 100 scsi0 +10G # åœ¨ iStoreOS ä¸­æ‰©å±•åˆ†åŒº opkg install parted parted /dev/sda print resizepart 2 100% exit # è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å° resize2fs /dev/sda2 # éªŒè¯æ–°å¤§å° df -h æ€§èƒ½è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 # å¯ç”¨BBRæ‹¥å¡æ§åˆ¶ echo \u0026#34;net.core.default_qdisc=fq\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.ipv4.tcp_congestion_control=bbr\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p # ä¼˜åŒ–ç½‘ç»œå‚æ•° echo \u0026#34;net.netfilter.nf_conntrack_max=65536\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.ipv4.tcp_window_scaling=1\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p âœ… æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨ Proxmox VE ä¸ŠæˆåŠŸå®‰è£…å’Œé…ç½® iStoreOS/OpenWRTï¼Œæ‰“é€ é«˜æ€§èƒ½çš„è½¯è·¯ç”±è§£å†³æ–¹æ¡ˆã€‚ğŸ‰\nğŸ¯ å…³é”®è¦ç‚¹ å‡†å¤‡å·¥ä½œå¾ˆé‡è¦ï¼šç¡®ä¿ç¡¬ä»¶å’Œç½‘ç»œç¯å¢ƒç¬¦åˆè¦æ±‚ é•œåƒä¸‹è½½è¦éªŒè¯ï¼šé¿å…å› é•œåƒé—®é¢˜å¯¼è‡´å®‰è£…å¤±è´¥ ç½‘ç»œé…ç½®è¦ä»”ç»†ï¼šç‰¹åˆ«æ˜¯å¤šç½‘å¡ç¯å¢ƒä¸‹çš„æ¡¥æ¥è®¾ç½® å®‰å…¨è®¾ç½®ä¸å¯å°‘ï¼šé¦–æ¬¡ä½¿ç”¨åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç å’ŒåŠ å¼ºå®‰å…¨è®¾ç½® å®šæœŸç»´æŠ¤ä¿ç¨³å®šï¼šå®šæœŸæ›´æ–°ç³»ç»Ÿå’Œæ£€æŸ¥æ—¥å¿— ğŸ“š æ‰©å±•èµ„æº iStoreOS å®˜æ–¹æ–‡æ¡£ OpenWRT å®˜æ–¹æ–‡æ¡£ Proxmox VE å®˜æ–¹æ–‡æ¡£ â“ è·å–å¸®åŠ© å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š\næŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å¯»æ‰¾é”™è¯¯ä¿¡æ¯ è®¿é—® iStoreOS è®ºå› æŸ¥é˜… OpenWRT ç¤¾åŒºæ–‡æ¡£ æœç´¢ç›¸å…³é”™è¯¯ä¿¡æ¯ï¼Œå¾ˆå¤šé—®é¢˜å·²ç»æœ‰è§£å†³æ–¹æ¡ˆ ç¥ä½ å®‰è£…é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚ğŸš€\n","date":"2024-12-07T16:06:47+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/86ee28f8/","title":"Proxmox VE å®‰è£… iStoreOS æŒ‡å— ğŸ–¥ï¸"},{"content":"Docker éƒ¨ç½² NASTools åª’ä½“ç®¡ç†å…¨å®¶æ¡¶ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² NASTools 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åˆå§‹é…ç½®æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåª’ä½“ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Diluka/nas-tools-unlock ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/diluka/nas-tools NASTools æ˜¯ä¸€ä¸ªå®Œæ•´çš„åª’ä½“ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œé›†æˆäº†å¤šä¸ªå·¥å…·æ¥ç®€åŒ–å’Œè‡ªåŠ¨åŒ–åª’ä½“æ–‡ä»¶çš„ä¸‹è½½ã€æ•´ç†ã€å­—å¹•è·å–å’Œå…ƒæ•°æ®åˆ®å‰Šã€‚åŒ…å« ChineseSubFinderã€Jackettã€NASTools ç­‰æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›ä¸€ç«™å¼çš„åª’ä½“ç®¡ç†ä½“éªŒã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ” è‡ªåŠ¨å­—å¹•ä¸‹è½½ ChineseSubFinder è‡ªåŠ¨è·å–ä¸­æ–‡å­—å¹• æå‡åª’ä½“è§‚çœ‹ä½“éªŒ ğŸŒ å¼ºå¤§ç´¢å¼•åŠŸèƒ½ Jackett æä¾›ä¸°å¯Œçš„ Torrent ç´¢å¼• æ”¯æŒå¤šç§èµ„æºç«™ç‚¹ ğŸ¤– æ™ºèƒ½åª’ä½“ç®¡ç† NASTools è‡ªåŠ¨åŒ–åª’ä½“æ•´ç†å’Œåˆ®å‰Š ç®€åŒ–åª’ä½“åº“ç®¡ç† ğŸ¬ å…ƒæ•°æ®åˆ®å‰Š è‡ªåŠ¨è·å–å½±ç‰‡ä¿¡æ¯ã€æµ·æŠ¥å’Œå­—å¹• ä¸°å¯Œåª’ä½“ä¿¡æ¯å±•ç¤º âš¡ å¤šå·¥å…·é›†æˆ é›†æˆå¤šä¸ªä¸“ä¸šåª’ä½“å·¥å…· ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker ç®€åŒ–å®‰è£…å’Œç»´æŠ¤ å¿«é€Ÿéƒ¨ç½²å’Œå‡çº§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² NASTools 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 mkdir -p /mnt/mydisk/home/nastools \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: ## chinesesubfinder å­—å¹• chinesesubfinder: image: allanpk716/chinesesubfinder:latest container_name: chinesesubfinder network_mode: bridge restart: on-failure ports: - 19035:19035 - 19037:19037 volumes: - ./chinesesubfinder:/config - /vol2/1000/å…‰å½±é›†:/media environment: - PUID=1026 - PGID=100 - PERMS=true - TZ=Asia/Shanghai - UMASK=022 hostname: chinesesubfinder logging: driver: json-file options: max-size: 100m ## https://github.com/ChineseSubFinder/ChineseSubFinder/blob/master/docker/readme.md ## image: allanpk716/chinesesubfinder:latest-lite ## ç”µå½±çš„ç›®å½•ï¼š/media/åª’ä½“åº“/åè¯­ç”µå½± ## ç”µå½±çš„ç›®å½•ï¼š/media/åª’ä½“åº“/å¤–è¯­ç”µå½± ## ç”µå½±çš„ç›®å½•ï¼š/media/åª’ä½“åº“/åŠ¨ç”»ç”µå½± ## ç”µè§†å‰§çš„ç›®å½•ï¼š/media/åª’ä½“åº“/ç”µè§†å‰§é›† ## chinesesubfinderè·å–å¯†é’¥ï¼šhttps://secure.assrt.net/usercp.php ## è·å–å¯†é’¥ç”¨æˆ·åï¼šmobufan è·å–å¯†é’¥å¯†ç ï¼šå°å+ç”Ÿï¼ˆå…¨å°å†™ï¼‰ ## æˆ‘çš„APIå¯†é’¥: E6cpCZ7KgGPXQFBQiH0ytoygDjEzDUrB ## æˆ‘çš„TMDBå¯†é’¥ï¼š5e9c7ec3253a7b68a2035b09119ee969 ## chinesesubfinderæˆ‘çš„ç”¨æˆ·åï¼šadmin æˆ‘çš„å¯†ç ï¼šå°å+ç”Ÿï¼ˆå…¨å°å†™ï¼‰ ## jackett ç´¢å¼•å™¨ jackett: image: linuxserver/jackett container_name: jackett network_mode: bridge restart: on-failure ports: - 9117:9117 volumes: - ./Jackett:/config/Jackett - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº:/downloads environment: - PUID=0 - PGID=0 - TZ=Asia/Shanghai - AUTO_UPDATE=true ## nastools è§†é¢‘åˆ®å‰Šå™¨ nastools: image: diluka/nas-tools:2.9.1 container_name: nastools network_mode: bridge restart: on-failure ports: - 3000:3000 volumes: - ./config:/config - ./config/hosts:/etc/hosts - /vol2/1000/å…‰å½±é›†:/media environment: - PUID=0 - PGID=0 - TZ=Asia/Shanghai - NASTOOL_AUTO_UPDATE=false deploy: resources: limits: memory: 2G # ğŸ’ª å†…å­˜é™åˆ¶ï¼ˆæ ¹æ®éœ€æ±‚è°ƒæ•´ï¼‰ cpus: \u0026#39;2.0\u0026#39; # âš¡ CPUé™åˆ¶ reservations: memory: 512M # ğŸ›Œ å†…å­˜ä¿ç•™ cpus: \u0026#39;1.0\u0026#39; # ğŸ”‹ CPUä¿ç•™ ## ====== nadtools é…ç½® ====== ## ## TMDBå¯†é’¥ï¼š973861c2fb241080063515bfe682a709 ## nastoolsåˆå§‹ç”¨æˆ·åï¼šadmin åˆå§‹å¯†ç ï¼špassword ## nastoolsæˆ‘çš„ç”¨æˆ·åï¼šadmin æˆ‘çš„å¯†ç ï¼šå°å+ç”Ÿï¼ˆå…¨å°å†™ï¼‰ ## ====== è®¾ç½®---\u0026gt;åª’ä½“åº“ ====== ## ## === ç”µå½± === ## ç”µå½±çš„ç›®å½•ï¼š/media/åª’ä½“åº“/åè¯­ç”µå½± ## ç”µå½±çš„ç›®å½•ï¼š/media/åª’ä½“åº“/å¤–è¯­ç”µå½± ## === ç”µè§†å‰§ === ## ç”µè§†å‰§çš„ç›®å½•ï¼š/media/åª’ä½“åº“/ç”µè§†å‰§é›† ## === åŠ¨æ¼« === ## ç”µå½±çš„ç›®å½•ï¼š/media/åª’ä½“åº“/åŠ¨ç”»ç”µå½± ## ====== è®¾ç½®---\u0026gt;ç›®å½•åŒæ­¥ ====== ## ## æºç›®å½•ï¼š/media/æ•´ç†åŒº/åè¯­ç”µå½±---\u0026gt;ç›®çš„ç›®å½•ï¼š/media/åª’ä½“åº“/åè¯­ç”µå½± ## æºç›®å½•ï¼š/media/æ•´ç†åŒº/å¤–è¯­ç”µå½±---\u0026gt;ç›®çš„ç›®å½•ï¼š/media/åª’ä½“åº“/å¤–è¯­ç”µå½± ## æºç›®å½•ï¼š/media/æ•´ç†åŒº/åŠ¨ç”»ç”µå½±---\u0026gt;ç›®çš„ç›®å½•ï¼š/media/åª’ä½“åº“/åŠ¨ç”»ç”µå½± ## æºç›®å½•ï¼š/media/æ•´ç†åŒº/ç”µè§†å‰§é›†---\u0026gt;ç›®çš„ç›®å½•ï¼š/media/åª’ä½“åº“/ç”µè§†å‰§é›† # network_mode: bridge # æ¡¥æ¥ç½‘ç»œ # restart: unless-stopped # æ‰‹åŠ¨åœæ­¢åä¸ä¼šè‡ªåŠ¨é‡å¯ï¼Œç›´åˆ° Docker å®ˆæŠ¤è¿›ç¨‹é‡å¯ # restart: on-failure # ä»…åœ¨å¤±è´¥æ—¶é‡å¯ # restart: always # å§‹ç»ˆé‡å¯ # restart: no # å³å®¹å™¨ä¸ä¼šè¢«è‡ªåŠ¨é‡å¯ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½éœ€æ‰‹åŠ¨å¯åŠ¨ EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» ChineseSubFinder: http://localhost:19035 Jackett: http://localhost:9117 NASTools: http://localhost:3000 2. åˆå§‹é…ç½®æ­¥éª¤ ğŸ¯ ChineseSubFinder é…ç½®:\nè®¿é—® Web ç•Œé¢ è®¾ç½®ç®¡ç†å‘˜å¯†ç  é…ç½®åª’ä½“è·¯å¾„å’Œå­—å¹•æº Jackett é…ç½®:\nè®¿é—® Web ç•Œé¢ æ·»åŠ å’Œç®¡ç†ç´¢å¼•å™¨ è·å– API å¯†é’¥ NASTools é…ç½®:\nè®¿é—® Web ç•Œé¢ é»˜è®¤è´¦å·: admin / password ä¿®æ”¹å¯†ç å¹¶é…ç½®å„é¡¹è®¾ç½® ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è¯´æ˜: å¦‚éœ€é€šè¿‡åŸŸåè®¿é—®ï¼Œå¯é…ç½® Nginx åå‘ä»£ç†\n1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/nastools.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # ChineseSubFinder åå‘ä»£ç†é…ç½® server { listen 443 ssl; server_name sub.example.com; ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; location / { proxy_pass http://127.0.0.1:19035; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } # NASTools åå‘ä»£ç†é…ç½® server { listen 443 ssl; server_name nas.example.com; ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; location / { proxy_pass http://127.0.0.1:3000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/nastools # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop chinesesubfinder jackett nastools docker start chinesesubfinder jackett nastools docker restart chinesesubfinder jackett nastools # åˆ é™¤å®¹å™¨ docker rm chinesesubfinder jackett nastools # è¿›å…¥å®¹å™¨Shell docker exec -it nastools sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect nastools docker stats nastools # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs nastools docker logs -f nastools docker logs --tail 100 nastools docker logs -t nastools 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi allanpk716/chinesesubfinder:latest-lite linuxserver/jackett:latest diluka/nas-tools:2.9.1 docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªåª’ä½“ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† NASTools åª’ä½“ç®¡ç†å…¨å®¶æ¡¶ï¼Œé›†æˆäº† ChineseSubFinderã€Jackett å’Œ NASTools ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼Œæ„å»ºäº†ä¸€å¥—å®Œæ•´çš„åª’ä½“è‡ªåŠ¨åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨åŒ–å®Œæˆåª’ä½“æ–‡ä»¶çš„ä¸‹è½½ã€æ•´ç†ã€å­—å¹•è·å–å’Œå…ƒæ•°æ®åˆ®å‰Šï¼Œå¤§å¹…æå‡åª’ä½“åº“ç®¡ç†æ•ˆç‡\nğŸ” ç²¾å‡†æœç´¢ å€ŸåŠ© Jackett çš„å¼ºå¤§ç´¢å¼•åŠŸèƒ½ï¼Œå¿«é€Ÿå®šä½å’Œè·å–å„ç±»åª’ä½“èµ„æº\nğŸ“º å®Œç¾è§‚å½± é€šè¿‡ ChineseSubFinder è‡ªåŠ¨è·å–é«˜è´¨é‡ä¸­æ–‡å­—å¹•ï¼Œäº«å—æ— éšœç¢çš„è§‚å½±ä½“éªŒ\nğŸ¤– å…¨è‡ªåŠ¨æµç¨‹ ä»èµ„æºå‘ç°åˆ°æ•´ç†å½’æ¡£ï¼Œå®ç°çœŸæ­£çš„ä¸€ç«™å¼è‡ªåŠ¨åŒ–åª’ä½“ç®¡ç†\nåª’ä½“æ˜¯æ•°å­—ç”Ÿæ´»çš„ç²¾å½©ç¯‡ç« ï¼Œè‡ªåŠ¨åŒ–æ˜¯æ•ˆç‡æå‡çš„å…³é”®ã€‚æ„¿ NASTools å…¨å®¶æ¡¶æˆä¸ºä½ åª’ä½“ç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ æ„å»ºä¸€ä¸ªæ•´æ´ã€ä¸°å¯Œã€é«˜æ•ˆçš„åª’ä½“å¨±ä¹ä¸­å¿ƒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè§£æ”¾åŒæ‰‹ï¼Œäº«å—åª’ä½“â€”â€”æ„å»ºä½ æ™ºèƒ½åŒ–çš„æ•°å­—å¨±ä¹ç”Ÿæ€å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®å®šæœŸæ£€æŸ¥å„ç»„ä»¶æ›´æ–°ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ï¼š\nChineseSubFinder é¡¹ç›® Jackett é¡¹ç›® NASTools é¡¹ç›® ğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€å„é¡¹ç›®çš„ GitHub Issues é¡µé¢æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œåª’ä½“ç®¡ç†é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T16:04:39+08:00","image":"https://file.meimolihan.eu.org/img/nastools-01.webp","permalink":"https://blog.meimolihan.eu.org/p/198d0678/","title":"Docker éƒ¨ç½² NASTools åª’ä½“ç®¡ç†å…¨å®¶æ¡¶ ğŸ³"},{"content":"Linux æ–‡ä»¶åŠæ–‡ä»¶å¤¹ç®¡ç†å‘½ä»¤å¤§å…¨ ğŸ“ ğŸ§ Linux æ–‡ä»¶ä¸ç›®å½•æ“ä½œå®Œå…¨æŒ‡å— æŒæ¡ Linux æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ“ä½œæ˜¯ç³»ç»Ÿç®¡ç†çš„åŸºç¡€ï¼Œæœ¬æ–‡æ•´ç†äº†æœ€å¸¸ç”¨çš„æ–‡ä»¶ç®¡ç†å‘½ä»¤ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆåœ°è¿›è¡Œæ–‡ä»¶å’Œç›®å½•æ“ä½œã€‚\nğŸ“‹ ç›®å½• ğŸ“„ ä¸€ã€æ–‡ä»¶åˆ›å»ºå‘½ä»¤ 1. åˆ›å»ºç©ºæ–‡ä»¶ 2. åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ æ‰§è¡Œæƒé™ 3. åˆ›å»ºå¸¦æœ‰å†…å®¹çš„æ–‡ä»¶ 4. è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶ ğŸ“‚ äºŒã€ç›®å½•åˆ›å»ºå‘½ä»¤ 1. åˆ›å»ºå•ä¸ªç›®å½• 2. åˆ›å»ºå¤šçº§ç›®å½• 3. åˆ›å»ºç›®å½•å¹¶è®¾ç½®æƒé™ 4. åˆ›å»ºå¤šä¸ªç›®å½• ğŸ” ä¸‰ã€æ–‡ä»¶æƒé™ç®¡ç† 1. ä¿®æ”¹æ–‡ä»¶/ç›®å½•æƒé™ 2. é€’å½’ä¿®æ”¹æƒé™ 3. æ·»åŠ æ‰§è¡Œæƒé™ 4. ç§»é™¤æ‰§è¡Œæƒé™ 5. æŸ¥çœ‹æ–‡ä»¶æƒé™ 6. æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€… ğŸ”§ å››ã€æ–‡ä»¶æ“ä½œå‘½ä»¤ 1. æ–‡ä»¶é‡å‘½å 2. ç§»åŠ¨æ–‡ä»¶ 3. å¼ºåˆ¶åˆ é™¤æ–‡ä»¶ 4. äº¤äº’å¼åˆ é™¤æ–‡ä»¶ 5. æŸ¥æ‰¾æ–‡ä»¶ 6. æŸ¥æ‰¾å¹¶å¤„ç†æ–‡ä»¶ ğŸ§¹ äº”ã€æ¸…ç†ä¸ç»´æŠ¤å‘½ä»¤ 1. æ¸…ç©ºå½“å‰ç›®å½• 2. å®‰å…¨æ¸…ç©ºç›®å½• 3. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 4. æŸ¥çœ‹ç›®å½•å¤§å° ğŸ“– å…­ã€æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘ 1. æŸ¥çœ‹æ–‡ä»¶å†…å®¹ 2. åˆ†é¡µæŸ¥çœ‹æ–‡ä»¶ 3. æŸ¥çœ‹æ–‡ä»¶å¼€å¤´ 4. æŸ¥çœ‹æ–‡ä»¶æœ«å°¾ 5. å®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ– âš ï¸ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ’¡ å…«ã€å®ç”¨æŠ€å·§ 1. åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶ 2. æ‰¹é‡åˆ›å»ºæ–‡ä»¶ 3. å¤åˆ¶å¹¶ä¿ç•™æƒé™ 4. åˆ›å»ºè½¯é“¾æ¥ ğŸ¯ æ€»ç»“ ğŸ“„ ä¸€ã€æ–‡ä»¶åˆ›å»ºå‘½ä»¤ 1. åˆ›å»ºç©ºæ–‡ä»¶ 1 2 touch test.sh # ğŸ“ åˆ›å»ºä¸€ä¸ªåä¸º test.sh çš„ç©ºæ–‡ä»¶ 2. åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ æ‰§è¡Œæƒé™ 1 2 touch test.sh \u0026amp;\u0026amp; chmod +x test.sh # âš¡ åˆ›å»ºæ–‡ä»¶å¹¶ç«‹å³èµ‹äºˆå¯æ‰§è¡Œæƒé™ 3. åˆ›å»ºå¸¦æœ‰å†…å®¹çš„æ–‡ä»¶ 1 2 echo \u0026#34;#!/bin/bash\u0026#34; \u0026gt; test.sh # ğŸ“ åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥å†…å®¹ï¼ˆä¼šè¦†ç›–ç°æœ‰å†…å®¹ï¼‰ 4. è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶ 1 2 echo \u0026#34;echo \u0026#39;Hello World\u0026#39;\u0026#34; \u0026gt;\u0026gt; test.sh # â• åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ æ–°å†…å®¹ ğŸ“‚ äºŒã€ç›®å½•åˆ›å»ºå‘½ä»¤ 1. åˆ›å»ºå•ä¸ªç›®å½• 1 2 mkdir test # ğŸ“ åˆ›å»ºåä¸º test çš„ç›®å½• 2. åˆ›å»ºå¤šçº§ç›®å½• 1 2 mkdir -p /test/test1/test2 # ğŸŒ³ é€’å½’åˆ›å»ºå¤šçº§ç›®å½•ç»“æ„ 3. åˆ›å»ºç›®å½•å¹¶è®¾ç½®æƒé™ 1 2 mkdir -m 755 /test/test1 # ğŸ” åˆ›å»ºç›®å½•å¹¶ç›´æ¥è®¾ç½®æƒé™ä¸º 755 (rwxr-xr-x) 4. åˆ›å»ºå¤šä¸ªç›®å½• 1 2 mkdir dir1 dir2 dir3 # ğŸ“‚ ä¸€æ¬¡æ€§åˆ›å»ºå¤šä¸ªç›®å½• ğŸ” ä¸‰ã€æ–‡ä»¶æƒé™ç®¡ç† 1. ä¿®æ”¹æ–‡ä»¶/ç›®å½•æƒé™ 1 2 chmod 755 /test # ğŸ›¡ï¸ è®¾ç½®æƒé™ä¸º rwxr-xr-x (æ‰€æœ‰è€…å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç»„å’Œå…¶ä»–å¯è¯»å¯æ‰§è¡Œ) 2. é€’å½’ä¿®æ”¹æƒé™ 1 2 chmod -R 755 /test # ğŸ”„ é€’å½’ä¿®æ”¹ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶çš„æƒé™ 3. æ·»åŠ æ‰§è¡Œæƒé™ 1 2 chmod +x test.sh # â• ä¸ºæ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™ 4. ç§»é™¤æ‰§è¡Œæƒé™ 1 2 chmod -x test.sh # â– ç§»é™¤æ–‡ä»¶çš„æ‰§è¡Œæƒé™ 5. æŸ¥çœ‹æ–‡ä»¶æƒé™ 1 2 ls -l test.sh # ğŸ‘€ æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†æƒé™ä¿¡æ¯ 6. æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€… 1 2 chown user:group test.sh # ğŸ‘¤ æ›´æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„ ğŸ”§ å››ã€æ–‡ä»¶æ“ä½œå‘½ä»¤ 1. æ–‡ä»¶é‡å‘½å 1 2 mv test.sh test1.sh # ğŸ”„ å°† test.sh é‡å‘½åä¸º test1.sh 2. ç§»åŠ¨æ–‡ä»¶ 1 2 mv test.sh /new/location/ # ğŸšš å°†æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½® 3. å¼ºåˆ¶åˆ é™¤æ–‡ä»¶ 1 2 rm -rf /test/test.sh # ğŸ—‘ï¸ å¼ºåˆ¶åˆ é™¤æ–‡ä»¶ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰ 4. äº¤äº’å¼åˆ é™¤æ–‡ä»¶ 1 2 rm -i test.sh # â“ åˆ é™¤å‰ç¡®è®¤ï¼Œæ›´å®‰å…¨çš„æ–¹å¼ 5. æŸ¥æ‰¾æ–‡ä»¶ 1 2 find /mnt -iname test.sh # ğŸ” åœ¨ /mnt ç›®å½•ä¸­æœç´¢åä¸º test.sh çš„æ–‡ä»¶ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ 6. æŸ¥æ‰¾å¹¶å¤„ç†æ–‡ä»¶ 1 2 find /mnt -name \u0026#34;*.log\u0026#34; -exec rm {} \\; # ğŸ” æŸ¥æ‰¾å¹¶åˆ é™¤æ‰€æœ‰ .log æ–‡ä»¶ ğŸ§¹ äº”ã€æ¸…ç†ä¸ç»´æŠ¤å‘½ä»¤ 1. æ¸…ç©ºå½“å‰ç›®å½• 1 2 rm -rf * # ğŸ§¹ åˆ é™¤å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼ˆæå…¶å±é™©ï¼ï¼‰ 2. å®‰å…¨æ¸…ç©ºç›®å½• 1 2 find . -type f -delete # ğŸ§¹ åªåˆ é™¤æ–‡ä»¶ï¼Œä¿ç•™ç›®å½•ç»“æ„ 3. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 1 2 df -h # ğŸ’¾ æ˜¾ç¤ºç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼ˆäººç±»å¯è¯»æ ¼å¼ï¼‰ 4. æŸ¥çœ‹ç›®å½•å¤§å° 1 2 du -sh /test # ğŸ“Š æ˜¾ç¤ºç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´æ€»å¤§å° ğŸ“– å…­ã€æ–‡ä»¶æŸ¥çœ‹ä¸ç¼–è¾‘ 1. æŸ¥çœ‹æ–‡ä»¶å†…å®¹ 1 2 cat test.sh # ğŸ‘€ æ˜¾ç¤ºæ–‡ä»¶å…¨éƒ¨å†…å®¹ 2. åˆ†é¡µæŸ¥çœ‹æ–‡ä»¶ 1 2 less test.sh # ğŸ“– åˆ†é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼ˆå¯å‘å‰å‘åç¿»é¡µï¼‰ 3. æŸ¥çœ‹æ–‡ä»¶å¼€å¤´ 1 2 head -n 10 test.sh # ğŸ‘† æŸ¥çœ‹æ–‡ä»¶å‰10è¡Œ 4. æŸ¥çœ‹æ–‡ä»¶æœ«å°¾ 1 2 tail -n 10 test.sh # ğŸ‘‡ æŸ¥çœ‹æ–‡ä»¶æœ€å10è¡Œ 5. å®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ– 1 2 tail -f application.log # ğŸ” å®æ—¶ç›‘æ§æ—¥å¿—æ–‡ä»¶å˜åŒ– âš ï¸ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ è°¨æ…ä½¿ç”¨ rm -rfï¼šè¿™ä¸ªå‘½ä»¤ä¼šæ°¸ä¹…åˆ é™¤æ–‡ä»¶ï¼Œæ— æ³•æ¢å¤ å¤‡ä»½é‡è¦æ•°æ®ï¼šæ“ä½œå‰ç¡®ä¿é‡è¦æ–‡ä»¶å·²å¤‡ä»½ ä½¿ç”¨åˆ«åä¿æŠ¤ï¼šå¯ä»¥åœ¨ .bashrc ä¸­æ·»åŠ åˆ«åé˜²æ­¢è¯¯åˆ  1 alias rm=\u0026#39;rm -i\u0026#39; æ£€æŸ¥å½“å‰ç›®å½•ï¼šæ‰§è¡Œåˆ é™¤æ“ä½œå‰ä½¿ç”¨ pwd ç¡®è®¤å½“å‰ç›®å½• ä½¿ç”¨ trash-cliï¼šå®‰è£… trash-cli å·¥å…·ï¼Œå°†æ–‡ä»¶ç§»åˆ°å›æ”¶ç«™è€Œä¸æ˜¯ç›´æ¥åˆ é™¤ 1 trash-put test.sh ğŸ’¡ å…«ã€å®ç”¨æŠ€å·§ 1. åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶ 1 2 touch \u0026#34;backup_$(date +%Y%m%d_%H%M%S).log\u0026#34; # â° åˆ›å»ºå¸¦æœ‰æ—¶é—´æˆ³çš„æ–‡ä»¶å 2. æ‰¹é‡åˆ›å»ºæ–‡ä»¶ 1 2 touch file{1..10}.txt # ğŸ”¢ åˆ›å»º file1.txt åˆ° file10.txt 3. å¤åˆ¶å¹¶ä¿ç•™æƒé™ 1 2 cp -p source.txt destination.txt # ğŸ“‹ å¤åˆ¶æ–‡ä»¶å¹¶ä¿ç•™åŸå§‹æƒé™å’Œæ—¶é—´æˆ³ 4. åˆ›å»ºè½¯é“¾æ¥ 1 2 ln -s /path/to/file link_name # ğŸ”— åˆ›å»ºæŒ‡å‘æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ ğŸ¯ æ€»ç»“ æŒæ¡è¿™äº› Linux æ–‡ä»¶åŠæ–‡ä»¶å¤¹ç®¡ç†å‘½ä»¤å°†å¤§å¤§æé«˜æ‚¨åœ¨ Linux ç¯å¢ƒä¸‹çš„å·¥ä½œæ•ˆç‡ï¼è®°å¾—å§‹ç»ˆè°¨æ…æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨åˆ é™¤å‘½ä»¤æ—¶ã€‚\nğŸ’¡ å…³é”®è¦ç‚¹ï¼š å¤‡ä»½ä¼˜å…ˆï¼šé‡è¦æ–‡ä»¶æ“ä½œå‰åŠ¡å¿…å¤‡ä»½ æƒé™ç®¡ç†ï¼šæ­£ç¡®è®¾ç½®æ–‡ä»¶æƒé™ä¿éšœç³»ç»Ÿå®‰å…¨ è°¨æ…åˆ é™¤ï¼šä½¿ç”¨ -i å‚æ•°æˆ–åˆ«åä¿æŠ¤é˜²æ­¢è¯¯åˆ  å–„ç”¨æŸ¥æ‰¾ï¼šfind å‘½ä»¤æ˜¯æ–‡ä»¶ç®¡ç†çš„å¼ºå¤§å·¥å…· å®æ—¶ç›‘æ§ï¼štail -f å¯¹äºæ—¥å¿—ç›‘æ§éå¸¸æœ‰ç”¨ ğŸ”„ æ‰©å±•å­¦ä¹ ï¼š å­¦ä¹ ä½¿ç”¨ rsync è¿›è¡Œæ–‡ä»¶åŒæ­¥ æŒæ¡ tar å’Œ gzip è¿›è¡Œæ–‡ä»¶å‹ç¼©å’Œè§£å‹ äº†è§£ inotifywait ç›‘æ§æ–‡ä»¶ç³»ç»Ÿå˜åŒ– å­¦ä¹ ä½¿ç”¨ mc (Midnight Commander) æ–‡ä»¶ç®¡ç†å™¨ ğŸš€ å®è·µæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼Œåœ¨å®‰å…¨çš„ç¯å¢ƒä¸­å¤šå¤šç»ƒä¹ è¿™äº›å‘½ä»¤ï¼Œå¾ˆå¿«ä½ å°±èƒ½æˆä¸º Linux æ–‡ä»¶ç®¡ç†é«˜æ‰‹ï¼\n","date":"2024-12-07T16:02:30+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8bc7b7e3/","title":"Linux æ–‡ä»¶åŠæ–‡ä»¶å¤¹ç®¡ç†å‘½ä»¤å¤§å…¨ ğŸ“"},{"content":"Linux æ–‡ä»¶ç¼–è¾‘ \u0026amp; è¦†ç›–ä¸è¿½åŠ  ä¸€ ã€è¦†ç›–æ–‡æœ¬å†…å®¹ 1 ã€è¦†ç›–æ–‡æœ¬å†…å®¹ï¼Œæ–¹æ³•ä¸€ 1 2 3 4 5 6 7 8 9 mkdir -pm 755 /mnt/test \u0026amp;\u0026amp; \\ touch /mnt/test/test.txt \u0026amp;\u0026amp; \\ chmod +x /mnt/test/test.txt \u0026amp;\u0026amp; \\ cat \u0026gt; /mnt/test/test.txt \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## mkdir -pm 755 /mnt/test æ–°å»º/mntæ–‡ä»¶å¤¹å¹¶èµ‹äºˆè¯»å†™æƒé™ ## touch /mnt/test/test.txt æ–°å»º/mnt/test.txtæ–‡ä»¶ ## chmod +x /mnt/test/test.txt èµ‹äºˆ/mnt/test.txtå¯æ‰§è¡Œæƒé™ ## cat \u0026gt; /mnt/test/test.txt \u0026lt;\u0026lt;EOF è¦†ç›–/mnt/test.txtå†…å®¹ EOF 2 ã€è¦†ç›–æ–‡æœ¬å†…å®¹ï¼Œæ–¹æ³•äºŒ 1 2 3 4 5 6 7 8 9 mkdir -pm 755 /mnt/test \u0026amp;\u0026amp; \\ touch /mnt/test/test.txt \u0026amp;\u0026amp; \\ chmod +x /mnt/test/test.txt \u0026amp;\u0026amp; \\ tee /mnt/test/test.txt \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## mkdir -pm 755 /mnt/test æ–°å»º/mnt/testæ–‡ä»¶å¤¹å¹¶èµ‹äºˆè¯»å†™æƒé™ ## touch /mnt/test/test.txt æ–°å»º/mnt/test/test.txtæ–‡ä»¶ ## chmod +x /mnt/test/test.txt èµ‹äºˆ/mnt/test/test.txtå¯æ‰§è¡Œæƒé™ ## tee /mnt/test/test.txt \u0026lt;\u0026lt;EOF è¦†ç›–/mnt/test/test.txtå†…å®¹ EOF äºŒ ã€è¿½åŠ æ–‡æœ¬å†…å®¹ 1 ã€è¿½åŠ æ–‡æœ¬å†…å®¹ï¼Œæ–¹æ³•ä¸€ 1 2 3 4 5 6 7 8 9 mkdir -pm 755 /mnt/test \u0026amp;\u0026amp; \\ touch /mnt/test/test.txt \u0026amp;\u0026amp; \\ chmod +x /mnt/test/test.txt \u0026amp;\u0026amp; \\ cat \u0026gt;\u0026gt;/mnt/test/test.txt \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## mkdir -pm 755 /mnt/test æ–°å»º/mnt/testæ–‡ä»¶å¤¹å¹¶èµ‹äºˆè¯»å†™æƒé™ ## touch /mnt/test/test.txt æ–°å»º/mnt/test/test.txtæ–‡ä»¶ ## chmod +x /mnt/test/test.txt èµ‹äºˆ/mnt/test/test.txtå¯æ‰§è¡Œæƒé™ ## cat \u0026gt;\u0026gt;/mnt/test/test.txt \u0026lt;\u0026lt;EOF è¿½åŠ /mnt/test/test.txtå†…å®¹ EOF 2 ã€è¿½åŠ æ–‡æœ¬å†…å®¹ï¼Œæ–¹æ³•äºŒ 1 2 3 4 5 6 7 8 9 mkdir -pm 755 /mnt/test \u0026amp;\u0026amp; \\ touch /mnt/test/test.txt \u0026amp;\u0026amp; \\ chmod +x /mnt/test/test.txt \u0026amp;\u0026amp; \\ tee -a /mnt/test/test.txt \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## mkdir -pm 755 /mnt/test æ–°å»º/mnt/testæ–‡ä»¶å¤¹å¹¶èµ‹äºˆè¯»å†™æƒé™ ## touch /mnt/test/test.txt æ–°å»º/mnt/test/test.txtæ–‡ä»¶ ## chmod +x /mnt/test/test.txt èµ‹äºˆ/mnt/test/test.txtå¯æ‰§è¡Œæƒé™ ## tee -a /mnt/test/test.txt \u0026lt;\u0026lt;EOF è¿½åŠ /mnt/test/test.txtå†…å®¹ EOF ä¸‰ ã€æµ‹è¯•æ–‡ä»¶æŸ¥çœ‹ä¸åˆ é™¤ 1 ã€æŸ¥çœ‹å†…å®¹ 1 cat /mnt/test/test.txt ## æŸ¥çœ‹å†…å®¹ 2 ã€åˆ é™¤æ–‡ä»¶ 1 rm /mnt/test/test.txt ## åˆ é™¤æ–‡ä»¶ ","date":"2024-12-07T16:01:18+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/fe74ee62/","title":"Linux æ–‡ä»¶ç¼–è¾‘ \u0026 è¦†ç›–ä¸è¿½åŠ "},{"content":"ç¾¤æ™–ç¬¬ä¸‰æ–¹å¥—ä»¶æºå¤§å…¨ ğŸ—ƒï¸ ğŸ”„ æ‰©å±•æ‚¨çš„ç¾¤æ™–NASåŠŸèƒ½ï¼Œè·å–ä¸°å¯Œç¬¬ä¸‰æ–¹åº”ç”¨ï¼ç¬¬ä¸‰æ–¹å¥—ä»¶æºä¸ºæ‚¨æ‰“å¼€ä¸€æ‰‡æ–°ä¸–ç•Œçš„å¤§é—¨ï¼Œè®©æ‚¨çš„ç¾¤æ™–NASå‘æŒ¥æ›´å¤§æ½œåŠ›ã€‚\n\u0026ndash;\nâœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ¯ ä¸°å¯Œåº”ç”¨ç”Ÿæ€ - æä¾›å®˜æ–¹å•†åº—ä¹‹å¤–çš„æµ·é‡åº”ç”¨é€‰æ‹© âš¡ å¿«é€Ÿè·å–æ›´æ–° - ç¬¬ä¸€æ—¶é—´è·å–æœ€æ–°ç‰ˆæœ¬çš„åº”ç”¨è½¯ä»¶ ğŸ”“ è§£é”é«˜çº§åŠŸèƒ½ - è®¿é—®é‚£äº›å®˜æ–¹å•†åº—æœªæä¾›çš„ç‰¹è‰²åº”ç”¨ ğŸŒ å…¨çƒèµ„æºæ•´åˆ - æ±‡é›†ä¸–ç•Œå„åœ°å¼€å‘è€…åˆ¶ä½œçš„ä¼˜ç§€å¥—ä»¶ ğŸ†“ å®Œå…¨å…è´¹ä½¿ç”¨ - å¤§å¤šæ•°ç¬¬ä¸‰æ–¹å¥—ä»¶æºéƒ½æ˜¯å…è´¹æä¾›çš„ \u0026ndash;\nğŸ“‹ ç›®å½• ğŸ¯ å¥—ä»¶æºç®€ä»‹ ğŸŒŸ æ¨èæºåˆ—è¡¨ ğŸ”§ æ·»åŠ æ–¹æ³• âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ’¡ ä½¿ç”¨æŠ€å·§ ğŸ“¦ çƒ­é—¨æ¨èå¥—ä»¶ ğŸ¯ å¥—ä»¶æºç®€ä»‹ ç¬¬ä¸‰æ–¹å¥—ä»¶æºä¸ºç¾¤æ™–DSMç³»ç»Ÿæä¾›äº†å®˜æ–¹å•†åº—ä¹‹å¤–çš„å¤§é‡å®ç”¨åº”ç”¨ç¨‹åºï¼Œæ¶µç›–ä¸‹è½½å·¥å…·ã€åª’ä½“æœåŠ¡å™¨ã€å¤‡ä»½å·¥å…·ã€å¼€å‘å·¥å…·ç­‰å¤šä¸ªç±»åˆ«ã€‚ğŸŒ\nè¿™äº›æºç”±å…¨çƒå¼€å‘è€…ç¤¾åŒºç»´æŠ¤ï¼Œä¸ºæ‚¨æä¾›ï¼š\nğŸ†• æœ€æ–°åº”ç”¨ç‰ˆæœ¬ - æ¯”å®˜æ–¹æºæ›´æ—©è·å¾—æ›´æ–° ğŸ› ï¸ ä¸“ä¸šå·¥å…· - å¼€å‘ã€è¿ç»´ç­‰ä¸“ä¸šé¢†åŸŸå·¥å…· ğŸ® å¨±ä¹åº”ç”¨ - å„ç§åª’ä½“å’Œæ¸¸æˆæœåŠ¡å™¨ ğŸ” å®‰å…¨å·¥å…· - ç½‘ç»œå®‰å…¨å’Œéšç§ä¿æŠ¤åº”ç”¨ ğŸŒŸ æ¨èæºåˆ—è¡¨ ğŸ¥‡ ä¸»æµæ¨èæº æ¥æºåç§° åœ°å€ çŠ¶æ€ ç‰¹è‰² æ¨èæŒ‡æ•° ğŸ† çŸ¿ç¥æº https://spk7.imnks.com/ âœ… æ´»è·ƒ å›½å†…é€Ÿåº¦æœ€å¿«ï¼Œåº”ç”¨ä¸°å¯Œï¼Œä¸­æ–‡æ”¯æŒå®Œå–„ â˜…â˜…â˜…â˜…â˜… ğŸŒ¸ äº‘æ¢¦æº https://spk.520810.xyz:666 âœ… æ´»è·ƒ åº”ç”¨é½å…¨ï¼Œæ›´æ–°åŠæ—¶ï¼Œç•Œé¢å‹å¥½ â˜…â˜…â˜…â˜…â˜† ğŸŒ SynoCommunity https://packages.synocommunity.com âœ… æ´»è·ƒ å›½é™…çŸ¥åç¤¾åŒºæºï¼Œåº”ç”¨è´¨é‡é«˜ â˜…â˜…â˜…â˜…â˜† ğŸ¥ˆ å¤‡ç”¨é€‰æ‹©æº æ¥æºåç§° åœ°å€ çŠ¶æ€ å¤‡æ³¨ æ¨èæŒ‡æ•° ğŸ» 4sagæº https://spk.4sag.ru/ âš ï¸ å¶å°”ä¸ç¨³å®š ä¿„ç½—æ–¯æºï¼Œæœ‰ä¸€äº›ç‰¹è‰²åº”ç”¨ â˜…â˜…â˜…â˜†â˜† ğŸ‘» è£™ä¸‹å­¤é­‚ http://spk.bobohome.store:8880 ğŸ”„ ä¸å®šæ—¶æ›´æ–° ä¸ªäººç»´æŠ¤æºï¼Œæœ‰ä¸€äº›ç‹¬ç‰¹å¥—ä»¶ â˜…â˜…â˜…â˜†â˜† ğŸ‡¨ğŸ‡­ Syscoæº http://synology.sysco.ch/ âš ï¸ æ›´æ–°è¾ƒæ…¢ ç‘å£«æºï¼Œæ¬§æ´²ç”¨æˆ·è®¿é—®è¾ƒå¿« â˜…â˜…â˜†â˜†â˜† ğŸ¥‰ å…¶ä»–å¯ç”¨æº æ¥æºåç§° åœ°å€ çŠ¶æ€ æ¨èæŒ‡æ•° ğŸŒ Acmenetæº http://synology.acmenet.ru/ ğŸ”„ å¶å°”æ›´æ–° â˜…â˜…â˜†â˜†â˜† â¹ï¸ Cphubæº http://www.cphub.net âŒ å·²åŸºæœ¬åœæ›´ â˜…â˜†â˜†â˜†â˜† ğŸ”§ æ·»åŠ æ–¹æ³• ğŸ“± é€šè¿‡DSMç•Œé¢æ·»åŠ  æ‰“å¼€å¥—ä»¶ä¸­å¿ƒ - åœ¨DSMæ¡Œé¢æ‰¾åˆ°å¹¶ç‚¹å‡»\u0026quot;å¥—ä»¶ä¸­å¿ƒ\u0026quot;å›¾æ ‡ ç‚¹å‡»è®¾ç½® â†’ å¥—ä»¶æ¥æº - åœ¨å·¦ä¸Šè§’ç‚¹å‡»è®¾ç½®æŒ‰é’® ç‚¹å‡»æ–°å¢ - è¾“å…¥åç§°å’ŒURLåœ°å€ ç‚¹å‡»ç¡®å®šä¿å­˜ - å®Œæˆæ·»åŠ åå³å¯åœ¨å¥—ä»¶ä¸­å¿ƒçœ‹åˆ°æ–°æºä¸­çš„å¥—ä»¶ ğŸ–¥ï¸ é€šè¿‡SSHæ·»åŠ ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰ 1 2 3 4 5 6 7 8 9 10 # å¤‡ä»½åŸæœ‰æºåˆ—è¡¨ sudo cp /etc/syno_repos.conf /etc/syno_repos.conf.bak # æ·»åŠ æ–°æºï¼ˆç¤ºä¾‹ï¼šçŸ¿ç¥æºï¼‰ echo \u0026#34;[çŸ¿ç¥æº] url=https://spk7.imnks.com/ trusted=no\u0026#34; | sudo tee -a /etc/syno_repos.conf # é‡å¯å¥—ä»¶ä¸­å¿ƒæœåŠ¡ sudo synopkg restart PackageCenter ğŸ”„ æ‰¹é‡æ·»åŠ è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/bin/bash # æ‰¹é‡æ·»åŠ å¸¸ç”¨æº SOURCES=( \u0026#34;çŸ¿ç¥æº,https://spk7.imnks.com/\u0026#34; \u0026#34;äº‘æ¢¦æº,https://spk.520810.xyz:666\u0026#34; \u0026#34;SynoCommunity,https://packages.synocommunity.com\u0026#34; ) for source in \u0026#34;${SOURCES[@]}\u0026#34;; do IFS=\u0026#39;,\u0026#39; read -r name url \u0026lt;\u0026lt;\u0026lt; \u0026#34;$source\u0026#34; echo \u0026#34;[$name] url=$url trusted=no\u0026#34; | sudo tee -a /etc/syno_repos.conf done # é‡å¯æœåŠ¡ä½¿æ›´æ”¹ç”Ÿæ•ˆ sudo synopkg restart PackageCenter ğŸ“ æ·»åŠ åçš„æ“ä½œ åˆ·æ–°å¥—ä»¶åˆ—è¡¨ - æ·»åŠ æºåè¿”å›å¥—ä»¶ä¸­å¿ƒä¸»ç•Œé¢ ç­‰å¾…åŠ è½½ - ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½æ–°æºçš„å¥—ä»¶åˆ—è¡¨ å¼€å§‹æµè§ˆ - åœ¨\u0026quot;ç¤¾ç¾¤\u0026quot;é€‰é¡¹å¡ä¸­æŸ¥çœ‹ç¬¬ä¸‰æ–¹å¥—ä»¶ âš ï¸ æ³¨æ„äº‹é¡¹ 1. ğŸ”’ å®‰å…¨é£é™© ç¬¬ä¸‰æ–¹æºä¸å—ç¾¤æ™–å®˜æ–¹è®¤è¯ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™© åªä»å¯ä¿¡æ¥æºæ·»åŠ å¥—ä»¶æºï¼Œä¼˜å…ˆé€‰æ‹©çŸ¥åç¤¾åŒºæº å®šæœŸæ£€æŸ¥æºçš„å®‰å…¨æ€§çŠ¶æ€ï¼Œå…³æ³¨ç›¸å…³ç¤¾åŒºå…¬å‘Š å®‰è£…å‰æŸ¥çœ‹å¥—ä»¶è¯„ä»·å’Œä¸‹è½½æ¬¡æ•°ï¼Œé€‰æ‹©å—æ¬¢è¿çš„åº”ç”¨ 2. âš ï¸ å…¼å®¹æ€§é—®é¢˜ æŸäº›å¥—ä»¶å¯èƒ½ä¸æœ€æ–°DSMç‰ˆæœ¬ä¸å…¼å®¹ å®‰è£…å‰åŠ¡å¿…æŸ¥çœ‹å…¼å®¹æ€§ä¿¡æ¯ï¼Œç¡®è®¤æ”¯æŒæ‚¨çš„DSMç‰ˆæœ¬ å¤‡ä»½é‡è¦æ•°æ®åå†å®‰è£…æ–°å¥—ä»¶ï¼Œé˜²æ­¢æ„å¤–æ•°æ®ä¸¢å¤± æ³¨æ„å¥—ä»¶æ¶æ„æ”¯æŒï¼Œç¡®ä¿å…¼å®¹æ‚¨çš„NASå‹å· 3. ğŸ”„ æ›´æ–°ç­–ç•¥ å»ºè®®å®šæœŸæ£€æŸ¥æºçš„æœ‰æ•ˆæ€§ï¼Œç§»é™¤å¤±æ•ˆçš„æº å…³æ³¨æºç«™ç‚¹çš„æ›´æ–°å…¬å‘Šï¼Œäº†è§£æœ€æ–°åŠ¨æ€ è®¾ç½®æ›´æ–°æé†’ï¼ŒåŠæ—¶è·å–å®‰å…¨æ›´æ–° ä¿ç•™2-3ä¸ªä¸»æµæºå³å¯ï¼Œé¿å…æºè¿‡å¤šé€ æˆæ··ä¹± 4. ğŸ¢ æ€§èƒ½å½±å“ æ·»åŠ è¿‡å¤šæºå¯èƒ½å‡æ…¢å¥—ä»¶ä¸­å¿ƒåŠ è½½é€Ÿåº¦ åªä¿ç•™å¸¸ç”¨æºï¼Œå®šæœŸæ¸…ç†ä¸å†ä½¿ç”¨çš„æº å¦‚æœåŠ è½½ç¼“æ…¢ï¼Œå¯ä»¥æš‚æ—¶ç¦ç”¨éƒ¨åˆ†æº è€ƒè™‘ä½¿ç”¨æœ¬åœ°æºæˆ–é•œåƒæºæå‡è®¿é—®é€Ÿåº¦ 5. ğŸ“œ æ³•å¾‹åˆè§„ ç¡®ä¿å®‰è£…çš„å¥—ä»¶ç¬¦åˆå½“åœ°æ³•å¾‹æ³•è§„ é¿å…å®‰è£…ç‰ˆæƒå­˜ç–‘çš„å¥—ä»¶å’Œåº”ç”¨ æ³¨æ„æ•°æ®éšç§å’Œä¿æŠ¤æ”¿ç­– ğŸ’¡ ä½¿ç”¨æŠ€å·§ ğŸ¯ æœ€ä½³å®è·µ 1 2 3 4 # æ¨èåªæ·»åŠ 2-3ä¸ªä¸»æµæº # 1. çŸ¿ç¥æº (å›½å†…ç”¨æˆ·é¦–é€‰) - ä¸°å¯Œçš„ä¸­æ–‡åº”ç”¨ # 2. SynoCommunity (å›½é™…ç¤¾åŒº) - é«˜è´¨é‡çš„å›½é™…åº”ç”¨ # 3. æ ¹æ®éœ€æ±‚é€‰æ‹©1ä¸ªä¸“ä¸šæº - å¦‚ç‰¹å®šé¢†åŸŸçš„ä¸“ç”¨æº ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³ âŒ æºæ— æ³•è¿æ¥\næ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ ç¡®è®¤æºåœ°å€æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦æœ‰æ‹¼å†™é”™è¯¯ å°è¯•ä½¿ç”¨HTTPSæ›¿ä»£HTTPï¼Œæˆ–åä¹‹ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿æœªé˜»æ­¢è®¿é—® ğŸ“¦ å¥—ä»¶å®‰è£…å¤±è´¥\næ£€æŸ¥DSMç‰ˆæœ¬å…¼å®¹æ€§ï¼Œç¡®è®¤å¥—ä»¶æ”¯æŒæ‚¨çš„ç‰ˆæœ¬ æŸ¥çœ‹å¥—ä»¶ä¾èµ–å…³ç³»ï¼Œæ˜¯å¦ç¼ºå°‘å¿…è¦ç»„ä»¶ æ£€æŸ¥ç³»ç»Ÿæ¶æ„æ”¯æŒï¼Œç¡®ä¿å¥—ä»¶å…¼å®¹æ‚¨çš„NASå‹å· æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š/var/log/synopkg.log ğŸ” æºè¯ä¹¦é”™è¯¯\nå¯¹äºè‡ªç­¾åè¯ä¹¦æºï¼Œå¯é€‰æ‹©\u0026quot;ä¿¡ä»»æ­¤æº\u0026quot; æˆ–ä½¿ç”¨HTTPåè®®ï¼ˆæ³¨æ„å®‰å…¨æ€§è¾ƒä½ï¼‰ è€ƒè™‘æ‰‹åŠ¨å¯¼å…¥è¯ä¹¦åˆ°ç³»ç»Ÿä¿¡ä»»åº“ æ›´æ–°ç³»ç»ŸCAè¯ä¹¦åŒ…ï¼šsudo update-ca-certificates ğŸ“Š æºçŠ¶æ€æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥æºå“åº”é€Ÿåº¦ curl -o /dev/null -s -w \u0026#34;%{time_total}s\\n\u0026#34; https://spk7.imnks.com/ # æ£€æŸ¥æºæ˜¯å¦å¯ç”¨ ping -c 4 $(echo https://spk7.imnks.com/ | awk -F/ \u0026#39;{print $3}\u0026#39;) # æŸ¥çœ‹å½“å‰å·²é…ç½®çš„æº cat /etc/syno_repos.conf # æ£€æŸ¥æºæ›´æ–°çŠ¶æ€ synopkg update ğŸ”§ é«˜çº§ç®¡ç†æŠ€å·§ ğŸ’¾ å¤‡ä»½æºé…ç½®\n1 2 3 4 5 # å¤‡ä»½æºåˆ—è¡¨ sudo cp /etc/syno_repos.conf /etc/syno_repos.conf.backup.$(date +%Y%m%d) # å¯¼å‡ºå·²å®‰è£…å¥—ä»¶åˆ—è¡¨ synopkg list --installed \u0026gt; installed_packages_$(date +%Y%m%d).txt âš¡ åŠ é€ŸæŠ€å·§\nä½¿ç”¨å›½å†…é•œåƒæºæå‡ä¸‹è½½é€Ÿåº¦ è®¾ç½®ä»£ç†æœåŠ¡å™¨è®¿é—®å›½å¤–æº å®šæœŸæ¸…ç†å¥—ä»¶ç¼“å­˜ï¼šsudo rm -rf /var/cache/synopkg/* ğŸ”„ æ›´æ–°ç­–ç•¥\nè®¾ç½®è‡ªåŠ¨æ£€æŸ¥æ›´æ–°é¢‘ç‡ é‡è¦å¥—ä»¶æ‰‹åŠ¨æ£€æŸ¥æ›´æ–° å»ºç«‹æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯æ›´æ–°å…¼å®¹æ€§ ğŸ“¦ çƒ­é—¨æ¨èå¥—ä»¶ ğŸ¬ åª’ä½“å¨±ä¹ Jellyfin - å¼€æºåª’ä½“æœåŠ¡å™¨ï¼Œå®Œå…¨å…è´¹ä¸”åŠŸèƒ½å¼ºå¤§ ğŸ†“ Plex - å¤šåª’ä½“ä¸²æµæœåŠ¡ï¼Œç•Œé¢ç¾è§‚æ˜“ç”¨ ğŸŒŸ Emby - åª’ä½“ç®¡ç†æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šç§å®¢æˆ·ç«¯ ğŸ“± HandBrake - è§†é¢‘è½¬ç å·¥å…·ï¼Œæ”¯æŒå¤šç§æ ¼å¼ ğŸ”„ ğŸ“¥ ä¸‹è½½å·¥å…· qBittorrent - BTä¸‹è½½å®¢æˆ·ç«¯ï¼Œè½»é‡ä¸”åŠŸèƒ½å®Œå–„ âš¡ Transmission - è½»é‡çº§BTå®¢æˆ·ç«¯ï¼Œèµ„æºå ç”¨ä½ ğŸƒ Aria2 - å¤šåŠŸèƒ½ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒå¤šç§åè®® ğŸ› ï¸ Download Station - ç¾¤æ™–å®˜æ–¹ä¸‹è½½å·¥å…·å¢å¼ºç‰ˆ ğŸ“¦ ğŸ”„ åŒæ­¥å¤‡ä»½ CloudSync - äº‘å­˜å‚¨åŒæ­¥ï¼Œæ”¯æŒå¤šå®¶äº‘æœåŠ¡å•† â˜ï¸ Syncthing - å»ä¸­å¿ƒåŒ–æ–‡ä»¶åŒæ­¥ï¼Œå®‰å…¨ç§å¯† ğŸ”’ Duplicati - åŠ å¯†å¤‡ä»½å·¥å…·ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ ğŸ’¾ BorgBackup - å»é‡å¤‡ä»½å·¥å…·ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ ğŸ—œï¸ ğŸ›¡ï¸ ç½‘ç»œå·¥å…· VPN Server - VPNæœåŠ¡ç«¯ï¼Œæ”¯æŒå¤šç§åè®® ğŸŒ WireGuard - ç°ä»£VPNåè®®ï¼Œé€Ÿåº¦å¿«å®‰å…¨æ€§é«˜ âš¡ Fail2ban - å®‰å…¨é˜²æŠ¤å·¥å…·ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£ ğŸ›¡ï¸ Pi-hole - ç½‘ç»œå¹¿å‘Šæ‹¦æˆªï¼Œæå‡æµè§ˆä½“éªŒ ğŸš« ğŸ› ï¸ å¼€å‘å·¥å…· Docker - å®¹å™¨å¹³å°ï¼Œè½»æ¾éƒ¨ç½²å„ç§åº”ç”¨ ğŸ³ Node.js - JavaScriptè¿è¡Œç¯å¢ƒï¼ŒWebå¼€å‘å¿…å¤‡ ğŸŸ¢ Python - ç¼–ç¨‹è¯­è¨€ç¯å¢ƒï¼Œæ•°æ®ç§‘å­¦å’Œè‡ªåŠ¨åŒ– ğŸ PHP - è„šæœ¬è¯­è¨€æ”¯æŒï¼ŒWebå¼€å‘å¸¸ç”¨å·¥å…· ğŸ˜ ğŸ“Š å®ç”¨å·¥å…· WebStation - WebæœåŠ¡å™¨ï¼Œæ‰˜ç®¡ç½‘ç«™å’Œåº”ç”¨ ğŸŒ MariaDB - æ•°æ®åº“æœåŠ¡å™¨ï¼ŒMySQLæ›¿ä»£å“ ğŸ—ƒï¸ Photo Station - ç…§ç‰‡ç®¡ç†å·¥å…·ï¼Œå±•ç¤ºå’Œåˆ†äº« ğŸ“¸ Note Station - ç¬”è®°åº”ç”¨ï¼Œå¤šè®¾å¤‡åŒæ­¥ ğŸ“ ğŸ  æ™ºèƒ½å®¶å±… Home Assistant - æ™ºèƒ½å®¶å±…ä¸­å¿ƒï¼Œé›†æˆå¤šç§è®¾å¤‡ ğŸ¡ OpenHAB - å®¶å±…è‡ªåŠ¨åŒ–å¹³å°ï¼Œé«˜åº¦å¯å®šåˆ¶ ğŸ”§ Node-RED - æµç¨‹ç¼–ç¨‹å·¥å…·ï¼Œç‰©è”ç½‘å¼€å‘ ğŸ”„ ğŸ” å¥—ä»¶ä¸­å¿ƒç•Œé¢ ğŸ’¡ æç¤ºï¼šç¬¬ä¸‰æ–¹æºæä¾›çš„å¥—ä»¶å¹¶éå®˜æ–¹è®¤è¯ï¼Œä½¿ç”¨æ—¶è¯·è‡ªè¡Œè¯„ä¼°é£é™©ã€‚å»ºè®®ä¼˜å…ˆé€‰æ‹©æ´»è·ƒç»´æŠ¤ã€ç¤¾åŒºè®¤å¯åº¦é«˜çš„æºï¼Œå¹¶å®šæœŸæ£€æŸ¥æ›´æ–°å’Œå®‰å…¨å…¬å‘Šã€‚\nğŸ‰ å¼€å§‹æ¢ç´¢å§ï¼ ç°åœ¨æ‚¨å·²ç»äº†è§£äº†ç¾¤æ™–ç¬¬ä¸‰æ–¹å¥—ä»¶æºçš„å…¨éƒ¨ä¿¡æ¯ï¼Œå¼€å§‹æ¢ç´¢ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº”ç”¨ä¸–ç•Œå§ï¼è®°å¾—ï¼š\nâœ… ä»å¯ä¿¡æºå¼€å§‹ - é€‰æ‹©çŸ¥åç¤¾åŒºç»´æŠ¤çš„æº ğŸ”„ å®šæœŸæ›´æ–°ç»´æŠ¤ - ä¿æŒå¥—ä»¶å’Œæºçš„æœ€æ–°çŠ¶æ€ ğŸ“‹ è®°å½•å®‰è£…çš„å¥—ä»¶ - ä¾¿äºç®¡ç†å’Œæ•…éšœæ’æŸ¥ ğŸ›¡ï¸ æ³¨æ„å®‰å…¨é˜²æŠ¤ - åªå®‰è£…æ¥è‡ªå¯ä¿¡æ¥æºçš„å¥—ä»¶ ğŸ¤ å‚ä¸ç¤¾åŒºäº¤æµ - åˆ†äº«ä½¿ç”¨ç»éªŒå’Œé—®é¢˜è§£å†³æ–¹æ³• äº«å—æ‚¨çš„ç¾¤æ™–NASæ‰©å±•ä¹‹æ—…ï¼ğŸš€ æ¢ç´¢æ— é™å¯èƒ½ï¼Œæ‰“é€ ä¸“å±æ‚¨çš„æ™ºèƒ½æ•°å­—ç”Ÿæ´»ä¸­å¿ƒã€‚\nğŸ“š å»¶ä¼¸é˜…è¯» ç¾¤æ™–å®˜æ–¹å¥—ä»¶ä¸­å¿ƒæŒ‡å— ç¬¬ä¸‰æ–¹å¥—ä»¶å¼€å‘æ–‡æ¡£ ç¾¤æ™–NASä½¿ç”¨æŠ€å·§è®ºå› â“ å¸¸è§é—®é¢˜ Q: ç¬¬ä¸‰æ–¹æºä¼šå½±å“NASçš„ä¿ä¿®å—ï¼Ÿ\nA: ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šï¼Œä½†å¦‚æœå› ç¬¬ä¸‰æ–¹å¥—ä»¶å¯¼è‡´ç¡¬ä»¶æŸåï¼Œå¯èƒ½ä¸åœ¨ä¿ä¿®èŒƒå›´å†…ã€‚\nQ: å¦‚ä½•å½»åº•ç§»é™¤ä¸€ä¸ªå¥—ä»¶æºï¼Ÿ\nA: åœ¨å¥—ä»¶ä¸­å¿ƒè®¾ç½®ä¸­åˆ é™¤æºï¼Œæˆ–é€šè¿‡SSHç¼–è¾‘/etc/syno_repos.confæ–‡ä»¶ç§»é™¤å¯¹åº”æ¡ç›®ã€‚\nQ: ä¸ºä»€ä¹ˆæ·»åŠ æºåçœ‹ä¸åˆ°å¥—ä»¶ï¼Ÿ\nA: å¯èƒ½æ˜¯æºæš‚æ—¶ä¸å¯ç”¨ï¼Œæˆ–è€…ä¸æ‚¨çš„DSMç‰ˆæœ¬ä¸å…¼å®¹ã€‚å°è¯•åˆ·æ–°æˆ–æ£€æŸ¥æºçŠ¶æ€ã€‚\nQ: å®‰è£…ç¬¬ä¸‰æ–¹å¥—ä»¶ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±å—ï¼Ÿ\nA: æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šï¼Œä½†å»ºè®®é‡è¦æ•°æ®å®šæœŸå¤‡ä»½ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚\nğŸ“… æœ€åæ›´æ–°æ—¥æœŸï¼š 2024å¹´3æœˆ\nğŸ”„ æœ¬æ–‡æŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿åé¦ˆå’Œå»ºè®®ï¼\n","date":"2024-12-07T16:00:55+08:00","image":"https://file.meimolihan.eu.org/img/dsm-01.webp","permalink":"https://blog.meimolihan.eu.org/p/640e5e1f/","title":"ç¾¤æ™–ç¬¬ä¸‰æ–¹å¥—ä»¶æºå¤§å…¨ ğŸ—ƒï¸"},{"content":"Ubuntu å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸš€ ğŸ”„ æå‡æ‚¨çš„Ubuntuè½¯ä»¶ä¸‹è½½é€Ÿåº¦ï¼Œäº«å—æ›´æµç•…çš„æ›´æ–°ä½“éªŒï¼\nğŸ“‹ ç›®å½• ğŸŒŸ ç®€ä»‹ ğŸ“¦ å›½å†…é•œåƒæºé€‰æ‹© ğŸ”„ åº”ç”¨é…ç½®å¹¶æ›´æ–° ğŸ› ï¸ æ‰‹åŠ¨ç¼–è¾‘æºæ–‡ä»¶ ğŸ“‹ å„ç‰ˆæœ¬ä»£å·å¯¹åº”è¡¨ ğŸ” éªŒè¯æºé…ç½® âš ï¸ æ³¨æ„äº‹é¡¹ ğŸš¨ æ•…éšœæ’é™¤ ğŸ’¡ é¢å¤–æç¤º ğŸ“Š é•œåƒæºé€Ÿåº¦æ¯”è¾ƒ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°† Ubuntu çš„è½¯ä»¶æºæ›´æ¢ä¸ºå›½å†…é•œåƒæºï¼Œæ˜¾è‘—æå‡è½¯ä»¶ä¸‹è½½å’Œæ›´æ–°é€Ÿåº¦ã€‚å›½å†…é•œåƒæºå¯ä»¥ä¸ºæ‚¨æä¾›ï¼š\nâš¡ æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ - å‡å°‘å›½é™…å¸¦å®½é™åˆ¶å¸¦æ¥çš„å»¶è¿Ÿ ğŸ”’ æ›´ç¨³å®šçš„è¿æ¥ - é¿å…å›½å¤–æºè¿æ¥ä¸ç¨³å®šçš„é—®é¢˜ ğŸ“¦ å®Œæ•´çš„é•œåƒ - åŒ…å«æ‰€æœ‰å®˜æ–¹è½¯ä»¶åŒ…ï¼Œä¸å®˜æ–¹æºåŒæ­¥æ›´æ–° ğŸŒ æœ¬åœ°åŒ–æ”¯æŒ - éƒ¨åˆ†æºæä¾›æœ¬åœ°åŒ–æ–‡æ¡£å’Œå¸®åŠ© ğŸ’¡ é¦–å…ˆå¤‡ä»½é…ç½®æ–‡ä»¶\n1 sudo cp /etc/apt/sources.list.d/ubuntu.sources /etc/apt/sources.list.d/ubuntu.sources.bak ğŸ“¦ å›½å†…é•œåƒæºé€‰æ‹© 1. é˜¿é‡Œäº‘é•œåƒæº ğŸ‡¨ğŸ‡³ 1 2 3 4 5 6 7 sudo tee /etc/apt/sources.list.d/ubuntu.sources \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Types: deb URIs: https://mirrors.aliyun.com/ubuntu/ Suites: noble noble-updates noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg EOF ç‰¹ç‚¹ï¼šè¦†ç›–å…¨å›½å¤šçº¿è·¯ï¼Œé€Ÿåº¦ç¨³å®šï¼Œæ›´æ–°åŠæ—¶\n2. æ¸…åå¤§å­¦é•œåƒæº ğŸ“ 1 2 3 4 5 6 7 sudo tee /etc/apt/sources.list.d/ubuntu.sources \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Types: deb URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ Suites: noble noble-updates noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg EOF ç‰¹ç‚¹ï¼šæ•™è‚²ç½‘ä¼˜åŠ¿æ˜æ˜¾ï¼Œæ›´æ–°é¢‘ç‡é«˜ï¼Œæ–‡æ¡£é½å…¨\n3. ä¸­ç§‘å¤§é•œåƒæº ğŸ”¬ 1 2 3 4 5 6 7 sudo tee /etc/apt/sources.list.d/ubuntu.sources \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Types: deb URIs: https://mirrors.ustc.edu.cn/ubuntu/ Suites: noble noble-updates noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg EOF ç‰¹ç‚¹ï¼šç§‘ç ”æœºæ„ç»´æŠ¤ï¼Œç¨³å®šæ€§å¥½ï¼ŒæŠ€æœ¯æ”¯æŒå¼º\n4. ç½‘æ˜“163é•œåƒæº ğŸ¦Œ 1 2 3 4 5 6 7 sudo tee /etc/apt/sources.list.d/ubuntu.sources \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Types: deb URIs: https://mirrors.163.com/ubuntu/ Suites: noble noble-updates noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg EOF ç‰¹ç‚¹ï¼šå•†ä¸šå…¬å¸ç»´æŠ¤ï¼Œå¸¦å®½å……è¶³ï¼Œå…¨å›½è¦†ç›–å¥½\n5. åä¸ºäº‘é•œåƒæº â˜ï¸ 1 2 3 4 5 6 7 sudo tee /etc/apt/sources.list.d/ubuntu.sources \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Types: deb URIs: https://mirrors.huaweicloud.com/ubuntu/ Suites: noble noble-updates noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg EOF ç‰¹ç‚¹ï¼šäº‘æœåŠ¡å•†æä¾›ï¼Œä¸äº‘æœåŠ¡é›†æˆå¥½ï¼Œä¼ä¸šçº§æ”¯æŒ\nğŸ”„ åº”ç”¨é…ç½®å¹¶æ›´æ–° é€‰æ‹©ä»»ä¸€æºé…ç½®åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ›´æ–°è½¯ä»¶æºåˆ—è¡¨ sudo apt-get update # å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ… sudo apt-get upgrade -y # å¯é€‰ï¼šå®Œæ•´ç³»ç»Ÿå‡çº§ sudo apt-get dist-upgrade -y # æ¸…ç†æ— ç”¨çš„è½¯ä»¶åŒ… sudo apt-get autoremove -y sudo apt-get autoclean -y # éªŒè¯ç³»ç»ŸçŠ¶æ€ sudo apt-get check æ›´æ–°è¿‡ç¨‹è¯´æ˜ï¼š\nğŸ”„ apt-get update - åˆ·æ–°è½¯ä»¶åŒ…åˆ—è¡¨ ğŸ“ˆ apt-get upgrade - å‡çº§å·²å®‰è£…çš„åŒ… ğŸš€ apt-get dist-upgrade - æ™ºèƒ½å¤„ç†ä¾èµ–å…³ç³»çš„å‡çº§ ğŸ§¹ autoremove å’Œ autoclean - æ¸…ç†ä¸éœ€è¦çš„åŒ…å’Œç¼“å­˜ ğŸ› ï¸ æ‰‹åŠ¨ç¼–è¾‘æºæ–‡ä»¶ å¦‚æœæ‚¨æ›´å–œæ¬¢æ‰‹åŠ¨ç¼–è¾‘æˆ–éœ€è¦è‡ªå®šä¹‰é…ç½®ï¼š\n1 2 3 4 5 6 7 8 # ä½¿ç”¨ nano ç¼–è¾‘ sudo nano /etc/apt/sources.list.d/ubuntu.sources # æˆ–ä½¿ç”¨ vim sudo vim /etc/apt/sources.list.d/ubuntu.sources # æˆ–ä½¿ç”¨ gedit (GUI) sudo gedit /etc/apt/sources.list.d/ubuntu.sources åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ç²˜è´´æ‚¨é€‰æ‹©çš„æºé…ç½®ï¼Œç„¶åä¿å­˜é€€å‡ºã€‚\næ–‡ä»¶æ ¼å¼è¯´æ˜ï¼š\nTypes: deb - åŒ…ç±»å‹ï¼ˆdebä¸ºäºŒè¿›åˆ¶åŒ…ï¼‰ URIs - é•œåƒæºåœ°å€ Suites - Ubuntuç‰ˆæœ¬ä»£å·å’Œæ›´æ–°ç±»å‹ Components - è½¯ä»¶åŒ…åˆ†ç±» Signed-By - GPGå¯†é’¥è·¯å¾„ ğŸ“‹ å„ç‰ˆæœ¬ä»£å·å¯¹åº”è¡¨ å¦‚æœæ‚¨çš„ Ubuntu ç‰ˆæœ¬ä¸æ˜¯ Nobleï¼ˆ24.04ï¼‰ï¼Œè¯·ç›¸åº”è°ƒæ•´ Suites å­—æ®µï¼š\nUbuntu ç‰ˆæœ¬ ç‰ˆæœ¬ä»£å· LTS æ”¯æŒ 24.04 LTS noble âœ… æ˜¯ 22.04 LTS jammy âœ… æ˜¯ 20.04 LTS focal âœ… æ˜¯ 18.04 LTS bionic âœ… æ˜¯ 16.04 LTS xenial âŒ å·²ç»“æŸ ä¾‹å¦‚ï¼Œå¯¹äº Ubuntu 22.04 (Jammy Jellyfish)ï¼š\n1 2 3 4 5 6 7 sudo tee /etc/apt/sources.list.d/ubuntu.sources \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Types: deb URIs: https://mirrors.aliyun.com/ubuntu/ Suites: jammy jammy-updates jammy-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg EOF ç‰ˆæœ¬è¯´æ˜ï¼š\n[ç‰ˆæœ¬ä»£å·] - åŸºç¡€ç‰ˆæœ¬ [ç‰ˆæœ¬ä»£å·]-updates - å¸¸è§„æ›´æ–° [ç‰ˆæœ¬ä»£å·]-security - å®‰å…¨æ›´æ–° [ç‰ˆæœ¬ä»£å·]-backports - å‘åç§»æ¤çš„æ–°åŠŸèƒ½ ğŸ” éªŒè¯æºé…ç½® æ£€æŸ¥å½“å‰é…ç½® 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰æºé…ç½® cat /etc/apt/sources.list.d/ubuntu.sources # æ£€æŸ¥æ›´æ–°æ˜¯å¦æ­£å¸¸ sudo apt update # æŸ¥çœ‹å¯å‡çº§çš„åŒ… apt list --upgradable æµ‹è¯•ä¸‹è½½é€Ÿåº¦ 1 2 3 4 5 6 7 8 9 # æµ‹è¯•é•œåƒæºé€Ÿåº¦ï¼ˆå®‰è£… speedtest-cli åï¼‰ sudo apt install speedtest-cli speedtest-cli # æˆ–è€…ä½¿ç”¨ curl æµ‹è¯•ä¸‹è½½é€Ÿåº¦ time curl -O https://mirrors.aliyun.com/ubuntu/ubuntu/indices/Release # æµ‹è¯•ç‰¹å®šé•œåƒçš„å“åº”æ—¶é—´ curl -s -w \u0026#34;HTTPå“åº”: %{http_code}\\næ€»æ—¶é—´: %{time_total}s\\n\u0026#34; -o /dev/null https://mirrors.aliyun.com/ubuntu/ éªŒè¯è½¯ä»¶åŒ…å®Œæ•´æ€§ 1 2 3 4 5 6 7 8 # å®‰è£… debian-goodies ä»¥ä½¿ç”¨ checkrestart å·¥å…· sudo apt install debian-goodies # æ£€æŸ¥éœ€è¦é‡å¯çš„æœåŠ¡ sudo checkrestart # éªŒè¯å·²å®‰è£…çš„è½¯ä»¶åŒ… dpkg -l | grep ^ii | wc -l âš ï¸ æ³¨æ„äº‹é¡¹ é€‰æ‹©æœ€è¿‘çš„é•œåƒï¼šæ ¹æ®æ‚¨çš„åœ°ç†ä½ç½®é€‰æ‹©æœ€è¿‘çš„é•œåƒæºä»¥è·å¾—æœ€ä½³é€Ÿåº¦ ç‰ˆæœ¬åŒ¹é…ï¼šç¡®ä¿ Suites ä¸­çš„ç‰ˆæœ¬ä»£å·ä¸æ‚¨çš„ Ubuntu ç‰ˆæœ¬ä¸€è‡´ HTTPS æ”¯æŒï¼šæ¨èä½¿ç”¨ HTTPS æºï¼Œæ›´å®‰å…¨ å®šæœŸæ›´æ–°ï¼šå»ºè®®å®šæœŸæ›´æ–°è½¯ä»¶åŒ…ä»¥è·å–å®‰å…¨è¡¥ä¸å’Œæ–°åŠŸèƒ½ æºä¼˜å…ˆçº§ï¼šä¸è¦åŒæ—¶å¯ç”¨å¤šä¸ªæºï¼Œå¯èƒ½å¯¼è‡´ä¾èµ–å†²çª ä¼ä¸šç¯å¢ƒï¼šåœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œè€ƒè™‘æ­å»ºæœ¬åœ°é•œåƒæº å¤‡ä»½é…ç½®ï¼šä¿®æ”¹å‰å§‹ç»ˆå¤‡ä»½åŸå§‹é…ç½®ï¼Œä¾¿äºæ¢å¤ ğŸš¨ æ•…éšœæ’é™¤ å¦‚æœé‡åˆ° GPG å¯†é’¥é”™è¯¯ 1 2 3 4 5 6 7 8 9 # æ›´æ–°å¯†é’¥ sudo apt-key update # æˆ–è€…é‡æ–°å¯¼å…¥ Ubuntu å¯†é’¥ sudo apt install ubuntu-keyring # æˆ–è€…æ‰‹åŠ¨ä¸‹è½½å¯†é’¥ sudo gpg --keyserver keyserver.ubuntu.com --recv-keys [å¯†é’¥ID] sudo gpg --export --armor [å¯†é’¥ID] | sudo apt-key add - å¦‚æœæºä¸å¯ç”¨ 1 2 3 4 5 # æš‚æ—¶æ¢å¤å®˜æ–¹æºæµ‹è¯• sudo cp /etc/apt/sources.list.d/ubuntu.sources.bak /etc/apt/sources.list.d/ubuntu.sources sudo apt update # æˆ–è€…å°è¯•å…¶ä»–é•œåƒæº æ¸…é™¤ apt ç¼“å­˜ 1 2 3 4 5 6 7 # æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°æ›´æ–° sudo rm -rf /var/lib/apt/lists/* sudo mkdir -p /var/lib/apt/lists/partial sudo apt update # æ¸…é™¤éƒ¨åˆ†ä¸‹è½½çš„åŒ… sudo apt clean ä¿®å¤æŸåçš„åŒ… 1 2 3 4 5 6 7 8 # ä¿®å¤æŸåçš„ä¾èµ–å…³ç³» sudo apt --fix-broken install # é‡æ–°é…ç½®åŒ… sudo dpkg --configure -a # æ£€æŸ¥åŒ…ç®¡ç†å™¨çŠ¶æ€ sudo apt check ğŸ’¡ é¢å¤–æç¤º ä½¿ç”¨åœ°ç†æœ€è¿‘çš„é•œåƒ 1 2 3 4 5 6 7 # è‡ªåŠ¨é€‰æ‹©æœ€ä½³é•œåƒï¼ˆéœ€è¦å®‰è£… netselect-aptï¼‰ sudo apt install netselect-apt sudo netselect-apt # æˆ–ä½¿ç”¨ mirrorså‘½ä»¤ï¼ˆéœ€è¦å…ˆå®‰è£…ï¼‰ sudo apt install mirrors sudo mirrors æ·»åŠ ç¬¬ä¸‰æ–¹ PPA æº 1 2 3 4 5 6 # ç¤ºä¾‹ï¼šæ·»åŠ  PHP PPA sudo add-apt-repository ppa:ondrej/php sudo apt update # æŸ¥çœ‹å·²æ·»åŠ çš„ PPA ls /etc/apt/sources.list.d/ æŸ¥çœ‹å½“å‰ä¸‹è½½é€Ÿåº¦ 1 2 3 4 5 # å®‰è£… apt é€Ÿåº¦æ˜¾ç¤ºæ’ä»¶ sudo apt install apt-transport-https # æŸ¥çœ‹ apt ä¸‹è½½ç»Ÿè®¡ sudo apt install apt-listbugs è®¾ç½® apt ä»£ç† å¦‚æœæ‚¨çš„ç½‘ç»œéœ€è¦é€šè¿‡ä»£ç†è®¿é—®ï¼Œå¯ä»¥é…ç½® apt ä½¿ç”¨ä»£ç†ï¼š\n1 2 3 4 5 # åˆ›å»º apt ä»£ç†é…ç½®æ–‡ä»¶ echo \u0026#39;Acquire::http::Proxy \u0026#34;http://proxy-ip:proxy-port\u0026#34;;\u0026#39; | sudo tee /etc/apt/apt.conf.d/80proxy # å¦‚æœéœ€è¦è®¤è¯ echo \u0026#39;Acquire::http::Proxy \u0026#34;http://username:password@proxy-ip:proxy-port\u0026#34;;\u0026#39; | sudo tee /etc/apt/apt.conf.d/80proxy ğŸ“Š é•œåƒæºé€Ÿåº¦æ¯”è¾ƒ æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æµ‹è¯•å„ä¸ªé•œåƒæºçš„é€Ÿåº¦ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆ›å»ºæµ‹è¯•è„šæœ¬ cat \u0026gt; test_mirrors.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash MIRRORS=( \u0026#34;é˜¿é‡Œäº‘\u0026#34; \u0026#34;https://mirrors.aliyun.com/ubuntu/dists/noble/Release\u0026#34; \u0026#34;æ¸…åå¤§å­¦\u0026#34; \u0026#34;https://mirrors.tuna.tsinghua.edu.cn/ubuntu/dists/noble/Release\u0026#34; \u0026#34;ä¸­ç§‘å¤§\u0026#34; \u0026#34;https://mirrors.ustc.edu.cn/ubuntu/dists/noble/Release\u0026#34; \u0026#34;ç½‘æ˜“\u0026#34; \u0026#34;https://mirrors.163.com/ubuntu/dists/noble/Release\u0026#34; \u0026#34;åä¸ºäº‘\u0026#34; \u0026#34;https://mirrors.huaweicloud.com/ubuntu/dists/noble/Release\u0026#34; ) for ((i=0; i\u0026lt;${#MIRRORS[@]}; i+=2)); do name=${MIRRORS[i]} url=${MIRRORS[i+1]} echo -n \u0026#34;æµ‹è¯• $name ... \u0026#34; speed=$(curl -o /dev/null -s -w \u0026#34;%{time_total}s\\n\u0026#34; $url) echo \u0026#34;$speed ç§’\u0026#34; done EOF # è¿è¡Œæµ‹è¯• chmod +x test_mirrors.sh ./test_mirrors.sh é€‰æ‹©å“åº”æ—¶é—´æœ€çŸ­çš„é•œåƒæºã€‚\nğŸ¯ æ€»ç»“ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸå°† Ubuntu çš„è½¯ä»¶æºæ›´æ¢ä¸ºå›½å†…é•œåƒæºï¼Œäº«å—æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ã€‚å¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥éšæ—¶æ¢å¤å¤‡ä»½çš„é…ç½®æ–‡ä»¶ã€‚\næœ€ä½³å®è·µå»ºè®®ï¼š\nâœ… å®šæœŸæ›´æ–°ç³»ç»Ÿï¼šsudo apt update \u0026amp;\u0026amp; sudo apt upgrade âœ… é€‰æ‹©åœ°ç†æœ€è¿‘çš„é•œåƒæº âœ… ä¿æŒå¤‡ä»½ä¹ æƒ¯ï¼Œä¿®æ”¹å‰å¤‡ä»½é…ç½®æ–‡ä»¶ âœ… å®šæœŸæ£€æŸ¥æºçŠ¶æ€ï¼Œç¡®ä¿é•œåƒæºä»ç„¶å¯ç”¨ âœ… å…³æ³¨å®‰å…¨æ›´æ–°ï¼ŒåŠæ—¶åº”ç”¨å®‰å…¨è¡¥ä¸ äº«å—æ‚¨æ›´å¿«é€Ÿçš„ Ubuntu ä½“éªŒï¼ğŸš€\nğŸ“š æ‰©å±•é˜…è¯» Ubuntu å®˜æ–¹é•œåƒåˆ—è¡¨ APT ä½¿ç”¨æŒ‡å— Ubuntu ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸ â“ å¸¸è§é—®é¢˜ Q: æ›´æ¢æºåå‡ºç°ä¾èµ–é”™è¯¯æ€ä¹ˆåŠï¼Ÿ\nA: å°è¯•è¿è¡Œ sudo apt --fix-broken install æˆ–æ¢å›å®˜æ–¹æºæ›´æ–°åå†åˆ‡æ¢ã€‚\nQ: å¦‚ä½•çŸ¥é“å“ªä¸ªæºæœ€å¿«ï¼Ÿ\nA: ä½¿ç”¨ä¸Šé¢æä¾›çš„æµ‹è¯•è„šæœ¬æˆ–ä½¿ç”¨ netselect-apt å·¥å…·è‡ªåŠ¨é€‰æ‹©ã€‚\nQ: ä¼ä¸šç¯å¢ƒå¦‚ä½•é…ç½®ï¼Ÿ\nA: è€ƒè™‘æ­å»ºæœ¬åœ°é•œåƒæœåŠ¡å™¨ï¼Œä½¿ç”¨ apt-mirror æˆ– aptly å·¥å…·ã€‚\nQ: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ›´æ–°è¿˜æ˜¯å¾ˆæ…¢ï¼Ÿ\nA: å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–é•œåƒæºæ­£åœ¨åŒæ­¥ï¼Œå°è¯•æ›´æ¢å…¶ä»–é•œåƒæºã€‚\n","date":"2024-12-07T15:59:53+08:00","image":"https://file.meimolihan.eu.org/img/ubuntu-01.webp","permalink":"https://blog.meimolihan.eu.org/p/eaef4af2/","title":"Ubuntu å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸš€"},{"content":"Proxmox VE åˆå¹¶ local å’Œ local-lvm å­˜å‚¨ç©ºé—´ ğŸ§ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Proxmox VE (PVE) ä¸­å°† local-lvm å­˜å‚¨ç©ºé—´åˆå¹¶åˆ° local å­˜å‚¨ä¸­ï¼Œä»¥ç®€åŒ–å­˜å‚¨ç®¡ç†å¹¶å¢åŠ æ ¹åˆ†åŒºå®¹é‡ã€‚é€‚ç”¨äºå®¶åº­å®éªŒå®¤å’Œå°å‹éƒ¨ç½²ç¯å¢ƒã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ ç‰¹ç‚¹é€Ÿè§ˆ ğŸ“– ä¸€ã€èƒŒæ™¯ä»‹ç» ğŸ” äºŒã€æŸ¥çœ‹å½“å‰å­˜å‚¨ç»“æ„ âš ï¸ ä¸‰ã€é‡è¦å‡†å¤‡å·¥ä½œ ğŸ”§ å››ã€åˆå¹¶æ“ä½œæ­¥éª¤ ğŸ’¡ äº”ã€LVM-thin æŠ€æœ¯è¯´æ˜ ğŸ› ï¸ å…­ã€åç»­é…ç½®å»ºè®® ğŸš¨ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ ğŸ“Š å…«ã€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯” ğŸ”„ ä¹ã€æ¢å¤æ–¹æ¡ˆ âœ¨ ç‰¹ç‚¹é€Ÿè§ˆ âœ… ç®€åŒ–ç®¡ç†ï¼šå°†ä¸¤ä¸ªå­˜å‚¨æ± åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå‡å°‘ç®¡ç†å¤æ‚åº¦ âœ… ç©ºé—´æœ€å¤§åŒ–ï¼šå……åˆ†åˆ©ç”¨ç£ç›˜ç©ºé—´ï¼Œé¿å…å›ºå®šåˆ†é…å¸¦æ¥çš„æµªè´¹ âœ… æ“ä½œæŒ‡å—ï¼šæä¾›ä»å‡†å¤‡åˆ°å®Œæˆçš„å®Œæ•´æ­¥éª¤ âœ… é£é™©æç¤ºï¼šåŒ…å«é‡è¦æ³¨æ„äº‹é¡¹å’Œæ¢å¤æ–¹æ¡ˆ âœ… æ€§èƒ½å¯¹æ¯”ï¼šå¸®åŠ©æ‚¨é€‰æ‹©æœ€é€‚åˆçš„å­˜å‚¨æ–¹æ¡ˆ ğŸ“– ä¸€ã€èƒŒæ™¯ä»‹ç» PVE é»˜è®¤å®‰è£…ä¼šåˆ›å»ºä¸¤ä¸ªå­˜å‚¨ï¼š\nğŸ—‚ï¸ localï¼šç›®å½•ç±»å‹å­˜å‚¨ï¼Œç”¨äºå­˜æ”¾ ISO é•œåƒã€å¤‡ä»½æ–‡ä»¶ç­‰ ğŸ’¾ local-lvmï¼šLVM-thin ç±»å‹å­˜å‚¨ï¼Œç”¨äºå­˜æ”¾è™šæ‹Ÿæœºç£ç›˜ è¿™ç§åˆ†ç¦»è®¾è®¡åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆç‰¹åˆ«æ˜¯å°å‹ç¯å¢ƒï¼‰å¯èƒ½å¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š\nğŸ”¸ å­˜å‚¨ç©ºé—´åˆ†é…ä¸çµæ´» ğŸ”¸ ç®¡ç†å¤æ‚åº¦å¢åŠ  ğŸ”¸ ç©ºé—´åˆ©ç”¨ç‡ä¸é«˜ æœ¬æ•™ç¨‹æŒ‡å¯¼å¦‚ä½•å°† local-lvm åˆå¹¶åˆ° localï¼ŒğŸ¯ å¢åŠ æ ¹åˆ†åŒºå®¹é‡å¹¶ç®€åŒ–å­˜å‚¨ç®¡ç†ã€‚\nğŸ” äºŒã€æŸ¥çœ‹å½“å‰å­˜å‚¨ç»“æ„ åœ¨å¼€å§‹æ“ä½œå‰ï¼Œè¯·å…ˆäº†è§£å½“å‰ç³»ç»Ÿçš„å­˜å‚¨ç»“æ„ï¼š\næŸ¥çœ‹ç£ç›˜åˆ†åŒºæƒ…å†µ 1 fdisk -l æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯ 1 lsblk æŸ¥çœ‹é€»è¾‘å·ä¿¡æ¯ 1 lvs æŸ¥çœ‹å­˜å‚¨é…ç½®æ–‡ä»¶ 1 cat /etc/pve/storage.cfg ğŸ“ è®°å½•ä¸‹å½“å‰çš„å­˜å‚¨é…ç½®ï¼Œç‰¹åˆ«æ˜¯ pve/data é€»è¾‘å·çš„å¤§å°å’Œä½¿ç”¨æƒ…å†µã€‚\nâš ï¸ ä¸‰ã€é‡è¦å‡†å¤‡å·¥ä½œ ğŸ”’ 1. å¤‡ä»½æ‰€æœ‰è™šæ‹Ÿæœºæ•°æ® åœ¨ç»§ç»­æ“ä½œå‰ï¼Œè¯·ç¡®ä¿ï¼š\nâœ… æ‰€æœ‰è™šæ‹Ÿæœºå·²å¤‡ä»½ âœ… é‡è¦æ•°æ®å·²è½¬ç§» âœ… è™šæ‹Ÿæœºä¸åœ¨ local-lvm ä¸Šè¿è¡Œ ğŸ”„ 2. ç§»åŠ¨è™šæ‹Ÿæœºåˆ° local å­˜å‚¨ åœ¨ PVE ç½‘é¡µç•Œé¢ä¸­ï¼Œé€‰æ‹©è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ é€‰æ‹©ç¡¬ç›˜ï¼Œç‚¹å‡»\u0026quot;ç§»åŠ¨ç£ç›˜\u0026quot; é€‰æ‹©\u0026quot;local\u0026quot;ä½œä¸ºç›®æ ‡å­˜å‚¨ â° æ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå–å†³äºè™šæ‹Ÿæœºç£ç›˜å¤§å°å’Œç³»ç»Ÿæ€§èƒ½ã€‚\nğŸ”§ å››ã€åˆå¹¶æ“ä½œæ­¥éª¤ 1. ç§»é™¤ local-lvm å¯¹åº”çš„é€»è¾‘å· 1 lvremove pve/data âš ï¸ ç³»ç»Ÿä¼šè¦æ±‚ç¡®è®¤æ“ä½œï¼Œè¯·è¾“å…¥ y ç¡®è®¤\n2. æ‰©å±•æ ¹åˆ†åŒºé€»è¾‘å· 1 lvextend -l +100%FREE -r pve/root -l +100%FREEï¼šä½¿ç”¨æ‰€æœ‰å¯ç”¨ç©ºé—´ -rï¼šåœ¨çº¿è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å° 3. éªŒè¯åˆå¹¶ç»“æœ 1 df -h ç°åœ¨åº”è¯¥å¯ä»¥çœ‹åˆ°æ ¹åˆ†åŒºå®¹é‡å·²å¢åŠ  ğŸ“ˆ\n4. åˆ é™¤ç½‘é¡µç«¯çš„ local-lvm å­˜å‚¨ ç™»å½• PVE ç½‘é¡µç®¡ç†ç•Œé¢ è¿›å…¥\u0026quot;æ•°æ®ä¸­å¿ƒ\u0026quot; â†’ \u0026ldquo;å­˜å‚¨\u0026rdquo; é€‰æ‹©\u0026quot;local-lvm\u0026quot; ç‚¹å‡»\u0026quot;åˆ é™¤\u0026quot; 5. æŸ¥çœ‹å­˜å‚¨ç›®å½•ç»“æ„ 1 tree /var/lib/vz/ é¢„æœŸè¾“å‡ºç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 /var/lib/vz/ â”œâ”€â”€ dump # å¤‡ä»½æ–‡ä»¶ â”œâ”€â”€ images # è™šæ‹Ÿæœºç£ç›˜ â”œâ”€â”€ private â”œâ”€â”€ snippets # ç‰‡æ®µ â””â”€â”€ template â”œâ”€â”€ cache # å®¹å™¨æ¨¡æ¿ â”œâ”€â”€ iso # ISO é•œåƒ â””â”€â”€ qemu ğŸ’¡ äº”ã€LVM-thin æŠ€æœ¯è¯´æ˜ LVM-thin (ç²¾ç®€é…ç½®) æä¾›ä»¥ä¸‹ç‰¹æ€§ï¼š\nâœ… ç©ºé—´è¶…åˆ†é… (Thin Provisioning)ï¼šå¯ä»¥åˆ†é…è¶…è¿‡å®é™…ç‰©ç†ç©ºé—´çš„è™šæ‹Ÿå®¹é‡ âœ… å¿«ç…§åŠŸèƒ½ï¼šæ”¯æŒå¿«é€Ÿåˆ›å»ºè™šæ‹Ÿæœºå¿«ç…§ âœ… ç©ºé—´åŠ¨æ€è°ƒæ•´ï¼šå¯ä»¥çµæ´»è°ƒæ•´å­˜å‚¨ç©ºé—´ ä½†ä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼š\nâŒ ä¸èƒ½ç›´æ¥è®¿é—®è™šæ‹Ÿæœºç£ç›˜æ–‡ä»¶ âŒ å¤‡ä»½å’Œè¿ç§»ç›¸å¯¹å¤æ‚ âŒ éœ€è¦æ›´å¤šç®¡ç†å¼€é”€ ğŸ› ï¸ å…­ã€åç»­é…ç½®å»ºè®® 1. é…ç½® local å­˜å‚¨é€‰é¡¹ åœ¨ PVE ç½‘é¡µç•Œé¢ä¸­ï¼Œç¼–è¾‘ local å­˜å‚¨ï¼š\nâœ… å‹¾é€‰\u0026quot;ç£ç›˜é•œåƒ\u0026quot; âœ… å‹¾é€‰\u0026quot;å®¹å™¨æ¨¡æ¿\u0026quot; âœ… å‹¾é€‰\u0026quot;ISO é•œåƒ\u0026quot; 2. åˆ›å»ºä¸“ç”¨å¤‡ä»½ç›®å½• 1 2 mkdir -p /var/lib/vz/dump chmod 755 /var/lib/vz/dump 3. å®šæœŸæ¸…ç†æ—§æ–‡ä»¶ 1 2 # æ¸…ç†30å¤©å‰çš„å¤‡ä»½æ–‡ä»¶ find /var/lib/vz/dump -type f -mtime +30 -delete 4. ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨ å»ºè®®å®‰è£…ç›‘æ§å·¥å…·ï¼Œå¦‚ï¼š\n1 2 apt install ncdu ncdu /var/lib/vz/ ğŸš¨ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜ âš ï¸ é‡è¦è­¦å‘Šï¼š æ“ä½œå‰åŠ¡å¿…å¤‡ä»½æ‰€æœ‰æ•°æ® ç¡®ä¿æ²¡æœ‰è™šæ‹Ÿæœºä½¿ç”¨ local-lvm æ“ä½œä¸å¯é€†ï¼Œè¯·è°¨æ…æ‰§è¡Œ å»ºè®®åœ¨ç³»ç»Ÿè´Ÿè½½ä½æ—¶è¿›è¡Œæ“ä½œ â“ å¸¸è§é—®é¢˜è§£å†³ï¼š Q: æ‰§è¡Œ lvremove æ—¶æç¤º\u0026quot;Logical volume in use\u0026quot;\nA: ç¡®ä¿æ‰€æœ‰è™šæ‹Ÿæœºå·²å…³é—­å¹¶ä» local-lvm ç§»å‡ºï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¿›ç¨‹å ç”¨ï¼š\n1 lsof /dev/pve/data Q: æ‰©å±•åç©ºé—´æ²¡æœ‰ç«‹å³ç”Ÿæ•ˆ\nA: å°è¯•é‡å¯ç³»ç»Ÿæˆ–ä½¿ç”¨ resize2fs å‘½ä»¤ï¼š\n1 resize2fs /dev/pve/root Q: PVE ç½‘é¡µç«¯æ˜¾ç¤ºå­˜å‚¨å¼‚å¸¸\nA: é‡å¯ PVE ç›¸å…³æœåŠ¡ï¼š\n1 systemctl restart pveproxy pvedaemon Q: åˆå¹¶åè™šæ‹Ÿæœºæ€§èƒ½å—å½±å“\nA: è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œç›®å½•å­˜å‚¨ç›¸æ¯” LVM-thin å¯èƒ½æœ‰è½»å¾®æ€§èƒ½å·®å¼‚\nğŸ“Š å…«ã€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯” æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ åˆ†ç¦»æ–¹æ¡ˆ (é»˜è®¤) æ€§èƒ½ä¼˜åŒ–ï¼Œæ”¯æŒå¿«ç…§ï¼Œç©ºé—´è¶…åˆ†é… ç®¡ç†å¤æ‚ï¼Œç©ºé—´åˆ†é…å›ºå®š ç”Ÿäº§ç¯å¢ƒï¼Œéœ€è¦é«˜çº§åŠŸèƒ½ åˆå¹¶æ–¹æ¡ˆ (æœ¬æ•™ç¨‹) ç®¡ç†ç®€å•ï¼Œç©ºé—´çµæ´»ï¼Œç›´æ¥è®¿é—®æ–‡ä»¶ ç¼ºå°‘ LVM-thin é«˜çº§åŠŸèƒ½ï¼Œæ€§èƒ½ç¨ä½ å®¶åº­å®éªŒå®¤ï¼Œå°å‹ç¯å¢ƒ ğŸ”„ ä¹ã€æ¢å¤æ–¹æ¡ˆï¼ˆå¦‚æœ‰éœ€è¦ï¼‰ å¦‚æœåˆå¹¶åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š\n1. ä»å¤‡ä»½æ¢å¤è™šæ‹Ÿæœº ç¡®ä¿æœ‰å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶ï¼Œé€šè¿‡ PVE ç½‘é¡µç•Œé¢è¿›è¡Œæ¢å¤ã€‚\n2. é‡æ–°åˆ›å»º LVM-thin æ±  1 2 3 4 5 6 # é¦–å…ˆç¼©å‡æ ¹åˆ†åŒºï¼Œè…¾å‡ºç©ºé—´ lvresize -L -50G /dev/pve/root # åˆ›å»ºæ–°çš„ thinpool lvcreate -L 50G -n data pve lvconvert --type thin-pool pve/data 3. é‡æ–°é…ç½®å­˜å‚¨ åœ¨ PVE ç½‘é¡µç•Œé¢ä¸­é‡æ–°æ·»åŠ  LVM-thin å­˜å‚¨ã€‚\nğŸ’ æ€»ç»“ æœ¬æŒ‡å—æä¾›äº†å°† PVE ä¸­ local-lvm å­˜å‚¨åˆå¹¶åˆ° local çš„å®Œæ•´æµç¨‹ã€‚è¿™ç§æ“ä½œé€‚åˆï¼š\nğŸ  å®¶åº­å®éªŒå®¤ç¯å¢ƒ ğŸ“ å­¦ä¹ å’Œæµ‹è¯•ç¯å¢ƒ ğŸ”§ éœ€è¦ç®€åŒ–å­˜å‚¨ç®¡ç†çš„å°å‹éƒ¨ç½² ä½†å¯¹äºç”Ÿäº§ç¯å¢ƒæˆ–éœ€è¦é«˜çº§å­˜å‚¨åŠŸèƒ½ï¼ˆå¦‚å¿«ç…§ã€ç©ºé—´è¶…åˆ†é…ï¼‰çš„åœºæ™¯ï¼Œå»ºè®®ä¿æŒé»˜è®¤çš„åˆ†ç¦»æ–¹æ¡ˆã€‚\nğŸ’¡ æç¤ºï¼šåœ¨è¿›è¡Œä»»ä½•å­˜å‚¨æ“ä½œå‰ï¼Œè¯·åŠ¡å¿…ç¡®ä¿æœ‰å®Œæ•´å¯ç”¨çš„å¤‡ä»½ï¼\nå¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨æˆåŠŸåˆå¹¶ PVE å­˜å‚¨ç©ºé—´ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ PVE å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚\nğŸ“ æ–‡æ¡£ä¿¡æ¯\næœ€åæ›´æ–°æ—¥æœŸ: 2023å¹´10æœˆ é€‚ç”¨ PVE ç‰ˆæœ¬: 7.x, 8.x ä½œè€…: Foxi\u0026rsquo;s Blog å‚è€ƒæ•™ç¨‹: Foxi\u0026rsquo;s Blog - PVE å­˜å‚¨åˆå¹¶ ğŸ”— ç›¸å…³èµ„æº\nProxmox VE å®˜æ–¹æ–‡æ¡£ Proxmox VE è®ºå› LVM2 å®˜æ–¹æ–‡æ¡£ ","date":"2024-12-07T15:59:19+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/d447d00f/","title":"Proxmox VE åˆå¹¶ local å’Œ local-lvm å­˜å‚¨ç©ºé—´ ğŸ§"},{"content":"Proxmox VE ç½‘å¡ç›´é€šé…ç½® ğŸŒ ğŸ“‘ å¯¼èˆªç›®å½• âœ¨ ç‰¹æ€§ä¸åŠŸèƒ½ ğŸ” å‰ç½®è¦æ±‚ âš™ï¸ é…ç½®æ­¥éª¤ âœ… éªŒè¯é…ç½® ğŸ› ï¸ åç»­æ“ä½œ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ â†©ï¸ æ¢å¤é»˜è®¤è®¾ç½® ğŸ’¡ å®ç”¨æŠ€å·§ âœ¨ ç‰¹æ€§ä¸åŠŸèƒ½ ç½‘å¡ç›´é€šï¼ˆPCI Passthroughï¼‰æ˜¯ä¸€é¡¹é«˜çº§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå…è®¸è™šæ‹Ÿæœºç›´æ¥è®¿é—®ç‰©ç†ç¡¬ä»¶è®¾å¤‡ï¼Œç»•è¿‡è™šæ‹ŸåŒ–å±‚çš„æ€§èƒ½å¼€é”€ã€‚è¿™é¡¹åŠŸèƒ½ç‰¹åˆ«é€‚åˆéœ€è¦é«˜æ€§èƒ½ç½‘ç»œçš„åº”ç”¨åœºæ™¯ï¼Œå¦‚ï¼š\nğŸš€ é«˜æ€§èƒ½è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆOPNsense/pfSenseï¼‰ ğŸ“Š ç½‘ç»œæµé‡åˆ†æç›‘æ§ ğŸ® ä½å»¶è¿Ÿæ¸¸æˆæœåŠ¡å™¨ ğŸ”§ ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ï¼ˆNFVï¼‰ ğŸ’» è™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„é«˜æ€§èƒ½ç½‘ç»œåº”ç”¨ âœ¨ ç‰¹æ€§ä¸åŠŸèƒ½ ç½‘å¡ç›´é€šæŠ€æœ¯æä¾›ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸ¯ æ¥è¿‘åŸç”Ÿæ€§èƒ½ï¼šè™šæ‹Ÿæœºç›´æ¥æ§åˆ¶ç‰©ç†ç½‘å¡ï¼Œæ€§èƒ½æŸå¤±æå° âš¡ ä½å»¶è¿Ÿï¼šç»•è¿‡è™šæ‹ŸåŒ–å±‚ï¼Œæ˜¾è‘—é™ä½ç½‘ç»œå»¶è¿Ÿ ğŸ”’ éš”ç¦»æ€§ï¼šç›´é€šè®¾å¤‡å®Œå…¨åˆ†é…ç»™ç‰¹å®šè™šæ‹Ÿæœºï¼Œå¢å¼ºå®‰å…¨æ€§ ğŸ›¡ï¸ ç¨³å®šæ€§ï¼šå‡å°‘å› è™šæ‹ŸåŒ–é©±åŠ¨å¯¼è‡´çš„å…¼å®¹æ€§é—®é¢˜ ğŸ”§ çµæ´»æ€§ï¼šæ”¯æŒå¤šç§ç½‘å¡å‹å·å’Œå“ç‰Œ ğŸ” å‰ç½®è¦æ±‚ åœ¨å¼€å§‹é…ç½®å‰ï¼Œè¯·ç¡®ä¿æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nç¡¬ä»¶è¦æ±‚ ğŸ–¥ï¸ CPUæ”¯æŒï¼šIntel VT-d æˆ– AMD-V æŠ€æœ¯ ğŸ§© ä¸»æ¿æ”¯æŒï¼šIOMMU åŠŸèƒ½å¿…é¡»åœ¨BIOSä¸­å¯ç”¨ ğŸ”Œ ç½‘å¡å…¼å®¹æ€§ï¼šå»ºè®®ä½¿ç”¨Intelæˆ–Broadcomç½‘å¡ï¼ŒæŸäº›Realtekç½‘å¡å¯èƒ½ä¸æ”¯æŒ è½¯ä»¶è¦æ±‚ ğŸ“¦ Proxmox VEï¼šå»ºè®®ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ ğŸ’¾ ç³»ç»Ÿå¤‡ä»½ï¼šé‡è¦æ•°æ®å¤‡ä»½ï¼Œé˜²æ­¢é…ç½®é”™è¯¯å¯¼è‡´ç³»ç»Ÿé—®é¢˜ æ£€æŸ¥ç¡¬ä»¶æ”¯æŒ 1 2 3 4 5 # æ£€æŸ¥CPUè™šæ‹ŸåŒ–æ”¯æŒ grep -E \u0026#39;(vmx|svm)\u0026#39; /proc/cpuinfo # æ£€æŸ¥IOMMUæ”¯æŒ dmesg | grep -i IOMMU âš™ï¸ é…ç½®æ­¥éª¤ 1. å¯ç”¨IOMMUæ”¯æŒ 1 2 # ä½¿ç”¨ nano ç¼–è¾‘å™¨ä¿®æ”¹ GRUB é…ç½® nano /etc/default/grub 2. ä¿®æ”¹å¯åŠ¨å‚æ•° æ ¹æ®æ‚¨çš„CPUå“ç‰Œé€‰æ‹©åˆé€‚çš„é…ç½®ï¼š\nIntel å¤„ç†å™¨ï¼š\n1 2 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on iommu=pt\u0026#34; # iommu=pt å‚æ•°ä»…å¯¹ç›´é€šè®¾å¤‡å¯ç”¨IOMMUï¼Œæé«˜æ€§èƒ½ AMD å¤„ç†å™¨ï¼š\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet amd_iommu=on iommu=pt\u0026#34; 3. æ›´æ–° GRUB é…ç½® 1 2 # ä½¿é…ç½®ä¿®æ”¹ç”Ÿæ•ˆ update-grub 4. åŠ è½½VFIOå†…æ ¸æ¨¡å— 1 2 3 4 5 6 7 8 # ç¼–è¾‘æ¨¡å—é…ç½®æ–‡ä»¶ nano /etc/modules # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š vfio vfio_iommu_type1 vfio_pci vfio_virqfd 5. å±è”½é»˜è®¤é©±åŠ¨ï¼ˆå¯é€‰ä½†æ¨èï¼‰ 1 2 3 # é˜²æ­¢å®¿ä¸»æœºå ç”¨è¦ç›´é€šçš„ç½‘å¡ echo \u0026#34;blacklist igb\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/pve-blacklist.conf # è¯·å°†igbæ›¿æ¢ä¸ºæ‚¨çš„ç½‘å¡é©±åŠ¨åï¼ˆå¦‚ï¼šr8169, e1000eç­‰ï¼‰ 6. æ›´æ–° initramfs 1 2 # æ›´æ–°åˆå§‹RAMæ–‡ä»¶ç³»ç»Ÿ update-initramfs -u -k all 7. é‡å¯ç³»ç»Ÿ 1 2 # é‡å¯ä½¿æ‰€æœ‰é…ç½®ç”Ÿæ•ˆ reboot now âœ… éªŒè¯é…ç½® æ£€æŸ¥ IOMMU æ˜¯å¦å¯ç”¨ 1 2 3 4 5 # æ£€æŸ¥dmesgè¾“å‡ºä¸­æ˜¯å¦æœ‰IOMMUç›¸å…³ä¿¡æ¯ dmesg | grep -e DMAR -e IOMMU # æœŸæœ›çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š # DMAR: IOMMU enabled æŸ¥çœ‹IOMMUåˆ†ç»„æƒ…å†µ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹IOMMUåˆ†ç»„ä¿¡æ¯ find /sys/kernel/iommu_groups/ -type l # æŸ¥çœ‹è¯¦ç»†çš„PCIè®¾å¤‡ä¿¡æ¯ lspci -nnk # æŸ¥çœ‹ç‰¹å®šç½‘å¡ä¿¡æ¯ï¼ˆç¤ºä¾‹ä¸ºç½‘ç»œè®¾å¤‡ï¼‰ lspci | grep -i ethernet æ£€æŸ¥VFIOæ¨¡å—åŠ è½½ 1 2 # ç¡®è®¤VFIOæ¨¡å—æ­£ç¡®åŠ è½½ lsmod | grep vfio ğŸ› ï¸ åç»­æ“ä½œ å°†ç½‘å¡æ·»åŠ åˆ°è™šæ‹Ÿæœº åœ¨PVEç½‘é¡µç®¡ç†ç•Œé¢ä¸­é€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; â†’ \u0026ldquo;PCIè®¾å¤‡\u0026rdquo; é€‰æ‹©è¦ç›´é€šçš„ç½‘å¡è®¾å¤‡ï¼ˆé€šè¿‡è®¾å¤‡IDè¯†åˆ«ï¼‰ é‡è¦é€‰é¡¹ï¼š âœ… æ‰€æœ‰åŠŸèƒ½ï¼šå¯ç”¨è®¾å¤‡çš„å…¨éƒ¨åŠŸèƒ½ âœ… PCI-Expressï¼šå¦‚æœè®¾å¤‡æ”¯æŒPCIe âœ… ROM-Barï¼šå…è®¸è™šæ‹Ÿæœºè¯»å–è®¾å¤‡ROM âœ… é¦–é€‰VFIOï¼šä½¿ç”¨VFIOæ¡†æ¶è€Œä¸æ˜¯ä¼ ç»Ÿæ–¹æ³• è¯†åˆ«ç½‘å¡PCI ID 1 2 3 4 5 6 # è·å–ç½‘å¡çš„PCI IDï¼ˆæ ¼å¼ï¼šXXXX:XX:XX.Xï¼‰ lspci -n | grep -i ethernet # ç¤ºä¾‹è¾“å‡ºï¼š # 02:00.0 Ethernet controller [0200]: Intel Corporation I211 Gigabit Network Connection [8086:1539] (rev 03) # è¿™é‡Œ8086:1539å°±æ˜¯è®¾å¤‡ID âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ”§ ç¡¬ä»¶å…¼å®¹æ€§ï¼šä¸æ˜¯æ‰€æœ‰ç½‘å¡éƒ½æ”¯æŒç›´é€šï¼ŒæœåŠ¡å™¨çº§ç½‘å¡é€šå¸¸æœ‰æ›´å¥½æ”¯æŒ ğŸ’¾ å¤‡ä»½é…ç½®ï¼šä¿®æ”¹å‰åŠ¡å¿…å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ 1 2 cp /etc/default/grub /etc/default/grub.backup cp /etc/modules /etc/modules.backup ğŸ“Š æ€§èƒ½å½±å“ï¼šç›´é€šåè¯¥ç½‘å¡å°†æ— æ³•è¢«å®¿ä¸»æœºä½¿ç”¨ï¼Œè¯·ç¡®ä¿æœ‰ç®¡ç†ç½‘å£ ğŸ”„ é‡å¯è¦æ±‚ï¼šæŸäº›æ›´æ”¹éœ€è¦å®Œå…¨é‡å¯ï¼Œè€Œä¸ä»…ä»…æ˜¯é‡è½½æœåŠ¡ å¸¸è§é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥è®¾å¤‡æ˜¯å¦è¢«å…¶ä»–é©±åŠ¨å ç”¨ lspci -vvv -s 02:00.0 # æ›¿æ¢ä¸ºæ‚¨çš„è®¾å¤‡åœ°å€ # æ£€æŸ¥dmesgä¸­å…³äºVFIOçš„é”™è¯¯ä¿¡æ¯ dmesg | grep -i vfio # æ£€æŸ¥IOMMUåˆ†ç»„æ˜¯å¦åˆç† #!/bin/bash for d in /sys/kernel/iommu_groups/*/devices/*; do n=${d#*/iommu_groups/*}; n=${n%%/*} printf \u0026#39;IOMMU Group %s \u0026#39; \u0026#34;$n\u0026#34; lspci -nns \u0026#34;${d##*/}\u0026#34; done â†©ï¸ æ¢å¤é»˜è®¤è®¾ç½® å¦‚æœéœ€è¦å–æ¶ˆç›´é€šé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æ¢å¤GRUBé…ç½®ä¸ºé»˜è®¤å€¼ nano /etc/default/grub # å°†å‚æ•°æ”¹å› \u0026#34;quiet\u0026#34; # ç§»é™¤æˆ–æ³¨é‡Šæ‰ /etc/modules ä¸­æ·»åŠ çš„vfioæ¨¡å— nano /etc/modules # ç§»é™¤é»‘åå•é…ç½®ï¼ˆå¦‚æœæ·»åŠ äº†ï¼‰ nano /etc/modprobe.d/pve-blacklist.conf # æ›´æ–°GRUBå’Œinitramfs update-grub update-initramfs -u -k all # é‡å¯ç³»ç»Ÿ reboot ğŸ’¡ å®ç”¨æŠ€å·§ é«˜çº§é…ç½®é€‰é¡¹ ğŸ”§ PCIe ACSè¦†ç›–ï¼šè§£å†³IOMMUåˆ†ç»„é™åˆ¶\n1 2 # åœ¨GRUBå‚æ•°ä¸­æ·»åŠ ï¼š pcie_acs_override=downstream,multifunction ğŸ¯ æŒ‡å®šç›´é€šè®¾å¤‡ï¼šç²¾ç¡®æ§åˆ¶å“ªäº›è®¾å¤‡ç›´é€š\n1 2 # åœ¨/etc/modprobe.d/vfio.confä¸­æ·»åŠ ï¼š options vfio-pci ids=8086:1539,8086:1540 ğŸ“Š æ€§èƒ½è°ƒä¼˜ï¼šé’ˆå¯¹é«˜æ€§èƒ½åœºæ™¯ä¼˜åŒ–\n1 2 # å¯ç”¨å·¨é¡µæ”¯æŒ echo 2048 \u0026gt; /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages ç›‘æ§ä¸è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ç›´é€šè®¾å¤‡çŠ¶æ€ virsh nodedev-list --cap pci # æŸ¥çœ‹è®¾å¤‡è¯¦ç»†ä¿¡æ¯ virsh nodedev-dumpxml pci_0000_02_00_0 # ç›‘æ§ç›´é€šè®¾å¤‡æ€§èƒ½ apt install iperf3 iperf3 -s # åœ¨æœåŠ¡å™¨ç«¯ iperf3 -c server_ip # åœ¨å®¢æˆ·ç«¯ ğŸ“ è®¾å¤‡é©±åŠ¨å‚è€ƒ ç½‘å¡å‹å· é©±åŠ¨æ¨¡å— ç›´é€šå…¼å®¹æ€§ Intel I210/I211 igb âœ… ä¼˜ç§€ Intel X540/X550 ixgbe âœ… ä¼˜ç§€ Intel I350 igb âœ… ä¼˜ç§€ Broadcom NetXtreme bnxt_en âœ… è‰¯å¥½ Realtek RTL8168 r8169 âš ï¸ ä¸€èˆ¬ ğŸš€ å®Œæˆä»¥ä¸Šé…ç½®åï¼Œæ‚¨çš„è™šæ‹Ÿæœºå°†èƒ½å¤Ÿç›´æ¥è®¿é—®ç‰©ç†ç½‘å¡ï¼Œè·å¾—æ¥è¿‘åŸç”Ÿæ€§èƒ½çš„ç½‘ç»œä½“éªŒï¼å»ºè®®é¦–æ¬¡é…ç½®åè¿›è¡Œå…¨é¢æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œæ€§èƒ½è¡¨ç°ã€‚\nğŸ“… æœ€åæ›´æ–°æ—¥æœŸï¼š2024å¹´3æœˆ\nâœ… æµ‹è¯•ç¯å¢ƒï¼šProxmox VE 7.4/8.0ï¼ŒIntel/AMDå¹³å°\nğŸ”§ é€‚ç”¨å¯¹è±¡ï¼šä¸­çº§åˆ°é«˜çº§PVEç”¨æˆ·\nå¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ å®˜æ–¹æ–‡æ¡£ æˆ–ç¤¾åŒºè®ºå›è·å–æ›´å¤šå¸®åŠ©ï¼ ğŸ’¬\n","date":"2024-12-07T15:58:55+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/a82e5981/","title":"Proxmox VE ç½‘å¡ç›´é€šé…ç½®  ğŸŒ"},{"content":"Proxmox VE å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸš€ âœ¨ ä¸ºProxmox VE (PVE) æ›´æ¢å›½å†…é•œåƒæºå¯ä»¥å¤§å¹…æå‡è½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦ï¼Œå‡å°‘æ›´æ–°ç­‰å¾…æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿç»´æŠ¤æ•ˆç‡ã€‚æœ¬æŒ‡å—æä¾›å¤šä¸ªå›½å†…ä¸»æµé•œåƒæºçš„é…ç½®æ–¹æ³•ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ ç‰¹æ€§ä¸ä¼˜åŠ¿ ğŸ”§ å‡†å¤‡å·¥ä½œ ğŸ“¦ æ›´æ¢è½¯ä»¶æº ğŸ¢ ä¼ä¸šæºé…ç½® ğŸ”“ æ— è®¢é˜…æºé…ç½® ğŸŒŠ Cephæºé…ç½® ğŸ“¦ LXCå®¹å™¨æº ğŸš« å»é™¤è®¢é˜…æç¤º ğŸ”„ æ›´æ–°ä¸é‡å¯ âš ï¸ æ³¨æ„äº‹é¡¹ âœ¨ ç‰¹æ€§ä¸ä¼˜åŠ¿ âš¡ æé€Ÿä¸‹è½½ï¼šå›½å†…é•œåƒæºæä¾›æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ ğŸŒ ç¨³å®šè¿æ¥ï¼šé¿å…å›½é™…ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„è¿æ¥é—®é¢˜ ğŸ”’ å®‰å…¨å¯é ï¼šå®˜æ–¹é•œåƒåŒæ­¥ï¼Œä¿è¯è½¯ä»¶åŒ…å®‰å…¨æ€§ ğŸ†“ å…è´¹ä½¿ç”¨ï¼šæ— éœ€è®¢é˜…å³å¯äº«å—ä¼ä¸šçº§åŠŸèƒ½ ğŸ› ï¸ å¤šæºé€‰æ‹©ï¼šæä¾›å¤šä¸ªä¸»æµé•œåƒæºä¾›é€‰æ‹© ğŸ”§ å‡†å¤‡å·¥ä½œ ğŸ“ åœ¨å¼€å§‹å‰ï¼Œè¯·åŠ¡å¿…å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶\n1 2 3 4 5 6 # å¤‡ä»½åŸå§‹è½¯ä»¶æºé…ç½® cp /etc/apt/sources.list /etc/apt/sources.list.backup cp /etc/apt/sources.list.d/*.list /etc/apt/sources.list.d/backup/ 2\u0026gt;/dev/null || mkdir -p /etc/apt/sources.list.d/backup \u0026amp;\u0026amp; cp /etc/apt/sources.list.d/*.list /etc/apt/sources.list.d/backup/ # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ ls -la /etc/apt/sources.list.backup /etc/apt/sources.list.d/backup/ ğŸ“¦ æ›´æ¢è½¯ä»¶æºï¼ˆé€‰æ‹©å…¶ä¸€å³å¯ï¼‰ 1. ğŸ¢ æ¸…åå¤§å­¦è½¯ä»¶æº 1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # æ¸…åå¤§å­¦é•œåƒæº deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware EOF 2. ğŸ¦Š ä¸­ç§‘å¤§è½¯ä»¶æº 1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # ä¸­ç§‘å¤§è½¯ä»¶æº deb https://mirrors.ustc.edu.cn/debian/ bookworm main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ bookworm main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ bookworm-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ bookworm-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ bookworm-backports main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ bookworm-backports main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ bookworm-security main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ bookworm-security main contrib non-free EOF 3. â˜ï¸ é˜¿é‡Œäº‘è½¯ä»¶æº 1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # é˜¿é‡Œäº‘è½¯ä»¶æº deb https://mirrors.aliyun.com/debian/ bookworm main non-free contrib deb-src https://mirrors.aliyun.com/debian/ bookworm main non-free contrib deb https://mirrors.aliyun.com/debian-security/ bookworm-security main deb-src https://mirrors.aliyun.com/debian-security/ bookworm-security main deb https://mirrors.aliyun.com/debian/ bookworm-updates main non-free contrib deb-src https://mirrors.aliyun.com/debian/ bookworm-updates main non-free contrib deb https://mirrors.aliyun.com/debian/ bookworm-backports main non-free contrib deb-src https://mirrors.aliyun.com/debian/ bookworm-backports main non-free contrib EOF 4. ğŸŒ©ï¸ è…¾è®¯äº‘è½¯ä»¶æº 1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # è…¾è®¯äº‘è½¯ä»¶æº deb https://mirrors.tencent.com/debian/ bookworm main non-free non-free-firmware contrib deb-src https://mirrors.tencent.com/debian/ bookworm main non-free non-free-firmware contrib deb https://mirrors.tencent.com/debian-security/ bookworm-security main deb-src https://mirrors.tencent.com/debian-security/ bookworm-security main deb https://mirrors.tencent.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb-src https://mirrors.tencent.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb https://mirrors.tencent.com/debian/ bookworm-backports main non-free non-free-firmware contrib deb-src https://mirrors.tencent.com/debian/ bookworm-backports main non-free non-free-firmware contrib EOF 5. ğŸ‡¨ğŸ‡³ åä¸ºäº‘è½¯ä»¶æº 1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # åä¸ºäº‘è½¯ä»¶æº deb https://mirrors.huaweicloud.com/debian/ bookworm main non-free non-free-firmware contrib deb-src https://mirrors.huaweicloud.com/debian/ bookworm main non-free non-free-firmware contrib deb https://mirrors.huaweicloud.com/debian-security/ bookworm-security main deb-src https://mirrors.huaweicloud.com/debian-security/ bookworm-security main deb https://mirrors.huaweicloud.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb-src https://mirrors.huaweicloud.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb https://mirrors.huaweicloud.com/debian/ bookworm-backports main non-free non-free-firmware contrib deb-src https://mirrors.huaweicloud.com/debian/ bookworm-backports main non-free non-free-firmware contrib EOF 6. ğŸ¦Œ ç½‘æ˜“163è½¯ä»¶æº 1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF # ç½‘æ˜“163è½¯ä»¶æº deb https://mirrors.163.com/debian/ bookworm main non-free non-free-firmware contrib deb-src https://mirrors.163.com/debian/ bookworm main non-free non-free-firmware contrib deb https://mirrors.163.com/debian-security/ bookworm-security main deb-src https://mirrors.163.com/debian-security/ bookworm-security main deb https://mirrors.163.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb-src https://mirrors.163.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb https://mirrors.163.com/debian/ bookworm-backports main non-free non-free-firmware contrib deb-src https://mirrors.163.com/debian/ bookworm-backports main non-free non-free-firmware contrib EOF ğŸ¢ ä¼ä¸šæºé…ç½®ï¼ˆé€‰æ‹©å…¶ä¸€ï¼‰ 1. ğŸ¢ æ¸…åå¤§å­¦ä¼ä¸šæº 1 2 3 4 cat \u0026gt; /etc/apt/sources.list.d/pve-enterprise.list \u0026lt;\u0026lt;EOF # æ¸…åå¤§å­¦ä¼ä¸šæº deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian/pve bookworm pve-no-subscription EOF 2. ğŸ¦Š ä¸­ç§‘å¤§ä¼ä¸šæº 1 2 3 4 cat \u0026gt; /etc/apt/sources.list.d/pve-enterprise.list \u0026lt;\u0026lt;EOF # ä¸­ç§‘å¤§ä¼ä¸šæº deb https://mirrors.ustc.edu.cn/proxmox/debian/pve bookworm pve-no-subscription EOF 3. ğŸš« å±è”½ä¼ä¸šæºï¼ˆè§£å†³VUMé—®é¢˜ï¼‰ 1 2 # æ³¨é‡Šæ‰ä¼ä¸šæº sed -i \u0026#39;s/^deb/#deb/\u0026#39; /etc/apt/sources.list.d/pve-enterprise.list ğŸ”“ æ— è®¢é˜…æºé…ç½® ğŸ¦Š ä¸­ç§‘å¤§æ— è®¢é˜…æº 1 2 3 4 cat \u0026gt; /etc/apt/sources.list.d/pve-no-subscription.list \u0026lt;\u0026lt;EOF # ä¸­ç§‘å¤§æ— è®¢é˜…æº deb https://mirrors.ustc.edu.cn/proxmox/debian/pve bookworm pve-no-subscription EOF ğŸŒŠ Cephæºé…ç½® ğŸ¦Š ä¸­ç§‘å¤§Cephæº 1 2 3 4 cat \u0026gt; /etc/apt/sources.list.d/ceph.list \u0026lt;\u0026lt;EOF # ä¸­ç§‘å¤§Cephæº deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-quincy bookworm no-subscription EOF ğŸš« å±è”½Cephæºï¼ˆè§£å†³VUMé—®é¢˜ï¼‰ 1 2 # æ³¨é‡Šæ‰Cephæº sed -i \u0026#39;s/^deb/#deb/\u0026#39; /etc/apt/sources.list.d/ceph.list ğŸ“¦ LXCå®¹å™¨æºé…ç½® ğŸ¢ æ¸…åå¤§å­¦LXCå®¹å™¨æº 1 sed -i \u0026#39;s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g\u0026#39; /usr/share/perl5/PVE/APLInfo.pm ğŸ¦Š ä¸­ç§‘å¤§LXCå®¹å™¨æº 1 sed -i \u0026#39;s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g\u0026#39; /usr/share/perl5/PVE/APLInfo.pm ğŸš« å»é™¤è®¢é˜…å¼¹çª—æé†’ ğŸ“¢ æ³¨æ„ï¼šä¿®æ”¹åéœ€è¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æ‰èƒ½ç”Ÿæ•ˆ\n1. ğŸ”§ æ–¹æ³•ä¸€ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 # ä¿®æ”¹PVEç®¡ç†ç•Œé¢ç›¸å…³æ–‡ä»¶ sed -i.bak \u0026#34;s/data.status === \u0026#39;Active\u0026#39;/true/g\u0026#34; /usr/share/pve-manager/js/pvemanagerlib.js sed -i.bak \u0026#34;s/if (res === null || res === undefined || \\!res || res/if(/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js sed -i.bak \u0026#34;s/.data.status.toLowerCase() !== \u0026#39;active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js # é‡å¯PVEä»£ç†æœåŠ¡ systemctl restart pveproxy 2. âš¡ æ–¹æ³•äºŒï¼ˆä¸€é”®è„šæœ¬ï¼‰ 1 2 sed -i.bak -z \u0026#34;s/res === null || res === undefined || \\!res || res\\n\\t\\t\\t.data.status.toLowerCase() \\!== \u0026#39;active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js systemctl restart pveproxy ğŸ”„ æ›´æ–°ä¸é‡å¯ 1 2 3 4 5 6 7 8 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ apt update # å‡çº§æ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶åŒ… apt dist-upgrade -y # é‡å¯ç³»ç»Ÿä½¿æ›´æ”¹ç”Ÿæ•ˆ reboot âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ”’ å¤‡ä»½é‡è¦æ•°æ®ï¼šåœ¨è¿›è¡Œç³»ç»Ÿé…ç½®æ›´æ”¹å‰ï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ® ğŸŒ ç½‘ç»œè¿æ¥ï¼šç¡®ä¿PVEç³»ç»Ÿå¯ä»¥æ­£å¸¸è®¿é—®äº’è”ç½‘ ğŸ“‹ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šæœ¬æŒ‡å—é’ˆå¯¹Proxmox VE 7.x (Bookworm) ç¼–å†™ï¼Œå…¶ä»–ç‰ˆæœ¬å¯èƒ½éœ€è¦è°ƒæ•´ ğŸ”„ æ›´æ–°ç­–ç•¥ï¼šå®šæœŸæ›´æ–°ç³»ç»Ÿä»¥è·å¾—å®‰å…¨è¡¥ä¸å’ŒåŠŸèƒ½æ”¹è¿› ğŸš« è®¢é˜…æç¤ºï¼šå»é™¤è®¢é˜…æç¤ºåï¼ŒæŸäº›ä¼ä¸šåŠŸèƒ½å¯èƒ½ä»ç„¶å—é™ ğŸ” æ•…éšœæ’é™¤ï¼šå¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æ¢å¤å¤‡ä»½æ–‡ä»¶ï¼š 1 2 3 cp /etc/apt/sources.list.backup /etc/apt/sources.list cp /etc/apt/sources.list.d/backup/*.list /etc/apt/sources.list.d/ apt update ğŸ”„ æœ€åæ›´æ–°ï¼š2024å¹´3æœˆ\nâœ… é€‚ç”¨ç‰ˆæœ¬ï¼šProxmox VE 7.x (Bookworm)\nğŸ·ï¸ æ ‡ç­¾ï¼š#PVE #é•œåƒæº #åŠ é€Ÿ #é…ç½®æŒ‡å—\nğŸ’¡ æç¤ºï¼šé€‰æ‹©è·ç¦»æ‚¨åœ°ç†ä½ç½®æœ€è¿‘çš„é•œåƒæºå¯ä»¥è·å¾—æœ€ä½³ä¸‹è½½é€Ÿåº¦ã€‚å¦‚æœæŸä¸ªé•œåƒæºå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å°è¯•åˆ‡æ¢åˆ°å…¶ä»–é•œåƒæºã€‚\n","date":"2024-12-07T15:58:30+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b621d7a0/","title":"Proxmox VE å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸš€"},{"content":"Alpine å›½å†…æºåŠ é€Ÿé…ç½®æŒ‡å— ğŸ”ï¸ ğŸš€ ä¸ºAlpine Linuxæ›´æ¢å›½å†…é•œåƒæºå¯ä»¥æ˜¾è‘—æå‡è½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦ï¼ŒåŠ é€Ÿç³»ç»Ÿæ›´æ–°å’Œè½¯ä»¶å®‰è£…è¿‡ç¨‹ï¼Œç‰¹åˆ«é€‚åˆå›½å†…ç”¨æˆ·ä½¿ç”¨ã€‚\nâœ¨ Alpine Linux ç‰¹ç‚¹ ğŸ§ è½»é‡çº§ï¼šåŸºç¡€é•œåƒä»…5MBå·¦å³ï¼Œæå…¶ç²¾ç®€ ğŸ”’ å®‰å…¨æ€§ï¼šé‡‡ç”¨musl libcå’ŒBusyBoxï¼Œ attack surfaceå° ğŸ“¦ ç®€å•åŒ…ç®¡ç†ï¼šapkåŒ…ç®¡ç†å™¨ç®€å•æ˜“ç”¨ï¼Œä¾èµ–å¤„ç†ä¼˜ç§€ ğŸ—ï¸ æ¨¡å—åŒ–è®¾è®¡ï¼šå¯æ ¹æ®éœ€è¦å®šåˆ¶æœ€å°åŒ–ç³»ç»Ÿ ğŸ”§ é€‚åˆå®¹å™¨ï¼šå¹¿æ³›ç”¨äºDockeråŸºç¡€é•œåƒ ğŸ“‹ å¯¼èˆªç›®å½• âœ¨ Alpine Linux ç‰¹ç‚¹ ğŸ”§ å‡†å¤‡å·¥ä½œ ğŸ”„ é•œåƒæºé…ç½® ğŸ” éªŒè¯é…ç½® âš™ï¸ é«˜çº§é…ç½® âš ï¸ æ³¨æ„äº‹é¡¹ âœ¨ Alpine Linux ç‰¹ç‚¹ Alpine Linuxæ˜¯ä¸€æ¬¾é¢å‘å®‰å…¨åº”ç”¨çš„è½»é‡çº§Linuxå‘è¡Œç‰ˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nğŸ›¡ï¸ å®‰å…¨å¯¼å‘ï¼šæ‰€æœ‰ç”¨æˆ·æ€äºŒè¿›åˆ¶æ–‡ä»¶éƒ½ç¼–è¯‘ä¸ºä½ç½®æ— å…³å¯æ‰§è¡Œæ–‡ä»¶(PIE)å¹¶å †æ ˆä¿æŠ¤ ğŸ—ï¸ åŸºäºmusl libcï¼šä½¿ç”¨musl libcå’ŒBusyBoxæ›¿ä»£GNUæ ¸å¿ƒå·¥å…· ğŸ“¦ apkåŒ…ç®¡ç†å™¨ï¼šé«˜æ•ˆçš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¾èµ–è§£æå¿«é€Ÿå‡†ç¡® ğŸ‹ å®¹å™¨å‹å¥½ï¼šæ˜¯Dockerå®˜æ–¹æ¨èçš„åŸºç¡€é•œåƒä¹‹ä¸€ ğŸ”§ é«˜åº¦å¯å®šåˆ¶ï¼šå¯ä»¥ä»æœ€å°å®‰è£…å¼€å§‹ï¼ŒæŒ‰éœ€æ·»åŠ è½¯ä»¶åŒ… ğŸ”§ å‡†å¤‡å·¥ä½œ ğŸ“ åœ¨è¿›è¡Œä»»ä½•é…ç½®ä¿®æ”¹å‰ï¼Œè¯·åŠ¡å¿…å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶\n1 2 3 4 5 # å¤‡ä»½åŸå§‹è½¯ä»¶æºé…ç½® cp /etc/apk/repositories /etc/apk/repositories.bak # ç¡®è®¤å¤‡ä»½æ–‡ä»¶ ls -la /etc/apk/repositories.bak ğŸ”„ é•œåƒæºé…ç½®ï¼ˆé€‰æ‹©å…¶ä¸€å³å¯ï¼‰ 1. â˜ï¸ é˜¿é‡Œäº‘é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 13 cat \u0026gt; /etc/apk/repositories \u0026lt;\u0026lt;EOF # é˜¿é‡Œäº‘é•œåƒç«™ # ç¨³å®šç‰ˆ (æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨) # http://mirrors.aliyun.com/alpine/v3.19/main/ # http://mirrors.aliyun.com/alpine/v3.19/community/ # è¾¹ç¼˜ç‰ˆ (æ¨èå¼€å‘ç¯å¢ƒä½¿ç”¨) http://mirrors.aliyun.com/alpine/edge/main/ http://mirrors.aliyun.com/alpine/edge/community/ EOF # æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼• apk update \u0026amp;\u0026amp; apk upgrade 2. ğŸ¢ æ¸…åå¤§å­¦é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026gt; /etc/apk/repositories \u0026lt;\u0026lt;EOF # æ¸…åå¤§å­¦é•œåƒç«™ # ç¨³å®šç‰ˆ # https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.19/main/ # https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.19/community/ # è¾¹ç¼˜ç‰ˆ https://mirrors.tuna.tsinghua.edu.cn/alpine/edge/main/ https://mirrors.tuna.tsinghua.edu.cn/alpine/edge/community/ EOF apk update \u0026amp;\u0026amp; apk upgrade 3. ğŸŒ©ï¸ è…¾è®¯äº‘é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026gt; /etc/apk/repositories \u0026lt;\u0026lt;EOF # è…¾è®¯äº‘é•œåƒç«™ # ç¨³å®šç‰ˆ # https://mirrors.tencent.com/alpine/v3.19/main/ # https://mirrors.tencent.com/alpine/v3.19/community/ # è¾¹ç¼˜ç‰ˆ https://mirrors.tencent.com/alpine/edge/main/ https://mirrors.tencent.com/alpine/edge/community/ EOF apk update \u0026amp;\u0026amp; apk upgrade 4. ğŸ‡¨ğŸ‡³ åä¸ºäº‘é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026gt; /etc/apk/repositories \u0026lt;\u0026lt;EOF # åä¸ºäº‘é•œåƒç«™ # ç¨³å®šç‰ˆ # https://mirrors.huaweicloud.com/alpine/v3.19/main/ # https://mirrors.huaweicloud.com/alpine/v3.19/community/ # è¾¹ç¼˜ç‰ˆ https://mirrors.huaweicloud.com/alpine/edge/main/ https://mirrors.huaweicloud.com/alpine/edge/community/ EOF apk update \u0026amp;\u0026amp; apk upgrade 5. ğŸ¦Š ä¸­ç§‘å¤§é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026gt; /etc/apk/repositories \u0026lt;\u0026lt;EOF # ä¸­ç§‘å¤§é•œåƒç«™ # ç¨³å®šç‰ˆ # https://mirrors.ustc.edu.cn/alpine/v3.19/main/ # https://mirrors.ustc.edu.cn/alpine/v3.19/community/ # è¾¹ç¼˜ç‰ˆ https://mirrors.ustc.edu.cn/alpine/edge/main/ https://mirrors.ustc.edu.cn/alpine/edge/community/ EOF apk update \u0026amp;\u0026amp; apk upgrade ğŸ” éªŒè¯é…ç½® æŸ¥çœ‹å½“å‰è½¯ä»¶æºé…ç½® 1 2 3 4 5 # æŸ¥çœ‹å½“å‰é…ç½®çš„é•œåƒæº cat /etc/apk/repositories # æµ‹è¯•é•œåƒæºè¿æ¥é€Ÿåº¦ apk update æµ‹è¯•è½¯ä»¶åŒ…å®‰è£… 1 2 3 4 5 # å®‰è£…æµ‹è¯•è½¯ä»¶åŒ…éªŒè¯é•œåƒæºå·¥ä½œæ­£å¸¸ apk add nano curl # æŸ¥çœ‹è½¯ä»¶åŒ…ä¿¡æ¯ apk info âš™ï¸ é«˜çº§é…ç½® æ‰‹åŠ¨ç¼–è¾‘è½¯ä»¶æºé…ç½®æ–‡ä»¶ 1 2 3 4 5 # ä½¿ç”¨nanoç¼–è¾‘å™¨æ‰‹åŠ¨ç¼–è¾‘ nano /etc/apk/repositories # æˆ–è€…ä½¿ç”¨viç¼–è¾‘å™¨ vi /etc/apk/repositories æ·»åŠ æµ‹è¯•å’Œç¤¾åŒºä»“åº“ 1 2 3 4 5 # å¦‚æœéœ€è¦ä½¿ç”¨æµ‹è¯•ç‰ˆè½¯ä»¶åŒ…ï¼Œå¯ä»¥æ·»åŠ testingä»“åº“ echo \u0026#34;http://mirrors.aliyun.com/alpine/edge/testing/\u0026#34; \u0026gt;\u0026gt; /etc/apk/repositories # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ apk update ç‰ˆæœ¬ç‰¹å®šé…ç½® 1 2 3 4 5 # å¦‚æœéœ€è¦ç‰¹å®šç‰ˆæœ¬ï¼Œæ›¿æ¢edgeä¸ºç‰ˆæœ¬å·(å¦‚v3.19) sed -i \u0026#39;s/edge/v3.19/g\u0026#39; /etc/apk/repositories # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ apk update âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ¯ ç‰ˆæœ¬é€‰æ‹©ï¼š\nedge æ˜¯æ»šåŠ¨å‘å¸ƒç‰ˆæœ¬ï¼ŒåŒ…å«æœ€æ–°è½¯ä»¶åŒ… v3.x æ˜¯ç¨³å®šç‰ˆæœ¬ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ ğŸ”„ æ›´æ–°ç­–ç•¥ï¼š\n1 2 3 4 5 # å®šæœŸæ›´æ–°ç³»ç»Ÿ apk update \u0026amp;\u0026amp; apk upgrade # å…¨é¢å‡çº§ç³»ç»Ÿ(åŒ…æ‹¬å†…æ ¸) apk update \u0026amp;\u0026amp; apk full-upgrade ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘ï¼š\nç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¨³å®šç‰ˆæœ¬(v3.x) å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨edgeç‰ˆæœ¬è·å–æœ€æ–°åŠŸèƒ½ ğŸ”§ æ•…éšœæ’é™¤ï¼š\n1 2 3 4 5 6 7 8 # å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ¢å¤å¤‡ä»½é…ç½® cp /etc/apk/repositories.bak /etc/apk/repositories # æ¸…é™¤ç¼“å­˜ rm -rf /var/cache/apk/* # é‡æ–°æ›´æ–° apk update ğŸŒ ç½‘ç»œé—®é¢˜ï¼š\nå¦‚æœæŸä¸ªé•œåƒæºè®¿é—®ä¸ç•…ï¼Œå¯å°è¯•å…¶ä»–é•œåƒæº ä½¿ç”¨pingå‘½ä»¤æµ‹è¯•é•œåƒæºå»¶è¿Ÿ 1 ping mirrors.aliyun.com -c 4 ğŸ“¦ Dockerä¸­ä½¿ç”¨ï¼š\n1 2 3 4 # åœ¨Dockerfileä¸­è®¾ç½®Alpineé•œåƒæº RUN echo \u0026#34;http://mirrors.aliyun.com/alpine/edge/main/\u0026#34; \u0026gt; /etc/apk/repositories \u0026amp;\u0026amp; \\ echo \u0026#34;http://mirrors.aliyun.com/alpine/edge/community/\u0026#34; \u0026gt;\u0026gt; /etc/apk/repositories \u0026amp;\u0026amp; \\ apk update \u0026amp;\u0026amp; apk add --no-cache curl ğŸ’¡ æç¤ºï¼šé€‰æ‹©è·ç¦»æ‚¨åœ°ç†ä½ç½®æœ€è¿‘çš„é•œåƒæºå¯ä»¥è·å¾—æœ€ä½³ä¸‹è½½é€Ÿåº¦ã€‚å¦‚æœä½¿ç”¨Dockerï¼Œå¯ä»¥åœ¨æ„å»ºé•œåƒæ—¶è®¾ç½®é•œåƒæºä»¥åŠ é€Ÿæ„å»ºè¿‡ç¨‹ã€‚\n","date":"2024-12-07T15:57:50+08:00","image":"https://file.meimolihan.eu.org/img/alpine-01.webp","permalink":"https://blog.meimolihan.eu.org/p/18e82f54/","title":"Alpine å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸ”ï¸"},{"content":"Proxmox VE è™šæ‹Ÿæœºå’Œ LXC å®¹å™¨ç®¡ç†å‘½ä»¤ ğŸ§ ğŸš€ å…¨é¢æ•´ç† Proxmox VE (PVE) ä¸­è™šæ‹Ÿæœºå’Œ LXC å®¹å™¨çš„ç®¡ç†å‘½ä»¤ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆç®¡ç†è™šæ‹ŸåŒ–ç¯å¢ƒ\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ PVE ç®¡ç†æ¦‚è¿° ğŸ–¥ï¸ è™šæ‹Ÿæœºç®¡ç†å‘½ä»¤ ğŸ“¦ LXC å®¹å™¨ç®¡ç†å‘½ä»¤ ğŸ”§ é«˜çº§ç®¡ç†æŠ€å·§ ğŸ“Š å‘½ä»¤å¯¹æ¯”è¡¨ ğŸ’¡ å®ç”¨æç¤ºä¸æŠ€å·§ ğŸš¨ æ³¨æ„äº‹é¡¹ ğŸ¯ æ‰©å±•èµ„æº âœ¨ PVE ç®¡ç†æ¦‚è¿° Proxmox VE æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨è™šæ‹ŸåŒ–ç®¡ç†å¹³å°ï¼Œå®ƒåŒæ—¶æ”¯æŒåŸºäº KVM çš„è™šæ‹Ÿæœºå’ŒåŸºäº LXC çš„å®¹å™¨ã€‚æœ¬æ–‡å°†ä»‹ç»å¸¸ç”¨çš„è™šæ‹Ÿæœº (QM) å’Œå®¹å™¨ (PCT/LXC) ç®¡ç†å‘½ä»¤ã€‚\nğŸ¯ ä¸»è¦ç‰¹æ€§ï¼š\nğŸ³ åŒæ—¶æ”¯æŒKVMè™šæ‹Ÿæœºå’ŒLXCå®¹å™¨ ğŸ”§ å®Œæ•´çš„Webç®¡ç†ç•Œé¢ ğŸ“Š ä¸°å¯Œçš„å‘½ä»¤è¡Œå·¥å…· ğŸŒ é›†ç¾¤ç®¡ç†èƒ½åŠ› ğŸ’¾ é›†æˆå¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ ğŸ–¥ï¸ ä¸€ã€è™šæ‹Ÿæœº (QM) ç®¡ç†å‘½ä»¤ 1. æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿæœºåˆ—è¡¨ qm list # æŸ¥çœ‹æŒ‡å®šè™šæ‹ŸæœºçŠ¶æ€ qm status 100 # æŸ¥çœ‹è™šæ‹Ÿæœºé…ç½® qm config 100 2. è™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯åŠ¨è™šæ‹Ÿæœº (vmid: 100) qm start 100 # å…³é—­è™šæ‹Ÿæœº qm stop 100 # é‡å¯è™šæ‹Ÿæœº qm reboot 100 # æŒ‚èµ·è™šæ‹Ÿæœº qm suspend 100 # æ¢å¤æŒ‚èµ·çš„è™šæ‹Ÿæœº qm resume 100 3. è™šæ‹Ÿæœºé…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®è™šæ‹Ÿæœºå†…å­˜ä¸º2GB qm set 100 -memory 2048 # è®¾ç½®CPUæ ¸å¿ƒæ•° qm set 100 -cores 2 # æ·»åŠ ç£ç›˜ qm set 100 -scsi0 storage:32 # æ·»åŠ ç½‘ç»œæ¥å£ qm set 100 -net0 virtio,bridge=vmbr0 4. è™šæ‹Ÿæœºå¿«ç…§å’Œå¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºå¿«ç…§ qm snapshot 100 snap1 # æ¢å¤å¿«ç…§ qm rollback 100 snap1 # åˆ é™¤å¿«ç…§ qm delsnapshot 100 snap1 # å¤‡ä»½è™šæ‹Ÿæœº qm backup 100 backup-storage ğŸ“¦ äºŒã€LXC å®¹å™¨ (PCT/LXC) ç®¡ç†å‘½ä»¤ 1. æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åˆ—è¡¨ pct list # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ pct status 200 # æŸ¥çœ‹å®¹å™¨é…ç½® pct config 200 2. å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯åŠ¨å®¹å™¨ (vmid: 200) pct start 200 # å…³é—­å®¹å™¨ pct stop 200 # é‡å¯å®¹å™¨ pct reboot 200 # è¿›å…¥å®¹å™¨æ§åˆ¶å° pct enter 200 # é€€å‡ºæ§åˆ¶å° (åœ¨å®¹å™¨å†…) exit 3. å®¹å™¨é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®å®¹å™¨å†…å­˜é™åˆ¶ pct set 200 -memory 512 # è®¾ç½®CPUé™åˆ¶ pct set 200 -cores 1 # è®¾ç½®æ ¹æ–‡ä»¶ç³»ç»Ÿå¤§å° pct set 200 -rootfs 8 # æ·»åŠ æŒ‚è½½ç‚¹ pct set 200 -mp0 /path/on/host,mp=/path/in/container 4. å®¹å™¨æ¨¡æ¿å’Œå…‹éš† 1 2 3 4 5 # ä»æ¨¡æ¿åˆ›å»ºå®¹å™¨ pct create 200 local:vztmpl/ubuntu-20.04-standard_20.04-1_amd64.tar.gz # å…‹éš†å®¹å™¨ pct clone 200 201 --hostname new-container ğŸ”§ ä¸‰ã€é«˜çº§ç®¡ç†æŠ€å·§ 1. æ‰¹é‡æ“ä½œå‘½ä»¤ 1 2 3 4 5 6 7 8 # å¯åŠ¨æ‰€æœ‰å·²å…³é—­çš„è™šæ‹Ÿæœº for vm in $(qm list | awk \u0026#39;/stopped/ {print $1}\u0026#39;); do qm start $vm; done # å…³é—­æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ for ct in $(pct list | awk \u0026#39;/running/ {print $1}\u0026#39;); do pct stop $ct; done # é‡å¯æ‰€æœ‰è™šæ‹Ÿæœº qm list | awk \u0026#39;/running/ {print $1}\u0026#39; | xargs -I {} qm reboot {} 2. èµ„æºç›‘æ§å‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ pvesh get /cluster/resources # æŸ¥çœ‹è™šæ‹Ÿæœºæ€§èƒ½æ•°æ® qm monitor 100 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ pct exec 200 -- free -h 3. è¿ç§»å’Œå¤åˆ¶ 1 2 3 4 5 6 7 8 # è¿ç§»è™šæ‹Ÿæœºåˆ°å…¶ä»–èŠ‚ç‚¹ qm migrate 100 target-node --online # å¤åˆ¶è™šæ‹Ÿæœº qm clone 100 101 --name new-vm # ç§»åŠ¨ç£ç›˜å­˜å‚¨ qm move-disk 100 scsi0 new-storage --delete 1 ğŸ“Š å››ã€å¸¸ç”¨å‘½ä»¤å¯¹æ¯”è¡¨ æ“ä½œ è™šæ‹Ÿæœºå‘½ä»¤ å®¹å™¨å‘½ä»¤ æŸ¥çœ‹åˆ—è¡¨ qm list pct list å¯åŠ¨ qm start \u0026lt;vmid\u0026gt; pct start \u0026lt;vmid\u0026gt; åœæ­¢ qm stop \u0026lt;vmid\u0026gt; pct stop \u0026lt;vmid\u0026gt; é‡å¯ qm reboot \u0026lt;vmid\u0026gt; pct reboot \u0026lt;vmid\u0026gt; æŸ¥çœ‹é…ç½® qm config \u0026lt;vmid\u0026gt; pct config \u0026lt;vmid\u0026gt; è¿›å…¥æ§åˆ¶å° - pct enter \u0026lt;vmid\u0026gt; è®¾ç½®å†…å­˜ qm set \u0026lt;vmid\u0026gt; -memory \u0026lt;size\u0026gt; pct set \u0026lt;vmid\u0026gt; -memory \u0026lt;size\u0026gt; åˆ›å»ºå¿«ç…§ qm snapshot \u0026lt;vmid\u0026gt; \u0026lt;name\u0026gt; pct snapshot \u0026lt;vmid\u0026gt; \u0026lt;name\u0026gt; ğŸ’¡ äº”ã€å®ç”¨æç¤ºä¸æŠ€å·§ 1. å‘½ä»¤åˆ«åè®¾ç½® 1 2 3 4 5 6 # åœ¨ ~/.bashrc ä¸­æ·»åŠ åˆ«å echo \u0026#34;alias vmlist=\u0026#39;qm list\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias ctlist=\u0026#39;pct list\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias vmstart=\u0026#39;qm start\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias ctstart=\u0026#39;pct start\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc 2. å¼ºåˆ¶æ“ä½œå‘½ä»¤ 1 2 3 4 5 6 7 8 # å¼ºåˆ¶åœæ­¢è™šæ‹Ÿæœº (è°¨æ…ä½¿ç”¨) qm stop 100 --forceStop # å¼ºåˆ¶åœæ­¢å®¹å™¨ pct stop 200 --force # å¼ºåˆ¶åˆ é™¤è™šæ‹Ÿæœº qm destroy 100 --purge 3. æ—¥å¿—æŸ¥çœ‹å‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹è™šæ‹Ÿæœºæ—¥å¿— cat /var/log/pve/tasks/active # æŸ¥çœ‹å®¹å™¨æ§åˆ¶å°æ—¥å¿— pct console 200 # å®æ—¶ç›‘æ§ç³»ç»Ÿæ—¥å¿— journalctl -f -u pvedaemon 4. ç½‘ç»œé…ç½®å‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç½‘ç»œé…ç½® cat /etc/network/interfaces # é‡å¯ç½‘ç»œæœåŠ¡ systemctl restart networking # æŸ¥çœ‹æ¡¥æ¥ç½‘ç»œçŠ¶æ€ brctl show ğŸš¨ å…­ã€æ³¨æ„äº‹é¡¹ âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ æƒé™ç®¡ç†ï¼š\n1 2 3 # ä½¿ç”¨é€‚å½“çš„æƒé™è¿è¡Œå‘½ä»¤ sudo qm list sudo pct list æ•°æ®å®‰å…¨ï¼š\nğŸ”’ é‡è¦æ“ä½œå‰åŠ¡å¿…å¤‡ä»½æ•°æ® ğŸ’¾ å®šæœŸéªŒè¯å¤‡ä»½å®Œæ•´æ€§ ğŸ“‹ è®°å½•æ‰€æœ‰å˜æ›´æ“ä½œ èµ„æºé™åˆ¶ï¼š\nğŸ–¥ï¸ ç¡®ä¿ç‰©ç†èµ„æºå……è¶³ ğŸ“Š ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ âš¡ é¿å…è¿‡åº¦åˆ†é…èµ„æº ğŸ”§ æœ€ä½³å®è·µ ç‰ˆæœ¬æ§åˆ¶ï¼š\n1 2 # è®°å½•PVEç‰ˆæœ¬ä¿¡æ¯ pveversion -v å®šæœŸç»´æŠ¤ï¼š\n1 2 3 # æ¸…ç†æ—§å¿«ç…§å’Œå¤‡ä»½ qm listsnapshot 100 pct listsnapshot 200 ç›‘æ§å‘Šè­¦ï¼š\n1 2 # è®¾ç½®ç›‘æ§é˜ˆå€¼ pvesh set /nodes/{node}/subscription -key value ğŸ¯ æ‰©å±•èµ„æº ğŸ“š å®˜æ–¹æ–‡æ¡£ Proxmox VE å®˜æ–¹æ–‡æ¡£ API å‚è€ƒæ–‡æ¡£ ğŸ”§ å¸¸ç”¨å·¥å…· 1 2 3 4 5 6 7 8 # å®‰è£…å¸¸ç”¨å·¥å…· apt install -y htop iotop iftop nmon # ç³»ç»Ÿç›‘æ§å‘½ä»¤ htop # è¿›ç¨‹ç›‘æ§ iotop # IOç›‘æ§ iftop # ç½‘ç»œæµé‡ç›‘æ§ nmon # æ€§èƒ½ç›‘æ§ ğŸŒ ç¤¾åŒºæ”¯æŒ Proxmox å®˜æ–¹è®ºå› GitHub Issues Reddit ç¤¾åŒº ğŸ’¡ æç¤ºï¼šPVE æä¾›äº†ä¸°å¯Œçš„ Web ç®¡ç†ç•Œé¢ï¼Œå¤§å¤šæ•°æ“ä½œéƒ½å¯ä»¥é€šè¿‡ GUI å®Œæˆã€‚å‘½ä»¤è¡Œå·¥å…·æ›´é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬å’Œæ‰¹é‡æ“ä½œã€‚\nğŸ”„ æœ€åæ›´æ–°ï¼š2024å¹´3æœˆ\nâœ… é€‚ç”¨ç‰ˆæœ¬ï¼šProxmox VE 7.x/8.x\nğŸ·ï¸ æ ‡ç­¾ï¼š#Proxmox #PVE #è™šæ‹ŸåŒ– #å®¹å™¨ #è¿ç»´å‘½ä»¤\nå¸Œæœ›è¿™ä»½å®Œæ•´çš„ PVE ç®¡ç†å‘½ä»¤æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ç®¡ç†è™šæ‹ŸåŒ–å’Œå®¹å™¨ç¯å¢ƒï¼ ğŸš€\n","date":"2024-12-07T15:52:36+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b8c8c73c/","title":"Proxmox VE è™šæ‹Ÿæœºå’Œ LXC å®¹å™¨ç®¡ç†å‘½ä»¤ ğŸ§"},{"content":"Proxmox VE åˆ é™¤ç£ç›˜ç›®å½•æŒ‡å— ğŸ—‘ï¸ ğŸš€ å®‰å…¨ç§»é™¤PVEå­˜å‚¨ç›®å½•ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ï¼æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨Proxmox VEç¯å¢ƒä¸­å®‰å…¨åˆ é™¤å­˜å‚¨ç›®å½•çš„å¤šç§æ–¹æ³•ï¼ŒåŒ…æ‹¬å›¾å½¢ç•Œé¢æ“ä½œå’Œå‘½ä»¤è¡ŒæŠ€å·§ã€‚\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ PVE å­˜å‚¨ç®¡ç†ç‰¹ç‚¹ ğŸ¯ æ–¹æ³•æ¦‚è§ˆ ğŸ–¥ï¸ å›¾å½¢ç•Œé¢åˆ é™¤ âŒ¨ï¸ å‘½ä»¤è¡Œåˆ é™¤ ğŸ”§ é«˜çº§æ¸…ç† âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ’¡ æœ€ä½³å®è·µ âœ¨ PVE å­˜å‚¨ç®¡ç†ç‰¹ç‚¹ Proxmox VEï¼ˆPVEï¼‰æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å­˜å‚¨ç®¡ç†ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nğŸ”€ å¤šå­˜å‚¨ç±»å‹æ”¯æŒï¼šæ”¯æŒç›®å½•å­˜å‚¨ã€LVMã€iSCSIã€Cephã€NFSç­‰å¤šç§å­˜å‚¨ç±»å‹ ğŸŒ é›†ä¸­ç®¡ç†ï¼šé€šè¿‡ç»Ÿä¸€çš„Webç•Œé¢ç®¡ç†æ‰€æœ‰å­˜å‚¨èµ„æº âš¡ å®æ—¶æ“ä½œï¼šæ”¯æŒå­˜å‚¨çš„å®æ—¶æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ï¼Œæ— éœ€é‡å¯æœåŠ¡ ğŸ”’ æ•°æ®å®‰å…¨ï¼šæä¾›å­˜å‚¨çº§åˆ«çš„å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ ğŸ“Š å¯è§†åŒ–ç›‘æ§ï¼šç›´è§‚å±•ç¤ºå­˜å‚¨ä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ ğŸ¯ æ–¹æ³•æ¦‚è§ˆ ğŸ“Š åˆ é™¤æ–¹æ³•å¯¹æ¯” æ–¹æ³• éš¾åº¦ å®‰å…¨æ€§ é€‚ç”¨åœºæ™¯ ğŸ–¥ï¸ å›¾å½¢ç•Œé¢ â­â˜†â˜†â˜†â˜† âœ… é«˜ ç®€å•ç›®å½•åˆ é™¤ âŒ¨ï¸ å‘½ä»¤è¡Œ â­â­â˜†â˜†â˜† âš ï¸ ä¸­ é«˜çº§ç”¨æˆ·ä½¿ç”¨ ğŸ”§ æ‰‹åŠ¨æ¸…ç† â­â­â­â­â­ â—ï¸ ä½ ç‰¹æ®Šæ•…éšœä¿®å¤ ğŸ–¥ï¸ å›¾å½¢ç•Œé¢åˆ é™¤ æ­¥éª¤ä¸€ï¼šè®¿é—®PVEç®¡ç†ç•Œé¢ æ‰“å¼€æµè§ˆå™¨ â†’ è¾“å…¥PVEç®¡ç†åœ°å€ï¼ˆå¦‚ï¼šhttps://192.168.1.100:8006ï¼‰ ç™»å½•ä½ çš„ç®¡ç†å‘˜è´¦æˆ· æ­¥éª¤äºŒï¼šå¯¼èˆªåˆ°å­˜å‚¨è®¾ç½® 1 å·¦ä¾§èœå• â†’ [æ•°æ®ä¸­å¿ƒ] â†’ [å­˜å‚¨] â†’ é€‰æ‹©è¦åˆ é™¤çš„ç›®å½• æ­¥éª¤ä¸‰ï¼šåˆ é™¤å­˜å‚¨ç›®å½• é€‰ä¸­è¦åˆ é™¤çš„å­˜å‚¨ç›®å½• ç‚¹å‡»é¡¶éƒ¨çš„ ã€åˆ é™¤ã€‘ æŒ‰é’® ç¡®è®¤åˆ é™¤æ“ä½œ æ­¥éª¤å››ï¼šéªŒè¯åˆ é™¤ åˆ·æ–°é¡µé¢ç¡®è®¤ç›®å½•å·²æ¶ˆå¤± æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦é‡Šæ”¾ âŒ¨ï¸ å‘½ä»¤è¡Œåˆ é™¤ æ–¹æ³•ä¸€ï¼šç¼–è¾‘å­˜å‚¨é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. å¤‡ä»½é…ç½®æ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰ sudo cp /etc/pve/storage.cfg /etc/pve/storage.cfg.backup # 2. ç¼–è¾‘å­˜å‚¨é…ç½®æ–‡ä»¶ sudo vi /etc/pve/storage.cfg # 3. æ‰¾åˆ°è¦åˆ é™¤çš„ç›®å½•é…ç½®å— # ç¤ºä¾‹é…ç½®å†…å®¹ï¼š # dir: local # path /var/lib/vz # content iso,vztmpl,backup # shared 0 # 4. åˆ é™¤å¯¹åº”çš„é…ç½®å—ï¼ˆæ•´æ®µåˆ é™¤ï¼‰ # 5. ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ æ–¹æ³•äºŒï¼šä½¿ç”¨pvesmå·¥å…· 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰å­˜å‚¨åˆ—è¡¨ sudo pvesm status # åˆ é™¤æŒ‡å®šå­˜å‚¨ sudo pvesm remove \u0026lt;å­˜å‚¨åç§°\u0026gt; # ç¤ºä¾‹ï¼šåˆ é™¤åä¸º\u0026#34;local-backup\u0026#34;çš„å­˜å‚¨ sudo pvesm remove local-backup æ–¹æ³•ä¸‰ï¼šæ¸…ç†æŒ‚è½½ç‚¹ï¼ˆå¦‚é€‚ç”¨ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. è¿›å…¥systemdæœåŠ¡ç›®å½• cd /etc/systemd/system # 2. æŸ¥æ‰¾ç›¸å…³çš„æŒ‚è½½æœåŠ¡æ–‡ä»¶ ls -la | grep -i \u0026#34;mount\u0026#34; # 3. åˆ é™¤å¯¹åº”çš„æŒ‚è½½æœåŠ¡æ–‡ä»¶ sudo rm /etc/systemd/system/mnt-pve-xxx.mount # 4. é‡æ–°åŠ è½½systemdé…ç½® sudo systemctl daemon-reload # 5. æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl list-units --type=mount ğŸ”§ é«˜çº§æ¸…ç† æ¸…ç†æ®‹ç•™æ–‡ä»¶ 1 2 3 4 5 6 # æ£€æŸ¥å¹¶æ¸…ç†ç‰©ç†ç›®å½•ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ sudo du -sh /var/lib/vz/* # æŸ¥çœ‹ç›®å½•å¤§å° sudo rm -rf /path/to/unwanted/directory # åˆ é™¤ç›®å½• # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ sudo find /tmp -name \u0026#34;*pve*\u0026#34; -type f -mtime +7 -delete æ£€æŸ¥å¹¶ä¿®å¤é…ç½® 1 2 3 4 5 6 7 8 9 # éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³• sudo pveverify storage.cfg # é‡æ–°è¯»å–é…ç½® sudo systemctl restart pvedaemon sudo systemctl restart pveproxy # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status pvedaemon pveproxy âš ï¸ æ³¨æ„äº‹é¡¹ ğŸš¨ é‡è¦è­¦å‘Š ğŸ“‹ å¤‡ä»½ä¼˜å…ˆï¼šæ“ä½œå‰åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®å’Œé…ç½®æ–‡ä»¶ ğŸ” ç¡®è®¤ç›®æ ‡ï¼šç¡®ä¿åˆ é™¤çš„æ˜¯æ­£ç¡®çš„ç›®å½•ï¼Œé¿å…è¯¯åˆ  â° æœåŠ¡å½±å“ï¼šåˆ é™¤æ“ä½œå¯èƒ½å¯¼è‡´ç›¸å…³æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ ğŸ“Š æ•°æ®å®‰å…¨ï¼šç¡®ä¿ç›®å½•ä¸­æ²¡æœ‰é‡è¦è™šæ‹Ÿæœºæˆ–å¤‡ä»½æ–‡ä»¶ âŒ å¸¸è§é”™è¯¯ 1 2 3 4 5 6 7 8 # é”™è¯¯ï¼šå­˜å‚¨æ­£åœ¨ä½¿ç”¨ä¸­ # è§£å†³æ–¹æ¡ˆï¼šå…ˆè¿ç§»æˆ–åœæ­¢ä½¿ç”¨è¯¥å­˜å‚¨çš„è™šæ‹Ÿæœº # é”™è¯¯ï¼šæƒé™ä¸è¶³ # è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨sudoæˆ–rootæƒé™ # é”™è¯¯ï¼šé…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ # è§£å†³æ–¹æ¡ˆï¼šä»å¤‡ä»½æ¢å¤æˆ–æ‰‹åŠ¨ä¿®å¤ ğŸ”„ æ¢å¤æ–¹æ³• 1 2 3 4 5 # å¦‚æœè¯¯åˆ ï¼Œä»å¤‡ä»½æ¢å¤ sudo cp /etc/pve/storage.cfg.backup /etc/pve/storage.cfg # é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ sudo systemctl restart pvedaemon pveproxy ğŸ’¡ æœ€ä½³å®è·µ ğŸ“ æ“ä½œæ¸…å• âœ… [ ] å¤‡ä»½é‡è¦æ•°æ® âœ… [ ] ç¡®è®¤è¦åˆ é™¤çš„ç›®å½• âœ… [ ] æ£€æŸ¥ç›®å½•ä½¿ç”¨æƒ…å†µ âœ… [ ] åœæ­¢ç›¸å…³æœåŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰ âœ… [ ] æ‰§è¡Œåˆ é™¤æ“ä½œ âœ… [ ] éªŒè¯åˆ é™¤ç»“æœ âœ… [ ] æ¸…ç†æ®‹ç•™æ–‡ä»¶ âœ… [ ] æ›´æ–°æ–‡æ¡£è®°å½• ğŸ›¡ï¸ é¢„é˜²æªæ–½ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®šæœŸæ¸…ç†æ— ç”¨å­˜å‚¨ sudo pvesm list --enabled | grep unused # ç›‘æ§å­˜å‚¨ä½¿ç”¨æƒ…å†µ sudo df -h /var/lib/vz/ # è®¾ç½®å­˜å‚¨ä½¿ç”¨è­¦æŠ¥ #!/bin/bash THRESHOLD=90 USAGE=$(df /var/lib/vz/ | awk \u0026#39;NR==2 {print $5}\u0026#39; | sed \u0026#39;s/%//\u0026#39;) if [ $USAGE -gt $THRESHOLD ]; then echo \u0026#34;å­˜å‚¨ç©ºé—´ä¸è¶³è­¦å‘Šï¼\u0026#34; | mail -s \u0026#34;PVEå­˜å‚¨è­¦æŠ¥\u0026#34; admin@example.com fi ğŸ“Š å­˜å‚¨ç®¡ç†æŠ€å·§ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å­˜å‚¨è¯¦ç»†ä¿¡æ¯ sudo pvesm status -verbose # æ£€æŸ¥å­˜å‚¨å†…å®¹ sudo pvesm scan \u0026lt;å­˜å‚¨åç§°\u0026gt; # ä¼˜åŒ–å­˜å‚¨ç©ºé—´ sudo pvesm alloc \u0026lt;å­˜å‚¨åç§°\u0026gt; \u0026lt;è™šæ‹ŸæœºID\u0026gt; ğŸ¯ æç¤ºï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒç»ƒä¹ åˆ é™¤æ“ä½œï¼Œç¡®è®¤æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œã€‚å¦‚æœ‰ç–‘é—®ï¼Œå‚è€ƒPVEå®˜æ–¹æ–‡æ¡£æˆ–å¯»æ±‚ç¤¾åŒºå¸®åŠ©ã€‚\nğŸ”§ éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ\nğŸ“š PVEå®˜æ–¹æ–‡æ¡£ï¼šhttps://pve.proxmox.com/wiki/Storage ğŸ’¬ ç¤¾åŒºè®ºå›ï¼šhttps://forum.proxmox.com/ ğŸ› BugæŠ¥å‘Šï¼šhttps://bugzilla.proxmox.com/ ","date":"2024-12-07T15:51:43+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/252425a6/","title":"Proxmox VE åˆ é™¤ç£ç›˜ç›®å½•æŒ‡å— ğŸ—‘ï¸"},{"content":"Linux ç³»ç»ŸæŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ä¿®å¤æŒ‡å— ğŸ”„ ğŸ› ï¸ è§£å†³æ–‡ä»¶ç³»ç»Ÿåªè¯»é—®é¢˜ï¼Œæ¢å¤ç³»ç»Ÿæ­£å¸¸è¯»å†™åŠŸèƒ½ï¼æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†è¯Šæ–­å’Œä¿®å¤Linuxæ–‡ä»¶ç³»ç»Ÿåªè¯»é—®é¢˜çš„æ–¹æ³•ï¼Œä»å¿«é€Ÿè§£å†³æ–¹æ¡ˆåˆ°æ·±å…¥æ’æŸ¥æŠ€å·§ã€‚\nğŸ“– ç›®å½•å¯¼èˆª ğŸ” é—®é¢˜è¯Šæ–­ ğŸš€ å¿«é€Ÿä¿®å¤ ğŸ”§ è¯¦ç»†æ­¥éª¤ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ’¡ é¢„é˜²æªæ–½ ğŸ” é—®é¢˜è¯Šæ–­ 1. æ£€æŸ¥å½“å‰æŒ‚è½½çŠ¶æ€ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹æ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½çŠ¶æ€ mount | grep \u0026#34;^/\u0026#34; # æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¿¡æ¯ mount | grep -E \u0026#34;(ro|rw)\u0026#34; # ç¤ºä¾‹è¾“å‡ºï¼š # /dev/sda2 on / type ext4 (ro,relatime) # âœ… å¦‚æœæ˜¾ç¤º \u0026#39;ro\u0026#39; è¡¨ç¤ºåªè¯»ï¼Œ\u0026#39;rw\u0026#39; è¡¨ç¤ºè¯»å†™ 2. æ£€æŸ¥ç£ç›˜ç©ºé—´çŠ¶æ€ 1 2 3 4 5 6 7 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h # æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ df -i # ğŸš¨ å¦‚æœä½¿ç”¨ç‡æ¥è¿‘100%ï¼Œå¯èƒ½å¯¼è‡´åªè¯»æ¨¡å¼ 3. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— 1 2 3 4 5 6 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ dmesg | grep -i \u0026#34;read-only\u0026#34; journalctl -p 3 -xb | grep -i \u0026#34;read-only\u0026#34; # ğŸ“‹ æŸ¥çœ‹æœ€è¿‘çš„ç³»ç»Ÿæ¶ˆæ¯ tail -50 /var/log/syslog ğŸš€ å¿«é€Ÿä¿®å¤ æ–¹æ³•ä¸€ï¼šé‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ 1 2 3 4 5 # å°è¯•é‡æ–°æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ sudo mount -o remount,rw / # å¦‚æœçŸ¥é“å…·ä½“è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè®¾å¤‡ sudo mount -o remount,rw /dev/sda2 / æ–¹æ³•äºŒï¼šå¼ºåˆ¶é‡æ–°æŒ‚è½½ 1 2 # å¦‚æœæ™®é€šé‡æŒ‚å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶æ–¹å¼ sudo mount -o remount,rw,force / æ–¹æ³•ä¸‰ï¼šæ£€æŸ¥å¹¶ä¿®å¤åé‡æŒ‚ 1 2 3 # å…ˆæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åé‡æŒ‚ sudo fsck -f /dev/sda2 sudo mount -o remount,rw /dev/sda2 / ğŸ”§ è¯¦ç»†æ­¥éª¤ æ­¥éª¤ä¸€ï¼šè¿›å…¥æ¢å¤æ¨¡å¼ 1 2 3 4 5 # å¦‚æœç³»ç»Ÿå®Œå…¨åªè¯»ï¼Œå¯èƒ½éœ€è¦é‡å¯åˆ°æ¢å¤æ¨¡å¼ sudo reboot # åœ¨å¯åŠ¨æ—¶é€‰æ‹©æ¢å¤æ¨¡å¼æˆ–å•ç”¨æˆ·æ¨¡å¼ # æˆ–è€…ä½¿ç”¨live CD/USBå¯åŠ¨ æ­¥éª¤äºŒï¼šæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ 1 2 3 4 5 6 7 8 9 10 # å¸è½½æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æœå·²æŒ‚è½½ï¼‰ sudo umount /dev/sda2 # å¼ºåˆ¶æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ sudo fsck -y -f -v /dev/sda2 # ğŸ“Š ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æ£€æŸ¥å‘½ä»¤ï¼š # ext4: sudo fsck.ext4 -f /dev/sda2 # xfs: sudo xfs_repair /dev/sda2 # btrfs: sudo btrfs check --repair /dev/sda2 æ­¥éª¤ä¸‰ï¼šä¿®å¤æŒ‚è½½é—®é¢˜ 1 2 3 4 5 6 7 # é‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ sudo mount -o rw /dev/sda2 /mnt # æ£€æŸ¥æŒ‚è½½ç»“æœ mount | grep \u0026#34;/dev/sda2\u0026#34; # ğŸ¯ åº”è¯¥æ˜¾ç¤º: /dev/sda2 on / type ext4 (rw,relatime) æ­¥éª¤å››ï¼šæ£€æŸ¥å¹¶ä¿®å¤å¯èƒ½çš„åŸå›  1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h # æ¸…ç†ç£ç›˜ç©ºé—´ï¼ˆå¦‚æœéœ€è¦ï¼‰ sudo apt clean sudo journalctl --vacuum-time=7d sudo rm -rf /tmp/* sudo rm -rf /var/tmp/* # æ£€æŸ¥inodeä½¿ç”¨ df -i âš ï¸ æ³¨æ„äº‹é¡¹ ğŸš¨ é‡è¦è­¦å‘Š ğŸ”’ æ•°æ®å®‰å…¨ï¼šåœ¨è¿›è¡Œfsckæ“ä½œå‰ï¼Œå°½é‡å¤‡ä»½é‡è¦æ•°æ® â° æ—¶é—´æ¶ˆè€—ï¼šfsckæ“ä½œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾… ğŸ”§ æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼šç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„fsckå‘½ä»¤å¯¹åº”ä½ çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ ğŸ“‹ æ—¥å¿—æ£€æŸ¥ï¼šä¿®å¤åæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ç¡®è®¤é—®é¢˜å·²è§£å†³ ğŸ” å¸¸è§é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 # å¦‚æœè®¾å¤‡å¿™ï¼Œæ— æ³•å¸è½½ sudo fuser -m /dev/sda2 # æŸ¥çœ‹å“ªäº›è¿›ç¨‹åœ¨ä½¿ç”¨ sudo lsof /dev/sda2 # æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶ # å¼ºåˆ¶ç»ˆæ­¢ç›¸å…³è¿›ç¨‹ sudo kill -9 \u0026lt;PID\u0026gt; # æˆ–è€…ä½¿ç”¨æ‡’å¸è½½ sudo umount -l /dev/sda2 ğŸ†˜ ç´§æ€¥æ¢å¤ 1 2 3 4 5 6 7 8 9 10 # å¦‚æœæ— æ³•è¿›å…¥ç³»ç»Ÿï¼Œä½¿ç”¨Live USB # 1. ä½¿ç”¨Liveç³»ç»Ÿå¯åŠ¨ # 2. æŒ‚è½½æ ¹åˆ†åŒº sudo mount /dev/sda2 /mnt # 3. æ£€æŸ¥å¹¶ä¿®å¤ sudo fsck -f /dev/sda2 # 4. é‡æ–°æŒ‚è½½ä¸ºè¯»å†™ sudo mount -o remount,rw /mnt ğŸ’¡ é¢„é˜²æªæ–½ ğŸ›¡ï¸ å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 # å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ sudo touch /forcefsck # ä¸‹æ¬¡å¯åŠ¨æ—¶å¼ºåˆ¶æ£€æŸ¥ sudo shutdown -rF now # é‡å¯å¹¶å¼ºåˆ¶æ£€æŸ¥ # è®¾ç½®å®šæœŸè‡ªåŠ¨æ£€æŸ¥ sudo tune2fs -c 100 /dev/sda2 # æ¯100æ¬¡æŒ‚è½½åæ£€æŸ¥ ğŸ“Š ç›‘æ§ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 # æ·»åŠ ç£ç›˜ç›‘æ§åˆ°crontab echo \u0026#34;0 2 * * * df -h \u0026gt;\u0026gt; /var/log/disk-usage.log\u0026#34; | sudo tee -a /etc/crontab echo \u0026#34;0 3 * * 0 fsck -n /dev/sda2\u0026#34; | sudo tee -a /etc/crontab # ğŸ“ˆ ç›‘æ§è„šæœ¬ç¤ºä¾‹ #!/bin/bash THRESHOLD=90 USAGE=$(df / | awk \u0026#39;NR==2 {print $5}\u0026#39; | sed \u0026#39;s/%//\u0026#39;) if [ $USAGE -gt $THRESHOLD ]; then echo \u0026#34;è­¦å‘Šï¼šç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡ $THRESHOLD%!\u0026#34; | mail -s \u0026#34;ç£ç›˜è­¦æŠ¥\u0026#34; admin@example.com fi ğŸ”§ ç³»ç»Ÿä¼˜åŒ– 1 2 3 4 5 6 # è°ƒæ•´æ–‡ä»¶ç³»ç»ŸæŒ‚è½½é€‰é¡¹ # ç¼–è¾‘ /etc/fstabï¼Œæ·»åŠ é€‚å½“çš„æŒ‚è½½é€‰é¡¹ # ä¾‹å¦‚ï¼šdefaults,errors=remount-ro # ğŸ“ ç¤ºä¾‹fstabæ¡ç›®ï¼š # /dev/sda2 / ext4 defaults,errors=remount-ro 0 1 ğŸ“‹ åº”æ€¥å‡†å¤‡ 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºåº”æ€¥ä¿®å¤è„šæœ¬ cat \u0026gt; /usr/local/bin/repair-ro.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;å°è¯•ä¿®å¤åªè¯»æ–‡ä»¶ç³»ç»Ÿ...\u0026#34; mount -o remount,rw / 2\u0026gt;/dev/null || { echo \u0026#34;é‡æŒ‚å¤±è´¥ï¼Œå°è¯•fsck...\u0026#34; fsck -f /dev/sda2 \u0026amp;\u0026amp; mount -o remount,rw / } EOF chmod +x /usr/local/bin/repair-ro.sh ğŸ¯ æç¤ºï¼šæ–‡ä»¶ç³»ç»Ÿå˜ä¸ºåªè¯»é€šå¸¸æ˜¯æŸç§é—®é¢˜çš„å¾å…†ï¼Œä¿®å¤åå»ºè®®ä»”ç»†æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼Œæ‰¾å‡ºæ ¹æœ¬åŸå› ï¼Œé¿å…é—®é¢˜å†æ¬¡å‘ç”Ÿã€‚\nğŸ”§ å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶æ•…éšœçš„è¿¹è±¡ï¼Œå»ºè®®æ£€æŸ¥ç¡¬ç›˜å¥åº·çŠ¶å†µï¼š\n1 2 3 4 5 # æ£€æŸ¥ç¡¬ç›˜SMARTçŠ¶æ€ sudo smartctl -a /dev/sda # æ£€æŸ¥åé“ sudo badblocks -v /dev/sda2 ","date":"2024-12-07T15:50:13+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/0c300897/","title":"Linux ç³»ç»ŸæŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼ä¿®å¤ ğŸ”„"},{"content":"euç‚¹org åŸŸåå…è´¹æ³¨å†Œä¸æ‰˜ç®¡è‡³ DNSPod å…¨æ”»ç•¥ ğŸŒ ğŸ‰ å…è´¹è·å–å±äºä½ è‡ªå·±çš„ EU.org åŸŸåï¼Œå¹¶æ‰˜ç®¡è‡³ DNSPod è¿›è¡Œè§£æï¼Œè½»æ¾æ­å»ºä¸ªäººç½‘ç«™ã€åšå®¢æˆ–é¡¹ç›®å±•ç¤ºé¡µï¼\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ EU.org åŸŸåç‰¹ç‚¹ ğŸ“Œ å‰è¨€ ğŸš€ æ³¨å†Œ EU.org è´¦å· ğŸ” æœç´¢å¹¶æ³¨å†ŒåŸŸå ğŸŒ é…ç½® DNS è§£æï¼ˆä»¥ DNSPod ä¸ºä¾‹ï¼‰ â³ ç­‰å¾…å®¡æ ¸ä¸ç”Ÿæ•ˆ âš™ï¸ åœ¨ DNSPod é…ç½®è§£æè®°å½• ğŸ’¡ å°è´´å£« â“ å¸¸è§é—®é¢˜ âœ¨ EU.org åŸŸåç‰¹ç‚¹ å®Œå…¨å…è´¹ï¼šæ— éœ€æ”¯ä»˜ä»»ä½•æ³¨å†Œæˆ–ç»­è´¹è´¹ç”¨ã€‚ æ°¸ä¹…æœ‰æ•ˆï¼šåªè¦éµå®ˆè§„åˆ™ï¼ŒåŸŸåå¯é•¿æœŸä½¿ç”¨ã€‚ å…¨çƒé€šç”¨ï¼š.eu.org åŸŸåå¯åœ¨å…¨çƒèŒƒå›´å†…è®¿é—®ï¼Œå¹¶è¢«è°·æ­Œã€Cloudflare ç­‰å…¬å¸è®¤å¯ã€‚ éè¥åˆ©ç»„ç»‡æ”¯æŒï¼šè‡ª1996å¹´ç”±éè¥åˆ©ç»„ç»‡æä¾›ï¼Œç¨³å®šå¯é ã€‚ æ”¯æŒè‡ªå®šä¹‰ DNSï¼šå¯çµæ´»æ‰˜ç®¡è‡³ DNSPodã€Cloudflare ç­‰ä¸»æµè§£ææœåŠ¡å•†ã€‚ é€‚åˆä¸ªäººä¸å­¦ä¹ é¡¹ç›®ï¼šæ˜¯å­¦ç”Ÿã€çˆ±å¥½è€…ã€ä¸ªäººæˆ–ç»„ç»‡æ­å»ºç½‘ç«™çš„ç†æƒ³é€‰æ‹©ã€‚ ğŸ“Œ å‰è¨€ EU.org æ˜¯ä¸€ä¸ªæä¾›å…è´¹åŸŸåæœåŠ¡çš„éè¥åˆ©ç»„ç»‡ï¼Œå…¶å®˜æ–¹ç½‘å€ä¸ºï¼š https://nic.eu.org/ ã€‚ä½ å¯ä»¥åœ¨æ­¤æ³¨å†Œä¸€ä¸ªå±äºè‡ªå·±çš„ .eu.org äºŒçº§åŸŸåï¼ˆå½¢å¦‚ yourname.eu.orgï¼‰ã€‚è™½ç„¶å®ƒæ˜¯äºŒçº§åŸŸåï¼Œä½†å·²è¢«å¹¿æ³›è®¤å¯ã€‚æ³¨å†ŒæˆåŠŸåï¼Œä½ å¯ä»¥å°†å…¶ DNS è§£ææ‰˜ç®¡è‡³ DNSPod ç­‰ä¸“ä¸šæœåŠ¡å•†ï¼Œä»¥è·å¾—æ›´ç¨³å®šã€é«˜æ•ˆçš„è§£æä½“éªŒã€‚\nğŸš€ æ³¨å†Œ EU.org è´¦å· 1ï¸âƒ£ è¿›å…¥æ³¨å†Œé¡µé¢ è®¿é—® https://nic.eu.org/ ï¼Œç‚¹å‡»é¡µé¢ä¸Šçš„ \u0026ldquo;Signup\u0026rdquo; æˆ–ç±»ä¼¼é“¾æ¥å¼€å§‹æ³¨å†Œã€‚\n2ï¸âƒ£ å¡«å†™è´¦å·ä¿¡æ¯ ç”¨æˆ·åï¼šé€‰æ‹©ä½ å–œæ¬¢çš„ç”¨æˆ·åã€‚ å¯†ç ï¼šè®¾ç½®ä¸€ä¸ªå®‰å…¨çš„å¯†ç ã€‚ é‚®ç®±ï¼šåŠ¡å¿…ä½¿ç”¨çœŸå®ä¸”å¸¸ç”¨çš„é‚®ç®±ï¼ˆå¦‚ Gmailã€Outlookï¼‰ï¼Œç”¨äºæ¥æ”¶éªŒè¯é‚®ä»¶å’Œé‡è¦çš„åŸŸåå®¡æ ¸é€šçŸ¥ã€‚ ä¸ªäººä¿¡æ¯ï¼šåŒ…æ‹¬å§“åã€å›½å®¶ã€åœ°å€ã€ç”µè¯ç­‰ã€‚æ³¨æ„ï¼šéƒ¨åˆ†æ”»ç•¥å»ºè®®ä¸ºé¿å…éº»çƒ¦ï¼Œå¯ä»¥å¡«å†™è™šæ‹Ÿçš„å›½å¤–ä¿¡æ¯ï¼Œä½†è¯·è‡ªè¡Œæƒè¡¡é£é™©ã€‚ 3ï¸âƒ£ æ¿€æ´»è´¦å· æäº¤æ³¨å†Œåï¼Œæ£€æŸ¥ä½ çš„é‚®ç®±ï¼Œä¼šæ”¶åˆ°ä¸€å°æ¿€æ´»é‚®ä»¶ã€‚ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥å®Œæˆè´¦å·æ¿€æ´»ã€‚\nğŸ” æœç´¢å¹¶æ³¨å†Œå¿ƒä»ªåŸŸå 1ï¸âƒ£ ç™»å½• EU.org åå° ä½¿ç”¨ä½ çš„è´¦å·ç™»å½• EU.org ã€‚\n2ï¸âƒ£ æœç´¢å¯ç”¨åŸŸå åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ä½ æƒ³è¦çš„åŸŸåå‰ç¼€ï¼Œä¾‹å¦‚ yournameï¼ŒæŸ¥çœ‹å¯¹åº”çš„ yourname.eu.org æ˜¯å¦å¯ç”¨ã€‚\n3ï¸âƒ£ ç”³è¯·æ³¨å†Œ å¦‚æœåŸŸåå¯ç”¨ï¼Œç‚¹å‡»â€œNew Domainâ€æˆ–â€œç”³è¯·æ–°çš„å…è´¹åŸŸåâ€æŒ‰é’®å¼€å§‹ç”³è¯·ã€‚\n4ï¸âƒ£ å¡«å†™åŸŸåä¿¡æ¯ï¼ˆå…³é”®æ­¥éª¤ï¼‰ Domain nameï¼šå¡«å†™ä½ æƒ³è¦çš„å®Œæ•´åŸŸåï¼Œä¾‹å¦‚ mobufan.eu.orgã€‚ Name servers (NS è®°å½•)ï¼šè¿™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ã€‚ä½ éœ€è¦åœ¨æ­¤å¡«å†™ DNS æ‰˜ç®¡æœåŠ¡å•†ï¼ˆå¦‚ DNSPodï¼‰æä¾›çš„åç§°æœåŠ¡å™¨åœ°å€ã€‚ - é€šå¸¸éœ€è¦å¡«å†™è‡³å°‘ 2 ä¸ª NS è®°å½•ï¼Œä¾‹å¦‚ DNSPod çš„ f1g1ns1.dnspod.net å’Œ f1g1ns2.dnspod.netï¼ˆè¯·ä»¥ DNSPod å®é™…æä¾›çš„ä¸ºå‡†ï¼‰ã€‚ - è¯·ç¡®ä¿æ‰€æœ‰ NS è®°å½•éƒ½å·²æ­£ç¡®æ·»åŠ ã€‚ å…¶ä»–ä¿¡æ¯å¦‚ SOA ç­‰å¯æŒ‰é»˜è®¤æˆ–æŒ‡å¼•å¡«å†™ã€‚ 5ï¸âƒ£ æäº¤ç”³è¯· ä»”ç»†æ£€æŸ¥ä¿¡æ¯æ— è¯¯åï¼Œæäº¤ç”³è¯·ã€‚å¦‚æœæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°ç›¸åº”çš„æˆåŠŸæç¤ºã€‚\nğŸŒ æå‰é…ç½® DNSPod è§£æï¼ˆå¯é€‰ä½†æ¨èï¼‰ åœ¨ EU.org å®¡æ ¸æœŸé—´æˆ–ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆåœ¨ DNSPod æ·»åŠ åŸŸåï¼Œä»¥ä¾¿å®¡æ ¸é€šè¿‡åèƒ½å¿«é€Ÿè®¾ç½®è§£æã€‚\n1ï¸âƒ£ æ³¨å†Œ/ç™»å½•è…¾è®¯äº‘ï¼ˆDNSPodï¼‰è´¦å· DNSPod å·²è¢«è…¾è®¯äº‘æ”¶è´­ï¼Œå¯ä½¿ç”¨è…¾è®¯äº‘è´¦å·ç™»å½•ã€‚è®¿é—® DNSPod å®˜ç½‘ æˆ–è…¾è®¯äº‘æ§åˆ¶å°ã€‚\n2ï¸âƒ£ åœ¨ DNSPod ä¸­æ·»åŠ åŸŸå åœ¨ DNSPod æ§åˆ¶å°ï¼Œæ‰¾åˆ°â€œåŸŸåè§£æâ€-\u0026gt;â€œæˆ‘çš„åŸŸåâ€ã€‚ ç‚¹å‡»â€œæ·»åŠ åŸŸåâ€ï¼Œè¾“å…¥ä½ åˆšç”³è¯·çš„å®Œæ•´ .eu.org åŸŸåï¼ˆä¾‹å¦‚ yourname.eu.orgï¼‰ï¼Œç„¶åç‚¹å‡»ç¡®è®¤ã€‚ æ·»åŠ åï¼ŒDNSPod ä¼šä¸ºä½ åˆ†é…ä¸¤ç»„åç§°æœåŠ¡å™¨åœ°å€ï¼ˆä¾‹å¦‚ f1g1ns1.dnspod.net å’Œ f1g1ns2.dnspod.netï¼‰ã€‚è¯·è®°ä¸‹è¿™ä¸¤æ¡åœ°å€ï¼Œè¿™å°±æ˜¯ä½ ä¹‹å‰åœ¨ EU.org ç”³è¯·æ—¶éœ€è¦å¡«å†™çš„ NS è®°å½•ã€‚ 3ï¸âƒ£ åœ¨ EU.org ç®¡ç†åå°é…ç½® DNS ç™»å½•ä½ çš„ EU.org è´¦å·ï¼Œæ‰¾åˆ°ä½ ç”³è¯·çš„åŸŸåç®¡ç†ç•Œé¢ã€‚ å°† Name servers ä¿®æ”¹ä¸º DNSPod æä¾›çš„é‚£ä¸¤ç»„åç§°æœåŠ¡å™¨åœ°å€ã€‚ ä¿å­˜è®¾ç½®ã€‚ 4ï¸âƒ£ æ£€æŸ¥ NS è®°å½•åŒæ­¥ å¯ä»¥ä½¿ç”¨ nslookup -type=ns yourdomain.eu.org å‘½ä»¤æˆ–åœ¨çº¿ DNS æ£€æŸ¥å·¥å…·ï¼ˆå¦‚ \u0026ldquo;Check on dns.computer\u0026rdquo;ï¼‰æŸ¥è¯¢ NS è®°å½•æ˜¯å¦å·²å…¨å±€ç”Ÿæ•ˆã€‚ å½“å·¥å…·æç¤º â€œAll name servers are synchronizedâ€ æˆ–ç±»ä¼¼ä¿¡æ¯æ—¶ï¼Œè¡¨ç¤ºå·²æˆåŠŸã€‚ â³ ç­‰å¾…å®¡æ ¸ä¸ç”Ÿæ•ˆ å®¡æ ¸æ—¶é—´ï¼šEU.org çš„åŸŸåç”³è¯·éœ€è¦äººå·¥å®¡æ ¸ï¼Œå®¡æ ¸æ—¶é—´å¯èƒ½è¾ƒé•¿ï¼Œé€šå¸¸éœ€è¦å‡ å¤©åˆ°å‡ å‘¨ï¼Œç”šè‡³ä¸€ä¸ªæœˆå·¦å³ã€‚è¯·è€å¿ƒç­‰å¾…ã€‚ å®¡æ ¸ç»“æœï¼šå®¡æ ¸é€šè¿‡åï¼Œä½ ä¼šæ”¶åˆ°ç¡®è®¤é‚®ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥ä¸æ—¶ç™»å½• EU.org åå°æŸ¥çœ‹ç”³è¯·çŠ¶æ€ã€‚ ç”Ÿæ•ˆæ—¶é—´ï¼šå®¡æ ¸é€šè¿‡åï¼Œç”±äº DNS å…¨çƒä¼ æ’­éœ€è¦æ—¶é—´ï¼ŒåŸŸåå¯èƒ½ä¸ä¼šç«‹å³è§£æç”Ÿæ•ˆï¼Œè¯·è€å¿ƒç­‰å¾…æœ€å¤š48å°æ—¶ã€‚ âš™ï¸ åœ¨ DNSPod é…ç½®è§£æè®°å½• å½“åŸŸåå®¡æ ¸é€šè¿‡ä¸”åœ¨ DNSPod ä¸­ç”Ÿæ•ˆåï¼Œä½ å°±å¯ä»¥æ·»åŠ å„ç§è§£æè®°å½•äº†ï¼š\nåœ¨ DNSPod çš„â€œæˆ‘çš„åŸŸåâ€åˆ—è¡¨ä¸­æ‰¾åˆ°ä½ çš„åŸŸåï¼Œç‚¹å‡»è¿›å…¥è§£æç®¡ç†ç•Œé¢ã€‚ ç‚¹å‡»â€œæ·»åŠ è®°å½•â€ï¼Œå¸¸è§çš„è®°å½•ç±»å‹åŒ…æ‹¬ï¼š A è®°å½•ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPv4 åœ°å€ï¼ˆä¾‹å¦‚ä½ çš„æœåŠ¡å™¨ IPï¼‰ã€‚ CNAME è®°å½•ï¼šå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼ˆä¾‹å¦‚ GitHub Pages æˆ–äº‘å¹³å°æä¾›çš„åˆ«åï¼‰ã€‚ MX è®°å½•ï¼šç”¨äºè®¾ç½®é‚®ç®±æœåŠ¡å™¨ã€‚ TXT è®°å½•ï¼šå¸¸ç”¨äºåŸŸåæ‰€æœ‰æƒéªŒè¯ï¼ˆå¦‚ç”³è¯· SSL è¯ä¹¦ï¼‰æˆ–é‚®ç®±SPFè®°å½•ã€‚ å¡«å†™å¥½è®°å½•å€¼åä¿å­˜ã€‚DNSPod çš„è§£æç”Ÿæ•ˆé€šå¸¸è¾ƒå¿«ã€‚ ğŸ’¡ å°è´´å£« ä¿¡æ¯çœŸå®æ€§ï¼šè™½ç„¶å¯èƒ½ä½¿ç”¨è™šæ‹Ÿä¿¡æ¯é€šè¿‡å®¡æ ¸ï¼Œä½†ä½¿ç”¨çœŸå®ä¿¡æ¯å¯èƒ½æ›´ç¨³å¦¥ã€‚ åŸŸåé€‰æ‹©ï¼šé¿å…ä½¿ç”¨æ•æ„Ÿè¯æ±‡ï¼ˆå¦‚æ”¿åºœã€å®—æ•™ã€å•†æ ‡ç›¸å…³ï¼‰ï¼Œé€‰æ‹©ä¸ªäººåŒ–æˆ–ä¸­æ€§è¯æ±‡ï¼Œä»¥æé«˜å®¡æ ¸é€šè¿‡ç‡ã€‚ é‚®ç®±é€‰æ‹©ï¼šä½¿ç”¨ Gmailã€Outlook ç­‰å›½é™…é‚®ç®±æœåŠ¡ï¼Œé¿å…ä½¿ç”¨å›½å†…é‚®ç®±ï¼Œä»¥é˜²æ”¶ä¸åˆ°é‚®ä»¶ã€‚ è€å¿ƒç­‰å¾…ï¼šå®¡æ ¸æ—¶é—´è¾ƒé•¿æ˜¯æ­£å¸¸çš„ï¼Œè¯·å‹¿é¢‘ç¹é‡å¤æäº¤æˆ–å‚¬ä¿ƒã€‚ DNS ç”Ÿæ•ˆï¼šä¿®æ”¹ DNS æœåŠ¡å™¨æˆ–è§£æè®°å½•åï¼Œå…¨çƒç”Ÿæ•ˆå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼ˆæœ€å¤š48å°æ—¶ï¼‰ï¼Œå¯é€šè¿‡åœ¨çº¿ DNS ä¼ æ’­æ£€æŸ¥å·¥å…·æŸ¥çœ‹çŠ¶æ€ã€‚ DNSPod ä¼˜åŠ¿ï¼šDNSPod è§£æç”Ÿæ•ˆé€Ÿåº¦åœ¨å¢ƒå†…é€šå¸¸å¿«äºéƒ¨åˆ†å›½é™…æœåŠ¡å•†ï¼Œå…è´¹ç‰ˆä¹Ÿæ”¯æŒåˆ†çº¿è·¯è§£æç­‰åŸºç¡€åŠŸèƒ½ã€‚ â“ å¸¸è§é—®é¢˜ (FAQ) é—®ï¼šEU.org åŸŸåçœŸçš„æ˜¯å…è´¹çš„å—ï¼Ÿ ç­”ï¼š æ˜¯çš„ï¼Œå®Œå…¨å…è´¹æ³¨å†Œå’Œç»­è´¹ã€‚\né—®ï¼šå®¡æ ¸ä¸ºä»€ä¹ˆéœ€è¦é‚£ä¹ˆé•¿æ—¶é—´ï¼Ÿ ç­”ï¼š å› ä¸ºæ˜¯ç”±äººå·¥è¿›è¡Œå®¡æ ¸çš„ï¼Œç”³è¯·é‡å¯èƒ½è¾ƒå¤§ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚\né—®ï¼šåŸŸåå®¡æ ¸è¢«æ‹’ç»äº†æ€ä¹ˆåŠï¼Ÿ ç­”ï¼š æ£€æŸ¥é‚®ç®±æ˜¯å¦æ”¶åˆ°è¯´æ˜é‚®ä»¶ã€‚å¯èƒ½åŸå› åŒ…æ‹¬ï¼šåŸŸåä¿¡æ¯å¡«å†™æœ‰é—®é¢˜ã€åŸŸåå‰ç¼€æ•æ„Ÿæˆ–ä¸åˆè§„ã€DNS è®¾ç½®ä¸æ­£ç¡®ç­‰ã€‚å¯ä»¥æ ¹æ®åŸå› è°ƒæ•´åé‡æ–°ç”³è¯·ã€‚\né—®ï¼šé™¤äº† DNSPodï¼Œè¿˜å¯ä»¥ç”¨å“ªäº› DNS æ‰˜ç®¡æœåŠ¡ï¼Ÿ ç­”ï¼š Cloudflareã€ClouDNS ç­‰éƒ½æ˜¯å¸¸è§é€‰æ‹©ã€‚åªéœ€å°† EU.org çš„ NS è®°å½•ä¿®æ”¹ä¸ºå¯¹åº”æœåŠ¡å•†æä¾›çš„åœ°å€å³å¯ã€‚\né—®ï¼šä¸ºä»€ä¹ˆåœ¨ DNSPod æ·»åŠ åŸŸåæ—¶æç¤ºâ€œæœªåœ¨è…¾è®¯äº‘æ³¨å†Œâ€ï¼Ÿ ç­”ï¼š è¿™æ˜¯æ­£å¸¸æç¤ºï¼Œå› ä¸ºä½ çš„åŸŸåæ³¨å†Œå•†æ˜¯ EU.org è€Œéè…¾è®¯äº‘ã€‚ä½ åªæ˜¯åœ¨ DNSPod æ·»åŠ è§£æï¼Œæ— éœ€åœ¨è…¾è®¯äº‘æ³¨å†Œè¯¥åŸŸåã€‚æŒ‰ç…§æç¤ºï¼Œåœ¨ EU.org å¤„ä¿®æ”¹ NS æœåŠ¡å™¨ä¸º DNSPod æä¾›çš„åœ°å€å³å¯ã€‚\né—®ï¼šå¦‚ä½•ç”¨è¿™ä¸ªåŸŸåæ­å»ºç½‘ç«™ï¼Ÿ ç­”ï¼š åœ¨ DNSPod è®¾ç½®å¥½ A è®°å½•ï¼ˆæŒ‡å‘ä½ çš„æœåŠ¡å™¨ IPï¼‰æˆ– CNAME è®°å½•ï¼ˆæŒ‡å‘ä½ çš„æ‰˜ç®¡å¹³å°ï¼Œå¦‚ GitHub Pagesã€Vercel ç­‰ï¼‰åï¼Œå³å¯é€šè¿‡åŸŸåè®¿é—®ä½ çš„ç½‘ç«™ã€‚\nğŸ“ æœ¬æ–‡å‚è€ƒäº†å¤šä¸ªæŠ€æœ¯ç¤¾åŒºçš„ç»éªŒåˆ†äº«å’Œå®˜æ–¹æ–‡æ¡£ï¼Œç»“åˆå®è·µæ•´ç†è€Œæˆã€‚å¦‚æœ‰é”™è¯¯æˆ–å˜æ›´ï¼Œè¯·ä»¥ EU.org å’Œ DNSPod å®˜æ–¹æœ€æ–°ä¿¡æ¯ä¸ºå‡†ã€‚ ğŸŒ äº«å—ä½ çš„å…è´¹åŸŸåå§ï¼\n","date":"2024-12-07T15:49:25+08:00","image":"https://file.meimolihan.eu.org/img/eu.org-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a1e9812a/","title":"EU.org åŸŸåå…è´¹æ³¨å†Œä¸æ‰˜ç®¡è‡³ DNSPod å…¨æ”»ç•¥ ğŸŒ"},{"content":"Docker éƒ¨ç½² Nginx Proxy Manager è‹±æ–‡ç‰ˆ ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nginx Proxy Manager 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Nginx Proxy Manager 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€åå‘ä»£ç†é…ç½®ä¸åŸŸåè§£æ 1. é˜¿é‡Œäº‘æ³›åŸŸåè§£æ ğŸŒ 2. çˆ±å¿«è·¯ç”±å™¨åŠ¨æ€åŸŸåè®¾ç½® ğŸ”„ 3. çˆ±å¿«è·¯ç”±å™¨ç«¯å£è½¬å‘ ğŸ”§ 4. NPM åå‘ä»£ç†å†…ç½‘æœåŠ¡ ğŸ–¥ï¸ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒ å¯èˆªä»£ç†ï¼Œè¿æ¥æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Nginx Proxy Manager å®˜ç½‘åœ°å€ï¼š https://nginxproxymanager.com/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/NginxProxyManager/nginx-proxy-manager ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/jc21/nginx-proxy-manager Nginx Proxy Manager æ˜¯ä¸€ä¸ªåŸºäº Nginx çš„å›¾å½¢åŒ–åå‘ä»£ç†ç®¡ç†å·¥å…·ï¼Œæä¾›äº†ä¸€ä¸ªç›´è§‚çš„ Web ç•Œé¢æ¥è½»æ¾ç®¡ç†åå‘ä»£ç†ã€SSL è¯ä¹¦å’Œè®¿é—®æ§åˆ¶ã€‚æ— éœ€æ·±å…¥äº†è§£ Nginx é…ç½®ï¼Œå³å¯å¿«é€Ÿè®¾ç½®å’Œç®¡ç†å¤šä¸ªç½‘ç«™çš„åå‘ä»£ç†ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¨ ç›´è§‚ç•Œé¢ å›¾å½¢åŒ– Web ç®¡ç†ç•Œé¢ æ— éœ€å‘½ä»¤è¡Œæ“ä½œï¼Œç®€å•æ˜“ç”¨ ğŸ”— å¤šåŸŸåç®¡ç† è½»æ¾ç®¡ç†å¤šä¸ªåŸŸåå’Œå­åŸŸå æ”¯æŒæ‰¹é‡æ“ä½œï¼Œé«˜æ•ˆç®¡ç† ğŸ” SSL è¯ä¹¦ è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ Let\u0026rsquo;s Encrypt è¯ä¹¦ è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–° âš¡ HTTP/2 æ”¯æŒ åŸç”Ÿæ”¯æŒ HTTP/2 åè®® æå‡ç½‘ç«™åŠ è½½é€Ÿåº¦ï¼Œä¼˜åŒ–æ€§èƒ½ ğŸ”„ HTTPS é‡å®šå‘ è‡ªåŠ¨ HTTP åˆ° HTTPS é‡å®šå‘ å¢å¼ºå®‰å…¨æ€§ï¼Œæå‡SEO ğŸ‘¥ è®¿é—®æ§åˆ¶ è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ç®¡ç† ç²¾ç»†åŒ–çš„æƒé™æ§åˆ¶ ğŸ³ Docker é›†æˆ åŸºäºå®¹å™¨åŒ–éƒ¨ç½² ç¯å¢ƒéš”ç¦»ï¼Œéƒ¨ç½²ç®€å• ğŸ“Š æ— æ•°æ®åº“ é…ç½®æ–‡ä»¶ç›´æ¥ç®¡ç† ç®€åŒ–æ¶æ„ï¼Œé™ä½ç»´æŠ¤æˆæœ¬ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nginx Proxy Manager 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/npm \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: app: container_name: npm image: jc21/nginx-proxy-manager:latest restart: always ports: - \u0026#34;1180:80\u0026#34; # HTTP æµé‡ç«¯å£ - \u0026#34;81:81\u0026#34; # ç®¡ç†ç•Œé¢ç«¯å£ - \u0026#34;4443:443\u0026#34; # HTTPS æµé‡ç«¯å£ volumes: - ./config/data:/data # æ•°æ®å­˜å‚¨ç›®å½• - ./config/letsencrypt:/etc/letsencrypt # SSL è¯ä¹¦ç›®å½• EOF ğŸ” é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼š\nç”¨æˆ·å: admin@example.com\nå¯†ç : changeme\nâš ï¸ é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å‡­æ®ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Nginx Proxy Manager 1. è®¿é—® Web ç•Œé¢ ğŸ’» ç®¡ç†ç•Œé¢: http://ä½ çš„æœåŠ¡å™¨IP:81 ä»£ç†æœåŠ¡: http://ä½ çš„æœåŠ¡å™¨IP:1180 (HTTP) HTTPS æœåŠ¡: https://ä½ çš„æœåŠ¡å™¨IP:4443 (HTTPS) 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—® http://ä½ çš„æœåŠ¡å™¨IP:81 ä½¿ç”¨é»˜è®¤è´¦æˆ·ç™»å½•ï¼ˆadmin@example.com / changemeï¼‰ ç«‹å³ä¿®æ”¹ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç  å¼€å§‹é…ç½®åå‘ä»£ç†å’Œ SSL è¯ä¹¦ ğŸŒ ä¸‰ã€åå‘ä»£ç†é…ç½®ä¸åŸŸåè§£æ 1. é˜¿é‡Œäº‘æ³›åŸŸåè§£æ ğŸŒ åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ä¸ºä½ çš„åŸŸåè®¾ç½®æ³›åŸŸåè§£æï¼ˆä¾‹å¦‚ï¼š*.yourdomain.comï¼‰ï¼Œå°†æ‰€æœ‰å­åŸŸåæŒ‡å‘ä½ çš„å…¬ç½‘ IP åœ°å€ã€‚\n2. çˆ±å¿«è·¯ç”±å™¨åŠ¨æ€åŸŸåè®¾ç½® ğŸ”„ åœ¨çˆ±å¿«è·¯ç”±å™¨ä¸­è®¾ç½®åŠ¨æ€åŸŸåæœåŠ¡ï¼ˆDDNSï¼‰ï¼Œç¡®ä¿åŸŸåå§‹ç»ˆæŒ‡å‘ä½ çš„åŠ¨æ€å…¬ç½‘ IPã€‚\n3. çˆ±å¿«è·¯ç”±å™¨ç«¯å£è½¬å‘ ğŸ”§ åœ¨çˆ±å¿«è·¯ç”±å™¨ä¸­è®¾ç½®ç«¯å£è½¬å‘è§„åˆ™ï¼Œå°†å¤–éƒ¨è®¿é—®çš„ 4443 ç«¯å£è½¬å‘åˆ° NPM å®¹å™¨çš„ 4443 ç«¯å£ã€‚\n4. NPM åå‘ä»£ç†å†…ç½‘æœåŠ¡ ğŸ–¥ï¸ åœ¨ NPM ç®¡ç†ç•Œé¢ä¸­æ·»åŠ ä»£ç†ä¸»æœºï¼Œå°†å¤–éƒ¨åŸŸåæŒ‡å‘å†…ç½‘æœåŠ¡ã€‚\né…ç½®å®Œæˆåè®¿é—®ç¤ºä¾‹:\nhttps://npm.yourdomain.com:4443 ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/npm # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop npm # åœæ­¢å®¹å™¨ docker start npm # å¯åŠ¨å®¹å™¨ docker restart npm # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it npm sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it npm bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs npm # æŸ¥çœ‹æ—¥å¿— docker logs -f npm # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 npm # æŸ¥çœ‹æœ€å100è¡Œ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi jc21/nginx-proxy-manager:latest # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒ å¯èˆªä»£ç†ï¼Œè¿æ¥æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Nginx Proxy Managerï¼ŒæŒæ¡äº†å›¾å½¢åŒ–åå‘ä»£ç†ç®¡ç†çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¯ è½»æ¾ç®¡ç† é€šè¿‡ç›´è§‚çš„ Web ç•Œé¢é…ç½®åå‘ä»£ç†ï¼Œå‘Šåˆ«å¤æ‚çš„ Nginx é…ç½®æ–‡ä»¶\nğŸ”’ å®‰å…¨åŠ å¯† è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ Let\u0026rsquo;s Encrypt SSL è¯ä¹¦ï¼Œä¸ºæ‰€æœ‰æœåŠ¡æä¾› HTTPS åŠ å¯†ä¿æŠ¤\nğŸŒ å¤šåŸŸæ”¯æŒ è½»æ¾ç®¡ç†å¤šä¸ªåŸŸåå’Œå­åŸŸåï¼Œæ„å»ºå®Œæ•´çš„ç½‘ç»œæœåŠ¡ç”Ÿæ€\nâš¡ é«˜æ•ˆæ€§èƒ½ äº«å— HTTP/2 å’Œè´Ÿè½½å‡è¡¡å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ\nç½‘ç»œä»£ç†ä¸ä»…æ˜¯æŠ€æœ¯å·¥å…·ï¼Œæ›´æ˜¯è¿æ¥æœåŠ¡çš„æ™ºèƒ½æ¡¥æ¢ã€‚æ„¿ Nginx Proxy Manager æˆä¸ºä½ ç½‘ç»œæ¶æ„çš„æ ¸å¿ƒè°ƒåº¦ä¸­å¿ƒï¼Œè®©æ¯ä¸€æ¬¡æœåŠ¡è®¿é—®éƒ½å®‰å…¨ã€å¿«é€Ÿã€ç¨³å®šã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç”¨å›¾å½¢åŒ–ç•Œé¢æŒæ§ä½ çš„ç½‘ç»œæœåŠ¡ï¼Œæ„å»ºé«˜æ•ˆå¯é çš„åå‘ä»£ç†ä½“ç³»ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Nginx Proxy Manager å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ é…ç½®é¡ºåˆ©ï¼Œç½‘ç»œç•…é€šï¼ğŸ‰\n","date":"2024-12-07T15:48:03+08:00","image":"https://file.meimolihan.eu.org/img/nginx-pm-01.webp","permalink":"https://blog.meimolihan.eu.org/p/8ca12419/","title":"Docker éƒ¨ç½² Nginx Proxy Manager è‹±æ–‡ç‰ˆ ğŸ”"},{"content":"Linux å®‰è£…ä¸å¸è½½å¸¸ç”¨è½¯ä»¶ ğŸ§ ğŸ”§ ä¸€ç«™å¼æŒæ¡ä¸»æµ Linux å‘è¡Œç‰ˆçš„è½¯ä»¶ç®¡ç†æŠ€å·§ï¼æœ¬æ–‡è¯¦ç»†æ•´ç†äº† Debianã€CentOSã€Ubuntuã€PVEã€Alpine å’Œ iStoreOS ç­‰ç³»ç»Ÿçš„è½¯ä»¶å®‰è£…ä¸å¸è½½æ–¹æ³•ï¼ŒåŠ©ä½ è½»æ¾é©¾é©­ Linux è½¯ä»¶ç”Ÿæ€ã€‚\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ Linux è½¯ä»¶ç®¡ç†ç‰¹ç‚¹ ğŸ”§ Debian12 è½¯ä»¶ç®¡ç† ğŸ”´ CentOS è½¯ä»¶ç®¡ç† ğŸ§ Ubuntu è½¯ä»¶ç®¡ç† ğŸ–¥ï¸ PVE è½¯ä»¶ç®¡ç† ğŸ”ï¸ Alpine è½¯ä»¶ç®¡ç† ğŸ“¦ iStoreOS è½¯ä»¶ç®¡ç† ğŸ’¡ å°è´´å£«ä¸æœ€ä½³å®è·µ â“ å¸¸è§é—®é¢˜è§£ç­” âœ¨ Linux è½¯ä»¶ç®¡ç†ç‰¹ç‚¹ Linux ç³»ç»Ÿæä¾›äº†å¤šç§å¼ºå¤§çš„è½¯ä»¶ç®¡ç†æ–¹å¼ï¼Œå„æœ‰ç‰¹è‰²ï¼š\nğŸ“¦ åŒ…ç®¡ç†å™¨ï¼šæ¯ä¸ªå‘è¡Œç‰ˆéƒ½æœ‰ä¸“å±çš„åŒ…ç®¡ç†å™¨ï¼ˆaptã€yumã€apkç­‰ï¼‰ï¼Œç®€åŒ–è½¯ä»¶å®‰è£…è¿‡ç¨‹ ğŸŒ è½¯ä»¶ä»“åº“ï¼šå®˜æ–¹ç»´æŠ¤å¤§é‡ç»è¿‡æµ‹è¯•çš„è½¯ä»¶åŒ…ï¼Œä¿è¯å®‰å…¨æ€§å’Œç¨³å®šæ€§ ğŸ”„ ä¾èµ–è§£æï¼šè‡ªåŠ¨å¤„ç†è½¯ä»¶ä¾èµ–å…³ç³»ï¼Œé¿å…\u0026quot;ä¾èµ–åœ°ç‹±\u0026quot; ğŸ”§ ç¼–è¯‘å®‰è£…ï¼šæ”¯æŒä»æºä»£ç ç¼–è¯‘å®‰è£…ï¼Œæä¾›æœ€å¤§çµæ´»æ€§å’Œä¼˜åŒ–é€‰é¡¹ ğŸ“Š ç‰ˆæœ¬æ§åˆ¶ï¼šè½»æ¾ç®¡ç†è½¯ä»¶ç‰ˆæœ¬ï¼Œæ”¯æŒå‡çº§ã€é™çº§å’Œå›æ»šæ“ä½œ ğŸ”§ Debian12 è½¯ä»¶ç®¡ç† ğŸ“¥ å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 3 4 5 6 7 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update -y # å®‰è£…å¸¸ç”¨å·¥å…·é›† sudo apt install -y rsync sudo curl wget vim tree samba nfs-common openssh-server zip htop net-tools # ğŸ¯ åŒ…å«ï¼šæ–‡ä»¶åŒæ­¥ã€ç®¡ç†å‘˜æƒé™ã€ç½‘ç»œå·¥å…·ã€ç¼–è¾‘å™¨ã€æ–‡ä»¶ç®¡ç†ã€æ–‡ä»¶å…±äº«ç­‰ ğŸ” æœç´¢è½¯ä»¶åŒ… 1 2 3 4 5 # æœç´¢å¯ç”¨è½¯ä»¶åŒ… apt search [è½¯ä»¶å] # æŸ¥çœ‹è½¯ä»¶åŒ…è¯¦ç»†ä¿¡æ¯ apt show [è½¯ä»¶å] ğŸ—‘ï¸ å¸è½½è½¯ä»¶ 1 2 3 4 5 # ç§»é™¤è½¯ä»¶åŒ…ä½†ä¿ç•™é…ç½®æ–‡ä»¶ sudo apt remove [è½¯ä»¶å] # ç¤ºä¾‹ï¼šç§»é™¤rsync sudo apt remove rsync ğŸ§¹ å½»åº•å¸è½½ï¼ˆå«é…ç½®æ–‡ä»¶ï¼‰ 1 2 3 4 5 6 7 8 # å®Œå…¨ç§»é™¤è½¯ä»¶åŒ…åŠç›¸å…³é…ç½®æ–‡ä»¶ sudo apt purge [è½¯ä»¶å] # ç¤ºä¾‹ï¼šå½»åº•ç§»é™¤rsync sudo apt purge rsync # è‡ªåŠ¨ç§»é™¤ä¸å†éœ€è¦çš„ä¾èµ–åŒ… sudo apt autoremove ğŸ“‹ è½¯ä»¶åŒ…ç®¡ç† 1 2 3 4 5 6 7 8 # åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ… apt list --installed # æ£€æŸ¥å¯æ›´æ–°çš„è½¯ä»¶åŒ… apt list --upgradable # æ›´æ–°æ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ… sudo apt upgrade -y ğŸ”´ CentOS è½¯ä»¶ç®¡ç† ğŸ“¥ å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 3 4 5 6 7 8 9 10 # æ›´æ–°ç³»ç»Ÿ sudo yum update -y # å®‰è£…EPELä»“åº“ï¼ˆæä¾›é¢å¤–è½¯ä»¶åŒ…ï¼‰ sudo yum install -y epel-release # å®‰è£…å¸¸ç”¨å·¥å…· sudo yum install -y rsync sudo curl wget vim tree samba nfs-utils rpcbind openssl openssh-server zip htop net-tools # ğŸ¯ åŒ…å«ï¼šåŸºç¡€å·¥å…·é›†ã€ç½‘ç»œæœåŠ¡ã€å®‰å…¨è¿æ¥ç­‰ ğŸ” æœç´¢è½¯ä»¶åŒ… 1 2 3 4 5 # æœç´¢è½¯ä»¶åŒ… yum search [è½¯ä»¶å] # æŸ¥çœ‹è½¯ä»¶åŒ…ä¿¡æ¯ yum info [è½¯ä»¶å] ğŸ—‘ï¸ å¸è½½è½¯ä»¶ 1 2 3 4 5 # ç§»é™¤è½¯ä»¶åŒ… sudo yum remove [è½¯ä»¶å] # ç¤ºä¾‹ï¼šç§»é™¤rsync sudo yum remove rsync ğŸ“‹ è½¯ä»¶åŒ…ç®¡ç† 1 2 3 4 5 6 7 8 # åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ… yum list installed # æ£€æŸ¥å¯æ›´æ–°çš„è½¯ä»¶åŒ… yum check-update # æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ… sudo yum update -y ğŸ§ Ubuntu è½¯ä»¶ç®¡ç† ğŸ“¥ å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 3 4 5 6 7 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update -y # å®‰è£…å¸¸ç”¨å·¥å…· sudo apt install -y nano curl git rsync openssh-server wget tree samba nfs-kernel-server nfs-common zip htop net-tools # ğŸ¯ åŒ…å«ï¼šè½»é‡ç¼–è¾‘å™¨ã€ç‰ˆæœ¬æ§åˆ¶ã€ç½‘ç»œæœåŠ¡ç­‰ ğŸ—‘ï¸ å¸è½½è½¯ä»¶ 1 2 3 4 5 # ç§»é™¤è½¯ä»¶åŒ…ä½†ä¿ç•™é…ç½®æ–‡ä»¶ sudo apt remove [è½¯ä»¶å] # ç¤ºä¾‹ï¼šç§»é™¤rsync sudo apt remove rsync ğŸ§¹ å½»åº•å¸è½½ï¼ˆå«é…ç½®æ–‡ä»¶ï¼‰ 1 2 3 4 5 6 7 8 # å®Œå…¨ç§»é™¤è½¯ä»¶åŒ…åŠç›¸å…³é…ç½®æ–‡ä»¶ sudo apt purge [è½¯ä»¶å] # ç¤ºä¾‹ï¼šå½»åº•ç§»é™¤rsync sudo apt purge rsync # è‡ªåŠ¨ç§»é™¤ä¸å†éœ€è¦çš„ä¾èµ–åŒ… sudo apt autoremove ğŸ”§ PPA ä»“åº“ç®¡ç† 1 2 3 4 5 6 7 8 # æ·»åŠ PPAä»“åº“ sudo add-apt-repository ppa:[ppaåç§°] # ç§»é™¤PPAä»“åº“ sudo add-apt-repository --remove ppa:[ppaåç§°] # æ›´æ–°PPAæº sudo apt update ğŸ–¥ï¸ PVE è½¯ä»¶ç®¡ç† ğŸ“¥ å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 3 4 5 6 7 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt-get update -y # å®‰è£…å¸¸ç”¨å·¥å…· sudo apt-get install -y rsync sudo curl wget vim tree samba zip htop net-tools # ğŸ¯ Proxmox VE ç¯å¢ƒä¸‹çš„å¸¸ç”¨å·¥å…· ğŸ—‘ï¸ å¸è½½è½¯ä»¶ 1 2 3 4 5 # ç§»é™¤è½¯ä»¶åŒ… sudo apt-get remove [è½¯ä»¶å] # ç¤ºä¾‹ï¼šç§»é™¤rsync sudo apt-get remove rsync ğŸ§¹ å½»åº•å¸è½½ï¼ˆå«é…ç½®æ–‡ä»¶ï¼‰ 1 2 3 4 5 6 7 8 # å®Œå…¨ç§»é™¤è½¯ä»¶åŒ…åŠç›¸å…³é…ç½®æ–‡ä»¶ sudo apt-get purge [è½¯ä»¶å] # ç¤ºä¾‹ï¼šå½»åº•ç§»é™¤rsync sudo apt-get purge rsync # è‡ªåŠ¨ç§»é™¤ä¸å†éœ€è¦çš„ä¾èµ–åŒ… sudo apt-get autoremove ğŸ”ï¸ Alpine è½¯ä»¶ç®¡ç† ğŸ“¥ å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 3 4 5 6 7 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apk update # å®‰è£…å¸¸ç”¨å·¥å…· sudo apk add rsync sudo curl wget vim tree samba shadow nfs-utils zip htop net-tools # ğŸ¯ è½»é‡çº§ Alpine Linux ä¸“ç”¨å·¥å…·é›† ğŸ—‘ï¸ å¸è½½è½¯ä»¶ 1 2 3 4 5 # ç§»é™¤è½¯ä»¶åŒ… sudo apk del [è½¯ä»¶å] # ç¤ºä¾‹ï¼šç§»é™¤rsync sudo apk del rsync ğŸ“‹ è½¯ä»¶åŒ…ç®¡ç† 1 2 3 4 5 6 7 8 # åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ… apk info -v # æœç´¢è½¯ä»¶åŒ… apk search [è½¯ä»¶å] # æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ… sudo apk upgrade ğŸ“¦ iStoreOS è½¯ä»¶ç®¡ç† ğŸ“¥ å®‰è£…å¸¸ç”¨è½¯ä»¶ 1 2 3 4 5 6 7 8 9 10 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ opkg update # å®‰è£…å¸¸ç”¨å·¥å…· opkg install nano rsync curl fdisk vsftpd openssh-sftp-server zip htop # ğŸš€ å¯åŠ¨ FTP æœåŠ¡ /etc/init.d/vsftpd enable \u0026amp;\u0026amp; /etc/init.d/vsftpd start # ğŸ¯ é€‚ç”¨äºè·¯ç”±å™¨çš„è½»é‡çº§å·¥å…· ğŸ—‘ï¸ å¸è½½è½¯ä»¶ 1 2 3 4 5 # ç§»é™¤è½¯ä»¶åŒ… opkg remove [è½¯ä»¶å] # ç¤ºä¾‹ï¼šç§»é™¤rsync opkg remove rsync ğŸ“‹ è½¯ä»¶åŒ…ç®¡ç† 1 2 3 4 5 # åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ… opkg list-installed # æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ… opkg update \u0026amp;\u0026amp; opkg upgrade ğŸ’¡ å°è´´å£«ä¸æœ€ä½³å®è·µ ğŸ” è½¯ä»¶æœç´¢æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨æ‰€æœ‰å‘è¡Œç‰ˆä¸­æœç´¢è½¯ä»¶ # Debian/Ubuntu/PVE: apt search [å…³é”®è¯] # CentOS: yum search [å…³é”®è¯] # Alpine: apk search [å…³é”®è¯] # iStoreOS: opkg list | grep [å…³é”®è¯] ğŸ“Š ç£ç›˜æ¸…ç†ä¸ç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 # æ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜ # Debian/Ubuntu/PVE: sudo apt clean # CentOS: sudo yum clean all # Alpine: sudo apk cache clean # åˆ é™¤æ— ç”¨ä¾èµ–åŒ… sudo apt autoremove # Debian/Ubuntu/PVE ğŸ“ é…ç½®æ–‡ä»¶ç®¡ç† 1 2 3 4 5 # å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ sudo cp /etc/[æœåŠ¡å]/[é…ç½®æ–‡ä»¶] /etc/[æœåŠ¡å]/[é…ç½®æ–‡ä»¶].backup # æ¯”è¾ƒé…ç½®æ–‡ä»¶å·®å¼‚ diff /etc/[æœåŠ¡å]/[é…ç½®æ–‡ä»¶] /etc/[æœåŠ¡å]/[é…ç½®æ–‡ä»¶].backup ğŸ›¡ï¸ å®‰å…¨æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 # å®šæœŸæ›´æ–°ç³»ç»Ÿ # Debian/Ubuntu/PVE: sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y # CentOS: sudo yum update -y # Alpine: sudo apk update \u0026amp;\u0026amp; sudo apk upgrade # è®¾ç½®è‡ªåŠ¨å®‰å…¨æ›´æ–° sudo apt install unattended-upgrades # Debian/Ubuntu sudo unattended-upgrade --debug â“ å¸¸è§é—®é¢˜è§£ç­” 1. å¦‚ä½•è§£å†³ä¾èµ–é—®é¢˜ï¼Ÿ 1 2 3 4 5 6 # å°è¯•ä¿®å¤æŸåçš„ä¾èµ–å…³ç³» # Debian/Ubuntu/PVE: sudo apt --fix-broken install # CentOS: sudo yum check-dependencies 2. å¦‚ä½•æ·»åŠ ç¬¬ä¸‰æ–¹è½¯ä»¶æºï¼Ÿ 1 2 3 4 5 # Debian/Ubuntu: ç¼–è¾‘/etc/apt/sources.list.d/ç›®å½•ä¸‹çš„.listæ–‡ä»¶ # CentOS: ç¼–è¾‘/etc/yum.repos.d/ç›®å½•ä¸‹çš„.repoæ–‡ä»¶ # Alpine: ç¼–è¾‘/etc/apk/repositoriesæ–‡ä»¶ # æ·»åŠ æºååŠ¡å¿…æ›´æ–°è½¯ä»¶åŒ…ç¼“å­˜ 3. å¦‚ä½•å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Ÿ 1 2 3 4 5 6 7 8 9 # Debian/Ubuntu/PVE: sudo apt install [è½¯ä»¶å]=[ç‰ˆæœ¬å·] # CentOS: sudo yum install [è½¯ä»¶å]-[ç‰ˆæœ¬å·] # æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬ apt-cache policy [è½¯ä»¶å] # Debian/Ubuntu yum list --showduplicates [è½¯ä»¶å] # CentOS 4. å¦‚ä½•æŸ¥æ‰¾è½¯ä»¶åŒ…æä¾›çš„æ–‡ä»¶ï¼Ÿ 1 2 3 4 5 6 7 8 # Debian/Ubuntu/PVE: dpkg -L [è½¯ä»¶å] # CentOS: rpm -ql [è½¯ä»¶å] # Alpine: apk info -L [è½¯ä»¶å] 5. å¦‚ä½•è§£å†³\u0026quot;è½¯ä»¶åŒ…æœªæ‰¾åˆ°\u0026quot;é”™è¯¯ï¼Ÿ æ›´æ–°è½¯ä»¶åŒ…ç¼“å­˜ æ£€æŸ¥è½¯ä»¶æºé…ç½®æ˜¯å¦æ­£ç¡® ç¡®è®¤è½¯ä»¶åŒ…åç§°æ˜¯å¦æ­£ç¡® å°è¯•æ·»åŠ åŒ…å«è¯¥è½¯ä»¶åŒ…çš„ç¬¬ä¸‰æ–¹æº ğŸ¯ æç¤ºï¼šä¸åŒ Linux å‘è¡Œç‰ˆçš„è½¯ä»¶ç®¡ç†æ–¹å¼å„æœ‰ç‰¹ç‚¹ï¼ŒæŒæ¡è¿™äº›æŠ€å·§å°†å¤§å¤§æé«˜ä½ çš„å·¥ä½œæ•ˆç‡ã€‚å»ºè®®æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‘è¡Œç‰ˆå’Œè½¯ä»¶ç®¡ç†ç­–ç•¥ã€‚\nğŸ“š æ‰©å±•é˜…è¯»ï¼š\nDebian è½¯ä»¶åŒ…ç®¡ç†æŒ‡å— CentOS Yum ä½¿ç”¨æŒ‡å— Ubuntu è½¯ä»¶ç®¡ç†æŠ€å·§ Alpine Linux åŒ…ç®¡ç† ğŸ§ Happy Linuxing! äº«å—å¼€æºä¸–ç•Œå¸¦æ¥çš„æ— é™å¯èƒ½ï¼\n","date":"2024-12-07T15:46:25+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/cf0b3fb6/","title":"Linux å®‰è£…ä¸å¸è½½å¸¸ç”¨è½¯ä»¶ ğŸ§"},{"content":"Ubuntu é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸ ğŸŒ æŒæ¡åœ¨ Ubuntu ä¸Šé…ç½®å’Œç®¡ç† NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æµç¨‹ï¼æœ¬æŒ‡å—ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§ä¼˜åŒ–ï¼Œæ¶µç›–æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„å…¨æ–¹ä½é…ç½®ï¼ŒåŠ©ä½ è½»æ¾å®ç°è·¨ç½‘ç»œæ–‡ä»¶å…±äº«ã€‚\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ NFS ç®€ä»‹ä¸ä¼˜åŠ¿ ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ–¥ï¸ Ubuntu ä½œä¸º NFS æœåŠ¡å™¨é…ç½® ğŸ’» Ubuntu ä½œä¸º NFS å®¢æˆ·ç«¯é…ç½® ğŸ”§ NFS æŒ‚è½½ç®¡ç† ğŸ” NFS å…±äº«æŸ¥çœ‹ä¸ç®¡ç† âš™ï¸ é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ› æ•…éšœæ’é™¤ ğŸ“Š æ€»ç»“ âœ¨ NFS ç®€ä»‹ä¸ä¼˜åŠ¿ NFS (Network File System) æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œå…è®¸é€šè¿‡ç½‘ç»œåœ¨ä¸åŒä¸»æœºé—´å…±äº«æ–‡ä»¶ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸŒ ç½‘ç»œå…±äº«ï¼šå®ç°å¤šå°æœåŠ¡å™¨ä¹‹é—´çš„æ–‡ä»¶å…±äº«å’Œè®¿é—® âš¡ é«˜æ€§èƒ½ï¼šæä¾›å¿«é€Ÿçš„ç½‘ç»œæ–‡ä»¶è®¿é—®é€Ÿåº¦ ğŸ”„ é€æ˜è®¿é—®ï¼šå®¢æˆ·ç«¯å¯ä»¥åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—®è¿œç¨‹æ–‡ä»¶ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒï¼šæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®å…±äº«ç›®å½• ğŸ›¡ï¸ æƒé™æ§åˆ¶ï¼šå¯ä»¥è®¾ç½®ä¸åŒçš„è®¿é—®æƒé™å’Œå®‰å…¨æ€§é€‰é¡¹ ğŸ’¾ èµ„æºé›†ä¸­ï¼šé›†ä¸­å­˜å‚¨ç®¡ç†ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ ğŸ“Š NFS ç‰ˆæœ¬å¯¹æ¯” ç‰ˆæœ¬ ç‰¹æ€§ é€‚ç”¨åœºæ™¯ NFSv2 åŸºç¡€åŠŸèƒ½ï¼Œ32ä½æ–‡ä»¶å¤§å°é™åˆ¶ è€æ—§ç³»ç»Ÿå…¼å®¹ NFSv3 64ä½æ–‡ä»¶å¤§å°ï¼Œå¼‚æ­¥å†™å…¥ å¤§å¤šæ•°ç°æœ‰ç¯å¢ƒ NFSv4 çŠ¶æ€åè®®ï¼Œå¼ºå®‰å…¨æ€§ï¼Œå¤åˆæ“ä½œ ç°ä»£ç¯å¢ƒæ¨è NFSv4.1 å¹¶è¡ŒNFS(pNFS)ï¼Œä¼šè¯ trunking é«˜æ€§èƒ½è®¡ç®—ç¯å¢ƒ NFSv4.2 æœåŠ¡å™¨ç«¯å¤åˆ¶ï¼Œç©ºé—´é¢„ç•™ æœ€æ–°åº”ç”¨åœºæ™¯ ğŸš€ å¿«é€Ÿå¼€å§‹ 1. ä½¿ç”¨ç§‘æŠ€lionä¸€é”®è„šæœ¬å·¥å…· 1 2 # ä¸‹è½½å¹¶è¿è¡Œç§‘æŠ€lionçš„ä¸€é”®é…ç½®è„šæœ¬ sudo curl -sS -O https://kejilion.pro/kejilion.sh \u0026amp;\u0026amp; chmod +x kejilion.sh \u0026amp;\u0026amp; ./kejilion.sh 2. å®‰è£… NFS å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è½¯ä»¶ 1 2 3 4 5 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… NFS ç›¸å…³è½¯ä»¶ sudo apt update \u0026amp;\u0026amp; sudo apt install nfs-kernel-server nfs-common -y # éªŒè¯å®‰è£… dpkg -l | grep nfs ğŸ–¥ï¸ ä¸€ã€Ubuntu ä½œä¸º NFS æœåŠ¡å™¨é…ç½® 1. åˆ›å»ºå¹¶é…ç½®å…±äº«ç›®å½• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™ sudo mkdir -pm 755 /mnt/mydisk # æ›´æ”¹ç›®å½•æ‰€æœ‰æƒï¼ˆå¯é€‰ï¼Œæ ¹æ®éœ€æ±‚ï¼‰ sudo chown nobody:nogroup /mnt/mydisk # é…ç½® NFS å¯¼å‡ºè®¾ç½® sudo tee /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## å…±äº« /mnt/mydisk ç›®å½•ç»™æ‰€æœ‰å®¢æˆ·ç«¯ /mnt/mydisk *(rw,fsid=0,no_subtree_check,no_root_squash,insecure,sync) # æˆ–è€…é™åˆ¶ç‰¹å®šç½‘æ®µè®¿é—® # /mnt/mydisk 192.168.1.0/24(rw,sync,no_subtree_check) # /mnt/mydisk 10.10.10.0/24(rw,sync,no_subtree_check) EOF # é‡æ–°åŠ è½½å¯¼å‡ºé…ç½® sudo exportfs -r # æŸ¥çœ‹å½“å‰å¯¼å‡ºåˆ—è¡¨ sudo exportfs -v 2. é‡å¯ NFS æœåŠ¡å™¨ 1 2 3 4 5 6 7 8 9 10 11 # æ–¹æ³•ä¸€ï¼šä½¿ç”¨ service å‘½ä»¤é‡å¯ sudo service nfs-kernel-server restart # æ–¹æ³•äºŒï¼šä½¿ç”¨ init.d è„šæœ¬é‡å¯ sudo /etc/init.d/nfs-kernel-server restart # æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ systemctl é‡å¯ï¼ˆæ¨èï¼‰ sudo systemctl restart nfs-kernel-server # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable nfs-kernel-server 3. éªŒè¯ NFS æœåŠ¡å™¨çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ NFS æœåŠ¡çŠ¶æ€ sudo systemctl status nfs-kernel-server # æŸ¥çœ‹å½“å‰å¯¼å‡ºçš„å…±äº«ç›®å½• sudo showmount -e # æŸ¥çœ‹ç«¯å£æ˜ å°„ sudo rpcinfo -p # æ£€æŸ¥NFSç»Ÿè®¡ä¿¡æ¯ nfsstat -s ğŸ’» äºŒã€Ubuntu ä½œä¸º NFS å®¢æˆ·ç«¯é…ç½® 1. ä¸´æ—¶æŒ‚è½½ NFS å…±äº« 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŒ‚è½½ ARS2 æœåŠ¡å™¨çš„å…±äº«ç›®å½• mkdir -pm 755 /mnt/ARS2-NFS mount -t nfs -o rw,hard,intr,timeo=300,retrans=3 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS # æŒ‚è½½ PVE æœåŠ¡å™¨çš„å…±äº«ç›®å½• mkdir -pm 755 /mnt/PVE-NFS mount -t nfs -o rw,hard,intr,timeo=300,retrans=3 10.10.10.254:/mnt/ntfs /mnt/PVE-NFS # æŒ‚è½½ Debian æœåŠ¡å™¨çš„å…±äº«ç›®å½• mkdir -pm 755 /mnt/Debian-NFS mount -t nfs -o rw,hard,intr,timeo=300,retrans=3 10.10.10.247:/mnt/mydisk /mnt/Debian-NFS # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹ df -hT /mnt/* # æµ‹è¯•æŒ‚è½½ç‚¹å†™å…¥æƒé™ touch /mnt/ARS2-NFS/test_file \u0026amp;\u0026amp; echo \u0026#34;å†™å…¥æµ‹è¯•æˆåŠŸ\u0026#34; || echo \u0026#34;å†™å…¥æµ‹è¯•å¤±è´¥\u0026#34; 2. æ°¸ä¹…æŒ‚è½½ NFS å…±äº« æ–¹æ³•ä¸€ï¼šè¦†ç›– /etc/fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• sudo mkdir -pm 755 /mnt/ARS2-NFS /mnt/PVE-NFS /mnt/Debian-NFS # é…ç½® fstab æ–‡ä»¶å®ç°æ°¸ä¹…æŒ‚è½½ sudo tee /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS å…±äº«é…ç½® 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs rw,hard,intr,timeo=300,retrans=3,nofail,x-systemd.device-timeout=15s 0 0 10.10.10.254:/mnt/ntfs /mnt/PVE-NFS nfs rw,hard,intr,timeo=300,retrans=3,nofail,x-systemd.device-timeout=15s 0 0 10.10.10.245:/mnt/mydisk /mnt/Debian-NFS nfs rw,hard,intr,timeo=300,retrans=3,nofail,x-systemd.device-timeout=15s 0 0 EOF # æµ‹è¯• fstab é…ç½®æ˜¯å¦æ­£ç¡® sudo mount -av # é‡å¯ç³»ç»Ÿä½¿é…ç½®ç”Ÿæ•ˆ sudo reboot æ–¹æ³•äºŒï¼šè¿½åŠ åˆ° /etc/fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»º Alpine æœåŠ¡å™¨çš„æŒ‚è½½ç‚¹ sudo mkdir -pm 755 /mnt/Alpine-NFS # è¿½åŠ  Alpine æœåŠ¡å™¨çš„ NFS å…±äº«é…ç½® sudo tee -a /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # è¿½åŠ  Alpine æœåŠ¡å™¨ NFS å…±äº« 10.10.10.242:/mnt/mydisk /mnt/Alpine-NFS nfs rw,hard,intr,timeo=300,retrans=3,nofail,x-systemd.device-timeout=15s 0 0 EOF # ç«‹å³æŒ‚è½½æ–°å¢çš„å…±äº« sudo mount /mnt/Alpine-NFS # é‡å¯ç³»ç»Ÿä½¿é…ç½®ç”Ÿæ•ˆ sudo reboot 3. æµ‹è¯•æŒ‚è½½é…ç½® 1 2 3 4 5 6 7 8 # æµ‹è¯• fstab é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆä¸å®é™…æŒ‚è½½ï¼‰ sudo mount -a # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½çš„ NFS å…±äº« mount | grep nfs # æ£€æŸ¥æŒ‚è½½ç‚¹çŠ¶æ€ df -hT | grep nfs ğŸ”§ ä¸‰ã€NFS æŒ‚è½½ç®¡ç† 1. æŸ¥çœ‹ NFS æŒ‚è½½çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹ df -hT /mnt/* # æŸ¥çœ‹ NFS ç‰¹å®šçš„æŒ‚è½½ä¿¡æ¯ mount | grep nfs # æŸ¥çœ‹è¯¦ç»†çš„æŒ‚è½½é€‰é¡¹ cat /proc/mounts | grep nfs # æŸ¥çœ‹NFSå®¢æˆ·ç«¯ç»Ÿè®¡ä¿¡æ¯ nfsstat -c æŒ‚è½½ç›®å½•è¯¦æƒ…ç¤ºä¾‹ï¼š\næ–‡ä»¶ç³»ç»Ÿ ç±»å‹ å¤§å° å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ 10.10.10.251:/mnt/mydisk nfs 2.7T 1.8T 823G 69% /mnt/ARS2-NFS 10.10.10.254:/mnt/ntfs nfs 932G 216G 717G 24% /mnt/PVE-NFS 10.10.10.247:/mnt/mydisk nfs 16G 7.9G 6.9G 54% /mnt/Ubuntu-NFS 2. å–æ¶ˆ NFS æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å–æ¶ˆå•ä¸ªæŒ‚è½½ç‚¹ sudo umount /mnt/ARS2-NFS # å–æ¶ˆæ‰€æœ‰ NFS æŒ‚è½½ sudo umount -a -t nfs # å¼ºåˆ¶å–æ¶ˆæŒ‚è½½ï¼ˆå½“è®¾å¤‡å¿™æ—¶ï¼‰ sudo umount -f /mnt/ARS2-NFS # å»¶è¿Ÿå–æ¶ˆæŒ‚è½½ï¼ˆå½“è®¾å¤‡å¿™æ—¶ï¼‰ sudo umount -l /mnt/ARS2-NFS # æŸ¥æ‰¾å¹¶ç»ˆæ­¢ä½¿ç”¨æŒ‚è½½ç‚¹çš„è¿›ç¨‹ sudo fuser -km /mnt/ARS2-NFS ğŸ” å››ã€NFS å…±äº«æŸ¥çœ‹ä¸ç®¡ç† 1. æŸ¥çœ‹ NFS å…±äº«ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨çš„ NFS å…±äº« sudo showmount -e 10.10.10.254 # æŸ¥çœ‹æœ¬æœºçš„ NFS å…±äº« sudo showmount -e # æŸ¥çœ‹å·²è¿æ¥æœ¬æœº NFS å…±äº«çš„å®¢æˆ·ç«¯ sudo showmount -a # æŸ¥çœ‹NFSæœåŠ¡å™¨çŠ¶æ€ nfsstat -s # æŸ¥çœ‹RPCæœåŠ¡çŠ¶æ€ rpcinfo -p 2. NFS çŠ¶æ€ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ NFS æœåŠ¡å™¨çŠ¶æ€ nfsstat -s # æŸ¥çœ‹ NFS å®¢æˆ·ç«¯çŠ¶æ€ nfsstat -c # å®æ—¶ç›‘æ§ NFS æ´»åŠ¨ sudo nfsstat -m # ç›‘æ§NFSæ€§èƒ½ nfsiostat 5 # æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ 3. è‡ªåŠ¨æ£€æŸ¥ NFS å…±äº«è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # åˆ›å»ºæ£€æŸ¥è„šæœ¬ cat \u0026gt; ./check_nfs_shares.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # å®šä¹‰è¦æ£€æŸ¥çš„æœåŠ¡å™¨åˆ—è¡¨ servers=( \u0026#34;10.10.10.242\u0026#34; \u0026#34;10.10.10.252\u0026#34; \u0026#34;10.10.10.243\u0026#34; \u0026#34;10.10.10.254\u0026#34; \u0026#34;10.10.10.251\u0026#34; \u0026#34;10.10.10.245\u0026#34; \u0026#34;10.10.10.246\u0026#34; \u0026#34;10.10.10.247\u0026#34; ) # å¾ªç¯æ£€æŸ¥æ¯ä¸ªæœåŠ¡å™¨çš„ NFS å…±äº« for server in \u0026#34;${servers[@]}\u0026#34;; do echo \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31mæ£€æŸ¥æœåŠ¡å™¨: $server\\033[0m\u0026#34; # æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿ if ping -c 1 -W 1 \u0026#34;$server\u0026#34; \u0026amp;\u0026gt; /dev/null; then echo -e \u0026#34;\\033[1;32mâœ“ æœåŠ¡å™¨åœ¨çº¿\\033[0m\u0026#34; # å°è¯•è·å–å…±äº«åˆ—è¡¨ï¼Œè®¾ç½®è¶…æ—¶é˜²æ­¢é•¿æ—¶é—´ç­‰å¾… timeout 5s showmount -e \u0026#34;$server\u0026#34; 2\u0026gt;/dev/null \u0026amp;\u0026amp; \\ echo -e \u0026#34;\\033[1;32mâœ“ NFSæœåŠ¡æ­£å¸¸\\033[0m\u0026#34; || \\ echo -e \u0026#34;\\033[1;31mâœ— NFSæœåŠ¡å¼‚å¸¸æˆ–æœªè¿è¡Œ\\033[0m\u0026#34; else echo -e \u0026#34;\\033[1;31mâœ— æœåŠ¡å™¨ç¦»çº¿\\033[0m\u0026#34; fi echo \u0026#34;-----------------------\u0026#34; done EOF # èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™å¹¶è¿è¡Œ chmod +x ./check_nfs_shares.sh ./check_nfs_shares.sh # æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼Œæ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ (crontab -l 2\u0026gt;/dev/null; echo \u0026#34;0 * * * * /path/to/check_nfs_shares.sh \u0026gt;\u0026gt; /var/log/nfs_check.log\u0026#34;) | crontab - âš™ï¸ äº”ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– 1. NFS æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # ç¼–è¾‘ /etc/nfs.conf æ–‡ä»¶è¿›è¡Œé«˜çº§é…ç½® sudo tee -a /etc/nfs.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [nfsd] threads=16 host= port= vers4=y vers4.0=y vers4.1=y vers4.2=y [mountd] manage-gids=y host= port= [statd] state-directory-path=/var/lib/nfs/statd [nfsdcld] storage-directory=/var/lib/nfs/nfsdcld [exportd] debug=0 EOF # è°ƒæ•´å†…æ ¸å‚æ•°ä¼˜åŒ–NFSæ€§èƒ½ sudo tee -a /etc/sysctl.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS æ€§èƒ½ä¼˜åŒ– sunrpc.tcp_slot_table_entries = 128 sunrpc.udp_slot_table_entries = 128 fs.nfs.nfs_congestion_kbps = 125000 EOF # åº”ç”¨å†…æ ¸å‚æ•° sudo sysctl -p # é‡å¯ NFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ sudo systemctl restart nfs-kernel-server 2. é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å…è®¸ NFS ç›¸å…³ç«¯å£é€šè¿‡é˜²ç«å¢™ sudo ufw allow from 10.10.10.0/24 to any port nfs sudo ufw allow from 10.10.10.0/24 to any port mountd sudo ufw allow from 10.10.10.0/24 to any port nlockmgr # æˆ–è€…å›ºå®šNFSç«¯å£å¹¶å¼€æ”¾ sudo tee -a /etc/sysctl.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; fs.nfs.nfs_callback_port = 8765 fs.nfs.nlm_udpport = 8766 fs.nfs.nlm_tcpport = 8767 EOF # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ sudo ufw status # æŸ¥çœ‹NFSä½¿ç”¨çš„ç«¯å£ rpcinfo -p 3. è‡ªåŠ¨æŒ‚è½½ (autofs) é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å®‰è£… autofs sudo apt install autofs -y # é…ç½® autofs sudo tee /etc/auto.master \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /mnt/nfs /etc/auto.nfs --timeout=300 --ghost EOF # åˆ›å»º NFS è‡ªåŠ¨æŒ‚è½½é…ç½® sudo tee /etc/auto.nfs \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ars2 -fstype=nfs,rw,hard,intr,timeo=300,retrans=3 10.10.10.251:/mnt/mydisk pve -fstype=nfs,rw,hard,intr,timeo=300,retrans=3 10.10.10.254:/mnt/ntfs debian -fstype=nfs,rw,hard,intr,timeo=300,retrans=3 10.10.10.247:/mnt/mydisk EOF # é‡å¯ autofs æœåŠ¡ sudo systemctl restart autofs # æµ‹è¯•è‡ªåŠ¨æŒ‚è½½ ls /mnt/nfs/ars2 ğŸ”’ å…­ã€å®‰å…¨æ³¨æ„äº‹é¡¹ 1. é™åˆ¶ NFS è®¿é—®æƒé™ 1 2 3 4 5 6 7 8 9 10 11 # åªå…è®¸ç‰¹å®š IP æ®µè®¿é—® NFS å…±äº« sudo tee /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /mnt/mydisk 10.10.10.0/24(rw,sync,no_subtree_check,no_root_squash) /mnt/secure 10.10.20.5(ro,sync,no_subtree_check) 10.10.20.6(ro,sync,no_subtree_check) EOF # é‡æ–°åŠ è½½é…ç½® sudo exportfs -r # æŸ¥çœ‹å½“å‰å¯¼å‡ºé…ç½® sudo exportfs -v 2. ä½¿ç”¨æ›´å®‰å…¨çš„ NFSv4 1 2 3 4 5 6 7 8 9 10 # åœ¨ /etc/fstab ä¸­ä½¿ç”¨ NFSv4 sudo tee -a /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs4 rw,hard,intr,timeo=300,retrans=3,nofail,x-systemd.device-timeout=15s,sec=krb5p 0 0 EOF # é…ç½®NFSæœåŠ¡å™¨åªä½¿ç”¨NFSv4 sudo sed -i \u0026#39;s/^RPCNFSDOPTS=\u0026#34;.*\u0026#34;$/RPCNFSDOPTS=\u0026#34;-N 2 -N 3 -V 4.2\u0026#34;/\u0026#39; /etc/default/nfs-kernel-server # é‡å¯NFSæœåŠ¡ sudo systemctl restart nfs-kernel-server 3. å®šæœŸæ£€æŸ¥ NFS å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥ NFS å…±äº«æƒé™ sudo showmount -e # æ£€æŸ¥è°åœ¨è®¿é—® NFS å…±äº« sudo showmount -a # æ£€æŸ¥ NFS æ—¥å¿— sudo tail -f /var/log/syslog | grep nfs # æ£€æŸ¥ä¸å®‰å…¨çš„å¯¼å‡ºé…ç½® sudo exports -v | grep -E \u0026#39;(insecure|no_root_squash)\u0026#39; # å®‰å…¨æ‰«æNFSæœåŠ¡ sudo nmap -sV -p 111,2049,20048 --script nfs* 10.10.10.251 4. ä½¿ç”¨Kerberosè®¤è¯ï¼ˆé«˜çº§ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å®‰è£…Kerberoså®¢æˆ·ç«¯ sudo apt install krb5-user libpam-krb5 -y # é…ç½®/etc/krb5.conf sudo cp /etc/krb5.conf /etc/krb5.conf.backup sudo editor /etc/krb5.conf # é…ç½®NFSä½¿ç”¨Kerberos sudo sed -i \u0026#39;s/^SECURE_NFS=.*/SECURE_NFS=\u0026#34;yes\u0026#34;/\u0026#39; /etc/default/nfs-common # è·å–Kerberosç¥¨æ® kinit nfs/$(hostname -f) # æ£€æŸ¥ç¥¨æ® klist # é‡å¯NFSæœåŠ¡ sudo systemctl restart nfs-common nfs-kernel-server ğŸ› ä¸ƒã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # å¦‚æœæŒ‚è½½å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping -c 3 10.10.10.251 # æ£€æŸ¥ NFS æœåŠ¡æ˜¯å¦è¿è¡Œ sudo systemctl status nfs-kernel-server # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status # æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ dmesg | grep nfs # æ£€æŸ¥RPCæœåŠ¡çŠ¶æ€ rpcinfo -p # æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ sudo netstat -tulnp | grep -E \u0026#39;(2049|111|20048)\u0026#39; # å¼ºåˆ¶é‡æ–°æ³¨å†ŒRPCæœåŠ¡ sudo rpcbind -w sudo systemctl restart nfs-common 2. å¼ºåˆ¶é‡æ–°æŒ‚è½½ 1 2 3 4 5 6 7 8 9 # å¼ºåˆ¶é‡æ–°æŒ‚è½½æ‰€æœ‰ NFS å…±äº« sudo umount -a -t nfs sudo mount -a # æ£€æŸ¥æŒ‚è½½ç»“æœ mount | grep nfs # å¦‚æœæŒ‚è½½ä»ç„¶å¤±è´¥ï¼Œæ£€æŸ¥æœåŠ¡å™¨ç«¯é…ç½® ssh nfs-server \u0026#34;sudo exportfs -v\u0026#34; 3. æ¸…é™¤ NFS ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 # æ¸…é™¤ NFS å®¢æˆ·ç«¯ç¼“å­˜ sudo /etc/init.d/nfs-common restart # æ¸…é™¤ NFS æœåŠ¡å™¨ç¼“å­˜ sudo /etc/init.d/nfs-kernel-server restart # æ¸…é™¤RPCç¼“å­˜ sudo rpcbind -w # æ¸…é™¤DNSç¼“å­˜ï¼ˆå¦‚æœä½¿ç”¨ä¸»æœºåï¼‰ sudo systemd-resolve --flush-caches 4. æ—¥å¿—åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„NFSç›¸å…³æ¡ç›® sudo journalctl -u nfs-kernel-server -f sudo journalctl -u nfs-common -f # æŸ¥çœ‹è¯¦ç»†çš„NFSè°ƒè¯•ä¿¡æ¯ sudo cat /proc/fs/nfsd/versions sudo cat /proc/fs/nfsd/pool_stats # å¯ç”¨NFSè°ƒè¯•æ—¥å¿— echo 32767 \u0026gt; /proc/sys/sunrpc/nfsd_debug echo 32767 \u0026gt; /proc/sys/sunrpc/nfs_debug # ç›‘æ§NFSæ“ä½œ sudo nfsstat -m ğŸ“Š æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²ç»å­¦ä¼šäº†åœ¨ Ubuntu ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç† NFS å…±äº«çš„å®Œæ•´æµç¨‹ï¼š\nâœ… NFS æœåŠ¡å™¨é…ç½®ï¼šè®¾ç½®å…±äº«ç›®å½•å’Œè®¿é—®æƒé™ âœ… NFS å®¢æˆ·ç«¯é…ç½®ï¼šä¸´æ—¶å’Œæ°¸ä¹…æŒ‚è½½è¿œç¨‹å…±äº« âœ… æŒ‚è½½ç®¡ç†ï¼šæŸ¥çœ‹ã€å–æ¶ˆå’Œç›‘æ§ NFS æŒ‚è½½ âœ… é«˜çº§é…ç½®ï¼šæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è®¾ç½® âœ… æ•…éšœæ’é™¤ï¼šè§£å†³å¸¸è§çš„ NFS è¿æ¥é—®é¢˜ ğŸ¯ æœ€ä½³å®è·µæ€»ç»“ ç‰ˆæœ¬é€‰æ‹©ï¼šå°½å¯èƒ½ä½¿ç”¨ NFSv4ï¼Œå®ƒæ›´å®‰å…¨ä¸”åŠŸèƒ½æ›´ä¸°å¯Œ å®‰å…¨é…ç½®ï¼šé™åˆ¶è®¿é—®IPèŒƒå›´ï¼Œé¿å…ä½¿ç”¨ no_root_squash æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®ç½‘ç»œæ¡ä»¶è°ƒæ•´è¶…æ—¶å’Œé‡ä¼ å‚æ•° ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥NFSæ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ å¤‡ä»½é…ç½®ï¼šå®šæœŸå¤‡ä»½ /etc/exports å’Œ /etc/fstab æ–‡ä»¶ ğŸ“š æ‰©å±•èµ„æº NFSå®˜æ–¹æ–‡æ¡£ NFSæ•…éšœæ’é™¤æŒ‡å— NFSæ€§èƒ½è°ƒä¼˜ ğŸ’¡ æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ NFSv4 åè®®ï¼Œå¹¶é™åˆ¶åªæœ‰å¯ä¿¡çš„ IP åœ°å€å¯ä»¥è®¿é—® NFS å…±äº«ã€‚å®šæœŸæ£€æŸ¥ NFS æ—¥å¿—å’Œæƒé™è®¾ç½®ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚\nğŸŒ ç°åœ¨ä½ å¯ä»¥è½»æ¾åœ°åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´å…±äº«æ–‡ä»¶äº†ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿æŸ¥é˜…ä¸Šè¿°èµ„æºæˆ–åœ¨ç¤¾åŒºå¯»æ±‚å¸®åŠ©ã€‚\n","date":"2024-12-07T15:45:30+08:00","image":"https://file.meimolihan.eu.org/img/ubuntu-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9a4b7ac2/","title":"Ubuntu é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸"},{"content":"iStoreOS é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡ ğŸŒ å¿«é€Ÿä¿®æ”¹ç½‘ç»œè®¾ç½®ï¼Œè½»æ¾åˆ‡æ¢ä¸åŒç½‘ç»œç¯å¢ƒ\nğŸ“– ç›®å½•å¯¼èˆª âœ¨ ç‰¹æ€§ä»‹ç» âš¡ ä¸€é”®ç½‘å…³é…ç½® ğŸ”§ æ‰‹åŠ¨ç½‘ç»œé…ç½® ğŸ“Š ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ğŸš€ ç½‘ç»œè¿æ¥æµ‹è¯• âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ› ï¸ æ•…éšœæ’é™¤ âœ¨ ç‰¹æ€§ä»‹ç» iStoreOS æ˜¯ä¸€æ¬¾åŸºäº OpenWRT å¼€å‘çš„æ™ºèƒ½è·¯ç”±æ“ä½œç³»ç»Ÿï¼Œæä¾›ä»¥ä¸‹ç‰¹æ€§ï¼š\nğŸ¯ ç®€å•æ˜“ç”¨ï¼šæä¾›å‹å¥½çš„ Web ç®¡ç†ç•Œé¢å’Œå‘½ä»¤è¡Œå·¥å…· ğŸ”„ çµæ´»é…ç½®ï¼šæ”¯æŒå¿«é€Ÿåˆ‡æ¢ä¸åŒç½‘ç»œç¯å¢ƒå’Œç½‘å…³è®¾ç½® ğŸ“¶ ç¨³å®šå¯é ï¼šåŸºäºæˆç†Ÿçš„ OpenWRT ç³»ç»Ÿï¼Œç½‘ç»œåŠŸèƒ½ç¨³å®š ğŸ›¡ï¸ å®‰å…¨å¢å¼ºï¼šå†…ç½®é˜²ç«å¢™å’Œå®‰å…¨é˜²æŠ¤åŠŸèƒ½ ğŸ”§ æ‰©å±•æ€§å¼ºï¼šæ”¯æŒè½¯ä»¶åŒ…å®‰è£…å’ŒåŠŸèƒ½æ‰©å±• âš¡ ä¸€é”®ç½‘å…³é…ç½® ğŸ¯ å¿«é€Ÿåˆ‡æ¢é»˜è®¤ç½‘å…³ 1. é…ç½® 10.10.10.252 ç½‘å…³ 1 2 # ğŸš€ ä¸€é”®é…ç½® 10.10.10.252 ç½‘å…³å¹¶é‡å¯ç½‘ç»œ sed -i \u0026#39;s/option gateway.*/option gateway \u0026#39;10.10.10.252\u0026#39;/\u0026#39; /etc/config/network \u0026amp;\u0026amp; /etc/init.d/network restart 2. é…ç½® 10.10.10.243 ç½‘å…³ 1 2 # ğŸ”„ ä¸€é”®é…ç½® 10.10.10.243 ç½‘å…³å¹¶é‡å¯ç½‘ç»œ sed -i \u0026#39;s/option gateway.*/option gateway \u0026#39;10.10.10.243\u0026#39;/\u0026#39; /etc/config/network \u0026amp;\u0026amp; /etc/init.d/network restart 3. é…ç½® 10.10.10.253 ç½‘å…³ 1 2 # ğŸ”§ ä¸€é”®é…ç½® 10.10.10.253 ç½‘å…³å¹¶é‡å¯ç½‘ç»œ sed -i \u0026#39;s/option gateway.*/option gateway \u0026#39;10.10.10.253\u0026#39;/\u0026#39; /etc/config/network \u0026amp;\u0026amp; /etc/init.d/network restart ğŸ“ è‡ªå®šä¹‰ç½‘å…³é…ç½® 1 2 3 # æ›¿æ¢ä¸ºä½ éœ€è¦çš„ç½‘å…³åœ°å€ NEW_GATEWAY=\u0026#34;192.168.1.1\u0026#34; sed -i \u0026#34;s/option gateway.*/option gateway \u0026#39;$NEW_GATEWAY\u0026#39;/\u0026#34; /etc/config/network \u0026amp;\u0026amp; /etc/init.d/network restart ğŸ”§ æ‰‹åŠ¨ç½‘ç»œé…ç½® ğŸ“ ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶ 1 2 3 4 5 # ä½¿ç”¨ nano ç¼–è¾‘å™¨ä¿®æ”¹ç½‘ç»œé…ç½® nano /etc/config/network # æˆ–ä½¿ç”¨ vi ç¼–è¾‘å™¨ vi /etc/config/network ğŸ‘€ æŸ¥çœ‹å½“å‰ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 # æ˜¾ç¤ºå®Œæ•´çš„ç½‘ç»œé…ç½®æ–‡ä»¶ cat /etc/config/network # ä»…æ˜¾ç¤ºç½‘ç»œæ¥å£é…ç½® uci show network # æŸ¥çœ‹å½“å‰æ¥å£çŠ¶æ€ ifstatus lan ğŸ’¾ åº”ç”¨é…ç½®æ›´æ”¹ 1 2 3 4 5 6 7 8 # é‡æ–°åŠ è½½ç½‘ç»œé…ç½®ï¼ˆä¸é‡å¯ï¼‰ /etc/init.d/network reload # å®Œå…¨é‡å¯ç½‘ç»œæœåŠ¡ /etc/init.d/network restart # ä½¿ç”¨ uci æäº¤æ›´æ”¹ uci commit network ğŸ“Š ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ğŸ” æŸ¥çœ‹å½“å‰ç½‘å…³ä¿¡æ¯ 1 2 3 4 5 6 7 8 # æ˜¾ç¤ºé»˜è®¤ç½‘å…³ï¼ˆå½©è‰²è¾“å‡ºï¼‰ echo -e \u0026#34;\\e[1;34mé»˜è®¤ç½‘å…³: \\e[1;31m$(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;)\\e[0m\u0026#34; # è¯¦ç»†è·¯ç”±ä¿¡æ¯ ip route show # æŸ¥çœ‹æ‰€æœ‰è·¯ç”±è¡¨ route -n ğŸŒ æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€ 1 2 3 4 5 6 7 8 # æ˜¾ç¤ºæ‰€æœ‰æ¥å£ä¿¡æ¯ ip addr show # æŸ¥çœ‹ç‰¹å®šæ¥å£ï¼ˆå¦‚br-lanï¼‰ ip addr show br-lan # ç®€æ´çš„æ¥å£çŠ¶æ€ ifconfig ğŸ“¡ DNS é…ç½®æ£€æŸ¥ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹DNSé…ç½® cat /etc/resolv.conf # æ£€æŸ¥DNSè§£æ nslookup google.com # æµ‹è¯•DNSå“åº”æ—¶é—´ dig google.com | grep \u0026#34;Query time\u0026#34; ğŸš€ ç½‘ç»œè¿æ¥æµ‹è¯• âš¡ ä¸‹è½½é€Ÿåº¦æµ‹è¯• 1 2 3 4 5 6 7 8 # ä¸‹è½½æµ‹è¯•æ–‡ä»¶ï¼ˆæ˜¾ç¤ºè¿›åº¦ï¼‰ wget -c -O /mnt/alltube.zip https://github.com/Rudloff/alltube/releases/download/3.1.1/alltube-3.1.1.zip # é™é€Ÿä¸‹è½½æµ‹è¯•ï¼ˆ100KB/sï¼‰ wget --limit-rate=100k -O /tmp/test.file http://example.com/file # æ˜¾ç¤ºä¸‹è½½è¿›åº¦ wget -q --show-progress -O /dev/null http://speedtest.tele2.net/100MB.zip ğŸ§¹ æ¸…ç†æµ‹è¯•æ–‡ä»¶ 1 2 3 4 5 # åˆ é™¤æµ‹è¯•æ–‡ä»¶ rm -f /mnt/alltube.zip # æ¸…ç†ä¸´æ—¶ä¸‹è½½æ–‡ä»¶ rm -f /tmp/test.file /tmp/*.download ğŸŒ ç½‘ç»œè¿é€šæ€§æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æµ‹è¯•ç½‘å…³è¿é€šæ€§ ping -c 4 $(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;) # æµ‹è¯•å¤–ç½‘è¿é€šæ€§ ping -c 4 8.8.8.8 # æµ‹è¯•DNSè§£æ ping -c 4 google.com # è·Ÿè¸ªç½‘ç»œè·¯å¾„ traceroute google.com # ä½¿ç”¨ mtr è¿›è¡Œç»¼åˆç½‘ç»œæµ‹è¯• mtr -r -c 10 google.com âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”´ é‡è¦è­¦å‘Š ğŸ’¾ å¤‡ä»½é…ç½®: ä¿®æ”¹å‰åŠ¡å¿…å¤‡ä»½ç½‘ç»œé…ç½®\n1 cp /etc/config/network /etc/config/network.backup.$(date +%Y%m%d) ğŸ“¶ è¿æ¥é£é™©: é”™è¯¯çš„ç½‘å…³é…ç½®å¯èƒ½å¯¼è‡´ç½‘ç»œä¸­æ–­\n1 # ç¡®ä¿ä½ æœ‰ç‰©ç†è®¿é—®æƒé™æˆ–å¤‡ç”¨è¿æ¥æ–¹å¼ ğŸ”„ æœåŠ¡å½±å“: ç½‘ç»œé‡å¯ä¼šçŸ­æš‚ä¸­æ–­æ‰€æœ‰ç½‘ç»œè¿æ¥\nâœ… æœ€ä½³å®è·µ ğŸ§ª æµ‹è¯•å‰éªŒè¯: å…ˆæ£€æŸ¥è¯­æ³•æ˜¯å¦æ­£ç¡®\n1 2 # æ£€æŸ¥é…ç½®è¯­æ³• uci validate network â° é€‰æ‹©åˆé€‚æ—¶é—´: åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œç½‘ç»œå˜æ›´\nğŸ“ è®°å½•å˜æ›´: è®°å½•æ¯æ¬¡ç½‘å…³ä¿®æ”¹çš„æ—¶é—´å’ŒåŸå› \nğŸ” é¢„å…ˆæµ‹è¯•: ä¿®æ”¹å‰å…ˆ ping æµ‹è¯•ç›®æ ‡ç½‘å…³\n1 ping -c 3 10.10.10.252 ğŸ› ï¸ æ•…éšœæ’é™¤ ğŸ”§ ç½‘ç»œé—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ç½‘ç»œæœåŠ¡çŠ¶æ€ /etc/init.d/network status # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„ç½‘ç»œé”™è¯¯ logread | grep network logread | grep dnsmasq # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ /etc/init.d/firewall status ğŸš‘ ç½‘ç»œæ¢å¤å‘½ä»¤ 1 2 3 4 5 6 7 8 # é‡å¯æ‰€æœ‰ç½‘ç»œç›¸å…³æœåŠ¡ /etc/init.d/network restart /etc/init.d/dnsmasq restart /etc/init.d/firewall restart # é‡ç½®ç½‘ç»œé…ç½®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ cp /etc/config/network.backup /etc/config/network /etc/init.d/network restart ğŸ“± æ— çº¿ç½‘ç»œæ£€æŸ¥ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ— çº¿ç½‘ç»œçŠ¶æ€ iwinfo # æ£€æŸ¥ç‰¹å®šæ— çº¿æ¥å£ iwinfo wlan0 info # æ‰«æå¯ç”¨æ— çº¿ç½‘ç»œ iwinfo wlan0 scan ğŸ”„ Webç•Œé¢æ¢å¤ å¦‚æœå‘½ä»¤è¡Œé…ç½®å‡ºç°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢å¤ï¼š\né€šè¿‡ç‰©ç†è¿æ¥è®¿é—®iStoreOS Webç®¡ç†ç•Œé¢ è¿›å…¥\u0026quot;ç½‘ç»œ\u0026quot; â†’ \u0026ldquo;æ¥å£\u0026rdquo; â†’ \u0026ldquo;LAN\u0026quot;è®¾ç½® é‡æ–°é…ç½®æ­£ç¡®çš„IPv4åœ°å€å’Œç½‘å…³ ä¿å­˜å¹¶åº”ç”¨è®¾ç½® ğŸ“ è·å–å¸®åŠ© å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼š\næŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼šhttps://wiki.istoreos.com/ è®¿é—®ç¤¾åŒºè®ºå›å¯»æ±‚å¸®åŠ© æ”¶é›†æ—¥å¿—ä¿¡æ¯ï¼šlogread \u0026gt; /tmp/system.log ğŸ’¡ ä¸“ä¸šæç¤º: åœ¨ä¿®æ”¹ç½‘ç»œè®¾ç½®å‰ï¼Œå»ºè®®å…ˆé€šè¿‡ ping å‘½ä»¤æµ‹è¯•ç›®æ ‡ç½‘å…³çš„è¿é€šæ€§ã€‚å¦‚æœå¯èƒ½ï¼Œæœ€å¥½åœ¨ç‰©ç†æ§åˆ¶å°å‰è¿›è¡Œæ“ä½œï¼Œä»¥å…ç½‘ç»œé…ç½®é”™è¯¯å¯¼è‡´æ— æ³•è¿œç¨‹è¿æ¥ã€‚\n","date":"2024-12-07T15:31:28+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/cb813b15/","title":"iStoreOS é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡"},{"content":"Alpine é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡ ğŸŒŸ æ¦‚è¿° æœ¬æŒ‡å—æä¾› Alpine Linux ç³»ç»Ÿé…ç½®é™æ€ IPv4 ç½‘å…³çš„å®Œæ•´æ–¹æ³•ï¼Œæ”¯æŒå¤šä¸ªç½‘å…³å¿«é€Ÿåˆ‡æ¢ï¼Œæ— éœ€é‡å¯ç³»ç»Ÿå³å¯ç”Ÿæ•ˆã€‚Alpine Linux ä»¥å…¶è½»é‡çº§å’Œå®‰å…¨æ€§è‘—ç§°ï¼Œæ˜¯è®¸å¤šæœåŠ¡å™¨å’Œå®¹å™¨ç¯å¢ƒçš„ç†æƒ³é€‰æ‹©ã€‚\nâœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸš€ å¿«é€Ÿåˆ‡æ¢ï¼šæä¾›ä¸€é”®è„šæœ¬åœ¨å¤šä¸ªç½‘å…³é—´å¿«é€Ÿåˆ‡æ¢ âš¡ å³æ—¶ç”Ÿæ•ˆï¼šæ— éœ€é‡å¯ç³»ç»Ÿï¼Œç½‘ç»œé…ç½®æ›´æ”¹ç«‹å³åº”ç”¨ ğŸ”§ ç®€å•æ˜“ç”¨ï¼šæ¸…æ™°çš„å‘½ä»¤å’Œç¤ºä¾‹ï¼Œé€‚åˆå„ç§æŠ€æœ¯æ°´å¹³çš„ç”¨æˆ· ğŸ“Š å…¨é¢è¦†ç›–ï¼šåŒ…å«é…ç½®ã€æµ‹è¯•ã€è¯Šæ–­å’Œæ•…éšœæ’é™¤å…¨æµç¨‹ ğŸ›¡ï¸ å®‰å…¨å¯é ï¼šæä¾›é…ç½®å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆï¼Œé¿å…ç½‘ç»œä¸­æ–­ ğŸ“‘ å¯¼èˆªç›®å½• ğŸŒ  æ¦‚è¿° âš¡ å¿«é€Ÿç½‘å…³åˆ‡æ¢è„šæœ¬ ğŸ”§ ç½‘ç»œç®¡ç†å‘½ä»¤ ğŸ“Š å®Œæ•´ç½‘ç»œé…ç½®ç¤ºä¾‹ ğŸ› ï¸ ç½‘ç»œæµ‹è¯•ä¸è¯Šæ–­ âš ï¸ æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ ğŸ”„ é«˜çº§ç½‘ç»œé…ç½® ğŸ¯ å®ç”¨æŠ€å·§ ğŸ“ ç³»ç»ŸæœåŠ¡ç®¡ç† ğŸŒ  æ¦‚è¿° Alpine Linux æ˜¯ä¸€ä¸ªåŸºäº musl libc å’Œ BusyBox çš„è½»é‡çº§ Linux å‘è¡Œç‰ˆï¼Œç‰¹åˆ«é€‚åˆèµ„æºå—é™ç¯å¢ƒå’Œå®¹å™¨éƒ¨ç½²ã€‚æœ¬æŒ‡å—ä¸“æ³¨äº Alpine ç³»ç»Ÿçš„é™æ€ IPv4 ç½‘ç»œé…ç½®ï¼Œç‰¹åˆ«æ˜¯ç½‘å…³ç®¡ç†ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nâœ… å¤šç½‘å…³å¿«é€Ÿåˆ‡æ¢ âœ… æ— éœ€ç³»ç»Ÿé‡å¯ âœ… å®Œæ•´çš„ç½‘ç»œè¯Šæ–­å·¥å…· âœ… å¤‡ä»½å’Œæ¢å¤æœºåˆ¶ âœ… é€‚ç”¨äºå„ç§ç½‘ç»œç¯å¢ƒ âš¡ å¿«é€Ÿç½‘å…³åˆ‡æ¢è„šæœ¬ 1. åˆ‡æ¢åˆ° 10.10.10.252 ç½‘å…³ 1 2 3 sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.252/\u0026#39; /etc/network/interfaces \u0026amp;\u0026amp; \\ sudo service networking restart \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.252\u0026#34; 2. åˆ‡æ¢åˆ° 10.10.10.243 ç½‘å…³ 1 2 3 sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.243/\u0026#39; /etc/network/interfaces \u0026amp;\u0026amp; \\ sudo service networking restart \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.243\u0026#34; 3. åˆ‡æ¢åˆ° 10.10.10.253 ç½‘å…³ 1 2 3 sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.253/\u0026#39; /etc/network/interfaces \u0026amp;\u0026amp; \\ sudo service networking restart \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.253\u0026#34; 4. æŸ¥çœ‹å½“å‰é»˜è®¤ç½‘å…³ 1 echo -e \u0026#34;\\e[1;34må½“å‰é»˜è®¤ç½‘å…³: \\e[1;31m$(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;)\\e[0m\u0026#34; ğŸ”§ ç½‘ç»œç®¡ç†å‘½ä»¤ ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶ 1 sudo nano /etc/network/interfaces æŸ¥çœ‹ç½‘ç»œé…ç½® 1 cat /etc/network/interfaces é‡å¯ç½‘ç»œæœåŠ¡ 1 sudo service networking restart æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€ 1 ip link show æŸ¥çœ‹ IP åœ°å€é…ç½® 1 ip addr show ğŸ“Š å®Œæ•´çš„ç½‘ç»œé…ç½®ç¤ºä¾‹ æŸ¥çœ‹å½“å‰çš„å®Œæ•´ç½‘ç»œé…ç½® 1 cat /etc/network/interfaces å…¸å‹çš„ Alpine ç½‘ç»œé…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 # /etc/network/interfaces æ–‡ä»¶ç¤ºä¾‹ auto lo iface lo inet loopback auto eth0 iface eth0 inet static address 10.10.10.247/24 gateway 10.10.10.252 dns-nameservers 223.5.5.5 8.8.8.8 ğŸ› ï¸ ç½‘ç»œæµ‹è¯•ä¸è¯Šæ–­ æµ‹è¯•ç½‘ç»œè¿æ¥ 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ wget -c -O /tmp/test.zip https://github.com/Rudloff/alltube/releases/download/3.1.1/alltube-3.1.1.zip # åˆ é™¤æµ‹è¯•æ–‡ä»¶ rm -f /tmp/test.zip # æµ‹è¯•åˆ°ç½‘å…³çš„è¿é€šæ€§ ping -c 4 10.10.10.252 # æµ‹è¯•å¤–éƒ¨ç½‘ç»œè¿é€šæ€§ ping -c 4 223.5.5.5 ç½‘ç»œè¯Šæ–­å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹è·¯ç”±è¡¨ ip route show # è¿½è¸ªç½‘ç»œè·¯å¾„ traceroute 8.8.8.8 # æ£€æŸ¥ DNS è§£æ nslookup google.com # æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯ netstat -i âš ï¸ æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ é…ç½®æ–‡ä»¶å¤‡ä»½ 1 2 3 4 5 6 # å¤‡ä»½ç½‘ç»œé…ç½® sudo cp /etc/network/interfaces /etc/network/interfaces.backup # æ¢å¤ç½‘ç»œé…ç½® sudo cp /etc/network/interfaces.backup /etc/network/interfaces sudo service networking restart å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 # å¦‚æœç½‘ç»œæœåŠ¡é‡å¯å¤±è´¥ï¼Œå°è¯•ä»¥ä¸‹å‘½ä»¤ sudo ifdown eth0 sudo ifup eth0 # æ£€æŸ¥ç½‘ç»œæœåŠ¡çŠ¶æ€ sudo service networking status # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„ç½‘ç»œé”™è¯¯ logread | grep network ç½‘ç»œæ¥å£é‡å‘½åé—®é¢˜ å¦‚æœæ¥å£åç§°ä¸æ˜¯ eth0ï¼Œä½¿ç”¨å®é™…æ¥å£åç§°ï¼š\n1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£ ip link show # æ ¹æ®å®é™…æ¥å£åç§°ä¿®æ”¹å‘½ä»¤ sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.252/\u0026#39; /etc/network/interfaces ğŸ”„ é«˜çº§ç½‘ç»œé…ç½® å¤šç½‘å¡é…ç½® å¦‚æœæ‚¨æœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 # /etc/network/interfaces å¤šç½‘å¡é…ç½®ç¤ºä¾‹ auto eth0 iface eth0 inet static address 10.10.10.247/24 gateway 10.10.10.252 auto eth1 iface eth1 inet static address 192.168.1.100/24 DNS é…ç½® é™¤äº†åœ¨ interfaces æ–‡ä»¶ä¸­é…ç½®ï¼Œè¿˜å¯ä»¥å•ç‹¬é…ç½® DNSï¼š\n1 2 3 4 5 6 7 8 9 # ç¼–è¾‘ resolv.conf sudo nano /etc/resolv.conf # æ·»åŠ ä»¥ä¸‹å†…å®¹ nameserver 223.5.5.5 nameserver 8.8.8.8 # é˜²æ­¢ DNS é…ç½®è¢«è¦†ç›– sudo chattr +i /etc/resolv.conf ğŸ¯ å®ç”¨æŠ€å·§ åˆ›å»ºå¿«é€Ÿåˆ‡æ¢è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/bash # ä¿å­˜ä¸º /usr/local/bin/switch_gateway if [ $# -eq 0 ]; then echo \u0026#34;ç”¨æ³•: switch_gateway [252|243|253]\u0026#34; exit 1 fi case $1 in \u0026#34;252\u0026#34;) GATEWAY=\u0026#34;10.10.10.252\u0026#34; ;; \u0026#34;243\u0026#34;) GATEWAY=\u0026#34;10.10.10.243\u0026#34; ;; \u0026#34;253\u0026#34;) GATEWAY=\u0026#34;10.10.10.253\u0026#34; ;; *) echo \u0026#34;é”™è¯¯: æ— æ•ˆçš„ç½‘å…³é€‰æ‹©\u0026#34; exit 1 ;; esac sudo sed -i \u0026#34;s/gateway.*/gateway $GATEWAY/\u0026#34; /etc/network/interfaces sudo service networking restart echo \u0026#34;âœ… å·²åˆ‡æ¢åˆ°ç½‘å…³: $GATEWAY\u0026#34; è®¾ç½®è„šæœ¬æƒé™ 1 sudo chmod +x /usr/local/bin/switch_gateway ä½¿ç”¨è„šæœ¬åˆ‡æ¢ç½‘å…³ 1 2 3 4 5 6 7 8 # åˆ‡æ¢åˆ° 252 ç½‘å…³ switch_gateway 252 # åˆ‡æ¢åˆ° 243 ç½‘å…³ switch_gateway 243 # åˆ‡æ¢åˆ° 253 ç½‘å…³ switch_gateway 253 ğŸ“ ç³»ç»ŸæœåŠ¡ç®¡ç† ç½‘ç»œç›¸å…³æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ç½‘ç»œæœåŠ¡çŠ¶æ€ rc-status | grep network # å°†ç½‘ç»œæœåŠ¡æ·»åŠ åˆ°é»˜è®¤è¿è¡Œçº§åˆ« rc-update add networking default # æ‰‹åŠ¨å¯åŠ¨ç½‘ç»œæœåŠ¡ rc-service networking start # åœæ­¢ç½‘ç»œæœåŠ¡ rc-service networking stop æ£€æŸ¥æœåŠ¡ä¾èµ– 1 2 3 4 5 # æŸ¥çœ‹ç½‘ç»œæœåŠ¡çš„ä¾èµ–å…³ç³» rc-service networking --list # é‡æ–°åŠ è½½æœåŠ¡é…ç½® rc-update -u ğŸ‰ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè½»æ¾åœ°åœ¨ Alpine Linux ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç†é™æ€ IP ç½‘å…³ï¼Œå¹¶åœ¨ä¸åŒç½‘å…³ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚Alpine Linux çš„ç½‘ç»œé…ç½®è™½ç„¶ç®€å•ï¼Œä½†åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆå„ç§éƒ¨ç½²åœºæ™¯ã€‚\nå…³é”®è¦ç‚¹ï¼š\nğŸ›¡ï¸ å§‹ç»ˆå¤‡ä»½ç½‘ç»œé…ç½® before è¿›è¡Œæ›´æ”¹ ğŸ” ä½¿ç”¨æä¾›çš„è¯Šæ–­å·¥å…·éªŒè¯ç½‘ç»œçŠ¶æ€ âš¡ åˆ©ç”¨è„šæœ¬å®ç°å¿«é€Ÿç½‘å…³åˆ‡æ¢ ğŸ“ äº†è§£ Alpine ç‰¹æœ‰çš„ OpenRC æœåŠ¡ç®¡ç†ç³»ç»Ÿ å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥ååŠ©ï¼Œè¯·å‚è€ƒ Alpine Linux å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚Happy networking! ğŸš€\n","date":"2024-12-07T15:30:42+08:00","image":"https://file.meimolihan.eu.org/img/alpine-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dd9edff6/","title":"Alpine é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡"},{"content":"CentOS é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡ ğŸŒŸ ç®€ä»‹ä¸ç‰¹ç‚¹ æœ¬æŒ‡å—æä¾›åœ¨ CentOS ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç†é™æ€ IPv4 åœ°å€åŠé»˜è®¤ç½‘å…³çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚CentOS ä½œä¸ºä¼ä¸šçº§ Linux å‘è¡Œç‰ˆï¼Œæä¾›äº†å¼ºå¤§è€Œç¨³å®šçš„ç½‘ç»œç®¡ç†åŠŸèƒ½ã€‚\nâœ¨ ä¸»è¦ç‰¹ç‚¹ ğŸš€ å¤šç½‘å…³æ”¯æŒï¼šå¿«é€Ÿåœ¨ä¸åŒç½‘å…³é—´åˆ‡æ¢ âš¡ å³æ—¶ç”Ÿæ•ˆï¼šé…ç½®æ›´æ”¹æ— éœ€é‡å¯ç³»ç»Ÿ ğŸ”§ åŒé‡ç®¡ç†ï¼šæ”¯æŒä¼ ç»Ÿ network æœåŠ¡å’Œ NetworkManager ğŸ“Š å…¨é¢è¯Šæ–­ï¼šæä¾›ä¸°å¯Œçš„ç½‘ç»œçŠ¶æ€æ£€æŸ¥å·¥å…· ğŸ›¡ï¸ å®‰å…¨å¯é ï¼šåŒ…å«é…ç½®å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆ ğŸ’¾ æ€§èƒ½æµ‹è¯•ï¼šå†…ç½®ç½‘ç»œé€Ÿåº¦æµ‹è¯•åŠŸèƒ½ ğŸ“‘ å¯¼èˆªç›®å½• ğŸŒ  ç®€ä»‹ä¸ç‰¹ç‚¹ âš¡ é»˜è®¤ç½‘å…³é…ç½® ğŸ”§ å®Œæ•´ç½‘ç»œé…ç½®ç¤ºä¾‹ ğŸ“Š ç½‘ç»œçŠ¶æ€æ£€æŸ¥å‘½ä»¤ ğŸ”„ ç½‘ç»œæœåŠ¡ç®¡ç† ğŸ’¾ æ–‡ä»¶ä¸‹è½½æµ‹è¯• ğŸ› ï¸ é«˜çº§ç½‘ç»œé…ç½® ğŸ” æ•…éšœæ’é™¤ ğŸ“ ç½‘ç»œé…ç½®å¤‡ä»½ä¸æ¢å¤ ğŸ’¡ å®ç”¨è„šæœ¬ ğŸŒ  ç®€ä»‹ä¸ç‰¹ç‚¹ CentOS æ˜¯åŸºäº Red Hat Enterprise Linux (RHEL) æºä»£ç æ„å»ºçš„ä¼ä¸šçº§ Linux å‘è¡Œç‰ˆï¼Œä»¥å…¶ç¨³å®šæ€§å’Œå¯é æ€§è‘—ç§°ã€‚æœ¬æŒ‡å—ä¸“æ³¨äº CentOS ç³»ç»Ÿçš„é™æ€ IPv4 ç½‘ç»œé…ç½®ï¼Œç‰¹åˆ«æ˜¯ç½‘å…³ç®¡ç†å’Œç½‘ç»œæ•…éšœæ’é™¤ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nâœ… å¤šç½‘å…³å¿«é€Ÿåˆ‡æ¢è„šæœ¬ âœ… NetworkManager å’Œä¼ ç»Ÿç½‘ç»œæœåŠ¡åŒé‡æ”¯æŒ âœ… å®Œæ•´çš„ç½‘ç»œè¯Šæ–­å·¥å…·é›† âœ… é…ç½®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶ âœ… ç½‘ç»œæ€§èƒ½æµ‹è¯•åŠŸèƒ½ âœ… é«˜çº§ç½‘ç»œåŠŸèƒ½ï¼ˆç»‘å®šã€VLANï¼‰ âš¡ é»˜è®¤ç½‘å…³é…ç½® 1. é…ç½® 10.10.10.252 ç½‘å…³ 1 2 3 4 5 6 sudo chmod 755 /etc/sysconfig/network-scripts/ifcfg-eth0 \u0026amp;\u0026amp; \\ sudo sed -i \u0026#39;s/GATEWAY.*/GATEWAY=10.10.10.252/\u0026#39; /etc/sysconfig/network-scripts/ifcfg-eth0 \u0026amp;\u0026amp; \\ sudo systemctl restart NetworkManager \u0026amp;\u0026amp; \\ nmcli n off \u0026amp;\u0026amp; \\ nmcli n on \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.252\u0026#34; 2. é…ç½® 10.10.10.243 ç½‘å…³ 1 2 3 4 5 6 sudo chmod 755 /etc/sysconfig/network-scripts/ifcfg-eth0 \u0026amp;\u0026amp; \\ sudo sed -i \u0026#39;s/GATEWAY.*/GATEWAY=10.10.10.243/\u0026#39; /etc/sysconfig/network-scripts/ifcfg-eth0 \u0026amp;\u0026amp; \\ sudo systemctl restart NetworkManager \u0026amp;\u0026amp; \\ nmcli n off \u0026amp;\u0026amp; \\ nmcli n on \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.243\u0026#34; 3. é…ç½® 10.10.10.253 ç½‘å…³ 1 2 3 4 5 6 sudo chmod 755 /etc/sysconfig/network-scripts/ifcfg-eth0 \u0026amp;\u0026amp; \\ sudo sed -i \u0026#39;s/GATEWAY.*/GATEWAY=10.10.10.253/\u0026#39; /etc/sysconfig/network-scripts/ifcfg-eth0 \u0026amp;\u0026amp; \\ sudo systemctl restart NetworkManager \u0026amp;\u0026amp; \\ nmcli n off \u0026amp;\u0026amp; \\ nmcli n on \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.253\u0026#34; 4. æŸ¥çœ‹å½“å‰é»˜è®¤ç½‘å…³ 1 echo -e \u0026#34;\\e[1;34mé»˜è®¤ç½‘å…³ : \\e[1;31m$(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;)\\e[0m\u0026#34; ğŸ”§ å®Œæ•´ç½‘ç»œé…ç½®ç¤ºä¾‹ ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶ 1 sudo nano /etc/sysconfig/network-scripts/ifcfg-eth0 å®Œæ•´çš„é™æ€ IP é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 TYPE=Ethernet PROXY_METHOD=none BROWSER_ONLY=no BOOTPROTO=static DEFROUTE=yes IPV4_FAILURE_FATAL=no IPV6INIT=yes IPV6_AUTOCONF=yes IPV6_DEFROUTE=yes IPV6_FAILURE_FATAL=no IPV6_ADDR_GEN_MODE=stable-privacy NAME=eth0 UUID=your-uuid-here DEVICE=eth0 ONBOOT=yes # é™æ€ IP é…ç½® IPADDR=10.10.10.100 PREFIX=24 NETMASK=255.255.255.0 GATEWAY=10.10.10.252 DNS1=8.8.8.8 DNS2=8.8.4.4 DOMAIN=yourdomain.local ğŸ“Š ç½‘ç»œçŠ¶æ€æ£€æŸ¥å‘½ä»¤ æŸ¥çœ‹å½“å‰ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ IP åœ°å€ ip addr show # æŸ¥çœ‹è·¯ç”±è¡¨ ip route show # æŸ¥çœ‹ DNS é…ç½® cat /etc/resolv.conf # æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶æ€ nmcli device status # æŸ¥çœ‹è¿æ¥è¯¦æƒ… nmcli connection show æµ‹è¯•ç½‘ç»œè¿é€šæ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æµ‹è¯•ç½‘å…³è¿é€šæ€§ ping -c 4 10.10.10.252 # æµ‹è¯•å¤–éƒ¨ç½‘ç»œè¿é€šæ€§ ping -c 4 8.8.8.8 # æµ‹è¯• DNS è§£æ nslookup google.com # è·Ÿè¸ªè·¯ç”± traceroute google.com # æ£€æŸ¥ç«¯å£è¿é€šæ€§ nc -zv example.com 80 ğŸ”„ ç½‘ç»œæœåŠ¡ç®¡ç† é‡å¯ç½‘ç»œæœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # ä¼ ç»Ÿæ–¹æ³•ï¼ˆCentOS 7ï¼‰ sudo systemctl restart network # NetworkManager æ–¹æ³• sudo systemctl restart NetworkManager # é‡æ–°åŠ è½½æ‰€æœ‰è¿æ¥ nmcli connection reload # å…³é—­å†å¼€å¯ç½‘ç»œ nmcli n off \u0026amp;\u0026amp; nmcli n on æ¥å£ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 # å¯ç”¨ç½‘ç»œæ¥å£ sudo ifup eth0 # ç¦ç”¨ç½‘ç»œæ¥å£ sudo ifdown eth0 # é‡å¯ç‰¹å®šæ¥å£ sudo ifdown eth0 \u0026amp;\u0026amp; sudo ifup eth0 # ä½¿ç”¨ nmcli ç®¡ç†æ¥å£ nmcli connection up eth0 nmcli connection down eth0 ğŸ’¾ æ–‡ä»¶ä¸‹è½½æµ‹è¯• ä¸‹è½½æµ‹è¯•æ–‡ä»¶ 1 wget -c -O /mnt/alltube.zip https://github.com/Rudloff/alltube/releases/download/3.1.1/alltube-3.1.1.zip åˆ é™¤æµ‹è¯•æ–‡ä»¶ 1 rm -f /mnt/alltube.zip ä¸‹è½½é€Ÿåº¦æµ‹è¯• 1 2 3 4 5 6 7 8 # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ time wget -O /dev/null http://speedtest.tele2.net/100MB.zip # ä½¿ç”¨ curl æµ‹è¯•é€Ÿåº¦ curl -o /dev/null -w \u0026#34;é€Ÿåº¦: %{speed_download} B/s\\n\u0026#34; http://speedtest.tele2.net/100MB.zip # ä½¿ç”¨ speedtest-cli æµ‹è¯• speedtest-cli --simple ğŸ› ï¸ é«˜çº§ç½‘ç»œé…ç½® å¤šç½‘å¡ç»‘å®šï¼ˆBondingï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰è£…å¿…è¦å·¥å…· sudo yum install -y teamd # åˆ›å»ºç»‘å®šæ¥å£ sudo nmcli connection add type bond con-name bond0 ifname bond0 mode active-backup # æ·»åŠ ä»å±æ¥å£ sudo nmcli connection add type bond-slave ifname eth0 master bond0 sudo nmcli connection add type bond-slave ifname eth1 master bond0 # é…ç½® IP åœ°å€ sudo nmcli connection modify bond0 ipv4.addresses \u0026#39;10.10.10.100/24\u0026#39; sudo nmcli connection modify bond0 ipv4.gateway \u0026#39;10.10.10.252\u0026#39; sudo nmcli connection modify bond0 ipv4.method manual # æ¿€æ´»ç»‘å®š sudo nmcli connection up bond0 VLAN é…ç½® 1 2 3 4 5 6 7 8 9 # å®‰è£… VLAN æ”¯æŒ sudo yum install -y vlan # åˆ›å»º VLAN æ¥å£ sudo nmcli connection add type vlan con-name vlan10 ifname eth0.10 dev eth0 id 10 sudo nmcli connection modify vlan10 ipv4.addresses \u0026#39;10.10.10.100/24\u0026#39; sudo nmcli connection modify vlan10 ipv4.gateway \u0026#39;10.10.10.252\u0026#39; sudo nmcli connection modify vlan10 ipv4.method manual sudo nmcli connection up vlan10 ğŸ” æ•…éšœæ’é™¤ ç½‘ç»œè¯Šæ–­å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ£€æŸ¥ç½‘ç»œé…ç½® nmcli device show eth0 # æŸ¥çœ‹ç½‘ç»œæ—¥å¿— journalctl -u NetworkManager --since \u0026#34;5 minutes ago\u0026#34; # æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€ ss -tuln # æŸ¥çœ‹ ARP è¡¨ arp -n # æ£€æŸ¥è·¯ç”±è¡¨ route -n # è¿½è¸ªç½‘ç»œè·¯å¾„ mtr google.com å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å¦‚æœç½‘ç»œé…ç½®ä¸ç”Ÿæ•ˆ sudo rm -f /var/lib/NetworkManager/NetworkManager.state sudo systemctl restart NetworkManager # æ¸…é™¤ DNS ç¼“å­˜ sudo systemctl restart nscd # é‡ç½®ç½‘ç»œé…ç½® sudo nmcli connection delete eth0 sudo nmcli connection add type ethernet con-name eth0 ifname eth0 # æ£€æŸ¥ SELinux çŠ¶æ€ sestatus # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo firewall-cmd --list-all ğŸ“ ç½‘ç»œé…ç½®å¤‡ä»½ä¸æ¢å¤ å¤‡ä»½ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 # å¤‡ä»½æ‰€æœ‰ç½‘ç»œé…ç½® sudo tar -czf network-backup-$(date +%Y%m%d).tar.gz /etc/sysconfig/network-scripts/ /etc/hosts /etc/resolv.conf # å¤‡ä»½ç‰¹å®šæ¥å£é…ç½® sudo cp /etc/sysconfig/network-scripts/ifcfg-eth0 /etc/sysconfig/network-scripts/ifcfg-eth0.backup # å¤‡ä»½ NetworkManager è¿æ¥ sudo cp -r /etc/NetworkManager/system-connections/ /root/network-backup/ æ¢å¤ç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 # ä»å¤‡ä»½æ¢å¤ sudo tar -xzf network-backup-20231001.tar.gz -C / # æ¢å¤ç‰¹å®šæ¥å£é…ç½® sudo cp /etc/sysconfig/network-scripts/ifcfg-eth0.backup /etc/sysconfig/network-scripts/ifcfg-eth0 sudo systemctl restart NetworkManager # æ¢å¤ NetworkManager è¿æ¥ sudo cp -r /root/network-backup/system-connections/* /etc/NetworkManager/system-connections/ sudo chmod 600 /etc/NetworkManager/system-connections/* sudo systemctl restart NetworkManager ğŸ’¡ å®ç”¨è„šæœ¬ ç½‘ç»œçŠ¶æ€æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #!/bin/bash # network-status.sh echo -e \u0026#34;\\e[1;34m=== ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ===\\e[0m\u0026#34; echo \u0026#34;\u0026#34; # æ˜¾ç¤ºæ¥å£ä¿¡æ¯ echo -e \u0026#34;\\e[1;32mç½‘ç»œæ¥å£:\\e[0m\u0026#34; ip addr show | grep -E \u0026#34;^(.*: )|(inet )\u0026#34; # æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ echo -e \u0026#34;\\e[1;32mè·¯ç”±è¡¨:\\e[0m\u0026#34; ip route show # æ˜¾ç¤ºé»˜è®¤ç½‘å…³ echo -e \u0026#34;\\e[1;32mé»˜è®¤ç½‘å…³:\\e[0m\u0026#34; ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39; # æ˜¾ç¤ºDNSé…ç½® echo -e \u0026#34;\\e[1;32mDNS é…ç½®:\\e[0m\u0026#34; grep -E \u0026#34;^nameserver\u0026#34; /etc/resolv.conf # æµ‹è¯•è¿é€šæ€§ echo -e \u0026#34;\\e[1;32mç½‘ç»œè¿é€šæ€§:\\e[0m\u0026#34; ping -c 2 -W 1 8.8.8.8 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo \u0026#34;å¤–éƒ¨ç½‘ç»œ: å¯è¾¾\u0026#34; || echo \u0026#34;å¤–éƒ¨ç½‘ç»œ: ä¸å¯è¾¾\u0026#34; ping -c 2 -W 1 $(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo \u0026#34;ç½‘å…³: å¯è¾¾\u0026#34; || echo \u0026#34;ç½‘å…³: ä¸å¯è¾¾\u0026#34; # æ˜¾ç¤ºå¼€æ”¾ç«¯å£ echo -e \u0026#34;\\e[1;32må¼€æ”¾ç«¯å£:\\e[0m\u0026#34; ss -tuln | grep LISTEN ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 chmod +x network-status.sh ./network-status.sh ç½‘å…³åˆ‡æ¢è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #!/bin/bash # switch-gateway.sh if [ $# -eq 0 ]; then echo \u0026#34;ç”¨æ³•: switch-gateway [252|243|253]\u0026#34; exit 1 fi case $1 in \u0026#34;252\u0026#34;) GATEWAY=\u0026#34;10.10.10.252\u0026#34; ;; \u0026#34;243\u0026#34;) GATEWAY=\u0026#34;10.10.10.243\u0026#34; ;; \u0026#34;253\u0026#34;) GATEWAY=\u0026#34;10.10.10.253\u0026#34; ;; *) echo \u0026#34;é”™è¯¯: æ— æ•ˆçš„ç½‘å…³é€‰æ‹©\u0026#34; exit 1 ;; esac sudo chmod 755 /etc/sysconfig/network-scripts/ifcfg-eth0 sudo sed -i \u0026#34;s/GATEWAY=.*/GATEWAY=$GATEWAY/\u0026#34; /etc/sysconfig/network-scripts/ifcfg-eth0 sudo systemctl restart NetworkManager nmcli n off nmcli n on echo \u0026#34;âœ… å·²åˆ‡æ¢åˆ°ç½‘å…³: $GATEWAY\u0026#34; ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 3 chmod +x switch-gateway.sh # åˆ‡æ¢åˆ° 252 ç½‘å…³ ./switch-gateway.sh 252 ğŸ‰ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè½»æ¾åœ°åœ¨ CentOS ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç†é™æ€ IPv4 ç½‘ç»œè®¾ç½®ã€‚CentOS æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ç½‘ç»œç®¡ç†å·¥å…·ï¼Œæ— è®ºæ˜¯ä¼ ç»Ÿçš„ network æœåŠ¡è¿˜æ˜¯ç°ä»£çš„ NetworkManagerï¼Œéƒ½èƒ½æ»¡è¶³å„ç§ç½‘ç»œé…ç½®éœ€æ±‚ã€‚\nå…³é”®è¦ç‚¹ï¼š\nğŸ›¡ï¸ å§‹ç»ˆå¤‡ä»½ç½‘ç»œé…ç½® before è¿›è¡Œæ›´æ”¹ ğŸ” ä½¿ç”¨æä¾›çš„è¯Šæ–­å·¥å…·éªŒè¯ç½‘ç»œçŠ¶æ€ âš¡ åˆ©ç”¨è„šæœ¬å®ç°å¿«é€Ÿç½‘å…³åˆ‡æ¢ ğŸ“ äº†è§£ CentOS ç‰¹æœ‰çš„ç½‘ç»œæœåŠ¡ç®¡ç†æ–¹å¼ ğŸ”§ æŒæ¡é«˜çº§ç½‘ç»œåŠŸèƒ½å¦‚ç»‘å®šå’Œ VLAN å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥ååŠ©ï¼Œè¯·å‚è€ƒ CentOS å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚Happy networking! ğŸš€\n","date":"2024-12-07T15:29:12+08:00","image":"https://file.meimolihan.eu.org/img/centos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/2e3d80a8/","title":"CentOS é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡"},{"content":"Debian é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡ ğŸ“‘ å¯¼èˆªç›®å½• ğŸŒ  ç®€ä»‹ä¸ç‰¹ç‚¹ âš¡ é»˜è®¤ç½‘å…³é…ç½® ğŸ“‹ ç½‘ç»œé…ç½®æ–‡ä»¶ç®¡ç† ğŸŒ DNS é…ç½®æŒ‡å— ğŸ”§ å®Œæ•´é™æ€ IP é…ç½®ç¤ºä¾‹ ğŸ› ï¸ ç½‘ç»œæ•…éšœæ’æŸ¥ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”„ æ¢å¤ç½‘ç»œé…ç½® ğŸ’¡ å®ç”¨è„šæœ¬ä¸æŠ€å·§ ğŸŒ  ç®€ä»‹ä¸ç‰¹ç‚¹ Debian æ˜¯æœ€å¤è€ä¸”æœ€å—å°Šæ•¬çš„ Linux å‘è¡Œç‰ˆä¹‹ä¸€ï¼Œä»¥å…¶ç¨³å®šæ€§ã€å®‰å…¨æ€§å’Œå¹¿æ³›çš„è½¯ä»¶åŒ…æ”¯æŒè‘—ç§°ã€‚æœ¬æŒ‡å—ä¸“æ³¨äº Debian ç³»ç»Ÿçš„é™æ€ IPv4 ç½‘ç»œé…ç½®ï¼Œç‰¹åˆ«æ˜¯ç½‘å…³ç®¡ç†å’Œç½‘ç»œæ•…éšœæ’é™¤ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nâœ… å¤šç½‘å…³å¿«é€Ÿåˆ‡æ¢è„šæœ¬ âœ… ä¼ ç»Ÿ interfaces å’Œç°ä»£ netplan é…ç½®æ–¹æ³• âœ… å®Œæ•´çš„ç½‘ç»œè¯Šæ–­å·¥å…·é›† âœ… DNS é…ç½®è¯¦è§£ï¼ˆåŒ…æ‹¬ systemd-resolvedï¼‰ âœ… é…ç½®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶ âœ… å®ç”¨è„šæœ¬å’Œè‡ªåŠ¨åŒ–æŠ€å·§ âš¡ é»˜è®¤ç½‘å…³é…ç½® 1. é…ç½® 10.10.10.252 ç½‘å…³ 1 2 3 4 sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.252/\u0026#39; /etc/network/interfaces \u0026amp;\u0026amp; \\ sudo systemctl restart networking \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.252\u0026#34; # ğŸ’¨ ä¸€é”®é…ç½® 10.10.10.252 ç½‘å…³å¹¶é‡å¯ç½‘ç»œæœåŠ¡ 2. é…ç½® 10.10.10.243 ç½‘å…³ 1 2 3 4 sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.243/\u0026#39; /etc/network/interfaces \u0026amp;\u0026amp; \\ sudo systemctl restart networking \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.243\u0026#34; # ğŸ’¨ ä¸€é”®é…ç½® 10.10.10.243 ç½‘å…³å¹¶é‡å¯ç½‘ç»œæœåŠ¡ 3. é…ç½® 10.10.10.253 ç½‘å…³ 1 2 3 4 sudo sed -i \u0026#39;s/gateway.*/gateway 10.10.10.253/\u0026#39; /etc/network/interfaces \u0026amp;\u0026amp; \\ sudo systemctl restart networking \u0026amp;\u0026amp; \\ echo \u0026#34;âœ… å·²æˆåŠŸåˆ‡æ¢åˆ°ç½‘å…³: 10.10.10.253\u0026#34; # ğŸ’¨ ä¸€é”®é…ç½® 10.10.10.253 ç½‘å…³å¹¶é‡å¯ç½‘ç»œæœåŠ¡ 4. æŸ¥çœ‹å½“å‰é»˜è®¤ç½‘å…³ 1 2 echo -e \u0026#34;\\e[1;34mé»˜è®¤ç½‘å…³ : \\e[1;31m$(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;)\\e[0m\u0026#34; # ğŸ” æ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„é»˜è®¤ç½‘å…³åœ°å€ ğŸ“‹ ç½‘ç»œé…ç½®æ–‡ä»¶ç®¡ç† 1. ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶ 1 2 3 4 5 sudo nano /etc/network/interfaces # âœï¸ ä½¿ç”¨ nano ç¼–è¾‘å™¨ä¿®æ”¹ç½‘ç»œé…ç½® # æˆ–è€…ä½¿ç”¨ vim sudo vim /etc/network/interfaces 2. æŸ¥çœ‹ç½‘ç»œé…ç½®å†…å®¹ 1 2 3 4 5 cat /etc/network/interfaces # ğŸ‘€ æ˜¾ç¤ºå½“å‰ç½‘ç»œé…ç½®ä¿¡æ¯ # å¸¦è¡Œå·æŸ¥çœ‹ cat -n /etc/network/interfaces 3. é‡å¯ç½‘ç»œæœåŠ¡ 1 2 3 4 5 sudo systemctl restart networking # ğŸ”„ åº”ç”¨ç½‘ç»œé…ç½®æ›´æ”¹ # æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³• sudo /etc/init.d/networking restart 4. æ£€æŸ¥ç½‘ç»œæœåŠ¡çŠ¶æ€ 1 2 3 4 5 systemctl status networking # ğŸ“Š æ£€æŸ¥ç½‘ç»œæœåŠ¡è¿è¡ŒçŠ¶æ€ # æŸ¥çœ‹ç½‘ç»œæœåŠ¡æ—¥å¿— journalctl -u networking --since \u0026#34;5 minutes ago\u0026#34; ğŸŒ DNS é…ç½®æŒ‡å— Debian 12 DNS é…ç½®è¯´æ˜ Debian 12 é»˜è®¤ä½¿ç”¨ systemd-resolved ç®¡ç† DNSï¼Œå¯èƒ½æ²¡æœ‰ç›´æ¥çš„ /etc/resolv.conf æ–‡ä»¶ã€‚\n1. åˆ›å»º/ç¼–è¾‘ DNS é…ç½®æ–‡ä»¶ 1 2 sudo nano /etc/resolv.conf # âœï¸ ç¼–è¾‘ DNS è§£æé…ç½® 2. æ·»åŠ  DNS æœåŠ¡å™¨ 1 2 3 4 5 6 # æ–‡ä»¶å†…å®¹ï¼š nameserver 223.5.5.5 # ğŸŒ é˜¿é‡Œ DNS nameserver 8.8.8.8 # ğŸŒ Google DNS nameserver 114.114.114.114 # ğŸŒ 114 DNS nameserver 1.1.1.1 # ğŸŒ Cloudflare DNS options rotate # ğŸ”„ å¯ç”¨ DNS è½®è¯¢ 3. é˜²æ­¢ DNS é…ç½®è¢«è¦†ç›– 1 2 3 4 5 # è®¾ç½® resolv.conf ä¸ºä¸å¯å˜ sudo chattr +i /etc/resolv.conf # å–æ¶ˆä¸å¯å˜å±æ€§ sudo chattr -i /etc/resolv.conf 4. ä½¿ç”¨ systemd-resolved é…ç½® DNS 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹å½“å‰ DNS é…ç½® resolvectl status # è®¾ç½®å…¨å±€ DNS sudo resolvectl dns eth0 8.8.8.8 1.1.1.1 # è®¾ç½®ç‰¹å®šåŸŸçš„ DNS sudo resolvectl domain eth0 \u0026#34;example.com\u0026#34; # åˆ·æ–° DNS ç¼“å­˜ sudo resolvectl flush-caches 5. åœ¨ interfaces æ–‡ä»¶ä¸­é…ç½® DNS 1 2 3 # åœ¨ /etc/network/interfaces ä¸­æ·»åŠ  dns-nameservers 8.8.8.8 1.1.1.1 dns-search example.com ğŸ”§ å®Œæ•´é™æ€ IP é…ç½®ç¤ºä¾‹ /etc/network/interfaces æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ç¯å›æ¥å£ auto lo iface lo inet loopback # ä¸»ç½‘ç»œæ¥å£ - é™æ€ IP é…ç½® auto eth0 iface eth0 inet static address 192.168.1.100/24 # ğŸ“ é™æ€ IP åœ°å€å’Œ CIDR è¡¨ç¤ºæ³• # æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿè¡¨ç¤ºæ³• # address 192.168.1.100 # netmask 255.255.255.0 gateway 192.168.1.1 # ğŸŒ‰ é»˜è®¤ç½‘å…³ dns-nameservers 8.8.8.8 8.8.4.4 # ğŸ” DNS æœåŠ¡å™¨ dns-search example.com # ğŸ” DNS æœç´¢åŸŸ # å¤‡ç”¨ç½‘ç»œæ¥å£é…ç½®ç¤ºä¾‹ # auto eth1 # iface eth1 inet static # address 10.0.0.100/24 # gateway 10.0.0.1 ä½¿ç”¨ netplan (Debian 10+) 1 2 3 4 5 6 7 8 9 10 11 12 # /etc/netplan/01-netcfg.yaml network: version: 2 renderer: networkd ethernets: eth0: addresses: - 192.168.1.100/24 gateway4: 192.168.1.1 nameservers: addresses: [8.8.8.8, 8.8.4.4] search: [example.com] åº”ç”¨ netplan é…ç½® 1 2 3 sudo netplan apply # æˆ–è€… sudo netplan try ğŸ› ï¸ ç½‘ç»œæ•…éšœæ’æŸ¥ 1. æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯ 1 2 3 4 5 ip addr show # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£çš„è¯¦ç»†ä¿¡æ¯ # æŸ¥çœ‹ç‰¹å®šæ¥å£ ip addr show eth0 2. æ£€æŸ¥è·¯ç”±è¡¨ 1 2 3 4 5 ip route show # ğŸ—ºï¸ æ˜¾ç¤ºç³»ç»Ÿè·¯ç”±è¡¨ # æŸ¥çœ‹é»˜è®¤è·¯ç”± ip route show default 3. æµ‹è¯• DNS è§£æ 1 2 3 4 5 6 7 8 nslookup google.com # ğŸ” æµ‹è¯• DNS è§£æåŠŸèƒ½ # ä½¿ç”¨ dig å‘½ä»¤ dig google.com # æµ‹è¯•ç‰¹å®š DNS æœåŠ¡å™¨ nslookup google.com 8.8.8.8 4. ç½‘ç»œè¿é€šæ€§æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 ping -c 4 google.com # ğŸŒ æµ‹è¯•ç½‘ç»œè¿é€šæ€§ # æµ‹è¯•åˆ°ç½‘å…³çš„è¿é€šæ€§ ping -c 4 $(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;) # è·Ÿè¸ªè·¯ç”±è·¯å¾„ traceroute google.com # ä½¿ç”¨ mtr è¿›è¡Œæ›´è¯¦ç»†çš„è·Ÿè¸ª mtr google.com 5. ç«¯å£å’ŒæœåŠ¡æ£€æŸ¥ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç›‘å¬ç«¯å£ ss -tuln # æ£€æŸ¥ç‰¹å®šç«¯å£è¿é€šæ€§ nc -zv example.com 80 # æ£€æŸ¥ HTTP æœåŠ¡ curl -I http://example.com âš ï¸ æ³¨æ„äº‹é¡¹ å¤‡ä»½é…ç½®ï¼šä¿®æ”¹å‰å¤‡ä»½åŸå§‹æ–‡ä»¶\n1 2 sudo cp /etc/network/interfaces /etc/network/interfaces.backup sudo cp /etc/resolv.conf /etc/resolv.conf.backup æ¥å£åç§°ï¼šç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç½‘ç»œæ¥å£åç§°\n1 2 3 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£ ip link show ls /sys/class/net ç½‘ç»œé‡å¯ï¼šé…ç½®æ›´æ”¹åéœ€è¦é‡å¯ç½‘ç»œæœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ\n1 sudo systemctl restart networking æƒé™è¦æ±‚ï¼šæ‰€æœ‰é…ç½®ä¿®æ”¹éƒ½éœ€è¦ root æƒé™\n1 sudo -i # åˆ‡æ¢åˆ° root ç”¨æˆ· ç½‘ç»œè§„åˆ’ï¼šç¡®ä¿ IP åœ°å€ã€å­ç½‘æ©ç å’Œç½‘å…³åœ¨åŒä¸€ç½‘ç»œæ®µ\n1 2 # æ£€æŸ¥ IP å’Œç½‘å…³æ˜¯å¦åœ¨åŒä¸€å­ç½‘ ipcalc -n 192.168.1.100/24 # è®¡ç®—ç½‘ç»œåœ°å€ é˜²ç«å¢™é…ç½®ï¼šç¡®ä¿é˜²ç«å¢™ä¸ä¼šé˜»æ­¢ç½‘ç»œè¿æ¥\n1 2 3 4 # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ sudo ufw status # æˆ–è€…ä½¿ç”¨ iptables sudo iptables -L ğŸ”„ æ¢å¤ç½‘ç»œé…ç½® å¦‚æœç½‘ç»œé…ç½®å‡ºç°é—®é¢˜ï¼Œå¯ä»¥æ¢å¤é»˜è®¤è®¾ç½®ï¼š\næ¢å¤ DHCP è·å– IP 1 2 3 4 5 6 7 8 # å¤‡ä»½å½“å‰é…ç½® sudo cp /etc/network/interfaces /etc/network/interfaces.bak # æ¢å¤ DHCP é…ç½® echo -e \u0026#34;auto lo\\niface lo inet loopback\\n\\nauto eth0\\niface eth0 inet dhcp\u0026#34; | sudo tee /etc/network/interfaces # é‡å¯ç½‘ç»œæœåŠ¡ sudo systemctl restart networking ä»å¤‡ä»½æ¢å¤ 1 2 3 4 5 6 7 8 # æ¢å¤ interfaces é…ç½® sudo cp /etc/network/interfaces.backup /etc/network/interfaces # æ¢å¤ resolv.conf é…ç½® sudo cp /etc/resolv.conf.backup /etc/resolv.conf # é‡å¯ç½‘ç»œæœåŠ¡ sudo systemctl restart networking ä½¿ç”¨æ•‘æ´æ¨¡å¼ å¦‚æœç½‘ç»œé…ç½®é”™è¯¯å¯¼è‡´æ— æ³•è¿æ¥ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿®å¤ï¼š\nä½¿ç”¨ Live CD/USB å¯åŠ¨ç³»ç»Ÿ æŒ‚è½½åŸç³»ç»Ÿæ ¹åˆ†åŒº ä¿®å¤ç½‘ç»œé…ç½®æ–‡ä»¶ é‡å¯åˆ°åŸç³»ç»Ÿ ğŸ’¡ å®ç”¨è„šæœ¬ä¸æŠ€å·§ ç½‘å…³åˆ‡æ¢è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #!/bin/bash # switch-gateway.sh if [ $# -eq 0 ]; then echo \u0026#34;ç”¨æ³•: switch-gateway [252|243|253]\u0026#34; exit 1 fi case $1 in \u0026#34;252\u0026#34;) GATEWAY=\u0026#34;10.10.10.252\u0026#34; ;; \u0026#34;243\u0026#34;) GATEWAY=\u0026#34;10.10.10.243\u0026#34; ;; \u0026#34;253\u0026#34;) GATEWAY=\u0026#34;10.10.10.253\u0026#34; ;; *) echo \u0026#34;é”™è¯¯: æ— æ•ˆçš„ç½‘å…³é€‰æ‹©\u0026#34; exit 1 ;; esac sudo sed -i \u0026#34;s/gateway.*/gateway $GATEWAY/\u0026#34; /etc/network/interfaces sudo systemctl restart networking echo \u0026#34;âœ… å·²åˆ‡æ¢åˆ°ç½‘å…³: $GATEWAY\u0026#34; ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 3 chmod +x switch-gateway.sh # åˆ‡æ¢åˆ° 252 ç½‘å…³ ./switch-gateway.sh 252 ç½‘ç»œçŠ¶æ€æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/bash # network-status.sh echo -e \u0026#34;\\e[1;34m=== ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ===\\e[0m\u0026#34; echo \u0026#34;\u0026#34; # æ˜¾ç¤ºæ¥å£ä¿¡æ¯ echo -e \u0026#34;\\e[1;32mç½‘ç»œæ¥å£:\\e[0m\u0026#34; ip addr show | grep -E \u0026#34;^(.*: )|(inet )\u0026#34; # æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ echo -e \u0026#34;\\e[1;32mè·¯ç”±è¡¨:\\e[0m\u0026#34; ip route show # æ˜¾ç¤ºé»˜è®¤ç½‘å…³ echo -e \u0026#34;\\e[1;32mé»˜è®¤ç½‘å…³:\\e[0m\u0026#34; ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39; # æ˜¾ç¤ºDNSé…ç½® echo -e \u0026#34;\\e[1;32mDNS é…ç½®:\\e[0m\u0026#34; cat /etc/resolv.conf | grep -v \u0026#34;^#\u0026#34; # æµ‹è¯•è¿é€šæ€§ echo -e \u0026#34;\\e[1;32mç½‘ç»œè¿é€šæ€§:\\e[0m\u0026#34; ping -c 2 -W 1 8.8.8.8 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo \u0026#34;å¤–éƒ¨ç½‘ç»œ: å¯è¾¾\u0026#34; || echo \u0026#34;å¤–éƒ¨ç½‘ç»œ: ä¸å¯è¾¾\u0026#34; ping -c 2 -W 1 $(ip route show default | awk \u0026#39;/default/ {print $3}\u0026#39;) \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo \u0026#34;ç½‘å…³: å¯è¾¾\u0026#34; || echo \u0026#34;ç½‘å…³: ä¸å¯è¾¾\u0026#34; ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 chmod +x network-status.sh ./network-status.sh ä¸‹è½½é€Ÿåº¦æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 #!/bin/bash # speed-test.sh echo -e \u0026#34;\\e[1;34m=== ç½‘ç»œé€Ÿåº¦æµ‹è¯• ===\\e[0m\u0026#34; echo \u0026#34;\u0026#34; # æµ‹è¯•ä¸‹è½½é€Ÿåº¦ echo -e \u0026#34;\\e[1;32mä¸‹è½½é€Ÿåº¦æµ‹è¯•:\\e[0m\u0026#34; wget -O /dev/null http://speedtest.tele2.net/100MB.zip 2\u0026gt;\u0026amp;1 | grep -o \u0026#39;[0-9.]\\+ [KM]*B/s\u0026#39; # ä½¿ç”¨ curl æµ‹è¯•é€Ÿåº¦ echo -e \u0026#34;\\e[1;32mCURL é€Ÿåº¦æµ‹è¯•:\\e[0m\u0026#34; curl -o /dev/null -w \u0026#34;é€Ÿåº¦: %{speed_download} B/s\\n\u0026#34; http://speedtest.tele2.net/100MB.zip ä½¿ç”¨æ–¹æ³•ï¼š\n1 2 chmod +x speed-test.sh ./speed-test.sh ğŸ‰ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè½»æ¾åœ°åœ¨ Debian ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç†é™æ€ IPv4 ç½‘ç»œè®¾ç½®ã€‚Debian æä¾›äº†çµæ´»è€Œå¼ºå¤§çš„ç½‘ç»œç®¡ç†å·¥å…·ï¼Œæ— è®ºæ˜¯ä¼ ç»Ÿçš„ interfaces é…ç½®è¿˜æ˜¯ç°ä»£çš„ netplanï¼Œéƒ½èƒ½æ»¡è¶³å„ç§ç½‘ç»œé…ç½®éœ€æ±‚ã€‚\nå…³é”®è¦ç‚¹ï¼š\nğŸ›¡ï¸ å§‹ç»ˆå¤‡ä»½ç½‘ç»œé…ç½® before è¿›è¡Œæ›´æ”¹ ğŸ” ä½¿ç”¨æä¾›çš„è¯Šæ–­å·¥å…·éªŒè¯ç½‘ç»œçŠ¶æ€ âš¡ åˆ©ç”¨è„šæœ¬å®ç°å¿«é€Ÿç½‘å…³åˆ‡æ¢ ğŸ“ äº†è§£ Debian ç‰¹æœ‰çš„ç½‘ç»œæœåŠ¡ç®¡ç†æ–¹å¼ ğŸŒ æŒæ¡ DNS é…ç½®æ–¹æ³•ï¼ˆåŒ…æ‹¬ systemd-resolvedï¼‰ å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥ååŠ©ï¼Œè¯·å‚è€ƒ Debian å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚Happy networking! ğŸš€\n","date":"2024-12-07T15:28:09+08:00","image":"https://file.meimolihan.eu.org/img/debian-01.webp","permalink":"https://blog.meimolihan.eu.org/p/37331804/","title":"Debian é™æ€ IPv4 é…ç½®æŒ‡å— ğŸ“¡"},{"content":"CentOS å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸš€ âš¡ åŠ é€Ÿä½ çš„è½¯ä»¶åŒ…ä¸‹è½½ä½“éªŒï¼Œå‘Šåˆ«ç¼“æ…¢çš„å®˜æ–¹æºï¼\nğŸ“‹ ç›®å½• ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸ”§ æ›´æ¢é•œåƒæº ğŸ¯ é˜¿é‡Œäº‘é•œåƒç«™ ğŸ“ æ¸…åå¤§å­¦é•œåƒç«™ ğŸ§ è…¾è®¯äº‘é•œåƒç«™ ğŸŒº åä¸ºäº‘é•œåƒç«™ ğŸ”¬ ä¸­ç§‘å¤§é•œåƒç«™ ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤ ğŸ’¡ æ³¨æ„äº‹é¡¹ ğŸ¯ å¿«é€Ÿå¼€å§‹ ğŸ“ å¤‡ä»½åŸæœ‰é…ç½® 1 2 3 4 5 6 # å¤‡ä»½åŸæœ‰é…ç½®æ–‡ä»¶ cp /etc/yum.repos.d/centos.repo /etc/yum.repos.d/centos.repo.bak cp /etc/yum.repos.d/CentOS-Stream9.repo /etc/yum.repos.d/CentOS-Stream9.repo.bak # æŸ¥çœ‹ç°æœ‰é…ç½®æ–‡ä»¶ ls /etc/yum.repos.d/ ğŸ”§ æ›´æ¢é•œåƒæº ğŸ¯ é˜¿é‡Œäº‘é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 cat \u0026gt; /etc/yum.repos.d/centos.repo \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [baseos] name=CentOS Stream $releasever - BaseOS baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 [appstream] name=CentOS Stream $releasever - AppStream baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 EOF # ğŸ”„ æ›´æ–°ç¼“å­˜ yum clean all \u0026amp;\u0026amp; yum makecache \u0026amp;\u0026amp; dnf update ğŸ“ æ¸…åå¤§å­¦é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 cat \u0026gt; /etc/yum.repos.d/centos.repo \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [baseos] name=CentOS Stream $releasever - BaseOS baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-stream/9-stream/BaseOS/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 [appstream] name=CentOS Stream $releasever - AppStream baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-stream/9-stream/AppStream/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 EOF # ğŸ”„ æ›´æ–°ç¼“å­˜ yum clean all \u0026amp;\u0026amp; yum makecache \u0026amp;\u0026amp; dnf update ğŸ§ è…¾è®¯äº‘é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 cat \u0026gt; /etc/yum.repos.d/centos.repo \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [baseos] name=CentOS Stream $releasever - BaseOS baseurl=https://mirrors.tencent.com/centos-stream/9-stream/BaseOS/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 [appstream] name=CentOS Stream $releasever - AppStream baseurl=https://mirrors.tencent.com/centos-stream/9-stream/AppStream/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 EOF # ğŸ”„ æ›´æ–°ç¼“å­˜ yum clean all \u0026amp;\u0026amp; yum makecache \u0026amp;\u0026amp; dnf update ğŸŒº åä¸ºäº‘é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 cat \u0026gt; /etc/yum.repos.d/centos.repo \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [baseos] name=CentOS Stream $releasever - BaseOS baseurl=https://mirrors.huaweicloud.com/centos-stream/9-stream/BaseOS/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 [appstream] name=CentOS Stream $releasever - AppStream baseurl=https://mirrors.huaweicloud.com/centos-stream/9-stream/AppStream/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 EOF # ğŸ”„ æ›´æ–°ç¼“å­˜ yum clean all \u0026amp;\u0026amp; yum makecache \u0026amp;\u0026amp; dnf update ğŸ”¬ ä¸­ç§‘å¤§é•œåƒç«™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 cat \u0026gt; /etc/yum.repos.d/centos.repo \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [baseos] name=CentOS Stream $releasever - BaseOS baseurl=https://mirrors.ustc.edu.cn/centos-stream/9-stream/BaseOS/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 [appstream] name=CentOS Stream $releasever - AppStream baseurl=https://mirrors.ustc.edu.cn/centos-stream/9-stream/AppStream/x86_64/os/ gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 EOF # ğŸ”„ æ›´æ–°ç¼“å­˜ yum clean all \u0026amp;\u0026amp; yum makecache \u0026amp;\u0026amp; dnf update ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ğŸ“ ç¼–è¾‘é…ç½®æ–‡ä»¶ nano /etc/yum.repos.d/centos.repo nano /etc/yum.repos.d/CentOS-Stream9.repo # ğŸ‘€ æŸ¥çœ‹é…ç½®æ–‡ä»¶å†…å®¹ cat /etc/yum.repos.d/centos.repo # ğŸ”‘ æ£€æŸ¥GPGå¯†é’¥ cat /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial # ğŸ§¹ æ¸…ç†ç¼“å­˜å¹¶é‡æ–°å»ºç«‹ yum clean all yum makecache # ğŸ“Š æŸ¥çœ‹å·²é…ç½®çš„ä»“åº“ yum repolist all # ğŸ” æµ‹è¯•ä¸‹è½½é€Ÿåº¦ time yum install -y --downloadonly nano ğŸ’¡ æ³¨æ„äº‹é¡¹ ğŸ“¦ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šç¡®ä¿é€‰æ‹©çš„é•œåƒæºæ”¯æŒä½ çš„ CentOS ç‰ˆæœ¬ ğŸ” GPG å¯†é’¥ï¼šå¦‚æœé‡åˆ° GPG å¯†é’¥é”™è¯¯ï¼Œå¯ä¸´æ—¶ä½¿ç”¨ --nogpgcheck å‚æ•° ğŸŒ ç½‘ç»œæµ‹è¯•ï¼šå»ºè®®æµ‹è¯•ä¸åŒé•œåƒæºçš„ä¸‹è½½é€Ÿåº¦ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ âš¡ æ›´æ–°é¢‘ç‡ï¼šå›½å†…é•œåƒç«™é€šå¸¸æ¯4-6å°æ—¶ä¸å®˜æ–¹æºåŒæ­¥ä¸€æ¬¡ ğŸ”„ å®šæœŸæ›´æ–°ï¼šå»ºè®®å®šæœŸæ›´æ–°è½¯ä»¶åŒ…ä»¥è·å–å®‰å…¨è¡¥ä¸ 1 2 3 4 5 # ğŸš€ ä¸€é”®æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ… sudo dnf update -y # ğŸ”’ ä»…å®‰è£…å®‰å…¨æ›´æ–° sudo dnf update --security -y ğŸ¯ æç¤ºï¼šæ›´æ¢é•œåƒæºåï¼Œè½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦å°†æ˜¾è‘—æå‡ï¼å»ºè®®é€‰æ‹©è·ç¦»ä½ åœ°ç†ä½ç½®æœ€è¿‘çš„é•œåƒç«™ä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚\n","date":"2024-12-07T15:26:51+08:00","image":"https://file.meimolihan.eu.org/img/centos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1dae936f/","title":"CentOS å›½å†…é•œåƒæºé…ç½®æŒ‡å— ğŸš€"},{"content":"Windows åˆå§‹å®‰è£…é…ç½®æŒ‡å— ğŸ› ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª âœ¨ æ ¸å¿ƒé…ç½®åŠŸèƒ½ ğŸ”‘ ä¸€ã€Windowsç³»ç»Ÿæ¿€æ´» ğŸŒ äºŒã€è¿œç¨‹æ¡Œé¢è®¾ç½® âš™ï¸ ä¸‰ã€ç³»ç»Ÿç•Œé¢ä¼˜åŒ– ğŸ”§ å››ã€å®ç”¨å·¥å…·æ¨è âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ âœ¨ æ ¸å¿ƒé…ç½®åŠŸèƒ½ ğŸ”‘ ç³»ç»Ÿæ¿€æ´»ï¼šå¿«é€Ÿæ¿€æ´»Windowsç³»ç»Ÿï¼Œç¡®ä¿æ­£ç‰ˆæˆæƒ ğŸŒ è¿œç¨‹è®¿é—®ï¼šå¼€å¯è¿œç¨‹æ¡Œé¢åŠŸèƒ½ï¼Œå®ç°è¿œç¨‹ç®¡ç† âš™ï¸ ç³»ç»Ÿä¼˜åŒ–ï¼šè°ƒæ•´ç³»ç»Ÿè®¾ç½®ï¼Œæå‡ä½¿ç”¨ä½“éªŒ ğŸ“‹ å¿«æ·æ“ä½œï¼šæ‰¹å¤„ç†å‘½ä»¤ç®€åŒ–å¤æ‚é…ç½®æµç¨‹ ğŸ”’ å®‰å…¨è®¾ç½®ï¼šè°ƒæ•´è´¦æˆ·ç­–ç•¥ï¼Œå¢å¼ºç³»ç»Ÿå®‰å…¨æ€§ ğŸ”‘ ä¸€ã€Windowsç³»ç»Ÿæ¿€æ´» 1. ğŸ¯ ä½¿ç”¨KMSæ¿€æ´»Windowsç³»ç»Ÿ 1 2 3 4 5 6 7 8 # ç¬¬ä¸€æ­¥ï¼šå®‰è£…äº§å“å¯†é’¥ slmgr /ipk W269N-WFGWX-YVC9B-4J6C9-T83GX # ç¬¬äºŒæ­¥ï¼šè®¾ç½®KMSæœåŠ¡å™¨åœ°å€ slmgr /skms kms8.msguides.com # ç¬¬ä¸‰æ­¥ï¼šæ¿€æ´»Windows slmgr /ato ğŸ’¡ æç¤ºï¼šæ¿€æ´»è¿‡ç¨‹å¯èƒ½éœ€è¦é‡å¤æ‰§è¡Œå‡ æ¬¡ï¼Œç›´åˆ°æ˜¾ç¤º\u0026quot;æˆåŠŸæ¿€æ´»äº§å“\u0026quot;çš„æ¶ˆæ¯ã€‚\n2. ğŸ” éªŒè¯æ¿€æ´»çŠ¶æ€ 1 2 3 4 5 # æŸ¥çœ‹æ¿€æ´»çŠ¶æ€ slmgr /xpr # æ˜¾ç¤ºè¯¦ç»†æ¿€æ´»ä¿¡æ¯ slmgr /dlv 3. ğŸ“ å¤‡ç”¨æ¿€æ´»æ–¹æ³• å¦‚æœä¸Šè¿°æ–¹æ³•å¤±æ•ˆï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š\n1 2 3 4 # å¤‡ç”¨KMSæœåŠ¡å™¨ slmgr /skms kms03.kms.ren slmgr /skms kms.digiboy.ir slmgr /skms kms.lotro.cc ğŸŒ äºŒã€è¿œç¨‹æ¡Œé¢è®¾ç½® 1. ğŸš€ å¿«é€Ÿå¼€å¯è¿œç¨‹æ¡Œé¢ åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶ å¼€å¯è¿œç¨‹æ¡Œé¢.batï¼š\n1 2 3 4 5 6 @echo off echo æ­£åœ¨å¼€å¯è¿œç¨‹æ¡Œé¢åŠŸèƒ½... reg add \u0026#34;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\u0026#34; /v fDenyTSConnections /t REG_DWORD /d 0 /f reg add \u0026#34;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\u0026#34; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f echo è¿œç¨‹æ¡Œé¢å·²å¼€å¯ï¼ pause 2. âš™ï¸ å›¾å½¢ç•Œé¢è®¾ç½®æ–¹å¼ åˆ›å»º è¿œç¨‹æ¡Œé¢è®¾ç½®.batï¼š\n1 2 3 @echo off start ms-settings:remotedesktop exit 3. ğŸ”’ è´¦æˆ·å®‰å…¨è®¾ç½® åˆ›å»º è´¦æˆ·ç­–ç•¥è®¾ç½®.batï¼š\n1 2 3 4 @echo off echo æ­£åœ¨æ‰“å¼€æœ¬åœ°å®‰å…¨ç­–ç•¥... start secpol.msc exit é…ç½®æ­¥éª¤ï¼š\næ‰“å¼€\u0026quot;æœ¬åœ°å®‰å…¨ç­–ç•¥\u0026quot; å¯¼èˆªè‡³ï¼šè´¦æˆ·ç­–ç•¥ â†’ è´¦æˆ·é”å®šç­–ç•¥ å³é”®ç‚¹å‡»\u0026quot;è´¦æˆ·é”å®šé˜ˆå€¼\u0026quot; â†’ å±æ€§ å°†å€¼æ”¹ä¸º 0ï¼ˆè¡¨ç¤ºè´¦æˆ·æ°¸ä¸é”å®šï¼‰ 4. ğŸŒ é˜²ç«å¢™é…ç½® ç¡®ä¿è¿œç¨‹æ¡Œé¢ç«¯å£ï¼ˆé»˜è®¤3389ï¼‰åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾ï¼š\n1 2 # å¼€æ”¾è¿œç¨‹æ¡Œé¢ç«¯å£ netsh advfirewall firewall add rule name=\u0026#34;Remote Desktop\u0026#34; dir=in action=allow protocol=TCP localport=3389 âš™ï¸ ä¸‰ã€ç³»ç»Ÿç•Œé¢ä¼˜åŒ– 1. ğŸ”„ åˆ‡æ¢Windowså³é”®èœå•æ ·å¼ åˆ›å»º åˆ‡æ¢å³é”®èœå•.batï¼ˆç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰ï¼š\n1 2 3 4 5 6 7 @echo off echo æ­£åœ¨æ¢å¤ç»å…¸å³é”®èœå•... reg add \u0026#34;HKCU\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\\InprocServer32\u0026#34; /f /ve taskkill /f /im explorer.exe start explorer.exe echo å³é”®èœå•å·²åˆ‡æ¢å®Œæˆï¼ pause 2. ğŸ¨ æ€§èƒ½ä¼˜åŒ–è®¾ç½® 1 2 3 4 # å…³é—­ä¸å¿…è¦çš„è§†è§‰æ•ˆæœ @echo off sysdm.cpl exit ç„¶åé€‰æ‹©\u0026quot;é«˜çº§\u0026quot; â†’ æ€§èƒ½è®¾ç½® â†’ è°ƒæ•´ä¸ºæœ€ä½³æ€§èƒ½\n3. âš¡ ç”µæºè®¡åˆ’ä¼˜åŒ– 1 2 # è®¾ç½®ä¸ºé«˜æ€§èƒ½æ¨¡å¼ powercfg -duplicatescheme 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c ğŸ”§ å››ã€å®ç”¨å·¥å…·æ¨è 1. ğŸ› ï¸ ç³»ç»Ÿç»´æŠ¤å·¥å…· 1 2 3 4 5 6 7 8 # ç£ç›˜æ¸…ç† cleanmgr # ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥ sfc /scannow # ç£ç›˜æ£€æŸ¥ chkdsk /f 2. ğŸ“Š ç³»ç»Ÿä¿¡æ¯æŸ¥çœ‹ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ systeminfo # æŸ¥çœ‹ç¡¬ä»¶ä¿¡æ¯ dxdiag # æŸ¥çœ‹ç½‘ç»œé…ç½® ipconfig /all 3. ğŸ–¥ï¸ å¿…å¤‡è½¯ä»¶æ¨è 7-Zipï¼šæ–‡ä»¶å‹ç¼©è§£å‹ Chrome/Firefoxï¼šç½‘é¡µæµè§ˆå™¨ VLCï¼šåª’ä½“æ’­æ”¾å™¨ Notepad++ï¼šæ–‡æœ¬ç¼–è¾‘å™¨ WinRARï¼šå‹ç¼©å·¥å…· âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ 1. ğŸ”’ å®‰å…¨å»ºè®® æ¿€æ´»åå»ºè®®æ›´æ”¹KMSè®¾ç½®ï¼Œä½¿ç”¨æ­£ç‰ˆæˆæƒ å¼€å¯è¿œç¨‹æ¡Œé¢æ—¶ç¡®ä¿ä½¿ç”¨å¼ºå¯†ç  å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸ å®‰è£…é˜²ç—…æ¯’è½¯ä»¶ 2. âš ï¸ é£é™©æç¤º KMSæ¿€æ´»å¯èƒ½è¿åå¾®è½¯è®¸å¯æ¡æ¬¾ å¼€æ”¾è¿œç¨‹æ¡Œé¢ç«¯å£å¯èƒ½å¢åŠ å®‰å…¨é£é™© ä¿®æ”¹ç³»ç»Ÿè®¾ç½®å‰å»ºè®®åˆ›å»ºè¿˜åŸç‚¹ 3. ğŸ’¾ å¤‡ä»½é‡è¦æ•°æ® 1 2 # åˆ›å»ºç³»ç»Ÿè¿˜åŸç‚¹ wmic.exe /Namespace:\\\\root\\default Path SystemRestore Call CreateRestorePoint \u0026#34;Before Configuration\u0026#34;, 100, 7 4. ğŸ†˜ æ•…éšœæ’é™¤ å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å°è¯•ï¼š\n1 2 3 4 5 6 7 8 # é‡ç½®ç½‘ç»œè®¾ç½® netsh winsock reset # é‡ç½®Windowsæ›´æ–°ç»„ä»¶ net stop wuauserv net stop cryptSvc net stop bits net stop msiserver ğŸ¯ é…ç½®å®Œæˆæ£€æŸ¥æ¸…å• Windowsç³»ç»Ÿå·²æˆåŠŸæ¿€æ´» è¿œç¨‹æ¡Œé¢åŠŸèƒ½å·²å¼€å¯ è´¦æˆ·é”å®šç­–ç•¥å·²é…ç½® å³é”®èœå•æ ·å¼å·²è°ƒæ•´ ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–å·²å®Œæˆ å¿…è¦è½¯ä»¶å·²å®‰è£… ç³»ç»Ÿå¤‡ä»½å·²åˆ›å»º ğŸ’¡ æç¤ºï¼šå®Œæˆæ‰€æœ‰é…ç½®åï¼Œå»ºè®®é‡å¯è®¡ç®—æœºä»¥ç¡®ä¿æ‰€æœ‰è®¾ç½®ç”Ÿæ•ˆã€‚\né€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨çš„Windowsç³»ç»Ÿå°†å®Œæˆåˆå§‹é…ç½®ï¼Œå…·å¤‡åŸºæœ¬çš„ä½¿ç”¨åŠŸèƒ½å’Œä¼˜åŒ–è®¾ç½®ï¼è®°å¾—å®šæœŸç»´æŠ¤å’Œæ›´æ–°ç³»ç»Ÿä»¥ä¿æŒæœ€ä½³æ€§èƒ½ã€‚ ğŸš€\n","date":"2024-12-07T15:23:58+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/4b4d2b2b/","title":"Windows åˆå§‹å®‰è£…é…ç½®æŒ‡å— ğŸ› ï¸"},{"content":"Typecho éŸ³ä¹æ’­æ”¾å™¨ QPlayer2 ğŸµ ä¸€æ¬¾ç®€æ´å°å·§çš„ HTML5 åº•éƒ¨æ‚¬æµ®éŸ³ä¹æ’­æ”¾å™¨ï¼Œä¸ºæ‚¨çš„ Typecho åšå®¢å¢æ·»éŸ³ä¹é­…åŠ›\nâœ¨ åŠŸèƒ½ç‰¹ç‚¹\nÂ· ğŸ¶ ç®€æ´ç¾è§‚çš„åº•éƒ¨æ‚¬æµ®è®¾è®¡ Â· ğŸ“± å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒç§»åŠ¨ç«¯ Â· ğŸ¨ æ”¯æŒæ­Œè¯æ˜¾ç¤ºå’Œæ­Œæ›²å°é¢ Â· âš¡ åŸºäº HTML5 Audio APIï¼Œæ— éœ€ Flash Â· ğŸ”§ ç®€å•æ˜“ç”¨çš„ JSON é…ç½®æ–¹å¼\nğŸ“¦ å®‰è£…æ­¥éª¤\nä¸‹è½½æ’ä»¶ æœ€æ–°ç‰ˆæœ¬ ä¸‹è½½ ) æˆ–ä½¿ç”¨ git å…‹éš†ï¼š\n1 git clone https://github.com/moeshin/QPlayer2-Typecho.git å®‰è£…åˆ° Typecho\nå°†æ–‡ä»¶å¤¹é‡å‘½åä¸º QPlayer2\nä¸Šä¼ åˆ° Typecho çš„æ’ä»¶ç›®å½•ï¼šusr/plugins/\nç™»å½• Typecho åå°ï¼Œè¿›å…¥\u0026quot;æ§åˆ¶å°\u0026quot; â†’ \u0026ldquo;æ’ä»¶\u0026rdquo;\næ‰¾åˆ° QPlayer2 å¹¶ç‚¹å‡»\u0026quot;å¯ç”¨\u0026quot;\né…ç½®æ’­æ”¾åˆ—è¡¨\nåœ¨æ’ä»¶è®¾ç½®é¡µé¢æ‰“å¼€ QPlayer2 é…ç½®\nåœ¨\u0026quot;æ’­æ”¾åˆ—è¡¨\u0026quot;ä¸­æ·»åŠ  JSON æ ¼å¼çš„æ­Œæ›²æ•°æ®\nä¿å­˜è®¾ç½®\nğŸ¼ æ­Œæ›²åˆ—è¡¨é…ç½®\nJSON æ•°æ®ç»“æ„\nå­—æ®µ è¯´æ˜ æ˜¯å¦å¿…é¡» ç¤ºä¾‹ name æ­Œæ›²åç§° âœ… \u0026ldquo;æ˜Ÿæ²³ä¸‡é‡Œ\u0026rdquo; artist æ­Œæ‰‹åç§° âŒ \u0026ldquo;Romé‚¢é”\u0026rdquo; audio éŸ³é¢‘æ–‡ä»¶é“¾æ¥ âœ… \u0026ldquo; https://example.com/song.mp3\" cover å°é¢å›¾ç‰‡é“¾æ¥ âŒ \u0026ldquo; https://example.com/cover.jpg\" lrc æ­Œè¯æ–‡ä»¶é“¾æ¥ âŒ \u0026ldquo; https://example.com/lyrics.lrc\" å®Œæ•´é…ç½®ç¤ºä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [ { \u0026#34;name\u0026#34;: \u0026#34;æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;å¼ è‰¯\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹-å¼ è‰¯.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹-å¼ è‰¯.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹-å¼ è‰¯.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;æ˜Ÿæ²³ä¸‡é‡Œ\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;Romé‚¢é”\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æ˜Ÿæ²³ä¸‡é‡Œ-Romé‚¢é”.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æ˜Ÿæ²³ä¸‡é‡Œ-Romé‚¢é”.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æ˜Ÿæ²³ä¸‡é‡Œ-Romé‚¢é”.lrc\u0026#34; }, // æ›´å¤šæ­Œæ›²... ] ğŸµ æ¨èæ­Œæ›²åˆ—è¡¨\nä»¥ä¸‹æ˜¯ç²¾å¿ƒæŒ‘é€‰çš„æ­Œæ›²æ¨èåˆ—è¡¨ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 [ { \u0026#34;name\u0026#34;: \u0026#34;æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;å¼ è‰¯\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹-å¼ è‰¯.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹-å¼ è‰¯.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æˆ‘çœŸæ€•è‡ªå·±å“ªå¤©å€’ä¸‹-å¼ è‰¯.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;æ˜Ÿæ²³ä¸‡é‡Œ\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;Romé‚¢é”\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æ˜Ÿæ²³ä¸‡é‡Œ-Romé‚¢é”.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æ˜Ÿæ²³ä¸‡é‡Œ-Romé‚¢é”.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/æ˜Ÿæ²³ä¸‡é‡Œ-Romé‚¢é”.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;ä¼¤å¿ƒå¤ªå¹³æ´‹\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;ä»»è´¤é½\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/ä¼¤å¿ƒå¤ªå¹³æ´‹-ä»»è´¤é½.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/ä¼¤å¿ƒå¤ªå¹³æ´‹-ä»»è´¤é½.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/ä¼¤å¿ƒå¤ªå¹³æ´‹-ä»»è´¤é½.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;èƒ¡å¹¿ç”Ÿ\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;ä»»ç´ æ±\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/èƒ¡å¹¿ç”Ÿ-ä»»ç´ æ±.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/èƒ¡å¹¿ç”Ÿ-ä»»ç´ æ±.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/èƒ¡å¹¿ç”Ÿ-ä»»ç´ æ±.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;å¯èƒ½\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;ç¨‹å“\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/å¯èƒ½-ç¨‹å“.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/å¯èƒ½-ç¨‹å“.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/å¯èƒ½-ç¨‹å“.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;ä¸‡æœ‰å¼•åŠ›\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;æ±ªè‹æ³·\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/ä¸‡æœ‰å¼•åŠ›-æ±ªè‹æ³·.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/ä¸‡æœ‰å¼•åŠ›-æ±ªè‹æ³·.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/ä¸‡æœ‰å¼•åŠ›-æ±ªè‹æ³·.lrc\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;äººé—´çƒŸç«\u0026#34;, \u0026#34;artist\u0026#34;: \u0026#34;ç¨‹å“\u0026#34;, \u0026#34;audio\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/äººé—´çƒŸç«-ç¨‹å“.mp3\u0026#34;, \u0026#34;cover\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/äººé—´çƒŸç«-ç¨‹å“.jpg\u0026#34;, \u0026#34;lrc\u0026#34;: \u0026#34;https://file.mobufan.eu.org:666/music/äººé—´çƒŸç«-ç¨‹å“.lrc\u0026#34; } ] âš™ï¸ è‡ªå®šä¹‰é…ç½®\næ’­æ”¾å™¨è®¾ç½®é€‰é¡¹\nÂ· è‡ªåŠ¨æ’­æ”¾: è®¾ç½®æ˜¯å¦åŠ è½½åè‡ªåŠ¨æ’­æ”¾ Â· å¾ªç¯æ¨¡å¼: å•æ›²å¾ªç¯/åˆ—è¡¨å¾ªç¯/éšæœºæ’­æ”¾ Â· éŸ³é‡æ§åˆ¶: é»˜è®¤éŸ³é‡è®¾ç½® Â· æ­Œè¯æ˜¾ç¤º: æ˜¯å¦å¯ç”¨æ­Œè¯åŠŸèƒ½ Â· è¿›åº¦æ¡: æ˜¾ç¤ºæ’­æ”¾è¿›åº¦æ¡\næ ·å¼è‡ªå®šä¹‰\nå¯ä»¥é€šè¿‡ CSS è‡ªå®šä¹‰æ’­æ”¾å™¨æ ·å¼ï¼š\n1 2 3 4 5 6 7 8 9 .qplayer-container { /* è‡ªå®šä¹‰æ’­æ”¾å™¨å®¹å™¨æ ·å¼ */ background-color: rgba(0, 0, 0, 0.8); } .qplayer-controls { /* è‡ªå®šä¹‰æ§åˆ¶æŒ‰é’®æ ·å¼ */ color: #ffffff; } ğŸ”§ å¸¸è§é—®é¢˜è§£ç­”\nâ“ æ’­æ”¾å™¨ä¸æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ\næ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å¯ç”¨ ç¡®è®¤æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ æ£€æŸ¥æ­Œæ›²é“¾æ¥æ˜¯å¦å¯è®¿é—® â“ æ­Œè¯ä¸æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ\nç¡®è®¤æ­Œè¯æ–‡ä»¶é“¾æ¥æ­£ç¡® æ£€æŸ¥æ­Œè¯æ–‡ä»¶æ ¼å¼æ˜¯å¦ä¸º LRC æ ‡å‡†æ ¼å¼ ç¡®ä¿æ­Œè¯æ–‡ä»¶ç¼–ç ä¸º UTF-8 â“ ç§»åŠ¨ç«¯æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ\næ£€æŸ¥å“åº”å¼å¸ƒå±€æ˜¯å¦æ­£å¸¸å·¥ä½œ ç¡®è®¤è§¦æ‘¸äº‹ä»¶å¤„ç†æ˜¯å¦æ­£å¸¸ â“ å¦‚ä½•æ·»åŠ æ–°æ­Œæ›²ï¼Ÿ\nåœ¨æ’­æ”¾åˆ—è¡¨ JSON ä¸­æ·»åŠ æ–°çš„æ­Œæ›²å¯¹è±¡ ç¡®ä¿éŸ³é¢‘æ–‡ä»¶å¯å…¬å¼€è®¿é—® ä¿å­˜è®¾ç½®å¹¶åˆ·æ–°é¡µé¢ ğŸ“± ç§»åŠ¨ç«¯é€‚é…\nQPlayer2 å·²é’ˆå¯¹ç§»åŠ¨è®¾å¤‡è¿›è¡Œä¼˜åŒ–ï¼š\nÂ· âœ… è§¦æ‘¸å‹å¥½çš„æ§åˆ¶ç•Œé¢ Â· âœ… æ»‘åŠ¨è°ƒèŠ‚è¿›åº¦å’ŒéŸ³é‡ Â· âœ… è‡ªé€‚åº”å±å¹•å°ºå¯¸ Â· âœ… çœç”µæ¨¡å¼ä¼˜åŒ–\nğŸŒŸ ä½¿ç”¨æŠ€å·§\næ‰¹é‡æ·»åŠ æ­Œæ›²: ä½¿ç”¨æ•°ç»„æ ¼å¼ä¸€æ¬¡æ€§æ·»åŠ å¤šé¦–æ­Œæ›² æœ¬åœ°æµ‹è¯•: å¯ä»¥å…ˆä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ CDN åŠ é€Ÿ: å»ºè®®å°†éŸ³é¢‘æ–‡ä»¶æ”¾åœ¨ CDN ä¸Šæé«˜åŠ è½½é€Ÿåº¦ å®šæœŸæ›´æ–°: å®šæœŸæ£€æŸ¥æ­Œæ›²é“¾æ¥æœ‰æ•ˆæ€§ï¼Œæ›´æ–°å¤±æ•ˆé“¾æ¥ ğŸ†˜ è·å–å¸®åŠ©\nÂ· ğŸ“– å®˜æ–¹æ–‡æ¡£ Â· ğŸ› æäº¤é—®é¢˜ Â· ğŸ’¬ ç¤¾åŒºè®¨è®º\nğŸ’¡ æç¤ºï¼šä½¿ç”¨å‰è¯·ç¡®ä¿æ‚¨æœ‰æƒä½¿ç”¨ç›¸å…³éŸ³ä¹èµ„æºï¼Œå°Šé‡ç‰ˆæƒå“¦ï¼\nå¸Œæœ› QPlayer2 èƒ½ä¸ºæ‚¨çš„ Typecho åšå®¢å¢æ·»æ›´å¤šéŸ³ä¹é­…åŠ›ï¼ğŸµ\n","date":"2024-12-07T15:20:42+08:00","image":"https://file.meimolihan.eu.org/img/qblayer2-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c3bed4e4/","title":"Typecho éŸ³ä¹æ’­æ”¾å™¨ QPlayer2 ğŸµ"},{"content":"Markdown è¡¨æ ¼è¯­æ³•å¤§å…¨ ğŸ“Š ğŸ“‹ å¯¼èˆªç›®å½• ğŸ“– ç®€ä»‹ ğŸ¯ åŸºç¡€è¡¨æ ¼è¯­æ³• ğŸ”¸ å†…å®¹å±…ä¸­å¯¹é½ ğŸ”¸ å†…å®¹å·¦å¯¹é½ ğŸ”¸ å†…å®¹å³å¯¹é½ ğŸ“‹ å¯¹é½æ–¹å¼æ€»ç»“ ğŸš€ é«˜çº§è¡¨æ ¼åŠŸèƒ½ ğŸ”¸ æ··åˆå¯¹é½æ–¹å¼ ğŸ”¸ è¡¨æ ¼å†…ä½¿ç”¨æ ¼å¼ ğŸ”¸ å¤æ‚è¡¨æ ¼ç¤ºä¾‹ ğŸ’¡ å®ç”¨æŠ€å·§ ğŸ”¸ è¡¨æ ¼å†…æ¢è¡Œ ğŸ”¸ ä½¿ç”¨ HTML å¢å¼ºè¡¨æ ¼ ğŸ”¸ è¡¨æ ¼æ’åºæç¤º âš ï¸ å…¼å®¹æ€§è¯´æ˜ ğŸ”¸ æ”¯æŒçš„å¹³å° ğŸ”¸ ä¸æ”¯æŒçš„å¹³å° ğŸ“‹ æœ€ä½³å®è·µ ğŸ”¸ ä¿æŒè¡¨æ ¼ç®€æ´ ğŸ”¸ ä½¿ç”¨ä¸€è‡´çš„æ ¼å¼ ğŸ”¸ æ·»åŠ è¡¨æ ¼æ ‡é¢˜å’Œè¯´æ˜ ğŸ› ï¸ å·¥å…·æ¨è â“ å¸¸è§é—®é¢˜è§£ç­” ğŸ”¸ Q1: è¡¨æ ¼ä¸­çš„ç«–çº¿å¦‚ä½•è½¬ä¹‰ï¼Ÿ ğŸ”¸ Q2: å¦‚ä½•åˆ›å»ºè·¨åˆ—å•å…ƒæ ¼ï¼Ÿ ğŸ”¸ Q3: è¡¨æ ¼å¤ªå®½æ€ä¹ˆåŠï¼Ÿ ğŸ“– ç®€ä»‹ è¡¨æ ¼æ˜¯ Markdown ä¸­éå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®©æ•°æ®ä»¥ç»“æ„åŒ–çš„æ–¹å¼æ¸…æ™°å‘ˆç°ã€‚âœ¨ æ— è®ºæ˜¯æŠ€æœ¯æ–‡æ¡£ã€é¡¹ç›®æŠ¥å‘Šè¿˜æ˜¯æ•°æ®å±•ç¤ºï¼Œè¡¨æ ¼éƒ½èƒ½å¸®åŠ©æ‚¨é«˜æ•ˆç»„ç»‡ä¿¡æ¯ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç» Markdown è¡¨æ ¼çš„å„ç§è¯­æ³•å’Œé«˜çº§ç”¨æ³•ï¼Œè®©æ‚¨è½»æ¾åˆ›å»ºä¸“ä¸šçº§è¡¨æ ¼ï¼\nğŸ“Œ Markdown è¡¨æ ¼æ ¸å¿ƒä¼˜åŠ¿ï¼š\nç®€æ´è¯­æ³•ï¼šåªéœ€å°‘é‡ç¬¦å·å³å¯åˆ›å»ºç»“æ„åŒ–è¡¨æ ¼ è·¨å¹³å°å…¼å®¹ï¼šåœ¨å¤§å¤šæ•° Markdown è§£æå™¨ä¸­éƒ½èƒ½è‰¯å¥½æ˜¾ç¤º çµæ´»å¯¹é½ï¼šæ”¯æŒå·¦å¯¹é½ã€å³å¯¹é½å’Œå±…ä¸­å¯¹é½å¤šç§æ–¹å¼ æ ¼å¼ä¸°å¯Œï¼šå¯åœ¨è¡¨æ ¼ä¸­ä½¿ç”¨ç²—ä½“ã€æ–œä½“ã€ä»£ç ç­‰å¤šç§æ ¼å¼ ğŸ¯ åŸºç¡€è¡¨æ ¼è¯­æ³• ğŸ”¸ å†…å®¹å±…ä¸­å¯¹é½ 1 2 3 4 | å¹´é¾„ | ç­çº§ | åå­— | |:----:|:----:|:----:| | 18 | äºŒç­ | å°å‡¡å‡¡ | | 18 | ä¸‰ç­ | æ¶µæ¶µ | æ•ˆæœå±•ç¤ºï¼š\nå¹´é¾„ ç­çº§ åå­— 18 äºŒç­ å°å‡¡å‡¡ 18 ä¸‰ç­ æ¶µæ¶µ ğŸ”¸ å†…å®¹å·¦å¯¹é½ 1 2 3 4 | å¹´é¾„ | ç­çº§ | åå­— | |:-----|:-----|:-----| | 18 | äºŒç­ | å°å‡¡å‡¡ | | 18 | ä¸‰ç­ | æ¶µæ¶µ | æ•ˆæœå±•ç¤ºï¼š\nå¹´é¾„ ç­çº§ åå­— 18 äºŒç­ å°å‡¡å‡¡ 18 ä¸‰ç­ æ¶µæ¶µ ğŸ”¸ å†…å®¹å³å¯¹é½ 1 2 3 4 | å¹´é¾„ | ç­çº§ | åå­— | |-----:|-----:|-----:| | 18 | äºŒç­ | å°å‡¡å‡¡ | | 18 | ä¸‰ç­ | æ¶µæ¶µ | æ•ˆæœå±•ç¤ºï¼š\nå¹´é¾„ ç­çº§ åå­— 18 äºŒç­ å°å‡¡å‡¡ 18 ä¸‰ç­ æ¶µæ¶µ ğŸ“‹ å¯¹é½æ–¹å¼æ€»ç»“ è¯­æ³• å¯¹é½æ–¹å¼ ç¤ºä¾‹ :---: å±…ä¸­å¯¹é½ å†…å®¹ :--- å·¦å¯¹é½ å·¦å¯¹é½å†…å®¹ ---: å³å¯¹é½ å³å¯¹é½å†…å®¹ --- é»˜è®¤å¯¹é½ï¼ˆé€šå¸¸å·¦å¯¹é½ï¼‰ é»˜è®¤å†…å®¹ ğŸš€ é«˜çº§è¡¨æ ¼åŠŸèƒ½ ğŸ”¸ æ··åˆå¯¹é½æ–¹å¼ 1 2 3 4 5 | é¡¹ç›® | æ•°é‡ | ä»·æ ¼ | è¯´æ˜ | |:-----|-----:|:----:|------| | è‹¹æœ | 5 | 20 | æ–°é²œæ°´æœ | | é¦™è•‰ | 3 | 15 | è¿›å£é¦™è•‰ | | æ©™å­ | 8 | 32 | å½“å­£é²œæ©™ | æ•ˆæœå±•ç¤ºï¼š\né¡¹ç›® æ•°é‡ ä»·æ ¼ è¯´æ˜ è‹¹æœ 5 20 æ–°é²œæ°´æœ é¦™è•‰ 3 15 è¿›å£é¦™è•‰ æ©™å­ 8 32 å½“å­£é²œæ©™ ğŸ’¡ æŠ€å·§ï¼šæ··åˆä½¿ç”¨å¯¹é½æ–¹å¼å¯ä»¥è®©è¡¨æ ¼æ›´åŠ ä¸“ä¸šï¼Œæ•°å­—é€šå¸¸å³å¯¹é½ï¼Œæ–‡æœ¬å·¦å¯¹é½ï¼Œæ ‡é¢˜å±…ä¸­å¯¹é½ã€‚\nğŸ”¸ è¡¨æ ¼å†…ä½¿ç”¨æ ¼å¼ 1 2 3 4 5 6 | åŠŸèƒ½ | è¯­æ³• | ç¤ºä¾‹ | |------|------|------| | **ç²—ä½“** | `**æ–‡æœ¬**` | **é‡è¦** | | *æ–œä½“* | `*æ–‡æœ¬*` | *å¼ºè°ƒ* | | `ä»£ç ` | `` `ä»£ç ` `` | `console.log()` | | [é“¾æ¥](https://example.com) | `[æ–‡æœ¬](é“¾æ¥)` | [è®¿é—®ç½‘ç«™](https://example.com) | æ•ˆæœå±•ç¤ºï¼š\nåŠŸèƒ½ è¯­æ³• ç¤ºä¾‹ ç²—ä½“ **æ–‡æœ¬** é‡è¦ æ–œä½“ *æ–‡æœ¬* å¼ºè°ƒ ä»£ç  `ä»£ç ` console.log() é“¾æ¥ [æ–‡æœ¬](é“¾æ¥) è®¿é—®ç½‘ç«™ ğŸ”¸ å¤æ‚è¡¨æ ¼ç¤ºä¾‹ 1 2 3 4 5 6 | éƒ¨é—¨ | å‘˜å·¥ | é¡¹ç›® | è¿›åº¦ | |------|------|------|------| | æŠ€æœ¯éƒ¨ | å¼ ä¸‰ | ç½‘ç«™é‡æ„ | âœ… å®Œæˆ | | æŠ€æœ¯éƒ¨ | æå›› | APIå¼€å‘ | ğŸŸ¡ è¿›è¡Œä¸­ | | è®¾è®¡éƒ¨ | ç‹äº” | UIè®¾è®¡ | ğŸ”´ å»¶æœŸ | | å¸‚åœºéƒ¨ | èµµå…­ | æ¨å¹¿æ´»åŠ¨ | âœ… å®Œæˆ | æ•ˆæœå±•ç¤ºï¼š\néƒ¨é—¨ å‘˜å·¥ é¡¹ç›® è¿›åº¦ æŠ€æœ¯éƒ¨ å¼ ä¸‰ ç½‘ç«™é‡æ„ âœ… å®Œæˆ æŠ€æœ¯éƒ¨ æå›› APIå¼€å‘ ğŸŸ¡ è¿›è¡Œä¸­ è®¾è®¡éƒ¨ ç‹äº” UIè®¾è®¡ ğŸ”´ å»¶æœŸ å¸‚åœºéƒ¨ èµµå…­ æ¨å¹¿æ´»åŠ¨ âœ… å®Œæˆ ğŸ¨ é«˜çº§åº”ç”¨ï¼šä½¿ç”¨è¡¨æƒ…ç¬¦å·å¯ä»¥ç›´è§‚åœ°è¡¨ç¤ºçŠ¶æ€ï¼Œæé«˜è¡¨æ ¼çš„å¯è¯»æ€§ã€‚\nğŸ’¡ å®ç”¨æŠ€å·§ ğŸ”¸ è¡¨æ ¼å†…æ¢è¡Œ 1 2 3 4 | åŠŸèƒ½ | æè¿° | |------|------| | å¤šè¡Œæ–‡æœ¬ | ç¬¬ä¸€è¡Œ\u0026lt;br\u0026gt;ç¬¬äºŒè¡Œ\u0026lt;br\u0026gt;ç¬¬ä¸‰è¡Œ | | åˆ—è¡¨ | - é¡¹ç›®ä¸€\u0026lt;br\u0026gt;- é¡¹ç›®äºŒ\u0026lt;br\u0026gt;- é¡¹ç›®ä¸‰ | æ•ˆæœå±•ç¤ºï¼š\nåŠŸèƒ½ æè¿° å¤šè¡Œæ–‡æœ¬ ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ\nç¬¬ä¸‰è¡Œ åˆ—è¡¨ - é¡¹ç›®ä¸€\n- é¡¹ç›®äºŒ\n- é¡¹ç›®ä¸‰ ğŸ”¸ ä½¿ç”¨ HTML å¢å¼ºè¡¨æ ¼ 1 2 3 4 5 | çŠ¶æ€ | è¯´æ˜ | |------|------| | \u0026lt;span style=\u0026#34;color:green\u0026#34;\u0026gt;âœ… æ­£å¸¸\u0026lt;/span\u0026gt; | ç³»ç»Ÿè¿è¡Œæ­£å¸¸ | | \u0026lt;span style=\u0026#34;color:orange\u0026#34;\u0026gt;âš ï¸ è­¦å‘Š\u0026lt;/span\u0026gt; | éœ€è¦å…³æ³¨ | | \u0026lt;span style=\u0026#34;color:red\u0026#34;\u0026gt;âŒ é”™è¯¯\u0026lt;/span\u0026gt; | å‡ºç°ä¸¥é‡é—®é¢˜ | ğŸ› ï¸ ä¸“ä¸šæŠ€å·§ï¼šåœ¨æ”¯æŒ HTML çš„ Markdown è§£æå™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ HTML æ ‡ç­¾å¢å¼ºè¡¨æ ¼çš„è§†è§‰æ•ˆæœã€‚\nğŸ”¸ è¡¨æ ¼æ’åºæç¤º 1 \u0026gt; ğŸ’¡ **æç¤º**: åœ¨æŸäº› Markdown æŸ¥çœ‹å™¨ä¸­ï¼Œç‚¹å‡»è¡¨å¤´å¯ä»¥å¯¹è¡¨æ ¼è¿›è¡Œæ’åºã€‚ âš ï¸ å…¼å®¹æ€§è¯´æ˜ ğŸ”¸ æ”¯æŒçš„å¹³å° å¹³å° åŸºç¡€è¡¨æ ¼ å¯¹é½æ–¹å¼ è¡¨æ ¼å†…æ ¼å¼ GitHub âœ… âœ… âœ… GitLab âœ… âœ… âœ… VS Code âœ… âœ… âœ… Typora âœ… âœ… âœ… å¤§å¤šæ•°é™æ€ç½‘ç«™ç”Ÿæˆå™¨ âœ… âœ… âœ… ğŸ”¸ ä¸æ”¯æŒçš„å¹³å° å¹³å° é™åˆ¶ è§£å†³æ–¹æ¡ˆ å¾®ä¿¡å…¬ä¼—å¹³å° âŒ è¡¨æ ¼æ”¯æŒæœ‰é™ ä½¿ç”¨å›¾ç‰‡ä»£æ›¿ æŸäº›ç§»åŠ¨åº”ç”¨ âŒ å¯èƒ½æ¸²æŸ“å¼‚å¸¸ ç®€åŒ–è¡¨æ ¼ç»“æ„ çº¯æ–‡æœ¬ç¯å¢ƒ âŒ æ— æ³•æ¸²æŸ“ æä¾›æ›¿ä»£æ–‡æœ¬æè¿° ğŸ“‹ æœ€ä½³å®è·µ ğŸ”¸ ä¿æŒè¡¨æ ¼ç®€æ´ 1 2 3 4 5 6 7 8 9 # âœ… æ¨è - ç®€æ´æ˜äº† | å§“å | å¹´é¾„ | åŸå¸‚ | |------|------|------| | å¼ ä¸‰ | 25 | åŒ—äº¬ | # âŒ é¿å… - è¿‡äºå¤æ‚ | éå¸¸é•¿çš„åˆ—æ ‡é¢˜1 | å¦ä¸€ä¸ªå¾ˆé•¿çš„åˆ—æ ‡é¢˜2 | ç¬¬ä¸‰ä¸ªè¶…é•¿çš„åˆ—æ ‡é¢˜3 | |-----------------|---------------------|---------------------| | å†…å®¹ | æ›´å¤šå†…å®¹ | ç”šè‡³æ›´å¤šçš„å†…å®¹ | ğŸ”¸ ä½¿ç”¨ä¸€è‡´çš„æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 # âœ… æ¨è - æ ¼å¼ä¸€è‡´ | äº§å“ | ä»·æ ¼ | åº“å­˜ | |:-----|-----:|-----:| | è‹¹æœ | 5.00 | 100 | | é¦™è•‰ | 3.50 | 200 | # âŒ é¿å… - æ ¼å¼æ··ä¹± | äº§å“ | ä»·æ ¼ | åº“å­˜ | |:-----|-----:|:----| | è‹¹æœ | 5.00 | 100 | | é¦™è•‰ | 3.50 | 200 | ğŸ”¸ æ·»åŠ è¡¨æ ¼æ ‡é¢˜å’Œè¯´æ˜ 1 2 3 4 5 6 7 8 **è¡¨1: å‘˜å·¥ä¿¡æ¯è¡¨** | å·¥å· | å§“å | éƒ¨é—¨ | å…¥èŒæ—¶é—´ | |------|------|------|----------| | 001 | å¼ ä¸‰ | æŠ€æœ¯éƒ¨ | 2020-01-15 | | 002 | æå›› | å¸‚åœºéƒ¨ | 2019-08-20 | \u0026gt; è¡¨æ ¼æœ€åæ›´æ–°: 2024å¹´10æœˆ ğŸ› ï¸ å·¥å…·æ¨è ğŸ”¸ åœ¨çº¿è¡¨æ ¼ç”Ÿæˆå™¨ Tables Generator - https://www.tablesgenerator.com/markdown_tables Markdown Table Generator - ç®€å•çš„åœ¨çº¿å·¥å…· Excel/Google Sheets è½¬ Markdown - å¤šç§æ’ä»¶å¯ç”¨ ğŸ”¸ ç¼–è¾‘å™¨æ’ä»¶ VS Code - Markdown Table Prettifier Sublime Text - Markdown Table Formatter Atom - Markdown Table Editor ğŸ”¸ å‘½ä»¤è¡Œå·¥å…· pandoc - å¼ºå¤§çš„æ–‡æ¡£è½¬æ¢å·¥å…· mdformat - Markdown æ ¼å¼åŒ–å·¥å…· â“ å¸¸è§é—®é¢˜è§£ç­” ğŸ”¸ Q1: è¡¨æ ¼ä¸­çš„ç«–çº¿å¦‚ä½•è½¬ä¹‰ï¼Ÿ A: ä½¿ç”¨ \\| æ¥è½¬ä¹‰ç«–çº¿å­—ç¬¦ã€‚\n1 2 3 | æè¿° | ç¤ºä¾‹ | |------|------| | åŒ…å«ç«–çº¿ | è¿™æ˜¯ä¸€ä¸ª\\|ä¾‹å­ | ğŸ”¸ Q2: å¦‚ä½•åˆ›å»ºè·¨åˆ—å•å…ƒæ ¼ï¼Ÿ A: åŸç”Ÿ Markdown ä¸æ”¯æŒè·¨åˆ—ï¼Œéœ€è¦ä½¿ç”¨ HTMLï¼š\n1 2 3 4 | åˆ—1 | åˆ—2 | åˆ—3 | |-----|-----|-----| | å†…å®¹1 | å†…å®¹2 | å†…å®¹3 | | \u0026lt;td colspan=2\u0026gt;è·¨ä¸¤åˆ—\u0026lt;/td\u0026gt; | å†…å®¹5 | ğŸ”¸ Q3: è¡¨æ ¼å¤ªå®½æ€ä¹ˆåŠï¼Ÿ A: è€ƒè™‘æ‹†åˆ†è¡¨æ ¼æˆ–ä½¿ç”¨æ»šåŠ¨æ¡ï¼ˆåœ¨æ”¯æŒ HTML çš„ç¯å¢ƒä¸­ï¼‰ï¼š\n1 2 3 4 5 \u0026lt;div style=\u0026#34;overflow-x: auto;\u0026#34;\u0026gt; | å¾ˆ | é•¿ | è¡¨ | æ ¼ | å†… | å®¹ | ç»§ | ç»­ | æ›´ | é•¿ | |----|----|----|----|----|----|----|----|----|----| | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | æ•°æ® | \u0026lt;/div\u0026gt; é€šè¿‡æŒæ¡è¿™äº›è¡¨æ ¼æŠ€å·§ï¼Œæ‚¨å¯ä»¥è®© Markdown æ–‡æ¡£æ›´åŠ ä¸“ä¸šå’Œæ˜“è¯»ï¼è®°å¾—æ ¹æ®å†…å®¹é€‰æ‹©åˆé€‚çš„è¡¨æ ¼æ ·å¼å“¦ï¼ğŸ˜Š\nğŸ’ æ€»ç»“ï¼šMarkdown è¡¨æ ¼è™½ç„¶è¯­æ³•ç®€å•ï¼Œä½†é€šè¿‡åˆç†è¿ç”¨å¯¹é½æ–¹å¼ã€æ ¼å¼å¢å¼ºå’Œæœ€ä½³å®è·µï¼Œå¯ä»¥åˆ›å»ºå‡ºæ—¢ç¾è§‚åˆå®ç”¨çš„è¡¨æ ¼ã€‚å¤šç»ƒä¹ ï¼Œå¤šå°è¯•ï¼Œæ‚¨ä¼šå‘ç°è¡¨æ ¼æ˜¯å±•ç¤ºç»“æ„åŒ–æ•°æ®çš„å¼ºå¤§å·¥å…·ï¼\n","date":"2024-12-07T15:19:56+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/cf7cf5aa/","title":"Markdown è¡¨æ ¼è¯­æ³•å¤§å…¨ğŸ“Š"},{"content":"Markdown æ–‡æœ¬é«˜äº®æŒ‡å— ğŸ” ğŸ“‹ å¯¼èˆªç›®å½• ğŸŒŸ æ–‡æœ¬é«˜äº®æŠ€å·§å¤§å…¨ ğŸ¯ åŸºç¡€é«˜äº®æ–¹æ³• ğŸ”¸ å±€éƒ¨æ–‡å­—åŠ ç²—é«˜äº® ğŸ”¸ æ•´è¡Œæ–‡å­—åŠ ç²—é«˜äº® ğŸ¨ é«˜çº§é«˜äº®æŠ€å·§ ğŸ”¸ è‡ªå®šä¹‰é¢œè‰²é«˜äº® ğŸ”¸ å¤šé¢œè‰²é«˜äº®æ–¹æ¡ˆ ğŸ”¸ æ¸å˜èƒŒæ™¯é«˜äº® ğŸ“ å®ç”¨é«˜äº®ç»„åˆ ğŸ”¸ å›¾æ ‡+é«˜äº®ç»„åˆ ğŸ”¸ ä»£ç é«˜äº®ç»“åˆ ğŸ”¸ è¡¨æ ¼ä¸­çš„é«˜äº® ğŸš€ é«˜äº®æœ€ä½³å®è·µ ğŸ”¸ é€‚ç”¨åœºæ™¯ ğŸ”¸ ä½¿ç”¨å»ºè®® ğŸ”¸ å…¼å®¹æ€§è¯´æ˜ ğŸ“ é«˜çº§æŠ€å·§ ğŸ”¸ åŠ¨æ€é«˜äº®æ•ˆæœ ğŸ”¸ é«˜äº®åŠ¨ç”» ğŸŒŸ æ–‡æœ¬é«˜äº®æŠ€å·§å¤§å…¨ Markdown æä¾›äº†å¤šç§æ–¹å¼æ¥é«˜äº®æ˜¾ç¤ºé‡è¦æ–‡æœ¬ï¼Œè®©æ‚¨çš„æ–‡æ¡£é‡ç‚¹çªå‡ºã€å±‚æ¬¡åˆ†æ˜ã€‚ğŸ“Œ æ–‡æœ¬é«˜äº®ä¸ä»…èƒ½å¤Ÿå¸å¼•è¯»è€…æ³¨æ„åŠ›ï¼Œè¿˜èƒ½æœ‰æ•ˆæå‡æ–‡æ¡£çš„å¯è¯»æ€§å’Œä¸“ä¸šæ€§ã€‚æ— è®ºæ˜¯æŠ€æœ¯æ–‡æ¡£ã€å­¦ä¹ ç¬”è®°è¿˜æ˜¯é¡¹ç›®æŠ¥å‘Šï¼Œåˆç†ä½¿ç”¨é«˜äº®æŠ€å·§éƒ½èƒ½è®©æ‚¨çš„å†…å®¹æ›´åŠ å‡ºå½©ï¼\nâœ¨ é«˜äº®åŠŸèƒ½ç‰¹ç‚¹ï¼š\nçªå‡ºé‡ç‚¹ï¼šå¿«é€Ÿå¼•å¯¼è¯»è€…å…³æ³¨å…³é”®ä¿¡æ¯ å¢å¼ºå¯è¯»æ€§ï¼šé€šè¿‡è§†è§‰å±‚æ¬¡åŒºåˆ†å†…å®¹é‡è¦æ€§ ç¾åŒ–æ’ç‰ˆï¼šä¸°å¯Œæ–‡æ¡£çš„è§†è§‰æ•ˆæœå’Œç¾è§‚åº¦ è·¨å¹³å°å…¼å®¹ï¼šå¤§éƒ¨åˆ†Markdownè§£æå™¨éƒ½æ”¯æŒåŸºç¡€é«˜äº®è¯­æ³• ğŸ¯ åŸºç¡€é«˜äº®æ–¹æ³• ğŸ”¸ å±€éƒ¨æ–‡å­—åŠ ç²—é«˜äº® 1 \u0026lt;mark\u0026gt;**æ–‡æœ¬é«˜äº®**\u0026lt;/mark\u0026gt;æµ‹è¯• ğŸ”¸ å±€éƒ¨æ–‡å­—åŠ ç²—é«˜äº®ç¤ºä¾‹ï¼š\næ–‡æœ¬é«˜äº®æµ‹è¯•\nğŸ”¸ æ•´è¡Œæ–‡å­—åŠ ç²—é«˜äº® 1 \u0026lt;mark\u0026gt;**æ–‡æœ¬é«˜äº®æµ‹è¯•**\u0026lt;/mark\u0026gt; ğŸ”¸ æ•´è¡Œæ–‡å­—åŠ ç²—é«˜äº®ç¤ºä¾‹ï¼š\næ–‡æœ¬é«˜äº®æµ‹è¯•\nğŸ’¡ è¯´æ˜: \u0026lt;mark\u0026gt;æ ‡ç­¾ç”¨äºå¼€å§‹é«˜äº®ï¼Œ\u0026lt;/mark\u0026gt;æ ‡ç­¾ç”¨äºç»“æŸé«˜äº®ã€‚è¿™æ˜¯HTML5æ ‡å‡†æ ‡ç­¾ï¼Œåœ¨ç°ä»£æµè§ˆå™¨ä¸­å…·æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ã€‚\nğŸ¨ é«˜çº§é«˜äº®æŠ€å·§ ğŸ”¸ è‡ªå®šä¹‰é¢œè‰²é«˜äº® 1 \u0026lt;span style=\u0026#34;background-color: #FFD700; padding: 2px 6px; border-radius: 3px;\u0026#34;\u0026gt;**è‡ªå®šä¹‰é¢œè‰²é«˜äº®**\u0026lt;/span\u0026gt; ğŸ”¸ æ•ˆæœ: è‡ªå®šä¹‰é¢œè‰²é«˜äº®\nğŸ“Œ ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆéœ€è¦ä¸æ–‡æ¡£ä¸»é¢˜è‰²æ­é…æˆ–å¼ºè°ƒç‰¹å®šç±»å‹ä¿¡æ¯çš„åœºæ™¯\nğŸ”¸ å¤šé¢œè‰²é«˜äº®æ–¹æ¡ˆ 1 2 3 \u0026lt;span style=\u0026#34;background-color: #FF6B6B; color: white; padding: 2px 6px;\u0026#34;\u0026gt;é‡è¦æç¤º\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;background-color: #4ECDC4; padding: 2px 6px;\u0026#34;\u0026gt;ä¿¡æ¯è¯´æ˜\u0026lt;/span\u0026gt; \u0026lt;span style=\u0026#34;background-color: #FFE66D; padding: 2px 6px;\u0026#34;\u0026gt;æ³¨æ„äº‹é¡¹\u0026lt;/span\u0026gt; ğŸ”¸ æ•ˆæœ: é‡è¦æç¤º ä¿¡æ¯è¯´æ˜ æ³¨æ„äº‹é¡¹\nğŸ¨ è‰²å½©å«ä¹‰å»ºè®®ï¼š\nğŸ”´ çº¢è‰²ï¼šé‡è¦è­¦å‘Šæˆ–é”™è¯¯æç¤º ğŸ”µ è“è‰²ï¼šä¸€èˆ¬ä¿¡æ¯æˆ–è¯´æ˜ ğŸŸ¡ é»„è‰²ï¼šæ³¨æ„äº‹é¡¹æˆ–æé†’ ğŸŸ¢ ç»¿è‰²ï¼šæˆåŠŸçŠ¶æ€æˆ–æ­£ç¡®ä¿¡æ¯ ğŸ”¸ æ¸å˜èƒŒæ™¯é«˜äº® 1 \u0026lt;span style=\u0026#34;background: linear-gradient(90deg, #FF9A8B, #FF6B6B); color: white; padding: 2px 8px; border-radius: 4px;\u0026#34;\u0026gt;æ¸å˜é«˜äº®æ•ˆæœ\u0026lt;/span\u0026gt; ğŸ”¸ æ•ˆæœ: æ¸å˜é«˜äº®æ•ˆæœ\nğŸ’« ç‰¹è‰²ï¼šæ¸å˜é«˜äº®èƒ½å¤Ÿåˆ›å»ºæ›´åŠ ç°ä»£å’Œå¸å¼•äººçš„è§†è§‰æ•ˆæœï¼Œç‰¹åˆ«é€‚åˆæ ‡é¢˜æˆ–é‡è¦æç¤º\nğŸ“ å®ç”¨é«˜äº®ç»„åˆ ğŸ”¸ å›¾æ ‡+é«˜äº®ç»„åˆ 1 2 3 âœ… \u0026lt;mark\u0026gt;**ä»»åŠ¡å®Œæˆ**\u0026lt;/mark\u0026gt; âš ï¸ \u0026lt;mark\u0026gt;**éœ€è¦æ³¨æ„**\u0026lt;/mark\u0026gt; âŒ \u0026lt;mark\u0026gt;**é”™è¯¯æç¤º**\u0026lt;/mark\u0026gt; ğŸ”¸ æ•ˆæœ: âœ… ä»»åŠ¡å®Œæˆ\nâš ï¸ éœ€è¦æ³¨æ„\nâŒ é”™è¯¯æç¤º\nğŸ“Š æ‰©å±•åº”ç”¨ï¼šå¯ä»¥ç»“åˆå„ç§emojiè¡¨æƒ…æ¥è¡¨è¾¾ä¸åŒçš„æƒ…æ„Ÿå’Œé‡è¦æ€§ç­‰çº§\nğŸ”¸ ä»£ç é«˜äº®ç»“åˆ 1 2 3 4 5 ```python # \u0026lt;mark\u0026gt;**é‡è¦å‡½æ•°**\u0026lt;/mark\u0026gt; def important_function(): return \u0026#34;This is important\u0026#34; ``` ğŸ”§ æŠ€æœ¯æç¤ºï¼šåœ¨ä»£ç å—ä¸­ä½¿ç”¨é«˜äº®æ—¶ï¼Œç¡®ä¿ä¸ä¼šç ´åä»£ç çš„è¯­æ³•é«˜äº®å’Œå¯è¯»æ€§\nğŸ”¸ è¡¨æ ¼ä¸­çš„é«˜äº® 1 2 3 4 | é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ | |------|------|------| | ä»»åŠ¡A | \u0026lt;mark\u0026gt;**è¿›è¡Œä¸­**\u0026lt;/mark\u0026gt; | é‡è¦ä»»åŠ¡ | | ä»»åŠ¡B | å·²å®Œæˆ | æ™®é€šä»»åŠ¡ | ğŸ“ˆ åº”ç”¨ä»·å€¼ï¼šåœ¨è¡¨æ ¼ä¸­ä½¿ç”¨é«˜äº®å¯ä»¥å¿«é€Ÿæ ‡è¯†å‡ºå…³é”®æ•°æ®æˆ–ç‰¹æ®ŠçŠ¶æ€ï¼Œæå‡æ•°æ®å¯è¯»æ€§\nğŸš€ é«˜äº®æœ€ä½³å®è·µ ğŸ”¸ é€‚ç”¨åœºæ™¯ å…³é”®ä¿¡æ¯ ğŸ“ - çªå‡ºæ˜¾ç¤ºé‡è¦æ•°æ®æˆ–ç»“è®º è­¦å‘Šæç¤º âš ï¸ - å¼ºè°ƒéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å†…å®¹ å˜æ›´è®°å½• ğŸ”„ - æ ‡è®°æ–°å¢æˆ–ä¿®æ”¹çš„å†…å®¹ å¼•ç”¨é‡ç‚¹ ğŸ’¬ - çªå‡ºå¼•ç”¨æ–‡çŒ®ä¸­çš„æ ¸å¿ƒè§‚ç‚¹ è¿›åº¦çŠ¶æ€ ğŸ“Š - æ ‡è¯†ä»»åŠ¡å®Œæˆæƒ…å†µæˆ–é¡¹ç›®çŠ¶æ€ æŠ€å·§æç¤º ğŸ’¡ - å¼ºè°ƒå®ç”¨æŠ€å·§æˆ–å¿«æ·æ–¹å¼ ğŸ”¸ ä½¿ç”¨å»ºè®® é€‚åº¦ä½¿ç”¨ âš–ï¸ - é¿å…è¿‡åº¦é«˜äº®ï¼Œå¦åˆ™ä¼šé™ä½æ•ˆæœï¼ˆå»ºè®®é«˜äº®å†…å®¹ä¸è¶…è¿‡å…¨æ–‡10%ï¼‰ ä¸€è‡´æ€§ ğŸ”„ - åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ç»Ÿä¸€çš„é«˜äº®é£æ ¼å’Œé¢œè‰²ç¼–ç  è‰²å½©æ­é… ğŸ¨ - é€‰æ‹©ä¸æ–‡æ¡£ä¸»é¢˜åè°ƒçš„é«˜äº®é¢œè‰²ï¼Œé¿å…ä½¿ç”¨è¿‡äºåˆºçœ¼çš„é¢œè‰² å¯è®¿é—®æ€§ â™¿ - ç¡®ä¿é«˜äº®æ–‡æœ¬ä¸èƒŒæ™¯æœ‰è¶³å¤Ÿå¯¹æ¯”åº¦ï¼ˆè‡³å°‘4.5:1ï¼‰ è¯­ä¹‰åŒ– ğŸ“– - æ ¹æ®å†…å®¹ç±»å‹é€‰æ‹©åˆé€‚çš„é«˜äº®æ–¹å¼ï¼Œä¿æŒè¯­ä¹‰ä¸€è‡´æ€§ ğŸ”¸ å…¼å®¹æ€§è¯´æ˜ \u0026lt;mark\u0026gt; æ ‡ç­¾åœ¨ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariã€Edgeç­‰ï¼‰ä¸­å¾—åˆ°è‰¯å¥½æ”¯æŒ åœ¨æŸäº›Markdownè§£æå™¨ï¼ˆå¦‚æŸäº›ç‰ˆæœ¬çš„GitHub Flavored Markdownï¼‰ä¸­å¯èƒ½éœ€è¦å¯ç”¨HTMLæ”¯æŒ å¯¹äºçº¯æ–‡æœ¬ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨==æ–‡æœ¬==è¯­æ³•ï¼ˆå¦‚æœè§£æå™¨æ”¯æŒï¼‰ ç§»åŠ¨ç«¯æ˜¾ç¤ºå¯èƒ½éœ€è¦å¯¹é«˜äº®æ ·å¼è¿›è¡Œå“åº”å¼è°ƒæ•´ ğŸ“ é«˜çº§æŠ€å·§ ğŸ”¸ åŠ¨æ€é«˜äº®æ•ˆæœ 1 \u0026lt;span style=\u0026#34;background-color: #FFD700; padding: 2px 6px; transition: all 0.3s ease;\u0026#34; onmouseover=\u0026#34;this.style.backgroundColor=\u0026#39;#FF6B6B\u0026#39;\u0026#34; onmouseout=\u0026#34;this.style.backgroundColor=\u0026#39;#FFD700\u0026#39;\u0026#34;\u0026gt;æ‚¬åœå˜è‰²æ•ˆæœ\u0026lt;/span\u0026gt; ğŸ”¸ æ•ˆæœï¼ˆæ‚¬åœæŸ¥çœ‹ï¼‰: æ‚¬åœå˜è‰²æ•ˆæœ\nğŸš€ åº”ç”¨åœºæ™¯ï¼šé€‚åˆäº¤äº’å¼æ–‡æ¡£æˆ–åœ¨çº¿æ•™ç¨‹ï¼Œå¢å¼ºç”¨æˆ·å‚ä¸æ„Ÿ\nğŸ”¸ é«˜äº®åŠ¨ç”» 1 2 3 4 5 6 7 8 9 \u0026lt;span style=\u0026#34;background-color: #FFD700; padding: 2px 6px; animation: pulse 2s infinite;\u0026#34;\u0026gt;é—ªçƒé«˜äº®\u0026lt;/span\u0026gt; \u0026lt;style\u0026gt; @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } } \u0026lt;/style\u0026gt; âœ¨ é«˜çº§åº”ç”¨ï¼šåŠ¨ç”»é«˜äº®éå¸¸é€‚åˆå¼•å¯¼ç”¨æˆ·å…³æ³¨æœ€æ–°æ›´æ–°æˆ–é‡è¦é€šçŸ¥\né€šè¿‡æŒæ¡è¿™äº›æ–‡æœ¬é«˜äº®æŠ€å·§ï¼Œæ‚¨å¯ä»¥è®©æ‚¨çš„Markdownæ–‡æ¡£æ›´åŠ ç”ŸåŠ¨ã€é‡ç‚¹çªå‡ºï¼Œæå‡è¯»è€…çš„é˜…è¯»ä½“éªŒï¼ğŸ‰\nğŸ’ æ€»ç»“æå‡ï¼š\nåŸºç¡€é«˜äº®æ»¡è¶³æ—¥å¸¸å¤§éƒ¨åˆ†éœ€æ±‚ é«˜çº§æŠ€å·§è®©æ–‡æ¡£æ›´åŠ ä¸“ä¸šå’Œå¸å¼•äºº åˆç†ä½¿ç”¨é«˜äº®å¯ä»¥æ˜¾è‘—æå‡æ–‡æ¡£è´¨é‡ å§‹ç»ˆè€ƒè™‘å…¼å®¹æ€§å’Œå¯è®¿é—®æ€§ ç°åœ¨å°±å¼€å§‹åœ¨æ‚¨çš„Markdownæ–‡æ¡£ä¸­å®è·µè¿™äº›é«˜äº®æŠ€å·§å§ï¼ğŸš€ è®©æ‚¨çš„å†…å®¹åœ¨ä¼—å¤šæ–‡æ¡£ä¸­è„±é¢–è€Œå‡ºï¼\n","date":"2024-12-07T15:19:12+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c9ffa402/","title":"Markdown æ–‡æœ¬é«˜äº®æŒ‡å— ğŸ”"},{"content":"Markdown å­—ä½“æ ·å¼ä¸é¢œè‰²æŒ‡å—ğŸ¨ ç®€ä»‹ ğŸ“– åœ¨ Markdown ä¸­ï¼Œè™½ç„¶åŸç”Ÿè¯­æ³•ä¸æ”¯æŒç›´æ¥è®¾ç½®å­—ä½“æ ·å¼ã€å¤§å°å’Œé¢œè‰²ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ HTML æ ‡ç­¾æ¥å®ç°è¿™äº›æ•ˆæœã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Markdown ä¸­ä½¿ç”¨å„ç§å­—ä½“æ ·å¼ã€‚\nå­—ä½“æ ·å¼ç¤ºä¾‹ ğŸ¯ 1. é»‘ä½“ (Heiti) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;é»‘ä½“\u0026#34;\u0026gt;æˆ‘æ˜¯é»‘ä½“å­—\u0026lt;/font\u0026gt; æˆ‘æ˜¯é»‘ä½“å­—\n2. å¾®è½¯é›…é»‘ (Microsoft YaHei) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;å¾®è½¯é›…é»‘\u0026#34;\u0026gt;æˆ‘æ˜¯å¾®è½¯é›…é»‘\u0026lt;/font\u0026gt; æˆ‘æ˜¯å¾®è½¯é›…é»‘\n3. åæ–‡å½©äº‘ (STCAIYUN) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;STCAIYUN\u0026#34;\u0026gt;æˆ‘æ˜¯åæ–‡å½©äº‘\u0026lt;/font\u0026gt; æˆ‘æ˜¯åæ–‡å½©äº‘\n4. åæ–‡è¡Œæ¥· (STXingkai) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;åæ–‡è¡Œæ¥·\u0026#34;\u0026gt;æˆ‘æ˜¯åæ–‡è¡Œæ¥·\u0026lt;/font\u0026gt; æˆ‘æ˜¯åæ–‡è¡Œæ¥·\n5. å®‹ä½“ (SimSun) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;å®‹ä½“\u0026#34;\u0026gt;æˆ‘æ˜¯å®‹ä½“\u0026lt;/font\u0026gt; æˆ‘æ˜¯å®‹ä½“\n6. ä»¿å®‹ä½“ (FangSong) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;ä»¿å®‹\u0026#34;\u0026gt;æˆ‘æ˜¯ä»¿å®‹ä½“\u0026lt;/font\u0026gt; æˆ‘æ˜¯ä»¿å®‹ä½“\n7. å¹¼åœ† (YouYuan) 1 \u0026lt;font color=#00ffff size=4 face=\u0026#34;å¹¼åœ†\u0026#34;\u0026gt;æˆ‘æ˜¯å¹¼åœ†\u0026lt;/font\u0026gt; æˆ‘æ˜¯å¹¼åœ†\né¢œè‰²ä»£ç å‚è€ƒè¡¨ ğŸ¨ å¸¸ç”¨é¢œè‰²ä»£ç  é¢œè‰²åç§° åå…­è¿›åˆ¶ä»£ç  ç¤ºä¾‹ æ·±çº¢è‰² #8B0000 æ·±çº¢è‰²æ–‡æœ¬ çº¢è‰² #FF0000 çº¢è‰²æ–‡æœ¬ æ©™è‰² #FFA500 æ©™è‰²æ–‡æœ¬ é‡‘è‰² #FFD700 é‡‘è‰²æ–‡æœ¬ é»„è‰² #FFFF00 é»„è‰²æ–‡æœ¬ ç»¿è‰² #008000 ç»¿è‰²æ–‡æœ¬ è“è‰² #0000FF è“è‰²æ–‡æœ¬ æ·±è“è‰² #00008B æ·±è“è‰²æ–‡æœ¬ ç´«è‰² #800080 ç´«è‰²æ–‡æœ¬ ç²‰è‰² #FFC0CB ç²‰è‰²æ–‡æœ¬ é’è‰² #00FFFF é’è‰²æ–‡æœ¬ ç°è‰² #808080 ç°è‰²æ–‡æœ¬ å­—ä½“å¤§å°å‚è€ƒè¡¨ ğŸ”¢ Size å‚æ•°å¯¹ç…§è¡¨ Sizeå€¼ å¤§è‡´å¯¹åº”å­—å· ç¤ºä¾‹ 1 8px æå°æ–‡å­— 2 10px è¾ƒå°æ–‡å­— 3 12px æ™®é€šæ–‡å­— 4 14px ç¨å¤§æ–‡å­— 5 18px å¤§æ–‡å­— 6 24px è¾ƒå¤§æ–‡å­— 7 36px è¶…å¤§æ–‡å­— ç»„åˆä½¿ç”¨ç¤ºä¾‹ âœ¨ å¤šç§æ ·å¼ç»„åˆ 1 2 3 \u0026lt;font color=\u0026#34;#FF6B6B\u0026#34; size=\u0026#34;5\u0026#34; face=\u0026#34;å¾®è½¯é›…é»‘\u0026#34;\u0026gt;å¤šå½©å¤§å­—\u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#4ECDC4\u0026#34; size=\u0026#34;3\u0026#34; face=\u0026#34;å®‹ä½“\u0026#34;\u0026gt;ä¸­ç­‰é’è‰²æ–‡å­—\u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#45B7D1\u0026#34; size=\u0026#34;4\u0026#34; face=\u0026#34;é»‘ä½“\u0026#34;\u0026gt;è“è‰²é»‘ä½“æ–‡å­—\u0026lt;/font\u0026gt; æ•ˆæœå±•ç¤ºï¼š å¤šå½©å¤§å­—\nä¸­ç­‰é’è‰²æ–‡å­—\nè“è‰²é»‘ä½“æ–‡å­—\næ¸å˜è‰²å½©æ•ˆæœ 1 2 3 4 5 6 \u0026lt;font color=\u0026#34;#FF9A8B\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;ğŸ”´\u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#FF7F50\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;ğŸŸ \u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#FFD700\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;ğŸŸ¡\u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#98FB98\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;ğŸŸ¢\u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#87CEEB\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;ğŸ”µ\u0026lt;/font\u0026gt; \u0026lt;font color=\u0026#34;#D8BFD8\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;ğŸŸ£\u0026lt;/font\u0026gt; æ•ˆæœå±•ç¤ºï¼š ğŸ”´ ğŸŸ  ğŸŸ¡ ğŸŸ¢ ğŸ”µ ğŸŸ£\nå®ç”¨æŠ€å·§ ğŸ’¡ 1. åˆ›å»ºé¢œè‰²æ ·å¼æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!-- æˆåŠŸæç¤º --\u0026gt; \u0026lt;font color=\u0026#34;#28a745\u0026#34; size=\u0026#34;4\u0026#34; face=\u0026#34;å¾®è½¯é›…é»‘\u0026#34;\u0026gt;âœ… æ“ä½œæˆåŠŸï¼\u0026lt;/font\u0026gt; \u0026lt;!-- è­¦å‘Šä¿¡æ¯ --\u0026gt; \u0026lt;font color=\u0026#34;#ffc107\u0026#34; size=\u0026#34;4\u0026#34; face=\u0026#34;é»‘ä½“\u0026#34;\u0026gt;âš ï¸ è¯·æ³¨æ„ï¼\u0026lt;/font\u0026gt; \u0026lt;!-- é”™è¯¯æç¤º --\u0026gt; \u0026lt;font color=\u0026#34;#dc3545\u0026#34; size=\u0026#34;4\u0026#34; face=\u0026#34;å®‹ä½“\u0026#34;\u0026gt;âŒ å‘ç”Ÿé”™è¯¯ï¼\u0026lt;/font\u0026gt; \u0026lt;!-- ä¿¡æ¯æç¤º --\u0026gt; \u0026lt;font color=\u0026#34;#17a2b8\u0026#34; size=\u0026#34;4\u0026#34; face=\u0026#34;ä»¿å®‹\u0026#34;\u0026gt;ğŸ’¡ æç¤ºä¿¡æ¯\u0026lt;/font\u0026gt; 2. å“åº”å¼å­—ä½“å¤§å° 1 2 3 \u0026lt;font style=\u0026#34;font-size: calc(12px + 0.5vw)\u0026#34; color=\u0026#34;#6c757d\u0026#34;\u0026gt; è‡ªé€‚åº”å¤§å°çš„æ–‡å­— \u0026lt;/font\u0026gt; 3. é˜´å½±æ•ˆæœ 1 2 3 4 \u0026lt;font style=\u0026#34;text-shadow: 2px 2px 4px rgba(0,0,0,0.5)\u0026#34; color=\u0026#34;#ffffff\u0026#34; size=\u0026#34;5\u0026#34;\u0026gt; å¸¦é˜´å½±çš„æ–‡å­—æ•ˆæœ \u0026lt;/font\u0026gt; æ³¨æ„äº‹é¡¹ âš ï¸ å…¼å®¹æ€§é—®é¢˜ï¼šæŸäº› Markdown è§£æå™¨å¯èƒ½ä¸æ”¯æŒ HTML æ ‡ç­¾ ç§»åŠ¨ç«¯é€‚é…ï¼šå›ºå®šå¤§å°çš„å­—ä½“åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯èƒ½æ˜¾ç¤ºä¸ä½³ å¯è®¿é—®æ€§ï¼šç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦è¶³å¤Ÿï¼Œæ–¹ä¾¿é˜…è¯» é€‚åº¦ä½¿ç”¨ï¼šé¿å…è¿‡åº¦ä½¿ç”¨æ ·å¼å½±å“é˜…è¯»ä½“éªŒ æ¨èå·¥å…· ğŸ› ï¸ åœ¨çº¿é¢œè‰²é€‰æ‹©å™¨ HTML Color Codes Coolors Adobe Color Markdown ç¼–è¾‘å™¨ Typora - æ”¯æŒå®æ—¶é¢„è§ˆ VS Code - å¸¦æœ‰ Markdown é¢„è§ˆæ’ä»¶ StackEdit - åœ¨çº¿ Markdown ç¼–è¾‘å™¨ æµè§ˆå™¨æ”¯æŒæƒ…å†µ ğŸŒ æµè§ˆå™¨ HTML æ”¯æŒ Markdown æ”¯æŒ Chrome âœ… å®Œæ•´æ”¯æŒ âœ… å®Œæ•´æ”¯æŒ Firefox âœ… å®Œæ•´æ”¯æŒ âœ… å®Œæ•´æ”¯æŒ Safari âœ… å®Œæ•´æ”¯æŒ âœ… å®Œæ•´æ”¯æŒ Edge âœ… å®Œæ•´æ”¯æŒ âœ… å®Œæ•´æ”¯æŒ é€šè¿‡çµæ´»è¿ç”¨è¿™äº›å­—ä½“æ ·å¼æŠ€å·§ï¼Œæ‚¨å¯ä»¥è®© Markdown æ–‡æ¡£æ›´åŠ ç”ŸåŠ¨å’Œç¾è§‚ï¼è®°å¾—ä¿æŒé€‚åº¦ï¼Œç¡®ä¿å†…å®¹çš„å¯è¯»æ€§å’Œä¸“ä¸šæ€§å“¦ï¼ğŸ˜Š\n","date":"2024-12-07T15:18:10+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/43ac6a63/","title":"Markdown å­—ä½“æ ·å¼ä¸é¢œè‰²æŒ‡å—ğŸ¨"},{"content":"Markdown å›¾ç‰‡åµŒå…¥æŒ‡å— ğŸ“¸ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†ä»‹ç»åœ¨ Markdown æ–‡æ¡£ä¸­åµŒå…¥å›¾ç‰‡çš„å¤šç§æ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºç¡€è¯­æ³•ã€å¸¦é“¾æ¥çš„å›¾ç‰‡ä»¥åŠå¯è°ƒæ•´å¤§å°çš„å›¾ç‰‡ã€‚\nğŸ–¼ï¸ ä¸€ã€åŸºç¡€å›¾ç‰‡è¯­æ³• è¯­æ³•æ ¼å¼ï¼š 1 ![å›¾ç‰‡æ›¿ä»£æ–‡æœ¬](å›¾ç‰‡URL) ç¤ºä¾‹ä»£ç ï¼š 1 ![æˆ‘çš„å›¾ç‰‡åç§°](https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg) æ•ˆæœæ¼”ç¤ºï¼š ä»¥ä¸‹æ˜¯ã€ŠåŸºç¡€å›¾ç‰‡è¯­æ³•ã€‹ç¤ºä¾‹ï¼š\nğŸ”— äºŒã€å¸¦é“¾æ¥çš„å›¾ç‰‡è¯­æ³• è¯­æ³•æ ¼å¼ï¼š 1 [![å›¾ç‰‡æ›¿ä»£æ–‡æœ¬](å›¾ç‰‡URL)](é“¾æ¥URL) ç¤ºä¾‹ä»£ç ï¼š 1 [![ç¤ºä¾‹å›¾ç‰‡](https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg)](https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg) æ•ˆæœæ¼”ç¤ºï¼š ä»¥ä¸‹æ˜¯ã€Šå¸¦é“¾æ¥çš„å›¾ç‰‡è¯­æ³•ã€‹ç¤ºä¾‹ï¼š\nğŸ’¡ ç‚¹å‡»å›¾ç‰‡å¯ä»¥è·³è½¬åˆ°æŒ‡å®šé“¾æ¥\nğŸ“ ä¸‰ã€è°ƒæ•´å›¾åƒå¤§å°çš„è¯­æ³• ä½¿ç”¨ HTML æ ‡ç­¾æ§åˆ¶å›¾ç‰‡å°ºå¯¸ï¼š è¯­æ³•æ ¼å¼ï¼š 1 \u0026lt;img src=\u0026#34;å›¾ç‰‡URL\u0026#34; alt=\u0026#34;æ›¿ä»£æ–‡æœ¬\u0026#34; width=\u0026#34;å®½åº¦\u0026#34; height=\u0026#34;é«˜åº¦\u0026#34;\u0026gt; ç¤ºä¾‹ä»£ç ï¼š 1 \u0026lt;img src=\u0026#34;https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg\u0026#34; alt=\u0026#34;ç¤ºä¾‹å›¾ç‰‡\u0026#34; width=\u0026#34;300\u0026#34; height=\u0026#34;200\u0026#34;\u0026gt; æ•ˆæœæ¼”ç¤ºï¼š ä»¥ä¸‹æ˜¯ã€Šé“¾æ¥å›¾åƒå¹¶è°ƒæ•´å›¾åƒå¤§å°çš„è¯­æ³•ã€‹ç¤ºä¾‹ï¼š\nğŸ¨ å››ã€æ›´å¤šå›¾ç‰‡æ§åˆ¶æŠ€å·§ 1. ä½¿ç”¨ CSS æ ·å¼æ§åˆ¶å›¾ç‰‡ 1 \u0026lt;img src=\u0026#34;https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg\u0026#34; alt=\u0026#34;ç¤ºä¾‹å›¾ç‰‡\u0026#34; style=\u0026#34;width: 50%; border: 2px solid #98FB98; border-radius: 10px;\u0026#34;\u0026gt; 2. å±…ä¸­æ˜¾ç¤ºå›¾ç‰‡ 1 2 3 \u0026lt;div align=\u0026#34;center\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg\u0026#34; alt=\u0026#34;å±…ä¸­å›¾ç‰‡\u0026#34; width=\u0026#34;300\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; 3. æ·»åŠ å›¾ç‰‡æ ‡é¢˜ 1 2 3 4 \u0026lt;figure\u0026gt; \u0026lt;img src=\u0026#34;https://pic3.zhimg.com/v2-52e3d25b08972370aeefe92a202e5ba3_r.jpg\u0026#34; alt=\u0026#34;ç¤ºä¾‹å›¾ç‰‡\u0026#34; width=\u0026#34;300\u0026#34;\u0026gt; \u0026lt;figcaption\u0026gt;è¿™æ˜¯ä¸€ä¸ªç¾ä¸½çš„ç¤ºä¾‹å›¾ç‰‡\u0026lt;/figcaption\u0026gt; \u0026lt;/figure\u0026gt; ğŸ’¡ äº”ã€æœ€ä½³å®è·µå»ºè®® ä½¿ç”¨æè¿°æ€§æ›¿ä»£æ–‡æœ¬ï¼šä¸ºæ‰€æœ‰å›¾ç‰‡æä¾›æœ‰æ„ä¹‰çš„ alt æ–‡æœ¬ï¼Œæé«˜å¯è®¿é—®æ€§ ä¼˜åŒ–å›¾ç‰‡å¤§å°ï¼šç¡®ä¿å›¾ç‰‡æ–‡ä»¶å¤§å°é€‚ä¸­ï¼Œæé«˜åŠ è½½é€Ÿåº¦ ä½¿ç”¨å¯é å›¾åºŠï¼šé€‰æ‹©ç¨³å®šçš„å›¾ç‰‡æ‰˜ç®¡æœåŠ¡ï¼Œé¿å…é“¾æ¥å¤±æ•ˆ ä¿æŒä¸€è‡´æ€§ï¼šåœ¨æ•´ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ç»Ÿä¸€çš„å›¾ç‰‡æ ·å¼å’Œå¤§å° è€ƒè™‘å“åº”å¼è®¾è®¡ï¼šä½¿ç”¨ç™¾åˆ†æ¯”å®½åº¦è€Œä¸æ˜¯å›ºå®šåƒç´ ï¼Œé€‚åº”ä¸åŒå±å¹•å°ºå¯¸ ğŸ› ï¸ å…­ã€å¸¸ç”¨å›¾åºŠæœåŠ¡ æœåŠ¡åç§° ç‰¹ç‚¹ å…è´¹é¢åº¦ Imgur æ— éœ€æ³¨å†Œï¼Œç®€å•æ˜“ç”¨ å®Œå…¨å…è´¹ GitHub ä¸ä»£ç ä»“åº“é›†æˆ å…è´¹ï¼Œä½†æœ‰ä»“åº“å¤§å°é™åˆ¶ Cloudinary æä¾›å›¾ç‰‡ä¼˜åŒ–å’Œè½¬æ¢ å…è´¹å¥—é¤æœ‰é™é¢ é˜¿é‡Œäº‘ OSS å›½å†…è®¿é—®é€Ÿåº¦å¿« æŒ‰é‡ä»˜è´¹ï¼Œæœ‰å…è´¹é¢åº¦ â“ ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­” 1. å›¾ç‰‡æ— æ³•æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ æ£€æŸ¥å›¾ç‰‡é“¾æ¥æ˜¯å¦æ­£ç¡® ç¡®è®¤å›¾ç‰‡æ˜¯å¦è¢«åˆ é™¤æˆ–ç§»åŠ¨ å°è¯•ä½¿ç”¨å…¶ä»–å›¾åºŠæœåŠ¡ 2. å¦‚ä½•æé«˜å›¾ç‰‡åŠ è½½é€Ÿåº¦ï¼Ÿ å‹ç¼©å›¾ç‰‡æ–‡ä»¶å¤§å° ä½¿ç”¨ CDN åŠ é€Ÿ é€‰æ‹©ç¦»ç”¨æˆ·æ›´è¿‘çš„å›¾åºŠæœåŠ¡å™¨ 3. Markdown ä¸­å¯ä»¥ä½¿ç”¨å“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ JPEG/JPG PNG GIF SVGï¼ˆåœ¨æŸäº› Markdown è§£æå™¨ä¸­ï¼‰ WebPï¼ˆåœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼‰ ğŸ“š å…«ã€æ‰©å±•é˜…è¯» Markdown å®˜æ–¹æŒ‡å— GitHub Markdown æ–‡æ¡£ Markdown å›¾ç‰‡é«˜çº§æŠ€å·§ ğŸš€ é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæ‚¨å¯ä»¥åœ¨ Markdown æ–‡æ¡£ä¸­çµæ´»åœ°åµŒå…¥å’Œæ§åˆ¶å›¾ç‰‡ï¼Œä½¿æ‚¨çš„æ–‡æ¡£æ›´åŠ ç”ŸåŠ¨å’Œä¸“ä¸šï¼\n","date":"2024-12-07T15:16:55+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ee1f4dc0/","title":"Markdown å›¾ç‰‡åµŒå…¥æŒ‡å— ğŸ“¸"},{"content":"Markdown è­¦å‘Šæ¡†ä¸é¢œè‰²ä»£ç å¤§å…¨ ğŸ¨ ğŸŒŸ æ¦‚è¿° æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Markdown ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼åˆ›å»ºç²¾ç¾çš„è­¦å‘Šæ¡†ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„é¢œè‰²ä»£ç å‚è€ƒè¡¨ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥è®©æ‚¨çš„æ–‡æ¡£æ›´åŠ ç”ŸåŠ¨ã€ä¸“ä¸šä¸”æ˜“äºé˜…è¯»ï¼\nâš ï¸ Markdown è­¦å‘Šæ¡†ä½¿ç”¨æŒ‡å— åŸºæœ¬ç»“æ„è§£æ 1 2 3 \u0026lt;div style=\u0026#34;background: #FFD700; padding: 12px;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:22px;color:#8B0000;\u0026#34;\u0026gt;\u0026lt;strong\u0026gt;è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸ¨ background: #FFD700 - å®šä¹‰è­¦å‘Šæ¡†èƒŒæ™¯é¢œè‰² ğŸ“ padding: 12px - å®šä¹‰å†…è¾¹è·å¤§å° ğŸ”¤ font-size:22px - å®šä¹‰æ–‡å­—å¤§å° ğŸ¯ color:#8B0000 - å®šä¹‰æ–‡å­—é¢œè‰² ğŸ”· \u0026lt;strong\u0026gt; - æ–‡å­—åŠ ç²—æ ‡ç­¾ ğŸ¯ è­¦å‘Šæ¡†ç¤ºä¾‹é›† ç¤ºä¾‹ä¸€ï¼šè­¦å‘ŠåŠ ç²—ï¼Œå†…å®¹æ­£å¸¸ 1 2 3 \u0026lt;div style=\u0026#34;background: #FFD700; padding: 12px;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:22px;\u0026#34;\u0026gt;\u0026lt;strong\u0026gt;è­¦å‘Šï¼š\u0026lt;/strong\u0026gt;è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸŸ¡ è­¦å‘Šæ¡†ç¤ºä¾‹ï¼šè­¦å‘ŠåŠ ç²—ï¼Œå†…å®¹æ­£å¸¸\nè­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\nç¤ºä¾‹äºŒï¼šå…¨éƒ¨æ–‡å­—åŠ ç²— 1 2 3 \u0026lt;div style=\u0026#34;background: #FFD700; padding: 12px;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:22px;\u0026#34;\u0026gt;\u0026lt;strong\u0026gt;è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸŸ¡ è­¦å‘Šæ¡†ç¤ºä¾‹ï¼šå…¨éƒ¨æ–‡å­—åŠ ç²—\nè­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\nç¤ºä¾‹ä¸‰ï¼šå…¨éƒ¨æ–‡å­—åŠ ç²—å¹¶æ·»åŠ é¢œè‰² 1 2 3 \u0026lt;div style=\u0026#34;background: #FFD700; padding: 12px;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:22px;color:#8B0000;\u0026#34;\u0026gt;\u0026lt;strong\u0026gt;è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸŸ¡ è­¦å‘Šæ¡†ç¤ºä¾‹ï¼šå…¨éƒ¨æ–‡å­—åŠ ç²—å¹¶æ·»åŠ é¢œè‰²\nè­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\nç¤ºä¾‹å››ï¼šå…¨éƒ¨æ–‡å­—åŠ ç²—å±…ä¸­å¹¶æ·»åŠ é¢œè‰² 1 2 3 \u0026lt;div style=\u0026#34;background: #FFD700; padding: 12px; display: flex; flex-direction: column; justify-content: center;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:22px;color:#8B0000;text-align:center;\u0026#34;\u0026gt;\u0026lt;strong\u0026gt;è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸŸ¡ è­¦å‘Šæ¡†ç¤ºä¾‹ï¼šå…¨éƒ¨æ–‡å­—åŠ ç²—å±…ä¸­å¹¶æ·»åŠ é¢œè‰²\nè­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ã€‚\nğŸ“ é«˜çº§æŠ€å·§ ç»„åˆä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 \u0026lt;div style=\u0026#34;background: #E0FFFF; padding: 15px; border-left: 5px solid #20B2AA;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:18px;color:#008080;text-align:center;\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;ğŸ’¡ æç¤ºï¼š\u0026lt;/strong\u0026gt;è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¿¡æ¯æ¡†ç¤ºä¾‹ï¼ \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸ’¡ æç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¿¡æ¯æ¡†ç¤ºä¾‹ï¼ å“åº”å¼è®¾è®¡æŠ€å·§ 1 2 3 4 5 \u0026lt;div style=\u0026#34;background: #FFD700; padding: 12px; margin: 10px 0; border-radius: 5px;\u0026#34;\u0026gt; \u0026lt;p style=\u0026#34;font-size:calc(16px + 0.5vw);color:#8B0000;\u0026#34;\u0026gt; \u0026lt;strong\u0026gt;ğŸ“± å“åº”å¼è­¦å‘Šï¼š\u0026lt;/strong\u0026gt;è¿™ä¸ªæ¡†ä¼šæ ¹æ®å±å¹•å¤§å°è°ƒæ•´å­—ä½“ï¼ \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ğŸ“± å“åº”å¼è­¦å‘Šï¼šè¿™ä¸ªæ¡†ä¼šæ ¹æ®å±å¹•å¤§å°è°ƒæ•´å­—ä½“ï¼ ğŸ“ æœ€ä½³å®è·µ ä¸€è‡´æ€§ - åœ¨æ•´ä¸ªæ–‡æ¡£ä¸­ä½¿ç”¨ç›¸åŒçš„é¢œè‰²ç¼–ç ç³»ç»Ÿ å¯è®¿é—®æ€§ - ç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦è¶³å¤Ÿï¼Œä¾¿äºé˜…è¯» é€‚åº¦ä½¿ç”¨ - ä¸è¦è¿‡åº¦ä½¿ç”¨é¢œè‰²ï¼Œä»¥å…åˆ†æ•£è¯»è€…æ³¨æ„åŠ› è¯­ä¹‰åŒ– - ä½¿ç”¨é¢œè‰²ä¼ è¾¾æ„ä¹‰ï¼ˆå¦‚çº¢è‰²è¡¨ç¤ºè­¦å‘Šï¼Œç»¿è‰²è¡¨ç¤ºæˆåŠŸï¼‰ æµ‹è¯• - åœ¨ä¸åŒè®¾å¤‡å’Œæµè§ˆå™¨ä¸Šæµ‹è¯•æ˜¾ç¤ºæ•ˆæœ ğŸ”§ æ•…éšœæ’é™¤ å¦‚æœæ‚¨çš„ Markdown è§£æå™¨ä¸æ”¯æŒå†…è” HTMLï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š\nä½¿ç”¨æ”¯æŒ HTML çš„ Markdown è§£æå™¨ï¼ˆå¦‚ GitHub Flavored Markdownï¼‰ å¦‚æœåªèƒ½ä½¿ç”¨çº¯ Markdownï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¨¡æ‹Ÿè­¦å‘Šæ¡†ï¼š 1 \u0026gt; **âš ï¸ æ³¨æ„ï¼š** è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨å—å¼•ç”¨çš„ç®€æ˜“è­¦å‘Šæ¡† âš ï¸ æ³¨æ„ï¼š è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨å—å¼•ç”¨çš„ç®€æ˜“è­¦å‘Šæ¡†\nå¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨åˆ›å»ºæ›´åŠ ç¾è§‚ã€ä¸“ä¸šçš„ Markdown æ–‡æ¡£ï¼ğŸ¨âœ¨\n","date":"2024-12-07T15:16:09+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a82478c7/","title":"Markdown è­¦å‘Šæ¡†ä¸é¢œè‰²ä»£ç å¤§å…¨ ğŸ¨"},{"content":"è®©æˆ‘å¸®ä½ æ•´ç†è¿™ä»½å…³äºä½¿ç”¨ acme.sh å’Œé˜¿é‡Œäº‘ DNS ç”³è¯·ä¸ç®¡ç†å…è´¹æ³›åŸŸå SSL è¯ä¹¦çš„è¯¦ç»†æŒ‡å—ã€‚æˆ‘ä¼šä¼˜åŒ–ç»“æ„ã€è¡¥å……ç»†èŠ‚ï¼Œå¹¶ç¡®ä¿ä¿¡æ¯çš„å‡†ç¡®æ€§å’Œå®ç”¨æ€§ã€‚\nä½¿ç”¨ acme.sh å’Œé˜¿é‡Œäº‘ DNS ç”³è¯·ä¸ç®¡ç†å…è´¹æ³›åŸŸå SSL è¯ä¹¦æŒ‡å— ğŸ” ğŸ“‹ ç›®å½• ğŸŒ° ç®€ä»‹ä¸ç‰¹ç‚¹ ğŸ“¦ å®‰è£… acme.sh ğŸ”‘ é…ç½®é˜¿é‡Œäº‘ DNS API ğŸ–‹ï¸ ç”³è¯·æ³›åŸŸåè¯ä¹¦ ğŸ“ å®‰è£…ä¸éƒ¨ç½²è¯ä¹¦ âš™ï¸ Nginx é…ç½®ç¤ºä¾‹ ğŸ”„ è‡ªåŠ¨ç»­æœŸç®¡ç† ğŸ› æ•…éšœæ’é™¤ ğŸ“Š å¤šåŸŸåç®¡ç† ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ ğŸ—‘ï¸ å¸è½½ä¸æ¸…ç† ğŸ’¡ é«˜çº§ç”¨æ³• ğŸ¯ æ€»ç»“ä¸æç¤º ğŸŒ° ç®€ä»‹ä¸ç‰¹ç‚¹ acme.sh æ˜¯ä¸€ä¸ªçº¯ Shell è¯­è¨€ç¼–å†™çš„ ACME åè®®å®¢æˆ·ç«¯ï¼Œä¸“ä¸ºä» Let\u0026rsquo;s Encrypt ç­‰è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰è‡ªåŠ¨è·å–å’Œæ›´æ–° SSL/TLS è¯ä¹¦è€Œè®¾è®¡ã€‚å®ƒæ”¯æŒæ³›åŸŸåè¯ä¹¦ï¼ˆWildcard Certificateï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªè¯ä¹¦å¯ä»¥ä¿æŠ¤ä¸€ä¸ªåŸŸååŠå…¶æ‰€æœ‰å­åŸŸåï¼ˆå¦‚ *.example.comï¼‰ï¼Œéå¸¸é€‚åˆæ‹¥æœ‰å¤šä¸ªå­åŸŸåçš„åœºæ™¯ã€‚\nä¸»è¦ç‰¹æ€§ä¸ä¼˜åŠ¿ï¼š\nå®Œå…¨å…è´¹ä¸è‡ªåŠ¨åŒ–ï¼šä¾æ‰˜ Let\u0026rsquo;s Encrypt å’Œ ZeroSSL ç­‰æœåŠ¡ï¼Œæä¾›å…è´¹çš„æ³›åŸŸåè¯ä¹¦ï¼Œå¹¶è‡ªåŠ¨åŒ–ç”³è¯·å’Œç»­æœŸæµç¨‹ã€‚ å¼ºå¤§çš„å…¼å®¹æ€§ï¼šæ”¯æŒä¼—å¤šçš„ DNS æä¾›å•† APIï¼Œé€šè¿‡é˜¿é‡Œäº‘ DNS API å¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„ DNS éªŒè¯ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚ éä¾µå…¥å¼å®‰è£…ï¼šå®‰è£…ç®€å•ï¼Œæ‰€æœ‰æ–‡ä»¶é€šå¸¸ä½äº ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œä¸ä¼šå½±å“ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†ã€‚ è‡ªåŠ¨ç»­æœŸä¸ç»´æŠ¤ï¼šè‡ªåŠ¨åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼ˆcron jobï¼‰æ¥æ£€æŸ¥å¹¶ç»­æœŸå³å°†è¿‡æœŸçš„è¯ä¹¦ï¼ˆLet\u0026rsquo;s Encrypt è¯ä¹¦æœ‰æ•ˆæœŸé€šå¸¸ä¸º 90 å¤©ï¼‰ï¼Œç¡®ä¿ç½‘ç«™æŒç»­åŠ å¯†ã€‚ GitHub åœ°å€ï¼š https://github.com/acmesh-official/acme.sh ä¸­æ–‡æ–‡æ¡£ï¼š https://github.com/acmesh-official/acme.sh/wiki/è¯´æ˜ ğŸ“¦ å®‰è£… acme.sh 1. è‡ªåŠ¨å®‰è£…è„šæœ¬ 1 2 3 4 5 6 # ä½¿ç”¨ curl å®‰è£… curl https://get.acme.sh | sh -s email=your_email@example.com # æˆ–è€…ä½¿ç”¨ wget å®‰è£… wget -O - https://get.acme.sh | sh -s email=your_email@example.com # ğŸ“¦ è‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…åˆ° ~/.acme.sh/ ç›®å½• ğŸ’¡ å°† your_email@example.com æ›¿æ¢ä¸ºä½ è‡ªå·±çš„é‚®ç®±åœ°å€ï¼Œè¯¥é‚®ç®±ç”¨äºæ¥æ”¶è¯ä¹¦ç›¸å…³çš„é€šçŸ¥ã€‚\n2. åŠ è½½ç¯å¢ƒå˜é‡ å®‰è£…å®Œæˆåï¼Œacme.sh ä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥è‡ªåŠ¨ç»­ç­¾è¯ä¹¦ã€‚\n1 2 3 4 5 6 # é‡æ–°åŠ è½½ bash é…ç½®ï¼ˆæˆ–é‡æ–°æ‰“å¼€ç»ˆç«¯ï¼‰ source ~/.bashrc # éªŒè¯å®‰è£… acme.sh --version # âœ… åº”è¯¥æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ 3. åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 # åˆ›å»ºå…¨å±€è®¿é—®é“¾æ¥ ln -s ~/.acme.sh/acme.sh /usr/local/bin/acme.sh # ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ acme.sh --version ğŸ”‘ é…ç½®é˜¿é‡Œäº‘ DNS API ä½¿ç”¨ DNS API æ–¹å¼æ˜¯ç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼ˆ*.example.comï¼‰çš„æ¨èæ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥å®ç°å…¨è‡ªåŠ¨éªŒè¯å’Œç»­æœŸã€‚\n1. è·å–é˜¿é‡Œäº‘ API å¯†é’¥ ç™»å½• é˜¿é‡Œäº‘æ§åˆ¶å° â†’ RAM è®¿é—®æ§åˆ¶ã€‚ åˆ›å»ºç”¨æˆ·ï¼šå»ºè®®åˆ›å»ºä¸€ä¸ªä¸“ç”¨äº API è°ƒç”¨çš„å­ç”¨æˆ·ï¼ˆä¸æ¨èä½¿ç”¨ä¸»è´¦æˆ·ï¼‰ï¼Œå¹¶å‹¾é€‰\u0026quot;OpenAPI è°ƒç”¨è®¿é—®\u0026quot;ã€‚ æ·»åŠ æƒé™ï¼šä¸ºè¯¥å­ç”¨æˆ·æ·»åŠ  AliyunDNSFullAccessï¼ˆç®¡ç†äº‘è§£æï¼ˆDNSï¼‰çš„æƒé™ï¼‰ç­–ç•¥ã€‚ ä¿å­˜ AccessKeyï¼šåˆ›å»ºæˆåŠŸåï¼Œå¤åˆ¶å¹¶å¦¥å–„ä¿å­˜ AccessKey ID å’Œ AccessKey Secretã€‚ 2. è®¾ç½®ç¯å¢ƒå˜é‡ å°†è·å–åˆ°çš„ API å¯†é’¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œä¾› acme.sh ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 # è®¾ç½®é˜¿é‡Œäº‘ API å¯†é’¥ (å½“å‰Shellä¼šè¯æœ‰æ•ˆ) export Ali_Key=\u0026#34;ä½ çš„é˜¿é‡Œäº‘AccessKey ID\u0026#34; export Ali_Secret=\u0026#34;ä½ çš„é˜¿é‡Œäº‘AccessKey Secret\u0026#34; # æ°¸ä¹…ä¿å­˜åˆ° acme.sh çš„è´¦æˆ·é…ç½®æ–‡ä»¶ä¸­ (æ¨èæ–¹å¼) echo \u0026#34;SAVED_Ali_Key=\u0026#39;ä½ çš„é˜¿é‡Œäº‘AccessKey ID\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.acme.sh/account.conf echo \u0026#34;SAVED_Ali_Secret=\u0026#39;ä½ çš„é˜¿é‡Œäº‘AccessKey Secret\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.acme.sh/account.conf # ğŸ”’ è®¾ç½®é…ç½®æ–‡ä»¶æƒé™ chmod 600 ~/.acme.sh/account.conf âš ï¸ é‡è¦å®‰å…¨æç¤ºï¼š\né¿å…åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥ä½¿ç”¨ export åæ¥æ˜æ–‡å¯†é’¥ï¼Œä»¥å…è¢« shell å†å²è®°å½•è®°å½•ã€‚ å¼ºçƒˆå»ºè®®ä½¿ç”¨ echo è¿½åŠ åˆ° account.conf æ–‡ä»¶çš„æ–¹å¼ï¼Œacme.sh ä¼šè‡ªåŠ¨è¯»å–å…¶ä¸­çš„ SAVED_Ali_Key å’Œ SAVED_Ali_Secret å˜é‡ã€‚ ç¡®ä¿ ~/.acme.sh/account.conf çš„æ–‡ä»¶æƒé™è®¾ç½®æ­£ç¡®ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚ ğŸ–‹ï¸ ç”³è¯·æ³›åŸŸåè¯ä¹¦ 1. ç”³è¯·è¯ä¹¦å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŸºæœ¬å‘½ä»¤ - ç”³è¯·æ³›åŸŸåè¯ä¹¦ acme.sh --issue --dns dns_ali \\ -d \u0026#39;*.example.com\u0026#39; \\ -d \u0026#39;example.com\u0026#39; # ğŸ¯ å‚æ•°è¯´æ˜: # --dns dns_ali: ä½¿ç”¨é˜¿é‡Œäº‘ DNS API è¿›è¡ŒéªŒè¯ # -d \u0026#39;*.example.com\u0026#39;: é€šé…ç¬¦åŸŸåï¼Œä¿æŠ¤æ‰€æœ‰å­åŸŸå # -d \u0026#39;example.com\u0026#39;: åŒæ—¶ç”³è¯·æ ¹åŸŸåè¯ä¹¦ï¼ˆå¯é€‰ï¼Œä½†å»ºè®®ï¼‰ # æ˜ç¡®æŒ‡å®šä½¿ç”¨ Let\u0026#39;s Encryptï¼ˆacme.sh é»˜è®¤å¯èƒ½æ˜¯ ZeroSSLï¼‰ acme.sh --issue --dns dns_ali \\ -d \u0026#39;*.example.com\u0026#39; \\ -d \u0026#39;example.com\u0026#39; \\ --server letsencrypt 2. æµ‹è¯•æ¨¡å¼ï¼ˆé¦–æ¬¡å»ºè®®ï¼‰ Let\u0026rsquo;s Encrypt ç”Ÿäº§ç¯å¢ƒæœ‰é€Ÿç‡é™åˆ¶ï¼Œåˆæ¬¡è°ƒè¯•å»ºè®®å…ˆç”¨æµ‹è¯•ç¯å¢ƒï¼ˆ--stagingï¼‰é¿å…è§¦å‘é™åˆ¶ã€‚\n1 2 3 4 5 6 7 # ä½¿ç”¨ Let\u0026#39;s Encrypt çš„æµ‹è¯•ç¯å¢ƒï¼ˆStagingï¼‰ acme.sh --issue --dns dns_ali \\ -d \u0026#39;*.example.com\u0026#39; \\ -d \u0026#39;example.com\u0026#39; \\ --server letsencrypt \\ --staging \\ --debug æµ‹è¯•æˆåŠŸï¼Œç¡®è®¤æ— è¯¯åï¼Œç§»é™¤ --staging å’Œ --debug å‚æ•°ï¼Œå†æ¬¡è¿è¡Œå‘½ä»¤ä»¥ç”³è¯·æ­£å¼è¯ä¹¦ã€‚\n3. è¯ä¹¦ç”³è¯·è¿‡ç¨‹ æ‰§è¡Œå‘½ä»¤åï¼Œacme.sh ä¼šï¼š\næ ¹æ®ä½ çš„åŸŸåï¼ˆå¦‚ example.comï¼‰è‡ªåŠ¨åœ¨é˜¿é‡Œäº‘ DNS ä¸­æ·»åŠ ä¸€æ¡ç”¨äºéªŒè¯çš„ TXT è®°å½•ï¼ˆè®°å½•åé€šå¸¸ä¸º _acme-challenge.example.comï¼‰ã€‚ ç­‰å¾… DNS è®°å½• propagateï¼ˆé€šå¸¸éœ€è¦å‡ ç§’åˆ°å‡ åˆ†é’Ÿï¼‰ã€‚ å‘ CA æœºæ„ï¼ˆå¦‚ Let\u0026rsquo;s Encryptï¼‰å®ŒæˆåŸŸåæ‰€æœ‰æƒéªŒè¯ã€‚ éªŒè¯æˆåŠŸåï¼Œè‡ªåŠ¨åˆ é™¤åˆšæ‰æ·»åŠ çš„ TXT è®°å½•ï¼ˆä¿æŒ DNS æ¸…æ´ï¼‰ã€‚ æœ€ç»ˆä¸‹è½½å¹¶ä¿å­˜æ³›åŸŸåè¯ä¹¦åˆ° ~/.acme.sh/*.example.com/ ç›®å½•ä¸‹ã€‚ ğŸ“ å®‰è£…ä¸éƒ¨ç½²è¯ä¹¦ è¯ä¹¦ç”³è¯·æˆåŠŸåï¼Œé»˜è®¤ä¿å­˜åœ¨ ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œä½†ä¸å»ºè®®ç›´æ¥è®© Web æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼‰ä½¿ç”¨è¯¥ç›®å½•ä¸‹çš„è¯ä¹¦æ–‡ä»¶ï¼Œå› ä¸ºè¯¥ç›®å½•ç»“æ„æ˜¯ acme.sh å†…éƒ¨ç®¡ç†çš„ï¼Œä¸”ç»­æœŸåè¯ä¹¦æ–‡ä»¶ä¼šæ›´æ–°ã€‚ä½ åº”è¯¥ä½¿ç”¨ --install-cert å‘½ä»¤å°†è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šä½ç½®ã€‚\n1. Nginx è¯ä¹¦å®‰è£… 1 2 3 4 5 6 7 8 # åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½• (æŒ‰éœ€ä¿®æ”¹è·¯å¾„) sudo mkdir -p /etc/nginx/ssl/example.com/ # å®‰è£…è¯ä¹¦åˆ°æŒ‡å®šä½ç½® acme.sh --install-cert -d \u0026#39;example.com\u0026#39; \\ --key-file /etc/nginx/ssl/example.com/private.key \\ --fullchain-file /etc/nginx/ssl/example.com/fullchain.cer \\ --reloadcmd \u0026#34;sudo systemctl reload nginx\u0026#34; --reloadcmd å‚æ•°éå¸¸é‡è¦ï¼šå®ƒæŒ‡å®šäº†è¯ä¹¦è‡ªåŠ¨ç»­æœŸåéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œé€šå¸¸æ˜¯é‡è½½ Web æœåŠ¡å™¨ä»¥ä½¿æ–°è¯ä¹¦ç”Ÿæ•ˆã€‚è¯·ç¡®ä¿æ­¤å‘½ä»¤æ­£ç¡®æ— è¯¯ã€‚\n2. Apache è¯ä¹¦å®‰è£… 1 2 3 4 5 6 7 8 # åˆ›å»ºè¯ä¹¦ç›®å½• sudo mkdir -p /etc/apache2/ssl/example.com/ # å®‰è£…è¯ä¹¦ acme.sh --install-cert -d \u0026#39;example.com\u0026#39; \\ --key-file /etc/apache2/ssl/example.com/private.key \\ --fullchain-file /etc/apache2/ssl/example.com/fullchain.cer \\ --reloadcmd \u0026#34;sudo systemctl reload apache2\u0026#34; 3. é€šç”¨è¯ä¹¦å®‰è£…ï¼ˆä»…å¤åˆ¶ï¼‰ 1 2 3 4 5 # å¦‚æœä½ åœ¨å…¶ä»–åœ°æ–¹ç®¡ç†é‡è½½é€»è¾‘ï¼Œå¯ä»¥åªå¤åˆ¶è¯ä¹¦æ–‡ä»¶ acme.sh --install-cert -d \u0026#39;example.com\u0026#39; \\ --cert-file /path/to/cert.pem \\ --key-file /path/to/private.key \\ --fullchain-file /path/to/fullchain.pem âš™ï¸ Nginx é…ç½®ç¤ºä¾‹ 1. SSL æœåŠ¡å™¨é…ç½®ç‰‡æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 # /etc/nginx/snippets/ssl_example.com.conf # SSL è¯ä¹¦è·¯å¾„ï¼ˆæŒ‡å‘ --install-cert å®‰è£…çš„ä½ç½®ï¼‰ ssl_certificate /etc/nginx/ssl/example.com/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/example.com/private.key; # SSL åè®®å’ŒåŠ å¯†å¥—ä»¶ä¼˜åŒ–ï¼ˆå¢å¼ºå®‰å…¨æ€§ï¼‰ ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # å¯ç”¨ SSL session ç¼“å­˜ï¼Œæå‡æ€§èƒ½ ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; 2. HTTPS æœåŠ¡å™¨å—ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # /etc/nginx/conf.d/example.com_ssl.conf server { listen 443 ssl http2; server_name example.com *.example.com; # æ³›åŸŸååŒ¹é… # å¼•å…¥ SSL é…ç½®ç‰‡æ®µ include /etc/nginx/snippets/ssl_example.com.conf; root /var/www/html; index index.html index.htm; # å…¶ä»–ç‰¹å®šé…ç½®... location / { try_files $uri $uri/ =404; } } 3. HTTP é‡å®šå‘åˆ° HTTPS 1 2 3 4 5 6 7 8 # /etc/nginx/conf.d/example.com_redirect.conf server { listen 80; server_name example.com *.example.com; # å¼ºåˆ¶é‡å®šå‘æ‰€æœ‰ HTTP è¯·æ±‚åˆ° HTTPS return 301 https://$host$request_uri; } 4. æµ‹è¯•å¹¶åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 # æµ‹è¯• Nginx é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡® sudo nginx -t # å¦‚æœæµ‹è¯•æˆåŠŸï¼Œé‡æ–°åŠ è½½ Nginx é…ç½®ï¼ˆæ— éœ€å®Œå…¨é‡å¯ï¼‰ sudo systemctl reload nginx # æ£€æŸ¥ Nginx çŠ¶æ€ sudo systemctl status nginx ğŸ”„ è‡ªåŠ¨ç»­æœŸç®¡ç† acme.sh çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€æ˜¯å…¶å…¨è‡ªåŠ¨ç»­æœŸèƒ½åŠ›ã€‚\n1. è‡ªåŠ¨ç»­æœŸåŸç† å®‰è£…æ—¶ï¼Œacme.sh ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºä¸€ä¸ª cron å®šæ—¶ä»»åŠ¡ã€‚ è¯¥ä»»åŠ¡æ¯å¤©å‡Œæ™¨è‡ªåŠ¨è¿è¡Œï¼Œæ£€æŸ¥æ‰€æœ‰å·²é¢å‘è¯ä¹¦çš„æœ‰æ•ˆæœŸã€‚ å¦‚æœè¯ä¹¦è·ç¦»è¿‡æœŸå°äº 30 å¤©ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰§è¡Œç»­æœŸæ“ä½œã€‚ ç»­æœŸæˆåŠŸåï¼Œä¼šæ‰§è¡Œä½ ä¹‹å‰é€šè¿‡ --install-cert è®¾ç½®çš„ --reloadcmd å‘½ä»¤ï¼ˆå¦‚ systemctl reload nginxï¼‰ï¼Œä½¿æ–°è¯ä¹¦ç«‹å³ç”Ÿæ•ˆã€‚ 1 2 3 # æŸ¥çœ‹ç°æœ‰çš„ cron ä»»åŠ¡ï¼ˆé€šå¸¸å¯ä»¥çœ‹åˆ° acme.sh çš„ä»»åŠ¡ï¼‰ crontab -l # ç¤ºä¾‹è¾“å‡ºï¼š0 0 * * * \u0026#34;/root/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/root/.acme.sh\u0026#34; \u0026gt; /dev/null 2. æ‰‹åŠ¨ç»­æœŸå‘½ä»¤ è™½ç„¶é€šå¸¸ä¸éœ€è¦ï¼Œä½†ä½ å¯ä»¥æ‰‹åŠ¨å¼ºåˆ¶ç»­æœŸï¼š\n1 2 3 4 5 # æ‰‹åŠ¨å¼ºåˆ¶ç»­æœŸç‰¹å®šè¯ä¹¦ acme.sh --renew -d \u0026#39;example.com\u0026#39; --force # å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹ç»­æœŸè¯¦æƒ… acme.sh --renew -d \u0026#39;example.com\u0026#39; --force --debug 3. æ£€æŸ¥è¯ä¹¦çŠ¶æ€ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ acme.sh ç®¡ç†çš„æ‰€æœ‰è¯ä¹¦åˆ—è¡¨ acme.sh --list # æŸ¥çœ‹ç‰¹å®šè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯ acme.sh --info -d \u0026#39;example.com\u0026#39; # ä½¿ç”¨ OpenSSL æ£€æŸ¥è¯ä¹¦æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯å’Œè¿‡æœŸæ—¶é—´ openssl x509 -in /etc/nginx/ssl/example.com/fullchain.cer -noout -dates ğŸ› æ•…éšœæ’é™¤ 1. å¸¸è§é”™è¯¯ä¸è§£å†³ DNS API éªŒè¯å¤±è´¥ï¼š\nç—‡çŠ¶ï¼šæ‰§è¡Œ --issue å‘½ä»¤æ—¶è¶…æ—¶æˆ–æŠ¥é”™ã€‚ æ’æŸ¥ï¼šç¡®ä¿é˜¿é‡Œäº‘ RAM ç”¨æˆ·çš„ AliyunDNSFullAccess æƒé™å·²æ­£ç¡®é™„åŠ ï¼›ä»”ç»†æ£€æŸ¥ Ali_Key å’Œ Ali_Secret æ˜¯å¦å¡«å†™æ­£ç¡®ï¼Œå¹¶æ— å¤šä½™ç©ºæ ¼ã€‚ å‘½ä»¤ï¼šacme.sh --issue --dns dns_ali -d '*.example.com' --debug 2 ï¼ˆå¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†è¾“å‡ºï¼‰ã€‚ è¯ä¹¦å·²è¿‡æœŸæœªè‡ªåŠ¨ç»­æœŸï¼š\næ’æŸ¥ï¼šè¿è¡Œ crontab -l æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦å­˜åœ¨ï¼›æ£€æŸ¥ ~/.acme.sh/account.conf ä¸­çš„ API å¯†é’¥é…ç½®æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚ å‘½ä»¤ï¼šæ‰‹åŠ¨æ‰§è¡Œ acme.sh --cron æ£€æŸ¥è‡ªåŠ¨ç»­æœŸè¿‡ç¨‹ã€‚ Nginx é‡è½½å¤±è´¥ï¼š\næ’æŸ¥ï¼šæ£€æŸ¥ --reloadcmd ä¸­çš„å‘½ä»¤æ˜¯å¦æ­£ç¡®ï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¦éœ€è¦ sudoï¼‰ï¼›ä½¿ç”¨ nginx -t æ£€æŸ¥ Nginx é…ç½®è¯­æ³•ã€‚ 2. æ—¥å¿—æ–‡ä»¶ acme.sh çš„è¯¦ç»†è¿è¡Œæ—¥å¿—é€šå¸¸ä½äºï¼š~/.acme.sh/acme.sh.logã€‚ ä½¿ç”¨ tail -f ~/.acme.sh/acme.sh.log å¯ä»¥å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚ ğŸ“Š å¤šåŸŸåç®¡ç† 1. ç”³è¯·å¤šä¸ªæ³›åŸŸåè¯ä¹¦ å¦‚æœä½ æœ‰å¤šä¸ªä¸»åŸŸåï¼Œéœ€è¦ä¸ºæ¯ä¸ªåŸŸååˆ†åˆ«ç”³è¯·è¯ä¹¦ï¼š\n1 2 3 4 5 6 # ä¸º example.com ç”³è¯· acme.sh --issue --dns dns_ali -d \u0026#39;*.example.com\u0026#39; -d \u0026#39;example.com\u0026#39; # ä¸º example.net ç”³è¯· acme.sh --issue --dns dns_ali -d \u0026#39;*.example.net\u0026#39; -d \u0026#39;example.net\u0026#39; # ä¸º example.org ç”³è¯· acme.sh --issue --dns dns_ali -d \u0026#39;*.example.org\u0026#39; -d \u0026#39;example.org\u0026#39; 2. è¯ä¹¦ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ acme.sh ç®¡ç†çš„æ‰€æœ‰è¯ä¹¦ acme.sh --list # åˆ é™¤æŸä¸ªåŸŸåçš„è¯ä¹¦ï¼ˆä» acme.sh ç®¡ç†ä¸­ç§»é™¤ï¼Œä¸ä¼šåˆ é™¤æ–‡ä»¶ï¼‰ acme.sh --remove -d \u0026#39;example.com\u0026#39; # æ’¤é”€è¯ä¹¦ï¼ˆåœ¨è¯ä¹¦æ³„éœ²ç­‰æƒ…å†µä¸‹ä½¿ç”¨ï¼‰ acme.sh --revoke -d \u0026#39;example.com\u0026#39; ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ API å¯†é’¥å®‰å…¨ï¼š\nå§‹ç»ˆä½¿ç”¨ RAM å­è´¦æˆ·ï¼Œå¹¶éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆ AliyunDNSFullAccess æƒé™ï¼Œè€Œéä¸»è´¦æˆ· AKã€‚ å°†å¯†é’¥ä¿å­˜åœ¨ ~/.acme.sh/account.conf ä¸­ï¼Œå¹¶ä½¿ç”¨ chmod 600 ~/.acme.sh/account.conf è®¾ç½®ä¸¥æ ¼çš„æ–‡ä»¶æƒé™ã€‚ è¯ä¹¦æ–‡ä»¶æƒé™ï¼š\n1 2 3 4 # è®¾ç½®ä¸¥æ ¼çš„è¯ä¹¦æ–‡ä»¶æƒé™ sudo chmod 644 /etc/nginx/ssl/example.com/fullchain.cer # è¯ä¹¦é“¾å¯è¯» sudo chmod 600 /etc/nginx/ssl/example.com/private.key # ç§é’¥ä»… root å¯è¯» sudo chown root:root /etc/nginx/ssl/example.com/* # æ‰€æœ‰è€…è®¾ä¸º root å®šæœŸå¤‡ä»½ï¼š\n1 2 3 # å¤‡ä»½è¯ä¹¦æ–‡ä»¶å’Œ acme.sh é…ç½® tar -czf /backup/ssl-certs-$(date +%Y%m%d).tar.gz /etc/nginx/ssl/ tar -czf /backup/acme-config-$(date +%Y%m%d).tar.gz ~/.acme.sh/ ğŸ—‘ï¸ å¸è½½ä¸æ¸…ç† 1 2 3 4 5 # ä¼˜é›…åœ°å¸è½½ acme.shï¼ˆä¼šæ¸…ç† cron ä»»åŠ¡ç­‰ï¼‰ acme.sh --uninstall # å¼ºåˆ¶åˆ é™¤æ•´ä¸ª acme.sh ç›®å½•ï¼ˆå¦‚æœ --uninstall ä¸æˆåŠŸï¼‰ rm -rf ~/.acme.sh å¸è½½å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å¤‡ä»½äº†é‡è¦çš„è¯ä¹¦æ–‡ä»¶ï¼Œæˆ–è€…å·²ç»å°†è¯ä¹¦éƒ¨ç½²åˆ°äº†å®‰å…¨çš„åœ°æ–¹ã€‚\nğŸ’¡ é«˜çº§ç”¨æ³• 1. ECC è¯ä¹¦ï¼ˆæ¨èï¼‰ ECCï¼ˆæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼‰è¯ä¹¦æ¯” RSA è¯ä¹¦æ›´å®‰å…¨ã€æ›´å¿«é€Ÿï¼Œä¸”å¯†é’¥é•¿åº¦æ›´çŸ­ã€‚ç°ä»£æµè§ˆå™¨å‡æ”¯æŒ ECCã€‚\n1 2 3 4 5 6 7 8 # ç”³è¯· ECC æ¤­åœ†æ›²çº¿è¯ä¹¦ acme.sh --issue --dns dns_ali -d \u0026#39;*.example.com\u0026#39; --keylength ec-256 # å®‰è£… ECC è¯ä¹¦ (æ³¨æ„ä½¿ç”¨ --ecc å‚æ•°) acme.sh --install-cert -d \u0026#39;example.com\u0026#39; --ecc \\ --key-file /etc/nginx/ssl/example.com/ecc.key \\ --fullchain-file /etc/nginx/ssl/example.com/ecc.cer \\ --reloadcmd \u0026#34;systemctl reload nginx\u0026#34; åœ¨ Nginx é…ç½®ä¸­ï¼Œå°† ssl_certificate å’Œ ssl_certificate_key æŒ‡å‘å¯¹åº”çš„ ECC æ–‡ä»¶å³å¯ã€‚\n2. æ›´æ¢é»˜è®¤ CA acme.sh é»˜è®¤å¯èƒ½ä½¿ç”¨ ZeroSSLï¼Œä½ å¯ä»¥åˆ‡æ¢å› Let\u0026rsquo;s Encryptï¼š\n1 2 # è®¾ç½®é»˜è®¤ CA ä¸º Let\u0026#39;s Encrypt acme.sh --set-default-ca --server letsencrypt 3. è¯ä¹¦è‡ªåŠ¨éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ å¦‚æœä½ æœ‰å¤šå°æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨ç»­æœŸåè‡ªåŠ¨å°†è¯ä¹¦éƒ¨ç½²åˆ°è¿œç¨‹æœºå™¨ï¼š\n1 2 3 acme.sh --deploy -d \u0026#39;example.com\u0026#39; --deploy-hook ssh \\ --deploy-srv \u0026#34;user@server1:/path/to/ssl\u0026#34; \\ --deploy-srv \u0026#34;user@server2:/path/to/ssl\u0026#34; ğŸ¯ æ€»ç»“ä¸æç¤º é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ åº”è¯¥å·²ç»æˆåŠŸä½¿ç”¨ acme.sh å’Œé˜¿é‡Œäº‘ DNS API ç”³è¯·å¹¶éƒ¨ç½²äº†å…è´¹çš„æ³›åŸŸå SSL è¯ä¹¦ã€‚è‡ªåŠ¨åŒ–æ˜¯ acme.sh çš„æ ¸å¿ƒä»·å€¼ï¼Œä¸€æ—¦æ­£ç¡®è®¾ç½®ï¼Œè¯ä¹¦å°†åœ¨åå°é™é»˜æ›´æ–°ï¼Œä½ å‡ ä¹æ— éœ€å†æ‰‹åŠ¨å¹²é¢„ã€‚\næ ¸å¿ƒè¦ç‚¹å›é¡¾ï¼š\nä½¿ç”¨ DNS API æ˜¯å®ç°æ³›åŸŸåè¯ä¹¦è‡ªåŠ¨åŒ–çš„å…³é”®ã€‚ å®‰å…¨åœ°ç®¡ç† ä½ çš„é˜¿é‡Œäº‘ API å¯†é’¥ï¼ˆRAM å­è´¦æˆ· + account.confï¼‰ã€‚ --install-cert å‘½ä»¤æ¯”ç›´æ¥ä½¿ç”¨ ~/.acme.sh/ ç›®å½•ä¸‹çš„è¯ä¹¦æ›´å¯é ã€‚ --reloadcmd å‚æ•°å¿…é¡»æ­£ç¡®è®¾ç½®ï¼Œä»¥ç¡®ä¿ç»­æœŸåæœåŠ¡èƒ½åŠ è½½æ–°è¯ä¹¦ã€‚ å®šæœŸæ‰§è¡Œ acme.sh --list æˆ–æ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤è‡ªåŠ¨ç»­æœŸå·¥ä½œæ­£å¸¸ã€‚ ğŸ’¡ æç¤º: æ³›åŸŸåè¯ä¹¦ï¼ˆ*.example.comï¼‰ä¸èƒ½ä¿æŠ¤äºŒçº§ä»¥ä¸Šçš„å­åŸŸåã€‚ä¾‹å¦‚ï¼Œå®ƒèƒ½ä¿æŠ¤ blog.example.com å’Œ api.example.comï¼Œä½†ä¸èƒ½ä¿æŠ¤ dev.api.example.comã€‚å¦‚æœéœ€è¦ä¿æŠ¤å¤šçº§å­åŸŸåï¼Œéœ€è¦å•ç‹¬ä¸º api.example.com å†ç”³è¯·ä¸€ä¸ªæ³›åŸŸåè¯ä¹¦ *api.example.com æˆ–å…·ä½“åŸŸåè¯ä¹¦ã€‚\nå¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·é¦–å…ˆæŸ¥é˜… ~/.acme.sh/acme.sh.log æ—¥å¿—æ–‡ä»¶ï¼Œæˆ–è€…å¼€å¯ --debug æ¨¡å¼è¿è¡Œå‘½ä»¤ã€‚acme.sh çš„ GitHub Wiki ä¹Ÿæ˜¯éå¸¸å®è´µçš„èµ„æºã€‚\n","date":"2024-12-07T15:14:55+08:00","image":"https://file.meimolihan.eu.org/img/ssl-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9018956d/","title":"ä½¿ç”¨ acme.sh å’Œ é˜¿é‡Œäº‘ DNS ç”³è¯·ä¸ç®¡ç†å…è´¹æ³›åŸŸå SSL è¯ä¹¦æŒ‡å— ğŸ”"},{"content":"Proxmox VE Windows è™šæ‹Ÿæœº VirtIO é©±åŠ¨é…ç½® ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸º PVE ä¸­çš„ Windows è™šæ‹Ÿæœºä¸‹è½½å’Œå®‰è£… VirtIO é©±åŠ¨ç¨‹åºï¼Œä»¥æ˜¾è‘—æå‡è™šæ‹Ÿæœºçš„æ€§èƒ½å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚è®©æ‚¨çš„ Windows è™šæ‹Ÿæœºåœ¨ Proxmox VE ä¸Šé£èµ·æ¥ï¼ğŸš¤\nğŸ“– å¯¼èˆªç›®å½• ğŸŒŸ VirtIO é©±åŠ¨ç®€ä»‹ ğŸ“¥ VirtIO é©±åŠ¨ä¸‹è½½ ğŸ”§ é©±åŠ¨å®‰è£…æ­¥éª¤ âš™ï¸ é…ç½®ä¸ä¼˜åŒ– ğŸ› å¸¸è§é—®é¢˜è§£å†³ ğŸ”„ è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ’¡ æœ€ä½³å®è·µ ğŸ“Š æ€§èƒ½å¯¹æ¯” ğŸŒŸ ä¸€ã€VirtIO é©±åŠ¨ç®€ä»‹ VirtIO æ˜¯ä¸€ç§åŠè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ç‰¹å®šçš„é©±åŠ¨ç¨‹åºè®©è™šæ‹Ÿæœºèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ä¸å®¿ä¸»æœºç¡¬ä»¶é€šä¿¡ã€‚ä¸å®Œå…¨æ¨¡æ‹Ÿç¡¬ä»¶ç›¸æ¯”ï¼ŒVirtIO èƒ½æ˜¾è‘—é™ä½å¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚ğŸ¯\nä¸»è¦ä¼˜åŠ¿ï¼š\næ€§èƒ½æå‡ âš¡: ç£ç›˜ I/O å’Œç½‘ç»œååé‡å¯è·å¾—æ•°å€æå‡ã€‚ é™ä½ CPU å ç”¨ ğŸ’¾: æ›´é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶å‡å°‘ CPU èµ„æºæ¶ˆè€—ã€‚ å¢å¼ºåŠŸèƒ½ ğŸ”§: æ”¯æŒå†…å­˜æ°”çƒé©±åŠ¨ã€QEMU å®¢æˆ·æœºä»£ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚ æ ¸å¿ƒé©±åŠ¨ç»„ä»¶ï¼š\nviostor - å­˜å‚¨æ§åˆ¶å™¨é©±åŠ¨ï¼ˆå¿…å¤‡ï¼å¦åˆ™å®‰è£…æ—¶å¯èƒ½æ‰¾ä¸åˆ°ç£ç›˜ï¼‰ NetKVM - ç½‘ç»œé€‚é…å™¨é©±åŠ¨ï¼ˆå®‰è£…åæ‰èƒ½è·å¾—ç½‘ç»œè¿æ¥ï¼‰ balloon - å†…å­˜æ°”çƒé©±åŠ¨ï¼ˆå…è®¸åŠ¨æ€è°ƒæ•´å†…å­˜ï¼‰ viorng - éšæœºæ•°ç”Ÿæˆå™¨é©±åŠ¨ï¼ˆå¢å¼ºå®‰å…¨æ€§ï¼‰ qxldod - QXL æ˜¾ç¤ºé©±åŠ¨ï¼ˆæ”¹å–„å›¾å½¢ä½“éªŒï¼‰ Guest-agent - å®¢æˆ·æœºä»£ç†ï¼ˆæ”¯æŒä¼˜é›…å…³æœºç­‰æ“ä½œï¼‰ ğŸ“¥ äºŒã€VirtIO é©±åŠ¨ä¸‹è½½ å›½å†…åŠ é€Ÿä¸‹è½½åœ°å€ï¼ˆæ¨èï¼‰ 1 2 3 4 5 # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒç«™ï¼ˆå›½å†…è®¿é—®é€Ÿåº¦å¿«ï¼‰ https://mirrors.ustc.edu.cn/fedora/groups/virt/virtio-win/direct-downloads/archive-virtio/ # æ¸…åå¤§å­¦é•œåƒç«™ https://mirrors.tuna.tsinghua.edu.cn/fedora/groups/virt/virtio-win/direct-downloads/archive-virtio/ ä¸‹è½½æœ€æ–°æˆ–ç‰¹å®šç‰ˆæœ¬ 1 2 3 4 5 6 7 8 # ä½¿ç”¨ wget ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼ˆæ¨èï¼‰ wget https://mirrors.ustc.edu.cn/fedora/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-latest.iso # ä¸‹è½½ç‰¹å®šç‰ˆæœ¬ï¼ˆé€‚ç”¨äºéœ€è¦ç‰ˆæœ¬é”å®šçš„ç”Ÿäº§ç¯å¢ƒï¼‰ wget https://mirrors.ustc.edu.cn/fedora/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.240.iso # ä½¿ç”¨ curl ä¸‹è½½ curl -L -o virtio-win.iso https://mirrors.ustc.edu.cn/fedora/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-latest.iso å®˜æ–¹æºï¼ˆå¤‡ç”¨ï¼‰ å¦‚æœå›½å†…é•œåƒç«™ä¸å¯ç”¨ï¼Œå¯ä»¥ä»å®˜æ–¹æºä¸‹è½½ï¼š\n1 2 3 4 5 # Fedora å®˜æ–¹æºï¼ˆå¯èƒ½è¾ƒæ…¢ï¼‰ https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso # æˆ–ä½¿ç”¨ GitHub å‘å¸ƒé¡µ https://github.com/virtio-win/virtio-win-pkg-scripts ğŸ’¡ æç¤º: å»ºè®®å®šæœŸæ›´æ–° VirtIO é©±åŠ¨ä»¥è·å–æ€§èƒ½æ”¹è¿›å’Œæ–°åŠŸèƒ½ï¼Œä½†ç”Ÿäº§ç¯å¢ƒå»ºè®®æµ‹è¯•åå†å‡çº§ã€‚\nğŸ”§ ä¸‰ã€é©±åŠ¨å®‰è£…æ­¥éª¤ 1. ä¸Šä¼ é©±åŠ¨é•œåƒåˆ° PVE ä¸‹è½½å®Œæˆåï¼Œéœ€è¦å°† ISO æ–‡ä»¶ä¸Šä¼ åˆ° PVE æœåŠ¡å™¨ï¼š\n1 2 3 4 5 # ä¸Šä¼ åˆ° PVE çš„ ISO å­˜å‚¨ç›®å½• cp virtio-win-latest.iso /var/lib/vz/template/iso/ # æˆ–è€…ä½¿ç”¨ SCP ä»æœ¬åœ°è®¡ç®—æœºä¸Šä¼  scp virtio-win-latest.iso root@pve-server:/var/lib/vz/template/iso/ 2. åˆ›å»ºè™šæ‹Ÿæœºå¹¶æŒ‚è½½é©±åŠ¨é•œåƒ åœ¨ PVE ä¸­åˆ›å»º Windows è™šæ‹Ÿæœºæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å…³é”®é…ç½®ï¼š\næ“ä½œç³»ç»Ÿ: é€‰æ‹©æ­£ç¡®çš„ Windows ç‰ˆæœ¬ï¼ˆå¦‚ Windows 11/2022/2025ï¼‰ SCSI æ§åˆ¶å™¨: é€‰æ‹© VirtIO SCSI singleï¼ˆæ€§èƒ½æ›´å¥½ï¼‰æˆ– VirtIO Block ç£ç›˜ç¼“å­˜: è®¾ç½®ä¸º Write back ä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼ˆä½† \u0026ldquo;No cache\u0026rdquo; é»˜è®¤å€¼æ›´å®‰å…¨ï¼‰ ç½‘ç»œæ¨¡å‹: é€‰æ‹© VirtIO (åŠè™šæ‹ŸåŒ–) CPU ç±»å‹: é€‰æ‹© host ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ åˆ›å»ºè™šæ‹Ÿæœºåï¼Œæ·»åŠ  VirtIO é©±åŠ¨é•œåƒï¼š\nåœ¨ PVE Web ç•Œé¢ä¸­é€‰æ‹© Windows è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; â†’ \u0026ldquo;CD/DVD é©±åŠ¨å™¨\u0026rdquo; é€‰æ‹©å·²ä¸Šä¼ çš„ virtio-win ISO æ–‡ä»¶ æ€»çº¿ç±»å‹å»ºè®®é€‰æ‹© IDE æˆ– SATA å‹¾é€‰\u0026quot;CD/DVD\u0026quot;å¯åŠ¨ï¼ˆä»…åœ¨å®‰è£…é©±åŠ¨æ—¶éœ€è¦ï¼‰ æˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œï¼š\n1 qm set \u0026lt;VMID\u0026gt; --ide2 local:iso/virtio-win-latest.iso,media=cdrom 3. Windows å®‰è£…è¿‡ç¨‹ä¸­çš„é©±åŠ¨åŠ è½½ å®‰è£… Windows æ—¶ï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯åŠ è½½ viostor å­˜å‚¨é©±åŠ¨ï¼Œå¦åˆ™å¯èƒ½çœ‹ä¸åˆ°å¯ç”¨ç£ç›˜ï¼š\nå¯åŠ¨ Windows å®‰è£…è¿‡ç¨‹ å½“å‡ºç°\u0026quot;ä½ æƒ³å°† Windows å®‰è£…åœ¨å“ªé‡Œ?\u0026ldquo;ç•Œé¢æ—¶ï¼Œå¦‚æœçœ‹ä¸åˆ°ç£ç›˜ï¼Œç‚¹å‡»\u0026rdquo;åŠ è½½é©±åŠ¨ç¨‹åº\u0026quot; ç‚¹å‡»\u0026quot;æµè§ˆ\u0026ldquo;å¹¶é€‰æ‹© VirtIO é©±åŠ¨å…‰ç›˜ æ ¹æ®ä½ çš„ Windows ç‰ˆæœ¬å’Œæ¶æ„é€‰æ‹©åˆé€‚çš„è·¯å¾„ï¼š Windows 10/11/2022/2025: E:\\vioscsi\\2k25\\amd64 æˆ– E:\\vioscsi\\win10\\amd64 Windows 7/2008: E:\\vioscsi\\win7\\amd64 ï¼ˆæ³¨æ„ï¼šé©±åŠ¨å™¨ç›˜ç¬¦ E: å¯èƒ½å› é…ç½®è€Œå¼‚ï¼‰ é€‰æ‹©\u0026rdquo;Red Hat VirtIO SCSI pass-through controller\u0026ldquo;å¹¶ç‚¹å‡»\u0026quot;ä¸‹ä¸€æ­¥\u0026rdquo; ç°åœ¨åº”è¯¥èƒ½çœ‹åˆ°ä½ çš„ç£ç›˜äº†ï¼Œç»§ç»­å®Œæˆ Windows å®‰è£… 4. ç³»ç»Ÿå®‰è£…åçš„é©±åŠ¨å®‰è£… Windows å®‰è£…å®Œæˆåï¼Œå¯èƒ½è¿˜éœ€è¦å®‰è£…å…¶ä»– VirtIO é©±åŠ¨ï¼š\næ‰“å¼€è®¾å¤‡ç®¡ç†å™¨ï¼š\nå³å‡»å¼€å§‹èœå• â†’ è®¾å¤‡ç®¡ç†å™¨ æˆ–è¿è¡Œ devmgmt.msc æ£€æŸ¥æœªè¯†åˆ«çš„è®¾å¤‡ï¼š\næŸ¥çœ‹\u0026quot;å…¶ä»–è®¾å¤‡\u0026quot;ä¸­æ˜¯å¦æœ‰å¸¦é»„è‰²æ„Ÿå¹å·çš„è®¾å¤‡ å¸¸è§éœ€è¦æ‰‹åŠ¨å®‰è£…çš„é©±åŠ¨åŒ…æ‹¬ï¼š ä»¥å¤ªç½‘æ§åˆ¶å™¨ â†’ NetKVM é©±åŠ¨ PCI è®¾å¤‡ â†’ å¯èƒ½æ˜¯ viorng æˆ– balloon é©±åŠ¨ SCSI æ§åˆ¶å™¨ â†’ viostor é©±åŠ¨ï¼ˆå¦‚æœå®‰è£…æ—¶æœªå®Œå…¨åŠ è½½ï¼‰ æ›´æ–°é©±åŠ¨ç¨‹åºï¼š\nå³å‡»æœªçŸ¥è®¾å¤‡ â†’ \u0026ldquo;æ›´æ–°é©±åŠ¨ç¨‹åº\u0026rdquo; é€‰æ‹©\u0026quot;æµè§ˆæˆ‘çš„ç”µè„‘ä»¥æŸ¥æ‰¾é©±åŠ¨ç¨‹åº\u0026quot; è·¯å¾„é€‰æ‹© VirtIO å…‰ç›˜å¯¹åº”æ¶æ„ç›®å½•ï¼š 64ä½ç³»ç»Ÿ: E:\\drivers\\amd64\\[é©±åŠ¨ç±»å‹]\\[ç³»ç»Ÿç‰ˆæœ¬] æˆ– E:\\amd64 32ä½ç³»ç»Ÿ: E:\\drivers\\x86\\[é©±åŠ¨ç±»å‹]\\[ç³»ç»Ÿç‰ˆæœ¬] æˆ– E:\\x86 å®‰è£…æ‰€æœ‰å¿…è¦é©±åŠ¨ 5. ä½¿ç”¨ MSI å®‰è£…åŒ…ï¼ˆæ›¿ä»£æ–¹æ³•ï¼‰ VirtIO é©±åŠ¨å…‰ç›˜åŒ…å«è‡ªåŠ¨å®‰è£…åŒ…ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰é©±åŠ¨ï¼š\n1 2 3 4 5 6 7 8 # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦ # å®‰è£…æ‰€æœ‰é©±åŠ¨ï¼ˆ64ä½ç³»ç»Ÿï¼‰ msiexec /i E:\\virtio-win_amd64.msi /passive /norestart # æˆ–æŒ‡å®šå®‰è£…ç»„ä»¶ msiexec /i E:\\virtio-win_amd64.msi ADDLOCAL=ALL /passive # ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œå…‰ç›˜æ ¹ç›®å½•ä¸‹çš„ MSI å®‰è£…ç¨‹åº 6. å®‰è£… QEMU å®¢æˆ·æœºä»£ç† QEMU å®¢æˆ·æœºä»£ç†æä¾›é¢å¤–åŠŸèƒ½ï¼Œå¦‚æ­£å¸¸å…³æœºå’Œæ€§èƒ½ç›‘æ§ï¼š\n1 2 3 4 5 # åœ¨ Windows ä¸­è¿è¡Œå®‰è£…ç¨‹åº E:\\guest-agent\\qemu-ga-x86_64.msi # æˆ–ä½¿ç”¨ Chocolatey (å¦‚æœå·²å®‰è£…) choco install qemu-guest-agent åœ¨ PVE ä¸­å¯ç”¨ä»£ç†ï¼š\n1 qm set \u0026lt;VMID\u0026gt; --agent enabled=1 âš™ï¸ å››ã€é…ç½®ä¸ä¼˜åŒ– 1. ä¿®æ”¹è™šæ‹Ÿæœºé…ç½® ä¸ºäº†æé«˜æ€§èƒ½å’ŒåŠŸèƒ½å®Œæ•´æ€§ï¼Œå»ºè®®ä¼˜åŒ–è™šæ‹Ÿæœºé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è®¾ç½® VirtIO ç£ç›˜ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰ qm set \u0026lt;VMID\u0026gt; --virtio0 local-lvm:32,format=qcow2 # è®¾ç½® VirtIO ç½‘ç»œé€‚é…å™¨ qm set \u0026lt;VMID\u0026gt; --net0 virtio,bridge=vmbr0 # å¯ç”¨ QEMU å®¢æˆ·æœºä»£ç† qm set \u0026lt;VMID\u0026gt; --agent enabled=1 # é…ç½®å†…å­˜æ°”çƒé©±åŠ¨ï¼ˆå…è®¸åŠ¨æ€è°ƒæ•´å†…å­˜ï¼‰ qm set \u0026lt;VMID\u0026gt; --balloon 1024 # æ·»åŠ  SPICE æ˜¾ç¤ºï¼ˆæ”¹å–„å›¾å½¢æ€§èƒ½ï¼‰ qm set \u0026lt;VMID\u0026gt; --vga qxl 2. éªŒè¯é©±åŠ¨å®‰è£… å®‰è£…å®Œæˆåï¼Œæ£€æŸ¥é©±åŠ¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ VirtIO é©±åŠ¨çŠ¶æ€ Get-WindowsDriver -Online | Where-Object {$_.Provider -like \u0026#34;*Red Hat*\u0026#34;} # æ£€æŸ¥è®¾å¤‡çŠ¶æ€ Get-PnpDevice | Where-Object {$_.Manufacturer -like \u0026#34;*Red Hat*\u0026#34;} | Format-Table FriendlyName, Status # æ£€æŸ¥ç½‘ç»œé€‚é…å™¨ Get-NetAdapter | Where-Object {$_.InterfaceDescription -like \u0026#34;*VirtIO*\u0026#34;} # æ£€æŸ¥ç£ç›˜æ§åˆ¶å™¨ Get-Disk | Where-Object {$_.FriendlyName -like \u0026#34;*VirtIO*\u0026#34;} ğŸ› äº”ã€å¸¸è§é—®é¢˜è§£å†³ 1. é©±åŠ¨ç­¾åé—®é¢˜ï¼ˆWindows 10/11ï¼‰ ç°ä»£ Windows ç‰ˆæœ¬è¦æ±‚é©±åŠ¨å…·æœ‰æœ‰æ•ˆæ•°å­—ç­¾åï¼Œå¯èƒ½ä¼šé˜»æ­¢æœªç­¾åçš„ VirtIO é©±åŠ¨ï¼š\n1 2 3 4 5 6 7 8 9 10 # ä¸´æ—¶ç¦ç”¨é©±åŠ¨ç­¾åå¼ºåˆ¶ï¼ˆé‡å¯åæœ‰æ•ˆï¼‰ # æ–¹æ³•ä¸€ï¼šå¯åŠ¨æ—¶æŒ‰ F8 æˆ– Shift+F8 é€‰æ‹©\u0026#34;ç¦ç”¨é©±åŠ¨ç­¾åå¼ºåˆ¶\u0026#34; # æ–¹æ³•äºŒï¼šåœ¨ç®¡ç†å‘˜ PowerShell ä¸­ï¼š bcdedit /set testsigning on shutdown /r /t 0 # å®‰è£…åæ¢å¤é©±åŠ¨ç­¾åå¼ºåˆ¶ bcdedit /set testsigning off # æ³¨æ„ï¼šæŸäº› VirtIO é©±åŠ¨ç‰ˆæœ¬å·²æœ‰æœ‰æ•ˆç­¾åï¼Œå¯èƒ½ä¸éœ€è¦æ­¤æ­¥éª¤ 2. é©±åŠ¨æ— æ³•å®‰è£…æˆ–æ— æ³•è¯†åˆ«è®¾å¤‡ å¦‚æœè®¾å¤‡ç®¡ç†å™¨ä¸­æ²¡æœ‰æ˜¾ç¤ºæœªçŸ¥è®¾å¤‡ï¼Œæˆ–è€…é©±åŠ¨æ— æ³•å®‰è£…ï¼š\nç¡®ä¿æ­£ç¡®åŠ è½½é©±åŠ¨å…‰ç›˜ï¼š\n1 2 # æ£€æŸ¥ PVE ä¸­å…‰ç›˜æ˜¯å¦å·²è¿æ¥ qm config \u0026lt;VMID\u0026gt; | grep ide2 ä½¿ç”¨ pnputil å¼ºåˆ¶å®‰è£…ï¼š\n1 2 3 4 5 6 # ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ # å®‰è£…æ‰€æœ‰ INF é©±åŠ¨ pnputil /add-driver E:\\drivers\\amd64\\*.inf /install # æˆ–å®‰è£…ç‰¹å®šé©±åŠ¨ pnputil /add-driver E:\\drivers\\amd64\\netkvm.inf /install æ£€æŸ¥ç³»ç»Ÿæ¶æ„åŒ¹é…ï¼šç¡®ä¿ä¸‹è½½çš„é©±åŠ¨æ¶æ„ï¼ˆx86/amd64ï¼‰ä¸ Windows ç‰ˆæœ¬åŒ¹é…\n3. ç½‘ç»œé©±åŠ¨é—®é¢˜ å®‰è£… NetKVM é©±åŠ¨åç½‘ç»œä»ä¸æ­£å¸¸ï¼š\n1 2 3 4 5 6 7 8 9 10 # ç¦ç”¨å†å¯ç”¨ç½‘ç»œé€‚é…å™¨ Get-NetAdapter | Where-Object {$_.InterfaceDescription -like \u0026#34;*VirtIO*\u0026#34;} | Disable-NetAdapter -Confirm:$false Start-Sleep -Seconds 5 Get-NetAdapter | Where-Object {$_.InterfaceDescription -like \u0026#34;*VirtIO*\u0026#34;} | Enable-NetAdapter # æ£€æŸ¥ç½‘ç»œé…ç½® Get-NetIPConfiguration | Where-Object {$_.InterfaceDescription -like \u0026#34;*VirtIO*\u0026#34;} # å¦‚æœéœ€è¦ï¼Œæ‰‹åŠ¨è®¾ç½® IP åœ°å€ New-NetIPAddress -InterfaceAlias \u0026#34;Ethernet\u0026#34; -IPAddress \u0026#34;192.168.1.100\u0026#34; -PrefixLength 24 -DefaultGateway \u0026#34;192.168.1.1\u0026#34; 4. æ€§èƒ½é—®é¢˜ å¦‚æœæ€§èƒ½ä¸å¦‚é¢„æœŸï¼š\næ£€æŸ¥ç£ç›˜ç¼“å­˜è®¾ç½®ï¼šåœ¨ PVE ä¸­è®¾ç½®ä¸º Write backï¼ˆæ€§èƒ½æ›´å¥½ï¼‰æˆ– Noneï¼ˆæ›´å®‰å…¨ï¼‰ ç¡®è®¤ VirtIO é©±åŠ¨æ­£å¸¸åŠ è½½ï¼šæ£€æŸ¥è®¾å¤‡ç®¡ç†å™¨ä¸­æ²¡æœ‰é»„è‰²æ„Ÿå¹å· è°ƒæ•´ç£ç›˜ IO å‚æ•°ï¼šåœ¨ PVE ä¸­è®¾ç½® iothread å’Œ cache æ£€æŸ¥å†…å­˜åˆ†é…ï¼šç¡®ä¿ balloon é©±åŠ¨æ­£å¸¸å·¥ä½œï¼Œå…è®¸åŠ¨æ€å†…å­˜è°ƒæ•´ ğŸ”„ å…­ã€è‡ªåŠ¨åŒ–è„šæœ¬ 1. è‡ªåŠ¨ä¸‹è½½è„šæœ¬ï¼ˆPVE ç«¯ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #!/bin/bash # è‡ªåŠ¨ä¸‹è½½æœ€æ–° VirtIO é©±åŠ¨ MIRROR=\u0026#34;https://mirrors.ustc.edu.cn/fedora/groups/virt/virtio-win/direct-downloads/archive-virtio\u0026#34; ISO_DIR=\u0026#34;/var/lib/vz/template/iso\u0026#34; LOG_FILE=\u0026#34;/var/log/virtio-update.log\u0026#34; echo \u0026#34;$(date): å¼€å§‹æ£€æŸ¥ VirtIO é©±åŠ¨æ›´æ–°\u0026#34; | tee -a $LOG_FILE # è·å–æœ€æ–°ç‰ˆæœ¬å· LATEST_VERSION=$(curl -s $MIRROR/ | grep -oP \u0026#39;virtio-win-\\K\\d+\\.\\d+\\.\\d+\u0026#39; | sort -V | tail -1) if [ -z \u0026#34;$LATEST_VERSION\u0026#34; ]; then echo \u0026#34;$(date): æ— æ³•è·å–æœ€æ–°ç‰ˆæœ¬å·\u0026#34; | tee -a $LOG_FILE exit 1 fi # æ£€æŸ¥æ˜¯å¦å·²ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ if [ -f \u0026#34;$ISO_DIR/virtio-win-$LATEST_VERSION.iso\u0026#34; ]; then echo \u0026#34;$(date): å·²æ˜¯æœ€æ–°ç‰ˆæœ¬: $LATEST_VERSION\u0026#34; | tee -a $LOG_FILE exit 0 fi echo \u0026#34;$(date): å‘ç°æ–°ç‰ˆæœ¬: $LATEST_VERSIONï¼Œå¼€å§‹ä¸‹è½½...\u0026#34; | tee -a $LOG_FILE # ä¸‹è½½æ–°ç‰ˆæœ¬ wget -q --show-progress -O $ISO_DIR/virtio-win-$LATEST_VERSION.iso $MIRROR/virtio-win-$LATEST_VERSION.iso if [ $? -eq 0 ]; then echo \u0026#34;$(date): ä¸‹è½½æˆåŠŸ: virtio-win-$LATEST_VERSION.iso\u0026#34; | tee -a $LOG_FILE # æ›´æ–°æœ€æ–°ç‰ˆæœ¬ç¬¦å·é“¾æ¥ ln -sf $ISO_DIR/virtio-win-$LATEST_VERSION.iso $ISO_DIR/virtio-win-latest.iso # ä¿ç•™æ—§ç‰ˆæœ¬ï¼ˆä¿ç•™æœ€è¿‘3ä¸ªç‰ˆæœ¬ï¼‰ ls -t $ISO_DIR/virtio-win-* | tail -n +4 | xargs rm -f echo \u0026#34;$(date): æ›´æ–°å®Œæˆ\u0026#34; | tee -a $LOG_FILE else echo \u0026#34;$(date): ä¸‹è½½å¤±è´¥\u0026#34; | tee -a $LOG_FILE exit 1 fi 2. é©±åŠ¨å®‰è£…æ£€æŸ¥è„šæœ¬ï¼ˆWindows ç«¯ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 # Windows é©±åŠ¨æ£€æŸ¥è„šæœ¬ function Test-VirtIODrivers { $results = @() # æ£€æŸ¥å­˜å‚¨é©±åŠ¨ $storage = Get-Disk | Where-Object {$_.FriendlyName -like \u0026#34;*VirtIO*\u0026#34;} if ($storage) { $results += [PSCustomObject]@{ Component = \u0026#34;å­˜å‚¨æ§åˆ¶å™¨\u0026#34; Status = \u0026#34;å·²å®‰è£…\u0026#34; Details = $storage.FriendlyName } } else { $results += [PSCustomObject]@{ Component = \u0026#34;å­˜å‚¨æ§åˆ¶å™¨\u0026#34; Status = \u0026#34;æœªå®‰è£…\u0026#34; Details = \u0026#34;\u0026#34; } } # æ£€æŸ¥ç½‘ç»œé©±åŠ¨ $network = Get-NetAdapter | Where-Object {$_.InterfaceDescription -like \u0026#34;*VirtIO*\u0026#34;} if ($network) { $results += [PSCustomObject]@{ Component = \u0026#34;ç½‘ç»œé€‚é…å™¨\u0026#34; Status = \u0026#34;å·²å®‰è£…\u0026#34; Details = $network.InterfaceDescription } } else { $results += [PSCustomObject]@{ Component = \u0026#34;ç½‘ç»œé€‚é…å™¨\u0026#34; Status = \u0026#34;æœªå®‰è£…\u0026#34; Details = \u0026#34;\u0026#34; } } # æ£€æŸ¥æ°”çƒé©±åŠ¨ $balloon = Get-PnpDevice | Where-Object {$_.FriendlyName -like \u0026#34;*Balloon*\u0026#34;} if ($balloon) { $results += [PSCustomObject]@{ Component = \u0026#34;å†…å­˜æ°”çƒé©±åŠ¨\u0026#34; Status = \u0026#34;å·²å®‰è£…\u0026#34; Details = $balloon.FriendlyName } } else { $results += [PSCustomObject]@{ Component = \u0026#34;å†…å­˜æ°”çƒé©±åŠ¨\u0026#34; Status = \u0026#34;æœªå®‰è£…\u0026#34; Details = \u0026#34;\u0026#34; } } # æ˜¾ç¤ºç»“æœ $results | Format-Table -AutoSize # æ€»ç»“ $installed = ($results | Where-Object {$_.Status -eq \u0026#34;å·²å®‰è£…\u0026#34;}).Count $total = $results.Count Write-Host \u0026#34;é©±åŠ¨å®‰è£…çŠ¶æ€: $installed/$total\u0026#34; -ForegroundColor $(if ($installed -eq $total) {\u0026#34;Green\u0026#34;} else {\u0026#34;Yellow\u0026#34;}) if ($installed -ne $total) { Write-Host \u0026#34;å»ºè®®å®‰è£…ç¼ºå¤±çš„é©±åŠ¨ä»¥è·å–æœ€ä½³æ€§èƒ½\u0026#34; -ForegroundColor Red } } # è¿è¡Œæ£€æŸ¥ Test-VirtIODrivers ğŸ’¡ ä¸ƒã€æœ€ä½³å®è·µ 1. é©±åŠ¨ç‰ˆæœ¬ç®¡ç† 1 2 3 4 5 6 # ä¿ç•™å¤šä¸ªç‰ˆæœ¬ä»¥å¤‡å›æ»š # å®šæœŸæ¸…ç†æ—§ç‰ˆæœ¬ï¼ˆä¿ç•™æœ€è¿‘5ä¸ªç‰ˆæœ¬ï¼‰ ls -t /var/lib/vz/template/iso/virtio-win-* | tail -n +6 | xargs rm -f # åˆ›å»ºç‰ˆæœ¬ç¬¦å·é“¾æ¥ ln -sf /var/lib/vz/template/iso/virtio-win-0.1.240.iso /var/lib/vz/template/iso/virtio-win-production.iso 2. é›†æˆé©±åŠ¨åˆ° Windows å®‰è£…é•œåƒ å¯¹äºéœ€è¦é¢‘ç¹éƒ¨ç½²çš„ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘å°† VirtIO é©±åŠ¨é›†æˆåˆ° Windows å®‰è£…é•œåƒä¸­ï¼š\nä½¿ç”¨ DISM å·¥å…·å°†é©±åŠ¨æ³¨å…¥ Windows é•œåƒ æˆ–è€…ä½¿ç”¨ Windows Assessment and Deployment Kit (ADK) åˆ›å»ºé›†æˆé©±åŠ¨çš„å®‰è£…é•œåƒ ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ Driveræ³¨å…¥å·¥å…· ä¹Ÿå¯ä»¥ç®€åŒ–æ­¤è¿‡ç¨‹ 3. å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 # å¯¼å‡ºå·²å®‰è£…çš„é©±åŠ¨ï¼ˆä¾¿äºè¿ç§»æˆ–æ¢å¤ï¼‰ Export-WindowsDriver -Online -Destination D:\\DriversBackup # å¤‡ä»½é©±åŠ¨é…ç½® Get-WindowsDriver -Online | Where-Object {$_.Provider -like \u0026#34;*Red Hat*\u0026#34;} | Export-Clixml -Path \u0026#34;D:\\VirtIO-Drivers.xml\u0026#34; 4. ç›‘æ§ä¸ç»´æŠ¤ å®šæœŸæ£€æŸ¥é©±åŠ¨æ›´æ–°ï¼šè®¢é˜… virtio-win çš„ GitHub å‘å¸ƒé¡µæˆ–é‚®ä»¶åˆ—è¡¨ ç›‘æ§è™šæ‹Ÿæœºæ€§èƒ½ï¼šç¡®è®¤ VirtIO é©±åŠ¨æ­£å¸¸å·¥ä½œå¹¶æä¾›é¢„æœŸæ€§èƒ½æå‡ æµ‹è¯•æ–°ç‰ˆæœ¬ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°ç‰ˆæœ¬é©±åŠ¨ ğŸ“Š å…«ã€æ€§èƒ½å¯¹æ¯” å¯ç”¨ VirtIO å‰åçš„æ€§èƒ½æå‡ ç»„ä»¶ ä¼ ç»Ÿæ¨¡æ‹Ÿ VirtIO æå‡å¹…åº¦ è¯´æ˜ ç£ç›˜ I/O IDE: ~100 MB/s VirtIO: ~500 MB/s 5å€ é¡ºåºè¯»å†™æ€§èƒ½å¤§å¹…æå‡ ç½‘ç»œåå E1000: ~5 Gbps VirtIO: ~20 Gbps 4å€ ç½‘ç»œååé‡æ˜¾è‘—å¢åŠ  CPU å ç”¨ è¾ƒé«˜ è¾ƒä½ å‡å°‘ 30-50% æ›´é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶é™ä½CPUä½¿ç”¨ å†…å­˜æ•ˆç‡ ä¸€èˆ¬ æ”¯æŒæ°”çƒé©±åŠ¨ æ›´é«˜æ•ˆ å…è®¸åŠ¨æ€å†…å­˜è°ƒæ•´ï¼Œæé«˜å®¿ä¸»å†…å­˜åˆ©ç”¨ç‡ å¯åŠ¨æ—¶é—´ è¾ƒæ…¢ è¾ƒå¿« å‡å°‘ 20-30% é©±åŠ¨ä¼˜åŒ–åŠ é€Ÿç³»ç»Ÿå¯åŠ¨ ğŸš€ é‡è¦æç¤º: å¯¹äºç”Ÿäº§ç¯å¢ƒçš„ Windows è™šæ‹Ÿæœºï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ VirtIO é©±åŠ¨ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚æ€§èƒ½æå‡å¹…åº¦å¯èƒ½å› å…·ä½“ç¡¬ä»¶é…ç½®å’Œå·¥ä½œè´Ÿè½½è€Œå¼‚ã€‚\næ€§èƒ½ä¼˜åŒ–å»ºè®® ç£ç›˜é…ç½®ï¼š\nä½¿ç”¨ VirtIO SCSI è€Œä¸æ˜¯ VirtIO Blockï¼ˆæ”¯æŒæ›´å¤šåŠŸèƒ½å’Œæ›´å¥½æ€§èƒ½ï¼‰ å¯ç”¨ IO çº¿ç¨‹ï¼ˆiothread=1ï¼‰ æ ¹æ®å·¥ä½œè´Ÿè½½é€‰æ‹©åˆé€‚çš„ç¼“å­˜æ¨¡å¼ï¼ˆWrite back ç”¨äºæ€§èƒ½ï¼ŒNone ç”¨äºæ•°æ®å®‰å…¨ï¼‰ ç½‘ç»œé…ç½®ï¼š\nä½¿ç”¨å¤šé˜Ÿåˆ— VirtIO ç½‘ç»œï¼ˆmulti_vnet=onï¼‰ è°ƒæ•´é˜Ÿåˆ—å¤§å°ä»¥é€‚åº”é«˜ååé‡éœ€æ±‚ å†…å­˜ç®¡ç†ï¼š\nç¡®ä¿ balloon é©±åŠ¨æ­£ç¡®å®‰è£…å’Œè¿è¡Œ ç›‘æ§å†…å­˜æ°”çƒæ•ˆæœï¼Œé¿å…è¿‡åº¦è†¨èƒ€å½±å“æ€§èƒ½ ç›‘æ§ä¸è°ƒä¼˜ï¼š\nå®šæœŸæ£€æŸ¥æ€§èƒ½æŒ‡æ ‡ï¼Œç¡®è®¤ VirtIO é©±åŠ¨æ­£å¸¸å·¥ä½œ æ ¹æ®å®é™…å·¥ä½œè´Ÿè½½è°ƒæ•´é…ç½®å‚æ•° é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸä¸º PVE ä¸­çš„ Windows è™šæ‹Ÿæœºé…ç½® VirtIO é©±åŠ¨ï¼Œå¹¶è·å¾—æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚å¦‚æœåœ¨å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶ã€‚\n","date":"2024-12-07T15:13:43+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/9414e1f1/","title":"Proxmox VE Windows è™šæ‹Ÿæœº VirtIO é©±åŠ¨é…ç½® ğŸ’»"},{"content":"Proxmox VE å¯¼å…¥ç°æœ‰ç£ç›˜é•œåƒå®Œæ•´æ•™ç¨‹ ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ PVE ä¸­å¯¼å…¥å·²æœ‰çš„ç£ç›˜é•œåƒæ–‡ä»¶ï¼ˆqcow2/vmdk/rawï¼‰ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°è™šæ‹Ÿæœºã€‚æ¶µç›–ä»å‡†å¤‡ã€å¯¼å…¥ã€é…ç½®åˆ°æ•…éšœæ’é™¤çš„å…¨è¿‡ç¨‹ï¼ğŸ’¾\nğŸ“– å¯¼èˆªç›®å½• ğŸŒŸ å¯¼å…¥å‰å‡†å¤‡ ğŸ”§ ä½¿ç”¨ qm importdisk å‘½ä»¤å¯¼å…¥ âš™ï¸ åœ¨ PVE é¢æ¿ä¸­é…ç½®ç£ç›˜ ğŸ”„ æ ¼å¼è½¬æ¢ä¸å¤„ç† âš ï¸ æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µä¸ä¼˜åŒ– ğŸ¯ éªŒè¯å¯¼å…¥ç»“æœ ğŸŒŸ ä¸€ã€å¯¼å…¥å‰å‡†å¤‡ åœ¨å¼€å§‹å¯¼å…¥å‰ï¼Œåšå¥½å……åˆ†çš„å‡†å¤‡å·¥ä½œå¯ä»¥é¿å…å¾ˆå¤šå¸¸è§é—®é¢˜ã€‚\næ£€æŸ¥ç°æœ‰é•œåƒæ–‡ä»¶ä¿¡æ¯\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹é•œåƒæ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼ˆæ ¼å¼ã€å¤§å°ã€è™šæ‹Ÿå¤§å°ç­‰ï¼‰ qemu-img info /path/to/your-disk-image.qcow2 # æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆç¡®ä¿ PVE æœ‰è¯»å–æƒé™ï¼‰ ls -la /path/to/your-disk-image.* # éªŒè¯é•œåƒå®Œæ•´æ€§ï¼ˆç‰¹åˆ«æ˜¯ä»å¤–éƒ¨æ¥æºè·å–çš„é•œåƒï¼‰ qemu-img check /path/to/your-disk-image.qcow2 å‡†å¤‡å­˜å‚¨ä½ç½®\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹å¯ç”¨å­˜å‚¨åŠå…¶çŠ¶æ€ pvesm status # æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³ df -h /var/lib/vz/images/ # æŸ¥çœ‹å­˜å‚¨è¯¦ç»†ä¿¡æ¯ï¼ˆç±»å‹ã€å¯ç”¨ç©ºé—´ã€å†…å®¹ç±»å‹ï¼‰ pvesm list \u0026lt;storage-name\u0026gt; ç¡®å®šè™šæ‹ŸæœºIDå’Œå­˜å‚¨æ± \n1 2 3 4 5 # åˆ—å‡ºæ‰€æœ‰è™šæ‹ŸæœºåŠå…¶ID qm list # æŸ¥çœ‹ç‰¹å®šå­˜å‚¨æ± çš„è¯¦ç»†ä¿¡æ¯ pvesm status \u0026lt;storage-pool-name\u0026gt; ğŸ”§ äºŒã€ä½¿ç”¨ qm importdisk å‘½ä»¤å¯¼å…¥ qm importdisk æ˜¯ PVE ä¸­å¯¼å…¥ç£ç›˜é•œåƒçš„ä¸»è¦å‘½ä»¤ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»ã€‚\nåŸºæœ¬å‘½ä»¤è¯­æ³• 1 qm importdisk \u0026lt;vmid\u0026gt; \u0026lt;image-path\u0026gt; \u0026lt;storage-pool\u0026gt; --format=\u0026lt;disk-format\u0026gt; å‚æ•°è¯´æ˜è¡¨ å‚æ•° è¯´æ˜ ç¤ºä¾‹å€¼ \u0026lt;vmid\u0026gt; è™šæ‹ŸæœºID 102 \u0026lt;image-path\u0026gt; é•œåƒæ–‡ä»¶è·¯å¾„ /mnt/pve/NAS/images/ubuntu.qcow2 \u0026lt;storage-pool\u0026gt; å­˜å‚¨æ± åç§° NVME, local-lvm, SSD --format ç£ç›˜æ ¼å¼ qcow2, vmdk, raw --storage-type å­˜å‚¨ç±»å‹ lvmthin, zfspool, directory å®é™…å¯¼å…¥ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # å¯¼å…¥ qcow2 æ ¼å¼é•œåƒåˆ°æœ¬åœ°å­˜å‚¨ qm importdisk 102 /mnt/pve/NAS/images/ubuntu-18.04.qcow2 local-lvm --format=qcow2 # å¯¼å…¥ vmdk æ ¼å¼é•œåƒåˆ°ç‰¹å®šå­˜å‚¨æ±  qm importdisk 102 /mnt/pve/NAS/images/windows10.vmdk NVME --format=vmdk # å¯¼å…¥ raw æ ¼å¼é•œåƒï¼ˆæ³¨æ„ï¼šraw æ ¼å¼å¯¼å…¥å¯èƒ½è¾ƒå¿«ï¼Œä½†å ç”¨ç©ºé—´å¤§ï¼‰ qm importdisk 102 /mnt/pve/NAS/images/debian11.raw SSD --format=raw # å¯¼å…¥æ—¶æŒ‡å®šæ›´å¤šé€‰é¡¹ï¼ˆè¯¦ç»†è¾“å‡ºã€è¦†ç›–ç°æœ‰æ–‡ä»¶ï¼‰ qm importdisk 102 /path/to/image.qcow2 local-lvm --format=qcow2 --verbose --overwrite 1 å¯¼å…¥è¿‡ç¨‹è¾“å‡ºè§£æ 1 2 3 4 5 6 importing disk \u0026#39;ubuntu-18.04.vmdk\u0026#39; to VM 102 ... Formatting \u0026#39;/nvme/images/102/vm-102-disk-1.qcow2\u0026#39;, fmt=qcow2 size=10737418240 cluster_size=65536 preallocation=metadata lazy_refcounts=off refcount_bits=16 transferred: 0 bytes remaining: 10737418240 bytes total: 10737418240 bytes progression: 0.00 % ... transferred: 10737418240 bytes remaining: 0 bytes total: 10737418240 bytes progression: 100.00 % Successfully imported disk as \u0026#39;unused1:NVME:102/vm-102-disk-1.qcow2\u0026#39; transferred: å·²ä¼ è¾“çš„æ•°æ®é‡ remaining: å‰©ä½™å¾…ä¼ è¾“æ•°æ®é‡ progression: å®Œæˆç™¾åˆ†æ¯” Successfully imported disk as: å¯¼å…¥æˆåŠŸåçš„ç£ç›˜æ ‡è¯†ç¬¦ âš™ï¸ ä¸‰ã€åœ¨ PVE é¢æ¿ä¸­é…ç½®ç£ç›˜ å¯¼å…¥æˆåŠŸåï¼Œéœ€è¦é€šè¿‡ Web ç•Œé¢è¿›è¡Œç£ç›˜é…ç½®ã€‚\næŸ¥çœ‹æœªä½¿ç”¨ç£ç›˜\nåœ¨ PVE Web ç•Œé¢ä¸­ï¼Œé€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ æŸ¥æ‰¾\u0026quot;æœªä½¿ç”¨çš„ç£ç›˜\u0026quot;æ¡ç›®ï¼ˆé€šå¸¸ä½äºåˆ—è¡¨åº•éƒ¨ï¼‰ é…ç½®ç£ç›˜å‚æ•°\nåŒå‡»\u0026quot;æœªä½¿ç”¨çš„ç£ç›˜\u0026quot;æ¡ç›®ï¼Œå¼¹å‡ºé…ç½®å¯¹è¯æ¡† ä¸»è¦é…ç½®é€‰é¡¹ï¼š æ€»çº¿/è®¾å¤‡ç±»å‹ï¼š VirtIO Block (æ¨èç”¨äº Linuxï¼Œæ€§èƒ½æœ€ä½³) âš¡ SCSI (å…¼å®¹æ€§å¥½ï¼Œé€‚åˆ Windows) SATA (é€šç”¨æ€§å¼º) IDE (ä»…ç”¨äºæ—§ç³»ç»Ÿå…¼å®¹) ç¼“å­˜æ¨¡å¼ï¼š None (é»˜è®¤ï¼Œæœ€å®‰å…¨) Write back (æ€§èƒ½æ›´å¥½ï¼Œä½†æ–­ç”µå¯èƒ½ä¸¢å¤±æ•°æ®) Writethrough (æŠ˜ä¸­æ–¹æ¡ˆ) å…¶ä»–é€‰é¡¹ï¼š IOThread (é«˜æ€§èƒ½åœºæ™¯å¯ç”¨) SSDä»¿çœŸ (å½“åç«¯å­˜å‚¨æ˜¯SSDæ—¶å¯ç”¨) ä¸¢å¼ƒ (å¯ç”¨TRIM/discardæ”¯æŒ) æ·»åŠ ç£ç›˜\nç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot;æŒ‰é’®ï¼Œç£ç›˜å°†æ­£å¼é™„åŠ åˆ°è™šæ‹Ÿæœº ç³»ç»Ÿä¼šè‡ªåŠ¨æ›´æ–°è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ï¼ˆ/etc/pve/qemu-server/\u0026lt;vmid\u0026gt;.confï¼‰ è°ƒæ•´å¯åŠ¨é¡ºåºï¼ˆå¦‚éœ€è¦ï¼‰\nå¦‚æœå¯¼å…¥çš„ç£ç›˜åŒ…å«æ“ä½œç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦è°ƒæ•´å¯åŠ¨é¡ºåº è¿›å…¥\u0026quot;é€‰é¡¹\u0026quot;é€‰é¡¹å¡ â†’ \u0026ldquo;å¼•å¯¼é¡ºåº\u0026rdquo; â†’ è°ƒæ•´ç£ç›˜é¡ºåº ğŸ”„ å››ã€æ ¼å¼è½¬æ¢ä¸å¤„ç† ä¸åŒæ ¼å¼çš„é•œåƒæ–‡ä»¶å¯èƒ½éœ€è¦å…ˆè½¬æ¢å†å¯¼å…¥ã€‚\n1. ä½¿ç”¨ qemu-img è½¬æ¢æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # VMDK è½¬ QCOW2ï¼ˆå¸¸è§äº VMware è™šæ‹Ÿæœºï¼‰ qemu-img convert -f vmdk -O qcow2 source.vmdk target.qcow2 # VDI è½¬ QCOW2ï¼ˆå¸¸è§äº VirtualBox è™šæ‹Ÿæœºï¼‰ qemu-img convert -f vdi -O qcow2 source.vdi target.qcow2 # RAW è½¬ QCOW2 qemu-img convert -f raw -O qcow2 source.raw target.qcow2 # QCOW2 è½¬ VMDK qemu-img convert -f qcow2 -O vmdk source.qcow2 target.vmdk # è½¬æ¢æ—¶å‹ç¼©é•œåƒï¼ˆèŠ‚çœç©ºé—´ï¼‰ qemu-img convert -c -f vmdk -O qcow2 source.vmdk compressed.qcow2 2. Web ç•Œé¢åœ¨çº¿è½¬æ¢ PVE æä¾› Web ç•Œé¢è¿›è¡Œç£ç›˜è¿ç§»å’Œè½¬æ¢ï¼Œæ— éœ€åœæœºï¼š\né€‰æ‹©è™šæ‹Ÿæœº â†’ \u0026ldquo;ç¡¬ä»¶\u0026rdquo; â†’ é€‰æ‹©ç£ç›˜ â†’ \u0026ldquo;ç£ç›˜æ“ä½œ\u0026rdquo; â†’ \u0026ldquo;è¿ç§»\u0026rdquo; é€‰æ‹©ç›®æ ‡å­˜å‚¨ é€‰æ‹©ç›®æ ‡æ ¼å¼ï¼ˆqcow2/vmdk/rawï¼‰ æ˜¯å¦åˆ é™¤æºç£ç›˜ï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼‰ 3. å¤„ç†ç‰¹æ®Šé•œåƒæ ¼å¼ OVA/OVF æ ¼å¼ï¼šå…ˆè§£å‹è·å– VMDK æ–‡ä»¶ 1 tar -xvf package.ova VHD/VHDX æ ¼å¼ï¼šä½¿ç”¨ qemu-img è½¬æ¢ 1 qemu-img convert -f vhdx -O qcow2 source.vhdx target.qcow2 âš ï¸ äº”ã€æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ æƒé™é—®é¢˜\n1 2 3 4 5 6 7 8 # ç¡®ä¿é•œåƒæ–‡ä»¶å¯è¯» chmod 644 /path/to/disk-image.qcow2 # å¦‚æœä½¿ç”¨ NFS å­˜å‚¨ï¼Œæ£€æŸ¥æŒ‚è½½é€‰é¡¹å’Œæƒé™ ls -la /mnt/pve/NAS/images/ # æ£€æŸ¥ PVE å­˜å‚¨é…ç½® cat /etc/pve/storage.cfg ç©ºé—´ä¸è¶³\n1 2 3 4 5 6 7 8 # æ£€æŸ¥å­˜å‚¨ç©ºé—´ df -h /var/lib/vz/images/ # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -f /var/tmp/qemu-import-* # æ‰©å±•å­˜å‚¨ç©ºé—´ï¼ˆå¦‚æœæ˜¯ LVMï¼‰ lvextend -L +50G /dev/pve/data å¯¼å…¥å¤±è´¥\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ qm importdisk 102 image.qcow2 local-lvm --format=qcow2 --verbose # æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— journalctl -f -u pvedaemon # æ£€æŸ¥å­˜å‚¨çŠ¶æ€ pvesm status ç£ç›˜è¯†åˆ«é—®é¢˜\n1 2 3 4 5 6 7 8 # å¼ºåˆ¶åˆ·æ–°ç£ç›˜é…ç½® qm rescan --vmid 102 # é‡æ–°æ£€æµ‹æœªä½¿ç”¨ç£ç›˜ qm disk rescan # æ‰‹åŠ¨æ·»åŠ ç£ç›˜åˆ°é…ç½®æ–‡ä»¶ qm set 102 --scsi1 /path/to/disk.qcow2 æ€§èƒ½é—®é¢˜\n1 2 3 4 5 6 # å¦‚æœå¯¼å…¥é€Ÿåº¦æ…¢ï¼Œå°è¯•ç›´æ¥å¤åˆ¶ cp source-image.qcow2 /var/lib/vz/images/102/ qm set 102 --scsi0 local:102/vm-102-disk-0.qcow2 # è°ƒæ•´ç¼“å­˜ç­–ç•¥ï¼ˆæ€§èƒ½ä¸å®‰å…¨æƒè¡¡ï¼‰ qm set 102 --scsi0 local:102/vm-102-disk-0.qcow2,cache=writeback Windows è™šæ‹Ÿæœºç‰¹åˆ«æ³¨æ„äº‹é¡¹ é©±åŠ¨å…¼å®¹æ€§ï¼šWindows å¯¹ç¡¬ä»¶å˜åŒ–æ•æ„Ÿï¼Œå¯¼å…¥åå¯èƒ½éœ€è¦é‡æ–°å®‰è£…é©±åŠ¨ ç£ç›˜æ§åˆ¶å™¨ç±»å‹ï¼šå¯¼å…¥å‰æœ€å¥½æ›´æ”¹ä¸º IDEï¼Œå¯¼å…¥åå†æ”¹ä¸º VirtIO å¹¶å®‰è£…é©±åŠ¨ æ¿€æ´»é—®é¢˜ï¼šç¡¬ä»¶å˜åŒ–å¯èƒ½å¯¼è‡´ Windows éœ€è¦é‡æ–°æ¿€æ´» ğŸ’¡ å…­ã€æœ€ä½³å®è·µä¸ä¼˜åŒ– é•œåƒé¢„å¤„ç†\n1 2 3 4 5 6 7 8 # å‹ç¼©é•œåƒå¤§å°ï¼ˆç§»é™¤ç©ºç™½ç©ºé—´ï¼‰ qemu-img convert -c -O qcow2 source.qcow2 compressed.qcow2 # è°ƒæ•´ç£ç›˜å¤§å° qemu-img resize source.qcow2 +10G # æ£€æŸ¥å¹¶ä¿®å¤é•œåƒç¢ç‰‡ qemu-img check -r all source.qcow2 å­˜å‚¨ä¼˜åŒ–\n1 2 3 4 5 6 7 8 # ä½¿ç”¨æ€§èƒ½æ›´å¥½çš„å­˜å‚¨æ±  qm importdisk 102 image.qcow2 NVME --format=qcow2 # å¯ç”¨ SSD ç‰¹æ€§ï¼ˆå½“åç«¯å­˜å‚¨æ˜¯ SSD æ—¶ï¼‰ qm set 102 --scsi1 NVME:102/vm-102-disk-1.qcow2,ssd=1 # ä½¿ç”¨ IO çº¿ç¨‹ï¼ˆé«˜æ€§èƒ½åœºæ™¯ï¼‰ qm set 102 --scsi1 NVME:102/vm-102-disk-1.qcow2,iothread=1 å¤‡ä»½ç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 # å¤‡ä»½åŸå§‹é•œåƒæ–‡ä»¶ cp /path/to/original-image.qcow2 /backup/ # åˆ›å»ºå¯¼å…¥è®°å½• echo \u0026#34;å¯¼å…¥æ—¶é—´: $(date)\u0026#34; \u0026gt;\u0026gt; /backup/import-log.txt echo \u0026#34;æºæ–‡ä»¶: $IMAGE_PATH\u0026#34; \u0026gt;\u0026gt; /backup/import-log.txt echo \u0026#34;ç›®æ ‡VM: $VMID\u0026#34; \u0026gt;\u0026gt; /backup/import-log.txt # å¯¼å…¥ååˆ›å»ºå¿«ç…§ qm snapshot 102 post-import-clean æ‰¹é‡å¯¼å…¥è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/bash # æ‰¹é‡å¯¼å…¥ç£ç›˜é•œåƒè„šæœ¬ VM_ID=$1 IMAGE_DIR=$2 STORAGE_POOL=$3 for image in $IMAGE_DIR/*.{qcow2,vmdk,raw}; do if [ -f \u0026#34;$image\u0026#34; ]; then echo \u0026#34;æ­£åœ¨å¯¼å…¥: $image\u0026#34; format=\u0026#34;${image##*.}\u0026#34; qm importdisk $VM_ID \u0026#34;$image\u0026#34; $STORAGE_POOL --format=$format if [ $? -eq 0 ]; then echo \u0026#34;æˆåŠŸå¯¼å…¥: $image\u0026#34; echo \u0026#34;$(date): æˆåŠŸå¯¼å…¥ $image åˆ° VM $VM_ID\u0026#34; \u0026gt;\u0026gt; /var/log/pve-import.log else echo \u0026#34;å¯¼å…¥å¤±è´¥: $image\u0026#34; echo \u0026#34;$(date): å¯¼å…¥ $image åˆ° VM $VM_ID å¤±è´¥\u0026#34; \u0026gt;\u0026gt; /var/log/pve-import.log fi fi done ğŸ¯ ä¸ƒã€éªŒè¯å¯¼å…¥ç»“æœ å¯¼å…¥å®Œæˆåï¼Œéœ€è¦éªŒè¯ç£ç›˜æ˜¯å¦æ­£ç¡®é™„åŠ å¹¶å¯æ­£å¸¸ä½¿ç”¨ã€‚\næ£€æŸ¥è™šæ‹Ÿæœºé…ç½®\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹è™šæ‹Ÿæœºç£ç›˜é…ç½® qm config 102 # æ£€æŸ¥ç£ç›˜æ–‡ä»¶æ˜¯å¦å­˜åœ¨ ls -la /var/lib/vz/images/102/ # éªŒè¯ç£ç›˜æ ¼å¼å’Œå¤§å° qemu-img info /var/lib/vz/images/102/vm-102-disk-1.qcow2 å¯åŠ¨æµ‹è¯•\n1 2 3 4 5 6 7 8 9 10 11 # å¯åŠ¨è™šæ‹Ÿæœº qm start 102 # ç›‘æ§å¯åŠ¨è¿‡ç¨‹ qm monitor 102 # æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º qm terminal 102 # æ£€æŸ¥è™šæ‹Ÿæœºå†…ç£ç›˜è¯†åˆ«æƒ…å†µ qm guest exec 102 lsblk æ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰\n1 2 3 4 5 6 7 8 9 # åœ¨è™šæ‹Ÿæœºå†…æµ‹è¯•ç£ç›˜æ€§èƒ½ # å¯¹äº Linux ç³»ç»Ÿ: fio --filename=/dev/sdb --rw=read --bs=4k --iodepth=64 --size=1G --name=test # æˆ–è€…ä½¿ç”¨ dd è¿›è¡Œç®€å•æµ‹è¯• dd if=/dev/zero of=./test.bin bs=1M count=1024 status=progress # å¯¹äº Windows ç³»ç»Ÿ: # ä½¿ç”¨ CrystalDiskMark æˆ–ç±»ä¼¼å·¥å…·è¿›è¡Œæµ‹è¯• åˆ›å»ºåŸºå‡†å¿«ç…§\n1 2 3 4 5 # å¯¼å…¥éªŒè¯æˆåŠŸååˆ›å»ºåŸºå‡†å¿«ç…§ qm snapshot 102 base-install # æŸ¥çœ‹å¿«ç…§åˆ—è¡¨ qm listsnapshot 102 ğŸš€ æç¤º: å¯¼å…¥å®Œæˆåï¼Œå»ºè®®å…ˆåˆ›å»ºè™šæ‹Ÿæœºå¿«ç…§ï¼Œç„¶åå†è¿›è¡Œç³»ç»Ÿé…ç½®æ›´æ”¹ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®åœ¨éé«˜å³°æ—¶æ®µè¿›è¡Œå¯¼å…¥æ“ä½œï¼Œå¹¶ç¡®ä¿æœ‰å®Œæ•´çš„å¤‡ä»½ã€‚\né€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸå°†ç°æœ‰çš„ç£ç›˜é•œåƒå¯¼å…¥åˆ° PVE è™šæ‹Ÿæœºä¸­ã€‚å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—è·å–æ›´å¤šä¿¡æ¯ã€‚\n","date":"2024-12-07T15:13:04+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b1da9660/","title":"Proxmox VE å¯¼å…¥ç°æœ‰ç£ç›˜é•œåƒå®Œæ•´æ•™ç¨‹ ğŸ’¾"},{"content":"FFmpeg æ‰¹å¤„ç†è„šæœ¬å¤§å…¨ ğŸ¬ FFmpeg ä¸‹è½½åœ°å€ï¼šhttps://github.com/BtbN/FFmpeg-Builds/releases\nğŸ”§ ä½¿ç”¨å‰è¯·å°† ffmpeg.exe æ”¾åœ¨ç›®æ ‡æ–‡ä»¶åŒä¸€ç›®å½•ä¸‹\nâœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹ç‚¹ ğŸ”„ æ ¼å¼è½¬æ¢ï¼šæ”¯æŒå¤šç§éŸ³è§†é¢‘æ ¼å¼äº’è½¬ï¼ŒåŒ…æ‹¬ MP4ã€TSã€MKV ç­‰å¸¸è§æ ¼å¼ âœ‚ï¸ å‰ªè¾‘å¤„ç†ï¼šç²¾ç¡®å»é™¤ç‰‡å¤´ç‰‡å°¾ï¼Œæ·»åŠ æ·¡å…¥æ·¡å‡ºæ•ˆæœ ğŸ“¸ ç”»é¢æ•è·ï¼šçµæ´»çš„è§†é¢‘æˆªå›¾åŠŸèƒ½ï¼Œæ”¯æŒæ—¶é—´ç‚¹æˆªå›¾å’Œå°é¢æå– ğŸ” å…ƒæ•°æ®ç®¡ç†ï¼šæŸ¥çœ‹å’Œæ¸…ç†è§†é¢‘å…ƒæ•°æ®ä¿¡æ¯ ğŸš« æ°´å°å»é™¤ï¼šç²¾å‡†å®šä½å¹¶å»é™¤è§†é¢‘ä¸­çš„æ°´å° ğŸ–¼ï¸ å°é¢æ·»åŠ ï¼šä¸ºè§†é¢‘æ–‡ä»¶æ·»åŠ è‡ªå®šä¹‰å°é¢å›¾ç‰‡ ğŸ“¦ è§†é¢‘å‹ç¼©ï¼šä½¿ç”¨ H264/H265 ç¼–ç é«˜æ•ˆå‹ç¼©è§†é¢‘ä½“ç§¯ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ“¦ ä¸€ã€éŸ³è§†é¢‘æ ¼å¼è½¬æ¢ âœ‚ï¸ äºŒã€å»ç‰‡å¤´ç‰‡å°¾ ğŸï¸ ä¸‰ã€æ·¡å…¥æ·¡å‡º ğŸ“¸ å››ã€è§†é¢‘æˆªå›¾ ğŸ” äº”ã€è§†é¢‘å…ƒæ•°æ® ğŸš« å…­ã€å»æ°´å° ğŸ–¼ï¸ ä¸ƒã€æ·»åŠ å°é¢ ğŸ“¦ å…«ã€è§†é¢‘å‹ç¼© ğŸ“¦ ä¸€ã€éŸ³è§†é¢‘æ ¼å¼è½¬æ¢ 1. ğŸ”„ åŒå‡»-è§†é¢‘æ ¼å¼è½¬æ¢ä¸ºMP4 1 2 3 4 5 6 7 8 9 10 11 12 @echo off \u0026amp; setlocal enabledelayedexpansion for %%a in (*.ts *.mkv *.mov *.avi *.flv *.mpg *.rmvb *.wmv) do ( set \u0026#34;filename=%%~na\u0026#34; ffmpeg -i \u0026#34;%%a\u0026#34; -c copy -y \u0026#34;!filename!.mp4\u0026#34; ) rem pause exit rem åŒå‡»è¿è¡Œï¼Œç›®å½•ä¸‹çš„è§†é¢‘æ–‡ä»¶è½¬æ¢æˆMP4 rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šæ­¤è„šæœ¬å¯å°†å¤šç§è§†é¢‘æ ¼å¼ï¼ˆTSã€MKVã€MOVã€AVIã€FLVã€MPGã€RMVBã€WMVï¼‰è½¬æ¢ä¸ºMP4æ ¼å¼ï¼Œä¿æŒåŸè§†é¢‘è´¨é‡å’Œç¼–ç ï¼Œä»…è½¬æ¢å®¹å™¨æ ¼å¼ã€‚\n2. ğŸ”„ åŒå‡»-è§†é¢‘æ ¼å¼è½¬æ¢ä¸ºTS 1 2 3 4 5 6 7 8 9 10 11 12 @echo off \u0026amp; setlocal enabledelayedexpansion for %%a in (*.mp4 *.mkv *.mov *.avi *.flv *.mpg *.rmvb *.wmv) do ( set \u0026#34;filename=%%~na\u0026#34; ffmpeg -i \u0026#34;%%a\u0026#34; -c copy -y \u0026#34;!filename!.ts\u0026#34; ) rem pause exit rem åŒå‡»è¿è¡Œï¼Œç›®å½•ä¸‹çš„è§†é¢‘æ–‡ä»¶è½¬æ¢æˆts rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šå°†å¤šç§è§†é¢‘æ ¼å¼è½¬æ¢ä¸ºTSæµæ ¼å¼ï¼Œé€‚åˆæµåª’ä½“ä¼ è¾“å’Œæ’­æ”¾ã€‚\n3. ğŸ–¼ï¸ æ‹–å…¥-è§†é¢‘æ ¼å¼è½¬æ¢ä¸ºJPG 1 2 3 4 5 6 7 8 9 10 @echo off cd /d \u0026#34;%~dp0\u0026#34; for %%F in (%*) do call :main %%F rem pause exit :main ffmpeg -i \u0026#34;%~1\u0026#34; -c copy \u0026#34;%~n1\u0026#34;.jpg -y rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šå°†è§†é¢‘æ–‡ä»¶æ‹–æ”¾åˆ°æ­¤è„šæœ¬ä¸Šï¼Œä¼šè‡ªåŠ¨æå–è§†é¢‘ç¬¬ä¸€å¸§ä¿å­˜ä¸ºJPGå›¾ç‰‡ã€‚é€‚ç”¨äºå¿«é€Ÿè·å–è§†é¢‘å°é¢ã€‚\nâœ‚ï¸ äºŒã€å»ç‰‡å¤´ç‰‡å°¾ 1. ğŸ“ åŒå‡»+æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå»ç‰‡å¤´ç‰‡å°¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @echo off \u0026amp; setlocal enabledelayedexpansion rem è®¾å®šç‰‡å¤´ç‰‡å°¾é•¿åº¦ï¼Œæ ¼å¼ä¸º HH:mm:ss.fff set \u0026#34;s1=00:00:05.0\u0026#34; :: éœ€å»é™¤çš„ç‰‡å¤´æ—¶é—´ set \u0026#34;s2=00:00:00.0\u0026#34; :: éœ€å»é™¤çš„ç‰‡å°¾æ—¶é—´ for /f \u0026#34;tokens=1-4delims=:.\u0026#34; %%a in (\u0026#34;%s2%\u0026#34;) do ( set /a \u0026#34;t2=(1%%a %% 100 *3600 + 1%%b %% 100 * 60 + 1%%c %% 100) * 1000 + 1%%d %% 1000\u0026#34; ) md å»ç‰‡å¤´+å°¾ 2\u0026gt;nul for %%i in (*.avi *.mkv *.mp4 *.flv) do ( for /f \u0026#34;tokens=2-5delims=:., \u0026#34; %%a in (\u0026#39;ffmpeg -i \u0026#34;%%i\u0026#34; 2^\u0026gt;^\u0026amp;1 ^| find \u0026#34;Duration:\u0026#34;\u0026#39;) do ( set /a \u0026#34;t=(1%%a%%100*3600+1%%b%%100*60+1%%c%%100)*1000+1%%d0%%1000,t-=t2,ms=t%%1000,t/=1000\u0026#34; set /a h=t/3600,m=t%%3600/60,s=t%%60,h+=100,m+=100,s+=100,ms+=1000 set \u0026#34;t=!h:~1!:!m:~1!:!s:~1!.!ms:~1!\u0026#34; ffmpeg -ss !s1! -to !t! -accurate_seek -i \u0026#34;%%i\u0026#34; -c copy -avoid_negative_ts 1 \u0026#34;å»ç‰‡å¤´+å°¾\\%%i\u0026#34; -y ) ) rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šæ‰¹é‡å»é™¤è§†é¢‘æ–‡ä»¶çš„ç‰‡å¤´å’Œç‰‡å°¾ï¼Œå¤„ç†åçš„è§†é¢‘ä¿å­˜åœ¨æ–°å»ºçš„\u0026quot;å»ç‰‡å¤´+å°¾\u0026quot;æ–‡ä»¶å¤¹ä¸­ã€‚\n2. ğŸ”– åŒå‡»+åŠ åç¼€ï¼Œå»ç‰‡å¤´ç‰‡å°¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @echo off \u0026amp; setlocal enabledelayedexpansion rem è®¾å®šç‰‡å¤´ç‰‡å°¾é•¿åº¦ï¼Œæ ¼å¼ä¸º HH:mm:ss.fff set \u0026#34;s1=00:00:10.0\u0026#34; :: éœ€å»é™¤çš„ç‰‡å¤´æ—¶é—´ set \u0026#34;s2=00:00:00.0\u0026#34; :: éœ€å»é™¤çš„ç‰‡å°¾æ—¶é—´ for /f \u0026#34;tokens=1-4delims=:.\u0026#34; %%a in (\u0026#34;%s2%\u0026#34;) do ( set /a \u0026#34;t2=(1%%a %% 100 *3600 + 1%%b %% 100 * 60 + 1%%c %% 100) * 1000 + 1%%d %% 1000\u0026#34; ) for %%i in (*.avi *.mkv *.mp4 *.flv) do ( for /f \u0026#34;tokens=2-5delims=:., \u0026#34; %%a in (\u0026#39;ffmpeg -i \u0026#34;%%i\u0026#34; 2^\u0026gt;^\u0026amp;1 ^| find \u0026#34;Duration:\u0026#34;\u0026#39;) do ( set /a \u0026#34;t=(1%%a%%100*3600+1%%b%%100*60+1%%c%%100)*1000+1%%d0%%1000,t-=t2,ms=t%%1000,t/=1000\u0026#34; set /a h=t/3600,m=t%%3600/60,s=t%%60,h+=100,m+=100,s+=100,ms+=1000 set \u0026#34;t=!h:~1!:!m:~1!:!s:~1!.!ms:~1!\u0026#34; set \u0026#34;filename=%%~na\u0026#34; ffmpeg -ss !s1! -to !t! -accurate_seek -i \u0026#34;%%i\u0026#34; -c copy -avoid_negative_ts 1 -y \u0026#34;!%%~dpi!%%~ni-ok.mp4\u0026#34; ) ) rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šå»é™¤è§†é¢‘ç‰‡å¤´ç‰‡å°¾åï¼Œåœ¨åŸæ–‡ä»¶ååæ·»åŠ \u0026quot;-ok\u0026quot;åç¼€ï¼Œä¿ç•™åœ¨åŸç›®å½•ã€‚\nğŸï¸ ä¸‰ã€æ·¡å…¥æ·¡å‡º 1. ğŸ“ åŒå‡»-æ–°å»ºæ–‡ä»¶å¤¹-æ·¡å…¥æ·¡å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @echo off \u0026amp; setlocal enabledelayedexpansion rem ====================================== set \u0026#34;s1=0\u0026#34; :: æ·¡å…¥å¼€å§‹æ—¶é—´ set \u0026#34;s2=5\u0026#34; :: æ·¡å…¥æŒç»­æ—¶é—´ set \u0026#34;s3=5\u0026#34; :: æ·¡å‡ºå¼€å§‹æ—¶é—´ set \u0026#34;s4=5\u0026#34; :: æ·¡å‡ºæŒç»­æ—¶é—´ rem ====================================== for /f \u0026#34;tokens=1-4delims=:.\u0026#34; %%a in (\u0026#34;%s3%\u0026#34;) do ( set /a \u0026#34;t2=(\u0026#34;%s3%\u0026#34;) * 1000 + 1%%d %% 1000\u0026#34; ) md æ·¡å…¥æ·¡å‡º 2\u0026gt;nul for %%i in (*.avi *.mkv *.mp4 *.flv) do ( for /f \u0026#34;tokens=2-5delims=:., \u0026#34; %%a in (\u0026#39;ffmpeg -i \u0026#34;%%i\u0026#34; 2^\u0026gt;^\u0026amp;1 ^| find \u0026#34;Duration:\u0026#34;\u0026#39;) do ( set /a \u0026#34;t=(1%%a%%100*3600+1%%b%%100*60+1%%c%%100)*1000+1%%d0%%1000,t-=t2,ms=t%%1000,t/=1000 ffmpeg -i \u0026#34;%%i\u0026#34; -vf \u0026#34;fade=t=in:st=!s1!:d=!s2!,fade=t=out:st=!t!:d=!s4!\u0026#34; -c:a copy -c:v libx264 -preset 6 -crf 17 \u0026#34;æ·¡å…¥æ·¡å‡º\\%%i\u0026#34; -y ) ) rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ rem ============fade=t=in:st=%s1%:d=%s2%,================ rem st=!s1!å¼€å§‹æ·¡å…¥æ—¶é—´ï¼šset \u0026#34;s1=0\u0026#34;ç¬¬0ç§’å¼€å§‹æ·¡å…¥ rem d=!s2!æŒç»­æ·¡å…¥æ—¶é—´ï¼šset \u0026#34;s2=5\u0026#34;æŒç»­5ç§’ rem ============fade=t=out:st=!t!:d=%s4%================ rem st=!t!å¼€å§‹æ·¡å‡ºæ—¶é—´ï¼št=è§†é¢‘æ€»ç§’æ•°-å‡å»s3è®¾å®šçš„å€¼ rem d=!s4!æŒç»­æ·¡å‡ºæ—¶é—´ï¼šset \u0026#34;s4=5\u0026#34;æŒç»­5ç§’ rem CRFå‚æ•°ï¼šå–å€¼èŒƒå›´é€šå¸¸åœ¨ 0 åˆ° 51 ä¹‹é—´ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— æŸç¼–ç ï¼Œ51 è¡¨ç¤ºæœ€å·®è´¨é‡ç¼–ç ã€‚(é€šå¸¸17-20) rem Presetå‚æ•°ï¼šæŒ‡å®šç¼–ç é€Ÿåº¦å’Œè´¨é‡çš„å¹³è¡¡ã€‚æ•°å­—è¶Šå°ï¼Œé€Ÿåº¦è¶Šæ…¢ï¼Œè´¨é‡è¶Šé«˜ï¼Œä½“ç§¯è¶Šå¤§-preset ultrafastç­‰äº-preset (é€šå¸¸6-8) åŠŸèƒ½è¯´æ˜ï¼šä¸ºè§†é¢‘æ·»åŠ æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼Œå¤„ç†åçš„è§†é¢‘ä¿å­˜åœ¨\u0026quot;æ·¡å…¥æ·¡å‡º\u0026quot;æ–‡ä»¶å¤¹ä¸­ã€‚\n2. ğŸ“ æ‹–å…¥-æ–°å»ºæ–‡ä»¶å¤¹-æ·¡å…¥æ·¡å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @echo off \u0026amp; setlocal enabledelayedexpansion rem ====================================== set \u0026#34;s1=0\u0026#34; :: æ·¡å…¥å¼€å§‹æ—¶é—´ set \u0026#34;s2=5\u0026#34; :: æ·¡å…¥æŒç»­æ—¶é—´ set \u0026#34;s3=5\u0026#34; :: æ·¡å‡ºå¼€å§‹æ—¶é—´ set \u0026#34;s4=5\u0026#34; :: æ·¡å‡ºæŒç»­æ—¶é—´ rem ====================================== for /f \u0026#34;tokens=1-4delims=:.\u0026#34; %%a in (\u0026#34;%s3%\u0026#34;) do ( set /a \u0026#34;t2=(\u0026#34;%s3%\u0026#34;) * 1000 + 1%%d %% 1000\u0026#34; ) md æ·¡å…¥æ·¡å‡º 2\u0026gt;nul for %%i in (\u0026#34;%~1\u0026#34;) do ( for /f \u0026#34;tokens=2-5delims=:., \u0026#34; %%a in (\u0026#39;ffmpeg -i \u0026#34;%%i\u0026#34; 2^\u0026gt;^\u0026amp;1 ^| find \u0026#34;Duration:\u0026#34;\u0026#39;) do ( set /a \u0026#34;t=(1%%a%%100*3600+1%%b%%100*60+1%%c%%100)*1000+1%%d0%%1000,t-=t2,ms=t%%1000,t/=1000 ffmpeg -i \u0026#34;%%i\u0026#34; -vf \u0026#34;fade=t=in:st=!s1!:d=!s2!,fade=t=out:st=!t!:d=!s4!\u0026#34; -c:a copy -c:v libx264 -preset 6 -crf 17 \u0026#34;æ·¡å…¥æ·¡å‡º\\%~n1\u0026#34;.mp4 -y ) ) rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ rem ============fade=t=in:st=%s1%:d=%s2%,================ rem st=!s1!å¼€å§‹æ·¡å…¥æ—¶é—´ï¼šset \u0026#34;s1=0\u0026#34;ç¬¬0ç§’å¼€å§‹æ·¡å…¥ rem d=!s2!æŒç»­æ·¡å…¥æ—¶é—´ï¼šset \u0026#34;s2=5\u0026#34;æŒç»­5ç§’ rem ============fade=t=out:st=!t!:d=%s4%================ rem st=!t!å¼€å§‹æ·¡å‡ºæ—¶é—´ï¼št=è§†é¢‘æ€»ç§’æ•°-å‡å»s3è®¾å®šçš„å€¼ rem d=!s4!æŒç»­æ·¡å‡ºæ—¶é—´ï¼šset \u0026#34;s4=5\u0026#34;æŒç»­5ç§’ rem CRFå‚æ•°ï¼šå–å€¼èŒƒå›´é€šå¸¸åœ¨ 0 åˆ° 51 ä¹‹é—´ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— æŸç¼–ç ï¼Œ51 è¡¨ç¤ºæœ€å·®è´¨é‡ç¼–ç ã€‚(é€šå¸¸17-20) rem Presetå‚æ•°ï¼šæŒ‡å®šç¼–ç é€Ÿåº¦å’Œè´¨é‡çš„å¹³è¡¡ã€‚æ•°å­—è¶Šå°ï¼Œé€Ÿåº¦è¶Šæ…¢ï¼Œè´¨é‡è¶Šé«˜ï¼Œä½“ç§¯è¶Šå¤§-preset ultrafastç­‰äº-preset (é€šå¸¸6-8) åŠŸèƒ½è¯´æ˜ï¼šå°†è§†é¢‘æ–‡ä»¶æ‹–æ”¾åˆ°æ­¤è„šæœ¬ä¸Šï¼Œä¼šä¸ºå…¶æ·»åŠ æ·¡å…¥æ·¡å‡ºæ•ˆæœå¹¶ä¿å­˜åˆ°\u0026quot;æ·¡å…¥æ·¡å‡º\u0026quot;æ–‡ä»¶å¤¹ã€‚\nğŸ“¸ å››ã€è§†é¢‘æˆªå›¾ 1. ğŸ–¼ï¸ æ‹–å…¥-è§†é¢‘å°é¢æˆªå›¾ 1 2 3 4 5 6 7 8 9 10 11 12 @echo off :softshare if \u0026#34;%~1\u0026#34;==\u0026#34;\u0026#34; goto :eof ffmpeg -i \u0026#34;%~1\u0026#34; -start_at_zero -vframes 1 \u0026#34;%~dpn1.jpg\u0026#34; -y shift\u0026amp;goto :softshare rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ rem æ–‡ä»¶åæ·»åŠ åç¼€(æˆªå›¾)è¾“å‡ºåˆ°åŒä¸€ç›®å½•ä¸‹ åŠŸèƒ½è¯´æ˜ï¼šæå–è§†é¢‘ç¬¬ä¸€å¸§ä½œä¸ºå°é¢å›¾ç‰‡ï¼Œä¿å­˜ä¸ºJPGæ ¼å¼ã€‚\n2. â±ï¸ æ‹–å…¥-æ—¶é—´çº¿è§†é¢‘æˆªå›¾ 1 2 3 4 5 6 7 8 9 10 11 @echo off :softshare if \u0026#34;%~1\u0026#34;==\u0026#34;\u0026#34; goto :eof ffmpeg -i \u0026#34;%~1\u0026#34; -ss 00:01:00 -qscale:v 1 -frames:v 1 \u0026#34;%~dpn1_ok.jpg\u0026#34; shift\u0026amp;goto :softshare rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ rem æ–‡ä»¶åæ·»åŠ åç¼€(æˆªå›¾)è¾“å‡ºåˆ°åŒä¸€ç›®å½•ä¸‹ åŠŸèƒ½è¯´æ˜ï¼šåœ¨è§†é¢‘çš„æŒ‡å®šæ—¶é—´ç‚¹ï¼ˆæ­¤å¤„ä¸º1åˆ†é’Ÿå¤„ï¼‰æˆªå›¾ï¼Œä¿å­˜ä¸ºJPGæ ¼å¼ã€‚\nğŸ” äº”ã€è§†é¢‘å…ƒæ•°æ® 1. ğŸ“Š æ‹–å…¥-è·å–è§†é¢‘å…ƒæ•°æ® 1 2 3 @echo off ffmpeg -i \u0026#34;%~1\u0026#34; -y pause åŠŸèƒ½è¯´æ˜ï¼šæ˜¾ç¤ºè§†é¢‘æ–‡ä»¶çš„è¯¦ç»†å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¼–ç æ ¼å¼ã€æ—¶é•¿ã€æ¯”ç‰¹ç‡ç­‰ã€‚\n2. ğŸ—‘ï¸ åŒå‡»-æ–°å»ºæ–‡ä»¶å¤¹-è§†é¢‘å…ƒæ•°æ®-æ¸…ç©º 1 2 3 4 5 6 7 8 9 @echo off \u0026amp; setlocal md å·²æ¸…ç©ºå…ƒæ•°æ® 2\u0026gt;nul for %%i in (*.avi *.mkv *.mp4 *.flv) do (ffmpeg -i \u0026#34;%%i\u0026#34; -map_metadata -1 -c:v copy -c:a copy \u0026#34;å·²æ¸…ç©ºå…ƒæ•°æ®\\%%i\u0026#34; -y ) rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šæ¸…é™¤è§†é¢‘æ–‡ä»¶ä¸­çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¤„ç†åçš„è§†é¢‘ä¿å­˜åœ¨\u0026quot;å·²æ¸…ç©ºå…ƒæ•°æ®\u0026quot;æ–‡ä»¶å¤¹ä¸­ã€‚\nğŸš« å…­ã€å»æ°´å° 1. ğŸš« æ‹–å…¥-å»å•æ°´å° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @echo off :softshare if \u0026#34;%~1\u0026#34;==\u0026#34;\u0026#34; goto :eof ffmpeg -i \u0026#34;%~1\u0026#34; -vf \u0026#34;delogo=x=79:y=36:w=95:h=88:show=0\u0026#34; -c:a copy \u0026#34;%~dpn1-ok.mp4\u0026#34; -y shift\u0026amp;goto :softshare rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ rem 1.æˆªå–çš„å›¾ç‰‡ç”¨IrfanView 64è½¯ä»¶æ‰“å¼€ï¼Œä¼šåœ¨å·¦ä¸Šæ–¹å‡ºç°(Selection:79,36;95x88) rem 2.å…¶ä¸­çš„\u0026#34;delogo=x=79:y=36:w=95:h=88:show=0\u0026#34; rem show=0è¡¨ç¤ºå…³é—­è·‘ç  åŠŸèƒ½è¯´æ˜ï¼šå»é™¤è§†é¢‘ä¸­çš„å•ä¸ªæ°´å°ï¼Œéœ€è¦é¢„å…ˆç¡®å®šæ°´å°çš„ä½ç½®å’Œå°ºå¯¸ã€‚\n2. ğŸš« æ‹–å…¥-å»åŒæ°´å° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @echo off :softshare if \u0026#34;%~1\u0026#34;==\u0026#34;\u0026#34; goto :eof ffmpeg -i \u0026#34;%~1\u0026#34; -vf \u0026#34;delogo=x=79:y=36:w=95:h=88,delogo=x=1280:y=77:w=557:h=78:show=0\u0026#34; -c:a copy \u0026#34;%~dpn1-ok.mp4\u0026#34; -y shift\u0026amp;goto :softshare rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ rem 1.æˆªå–çš„å›¾ç‰‡ç”¨IrfanView 64è½¯ä»¶æ‰“å¼€ï¼Œä¼šåœ¨å·¦ä¸Šæ–¹å‡ºç°(Selection:79,36;95x88) rem 2.å…¶ä¸­çš„\u0026#34;delogo=x=79:y=36:w=95:h=88:show=0\u0026#34; rem show=0è¡¨ç¤ºå…³é—­è·‘ç  åŠŸèƒ½è¯´æ˜ï¼šåŒæ—¶å»é™¤è§†é¢‘ä¸­çš„ä¸¤ä¸ªæ°´å°ï¼Œéœ€è¦é¢„å…ˆç¡®å®šæ¯ä¸ªæ°´å°çš„ä½ç½®å’Œå°ºå¯¸ã€‚\nğŸ–¼ï¸ ä¸ƒã€æ·»åŠ å°é¢ 1. ğŸ“ åŒæ—¶æ‹–å…¥mp4å’Œjpg-æ–°å»ºæ–‡ä»¶å¤¹-æ·»åŠ å°é¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 @echo off setlocal enabledelayedexpansion set \u0026#34;video_file=\u0026#34; set \u0026#34;image_file=\u0026#34; for %%f in (%*) do ( if /i \u0026#34;%%~xf\u0026#34;==\u0026#34;.mp4\u0026#34; set \u0026#34;video_file=%%~f\u0026#34; if /i \u0026#34;%%~xf\u0026#34;==\u0026#34;.jpg\u0026#34; set \u0026#34;image_file=%%~f\u0026#34; ) if not defined video_file ( echo No MP4 file provided. Please drag and drop an MP4 file onto the script. pause exit /b ) if not defined image_file ( echo No JPG file provided. Please drag and drop a JPG file onto the script. pause exit /b ) set \u0026#34;output_folder=%~dp0Output\u0026#34; if not exist \u0026#34;!output_folder!\u0026#34; mkdir \u0026#34;!output_folder!\u0026#34; set \u0026#34;output_file=%~dp0Output\\%~n1.mp4\u0026#34; if /i \u0026#34;%~x1\u0026#34; neq \u0026#34;.mp4\u0026#34; ( set \u0026#34;output_file=%~dp0Output\\%~n2.mp4\u0026#34; ) ffmpeg -i \u0026#34;!video_file!\u0026#34; -i \u0026#34;!image_file!\u0026#34; -map 0 -map 1 -c copy -disposition:v:1 attached_pic -metadata:s:v comment=\u0026#34;Cover (Front)\u0026#34; \u0026#34;!output_file!\u0026#34; -y echo Cover added successfully. rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šå°†MP4è§†é¢‘æ–‡ä»¶å’ŒJPGå›¾ç‰‡åŒæ—¶æ‹–æ”¾åˆ°æ­¤è„šæœ¬ä¸Šï¼Œä¼šå°†å›¾ç‰‡æ·»åŠ ä¸ºè§†é¢‘å°é¢ï¼Œå¤„ç†åçš„è§†é¢‘ä¿å­˜åœ¨\u0026quot;Output\u0026quot;æ–‡ä»¶å¤¹ä¸­ã€‚\n2. ğŸ”– åŒæ—¶æ‹–å…¥mp4å’Œjpg-åŠ åç¼€-æ·»åŠ å°é¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @echo off setlocal enabledelayedexpansion set \u0026#34;video_file=\u0026#34; set \u0026#34;image_file=\u0026#34; for %%f in (%*) do ( if /i \u0026#34;%%~xf\u0026#34;==\u0026#34;.mp4\u0026#34; set \u0026#34;video_file=%%~f\u0026#34; if /i \u0026#34;%%~xf\u0026#34;==\u0026#34;.jpg\u0026#34; set \u0026#34;image_file=%%~f\u0026#34; ) if not defined video_file ( echo No MP4 file provided. Please drag and drop an MP4 file onto the script. pause exit /b ) if not defined image_file ( echo No JPG file provided. Please drag and drop a JPG file onto the script. pause exit /b ) set \u0026#34;output_file=!video_file:.mp4=-ok.mp4!\u0026#34; ffmpeg -i \u0026#34;!video_file!\u0026#34; -i \u0026#34;!image_file!\u0026#34; -map 0 -map 1 -c copy -disposition:v:1 attached_pic -metadata:s:v comment=\u0026#34;Cover (Front)\u0026#34; \u0026#34;!output_file!\u0026#34; -y echo Cover added successfully. rem pause exit rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šå°†MP4è§†é¢‘æ–‡ä»¶å’ŒJPGå›¾ç‰‡åŒæ—¶æ‹–æ”¾åˆ°æ­¤è„šæœ¬ä¸Šï¼Œä¼šå°†å›¾ç‰‡æ·»åŠ ä¸ºè§†é¢‘å°é¢ï¼Œå¹¶åœ¨åŸæ–‡ä»¶ååæ·»åŠ \u0026quot;-ok\u0026quot;åç¼€ã€‚\nğŸ“¦ å…«ã€è§†é¢‘å‹ç¼© 1. ğŸ”„ æ‹–å…¥-H264(crf 18 preset 7) 1 2 3 4 5 6 7 8 9 10 11 @echo off cd /d \u0026#34;%~dp0\u0026#34; for %%F in (%*) do call :main %%F rem pause exit :main md h264 2\u0026gt;nul ffmpeg -i \u0026#34;%~1\u0026#34; -threads 3 -y -c:v libx264 -crf 18 -preset 7 -c:a copy \u0026#34;h264\\%~n1\u0026#34;.mp4 rem ä¸Šé¢çš„rem pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šä½¿ç”¨H264ç¼–ç å‹ç¼©è§†é¢‘ï¼Œå¹³è¡¡æ–‡ä»¶å¤§å°å’Œè´¨é‡ï¼Œå¤„ç†åçš„è§†é¢‘ä¿å­˜åœ¨\u0026quot;h264\u0026quot;æ–‡ä»¶å¤¹ä¸­ã€‚\n2. ğŸ”„ æ‹–å…¥-H265(crf=17 preset=8) 1 2 3 4 5 6 7 8 9 10 11 @echo off cd /d \u0026#34;%~dp0\u0026#34; for %%F in (%*) do call :main %%F rem pause exit :main md h265 2\u0026gt;nul ffmpeg -i \u0026#34;%~1\u0026#34; -threads 3 -y -c:v libx265 -x265-params crf=17:preset=8 -c:a copy \u0026#34;h265\\%~n1\u0026#34;.mp4 rem ä¸Šé¢çš„pauseä¸ºæš‚åœå‘½ä»¤ï¼Œå»æ‰remè€…ä¸ºå¯ç”¨(æœ‰é”™è¯¯çš„æ—¶å€™å¯å¼€å¯-æŸ¥çœ‹é”™è¯¯)ã€‚ åŠŸèƒ½è¯´æ˜ï¼šä½¿ç”¨æ›´é«˜æ•ˆçš„H265ç¼–ç å‹ç¼©è§†é¢‘ï¼Œåœ¨ç›¸åŒè´¨é‡ä¸‹æ–‡ä»¶æ›´å°ï¼Œå¤„ç†åçš„è§†é¢‘ä¿å­˜åœ¨\u0026quot;h265\u0026quot;æ–‡ä»¶å¤¹ä¸­ã€‚\n3. ğŸ“Š crfå’Œpreset å‚æ•°è¯´æ˜ CRFå‚æ•°è¯´æ˜\nå–å€¼èŒƒå›´é€šå¸¸åœ¨ 0 åˆ° 51 ä¹‹é—´ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— æŸç¼–ç ï¼Œ51 è¡¨ç¤ºæœ€å·®è´¨é‡ç¼–ç ã€‚(17-20éƒ½å¯ä»¥è·å¾—è¾ƒå¥½è´¨é‡)\nPresetå‚æ•°è¯´æ˜\n-preset ultrafast ç­‰äº -preset 0 -preset superfast ç­‰äº -preset 1 -preset veryfast ç­‰äº -preset 2 -preset faster ç­‰äº -preset 3 -preset fast ç­‰äº -preset 4 -preset medium ç­‰äº -preset 5 -preset slow ç­‰äº -preset 6 -preset slower ç­‰äº -preset 7 -preset veryslow ç­‰äº -preset 8 -preset placebo ç­‰äº -preset 9 æ•°å­—è¶Šå°ï¼Œç¼–ç é€Ÿåº¦è¶Šå¿«ï¼Œä½†å‹ç¼©æ•ˆç‡è¶Šä½ï¼Œæ–‡ä»¶ä½“ç§¯è¶Šå¤§ã€‚é€šå¸¸æ¨èä½¿ç”¨5-8ä¹‹é—´çš„é¢„è®¾å€¼ã€‚\nğŸ’¡ ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ ğŸ“‚ æ–‡ä»¶å¤‡ä»½ï¼šåœ¨å¤„ç†é‡è¦è§†é¢‘å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½åŸæ–‡ä»¶ âš™ï¸ å‚æ•°è°ƒæ•´ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´CRFå’ŒPresetå‚æ•°ï¼Œå¹³è¡¡è´¨é‡å’Œæ–‡ä»¶å¤§å° ğŸ–¥ï¸ ç¡¬ä»¶è¦æ±‚ï¼šè§†é¢‘å¤„ç†å¯¹CPUè¦æ±‚è¾ƒé«˜ï¼Œå¤„ç†å¤§æ–‡ä»¶æ—¶è¯·è€å¿ƒç­‰å¾… ğŸ” æ°´å°å®šä½ï¼šä½¿ç”¨IrfanViewç­‰å·¥å…·ç²¾ç¡®å®šä½æ°´å°åæ ‡å’Œå°ºå¯¸ ğŸ“ æ—¥å¿—æŸ¥çœ‹ï¼šé‡åˆ°é—®é¢˜æ—¶ï¼Œå–æ¶ˆpauseæ³¨é‡ŠæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ ğŸ¯ é€‚ç”¨åœºæ™¯ ä¸ªäººè§†é¢‘ç¼–è¾‘ï¼šå¿«é€Ÿå¤„ç†å®¶åº­è§†é¢‘ã€æ—…è¡Œè®°å½• å†…å®¹åˆ›ä½œè€…ï¼šä¸ºç¤¾äº¤åª’ä½“å¹³å°å‡†å¤‡è§†é¢‘å†…å®¹ æ•™è‚²åŸ¹è®­ï¼šåˆ¶ä½œæ•™å­¦è§†é¢‘ææ–™ ä¼ä¸šå®£ä¼ ï¼šå‡†å¤‡äº§å“æ¼”ç¤ºå’Œå®£ä¼ è§†é¢‘ é€šè¿‡ä»¥ä¸ŠFFmpegæ‰¹å¤„ç†è„šæœ¬ï¼Œæ‚¨å¯ä»¥é«˜æ•ˆåœ°å®Œæˆå„ç§è§†é¢‘å¤„ç†ä»»åŠ¡ï¼Œæ— éœ€å¤æ‚çš„æ‰‹åŠ¨æ“ä½œï¼ğŸ¥\n","date":"2024-12-07T15:11:59+08:00","image":"https://file.meimolihan.eu.org/img/ffmpeg-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d09c22ac/","title":"FFmpeg æ‰¹å¤„ç†è„šæœ¬å¤§å…¨ ğŸ¬"},{"content":"Windows å¸¸ç”¨æ‰¹å¤„ç†å‘½ä»¤å¤§å…¨ ğŸªŸ å…¨é¢æ•´ç† Windows ç³»ç»Ÿæ—¥å¸¸ç®¡ç†å’Œç»´æŠ¤çš„æ‰¹å¤„ç†è„šæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼æœ¬æŒ‡å—æ¶µç›–æ–‡ä»¶æ“ä½œã€ç½‘ç»œé…ç½®ã€ç³»ç»Ÿä¼˜åŒ–ç­‰å®ç”¨æŠ€å·§ã€‚ğŸªŸ\nğŸ“– å¯¼èˆªç›®å½• ğŸŒŸ æ‰¹å¤„ç†ç®€ä»‹ ğŸ“ æ–‡ä»¶ä¸ç›®å½•æ“ä½œ ğŸŒ ç½‘ç»œç›¸å…³å‘½ä»¤ ğŸ¨ ç³»ç»Ÿç•Œé¢ä¼˜åŒ– âš¡ ç³»ç»Ÿç”µæºç®¡ç† ğŸ› ï¸ ç³»ç»Ÿç»´æŠ¤å‘½ä»¤ ğŸ‘¥ ç”¨æˆ·è´¦æˆ·ç®¡ç† ğŸ’¡ å®ç”¨æŠ€å·§ä¸æç¤º ğŸš€ é«˜çº§æ‰¹å¤„ç†æŠ€å·§ ğŸŒŸ æ‰¹å¤„ç†æ–‡ä»¶ç®€ä»‹ æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆ.bat æˆ– .cmdï¼‰æ˜¯ Windows ç³»ç»Ÿä¸­ç”¨äºè‡ªåŠ¨æ‰§è¡Œä»»åŠ¡çš„è„šæœ¬æ–‡ä»¶ï¼Œå¯ä»¥æ‰¹é‡å¤„ç†å‘½ä»¤ï¼Œæé«˜ç³»ç»Ÿç®¡ç†æ•ˆç‡ã€‚âœ¨\nä¸»è¦ä¼˜åŠ¿ï¼š\nè‡ªåŠ¨åŒ– ğŸ¤–: æ‰¹é‡æ‰§è¡Œé‡å¤ä»»åŠ¡ï¼ŒèŠ‚çœæ—¶é—´ çµæ´»æ€§ ğŸ”§: å¯ç»„åˆå„ç§ç³»ç»Ÿå‘½ä»¤å’Œç¨‹åº å¼ºå¤§åŠŸèƒ½ âš¡: æ”¯æŒå˜é‡ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ç­‰ç¼–ç¨‹å…ƒç´  ç³»ç»Ÿé›†æˆ ğŸ–¥ï¸: ç›´æ¥è°ƒç”¨ Windows ç³»ç»Ÿå·¥å…·å’Œå‘½ä»¤ åŸºæœ¬ç»“æ„ï¼š\n1 2 3 4 @echo off REM è¿™æ˜¯ä¸€æ¡æ³¨é‡Š echo æ¬¢è¿ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ pause ğŸ“ ä¸€ã€æ–‡ä»¶ä¸ç›®å½•æ“ä½œ 1. åˆ›å»ºå¤šçº§ç›®å½• ğŸ“‚ 1 2 3 4 @echo off md \u0026#34;D:\\Installation directory\\æ´›é›ªéŸ³ä¹\u0026#34; echo âœ… ç›®å½•åˆ›å»ºæˆåŠŸï¼ pause 2. åœ¨æ¡Œé¢åˆ›å»ºæ–‡ä»¶å¤¹ ğŸ–¥ï¸ 1 2 3 4 5 6 7 8 9 10 @echo off set \u0026#34;folder=%USERPROFILE%\\Desktop\\éŸ³ä¹ä¸‹è½½\u0026#34; if not exist \u0026#34;%folder%\u0026#34; ( mkdir \u0026#34;%folder%\u0026#34; echo âœ… æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼ ) else ( echo â„¹ï¸ æ–‡ä»¶å¤¹å·²å­˜åœ¨ï¼ ) pause 3. æ‰¹é‡é‡å‘½åæ–‡ä»¶ ğŸ”„ 1 2 3 4 5 6 7 8 9 10 11 @echo off setlocal enabledelayedexpansion set /a count=0 for %%i in (*.txt) do ( set /a count+=1 ren \u0026#34;%%i\u0026#34; \u0026#34;æ–‡æ¡£!count!.txt\u0026#34; ) echo âœ… å…±é‡å‘½åäº† !count! ä¸ªæ–‡ä»¶ pause 4. å¤åˆ¶å’Œå¤‡ä»½æ–‡ä»¶ ğŸ’¾ 1 2 3 4 5 6 7 8 9 10 11 @echo off echo ğŸ“‹ æ­£åœ¨å¤‡ä»½é‡è¦æ–‡ä»¶... xcopy \u0026#34;C:\\é‡è¦æ–‡æ¡£\\*.*\u0026#34; \u0026#34;D:\\å¤‡ä»½\\%date:~0,4%%date:~5,2%%date:~8,2%\\\u0026#34; /s /i if %errorlevel% equ 0 ( echo âœ… å¤‡ä»½å®Œæˆï¼ ) else ( echo âŒ å¤‡ä»½è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼ ) pause ğŸŒ äºŒã€ç½‘ç»œç›¸å…³å‘½ä»¤ 1. æŸ¥çœ‹IPåœ°å€å’Œç½‘å…³ ğŸ” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @echo off setlocal enabledelayedexpansion echo ğŸ“¡ æ­£åœ¨è·å–ç½‘ç»œä¿¡æ¯... echo. for /f \u0026#34;tokens=2 delims=:\u0026#34; %%a in (\u0026#39;ipconfig ^| find \u0026#34;IPv4\u0026#34;\u0026#39;) do ( set \u0026#34;ipaddress=%%a\u0026#34; set \u0026#34;ipaddress=!ipaddress: =!\u0026#34; echo ğŸ“¡ æœ¬æœºIPv4åœ°å€: !ipaddress! ) for /f \u0026#34;tokens=3\u0026#34; %%a in (\u0026#39;route print ^| findstr /r /c:\u0026#34;0.0.0.0.*0.0.0.0\u0026#34;\u0026#39;) do ( set \u0026#34;gateway=%%a\u0026#34; echo ğŸŒ é»˜è®¤ç½‘å…³åœ°å€: !gateway! ) pause 2. åˆ·æ–°DNSç¼“å­˜ ğŸ”„ 1 2 3 4 5 6 7 8 9 10 11 @echo off echo ğŸ”„ æ­£åœ¨åˆ·æ–°DNSç¼“å­˜... ipconfig /flushdns if %errorlevel% equ 0 ( echo âœ… DNS ç¼“å­˜å·²åˆ·æ–°! ) else ( echo âŒ DNS åˆ·æ–°å¤±è´¥! ) timeout /t 3 3. æŒç»­Pingæµ‹è¯• ğŸ“¶ 1 2 3 @echo off echo ğŸš€ å¼€å§‹æŒç»­pingæµ‹è¯•ï¼ŒæŒ‰Ctrl+Cåœæ­¢ ping 10.10.10.251 -t 4. è®¾ç½®é™æ€IPåœ°å€ âš™ï¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @echo off REM æ£€æŸ¥ç®¡ç†å‘˜æƒé™ net session \u0026gt;nul 2\u0026gt;\u0026amp;1 if %errorLevel% neq 0 ( echo âš ï¸ è¯·æ±‚ç®¡ç†å‘˜æƒé™... powershell start -verb runas \u0026#39;%0\u0026#39; exit /B ) echo ğŸ› ï¸ æ­£åœ¨è®¾ç½®ç½‘ç»œé…ç½®... netsh interface ip set address \u0026#34;ä»¥å¤ªç½‘\u0026#34; static 10.10.10.248 255.255.255.0 10.10.10.253 netsh interface ip set dns \u0026#34;ä»¥å¤ªç½‘\u0026#34; static 223.5.5.5 primary netsh interface ip add dns \u0026#34;ä»¥å¤ªç½‘\u0026#34; 8.8.8.8 index=2 echo âœ… ç½‘ç»œé…ç½®å®Œæˆï¼ echo ğŸ“ IPåœ°å€: 10.10.10.248 echo ğŸ”§ å­ç½‘æ©ç : 255.255.255.0 echo ğŸŒ ç½‘å…³: 10.10.10.253 echo ğŸ“¡ DNS: 223.5.5.5, 8.8.8.8 pause 5. ç½‘ç»œè¯Šæ–­å·¥å…· ğŸ©º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @echo off echo ğŸ©º å¼€å§‹ç½‘ç»œè¯Šæ–­... echo. echo 1. æ­£åœ¨æ£€æŸ¥ç½‘ç»œè¿æ¥... ping -n 4 www.google.com echo. echo 2. æ­£åœ¨è¿½è¸ªè·¯ç”±... tracert www.google.com echo. echo 3. æ˜¾ç¤ºç½‘ç»œç»Ÿè®¡ä¿¡æ¯... netstat -an pause ğŸ¨ ä¸‰ã€ç³»ç»Ÿç•Œé¢ä¼˜åŒ– 1. å»é™¤å¿«æ·æ–¹å¼ç®­å¤´ (Win10/Win11) ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 @echo off echo ğŸ› ï¸ æ­£åœ¨å»é™¤å¿«æ·æ–¹å¼ç®­å¤´... %1 mshta vbscript:CreateObject(\u0026#34;Shell.Application\u0026#34;).ShellExecute(\u0026#34;cmd.exe\u0026#34;,\u0026#34;/c %~s0 ::\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;runas\u0026#34;,1)(window.close)\u0026amp;\u0026amp;exit reg add \u0026#34;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Icons\u0026#34; /v 29 /d \u0026#34;%systemroot%\\system32\\imageres.dll,197\u0026#34; /t reg_sz /f taskkill /f /im explorer.exe \u0026gt;nul 2\u0026gt;\u0026amp;1 attrib -s -r -h \u0026#34;%userprofile%\\AppData\\Local\\iconcache.db\u0026#34; \u0026gt;nul 2\u0026gt;\u0026amp;1 del \u0026#34;%userprofile%\\AppData\\Local\\iconcache.db\u0026#34; /f /q \u0026gt;nul 2\u0026gt;\u0026amp;1 start explorer.exe \u0026gt;nul 2\u0026gt;\u0026amp;1 echo âœ… å¿«æ·æ–¹å¼ç®­å¤´å·²å»é™¤ï¼ pause 2. è°ƒæ•´ç³»ç»Ÿæ€§èƒ½é€‰é¡¹ âš¡ 1 2 3 4 5 6 7 8 9 @echo off echo âš¡ è°ƒæ•´ç³»ç»Ÿæ€§èƒ½é€‰é¡¹... %1 mshta vbscript:CreateObject(\u0026#34;Shell.Application\u0026#34;).ShellExecute(\u0026#34;cmd.exe\u0026#34;,\u0026#34;/c %~s0 ::\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;runas\u0026#34;,1)(window.close)\u0026amp;\u0026amp;exit REM è°ƒæ•´ä¸ºæœ€ä½³æ€§èƒ½ systempropertiesperformance.exe echo âœ… æ€§èƒ½é€‰é¡¹å·²è°ƒæ•´ï¼ pause âš¡ å››ã€ç³»ç»Ÿç”µæºç®¡ç† 1. ç«‹å³å…³æœº ğŸ”´ 1 2 3 4 @echo off echo âš ï¸ æ­£åœ¨ç«‹å³å…³é—­è®¡ç®—æœº... echo ğŸ’¾ è¯·ä¿å­˜å¥½æ‰€æœ‰å·¥ä½œï¼ shutdown /s /t 0 /f /c \u0026#34;è®¡ç®—æœºæ­£åœ¨ç«‹å³å…³é—­\u0026#34; 2. ç«‹å³é‡å¯ ğŸ”„ 1 2 3 @echo off echo ğŸ”„ æ­£åœ¨é‡å¯è®¡ç®—æœº... shutdown /r /t 0 /f 3. å®šæ—¶å…³æœº â° 1 2 3 4 5 6 7 8 9 10 11 12 @echo off set /p minutes=â° è¯·è¾“å…¥å…³æœºå»¶è¿Ÿæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰: set /a seconds=%minutes% * 60 if %seconds% gtr 0 ( shutdown /s /t %seconds% echo â° è®¡ç®—æœºå°†åœ¨ %minutes% åˆ†é’Ÿåå…³é—­ ) else ( echo âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ†é’Ÿæ•°ï¼ ) pause 4. å–æ¶ˆå…³æœºè®¡åˆ’ ğŸš« 1 2 3 4 5 @echo off echo ğŸš« æ­£åœ¨å–æ¶ˆå…³æœºè®¡åˆ’... shutdown /a echo âœ… å…³æœºè®¡åˆ’å·²å–æ¶ˆï¼ timeout /t 3 ğŸ› ï¸ äº”ã€ç³»ç»Ÿç»´æŠ¤å‘½ä»¤ 1. ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥ ğŸ” 1 2 3 4 5 6 7 8 9 10 11 12 13 @echo off echo ğŸ” æ­£åœ¨æ£€æŸ¥ç³»ç»Ÿæ–‡ä»¶... %1 mshta vbscript:CreateObject(\u0026#34;Shell.Application\u0026#34;).ShellExecute(\u0026#34;cmd.exe\u0026#34;,\u0026#34;/c %~s0 ::\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;runas\u0026#34;,1)(window.close)\u0026amp;\u0026amp;exit sfc /scannow if %errorlevel% equ 0 ( echo âœ… ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥å®Œæˆï¼Œæœªå‘ç°é—®é¢˜ï¼ ) else ( echo âš ï¸ ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥å®Œæˆï¼Œå‘ç°ä¸€äº›é—®é¢˜éœ€è¦ä¿®å¤ï¼ ) pause 2. ç£ç›˜æ¸…ç† ğŸ§¹ 1 2 3 4 5 6 7 8 9 10 11 @echo off echo ğŸ§¹ æ­£åœ¨æ¸…ç†ç£ç›˜... cleanmgr /sagerun:1 if %errorlevel% equ 0 ( echo âœ… ç£ç›˜æ¸…ç†å®Œæˆï¼ ) else ( echo âŒ ç£ç›˜æ¸…ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼ ) timeout /t 3 3. æ£€æŸ¥ç£ç›˜é”™è¯¯ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @echo off echo ğŸ”§ æ­£åœ¨æ£€æŸ¥ç£ç›˜é”™è¯¯... chkdsk C: /f /x echo. echo âš ï¸ éœ€è¦é‡å¯æ‰èƒ½å®Œæˆç£ç›˜æ£€æŸ¥ï¼ echo ğŸ’¡ æ˜¯å¦ç«‹å³é‡å¯ï¼Ÿ(Y/N) choice /c YN /n if %errorlevel% equ 1 ( shutdown /r /t 0 ) else ( echo â„¹ï¸ ä¸‹æ¬¡é‡å¯æ—¶å°†æ£€æŸ¥ç£ç›˜é”™è¯¯ï¼ pause ) 4. å¸è½½ç³»ç»Ÿç»„ä»¶ ğŸ—‘ï¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 @echo off echo ğŸ—‘ï¸ æ­£åœ¨å¸è½½ä¸éœ€è¦çš„ç³»ç»Ÿç»„ä»¶... %1 mshta vbscript:CreateObject(\u0026#34;Shell.Application\u0026#34;).ShellExecute(\u0026#34;cmd.exe\u0026#34;,\u0026#34;/c %~s0 ::\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;runas\u0026#34;,1)(window.close)\u0026amp;\u0026amp;exit REM å¸è½½å°ç»„ä»¶ winget uninstall MicrosoftWindows.Client.WebExperience_cw5n1h2txyewy REM é‡å¯æ–‡ä»¶ç®¡ç†å™¨ taskkill /f /im explorer.exe \u0026gt;nul 2\u0026gt;\u0026amp;1 start explorer.exe \u0026gt;nul 2\u0026gt;\u0026amp;1 echo âœ… ç³»ç»Ÿç»„ä»¶æ¸…ç†å®Œæˆï¼ pause ğŸ‘¥ å…­ã€ç”¨æˆ·è´¦æˆ·ç®¡ç† 1. æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· ğŸ‘¤ 1 2 3 4 5 6 @echo off echo ğŸ“‹ ç³»ç»Ÿç”¨æˆ·åˆ—è¡¨: echo ====================== net user echo ====================== pause 2. åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ· â• 1 2 3 4 5 6 7 8 9 10 11 12 @echo off echo ğŸ‘¤ æ­£åœ¨åˆ›å»ºæ–°ç”¨æˆ·... net user XOS guo88888 /add /fullname:\u0026#34;XOS User\u0026#34; /comment:\u0026#34;æ ‡å‡†ç”¨æˆ·è´¦æˆ·\u0026#34; net localgroup administrators XOS /add if %errorlevel% equ 0 ( echo âœ… ç”¨æˆ· XOS åˆ›å»ºæˆåŠŸï¼Œå·²åŠ å…¥ç®¡ç†å‘˜ç»„ ) else ( echo âŒ ç”¨æˆ·åˆ›å»ºå¤±è´¥ï¼ ) pause 3. åˆ é™¤ç”¨æˆ·è´¦æˆ· â– 1 2 3 4 5 6 7 8 9 10 11 @echo off echo âš ï¸ æ­£åœ¨åˆ é™¤ç”¨æˆ·è´¦æˆ·... net user XOS /delete if %errorlevel% equ 0 ( echo âœ… ç”¨æˆ· XOS å·²åˆ é™¤ ) else ( echo âŒ ç”¨æˆ·åˆ é™¤å¤±è´¥ï¼ ) pause 4. æ›´æ”¹ç”¨æˆ·å¯†ç  ğŸ”’ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @echo off set /p username=ğŸ‘¤ è¯·è¾“å…¥ç”¨æˆ·å: if \u0026#34;%username%\u0026#34;==\u0026#34;\u0026#34; ( echo âŒ ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼ pause exit /b 1 ) net user %username% * if %errorlevel% equ 0 ( echo âœ… å¯†ç å·²æ›´æ”¹ ) else ( echo âŒ å¯†ç æ›´æ”¹å¤±è´¥ï¼ ) pause ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ä¸æç¤º 1. æ‰¹å¤„ç†æœ€ä½³å®è·µ âœ… æƒé™ç®¡ç† ğŸ›¡ï¸: å§‹ç»ˆåœ¨å…³é”®æ“ä½œå‰è¯·æ±‚ç®¡ç†å‘˜æƒé™\n1 2 3 4 5 6 net session \u0026gt;nul 2\u0026gt;\u0026amp;1 if %errorLevel% neq 0 ( echo âš ï¸ è¯·æ±‚ç®¡ç†å‘˜æƒé™... powershell start -verb runas \u0026#39;%0\u0026#39; exit /B ) é”™è¯¯å¤„ç† ğŸ”§: æ·»åŠ é€‚å½“çš„é”™è¯¯æ£€æŸ¥å’Œå¤„ç†\n1 2 3 4 if %errorlevel% neq 0 ( echo âŒ æ“ä½œå¤±è´¥ï¼ exit /b 1 ) æ—¥å¿—è®°å½• ğŸ“: è®°å½•è„šæœ¬æ‰§è¡Œæƒ…å†µ\n1 echo [%date% %time%] è„šæœ¬å¼€å§‹æ‰§è¡Œ \u0026gt;\u0026gt; script.log 2. å®‰å…¨æ³¨æ„äº‹é¡¹ âš ï¸ ä¸è¦è¿è¡ŒæœªçŸ¥æ¥æºçš„æ‰¹å¤„ç†æ–‡ä»¶ å®šæœŸå¤‡ä»½é‡è¦æ•°æ®å’Œç³»ç»Ÿé…ç½® è°¨æ…ä¿®æ”¹æ³¨å†Œè¡¨å’Œç³»ç»Ÿæ–‡ä»¶ æµ‹è¯•è„šæœ¬åœ¨éç”Ÿäº§ç¯å¢ƒé¦–å…ˆéªŒè¯ 3. è°ƒè¯•æŠ€å·§ ğŸ› 1 2 3 4 5 6 @echo on REM å¼€å¯å‘½ä»¤å›æ˜¾ echo ğŸ” è°ƒè¯•ä¿¡æ¯: echo ğŸ“‚ å½“å‰ç›®å½•: %cd% echo ğŸ’» ç³»ç»Ÿç‰ˆæœ¬: %os% echo ğŸ‘¤ å½“å‰ç”¨æˆ·: %username% pause ğŸš€ å…«ã€é«˜çº§æ‰¹å¤„ç†æŠ€å·§ 1. åˆ›å»ºå›¾å½¢åŒ–é€‰æ‹©èœå• ğŸ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 @echo off chcp 65001 \u0026gt;nul :menu cls echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— echo â•‘ ç³»ç»Ÿç»´æŠ¤å·¥å…·ç®± â•‘ echo â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ echo â•‘ 1. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ â•‘ echo â•‘ 2. æ£€æŸ¥ç£ç›˜é”™è¯¯ â•‘ echo â•‘ 3. ä¼˜åŒ–å¯åŠ¨é¡¹ â•‘ echo â•‘ 4. ç½‘ç»œè¯Šæ–­ â•‘ echo â•‘ 5. é€€å‡º â•‘ echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• choice /c 12345 /n /m \u0026#34;è¯·é€‰æ‹©æ“ä½œ: \u0026#34; if errorlevel 5 goto exit if errorlevel 4 goto network if errorlevel 3 goto optimize if errorlevel 2 goto checkdisk if errorlevel 1 goto cleantemp :cleantemp echo ğŸ§¹ æ­£åœ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶... del /q /f /s %temp%\\*.* echo âœ… ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆï¼ pause goto menu :checkdisk echo ğŸ”§ æ­£åœ¨æ£€æŸ¥ç£ç›˜... chkdsk c: /f echo âš ï¸ éœ€è¦é‡å¯å®Œæˆç£ç›˜æ£€æŸ¥ï¼ pause goto menu :optimize echo âš¡ ä¼˜åŒ–å¯åŠ¨é¡¹... msconfig echo âœ… å¯åŠ¨é¡¹ä¼˜åŒ–å®Œæˆï¼ pause goto menu :network echo ğŸŒ å¼€å§‹ç½‘ç»œè¯Šæ–­... ping -n 4 www.google.com pause goto menu :exit echo ğŸ‘‹ å†è§ï¼ exit 2. æ—¥å¿—è®°å½•åŠŸèƒ½ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @echo off set logfile=%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%.log set logfile=%logfile: =0% echo [%date% %time%] è„šæœ¬å¼€å§‹æ‰§è¡Œ \u0026gt;\u0026gt; %logfile% REM è®°å½•ç³»ç»Ÿä¿¡æ¯ systeminfo | findstr /B /C:\u0026#34;OS åç§°\u0026#34; /C:\u0026#34;OS ç‰ˆæœ¬\u0026#34; /C:\u0026#34;ç³»ç»Ÿç±»å‹\u0026#34; \u0026gt;\u0026gt; %logfile% REM ä½ çš„ä»£ç åœ¨è¿™é‡Œ echo ğŸ› ï¸ æ‰§è¡Œç³»ç»Ÿç»´æŠ¤ä»»åŠ¡... \u0026gt;\u0026gt; %logfile% echo [%date% %time%] è„šæœ¬æ‰§è¡Œå®Œæˆ \u0026gt;\u0026gt; %logfile% echo ğŸ“‹ æ—¥å¿—å·²ä¿å­˜åˆ°: %logfile% pause 3. é«˜çº§é”™è¯¯å¤„ç† ğŸš¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @echo off setlocal enabledelayedexpansion REM è®¾ç½®é”™è¯¯å¤„ç† set errorhandler=exit /b 1 :main echo ğŸš€ å¼€å§‹æ‰§è¡Œä»»åŠ¡... REM å°è¯•æ‰§è¡Œå¯èƒ½å¤±è´¥çš„æ“ä½œ call :dangerous_operation if !errorlevel! neq 0 ( echo âŒ æ“ä½œå¤±è´¥ï¼Œé”™è¯¯ä»£ç : !errorlevel! goto error ) echo âœ… æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼ goto end :dangerous_operation REM è¿™é‡Œæ”¾ç½®å¯èƒ½å¤±è´¥çš„æ“ä½œ echo âš ï¸ æ‰§è¡Œå±é™©æ“ä½œ... exit /b 1 REM æ¨¡æ‹Ÿå¤±è´¥ :error echo ğŸ›¡ï¸ æ­£åœ¨æ‰§è¡Œé”™è¯¯å¤„ç†... REM æ¸…ç†èµ„æºã€å‘é€é€šçŸ¥ç­‰ goto end :end echo ğŸ“ è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼ pause exit /b 0 4. å‚æ•°åŒ–è„šæœ¬ ğŸ“‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 @echo off setlocal enabledelayedexpansion echo ğŸ”§ å‚æ•°åŒ–è„šæœ¬ç¤ºä¾‹ echo ğŸ“‹ å‚æ•°ä¸ªæ•°: %# echo ğŸ“ æ‰€æœ‰å‚æ•°: %* if \u0026#34;%1\u0026#34;==\u0026#34;\u0026#34; ( echo âŒ è¯·æä¾›æ“ä½œå‚æ•° echo ğŸ’¡ ç”¨æ³•: %0 [install|uninstall|update] exit /b 1 ) :switch if /i \u0026#34;%1\u0026#34;==\u0026#34;install\u0026#34; goto install if /i \u0026#34;%1\u0026#34;==\u0026#34;uninstall\u0026#34; goto uninstall if /i \u0026#34;%1\u0026#34;==\u0026#34;update\u0026#34; goto update echo âŒ æœªçŸ¥å‚æ•°: %1 exit /b 1 :install echo ğŸš€ æ­£åœ¨å®‰è£…... REM å®‰è£…é€»è¾‘ goto end :uninstall echo ğŸ—‘ï¸ æ­£åœ¨å¸è½½... REM å¸è½½é€»è¾‘ goto end :update echo ğŸ”„ æ­£åœ¨æ›´æ–°... REM æ›´æ–°é€»è¾‘ goto end :end echo âœ… æ“ä½œå®Œæˆï¼ exit /b 0 ğŸ¯ ä½¿ç”¨æç¤ºä¸æœ€ä½³å®è·µ æµ‹è¯•ç¯å¢ƒéªŒè¯ ğŸ§ª: åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è„šæœ¬åŠŸèƒ½ é€æ­¥æ‰§è¡Œ ğŸ‘£: å¤æ‚è„šæœ¬å¯ä»¥æ·»åŠ  pause å‘½ä»¤åˆ†æ­¥æ‰§è¡Œå’Œè°ƒè¯• æ³¨é‡Šæ–‡æ¡£ ğŸ“„: ä¸ºè„šæœ¬æ·»åŠ è¯¦ç»†æ³¨é‡Šï¼Œæ–¹ä¾¿åç»­ç»´æŠ¤ ç‰ˆæœ¬æ§åˆ¶ ğŸ”„: ä½¿ç”¨ Git ç­‰å·¥å…·ç®¡ç†è„šæœ¬ç‰ˆæœ¬ å®šæœŸå®¡æŸ¥ ğŸ”: å®šæœŸæ£€æŸ¥è„šæœ¬çš„å®‰å…¨æ€§å’Œå…¼å®¹æ€§ âš ï¸ é‡è¦æé†’: æ‰¹å¤„ç†æ–‡ä»¶æ˜¯å¼ºå¤§çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä½†è¯·è°¨æ…ä½¿ç”¨ç³»ç»Ÿçº§å‘½ä»¤ã€‚å»ºè®®åœ¨è¿è¡Œå‰å¤‡ä»½é‡è¦æ•°æ®ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯è„šæœ¬åŠŸèƒ½ã€‚\nå¸Œæœ›è¿™ä»½æ‰¹å¤„ç†å‘½ä»¤å¤§å…¨èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç† Windows ç³»ç»Ÿï¼å¦‚æœ‰å…¶ä»–éœ€æ±‚ï¼Œå¯ä»¥å‚è€ƒ Microsoft å®˜æ–¹æ–‡æ¡£æˆ–æ‰¹å¤„ç†ç¼–ç¨‹æŒ‡å—ã€‚ğŸ‰\n","date":"2024-12-07T15:10:18+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/ab89bd38/","title":"Windows å¸¸ç”¨æ‰¹å¤„ç†å‘½ä»¤å¤§å…¨ ğŸªŸ"},{"content":"Linux å’Œ Windows ç³»ç»Ÿé—´æ–‡ä»¶ä¼ è¾“ ğŸ”„ ä½¿ç”¨ rz å’Œ sz å‘½ä»¤è½»æ¾åœ¨ Linux å’Œ Windows ç³»ç»Ÿä¹‹é—´ä¼ è¾“æ–‡ä»¶ã€‚æœ¬æŒ‡å—æ¶µç›–å®‰è£…ã€é…ç½®ã€ä½¿ç”¨æŠ€å·§ä»¥åŠæ›¿ä»£æ–¹æ¡ˆï¼ŒåŠ©æ‚¨å®ç°é«˜æ•ˆè·¨å¹³å°æ–‡ä»¶ä¼ è¾“ï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• ğŸŒŸ ç®€ä»‹ ğŸ“¦ å®‰è£… lrzsz ğŸ–¥ï¸ Windows ç«¯é…ç½® ğŸ“¤ ä» Windows ä¸Šä¼ æ–‡ä»¶åˆ° Linux (rz) ğŸ“¥ ä» Linux ä¸‹è½½æ–‡ä»¶åˆ° Windows (sz) ğŸ”§ å¸¸ç”¨å‚æ•°è¯´æ˜ ğŸ’¡ å®ç”¨æŠ€å·§å’Œç¤ºä¾‹ âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ”„ æ›¿ä»£æ–¹æ¡ˆ ğŸ“Š å·¥å…·å¯¹æ¯” ğŸ¯ æœ€ä½³å®è·µå»ºè®® \u0026ndash;\nğŸŒŸ ç®€ä»‹ rz å’Œ sz æ˜¯ Linux ç³»ç»Ÿä¸­å¸¸ç”¨çš„æ–‡ä»¶ä¼ è¾“å‘½ä»¤ï¼Œå®ƒä»¬ä½¿ç”¨ ZMODEM åè®® é€šè¿‡ç»ˆç«¯è¿æ¥ï¼ˆå¦‚ SSHï¼‰åœ¨æœ¬åœ°è®¡ç®—æœºå’Œè¿œç¨‹æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªå‘½ä»¤æ˜¯ lrzsz è½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œéå¸¸é€‚åˆåœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸‹è¿›è¡Œç®€å•çš„æ–‡ä»¶äº¤æ¢ã€‚âœ¨\nä¸»è¦ä¼˜åŠ¿ï¼š\nç®€å•æ˜“ç”¨ ğŸ¯: åªéœ€ä¸¤ä¸ªå‘½ä»¤å³å¯å®Œæˆä¸Šä¼ ä¸‹è½½ æ— éœ€é¢å¤–é…ç½® âš¡: å¤§å¤šæ•° SSH å®¢æˆ·ç«¯åŸç”Ÿæ”¯æŒ è·¨å¹³å°å…¼å®¹ ğŸ”„: æ”¯æŒå¤šç§ Linux å‘è¡Œç‰ˆå’Œ Windows ç»ˆç«¯ æ— éœ€å¦å¼€è¿æ¥ ğŸ–¥ï¸: åœ¨ç°æœ‰ SSH ä¼šè¯ä¸­ç›´æ¥ä¼ è¾“æ–‡ä»¶ ğŸ“¦ ä¸€ã€å®‰è£… lrzsz åœ¨ä¸åŒ Linux å‘è¡Œç‰ˆä¸Šå®‰è£… lrzsz åŒ…ï¼š\n1. Debian/Ubuntu ç³»ç»Ÿ 1 2 sudo apt-get update sudo apt-get install lrzsz -y 2. Red Hat/CentOS/Rocky Linux 1 2 3 4 5 # å¯¹äºè¾ƒæ–°ç‰ˆæœ¬ï¼ˆä½¿ç”¨ dnfï¼‰ sudo dnf install lrzsz -y # å¯¹äºè¾ƒæ—§ç‰ˆæœ¬ï¼ˆä½¿ç”¨ yumï¼‰ sudo yum install lrzsz -y 3. Alpine Linux 1 sudo apk add lrzsz 4. openSUSE 1 sudo zypper install lrzsz 5. Arch Linux 1 sudo pacman -S lrzsz 6. éªŒè¯å®‰è£… 1 2 3 4 5 6 7 # æ£€æŸ¥ rz å’Œ sz å‘½ä»¤æ˜¯å¦å¯ç”¨ which rz sz # é¢„æœŸè¾“å‡º: /usr/bin/rz å’Œ /usr/bin/sz # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ rz --version sz --version ğŸ–¥ï¸ äºŒã€Windows ç«¯é…ç½® rz/sz éœ€è¦ç»ˆç«¯è½¯ä»¶æ”¯æŒ ZMODEM åè®®ã€‚ä»¥ä¸‹æ˜¯æ”¯æŒçš„ç»ˆç«¯è½¯ä»¶åŠå…¶é…ç½®æ–¹æ³•ï¼š\næ”¯æŒçš„ç»ˆç«¯è½¯ä»¶ âœ… PuTTYï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰ âœ… Xshellï¼ˆå†…ç½®æ”¯æŒï¼Œå¼€ç®±å³ç”¨ï¼‰ âœ… MobaXtermï¼ˆå†…ç½®æ”¯æŒï¼Œæ¨èä½¿ç”¨ï¼‰ âœ… SecureCRTï¼ˆå†…ç½®æ”¯æŒï¼‰ âœ… Windows Terminalï¼ˆé…åˆ WSL ä½¿ç”¨ï¼‰ PuTTY é…ç½®æ­¥éª¤ ä¸‹è½½å¹¶å®‰è£… PuTTY: https://www.chiark.greenend.org.uk/~sgtatham/putty/ é…ç½® ZMODEM æ”¯æŒ:\næ‰“å¼€ PuTTYï¼Œè¿æ¥åˆ°æ‚¨çš„ Linux æœåŠ¡å™¨ è½¬åˆ° Connection \u0026gt; SSH \u0026gt; X11 ç¡®ä¿ \u0026ldquo;Enable X11 forwarding\u0026rdquo; å·²å‹¾é€‰ åœ¨\u0026quot;X display location\u0026quot;ä¸­å¡«å†™ localhost:0 è®¾ç½®é»˜è®¤ä¸‹è½½è·¯å¾„:\nè½¬åˆ° Connection \u0026gt; SSH \u0026gt; Tunnels æ·»åŠ æ–°çš„è½¬å‘ï¼šSource port: 0, Destination: localhost:0 MobaXterm é…ç½®ï¼ˆæ¨èï¼‰ MobaXterm å†…ç½®äº†å¯¹ ZMODEM åè®®çš„æ”¯æŒï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š\nä¸‹è½½å¹¶å®‰è£… MobaXterm: https://mobaxterm.mobatek.net/ åˆ›å»º SSH ä¼šè¯è¿æ¥åˆ° Linux æœåŠ¡å™¨ ç›´æ¥ä½¿ç”¨ rz/sz å‘½ä»¤å³å¯ ğŸ“¤ ä¸‰ã€ä» Windows ä¸Šä¼ æ–‡ä»¶åˆ° Linux (rz) rz å‘½ä»¤ç”¨äºä»æœ¬åœ° Windows è®¡ç®—æœºä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹ Linux æœåŠ¡å™¨ã€‚\nåŸºæœ¬å‘½ä»¤ 1 2 3 4 5 6 7 8 # ä¸Šä¼ æ–‡ä»¶åˆ°å½“å‰ç›®å½• rz # ä¸Šä¼ æ–‡ä»¶å¹¶æŒ‡å®šä¿å­˜æ–‡ä»¶å rz -y newfilename.txt # ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ rz -y è¯¦ç»†æ­¥éª¤ è¿æ¥åˆ° Linux æœåŠ¡å™¨ é€šè¿‡ SSH å¯¼èˆªåˆ°ç›®æ ‡ç›®å½•: 1 cd /path/to/destination æ‰§è¡Œ rz å‘½ä»¤: 1 rz é€‰æ‹©æ–‡ä»¶: ç»ˆç«¯è½¯ä»¶ä¼šå¼¹å‡ºæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† é€‰æ‹©è¦ä¸Šä¼ çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ ç›‘æ§ä¼ è¾“è¿›åº¦: ä¼ è¾“å¼€å§‹åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ ä¼ è¾“å®Œæˆåï¼Œæ–‡ä»¶ä¼šä¿å­˜åœ¨å½“å‰ç›®å½• é«˜çº§é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶ rz -y # é€‰æ‹©ç‰¹å®šæ–‡ä»¶ç±»å‹ rz -E \u0026#34;*.txt\u0026#34; # æ˜¾ç¤ºè¯¦ç»†ä¼ è¾“ä¿¡æ¯ rz -v # äºŒè¿›åˆ¶æ¨¡å¼ä¼ è¾“ï¼ˆé€‚ç”¨äºéæ–‡æœ¬æ–‡ä»¶ï¼‰ rz -b # è½¬ä¹‰æ§åˆ¶å­—ç¬¦ï¼ˆé€‚ç”¨äºç‰¹æ®Šæ–‡ä»¶ï¼‰ rz -e ğŸ“¥ å››ã€ä» Linux ä¸‹è½½æ–‡ä»¶åˆ° Windows (sz) sz å‘½ä»¤ç”¨äºä»è¿œç¨‹ Linux æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ° Windows è®¡ç®—æœºã€‚\nåŸºæœ¬å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # ä¸‹è½½å•ä¸ªæ–‡ä»¶ sz filename.txt # ä¸‹è½½å¤šä¸ªæ–‡ä»¶ sz file1.txt file2.jpg file3.zip # ä½¿ç”¨é€šé…ç¬¦ä¸‹è½½å¤šä¸ªæ–‡ä»¶ sz *.log # ä¸‹è½½å¹¶é‡å‘½åæ–‡ä»¶ sz -y original.txt newname.txt è¯¦ç»†æ­¥éª¤ åœ¨ Linux æœåŠ¡å™¨ä¸Šï¼Œå¯¼èˆªåˆ°åŒ…å«è¦ä¸‹è½½æ–‡ä»¶çš„ç›®å½• è¾“å…¥ sz å‘½ä»¤ åŠ ä¸Šæ–‡ä»¶å: 1 sz filename.txt é€‰æ‹©ä¿å­˜ä½ç½®: ç»ˆç«¯è½¯ä»¶ä¼šè‡ªåŠ¨å¼¹å‡ºä¿å­˜å¯¹è¯æ¡† é€‰æ‹©æœ¬åœ°ä¿å­˜ä½ç½®å’Œæ–‡ä»¶å ç›‘æ§ä¼ è¾“è¿›åº¦: ä¼ è¾“å¼€å§‹åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ ä¼ è¾“å®Œæˆåï¼Œæ–‡ä»¶ä¼šä¿å­˜åœ¨æŒ‡å®šä½ç½® é«˜çº§é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 # ä¸‹è½½æ•´ä¸ªç›®å½•ï¼ˆéœ€è¦å…ˆå‹ç¼©ï¼‰ tar czf - directory/ | sz -y directory.tar.gz # é™åˆ¶ä¼ è¾“é€Ÿç‡ï¼ˆKB/sï¼Œé€‚ç”¨äºå¤§æ–‡ä»¶æˆ–æ…¢é€Ÿè¿æ¥ï¼‰ sz -l 1024 largefile.iso # æ˜¾ç¤ºè¯¦ç»†è¾“å‡º sz -v filename.txt # å¼ºåˆ¶ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ sz -b image.jpg ğŸ”§ äº”ã€å¸¸ç”¨å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ ç¤ºä¾‹ -y è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶ sz -y file.txt -e è½¬ä¹‰æ§åˆ¶å­—ç¬¦ rz -e -E å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šæ‰©å±•å rz -E \u0026quot;*.txt\u0026quot; -b äºŒè¿›åˆ¶æ¨¡å¼ä¼ è¾“ sz -b image.jpg -v æ˜¾ç¤ºè¯¦ç»†è¾“å‡º rz -v -l é™åˆ¶ä¼ è¾“é€Ÿç‡ï¼ˆKB/sï¼‰ sz -l 512 bigfile.iso -q å®‰é™æ¨¡å¼ï¼Œå‡å°‘è¾“å‡º rz -q -c å‘é€å‘½ä»¤è€Œä¸æ˜¯æ–‡ä»¶ é«˜çº§ç”¨æ³• \u0026ndash;\nğŸ’¡ å…­ã€å®ç”¨æŠ€å·§å’Œç¤ºä¾‹ 1. ä¼ è¾“å¤§æ–‡ä»¶ 1 2 3 4 5 6 7 8 # åˆ†å·ä¼ è¾“å¤§æ–‡ä»¶ï¼ˆåœ¨ Linux ä¸Šåˆ†å‰²ï¼‰ split -b 100M largefile.iso largefile_part. # ä¼ è¾“æ‰€æœ‰åˆ†å· sz largefile_part.* # åœ¨æ¥æ”¶ç«¯åˆå¹¶åˆ†å·ï¼ˆWindows ä¸Šï¼‰ copy /b largefile_part.* largefile.iso 2. ä¼ è¾“æ•´ä¸ªç›®å½• 1 2 3 4 5 6 # å‹ç¼©åä¼ è¾“ tar czf - mydirectory/ | sz -y mydirectory.tar.gz # åœ¨æ¥æ”¶ç«¯è§£å‹ rz # æ¥æ”¶ tar.gz æ–‡ä»¶ tar xzf mydirectory.tar.gz 3. è‡ªåŠ¨åŒ–ä¼ è¾“è„šæœ¬ 1 2 3 4 5 6 7 8 #!/bin/bash # è‡ªåŠ¨å¤‡ä»½å¹¶ä¼ è¾“è„šæœ¬ BACKUP_FILE=\u0026#34;backup_$(date +%Y%m%d_%H%M%S).tar.gz\u0026#34; tar czf /tmp/$BACKUP_FILE /important/data/ echo \u0026#34;ğŸ“¦ å¼€å§‹ä¼ è¾“å¤‡ä»½æ–‡ä»¶: $BACKUP_FILE\u0026#34; sz /tmp/$BACKUP_FILE rm /tmp/$BACKUP_FILE echo \u0026#34;âœ… å¤‡ä»½ä¼ è¾“å®Œæˆï¼\u0026#34; 4. æ£€æŸ¥ä¼ è¾“å®Œæ•´æ€§ 1 2 3 4 5 6 # å‘é€ç«¯ç”Ÿæˆæ ¡éªŒå’Œ md5sum bigfile.iso \u0026gt; bigfile.iso.md5 sz bigfile.iso bigfile.iso.md5 # æ¥æ”¶ç«¯éªŒè¯ md5sum -c bigfile.iso.md5 5. æ‰¹é‡ä¼ è¾“è„šæœ¬ 1 2 3 4 5 #!/bin/bash # æ‰¹é‡ä¼ è¾“æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶ echo \u0026#34;ğŸ–¼ï¸ å¼€å§‹ä¼ è¾“å›¾ç‰‡æ–‡ä»¶...\u0026#34; sz *.jpg *.png *.gif echo \u0026#34;âœ… å›¾ç‰‡ä¼ è¾“å®Œæˆï¼\u0026#34; \u0026ndash;\nâš ï¸ ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ âŒ é—®é¢˜ 1: rz/sz å‘½ä»¤æœªæ‰¾åˆ° è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 # å®‰è£… lrzsz åŒ… sudo apt-get install lrzsz # Ubuntu/Debian sudo yum install lrzsz # CentOS/RHEL sudo dnf install lrzsz # Fedora/CentOS 8+ âŒ é—®é¢˜ 2: ä¼ è¾“ä¸­æ–­æˆ–ä¸ç¨³å®š è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 # ä½¿ç”¨é€Ÿç‡é™åˆ¶æé«˜ç¨³å®šæ€§ sz -l 512 largefile.iso # é™åˆ¶ä¸º 512KB/s # æˆ–è€…ä½¿ç”¨åˆ†å·ä¼ è¾“ split -b 50M largefile.iso largefile_part. sz largefile_part* âŒ é—®é¢˜ 3: ä¸­æ–‡æ–‡ä»¶åä¹±ç  è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 6 # è®¾ç½®æ­£ç¡®çš„å­—ç¬¦ç¼–ç  export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 # ç„¶åä¼ è¾“æ–‡ä»¶ sz ä¸­æ–‡æ–‡ä»¶.txt âŒ é—®é¢˜ 4: æƒé™ä¸è¶³ è§£å†³æ–¹æ¡ˆ:\n1 2 3 4 5 # ä¸Šä¼ åˆ°æœ‰å†™å…¥æƒé™çš„ç›®å½• cd /tmp rz # æˆ–è€…ä½¿ç”¨ sudoï¼ˆä½†éœ€è¦é…ç½® sudo å…è®¸ rz/szï¼‰ âŒ é—®é¢˜ 5: ç»ˆç«¯è½¯ä»¶ä¸æ”¯æŒ ZMODEM è§£å†³æ–¹æ¡ˆ:\næ¢ç”¨æ”¯æŒ ZMODEM çš„ç»ˆç«¯è½¯ä»¶ï¼ˆå¦‚ MobaXtermã€Xshellï¼‰ æˆ–è€…ä½¿ç”¨æ›¿ä»£ä¼ è¾“æ–¹æ³•ï¼ˆSCPã€SFTPï¼‰ âŒ é—®é¢˜ 6: é˜²ç«å¢™é˜»æ­¢ä¼ è¾“ è§£å†³æ–¹æ¡ˆ:\næ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ ZMODEM ç«¯å£æœªè¢«é˜»æ­¢ æˆ–è€…ä½¿ç”¨æ›¿ä»£ä¼ è¾“æ–¹æ³•ï¼ˆSCP ä½¿ç”¨ SSH ç«¯å£ï¼‰ ğŸ”„ å…«ã€æ›¿ä»£æ–¹æ¡ˆ è™½ç„¶ rz/sz å¾ˆæ–¹ä¾¿ï¼Œä½†è¿˜æœ‰å…¶ä»–æ–‡ä»¶ä¼ è¾“æ–¹æ³•å¯ä¾›é€‰æ‹©ï¼š\n1. SCP (Secure Copy) 1 2 3 4 5 6 7 8 # ä» Windows åˆ° Linux scp file.txt user@linux-server:/path/ # ä» Linux åˆ° Windows scp user@linux-server:/path/file.txt . # é€’å½’å¤åˆ¶ç›®å½• scp -r directory/ user@linux-server:/path/ 2. SFTP (SSH File Transfer Protocol) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯åŠ¨ SFTP ä¼šè¯ sftp user@linux-server # ä¸Šä¼ æ–‡ä»¶ put localfile.txt # ä¸‹è½½æ–‡ä»¶ get remotefile.txt # åˆ—å‡ºè¿œç¨‹æ–‡ä»¶ ls # é€€å‡º exit 3. Rsync (é«˜æ•ˆåŒæ­¥) 1 2 3 4 5 6 7 8 # åŒæ­¥æœ¬åœ°ç›®å½•åˆ°è¿œç¨‹ rsync -avz /local/path/ user@linux-server:/remote/path/ # ä»è¿œç¨‹åŒæ­¥åˆ°æœ¬åœ° rsync -avz user@linux-server:/remote/path/ /local/path/ # éƒ¨åˆ†åŒæ­¥ï¼ˆä»…æ›´æ–°å˜åŒ–éƒ¨åˆ†ï¼‰ rsync -avz --progress user@linux-server:/remote/path/ /local/path/ 4. HTTP ä¸‹è½½ 1 2 3 4 5 # åœ¨ Linux ä¸Šå¯åŠ¨ç®€å• HTTP æœåŠ¡å™¨ python3 -m http.server 8000 # ç„¶ååœ¨ Windows æµè§ˆå™¨ä¸­è®¿é—® # http://linux-server-ip:8000 5. å…±äº«æ–‡ä»¶å¤¹/NFS 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨ Linux ä¸Šè®¾ç½® NFS å…±äº« sudo apt-get install nfs-kernel-server # Ubuntu/Debian sudo yum install nfs-utils # CentOS/RHEL # é…ç½®å¯¼å‡ºç›®å½• sudo nano /etc/exports # æ·»åŠ : /path/to/share *(rw,sync,no_subtree_check) # é‡å¯æœåŠ¡ sudo systemctl restart nfs-server # åœ¨ Windows ä¸Šæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ \u0026ndash;\nğŸ“Š ä¹ã€rz/sz ä¸å…¶ä»–å·¥å…·å¯¹æ¯” ç‰¹æ€§ rz/sz SCP SFTP Rsync æ˜“ç”¨æ€§ â­â­â­â­â­ â­â­â­â­ â­â­â­ â­â­â­ é€Ÿåº¦ â­â­â­ â­â­â­â­ â­â­â­â­ â­â­â­â­â­ æ–­ç‚¹ç»­ä¼  âœ… âŒ âœ… âœ… ç›®å½•åŒæ­¥ âŒ âŒ âœ… âœ… æ— éœ€é¢å¤–é…ç½® âœ… âŒ âŒ âŒ å›¾å½¢ç•Œé¢æ”¯æŒ âŒ âœ… âœ… âŒ ğŸ¯ åã€æœ€ä½³å®è·µå»ºè®® å°æ–‡ä»¶ä¼˜å…ˆ ğŸ“: rz/sz æœ€é€‚åˆä¸­å°å‹æ–‡ä»¶ä¼ è¾“ï¼ˆ\u0026lt; 1GBï¼‰ ç¨³å®šæ€§ä¼˜å…ˆ ğŸŒ: å¯¹äºä¸ç¨³å®šè¿æ¥ï¼Œä½¿ç”¨é€Ÿç‡é™åˆ¶å‚æ•° -l éªŒè¯å®Œæ•´æ€§ âœ…: é‡è¦æ–‡ä»¶ä¼ è¾“åéªŒè¯ MD5 æ ¡éªŒå’Œ å®‰å…¨æ€§è€ƒè™‘ ğŸ”’: æ•æ„Ÿæ–‡ä»¶è€ƒè™‘ä½¿ç”¨åŠ å¯†ä¼ è¾“æ›¿ä»£æ–¹æ¡ˆ å¤‡ä»½é‡è¦æ•°æ® ğŸ’¾: é‡è¦æ“ä½œå‰åšå¥½å¤‡ä»½ é€‰æ‹©åˆé€‚çš„å·¥å…· ğŸ› ï¸: æ ¹æ®æ–‡ä»¶å¤§å°å’Œç½‘ç»œæ¡ä»¶é€‰æ‹©æœ€ä½³ä¼ è¾“æ–¹å¼ ç›‘æ§ä¼ è¾“è¿‡ç¨‹ ğŸ‘€: å¤§å‹æ–‡ä»¶ä¼ è¾“æ—¶ä¿æŒä¼šè¯æ´»è·ƒï¼Œé¿å…è¶…æ—¶ ä¼ è¾“ç­–ç•¥é€‰æ‹©æŒ‡å— å°æ–‡ä»¶ (\u0026lt;100MB): ç›´æ¥ä½¿ç”¨ rz/sz ä¸­ç­‰æ–‡ä»¶ (100MB-1GB): ä½¿ç”¨ rz/sz å¸¦é€Ÿç‡é™åˆ¶æˆ– SCP å¤§æ–‡ä»¶ (\u0026gt;1GB): ä½¿ç”¨ Rsync æˆ–åˆ†å·ä¼ è¾“ ç›®å½•åŒæ­¥: ä½¿ç”¨ Rsync æˆ– SFTP è‡ªåŠ¨åŒ–è„šæœ¬: ä½¿ç”¨ SCP æˆ– Rsync ğŸ’¡ æç¤º: å¯¹äºæ—¥å¸¸ä½¿ç”¨ï¼Œrz/sz æä¾›äº†æœ€å¿«æ·æ–¹ä¾¿çš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯åœ¨æ²¡æœ‰å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ç¯å¢ƒä¸­ã€‚ä½†å¯¹äºå¤§è§„æ¨¡æˆ–è‡ªåŠ¨åŒ–æ–‡ä»¶ä¼ è¾“ï¼Œå»ºè®®è€ƒè™‘ SCP æˆ– Rsync ç­‰æ›´å¯é çš„æ–¹æ¡ˆã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨è½»æ¾åœ¨ Linux å’Œ Windows ç³»ç»Ÿä¹‹é—´ä¼ è¾“æ–‡ä»¶ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·å‚è€ƒå„ç»ˆç«¯è½¯ä»¶çš„å®˜æ–¹æ–‡æ¡£ã€‚ğŸ‰\n","date":"2024-12-07T15:09:44+08:00","image":"https://file.meimolihan.eu.org/img/linux-windows-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d599baa1/","title":"Linux å’Œ Windows ç³»ç»Ÿé—´æ–‡ä»¶ä¼ è¾“ ğŸ”„"},{"content":"Proxmox VE å†…æ ¸å‡çº§ \u0026amp; é™çº§æŒ‡å— ğŸ§ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Proxmox VE ä¸­å®‰å…¨åœ°å‡çº§æˆ–é™çº§å†…æ ¸ç‰ˆæœ¬ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ã€ç¡¬ä»¶å…¼å®¹æ€§å’Œå®‰å…¨æ€§ã€‚åŒ…å«ä»åŸºç¡€æ“ä½œåˆ°é«˜çº§ç®¡ç†çš„å…¨é¢å†…å®¹ï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ æ¦‚è¿° âš ï¸ é‡è¦æç¤º ğŸ”„ å†…æ ¸ç®¡ç†åŸºæœ¬æ“ä½œ â¬†ï¸ å‡çº§å†…æ ¸ç‰ˆæœ¬ ğŸ“Œ å†…æ ¸ç‰ˆæœ¬å›ºåŒ– â¬‡ï¸ é™çº§å†…æ ¸ç‰ˆæœ¬ ğŸ› ï¸ å†…æ ¸å¤´æ–‡ä»¶å®‰è£… ğŸ”§ é«˜çº§å†…æ ¸ç®¡ç† ğŸ“Š å†…æ ¸ç‰ˆæœ¬é€‰æ‹©å»ºè®® ğŸš¨ æ•…éšœæ’é™¤ä¸æ¢å¤ ğŸ¤– è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ ğŸ’¡ æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ âœ¨ æ¦‚è¿° Proxmox VE åŸºäº Debianï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ Linux å†…æ ¸ã€‚æ­£ç¡®ç®¡ç†å†…æ ¸ç‰ˆæœ¬å¯¹äºç³»ç»Ÿç¨³å®šæ€§ã€ç¡¬ä»¶å…¼å®¹æ€§å’Œå®‰å…¨æ€§è‡³å…³é‡è¦ã€‚\nå†…æ ¸ç®¡ç†çš„é‡è¦æ€§ï¼š\nğŸ”§ ç¡¬ä»¶å…¼å®¹æ€§ï¼šæ–°ç‰ˆå†…æ ¸é€šå¸¸æ”¯æŒæ›´æ–°çš„ç¡¬ä»¶ ğŸ›¡ï¸ å®‰å…¨æ€§ï¼šå†…æ ¸æ›´æ–°åŒ…å«é‡è¦çš„å®‰å…¨è¡¥ä¸ âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šæ–°å†…æ ¸å¯èƒ½æä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ”¹è¿› ğŸ”„ ç¨³å®šæ€§ï¼šæœ‰æ—¶éœ€è¦é™çº§å†…æ ¸ä»¥è§£å†³å…¼å®¹æ€§é—®é¢˜ ğŸ“Š åŠŸèƒ½å¢å¼ºï¼šæ–°ç‰¹æ€§å’Œæ–°åŠŸèƒ½é€šå¸¸éœ€è¦æ–°ç‰ˆå†…æ ¸ âš ï¸ é‡è¦æç¤º åœ¨è¿›è¡Œä»»ä½•å†…æ ¸æ“ä½œå‰ï¼Œè¯·åŠ¡å¿…ï¼š\nå¤‡ä»½é‡è¦æ•°æ®ï¼šåŒ…æ‹¬è™šæ‹Ÿæœºé…ç½®ã€å­˜å‚¨è®¾ç½®å’Œç³»ç»Ÿé…ç½®\n1 2 3 4 5 6 7 8 # å¤‡ä»½è™šæ‹Ÿæœºåˆ—è¡¨ qm list \u0026gt; /root/vm-backup-list.txt # å¤‡ä»½ç½‘ç»œé…ç½® cp /etc/network/interfaces /root/network-backup.interfaces # å¤‡ä»½å­˜å‚¨é…ç½® cp /etc/pve/storage.cfg /root/storage-backup.cfg ç¡®ä¿æœ‰ç‰©ç†è®¿é—®æˆ–å¯é çš„æ¢å¤æ–¹æ³•ï¼šå¦‚æœè¿œç¨‹æ“ä½œï¼Œç¡®ä¿æœ‰å¸¦å¤–ç®¡ç†(IPMI/iDRAC)æˆ–æ¢å¤æ–¹æ¡ˆ\nåœ¨æµ‹è¯•ç¯å¢ƒä¸­å…ˆè¡ŒéªŒè¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒæ“ä½œå‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯\näº†è§£å¦‚ä½•ä»æ—§å†…æ ¸å¯åŠ¨ï¼šç†Ÿæ‚‰GRUBèœå•æ“ä½œï¼ŒçŸ¥é“å¦‚ä½•é€‰æ‹©æ—§å†…æ ¸å¯åŠ¨\næ£€æŸ¥å½“å‰å†…æ ¸å’Œç³»ç»ŸçŠ¶æ€\n1 2 3 4 5 6 7 8 9 # è®°å½•å½“å‰å†…æ ¸ç‰ˆæœ¬ uname -r \u0026gt; /root/current-kernel.txt # æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— dmesg | tail -50 # æ£€æŸ¥ç¡¬ä»¶çŠ¶æ€ lspci lsmod ğŸ”„ å†…æ ¸ç®¡ç†åŸºæœ¬æ“ä½œ 1. æ›´æ–°è½¯ä»¶æº 1 apt update ç¡®ä¿è·å–æœ€æ–°çš„è½¯ä»¶åŒ…ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯ç”¨çš„å†…æ ¸ç‰ˆæœ¬ã€‚\n2. æŸ¥çœ‹å¯ç”¨å†…æ ¸ç‰ˆæœ¬ 1 2 3 4 5 6 7 8 # åˆ—å‡ºæ‰€æœ‰å¯å®‰è£…çš„ PVE å†…æ ¸ç‰ˆæœ¬ apt-cache search pve-kernel # ä½¿ç”¨æ›´è¯¦ç»†çš„æœç´¢ apt-cache search --names-only \u0026#39;^pve-kernel-[0-9]\u0026#39; # æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ apt-cache show pve-kernel-6.5.11-4-pve 3. æŸ¥çœ‹å½“å‰å·²å®‰è£…å†…æ ¸ 1 2 3 4 5 6 7 8 9 10 11 12 # æ˜¾ç¤ºå½“å‰è¿è¡Œçš„å†…æ ¸ uname -r uname -a # æ˜¾ç¤ºæ‰€æœ‰å·²å®‰è£…å†…æ ¸ dpkg -l | grep pve-kernel # ä½¿ç”¨ proxmox å·¥å…·æŸ¥çœ‹ proxmox-boot-tool kernel list # æŸ¥çœ‹å†…æ ¸æ–‡ä»¶ ls -la /boot/vmlinuz-* 4. æ£€æŸ¥å†…æ ¸ä¾èµ–å…³ç³» 1 2 3 4 5 # æ£€æŸ¥å†…æ ¸åŒ…ä¾èµ– apt-cache depends pve-kernel-6.5.11-4-pve # æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ apt-check â¬†ï¸ å‡çº§å†…æ ¸ç‰ˆæœ¬ 1. å®‰è£…æŒ‡å®šç‰ˆæœ¬å†…æ ¸ 1 2 3 4 5 # å®‰è£…ç‰¹å®šç‰ˆæœ¬å†…æ ¸ apt install pve-kernel-6.5.11-4-pve # æˆ–è€…å®‰è£…æœ€æ–°å¯ç”¨å†…æ ¸ apt install pve-kernel-$(apt-cache search --names-only \u0026#39;^pve-kernel-[0-9]\u0026#39; | awk \u0026#39;{print $1}\u0026#39; | sort -V | tail -1) 2. æ›´æ–° GRUB å¼•å¯¼é…ç½® 1 2 3 4 5 6 7 8 # æ›´æ–° GRUB é…ç½® update-grub # å¯¹äº UEFI ç³»ç»Ÿï¼Œè¿˜éœ€è¦æ›´æ–° systemd-boot proxmox-boot-tool refresh # æ£€æŸ¥ GRUB é…ç½® grep -A 10 -B 5 \u0026#34;menuentry\u0026#34; /boot/grub/grub.cfg 3. é‡å¯ç³»ç»Ÿä½¿ç”¨æ–°å†…æ ¸ 1 2 3 4 5 6 7 8 # è®¡åˆ’é‡å¯ shutdown -r +10 \u0026#34;å†…æ ¸å‡çº§é‡å¯\u0026#34; # æˆ–è€…ç«‹å³é‡å¯ reboot # å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ kexec å¿«é€Ÿé‡å¯ï¼ˆé«˜çº§ç”¨æ³•ï¼‰ # apt install kexec-tools 4. éªŒè¯æ–°å†…æ ¸ 1 2 3 4 5 6 7 8 9 # ç¡®è®¤å½“å‰è¿è¡Œçš„æ˜¯æ–°å†…æ ¸ç‰ˆæœ¬ uname -r # æ£€æŸ¥å†…æ ¸å¯åŠ¨æ—¶é—´ dmesg | grep \u0026#34;BOOT_IMAGE\u0026#34; # éªŒè¯æ‰€æœ‰ç¡¬ä»¶é©±åŠ¨æ­£å¸¸åŠ è½½ dmesg | grep -i error lsmod 5. æ¸…ç†æ—§å†…æ ¸ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å¯æ¸…ç†çš„æ—§å†…æ ¸ proxmox-boot-tool kernel list # ç§»é™¤ä¸å†éœ€è¦çš„æ—§å†…æ ¸ï¼ˆè°¨æ…æ“ä½œï¼‰ apt remove pve-kernel-5.15.102-1-pve # è‡ªåŠ¨æ¸…ç†ä¸å†éœ€è¦çš„åŒ… apt autoremove ğŸ“Œ å†…æ ¸ç‰ˆæœ¬å›ºåŒ– 1. å›ºåŒ–ç‰¹å®šå†…æ ¸ç‰ˆæœ¬ 1 2 3 4 5 # å›ºåŒ–æŒ‡å®šå†…æ ¸ç‰ˆæœ¬ proxmox-boot-tool kernel pin 6.5.11-4-pve # æˆ–è€…ä½¿ç”¨é€šé…ç¬¦å›ºåŒ–ç³»åˆ—ç‰ˆæœ¬ proxmox-boot-tool kernel pin 6.5.* 2. æ£€æŸ¥å›ºåŒ–çŠ¶æ€ 1 2 3 4 5 6 7 8 # æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å†…æ ¸åŠå›ºåŒ–çŠ¶æ€ proxmox-boot-tool kernel list # æ£€æŸ¥å½“å‰å›ºåŒ–è®¾ç½® cat /etc/default/pve-kernel # æŸ¥çœ‹å›ºåŒ–å†å² journalctl -u pve-kernel -f 3. å–æ¶ˆå†…æ ¸å›ºåŒ– 1 2 3 4 5 6 # å–æ¶ˆå†…æ ¸å›ºåŒ– proxmox-boot-tool kernel unpin # æˆ–è€…æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ nano /etc/default/pve-kernel # åˆ é™¤æˆ–æ³¨é‡Šæ‰ PINNED_KERNEL è¡Œ 4. ä¸´æ—¶è¦†ç›–å›ºåŒ–è®¾ç½® 1 2 3 4 5 6 7 # ä¸´æ—¶å®‰è£…ç‰¹å®šå†…æ ¸ï¼ˆå³ä½¿æœ‰å›ºåŒ–è®¾ç½®ï¼‰ apt install -o Dpkg::Options::=\u0026#34;--force-overwrite\u0026#34; pve-kernel-6.5.13-1-pve # ä¸´æ—¶å–æ¶ˆå›ºåŒ–è¿›è¡Œæ›´æ–° proxmox-boot-tool kernel unpin apt update \u0026amp;\u0026amp; apt upgrade proxmox-boot-tool kernel pin 6.5.* â¬‡ï¸ é™çº§å†…æ ¸ç‰ˆæœ¬ 1. æŸ¥çœ‹å·²å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ 1 2 3 4 5 6 7 8 # åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…å†…æ ¸ï¼ŒæŒ‰ç‰ˆæœ¬æ’åº dpkg -l | grep pve-kernel | sort -V # æŸ¥çœ‹å¯ç”¨æ—§ç‰ˆæœ¬ apt-cache search pve-kernel | grep -E \u0026#39;^pve-kernel-[0-9]\u0026#39; | sort -V # æ£€æŸ¥ä»“åº“ä¸­æ˜¯å¦æœ‰æ—§ç‰ˆæœ¬ apt-cache policy pve-kernel-5.15.107-1-pve 2. å®‰è£…æ—§ç‰ˆæœ¬å†…æ ¸ 1 2 3 4 5 6 # å®‰è£…ç‰¹å®šæ—§ç‰ˆæœ¬å†…æ ¸ apt install pve-kernel-5.15.107-1-pve # å¦‚æœç‰ˆæœ¬ä¸åœ¨å½“å‰ä»“åº“ä¸­ï¼Œå¯ä»¥æ·»åŠ æ—§ç‰ˆæœ¬ä»“åº“æˆ–æ‰‹åŠ¨ä¸‹è½½ wget http://download.proxmox.com/debian/pve/dists/bullseye/pve-no-subscription/binary-amd64/pve-kernel-5.15.107-1-pve_5.15.107-1_amd64.deb dpkg -i pve-kernel-5.15.107-1-pve_5.15.107-1_amd64.deb 3. ç§»é™¤æ–°ç‰ˆæœ¬å†…æ ¸ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 # ç§»é™¤æœ‰é—®é¢˜çš„æ–°ç‰ˆæœ¬å†…æ ¸ apt remove pve-kernel-6.5.13-1-pve # æ³¨æ„ï¼šç¡®ä¿è‡³å°‘ä¿ç•™ä¸€ä¸ªå¯å¯åŠ¨çš„å†…æ ¸ # å¯ä»¥å…ˆæ£€æŸ¥å‰©ä½™å†…æ ¸æ•°é‡ dpkg -l | grep pve-kernel | wc -l 4. æ›´æ–° GRUB å¹¶é‡å¯ 1 2 3 4 5 6 7 8 # æ›´æ–° GRUB é…ç½® update-grub # è®¾ç½®é»˜è®¤å¯åŠ¨é¡¹ä¸ºæ—§å†…æ ¸ï¼ˆå¦‚æœéœ€è¦ï¼‰ grub-set-default \u0026#34;Advanced options for Proxmox VE GNU/Linux\u0026gt;Proxmox VE GNU/Linux, with Linux 5.15.107-1-pve\u0026#34; # é‡å¯ç³»ç»Ÿ reboot 5. éªŒè¯é™çº§ç»“æœ 1 2 3 4 5 6 7 8 9 # ç¡®è®¤å½“å‰è¿è¡Œçš„æ˜¯æ—§å†…æ ¸ç‰ˆæœ¬ uname -r # æ£€æŸ¥ç³»ç»Ÿç¨³å®šæ€§ dmesg | grep -i error # æµ‹è¯•å…³é”®åŠŸèƒ½ï¼ˆç½‘ç»œã€å­˜å‚¨ç­‰ï¼‰ ip a zpool status ğŸ› ï¸ å†…æ ¸å¤´æ–‡ä»¶å®‰è£… 1. å®‰è£…å¯¹åº”å†…æ ¸çš„å¤´æ–‡ä»¶ 1 2 3 4 5 6 7 8 # å®‰è£…ä¸å½“å‰å†…æ ¸åŒ¹é…çš„å¤´æ–‡ä»¶ apt install pve-headers-$(uname -r) # æˆ–è€…å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„å¤´æ–‡ä»¶ apt install pve-headers-6.5.11-4-pve # å®‰è£…å¼€å‘å·¥å…·é“¾ï¼ˆå¦‚æœéœ€è¦ç¼–è¯‘æ¨¡å—ï¼‰ apt install build-essential dkms 2. éªŒè¯å¤´æ–‡ä»¶å®‰è£… 1 2 3 4 5 6 7 8 # æ£€æŸ¥å¤´æ–‡ä»¶æ˜¯å¦æˆåŠŸå®‰è£… dpkg -l | grep pve-headers # ç¡®è®¤å¤´æ–‡ä»¶è·¯å¾„ ls -la /usr/src/ # æ£€æŸ¥å†…æ ¸æ„å»ºé…ç½® zcat /proc/config.gz | head -20 3. é‡æ–°ç¼–è¯‘å†…æ ¸æ¨¡å— 1 2 3 4 5 6 7 8 9 10 11 # é‡æ–°ç¼–è¯‘ ZFS æ¨¡å—ï¼ˆå¸¸è§éœ€æ±‚ï¼‰ apt install pve-headers-$(uname -r) dpkg-reconfigure zfs-dkms # æˆ–è€…æ‰‹åŠ¨è§¦å‘ç¼–è¯‘ dkms build zfs/2.1.9 -k $(uname -r) dkms install zfs/2.1.9 -k $(uname -r) # æ£€æŸ¥æ¨¡å—çŠ¶æ€ dkms status modprobe zfs 4. è‡ªå®šä¹‰å†…æ ¸æ¨¡å—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å·²åŠ è½½æ¨¡å— lsmod # æŸ¥æ‰¾æ¨¡å—ä¿¡æ¯ modinfo zfs # æ‰‹åŠ¨åŠ è½½/å¸è½½æ¨¡å— modprobe module_name rmmod module_name # æ°¸ä¹…æ·»åŠ æ¨¡å—åˆ°åŠ è½½åˆ—è¡¨ echo \u0026#34;module_name\u0026#34; \u0026gt;\u0026gt; /etc/modules ğŸ”§ é«˜çº§å†…æ ¸ç®¡ç† 1. å†…æ ¸å‚æ•°è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å½“å‰å†…æ ¸å‚æ•° sysctl -a | head -20 # ä¸´æ—¶ä¿®æ”¹å†…æ ¸å‚æ•° sysctl -w vm.swappiness=10 # æ°¸ä¹…ä¿®æ”¹å†…æ ¸å‚æ•° echo \u0026#34;vm.swappiness=10\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p # æŸ¥çœ‹ç‰¹å®šå‚æ•° sysctl vm.swappiness 2. å†…æ ¸æ¨¡å—é»‘åå• 1 2 3 4 5 6 7 8 # ç¦ç”¨ä¸éœ€è¦çš„æ¨¡å— echo \u0026#34;blacklist module_name\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf # æ›´æ–° initramfs update-initramfs -u # æ£€æŸ¥é»‘åå•ç”Ÿæ•ˆ lsmod | grep module_name 3. å†…æ ¸è°ƒè¯•ä¸è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 # å¯ç”¨å†…æ ¸è°ƒè¯•è¾“å‡º echo \u0026#34;8\u0026#34; \u0026gt; /proc/sys/kernel/printk # æŸ¥çœ‹å†…æ ¸ç¯å½¢ç¼“å†²åŒº dmesg -T # å®æ—¶ç›‘æ§å†…æ ¸æ¶ˆæ¯ journalctl -k -f # æ£€æŸ¥å†…æ ¸é”™è¯¯ grep -i error /var/log/kern.log 4. æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # å®‰è£…æ€§èƒ½ç›‘æ§å·¥å…· apt install sysstat linux-perf # ç›‘æ§ç³»ç»Ÿæ€§èƒ½ vmstat 1 10 iostat -x 1 10 # ä½¿ç”¨ perf è¿›è¡Œæ€§èƒ½åˆ†æ perf top # è°ƒæ•´å†…æ ¸è°ƒåº¦å‚æ•° echo \u0026#39;kernel.sched_autogroup_enabled = 1\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.d/99-scheduler.conf ğŸ“Š å†…æ ¸ç‰ˆæœ¬é€‰æ‹©å»ºè®® å†…æ ¸ç‰ˆæœ¬ é€‚ç”¨åœºæ™¯ æ³¨æ„äº‹é¡¹ æœ€æ–°ç¨³å®šç‰ˆ æ–°ç¡¬ä»¶æ”¯æŒã€å®‰å…¨æ›´æ–°ã€éœ€è¦æœ€æ–°åŠŸèƒ½ å¯èƒ½å­˜åœ¨æœªçŸ¥å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯ LTS é•¿æœŸæ”¯æŒç‰ˆ ç”Ÿäº§ç¯å¢ƒã€ç¨³å®šæ€§ä¼˜å…ˆã€é•¿æœŸè¿è¡Œç³»ç»Ÿ å¯èƒ½ç¼ºå°‘æœ€æ–°ç¡¬ä»¶æ”¯æŒï¼Œä½†ç»è¿‡å……åˆ†æµ‹è¯• æ—§ç‰ˆæœ¬ è§£å†³å…¼å®¹æ€§é—®é¢˜ã€ç‰¹å®šç¡¬ä»¶éœ€æ±‚ å¯èƒ½ç¼ºå°‘å®‰å…¨æ›´æ–°ï¼Œéœ€è¯„ä¼°å®‰å…¨é£é™© æ¨èç­–ç•¥ï¼š æµ‹è¯•ç¯å¢ƒï¼šä½¿ç”¨æœ€æ–°å†…æ ¸ï¼Œæå‰å‘ç°å…¼å®¹æ€§é—®é¢˜\n1 2 3 # åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¯ç”¨æµ‹è¯•ä»“åº“ echo \u0026#34;deb http://download.proxmox.com/debian/pve test main\u0026#34; \u0026gt; /etc/apt/sources.list.d/pvetest.list apt update ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ç»è¿‡éªŒè¯çš„ç¨³å®šç‰ˆæœ¬ï¼Œå»¶è¿Ÿå‡çº§\n1 2 # å›ºåŒ–ç”Ÿäº§ç¯å¢ƒå†…æ ¸ç‰ˆæœ¬ proxmox-boot-tool kernel pin 6.2.* ç‰¹å®šç¡¬ä»¶ï¼šé€‰æ‹©æä¾›æ‰€éœ€é©±åŠ¨ç¨‹åºçš„ç‰ˆæœ¬\n1 2 3 # æ£€æŸ¥ç¡¬ä»¶å…¼å®¹æ€§ lspci -k # æŸ¥æ‰¾æ‰€éœ€é©±åŠ¨æ”¯æŒçš„å†…æ ¸ç‰ˆæœ¬ å®‰å…¨å…³é”®ç¯å¢ƒï¼šä¼˜å…ˆé€‰æ‹©åŒ…å«å®‰å…¨è¡¥ä¸çš„ç‰ˆæœ¬\n1 2 # è®¢é˜…å®‰å…¨å…¬å‘Š # å…³æ³¨ Proxmox å®‰å…¨é‚®ä»¶åˆ—è¡¨ ğŸš¨ æ•…éšœæ’é™¤ä¸æ¢å¤ 1. å†…æ ¸å¯åŠ¨å¤±è´¥ å¦‚æœæ–°å†…æ ¸æ— æ³•å¯åŠ¨ï¼š\né‡å¯ç³»ç»Ÿ åœ¨ GRUB èœå•ä¸­é€‰æ‹©æ—§å†…æ ¸å¯åŠ¨ ç§»é™¤æœ‰é—®é¢˜çš„æ–°å†…æ ¸ï¼š 1 2 3 4 5 6 7 8 # ç™»å½•åç§»é™¤é—®é¢˜å†…æ ¸ apt remove pve-kernel-6.5.13-1-pve # æ›´æ–° GRUB é…ç½® update-grub # æ£€æŸ¥å¯åŠ¨é¡¹ grep -A 10 -B 5 \u0026#34;menuentry\u0026#34; /boot/grub/grub.cfg 2. æ¨¡å—ä¸å…¼å®¹ å¦‚æœç¡¬ä»¶é©±åŠ¨æˆ–æ¨¡å—ä¸å…¼å®¹ï¼š\n1 2 3 4 5 6 7 8 9 # é‡æ–°ç¼–è¯‘ ZFS æ¨¡å—ï¼ˆå¦‚éœ€è¦ï¼‰ apt install pve-headers-$(uname -r) dpkg-reconfigure zfs-dkms # æˆ–è€…å°è¯•é™çº§ç›¸å…³æ¨¡å— apt install zfs-dkms=2.1.9-pve1 # æ£€æŸ¥æ¨¡å—ä¾èµ– depmod -a 3. ç½‘ç»œé—®é¢˜ å¦‚æœæ–°å†…æ ¸å¯¼è‡´ç½‘ç»œé—®é¢˜ï¼š\n1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥åŠ è½½çš„ç½‘ç»œé©±åŠ¨ lsmod | grep -E \u0026#39;(e1000|ixgbe|bnxt|mlx)\u0026#39; # é‡æ–°åŠ è½½é©±åŠ¨æ¨¡å— modprobe -r \u0026lt;é©±åŠ¨æ¨¡å—å\u0026gt; modprobe \u0026lt;é©±åŠ¨æ¨¡å—å\u0026gt; # æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€ ip link show ethtool \u0026lt;æ¥å£å\u0026gt; 4. æ–‡ä»¶ç³»ç»Ÿé—®é¢˜ å¦‚æœé‡åˆ°æ–‡ä»¶ç³»ç»ŸæŒ‚è½½é—®é¢˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ fsck /dev/sdX # æ£€æŸ¥ ZFS æ± çŠ¶æ€ zpool status zpool import # æ£€æŸ¥ LVM çŠ¶æ€ pvdisplay vgdisplay lvdisplay 5. æ¢å¤æ¨¡å¼ å¦‚æœæ— æ³•æ­£å¸¸å¯åŠ¨ï¼š\nä½¿ç”¨æ¢å¤æ¨¡å¼ï¼šåœ¨ GRUB èœå•ä¸­é€‰æ‹©æ¢å¤æ¨¡å¼ ä½¿ç”¨ Live CDï¼šä½¿ç”¨ Proxmox å®‰è£…ä»‹è´¨å¯åŠ¨ chroot ä¿®å¤ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 # ä» Live CD æŒ‚è½½æ ¹åˆ†åŒº mount /dev/pve/root /mnt mount /dev/sda1 /mnt/boot mount -t proc proc /mnt/proc mount -t sysfs sys /mnt/sys mount -o bind /dev /mnt/dev # chroot åˆ°ç³»ç»Ÿ chroot /mnt # è¿›è¡Œä¿®å¤æ“ä½œ apt remove pve-kernel-6.5.13-1-pve update-grub ğŸ¤– è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ å®‰å…¨å†…æ ¸æ›´æ–°è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 #!/bin/bash # æ—¥å¿—è®°å½• LOG_FILE=\u0026#34;/var/log/kernel-update-$(date +%Y%m%d).log\u0026#34; exec \u0026gt; \u0026gt;(tee -a \u0026#34;$LOG_FILE\u0026#34;) 2\u0026gt;\u0026amp;1 exec 2\u0026gt;\u0026amp;1 echo \u0026#34;=== å¼€å§‹å†…æ ¸æ›´æ–°: $(date) ===\u0026#34; echo \u0026#34;å½“å‰å†…æ ¸ç‰ˆæœ¬: $(uname -r)\u0026#34; # å¤‡ä»½å½“å‰å†…æ ¸ä¿¡æ¯ BACKUP_DIR=\u0026#34;/root/kernel-backup/$(date +%Y%m%d_%H%M%S)\u0026#34; mkdir -p \u0026#34;$BACKUP_DIR\u0026#34; echo \u0026#34;å¤‡ä»½ç›®å½•: $BACKUP_DIR\u0026#34; # å¤‡ä»½é‡è¦é…ç½® dpkg -l | grep pve-kernel \u0026gt; \u0026#34;$BACKUP_DIR/kernel-list.txt\u0026#34; uname -a \u0026gt; \u0026#34;$BACKUP_DIR/uname-info.txt\u0026#34; cp /etc/network/interfaces \u0026#34;$BACKUP_DIR/\u0026#34; cp /etc/pve/storage.cfg \u0026#34;$BACKUP_DIR/\u0026#34; cp /boot/grub/grub.cfg \u0026#34;$BACKUP_DIR/\u0026#34; # æ›´æ–°è½¯ä»¶æº echo \u0026#34;æ›´æ–°è½¯ä»¶æº...\u0026#34; if ! apt update; then echo \u0026#34;é”™è¯¯: è½¯ä»¶æºæ›´æ–°å¤±è´¥!\u0026#34; exit 1 fi # æŸ¥æ‰¾æœ€æ–°å¯ç”¨å†…æ ¸ LATEST_KERNEL=$(apt-cache search --names-only \u0026#39;^pve-kernel-[0-9]\u0026#39; | awk \u0026#39;{print $1}\u0026#39; | sort -V | tail -1) if [ -z \u0026#34;$LATEST_KERNEL\u0026#34; ]; then echo \u0026#34;é”™è¯¯: æœªæ‰¾åˆ°å¯ç”¨å†…æ ¸!\u0026#34; exit 1 fi echo \u0026#34;æ‰¾åˆ°æœ€æ–°å†…æ ¸: $LATEST_KERNEL\u0026#34; # æ£€æŸ¥æ˜¯å¦å·²å®‰è£… if dpkg -l | grep -q \u0026#34;$LATEST_KERNEL\u0026#34;; then echo \u0026#34;ä¿¡æ¯: $LATEST_KERNEL å·²å®‰è£…ï¼Œæ— éœ€æ›´æ–°\u0026#34; exit 0 fi # å®‰è£…æ–°å†…æ ¸ echo \u0026#34;å®‰è£…æ–°å†…æ ¸: $LATEST_KERNEL\u0026#34; if ! apt install -y \u0026#34;$LATEST_KERNEL\u0026#34;; then echo \u0026#34;é”™è¯¯: å†…æ ¸å®‰è£…å¤±è´¥!\u0026#34; exit 1 fi # å®‰è£…å¯¹åº”å¤´æ–‡ä»¶ HEADERS_PKG=\u0026#34;${LATEST_KERNEL/kernel/headers}\u0026#34; if apt-cache show \u0026#34;$HEADERS_PKG\u0026#34; \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;å®‰è£…å†…æ ¸å¤´æ–‡ä»¶: $HEADERS_PKG\u0026#34; apt install -y \u0026#34;$HEADERS_PKG\u0026#34; fi # æ›´æ–° GRUB echo \u0026#34;æ›´æ–° GRUB é…ç½®...\u0026#34; update-grub # æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–° systemd-boot if [ -d /boot/efi ]; then proxmox-boot-tool refresh fi echo \u0026#34;=== å†…æ ¸æ›´æ–°å®Œæˆ: $(date) ===\u0026#34; echo \u0026#34;æ–°å†…æ ¸: $LATEST_KERNEL\u0026#34; echo \u0026#34;è¯·é‡å¯ç³»ç»Ÿä»¥åº”ç”¨æ–°å†…æ ¸: reboot\u0026#34; echo \u0026#34;æ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; # å‘é€é€šçŸ¥ï¼ˆå¦‚æœæœ‰é…ç½®é€šçŸ¥ç³»ç»Ÿï¼‰ if command -v sendmail \u0026amp;\u0026gt; /dev/null; then echo \u0026#34;å†…æ ¸æ›´æ–°å®Œæˆäº $(date)\u0026#34; | mail -s \u0026#34;PVE å†…æ ¸æ›´æ–°é€šçŸ¥\u0026#34; admin@example.com fi å†…æ ¸å¥åº·æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # å†…æ ¸å¥åº·æ£€æŸ¥ echo \u0026#34;=== å†…æ ¸å¥åº·æ£€æŸ¥: $(date) ===\u0026#34; # æ£€æŸ¥å½“å‰å†…æ ¸ echo \u0026#34;å½“å‰å†…æ ¸: $(uname -r)\u0026#34; # æ£€æŸ¥å·²å®‰è£…å†…æ ¸ echo \u0026#34;å·²å®‰è£…å†…æ ¸:\u0026#34; dpkg -l | grep pve-kernel | awk \u0026#39;{print $2 \u0026#34; \u0026#34; $3}\u0026#39; # æ£€æŸ¥å¯åŠ¨é¡¹ echo \u0026#34;GRUB å¯åŠ¨é¡¹:\u0026#34; grep -A 2 \u0026#34;menuentry\u0026#34; /boot/grub/grub.cfg | grep -E \u0026#34;(menuentry|linux)\u0026#34; | head -6 # æ£€æŸ¥å†…æ ¸é”™è¯¯ echo \u0026#34;å†…æ ¸é”™è¯¯:\u0026#34; dmesg -T | grep -i error | tail -5 # æ£€æŸ¥æ¨¡å—çŠ¶æ€ echo \u0026#34;æ¨¡å—çŠ¶æ€:\u0026#34; lsmod | head -10 # æ£€æŸ¥å†…å­˜ä½¿ç”¨ echo \u0026#34;å†…å­˜ä½¿ç”¨:\u0026#34; free -h # æ£€æŸ¥ç£ç›˜ç©ºé—´ echo \u0026#34;å¯åŠ¨åˆ†åŒºç©ºé—´:\u0026#34; df -h /boot echo \u0026#34;=== æ£€æŸ¥å®Œæˆ ===\u0026#34; ğŸ’¡ æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ 1. ä¿ç•™æ—§å†…æ ¸ 1 2 3 4 5 6 7 8 # å§‹ç»ˆä¿ç•™è‡³å°‘ä¸€ä¸ªæ—§å†…æ ¸ä½œä¸ºå¤‡ä»½ # å»ºè®®ä¿ç•™2-3ä¸ªæœ€è¿‘å†…æ ¸ç‰ˆæœ¬ # æŸ¥çœ‹å½“å‰å†…æ ¸æ•°é‡ dpkg -l | grep pve-kernel | wc -l # æ¸…ç†æ›´æ—§çš„ç‰ˆæœ¬ä»¥èŠ‚çœç©ºé—´ apt autoremove --purge 2. æµ‹è¯•éªŒè¯æµç¨‹ æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°å†…æ ¸ åŠŸèƒ½æµ‹è¯•æ¸…å•ï¼š è™šæ‹Ÿæœºå¯åŠ¨å’Œè¿è¡Œ ç½‘ç»œåŠŸèƒ½æ­£å¸¸ å­˜å‚¨è®¿é—®æ­£å¸¸ å¤‡ä»½åŠŸèƒ½æ­£å¸¸ å…³é”®æœåŠ¡è¿è¡Œ 3. ç›‘æ§ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 # å‡çº§åç›‘æ§ç³»ç»Ÿç¨³å®šæ€§è‡³å°‘24å°æ—¶ # ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ top -b -n 1 | head -20 # ç›‘æ§å†…æ ¸æ—¥å¿— tail -f /var/log/kern.log # ç›‘æ§è™šæ‹ŸæœºçŠ¶æ€ qm list 4. æ–‡æ¡£è®°å½• 1 2 3 4 5 6 7 8 9 10 11 12 # è®°å½•æ¯æ¬¡å†…æ ¸å˜æ›´ echo \u0026#34;$(date) - å‡çº§åˆ°å†…æ ¸ 6.5.11-4-pve\u0026#34; \u0026gt;\u0026gt; /var/log/kernel-changes.log # è®°å½•å˜æ›´åŸå› å’Œç»“æœ cat \u0026gt;\u0026gt; /var/log/kernel-changes.log \u0026lt;\u0026lt; EOF æ—¥æœŸ: $(date) æ“ä½œ: å‡çº§å†…æ ¸ ç‰ˆæœ¬: 6.5.11-4-pve åŸå› : å®‰å…¨æ›´æ–° ç»“æœ: æˆåŠŸ é—®é¢˜: æ—  EOF 5. å›æ»šè®¡åˆ’ æ˜ç¡®å›æ»šæ¡ä»¶ï¼šå®šä¹‰ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å›æ»š å‡†å¤‡å›æ»šè„šæœ¬ï¼šæå‰å‡†å¤‡å¥½å›æ»šæ‰€éœ€çš„å‘½ä»¤å’Œæ­¥éª¤ æµ‹è¯•å›æ»šæµç¨‹ï¼šç¡®ä¿å›æ»šæµç¨‹åœ¨å®é™…éœ€è¦æ—¶èƒ½æ­£å¸¸å·¥ä½œ æ²Ÿé€šè®¡åˆ’ï¼šç¡®ä¿å›¢é˜Ÿäº†è§£å›æ»šè®¡åˆ’å’Œè´£ä»»äºº 6. å®šæœŸå®¡æŸ¥ 1 2 3 4 5 6 7 8 9 # å®šæœŸæ£€æŸ¥å¯ç”¨å†…æ ¸æ›´æ–° apt update apt-cache search pve-kernel # å®¡æŸ¥å®‰å…¨å…¬å‘Š # å…³æ³¨ Proxmox å®‰å…¨é‚®ä»¶åˆ—è¡¨å’Œè®ºå› # è¯„ä¼°å‡çº§éœ€æ±‚ # æ ¹æ®å®‰å…¨æ€§å’ŒåŠŸèƒ½éœ€æ±‚å†³å®šæ˜¯å¦å‡çº§ ğŸ¯ æç¤ºï¼šå†…æ ¸ç®¡ç†æ˜¯ç³»ç»Ÿç»´æŠ¤çš„é‡è¦éƒ¨åˆ†ã€‚é€šè¿‡è°¨æ…çš„å‡çº§ç­–ç•¥ã€ç‰ˆæœ¬å›ºåŒ–å’Œå……åˆ†çš„æµ‹è¯•ï¼Œå¯ä»¥ç¡®ä¿ PVE ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æˆåŠŸç®¡ç† PVE å†…æ ¸ç‰ˆæœ¬ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ Proxmox VE å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚\n","date":"2024-12-07T15:09:14+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/4e02accc/","title":"Proxmox VE å†…æ ¸å‡çº§ \u0026 é™çº§æŒ‡å— ğŸ§"},{"content":"CS2 æ‹·è´å‡†å¿ƒä»£ç  åœ¨cs2é‡Œè°ƒå¥½å‡†å¿ƒï¼Œå†é€€å‡ºcs2ã€‚\t//ä¸€å®šè¦é€€å‡ºåï¼Œs2_user_convars_0_slot0.vcfgæ–‡ä»¶æ‰æ›´æ–°ã€‚ CS2å¹³å°CFGè·¯å¾„ï¼š 1 C:\\Program Files (x86)\\Steam\\userdata\\325482522\\730\\local\\cfg å°†cs2_user_convars_0_slot0.vcfgä¸­ç¬¬11-31è¡ŒåŒ…å«cl_crosshairçš„å…¨éƒ¨å¤åˆ¶ä¸‹æ¥ã€‚åˆ°è¿™é‡Œå°±è·å–åˆ°äº†ä½ çš„å‡†å¿ƒä»£ç ã€‚æœ‰äº†å‡†å¿ƒä»£ç åå…¶ä½™æ“ä½œå’Œcsgoæ—¶æœŸä¸€æ ·ã€‚ æˆ‘çš„ä¸ªäººCFGè·¯å¾„ï¼š 1 C:\\Program Files (x86)\\Steam\\steamapps\\common\\Counter-Strike Global Offensive\\game\\csgo\\cfg æˆ‘ç»‘å®šæŒ‰é”®\u0026quot;Insert\u0026quot; ä¸ºï¼šåŠ è½½auto.cfg æŒ‰Inserté”®æ—¶ï¼Œè‡ªåŠ¨åŠ è½½auto.cfg é…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤æˆ–è®¾ç½®ã€‚\n","date":"2024-12-07T15:07:22+08:00","image":"https://file.meimolihan.eu.org/img/csgo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/391d71e0/","title":"CS2 æ‹·è´å‡†å¿ƒä»£ç "},{"content":"Proxmox VE é…ç½®å¤‡ä»½ä¸æ¢å¤æ–¹æ¡ˆ ğŸ’¾ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç» PVE ç³»ç»Ÿçš„å®Œæ•´å¤‡ä»½å’Œæ¢å¤æµç¨‹ï¼Œç¡®ä¿åœ¨ç³»ç»Ÿé‡è£…æˆ–æ•…éšœæ—¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤è™šæ‹ŸåŒ–ç¯å¢ƒã€‚åŒ…å«ä»åŸºç¡€å¤‡ä»½åˆ°é«˜çº§æ¢å¤ç­–ç•¥çš„å…¨é¢æ–¹æ¡ˆï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• ğŸ“‹ å¤‡ä»½ç­–ç•¥æ¦‚è¿° ğŸ’¾ æœ¬åœ°å¤‡ä»½é…ç½® ğŸŒ è¿œç¨‹å¤‡ä»½æ–¹æ¡ˆ ğŸ”„ æ¢å¤æµç¨‹ âš™ï¸ è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬ ğŸ”’ å®‰å…¨ä¸æœ€ä½³å®è·µ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ âœ… æ¢å¤åçš„æ£€æŸ¥æ¸…å• ğŸ“‹ å¤‡ä»½ç­–ç•¥æ¦‚è¿° å¤‡ä»½å†…å®¹åˆ†ç±» ğŸ¢ è™šæ‹Ÿæœºç£ç›˜æ•°æ® - æœ€é‡è¦çš„æ•°æ®ï¼Œå­˜å‚¨åœ¨ç¬¬äºŒå—ç¡¬ç›˜ âš™ï¸ PVE é…ç½®ä¿¡æ¯ - é›†ç¾¤é…ç½®ã€è™šæ‹Ÿæœºè®¾ç½®ã€ç½‘ç»œé…ç½®ç­‰ ğŸ“„ ç³»ç»Ÿé…ç½®æ–‡ä»¶ - å†…æ ¸æ¨¡å—ã€GRUB è®¾ç½®ã€ç½‘ç»œé…ç½® ğŸ” è¯ä¹¦å’Œå¯†é’¥ - SSL è¯ä¹¦ã€API å¯†é’¥ã€è®¤è¯ä¿¡æ¯ ğŸ‘¥ ç”¨æˆ·å’Œæƒé™ - ç”¨æˆ·é…ç½®ã€è®¿é—®æ§åˆ¶åˆ—è¡¨ æ¨èå­˜å‚¨æ–¹æ¡ˆ å¤‡ä»½é¢‘ç‡å»ºè®® æ•°æ®ç±»å‹ å¤‡ä»½é¢‘ç‡ ä¿ç•™ç­–ç•¥ å­˜å‚¨ä½ç½® è™šæ‹Ÿæœºé…ç½® æ¯æ—¥ ä¿ç•™30å¤© æœ¬åœ°+è¿œç¨‹ è™šæ‹Ÿæœºç£ç›˜ æ¯å‘¨å…¨å¤‡+æ¯æ—¥å¢é‡ ä¿ç•™4å‘¨ ä¸“ç”¨å­˜å‚¨ ç³»ç»Ÿé…ç½® æ¯å‘¨ ä¿ç•™12å‘¨ æœ¬åœ°+è¿œç¨‹ è¯ä¹¦å¯†é’¥ å˜æ›´æ—¶å¤‡ä»½ æ°¸ä¹…ä¿ç•™ åŠ å¯†å­˜å‚¨ ğŸ’¾ æœ¬åœ°å¤‡ä»½é…ç½® 1. åˆ›å»ºå¤‡ä»½ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 # åˆ›å»ºå®Œæ•´çš„å¤‡ä»½ç›®å½•ç»“æ„ mkdir -p /var/lib/vz/pve-backup/{modules-load.d,pve-cluster,network,ssl,users,storage} mkdir -p /var/lib/vz/pve-backup/{cron,logs,scripts} # ğŸ“ åˆ›å»ºåˆ†ç±»å¤‡ä»½ç›®å½• # è®¾ç½®æ­£ç¡®çš„æƒé™ chmod 700 /var/lib/vz/pve-backup chown root:root /var/lib/vz/pve-backup 2. æ‰§è¡Œæœ¬åœ°å¤‡ä»½å‘½ä»¤ å¤‡ä»½ PVE é›†ç¾¤é…ç½® 1 2 3 4 5 6 # 1. å¤‡ä»½æ ¸å¿ƒé…ç½®æ–‡ä»¶ rsync -avhu --progress /var/lib/pve-cluster/config.db /var/lib/vz/pve-backup/ # ğŸ—ƒï¸ config.db åŒ…å«æ‰€æœ‰è™šæ‹Ÿæœºé…ç½®å’Œé›†ç¾¤è®¾ç½® # å¤‡ä»½æ•´ä¸ª pve-cluster ç›®å½•ï¼ˆå¯é€‰ï¼‰ rsync -avhu --progress /var/lib/pve-cluster/ /var/lib/vz/pve-backup/pve-cluster/ å¤‡ä»½ç³»ç»Ÿé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 2. å¤‡ä»½å†…æ ¸æ¨¡å—é…ç½® rsync -avhu --progress /etc/modules-load.d/* /var/lib/vz/pve-backup/modules-load.d/ # 3. å¤‡ä»½ GRUB é…ç½® rsync -avhu --progress /etc/default/grub /var/lib/vz/pve-backup/ # 4. å¤‡ä»½å†…æ ¸æ¨¡å—åˆ—è¡¨ rsync -avhu --progress /etc/modules /var/lib/vz/pve-backup/ # 5. å¤‡ä»½ç½‘ç»œé…ç½® rsync -avhu --progress /etc/network/* /var/lib/vz/pve-backup/network/ # 6. å¤‡ä»½ DNS é…ç½® rsync -avhu --progress /etc/resolv.conf /var/lib/vz/pve-backup/ rsync -avhu --progress /etc/hosts /var/lib/vz/pve-backup/ # 7. å¤‡ä»½å®šæ—¶ä»»åŠ¡ rsync -avhu --progress /etc/cron.* /var/lib/vz/pve-backup/cron/ rsync -avhu --progress /var/spool/cron/ /var/lib/vz/pve-backup/cron/spool/ å¤‡ä»½ PVE ç‰¹å®šé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # 8. å¤‡ä»½ SSL è¯ä¹¦å’Œå¯†é’¥ rsync -avhu --progress /etc/pve/local/pve-ssl.* /var/lib/vz/pve-backup/ssl/ rsync -avhu --progress /etc/pve/nodes/*/pve-ssl.* /var/lib/vz/pve-backup/ssl/ # 9. å¤‡ä»½ç”¨æˆ·é…ç½® rsync -avhu --progress /etc/pve/user.cfg /var/lib/vz/pve-backup/users/ rsync -avhu --progress /etc/pve/domains.cfg /var/lib/vz/pve-backup/users/ # 10. å¤‡ä»½å­˜å‚¨é…ç½® rsync -avhu --progress /etc/pve/storage.cfg /var/lib/vz/pve-backup/storage/ # 11. å¤‡ä»½é˜²ç«å¢™é…ç½® rsync -avhu --progress /etc/pve/firewall/ /var/lib/vz/pve-backup/firewall/ 3. åˆ›å»ºå¤‡ä»½å…ƒæ•°æ® 1 2 3 4 5 6 7 8 9 10 11 # è®°å½•å¤‡ä»½ä¿¡æ¯ echo \u0026#34;å¤‡ä»½æ—¶é—´: $(date)\u0026#34; \u0026gt; /var/lib/vz/pve-backup/backup-info.txt echo \u0026#34;PVE ç‰ˆæœ¬: $(pveversion)\u0026#34; \u0026gt;\u0026gt; /var/lib/vz/pve-backup/backup-info.txt echo \u0026#34;å†…æ ¸ç‰ˆæœ¬: $(uname -r)\u0026#34; \u0026gt;\u0026gt; /var/lib/vz/pve-backup/backup-info.txt echo \u0026#34;ä¸»æœºå: $(hostname)\u0026#34; \u0026gt;\u0026gt; /var/lib/vz/pve-backup/backup-info.txt # åˆ›å»ºæ–‡ä»¶æ¸…å• find /var/lib/vz/pve-backup -type f \u0026gt; /var/lib/vz/pve-backup/file-list.txt # åˆ›å»ºæ ¡éªŒå’Œ sha256sum /var/lib/vz/pve-backup/* \u0026gt; /var/lib/vz/pve-backup/checksums.txt 4. éªŒè¯å¤‡ä»½ç»“æœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ç»“æ„ tree /var/lib/vz/pve-backup # ğŸ“Š åº”è¯¥æ˜¾ç¤ºå®Œæ•´çš„ç›®å½•ç»“æ„ # æ£€æŸ¥é‡è¦æ–‡ä»¶ ls -la /var/lib/vz/pve-backup/config.db ls -la /var/lib/vz/pve-backup/network/ # éªŒè¯æ ¡éªŒå’Œ sha256sum -c /var/lib/vz/pve-backup/checksums.txt # æ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§ if [ -f \u0026#34;/var/lib/vz/pve-backup/config.db\u0026#34; ]; then echo \u0026#34;âœ… å¤‡ä»½å®Œæˆ: $(date)\u0026#34; else echo \u0026#34;âŒ å¤‡ä»½å¤±è´¥: config.db ä¸å­˜åœ¨\u0026#34; exit 1 fi ğŸŒ è¿œç¨‹å¤‡ä»½æ–¹æ¡ˆ æ–¹æ¡ˆä¸€ï¼šNFS å…±äº«å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»º NFS å¤‡ä»½ç›®å½• mkdir -p /mnt/ntfs/pve/pve-backup # æŒ‚è½½ NFS å…±äº«ï¼ˆå¦‚æœå°šæœªæŒ‚è½½ï¼‰ mount -t nfs 192.168.1.100:/backup /mnt/ntfs # åŒæ­¥åˆ° NFS å…±äº« rsync -avhu --progress --delete /var/lib/vz/pve-backup/ /mnt/ntfs/pve/pve-backup/ # ğŸ”„ åŒæ­¥åˆ°æœ¬åœ° NFS å…±äº«ç›®å½• # éªŒè¯åŒæ­¥ç»“æœ diff -r /var/lib/vz/pve-backup/ /mnt/ntfs/pve/pve-backup/ # âœ… ä¸¤ä¸ªç›®å½•å†…å®¹åº”è¯¥ä¸€è‡´ # å¸è½½ NFS å…±äº«ï¼ˆå¯é€‰ï¼‰ umount /mnt/ntfs æ–¹æ¡ˆäºŒï¼šè·¨æœåŠ¡å™¨åŒæ­¥ 1 2 3 4 5 6 7 8 9 # ä» Debian æœåŠ¡å™¨åŒæ­¥åˆ°å¤‡ä»½æœåŠ¡å™¨ mkdir -p /mnt/ARS2-NFS/pve/pve-backup # ä½¿ç”¨ rsync è¿›è¡ŒåŒæ­¥ rsync -avhu --progress --delete /mnt/PVE-NFS/pve/pve-backup/ /mnt/ARS2-NFS/pve/pve-backup/ # ğŸŒ è·¨æœåŠ¡å™¨å¤‡ä»½å¢åŠ å†—ä½™ # æ·»åŠ æ ¡éªŒå’ŒéªŒè¯ rsync -avhu --progress --checksum /mnt/PVE-NFS/pve/pve-backup/ /mnt/ARS2-NFS/pve/pve-backup/ æ–¹æ¡ˆä¸‰ï¼šSCP å®‰å…¨æ‹·è´ 1 2 3 4 5 6 7 8 9 10 11 # ç›´æ¥å¤‡ä»½åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ˆ10.10.10.251ï¼‰ # é¦–å…ˆè®¾ç½® SSH å…å¯†ç™»å½• ssh-keygen -t rsa -b 4096 ssh-copy-id root@10.10.10.251 # ä½¿ç”¨ SCP è¿›è¡ŒåŠ å¯†ä¼ è¾“ scp -P 22 -r /var/lib/vz/pve-backup/* root@10.10.10.251:/mnt/mydisk/pve/pve-backup/ # ğŸ”’ ä½¿ç”¨ SCP è¿›è¡ŒåŠ å¯†ä¼ è¾“ # æˆ–è€…ä½¿ç”¨ rsync over SSH rsync -avhu --progress -e \u0026#34;ssh -p 22\u0026#34; /var/lib/vz/pve-backup/ root@10.10.10.251:/mnt/mydisk/pve/pve-backup/ æ–¹æ¡ˆå››ï¼šäº‘å­˜å‚¨å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨ rclone å¤‡ä»½åˆ°äº‘å­˜å‚¨ # é¦–å…ˆå®‰è£…å’Œé…ç½® rclone apt install rclone rclone config # åŒæ­¥åˆ°äº‘å­˜å‚¨ rclone sync /var/lib/vz/pve-backup/ remote:backup/pve-config/ # æˆ–è€…ä½¿ç”¨ duplicity è¿›è¡ŒåŠ å¯†å¤‡ä»½ apt install duplicity duplicity --encrypt-key \u0026#34;BACKUP_KEY\u0026#34; /var/lib/vz/pve-backup/ file:///mnt/backup/pve-config/ ğŸ”„ æ¢å¤æµç¨‹ 1. å‡†å¤‡æ¢å¤ç¯å¢ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºæ¢å¤ç›®å½• mkdir -p /var/lib/vz/pve-backup # ä»è¿œç¨‹æœåŠ¡å™¨è·å–å¤‡ä»½æ–‡ä»¶ # ä½¿ç”¨ SCP scp -P 22 -r root@10.10.10.251:/mnt/mydisk/pve-backup/* /var/lib/vz/pve-backup/ # æˆ–è€…ä½¿ç”¨ rsync rsync -avhu --progress -e \u0026#34;ssh -p 22\u0026#34; root@10.10.10.251:/mnt/mydisk/pve-backup/* /var/lib/vz/pve-backup/ # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ sha256sum -c /var/lib/vz/pve-backup/checksums.txt # æ£€æŸ¥å¤‡ä»½ç‰ˆæœ¬å…¼å®¹æ€§ PVE_VERSION=$(pveversion) BACKUP_VERSION=$(grep \u0026#34;PVE ç‰ˆæœ¬\u0026#34; /var/lib/vz/pve-backup/backup-info.txt | cut -d: -f2) echo \u0026#34;å½“å‰ç‰ˆæœ¬: $PVE_VERSION\u0026#34; echo \u0026#34;å¤‡ä»½ç‰ˆæœ¬: $BACKUP_VERSION\u0026#34; 2. æ¢å¤é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # 1. æ¢å¤é›†ç¾¤é…ç½® cp -r /var/lib/vz/pve-backup/config.db /var/lib/pve-cluster/ # 2. æ¢å¤å†…æ ¸æ¨¡å—é…ç½® cp -r /var/lib/vz/pve-backup/modules-load.d/* /etc/modules-load.d/ # 3. æ¢å¤ GRUB é…ç½® cp -r /var/lib/vz/pve-backup/grub /etc/default/ # 4. æ¢å¤å†…æ ¸æ¨¡å— cp -r /var/lib/vz/pve-backup/modules /etc/ # 5. æ¢å¤ç½‘ç»œé…ç½® cp -r /var/lib/vz/pve-backup/network/* /etc/network/ # 6. æ¢å¤ DNS é…ç½® cp -r /var/lib/vz/pve-backup/resolv.conf /etc/ cp -r /var/lib/vz/pve-backup/hosts /etc/ # 7. æ¢å¤å®šæ—¶ä»»åŠ¡ cp -r /var/lib/vz/pve-backup/cron/* /etc/cron.*/ cp -r /var/lib/vz/pve-backup/cron/spool/* /var/spool/cron/ # 8. æ¢å¤ SSL è¯ä¹¦å’Œå¯†é’¥ cp -r /var/lib/vz/pve-backup/ssl/* /etc/pve/local/ cp -r /var/lib/vz/pve-backup/ssl/* /etc/pve/nodes/$(hostname)/ # 9. æ¢å¤ç”¨æˆ·é…ç½® cp -r /var/lib/vz/pve-backup/users/* /etc/pve/ # 10. æ¢å¤å­˜å‚¨é…ç½® cp -r /var/lib/vz/pve-backup/storage/* /etc/pve/ # 11. æ¢å¤é˜²ç«å¢™é…ç½® cp -r /var/lib/vz/pve-backup/firewall/* /etc/pve/firewall/ 3. åº”ç”¨é…ç½®æ›´æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æ›´æ–° GRUB é…ç½® update-grub # ğŸ”§ é‡æ–°ç”Ÿæˆ GRUB å¼•å¯¼èœå• # æ›´æ–° initramfs update-initramfs -k all -u # ğŸ§ æ›´æ–°æ‰€æœ‰å†…æ ¸çš„ initramfs # é‡å¯ç½‘ç»œæœåŠ¡ systemctl restart networking # ğŸŒ åº”ç”¨æ–°çš„ç½‘ç»œé…ç½® # é‡å¯ PVE æœåŠ¡ systemctl restart pve-cluster systemctl restart pvedaemon systemctl restart pveproxy systemctl restart pvestatd # é‡æ–°åŠ è½½é˜²ç«å¢™ pve-firewall restart # é‡æ–°åŠ è½½å­˜å‚¨é…ç½® pvesm set \u0026lt;storage\u0026gt; --content \u0026lt;content\u0026gt; 4. æœ€ç»ˆéªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æ£€æŸ¥æ¢å¤ç»“æœ tree /var/lib/vz/pve-backup # éªŒè¯é›†ç¾¤çŠ¶æ€ pvecm status # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® qm list # æµ‹è¯•ç½‘ç»œè¿æ¥ ping -c 4 8.8.8.8 # æ£€æŸ¥å­˜å‚¨çŠ¶æ€ pvesm status # éªŒè¯è¯ä¹¦ openssl x509 -in /etc/pve/local/pve-ssl.pem -noout -text | grep \u0026#34;Not After\u0026#34; # æ£€æŸ¥æœåŠ¡çŠ¶æ€ systemctl status pve-cluster pvedaemon pveproxy pvestatd âš™ï¸ è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬ å®Œæ•´å¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 #!/bin/bash # PVE è‡ªåŠ¨å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/var/lib/vz/pve-backup\u0026#34; LOG_FILE=\u0026#34;/var/log/pve-backup.log\u0026#34; REMOTE_SERVER=\u0026#34;root@10.10.10.251\u0026#34; REMOTE_PATH=\u0026#34;/mnt/mydisk/pve/pve-backup\u0026#34; RETENTION_DAYS=30 # è®°å½•å¼€å§‹æ—¶é—´ echo \u0026#34;=== å¼€å§‹ PVE é…ç½®å¤‡ä»½: $(date) ===\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR/{modules-load.d,pve-cluster,network,ssl,users,storage,cron,logs,scripts} # æ‰§è¡Œå¤‡ä»½ echo \u0026#34;$(date) - å¼€å§‹å¤‡ä»½é…ç½®æ–‡ä»¶...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE rsync -avhu --progress /var/lib/pve-cluster/config.db $BACKUP_DIR/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/modules-load.d/* $BACKUP_DIR/modules-load.d/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/default/grub $BACKUP_DIR/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/modules $BACKUP_DIR/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/network/* $BACKUP_DIR/network/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/resolv.conf $BACKUP_DIR/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/hosts $BACKUP_DIR/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/cron.* $BACKUP_DIR/cron/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /var/spool/cron/ $BACKUP_DIR/cron/spool/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/pve/local/pve-ssl.* $BACKUP_DIR/ssl/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/pve/user.cfg $BACKUP_DIR/users/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/pve/domains.cfg $BACKUP_DIR/users/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/pve/storage.cfg $BACKUP_DIR/storage/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 rsync -avhu --progress /etc/pve/firewall/ $BACKUP_DIR/firewall/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # åˆ›å»ºå…ƒæ•°æ® echo \u0026#34;å¤‡ä»½æ—¶é—´: $(date)\u0026#34; \u0026gt; $BACKUP_DIR/backup-info.txt echo \u0026#34;PVE ç‰ˆæœ¬: $(pveversion)\u0026#34; \u0026gt;\u0026gt; $BACKUP_DIR/backup-info.txt echo \u0026#34;å†…æ ¸ç‰ˆæœ¬: $(uname -r)\u0026#34; \u0026gt;\u0026gt; $BACKUP_DIR/backup-info.txt echo \u0026#34;ä¸»æœºå: $(hostname)\u0026#34; \u0026gt;\u0026gt; $BACKUP_DIR/backup-info.txt find $BACKUP_DIR -type f \u0026gt; $BACKUP_DIR/file-list.txt sha256sum $BACKUP_DIR/* \u0026gt; $BACKUP_DIR/checksums.txt # è¿œç¨‹åŒæ­¥ echo \u0026#34;$(date) - åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE rsync -avhu --progress -e \u0026#34;ssh -p 22\u0026#34; $BACKUP_DIR/ $REMOTE_SERVER:$REMOTE_PATH/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # æ¸…ç†æ—§å¤‡ä»½ echo \u0026#34;$(date) - æ¸…ç†æ—§å¤‡ä»½...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE find $BACKUP_DIR -type f -mtime +$RETENTION_DAYS -delete \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 ssh -p 22 $REMOTE_SERVER \u0026#34;find $REMOTE_PATH -type f -mtime +$RETENTION_DAYS -delete\u0026#34; \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # è®°å½•å®Œæˆæ—¶é—´ echo \u0026#34;=== PVE é…ç½®å¤‡ä»½å®Œæˆ: $(date) ===\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰ if command -v sendmail \u0026gt; /dev/null; then echo \u0026#34;PVE é…ç½®å¤‡ä»½å·²å®Œæˆäº $(date)\u0026#34; | mail -s \u0026#34;PVE å¤‡ä»½é€šçŸ¥\u0026#34; admin@example.com fi exit 0 æ¢å¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 #!/bin/bash # PVE è‡ªåŠ¨æ¢å¤è„šæœ¬ BACKUP_DIR=\u0026#34;/var/lib/vz/pve-backup\u0026#34; LOG_FILE=\u0026#34;/var/log/pve-restore.log\u0026#34; REMOTE_SERVER=\u0026#34;root@10.10.10.251\u0026#34; REMOTE_PATH=\u0026#34;/mnt/mydisk/pve/pve-backup\u0026#34; # è®°å½•å¼€å§‹æ—¶é—´ echo \u0026#34;=== å¼€å§‹ PVE é…ç½®æ¢å¤: $(date) ===\u0026#34; \u0026gt; $LOG_FILE # ä»è¿œç¨‹è·å–å¤‡ä»½ echo \u0026#34;$(date) - ä»è¿œç¨‹æœåŠ¡å™¨è·å–å¤‡ä»½...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE rsync -avhu --progress -e \u0026#34;ssh -p 22\u0026#34; $REMOTE_SERVER:$REMOTE_PATH/ $BACKUP_DIR/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ echo \u0026#34;$(date) - éªŒè¯å¤‡ä»½å®Œæ•´æ€§...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE if ! sha256sum -c $BACKUP_DIR/checksums.txt \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1; then echo \u0026#34;é”™è¯¯: å¤‡ä»½æ ¡éªŒå¤±è´¥!\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi # åœæ­¢ PVE æœåŠ¡ echo \u0026#34;$(date) - åœæ­¢ PVE æœåŠ¡...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE systemctl stop pveproxy pvestatd pvedaemon pve-cluster \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # æ¢å¤é…ç½® echo \u0026#34;$(date) - æ¢å¤é…ç½®æ–‡ä»¶...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE cp -r $BACKUP_DIR/config.db /var/lib/pve-cluster/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/modules-load.d/* /etc/modules-load.d/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/grub /etc/default/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/modules /etc/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/network/* /etc/network/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/resolv.conf /etc/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/hosts /etc/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/cron/* /etc/cron.*/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/cron/spool/* /var/spool/cron/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/ssl/* /etc/pve/local/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/ssl/* /etc/pve/nodes/$(hostname)/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/users/* /etc/pve/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/storage/* /etc/pve/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 cp -r $BACKUP_DIR/firewall/* /etc/pve/firewall/ \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # åº”ç”¨é…ç½® echo \u0026#34;$(date) - åº”ç”¨é…ç½®æ›´æ”¹...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE update-grub \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 update-initramfs -k all -u \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 systemctl restart networking \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # å¯åŠ¨ PVE æœåŠ¡ echo \u0026#34;$(date) - å¯åŠ¨ PVE æœåŠ¡...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE systemctl start pve-cluster pvedaemon pveproxy pvestatd \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 pve-firewall restart \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # éªŒè¯æ¢å¤ echo \u0026#34;$(date) - éªŒè¯æ¢å¤ç»“æœ...\u0026#34; \u0026gt;\u0026gt; $LOG_FILE pvecm status \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 qm list \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 pvesm status \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # è®°å½•å®Œæˆæ—¶é—´ echo \u0026#34;=== PVE é…ç½®æ¢å¤å®Œæˆ: $(date) ===\u0026#34; \u0026gt;\u0026gt; $LOG_FILE echo \u0026#34;æ¢å¤å®Œæˆï¼Œè¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; exit 0 è®¾ç½®å®šæ—¶ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ç¼–è¾‘ crontab crontab -e # æ·»åŠ æ¯æ—¥å¤‡ä»½ä»»åŠ¡ï¼ˆå‡Œæ™¨2ç‚¹ï¼‰ 0 2 * * * /usr/local/bin/pve-backup.sh # æ·»åŠ æ¯å‘¨æ¢å¤æµ‹è¯•ä»»åŠ¡ï¼ˆå‘¨æ—¥å‡Œæ™¨3ç‚¹ï¼‰ 0 3 * * 0 /usr/local/bin/pve-restore-test.sh # æ·»åŠ æ—¥å¿—è½®è½¬é…ç½® cat \u0026gt; /etc/logrotate.d/pve-backup \u0026lt;\u0026lt; EOF /var/log/pve-backup.log { weekly missingok rotate 4 compress delaycompress notifempty create 640 root root } EOF ğŸ”’ å®‰å…¨ä¸æœ€ä½³å®è·µ 1. å¤‡ä»½åŠ å¯† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # ä½¿ç”¨ GPG åŠ å¯†å¤‡ä»½æ–‡ä»¶ gpg --encrypt --recipient \u0026#34;backup@example.com\u0026#34; /var/lib/vz/pve-backup/config.db # ğŸ” ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯ # æˆ–è€…ä½¿ç”¨ openssl åŠ å¯† openssl enc -aes-256-cbc -salt -in /var/lib/vz/pve-backup/config.db -out /var/lib/vz/pve-backup/config.db.enc # åˆ›å»ºåŠ å¯†å¤‡ä»½è„šæœ¬ cat \u0026gt; /usr/local/bin/encrypt-backup \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash BACKUP_DIR=\u0026#34;/var/lib/vz/pve-backup\u0026#34; TAR_FILE=\u0026#34;/tmp/pve-backup-$(date +%Y%m%d).tar.gz\u0026#34; ENCRYPTED_FILE=\u0026#34;/tmp/pve-backup-$(date +%Y%m%d).tar.gz.enc\u0026#34; # åˆ›å»ºå‹ç¼©åŒ… tar -czf $TAR_FILE $BACKUP_DIR # åŠ å¯†å‹ç¼©åŒ… openssl enc -aes-256-cbc -salt -in $TAR_FILE -out $ENCRYPTED_FILE # ä¸Šä¼ åŠ å¯†æ–‡ä»¶åˆ°è¿œç¨‹ scp -P 22 $ENCRYPTED_FILE root@10.10.10.251:/mnt/mydisk/pve/encrypted-backups/ # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -f $TAR_FILE $ENCRYPTED_FILE EOF chmod +x /usr/local/bin/encrypt-backup 2. å®šæœŸéªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # å®šæœŸæ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§ sha256sum /var/lib/vz/pve-backup/config.db \u0026gt; /var/lib/vz/pve-backup/checksum.txt # éªŒè¯å¤‡ä»½ sha256sum -c /var/lib/vz/pve-backup/checksum.txt # å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹ # åˆ›å»ºæµ‹è¯•æ¢å¤è„šæœ¬ cat \u0026gt; /usr/local/bin/test-restore \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash # åœ¨éš”ç¦»ç¯å¢ƒä¸­æµ‹è¯•æ¢å¤æµç¨‹ TEST_DIR=\u0026#34;/tmp/pve-restore-test\u0026#34; mkdir -p $TEST_DIR # å¤åˆ¶å¤‡ä»½æ–‡ä»¶åˆ°æµ‹è¯•ç›®å½• cp -r /var/lib/vz/pve-backup/* $TEST_DIR/ # éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ sha256sum -c $TEST_DIR/checksums.txt # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• if [ -f \u0026#34;$TEST_DIR/grub\u0026#34; ]; then echo \u0026#34;æµ‹è¯• GRUB é…ç½®...\u0026#34; # è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šçš„é…ç½®éªŒè¯ fi echo \u0026#34;æ¢å¤æµ‹è¯•å®Œæˆ\u0026#34; rm -rf $TEST_DIR EOF chmod +x /usr/local/bin/test-restore 3. å¤šé‡å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 # è®¾ç½®å¤šä¸ªå¤‡ä»½ä½ç½® # 1. æœ¬åœ°å¤‡ä»½ - å¿«é€Ÿæ¢å¤ # 2. å±€åŸŸç½‘å¤‡ä»½ - é˜²æ­¢å•ç‚¹æ•…éšœ # 3. è¿œç¨‹å¼‚åœ°å¤‡ä»½ - é˜²æ­¢ç¾éš¾æ€§æ•…éšœ # 4. äº‘å­˜å‚¨å¤‡ä»½ - é¢å¤–ä¿æŠ¤å±‚ # ä½¿ç”¨ä¸åŒçš„å¤‡ä»½å·¥å…·å¢åŠ å†—ä½™ # rsync, scp, rclone, duplicity ç­‰ 4. ç›‘æ§ä¸å‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # æ·»åŠ å¤‡ä»½ç›‘æ§ cat \u0026gt; /etc/cron.daily/pve-backup-check \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash LOG_FILE=\u0026#34;/var/log/pve-backup-check.log\u0026#34; BACKUP_DIR=\u0026#34;/var/lib/vz/pve-backup\u0026#34; # æ£€æŸ¥å¤‡ä»½æ˜¯å¦å­˜åœ¨ if [ ! -f \u0026#34;$BACKUP_DIR/config.db\u0026#34; ]; then echo \u0026#34;å¤‡ä»½å¤±è´¥: config.db ä¸å­˜åœ¨\u0026#34; | mail -s \u0026#34;PVE å¤‡ä»½å‘Šè­¦\u0026#34; admin@example.com echo \u0026#34;$(date) - å¤‡ä»½å¤±è´¥: config.db ä¸å­˜åœ¨\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi # æ£€æŸ¥å¤‡ä»½æ–°é²œåº¦ï¼ˆ24å°æ—¶å†…ï¼‰ if find \u0026#34;$BACKUP_DIR\u0026#34; -name \u0026#34;config.db\u0026#34; -mtime +1 | grep -q \u0026#34;.\u0026#34;; then echo \u0026#34;å¤‡ä»½è¿‡æœŸ: config.db è¶…è¿‡24å°æ—¶æœªæ›´æ–°\u0026#34; | mail -s \u0026#34;PVE å¤‡ä»½å‘Šè­¦\u0026#34; admin@example.com echo \u0026#34;$(date) - å¤‡ä»½è¿‡æœŸ: config.db è¶…è¿‡24å°æ—¶æœªæ›´æ–°\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 1 fi echo \u0026#34;$(date) - å¤‡ä»½æ£€æŸ¥æ­£å¸¸\u0026#34; \u0026gt;\u0026gt; $LOG_FILE exit 0 EOF chmod +x /etc/cron.daily/pve-backup-check âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ 1. è™šæ‹Ÿæœºç£ç›˜å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 # è™šæ‹Ÿæœºç£ç›˜éœ€è¦å•ç‹¬å¤‡ä»½ # å»ºè®®ä½¿ç”¨ PVE å†…ç½®å¤‡ä»½åŠŸèƒ½æˆ–å­˜å‚¨å¤åˆ¶ # æŸ¥çœ‹è™šæ‹Ÿæœºç£ç›˜ä½ç½® qm config \u0026lt;VMID\u0026gt; | grep -i disk # ä½¿ç”¨ PVE å†…ç½®å¤‡ä»½åŠŸèƒ½ vzdump \u0026lt;VMID\u0026gt; --compress zstd --mode snapshot --storage \u0026lt;storage-id\u0026gt; # æˆ–è€…ä½¿ç”¨å­˜å‚¨å¤åˆ¶ pvesm add zfspool \u0026lt;pool-name\u0026gt; --pool \u0026lt;zpool-name\u0026gt; --content images 2. è¯ä¹¦å’Œå¯†é’¥å®‰å…¨ 1 2 3 4 5 6 7 8 # å¤‡ä»½ SSL è¯ä¹¦å’Œå¯†é’¥ cp -r /etc/pve/local/pve-ssl.* /var/lib/vz/pve-backup/ cp -r /etc/pve/nodes/*/pve-ssl.* /var/lib/vz/pve-backup/ # ä¿æŠ¤å¤‡ä»½çš„è¯ä¹¦æ–‡ä»¶ chmod 600 /var/lib/vz/pve-backup/ssl/* # è€ƒè™‘ä½¿ç”¨è¯ä¹¦ç®¡ç†å™¨ï¼ˆå¦‚ certbotï¼‰è‡ªåŠ¨ç®¡ç†è¯ä¹¦ 3. ç”¨æˆ·å’Œæƒé™ç®¡ç† 1 2 3 4 5 6 7 # å¤‡ä»½ç”¨æˆ·é…ç½® cp /etc/pve/user.cfg /var/lib/vz/pve-backup/ cp /etc/pve/domains.cfg /var/lib/vz/pve-backup/ # è®°å½•å½“å‰æƒé™è®¾ç½® pveum role list \u0026gt; /var/lib/vz/pve-backup/roles.txt pveum acl list \u0026gt; /var/lib/vz/pve-backup/acl.txt 4. å­˜å‚¨é…ç½®æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 # å¤‡ä»½å­˜å‚¨é…ç½® cp /etc/pve/storage.cfg /var/lib/vz/pve-backup/ # è®°å½•å­˜å‚¨è¯¦ç»†ä¿¡æ¯ pvesm status --verbose \u0026gt; /var/lib/vz/pve-backup/storage-details.txt # å¦‚æœä½¿ç”¨ ZFSï¼Œå¤‡ä»½æ± é…ç½® zpool status \u0026gt; /var/lib/vz/pve-backup/zpool-status.txt zfs list \u0026gt; /var/lib/vz/pve-backup/zfs-list.txt 5. ç‰ˆæœ¬å…¼å®¹æ€§ 1 2 3 4 5 6 7 # æ£€æŸ¥ PVE ç‰ˆæœ¬å…¼å®¹æ€§ # æ¢å¤æ—¶ç¡®ä¿å¤‡ä»½ç‰ˆæœ¬ä¸å½“å‰ç‰ˆæœ¬å…¼å®¹ # è®°å½•ç‰ˆæœ¬ä¿¡æ¯ pveversion -v \u0026gt; /var/lib/vz/pve-backup/version-details.txt # å¦‚æœè·¨å¤§ç‰ˆæœ¬æ¢å¤ï¼Œå…ˆæµ‹è¯•å…¼å®¹æ€§ âœ… æ¢å¤åçš„æ£€æŸ¥æ¸…å• PVE é›†ç¾¤çŠ¶æ€æ­£å¸¸: pvecm status æ‰€æœ‰è™šæ‹Ÿæœºé…ç½®å¯è§: qm list ç½‘ç»œè¿æ¥æ­£å¸¸: ping 8.8.8.8 å­˜å‚¨é…ç½®æ­£ç¡®: pvesm status æœåŠ¡è¿è¡Œæ­£å¸¸: systemctl status pve-cluster pvedaemon pveproxy pvestatd é˜²ç«å¢™è§„åˆ™æ­£ç¡®: pve-firewall compile è¯ä¹¦æœ‰æ•ˆ: openssl x509 -in /etc/pve/local/pve-ssl.pem -noout -checkend 86400 ç”¨æˆ·æƒé™æ­£ç¡®: pveum user list å®šæ—¶ä»»åŠ¡æ­£å¸¸: systemctl status cron å¤‡ä»½åŠŸèƒ½æ­£å¸¸: æµ‹è¯•æ–°çš„å¤‡ä»½ ç›‘æ§å‘Šè­¦æ­£å¸¸: æ£€æŸ¥ç›‘æ§ç³»ç»Ÿ æ€§èƒ½æ­£å¸¸: æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½å’Œèµ„æºä½¿ç”¨ ğŸš¨ é‡è¦æé†’: å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹ï¼Œç¡®ä¿å¤‡ä»½çš„æœ‰æ•ˆæ€§ã€‚å»ºè®®æ¯å­£åº¦è‡³å°‘è¿›è¡Œä¸€æ¬¡æ¢å¤æµ‹è¯•ã€‚\næ¢å¤æµ‹è¯•è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #!/bin/bash # PVE æ¢å¤æµ‹è¯•è„šæœ¬ echo \u0026#34;=== PVE æ¢å¤æµ‹è¯•å¼€å§‹: $(date) ===\u0026#34; # æ£€æŸ¥åŸºæœ¬æœåŠ¡ services=(\u0026#34;pve-cluster\u0026#34; \u0026#34;pvedaemon\u0026#34; \u0026#34;pveproxy\u0026#34; \u0026#34;pvestatd\u0026#34;) for service in \u0026#34;${services[@]}\u0026#34;; do if systemctl is-active --quiet \u0026#34;$service\u0026#34;; then echo \u0026#34;âœ… $service è¿è¡Œæ­£å¸¸\u0026#34; else echo \u0026#34;âŒ $service æœªè¿è¡Œ\u0026#34; fi done # æ£€æŸ¥é›†ç¾¤çŠ¶æ€ if pvecm status \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ… é›†ç¾¤çŠ¶æ€æ­£å¸¸\u0026#34; else echo \u0026#34;âŒ é›†ç¾¤çŠ¶æ€å¼‚å¸¸\u0026#34; fi # æ£€æŸ¥è™šæ‹Ÿæœº if qm list \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ… è™šæ‹Ÿæœºåˆ—è¡¨å¯è®¿é—®\u0026#34; VM_COUNT=$(qm list | grep -c running) echo \u0026#34;è¿è¡Œä¸­çš„è™šæ‹Ÿæœº: $VM_COUNT\u0026#34; else echo \u0026#34;âŒ æ— æ³•è®¿é—®è™šæ‹Ÿæœºåˆ—è¡¨\u0026#34; fi # æ£€æŸ¥å­˜å‚¨ if pvesm status \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ… å­˜å‚¨çŠ¶æ€æ­£å¸¸\u0026#34; else echo \u0026#34;âŒ å­˜å‚¨çŠ¶æ€å¼‚å¸¸\u0026#34; fi # æ£€æŸ¥ç½‘ç»œ if ping -c 1 -W 1 8.8.8.8 \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ… ç½‘ç»œè¿æ¥æ­£å¸¸\u0026#34; else echo \u0026#34;âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸\u0026#34; fi echo \u0026#34;=== PVE æ¢å¤æµ‹è¯•å®Œæˆ: $(date) ===\u0026#34; é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå»ºç«‹å®Œæ•´çš„ PVE å¤‡ä»½å’Œæ¢å¤ä½“ç³»ï¼Œç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§å’Œæ•°æ®å®‰å…¨ã€‚è®°ä½ï¼Œå¤‡ä»½åªæœ‰åœ¨èƒ½å¤ŸæˆåŠŸæ¢å¤æ—¶æ‰æœ‰ä»·å€¼ï¼Œå› æ­¤è¯·å®šæœŸæµ‹è¯•æ‚¨çš„æ¢å¤æµç¨‹ï¼ğŸ”\n","date":"2024-12-07T15:05:59+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/a636eac2/","title":"Proxmox VE é…ç½®å¤‡ä»½ä¸æ¢å¤æ–¹æ¡ˆ ğŸ’¾"},{"content":"Proxmox VE åˆ é™¤è‡ªå¸¦ Swap å¹¶é‡æ–°åˆ›å»º Swap ğŸ§ è¯¦ç»†æŒ‡å¯¼å¦‚ä½•åœ¨ Proxmox VE (PVE) ä¸­åˆ é™¤é»˜è®¤çš„ LVM swap åˆ†åŒºå¹¶åˆ›å»ºæ›´çµæ´»çš„ swap æ–‡ä»¶\nâœ¨ æ¦‚è¿°\nPVE é»˜è®¤ä½¿ç”¨ LVM åˆ†åŒºåˆ›å»º swap ç©ºé—´ï¼Œä½†è¿™ç§æ–¹å¼ä¸å¤Ÿçµæ´»ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åˆ é™¤é»˜è®¤çš„ swap åˆ†åŒºï¼Œæ‰©å±•æ ¹åˆ†åŒºç©ºé—´ï¼Œå¹¶åˆ›å»ºåŸºäºæ–‡ä»¶çš„ swap ç©ºé—´ï¼ŒåŒæ—¶ä¼˜åŒ–ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç­–ç•¥ã€‚\nâš ï¸ é‡è¦æç¤º\nåœ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œå‰ï¼Œè¯·ç¡®ä¿ï¼š\nå·²å¤‡ä»½é‡è¦æ•°æ® ç³»ç»Ÿæ²¡æœ‰é‡è¦ä»»åŠ¡æ­£åœ¨è¿è¡Œ äº†è§£æ“ä½œé£é™©ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éšæ„ä¿®æ”¹ ğŸ”§ ä¸€ã€åˆ é™¤é»˜è®¤ Swap å¹¶åˆ›å»ºæ–° Swap æ–‡ä»¶\næŸ¥çœ‹å½“å‰ Swap åˆ†åŒº 1 lvs ç¡®è®¤ swap é€»è¾‘å·çš„åç§°å’Œå¤§å°\nå…³é—­æ‰€æœ‰äº¤æ¢ç©ºé—´ 1 swapoff -a ç¦ç”¨æ‰€æœ‰æ´»è·ƒçš„ swap ç©ºé—´\nåˆ é™¤ PVE é»˜è®¤çš„ swap åˆ†åŒº 1 lvremove /dev/pve/swap ç³»ç»Ÿä¼šè¦æ±‚ç¡®è®¤æ“ä½œï¼Œè¾“å…¥ y ç»§ç»­\næ‰©å±•æ ¹åˆ†åŒºé€»è¾‘å· 1 lvresize -l +100%FREE /dev/pve/root å°†é‡Šæ”¾çš„ swap ç©ºé—´åˆ†é…ç»™æ ¹åˆ†åŒº\nè°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å° 1 resize2fs /dev/mapper/pve-root ä½¿æ–‡ä»¶ç³»ç»Ÿé€‚åº”æ–°çš„é€»è¾‘å·å¤§å°\nåˆ›å»º 16GB çš„ swap æ–‡ä»¶ 1 dd if=/dev/zero of=/swapfile bs=1G count=16 status=progress bs=1G count=16 åˆ›å»º 16GB æ–‡ä»¶ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´å¤§å°\nè®¾ç½®å®‰å…¨æƒé™ 1 chmod 0600 /swapfile ç¡®ä¿åªæœ‰ root ç”¨æˆ·å¯ä»¥è®¿é—® swap æ–‡ä»¶\næ ¼å¼åŒ– swap æ–‡ä»¶ 1 mkswap /swapfile å°†æ–‡ä»¶è®¾ç½®ä¸º swap æ ¼å¼\nå¯ç”¨ swap æ–‡ä»¶ 1 swapon /swapfile ç«‹å³æ¿€æ´» swap æ–‡ä»¶\nå¤‡ä»½ fstab æ–‡ä»¶ 1 cp /etc/fstab /etc/fstab.bak é‡è¦ï¼šå§‹ç»ˆå¤‡ä»½ç³»ç»Ÿæ–‡ä»¶ before ä¿®æ”¹\né…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ 1 echo \u0026#39;/swapfile none swap sw 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab æ·»åŠ  swap æ–‡ä»¶åˆ°å¯åŠ¨æŒ‚è½½åˆ—è¡¨\néªŒè¯æ‰€æœ‰ swap é…ç½® 1 swapon -a æ¿€æ´» fstab ä¸­æ‰€æœ‰çš„ swap é…ç½®\néªŒè¯ swap çŠ¶æ€ 1 free -h æŸ¥çœ‹å†…å­˜å’Œ swap ä½¿ç”¨æƒ…å†µ\nâš™ï¸ äºŒã€é…ç½® Swap ç­–ç•¥ä¼˜åŒ–\næŸ¥çœ‹å½“å‰ swappiness å€¼ 1 2 3 cat /proc/sys/vm/swappiness # æˆ– sysctl vm.swappiness é»˜è®¤å€¼é€šå¸¸ä¸º 60ï¼Œè¡¨ç¤ºç³»ç»Ÿåœ¨å†…å­˜ä½¿ç”¨è¾¾åˆ° 40% æ—¶å¼€å§‹ä½¿ç”¨ swap\nä¸´æ—¶è°ƒæ•´ swappinessï¼ˆé‡å¯åå¤±æ•ˆï¼‰ 1 2 3 4 5 # æ–¹æ³• 1 sysctl vm.swappiness=10 # æ–¹æ³• 2 echo 10 \u0026gt; /proc/sys/vm/swappiness å€¼è¶Šä½ï¼Œç³»ç»Ÿè¶Šä¸æ„¿æ„ä½¿ç”¨ swapï¼ˆæ¨è 10-30 å¯¹äºæœåŠ¡å™¨ï¼‰\næ°¸ä¹…æ›´æ”¹ swappiness å€¼ 1 echo \u0026#39;vm.swappiness=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf å°†æ­¤è¡Œæ·»åŠ åˆ° sysctl.conf æ–‡ä»¶\nåº”ç”¨æ–°çš„ sysctl è®¾ç½® 1 sysctl -p é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ä½¿æ›´æ”¹ç”Ÿæ•ˆ\nğŸ“Š Swap å¤§å°å»ºè®®\nç³»ç»Ÿå†…å­˜ æ¨è Swap å¤§å° è¯´æ˜ â‰¤ 2GB 2Ã—å†…å­˜ ä¼ ç»Ÿå»ºè®® 2-8GB =å†…å­˜ å¹³è¡¡æ–¹æ¡ˆ 8-64GB 4-8GB æœåŠ¡å™¨æ¨è â‰¥ 64GB 4GB å¤§å†…å­˜ç³»ç»Ÿ\nğŸ’¡ æç¤ºï¼šå¯¹äº PVE ä¸»æœºï¼Œ8-16GB swap é€šå¸¸è¶³å¤Ÿï¼Œé™¤éè¿è¡Œå†…å­˜å¯†é›†å‹è™šæ‹Ÿæœº\nğŸ” éªŒè¯ä¸ç›‘æ§\næ£€æŸ¥ swap çŠ¶æ€ 1 2 swapon --show free -h ç›‘æ§ swap ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 # å®æ—¶ç›‘æ§ watch -n 1 \u0026#39;free -h\u0026#39; # æŸ¥çœ‹è¯¦ç»†å†…å­˜ä¿¡æ¯ cat /proc/meminfo | grep -i swap æ£€æŸ¥ swappiness è®¾ç½® 1 2 sysctl vm.swappiness cat /proc/sys/vm/swappiness ğŸ› ï¸ æ•…éšœæ’é™¤\nå¦‚æœ swap æ–‡ä»¶åˆ›å»ºå¤±è´¥ 1 2 3 4 5 # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h # å¦‚æœç©ºé—´ä¸è¶³ï¼Œè€ƒè™‘å‡å° swap æ–‡ä»¶å¤§å° dd if=/dev/zero of=/swapfile bs=1G count=8 status=progress å¦‚æœæ— æ³•å¯ç”¨ swap 1 2 3 4 5 # æ£€æŸ¥æ–‡ä»¶æ ¼å¼ file /swapfile # é‡æ–°æ ¼å¼åŒ– mkswap -f /swapfile æ¢å¤é»˜è®¤é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # ç¦ç”¨ swap æ–‡ä»¶ swapoff /swapfile # åˆ é™¤ swap æ–‡ä»¶ rm -f /swapfile # ä» fstab ä¸­ç§»é™¤æ¡ç›® sed -i \u0026#39;/\\/swapfile/d\u0026#39; /etc/fstab # æ¢å¤é»˜è®¤ swappiness sed -i \u0026#39;/vm.swappiness/d\u0026#39; /etc/sysctl.conf echo 60 \u0026gt; /proc/sys/vm/swappiness ğŸ’¡ é«˜çº§ä¼˜åŒ–æŠ€å·§\nä½¿ç”¨å¤šä¸ª swap æ–‡ä»¶ 1 2 3 4 5 6 7 8 # åˆ›å»ºç¬¬äºŒä¸ª swap æ–‡ä»¶ dd if=/dev/zero of=/swapfile2 bs=1G count=4 status=progress chmod 0600 /swapfile2 mkswap /swapfile2 swapon /swapfile2 # æ·»åŠ åˆ° fstab echo \u0026#39;/swapfile2 none swap sw 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab è°ƒæ•´ swap ä¼˜å…ˆçº§ 1 2 3 # åœ¨ fstab ä¸­æ·»åŠ ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ echo \u0026#39;/swapfile none swap sw,pri=10 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab echo \u0026#39;/swapfile2 none swap sw,pri=5 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab å®šæœŸç›‘æ§ swap ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºç›‘æ§è„šæœ¬ cat \u0026gt; /usr/local/bin/swap_monitor.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;=== Swap Usage Monitor ===\u0026#34; echo \u0026#34;Date: $(date)\u0026#34; echo \u0026#34;Total swap: $(free -h | awk \u0026#39;/Swap/ {print $2}\u0026#39;)\u0026#34; echo \u0026#34;Used swap: $(free -h | awk \u0026#39;/Swap/ {print $3}\u0026#39;)\u0026#34; echo \u0026#34;Swappiness: $(cat /proc/sys/vm/swappiness)\u0026#34; EOF chmod +x /usr/local/bin/swap_monitor.sh ğŸš¨ æ³¨æ„äº‹é¡¹\næ€§èƒ½è€ƒè™‘ï¼šswap æ–‡ä»¶æ€§èƒ½ç•¥ä½äºä¸“ç”¨ swap åˆ†åŒºï¼Œä½†å¯¹äºå¤§å¤šæ•°ç”¨é€”è¶³å¤Ÿ SSD ç£¨æŸï¼šé¢‘ç¹çš„ swap æ“ä½œå¯èƒ½ç¼©çŸ­ SSD å¯¿å‘½ï¼Œé€‚å½“è°ƒæ•´ swappiness å†…å­˜å……è¶³ï¼šå¦‚æœç³»ç»Ÿæœ‰è¶³å¤Ÿå†…å­˜ï¼Œå¯ä»¥è€ƒè™‘å®Œå…¨ç¦ç”¨ swap ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥ swap ä½¿ç”¨æƒ…å†µï¼Œç¡®ä¿ç³»ç»Ÿæ€§èƒ½ ğŸ”§ æç¤ºï¼šå¯¹äºæ•°æ®åº“æœåŠ¡å™¨æˆ–é«˜æ€§èƒ½åº”ç”¨ï¼Œå»ºè®®ä½¿ç”¨ä¸“ç”¨ swap åˆ†åŒºè€Œä¸æ˜¯ swap æ–‡ä»¶\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æˆåŠŸä¼˜åŒ– PVE çš„ swap é…ç½®ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ PVE å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚\n","date":"2024-12-07T15:05:08+08:00","image":"https://file.meimolihan.eu.org/img/pve-swap-01.webp","permalink":"https://blog.meimolihan.eu.org/p/725d957c/","title":"Proxmox VE åˆ é™¤è‡ªå¸¦ Swap å¹¶é‡æ–°åˆ›å»º Swap ğŸ§"},{"content":"Windows éƒ¨ç½² Samba æœåŠ¡æŒ‡å— ğŸªŸ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Windows ç³»ç»Ÿä¸Šé…ç½®å’Œä½¿ç”¨ Samba æœåŠ¡ï¼ŒåŒ…æ‹¬ä½œä¸ºå®¢æˆ·ç«¯è¿æ¥ Linux/Windows å…±äº«ï¼Œä»¥åŠä½œä¸ºæœåŠ¡ç«¯æä¾›æ–‡ä»¶å…±äº«æœåŠ¡ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å°†æŒæ¡è·¨å¹³å°æ–‡ä»¶å…±äº«çš„å…¨å¥—è§£å†³æ–¹æ¡ˆï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ Samba æœåŠ¡ç®€ä»‹ ğŸ–¥ï¸ Windows ä½œä¸ºå®¢æˆ·ç«¯ ğŸ”— å¿«é€Ÿè¿æ¥å…±äº« ğŸ“ ç½‘ç»œé©±åŠ¨å™¨æ˜ å°„ ğŸ”§ è¿æ¥ç®¡ç†å‘½ä»¤ âš¡ å¼€æœºè‡ªåŠ¨æŒ‚è½½é…ç½® ğŸ–¥ï¸ Windows ä½œä¸ºæœåŠ¡ç«¯ ğŸ‘¥ ç”¨æˆ·ç®¡ç† ğŸ“‚ å…±äº«æ–‡ä»¶å¤¹é…ç½® ğŸŒ IP åœ°å€æŸ¥çœ‹å·¥å…· âš™ï¸ é«˜çº§é…ç½®å’Œç®¡ç† ğŸ” å¯†ç ç®¡ç† ğŸ”„ æ‰¹é‡è¿æ¥ç®¡ç† ğŸ”§ æ•…éšœæ’é™¤å’Œè¯Šæ–­ ğŸ›¡ï¸ å®‰å…¨å»ºè®® ğŸ’¾ å®ç”¨æŠ€å·§ ğŸ¯ æ€»ç»“ âœ¨ Samba æœåŠ¡ç®€ä»‹ Samba æ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶å¥—ä»¶ï¼Œæä¾›äº†åœ¨ Windows å’Œ Unix/Linux ç³»ç»Ÿä¹‹é—´è¿›è¡Œæ–‡ä»¶å’Œæ‰“å°æœºå…±äº«çš„èƒ½åŠ›ã€‚é€šè¿‡ SMB/CIFS åè®®å®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«ã€‚\nä¸»è¦ç‰¹ç‚¹ï¼š\nğŸ”„ è·¨å¹³å°å…±äº«ï¼šå®ç° Windowsã€Linuxã€macOS ä¹‹é—´çš„æ–‡ä»¶å…±äº« ğŸ‘¥ ç”¨æˆ·è®¤è¯ï¼šæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œä¿éšœè®¿é—®å®‰å…¨ ğŸ“Š é«˜æ€§èƒ½ï¼šä¼˜åŒ–çš„ä¼ è¾“åè®®ï¼Œæä¾›é«˜é€Ÿæ–‡ä»¶ä¼ è¾“ ğŸ›¡ï¸ å®‰å…¨æ€§ï¼šæ”¯æŒåŠ å¯†ä¼ è¾“å’Œè®¿é—®æ§åˆ¶ ğŸ”§ æ˜“ç”¨æ€§ï¼šç®€å•çš„é…ç½®å’Œç®¡ç†æ–¹å¼ ğŸ–¥ï¸ Windows ä½œä¸ºå®¢æˆ·ç«¯ ğŸ”— å¿«é€Ÿè¿æ¥å…±äº« è¿æ¥ Linux Samba å…±äº«æ‰¹å¤„ç†è„šæœ¬ åˆ›å»º connect_linux_share.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 @echo off REM ================================================== REM è¿æ¥ Linux Samba å…±äº«æ‰¹å¤„ç†è„šæœ¬ REM æ–‡ä»¶å: connect_linux_share.bat REM ================================================== REM è®¾ç½®è¿æ¥å‚æ•° set SERVER_IP=10.10.10.251 set SHARE_NAME=Media set USERNAME=your_username set PASSWORD=your_password echo âš¡ æ­£åœ¨è¿æ¥ Linux Samba å…±äº«... echo ğŸ“ æœåŠ¡å™¨: %SERVER_IP%\\%SHARE_NAME% echo ğŸ‘¤ ç”¨æˆ·å: %USERNAME% REM å»ºç«‹ç½‘ç»œè¿æ¥ net use \\\\%SERVER_IP%\\%SHARE_NAME% %PASSWORD% /user:%USERNAME% REM æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ if %errorlevel% equ 0 ( echo âœ… è¿æ¥æˆåŠŸï¼ echo ğŸš€ æ­£åœ¨æ‰“å¼€å…±äº«æ–‡ä»¶å¤¹... timeout /t 2 /nobreak \u0026gt;nul explorer \\\\%SERVER_IP%\\%SHARE_NAME% ) else ( echo âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç  pause ) exit è¿æ¥ Windows å…±äº«æ‰¹å¤„ç†è„šæœ¬ åˆ›å»º connect_windows_share.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @echo off REM ================================================== REM è¿æ¥ Windows å…±äº«æ‰¹å¤„ç†è„šæœ¬ REM æ–‡ä»¶å: connect_windows_share.bat REM ================================================== set SERVER_IP=10.10.10.248 set SHARE_NAME=Win11é˜¿é‡Œäº‘ç›˜ set USERNAME=å¢¨ä¸å‡¡ set PASSWORD=241313 echo âš¡ æ­£åœ¨è¿æ¥ Windows å…±äº«... net use \\\\%SERVER_IP%\\%SHARE_NAME% %PASSWORD% /user:%USERNAME% if %errorlevel% equ 0 ( echo âœ… è¿æ¥æˆåŠŸï¼ explorer \\\\%SERVER_IP%\\%SHARE_NAME% ) else ( echo âŒ è¿æ¥å¤±è´¥ pause ) exit ğŸ“ ç½‘ç»œé©±åŠ¨å™¨æ˜ å°„ æ˜ å°„ Linux å…±äº«é©±åŠ¨å™¨ï¼š 1 2 3 4 5 6 7 8 9 10 @echo off REM æ˜ å°„ Linux Samba å…±äº«åˆ° Z: é©±åŠ¨å™¨ net use Z: \\\\10.10.10.251\\Media your_password /user:your_username /persistent:yes if %errorlevel% equ 0 ( echo âœ… Linux å…±äº«å·²æ˜ å°„åˆ° Z: é©±åŠ¨å™¨ explorer Z: ) else ( echo âŒ æ˜ å°„å¤±è´¥ ) pause æ˜ å°„ Windows å…±äº«é©±åŠ¨å™¨ï¼š 1 2 3 4 5 6 7 8 9 10 @echo off REM æ˜ å°„ Windows å…±äº«åˆ° Y: é©±åŠ¨å™¨ net use Y: \\\\10.10.10.248\\Win11é˜¿é‡Œäº‘ç›˜ 241313 /user:å¢¨ä¸å‡¡ /persistent:yes if %errorlevel% equ 0 ( echo âœ… Windows å…±äº«å·²æ˜ å°„åˆ° Y: é©±åŠ¨å™¨ explorer Y: ) else ( echo âŒ æ˜ å°„å¤±è´¥ ) pause ğŸ”§ è¿æ¥ç®¡ç†å‘½ä»¤ æŸ¥çœ‹å½“å‰è¿æ¥ï¼š 1 2 3 4 5 6 @echo off echo ğŸ“Š å½“å‰ç½‘ç»œè¿æ¥åˆ—è¡¨: echo =============================== net use echo =============================== pause æ¸…é™¤ç‰¹å®šè¿æ¥ï¼š 1 2 3 4 5 6 7 8 9 @echo off echo ğŸ—‘ï¸ æ­£åœ¨æ¸…é™¤æŒ‡å®š Samba è¿æ¥... net use \\\\10.10.10.251\\Media /delete if %errorlevel% equ 0 ( echo âœ… è¿æ¥å·²æ¸…é™¤ ) else ( echo âŒ æ¸…é™¤å¤±è´¥ ) pause æ¸…é™¤æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 @echo off echo âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…é™¤æ‰€æœ‰ç½‘ç»œé©±åŠ¨å™¨æ˜ å°„ï¼ echo â° æŒ‰ Ctrl+C å–æ¶ˆï¼Œæˆ–æŒ‰ä»»æ„é”®ç»§ç»­... pause \u0026gt;nul net use * /delete /y if %errorlevel% equ 0 ( echo âœ… æ‰€æœ‰ç½‘ç»œè¿æ¥å·²æ¸…é™¤ ) else ( echo âŒ æ¸…é™¤å¤±è´¥ ) pause âš¡ å¼€æœºè‡ªåŠ¨æŒ‚è½½é…ç½® åˆ›å»ºå¼€æœºè‡ªåŠ¨æŒ‚è½½è„šæœ¬ åˆ›å»º auto_mount.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @echo off REM ================================================== REM å¼€æœºè‡ªåŠ¨æŒ‚è½½è„šæœ¬ REM å°†æ­¤è„šæœ¬æ”¾å…¥å¼€æœºå¯åŠ¨æ–‡ä»¶å¤¹ REM ================================================== echo ğŸš€ æ­£åœ¨æŒ‚è½½ç½‘ç»œå…±äº«... echo. REM æŒ‚è½½ Linux Samba å…±äº« echo ğŸ“ æŒ‚è½½ Linux å…±äº« (Z:)... net use Z: \\\\10.10.10.254\\PVE-mydisk yifan0719 /user:root /persistent:yes REM æŒ‚è½½ Debian Samba å…±äº« echo ğŸ“ æŒ‚è½½ Debian å…±äº« (Y:)... net use Y: \\\\10.10.10.245\\Debian yifan0719 /user:admin /persistent:yes REM æŒ‚è½½ PVE NTFS å…±äº« echo ğŸ“ æŒ‚è½½ PVE NTFS å…±äº« (X:)... net use X: \\\\10.10.10.254\\PVE-ntfs yifan0719 /user:root /persistent:yes REM æŒ‚è½½ WebDAV å…±äº« echo ğŸ“ æŒ‚è½½ WebDAV å…±äº« (W:)... net use W: https://file.meimolihan.eu.org:6663/webdav /user:admin yifan0719 /persistent:yes echo. echo âœ… ç½‘ç»œå…±äº«æŒ‚è½½å®Œæˆï¼ timeout /t 3 /nobreak \u0026gt;nul è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨æ–‡ä»¶å¤¹ 1 2 3 4 5 @echo off REM æ‰“å¼€å¼€æœºå¯åŠ¨æ–‡ä»¶å¤¹ explorer shell:startup echo ğŸ“ è¯·å°† auto_mount.bat æ–‡ä»¶å¤åˆ¶åˆ°æ­¤æ–‡ä»¶å¤¹ä¸­ pause æ–¹æ³•äºŒï¼šä½¿ç”¨ä»»åŠ¡è®¡åˆ’ç¨‹åº æŒ‰ Win + R è¾“å…¥ taskschd.msc åˆ›å»ºæ–°ä»»åŠ¡ è®¾ç½®è§¦å‘å™¨ä¸º\u0026quot;ç™»å½•æ—¶\u0026quot; æ“ä½œä¸ºå¯åŠ¨ auto_mount.bat ğŸ–¥ï¸ Windows ä½œä¸ºæœåŠ¡ç«¯ ğŸ‘¥ ç”¨æˆ·ç®¡ç†å‘½ä»¤ æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼š 1 2 3 4 5 6 7 @echo off echo ğŸ‘¤ å½“å‰ç™»å½•ç”¨æˆ·: echo =============================== WHOAMI echo =============================== echo ğŸ’¡ å…±äº«æ–‡ä»¶å¤¹ç”¨æˆ·åä¸ºåæ–œæ åçš„å†…å®¹ pause ğŸ“‚ å…±äº«æ–‡ä»¶å¤¹é…ç½® å¿«é€Ÿåˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ï¼š åˆ›å»º create_share.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @echo off REM ================================================== REM åˆ›å»ºç½‘ç»œå…±äº«æ–‡ä»¶å¤¹ REM æ–‡ä»¶å: create_share.bat REM ================================================== set /p \u0026#34;folder_path=ğŸ“ è¯·è¾“å…¥è¦å…±äº«çš„æ–‡ä»¶å¤¹å®Œæ•´è·¯å¾„: \u0026#34; set /p \u0026#34;share_name=ğŸ·ï¸ è¯·è¾“å…¥ç½‘ç»œå…±äº«åç§°: \u0026#34; echo. echo âš¡ æ­£åœ¨åˆ›å»ºå…±äº«... REM åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ if not exist \u0026#34;%folder_path%\u0026#34; ( mkdir \u0026#34;%folder_path%\u0026#34; echo âœ… åˆ›å»ºæ–‡ä»¶å¤¹: %folder_path% ) REM è®¾ç½®å…±äº«æƒé™ net share \u0026#34;%share_name%\u0026#34;=\u0026#34;%folder_path%\u0026#34; /GRANT:Everyone,FULL REM è®¾ç½®æ–‡ä»¶å¤¹æƒé™ icacls \u0026#34;%folder_path%\u0026#34; /grant Everyone:(OI)(CI)F echo. echo ================================================== echo ğŸ‰ å…±äº«åˆ›å»ºæˆåŠŸï¼ echo ğŸ“› å…±äº«åç§°: %share_name% echo ğŸ“ å…±äº«è·¯å¾„: %folder_path% echo ğŸŒ è®¿é—®åœ°å€: \\\\%COMPUTERNAME%\\%share_name% echo ================================================== pause ğŸŒ IP åœ°å€æŸ¥çœ‹å·¥å…· åˆ›å»º show_ip.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @echo off REM ================================================== REM ç½‘ç»œä¿¡æ¯æŸ¥çœ‹å·¥å…· REM æ–‡ä»¶å: show_ip.bat REM ================================================== echo ğŸŒ æ­£åœ¨è·å–ç½‘ç»œä¿¡æ¯... echo. REM è·å–IPv4åœ°å€ for /f \u0026#34;tokens=2 delims=:\u0026#34; %%a in (\u0026#39;ipconfig ^| find \u0026#34;IPv4\u0026#34;\u0026#39;) do ( set \u0026#34;ipaddress=%%a\u0026#34; set \u0026#34;ipaddress=!ipaddress: =!\u0026#34; echo ğŸ“ æœ¬æœºIPv4åœ°å€: !ipaddress! ) REM è·å–é»˜è®¤ç½‘å…³ for /f \u0026#34;tokens=3\u0026#34; %%a in (\u0026#39;route print ^| findstr /r /c:\u0026#34;0.0.0.0.*0.0.0.0\u0026#34;\u0026#39;) do ( set \u0026#34;gateway=%%a\u0026#34; echo ğŸŒ é»˜è®¤ç½‘å…³: !gateway! ) REM è·å–è®¡ç®—æœºå echo ğŸ’» è®¡ç®—æœºå: %COMPUTERNAME% REM è·å–å…±äº«åˆ—è¡¨ echo. echo ğŸ“‚ å½“å‰å…±äº«åˆ—è¡¨: echo =============================== net share echo =============================== pause âš™ï¸ é«˜çº§é…ç½®å’Œç®¡ç† ğŸ” å¯†ç ç®¡ç† å®‰å…¨çš„å¯†ç ç®¡ç†è„šæœ¬ï¼š åˆ›å»º secure_connect.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @echo off REM ================================================== REM å®‰å…¨è¿æ¥è„šæœ¬ - ä¸æ˜¾ç¤ºæ˜æ–‡å¯†ç  REM ================================================== setlocal enabledelayedexpansion REM ä½¿ç”¨ç¼–ç çš„æ–¹å¼å­˜å‚¨å¯†ç ï¼ˆBase64ï¼‰ set encoded_password=WWlmYW4wNzE5 echo ğŸ” æ­£åœ¨å»ºç«‹å®‰å…¨è¿æ¥... REM Base64 è§£ç å‡½æ•° for /f \u0026#34;delims==\u0026#34; %%A in (\u0026#39;certutil -decode -f CON: CON: \u0026lt;\u0026lt;\u0026lt; \u0026#34;!encoded_password!\u0026#34;\u0026#39;) do set password=%%A net use Z: \\\\10.10.10.251\\Media !password! /user:root if %errorlevel% equ 0 ( echo âœ… å®‰å…¨è¿æ¥å»ºç«‹å®Œæˆ explorer Z: ) else ( echo âŒ å®‰å…¨è¿æ¥å¤±è´¥ ) endlocal pause ğŸ”„ æ‰¹é‡è¿æ¥ç®¡ç† åˆ›å»º network_manager.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 @echo off REM ================================================== REM ç½‘ç»œè¿æ¥ç®¡ç†å™¨ REM ================================================== :menu cls echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— echo â•‘ ç½‘ç»œè¿æ¥ç®¡ç†å™¨ â•‘ echo â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ echo â•‘ 1. è¿æ¥ Linux Samba å…±äº« â•‘ echo â•‘ 2. è¿æ¥ Windows å…±äº« â•‘ echo â•‘ 3. æŸ¥çœ‹å½“å‰è¿æ¥ â•‘ echo â•‘ 4. æ¸…é™¤æ‰€æœ‰è¿æ¥ â•‘ echo â•‘ 5. åˆ›å»ºæ–°çš„å…±äº«æ–‡ä»¶å¤¹ â•‘ echo â•‘ 6. é€€å‡º â•‘ echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• set /p choice=ğŸ“ è¯·é€‰æ‹©æ“ä½œ (1-6): if \u0026#34;%choice%\u0026#34;==\u0026#34;1\u0026#34; goto linux_connect if \u0026#34;%choice%\u0026#34;==\u0026#34;2\u0026#34; goto windows_connect if \u0026#34;%choice%\u0026#34;==\u0026#34;3\u0026#34; goto show_connections if \u0026#34;%choice%\u0026#34;==\u0026#34;4\u0026#34; goto clear_connections if \u0026#34;%choice%\u0026#34;==\u0026#34;5\u0026#34; goto create_share if \u0026#34;%choice%\u0026#34;==\u0026#34;6\u0026#34; exit echo âŒ æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥ timeout /t 2 /nobreak \u0026gt;nul goto menu :linux_connect net use Z: \\\\10.10.10.251\\Media your_password /user:root if %errorlevel% equ 0 ( echo âœ… Linux å…±äº«è¿æ¥æˆåŠŸ explorer Z: ) else ( echo âŒ Linux å…±äº«è¿æ¥å¤±è´¥ ) pause goto menu :windows_connect net use Y: \\\\10.10.10.248\\Win11é˜¿é‡Œäº‘ç›˜ 241313 /user:å¢¨ä¸å‡¡ if %errorlevel% equ 0 ( echo âœ… Windows å…±äº«è¿æ¥æˆåŠŸ explorer Y: ) else ( echo âŒ Windows å…±äº«è¿æ¥å¤±è´¥ ) pause goto menu :show_connections echo ğŸ“Š å½“å‰ç½‘ç»œè¿æ¥: echo =============================== net use echo =============================== pause goto menu :clear_connections net use * /delete /y echo âœ… æ‰€æœ‰è¿æ¥å·²æ¸…é™¤ pause goto menu :create_share set /p \u0026#34;folder_path=ğŸ“ è¯·è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„: \u0026#34; set /p \u0026#34;share_name=ğŸ·ï¸ è¯·è¾“å…¥å…±äº«åç§°: \u0026#34; net share \u0026#34;%share_name%\u0026#34;=\u0026#34;%folder_path%\u0026#34; /GRANT:Everyone,FULL echo âœ… å…±äº«åˆ›å»ºæˆåŠŸ! pause goto menu ğŸ”§ æ•…éšœæ’é™¤å’Œè¯Šæ–­ ç½‘ç»œè¯Šæ–­å·¥å…· åˆ›å»º network_diagnosis.bat æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 @echo off REM ================================================== REM ç½‘ç»œè¿æ¥è¯Šæ–­å·¥å…· REM ================================================== echo ğŸ” æ­£åœ¨æ‰§è¡Œç½‘ç»œè¯Šæ–­... echo. echo 1. æµ‹è¯•ç½‘ç»œè¿é€šæ€§: ping 10.10.10.251 -n 2 \u0026gt;nul \u0026amp;\u0026amp; echo âœ… Linux æœåŠ¡å™¨å¯è¾¾ || echo âŒ Linux æœåŠ¡å™¨ä¸å¯è¾¾ ping 10.10.10.248 -n 2 \u0026gt;nul \u0026amp;\u0026amp; echo âœ… Windows æœåŠ¡å™¨å¯è¾¾ || echo âŒ Windows æœåŠ¡å™¨ä¸å¯è¾¾ echo. echo 2. æ£€æŸ¥ç«¯å£å¼€æ”¾æƒ…å†µ: powershell -command \u0026#34;Test-NetConnection -ComputerName 10.10.10.251 -Port 445\u0026#34; | find \u0026#34;TcpTestSucceeded: True\u0026#34; \u0026gt;nul \u0026amp;\u0026amp; echo âœ… Samba ç«¯å£å¼€æ”¾ || echo âŒ Samba ç«¯å£å…³é—­ echo. echo 3. æ£€æŸ¥æœ¬åœ°å…±äº«æœåŠ¡: net statistics server | find \u0026#34;Server\u0026#34; \u0026amp;\u0026amp; echo âœ… Server æœåŠ¡è¿è¡Œä¸­ || echo âŒ Server æœåŠ¡æœªè¿è¡Œ echo. echo 4. æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€: netsh advfirewall show allprofiles state | find \u0026#34;ON\u0026#34; \u0026gt;nul \u0026amp;\u0026amp; echo âš ï¸ é˜²ç«å¢™å·²å¼€å¯ || echo âœ… é˜²ç«å¢™å·²å…³é—­ echo. echo 5. æ£€æŸ¥ç½‘ç»œå‘ç°åŠŸèƒ½: reg query \u0026#34;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\FDResPub\u0026#34; /v Start | find \u0026#34;0x2\u0026#34; \u0026gt;nul \u0026amp;\u0026amp; echo âœ… ç½‘ç»œå‘ç°å·²å¯ç”¨ || echo âŒ ç½‘ç»œå‘ç°å·²ç¦ç”¨ echo. echo ğŸ“‹ è¯Šæ–­å®Œæˆï¼ pause Samba è¿æ¥æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @echo off REM æµ‹è¯• Samba è¿æ¥ echo ğŸ” æµ‹è¯• Samba è¿æ¥... net use \\\\10.10.10.251\\Media /user:root yifan0719 if %errorlevel% equ 0 ( echo âœ… Samba è¿æ¥æµ‹è¯•é€šè¿‡ net use \\\\10.10.10.251\\Media /delete ) else ( echo âŒ Samba è¿æ¥æµ‹è¯•å¤±è´¥ echo ğŸ’¡ å¯èƒ½çš„åŸå› : echo - ç½‘ç»œä¸å¯è¾¾ echo - è®¤è¯å¤±è´¥ echo - é˜²ç«å¢™é˜»æ­¢ echo - æœåŠ¡æœªè¿è¡Œ ) pause ğŸ›¡ï¸ å®‰å…¨å»ºè®® å®‰å…¨é…ç½®å»ºè®® ä½¿ç”¨å¼ºå¯†ç ï¼šé¿å…ä½¿ç”¨ç®€å•å¯†ç ï¼Œæ¨èä½¿ç”¨å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ç»„åˆ é™åˆ¶è®¿é—®æƒé™ï¼šåªç»™å¿…è¦ç”¨æˆ·è®¿é—®æƒé™ï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™ å®šæœŸæ›´æ–°å¯†ç ï¼šå®šæœŸæ›´æ”¹å…±äº«å¯†ç ï¼Œå»ºè®®æ¯90å¤©æ›´æ¢ä¸€æ¬¡ å¯ç”¨åŠ å¯†ï¼šä½¿ç”¨ SMB3 åŠ å¯†åŠŸèƒ½ä¿æŠ¤æ•°æ®ä¼ è¾“ é˜²ç«å¢™é…ç½®ï¼šé™åˆ¶ä¸å¿…è¦çš„ç«¯å£è®¿é—®ï¼Œåªå¼€æ”¾éœ€è¦çš„ç«¯å£ å®‰å…¨å®¡è®¡è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @echo off REM å®‰å…¨å®¡è®¡è„šæœ¬ echo ğŸ”’ æ­£åœ¨æ‰§è¡Œå®‰å…¨å®¡è®¡... echo. echo 1. æ£€æŸ¥å…±äº«æƒé™: net share | findstr /C:\u0026#34;Everyone\u0026#34; /C:\u0026#34;Full\u0026#34; echo. echo 2. æ£€æŸ¥å½“å‰è¿æ¥: net use echo. echo 3. æ£€æŸ¥å…±äº«æ–‡ä»¶å¤¹æƒé™: for /f \u0026#34;tokens=2 delims= \u0026#34; %%a in (\u0026#39;net share ^| findstr /V \u0026#34;å‘½ä»¤æˆåŠŸå®Œæˆ\u0026#34; ^| findstr /V \u0026#34;å…±äº«å\u0026#34;\u0026#39;) do ( echo ğŸ“ å…±äº«: %%a icacls \u0026#34;%%a\u0026#34; | findstr /I \u0026#34;(F)\u0026#34; | findstr /V \u0026#34;Administrators\u0026#34; | findstr /V \u0026#34;SYSTEM\u0026#34; ) echo. echo 4. å»ºè®®æ“ä½œ: echo - å®šæœŸæ›´æ”¹å¯†ç  echo - é™åˆ¶å…±äº«æƒé™ echo - å¯ç”¨è®¿é—®æ—¥å¿— echo - ä½¿ç”¨ç½‘ç»œåŠ å¯† echo - å®šæœŸå®¡æŸ¥å…±äº«è®¾ç½® pause ğŸ’¾ å®ç”¨æŠ€å·§ å¿«é€Ÿè®¿é—®æŠ€å·§ 1 2 3 4 5 6 7 8 @echo off REM åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼ echo [InternetShortcut] \u0026gt; \u0026#34;%USERPROFILE%\\Desktop\\Linuxå…±äº«.url\u0026#34; echo URL=\\\\10.10.10.251\\Media \u0026gt;\u0026gt; \u0026#34;%USERPROFILE%\\Desktop\\Linuxå…±äº«.url\u0026#34; echo IconIndex=0 \u0026gt;\u0026gt; \u0026#34;%USERPROFILE%\\Desktop\\Linuxå…±äº«.url\u0026#34; echo IconFile=%SystemRoot%\\system32\\SHELL32.dll \u0026gt;\u0026gt; \u0026#34;%USERPROFILE%\\Desktop\\Linuxå…±äº«.url\u0026#34; echo âœ… å¿«æ·æ–¹å¼å·²åˆ›å»ºåˆ°æ¡Œé¢ pause æ‰¹é‡æ˜ å°„è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @echo off REM æ‰¹é‡æ˜ å°„å¤šä¸ªå…±äº« set shares[0]=\\\\10.10.10.251\\Media set shares[1]=\\\\10.10.10.254\\PVE-mydisk set shares[2]=\\\\10.10.10.245\\Debian set drives[0]=Z: set drives[1]=Y: set drives[2]=X: echo ğŸ—‚ï¸ æ­£åœ¨æ‰¹é‡æ˜ å°„å…±äº«... for /l %%i in (0,1,2) do ( echo ğŸ“ æ˜ å°„ !drives[%%i]! åˆ° !shares[%%i]! net use !drives[%%i]! !shares[%%i]! /persistent:yes ) echo âœ… æ‰¹é‡æ˜ å°„å®Œæˆ pause å…±äº«çŠ¶æ€ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 @echo off REM å…±äº«çŠ¶æ€ç›‘æ§è„šæœ¬ echo ğŸ“Š å…±äº«çŠ¶æ€ç›‘æ§ echo =============================== for /f \u0026#34;skip=4 tokens=1*\u0026#34; %%a in (\u0026#39;net share\u0026#39;) do ( if not \u0026#34;%%b\u0026#34;==\u0026#34;\u0026#34; ( echo ğŸ“ %%a - %%b net share %%a | findstr /C:\u0026#34;è·¯å¾„\u0026#34; /C:\u0026#34;ç”¨æˆ·\u0026#34; echo. ) ) echo =============================== pause ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š\nâœ… Windows ä½œä¸ºå®¢æˆ·ç«¯ï¼š ğŸ”— è¿æ¥ Linux å’Œ Windows Samba å…±äº« ğŸ“ åˆ›å»ºç½‘ç»œé©±åŠ¨å™¨æ˜ å°„ âš¡ é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ ğŸ”§ ç®¡ç†ç½‘ç»œè¿æ¥ âœ… Windows ä½œä¸ºæœåŠ¡ç«¯ï¼š ğŸ‘¥ åˆ›å»ºå’Œç®¡ç†å…±äº«æ–‡ä»¶å¤¹ ğŸ“‚ é…ç½®ç”¨æˆ·æƒé™ ğŸŒ æŸ¥çœ‹ç½‘ç»œä¿¡æ¯ âœ… é«˜çº§åŠŸèƒ½ï¼š ğŸ” å®‰å…¨çš„å¯†ç ç®¡ç† ğŸ”„ æ‰¹é‡è¿æ¥ç®¡ç† ğŸ”§ ç½‘ç»œè¯Šæ–­å’Œæ•…éšœæ’é™¤ ğŸ›¡ï¸ å®‰å…¨é…ç½®å»ºè®® ğŸ”§ å¸¸ç”¨å‘½ä»¤å›é¡¾ï¼š 1 2 3 4 5 6 net use # æŸ¥çœ‹ç½‘ç»œè¿æ¥ net use Z: \\\\server\\share # æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ net share # æŸ¥çœ‹å…±äº«åˆ—è¡¨ net share ShareName /delete # åˆ é™¤å…±äº« whoami # æŸ¥çœ‹å½“å‰ç”¨æˆ· icacls # ç®¡ç†æ–‡ä»¶æƒé™ ğŸŒŸ æœ€ä½³å®è·µï¼š å®šæœŸå¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ ä½¿ç”¨å¼ºå¯†ç å’Œå®šæœŸæ›´æ¢ é™åˆ¶è®¿é—®æƒé™åˆ°æœ€å°å¿…è¦èŒƒå›´ å¯ç”¨æ—¥å¿—è®°å½•ç”¨äºå®¡è®¡å’Œæ•…éšœæ’é™¤ å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡ ç°åœ¨æ‚¨å¯ä»¥ç†Ÿç»ƒåœ°åœ¨ Windows ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç† Samba æœåŠ¡äº†ï¼ğŸš€\nğŸ“š æ‰©å±•èµ„æº Microsoft SMB åè®®æ–‡æ¡£ Windows ç½‘ç»œå‘½ä»¤å‚è€ƒ Samba å®˜æ–¹æ–‡æ¡£ Windows å®‰å…¨æœ€ä½³å®è·µ äº«å—æ‚¨çš„é«˜æ•ˆæ–‡ä»¶å…±äº«ä½“éªŒï¼ğŸ‰\n","date":"2024-12-07T15:04:26+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/ae146e9c/","title":"Windows éƒ¨ç½² Samba æœåŠ¡æŒ‡å— ğŸªŸ"},{"content":"Linux ç³»ç»Ÿä¸­æ–‡è¯­è¨€å’Œæ—¶åŒºè®¾ç½®æŒ‡å— ğŸŒ å…¨é¢ä»‹ç»å¦‚ä½•åœ¨å„ç§ Linux å‘è¡Œç‰ˆä¸­è®¾ç½®ä¸­æ–‡è¯­è¨€ç¯å¢ƒå’Œæ—¶åŒºé…ç½®ï¼ŒåŒ…æ‹¬æ•…éšœæ’é™¤å’Œé«˜çº§æŠ€å·§ã€‚\nâœ¨ ç›®å½• âœ¨ æ¦‚è¿° ğŸ§ ä¸€ã€Debian ç³»ç»Ÿè®¾ç½® ğŸ”´ äºŒã€CentOS/RHEL ç³»ç»Ÿè®¾ç½® ğŸ–¥ï¸ ä¸‰ã€Proxmox VE (PVE) è®¾ç½® ğŸ§ å››ã€Ubuntu ç³»ç»Ÿè®¾ç½® âš™ï¸ äº”ã€é«˜çº§é…ç½®æŠ€å·§ ğŸ” å…­ã€æ•…éšœæ’é™¤ ğŸ’¡ ä¸ƒã€å®ç”¨æç¤º ğŸ“Š å…«ã€åŒºåŸŸè®¾ç½®å˜é‡è¯´æ˜ âœ¨ æ¦‚è¿° æ­£ç¡®è®¾ç½®è¯­è¨€ç¯å¢ƒå’Œæ—¶åŒºå¯¹äº Linux ç³»ç»Ÿçš„ä½¿ç”¨ä½“éªŒè‡³å…³é‡è¦ã€‚æœ¬æŒ‡å—æ¶µç›–äº† Debianã€CentOSã€Proxmox VE (PVE) å’Œ Ubuntu ç³»ç»Ÿçš„ä¸­æ–‡è¯­è¨€å’Œæ—¶åŒºé…ç½®æ–¹æ³•ã€‚\nğŸ’¡ æç¤º: å¯¹äºç”Ÿäº§æœåŠ¡å™¨ï¼Œå»ºè®®ä¿æŒè‹±æ–‡ç¯å¢ƒä»¥å‡å°‘æ½œåœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒåŒæ—¶ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®å¤„ç†ä¸­æ–‡å†…å®¹å’Œæ—¶åŒºã€‚\nğŸ§ ä¸€ã€Debian ç³»ç»Ÿè®¾ç½® 1ï¸âƒ£ å®‰è£…ä¸­æ–‡å­—ä½“ ğŸ”¤ 1 2 3 4 5 6 7 8 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£…å¸¸ç”¨ä¸­æ–‡å­—ä½“ sudo apt install ttf-wqy-microhei fonts-wqy-zenhei fonts-noto-cjk -y # éªŒè¯å­—ä½“å®‰è£… fc-list :lang=zh | grep -i \u0026#34;wqy\\|noto\u0026#34; 2ï¸âƒ£ å®‰è£…ä¸­æ–‡è¯­è¨€åŒ… ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 # å®‰è£… locales åŒ… sudo apt install locales -y # ç”Ÿæˆä¸­æ–‡åŒºåŸŸè®¾ç½® sudo sed -i \u0026#39;s/# zh_CN.UTF-8 UTF-8/zh_CN.UTF-8 UTF-8/\u0026#39; /etc/locale.gen sudo sed -i \u0026#39;s/# zh_CN.GBK GBK/zh_CN.GBK GBK/\u0026#39; /etc/locale.gen # é‡æ–°ç”ŸæˆåŒºåŸŸè®¾ç½® sudo locale-gen # æˆ–è€…ä½¿ç”¨äº¤äº’å¼é…ç½® sudo dpkg-reconfigure locales 3ï¸âƒ£ è®¾ç½®ç¯å¢ƒå˜é‡ âš™ï¸ 1 2 3 4 5 6 7 8 9 10 11 12 # å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ sudo cp /etc/profile /etc/profile.bak sudo cp /etc/default/locale /etc/default/locale.bak # è®¾ç½®ç³»ç»Ÿçº§è¯­è¨€ç¯å¢ƒ echo \u0026#39;LANG=zh_CN.UTF-8\u0026#39; | sudo tee /etc/default/locale echo \u0026#39;LC_ALL=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/default/locale # ä¸ºç”¨æˆ·é…ç½®æ–‡ä»¶æ·»åŠ ç¯å¢ƒå˜é‡ echo \u0026#39;export LANG=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/profile echo \u0026#39;export LC_ALL=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/profile echo \u0026#39;export LANGUAGE=zh_CN:zh:en_US:en\u0026#39; | sudo tee -a /etc/profile 4ï¸âƒ£ ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ ğŸ”„ 1 2 3 4 5 # ç«‹å³ç”Ÿæ•ˆ source /etc/profile # æˆ–è€…é‡æ–°ç™»å½• exit 5ï¸âƒ£ è®¾ç½®æ—¶åŒº ğŸ• 1 2 3 4 5 6 7 8 # è®¾ç½®äºšæ´²ä¸Šæµ·æ—¶åŒº sudo timedatectl set-timezone Asia/Shanghai # æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³• sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # åŒæ­¥ç¡¬ä»¶æ—¶é’Ÿ sudo hwclock --systohc 6ï¸âƒ£ éªŒè¯è®¾ç½® âœ… 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥å½“å‰è¯­è¨€ç¯å¢ƒ locale echo $LANG echo $LC_ALL # æ£€æŸ¥æ—¶åŒº timedatectl date # æµ‹è¯•ä¸­æ–‡æ˜¾ç¤º echo \u0026#34;ä¸­æ–‡æµ‹è¯•\u0026#34; \u0026gt; test_ä¸­æ–‡.txt ls -la ğŸ”´ äºŒã€CentOS/RHEL ç³»ç»Ÿè®¾ç½® 1ï¸âƒ£ å®‰è£…ä¸­æ–‡è¯­è¨€æ”¯æŒ ğŸ“š 1 2 3 4 5 # CentOS 7/8 å’Œ RHEL sudo yum -y install langpacks-zh_CN glibc-common # CentOS Stream 8/9 å’Œ RHEL 8+ sudo dnf -y install langpacks-zh_CN glibc-langpack-zh 2ï¸âƒ£ è®¾ç½®ç³»ç»Ÿè¯­è¨€ ğŸŒ 1 2 3 4 5 6 7 # è®¾ç½®ç³»ç»ŸåŒºåŸŸ sudo localectl set-locale LANG=zh_CN.UTF-8 sudo localectl set-locale LC_CTYPE=zh_CN.UTF-8 # æˆ–è€…æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ echo \u0026#39;LANG=zh_CN.UTF-8\u0026#39; | sudo tee /etc/locale.conf echo \u0026#39;LC_CTYPE=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/locale.conf 3ï¸âƒ£ åŠ è½½é…ç½®æ–‡ä»¶ ğŸ”„ 1 2 3 4 5 # ç«‹å³ç”Ÿæ•ˆ source /etc/locale.conf # æˆ–è€…é‡å¯ç³»ç»Ÿ sudo reboot 4ï¸âƒ£ è®¾ç½®æ—¶åŒº ğŸ• 1 2 3 4 5 6 7 8 # ä½¿ç”¨ timedatectl è®¾ç½®æ—¶åŒº sudo timedatectl set-timezone Asia/Shanghai # éªŒè¯æ—¶åŒº timedatectl # ä¼ ç»Ÿæ–¹æ³•ï¼ˆå¦‚æœ timedatectl ä¸å¯ç”¨ï¼‰ sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 5ï¸âƒ£ å®‰è£…ä¸­æ–‡å­—ä½“ ğŸ”¤ 1 2 3 4 5 6 7 8 # CentOS 7 sudo yum -y install wqy-microhei-fonts wqy-zenhei-fonts google-noto-sans-cjk-fonts # CentOS 8+ sudo dnf -y install wqy-microhei-fonts wqy-zenhei-fonts google-noto-sans-cjk-fonts # åˆ·æ–°å­—ä½“ç¼“å­˜ sudo fc-cache -fv 6ï¸âƒ£ éªŒè¯è®¾ç½® âœ… 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹å½“å‰è¯­è¨€è®¾ç½® localectl status locale # æŸ¥çœ‹æ—¶åŒºè®¾ç½® timedatectl date -R # æµ‹è¯•ä¸­æ–‡æ”¯æŒ echo \u0026#34;ä¸­æ–‡æµ‹è¯•\u0026#34; | iconv -f UTF-8 -t GBK ğŸ–¥ï¸ ä¸‰ã€Proxmox VE (PVE) è®¾ç½® 1ï¸âƒ£ æ£€æŸ¥ä¸­æ–‡å­—ä½“å®‰è£…æƒ…å†µ ğŸ” 1 2 3 4 5 # æ£€æŸ¥å·²å®‰è£…çš„ä¸­æ–‡å­—ä½“ fc-list :lang=zh | head -10 # å¦‚æœæ²¡æœ‰ä¸­æ–‡å­—ä½“ï¼Œå®‰è£…å®ƒä»¬ sudo apt update 2ï¸âƒ£ å®‰è£…ä¸­æ–‡å­—ä½“ ğŸ“¦ 1 2 3 4 5 # å®‰è£…å¸¸ç”¨ä¸­æ–‡å­—ä½“åŒ… sudo apt install fonts-wqy-zenhei fonts-wqy-microhei fonts-noto-cjk -y # éªŒè¯å®‰è£… fc-list :lang=zh | grep -i \u0026#34;wqy\\|noto\u0026#34; 3ï¸âƒ£ æ£€æŸ¥å½“å‰åŒºåŸŸè®¾ç½® ğŸŒ 1 2 3 4 5 6 # æŸ¥çœ‹å½“å‰åŒºåŸŸè®¾ç½® locale localectl status # æ£€æŸ¥å¯ç”¨åŒºåŸŸ localectl list-locales | grep zh_CN 4ï¸âƒ£ é…ç½®ä¸­æ–‡åŒºåŸŸè®¾ç½® âš™ï¸ 1 2 3 4 5 6 7 8 9 10 11 12 # ç¼–è¾‘ locale.gen æ–‡ä»¶ sudo nano /etc/locale.gen # å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼ˆåˆ é™¤ #ï¼‰ï¼š # zh_CN.UTF-8 UTF-8 # zh_CN.GBK GBK # ç”ŸæˆåŒºåŸŸè®¾ç½® sudo locale-gen # æ›´æ–°ç³»ç»ŸåŒºåŸŸ sudo update-locale LANG=zh_CN.UTF-8 LC_MESSAGES=zh_CN.UTF-8 5ï¸âƒ£ è®¾ç½®æ—¶åŒº ğŸ• 1 2 3 4 5 6 7 8 9 # è®¾ç½®æ—¶åŒº sudo timedatectl set-timezone Asia/Shanghai # éªŒè¯æ—¶åŒº timedatectl # ç¡®ä¿æ—¶é—´åŒæ­¥æœåŠ¡è¿è¡Œ sudo systemctl enable systemd-timesyncd sudo systemctl start systemd-timesyncd 6ï¸âƒ£ Web ç•Œé¢ä¸­æ–‡æ”¯æŒ ğŸŒ 1 2 3 4 5 6 # PVE Web ç•Œé¢ä¸»è¦ä½¿ç”¨è‹±æ–‡ # ä½†å¯ä»¥ç¡®ä¿ç»ˆç«¯å’Œå‘½ä»¤è¡Œä¸­æ–‡æ­£å¸¸æ˜¾ç¤º # æµ‹è¯•ä¸­æ–‡æ–‡ä»¶åæ”¯æŒ touch \u0026#34;æµ‹è¯•æ–‡ä»¶-ä¸­æ–‡.txt\u0026#34; ls -la 7ï¸âƒ£ é‡å¯æœåŠ¡ ğŸ”„ 1 2 3 4 5 6 # é‡å¯ç›¸å…³æœåŠ¡ sudo systemctl restart pveproxy sudo systemctl restart pvedaemon # æˆ–è€…é‡å¯æ•´ä¸ªç³»ç»Ÿ sudo reboot ğŸ§ å››ã€Ubuntu ç³»ç»Ÿè®¾ç½® 1ï¸âƒ£ å®‰è£…ä¸­æ–‡è¯­è¨€åŒ… ğŸ“¦ 1 2 3 4 5 6 7 8 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£…ä¸­æ–‡è¯­è¨€æ”¯æŒ sudo apt install language-pack-zh-hans language-pack-zh-hans-base -y # å®‰è£…å®Œæ•´çš„ä¸­æ–‡æ”¯æŒï¼ˆåŒ…æ‹¬è¾“å…¥æ³•ï¼‰ sudo apt install $(check-language-support -l zh_CN) -y 2ï¸âƒ£ è®¾ç½®ç³»ç»Ÿè¯­è¨€ ğŸŒ 1 2 3 4 5 6 7 # ä½¿ç”¨ localectl è®¾ç½®è¯­è¨€ sudo localectl set-locale LANG=zh_CN.UTF-8 sudo localectl set-locale LC_CTYPE=zh_CN.UTF-8 # æˆ–è€…æ‰‹åŠ¨é…ç½® echo \u0026#39;LANG=zh_CN.UTF-8\u0026#39; | sudo tee /etc/default/locale echo \u0026#39;LC_ALL=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/default/locale 3ï¸âƒ£ é…ç½®å›¾å½¢ç•Œé¢è¯­è¨€ï¼ˆå¦‚æœ‰ï¼‰ğŸ–¥ï¸ 1 2 3 4 5 6 7 8 # å¯¹äºæœ‰å›¾å½¢ç•Œé¢çš„ Ubuntu sudo apt install ubuntu-desktop -y # è®¾ç½®å›¾å½¢ç•Œé¢è¯­è¨€ sudo update-locale LANG=zh_CN.UTF-8 # å®‰è£…ä¸­æ–‡è¾“å…¥æ³• sudo apt install fcitx fcitx-googlepinyin fcitx-module-cloudpinyin -y 4ï¸âƒ£ é‡å¯ç³»ç»Ÿ ğŸ”„ 1 2 3 4 5 # é‡å¯ä½¿æ›´æ”¹ç”Ÿæ•ˆ sudo reboot # æˆ–è€…é‡æ–°åŠ è½½ç¯å¢ƒ source /etc/default/locale 5ï¸âƒ£ å®‰è£…å®Œæ•´ä¸­æ–‡æ”¯æŒ ğŸ“š 1 2 3 4 5 # å®‰è£…é¢å¤–çš„ä¸­æ–‡æ”¯æŒåŒ… sudo apt install fonts-noto-cjk fonts-wqy-microhei fonts-wqy-zenhei -y # å®‰è£…ä¸­æ–‡æ‰‹å†Œé¡µ sudo apt install manpages-zh -y 6ï¸âƒ£ è®¾ç½®æ—¶åŒº ğŸ• 1 2 3 4 5 6 7 8 9 # è®¾ç½®æ—¶åŒº sudo timedatectl set-timezone Asia/Shanghai # æˆ–è€…ä½¿ç”¨äº¤äº’å¼é…ç½® sudo dpkg-reconfigure tzdata # éªŒè¯æ—¶åŒº timedatectl date 7ï¸âƒ£ éªŒè¯è®¾ç½® âœ… 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥è¯­è¨€ç¯å¢ƒ locale localectl status # æµ‹è¯•ä¸­æ–‡æ”¯æŒ echo \u0026#34;ä¸­æ–‡æµ‹è¯•æˆåŠŸï¼\u0026#34; \u0026gt; æµ‹è¯•æ–‡ä»¶.txt cat æµ‹è¯•æ–‡ä»¶.txt # æ£€æŸ¥å­—ä½“æ”¯æŒ fc-list :lang=zh | head -5 âš™ï¸ äº”ã€é«˜çº§é…ç½®æŠ€å·§ 1ï¸âƒ£ åŒæ—¶é…ç½®å¤šç§è¯­è¨€ç¯å¢ƒ ğŸŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç¼–è¾‘ /etc/locale.gen æ–‡ä»¶ sudo nano /etc/locale.gen # å–æ¶ˆæ³¨é‡Šå¤šç§è¯­è¨€æ”¯æŒ # en_US.UTF-8 UTF-8 # zh_CN.UTF-8 UTF-8 # ja_JP.UTF-8 UTF-8 # ko_KR.UTF-8 UTF-8 # ç”ŸæˆåŒºåŸŸè®¾ç½® sudo locale-gen # è®¾ç½®ä¼˜å…ˆçº§ echo \u0026#39;LANG=en_US.UTF-8\u0026#39; | sudo tee /etc/default/locale echo \u0026#39;LC_CTYPE=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/default/locale 2ï¸âƒ£ ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®ä¸åŒè¯­è¨€ ğŸ‘¤ 1 2 3 4 5 6 7 8 9 10 11 12 # ä¸ºç”¨æˆ·å•ç‹¬è®¾ç½®è¯­è¨€ç¯å¢ƒ nano ~/.profile # æ·»åŠ ä»¥ä¸‹å†…å®¹ export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 export LANGUAGE=en_US:en # æˆ–è€…ä¸ºç”¨æˆ·è®¾ç½®ä¸­æ–‡ export LANG=zh_CN.UTF-8 export LC_ALL=zh_CN.UTF-8 export LANGUAGE=zh_CN:zh 3ï¸âƒ£ ä¸´æ—¶æ›´æ”¹è¯­è¨€ç¯å¢ƒ ğŸ”„ 1 2 3 4 5 6 7 8 9 10 11 # ä¸´æ—¶è®¾ç½®ä¸ºè‹±æ–‡ export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 # ä¸´æ—¶è®¾ç½®ä¸ºä¸­æ–‡ export LANG=zh_CN.UTF-8 export LC_ALL=zh_CN.UTF-8 # ä¸´æ—¶è®¾ç½®ä¸ºæ—¥è¯­ export LANG=ja_JP.UTF-8 export LC_ALL=ja_JP.UTF-8 4ï¸âƒ£ æ£€æŸ¥å¯ç”¨æ—¶åŒº ğŸŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ—¶åŒº timedatectl list-timezones # æœç´¢äºšæ´²æ—¶åŒº timedatectl list-timezones | grep Asia # æœç´¢ä¸­å›½æ—¶åŒº timedatectl list-timezones | grep Shanghai timedatectl list-timezones | grep Hongkong timedatectl list-timezones | grep Taipei # æŸ¥çœ‹å½“å‰æ—¶åŒº timedatectl show | grep Timezone 5ï¸âƒ£ è‡ªå®šä¹‰åŒºåŸŸè®¾ç½® ğŸ¨ 1 2 3 4 5 6 7 8 # åˆ›å»ºè‡ªå®šä¹‰åŒºåŸŸè®¾ç½® sudo localedef -i zh_CN -f UTF-8 zh_CN.UTF-8 # éªŒè¯è‡ªå®šä¹‰åŒºåŸŸ locale -a | grep zh_CN # è®¾ç½®è‡ªå®šä¹‰åŒºåŸŸ sudo update-locale LANG=zh_CN.UTF-8 ğŸ” å…­ã€æ•…éšœæ’é™¤ 1ï¸âƒ£ å­—ä½“æ˜¾ç¤ºé—®é¢˜ âŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ·æ–°å­—ä½“ç¼“å­˜ sudo fc-cache -fv # æŸ¥çœ‹å·²å®‰è£…çš„ä¸­æ–‡å­—ä½“ fc-list :lang=zh fc-list | grep -i chinese # é‡æ–°å®‰è£…å­—ä½“ sudo apt install --reinstall fonts-wqy-zenhei fonts-wqy-microhei # æ£€æŸ¥å­—ä½“ç›®å½•æƒé™ sudo chmod 755 /usr/share/fonts/ sudo chmod 644 /usr/share/fonts/*/* 2ï¸âƒ£ åŒºåŸŸè®¾ç½®æœªç”Ÿæ•ˆ âŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥åŒºåŸŸè®¾ç½®æ–‡ä»¶ cat /etc/default/locale cat /etc/locale.conf # é‡æ–°ç”ŸæˆåŒºåŸŸè®¾ç½® sudo locale-gen sudo update-locale # æ£€æŸ¥åŒºåŸŸè®¾ç½®æ˜¯å¦å¯ç”¨ locale -a | grep zh_CN # å¦‚æœç¼ºå°‘åŒºåŸŸè®¾ç½®ï¼Œå®‰è£…è¯­è¨€åŒ… sudo apt install locales -y 3ï¸âƒ£ æ—¶åŒºè®¾ç½®ä¸æ­£ç¡® âŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥å½“å‰æ—¶åŒº timedatectl ls -l /etc/localtime # æ‰‹åŠ¨è®¾ç½®æ—¶åŒºé“¾æ¥ sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # æ›´æ–°ç¡¬ä»¶æ—¶é’Ÿ sudo hwclock --systohc # æ£€æŸ¥æ—¶é—´åŒæ­¥ sudo systemctl status systemd-timesyncd sudo timedatectl set-ntp true 4ï¸âƒ£ å›¾å½¢ç•Œé¢è¯­è¨€ä¸æ›´æ”¹ âŒ 1 2 3 4 5 6 7 8 9 10 # å¯¹äºæœ‰å›¾å½¢ç•Œé¢çš„ç³»ç»Ÿ sudo update-locale LANG=zh_CN.UTF-8 LC_MESSAGES=zh_CN.UTF-8 # é‡æ–°å¯åŠ¨æ˜¾ç¤ºç®¡ç†å™¨ sudo systemctl restart gdm sudo systemctl restart lightdm sudo systemctl restart sddm # æˆ–è€…é‡å¯ç³»ç»Ÿ sudo reboot 5ï¸âƒ£ SSH å®¢æˆ·ç«¯ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 # ç¡®ä¿ SSH å®¢æˆ·ç«¯æ”¯æŒ UTF-8 # åœ¨å®¢æˆ·ç«¯è®¾ç½®ä¸­å¯ç”¨ UTF-8 ç¼–ç  # åœ¨æœåŠ¡å™¨ä¸Šç¡®ä¿æ­£ç¡®åŒºåŸŸè®¾ç½® echo \u0026#39;export LANG=en_US.UTF-8\u0026#39; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#39;export LC_ALL=en_US.UTF-8\u0026#39; \u0026gt;\u0026gt; ~/.bashrc # æˆ–è€…ä½¿ç”¨ screen/tmux æ—¶è®¾ç½® echo \u0026#39;defencoding UTF-8\u0026#39; \u0026gt;\u0026gt; ~/.screenrc echo \u0026#39;set -g utf8 on\u0026#39; \u0026gt;\u0026gt; ~/.tmux.conf 6ï¸âƒ£ ä¸­æ–‡æ–‡ä»¶åä¹±ç  ğŸ“ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ç³»ç»Ÿç¼–ç  echo $LANG echo $LC_CTYPE # ä¿®å¤æ–‡ä»¶åç¼–ç é—®é¢˜ convmv -f GBK -t UTF-8 -r --notest /path/to/directory # ä½¿ç”¨æ­£ç¡®çš„ç¼–ç æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ # åœ¨ /etc/fstab ä¸­æ·»åŠ æŒ‚è½½é€‰é¡¹ï¼š # defaults,utf8 0 0 ğŸ’¡ ä¸ƒã€å®ç”¨æç¤º 1ï¸âƒ£ æœåŠ¡å™¨ vs æ¡Œé¢ç¯å¢ƒ ğŸ–¥ï¸ 1 2 3 4 5 6 7 8 # æœåŠ¡å™¨ç¯å¢ƒï¼šæœ€å°åŒ–ä¸­æ–‡æ”¯æŒ sudo apt install locales fonts-wqy-zenhei # æ¡Œé¢ç¯å¢ƒï¼šå®Œæ•´ä¸­æ–‡æ”¯æŒ sudo apt install $(check-language-support -l zh_CN) # å¼€å‘ç¯å¢ƒï¼šé¢å¤–å¼€å‘å·¥å…· sudo apt install language-pack-zh-hans language-pack-gnome-zh-hans 2ï¸âƒ£ å¤‡ä»½é…ç½® ğŸ“¦ 1 2 3 4 5 6 7 8 # å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ sudo cp /etc/default/locale /etc/default/locale.backup sudo cp /etc/locale.gen /etc/locale.gen.backup sudo cp /etc/timezone /etc/timezone.backup # å¤‡ä»½ç”¨æˆ·é…ç½® cp ~/.profile ~/.profile.backup cp ~/.bashrc ~/.bashrc.backup 3ï¸âƒ£ æµ‹è¯•ä¸­æ–‡æ”¯æŒ âœ… 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºæµ‹è¯•æ–‡ä»¶å’Œç›®å½• mkdir æµ‹è¯•ç›®å½• touch æµ‹è¯•ç›®å½•/æµ‹è¯•æ–‡ä»¶.txt echo \u0026#34;ä¸­æ–‡å†…å®¹æµ‹è¯•\u0026#34; \u0026gt; æµ‹è¯•ç›®å½•/æµ‹è¯•æ–‡ä»¶.txt # éªŒè¯æ˜¾ç¤º ls -la æµ‹è¯•ç›®å½•/ cat æµ‹è¯•ç›®å½•/æµ‹è¯•æ–‡ä»¶.txt # æ¸…ç†æµ‹è¯•æ–‡ä»¶ rm -rf æµ‹è¯•ç›®å½•/ 4ï¸âƒ£ å¤šç”¨æˆ·ç³»ç»Ÿè€ƒè™‘ ğŸ‘¥ 1 2 3 4 5 6 7 8 9 # ä¸ºä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒè¯­è¨€ # User1 ä½¿ç”¨ä¸­æ–‡ echo \u0026#39;export LANG=zh_CN.UTF-8\u0026#39; \u0026gt;\u0026gt; /home/user1/.profile # User2 ä½¿ç”¨è‹±æ–‡ echo \u0026#39;export LANG=en_US.UTF-8\u0026#39; \u0026gt;\u0026gt; /home/user2/.profile # ç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æ­£ç¡®çš„ç¯å¢ƒå˜é‡ sudo update-locale LANG=en_US.UTF-8 # ç³»ç»Ÿé»˜è®¤ 5ï¸âƒ£ å®¹å™¨ç¯å¢ƒæ³¨æ„äº‹é¡¹ ğŸ³ 1 2 3 4 5 6 7 # Docker å®¹å™¨ä¸­è®¾ç½®ä¸­æ–‡ç¯å¢ƒ FROM ubuntu:20.04 RUN apt update \u0026amp;\u0026amp; apt install -y locales fonts-wqy-zenhei RUN sed -i \u0026#39;s/# zh_CN.UTF-8 UTF-8/zh_CN.UTF-8 UTF-8/\u0026#39; /etc/locale.gen RUN locale-gen zh_CN.UTF-8 ENV LANG zh_CN.UTF-8 ENV LC_ALL zh_CN.UTF-8 ğŸ“Š å…«ã€åŒºåŸŸè®¾ç½®å˜é‡è¯´æ˜ å˜é‡å è¯´æ˜ ç¤ºä¾‹å€¼ ä¼˜å…ˆçº§ LANG é»˜è®¤åŒºåŸŸè®¾ç½® zh_CN.UTF-8 æœ€ä½ LC_ALL è¦†ç›–æ‰€æœ‰åŒºåŸŸç±»åˆ« zh_CN.UTF-8 æœ€é«˜ LC_CTYPE å­—ç¬¦åˆ†ç±»å’Œå¤§å°å†™è½¬æ¢ zh_CN.UTF-8 é«˜ LC_NUMERIC æ•°å­—æ ¼å¼ zh_CN.UTF-8 ä¸­ LC_TIME æ—¶é—´å’Œæ—¥æœŸæ ¼å¼ zh_CN.UTF-8 ä¸­ LC_COLLATE æ’åºå’Œæ¯”è¾ƒè§„åˆ™ zh_CN.UTF-8 ä¸­ LC_MONETARY è´§å¸æ ¼å¼ zh_CN.UTF-8 ä¸­ LC_MESSAGES æ¶ˆæ¯å’Œç•Œé¢è¯­è¨€ zh_CN.UTF-8 é«˜ LC_PAPER çº¸å¼ å¤§å°è®¾ç½® zh_CN.UTF-8 ä½ LC_NAME å§“åæ ¼å¼ zh_CN.UTF-8 ä½ LC_ADDRESS åœ°å€å’Œåœ°ç†ä½ç½®æ ¼å¼ zh_CN.UTF-8 ä½ LC_TELEPHONE ç”µè¯å·ç æ ¼å¼ zh_CN.UTF-8 ä½ LC_MEASUREMENT åº¦é‡è¡¡å•ä½ zh_CN.UTF-8 ä½ LC_IDENTIFICATION åŒºåŸŸæè¿°å…ƒæ•°æ® zh_CN.UTF-8 ä½ å˜é‡ä¼˜å…ˆçº§è¯´æ˜ ğŸ¯ 1 2 3 4 5 6 7 8 9 10 11 # ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š # 1. LC_ALL (æœ€é«˜ä¼˜å…ˆçº§ï¼Œè¦†ç›–æ‰€æœ‰è®¾ç½®) # 2. LC_* å„ä¸ªç±»åˆ«å˜é‡ # 3. LANG (æœ€ä½ä¼˜å…ˆçº§ï¼Œé»˜è®¤è®¾ç½®) # ç¤ºä¾‹ï¼šè®¾ç½®ç³»ç»Ÿé»˜è®¤ä¸ºè‹±æ–‡ï¼Œä½†æ¶ˆæ¯æ˜¾ç¤ºä¸­æ–‡ export LANG=en_US.UTF-8 export LC_MESSAGES=zh_CN.UTF-8 # é‡ç½® LC_ALL ä»¥å…è®¸å…¶ä»–å˜é‡ç”Ÿæ•ˆ unset LC_ALL æœ€ä½³å®è·µ âœ… 1 2 3 4 5 6 7 8 9 10 11 12 # ç”Ÿäº§æœåŠ¡å™¨æ¨èé…ç½® echo \u0026#39;LANG=en_US.UTF-8\u0026#39; | sudo tee /etc/default/locale echo \u0026#39;LC_CTYPE=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/default/locale # å¼€å‘ç¯å¢ƒé…ç½® echo \u0026#39;LANG=zh_CN.UTF-8\u0026#39; | sudo tee /etc/default/locale echo \u0026#39;LC_ALL=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/default/locale # å¤šè¯­è¨€æ”¯æŒé…ç½® echo \u0026#39;LANG=en_US.UTF-8\u0026#39; | sudo tee /etc/default/locale echo \u0026#39;LC_CTYPE=zh_CN.UTF-8\u0026#39; | sudo tee -a /etc/default/locale echo \u0026#39;LC_TIME=ja_JP.UTF-8\u0026#39; | sudo tee -a /etc/default/locale ğŸ‰ å®Œæˆï¼ ç°åœ¨æ‚¨å·²ç»æŒæ¡äº†åœ¨å„ç§ Linux å‘è¡Œç‰ˆä¸­é…ç½®ä¸­æ–‡è¯­è¨€ç¯å¢ƒå’Œæ—¶åŒºçš„å®Œæ•´çŸ¥è¯†ã€‚è®°å¾—æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„é…ç½®æ–¹æ¡ˆã€‚\nğŸ“š æ‰©å±•èµ„æº GNU C Library åŒºåŸŸè®¾ç½®æ–‡æ¡£ Debian åŒºåŸŸè®¾ç½®æŒ‡å— Ubuntu æœ¬åœ°åŒ–å¸®åŠ© Red Hat ç³»ç»Ÿè¯­è¨€é…ç½® â“ å¸¸è§é—®é¢˜è§£ç­” Q: ä¸ºä»€ä¹ˆè®¾ç½®äº†ä¸­æ–‡ç¯å¢ƒä½†æŸäº›ç¨‹åºè¿˜æ˜¯æ˜¾ç¤ºè‹±æ–‡ï¼Ÿ A: è¿™å¯èƒ½æ˜¯å› ä¸ºç¨‹åºæ²¡æœ‰å®Œæ•´çš„ä¸­æ–‡ç¿»è¯‘åŒ…ï¼Œæˆ–è€…éœ€è¦å•ç‹¬è®¾ç½®ç¨‹åºçš„è¯­è¨€é€‰é¡¹ã€‚\nQ: å¦‚ä½•ä¸´æ—¶åˆ‡æ¢åˆ°è‹±æ–‡ç¯å¢ƒè¿›è¡Œæ•…éšœæ’é™¤ï¼Ÿ A: ä½¿ç”¨å‘½ä»¤ export LANG=en_US.UTF-8 å¯ä»¥ä¸´æ—¶åˆ‡æ¢åˆ°è‹±æ–‡ç¯å¢ƒã€‚\nQ: æ—¶åŒºè®¾ç½®åæ—¶é—´ä»ç„¶ä¸æ­£ç¡®æ€ä¹ˆåŠï¼Ÿ A: æ£€æŸ¥ NTP æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼šsudo systemctl status systemd-timesyncdï¼Œå¹¶ç¡®ä¿ç¡¬ä»¶æ—¶é’ŸåŒæ­¥ï¼šsudo hwclock --systohcã€‚\nQ: ä¸­æ–‡æ–‡ä»¶ååœ¨ Windows å’Œ Linux ä¹‹é—´ä¼ è¾“å‡ºç°ä¹±ç ï¼Ÿ A: è¿™æ˜¯å› ä¸º Windows é€šå¸¸ä½¿ç”¨ GBK ç¼–ç è€Œ Linux ä½¿ç”¨ UTF-8ã€‚å¯ä»¥ä½¿ç”¨ convmv å·¥å…·è¿›è¡Œç¼–ç è½¬æ¢ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æˆåŠŸé…ç½® Linux ç³»ç»Ÿçš„ä¸­æ–‡è¯­è¨€ç¯å¢ƒå’Œæ—¶åŒºè®¾ç½®ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå„å‘è¡Œç‰ˆçš„å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºæ”¯æŒã€‚\n","date":"2024-12-07T15:03:31+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ce4e666d/","title":"Linux ç³»ç»Ÿä¸­æ–‡è¯­è¨€å’Œæ—¶åŒºè®¾ç½®æŒ‡å— ğŸŒ"},{"content":"Linux ç»ˆç«¯æ–‡ä»¶åˆ—è¡¨ç€è‰²æ–¹æ¡ˆ ğŸŒˆ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸º Linux çš„ ls å‘½ä»¤é…ç½®å½©è‰²è¾“å‡ºï¼Œè®©æ–‡ä»¶åˆ—è¡¨æ›´åŠ ç›´è§‚å’Œæ˜“äºè¯†åˆ«ã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„é¢œè‰²æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥å¤§å¹…æå‡ç»ˆç«¯ä½¿ç”¨æ•ˆç‡å’Œä½“éªŒï¼ğŸ¨\nğŸ“– å¯¼èˆªç›®å½• ğŸ¯ å¿«é€Ÿé…ç½®æ–¹æ³• ğŸ“Š é¢œè‰²ä»£ç è¯¦è§£ ğŸ¨ è‡ªå®šä¹‰é¢œè‰²æ–¹æ¡ˆ âš™ï¸ ç³»ç»Ÿçº§é…ç½® ğŸ”§ å…¶ä»–ç›¸å…³é…ç½® ğŸ› æ•…éšœæ’é™¤ ğŸ’¡ å®ç”¨æŠ€å·§ ğŸŒŸ é¢œè‰²æ–¹æ¡ˆæ¨è ğŸ¯ ä¸€ã€å¿«é€Ÿé…ç½®æ–¹æ³• 1. åˆ›å»ºç€è‰²é…ç½® 1 2 3 4 5 6 7 8 9 # å°†ç€è‰²é…ç½®æ·»åŠ åˆ° .bashrc æ–‡ä»¶ cat \u0026gt;\u0026gt; ~/.bashrc \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # LS é¢œè‰²é…ç½® alias ls=\u0026#39;ls --color=auto\u0026#39; export LS_COLORS=\u0026#39;di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:bd=1;34:cd=1;34:su=1;41:sg=1;46:tw=1;42:ow=1;33:*.gz=1;32:*.mp4=1;32\u0026#39; EOF # ç«‹å³ç”Ÿæ•ˆ source ~/.bashrc 2. éªŒè¯é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æµ‹è¯•é…ç½®æ˜¯å¦ç”Ÿæ•ˆ ls -la # ğŸ¨ åº”è¯¥æ˜¾ç¤ºå½©è‰²è¾“å‡º # æ£€æŸ¥ LS_COLORS å˜é‡ echo $LS_COLORS # åˆ›å»ºæµ‹è¯•æ–‡ä»¶å’Œç¯å¢ƒ mkdir -p /tmp/color-test \u0026amp;\u0026amp; cd /tmp/color-test touch {file.txt,script.sh,image.jpg,archive.tar.gz,music.mp3} chmod +x script.sh ln -s file.txt link.txt mkfifo pipe.fifo ls -la ğŸ“Š äºŒã€é¢œè‰²ä»£ç è¯¦è§£ æ–‡ä»¶ç±»å‹é¢œè‰²ä»£ç  ä»£ç  é¢œè‰² æ•ˆæœ ç¤ºä¾‹ 1;34 è“è‰² ç²—ä½“è“è‰² ç›®å½• 1;36 é’è‰² ç²—ä½“é’è‰² ç¬¦å·é“¾æ¥ 1;35 ç´«è‰² ç²—ä½“ç´«è‰² Socket æ–‡ä»¶ 1;33 é»„è‰² ç²—ä½“é»„è‰² å‘½åç®¡é“ 1;32 ç»¿è‰² ç²—ä½“ç»¿è‰² å¯æ‰§è¡Œæ–‡ä»¶ 1;41 çº¢åº• ç²—ä½“ç™½è‰²ï¼Œçº¢è‰²èƒŒæ™¯ setuid æ–‡ä»¶ 1;46 é’åº• ç²—ä½“é»‘è‰²ï¼Œé’è‰²èƒŒæ™¯ setgid æ–‡ä»¶ 1;42 ç»¿åº• ç²—ä½“é»‘è‰²ï¼Œç»¿è‰²èƒŒæ™¯ ç²˜æ»ä½ç›®å½• æ–‡ä»¶ç±»å‹æ ‡è¯†ç¬¦ ä»£ç  æ–‡ä»¶ç±»å‹ è¯´æ˜ ç¤ºä¾‹ di ç›®å½• Directory /home/user/ ln ç¬¦å·é“¾æ¥ Symbolic Link link -\u0026gt; target so Socket æ–‡ä»¶ Socket /run/service.sock pi å‘½åç®¡é“ FIFO/Named Pipe pipe.fifo ex å¯æ‰§è¡Œæ–‡ä»¶ Executable script.sh bd å—è®¾å¤‡ Block Device /dev/sda cd å­—ç¬¦è®¾å¤‡ Character Device /dev/tty su setuid æ–‡ä»¶ Set UID /usr/bin/passwd sg setgid æ–‡ä»¶ Set GID /usr/bin/wall tw ç²˜æ»ä½ç›®å½• Sticky Bit Directory /tmp/ ow å…¶ä»–å¯å†™ç›®å½• Other Writable Directory /var/www/ *.ext æ‰©å±•ååŒ¹é… æŒ‰æ–‡ä»¶æ‰©å±•å *.txt, *.jpg é¢œè‰²ä»£ç æ ¼å¼ 1 2 3 4 5 6 7 # åŸºæœ¬æ ¼å¼ TYPE=STYLE;FOREGROUND;BACKGROUND # ç¤ºä¾‹ di=1;34 # ç›®å½•ï¼šç²—ä½“è“è‰²æ–‡æœ¬ *.txt=1;32 # txtæ–‡ä»¶ï¼šç²—ä½“ç»¿è‰²æ–‡æœ¬ *.jpg=1;35 # jpgæ–‡ä»¶ï¼šç²—ä½“ç´«è‰²æ–‡æœ¬ æ ·å¼ä»£ç  ä»£ç  æ ·å¼ 0 æ­£å¸¸æ ·å¼ 1 ç²—ä½“ 4 ä¸‹åˆ’çº¿ 5 é—ªçƒ 7 åæ˜¾ 8 éšè— é¢œè‰²ä»£ç è¡¨ ä»£ç  å‰æ™¯è‰² èƒŒæ™¯è‰² 30 é»‘è‰² 40 31 çº¢è‰² 41 32 ç»¿è‰² 42 33 é»„è‰² 43 34 è“è‰² 44 35 ç´«è‰² 45 36 é’è‰² 46 37 ç™½è‰² 47 39 é»˜è®¤å‰æ™¯è‰² 49 ğŸ¨ ä¸‰ã€è‡ªå®šä¹‰é¢œè‰²æ–¹æ¡ˆ 1. åŸºç¡€é¢œè‰²æ–¹æ¡ˆ 1 2 # ç®€æ´æ˜äº†çš„é¢œè‰²æ–¹æ¡ˆ export LS_COLORS=\u0026#39;di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:*.tar=31:*.tgz=31:*.zip=31:*.gz=31:*.bz2=31:*.deb=31:*.rpm=31:*.jpg=35:*.png=35:*.gif=35:*.mp4=35:*.mp3=35:\u0026#39; 2. é«˜çº§é¢œè‰²æ–¹æ¡ˆ 1 2 # æ›´è¯¦ç»†çš„æ–‡ä»¶ç±»å‹åŒºåˆ† export LS_COLORS=\u0026#39;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:\u0026#39; 3. æš—è‰²ä¸»é¢˜æ–¹æ¡ˆ 1 2 # é€‚åˆæš—è‰²ç»ˆç«¯çš„æ–¹æ¡ˆ export LS_COLORS=\u0026#39;di=1;36:ln=1;35:so=1;32:pi=1;33:ex=1;31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=34;42:*.c=1;33:*.h=1;33:*.py=1;33:*.js=1;33:*.html=1;33:*.css=1;33:*.json=1;33:\u0026#39; 4. é«˜å¯¹æ¯”åº¦æ–¹æ¡ˆ 1 2 # é€‚åˆè§†åŠ›ä¸ä½³ç”¨æˆ·çš„é«˜å¯¹æ¯”åº¦æ–¹æ¡ˆ export LS_COLORS=\u0026#39;di=1;37;44:ln=1;37;46:so=1;37;45:pi=1;37;43:ex=1;37;42:bd=1;37;44:cd=1;37;44:su=1;37;41:sg=1;30;47:tw=1;30;42:ow=1;37;44:*.txt=1;37:*.sh=1;32:*.py=1;33:*.js=1;33:*.html=1;33:*.css=1;33:*.jpg=1;35:*.png=1;35:*.gif=1;35:*.mp4=1;35:*.mp3=1;36:\u0026#39; âš™ï¸ å››ã€ç³»ç»Ÿçº§é…ç½® 1. å…¨å±€é…ç½®ï¼ˆæ‰€æœ‰ç”¨æˆ·ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 # ç¼–è¾‘å…¨å±€é…ç½®æ–‡ä»¶ sudo nano /etc/bash.bashrc # æ·»åŠ ä»¥ä¸‹å†…å®¹ if [ -x /usr/bin/dircolors ]; then test -r ~/.dircolors \u0026amp;\u0026amp; eval \u0026#34;$(dircolors -b ~/.dircolors)\u0026#34; || eval \u0026#34;$(dircolors -b)\u0026#34; alias ls=\u0026#39;ls --color=auto\u0026#39; alias grep=\u0026#39;grep --color=auto\u0026#39; alias fgrep=\u0026#39;fgrep --color=auto\u0026#39; alias egrep=\u0026#39;egrep --color=auto\u0026#39; fi 2. ä½¿ç”¨ dircolors é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # ç”Ÿæˆé»˜è®¤é…ç½® dircolors -p \u0026gt; ~/.dircolors # ç¼–è¾‘è‡ªå®šä¹‰é…ç½® nano ~/.dircolors # åº”ç”¨é…ç½® eval \u0026#34;$(dircolors -b ~/.dircolors)\u0026#34; # æŸ¥çœ‹é»˜è®¤é…ç½®å†…å®¹ cat ~/.dircolors | head -20 3. ä¸ºä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒæ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 # åœ¨ç”¨æˆ·å®¶ç›®å½•åˆ›å»ºä¸ªæ€§åŒ–é…ç½® cat \u0026gt; ~/.ls_colors \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # ä¸ªæ€§åŒ– LS_COLORS é…ç½® di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32 *.txt=1;37:*.sh=1;32:*.py=1;33:*.js=1;33 *.jpg=1;35:*.png=1;35:*.gif=1;35 *.mp4=1;35:*.mp3=1;36:*.flac=1;36 EOF # åœ¨ .bashrc ä¸­å¼•ç”¨ echo \u0026#39;export LS_COLORS=$(cat ~/.ls_colors | tr -d \u0026#34;\\n\u0026#34;)\u0026#39; \u0026gt;\u0026gt; ~/.bashrc ğŸ”§ äº”ã€å…¶ä»–ç›¸å…³é…ç½® 1. ä¸ºå…¶ä»–å‘½ä»¤å¯ç”¨é¢œè‰² 1 2 3 4 5 6 7 8 9 10 11 12 13 # åœ¨ ~/.bashrc ä¸­æ·»åŠ  alias grep=\u0026#39;grep --color=auto\u0026#39; alias fgrep=\u0026#39;fgrep --color=auto\u0026#39; alias egrep=\u0026#39;egrep --color=auto\u0026#39; alias ip=\u0026#39;ip -color=auto\u0026#39; # å¯¹äº diff å‘½ä»¤ alias diff=\u0026#39;diff --color=auto\u0026#39; # å¯¹äº ls çš„æ›´å¤šåˆ«å alias ll=\u0026#39;ls -alF\u0026#39; alias la=\u0026#39;ls -A\u0026#39; alias l=\u0026#39;ls -CF\u0026#39; 2. æ ‘çŠ¶æ˜¾ç¤ºå¸¦é¢œè‰² 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£… tree å‘½ä»¤ sudo apt install tree # ä½¿ç”¨å½©è‰² tree alias tree=\u0026#39;tree -C\u0026#39; # æ°¸ä¹…ç”Ÿæ•ˆ echo \u0026#34;alias tree=\u0026#39;tree -C\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc # ä½¿ç”¨ç¤ºä¾‹ tree -L 2 /home 3. å½©è‰² man é¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¯ç”¨å½©è‰² man é¡µé¢ export LESS_TERMCAP_mb=$\u0026#39;\\E[1;31m\u0026#39; # å¼€å§‹é—ªçƒ export LESS_TERMCAP_md=$\u0026#39;\\E[1;36m\u0026#39; # å¼€å§‹ç²—ä½“ export LESS_TERMCAP_me=$\u0026#39;\\E[0m\u0026#39; # ç»“æŸæ¨¡å¼ export LESS_TERMCAP_so=$\u0026#39;\\E[01;44;33m\u0026#39; # å¼€å§‹çªå‡ºæ˜¾ç¤º export LESS_TERMCAP_se=$\u0026#39;\\E[0m\u0026#39; # ç»“æŸçªå‡ºæ˜¾ç¤º export LESS_TERMCAP_us=$\u0026#39;\\E[1;32m\u0026#39; # å¼€å§‹ä¸‹åˆ’çº¿ export LESS_TERMCAP_ue=$\u0026#39;\\E[0m\u0026#39; # ç»“æŸä¸‹åˆ’çº¿ # æ·»åŠ åˆ° ~/.bashrc cat \u0026gt;\u0026gt; ~/.bashrc \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; # å½©è‰² man é¡µé¢ export LESS_TERMCAP_mb=$\u0026#39;\\E[1;31m\u0026#39; export LESS_TERMCAP_md=$\u0026#39;\\E[1;36m\u0026#39; export LESS_TERMCAP_me=$\u0026#39;\\E[0m\u0026#39; export LESS_TERMCAP_so=$\u0026#39;\\E[01;44;33m\u0026#39; export LESS_TERMCAP_se=$\u0026#39;\\E[0m\u0026#39; export LESS_TERMCAP_us=$\u0026#39;\\E[1;32m\u0026#39; export LESS_TERMCAP_ue=$\u0026#39;\\E[0m\u0026#39; EOF 4. å½©è‰²æç¤ºç¬¦ 1 2 3 4 5 # åœ¨ ~/.bashrc ä¸­æ·»åŠ å½©è‰²æç¤ºç¬¦ PS1=\u0026#39;\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[00m\\]\\$ \u0026#39; # æ›´å¤æ‚çš„æç¤ºç¬¦ PS1=\u0026#39;\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[00m\\]$(git branch 2\u0026gt;/dev/null | grep -e ^* | sed -E \u0026#34;s/^\\* (.+)$/ \\[\\033[01;33m\\](\\1)\\[\\033[00m\\]/\u0026#34;)\\$ \u0026#39; ğŸ› å…­ã€æ•…éšœæ’é™¤ 1. é¢œè‰²ä¸æ˜¾ç¤º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥ç»ˆç«¯æ˜¯å¦æ”¯æŒé¢œè‰² echo $TERM # åº”è¯¥æ˜¾ç¤º: xterm-256color æˆ–ç±»ä¼¼ # å¼ºåˆ¶å¯ç”¨é¢œè‰² export TERM=xterm-256color # æ£€æŸ¥æ˜¯å¦è®¾ç½®äº† NO_COLOR ç¯å¢ƒå˜é‡ echo $NO_COLOR # å¦‚æœè®¾ç½®äº†ï¼Œå–æ¶ˆè®¾ç½® unset NO_COLOR # æ£€æŸ¥ ls å‘½ä»¤æ˜¯å¦æ”¯æŒé¢œè‰² ls --color=always | head -5 2. é¢œè‰²é…ç½®æ— æ•ˆ 1 2 3 4 5 6 7 8 9 10 11 # é‡æ–°åŠ è½½é…ç½® source ~/.bashrc # æ£€æŸ¥åˆ«å alias ls # æ£€æŸ¥å˜é‡ echo $LS_COLORS # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–é…ç½®è¦†ç›– grep -n \u0026#34;LS_COLORS\\|alias ls\u0026#34; ~/.bashrc ~/.profile ~/.bash_profile 3. æ¢å¤é»˜è®¤è®¾ç½® 1 2 3 4 5 6 7 8 9 10 # åˆ é™¤è‡ªå®šä¹‰é…ç½® sed -i \u0026#39;/LS_COLORS/d\u0026#39; ~/.bashrc sed -i \u0026#39;/alias ls/d\u0026#39; ~/.bashrc # é‡æ–°åŠ è½½ source ~/.bashrc # æˆ–è€…ä½¿ç”¨é»˜è®¤å€¼ export LS_COLORS=\u0026#34;\u0026#34; alias ls=\u0026#39;ls --color=auto\u0026#39; 4. ç»ˆç«¯å…¼å®¹æ€§é—®é¢˜ 1 2 3 4 5 6 7 8 # å¯¹äºæŸäº›ç»ˆç«¯ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„è®¾ç½® if [ \u0026#34;$TERM\u0026#34; = \u0026#34;dumb\u0026#34; ]; then alias ls=\u0026#39;ls --color=never\u0026#39; alias grep=\u0026#39;grep --color=never\u0026#39; else alias ls=\u0026#39;ls --color=auto\u0026#39; alias grep=\u0026#39;grep --color=auto\u0026#39; fi ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ 1. ä¸´æ—¶æµ‹è¯•é¢œè‰²æ–¹æ¡ˆ 1 2 3 4 5 # ä¸´æ—¶è®¾ç½®è€Œä¸ä¿®æ”¹é…ç½®æ–‡ä»¶ LS_COLORS=\u0026#39;di=1;34:ln=1;36:ex=1;32\u0026#39; ls -la # æµ‹è¯•ç‰¹å®šæ–‡ä»¶ç±»å‹ LS_COLORS=\u0026#39;*.sh=1;32:*.py=1;33:*.js=1;33\u0026#39; ls -la 2. æŸ¥çœ‹æ‰€æœ‰é¢œè‰²ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„é¢œè‰²ä»£ç  for i in {0..255}; do printf \u0026#34;\\e[48;5;%sm%3d\\e[0m \u0026#34; $i $i if (( (i + 1) % 16 == 0 )); then printf \u0026#34;\\n\u0026#34; fi done # æˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„ç‰ˆæœ¬ echo -e \u0026#34;\\e[0mNC (No color)\u0026#34; echo -e \u0026#34;\\e[1;37mBold White\\e[0m\u0026#34; echo -e \u0026#34;\\e[1;31mBold Red\\e[0m\u0026#34; echo -e \u0026#34;\\e[1;32mBold Green\\e[0m\u0026#34; echo -e \u0026#34;\\e[1;33mBold Yellow\\e[0m\u0026#34; echo -e \u0026#34;\\e[1;34mBold Blue\\e[0m\u0026#34; echo -e \u0026#34;\\e[1;35mBold Purple\\e[0m\u0026#34; echo -e \u0026#34;\\e[1;36mBold Cyan\\e[0m\u0026#34; 3. åˆ›å»ºé¢œè‰²æµ‹è¯•è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºæµ‹è¯•æ–‡ä»¶ mkdir -p /tmp/color-test cd /tmp/color-test touch {file.txt,script.sh,image.jpg,archive.tar.gz,music.mp3} chmod +x script.sh ln -s file.txt link.txt mkfifo pipe.fifo # æµ‹è¯•é¢œè‰²æ˜¾ç¤º ls -la # æ¸…ç†æµ‹è¯•æ–‡ä»¶ cd .. rm -rf /tmp/color-test 4. å¯¼å‡ºå’Œå¯¼å…¥é…ç½® 1 2 3 4 5 6 7 8 # å¯¼å‡ºå½“å‰ LS_COLORS é…ç½® echo $LS_COLORS \u0026gt; ls_colors_backup.txt # ä»æ–‡ä»¶å¯¼å…¥é…ç½® export LS_COLORS=$(cat ls_colors_backup.txt) # åˆ†äº«é…ç½®ç»™å…¶ä»–ç”¨æˆ· echo \u0026#34;export LS_COLORS=\u0026#39;$LS_COLORS\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/shared_ls_colors.sh ğŸŒŸ å…«ã€é¢œè‰²æ–¹æ¡ˆæ¨è 1. ç¨‹åºå‘˜ä¸“ç”¨æ–¹æ¡ˆ 1 export LS_COLORS=\u0026#39;di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:bd=1;34:cd=1;34:su=1;41:sg=1;46:tw=1;42:ow=1;33:*.c=1;33:*.h=1;33:*.cpp=1;33:*.hpp=1;33:*.py=1;33:*.js=1;33:*.html=1;33:*.css=1;33:*.json=1;33:*.xml=1;33:*.yml=1;33:*.yaml=1;33:*.md=1;33:*.txt=1;37:*.conf=1;33:\u0026#39; 2. å¤šåª’ä½“æ–¹æ¡ˆ 1 export LS_COLORS=\u0026#39;di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:*.jpg=1;35:*.jpeg=1;35:*.png=1;35:*.gif=1;35:*.bmp=1;35:*.mp4=1;35:*.avi=1;35:*.mkv=1;35:*.mov=1;35:*.mp3=1;36:*.flac=1;36:*.wav=1;36:*.ogg=1;36:*.aac=1;36:\u0026#39; 3. æ–‡æ¡£æ–¹æ¡ˆ 1 export LS_COLORS=\u0026#39;di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:*.pdf=1;31:*.doc=1;31:*.docx=1;31:*.xls=1;31:*.xlsx=1;31:*.ppt=1;31:*.pptx=1;31:*.odt=1;31:*.ods=1;31:*.odp=1;31:*.txt=1;37:*.rtf=1;37:*.tex=1;33:\u0026#39; 4. æœåŠ¡å™¨ç®¡ç†æ–¹æ¡ˆ 1 export LS_COLORS=\u0026#39;di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:*.conf=1;33:*.cfg=1;33:*.ini=1;33:*.yml=1;33:*.yaml=1;33:*.json=1;33:*.xml=1;33:*.log=1;37:*.sql=1;33:*.db=1;33:*.sh=1;32:*.py=1;33:*.pl=1;33:\u0026#39; 5. ç®€çº¦æ–¹æ¡ˆ 1 export LS_COLORS=\u0026#39;di=34:ln=36:so=35:pi=33:ex=32:*.txt=37:*.sh=32:*.py=33:*.js=33:*.html=33:*.css=33:*.jpg=35:*.png=35:*.gif=35:*.mp4=35:*.mp3=36:\u0026#39; ğŸ¯ æç¤º: é€‰æ‹©é€‚åˆæ‚¨å·¥ä½œç±»å‹çš„é¢œè‰²æ–¹æ¡ˆï¼Œå¯ä»¥è®©æ–‡ä»¶ç®¡ç†æ›´åŠ é«˜æ•ˆã€‚å»ºè®®å®šæœŸè°ƒæ•´å’Œä¼˜åŒ–æ‚¨çš„é¢œè‰²é…ç½®ã€‚\né€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåˆ›å»ºå‡ºæ—¢ç¾è§‚åˆå®ç”¨çš„ç»ˆç«¯é¢œè‰²æ–¹æ¡ˆã€‚è®°å¾—æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´é¢œè‰²ä»£ç ï¼Œæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„é…ç½®ã€‚\n","date":"2024-12-07T15:02:53+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e0809497/","title":"Linux ç»ˆç«¯æ–‡ä»¶åˆ—è¡¨ç€è‰²æ–¹æ¡ˆ ğŸŒˆ"},{"content":"Docker é•œåƒåŠ é€Ÿé…ç½®æŒ‡å— ğŸ³ ğŸš€ ä¸€é”®è§£å†³ Docker é•œåƒæ‹‰å–ç¼“æ…¢é—®é¢˜ï¼Œæå‡å®¹å™¨éƒ¨ç½²æ•ˆç‡ã€‚æœ¬æŒ‡å—æä¾›å…¨é¢çš„ Docker é•œåƒåŠ é€Ÿé…ç½®æ–¹æ¡ˆï¼Œæ¶µç›–å¤šç§ç³»ç»Ÿå’Œç¯å¢ƒï¼âœ¨\nğŸ“– å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ§ Linux ä¸€é”®é…ç½® ğŸ”§ æ‰‹åŠ¨é…ç½® Docker é•œåƒæº ğŸ–¥ï¸ OpenWRT Docker é…ç½® ğŸ” è·å–æœ€æ–°é•œåƒæºåœ°å€ ğŸ’¡ ä½¿ç”¨å»ºè®® ğŸš¨ å¸¸è§é—®é¢˜ ğŸ“Š é•œåƒæºæ¨èåˆ—è¡¨ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ Docker é•œåƒåŠ é€Ÿé…ç½®æä¾›ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸŒ å…¨çƒåŠ é€Ÿ - å¤šä¸ªå›½å†…ä¼˜è´¨é•œåƒæºï¼Œå¤§å¹…æå‡æ‹‰å–é€Ÿåº¦ ğŸ› ï¸ å¤šå¹³å°æ”¯æŒ - æ”¯æŒ Linuxã€Windowsã€macOSã€OpenWRT ç­‰ç³»ç»Ÿ âš¡ ä¸€é”®é…ç½® - æä¾›è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œç®€åŒ–é…ç½®æµç¨‹ ğŸ”„ å®æ—¶æ›´æ–° - é•œåƒæºåœ°å€æŒç»­ç»´æŠ¤æ›´æ–° ğŸ“Š é€Ÿåº¦ä¼˜é€‰ - æ™ºèƒ½é€‰æ‹©æœ€å¿«é•œåƒèŠ‚ç‚¹ ğŸ†“ å®Œå…¨å…è´¹ - æ‰€æœ‰é•œåƒæœåŠ¡å‡å…è´¹ä½¿ç”¨ ğŸ”’ å®‰å…¨å¯é  - å®˜æ–¹å’Œå¯ä¿¡ç¬¬ä¸‰æ–¹é•œåƒæºï¼Œä¿è¯å®‰å…¨æ€§ ğŸ“ˆ æ€§èƒ½ç›‘æ§ - å¯ç›‘æ§é•œåƒæ‹‰å–é€Ÿåº¦å’ŒæˆåŠŸç‡ ğŸ§ Linux ä¸€é”®é…ç½®é•œåƒåŠ é€Ÿ å®˜æ–¹ç½‘ç«™ï¼šhttps://linuxmirrors.cn/ ğŸ‡¨ğŸ‡³ ä¸­å›½å¤§é™†ç”¨æˆ· 1 2 3 4 5 # ä½¿ç”¨å®˜æ–¹ä¸€é”®é…ç½®è„šæœ¬ bash \u0026lt;(curl -sSL https://linuxmirrors.cn/main.sh) # æˆ–è€…ä½¿ç”¨å¤‡ç”¨ä¸‹è½½æ–¹å¼ bash \u0026lt;(wget -qO- https://linuxmirrors.cn/main.sh) ğŸ“ ä¸­å›½å¤§é™†æ•™è‚²ç½‘ç”¨æˆ· 1 2 # æ•™è‚²ç½‘ä¸“ç”¨ä¼˜åŒ–è„šæœ¬ bash \u0026lt;(curl -sSL https://linuxmirrors.cn/main.sh) --edu ğŸ”§ é«˜çº§é€‰é¡¹ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é€‰é¡¹ bash \u0026lt;(curl -sSL https://linuxmirrors.cn/main.sh) --help # æŒ‡å®šç‰¹å®šé•œåƒæº bash \u0026lt;(curl -sSL https://linuxmirrors.cn/main.sh) --source tuna # ä»…æµ‹è¯•ä¸å®é™…æ›´æ”¹é…ç½® bash \u0026lt;(curl -sSL https://linuxmirrors.cn/main.sh) --test ğŸ”§ æ‰‹åŠ¨é…ç½® Docker é•œåƒæº JSON é…ç½®æ–‡ä»¶ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://dockerpull.org\u0026#34;, \u0026#34;https://docker.1panel.dev\u0026#34;, \u0026#34;https://docker.fxxk.dedyn.io\u0026#34;, \u0026#34;https://docker.xn--6oq72ry9d5zx.cn\u0026#34;, \u0026#34;https://docker.zhai.cm\u0026#34;, \u0026#34;https://docker.5z5f.com\u0026#34;, \u0026#34;https://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://mirror.baidubce.com\u0026#34;, \u0026#34;https://registry.docker-cn.com\u0026#34; ], \u0026#34;max-concurrent-downloads\u0026#34;: 10, \u0026#34;log-level\u0026#34;: \u0026#34;warn\u0026#34;, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34; } ğŸ“ é…ç½®å‘½ä»¤ï¼ˆLinuxç³»ç»Ÿï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # åˆ›å»ºé…ç½®ç›®å½• sudo mkdir -p /etc/docker # å¤‡ä»½ç°æœ‰é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ sudo cp /etc/docker/daemon.json /etc/docker/daemon.json.bak 2\u0026gt;/dev/null || true # åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶ sudo tee /etc/docker/daemon.json \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://dockerpull.org\u0026#34;, \u0026#34;https://docker.1panel.dev\u0026#34;, \u0026#34;https://docker.fxxk.dedyn.io\u0026#34;, \u0026#34;https://docker.xn--6oq72ry9d5zx.cn\u0026#34;, \u0026#34;https://docker.zhai.cm\u0026#34;, \u0026#34;https://docker.5z5f.com\u0026#34; ] } EOF # é‡å¯DockeræœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ sudo systemctl daemon-reload sudo systemctl restart docker # éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ docker info | grep -A 10 \u0026#34;Registry Mirrors\u0026#34; # æµ‹è¯•é•œåƒæ‹‰å–é€Ÿåº¦ time docker pull hello-world ğŸ–¥ï¸ macOS é…ç½® 1 2 3 4 5 6 7 8 9 10 # é€šè¿‡Docker Desktopç•Œé¢é…ç½®ï¼š # 1. æ‰“å¼€Docker Desktop # 2. è¿›å…¥Preferences â†’ Docker Engine # 3. ç¼–è¾‘registry-mirrorsé…ç½® # 4. ç‚¹å‡»Apply \u0026amp; Restart # æˆ–è€…ç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶ nano ~/.docker/daemon.json # æ·»åŠ é•œåƒæºé…ç½®åé‡å¯Docker ğŸªŸ Windows é…ç½® 1 2 3 4 5 6 7 8 # é€šè¿‡Docker Desktopç•Œé¢é…ç½®ï¼š # 1. å³é”®ç‚¹å‡»ç³»ç»Ÿæ‰˜ç›˜ä¸­çš„Dockerå›¾æ ‡ # 2. é€‰æ‹©Settings â†’ Docker Engine # 3. ç¼–è¾‘registry-mirrorsé…ç½® # 4. ç‚¹å‡»Apply \u0026amp; Restart # æˆ–è€…ä½¿ç”¨PowerShell notepad \u0026#34;$env:USERPROFILE\\.docker\\daemon.json\u0026#34; ğŸ–¥ï¸ OpenWRT Docker é•œåƒé…ç½® Web ç•Œé¢é…ç½® ç™»å½• OpenWRT ç®¡ç†ç•Œé¢ è¿›å…¥\u0026quot;æœåŠ¡\u0026quot; â†’ \u0026ldquo;Docker\u0026rdquo; â†’ \u0026ldquo;é…ç½®\u0026rdquo; åœ¨\u0026quot;é•œåƒåŠ é€Ÿå™¨\u0026quot;å­—æ®µä¸­æ·»åŠ é•œåƒæºåœ°å€ ä¿å­˜å¹¶åº”ç”¨é…ç½® å‘½ä»¤è¡Œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # ç¼–è¾‘Dockeré…ç½®æ–‡ä»¶ vim /etc/docker/daemon.json # æ·»åŠ é•œåƒæºé…ç½® { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.zhai.cm\u0026#34;, \u0026#34;https://dockerpull.org\u0026#34; ] } # é‡å¯DockeræœåŠ¡ /etc/init.d/dockerd restart ğŸ” è·å–æœ€æ–°é•œåƒæºåœ°å€ ğŸŒ æ–¹æ³•ä¸€ï¼šç½‘é¡µæŸ¥è¯¢ å›½é™…æºæ›´æ–°ï¼š https://github.com/dongyubin/DockerHub å›½å†…æºæ›´æ–°ï¼š https://www.wangdu.site/course/2109.html å®˜æ–¹æ–‡æ¡£ï¼š https://docs.docker.com/registry/recipes/mirror/ ğŸ’» æ–¹æ³•äºŒï¼šç»ˆç«¯å‘½ä»¤æŸ¥è¯¢ 1 2 3 4 5 6 7 # ä½¿ç”¨å°é›…å¤§ç¤¼åŒ…è„šæœ¬æµ‹è¯•é•œåƒæºé€Ÿåº¦ bash -c \u0026#34;$(curl --insecure -fsSL https://ddsrem.com/xiaoya_install.sh)\u0026#34; # æŒ‰ç…§æç¤ºé€‰æ‹©ï¼š9 â†’ 6ï¼Œæµ‹è¯•å¹¶é€‰æ‹©æœ€å¿«é•œåƒæº # æˆ–è€…ä½¿ç”¨ä¸“ç”¨æµ‹è¯•è„šæœ¬ curl -sSL https://cdn.jsdelivr.net/gh/docker-practice/docker-registry-mirror@master/test.sh | bash ğŸ”§ æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨æµ‹è¯•é•œåƒæºé€Ÿåº¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºæµ‹è¯•è„šæœ¬ cat \u0026gt; test-mirror-speed.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash mirrors=( \u0026#34;https://dockerpull.org\u0026#34; \u0026#34;https://docker.1panel.dev\u0026#34; \u0026#34;https://docker.zhai.cm\u0026#34; \u0026#34;https://hub-mirror.c.163.com\u0026#34; \u0026#34;https://mirror.baidubce.com\u0026#34; ) for mirror in \u0026#34;${mirrors[@]}\u0026#34;; do echo \u0026#34;æµ‹è¯•é•œåƒæº: $mirror\u0026#34; time docker pull --registry-mirror=$mirror hello-world 2\u0026gt;/dev/null | grep \u0026#34;real\u0026#34; docker rmi hello-world \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 echo \u0026#34;-------------------\u0026#34; done EOF chmod +x test-mirror-speed.sh ./test-mirror-speed.sh ğŸ’¡ ä½¿ç”¨å»ºè®® 1. å¤šæºé…ç½®ç­–ç•¥ 1 2 3 4 5 6 7 8 # é…ç½®å¤šä¸ªé•œåƒæºï¼ŒDockerä¼šæŒ‰é¡ºåºå°è¯• { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.zhai.cm\u0026#34;, # ä¸»é•œåƒæº \u0026#34;https://dockerpull.org\u0026#34;, # å¤‡ç”¨é•œåƒæº1 \u0026#34;https://hub-mirror.c.163.com\u0026#34; # å¤‡ç”¨é•œåƒæº2 ] } 2. ç½‘ç»œä¼˜åŒ–è®¾ç½® 1 2 3 4 5 6 7 8 9 # åœ¨daemon.jsonä¸­æ·»åŠ æ€§èƒ½ä¼˜åŒ–é…ç½® { \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://docker.zhai.cm\u0026#34;], \u0026#34;max-concurrent-downloads\u0026#34;: 10, \u0026#34;max-concurrent-uploads\u0026#34;: 5, \u0026#34;log-level\u0026#34;: \u0026#34;warn\u0026#34;, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;live-restore\u0026#34;: true } 3. å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 7 8 # å®šæœŸæ¸…ç†æ— ç”¨é•œåƒ docker system prune -af # æ£€æŸ¥é•œåƒæºçŠ¶æ€ docker info | grep -i mirror # æ›´æ–°é•œåƒæºåˆ—è¡¨ curl -sSL https://linuxmirrors.cn/main.sh | bash -s -- --update 4. æ•…éšœè½¬ç§»ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨å¥åº·æ£€æŸ¥è„šæœ¬ç›‘æ§é•œåƒæºçŠ¶æ€ cat \u0026gt; check-mirror-health.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash MIRROR=\u0026#34;https://docker.zhai.cm\u0026#34; if curl --connect-timeout 5 -s $MIRROR \u0026gt; /dev/null; then echo \u0026#34;$MIRROR æ­£å¸¸\u0026#34; else echo \u0026#34;$MIRROR å¼‚å¸¸ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨é•œåƒæº\u0026#34; # è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨é•œåƒæºçš„é€»è¾‘ fi EOF ğŸš¨ å¸¸è§é—®é¢˜ â“ é…ç½®åä¸ç”Ÿæ•ˆæ€ä¹ˆåŠï¼Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€ sudo systemctl status docker # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• sudo docker --config /etc/docker --validate # æŸ¥çœ‹è¯¦ç»†æ—¥å¿— sudo journalctl -u docker.service -n 50 # é‡æ–°åŠ è½½é…ç½® sudo systemctl daemon-reload sudo systemctl restart docker â“ å¦‚ä½•æµ‹è¯•é•œåƒæºé€Ÿåº¦ï¼Ÿ 1 2 3 4 5 6 7 8 # ä½¿ç”¨timeå‘½ä»¤æµ‹è¯•æ‹‰å–é€Ÿåº¦ time docker pull hello-world # ä½¿ç”¨ä¸“ç”¨æµ‹é€Ÿå·¥å…· docker run --rm registry.cn-hangzhou.aliyuncs.com/acs/mirror-speed-test # æµ‹è¯•ç‰¹å®šé•œåƒæº docker pull --registry-mirror=https://docker.zhai.cm hello-world â“ é•œåƒæºå¤±æ•ˆæ€ä¹ˆåŠï¼Ÿ ä»ä¸Šè¿°è·å–æ–¹æ³•ä¸­æŸ¥æ‰¾æœ€æ–°å¯ç”¨é•œåƒæº ç§»é™¤å¤±æ•ˆé•œåƒæºï¼Œæ·»åŠ æ–°é•œåƒæº é‡å¯DockeræœåŠ¡ æ¸…ç†æœ¬åœ°ç¼“å­˜ï¼šdocker system prune -af â“ ä¼ä¸šå†…ç½‘å¦‚ä½•é…ç½®ï¼Ÿ 1 2 3 4 5 6 7 8 9 # æ­å»ºç§æœ‰é•œåƒä»“åº“ docker run -d -p 5000:5000 --restart=always --name registry registry:2 # é…ç½®å†…ç½‘é•œåƒåŠ é€Ÿ { \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;http://ä¼ä¸šå†…éƒ¨é•œåƒä»“åº“:5000\u0026#34;] } # ä½¿ç”¨Nexusæˆ–Harboræ­å»ºä¼ä¸šçº§é•œåƒä»“åº“ â“ å¦‚ä½•éªŒè¯é•œåƒæºçš„å®‰å…¨æ€§ï¼Ÿ 1 2 3 4 5 6 7 8 # æ£€æŸ¥é•œåƒç­¾å docker trust inspect --pretty image:tag # ä½¿ç”¨å®‰å…¨æ‰«æå·¥å…· docker scan image:tag # åªä½¿ç”¨å¯ä¿¡çš„é•œåƒæº # å®šæœŸæ›´æ–°å®‰å…¨ç­–ç•¥ ğŸ“Š é•œåƒæºæ¨èåˆ—è¡¨ é•œåƒæºåç§° åœ°å€ ç¨³å®šæ€§ é€Ÿåº¦ æ¨èæŒ‡æ•° Dockerä¸­å›½ https://docker.zhai.cm â­â­â­â­ â­â­â­â­ â­â­â­â­â­ 1Panel https://docker.1panel.dev â­â­â­â­ â­â­â­â­ â­â­â­â­â­ DockerPull https://dockerpull.org â­â­â­â­ â­â­â­â­ â­â­â­â­â­ ç½‘æ˜“èœ‚å·¢ https://hub-mirror.c.163.com â­â­â­â­ â­â­â­â­ â­â­â­â­ ç™¾åº¦äº‘ https://mirror.baidubce.com â­â­â­â­ â­â­â­â­ â­â­â­â­ é˜¿é‡Œäº‘ https://.mirror.aliyuncs.com â­â­â­â­â­ â­â­â­â­â­ â­â­â­â­â­ è…¾è®¯äº‘ https://mirror.ccs.tencentyun.com â­â­â­â­â­ â­â­â­â­â­ â­â­â­â­â­ ğŸ¢ ä¼ä¸šçº§é•œåƒæº é˜¿é‡Œäº‘ï¼šéœ€ç™»å½•æ§åˆ¶å°è·å–ä¸“å±åŠ é€Ÿå™¨åœ°å€ è…¾è®¯äº‘ï¼šéœ€åœ¨å®¹å™¨æœåŠ¡ä¸­è·å–ä¸“å±åŠ é€Ÿå™¨åœ°å€ åä¸ºäº‘ï¼šhttps://.swr.myhuaweicloud.com å¾®è½¯äº‘ï¼šhttps://azure.microsoft.com/en-us/services/container-registry/ ğŸŒ å›½é™…é•œåƒæº Docker Hubï¼šhttps://hub.docker.com/ (é»˜è®¤) Google Container Registryï¼šhttps://gcr.io Amazon ECRï¼šhttps://aws.amazon.com/ecr/ GitHub Container Registryï¼šhttps://ghcr.io ğŸ’¡ æç¤ºï¼šé•œåƒæºåœ°å€å¯èƒ½ä¼šéšæ—¶é—´å˜åŒ–ï¼Œå»ºè®®å®šæœŸæ›´æ–°é•œåƒæºåˆ—è¡¨ä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚å¦‚é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯å°è¯•åˆ‡æ¢ä¸åŒçš„é•œåƒæºã€‚\nHappy Dockerizing! ğŸ‰ ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼\n","date":"2024-12-07T15:01:20+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/670f627d/","title":"Docker é•œåƒåŠ é€Ÿé…ç½®æŒ‡å— ğŸ³"},{"content":"Proxmox VE æ–°ç¡¬ç›˜æ·»åŠ ä¸é…ç½® ğŸ’¾ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ PVE ç³»ç»Ÿä¸­æ·»åŠ æ–°ç¡¬ç›˜ï¼ŒåŒ…æ‹¬åˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½å’Œè‡ªåŠ¨æŒ‚è½½é…ç½®ï¼Œä»¥åŠå¦‚ä½•å°†å…¶é›†æˆåˆ° PVE å­˜å‚¨ç³»ç»Ÿä¸­ã€‚ğŸš€\nğŸ“– å¯¼èˆªç›®å½• ğŸ” æŸ¥çœ‹ç°æœ‰ç¡¬ç›˜ ğŸ› ï¸ ç¡¬ç›˜åˆ†åŒº ğŸ’½ æ ¼å¼åŒ–ç¡¬ç›˜ ğŸ“‚ æŒ‚è½½ç¡¬ç›˜ ğŸ”„ é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ ğŸ—‘ï¸ å–æ¶ˆæŒ‚è½½ âš™ï¸ é«˜çº§é…ç½® ğŸ”§ PVE å­˜å‚¨é…ç½® âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ’¡ å®Œæ•´æ“ä½œç¤ºä¾‹ ğŸ” ä¸€ã€æŸ¥çœ‹ç°æœ‰ç¡¬ç›˜ 1. æŸ¥çœ‹æ‰€æœ‰ç¡¬ç›˜ä¿¡æ¯ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰å—è®¾å¤‡çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŒ‚è½½ç‚¹å’Œæ–‡ä»¶ç³»ç»Ÿ lsblk -f # æŸ¥çœ‹æ›´è¯¦ç»†çš„è®¾å¤‡æ ‘ lsblk -o NAME,SIZE,TYPE,MOUNTPOINT,FSTYPE,LABEL,UUID # åªæ˜¾ç¤ºç£ç›˜è®¾å¤‡ï¼ˆæ’é™¤åˆ†åŒºå’Œå¾ªç¯è®¾å¤‡ï¼‰ lsblk -d -o NAME,SIZE,TYPE,MODEL,SERIAL 2. è¯¦ç»†ç¡¬ç›˜ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ˜¾ç¤ºæ‰€æœ‰ç¡¬ç›˜çš„è¯¦ç»†åˆ†åŒºä¿¡æ¯ fdisk -l # æŸ¥çœ‹ç‰¹å®šç¡¬ç›˜è¯¦æƒ… fdisk -l /dev/sda # ä½¿ç”¨ parted æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯ parted -l # æŸ¥çœ‹ç¡¬ç›˜å‹å·å’Œåºåˆ—å· hdparm -i /dev/sda | grep -E \u0026#34;Model|Serial\u0026#34; # æ£€æŸ¥ç¡¬ç›˜å¥åº·çŠ¶æ€ smartctl -a /dev/sda | grep -E \u0026#34;Model|Serial|Temperature|Reallocated|Pending|Uncorrectable\u0026#34; 3. è¯†åˆ«æ–°ç¡¬ç›˜ 1 2 3 4 5 6 7 8 9 # æ¯”è¾ƒæ’å…¥æ–°ç¡¬ç›˜å‰åçš„è®¾å¤‡åˆ—è¡¨ ls /dev/sd* \u0026gt; /tmp/before.txt # æ’å…¥ç¡¬ç›˜å ls /dev/sd* \u0026gt; /tmp/after.txt diff /tmp/before.txt /tmp/after.txt # æˆ–è€…æŸ¥çœ‹å†…æ ¸æ—¥å¿—è¯†åˆ«æ–°è®¾å¤‡ dmesg | grep -i sd tail -f /var/log/syslog | grep -i attached ğŸ› ï¸ äºŒã€ç¡¬ç›˜åˆ†åŒº 1. è¿›å…¥ fdisk åˆ†åŒºå·¥å…· 1 2 # å¯¹æ–°ç¡¬ç›˜è¿›è¡Œåˆ†åŒºï¼ˆä»¥ /dev/sdb ä¸ºä¾‹ï¼‰ fdisk /dev/sdb 2. fdisk å¸¸ç”¨å‘½ä»¤ åœ¨ fdisk äº¤äº’ç•Œé¢ä¸­ï¼š\nå‘½ä»¤ è¯´æ˜ ä¸­æ–‡è§£é‡Š m æ˜¾ç¤ºå¸®åŠ©èœå• åˆ—å‡ºæ‰€æœ‰å¯ç”¨å‘½ä»¤ p æ‰“å°å½“å‰åˆ†åŒºè¡¨ æ˜¾ç¤ºç°æœ‰åˆ†åŒºæƒ…å†µ n åˆ›å»ºæ–°åˆ†åŒº æ–°å»ºä¸€ä¸ªåˆ†åŒº p åˆ›å»ºä¸»åˆ†åŒº åˆ›å»ºä¸»åˆ†åŒºï¼ˆæœ€å¤š4ä¸ªï¼‰ e åˆ›å»ºæ‰©å±•åˆ†åŒº åˆ›å»ºæ‰©å±•åˆ†åŒº l åˆ—å‡ºåˆ†åŒºç±»å‹ æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„åˆ†åŒºç±»å‹ d åˆ é™¤åˆ†åŒº åˆ é™¤æŒ‡å®šåˆ†åŒº t æ”¹å˜åˆ†åŒºç±»å‹ ä¿®æ”¹åˆ†åŒºç±»å‹ w ä¿å­˜å¹¶é€€å‡º ä¿å­˜æ›´æ”¹å¹¶é€€å‡º q ä¸ä¿å­˜é€€å‡º æ”¾å¼ƒæ›´æ”¹å¹¶é€€å‡º 3. åˆ›å»ºåˆ†åŒºæ­¥éª¤ 1 2 3 4 5 6 7 # åœ¨ fdisk ä¸­çš„æ“ä½œé¡ºåºï¼š 1. è¾“å…¥ `n` # åˆ›å»ºæ–°åˆ†åŒº 2. è¾“å…¥ `p` # é€‰æ‹©ä¸»åˆ†åŒº 3. æŒ‰å›è½¦ # ä½¿ç”¨é»˜è®¤åˆ†åŒºå· (1) 4. æŒ‰å›è½¦ # ä½¿ç”¨é»˜è®¤èµ·å§‹æ‰‡åŒº 5. æŒ‰å›è½¦ # ä½¿ç”¨æ‰€æœ‰å¯ç”¨ç©ºé—´ 6. è¾“å…¥ `w` # ä¿å­˜å¹¶é€€å‡º 4. ä½¿ç”¨ parted è¿›è¡Œé«˜çº§åˆ†åŒº 1 2 3 4 5 6 7 8 # å¯¹äºå¤§äº2TBçš„ç¡¬ç›˜ï¼Œä½¿ç”¨ parted parted /dev/sdb # åœ¨ parted ä¸­çš„æ“ä½œï¼š (parted) mklabel gpt # åˆ›å»º GPT åˆ†åŒºè¡¨ (parted) mkpart primary 0% 100% # åˆ›å»ºå ç”¨æ•´ä¸ªç£ç›˜çš„åˆ†åŒº (parted) print # æ‰“å°åˆ†åŒºä¿¡æ¯ (parted) quit # é€€å‡º 5. ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–åˆ†åŒº 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨ sfdisk è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†åŒº echo \u0026#39;type=83\u0026#39; | sfdisk /dev/sdb # æˆ–è€…åˆ›å»ºæ›´å¤æ‚çš„åˆ†åŒºæ–¹æ¡ˆ cat \u0026gt; partition.sfdisk \u0026lt;\u0026lt; EOF label: gpt ,10G,LVM ,20G ,+ EOF sfdisk /dev/sdb \u0026lt; partition.sfdisk ğŸ’½ ä¸‰ã€æ ¼å¼åŒ–ç¡¬ç›˜ 1. æ ¼å¼åŒ–åˆ†åŒº 1 2 3 4 5 6 7 8 # æ ¼å¼åŒ–ä¸º ext4 æ–‡ä»¶ç³»ç»Ÿ mkfs -t ext4 /dev/sdb1 # æˆ–è€…ä½¿ç”¨æ›´è¯¦ç»†çš„å‘½ä»¤ mkfs.ext4 /dev/sdb1 # å¯¹äºå¤§å®¹é‡ç¡¬ç›˜ï¼Œå¯ä»¥ä½¿ç”¨æ›´å¤§çš„inodeæ¯”ä¾‹ mkfs.ext4 -i 2048 /dev/sdb1 2. æ ¼å¼åŒ–é€‰é¡¹ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 # æ·»åŠ å·æ ‡ mkfs.ext4 -L \u0026#34;pve_data\u0026#34; /dev/sdb1 # è®¾ç½®ä¿ç•™å—æ¯”ä¾‹ä¸º 0%ï¼ˆæœ€å¤§åŒ–å¯ç”¨ç©ºé—´ï¼‰ mkfs.ext4 -m 0 /dev/sdb1 # ä½¿ç”¨ç‰¹å®šå—å¤§å°ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ mkfs.ext4 -b 4096 /dev/sdb1 # å¼ºåˆ¶æ ¼å¼åŒ–ï¼ˆå³ä½¿è®¾å¤‡å·²æŒ‚è½½ï¼‰ mkfs.ext4 -F /dev/sdb1 3. å…¶ä»–æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ 1 2 3 4 5 6 7 8 # æ ¼å¼åŒ–ä¸º XFS æ–‡ä»¶ç³»ç»Ÿï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰ mkfs.xfs -f /dev/sdb1 # æ ¼å¼åŒ–ä¸º Btrfs æ–‡ä»¶ç³»ç»Ÿï¼ˆé«˜çº§ç‰¹æ€§ï¼‰ mkfs.btrfs -f /dev/sdb1 # æ ¼å¼åŒ–ä¸º NTFS æ–‡ä»¶ç³»ç»Ÿï¼ˆWindows å…¼å®¹ï¼‰ mkfs.ntfs -f /dev/sdb1 4. éªŒè¯æ ¼å¼åŒ– 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ blkid /dev/sdb1 # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ tune2fs -l /dev/sdb1 | head -20 # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§ fsck -f /dev/sdb1 # æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼ˆæ ¼å¼åŒ–åï¼‰ df -h /dev/sdb1 ğŸ“‚ å››ã€æŒ‚è½½ç¡¬ç›˜ 1. åˆ›å»ºæŒ‚è½½ç‚¹ 1 2 3 4 5 6 7 8 # åˆ›å»ºæŒ‚è½½ç›®å½• mkdir -p /mnt/sdb1 # æˆ–è€…ä½¿ç”¨æ›´æœ‰æ„ä¹‰çš„åç§° mkdir -p /mnt/pve-data # åˆ›å»ºå¤šå±‚ç›®å½•ç»“æ„ mkdir -p /mnt/storage/{backup,iso,template,images} 2. æ‰‹åŠ¨æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŒ‚è½½åˆ†åŒºåˆ°ç›®å½• mount -t ext4 /dev/sdb1 /mnt/sdb1 # ä½¿ç”¨ç‰¹å®šæŒ‚è½½é€‰é¡¹ mount -t ext4 -o noatime,nodiratime /dev/sdb1 /mnt/sdb1 # éªŒè¯æŒ‚è½½ df -h /mnt/sdb1 # æŸ¥çœ‹è¯¦ç»†æŒ‚è½½ä¿¡æ¯ mount | grep sdb1 # æ£€æŸ¥ç›®å½•æƒé™ ls -ld /mnt/sdb1 3. è®¾ç½®æƒé™ 1 2 3 4 5 6 7 8 9 10 11 12 # è®¾ç½®åˆé€‚çš„æƒé™ chmod 755 /mnt/sdb1 chown root:root /mnt/sdb1 # åˆ›å»ºå¸¸ç”¨å­ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -p /mnt/sdb1/{backup,iso,template,images} chmod 755 /mnt/sdb1/* chown root:root /mnt/sdb1/* # ä¸ºç‰¹å®šç”¨æˆ·æˆ–ç»„è®¾ç½®æƒé™ chown -R nobody:nogroup /mnt/sdb1/backup chmod 770 /mnt/sdb1/backup ğŸ”„ äº”ã€é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ 1. ç¼–è¾‘ fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 # å¤‡ä»½åŸæœ‰ fstab æ–‡ä»¶ cp /etc/fstab /etc/fstab.backup.$(date +%Y%m%d) # æ·»åŠ è‡ªåŠ¨æŒ‚è½½é…ç½®åˆ° /etc/fstab echo \u0026#39;/dev/sdb1 /mnt/sdb1 ext4 defaults,nofail,x-systemd.device-timeout=15s 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab # æˆ–è€…ä½¿ç”¨ UUIDï¼ˆæ¨èï¼‰ UUID=$(blkid -s UUID -o value /dev/sdb1) echo \u0026#34;UUID=$UUID /mnt/sdb1 ext4 defaults,nofail,x-systemd.device-timeout=15s 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab 2. fstab å‚æ•°è§£é‡Š 1 2 3 4 5 6 7 8 # é…ç½®é¡¹è¯´æ˜ï¼š # /dev/sdb1 æˆ– UUID=... - è®¾å¤‡è·¯å¾„æˆ–å”¯ä¸€æ ‡è¯† # /mnt/sdb1 - æŒ‚è½½ç‚¹ # ext4 - æ–‡ä»¶ç³»ç»Ÿç±»å‹ # defaults - é»˜è®¤æŒ‚è½½é€‰é¡¹ # nofail - å¯åŠ¨æ—¶å¦‚æœè®¾å¤‡ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ # x-systemd.device-timeout=15s - è®¾å¤‡è¶…æ—¶æ—¶é—´ # 0 0 - dump å’Œ fsck é€‰é¡¹ 3. å…¶ä»–æœ‰ç”¨çš„æŒ‚è½½é€‰é¡¹ 1 2 3 4 5 6 7 8 # æ€§èƒ½ä¼˜åŒ–é€‰é¡¹ defaults,noatime,nodiratime,data=writeback # å®‰å…¨é€‰é¡¹ defaults,nosuid,nodev,noexec # ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿé€‰é¡¹ defaults,_netdev,auto 4. æµ‹è¯• fstab é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # æµ‹è¯• fstab é…ç½®æ˜¯å¦æ­£ç¡® mount -a # å¦‚æœå‡ºç°é”™è¯¯ï¼Œæ£€æŸ¥å¹¶ä¿®å¤ mount -a 2\u0026gt;\u0026amp;1 | grep -i error # éªŒè¯è‡ªåŠ¨æŒ‚è½½ umount /mnt/sdb1 systemctl daemon-reload systemctl restart local-fs.target # æ£€æŸ¥å¯åŠ¨æ—¶æŒ‚è½½ systemctl status local-fs.target ğŸ—‘ï¸ å…­ã€å–æ¶ˆæŒ‚è½½ 1. å®‰å…¨å¸è½½ 1 2 3 4 5 6 7 8 9 10 11 12 # å¸è½½åˆ†åŒº umount /dev/sdb1 # æˆ–è€…é€šè¿‡æŒ‚è½½ç‚¹å¸è½½ umount /mnt/sdb1 # æ£€æŸ¥æ˜¯å¦å¸è½½æˆåŠŸ df -h | grep sdb1 # æŸ¥çœ‹å“ªäº›è¿›ç¨‹æ­£åœ¨ä½¿ç”¨æŒ‚è½½ç‚¹ lsof /mnt/sdb1 fuser -vm /mnt/sdb1 2. å¼ºåˆ¶å¸è½½ï¼ˆå¦‚æœéœ€è¦ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 # å¦‚æœè®¾å¤‡å¿™ï¼Œå¼ºåˆ¶å¸è½½ umount -f /mnt/sdb1 # æˆ–è€…ä½¿ç”¨ lazy unmount umount -l /mnt/sdb1 # ç»ˆæ­¢ä½¿ç”¨æŒ‚è½½ç‚¹çš„è¿›ç¨‹ fuser -km /mnt/sdb1 # ç„¶åå†æ¬¡å°è¯•å¸è½½ umount /mnt/sdb1 3. ä» fstab ä¸­ç§»é™¤é…ç½® 1 2 3 4 5 6 7 # ç§»é™¤ fstab ä¸­çš„æŒ‚è½½é…ç½® sed -i \u0026#39;/\\/mnt\\/sdb1/d\u0026#39; /etc/fstab # æˆ–è€…å¤‡ä»½å¹¶ç¼–è¾‘æ–‡ä»¶ cp /etc/fstab /etc/fstab.modified vi /etc/fstab.modified mv /etc/fstab.modified /etc/fstab âš™ï¸ ä¸ƒã€é«˜çº§é…ç½® 1. ä½¿ç”¨ UUID æŒ‚è½½ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 # è·å–åˆ†åŒºçš„ UUID blkid /dev/sdb1 # ä½¿ç”¨ UUID æ›¿æ¢è®¾å¤‡è·¯å¾„ UUID=$(blkid -s UUID -o value /dev/sdb1) echo \u0026#34;UUID=$UUID /mnt/sdb1 ext4 defaults,nofail 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab # éªŒè¯ UUID æŒ‚è½½ umount /mnt/sdb1 mount -U $UUID /mnt/sdb1 2. æŒ‚è½½é€‰é¡¹ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 # æ€§èƒ½ä¼˜åŒ–æŒ‚è½½é€‰é¡¹ cat \u0026gt;\u0026gt; /etc/fstab \u0026lt;\u0026lt; EOF /dev/sdb1 /mnt/sdb1 ext4 defaults,noatime,nodiratime,data=writeback,commit=60 0 0 EOF # é‡æ–°æŒ‚è½½åº”ç”¨æ–°é€‰é¡¹ mount -o remount /mnt/sdb1 # æ£€æŸ¥å½“å‰æŒ‚è½½é€‰é¡¹ mount | grep sdb1 3. åˆ›å»ºç¬¦å·é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºæ–¹ä¾¿çš„ç¬¦å·é“¾æ¥ ln -sf /mnt/sdb1 /pve-data # éªŒè¯é“¾æ¥ ls -la /pve-data # ä¸ºä¸åŒç”¨é€”åˆ›å»ºå¤šä¸ªé“¾æ¥ ln -sf /mnt/sdb1/backup /pve-backup ln -sf /mnt/sdb1/iso /pve-iso ln -sf /mnt/sdb1/template /pve-template 4. é…ç½®ç£ç›˜è°ƒåº¦å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å½“å‰è°ƒåº¦å™¨ cat /sys/block/sdb/queue/scheduler # ä¿®æ”¹è°ƒåº¦å™¨ï¼ˆä¾‹å¦‚æ”¹ä¸º deadlineï¼‰ echo deadline \u0026gt; /sys/block/sdb/queue/scheduler # æ°¸ä¹…ä¿®æ”¹è°ƒåº¦å™¨ echo \u0026#39;ACTION==\u0026#34;add|change\u0026#34;, KERNEL==\u0026#34;sdb\u0026#34;, ATTR{queue/scheduler}=\u0026#34;deadline\u0026#34;\u0026#39; \u0026gt; /etc/udev/rules.d/60-ioscheduler.rules # é‡æ–°åŠ è½½ udev è§„åˆ™ udevadm control --reload-rules udevadm trigger ğŸ”§ å…«ã€PVE å­˜å‚¨é…ç½® 1. æ·»åŠ ä¸º PVE å­˜å‚¨ï¼ˆWeb ç•Œé¢ï¼‰ ç™»å½• PVE Web ç®¡ç†ç•Œé¢ é€‰æ‹©æ•°æ®ä¸­å¿ƒ â†’ å­˜å‚¨ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; â†’ \u0026ldquo;ç›®å½•\u0026rdquo; å¡«å†™ä¿¡æ¯ï¼š ID: sdb1-storageï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰ ç›®å½•: /mnt/sdb1 å†…å®¹: é€‰æ‹©éœ€è¦çš„ç±»å‹ï¼ˆç£ç›˜é•œåƒã€ISOã€å¤‡ä»½ç­‰ï¼‰ èŠ‚ç‚¹: é€‰æ‹©å¯ç”¨èŠ‚ç‚¹æˆ–æ‰€æœ‰èŠ‚ç‚¹ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; 2. å‘½ä»¤è¡Œæ·»åŠ å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨å‘½ä»¤è¡Œæ·»åŠ å­˜å‚¨ pvesm add dir sdb1-storage --path /mnt/sdb1 --content images,iso,backup # æ·»åŠ ç‰¹å®šç±»å‹çš„å­˜å‚¨ pvesm add dir sdb1-images --path /mnt/sdb1/images --content images pvesm add dir sdb1-iso --path /mnt/sdb1/iso --content iso pvesm add dir sdb1-backup --path /mnt/sdb1/backup --content backup # éªŒè¯å­˜å‚¨æ·»åŠ  pvesm status pvesm list 3. é…ç½®å­˜å‚¨é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®å­˜å‚¨é€‰é¡¹ pvesm set sdb1-storage --maxfiles 0 # ä¸é™åˆ¶æ–‡ä»¶æ•° # æŸ¥çœ‹å­˜å‚¨é…ç½® pvesm config sdb1-storage # å¯ç”¨å…±äº«å­˜å‚¨ pvesm set sdb1-storage --shared 1 # è®¾ç½®å­˜å‚¨æƒé™ pvesm set sdb1-storage --nodes node1,node2 4. ä½¿ç”¨å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»ºè™šæ‹Ÿæœºå¹¶ä½¿ç”¨æ–°å­˜å‚¨ qm create 100 --name test-vm --storage sdb1-storage # ä¸Šä¼  ISO é•œåƒåˆ°å­˜å‚¨ qm importdisk 100 /path/to/iso.iso sdb1-storage # å¤‡ä»½è™šæ‹Ÿæœºåˆ°æ–°å­˜å‚¨ vzdump 100 --storage sdb1-backup # æŸ¥çœ‹å­˜å‚¨ä½¿ç”¨æƒ…å†µ pvesm status df -h /mnt/sdb1 âš ï¸ ä¹ã€æ³¨æ„äº‹é¡¹ 1. å®‰å…¨è­¦å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 # ä¸è¦æŒ‚è½½ç³»ç»Ÿå…³é”®ç›®å½• # ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™ # å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº· # æ£€æŸ¥ç£ç›˜å¥åº· smartctl -a /dev/sdb # ç›‘æ§ç£ç›˜æ¸©åº¦ smartctl -A /dev/sdb | grep -i temperature # å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ fsck -n /dev/sdb1 2. æ€§èƒ½è€ƒè™‘ 1 2 3 4 5 6 7 8 9 10 # å¯¹äº SSD ç¡¬ç›˜ï¼Œä½¿ç”¨é€‚å½“çš„æŒ‚è½½é€‰é¡¹ echo noop \u0026gt; /sys/block/sdb/queue/scheduler # SSD è°ƒåº¦å™¨ echo 0 \u0026gt; /proc/sys/vm/dirty_background_ratio echo 0 \u0026gt; /proc/sys/vm/dirty_ratio # å¯ç”¨ TRIMï¼ˆSSD ä¸“ç”¨ï¼‰ fstrim /mnt/sdb1 # å®šæœŸæ¸…ç†ç¼“å­˜ sync \u0026amp;\u0026amp; echo 3 \u0026gt; /proc/sys/vm/drop_caches 3. å¤‡ä»½é‡è¦æ•°æ® 1 2 3 4 5 6 7 8 # åœ¨æ“ä½œå‰å¤‡ä»½é‡è¦æ•°æ® tar -czf /root/fstab-backup-$(date +%Y%m%d).tar.gz /etc/fstab # å¤‡ä»½åˆ†åŒºè¡¨ sfdisk -d /dev/sdb \u0026gt; /root/sdb-partition-backup.txt # å®šæœŸå¤‡ä»½å­˜å‚¨é…ç½® pvesm status \u0026gt; /root/pve-storage-status-$(date +%Y%m%d).txt 4. ç›‘æ§å’Œç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®ç£ç›˜ç›‘æ§ echo \u0026#39;#!/bin/bash USAGE=$(df /mnt/sdb1 | awk \u0026#34;NR==2{print $5}\u0026#34; | sed \u0026#34;s/%//\u0026#34;) if [ $USAGE -gt 90 ]; then echo \u0026#34;è­¦å‘Š: ç£ç›˜ç©ºé—´ä¸è¶³ ${USAGE}%\u0026#34; | logger -t disk-monitor fi\u0026#39; \u0026gt; /usr/local/bin/disk-alert.sh chmod +x /usr/local/bin/disk-alert.sh # æ·»åŠ åˆ°è®¡åˆ’ä»»åŠ¡ echo \u0026#34;*/30 * * * * /usr/local/bin/disk-alert.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontab ğŸ’¡ åã€å®Œæ•´æ“ä½œç¤ºä¾‹ æ–°ç¡¬ç›˜åˆå§‹åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #!/bin/bash # PVE æ–°ç¡¬ç›˜åˆå§‹åŒ–è„šæœ¬ set -e DISK=\u0026#34;/dev/sdb\u0026#34; MOUNT_POINT=\u0026#34;/mnt/pve-data\u0026#34; STORAGE_ID=\u0026#34;pve-data\u0026#34; echo \u0026#34;æ­£åœ¨åˆå§‹åŒ–æ–°ç¡¬ç›˜ $DISK...\u0026#34; # 1. æ£€æŸ¥ç£ç›˜æ˜¯å¦å­˜åœ¨ if [ ! -b $DISK ]; then echo \u0026#34;é”™è¯¯: ç£ç›˜ $DISK ä¸å­˜åœ¨!\u0026#34; exit 1 fi # 2. åˆ†åŒº echo \u0026#34;åˆ›å»ºåˆ†åŒº...\u0026#34; echo -e \u0026#34;n\\np\\n1\\n\\n\\nw\u0026#34; | fdisk $DISK partprobe $DISK sleep 2 # 3. æ ¼å¼åŒ– echo \u0026#34;æ ¼å¼åŒ–åˆ†åŒº...\u0026#34; mkfs.ext4 -m 0 -L \u0026#34;pve_data\u0026#34; ${DISK}1 # 4. åˆ›å»ºæŒ‚è½½ç‚¹ echo \u0026#34;åˆ›å»ºæŒ‚è½½ç‚¹...\u0026#34; mkdir -p $MOUNT_POINT # 5. ä¸´æ—¶æŒ‚è½½ echo \u0026#34;ä¸´æ—¶æŒ‚è½½...\u0026#34; mount ${DISK}1 $MOUNT_POINT # 6. åˆ›å»ºå­ç›®å½• mkdir -p $MOUNT_POINT/{images,iso,backup,template} # 7. é…ç½®è‡ªåŠ¨æŒ‚è½½ echo \u0026#34;é…ç½®è‡ªåŠ¨æŒ‚è½½...\u0026#34; UUID=$(blkid -s UUID -o value ${DISK}1) echo \u0026#34;UUID=$UUID $MOUNT_POINT ext4 defaults,nofail,x-systemd.device-timeout=15s 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab # 8. æ·»åŠ ä¸º PVE å­˜å‚¨ echo \u0026#34;æ·»åŠ ä¸º PVE å­˜å‚¨...\u0026#34; pvesm add dir $STORAGE_ID --path $MOUNT_POINT --content images,iso,backup # 9. è®¾ç½®æƒé™ chmod 755 $MOUNT_POINT chown root:root $MOUNT_POINT echo \u0026#34;æ–°ç¡¬ç›˜åˆå§‹åŒ–å®Œæˆï¼\u0026#34; echo \u0026#34;æŒ‚è½½ç‚¹: $MOUNT_POINT\u0026#34; echo \u0026#34;å­˜å‚¨ ID: $STORAGE_ID\u0026#34; df -h $MOUNT_POINT pvesm status ä½¿ç”¨è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 # ä¸‹è½½è„šæœ¬ curl -O https://example.com/pve-disk-init.sh # èµ‹äºˆæ‰§è¡Œæƒé™ chmod +x pve-disk-init.sh # è¿è¡Œè„šæœ¬ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ ./pve-disk-init.sh # æˆ–è€…ç›´æ¥è¿è¡Œ bash pve-disk-init.sh éªŒè¯è„šæœ¬æ‰§è¡Œç»“æœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥æŒ‚è½½ df -h /mnt/pve-data # æ£€æŸ¥ fstab é…ç½® grep \u0026#34;pve-data\u0026#34; /etc/fstab # æ£€æŸ¥ PVE å­˜å‚¨ pvesm status pvesm list # æµ‹è¯•è‡ªåŠ¨æŒ‚è½½ umount /mnt/pve-data mount -a df -h /mnt/pve-data ğŸ¯ æç¤º: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ“ä½œå‰ï¼Œè¯·ç¡®ä¿å·²ç»å¤‡ä»½é‡è¦æ•°æ®ï¼Œå¹¶ç¡®è®¤æ“ä½œçš„æ˜¯æ­£ç¡®çš„ç¡¬ç›˜è®¾å¤‡ã€‚å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯è„šæœ¬å’Œæ“ä½œæµç¨‹ã€‚\né€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ¨ PVE ä¸­æ·»åŠ å’Œé…ç½®æ–°ç¡¬ç›˜ã€‚å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒç›¸å…³æ—¥å¿—æ–‡ä»¶æˆ–å¯»æ±‚ç¤¾åŒºå¸®åŠ©ã€‚\n","date":"2024-12-07T14:57:32+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/c9d812ef/","title":"Proxmox VE æ–°ç¡¬ç›˜æ·»åŠ ä¸é…ç½® ğŸ’¾"},{"content":"Proxmox VE è™šæ‹Ÿå†…å­˜ Swap å…¨é¢è§£æ ğŸ§ æ·±å…¥ç†è§£ Proxmox VE ä¸­ Swap è™šæ‹Ÿå†…å­˜çš„å·¥ä½œåŸç†ã€é…ç½®æ–¹æ³•å’Œä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ‚¨æ„å»ºæ›´ç¨³å®šé«˜æ•ˆçš„è™šæ‹ŸåŒ–ç¯å¢ƒï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ ä»€ä¹ˆæ˜¯ Swap è™šæ‹Ÿå†…å­˜ï¼Ÿ ğŸ› ï¸ ä¸€ã€åˆ é™¤ Swap è™šæ‹Ÿå†…å­˜ ğŸ› ï¸ äºŒã€åˆ›å»º Swap è™šæ‹Ÿå†…å­˜ ğŸ› ï¸ æ–‡ä»¶ä¸º Swap è™šæ‹Ÿå†…å­˜ ğŸ› ï¸ åˆ†åŒºä¸º Swap è™šæ‹Ÿå†…å­˜ âš™ï¸ ä¸‰ã€é…ç½®æ°¸ä¹…ç”Ÿæ•ˆ ğŸ¯ å››ã€Swap ç­–ç•¥ä¼˜åŒ– âš–ï¸ äº”ã€å¯ç”¨ Swap çš„ä¼˜ç¼ºç‚¹ ğŸš€ å…­ã€ä¼˜åŒ– Swap æ€§èƒ½çš„ç­–ç•¥ ğŸ“Š ä¸ƒã€Swap å¤§å°è§„åˆ’å»ºè®® ğŸ”§ å…«ã€é«˜çº§é…ç½®æŠ€å·§ ğŸš¨ ä¹ã€æ•…éšœæ’é™¤ä¸æ³¨æ„äº‹é¡¹ ğŸ“ˆ åã€ç›‘æ§ä¸ç»´æŠ¤ âœ¨ ä»€ä¹ˆæ˜¯ Swap è™šæ‹Ÿå†…å­˜ï¼Ÿ Swap è™šæ‹Ÿå†…å­˜æ˜¯ Linux ç³»ç»Ÿçš„ä¸€ç§å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå½“ç‰©ç†å†…å­˜ï¼ˆRAMï¼‰ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šå°†ä¸€éƒ¨åˆ†ä¸å¸¸ç”¨çš„å†…å­˜æ•°æ®æš‚æ—¶å­˜å‚¨åˆ°ç¡¬ç›˜ä¸Šçš„ç‰¹å®šåŒºåŸŸï¼ˆSwap ç©ºé—´ï¼‰ï¼Œä»è€Œé‡Šæ”¾ç‰©ç†å†…å­˜ä¾›æ›´ç´§æ€¥çš„ä»»åŠ¡ä½¿ç”¨ã€‚\nğŸ” å·¥ä½œåŸç† å†…å­˜æ‰©å±•ï¼šå°†ç¡¬ç›˜ç©ºé—´è™šæ‹Ÿä¸ºå†…å­˜ä½¿ç”¨ æ•°æ®äº¤æ¢ï¼šå°†ä¸æ´»è·ƒçš„å†…å­˜é¡µç§»åŠ¨åˆ° Swap ç©ºé—´ åº”æ€¥ä¿æŠ¤ï¼šé˜²æ­¢å†…å­˜è€—å°½å¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–è¿›ç¨‹è¢«ç»ˆæ­¢ å†…å­˜å‹ç¼©ï¼šç°ä»£ Linux å†…æ ¸è¿˜ä½¿ç”¨ zswap è¿›è¡Œå†…å­˜å‹ç¼©ï¼Œå‡å°‘å¯¹ç£ç›˜çš„ä¾èµ– ğŸ“Š å†…å­˜å±‚æ¬¡ç»“æ„å¯¹æ¯” å­˜å‚¨ç±»å‹ è®¿é—®é€Ÿåº¦ å®¹é‡ æˆæœ¬ ç”¨é€” CPU ç¼“å­˜ 1-10ns KB-MB æé«˜ å¤„ç†å™¨ç›´æ¥è®¿é—® å†…å­˜ (RAM) 10-100ns GB é«˜ æ´»åŠ¨æ•°æ®å’Œç¨‹åº Swap ç©ºé—´ 1-10ms GB ä½ ä¸æ´»åŠ¨å†…å­˜é¡µ ç¡¬ç›˜å­˜å‚¨ 5-20ms TB æä½ é•¿æœŸæ•°æ®å­˜å‚¨ ğŸ› ï¸ ä¸€ã€åˆ é™¤ Swap è™šæ‹Ÿå†…å­˜ 1. ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ Swap 1 swapoff -a 2. æ°¸ä¹…ç§»é™¤ /etc/fstab ä¸­çš„äº¤æ¢æ¡ç›® ç¼–è¾‘ /etc/fstab æ–‡ä»¶ï¼š\n1 nano /etc/fstab æ‰¾åˆ°å¹¶åˆ é™¤æˆ–æ³¨é‡Šæ‰ï¼ˆåœ¨è¡Œé¦–æ·»åŠ  #ï¼‰ä»¥ä¸‹ä¸¤è¡Œï¼š\n1 2 /dev/pve/swap none swap sw 0 0 /swapfile2 none swap sw 0 0 ä¿®æ”¹åçš„ç›¸å…³éƒ¨åˆ†åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š\n1 2 3 4 5 6 7 8 9 # \u0026lt;file system\u0026gt; \u0026lt;mount point\u0026gt; \u0026lt;type\u0026gt; \u0026lt;options\u0026gt; \u0026lt;dump\u0026gt; \u0026lt;pass\u0026gt; /dev/pve/root / ext4 errors=remount-ro 0 1 UUID=F49F-33B4 /boot/efi vfat defaults 0 1 #/dev/pve/swap none swap sw 0 0 proc /proc proc defaults 0 0 ## usb--ext4--/mnt/usb UUID=998ebf40-fb54-1444-ad98-b903a6809686 /mnt/usb ext4 nofail,x-systemd.device-timeout=15s 0 0 #/swapfile2 none swap sw 0 0 ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ï¼ˆåœ¨ nano ä¸­æŒ‰ Ctrl+Xï¼Œç„¶åæŒ‰ Y ç¡®è®¤ï¼Œæœ€åæŒ‰ Enterï¼‰ã€‚\n3. åˆ é™¤äº¤æ¢æ–‡ä»¶ åˆ é™¤æ‚¨åˆ›å»ºçš„äº¤æ¢æ–‡ä»¶ /swapfile2ï¼š\n1 rm -f /swapfile2 4. åˆ é™¤ LVM äº¤æ¢åˆ†åŒºï¼ˆå¯é€‰ä½†æ¨èï¼‰ è¦å®Œå…¨ç§»é™¤ LVM äº¤æ¢åˆ†åŒºå¹¶å›æ”¶å…¶ç©ºé—´ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\né¦–å…ˆç¡®è®¤å½“å‰çš„ LVM å¸ƒå±€ï¼š\n1 lvdisplay æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º swap çš„é€»è¾‘å·ï¼š\n1 2 3 4 5 6 7 8 9 --- Logical volume --- LV Path /dev/pve/swap LV Name swap VG Name pve LV UUID ... LV Write Access read/write LV Status available # open 0 LV Size 8.00 GiB åˆ é™¤äº¤æ¢é€»è¾‘å·ï¼š\n1 lvremove /dev/pve/swap ç³»ç»Ÿä¼šæç¤ºæ‚¨ç¡®è®¤åˆ é™¤ï¼Œè¾“å…¥ y å¹¶æŒ‰ Enterã€‚\nç°åœ¨æ‚¨å¯ä»¥å°†é‡Šæ”¾çš„ç©ºé—´åˆ†é…ç»™å…¶ä»–é€»è¾‘å·ã€‚æœ€åˆç†çš„é€‰æ‹©æ˜¯æ‰©å±•æ ¹åˆ†åŒºï¼š\n1 2 3 4 5 # æ‰©å±•æ ¹é€»è¾‘å·ï¼ˆä½¿ç”¨æ‰€æœ‰å¯ç”¨ç©ºé—´ï¼‰ lvextend -l +100%FREE /dev/pve/root # è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°ï¼ˆå‡è®¾æ˜¯ ext4ï¼‰ resize2fs /dev/pve/root 5. éªŒè¯æ›´æ”¹ ç¡®è®¤æ‰€æœ‰äº¤æ¢ç©ºé—´å·²è¢«ç§»é™¤ï¼š\n1 2 free -h swapon --show è¿™ä¸¤ä¸ªå‘½ä»¤åº”è¯¥æ˜¾ç¤ºæ²¡æœ‰ä»»ä½•äº¤æ¢ç©ºé—´è¢«æ¿€æ´»ã€‚\näºŒã€åˆ›å»º Swap è™šæ‹Ÿå†…å­˜ï¼ˆæ¨èç”¨äº PVEï¼‰ æ–¹æ³•ä¸€ã€æ–‡ä»¶ä¸º Swap è™šæ‹Ÿå†…å­˜ 1. åˆ›å»º Swap æ–‡ä»¶ 1 2 # åˆ›å»º 16GB çš„ Swap æ–‡ä»¶ dd if=/dev/zero of=/swapfile bs=1G count=16 status=progress status=progress å‚æ•°æ˜¾ç¤ºåˆ›å»ºè¿›åº¦ï¼Œé¿å…é•¿æ—¶é—´æ— å“åº”\n2. è®¾ç½®å®‰å…¨æƒé™ 1 chmod 0600 /swapfile ç¡®ä¿åªæœ‰ root ç”¨æˆ·å¯ä»¥è®¿é—®ï¼Œæé«˜å®‰å…¨æ€§\n3. æ ¼å¼åŒ– Swap æ–‡ä»¶ 1 mkswap /swapfile å°†æ–‡ä»¶æ ‡è®°ä¸º Swap ç©ºé—´\n4. å¯ç”¨ Swap 1 swapon /swapfile ç«‹å³æ¿€æ´» Swap æ–‡ä»¶\n5. éªŒè¯ Swap çŠ¶æ€ 1 2 free -h swapon --show æŸ¥çœ‹å†…å­˜å’Œ Swap ä½¿ç”¨æƒ…å†µ\næ–¹æ³•äºŒã€åˆ†åŒºä¸º Swap è™šæ‹Ÿå†…å­˜ 1. åˆ›å»º Swap åˆ†åŒº 1 2 3 # ä½¿ç”¨ fdisk æˆ– parted åˆ›å»ºæ–°åˆ†åŒº fdisk /dev/sdb # åœ¨ fdisk ä¸­: n â†’ p â†’ åˆ†åŒºå· â†’ èµ·å§‹æ‰‡åŒº â†’ ç»“æŸæ‰‡åŒº â†’ t â†’ 82 (Linux swap) â†’ w 2. æ ¼å¼åŒ– Swap åˆ†åŒº 1 mkswap /dev/sdb1 3. å¯ç”¨ Swap åˆ†åŒº 1 swapon /dev/sdb1 4. éªŒè¯ Swap çŠ¶æ€ 1 2 free -h cat /proc/swaps âš™ï¸ ä¸‰ã€é…ç½®æ°¸ä¹…ç”Ÿæ•ˆ 1. å¤‡ä»½ fstab æ–‡ä»¶ 1 cp /etc/fstab /etc/fstab.bak 2. æ·»åŠ è‡ªåŠ¨æŒ‚è½½é…ç½® 1 2 3 4 5 6 7 8 9 # å¯¹äº Swap æ–‡ä»¶ echo \u0026#39;/swapfile none swap sw 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab # å¯¹äº Swap åˆ†åŒº echo \u0026#39;/dev/sdb1 none swap sw 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab # æˆ–è€…ä½¿ç”¨ UUIDï¼ˆæ¨èï¼Œæ›´ç¨³å®šï¼‰ UUID=$(blkid -s UUID -o value /dev/sdb1) echo \u0026#34;UUID=$UUID none swap sw 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab 3. æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡® 1 2 3 4 5 6 7 8 9 # ç¦ç”¨æ‰€æœ‰ Swap swapoff -a # é‡æ–°å¯ç”¨æ‰€æœ‰ Swapï¼ˆæ ¹æ® fstabï¼‰ swapon -a # éªŒè¯ç»“æœ free -h swapon --show 4. æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨æ—¶ Swap åŠ è½½ 1 2 3 4 5 # æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¥å¿— dmesg | grep -i swap # æ£€æŸ¥ systemd æœåŠ¡çŠ¶æ€ systemctl status swap.target ğŸ¯ å››ã€Swap ç­–ç•¥ä¼˜åŒ–ï¼ˆSwappinessï¼‰ 1. ç†è§£ Swappiness Swappiness æ˜¯ Linux å†…æ ¸å‚æ•°ï¼Œæ§åˆ¶ç³»ç»Ÿä½¿ç”¨ Swap çš„å€¾å‘ç¨‹åº¦ï¼š\nå€¼èŒƒå›´ï¼š0-100 é»˜è®¤å€¼ï¼š60ï¼ˆå¤§å¤šæ•°å‘è¡Œç‰ˆï¼‰ ä½å€¼ (0-30)ï¼šå°½é‡é¿å…ä½¿ç”¨ Swap é«˜å€¼ (70-100)ï¼šç§¯æä½¿ç”¨ Swap 2. æŸ¥çœ‹å½“å‰ Swappiness å€¼ 1 2 3 4 5 6 7 cat /proc/sys/vm/swappiness # æˆ–è€… sysctl vm.swappiness # æŸ¥çœ‹æ‰€æœ‰å†…å­˜ç›¸å…³å‚æ•° sysctl -a | grep vm. 3. ä¸´æ—¶è°ƒæ•´ Swappiness 1 2 3 4 5 # æ–¹æ³• 1 sysctl vm.swappiness=10 # æ–¹æ³• 2 echo 10 \u0026gt; /proc/sys/vm/swappiness ä¸´æ—¶è°ƒæ•´é‡å¯åå¤±æ•ˆï¼Œé€‚åˆæµ‹è¯•ä¸åŒå€¼çš„æ•ˆæœ\n4. æ°¸ä¹…è°ƒæ•´ Swappiness 1 2 3 4 5 6 7 8 # ç¼–è¾‘ sysctl é…ç½®æ–‡ä»¶ echo \u0026#39;vm.swappiness=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf # æˆ–è€…åˆ›å»ºä¸“ç”¨é…ç½®æ–‡ä»¶ echo \u0026#39;vm.swappiness=10\u0026#39; \u0026gt; /etc/sysctl.d/99-swap.conf # ç«‹å³ç”Ÿæ•ˆ sysctl -p /etc/sysctl.d/99-swap.conf 5. Swappiness æ¨èå€¼ åœºæ™¯ æ¨èå€¼ è¯´æ˜ æ¡Œé¢ç³»ç»Ÿ 10-30 å‡å°‘å¡é¡¿ï¼Œæå‡å“åº”é€Ÿåº¦ æœåŠ¡å™¨ 10-20 ä¼˜å…ˆä½¿ç”¨ç‰©ç†å†…å­˜ æ•°æ®åº“æœåŠ¡å™¨ 1-10 æå°½é‡é¿å…ä½¿ç”¨ Swap å†…å­˜ä¸¥é‡ä¸è¶³ 60-80 ç§¯æä½¿ç”¨ Swap é¿å…å´©æºƒ PVE è™šæ‹ŸåŒ–ä¸»æœº 10-30 å¹³è¡¡è™šæ‹Ÿæœºæ€§èƒ½å’Œç¨³å®šæ€§ 6. ç›¸å…³å‚æ•°è°ƒæ•´ 1 2 3 4 5 6 7 # è°ƒæ•´è™šæ‹Ÿå†…å­˜ç®¡ç†å‚æ•° echo \u0026#39;vm.vfs_cache_pressure=50\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_ratio=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_background_ratio=5\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf # åº”ç”¨é…ç½® sysctl -p âš–ï¸ äº”ã€å¯ç”¨ Swap çš„ä¼˜ç¼ºç‚¹ âœ… ä¼˜ç‚¹ å†…å­˜æ‰©å±•ï¼šç¼“è§£ç‰©ç†å†…å­˜å‹åŠ› ç³»ç»Ÿç¨³å®šï¼šé˜²æ­¢å†…å­˜è€—å°½å¯¼è‡´ç³»ç»Ÿå´©æºƒ è¿›ç¨‹ä¿æŠ¤ï¼šé¿å…é‡è¦è¿›ç¨‹è¢« OOM Killer ç»ˆæ­¢ æˆæœ¬æ•ˆç›Šï¼šç”¨å»‰ä»·ç¡¬ç›˜ç©ºé—´æ‰©å±•æ˜‚è´µçš„å†…å­˜ ä¼‘çœ æ”¯æŒï¼šç³»ç»Ÿä¼‘çœ éœ€è¦ Swap ç©ºé—´ä¿å­˜å†…å­˜çŠ¶æ€ âŒ ç¼ºç‚¹ æ€§èƒ½ä¸‹é™ï¼šç¡¬ç›˜é€Ÿåº¦è¿œä½äºå†…å­˜ï¼ˆHDD: 100-200 IOPS, SSD: 10K-100K IOPS, RAM: æ•°ç™¾ä¸‡ IOPSï¼‰ ç¡¬ç›˜ç£¨æŸï¼šé¢‘ç¹äº¤æ¢æ“ä½œå¯èƒ½ç¼©çŸ­ SSD å¯¿å‘½ æ½œåœ¨é”™è¯¯ï¼šæç«¯æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´å†…å­˜ç›¸å…³é”™è¯¯ å“åº”å»¶è¿Ÿï¼šWindows è™šæ‹Ÿæœºä¼šæ˜æ˜¾å¡é¡¿ ç®¡ç†å¤æ‚åº¦ï¼šéœ€è¦åˆç†é…ç½®å’Œç›‘æ§ ğŸ“Š æ€§èƒ½å½±å“åˆ†æ 1 2 3 4 5 6 7 8 # æµ‹è¯•ç£ç›˜ I/O æ€§èƒ½ï¼ˆå½±å“ Swap æ€§èƒ½çš„å…³é”®å› ç´ ï¼‰ dd if=/dev/zero of=/tmp/test bs=8k count=1000000 # ç›‘æ§ Swap I/O iostat -xm 1 # æŸ¥çœ‹å†…å­˜å’Œ Swap ä½¿ç”¨è¶‹åŠ¿ vmstat 1 ğŸš€ å…­ã€ä¼˜åŒ– Swap æ€§èƒ½çš„ç­–ç•¥ 1. ä½¿ç”¨é«˜æ€§èƒ½å­˜å‚¨ 1 2 3 4 5 6 7 8 # ä¼˜å…ˆä½¿ç”¨ NVMe SSD åˆ›å»º Swap dd if=/dev/zero of=/mnt/nvme/swapfile bs=1G count=16 status=progress # æˆ–è€…ä½¿ç”¨ RAM diskï¼ˆä¸´æ—¶æ€§ï¼Œé‡å¯å¤±æ•ˆï¼‰ mount -t tmpfs -o size=2G tmpfs /mnt/tmpfs dd if=/dev/zero of=/mnt/tmpfs/swapfile bs=1G count=2 status=progress mkswap /mnt/tmpfs/swapfile swapon /mnt/tmpfs/swapfile 2. å¤šä¸ª Swap åŒºåŸŸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»ºå¤šä¸ª Swap æ–‡ä»¶ dd if=/dev/zero of=/swapfile1 bs=1G count=8 status=progress dd if=/dev/zero of=/swapfile2 bs=1G count=8 status=progress # åŒæ—¶å¯ç”¨ mkswap /swapfile1 mkswap /swapfile2 swapon /swapfile1 swapon /swapfile2 # æŸ¥çœ‹æ‰€æœ‰ Swap ç©ºé—´ swapon --show # è®¾ç½®ä¸åŒçš„ä¼˜å…ˆçº§ echo \u0026#39;/swapfile1 none swap sw,pri=100 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab echo \u0026#39;/swapfile2 none swap sw,pri=50 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab 3. è°ƒæ•´ Swap ä¼˜å…ˆçº§ 1 2 3 4 5 6 7 # åœ¨ /etc/fstab ä¸­è®¾ç½®ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ /swapfile1 none swap sw,pri=10 0 0 /swapfile2 none swap sw,pri=20 0 0 # æˆ–è€…ä½¿ç”¨è®¾å¤‡è·¯å¾„ /dev/sdb1 none swap sw,pri=10 0 0 /dev/sdc1 none swap sw,pri=20 0 0 4. ç›‘æ§ Swap ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®æ—¶ç›‘æ§ watch -n 1 \u0026#39;free -h; echo \u0026#34;Swappiness: $(cat /proc/sys/vm/swappiness)\u0026#34;\u0026#39; # æŸ¥çœ‹è¯¦ç»† Swap ä¿¡æ¯ cat /proc/swaps # ç›‘æ§ Swap I/O æ´»åŠ¨ iostat -xm 1 # æŸ¥çœ‹å“ªäº›è¿›ç¨‹ä½¿ç”¨ Swap smem -s swap -r # æˆ–è€…ä½¿ç”¨ for file in /proc/*/status; do awk \u0026#39;/VmSwap|Name/{printf $2 \u0026#34; \u0026#34; $3}END{ print \u0026#34;\u0026#34;}\u0026#39; $file done 2\u0026gt;/dev/null | sort -k 2 -n -r | head -10 ğŸ“Š ä¸ƒã€Swap å¤§å°è§„åˆ’å»ºè®® ç‰©ç†å†…å­˜å¤§å° æ¨è Swap å¤§å° è¯´æ˜ â‰¤ 2GB 2Ã— å†…å­˜ ä¼ ç»Ÿå»ºè®®ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ 2-8GB =å†…å­˜ å¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§ 8-64GB 4-16GB æœåŠ¡å™¨ç¯å¢ƒæ¨èå€¼ â‰¥ 64GB 4-8GB å¤§å†…å­˜ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºåº”æ€¥ ä¼‘çœ éœ€æ±‚ å†…å­˜å¤§å° + 10% ç³»ç»Ÿä¼‘çœ éœ€è¦è¶³å¤Ÿç©ºé—´ä¿å­˜å†…å­˜çŠ¶æ€ ğŸ’¡ PVE ç‰¹å®šå»ºè®® å¯¹äºè¿è¡Œå¤§é‡è™šæ‹Ÿæœºçš„ PVE ä¸»æœºï¼Œå»ºè®®é…ç½®ï¼š\næœ€å°: 4GB Swap æ¨è: 8-16GB Swap æœ€å¤§: ä¸è¶…è¿‡ 32GBï¼ˆé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼‰ ğŸ”¢ è®¡ç®—å…¬å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ ¹æ®å†…å­˜è®¡ç®—æ¨è Swap å¤§å° MEMORY_GB=$(free -g | awk \u0026#39;/Mem:/ {print $2}\u0026#39;) if [ $MEMORY_GB -le 2 ]; then SWAP_GB=$((MEMORY_GB * 2)) elif [ $MEMORY_GB -le 8 ]; then SWAP_GB=$MEMORY_GB elif [ $MEMORY_GB -le 64 ]; then SWAP_GB=16 else SWAP_GB=8 fi echo \u0026#34;æ¨è Swap å¤§å°: ${SWAP_GB}GB\u0026#34; ğŸ”§ å…«ã€é«˜çº§é…ç½®æŠ€å·§ 1. ä½¿ç”¨ ZRAMï¼ˆå†…å­˜å‹ç¼©ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å®‰è£… zram-tools apt install zram-tools # é…ç½® ZRAMï¼ˆç¼–è¾‘ /etc/default/zramswapï¼‰ PERCENTAGE=50 PRIORITY=100 ALGORITHM=lz4 # é‡å¯æœåŠ¡ systemctl restart zramswap # æŸ¥çœ‹çŠ¶æ€ zramctl # æˆ–è€…æ‰‹åŠ¨é…ç½® modprobe zram num_devices=1 echo 4G \u0026gt; /sys/block/zram0/disksize mkswap /dev/zram0 swapon /dev/zram0 -p 100 2. è°ƒæ•´ç¼“å­˜å‹åŠ› 1 2 3 4 5 6 7 8 # å‡å°‘ç¼“å­˜å‹åŠ›ï¼Œé™ä½ Swap ä½¿ç”¨ echo 50 \u0026gt; /proc/sys/vm/vfs_cache_pressure echo \u0026#39;vm.vfs_cache_pressure=50\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf # è°ƒæ•´è„é¡µå†™å›ç­–ç•¥ echo \u0026#39;vm.dirty_ratio=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_background_ratio=5\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.dirty_expire_centisecs=3000\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf 3. ç¦ç”¨ Swapï¼ˆç‰¹å®šåœºæ™¯ï¼‰ 1 2 3 4 5 6 7 8 # ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ Swap swapoff -a # æ°¸ä¹…ç¦ç”¨ï¼ˆç¼–è¾‘ /etc/fstabï¼Œæ³¨é‡Šæˆ–åˆ é™¤ Swap è¡Œï¼‰ sed -i \u0026#39;/swap/d\u0026#39; /etc/fstab # æˆ–è€…ä½¿ç”¨ swapoff å’Œ systemctl systemctl mask swap.target 4. åº”æ€¥å†…å­˜ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # æ‰‹åŠ¨é‡Šæ”¾ç¼“å­˜ echo 3 \u0026gt; /proc/sys/vm/drop_caches # ä»…é‡Šæ”¾é¡µç¼“å­˜ echo 1 \u0026gt; /proc/sys/vm/drop_caches # é‡Šæ”¾ç›®å½•é¡¹å’Œinodeç¼“å­˜ echo 2 \u0026gt; /proc/sys/vm/drop_caches # æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¯¦æƒ… cat /proc/meminfo 5. ä½¿ç”¨ Btrfs äº¤æ¢æ–‡ä»¶ 1 2 3 4 5 6 7 8 # åœ¨ Btrfs æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºäº¤æ¢æ–‡ä»¶ truncate -s 0 /swapfile chattr +C /swapfile btrfs property set /swapfile compression none dd if=/dev/zero of=/swapfile bs=1G count=16 status=progress chmod 0600 /swapfile mkswap /swapfile swapon /swapfile ğŸš¨ ä¹ã€æ•…éšœæ’é™¤ä¸æ³¨æ„äº‹é¡¹ 1. Swap åˆ›å»ºå¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥ç£ç›˜ç©ºé—´ df -h # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆæŸäº›æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒ Swapï¼‰ df -T # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§ï¼ˆå¦‚ç¨€ç–æ–‡ä»¶æ”¯æŒï¼‰ touch /testfile truncate -s 1G /testfile ls -lh /testfile # æ£€æŸ¥æ–‡ä»¶å¤§å° # å¯¹äº Btrfsï¼Œéœ€è¦ç‰¹æ®Šå¤„ç† btrfs filesystem df / 2. Swap æ— æ³•å¯ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /swapfile # æ£€æŸ¥æ–‡ä»¶ç³»ç»ŸæŒ‚è½½é€‰é¡¹ï¼ˆnoexec, nosuidï¼‰ mount | grep \u0026#34; / \u0026#34; # é‡æ–°æ ¼å¼åŒ– mkswap -f /swapfile # æ£€æŸ¥å†…æ ¸æ—¥å¿— dmesg | grep -i swap # æ£€æŸ¥ SELinux/AppArmor é™åˆ¶ ausearch -m avc -ts recent | grep swap 3. æ€§èƒ½é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹ Swap ä½¿ç”¨æƒ…å†µ vmstat 1 # æ£€æŸ¥å“ªäº›è¿›ç¨‹ä½¿ç”¨ Swap smem -s swap -r # æˆ–è€…ä½¿ç”¨ for file in /proc/*/status; do awk \u0026#39;/VmSwap|Name/{printf $2 \u0026#34; \u0026#34; $3}END{ print \u0026#34;\u0026#34;}\u0026#39; $file done 2\u0026gt;/dev/null | sort -k 2 -n -r | head -10 # ç›‘æ§ç£ç›˜ I/O iotop -o # æ£€æŸ¥å†…å­˜å‹åŠ› cat /proc/pressure/memory 4. å®‰å…¨æ³¨æ„äº‹é¡¹ é¿å…å°† Swap æ–‡ä»¶æ”¾åœ¨åŠ å¯†åˆ†åŒºï¼ˆæ€§èƒ½æå·®ï¼‰ å®šæœŸç›‘æ§ Swap ä½¿ç”¨æƒ…å†µï¼Œé¿å…è¿‡åº¦ä¾èµ– è€ƒè™‘åœ¨ç³»ç»Ÿä¼‘çœ æ—¶åŠ å¯† Swap å†…å®¹ ç¡®ä¿ Swap æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆ0600ï¼‰ åœ¨æ•æ„Ÿç¯å¢ƒä¸­è€ƒè™‘ç¦ç”¨ Swapï¼ˆé˜²æ­¢å†…å­˜æ•°æ®æ³„éœ²ï¼‰ 5. SSD ç‰¹æ®Šè€ƒè™‘ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ SSD ç£¨æŸæƒ…å†µ smartctl -A /dev/nvme0n1 | grep Wear_Level # ä¸º SSD è°ƒæ•´äº¤æ¢ç­–ç•¥ echo \u0026#39;vm.swappiness=10\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#39;vm.vfs_cache_pressure=50\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf # ä½¿ç”¨ fstrim å®šæœŸæ•´ç† systemctl enable fstrim.timer systemctl start fstrim.timer ğŸ“ˆ åã€ç›‘æ§ä¸ç»´æŠ¤ 1. åˆ›å»ºç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #!/bin/bash # swap_monitor.sh - ç›‘æ§ Swap ä½¿ç”¨æƒ…å†µ THRESHOLD=80 # è­¦å‘Šé˜ˆå€¼ç™¾åˆ†æ¯” LOG_FILE=\u0026#34;/var/log/swap_monitor.log\u0026#34; # è·å– Swap ä½¿ç”¨ç‡ swap_total=$(free | awk \u0026#39;/Swap/ {print $2}\u0026#39;) swap_used=$(free | awk \u0026#39;/Swap/ {print $3}\u0026#39;) if [ $swap_total -gt 0 ]; then swap_usage=$((swap_used * 100 / swap_total)) else swap_usage=0 fi echo \u0026#34;$(date): Swap ä½¿ç”¨ç‡: $swap_usage%\u0026#34; \u0026gt;\u0026gt; $LOG_FILE if [ $swap_usage -ge $THRESHOLD ]; then echo \u0026#34;$(date): è­¦å‘Š: Swap ä½¿ç”¨ç‡è¶…è¿‡ $THRESHOLD%!\u0026#34; \u0026gt;\u0026gt; $LOG_FILE # å‘é€è­¦æŠ¥é‚®ä»¶ echo \u0026#34;Swap ä½¿ç”¨ç‡è­¦æŠ¥: $swap_usage%\u0026#34; | mail -s \u0026#34;Swap ä½¿ç”¨ç‡è­¦æŠ¥ $(hostname)\u0026#34; admin@example.com # è§¦å‘åº”æ€¥æªæ–½ echo 1 \u0026gt; /proc/sys/vm/drop_caches fi 2. è®¾ç½®å®šæœŸç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # æ·»åŠ å®šæ—¶ä»»åŠ¡ echo \u0026#34;*/5 * * * * root /usr/local/bin/swap_monitor.sh\u0026#34; \u0026gt; /etc/cron.d/swap_monitor # æˆ–è€…ä½¿ç”¨ systemd timer cat \u0026gt; /etc/systemd/system/swap-monitor.service \u0026lt;\u0026lt; EOF [Unit] Description=Swap Usage Monitor After=network.target [Service] Type=oneshot ExecStart=/usr/local/bin/swap_monitor.sh User=root EOF cat \u0026gt; /etc/systemd/system/swap-monitor.timer \u0026lt;\u0026lt; EOF [Unit] Description=Run swap monitor every 5 minutes [Timer] OnBootSec=5min OnUnitActiveSec=5min [Install] WantedBy=timers.target EOF systemctl enable swap-monitor.timer systemctl start swap-monitor.timer 3. å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ£€æŸ¥å¹¶æ¸…ç†ä¸å†éœ€è¦çš„ Swap æ–‡ä»¶ swapon --show | grep file | while read path _; do if [ ! -f \u0026#34;$path\u0026#34; ]; then swapoff \u0026#34;$path\u0026#34; sed -i \u0026#34;\\|$path|d\u0026#34; /etc/fstab echo \u0026#34;å·²æ¸…ç†æ— æ•ˆçš„ Swap æ–‡ä»¶: $path\u0026#34; fi done # æ£€æŸ¥ Swap æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§ swapon --show | grep file | awk \u0026#39;{print $1}\u0026#39; | while read swapfile; do if ! swapon -s | grep -q \u0026#34;$swapfile\u0026#34;; then mkswap -f \u0026#34;$swapfile\u0026#34; swapon \u0026#34;$swapfile\u0026#34; fi done # å®šæœŸé‡æ–°å¯ç”¨ Swapï¼ˆé˜²æ­¢é•¿æ—¶é—´è¿è¡Œçš„é—®é¢˜ï¼‰ swapoff -a \u0026amp;\u0026amp; swapon -a 4. æ€§èƒ½åŸºå‡†æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 # æµ‹è¯• Swap æ€§èƒ½ dd if=/dev/zero of=/tmp/test bs=8k count=1000000 # æµ‹è¯•å†…å­˜å’Œ Swap ç»¼åˆæ€§èƒ½ sysbench memory --memory-block-size=1K --memory-total-size=10G run # ç›‘æ§æµ‹è¯•æœŸé—´çš„æ€§èƒ½ vmstat 1 30 \u0026gt; /tmp/vmstat.log \u0026amp; iostat -xm 1 30 \u0026gt; /tmp/iostat.log \u0026amp; sysbench memory --memory-block-size=1K --memory-total-size=10G run 5. æ—¥å¿—åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ†æ Swap ä½¿ç”¨æ¨¡å¼ awk \u0026#39;/Swap/ {print $3}\u0026#39; /proc/meminfo \u0026gt; /tmp/swap_usage.log # ç”Ÿæˆä½¿ç”¨æŠ¥å‘Š gnuplot \u0026lt;\u0026lt; EOF set terminal png set output \u0026#34;/tmp/swap_usage.png\u0026#34; set title \u0026#34;Swap Usage Over Time\u0026#34; set xlabel \u0026#34;Time\u0026#34; set ylabel \u0026#34;Swap Used (KB)\u0026#34; plot \u0026#34;/tmp/swap_usage.log\u0026#34; with lines EOF ğŸ¯ æ€»ç»“ Swap æ˜¯ Linux ç³»ç»Ÿé‡è¦çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œåˆç†é…ç½®å¯ä»¥æå‡ç³»ç»Ÿç¨³å®šæ€§ï¼Œä½†éœ€è¦æ ¹æ®å…·ä½“ä½¿ç”¨åœºæ™¯è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äº PVE è™šæ‹ŸåŒ–å¹³å°ï¼Œå»ºè®®ï¼š\nä½¿ç”¨é«˜æ€§èƒ½ NVMe SSD åˆ›å»ºé€‚é‡ Swap è®¾ç½®è¾ƒä½çš„ swappiness å€¼ï¼ˆ10-30ï¼‰ é…ç½®ç›‘æ§å’Œè­¦æŠ¥ï¼ŒåŠæ—¶å‘ç°å†…å­˜é—®é¢˜ å®šæœŸç»´æŠ¤ Swap ç©ºé—´ï¼Œç¡®ä¿ç³»ç»Ÿå¥åº·è¿è¡Œ æ ¹æ®å·¥ä½œè´Ÿè½½è°ƒæ•´ Swap å¤§å°å’Œç­–ç•¥ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ– PVE ä¸­çš„ Swap é…ç½®ï¼Œæ„å»ºæ›´ç¨³å®šé«˜æ•ˆçš„è™šæ‹ŸåŒ–ç¯å¢ƒï¼\nğŸ’¡ æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œä»»ä½•æ›´æ”¹å‰ï¼Œè¯·åŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯ï¼Œå¹¶ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç† PVE ç³»ç»Ÿçš„å†…å­˜èµ„æºï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ PVE å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚\n","date":"2024-12-07T14:56:38+08:00","image":"https://file.meimolihan.eu.org/img/pve-swap-01.webp","permalink":"https://blog.meimolihan.eu.org/p/10ee8ae3/","title":"Proxmox VE è™šæ‹Ÿå†…å­˜ Swap å…¨é¢è§£æ ğŸ§"},{"content":"Proxmox VE é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨ Proxmox VE (PVE) ç¯å¢ƒä¸­é…ç½® NFS å…±äº«å­˜å‚¨çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–¹æ³•ã€‚NFS (Network File System) å…è®¸åœ¨ç½‘ç»œä¸­çš„ä¸åŒç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶å’Œç›®å½•ï¼Œæ˜¯è™šæ‹ŸåŒ–ç¯å¢ƒä¸­å¸¸ç”¨çš„å…±äº«å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚ğŸš€\nğŸ“– å¯¼èˆªç›®å½• ğŸ“– ç®€ä»‹ ğŸ–¥ï¸ PVE ä½œä¸º NFS æœåŠ¡ç«¯é…ç½® ğŸ’» PVE ä½œä¸º NFS å®¢æˆ·ç«¯é…ç½® ğŸ“Š PVE Web ç•Œé¢é…ç½® NFS ğŸ” NFS å…±äº«ç›‘æ§è„šæœ¬ ğŸ› ï¸ æ•…éšœæ’é™¤å’Œä¼˜åŒ– ğŸ”’ å®‰å…¨é…ç½®å»ºè®® ğŸ’¾ å¤‡ä»½å’Œæ¢å¤ ğŸ“– ç®€ä»‹ NFS (Network File System) æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œå…è®¸å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šçš„ç”¨æˆ·é€šè¿‡ç½‘ç»œè®¿é—®æ–‡ä»¶ï¼Œå°±åƒè®¿é—®æœ¬åœ°å­˜å‚¨ä¸€æ ·ã€‚åœ¨ Proxmox VE ç¯å¢ƒä¸­ï¼ŒNFS å¸¸ç”¨äºï¼š\nå…±äº«å­˜å‚¨ï¼šåœ¨å¤šä¸ª PVE èŠ‚ç‚¹é—´å…±äº«è™šæ‹Ÿæœºç£ç›˜æ˜ åƒ é›†ä¸­å¤‡ä»½ï¼šæä¾›é›†ä¸­çš„å­˜å‚¨ä½ç½®ç”¨äºå¤‡ä»½ æ¨¡æ¿å­˜å‚¨ï¼šå­˜å‚¨æ“ä½œç³»ç»Ÿæ¨¡æ¿å’Œ ISO æ˜ åƒ é«˜å¯ç”¨æ€§ï¼šä¸ºè™šæ‹Ÿæœºé«˜å¯ç”¨æ€§(HA)æä¾›å…±äº«å­˜å‚¨ ğŸ–¥ï¸ ä¸€ã€PVE ä½œä¸º NFS æœåŠ¡ç«¯é…ç½® 1. å®‰è£… NFS æœåŠ¡å™¨è½¯ä»¶ 1 2 3 4 5 6 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… NFS æœåŠ¡å™¨ apt-get update apt-get install nfs-kernel-server nfs-common -y # å®‰è£…ä¾èµ–åŒ… apt-get install rpcbind -y 2. æ£€æŸ¥ NFS æœåŠ¡çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹ NFS æœåŠ¡è¿è¡ŒçŠ¶æ€ systemctl status nfs-kernel-server # å¯åŠ¨ NFS æœåŠ¡ï¼ˆå¦‚æœæœªè¿è¡Œï¼‰ systemctl start nfs-kernel-server # è®¾ç½® NFS æœåŠ¡å¼€æœºè‡ªå¯ systemctl enable nfs-kernel-server # æ£€æŸ¥ç›¸å…³æœåŠ¡çŠ¶æ€ systemctl status rpcbind systemctl status nfs-mountd 3. åˆ›å»ºå…±äº«ç›®å½•å¹¶é…ç½® NFS å¯¼å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -p /mnt/ntfs mkdir -p /mnt/mydisk chmod -R 755 /mnt/ntfs /mnt/mydisk # è®¾ç½®æ‰€æœ‰æƒï¼ˆæ ¹æ®éœ€è¦è°ƒæ•´ï¼‰ chown -R nobody:nogroup /mnt/ntfs /mnt/mydisk # åˆ›å»ºå¹¶é…ç½® exports æ–‡ä»¶ cat \u0026gt; /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS å…±äº«é…ç½® # æ ¼å¼: å…±äº«ç›®å½• å®¢æˆ·ç«¯(é€‰é¡¹) /mnt/ntfs *(rw,sync,no_subtree_check,no_root_squash,insecure) /mnt/mydisk *(rw,sync,no_subtree_check,no_root_squash,insecure) # æˆ–è€…é™åˆ¶ç‰¹å®šç½‘ç»œæ®µè®¿é—® # /mnt/ntfs 10.10.10.0/24(rw,sync,no_subtree_check,no_root_squash,insecure) # /mnt/mydisk 10.10.10.0/24(rw,sync,no_subtree_check,no_root_squash,insecure) EOF # é‡æ–°åŠ è½½ NFS é…ç½® exportfs -rva # é‡å¯ NFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ systemctl restart nfs-kernel-server 4. éªŒè¯ NFS å…±äº«é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹æœ¬æœº NFS å…±äº«åˆ—è¡¨ showmount -e # æŸ¥çœ‹è¯¦ç»†çš„å¯¼å‡ºåˆ—è¡¨ exportfs -v # æ£€æŸ¥ NFS çŠ¶æ€ nfsstat -s # æ£€æŸ¥ RPC æœåŠ¡çŠ¶æ€ rpcinfo -p # æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ ufw allow from 10.10.10.0/24 to any port nfs ufw status verbose 5. é«˜çº§ NFS æœåŠ¡å™¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # ç¼–è¾‘ NFS é…ç½®æ–‡ä»¶ cat \u0026gt; /etc/nfs.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [nfsd] # è®¾ç½® NFS çº¿ç¨‹æ•° threads=16 # è®¾ç½® NFS ç‰ˆæœ¬ # vers2=no # vers3=yes # vers4=yes # vers4.0=yes # vers4.1=yes # vers4.2=yes [mountd] # ç®¡ç†ç«¯å£è®¾ç½® manage-gids=yes [statd] # çŠ¶æ€ç›‘æ§è®¾ç½® EOF # é‡å¯æœåŠ¡åº”ç”¨é…ç½® systemctl restart nfs-kernel-server ğŸ’» äºŒã€PVE ä½œä¸º NFS å®¢æˆ·ç«¯é…ç½® 1. æŸ¥çœ‹è¿œç¨‹ NFS å…±äº« 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹æŒ‡å®šæœåŠ¡å™¨çš„ NFS å…±äº« showmount -e 10.10.10.251 # æŸ¥çœ‹æœ¬æœºå¯ç”¨çš„ NFS å…±äº« showmount -e # ä½¿ç”¨ rpcinfo æ£€æŸ¥æœåŠ¡ rpcinfo -p 10.10.10.251 # æ£€æŸ¥ NFS ç‰ˆæœ¬æ”¯æŒ rpcinfo -u 10.10.10.251 nfs 3 rpcinfo -u 10.10.10.251 nfs 4 2. æ‰‹åŠ¨æŒ‚è½½ NFS å…±äº« 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºæœ¬åœ°æŒ‚è½½ç‚¹ mkdir -p /mnt/nfs/ntfs mkdir -p /mnt/nfs/mydisk # æŒ‚è½½ NFS å…±äº«ï¼ˆä½¿ç”¨ NFSv4 ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ï¼‰ mount -t nfs4 -o vers=4.1,async,noatime,nodiratime 10.10.10.251:/mnt/ntfs /mnt/nfs/ntfs mount -t nfs4 -o vers=4.1,async,noatime,nodiratime 10.10.10.251:/mnt/mydisk /mnt/nfs/mydisk # éªŒè¯æŒ‚è½½ç»“æœ df -hT | grep nfs mount | grep nfs # æµ‹è¯•è¯»å†™æƒé™ touch /mnt/nfs/ntfs/test_file echo \u0026#34;test\u0026#34; \u0026gt; /mnt/nfs/ntfs/test_file cat /mnt/nfs/ntfs/test_file rm /mnt/nfs/ntfs/test_file 3. é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å¤‡ä»½åŸ fstab æ–‡ä»¶ cp /etc/fstab /etc/fstab.backup.$(date +%Y%m%d) # ç¼–è¾‘ /etc/fstab æ–‡ä»¶ cat \u0026gt;\u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS å…±äº«é…ç½® 10.10.10.251:/mnt/ntfs /mnt/nfs/ntfs nfs4 vers=4.1,async,noatime,nodiratime,_netdev,auto 0 0 10.10.10.251:/mnt/mydisk /mnt/nfs/mydisk nfs4 vers=4.1,async,noatime,nodiratime,_netdev,auto 0 0 EOF # æµ‹è¯• fstab é…ç½® mount -a # æ£€æŸ¥æŒ‚è½½ç»“æœ df -hT | grep nfs # å¦‚æœä½¿ç”¨ systemdï¼Œå¯ä»¥å¯ç”¨è‡ªåŠ¨æŒ‚è½½æœåŠ¡ systemctl daemon-reload 4. é«˜çº§æŒ‚è½½é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æ€§èƒ½ä¼˜åŒ–æŒ‚è½½é€‰é¡¹ mount -t nfs4 -o \\ vers=4.1,\\ async,\\ noatime,\\ nodiratime,\\ rsize=131072,\\ wsize=131072,\\ hard,\\ intr,\\ timeo=600,\\ retrans=2 \\ 10.10.10.251:/mnt/ntfs /mnt/nfs/ntfs # å‚æ•°è¯´æ˜: # vers=4.1 - ä½¿ç”¨ NFSv4.1 åè®® # async - å¼‚æ­¥å†™å…¥ï¼Œæé«˜æ€§èƒ½ # noatime - ä¸æ›´æ–°æ–‡ä»¶è®¿é—®æ—¶é—´ï¼Œå‡å°‘ç£ç›˜æ“ä½œ # nodiratime - ä¸æ›´æ–°ç›®å½•è®¿é—®æ—¶é—´ # rsize/wsize - è¯»å†™ç¼“å†²åŒºå¤§å°(é€šå¸¸è®¾ç½®ä¸º 131072 æˆ– 65536) # hard - ç¡¬æŒ‚è½½ï¼ŒæœåŠ¡å™¨æ— å“åº”æ—¶é‡è¯• # intr - å…è®¸ä¸­æ–­ NFS æ“ä½œ # timeo - è¶…æ—¶æ—¶é—´(ååˆ†ä¹‹ä¸€ç§’) # retrans - é‡è¯•æ¬¡æ•° # _netdev - ç­‰å¾…ç½‘ç»œå°±ç»ªåå†æŒ‚è½½ ğŸ“Š ä¸‰ã€PVE Web ç•Œé¢é…ç½® NFS é€šè¿‡ Web ç•Œé¢æ·»åŠ  NFS å­˜å‚¨ï¼š ç™»å½• PVE Web ç®¡ç†ç•Œé¢\né€‰æ‹©æ•°æ®ä¸­å¿ƒ â†’ å­˜å‚¨\nç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot; â†’ \u0026ldquo;NFS\u0026rdquo;\nå¡«å†™é…ç½®ä¿¡æ¯ï¼š\nID: è‡ªå®šä¹‰å­˜å‚¨åç§°(å¦‚: nfs-storage) æœåŠ¡å™¨: NFS æœåŠ¡å™¨ IP (10.10.10.251) å¯¼å‡º: å…±äº«ç›®å½•è·¯å¾„ (/mnt/ntfs æˆ– /mnt/mydisk) å†…å®¹ç±»å‹: é€‰æ‹©éœ€è¦çš„ç±»å‹(é•œåƒã€ç£ç›˜ã€å®¹å™¨ç­‰) é€‰é¡¹: ç‰ˆæœ¬: NFSv4(æ¨è) æˆ– NFSv3 é¢„åˆ†é…: å…³é—­(thin)æˆ–å¼€å¯(full) æ ¼å¼åŒ–: å¦‚æœéœ€è¦æ ¼å¼åŒ–ç£ç›˜ ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot;ä¿å­˜é…ç½®\nå‘½ä»¤è¡Œæ·»åŠ  NFS å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨ pvesm å‘½ä»¤æ·»åŠ  NFS å­˜å‚¨ pvesm add nfs nfs-storage \\ --server 10.10.10.251 \\ --export /mnt/ntfs \\ --options vers=4.1 \\ --content images,iso,backup # æŸ¥çœ‹å­˜å‚¨çŠ¶æ€ pvesm status pvesm list # è®¾ç½®å­˜å‚¨é€‰é¡¹ pvesm set nfs-storage --nodes pve-node1,pve-node2 pvesm set nfs-storage --shared 1 ğŸ” å››ã€NFS å…±äº«ç›‘æ§è„šæœ¬ åˆ›å»º NFS å…±äº«æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 # åˆ›å»ºæ£€æŸ¥è„šæœ¬ cat \u0026gt; /usr/local/bin/check_nfs_shares.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[1;31m\u0026#39; GREEN=\u0026#39;\\033[1;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[1;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color # æ—¥å¿—æ–‡ä»¶ LOG_FILE=\u0026#34;/var/log/nfs_check.log\u0026#34; # NFS æœåŠ¡å™¨åˆ—è¡¨ declare -A nfs_servers=( [\u0026#34;10.10.10.242\u0026#34;]=\u0026#34;PVE-Node-1\u0026#34; [\u0026#34;10.10.10.252\u0026#34;]=\u0026#34;PVE-Node-2\u0026#34; [\u0026#34;10.10.10.243\u0026#34;]=\u0026#34;PVE-Node-3\u0026#34; [\u0026#34;10.10.10.254\u0026#34;]=\u0026#34;PVE-Node-4\u0026#34; [\u0026#34;10.10.10.251\u0026#34;]=\u0026#34;PVE-NAS-1\u0026#34; [\u0026#34;10.10.10.245\u0026#34;]=\u0026#34;PVE-NAS-2\u0026#34; [\u0026#34;10.10.10.246\u0026#34;]=\u0026#34;PVE-Backup-1\u0026#34; [\u0026#34;10.10.10.247\u0026#34;]=\u0026#34;PVE-Backup-2\u0026#34; ) # å‡½æ•°ï¼šè®°å½•æ—¥å¿— log_message() { echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; } # å‡½æ•°ï¼šæ£€æŸ¥ NFS æœåŠ¡å™¨ check_nfs_server() { local server_ip=$1 local server_name=$2 echo -e \u0026#34;\\n${BLUE}æ£€æŸ¥æœåŠ¡å™¨: $server_name ($server_ip)${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; # æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿ if ping -c 1 -W 1 \u0026#34;$server_ip\u0026#34; \u0026amp;\u0026gt; /dev/null; then echo -e \u0026#34;${GREEN}âœ“ æœåŠ¡å™¨åœ¨çº¿${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; # æ£€æŸ¥ NFS æœåŠ¡ if rpcinfo -u \u0026#34;$server_ip\u0026#34; nfs \u0026amp;\u0026gt; /dev/null; then echo -e \u0026#34;${GREEN}âœ“ NFS æœåŠ¡æ­£å¸¸${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; # è·å–å…±äº«åˆ—è¡¨ local shares shares=$(showmount -e \u0026#34;$server_ip\u0026#34; 2\u0026gt;/dev/null) if [ $? -eq 0 ]; then echo -e \u0026#34;${GREEN}âœ“ NFS å…±äº«åˆ—è¡¨:${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;$shares\u0026#34; | sed \u0026#39;1d\u0026#39; | while read -r line; do echo -e \u0026#34; ${GREEN}$line${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; done # æ£€æŸ¥æŒ‚è½½ç‚¹ check_nfs_mounts \u0026#34;$server_ip\u0026#34; else echo -e \u0026#34;${YELLOW}âš  æ— æ³•è·å–å…±äº«åˆ—è¡¨${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; fi else echo -e \u0026#34;${RED}âœ— NFS æœåŠ¡å¼‚å¸¸${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; log_message \u0026#34;ERROR: NFS service down on $server_name ($server_ip)\u0026#34; fi else echo -e \u0026#34;${RED}âœ— æœåŠ¡å™¨ç¦»çº¿${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; log_message \u0026#34;ERROR: Server $server_name ($server_ip) is offline\u0026#34; fi echo \u0026#34;-----------------------\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; } # å‡½æ•°ï¼šæ£€æŸ¥ NFS æŒ‚è½½ç‚¹ check_nfs_mounts() { local server_ip=$1 mount | grep \u0026#34;nfs\u0026#34; | grep \u0026#34;$server_ip\u0026#34; | while read -r line; do local mount_point mount_point=$(echo \u0026#34;$line\u0026#34; | awk \u0026#39;{print $3}\u0026#39;) local device device=$(echo \u0026#34;$line\u0026#34; | awk \u0026#39;{print $1}\u0026#39;) # æ£€æŸ¥æŒ‚è½½ç‚¹æ˜¯å¦å¯è®¿é—® if touch \u0026#34;$mount_point/.nfs_test\u0026#34; 2\u0026gt;/dev/null; then echo -e \u0026#34; ${GREEN}âœ“ æŒ‚è½½ç‚¹ $mount_point æ­£å¸¸${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; rm -f \u0026#34;$mount_point/.nfs_test\u0026#34; else echo -e \u0026#34; ${RED}âœ— æŒ‚è½½ç‚¹ $mount_point å¼‚å¸¸${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; log_message \u0026#34;ERROR: Mount point $mount_point ($device) is not accessible\u0026#34; # å°è¯•é‡æ–°æŒ‚è½½ umount -f \u0026#34;$mount_point\u0026#34; 2\u0026gt;/dev/null mount \u0026#34;$device\u0026#34; \u0026#34;$mount_point\u0026#34; 2\u0026gt;/dev/null if [ $? -eq 0 ]; then echo -e \u0026#34; ${GREEN}âœ“ æŒ‚è½½ç‚¹ $mount_point å·²æ¢å¤${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; log_message \u0026#34;INFO: Mount point $mount_point recovered\u0026#34; fi fi done } # ä¸»å‡½æ•° main() { echo \u0026#34;=== NFS å…±äº«çŠ¶æ€æ£€æŸ¥ ===\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;å¼€å§‹æ—¶é—´: $(date)\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;==========================\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; for server_ip in \u0026#34;${!nfs_servers[@]}\u0026#34;; do server_name=\u0026#34;${nfs_servers[$server_ip]}\u0026#34; check_nfs_server \u0026#34;$server_ip\u0026#34; \u0026#34;$server_name\u0026#34; done # æ£€æŸ¥æœ¬åœ° NFS æœåŠ¡çŠ¶æ€ echo -e \u0026#34;\\n${BLUE}æ£€æŸ¥æœ¬åœ° NFS æœåŠ¡çŠ¶æ€${NC}\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; systemctl status nfs-kernel-server --no-pager | tee -a \u0026#34;$LOG_FILE\u0026#34; echo -e \u0026#34;\\næ£€æŸ¥å®Œæˆæ—¶é—´: $(date)\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;è¯¦ç»†æ—¥å¿—è¯·æŸ¥çœ‹: $LOG_FILE\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; } # æ‰§è¡Œä¸»å‡½æ•° main \u0026#34;$@\u0026#34; EOF # è®¾ç½®è„šæœ¬æƒé™ chmod +x /usr/local/bin/check_nfs_shares.sh # è¿è¡Œæ£€æŸ¥è„šæœ¬ /usr/local/bin/check_nfs_shares.sh è®¾ç½®å®šæ—¶æ£€æŸ¥ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # ç¼–è¾‘ crontab crontab -e # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰ */30 * * * * /usr/local/bin/check_nfs_shares.sh \u0026gt;\u0026gt; /var/log/nfs_check.log 2\u0026gt;\u0026amp;1 # æˆ–è€…åˆ›å»º systemd timer cat \u0026gt; /etc/systemd/system/nfs-check.service \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Unit] Description=NFS Share Check Service After=network.target [Service] Type=oneshot ExecStart=/usr/local/bin/check_nfs_shares.sh User=root EOF cat \u0026gt; /etc/systemd/system/nfs-check.timer \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Unit] Description=Run NFS check every 30 minutes [Timer] OnBootSec=5min OnUnitActiveSec=30min [Install] WantedBy=timers.target EOF systemctl enable nfs-check.timer systemctl start nfs-check.timer NFS æ€§èƒ½ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åˆ›å»º NFS æ€§èƒ½ç›‘æ§è„šæœ¬ cat \u0026gt; /usr/local/bin/nfs_performance.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;=== NFS æ€§èƒ½ç›‘æ§ ===\u0026#34; echo \u0026#34;æ—¶é—´: $(date)\u0026#34; echo \u0026#34;====================\u0026#34; # æŸ¥çœ‹ NFS ç»Ÿè®¡ä¿¡æ¯ echo -e \u0026#34;\\nNFS å®¢æˆ·ç«¯ç»Ÿè®¡:\u0026#34; nfsstat -c echo -e \u0026#34;\\nNFS æœåŠ¡å™¨ç»Ÿè®¡:\u0026#34; nfsstat -s echo -e \u0026#34;\\nNFS æŒ‚è½½ç‚¹ç»Ÿè®¡:\u0026#34; mount | grep nfs echo -e \u0026#34;\\nNFS I/O ç»Ÿè®¡:\u0026#34; cat /proc/fs/nfsfs/servers cat /proc/fs/nfsfs/volumes echo -e \u0026#34;\\nç½‘ç»œè¿æ¥ç»Ÿè®¡:\u0026#34; ss -t -a | grep :nfs EOF chmod +x /usr/local/bin/nfs_performance.sh ğŸ› ï¸ äº”ã€æ•…éšœæ’é™¤å’Œä¼˜åŒ– å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # 1. æ£€æŸ¥ NFS æœåŠ¡çŠ¶æ€ systemctl status nfs-kernel-server journalctl -u nfs-kernel-server -f # 2. æŸ¥çœ‹ NFS æ—¥å¿— tail -f /var/log/syslog | grep nfs tail -f /var/log/messages | grep nfs # 3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½® ufw status verbose iptables -L -n # 4. æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping 10.10.10.251 telnet 10.10.10.251 2049 nc -zv 10.10.10.251 2049 # 5. é‡æ–°æŒ‚è½½ NFS å…±äº« umount -f /mnt/nfs/ntfs mount -a # 6. æ£€æŸ¥ NFS ç‰ˆæœ¬å…¼å®¹æ€§ rpcinfo -u 10.10.10.251 nfs 3 rpcinfo -u 10.10.10.251 nfs 4 # 7. æ£€æŸ¥æ–‡ä»¶é”çŠ¶æ€ nfs4_getfacl /mnt/nfs/ntfs æ€§èƒ½ä¼˜åŒ–å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # 1. è°ƒæ•´ NFS æŒ‚è½½å‚æ•°ï¼ˆåœ¨ /etc/fstab ä¸­ï¼‰ 10.10.10.251:/mnt/ntfs /mnt/nfs/ntfs nfs4 rw,vers=4.1,async,noatime,nodiratime,rsize=131072,wsize=131072,hard,intr,timeo=600,retrans=2,_netdev 0 0 # 2. å¢åŠ  NFS çº¿ç¨‹æ•° echo \u0026#34;options nfs nfs4_disable_idmapping=0\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/nfs.conf echo \u0026#34;options nfsd threads=16\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/nfs.conf # 3. è°ƒæ•´ç½‘ç»œå‚æ•° echo \u0026#34;net.core.rmem_max = 16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.core.wmem_max = 16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.core.rmem_default = 16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.core.wmem_default = 16777216\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p # 4. ä½¿ç”¨æ›´å¿«çš„ç½‘ç»œè¿æ¥ # è€ƒè™‘ä½¿ç”¨ 10GbE æˆ–æ›´é«˜é€Ÿåº¦çš„ç½‘ç»œ # 5. ä½¿ç”¨é«˜æ€§èƒ½å­˜å‚¨åç«¯ # å¦‚ SSD æˆ– NVMe å­˜å‚¨ # 6. è°ƒæ•´ NFS æœåŠ¡å™¨é…ç½® echo \u0026#34;options sunrpc tcp_slot_table_entries=128\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/sunrpc.conf echo \u0026#34;options sunrpc tcp_max_slot_table_entries=128\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/sunrpc.conf ğŸ”’ å…­ã€å®‰å…¨é…ç½®å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # 1. é™åˆ¶ NFS è®¿é—®æƒé™ï¼ˆä¿®æ”¹ /etc/exportsï¼‰ /mnt/ntfs 10.10.10.0/24(rw,sync,no_subtree_check,no_root_squash,insecure) # 2. ä½¿ç”¨æ›´å®‰å…¨çš„ NFSv4 /mnt/ntfs 10.10.10.0/24(rw,sync,fsid=0,sec=sys,no_subtree_check) # 3. é…ç½®é˜²ç«å¢™è§„åˆ™ ufw allow from 10.10.10.0/24 to any port nfs ufw allow from 10.10.10.0/24 to any port mountd ufw allow from 10.10.10.0/24 to any port nlockmgr # 4. ä½¿ç”¨ Kerberos è®¤è¯ï¼ˆé«˜çº§ï¼‰ # /mnt/ntfs 10.10.10.0/24(rw,sync,sec=krb5p) # 5. å®šæœŸæ£€æŸ¥ NFS æƒé™ nfs4_getfacl /mnt/ntfs # 6. ä½¿ç”¨ VPN æˆ–ä¸“ç”¨ç½‘ç»œ # å°† NFS æµé‡éš”ç¦»åˆ°ä¸“ç”¨ç½‘ç»œ # 7. ç›‘æ§ NFS è®¿é—®æ—¥å¿— cat \u0026gt; /etc/rsyslog.d/nfs.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; if $programname == \u0026#39;nfsd\u0026#39; then /var/log/nfs.log \u0026amp; stop EOF systemctl restart rsyslog ğŸ’¾ ä¸ƒã€å¤‡ä»½å’Œæ¢å¤ NFS é…ç½®å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å¤‡ä»½ NFS é…ç½®æ–‡ä»¶ tar -czf /backup/nfs_config_$(date +%Y%m%d).tar.gz \\ /etc/exports \\ /etc/nfs.conf \\ /etc/nfsmount.conf \\ /etc/modprobe.d/nfs.conf \\ /etc/sysctl.d/nfs.conf # å¤‡ä»½å…±äº«ç›®å½•ç»“æ„ find /mnt/ntfs /mnt/mydisk -type f -name \u0026#34;*.conf\u0026#34; -o -name \u0026#34;*.cfg\u0026#34; | \\ tar -czf /backup/nfs_shared_config_$(date +%Y%m%d).tar.gz -T - # å¤‡ä»½ fstab é…ç½® cp /etc/fstab /backup/fstab.backup.$(date +%Y%m%d) # å¤‡ä»½ PVE å­˜å‚¨é…ç½® pvesm status \u0026gt; /backup/pve_storage_status_$(date +%Y%m%d).txt pvesm list --output-format json \u0026gt; /backup/pve_storage_list_$(date +%Y%m%d).json æ¢å¤ NFS é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ¢å¤ NFS é…ç½®æ–‡ä»¶ tar -xzf /backup/nfs_config_20230101.tar.gz -C / # é‡æ–°åŠ è½½é…ç½® exportfs -rva systemctl restart nfs-kernel-server # æ¢å¤ fstab é…ç½® cp /backup/fstab.backup.20230101 /etc/fstab mount -a # æ¢å¤ PVE å­˜å‚¨é…ç½® # éœ€è¦æ ¹æ®å¤‡ä»½é‡æ–°æ·»åŠ å­˜å‚¨ ç¾éš¾æ¢å¤è®¡åˆ’ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # åˆ›å»ºç¾éš¾æ¢å¤è„šæœ¬ cat \u0026gt; /usr/local/bin/nfs_disaster_recovery.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;å¼€å§‹ NFS ç¾éš¾æ¢å¤...\u0026#34; # 1. åœæ­¢ç›¸å…³æœåŠ¡ systemctl stop nfs-kernel-server systemctl stop rpcbind # 2. æ¢å¤é…ç½®æ–‡ä»¶ if [ -f \u0026#34;/backup/nfs_config_latest.tar.gz\u0026#34; ]; then tar -xzf /backup/nfs_config_latest.tar.gz -C / fi # 3. æ¢å¤ fstab if [ -f \u0026#34;/backup/fstab.backup.latest\u0026#34; ]; then cp /backup/fstab.backup.latest /etc/fstab fi # 4. å¯åŠ¨æœåŠ¡ systemctl start rpcbind systemctl start nfs-kernel-server # 5. é‡æ–°æŒ‚è½½ mount -a # 6. éªŒè¯æ¢å¤ showmount -e df -hT | grep nfs echo \u0026#34;NFS ç¾éš¾æ¢å¤å®Œæˆ!\u0026#34; EOF chmod +x /usr/local/bin/nfs_disaster_recovery.sh é€šè¿‡ä»¥ä¸Šé…ç½®å’ŒæŒ‡å—ï¼Œæ‚¨å¯ä»¥åœ¨ PVE ç¯å¢ƒä¸­æˆåŠŸæ­å»ºå’Œç®¡ç† NFS å…±äº«å­˜å‚¨ï¼Œå®ç°é«˜æ•ˆçš„æ–‡ä»¶å…±äº«å’Œæ•°æ®ç®¡ç†ï¼ğŸ“ è®°å¾—å®šæœŸæ£€æŸ¥ç³»ç»ŸçŠ¶æ€å’Œç»´æŠ¤å¤‡ä»½å“¦ï¼ğŸ˜Š\nğŸ’¡ æç¤º: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œä»»ä½•æ›´æ”¹å‰ï¼Œè¯·åŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯ï¼Œå¹¶ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½ã€‚\n","date":"2024-12-07T14:55:17+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/34897ada/","title":"Proxmox VE é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸"},{"content":"Proxmox VE \u0026amp; Linux è™šæ‹Ÿç£ç›˜æŒ‚è½½ä¸ä¿®æ”¹ ğŸ’¾ âœ¨ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ PVE/Linux ç³»ç»Ÿä¸­ç›´æ¥æŒ‚è½½å’Œä¿®æ”¹å„ç§è™šæ‹Ÿç£ç›˜æ ¼å¼ï¼ˆimg/qcow2/vmdk/RAW/RBDï¼‰ï¼Œæ— éœ€å¯åŠ¨è™šæ‹Ÿæœºå³å¯ç›´æ¥è®¿é—®ç£ç›˜å†…å®¹ã€‚æ— è®ºæ˜¯æ•°æ®æ¢å¤ã€ç³»ç»Ÿä¿®å¤è¿˜æ˜¯é…ç½®ä¿®æ”¹ï¼Œè¿™äº›æŠ€å·§éƒ½èƒ½å¸®æ‚¨è½»æ¾å®Œæˆï¼\nğŸ”— å‚è€ƒæ•™ç¨‹ï¼š https://foxi.buduanwang.vip/linux/552.html/ ğŸ“‹ ç›®å½• ğŸŒŸ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ„ ä¸€ã€ä¿®æ”¹qcow2é•œåƒ ğŸ’½ äºŒã€ä¿®æ”¹RAW/LVMé•œåƒ ğŸ  ä¸‰ã€æŒ‚è½½ä¿®æ”¹ZFS zvolé•œåƒ ğŸ”„ å››ã€ä¿®æ”¹Ceph RBD âš ï¸ äº”ã€é€šç”¨æ“ä½œä¸æ³¨æ„äº‹é¡¹ ğŸ¯ å…­ã€æ ¼å¼è½¬æ¢æŒ‡å— ğŸ“Š ä¸ƒã€ä¸åŒæ ¼å¼å¯¹æ¯” ğŸ”’ å…«ã€å®‰å…¨è­¦å‘Š ğŸŒŸ ç‰¹ç‚¹ä¸åŠŸèƒ½ æœ¬æŒ‡å—æ¶µç›–ä»¥ä¸‹å¼ºå¤§åŠŸèƒ½ï¼š\nğŸ”§ å¤šæ ¼å¼æ”¯æŒï¼šå…¨é¢æ”¯æŒ qcow2ã€RAWã€VMDKã€ZFS zvol å’Œ Ceph RBD ç­‰å¤šç§è™šæ‹Ÿç£ç›˜æ ¼å¼ âš¡ æ— éœ€å¯åŠ¨è™šæ‹Ÿæœºï¼šç›´æ¥æŒ‚è½½å’Œä¿®æ”¹è™šæ‹Ÿç£ç›˜å†…å®¹ï¼ŒèŠ‚çœæ—¶é—´å’Œèµ„æº ğŸ›¡ï¸ å®‰å…¨æ“ä½œï¼šæä¾›åªè¯»æŒ‚è½½é€‰é¡¹ï¼Œé¿å…æ„å¤–æ•°æ®æŸå ğŸ”§ æ•…éšœæ¢å¤ï¼šå¸®åŠ©ä¿®å¤ç³»ç»Ÿå¯åŠ¨é—®é¢˜ã€æ¢å¤é‡è¦æ–‡ä»¶ ğŸ“ è·¨å¹³å°è®¿é—®ï¼šåœ¨ Linux ç¯å¢ƒä¸­è®¿é—® Windows è™šæ‹Ÿç£ç›˜æ–‡ä»¶ç³»ç»Ÿ ğŸ”„ æ ¼å¼è½¬æ¢ï¼šæä¾›ä¸åŒè™šæ‹Ÿç£ç›˜æ ¼å¼ä¹‹é—´çš„è½¬æ¢æ–¹æ³• ğŸ„ ä¸€ã€ä¿®æ”¹qcow2é•œåƒ 1. å®‰è£…å¿…è¦å·¥å…· 1 2 3 4 5 # Debian/Ubuntu ç³»ç»Ÿ sudo apt-get install qemu-utils # CentOS/RHEL ç³»ç»Ÿ sudo yum install qemu-img 2. åŠ è½½ nbd å†…æ ¸æ¨¡å— 1 2 3 # åŠ è½½ç½‘ç»œå—è®¾å¤‡æ¨¡å— modprobe nbd max_part=8 # ğŸ”§ æœ€å¤§æ”¯æŒ8ä¸ªåˆ†åŒº 3. æŒ‚è½½è™šæ‹Ÿç£ç›˜ 1 2 3 # è¿æ¥ qcow2 é•œåƒåˆ° nbd è®¾å¤‡ qemu-nbd --connect=/dev/nbd2 /mnt/pve/nvme960/images/107/vm-107-disk-0.qcow2 # ğŸ“Œ æ³¨æ„ï¼šnbd åå¿…é¡»è·Ÿæ•°å­—ï¼ˆnbd0, nbd1, nbd2...ï¼‰ 4. æŸ¥çœ‹ç£ç›˜åˆ†åŒº 1 2 3 4 5 # æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ fdisk -l | grep nbd2 # ğŸ“Š ç¤ºä¾‹è¾“å‡ºï¼š # /dev/nbd2p1 * 2048 206847 204800 100M 7 HPFS/NTFS/exFAT # /dev/nbd2p2 206848 67106815 66899968 31.9G 7 HPFS/NTFS/exFAT 5. æŒ‚è½½åˆ†åŒºï¼ˆä»¥ NTFS ä¸ºä¾‹ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 # å®‰è£… NTFS æ”¯æŒ apt install ntfs-3g -y # åˆ›å»ºæŒ‚è½½ç‚¹ mkdir /win7 # æŒ‚è½½åˆ†åŒº mount /dev/nbd2p2 /win7 # éªŒè¯æŒ‚è½½ df -h | grep win7 # âœ… è¾“å‡ºï¼š/dev/nbd2p2 32G 24G 8.9G 73% /win7 6. å¸è½½æ“ä½œ 1 2 3 4 5 6 7 8 # å¸è½½åˆ†åŒº umount /win7 # æ–­å¼€ nbd è¿æ¥ qemu-nbd --disconnect /dev/nbd2 # ç§»é™¤ nbd æ¨¡å—ï¼ˆå¯é€‰ï¼‰ modprobe -r nbd ğŸ’½ äºŒã€ä¿®æ”¹RAW/LVMé•œåƒ 1. æŸ¥æ‰¾ç£ç›˜è·¯å¾„ 1 2 3 # æŸ¥çœ‹ LVM ç£ç›˜æ˜ å°„ ls /dev/mapper/ # ğŸ“‹ ç¤ºä¾‹è¾“å‡ºï¼šNvmeSSD-vm--108--disk--4 2. å®‰è£…å¿…è¦å·¥å…· 1 2 # å®‰è£… kpartx ç”¨äºå¤„ç†åˆ†åŒºè¡¨ apt update \u0026amp;\u0026amp; apt install kpartx -y 3. æŒ‚è½½ä¸º loop è®¾å¤‡ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç°æœ‰ loop è®¾å¤‡ losetup # åˆ›å»º loop è®¾å¤‡è¿æ¥ losetup /dev/loop5 /dev/mapper/NvmeSSD-vm--108--disk--4 # æ˜ å°„åˆ†åŒº kpartx -a /dev/loop5 4. æŸ¥çœ‹å’ŒæŒ‚è½½åˆ†åŒº 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹åˆ†åŒºæƒ…å†µ lsblk # åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½ mkdir /cloud mount /dev/mapper/loop5p2 /cloud # éªŒè¯æŒ‚è½½ df -h | grep cloud 5. å¸è½½æ“ä½œ 1 2 3 4 5 6 7 8 # å¸è½½åˆ†åŒº umount /cloud # å–æ¶ˆåˆ†åŒºæ˜ å°„ kpartx -d /dev/loop5 # æ–­å¼€ loop è®¾å¤‡ losetup -d /dev/loop5 ğŸ  ä¸‰ã€æŒ‚è½½ä¿®æ”¹ZFS zvolé•œåƒ 1. æŸ¥æ‰¾ ZFS å·è·¯å¾„ 1 2 3 # æŸ¥çœ‹ zvol è®¾å¤‡ ls /dev/zvol/zfs/* -l # ğŸ”— è¾“å‡ºä¸ºç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘å®é™…è®¾å¤‡ 2. ç›´æ¥æŒ‚è½½åˆ†åŒº 1 2 3 4 5 # æ–¹æ³•ä¸€ï¼šä½¿ç”¨ zd è®¾å¤‡å· mount /dev/zd16p1 /cloud # æ–¹æ³•äºŒï¼šä½¿ç”¨ zvol è·¯å¾„ mount /dev/zvol/zfs/vm-100-disk-0-part1 /cloud 3. æŸ¥çœ‹åˆ†åŒºæƒ…å†µ 1 2 3 # æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯ lsblk | grep zd # ğŸ“Š æ˜¾ç¤ºæ‰€æœ‰ zd è®¾å¤‡åŠå…¶åˆ†åŒº 4. å¸è½½æ“ä½œ 1 2 # ç®€å•å¸è½½å³å¯ umount /cloud ğŸ”„ å››ã€ä¿®æ”¹Ceph RBD 1. æŸ¥çœ‹ RBD é•œåƒ 1 2 3 # åˆ—å‡ºæŒ‡å®šå­˜å‚¨æ± çš„ RBD é•œåƒ rbd ls --pool ssd # ğŸ“‹ ç¤ºä¾‹è¾“å‡ºï¼šrdb1 2. æ˜ å°„ RBD åˆ°æœ¬åœ° 1 2 3 4 5 6 # æ˜ å°„ RBD é•œåƒåˆ°æœ¬åœ°è®¾å¤‡ rbd map --pool ssd rdb1 # ğŸ’¾ è¾“å‡ºï¼š/dev/rbd0 # æŸ¥çœ‹æ˜ å°„çŠ¶æ€ rbd showmapped 3. æŒ‚è½½å’Œä½¿ç”¨ 1 2 3 4 5 # æŸ¥çœ‹åˆ†åŒºï¼ˆå¦‚æœæœ‰ï¼‰ fdisk -l /dev/rbd0 # æŒ‚è½½åˆ†åŒº mount /dev/rbd0p1 /mnt/rbd 4. å¸è½½å’Œå–æ¶ˆæ˜ å°„ 1 2 3 4 5 6 7 # å¸è½½åˆ†åŒº umount /mnt/rbd # å–æ¶ˆæ˜ å°„ï¼ˆä¸¤ç§æ–¹å¼ï¼‰ rbd unmap --pool ssd rdb1 # æˆ– rbd unmap /dev/rbd0 âš ï¸ äº”ã€é€šç”¨æ“ä½œä¸æ³¨æ„äº‹é¡¹ 1. å®‰å…¨æ“ä½œæŒ‡å— 1 2 3 4 5 6 7 8 # 1. å§‹ç»ˆå…ˆå¤‡ä»½é‡è¦æ•°æ® cp /path/to/image.qcow2 /path/to/image.qcow2.backup # 2. ç¡®ä¿è™šæ‹Ÿæœºå·²å…³é—­ qm list | grep \u0026lt;VMID\u0026gt; # 3. ä½¿ç”¨åªè¯»æ¨¡å¼æŒ‚è½½ï¼ˆæ¨èå…ˆæµ‹è¯•ï¼‰ mount -o ro /dev/nbd2p1 /mnt/test 2. æ–‡ä»¶ç³»ç»Ÿæ”¯æŒ 1 2 3 4 5 # å®‰è£…å¸¸è§æ–‡ä»¶ç³»ç»Ÿæ”¯æŒ apt install ntfs-3g exfat-fuse exfat-utils -y # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹ blkid /dev/nbd2p1 3. è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 #!/bin/bash # è‡ªåŠ¨æŒ‚è½½ qcow2 é•œåƒè„šæœ¬ IMAGE_PATH=\u0026#34;$1\u0026#34; MOUNT_POINT=\u0026#34;$2\u0026#34; modprobe nbd max_part=8 qemu-nbd --connect=/dev/nbd0 \u0026#34;$IMAGE_PATH\u0026#34; mkdir -p \u0026#34;$MOUNT_POINT\u0026#34; mount /dev/nbd0p1 \u0026#34;$MOUNT_POINT\u0026#34; echo \u0026#34;å·²æŒ‚è½½åˆ°: $MOUNT_POINT\u0026#34; 4. æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 9 10 # å¦‚æœæŒ‚è½½å¤±è´¥ï¼Œæ£€æŸ¥å†…æ ¸æ¶ˆæ¯ dmesg | tail -20 # æ£€æŸ¥ nbd è®¾å¤‡çŠ¶æ€ ls /dev/nbd* # å¼ºåˆ¶æ–­å¼€æ‰€æœ‰ nbd è¿æ¥ for device in /dev/nbd*; do qemu-nbd --disconnect \u0026#34;$device\u0026#34; 2\u0026gt;/dev/null done 5. æ€§èƒ½ä¼˜åŒ–å»ºè®® 1 2 3 4 5 # ä½¿ç”¨ç¼“å­˜æ¨¡å¼æŒ‚è½½ï¼ˆæ€§èƒ½æ›´å¥½ä½†é£é™©æ›´é«˜ï¼‰ qemu-nbd --cache=writeback --connect=/dev/nbd0 image.qcow2 # ä½¿ç”¨ aio æ¨¡å¼ qemu-nbd --aio=native --connect=/dev/nbd0 image.qcow2 ğŸ¯ å…­ã€æ ¼å¼è½¬æ¢æŒ‡å— ä¸åŒæ ¼å¼é—´è½¬æ¢ 1 2 3 4 5 6 7 8 # qcow2 è½¬ raw qemu-img convert -O raw input.qcow2 output.raw # raw è½¬ qcow2 qemu-img convert -O qcow2 input.raw output.qcow2 # vmdk è½¬ qcow2 qemu-img convert -O qcow2 input.vmdk output.qcow2 å‹ç¼©å’Œä¼˜åŒ– 1 2 3 4 5 # åˆ›å»ºå‹ç¼©çš„ qcow2 é•œåƒ qemu-img convert -O qcow2 -c input.raw compressed.qcow2 # è°ƒæ•´é•œåƒå¤§å° qemu-img resize image.qcow2 +10G ğŸ“Š ä¸ƒã€ä¸åŒæ ¼å¼å¯¹æ¯” æ ¼å¼ ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ qcow2 âœ… æ”¯æŒå¿«ç…§\nâœ… åŠ¨æ€åˆ†é…\nâœ… å‹ç¼© âŒ æ€§èƒ½ç¨å·®\nâŒ å¤æ‚åº¦é«˜ ğŸ¯ ç”Ÿäº§ç¯å¢ƒè™šæ‹Ÿæœº raw âœ… æ€§èƒ½æœ€å¥½\nâœ… ç®€å•ç›´æ¥\nâœ… å…¼å®¹æ€§å¥½ âŒ å›ºå®šå¤§å°\nâŒ æ— é«˜çº§åŠŸèƒ½ ğŸš€ æ€§èƒ½æ•æ„Ÿåœºæ™¯ vmdk âœ… VMware å…¼å®¹\nâœ… å¹¿æ³›æ”¯æŒ âŒ æ€§èƒ½ä¸€èˆ¬\nâŒ åŠŸèƒ½æœ‰é™ ğŸ”„ VMware è¿ç§» RBD âœ… åˆ†å¸ƒå¼å­˜å‚¨\nâœ… å¿«ç…§å’Œå…‹éš†\nâœ… é«˜æ€§èƒ½ âŒ é…ç½®å¤æ‚\nâŒ Ceph ä¾èµ– ğŸŒ äº‘ç¯å¢ƒå’Œé›†ç¾¤ ğŸ”’ å…«ã€å®‰å…¨è­¦å‘Š ğŸš¨ æ•°æ®é£é™©ï¼šç›´æ¥ä¿®æ”¹è™šæ‹Ÿç£ç›˜å¯èƒ½å¯¼è‡´æ•°æ®æŸåï¼ŒåŠ¡å¿…å…ˆå¤‡ä»½ ğŸ”’ æ–‡ä»¶ç³»ç»Ÿé”ï¼šç¡®ä¿æ²¡æœ‰å…¶ä»–è¿›ç¨‹åœ¨ä½¿ç”¨ç£ç›˜ï¼Œé¿å…å†²çª ğŸ’¾ å¤‡ä»½ä¼˜å…ˆï¼šæ“ä½œå‰åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ï¼Œé˜²æ­¢æ„å¤–å‘ç”Ÿ ğŸ‘€ åªè¯»æµ‹è¯•ï¼šé¦–æ¬¡æŒ‚è½½å»ºè®®ä½¿ç”¨åªè¯»æ¨¡å¼æµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯åå†è¯»å†™æŒ‚è½½ ğŸ‘® æƒé™ç®¡ç†ï¼šä½¿ç”¨åˆé€‚çš„ç”¨æˆ·æƒé™æ“ä½œï¼Œé¿å…æƒé™é—®é¢˜ ğŸš¨ é‡è¦æç¤ºï¼šè¿™äº›æ“ä½œä¸»è¦ç”¨äºç´§æ€¥ä¿®å¤å’Œç‰¹æ®Šç»´æŠ¤ï¼Œä¸å»ºè®®ä½œä¸ºå¸¸è§„æ“ä½œä½¿ç”¨ã€‚åœ¨ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒç£ç›˜å‰ï¼ŒåŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æ“ä½œæµç¨‹ã€‚\né€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç†Ÿç»ƒåœ°åœ¨ PVE/Linux ç¯å¢ƒä¸­æŒ‚è½½å’Œä¿®æ”¹å„ç§è™šæ‹Ÿç£ç›˜æ ¼å¼ã€‚è®°å¾—å§‹ç»ˆè°¨æ…æ“ä½œï¼Œå¹¶åšå¥½æ•°æ®å¤‡ä»½ï¼ğŸ‰\nğŸ“ æ€»ç»“ä¸€ä¸‹ï¼š\nä½¿ç”¨ qemu-nbd å¤„ç† qcow2 æ ¼å¼ ä½¿ç”¨ losetup å’Œ kpartx å¤„ç† RAW/LVM æ ¼å¼ ç›´æ¥æŒ‚è½½ ZFS zvol è®¾å¤‡ ä½¿ç”¨ rbd map å¤„ç† Ceph RBD é•œåƒ å§‹ç»ˆå¤‡ä»½æ•°æ®å¹¶ä½¿ç”¨åªè¯»æ¨¡å¼å…ˆæµ‹è¯• ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºï¼ğŸ’¬\n","date":"2024-12-07T14:54:48+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/72ec2819/","title":"Proxmox VE/Linux è™šæ‹Ÿç£ç›˜æŒ‚è½½ä¸ä¿®æ”¹ ğŸ’¾"},{"content":"Proxmox VE éƒ¨ç½² Samba æœåŠ¡æŒ‡å— ğŸ–¥ï¸ ğŸ“‹ ç›®å½• ğŸŒŸ ç®€ä»‹ ğŸ”§ ä¸€ã€å®‰è£… Samba æœåŠ¡å¹¶åˆ›å»ºç”¨æˆ· âš™ï¸ äºŒã€é…ç½® Samba æœåŠ¡ ğŸš€ ä¸‰ã€ä¸€é”®éƒ¨ç½²è„šæœ¬ ğŸ” å››ã€éªŒè¯ä¸æµ‹è¯• ğŸ› ï¸ äº”ã€ç®¡ç†å‘½ä»¤ ğŸ’¡ å…­ã€æ•…éšœæ’é™¤ ğŸ”’ ä¸ƒã€å®‰å…¨å»ºè®® ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Proxmox VE (PVE) ä¸Šéƒ¨ç½² Samba æœåŠ¡ï¼Œå®ç°æ–‡ä»¶å…±äº«åŠŸèƒ½ã€‚ç›´æ¥åœ¨ PVE ä¸»æœºä¸Šå®‰è£… Samba æ¯”é€šè¿‡è™šæ‹Ÿæœºè¿è¡Œé»‘ç¾¤æ™–æ€§èƒ½æ›´é«˜ã€‚\nğŸ”— æ•™ç¨‹é“¾æ¥ï¼š https://foxi.buduanwang.vip/virtualization/1754.html/ ğŸ”§ ä¸€ã€å®‰è£… Samba æœåŠ¡å¹¶åˆ›å»ºç”¨æˆ· 1. å®‰è£… Samba æœåŠ¡ 1 apt update \u0026amp;\u0026amp; apt install samba -y 2. åˆ›å»º admin ç”¨æˆ·å¹¶è®¾ç½®å¯†ç  1 useradd admin \u0026amp;\u0026amp; smbpasswd -a admin ç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥å¹¶ç¡®è®¤ admin ç”¨æˆ·çš„ Samba å¯†ç \nâš™ï¸ äºŒã€é…ç½® Samba æœåŠ¡ 1. å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 cp -i /etc/samba/smb.conf /etc/samba/smb.conf.bak \u0026amp;\u0026amp; cd /etc/samba \u0026amp;\u0026amp; ls 2. åˆ›å»ºå…±äº«ç›®å½• 1 mkdir -pm 755 /mnt/ntfs 3. åˆ›å»ºå®Œæ•´çš„ Samba é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 chmod +x /etc/samba/smb.conf \u0026amp;\u0026amp; cat \u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [global] ## æµè§ˆ/è¯†åˆ« ### # å°†æ­¤æ›´æ”¹ä¸ºæ‚¨çš„ Samba æœåŠ¡å™¨å°†è¦åŠ å…¥çš„å·¥ä½œç»„/NT åŸŸåç§° workgroup = WORKGROUP #### ç½‘ç»œ #### # è¦ç»‘å®šåˆ°çš„ç‰¹å®šæ¥å£/ç½‘ç»œé›†åˆ # è¿™å¯ä»¥æ˜¯æ¥å£åç§°æˆ– IP åœ°å€/å­ç½‘æ©ç ï¼› # é€šå¸¸æ¨èä½¿ç”¨æ¥å£åç§° ; interfaces = 127.0.0.0/8 eth0 # ä»…ç»‘å®šåˆ°æŒ‡å®šçš„æ¥å£å’Œ/æˆ–ç½‘ç»œï¼›æ‚¨å¿…é¡»ä½¿ç”¨ # ä¸Šé¢çš„ \u0026#39;interfaces\u0026#39; é€‰é¡¹æ‰èƒ½ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚ # å¦‚æœæ‚¨çš„ Samba æœºå™¨æ²¡æœ‰å—åˆ°é˜²ç«å¢™çš„ä¿æŠ¤æˆ–æœ¬èº«å°±æ˜¯é˜²ç«å¢™ï¼Œåˆ™å»ºè®®å¯ç”¨æ­¤åŠŸèƒ½ã€‚ # ä½†æ˜¯ï¼Œæ­¤é€‰é¡¹ä¸èƒ½æ­£ç¡®å¤„ç†åŠ¨æ€æˆ–éå¹¿æ’­æ¥å£ã€‚ ; bind interfaces only = yes #### è°ƒè¯•/è®¡è´¹ #### # è¿™å‘Šè¯‰ Samba ä¸ºæ¯å°è¿æ¥çš„æœºå™¨ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ log file = /var/log/samba/log.%m # é™åˆ¶å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼ˆä»¥ KiB ä¸ºå•ä½ï¼‰ã€‚ max log size = 1000 # æˆ‘ä»¬å¸Œæœ› Samba åªè®°å½•åˆ° /var/log/samba/log.{smbd,nmbd}ã€‚ # å¦‚æœæ‚¨æƒ³å°†é‡è¦æ¶ˆæ¯å‘é€åˆ° syslogï¼Œä¹Ÿå¯ä»¥æ·»åŠ  syslog@1ã€‚ logging = file # å½“ Samba å´©æºƒæ—¶åšç‚¹æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼šç»™ç®¡ç†å‘˜å‘é€ä¸€ä¸ªå›æº¯é‚®ä»¶ panic action = /usr/share/samba/panic-action %d ####### è®¤è¯ ####### # æœåŠ¡å™¨è§’è‰²ã€‚å®šä¹‰ Samba å°†è¿è¡Œçš„æ¨¡å¼ã€‚å¯èƒ½çš„å€¼æœ‰ \u0026#34;ç‹¬ç«‹æœåŠ¡å™¨\u0026#34;ã€\u0026#34;æˆå‘˜æœåŠ¡å™¨\u0026#34;ã€\u0026#34;ç»å…¸ä¸»åŸŸæ§åˆ¶å™¨\u0026#34;ã€\u0026#34;ç»å…¸å¤‡ä»½åŸŸæ§åˆ¶å™¨\u0026#34;ã€\u0026#34;æ´»åŠ¨ç›®å½•åŸŸæ§åˆ¶å™¨\u0026#34;ã€‚ # # å¤§å¤šæ•°äººä¼šæƒ³è¦ \u0026#34;ç‹¬ç«‹æœåŠ¡å™¨\u0026#34; æˆ– \u0026#34;æˆå‘˜æœåŠ¡å™¨\u0026#34;ã€‚ # ä½œä¸º \u0026#34;æ´»åŠ¨ç›®å½•åŸŸæ§åˆ¶å™¨\u0026#34; è¿è¡Œå°†éœ€è¦é¦–å…ˆè¿è¡Œ \u0026#34;samba-tool domain provision\u0026#34; æ¥æ¸…é™¤æ•°æ®åº“å¹¶åˆ›å»ºä¸€ä¸ªæ–°åŸŸã€‚ server role = standalone server obey pam restrictions = yes # æ­¤å¸ƒå°”å‚æ•°æ§åˆ¶å½“ passdb ä¸­çš„åŠ å¯† SMB å¯†ç è¢«æ›´æ”¹æ—¶ï¼ŒSamba æ˜¯å¦å°è¯•åŒæ­¥ Unix å¯†ç ä¸ SMB å¯†ç ã€‚ unix password sync = yes # åœ¨ Debian GNU/Linux ç³»ç»Ÿä¸Šï¼Œè¦ä½¿ Unix å¯†ç åŒæ­¥å·¥ä½œï¼Œå¿…é¡»è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼ˆæ„Ÿè°¢ Ian Kahan \u0026lt;\u0026lt;kahan@informatik.tu-muenchen.de\u0026gt; å‘é€äº†åœ¨ Debian Sarge ä¸­ passwd ç¨‹åºçš„æ­£ç¡®èŠå¤©è„šæœ¬ï¼‰ã€‚ passwd program = /usr/bin/passwd %u passwd chat = *Enter\\snew\\s*\\spassword:* %n\\n *Retype\\snew\\s*\\spassword:* %n\\n *password\\supdated\\ssuccessfully* . # æ­¤å¸ƒå°”å€¼æ§åˆ¶å½“ SMB å®¢æˆ·ç«¯è¯·æ±‚æ›´æ”¹å¯†ç æ—¶ï¼ŒPAM æ˜¯å¦å°†ç”¨äºå¯†ç æ›´æ”¹ï¼Œè€Œä¸æ˜¯ \u0026#39;passwd program\u0026#39; ä¸­åˆ—å‡ºçš„ç¨‹åºã€‚é»˜è®¤ä¸º \u0026#39;no\u0026#39;ã€‚ pam password change = yes # æ­¤é€‰é¡¹æ§åˆ¶å¦‚ä½•å°†ä¸æˆåŠŸçš„è®¤è¯å°è¯•æ˜ å°„åˆ°åŒ¿åè¿æ¥ map to guest = bad user ########## åŸŸ ############ # å¦‚æœè®¾ç½®äº† \u0026#39;server role = classic primary domain controller\u0026#39;ã€\u0026#39;server role = classic backup domain controller\u0026#39; æˆ– \u0026#39;domain logons\u0026#39;ï¼Œåˆ™ä»¥ä¸‹è®¾ç½®æ‰ä¼šç”Ÿæ•ˆ # å®ƒæŒ‡å®šäº†ç”¨æˆ·é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼ˆä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼‰ã€‚ä»¥ä¸‹éœ€è¦åœ¨ Samba æœåŠ¡å™¨ä¸Šè®¾ç½® [profiles] å…±äº«ï¼ˆè§ä¸‹æ–‡ï¼‰ ; logon path = \\\\%N\\profiles\\%U # å¦ä¸€ä¸ªå¸¸è§çš„é€‰æ‹©æ˜¯å°†é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ï¼ˆè¿™æ˜¯ Samba çš„é»˜è®¤è®¾ç½®ï¼‰ # logon path = \\\\%N\\%U\\profile # å¦‚æœè®¾ç½®äº† \u0026#39;domain logons\u0026#39;ï¼Œåˆ™ä»¥ä¸‹è®¾ç½®æ‰ä¼šç”Ÿæ•ˆ # å®ƒæŒ‡å®šäº†ç”¨æˆ·ä¸»ç›®å½•çš„ä½ç½®ï¼ˆä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼‰ ; logon drive = H: # logon home = \\\\%N\\%U # å¦‚æœè®¾ç½®äº† \u0026#39;domain logons\u0026#39;ï¼Œåˆ™ä»¥ä¸‹è®¾ç½®æ‰ä¼šç”Ÿæ•ˆ # å®ƒæŒ‡å®šäº†ç™»å½•æœŸé—´è¦è¿è¡Œçš„è„šæœ¬ã€‚è„šæœ¬å¿…é¡»å­˜å‚¨åœ¨ [netlogon] å…±äº«ä¸­ # æ³¨æ„ï¼šå¿…é¡»ä»¥ \u0026#39;DOS\u0026#39; æ–‡ä»¶æ ¼å¼çº¦å®šå­˜å‚¨ ; logon script = logon.cmd # è¿™å…è®¸é€šè¿‡ SAMR RPC ç®¡é“åœ¨åŸŸæ§åˆ¶å™¨ä¸Šåˆ›å»º Unix ç”¨æˆ·ã€‚ç¤ºä¾‹å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ª Unix å¯†ç è¢«ç¦ç”¨çš„ç”¨æˆ·å¸æˆ·ï¼›è¯·æ ¹æ®æ‚¨çš„éœ€è¦è¿›è¡Œè°ƒæ•´ ; add user script = /usr/sbin/useradd --create-home %u # è¿™å…è®¸é€šè¿‡ SAMR RPC ç®¡é“åœ¨åŸŸæ§åˆ¶å™¨ä¸Šåˆ›å»ºæœºå™¨å¸æˆ·ã€‚ # ä»¥ä¸‹å‡è®¾ç³»ç»Ÿä¸Šå­˜åœ¨ä¸€ä¸ª \u0026#34;machines\u0026#34; ç»„ ; add machine script = /usr/sbin/useradd -g machines -c \u0026#34;%u machine account\u0026#34; -d /var/lib/samba -s /bin/false %u # è¿™å…è®¸é€šè¿‡ SAMR RPC ç®¡é“åœ¨åŸŸæ§åˆ¶å™¨ä¸Šåˆ›å»º Unix ç»„ã€‚ ; add group script = /usr/sbin/addgroup --force-badname %g ############ æ‚é¡¹ ############ # ä½¿ç”¨ä»¥ä¸‹è¡Œå¯ä»¥åŸºäºæ¯å°æœºå™¨è‡ªå®šä¹‰æ‚¨çš„é…ç½®ã€‚ # %m è¢«æ›¿æ¢ä¸ºè¿æ¥çš„æœºå™¨çš„ netbios åç§° ; include = /home/samba/etc/smb.conf.%m # ä¸€äº› winbind çš„é»˜è®¤è®¾ç½®ï¼ˆç¡®ä¿æ‚¨æ²¡æœ‰ä¸ºå…¶ä»–ç”¨é€”ä½¿ç”¨è¿™äº›èŒƒå›´ï¼‰ã€‚ ; idmap config * : backend = tdb ; idmap config * : range = 3000-7999 ; idmap config YOURDOMAINHERE : backend = tdb ; idmap config YOURDOMAINHERE : range = 100000-999999 ; template shell = /bin/bash # è®¾ç½® usershare é€‰é¡¹ä»¥å…è®¸é root ç”¨æˆ·ä½¿ç”¨ net usershare å‘½ä»¤å…±äº«æ–‡ä»¶å¤¹ã€‚ # æœ€å¤§ç”¨æˆ·å…±äº«æ•°é‡ã€‚0 è¡¨ç¤ºç¦ç”¨ usershareã€‚ # usershare max shares = 100 # å…è®¸å·²è¢«æˆäºˆ usershare æƒé™çš„ç”¨æˆ·åˆ›å»ºå…¬å…±å…±äº«ï¼Œè€Œä¸ä»…ä»…æ˜¯ç»è¿‡èº«ä»½éªŒè¯çš„å…±äº« usershare allow guests = yes #======================= å…±äº«å®šä¹‰ ======================= [homes] comment = Home Directories browseable = no # é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»ç›®å½•ä»¥åªè¯»æ–¹å¼å¯¼å‡ºã€‚å¦‚æœæ‚¨æƒ³è¦èƒ½å¤Ÿå†™å…¥å®ƒä»¬ï¼Œè¯·å°†ä¸‹ä¸€ä¸ªå‚æ•°æ›´æ”¹ä¸º \u0026#39;no\u0026#39;ã€‚ åªè¯» = æ˜¯ # å‡ºäºå®‰å…¨åŸå› ï¼Œæ–‡ä»¶åˆ›å»ºæ©ç è®¾ç½®ä¸º 0700ã€‚å¦‚æœæ‚¨æƒ³è¦åˆ›å»ºå…·æœ‰ group=rw æƒé™çš„æ–‡ä»¶ï¼Œè¯·å°†ä¸‹ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º 0775ã€‚ åˆ›å»ºæ©ç  = 0700 # å‡ºäºå®‰å…¨åŸå› ï¼Œç›®å½•åˆ›å»ºæ©ç è®¾ç½®ä¸º 0700ã€‚å¦‚æœæ‚¨æƒ³è¦åˆ›å»ºå…·æœ‰ group=rw æƒé™çš„ç›®å½•ï¼Œè¯·å°†ä¸‹ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º 0775ã€‚ ç›®å½•æ©ç  = 0700 # é»˜è®¤æƒ…å†µä¸‹ï¼Œ\\\\æœåŠ¡å™¨\\ç”¨æˆ·å å…±äº«å¯ä»¥ç”±ä»»ä½•æœ‰è®¿é—® Samba æœåŠ¡å™¨æƒé™çš„äººè¿æ¥ã€‚ # ä¸‹ä¸€ä¸ªå‚æ•°ç¡®ä¿åªæœ‰ \u0026#34;ç”¨æˆ·å\u0026#34; æ‰èƒ½è¿æ¥åˆ° \\\\æœåŠ¡å™¨\\ç”¨æˆ·å # å½“ä½¿ç”¨å¤–éƒ¨è®¤è¯æ–¹æ¡ˆæ—¶ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ æœ‰æ•ˆç”¨æˆ· = %S # å–æ¶ˆæ³¨é‡Šä»¥ä¸‹å†…å®¹å¹¶ä¸ºåŸŸç™»å½•åˆ›å»º netlogon ç›®å½• # ï¼ˆæ‚¨éœ€è¦é…ç½® Samba ä»¥å……å½“åŸŸæ§åˆ¶å™¨ã€‚ï¼‰ ;[netlogon] ; comment = Network Logon Service ; path = /home/samba/netlogon ; guest ok = yes ; read only = yes # å–æ¶ˆæ³¨é‡Šä»¥ä¸‹å†…å®¹å¹¶åˆ›å»º profiles ç›®å½•ä»¥å­˜å‚¨ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼ˆè§ä¸Šé¢çš„ \u0026#34;ç™»å½•è·¯å¾„\u0026#34; é€‰é¡¹ï¼‰ # ï¼ˆæ‚¨éœ€è¦é…ç½® Samba ä»¥å……å½“åŸŸæ§åˆ¶å™¨ã€‚ï¼‰ # ä¸‹é¢çš„è·¯å¾„åº”è¯¥æ˜¯å¯å†™å…¥çš„ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶å¯ä»¥åˆ›å»ºä»–ä»¬çš„é…ç½®æ–‡ä»¶ç›®å½• ;[profiles] ; comment = Users profiles ; path = /home/samba/profiles ; guest ok = no ; browseable = no ; create mask = 0600 ; directory mask = 0700 [printers] comment = All Printers browseable = no path = /var/tmp printable = yes guest ok = no read only = yes create mask = 0700 # Windows å®¢æˆ·ç«¯å°†æ­¤å…±äº«åç§°è§†ä¸ºå¯ä¸‹è½½æ‰“å°æœºé©±åŠ¨ç¨‹åºçš„æ¥æº [print$] comment = Printer Drivers path = /var/lib/samba/printers browseable = yes read only = yes guest ok = no # å–æ¶ˆæ³¨é‡Šä»¥å…è®¸è¿œç¨‹ç®¡ç† Windows æ‰“å°æœºé©±åŠ¨ç¨‹åºã€‚ # æ‚¨å¯èƒ½éœ€è¦å°† \u0026#39;lpadmin\u0026#39; æ›¿æ¢ä¸ºæ‚¨çš„ç®¡ç†å‘˜ç”¨æˆ·æ‰€åœ¨çš„ç»„çš„åç§°ã€‚ # è¯·æ³¨æ„ï¼Œæ‚¨è¿˜éœ€è¦ä¸ºè¿™äº›ç”¨æˆ·è®¾ç½®é€‚å½“çš„ Unix æƒé™ï¼Œä»¥ä¾¿ä»–ä»¬å¯¹é©±åŠ¨ç¨‹åºç›®å½•å…·æœ‰å†™å…¥æƒé™ ; å†™å…¥åˆ—è¡¨ = root, @lpadmin ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [Backup] comment = mysamba path = /var/lib/vz/dump browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no [PVE-ntfs] comment = mysamba path = /mnt/ntfs browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no EOF systemctl restart smbd 4. è¿½åŠ é¢å¤–å…±äº«é…ç½®ï¼ˆå¯é€‰ï¼‰ å¦‚æœéœ€è¦æ·»åŠ æ›´å¤šå…±äº«ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 mkdir -pm 755 /mnt/mydisk \u0026amp;\u0026amp; chmod +x /etc/samba/smb.conf \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [PVE-mydisk] comment = mysamba path = /mnt/mydisk browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no EOF systemctl restart smbd ğŸš€ ä¸‰ã€ä¸€é”®éƒ¨ç½²è„šæœ¬ 1. åˆ›å»ºå¹¶æ‰§è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 touch ~/smb.sh \u0026amp;\u0026amp; cat \u0026gt; ~/smb.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash apt update \u0026amp;\u0026amp; apt install samba -y mkdir -pm 755 /mnt/ntfs \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;MYENDMARK ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [local] ## è¿™æ˜¯æˆ‘çš„å…±äº«åç§° comment = mysamba ## å…±äº«ç›®å½•çš„è·¯å¾„ path = /var/lib/vz/ ## æŒ‡å®šå…±äº«æ˜¯å¦åº”è¯¥åœ¨ç½‘ç»œé‚»å±…ä¸­è¢«æµè§ˆåˆ°ï¼Œyesæ˜¾ç¤ºå…±äº«åç§°ï¼Œnoéšè—å…±äº«åç§°ã€‚ browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no [PVE-ntfs] ## è¿™æ˜¯æˆ‘çš„å…±äº«åç§° comment = mysamba ## å…±äº«ç›®å½•çš„è·¯å¾„ path = /mnt/ntfs ## æŒ‡å®šå…±äº«æ˜¯å¦åº”è¯¥åœ¨ç½‘ç»œé‚»å±…ä¸­è¢«æµè§ˆåˆ°ï¼Œyesæ˜¾ç¤ºå…±äº«åç§°ï¼Œnoéšè—å…±äº«åç§°ã€‚ browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no MYENDMARK ## æ–°å»ºadminç”¨æˆ· \u0026amp;\u0026amp; ä¸ºadminç”¨æˆ·åˆ›å»ºä¸¤æ¬¡å¯†ç  useradd admin 2\u0026gt;/dev/null || true (echo yifan0719; echo yifan0719) | smbpasswd -a -s admin systemctl restart smbd EOF chmod +x ~/smb.sh \u0026amp;\u0026amp; bash ~/smb.sh 2. æŸ¥çœ‹è„šæœ¬å†…å®¹ 1 cat ~/smb.sh ğŸ” å››ã€éªŒè¯ä¸æµ‹è¯• 1. æ£€æŸ¥ Samba æœåŠ¡çŠ¶æ€ 1 systemctl status smbd 2. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• 1 testparm 3. æŸ¥çœ‹å…±äº«åˆ—è¡¨ 1 smbclient -L localhost -U admin 4. ä»å®¢æˆ·ç«¯è®¿é—®å…±äº« åœ¨ Windows å®¢æˆ·ç«¯ä¸Šï¼Œæ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œè¾“å…¥ï¼š\n1 \\\\PVEæœåŠ¡å™¨IPåœ°å€ ä½¿ç”¨ admin ç”¨æˆ·å’Œè®¾ç½®çš„å¯†ç ç™»å½•\nğŸ› ï¸ äº”ã€ç®¡ç†å‘½ä»¤ 1. æ·»åŠ æ–°ç”¨æˆ· 1 2 3 4 5 # æ·»åŠ ç³»ç»Ÿç”¨æˆ· useradd newuser # è®¾ç½®Sambaå¯†ç  smbpasswd -a newuser 2. åˆ é™¤ç”¨æˆ· 1 2 3 4 5 # ä»Sambaä¸­åˆ é™¤ç”¨æˆ· smbpasswd -x username # åˆ é™¤ç³»ç»Ÿç”¨æˆ· userdel username 3. é‡æ–°åŠ è½½é…ç½® 1 2 3 4 5 # é‡æ–°åŠ è½½Sambaé…ç½®ï¼ˆä¸ä¸­æ–­ç°æœ‰è¿æ¥ï¼‰ systemctl reload smbd # æˆ–å®Œå…¨é‡å¯æœåŠ¡ systemctl restart smbd ğŸ’¡ å…­ã€æ•…éšœæ’é™¤ 1. æƒé™é—®é¢˜ å¦‚æœæ— æ³•è®¿é—®å…±äº«ï¼Œæ£€æŸ¥ç›®å½•æƒé™ï¼š\n1 2 chmod -R 755 /å…±äº«ç›®å½• chown -R admin:root /å…±äº«ç›®å½• 2. é˜²ç«å¢™é…ç½® ç¡®ä¿é˜²ç«å¢™å…è®¸ Samba æµé‡ï¼š\n1 2 # å…è®¸Sambaç›¸å…³ç«¯å£ ufw allow samba 3. æŸ¥çœ‹æ—¥å¿— æ£€æŸ¥ Samba æ—¥å¿—ä»¥è¯Šæ–­é—®é¢˜ï¼š\n1 2 tail -f /var/log/samba/log.smbd tail -f /var/log/samba/log.nmbd ğŸ”’ ä¸ƒã€å®‰å…¨å»ºè®® ğŸ” å®šæœŸæ›´æ–°å¯†ç ï¼šå®šæœŸæ›´æ”¹ Samba ç”¨æˆ·å¯†ç  ğŸ›¡ï¸ é™åˆ¶è®¿é—®ï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ Samba ç«¯å£çš„è®¿é—® ğŸ‘¤ ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·ï¼šä¸º Samba å…±äº«åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼Œé¿å…ä½¿ç”¨ root ğŸ’¾ å®šæœŸå¤‡ä»½é…ç½®ï¼šå¤‡ä»½ /etc/samba/smb.conf æ–‡ä»¶ ğŸ“Š ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥ Samba æ—¥å¿—æ–‡ä»¶ ğŸš€ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»åœ¨ PVE ä¸ŠæˆåŠŸéƒ¨ç½²äº† Samba æœåŠ¡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨ç½‘ç»œä¸­å…±äº«æ–‡ä»¶ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ¯”åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œé»‘ç¾¤æ™–æ€§èƒ½æ›´é«˜ï¼Œæ›´ç›´æ¥åœ°åˆ©ç”¨ç¡¬ä»¶èµ„æºï¼\n","date":"2024-12-07T14:53:34+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/b76332d2/","title":"Proxmox VE éƒ¨ç½² Samba æœåŠ¡æŒ‡å— ğŸ–¥ï¸"},{"content":"Typecho æ–‡ç« æ ‡ç­¾é€‰æ‹©å™¨æ’ä»¶ ğŸ·ï¸ âœ¨ è®© Typecho æ–‡ç« æ ‡ç­¾ç®¡ç†å˜å¾—å‰æ‰€æœªæœ‰çš„ç›´è§‚é«˜æ•ˆï¼Œæå¤§æå‡å†™ä½œä½“éªŒï¼\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ æ’ä»¶ä»‹ç» âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ“¥ å®‰è£…æ–¹æ³• ğŸŒ æ–¹æ³•ä¸€ï¼šå®˜æ–¹ä¸‹è½½ âš™ï¸ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»º ğŸ”§ ä½¿ç”¨æ–¹æ³• ğŸ› ï¸ è‡ªå®šä¹‰é…ç½® â“ å¸¸è§é—®é¢˜ ğŸ”„ æ›´æ–°æ—¥å¿— ğŸ¯ æ’ä»¶ä»‹ç» TagsHelper æ˜¯ä¸€æ¬¾ä¸“ä¸º Typecho è®¾è®¡çš„å®ç”¨å‹æ’ä»¶ï¼Œå®ƒåœ¨æ–‡ç« ç¼–è¾‘é¡µé¢æ·»åŠ äº†ä¸€ä¸ªç›´è§‚çš„æ ‡ç­¾é€‰æ‹©é¢æ¿ï¼Œå½»åº•æ”¹å˜äº†ä¼ ç»Ÿæ‰‹åŠ¨è¾“å…¥æ ‡ç­¾çš„æ–¹å¼ã€‚æ— è®ºä½ æ˜¯ä¸ªäººåšä¸»è¿˜æ˜¯å†…å®¹åˆ›ä½œå›¢é˜Ÿï¼Œè¿™ä¸ªæ’ä»¶éƒ½èƒ½æ˜¾è‘—æå‡ä½ çš„å†…å®¹ç®¡ç†æ•ˆç‡ï¼\nâœ¨ åŠŸèƒ½ç‰¹ç‚¹ â€¢ ğŸ¯ å¯è§†åŒ–æ ‡ç­¾ç®¡ç† - ä»¥ç›´è§‚é¢æ¿å½¢å¼å±•ç¤ºæ‰€æœ‰ç°æœ‰æ ‡ç­¾ï¼Œå‘Šåˆ«è®°å¿†è´Ÿæ‹…\nâ€¢ âš¡ ä¸€é”®å¿«é€Ÿæ·»åŠ  - ç‚¹å‡»å³å¯å°†æ ‡ç­¾æ·»åŠ åˆ°æ–‡ç« ï¼Œå‡å°‘æ‰“å­—é”™è¯¯å’Œé‡å¤åŠ³åŠ¨\nâ€¢ ğŸ¨ æ™ºèƒ½æ’åºç³»ç»Ÿ - æ”¯æŒæŒ‰ä½¿ç”¨é¢‘ç‡æˆ–å­—æ¯é¡ºåºæ’åˆ—ï¼Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€æ ‡ç­¾\nâ€¢ ğŸ“Š çƒ­é—¨æ ‡ç­¾çªå‡º - å¸¸ç”¨æ ‡ç­¾è‡ªåŠ¨å‰ç½®ï¼Œæé«˜å†…å®¹æ ‡ç­¾ä¸€è‡´æ€§\nâ€¢ ğŸ”§ é«˜åº¦å¯å®šåˆ¶ - å¯è°ƒæ•´æ˜¾ç¤ºæ ‡ç­¾æ•°é‡å’Œæ’åºæ–¹å¼ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚\nâ€¢ ğŸ’» è½»é‡çº§è®¾è®¡ - ä¸å½±å“åå°åŠ è½½é€Ÿåº¦ï¼Œæ— ç¼é›†æˆTypechoç¼–è¾‘ç•Œé¢\nâ€¢ ğŸ†“ å®Œå…¨å¼€æº - åŸºäºMITåè®®å¼€æºï¼Œå¯è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹\nğŸ“¥ å®‰è£…æ–¹æ³• ğŸŒ æ–¹æ³•ä¸€ï¼šå®˜æ–¹ä¸‹è½½ï¼ˆæ¨èï¼‰ è®¿é—®å®˜æ–¹é¡µé¢è·å–æ’ä»¶\nä¸­æ–‡ä»‹ç»é¡µï¼š https://typecho.work/archives/tagshelper.html GitHub ä»“åº“ï¼š https://github.com/typecho-fans/plugins/tree/master/tagshelper ä¸‹è½½å¹¶å®‰è£…æ’ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 # è¿›å…¥Typechoæ’ä»¶ç›®å½• cd /path/to/your/typecho/usr/plugins # ä¸‹è½½æ’ä»¶å‹ç¼©åŒ…ï¼ˆå¦‚æœä½¿ç”¨wgetï¼‰ wget https://github.com/typecho-fans/plugins/raw/master/tagshelper/tagshelper.zip # è§£å‹æ’ä»¶ unzip tagshelper.zip # è®¾ç½®é€‚å½“æƒé™ï¼ˆæ ¹æ®ä½ çš„æœåŠ¡å™¨ç¯å¢ƒè°ƒæ•´ï¼‰ chmod -R 755 tagshelper chown -R www-data:www-data tagshelper å¯ç”¨æ’ä»¶\nç™»å½•Typechoåå°ï¼Œè¿›å…¥\u0026quot;æ§åˆ¶å°\u0026quot; â†’ \u0026ldquo;æ’ä»¶\u0026rdquo; æ‰¾åˆ°TagsHelperæ’ä»¶å¹¶ç‚¹å‡»\u0026quot;å¯ç”¨\u0026quot; âš™ï¸ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ›å»º å¦‚æœæ— æ³•ä»å®˜æ–¹ä¸‹è½½ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ’ä»¶æ–‡ä»¶ï¼š\nåˆ›å»ºæ’ä»¶ç›®å½•å’Œæ–‡ä»¶\n1 2 3 4 5 # åˆ›å»ºæ’ä»¶ç›®å½• mkdir -p /path/to/your/typecho/usr/plugins/tagshelper # åˆ›å»ºä¸»æ’ä»¶æ–‡ä»¶ touch /path/to/your/typecho/usr/plugins/tagshelper/Plugin.php ç¼–è¾‘Plugin.phpæ–‡ä»¶å†…å®¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 \u0026lt;?php /** * åå°ç¼–è¾‘æ–‡ç« æ—¶å¢åŠ æ ‡ç­¾é€‰æ‹©åˆ—è¡¨ * * @package tagshelper * @author æ³½æ³½ç¤¾é•¿ * @version 1.1 * @link http://blog.zezeshe.com */ class tagshelper_Plugin implements Typecho_Plugin_Interface { public static function activate() { Typecho_Plugin::factory(\u0026#39;admin/write-post.php\u0026#39;)-\u0026gt;bottom = array(\u0026#39;tagshelper_Plugin\u0026#39;, \u0026#39;tagslist\u0026#39;); } /* ç¦ç”¨æ’ä»¶æ–¹æ³• */ public static function deactivate(){} public static function config(Typecho_Widget_Helper_Form $form){} public static function personalConfig(Typecho_Widget_Helper_Form $form){} public static function tagslist() { ?\u0026gt; \u0026lt;style\u0026gt; .tagshelper a { cursor: pointer; padding: 0px 6px; margin: 2px 0; display: inline-block; border-radius: 2px; text-decoration: none; } .tagshelper a:hover { background: #ccc; color: #fff; } \u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; $(document).ready(function(){ $(\u0026#39;#tags\u0026#39;).after(\u0026#39;\u0026lt;div style=\u0026#34;margin-top: 35px;\u0026#34; class=\u0026#34;tagshelper\u0026#34;\u0026gt;\u0026lt;ul style=\u0026#34;list-style: none;border: 1px solid #D9D9D6;padding: 6px 12px; max-height: 240px;overflow: auto;background-color: #FFF;border-radius: 2px;\u0026#34;\u0026gt;\u0026lt;?php $i=0; Typecho_Widget::widget(\u0026#39;Widget_Metas_Tag_Cloud\u0026#39;, \u0026#39;sort=count\u0026amp;desc=1\u0026amp;limit=200\u0026#39;)-\u0026gt;to($tags); while ($tags-\u0026gt;next()) { echo \u0026#34;\u0026lt;a id=\u0026#39;\u0026#34;.$i.\u0026#34;\u0026#39; onclick=\\\u0026#34;$(\u0026#39;#tags\u0026#39;).tokenInput(\u0026#39;add\u0026#39;, {id: \u0026#39;\u0026#34;.$tags-\u0026gt;name.\u0026#34;\u0026#39;, tags: \u0026#39;\u0026#34;.$tags-\u0026gt;name.\u0026#34;\u0026#39;});\\\u0026#34;\u0026gt;\u0026#34;.$tags-\u0026gt;name.\u0026#34;\u0026lt;/a\u0026gt;\u0026#34;; $i++; } ?\u0026gt;\u0026lt;/ul\u0026gt;\u0026lt;/div\u0026gt;\u0026#39;); }); \u0026lt;/script\u0026gt; \u0026lt;?php } } ?\u0026gt; ğŸ”§ ä½¿ç”¨æ–¹æ³• å¯ç”¨æ’ä»¶å\nåˆ›å»ºæˆ–ç¼–è¾‘æ–‡ç« æ—¶ï¼Œæ»šåŠ¨åˆ°æ ‡ç­¾è¾“å…¥æ¡†ä¸‹æ–¹ å³å¯çœ‹åˆ°æ ‡ç­¾é€‰æ‹©é¢æ¿ ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨\nğŸ“Œ ç‚¹å‡»é¢æ¿ä¸­çš„ä»»æ„æ ‡ç­¾å³å¯æ·»åŠ åˆ°å½“å‰æ–‡ç«  ğŸ” é¢æ¿é»˜è®¤æ˜¾ç¤ºæœ€å¸¸ç”¨çš„200ä¸ªæ ‡ç­¾ ğŸ·ï¸ å·²æ·»åŠ çš„æ ‡ç­¾ä¼šæ­£å¸¸æ˜¾ç¤ºåœ¨æ ‡ç­¾è¾“å…¥æ¡†ä¸­ ä¸ä¼ ç»Ÿæ–¹å¼ç»“åˆ\nä½ ä»ç„¶å¯ä»¥æ‰‹åŠ¨è¾“å…¥æ ‡ç­¾ é€‰æ‹©å™¨åªæ˜¯æä¾›äº†æ›´ç›´è§‚çš„æ·»åŠ æ–¹å¼ ğŸ› ï¸ è‡ªå®šä¹‰é…ç½® æ’ä»¶æä¾›ä»¥ä¸‹é…ç½®é€‰é¡¹ï¼ˆé€šè¿‡æ’ä»¶è®¾ç½®ç•Œé¢è°ƒæ•´ï¼‰ï¼š\né…ç½®é€‰é¡¹ è¯´æ˜ é»˜è®¤å€¼ æ˜¾ç¤ºæ ‡ç­¾æ•°é‡ æ§åˆ¶æ ‡ç­¾é¢æ¿ä¸­æœ€å¤šæ˜¾ç¤ºå¤šå°‘ä¸ªæ ‡ç­¾ 200 æ’åºæ–¹å¼ æ”¯æŒæŒ‰ä½¿ç”¨æ¬¡æ•°é™åºæˆ–æŒ‰å­—æ¯é¡ºåºæ’åˆ— æŒ‰ä½¿ç”¨æ¬¡æ•° é…ç½®ç¤ºä¾‹ï¼š\nå¦‚æœä½ æœ‰å¤§é‡æ ‡ç­¾ï¼Œå¯ä»¥å¢åŠ æ˜¾ç¤ºæ•°é‡åˆ°500 å¦‚æœå¸Œæœ›æŒ‰å­—æ¯é¡ºåºæŸ¥æ‰¾ï¼Œå¯ä»¥åˆ‡æ¢æ’åºæ–¹å¼ â“ å¸¸è§é—®é¢˜ â“ æ’ä»¶å¯ç”¨åæ²¡æœ‰æ˜¾ç¤ºæ ‡ç­¾é¢æ¿ï¼Ÿ\nâœ… ç¡®ä¿æ’ä»¶å·²æ­£ç¡®ä¸Šä¼ åˆ° /usr/plugins/tagshelper/ ç›®å½• âœ… æ£€æŸ¥æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®ï¼ˆé€šå¸¸755å¯¹äºç›®å½•ï¼Œ644å¯¹äºæ–‡ä»¶ï¼‰ âœ… æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•ï¼ˆCtrl+F5å¼ºåˆ¶åˆ·æ–°ï¼‰ â“ ç‚¹å‡»æ ‡ç­¾æ²¡æœ‰ååº”ï¼Ÿ\nâœ… ç¡®ä¿é¡µé¢å·²å®Œå…¨åŠ è½½JavaScriptèµ„æº âœ… æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ï¼ˆF12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼‰ âœ… ç¡®è®¤æ²¡æœ‰ä¸å…¶ä»–æ’ä»¶æˆ–ä¸»é¢˜çš„JavaScriptå†²çª â“ å¦‚ä½•ä¿®æ”¹æ ‡ç­¾é¢æ¿çš„æ ·å¼ï¼Ÿ\nâœ… ç¼–è¾‘Plugin.phpæ–‡ä»¶ä¸­çš„CSSéƒ¨åˆ† âœ… å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´é¢œè‰²ã€å¤§å°ã€è¾¹æ¡†ç­‰æ ·å¼ âœ… å»ºè®®ä¿ç•™åŸºæœ¬çš„äº¤äº’é€»è¾‘ä¸å˜ â“ æ ‡ç­¾æ˜¾ç¤ºä¸å…¨æ€ä¹ˆåŠï¼Ÿ\nâœ… åœ¨æ’ä»¶è®¾ç½®ä¸­å¢åŠ \u0026quot;æ˜¾ç¤ºæ ‡ç­¾æ•°é‡\u0026quot;çš„å€¼ âœ… ç¡®ä¿ä½ çš„æ ‡ç­¾æ•°é‡æ²¡æœ‰è¶…è¿‡è®¾ç½®çš„é™åˆ¶ âœ… æ£€æŸ¥æ˜¯å¦æœ‰æ ‡ç­¾åŒ…å«ç‰¹æ®Šå­—ç¬¦å¯¼è‡´æ˜¾ç¤ºé—®é¢˜ â“ æ’ä»¶å…¼å®¹æ€§å¦‚ä½•ï¼Ÿ\nâœ… å…¼å®¹Typecho 1.0åŠä»¥ä¸Šç‰ˆæœ¬ âœ… æ”¯æŒå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariã€Edgeï¼‰ âœ… ä¸å®˜æ–¹ç¼–è¾‘å™¨å’Œå…¶ä»–å¸¸ç”¨æ’ä»¶å…¼å®¹ ğŸ”„ æ›´æ–°æ—¥å¿— v1.1 (å½“å‰ç‰ˆæœ¬)\nâœ¨ å¢åŠ æ ‡ç­¾é¢æ¿æ»šåŠ¨åŠŸèƒ½ï¼Œæ”¯æŒå¤§é‡æ ‡ç­¾æ˜¾ç¤º ğŸ› ä¿®å¤ç‰¹æ®Šå­—ç¬¦æ ‡ç­¾çš„æ˜¾ç¤ºé—®é¢˜ ğŸ¨ ä¼˜åŒ–é¢æ¿æ ·å¼å’Œç”¨æˆ·ä½“éªŒ v1.0 (åˆå§‹ç‰ˆæœ¬)\nğŸš€ é¦–æ¬¡å‘å¸ƒï¼ŒåŸºæœ¬æ ‡ç­¾é€‰æ‹©åŠŸèƒ½ âœ… æ”¯æŒç‚¹å‡»æ·»åŠ æ ‡ç­¾åˆ°æ–‡ç«  ğŸ’¡ æç¤ºå»ºè®®ï¼šå®šæœŸå…³æ³¨å®˜æ–¹GitHubé¡µé¢è·å–æ›´æ–°ç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿è·å¾—æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨ä¿®å¤ã€‚å¦‚æœä½ æ˜¯å¼€å‘è€…ï¼Œæ¬¢è¿è´¡çŒ®ä»£ç æˆ–æå‡ºæ”¹è¿›å»ºè®®ï¼\nğŸ› å‘ç°é—®é¢˜ï¼Ÿè¯·åœ¨GitHubä»“åº“æäº¤Issueï¼š https://github.com/typecho-fans/plugins/issues â­ å¦‚æœè§‰å¾—è¿™ä¸ªæ’ä»¶æœ‰ç”¨ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼\n","date":"2024-12-07T14:52:50+08:00","image":"https://file.meimolihan.eu.org/img/typecho-01.webp","permalink":"https://blog.meimolihan.eu.org/p/90b4c270/","title":"Typecho æ–‡ç« æ ‡ç­¾é€‰æ‹©å™¨æ’ä»¶ ğŸ·ï¸"},{"content":"Proxmox VE æŒ‚è½½å·²æœ‰æ•°æ®çš„ ext4 å’Œ NTFS ç¡¬ç›˜ ğŸ§ æœ¬æŒ‡å—è¯¦ç»†è®²è§£å¦‚ä½•åœ¨ Proxmox VE ä¸­æ— æŸæŒ‚è½½å·²åŒ…å«æ•°æ®çš„ ext4 å’Œ NTFS æ ¼å¼ç¡¬ç›˜ï¼Œæ— éœ€æ ¼å¼åŒ–å³å¯ç›´æ¥è®¿é—®å’Œä½¿ç”¨ç°æœ‰æ•°æ®ã€‚å®Œç¾è§£å†³ PVE Web é¢æ¿æ— æ³•ç›´æ¥æŒ‚è½½å·²æœ‰æ•°æ®ç¡¬ç›˜çš„é—®é¢˜ï¼\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ æ¦‚è¿° âœ¨ å†…å®¹ç‰¹ç‚¹ ğŸ§ ä¸€æŒ‚è½½-ext4-æ ¼å¼ç¡¬ç›˜ ğŸ’¾ äºŒæŒ‚è½½-ntfs-æ ¼å¼ç¡¬ç›˜ âš™ï¸ ä¸‰é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ”§ å››å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ ğŸ“Š äº”æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§å¯¹æ¯” ğŸ’¡ å…­æœ€ä½³å®è·µå»ºè®® ğŸš¨ ä¸ƒæ³¨æ„äº‹é¡¹ä¸è­¦å‘Š âœ¨ æ¦‚è¿° Proxmox VE Web é¢æ¿é»˜è®¤åªèƒ½æ·»åŠ æ–°ç¡¬ç›˜å¹¶åˆå§‹åŒ–ï¼Œæ— æ³•ç›´æ¥æŒ‚è½½å·²æ ¼å¼åŒ–çš„å«æœ‰æ•°æ®çš„ç¡¬ç›˜ã€‚è¿™ç»™éœ€è¦è¿ç§»ç°æœ‰æ•°æ®çš„ç”¨æˆ·å¸¦æ¥äº†ä¸ä¾¿ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨æŒ‚è½½ ext4 å’Œ NTFS æ ¼å¼çš„ç¡¬ç›˜ï¼Œå¹¶ä½¿å…¶åœ¨ PVE ä¸­å¯ç”¨ï¼ŒåŒæ—¶ä¿æŒåŸæœ‰æ•°æ®å®Œæ•´æ— æŸã€‚\né€‚ç”¨åœºæ™¯ï¼š\nğŸ”„ ä»å…¶ä»–ç³»ç»Ÿè¿ç§»æ•°æ®åˆ° PVE ğŸ’¾ ç›´æ¥è®¿é—® Windows ç³»ç»Ÿä¸­çš„æ–‡ä»¶ ğŸ—‚ï¸ å…±äº«å­˜å‚¨ç©ºé—´ between multiple containers ğŸ“€ åˆ©ç”¨ç°æœ‰ç¡¬ç›˜æ‰©å±• PVE å­˜å‚¨ âœ¨ å†…å®¹ç‰¹ç‚¹ ğŸš€ æ— æŸæŒ‚è½½ï¼šæ— éœ€æ ¼å¼åŒ–ï¼Œä¿ç•™åŸæœ‰æ•°æ®å®Œæ•´\nğŸ¯ åŒç³»ç»Ÿæ”¯æŒï¼šåŒæ—¶è¦†ç›– ext4 (Linux) å’Œ NTFS (Windows) æ–‡ä»¶ç³»ç»Ÿ\nâš¡ æ€§èƒ½ä¼˜åŒ–ï¼šæä¾›é’ˆå¯¹æœºæ¢°ç¡¬ç›˜å’Œ SSD çš„ä¸“ç”¨ä¼˜åŒ–æ–¹æ¡ˆ\nğŸ” æƒé™ç®¡ç†ï¼šè¯¦ç»†è®²è§£å¤šç”¨æˆ·ç¯å¢ƒä¸‹çš„æƒé™é…ç½®\nğŸ“‚ ä¸­æ–‡æ”¯æŒï¼šè§£å†³ä¸­æ–‡æ–‡ä»¶åä¹±ç é—®é¢˜\nğŸ”„ è‡ªåŠ¨æŒ‚è½½ï¼šé…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼Œä¸€åŠ³æ°¸é€¸\nğŸ“š å‚è€ƒèµ„æº\nğŸ“– å›¾æ–‡æ•™ç¨‹ ğŸ¥ è§†é¢‘æ•™ç¨‹ ğŸ§ ä¸€ã€æŒ‚è½½ ext4 æ ¼å¼ç¡¬ç›˜ 1. æŸ¥çœ‹æ‰€æœ‰ç£ç›˜è®¾å¤‡ 1 lsblk æ­¤å‘½ä»¤å°†åˆ—å‡ºæ‰€æœ‰è¿æ¥çš„ç£ç›˜è®¾å¤‡åŠå…¶åˆ†åŒºæƒ…å†µï¼Œå¸®åŠ©æ‚¨è¯†åˆ«è¦æŒ‚è½½çš„ç£ç›˜ã€‚\n2. æŸ¥çœ‹å…·ä½“æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ 1 lsblk -f /dev/sda å°† /dev/sda æ›¿æ¢ä¸ºæ‚¨çš„å®é™…è®¾å¤‡åç§°ï¼ŒæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿç±»å‹å’Œ UUIDã€‚\n3. åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½ç¡¬ç›˜ 1 mkdir -p /mnt/mydisk \u0026amp;\u0026amp; mount /dev/sda1 /mnt/mydisk å°† /dev/sda1 æ›¿æ¢ä¸ºæ‚¨çš„å®é™…åˆ†åŒºï¼Œ/mnt/mydisk æ›¿æ¢ä¸ºæ‚¨å–œæ¬¢çš„æŒ‚è½½è·¯å¾„ã€‚\n4. å–æ¶ˆæŒ‚è½½ï¼ˆå¦‚éœ€ï¼‰ 1 umount /dev/sda1 å®‰å…¨å¸è½½åˆ†åŒºï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚\n5. é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ 5.1 æŸ¥çœ‹ç¡¬ç›˜çš„ UUID 1 blkid è®°å½•ä¸‹æ‚¨è¦æŒ‚è½½çš„åˆ†åŒºçš„ UUIDã€‚\n5.2 ç¼–è¾‘ fstab æ–‡ä»¶é…ç½®è‡ªåŠ¨æŒ‚è½½ 1 nano /etc/fstab æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ UUID å’ŒæŒ‚è½½ç‚¹ï¼‰ï¼š\n1 2 # ext4 ç¡¬ç›˜è‡ªåŠ¨æŒ‚è½½ UUID=50a66a71-8fcd-42a5-a9ca-0cc06fa733e6 /mnt/mydisk ext4 nofail,x-systemd.device-timeout=15s 0 0 ä½¿ç”¨ nofail é€‰é¡¹é˜²æ­¢å› æ‰¾ä¸åˆ°ç¡¬ç›˜è€Œå¯¼è‡´ç³»ç»Ÿå¯åŠ¨å¤±è´¥ã€‚\nğŸ’¾ äºŒã€æŒ‚è½½ NTFS æ ¼å¼ç¡¬ç›˜ï¼ˆWindows ç¡¬ç›˜ï¼‰ 1. æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ 1 lsblk 2. æŸ¥çœ‹ NTFS åˆ†åŒºè¯¦ç»†ä¿¡æ¯ 1 lsblk -f /dev/sda 3. å®‰è£… NTFS æ”¯æŒè½¯ä»¶åŒ… 1 apt update \u0026amp;\u0026amp; apt install ntfs-3g -y NTFS-3G æ˜¯å¼€æºçš„ NTFS é©±åŠ¨ç¨‹åºï¼Œå…è®¸ Linux ç³»ç»Ÿè¯»å†™ NTFS æ ¼å¼ç¡¬ç›˜ã€‚\n4. åˆ›å»ºæŒ‚è½½ç‚¹å¹¶ä¿®å¤ NTFS æ–‡ä»¶ç³»ç»Ÿ 1 mkdir /mnt/ntfs \u0026amp;\u0026amp; ntfsfix /dev/sda1 ntfsfix ç”¨äºä¿®å¤å¸¸è§çš„ NTFS é—®é¢˜ï¼Œä½†ä¸ä¼šæŸåç°æœ‰æ•°æ®ã€‚\n5. æŒ‚è½½ NTFS åˆ†åŒº 1 mount /dev/sda1 /mnt/ntfs ä½¿ç”¨é»˜è®¤å‚æ•°æŒ‚è½½ NTFS åˆ†åŒºã€‚\n6. éªŒè¯æŒ‚è½½ç»“æœ 1 cd /mnt/ntfs \u0026amp;\u0026amp; ls 7. åœ¨ PVE Web ç•Œé¢ä¸­æ·»åŠ å­˜å‚¨ âœ… ç™»å½• PVE Web ç®¡ç†ç•Œé¢ âœ… è¿›å…¥\u0026quot;æ•°æ®ä¸­å¿ƒ\u0026quot; â†’ \u0026ldquo;å­˜å‚¨\u0026rdquo; â†’ \u0026ldquo;æ·»åŠ \u0026rdquo; â†’ \u0026ldquo;ç›®å½•\u0026rdquo; âœ… å¡«å†™é…ç½®ï¼š ğŸ†” ID: è‡ªå®šä¹‰åç§°ï¼ˆå¦‚ \u0026ldquo;ntfs-storage\u0026rdquo;ï¼‰ ğŸ“ ç›®å½•: å¡«å†™æŒ‚è½½è·¯å¾„ï¼ˆå¦‚ \u0026ldquo;/mnt/ntfs\u0026rdquo;ï¼‰ ğŸ“¦ å†…å®¹: å…¨é€‰æ‰€æœ‰ç±»å‹ âœ… ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot;å®Œæˆé…ç½® 8. é…ç½® NTFS åˆ†åŒºå¼€æœºè‡ªåŠ¨æŒ‚è½½ 8.1 æŸ¥çœ‹ NTFS åˆ†åŒºçš„ UUID æˆ– PARTUUID 1 blkid 8.2 ç¼–è¾‘ fstab æ–‡ä»¶ 1 nano /etc/fstab æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ UUID å’ŒæŒ‚è½½ç‚¹ï¼‰ï¼š\n1 2 # NTFS ç¡¬ç›˜è‡ªåŠ¨æŒ‚è½½ UUID=47B29C2C34E7F600 /mnt/ntfs ntfs-3g nofail,x-systemd.device-timeout=15s,windows_names,uid=1000,gid=1000,umask=000 0 0 å‚æ•°è¯´æ˜ï¼š\nğŸ”§ nofail,x-systemd.device-timeout=15s: é˜²æ­¢å¯åŠ¨å¤±è´¥ ğŸªŸ windows_names: é™åˆ¶æ–‡ä»¶åå…¼å®¹ Windows ğŸ‘¤ uid=1000,gid=1000: è®¾ç½®æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆé€šå¸¸1000æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·çš„IDï¼‰ ğŸ“ umask=000: è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è¯»å¯å†™å¯æ‰§è¡Œï¼‰ âš™ï¸ ä¸‰ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– 1. æŒ‚è½½é€‰é¡¹è¯¦è§£ å¯¹äº ext4 æ–‡ä»¶ç³»ç»Ÿï¼š\n1 UUID=xxxxxxxxxxxx /mnt/mydisk ext4 defaults,nofail,x-systemd.device-timeout=15s,noatime 0 0 âš¡ noatime: ä¸æ›´æ–°æ–‡ä»¶è®¿é—®æ—¶é—´ï¼Œæé«˜æ€§èƒ½ ğŸ”„ data=ordered: æ•°æ®å†™å…¥é¡ºåºï¼ˆå¹³è¡¡æ€§èƒ½ä¸å®‰å…¨æ€§ï¼‰ å¯¹äº NTFS æ–‡ä»¶ç³»ç»Ÿï¼š\n1 UUID=xxxxxxxxxxxx /mnt/ntfs ntfs-3g defaults,nofail,x-systemd.device-timeout=15s,windows_names,uid=1000,gid=1000,umask=000,big_writes 0 0 ğŸš€ big_writes: å¯ç”¨å¤§å†™å…¥æ“ä½œï¼Œæé«˜æ€§èƒ½ ğŸ‡¨ğŸ‡³ locale=zh_CN.UTF-8: è®¾ç½®ä¸­æ–‡localeæ”¯æŒä¸­æ–‡æ–‡ä»¶å 2. æ€§èƒ½ä¼˜åŒ–å»ºè®® å¯¹äºæœºæ¢°ç¡¬ç›˜ï¼š\n1 2 # å‡å°‘è¯»å†™ç¼“å­˜ï¼Œé™ä½æ•°æ®ä¸¢å¤±é£é™© UUID=xxxxxxxxxxxx /mnt/mydisk ext4 defaults,nofail,data=ordered,commit=60 0 0 å¯¹äº SSD ç¡¬ç›˜ï¼š\n1 2 # ä¼˜åŒ–SSDæ€§èƒ½ UUID=xxxxxxxxxxxx /mnt/mydisk ext4 defaults,nofail,noatime,discard,data=writeback 0 0 â™»ï¸ discard: å¯ç”¨TRIMåŠŸèƒ½ï¼ˆä»…é€‚ç”¨äºSSDï¼‰ âš¡ data=writeback: æé«˜æ€§èƒ½ï¼ˆä½†å¢åŠ æ•°æ®ä¸¢å¤±é£é™©ï¼‰ 3. å¤šç”¨æˆ·æƒé™è®¾ç½® è®¾ç½®ç‰¹å®šç”¨æˆ·ç»„è®¿é—®æƒé™ï¼š\n1 2 3 4 5 6 7 8 # åˆ›å»ºä¸“é—¨çš„ç”¨æˆ·ç»„ groupadd storage-users # æ·»åŠ ç”¨æˆ·åˆ°ç»„ usermod -aG storage-users username # åœ¨fstabä¸­è®¾ç½®æƒé™ UUID=xxxxxxxxxxxx /mnt/shared ext4 defaults,nofail,gid=1005,umask=002 0 0 æ›¿æ¢ 1005 ä¸º storage-users ç»„çš„GIDã€‚\nğŸ”§ å››ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ 1. âŒ æŒ‚è½½å¤±è´¥ï¼šæƒé™ä¸è¶³ 1 2 3 4 5 # æ£€æŸ¥å½“å‰ç”¨æˆ·æƒé™ id # ä¸´æ—¶ä»¥rootæƒé™æŒ‚è½½ sudo mount /dev/sda1 /mnt/mydisk 2. âŒ æŒ‚è½½å¤±è´¥ï¼šæ–‡ä»¶ç³»ç»ŸæŸå 1 2 3 4 5 # å¯¹äºext4æ–‡ä»¶ç³»ç»Ÿ fsck /dev/sda1 # å¯¹äºNTFSæ–‡ä»¶ç³»ç»Ÿ ntfsfix /dev/sda1 3. âŒ ä¸­æ–‡æ–‡ä»¶åæ˜¾ç¤ºä¹±ç  1 2 3 4 5 # æ£€æŸ¥ç³»ç»Ÿlocaleè®¾ç½® locale # æŒ‚è½½æ—¶æŒ‡å®šlocale mount -o locale=zh_CN.UTF-8 /dev/sda1 /mnt/ntfs 4. âŒ å†™å…¥é€Ÿåº¦æ…¢ 1 2 3 4 5 # æ£€æŸ¥å½“å‰æŒ‚è½½é€‰é¡¹ mount | grep sda1 # å°è¯•ä½¿ç”¨æ€§èƒ½æ›´å¥½çš„é€‰é¡¹é‡æ–°æŒ‚è½½ mount -o remount,async /dev/sda1 5. âŒ æ— æ³•åœ¨PVE Webç•Œé¢ä¸­çœ‹åˆ°å­˜å‚¨ 1 2 3 4 5 # é‡æ–°æ‰«æå­˜å‚¨ pvesm scan # é‡å¯PVEä»£ç†æœåŠ¡ systemctl restart pvedaemon.service ğŸ“Š äº”ã€æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§å¯¹æ¯” ç‰¹æ€§ ext4 NTFS è¯´æ˜ ğŸ§ Linuxå…¼å®¹æ€§ â­â­â­â­â­ â­â­â­ ext4æ˜¯LinuxåŸç”Ÿæ–‡ä»¶ç³»ç»Ÿ ğŸªŸ Windowså…¼å®¹æ€§ â­ (éœ€ç¬¬ä¸‰æ–¹è½¯ä»¶) â­â­â­â­â­ NTFSæ˜¯WindowsåŸç”Ÿæ–‡ä»¶ç³»ç»Ÿ ğŸ“ å¤§æ–‡ä»¶æ”¯æŒ â­â­â­â­â­ â­â­â­â­â­ ä¸¤è€…éƒ½æ”¯æŒè¶…å¤§æ–‡ä»¶ ğŸ” æƒé™ç®¡ç† â­â­â­â­â­ â­â­â­ ext4çš„Linuxæƒé™ç®¡ç†æ›´å®Œå–„ ğŸ“ æ—¥å¿—åŠŸèƒ½ â­â­â­â­â­ â­â­â­â­ ä¸¤è€…éƒ½æä¾›æ—¥å¿—åŠŸèƒ½ âš¡ æ€§èƒ½ â­â­â­â­ â­â­â­ ext4åœ¨Linuxä¸Šé€šå¸¸æ€§èƒ½æ›´å¥½ ğŸ’¡ å…­ã€æœ€ä½³å®è·µå»ºè®® ğŸ’¾ å¤‡ä»½é‡è¦æ•°æ®ï¼šåœ¨æ“ä½œå‰å§‹ç»ˆå¤‡ä»½é‡è¦æ•°æ® ğŸ†” ä½¿ç”¨UUIDè€Œéè®¾å¤‡åï¼šè®¾å¤‡åï¼ˆå¦‚/dev/sda1ï¼‰å¯èƒ½å˜åŒ–ï¼ŒUUIDæ›´ç¨³å®š ğŸ§ª æµ‹è¯•æŒ‚è½½é€‰é¡¹ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰æµ‹è¯•ä¸åŒæŒ‚è½½é€‰é¡¹çš„æ€§èƒ½å½±å“ ğŸ” ç›‘æ§ç£ç›˜å¥åº·ï¼šå®šæœŸæ£€æŸ¥ç£ç›˜SMARTçŠ¶æ€å’Œæ–‡ä»¶ç³»ç»Ÿå¥åº· ğŸ”„ è€ƒè™‘æ–‡ä»¶ç³»ç»Ÿè½¬æ¢ï¼šå¯¹äºé•¿æœŸåœ¨Linuxä½¿ç”¨çš„ç£ç›˜ï¼Œè€ƒè™‘è½¬æ¢ä¸ºext4æˆ–Btrfs è½¬æ¢NTFSåˆ°ext4ï¼ˆæ•°æ®å¤‡ä»½åï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 # 1. å¤‡ä»½æ•°æ® rsync -av /mnt/ntfs/ /å¤‡ä»½è·¯å¾„/ # 2. è½¬æ¢æ–‡ä»¶ç³»ç»Ÿ umount /dev/sda1 mkfs.ext4 /dev/sda1 # 3. æ¢å¤æ•°æ® mount /dev/sda1 /mnt/mydisk rsync -av /å¤‡ä»½è·¯å¾„/ /mnt/mydisk/ ğŸš¨ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸è­¦å‘Š âš¡ Windowså¿«é€Ÿå¯åŠ¨ï¼šå¦‚æœNTFSç¡¬ç›˜æ¥è‡ªWindowsç³»ç»Ÿï¼Œè¯·ç¡®ä¿ç¦ç”¨Windowsçš„\u0026quot;å¿«é€Ÿå¯åŠ¨\u0026quot;åŠŸèƒ½ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ–‡ä»¶ç³»ç»ŸæŸå ğŸ”Œ å®‰å…¨å¸è½½ï¼šå§‹ç»ˆä½¿ç”¨ umount å‘½ä»¤å®‰å…¨å¸è½½ç¡¬ç›˜ï¼Œç›´æ¥æ–­ç”µå¯èƒ½å¯¼è‡´æ•°æ®æŸå ğŸ” æƒé™é—®é¢˜ï¼šNTFSæ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒLinuxæƒé™æ¨¡å‹ï¼Œå¯èƒ½å¯¼è‡´æƒé™é—®é¢˜ ğŸ‡¨ğŸ‡³ å­—ç¬¦ç¼–ç ï¼šç¡®ä¿ç³»ç»Ÿlocaleè®¾ç½®æ­£ç¡®ï¼Œé¿å…ä¸­æ–‡æ–‡ä»¶åä¹±ç  ğŸ”„ ç³»ç»Ÿæ›´æ–°ï¼šä¿æŒNTFS-3Gè½¯ä»¶åŒ…æ›´æ–°ï¼Œä»¥è·å¾—æ›´å¥½çš„å…¼å®¹æ€§å’Œæ€§èƒ½ ğŸ¯ æç¤ºï¼šå¯¹äºç»å¸¸åœ¨Linuxå’ŒWindowsä¹‹é—´å…±äº«çš„ç¡¬ç›˜ï¼ŒexFATå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒåœ¨è¿™ä¸¤ç§ç³»ç»Ÿä¸Šéƒ½æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œä¸”æ²¡æœ‰NTFSçš„æƒé™é—®é¢˜ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æˆåŠŸåœ¨PVEä¸­æŒ‚è½½å’Œä½¿ç”¨å·²æœ‰æ•°æ®çš„ç¡¬ç›˜ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒPVEå®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚ğŸ†˜\n","date":"2024-12-07T14:24:58+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/688d0554/","title":"Proxmox VE æŒ‚è½½å·²æœ‰æ•°æ®çš„ ext4 å’Œ NTFS ç¡¬ç›˜ ğŸ§"},{"content":"Halo åšå®¢å¤‡ä»½ä¸æ–‡ç« å¯¼å‡º ğŸ“ ğŸ”„ å…¨é¢ä¿æŠ¤ä½ çš„åšå®¢å†…å®¹ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼\nğŸ“‹ ç›®å½•å¯¼èˆª\nÂ· ğŸ’¾ åå°å¤‡ä»½ Â· ğŸ“¦ å¤‡ä»½æ–‡ä»¶ä½ç½® Â· ğŸ“‚ æ–‡ç« å¯¼å‡ºè·¯å¾„ Â· ğŸ”„ è‡ªåŠ¨å¤‡ä»½è„šæœ¬ Â· ğŸš€ å¿«é€Ÿæ¢å¤æŒ‡å— Â· ğŸ’¡ å¤‡ä»½ç­–ç•¥å»ºè®®\nğŸ’¾ åå°å¤‡ä»½\næ‰‹åŠ¨å¤‡ä»½æ­¥éª¤\nç™»å½• Halo åå°ç®¡ç†ç•Œé¢ è¿›å…¥ã€Œç³»ç»Ÿã€-\u0026gt;ã€Œå¤‡ä»½ã€ ç‚¹å‡»ã€Œç«‹å³å¤‡ä»½ã€æŒ‰é’® ç­‰å¾…å¤‡ä»½å®Œæˆï¼ˆå¤‡ä»½æ–‡ä»¶å°†è‡ªåŠ¨ç”Ÿæˆï¼‰ https://file.meimolihan.eu.org/screenshot/halo-backup.png ğŸ“¦ å¤‡ä»½æ–‡ä»¶ä½ç½®\né»˜è®¤å¤‡ä»½è·¯å¾„\n1 2 3 4 5 6 7 8 # è¿›å…¥å¤‡ä»½ç›®å½• cd /mnt/mydisk/home/halo/config/halo2/backups # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ ls -la *.zip # æŒ‰æ—¶é—´æ’åºæŸ¥çœ‹æœ€æ–°å¤‡ä»½ ls -lt *.zip | head -5 å¤‡ä»½æ–‡ä»¶å‘½åæ ¼å¼\n1 2 YYYYMMDDHHMMSS-backup-éšæœºæ ‡è¯†ç¬¦.zip ç¤ºä¾‹ï¼š20241025192604-backup-PPAuB.zip ğŸ“‚ æ–‡ç« å¯¼å‡ºè·¯å¾„\nè§£å‹å¤‡ä»½æ–‡ä»¶\n1 2 3 4 5 6 7 8 # åˆ›å»ºè§£å‹ç›®å½• mkdir -p /tmp/halo-backup # è§£å‹å¤‡ä»½æ–‡ä»¶ï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…æ–‡ä»¶åï¼‰ unzip /mnt/mydisk/home/halo/config/halo2/backups/20241025192604-backup-PPAuB.zip -d /tmp/halo-backup/ # æŸ¥çœ‹å¯¼å‡ºçš„æ–‡ç«  find /tmp/halo-backup -name \u0026#34;*.html\u0026#34; -type f | head -10 æ–‡ç« å­˜å‚¨è·¯å¾„\n1 2 3 4 å¤‡ä»½æ–‡ä»¶è§£å‹åè·¯å¾„ï¼š /tmp/halo-backup/workdir/plugins/export2doc_files/export/ æ–‡ç« æ ¼å¼ï¼šHTML æ–‡ä»¶ ğŸ”„ è‡ªåŠ¨å¤‡ä»½è„šæœ¬\nè‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 #!/bin/bash # Halo è‡ªåŠ¨å¤‡ä»½è„šæœ¬ # è®¾ç½®å˜é‡ BACKUP_DIR=\u0026#34;/mnt/mydisk/home/halo/config/halo2/backups\u0026#34; LOG_FILE=\u0026#34;/var/log/halo-backup.log\u0026#34; RETENTION_DAYS=30 # ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½ # åˆ›å»ºæ—¥å¿—å‡½æ•° log() { echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; \u0026gt;\u0026gt; $LOG_FILE } # å¼€å§‹å¤‡ä»½ log \u0026#34;å¼€å§‹ Halo å¤‡ä»½æµç¨‹\u0026#34; # æ£€æŸ¥å¤‡ä»½ç›®å½•æ˜¯å¦å­˜åœ¨ if [ ! -d \u0026#34;$BACKUP_DIR\u0026#34; ]; then log \u0026#34;é”™è¯¯: å¤‡ä»½ç›®å½•ä¸å­˜åœ¨: $BACKUP_DIR\u0026#34; exit 1 fi # æ‰§è¡Œå¤‡ä»½ (è¿™é‡Œéœ€è¦æ ¹æ®ä½ çš„Haloå®‰è£…æ–¹å¼è°ƒæ•´å¤‡ä»½å‘½ä»¤) # å¦‚æœæ˜¯dockerå®‰è£…ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œdockerå‘½ä»¤è§¦å‘å¤‡ä»½ # docker exec halo halo backup log \u0026#34;å¤‡ä»½å‘½ä»¤å·²æ‰§è¡Œï¼Œç­‰å¾…å¤‡ä»½æ–‡ä»¶ç”Ÿæˆ...\u0026#34; # ç­‰å¾…å¤‡ä»½å®Œæˆ sleep 30 # æŸ¥æ‰¾æœ€æ–°å¤‡ä»½æ–‡ä»¶ LATEST_BACKUP=$(ls -t $BACKUP_DIR/*.zip | head -1) if [ -n \u0026#34;$LATEST_BACKUP\u0026#34; ]; then log \u0026#34;æœ€æ–°å¤‡ä»½æ–‡ä»¶: $LATEST_BACKUP\u0026#34; # æå–æ–‡ç« åˆ°æŒ‡å®šç›®å½• EXTRACT_DIR=\u0026#34;/opt/halo-articles/$(date +%Y%m%d)\u0026#34; mkdir -p $EXTRACT_DIR unzip -o \u0026#34;$LATEST_BACKUP\u0026#34; \u0026#34;workdir/plugins/export2doc_files/export/*\u0026#34; -d \u0026#34;$EXTRACT_DIR\u0026#34; \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 # ç§»åŠ¨æ–‡ç« æ–‡ä»¶åˆ°æ›´ç›´è§‚çš„ä½ç½® if [ -d \u0026#34;$EXTRACT_DIR/workdir/plugins/export2doc_files/export\u0026#34; ]; then mv \u0026#34;$EXTRACT_DIR/workdir/plugins/export2doc_files/export/\u0026#34;* \u0026#34;$EXTRACT_DIR/\u0026#34; rm -rf \u0026#34;$EXTRACT_DIR/workdir\u0026#34; log \u0026#34;æ–‡ç« å·²æå–åˆ°: $EXTRACT_DIR\u0026#34; fi # æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘30å¤©ï¼‰ find $BACKUP_DIR -name \u0026#34;*.zip\u0026#34; -mtime +$RETENTION_DAYS -delete \u0026gt;\u0026gt; $LOG_FILE 2\u0026gt;\u0026amp;1 log \u0026#34;å·²æ¸…ç†è¶…è¿‡ $RETENTION_DAYS å¤©çš„æ—§å¤‡ä»½\u0026#34; else log \u0026#34;è­¦å‘Š: æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶\u0026#34; fi log \u0026#34;å¤‡ä»½æµç¨‹å®Œæˆ\u0026#34; è®¾ç½®å®šæ—¶è‡ªåŠ¨å¤‡ä»½\n1 2 3 4 5 6 7 # ç¼–è¾‘crontab crontab -e # æ·»åŠ ä»¥ä¸‹è¡Œï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ 0 2 * * * /path/to/your/halo-backup-script.sh # ä¿å­˜å¹¶é€€å‡º ğŸš€ å¿«é€Ÿæ¢å¤æŒ‡å—\nä»å¤‡ä»½æ¢å¤ Halo\nè¿›å…¥ Halo åå°ã€Œç³»ç»Ÿã€-\u0026gt;ã€Œå¤‡ä»½ã€ æ‰¾åˆ°è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶ ç‚¹å‡»ã€Œæ¢å¤ã€æŒ‰é’® ç¡®è®¤æ¢å¤æ“ä½œ ç­‰å¾…æ¢å¤å®Œæˆ æ‰‹åŠ¨æ¢å¤æ–‡ç« \n1 2 3 4 5 6 7 # å°†æå–çš„æ–‡ç« é‡æ–°å¯¼å…¥Halo # æ³¨æ„ï¼šè¿™éœ€è¦æ ¹æ®Haloçš„å¯¼å…¥åŠŸèƒ½è¿›è¡Œæ“ä½œ # é€šå¸¸å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š # 1. å°†HTMLæ–‡ä»¶è½¬æ¢ä¸ºMarkdown # 2. ä½¿ç”¨Haloçš„å¯¼å…¥åŠŸèƒ½ # 3. æˆ–é€šè¿‡APIæ‰¹é‡åˆ›å»ºæ–‡ç«  ğŸ’¡ å¤‡ä»½ç­–ç•¥å»ºè®®\nğŸ”’ å¤šé‡å¤‡ä»½ç­–ç•¥\næœ¬åœ°å¤‡ä»½ï¼šä¿ç•™æœ€è¿‘7å¤©çš„æ¯æ—¥å¤‡ä»½ å¼‚åœ°å¤‡ä»½ï¼šæ¯å‘¨å°†å¤‡ä»½æ–‡ä»¶åŒæ­¥åˆ°äº‘å­˜å‚¨ï¼ˆå¦‚AWS S3ã€Google Driveç­‰ï¼‰ æ–‡ç« å¯¼å‡ºï¼šæ¯æœˆå¯¼å‡ºä¸€æ¬¡æ‰€æœ‰æ–‡ç« ä¸ºHTML/Markdownæ ¼å¼ ğŸ“Š å¤‡ä»½ç›‘æ§\n1 2 3 4 5 6 7 # æ£€æŸ¥å¤‡ä»½çŠ¶æ€çš„ç®€å•è„šæœ¬ #!/bin/bash BACKUP_COUNT=$(find /mnt/mydisk/home/halo/config/halo2/backups -name \u0026#34;*.zip\u0026#34; -mtime -1 | wc -l) if [ $BACKUP_COUNT -eq 0 ]; then echo \u0026#34;è­¦å‘Š: è¿‡å»24å°æ—¶å†…æ²¡æœ‰ç”Ÿæˆå¤‡ä»½!\u0026#34; | mail -s \u0026#34;Haloå¤‡ä»½è­¦æŠ¥\u0026#34; admin@example.com fi ğŸ—‚ï¸ å¤‡ä»½ç›®å½•ç»“æ„ç¤ºä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 /mnt/mydisk/backups/ â”œâ”€â”€ halo/ â”‚ â”œâ”€â”€ daily/20241025.zip â”‚ â”œâ”€â”€ daily/20241026.zip â”‚ â””â”€â”€ weekly/20241020.zip â””â”€â”€ articles/ â”œâ”€â”€ 20241025/ â”‚ â”œâ”€â”€ post1.html â”‚ â””â”€â”€ post2.html â””â”€â”€ 20241026/ â”œâ”€â”€ post1.html â””â”€â”€ post3.html ğŸ¯ æç¤ºï¼šå®šæœŸæµ‹è¯•å¤‡ä»½æ–‡ä»¶çš„æ¢å¤è¿‡ç¨‹ï¼Œç¡®ä¿åœ¨çœŸæ­£éœ€è¦æ—¶èƒ½å¤Ÿé¡ºåˆ©æ¢å¤æ•°æ®ï¼å»ºè®®æ¯å­£åº¦è‡³å°‘è¿›è¡Œä¸€æ¬¡æ¢å¤æ¼”ç»ƒã€‚\n","date":"2024-12-07T14:24:11+08:00","image":"https://file.meimolihan.eu.org/img/halo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dba8915a/","title":"Halo åšå®¢å¤‡ä»½ä¸æ–‡ç« å¯¼å‡º ğŸ“"},{"content":"Proxmox VE ç¡¬ç›˜ç›´é€šå®Œå…¨æŒ‡å— ğŸ’¾ ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»åœ¨ PVE ä¸­å°†ç‰©ç†ç¡¬ç›˜ç›´é€šç»™è™šæ‹Ÿæœºçš„ä¸‰ç§ä¸»æµæ–¹æ³•ï¼Œæ¶µç›– RDM ç›´é€šã€æ§åˆ¶å™¨ç›´é€šå’Œ NVMe ç›´é€šï¼Œé€‚ç”¨äºå„ç§ä½¿ç”¨åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚ã€‚æ— è®ºæ‚¨æ˜¯å®¶åº­ç”¨æˆ·è¿˜æ˜¯ä¼ä¸šç¯å¢ƒï¼Œéƒ½èƒ½æ‰¾åˆ°é€‚åˆçš„æ–¹æ¡ˆï¼\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ æŒ‡å—ç‰¹ç‚¹ ğŸ¯ æ–¹æ³•ä¸€ã€ç®€å•ç¡¬ç›˜ç›´é€š ğŸ”§ æ–¹æ³•äºŒã€æ˜ å°„ç›´é€šå•å—ç¡¬ç›˜ âš¡ æ–¹æ³•ä¸‰ã€é«˜çº§ç›´é€šæ–¹å¼ ğŸ”¥ nvme-ç›´é€šç‰¹æ®Šé…ç½® ğŸš€ ä»ç›´é€šç¡¬ç›˜å¼•å¯¼ç³»ç»Ÿ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ“Š æ–¹æ³•å¯¹æ¯”æ€»ç»“ ğŸ’¡ æœ€ä½³å®è·µå»ºè®® âœ¨ æŒ‡å—ç‰¹ç‚¹ âœ… ä¸‰ç§ç›´é€šæ–¹æ³•å…¨é¢è¦†ç›– ğŸ”§ è¯¦ç»†å‘½ä»¤ç¤ºä¾‹å’Œå‚æ•°è¯´æ˜ âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ¯ å®é™…åº”ç”¨åœºæ™¯æ¨è å‚è€ƒæ•™ç¨‹ï¼š https://foxi.buduanwang.vip/virtualization/1754.html/ ğŸ¯ æ–¹æ³•ä¸€ï¼šç®€å•ç¡¬ç›˜ç›´é€š 1. ğŸ“¦ æ›´æ–°ç¯å¢ƒå¹¶å®‰è£…å·¥å…· 1 2 3 # æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£…å¿…è¦å·¥å…· apt-get update \u0026amp;\u0026amp; apt-get install lshw # å®‰è£…ç¡¬ä»¶ä¿¡æ¯æŸ¥çœ‹å·¥å…·ï¼Œå¸®åŠ©è¯†åˆ«ç£ç›˜è®¾å¤‡ 2. ğŸ” æŸ¥çœ‹ç¡¬ç›˜ä¿¡æ¯ 1 2 3 4 # åˆ—å‡ºæ‰€æœ‰ç¡¬ç›˜çš„ ID ä¿¡æ¯ ls -l /dev/disk/by-id/ # æŸ¥æ‰¾ ata- å¼€å¤´çš„ç¡¬ç›˜ IDï¼ˆé€‚ç”¨äº SATA ç¡¬ç›˜ï¼‰ # æŸ¥æ‰¾ nvme- å¼€å¤´çš„ç¡¬ç›˜ IDï¼ˆé€‚ç”¨äº NVMe ç¡¬ç›˜ï¼‰ 3. ğŸ¯ ç›´é€šç¡¬ç›˜åˆ°è™šæ‹Ÿæœº 1 2 3 4 5 6 # å°†ç¡¬ç›˜ç›´é€šåˆ°æŒ‡å®šè™šæ‹Ÿæœº qm set 101 --sata4 /dev/disk/by-id/ata-WDC_WD10EZEX-08RKKA0_WD-WCC1S4752100 # å‚æ•°è¯´æ˜ï¼š # 101: è™šæ‹ŸæœºID # sata4: SATAæ¥å£ä½ç½®(0-5) # ata-...: ç¡¬ç›˜çš„å”¯ä¸€æ ‡è¯†ID ğŸ’¡ æç¤ºï¼š\nä½¿ç”¨ /dev/disk/by-id/ ä¸‹çš„è®¾å¤‡æ ‡è¯†ï¼Œè€Œä¸æ˜¯ /dev/sdXï¼Œé¿å…è®¾å¤‡åå˜åŒ–å¯¼è‡´çš„é—®é¢˜ å¯ä»¥é€šè¿‡ qm config \u0026lt;VMID\u0026gt; æŸ¥çœ‹å½“å‰è™šæ‹Ÿæœºé…ç½® ğŸ”§ æ–¹æ³•äºŒï¼šæ˜ å°„ç›´é€šå•å—ç¡¬ç›˜ 1. ğŸ“‹ æŸ¥çœ‹ç£ç›˜ ID ä¿¡æ¯ 1 2 3 4 # è¯¦ç»†æŸ¥çœ‹æ‰€æœ‰ç£ç›˜æ ‡è¯†ä¿¡æ¯ ls -l /dev/disk/by-id/ # è¿‡æ»¤æ˜¾ç¤ºç‰©ç†ç¡¬ç›˜ï¼ˆæ’é™¤åˆ†åŒºå’Œé€»è¾‘å·ï¼‰ ls -l /dev/disk/by-id/ | grep -v part | grep -v wwn 2. ğŸ“ ç›´é€šå‘½ä»¤è¯­æ³• 1 2 # é€šç”¨ç›´é€šå‘½ä»¤æ ¼å¼ qm set \u0026lt;vm_id\u0026gt; --\u0026lt;disk_type\u0026gt;[n] /dev/disk/by-id/\u0026lt;disk_identifier\u0026gt; 3. âœ… å®é™…ç¤ºä¾‹ 1 2 3 4 5 # ç¤ºä¾‹ï¼šç›´é€šå¸Œæ·ç¡¬ç›˜åˆ°è™šæ‹Ÿæœº 102 çš„ sata2 æ¥å£ qm set 102 --sata2 /dev/disk/by-id/ata-ST4000VX000-2AG166_ZGY163KG # ç¤ºä¾‹ï¼šç›´é€š NVMe ç¡¬ç›˜åˆ°è™šæ‹Ÿæœº 103 çš„ scsi0 æ¥å£ qm set 103 --scsi0 /dev/disk/by-id/nvme-Samsung_SSD_970_EVO_Plus_1TB_S5GXNS0N123456 4. ğŸ“Š æ¥å£ç±»å‹è¯´æ˜ æ¥å£ç±»å‹ æœ€å¤§è®¾å¤‡æ•° æ€§èƒ½ç­‰çº§ æ¨èç”¨é€” ç‰¹ç‚¹ --scsiX 13 ğŸš€ æœ€ä½³ é«˜æ€§èƒ½éœ€æ±‚ æ”¯æŒ TRIMï¼Œæœ€ä½³æ€§èƒ½ --sataX 6 âš¡ è‰¯å¥½ æ™®é€šå­˜å‚¨ å…¼å®¹æ€§å¥½ --ideX 4 ğŸ¢ ä¸€èˆ¬ å…¼å®¹æ—§ç³»ç»Ÿ ä¼ ç»Ÿæ¥å£ï¼Œæ€§èƒ½è¾ƒä½ âš¡ æ–¹æ³•ä¸‰ï¼šé«˜çº§ç›´é€šæ–¹å¼ 1. ğŸ”„ RDM (è£¸ç£ç›˜æ˜ å°„) ç‰¹ç‚¹ï¼š\nâœ… ä¸éœ€è¦å¼€å¯ IOMMU ğŸ”§ çº¯è½¯ä»¶å®ç°ï¼Œå…¼å®¹æ€§å¥½ ğŸ’¾ è™šæ‹Ÿæœºå†…è¯†åˆ«ä¸º VirtIO æˆ– SCSI è®¾å¤‡ 1 2 # åˆ—å‡ºå¯ç”¨ç‰©ç†ç¡¬ç›˜ï¼ˆæ’é™¤ LVM å’Œåˆ†åŒºï¼‰ ls -la /dev/disk/by-id/ | grep -v dm | grep -v lvm | grep -v part 2. ğŸ¯ RDM ç›´é€šç¤ºä¾‹ 1 2 3 4 5 # NVMe ç¡¬ç›˜ç›´é€šä¸º VirtIO è®¾å¤‡ï¼ˆæ€§èƒ½æœ€ä½³ï¼‰ qm set 101 --virtio2 /dev/disk/by-id/nvme-INTEL_SSDPE2KX020T8_BTLJ039307142P0BGN # SATA ç¡¬ç›˜ç›´é€šä¸º SCSI è®¾å¤‡ qm set 101 --scsi3 /dev/disk/by-id/ata-WDC_WD10EZEX-08RKKA0_WD-WCC1S4752100 3. âŒ å–æ¶ˆç›´é€šé…ç½® 1 2 3 # åˆ é™¤ç›´é€šçš„ç¡¬ç›˜è®¾å¤‡ qm set 101 --delete scsi1 # æˆåŠŸè¿”å›: update VM 101: -delete scsi1 4. ğŸ›ï¸ æ§åˆ¶å™¨ç›´é€šï¼ˆé«˜çº§ï¼‰ ç‰¹ç‚¹ï¼š\nğŸ¯ ç›´é€šæ•´ä¸ªç£ç›˜æ§åˆ¶å™¨ ğŸ’¡ è·å¾—å®Œæ•´çš„ç¡¬ç›˜å±æ€§ï¼ˆåŒ…æ‹¬ SMARTï¼‰ âš ï¸ éœ€è¦å¤šä¸ªç£ç›˜æ§åˆ¶å™¨å’Œæ”¯æŒ IOMMU 1 2 3 # æŸ¥çœ‹å¯ç”¨ç£ç›˜æ§åˆ¶å™¨ lspci | grep -i \u0026#34;sata\\|scsi\\|nvme\u0026#34; # ç¤ºä¾‹è¾“å‡º: 01:00.0 SATA controller: Intel Corporation C610/X99 series chipset sSATA Controller 5. ğŸ”— æŸ¥çœ‹ç¡¬ç›˜ä¸æ§åˆ¶å™¨å…³ç³» 1 2 3 4 # æŸ¥çœ‹ç¡¬ç›˜è®¾å¤‡è·¯å¾„å’Œæ§åˆ¶å™¨çš„å…³è” ls -la /sys/block/sd*/device # ä½¿ç”¨ tree å‘½ä»¤æŸ¥çœ‹æ›´æ¸…æ™°çš„å±‚æ¬¡ç»“æ„ apt install tree \u0026amp;\u0026amp; tree /sys/block/sda/device/ ğŸ”¥ NVMe ç›´é€šç‰¹æ®Šé…ç½® 1. ğŸ’¾ æ™®é€š NVMe ç›´é€š 1 2 3 4 # æŸ¥çœ‹ NVMe è®¾å¤‡ä¿¡æ¯ lspci | grep -i nvme nvme list # æ˜¾ç¤ºè¯¦ç»†çš„ NVMe è®¾å¤‡ä¿¡æ¯å’Œå‘½åç©ºé—´ 2. âš™ï¸ ç‰¹æ®Šå›ºä»¶å¤„ç† å¯¹äºæŸäº› OEM NVMe è®¾å¤‡ï¼Œå¯èƒ½éœ€è¦é¢å¤–é…ç½®ï¼š\n1 2 3 # åœ¨è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶(/etc/pve/qemu-server/XXX.conf)ä¸­æ·»åŠ å‚æ•° args: -set device.hostpci0.x-msix-relocation=bar2 # è¿™å¯ä»¥è§£å†³æŸäº› NVMe è®¾å¤‡çš„ MSI-X ä¸­æ–­é—®é¢˜ é…ç½®è¯´æ˜ï¼š\nhostpci0: PCIe è®¾å¤‡ç¼–å·ï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰ x-msix-relocation=bar2: MSI-X ä¸­æ–­é‡å®šä½åˆ° BAR2 éœ€è¦å…ˆå¯ç”¨ IOMMU æ”¯æŒ 3. ğŸ› ï¸ IOMMU é…ç½® 1 2 3 4 5 6 7 8 9 # ç¼–è¾‘ GRUB é…ç½®å¯ç”¨ IOMMU nano /etc/default/grub # åœ¨ GRUB_CMDLINE_LINUX_DEFAULT ä¸­æ·»åŠ ï¼š # Intel: intel_iommu=on iommu=pt # AMD: amd_iommu=on iommu=pt # æ›´æ–° GRUB update-grub reboot ğŸš€ ä»ç›´é€šç¡¬ç›˜å¼•å¯¼ç³»ç»Ÿ 1. ğŸªŸ Windows ç³»ç»Ÿå¼•å¯¼ UEFI å¼•å¯¼é…ç½® 1 2 3 4 # è™šæ‹Ÿæœºé…ç½®è¦æ±‚ bios: ovmf efidisk0: local-lvm:vm-101-disk-0,size=4M tpmstate0: local-lvm:vm-101-disk-1,size=4M Legacy BIOS å¼•å¯¼ 1 2 3 # ä¼ ç»Ÿ BIOS å¼•å¯¼é…ç½® bios: seabios boot: order=sata0 2. ğŸ¯ é©±åŠ¨ç¨‹åºé…ç½® 1 2 3 4 # å¯¹äº Windows ç³»ç»Ÿï¼Œå»ºè®®ä½¿ç”¨ VirtIO é©±åŠ¨ scsihw: virtio-scsi-single # ä¸‹è½½ VirtIO é©±åŠ¨é•œåƒå¹¶åŠ è½½ ide2: local:iso/virtio-win.iso,media=cdrom 3. ğŸ“‹ å¼•å¯¼é¡ºåºè®¾ç½® 1 2 3 4 # ä¿®æ”¹å¼•å¯¼é¡ºåºï¼Œä»ç›´é€šç¡¬ç›˜å¯åŠ¨ qm set 101 --boot order=\u0026#39;scsi0\u0026#39; # è®¾ç½®å¯åŠ¨è¶…æ—¶ qm set 101 --boot timeout=5000 4. ğŸ§ Linux ç³»ç»Ÿå¼•å¯¼ 1 2 3 4 5 # Linux é€šå¸¸å¯¹ç›´é€šç¡¬ç›˜æ”¯æŒæ›´å¥½ # ç¡®ä¿å†…æ ¸åŒ…å«å¿…è¦çš„é©±åŠ¨æ¨¡å— # æ£€æŸ¥é©±åŠ¨åŠ è½½ lsmod | grep nvme lsmod | grep ahci âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ 1. ğŸ›¡ï¸ å®‰å…¨è­¦å‘Š 1 2 3 # åˆ‡å‹¿ç›´é€šåŒ…å« PVE ç³»ç»Ÿçš„ç¡¬ç›˜æ§åˆ¶å™¨ï¼ lsblk -f | grep -E \u0026#34;(pve-root|pve-data)\u0026#34; # ç¡®è®¤ç³»ç»Ÿæ‰€åœ¨ç¡¬ç›˜ï¼Œé¿å…ç›´é€šåå¯¼è‡´ä¸»æœºæ— æ³•å¯åŠ¨ 2. âš¡ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨ VirtIO SCSI æ¥å£è·å¾—æœ€ä½³æ€§èƒ½ qm set 101 --scsihw virtio-scsi-single # å¯ç”¨ IO çº¿ç¨‹å’Œå†™å…¥ç¼“å­˜ qm set 101 --iothread 1 qm set 101 --cache writeback # å¯ç”¨ discardï¼ˆTRIMï¼‰æ”¯æŒ qm set 101 --discard on 3. ğŸ’¾ å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 # ç›´é€šå‰åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ® # ä½¿ç”¨ dd æˆ– rsync è¿›è¡Œå®Œæ•´å¤‡ä»½ dd if=/dev/disk-id of=/path/to/backup.img bs=4M status=progress # æˆ–è€…ä½¿ç”¨ä¸“ä¸šå¤‡ä»½å·¥å…· apt install clonezilla 4. ğŸ”§ æ•…éšœæ’é™¤ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç›´é€šçŠ¶æ€å’Œé…ç½® qm config 101 | grep -E \u0026#34;(scsi|sata|virtio)\u0026#34; # æŸ¥çœ‹è™šæ‹Ÿæœºæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯ journalctl -u pvedaemon --since \u0026#34;10 minutes ago\u0026#34; # æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ smartctl -a /dev/disk/by-id/your-disk-id ğŸ“Š æ–¹æ³•å¯¹æ¯”æ€»ç»“ ç‰¹æ€§ RDM ç›´é€š æ§åˆ¶å™¨ç›´é€š NVMe ç›´é€š é…ç½®éš¾åº¦ ğŸŸ¢ ç®€å• ğŸŸ¡ ä¸­ç­‰ ğŸŸ¡ ä¸­ç­‰ æ€§èƒ½ ğŸŸ¢ ä¼˜ç§€ ğŸŸ¢ ä¼˜ç§€ ğŸŸ¢ æœ€ä½³ åŠŸèƒ½å®Œæ•´æ€§ ğŸŸ¡ éƒ¨åˆ† ğŸŸ¢ å®Œæ•´ ğŸŸ¢ å®Œæ•´ ç³»ç»Ÿè¦æ±‚ ğŸŸ¢ æ— ç‰¹æ®Šè¦æ±‚ ğŸŸ¡ éœ€è¦IOMMU ğŸŸ¡ éœ€è¦IOMMU æ¨èåœºæ™¯ å•ç¡¬ç›˜ç›´é€š å¤šç¡¬ç›˜é˜µåˆ— é«˜æ€§èƒ½NVMeå­˜å‚¨ SMARTæ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ âœ… æ”¯æŒ ğŸ’¡ æœ€ä½³å®è·µå»ºè®® 1. ğŸ­ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² 1 2 3 4 # 1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯ # 2. ç¡®ä¿æœ‰å®Œæ•´çš„æ•°æ®å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆ # 3. é€æ­¥è¿ç§»ï¼Œå…ˆéå…³é”®ä¸šåŠ¡åå…³é”®ä¸šåŠ¡ # 4. å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ 2. ğŸ“ˆ æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 # å®‰è£…æ€§èƒ½ç›‘æ§å·¥å…· apt install iotop htop nvme-cli # ç›‘æ§ç£ç›˜ IO æ€§èƒ½ iostat -x 1 # NVMe ç‰¹å®šç›‘æ§ nvme smart-log /dev/nvme0n1 3. ğŸ¤– è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/bash # è‡ªåŠ¨ç›´é€šè„šæœ¬ç¤ºä¾‹ VM_ID=$1 DISK_ID=$2 INTERFACE=$3 # éªŒè¯å‚æ•° if [ -z \u0026#34;$VM_ID\u0026#34; ] || [ -z \u0026#34;$DISK_ID\u0026#34; ] || [ -z \u0026#34;$INTERFACE\u0026#34; ]; then echo \u0026#34;ç”¨æ³•: $0 \u0026lt;è™šæ‹ŸæœºID\u0026gt; \u0026lt;ç£ç›˜ID\u0026gt; \u0026lt;æ¥å£\u0026gt;\u0026#34; exit 1 fi # æ‰§è¡Œç›´é€šæ“ä½œ if qm set $VM_ID --$INTERFACE /dev/disk/by-id/$DISK_ID; then echo \u0026#34;âœ… ç¡¬ç›˜ $DISK_ID å·²æˆåŠŸç›´é€šåˆ°è™šæ‹Ÿæœº $VM_ID çš„ $INTERFACE æ¥å£\u0026#34; else echo \u0026#34;âŒ ç›´é€šå¤±è´¥ï¼Œè¯·æ£€æŸ¥å‚æ•°å’Œæƒé™\u0026#34; exit 1 fi 4. ğŸ”„ è¿ç§»ç­–ç•¥ 1 2 3 4 5 6 7 8 # å¯¹äºæ­£åœ¨ä½¿ç”¨çš„ç¡¬ç›˜ï¼Œå»ºè®®ï¼š # 1. å…ˆåˆ›å»ºå®Œæ•´å¤‡ä»½ # 2. åœ¨ä½è´Ÿè½½æ—¶æ®µè¿›è¡Œè¿ç§» # 3. éªŒè¯æ•°æ®å®Œæ•´æ€§ # 4. æ›´æ–°æ–‡æ¡£å’Œç›‘æ§é…ç½® # ä½¿ç”¨ rsync è¿›è¡Œåœ¨çº¿è¿ç§» rsync -av --progress /source/path/ /destination/path/ ğŸ¯ æ€»ç»“å»ºè®®ï¼š é€šè¿‡ä»¥ä¸Šä¸‰ç§æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„ç¡¬ç›˜ç›´é€šæ–¹æ¡ˆã€‚å¯¹äºå¤§å¤šæ•°ç”¨æˆ·ï¼Œå»ºè®®ä»ç®€å•çš„ RDM ç›´é€šå¼€å§‹ï¼Œé€æ­¥å°è¯•æ›´é«˜çº§çš„é…ç½®æ–¹å¼ã€‚è®°å¾—å§‹ç»ˆéµå¾ª\u0026quot;å…ˆæµ‹è¯•åç”Ÿäº§\u0026quot;çš„åŸåˆ™ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œç³»ç»Ÿç¨³å®šã€‚\nğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ\nğŸ“– å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://pve.proxmox.com/wiki/Storage ğŸ’¬ ç¤¾åŒºæ”¯æŒï¼šhttps://forum.proxmox.com/ ğŸ› é—®é¢˜æŠ¥å‘Šï¼šhttps://bugzilla.proxmox.com/ ç¥æ‚¨åœ¨ PVE è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰\n","date":"2024-12-07T14:19:14+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/bca39f7f/","title":"Proxmox VE ç¡¬ç›˜ç›´é€šå®Œå…¨æŒ‡å— ğŸ’¾"},{"content":"Proxmox VE æ ¸æ˜¾ SR-IOV ç›´é€š Windows ğŸ–¥ï¸ ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»åœ¨ Proxmox VE ä¸­é€šè¿‡ SR-IOV æŠ€æœ¯å°† Intel æ ¸æ˜¾ç›´é€šç»™ Windows è™šæ‹Ÿæœºçš„ä¸¤ç§æ–¹æ³•ï¼Œå®ç°ç¡¬ä»¶åŠ é€Ÿå’Œè¿œç¨‹æ¡Œé¢ä¼˜åŒ–ã€‚æ— è®ºæ‚¨æ˜¯å¸Œæœ›è·å¾—æ›´å¥½çš„å›¾å½¢æ€§èƒ½è¿˜æ˜¯æ›´æµç•…çš„è¿œç¨‹æ¡Œé¢ä½“éªŒï¼Œè¿™é‡Œéƒ½æœ‰é€‚åˆæ‚¨çš„è§£å†³æ–¹æ¡ˆï¼\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ æŒ‡å—ç‰¹ç‚¹ ğŸ“‹ å‰ç½®è¦æ±‚ ğŸ¯ æ–¹æ³•ä¸€æ— æ˜¾å¡æ¨¡å¼\u0026ndash;è¿œç¨‹æ¡Œé¢ âš¡ æ–¹æ³•äºŒsr-iov-ç›´é€š\u0026ndash;virtio-gpu ğŸ”§ é«˜çº§é…ç½®é€‰é¡¹ âš ï¸ æ•…éšœæ’é™¤ ğŸ› ï¸ éªŒè¯ä¸æµ‹è¯• ğŸ“Š æ–¹æ³•å¯¹æ¯” ğŸ’¡ ä½¿ç”¨å»ºè®® ğŸ†˜ å¸¸è§é—®é¢˜è§£ç­” âœ¨ æŒ‡å—ç‰¹ç‚¹ âœ… ä¸¤ç§æ–¹æ³•å…¨é¢è¦†ç›–ä¸åŒéœ€æ±‚åœºæ™¯ ğŸ”§ è¯¦ç»†æ­¥éª¤å’Œé…ç½®ç¤ºä¾‹ âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ› ï¸ æ•…éšœæ’é™¤æŒ‡å— ğŸ¯ å®é™…åº”ç”¨åœºæ™¯æ¨è ğŸ“‹ å‰ç½®è¦æ±‚ ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚ âœ… Proxmox VE 7.x æˆ– 8.x âœ… Intel å¤„ç†å™¨å¸¦é›†æˆæ˜¾å¡ï¼ˆæ ¸æ˜¾ï¼‰ âœ… BIOS ä¸­å¯ç”¨ VT-d/IOMMU æ”¯æŒ âœ… Windows 10/11 è™šæ‹Ÿæœº ğŸ”§ å‡†å¤‡å·¥ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 # ç¡®ä¿ SR-IOV æ”¯æŒå·²å¼€å¯ grep -E \u0026#34;SR-IOV|VT-d\u0026#34; /proc/cpuinfo # æ£€æŸ¥æ ¸æ˜¾è®¾å¤‡ lspci | grep -i vga # ç¤ºä¾‹è¾“å‡º: 00:02.0 VGA compatible controller: Intel Corporation ... # æŸ¥çœ‹ IOMMU åˆ†ç»„æƒ…å†µ for d in /sys/kernel/iommu_groups/*/devices/*; do n=${d#*/iommu_groups/*}; n=${n%%/*} printf \u0026#39;IOMMU Group %s \u0026#39; \u0026#34;$n\u0026#34; lspci -nns \u0026#34;${d##*/}\u0026#34; done ğŸ’¾ é©±åŠ¨å‡†å¤‡ ä¸‹è½½æœ€æ–° Intel GPU é©±åŠ¨ç¨‹åº å‡†å¤‡ VirtIO é©±åŠ¨ ISOï¼ˆæ¥è‡ª Fedora é¡¹ç›®ï¼‰ ç¡®ä¿ Windows å®‰è£…é•œåƒå¯ç”¨ ğŸ¯ æ–¹æ³•ä¸€ï¼šæ— æ˜¾å¡æ¨¡å¼ + è¿œç¨‹æ¡Œé¢ 1. ğŸ–¥ï¸ ä¿®æ”¹è™šæ‹Ÿæœºæ˜¾å¡è®¾ç½® åœ¨ PVE Web ç•Œé¢ä¸­é€‰æ‹© Windows è™šæ‹Ÿæœº è¿›å…¥\u0026quot;ç¡¬ä»¶\u0026quot;é€‰é¡¹å¡ æ‰¾åˆ°\u0026quot;æ˜¾å¡\u0026quot;è®¾å¤‡ï¼Œç‚¹å‡»\u0026quot;ç¼–è¾‘\u0026quot; é€‰æ‹©\u0026quot;æ—  (none)\u0026ldquo;ä½œä¸ºæ˜¾å¡ç±»å‹ ç¡®è®¤æ›´æ”¹ 2. ğŸŒ é…ç½®è¿œç¨‹æ¡Œé¢ åœ¨ Windows è™šæ‹Ÿæœºå†…æ“ä½œï¼š\næ‰“å¼€\u0026quot;è®¾ç½®\u0026rdquo; â†’ \u0026ldquo;ç³»ç»Ÿ\u0026rdquo; â†’ \u0026ldquo;è¿œç¨‹æ¡Œé¢\u0026rdquo; å¯ç”¨\u0026quot;å¯ç”¨è¿œç¨‹æ¡Œé¢\u0026quot; ç¡®è®¤é˜²ç«å¢™å…è®¸è¿œç¨‹è¿æ¥ è®¾ç½®ç”¨æˆ·è®¿é—®æƒé™ 3. ğŸ”— è¿œç¨‹è¿æ¥ä¼˜åŒ– 1 2 3 4 5 # ä» Linux å®¢æˆ·ç«¯ä½¿ç”¨ FreeRDPï¼ˆæ€§èƒ½æ›´å¥½ï¼‰ xfreerdp /u:username /p:password /v:192.168.1.100 +fonts /gdi:sw /rfx # æˆ–ä½¿ç”¨ Windows è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢è¿æ¥ # è¿è¡Œ: mstsc.exe ğŸ¯ ä¼˜ç‚¹ï¼š\nâœ… é…ç½®ç®€å•å¿«æ· âœ… å…¼å®¹æ€§æä½³ âœ… æ”¯æŒå¤šç§è¿œç¨‹è¿æ¥æ–¹å¼ âœ… ä¸éœ€è¦ç‰¹æ®Šç¡¬ä»¶æ”¯æŒ âš ï¸ ç¼ºç‚¹ï¼š\nâŒ æ— æ³•åœ¨ PVE æ§åˆ¶å°æ˜¾ç¤º âŒ ä¾èµ–ç½‘ç»œè¿æ¥è´¨é‡ âŒ æ— ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ âš¡ æ–¹æ³•äºŒï¼šSR-IOV ç›´é€š + VirtIO-GPU 1. ğŸ“ ç¼–è¾‘è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ 1 2 # ç¼–è¾‘è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ï¼ˆå°† 249 æ›¿æ¢ä¸ºä½ çš„ VM IDï¼‰ nano /etc/pve/qemu-server/249.conf 2. âš™ï¸ æ·»åŠ  SR-IOV å‚æ•° åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 # SR-IOV æ ¸æ˜¾ç›´é€šé…ç½® args: -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=0x2 3. ğŸ¨ ä¿®æ”¹æ˜¾å¡ç±»å‹ä¸º VirtIO-GPU åœ¨ PVE Web ç•Œé¢ä¸­ï¼š\né€‰æ‹©è™šæ‹Ÿæœº â†’ ç¡¬ä»¶ â†’ æ˜¾å¡ æ›´æ”¹ä¸º\u0026quot;VirtIO-GPU\u0026quot; ä¿å­˜é…ç½® 4. ğŸ“‹ å®Œæ•´é…ç½®æ–‡ä»¶ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # /etc/pve/qemu-server/222.conf ç¤ºä¾‹ agent: 1 balloon: 0 bios: ovmf boot: order=scsi0 cores: 8 cpu: host efidisk0: local-lvm:vm-222-disk-0,size=4M hostpci0: 0000:00:02.0,pcie=1,x-vga=1 machine: pc-q35-9.0 memory: 16384 name: Win11-Gaming net0: virtio=BC:24:11:7A:51:25,bridge=vmbr0,firewall=1 numa: 1 ostype: win11 scsi0: local-lvm:vm-222-disk-1,cache=writeback,discard=on,iothread=1,size=100G scsihw: virtio-scsi-single smbios1: uuid=9a61979c-d867-493b-a99d-f04827963dd0 sockets: 1 usb0: host=1-5,usb3=1 vga: virtio vmgenid: 7fc0938e-4945-4aa5-9a38-26fb18b59a25 # SR-IOV æ ¸æ˜¾ç›´é€šå‚æ•° args: -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=0x2 -set device.hostpci0.x-igd-opregion=on 5. ğŸ’¿ Windows é©±åŠ¨å®‰è£… åœ¨ Windows è™šæ‹Ÿæœºå†…ï¼š\nä¸‹è½½æœ€æ–° Intel GPU é©±åŠ¨ç¨‹åº å®‰è£… VirtIO é©±åŠ¨ï¼ˆæ¥è‡ª Fedora é¡¹ç›®ï¼‰ é‡å¯è™šæ‹Ÿæœºå®Œæˆé©±åŠ¨å®‰è£… æ£€æŸ¥è®¾å¤‡ç®¡ç†å™¨ä¸­çš„æ˜¾ç¤ºé€‚é…å™¨çŠ¶æ€ ğŸ¯ ä¼˜ç‚¹ï¼š\nâœ… ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ âœ… æ›´å¥½çš„å›¾å½¢æ€§èƒ½ âœ… æ”¯æŒ PVE æ§åˆ¶å°æ˜¾ç¤º âœ… å¤šæ˜¾ç¤ºå™¨æ”¯æŒ âš ï¸ ç¼ºç‚¹ï¼š\nâŒ é…ç½®å¤æ‚åº¦è¾ƒé«˜ âŒ éœ€è¦ç‰¹å®šçš„é©±åŠ¨æ”¯æŒ âŒ å¯èƒ½é‡åˆ°å…¼å®¹æ€§é—®é¢˜ ğŸ”§ é«˜çº§é…ç½®é€‰é¡¹ 1. ğŸ–¥ï¸ å¤šæ˜¾ç¤ºå™¨æ”¯æŒ 1 2 # åœ¨é…ç½®æ–‡ä»¶ args ä¸­æ·»åŠ å¤šæ˜¾ç¤ºå™¨å‚æ•° args: -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=0x2 -set device.hostpci0.x-igd-opregion=on 2. ğŸ’¾ æ˜¾å­˜å¤§å°è°ƒæ•´ 1 2 # è°ƒæ•´æ˜¾å­˜å¤§å°ï¼ˆå•ä½ï¼šMBï¼‰ args: -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=0x2 -global igd-passthru.ram-size=2048 3. ğŸ”„ UEFI å›ºä»¶é…ç½® 1 2 # ç¡®ä¿ä½¿ç”¨ OVMF UEFI å›ºä»¶ efidisk0: local:222/vm-222-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K 4. âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # å¯ç”¨ CPU ç±»å‹ä¸º host ä»¥è·å¾—æœ€ä½³æ€§èƒ½ cpu: host # å¯ç”¨ NUMA äº²å’Œæ€§ numa: 1 # ä½¿ç”¨ VirtIO SCSI å•é˜Ÿåˆ—æ§åˆ¶å™¨ scsihw: virtio-scsi-single # å¯ç”¨ IO çº¿ç¨‹ iothread: 1 âš ï¸ æ•…éšœæ’é™¤ 1. ğŸ” å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥ IOMMU æ˜¯å¦å·²å¯ç”¨ dmesg | grep -e DMAR -e IOMMU # å¦‚æœæœªå¯ç”¨ï¼Œç¼–è¾‘ GRUB é…ç½® nano /etc/default/grub # åœ¨ GRUB_CMDLINE_LINUX_DEFAULT ä¸­æ·»åŠ : # Intel: intel_iommu=on iommu=pt # AMD: amd_iommu=on iommu=pt # æ›´æ–° GRUB å¹¶é‡å¯ update-grub reboot 2. âš ï¸ é©±åŠ¨å†²çªè§£å†³ 1 2 3 4 5 6 # å¦‚æœå‡ºç°é©±åŠ¨å†²çªï¼Œå°è¯•å±è”½å®¿ä¸»æœºæ ¸æ˜¾é©±åŠ¨ echo \u0026#34;blacklist i915\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf update-initramfs -u # æˆ–è€…ä»…ç¦ç”¨ç‰¹å®šåŠŸèƒ½ echo \u0026#34;options i915 enable_guc=0\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/i915.conf 3. ğŸ› Windows è“å±é—®é¢˜ å°è¯•ä¸åŒçš„ Intel é©±åŠ¨ç‰ˆæœ¬ æ£€æŸ¥ BIOS ä¸­ VT-d è®¾ç½®æ˜¯å¦æ­£ç¡®å¯ç”¨ ç¡®ä¿ä½¿ç”¨ UEFI å¯åŠ¨è€Œéä¼ ç»Ÿ BIOS å°è¯•å‡å°‘åˆ†é…çš„æ˜¾å­˜å¤§å° 4. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ– 1 2 3 4 5 6 7 # å®‰è£…å¹¶è¿è¡Œ htop ç›‘æ§ CPU ä½¿ç”¨æƒ…å†µ apt install htop htop # ç›‘æ§ GPU ä½¿ç”¨æƒ…å†µï¼ˆéœ€è¦å®‰è£…ç›¸åº”å·¥å…·ï¼‰ apt install intel-gpu-tools intel_gpu_top ğŸ› ï¸ éªŒè¯ä¸æµ‹è¯• 1. âœ… éªŒè¯ç›´é€šçŠ¶æ€ åœ¨ Windows è™šæ‹Ÿæœºå†…ï¼š\næ‰“å¼€\u0026quot;è®¾å¤‡ç®¡ç†å™¨\u0026quot; æŸ¥çœ‹\u0026quot;æ˜¾ç¤ºé€‚é…å™¨\u0026quot; åº”è¯¥æ˜¾ç¤º Intel æ ¸æ˜¾è®¾å¤‡ æ£€æŸ¥è®¾å¤‡çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼ˆæ— æ„Ÿå¹å·ï¼‰ 2. ğŸ® æ€§èƒ½æµ‹è¯• 1 2 3 4 5 # ä½¿ç”¨ Windows å†…ç½®çš„ dxdiag å·¥å…· # è¿è¡Œ: dxdiag.exe # æˆ–ä½¿ç”¨ GPU-Z æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ # è¿è¡Œ 3DMark æˆ– FurMark è¿›è¡Œå‹åŠ›æµ‹è¯• 3. ğŸŒ è¿œç¨‹æ¡Œé¢ä¼˜åŒ– 1 2 3 4 5 6 7 # è°ƒæ•´è¿œç¨‹æ¡Œé¢è®¾ç½®ä»¥è·å¾—æ›´å¥½æ€§èƒ½ # 1. å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ # 2. è°ƒæ•´æ˜¾ç¤ºè´¨é‡å’Œé¢œè‰²æ·±åº¦ # 3. ä½¿ç”¨ H.264/AVC ç¼–ç  # å¯¹äº FreeRDPï¼Œä½¿ç”¨ä»¥ä¸‹å‚æ•°ä¼˜åŒ–æ€§èƒ½ xfreerdp /u:username /p:password /v:192.168.1.100 +glyph-cache +aero +window-drag /gdi:sw /rfx ğŸ“Š æ–¹æ³•å¯¹æ¯” ç‰¹æ€§ æ–¹æ³•ä¸€ï¼ˆæ— æ˜¾å¡ï¼‰ æ–¹æ³•äºŒï¼ˆSR-IOVï¼‰ é…ç½®éš¾åº¦ ğŸŸ¢ ç®€å• ğŸŸ¡ ä¸­ç­‰ æ€§èƒ½ ğŸŸ¡ ä¸€èˆ¬ ğŸŸ¢ ä¼˜ç§€ æ§åˆ¶å°æ˜¾ç¤º âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ ç¡¬ä»¶åŠ é€Ÿ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ å…¼å®¹æ€§ ğŸŸ¢ ä¼˜ç§€ ğŸŸ¡ è‰¯å¥½ å¤šæ˜¾ç¤ºå™¨ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ æ¸¸æˆæ”¯æŒ âŒ æœ‰é™ âœ… è‰¯å¥½ è§†é¢‘ç¼–ç  âŒ è½¯ä»¶ç¼–ç  âœ… ç¡¬ä»¶ç¼–ç  ğŸ’¡ ä½¿ç”¨å»ºè®® 1. ğŸ¯ é€‚ç”¨åœºæ™¯æ¨è æ–¹æ³•ä¸€ï¼šç®€å•çš„è¿œç¨‹æ¡Œé¢éœ€æ±‚ï¼Œä¸éœ€è¦ç¡¬ä»¶åŠ é€Ÿ æ–¹æ³•äºŒï¼šéœ€è¦ç¡¬ä»¶åŠ é€Ÿçš„æ¸¸æˆã€è§†é¢‘ç¼–è¾‘ã€CAD åº”ç”¨ 2. âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®® 1 2 3 4 5 # åˆ†é…è¶³å¤Ÿçš„æ˜¾å­˜ï¼ˆè‡³å°‘ 256MBï¼‰ # ä½¿ç”¨ CPU ç±»å‹: host # å¯ç”¨ NUMA äº²å’Œæ€§ # ä½¿ç”¨ VirtIO å­˜å‚¨å’Œç½‘ç»œé©±åŠ¨ # å¯ç”¨å†™å…¥ç¼“å­˜å’Œä¸¢å¼ƒï¼ˆTRIMï¼‰æ”¯æŒ 3. ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹ ä»…å…è®¸å¯ä¿¡ç½‘ç»œè®¿é—®è¿œç¨‹æ¡Œé¢ ä½¿ç”¨å¼ºå¯†ç å’ŒåŒå› ç´ è®¤è¯ å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œé©±åŠ¨ç¨‹åº ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—® 4. ğŸ’¾ å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 # å®šæœŸå¤‡ä»½è™šæ‹Ÿæœºé…ç½® cp /etc/pve/qemu-server/222.conf /backup/location/ # ä½¿ç”¨ vzdump å¤‡ä»½æ•´ä¸ªè™šæ‹Ÿæœº vzdump 222 --compress zstd --mode stop --storage local ğŸ†˜ å¸¸è§é—®é¢˜è§£ç­” Q1: ç›´é€šå Windows è“å±æ€ä¹ˆåŠï¼Ÿ A: å°è¯•ä¸åŒçš„é©±åŠ¨ç‰ˆæœ¬ï¼Œæˆ–æ£€æŸ¥ BIOS ä¸­ VT-d è®¾ç½®ã€‚ç¡®ä¿ä½¿ç”¨ UEFI å¯åŠ¨è€Œéä¼ ç»Ÿ BIOSã€‚\nQ2: æ€§èƒ½ä¸å¦‚é¢„æœŸæ€ä¹ˆåŠï¼Ÿ A: æ£€æŸ¥ CPU åˆ†é…ã€å†…å­˜é…ç½®å’Œé©±åŠ¨ç‰ˆæœ¬ã€‚å°è¯•å¯ç”¨ NUMA å’Œè°ƒæ•´æ˜¾å­˜å¤§å°ã€‚\nQ3: å¦‚ä½•é‡ç½®é…ç½®ï¼Ÿ A: åˆ é™¤é…ç½®æ–‡ä»¶ä¸­çš„ args è¡Œï¼Œå¹¶é‡æ–°é…ç½®æ˜¾å¡ã€‚å¯ä»¥ä»å¤‡ä»½æ¢å¤é…ç½®æ–‡ä»¶ã€‚\nQ4: æ”¯æŒå“ªäº› Intel å¤„ç†å™¨ï¼Ÿ A: å¤§å¤šæ•°ç¬¬ 4 ä»£åŠæ›´æ–°çš„ Intel Core å¤„ç†å™¨éƒ½æ”¯æŒ SR-IOVã€‚å…·ä½“æ”¯æŒæƒ…å†µè¯·æŸ¥é˜… Intel å®˜æ–¹æ–‡æ¡£ã€‚\nQ5: èƒ½å¦ç›´é€šç»™å¤šä¸ªè™šæ‹Ÿæœºï¼Ÿ A: SR-IOV æŠ€æœ¯æ”¯æŒå°†å•ä¸ªç‰©ç†è®¾å¤‡è™šæ‹ŸåŒ–ä¸ºå¤šä¸ªè™šæ‹ŸåŠŸèƒ½(VFs)ï¼Œä½†éœ€è¦ç¡¬ä»¶å’Œé©±åŠ¨ç¨‹åºçš„æ”¯æŒã€‚ç›®å‰ Intel æ ¸æ˜¾çš„ SR-IOV æ”¯æŒä»æœ‰é™ã€‚\nğŸ¯ é€šè¿‡ä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„æ ¸æ˜¾ç›´é€šæ–¹æ¡ˆã€‚å»ºè®®å…ˆä½¿ç”¨æ–¹æ³•ä¸€æµ‹è¯•åŸºæœ¬åŠŸèƒ½ï¼Œå†å°è¯•æ–¹æ³•äºŒè·å¾—æ›´å¥½çš„æ€§èƒ½ä½“éªŒã€‚è®°å¾—å§‹ç»ˆéµå¾ª\u0026quot;å…ˆæµ‹è¯•åç”Ÿäº§\u0026quot;çš„åŸåˆ™ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œæ•°æ®å®‰å…¨ã€‚\nğŸ“š æ‰©å±•é˜…è¯»ï¼š\nProxmox VE å®˜æ–¹æ–‡æ¡£ Intel GPU é©±åŠ¨ç¨‹åºä¸‹è½½ VirtIO é©±åŠ¨ç¨‹åºä¸‹è½½ ğŸ’¬ éœ€è¦å¸®åŠ©ï¼Ÿ\nProxmox ç¤¾åŒºè®ºå› Reddit r/Proxmox Proxmox å®˜æ–¹æ”¯æŒ ç¥æ‚¨åœ¨ PVE è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰\n","date":"2024-12-07T14:18:19+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/36b6421b/","title":"Proxmox VE æ ¸æ˜¾ SR-IOV ç›´é€š Windows ğŸ–¥ï¸"},{"content":"Proxmox VE è®¾å¤‡ PCIe ç›´é€šå®Œå…¨æŒ‡å— ğŸ”Œ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»åœ¨ PVE ä¸­é…ç½® PCIe è®¾å¤‡ç›´é€šçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ Intel å’Œ AMD å¹³å°çš„ IOMMU é…ç½®ï¼Œç‰¹åˆ«é’ˆå¯¹ Intel æ ¸æ˜¾ SR-IOV åŠŸèƒ½çš„å¼€å¯å’ŒéªŒè¯ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥å°† GPUã€ç½‘å¡ã€NVMe ç­‰è®¾å¤‡ç›´æ¥åˆ†é…ç»™è™šæ‹Ÿæœºï¼Œè·å¾—æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½ä½“éªŒï¼ğŸš€\nğŸ§­ å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½ä¸ç‰¹ç‚¹ âš™ï¸ ä¸€ã€PCIe è®¾å¤‡ç›´é€šé…ç½® ğŸ” äºŒã€éªŒè¯ PCIe ç›´é€šçŠ¶æ€ ğŸ› ï¸ ä¸‰ã€é«˜çº§é…ç½®é€‰é¡¹ âš ï¸ å››ã€æ•…éšœæ’é™¤ ğŸ’¡ äº”ã€åº”ç”¨åœºæ™¯ç¤ºä¾‹ ğŸ“Š å…­ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ”’ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ¯ å…«ã€å®Œæ•´éªŒè¯æµç¨‹ âœ¨ åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ”§ å…¨é¢æ”¯æŒï¼šæ”¯æŒ Intel å’Œ AMD å¹³å°çš„ IOMMU é…ç½® ğŸ–¥ï¸ æ ¸æ˜¾è™šæ‹ŸåŒ–ï¼šè¯¦ç»†è®²è§£ Intel GPU SR-IOV è™šæ‹ŸåŒ–æŠ€æœ¯ ğŸ“Š æ€§èƒ½ä¼˜åŒ–ï¼šæä¾›å¤šç§æ€§èƒ½è°ƒä¼˜æ–¹æ¡ˆï¼Œå……åˆ†å‘æŒ¥ç¡¬ä»¶æ½œåŠ› ğŸ”’ å®‰å…¨å»ºè®®ï¼šåŒ…å«å®‰å…¨æ³¨æ„äº‹é¡¹ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šå¯é  ğŸ› æ•…éšœæ’é™¤ï¼šå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿæ’æŸ¥é—®é¢˜ ğŸ’¡ å®ç”¨ç¤ºä¾‹ï¼šå¤šç§å®é™…åº”ç”¨åœºæ™¯ï¼Œç›´æ¥å¥—ç”¨å³å¯ âš™ï¸ ä¸€ã€PCIe è®¾å¤‡ç›´é€šé…ç½® 1. é…ç½® GRUB å¯åŠ¨å‚æ•° 1 2 3 4 5 6 7 8 9 # ç¼–è¾‘ GRUB é…ç½®å¯ç”¨ IOMMU å’Œ SR-IOV åŠŸèƒ½ sed -i \u0026#39;/^GRUB_CMDLINE_LINUX_DEFAULT/c\\GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on iommu=pt pcie_acs_override=downstream i915.enable_guc=3 i915.max_vfs=7\u0026#34;\u0026#39; /etc/default/grub # ğŸ”§ å‚æ•°è¯´æ˜: # intel_iommu=on - å¯ç”¨ Intel IOMMUï¼ˆAMD å¹³å°ä½¿ç”¨ amd_iommu=onï¼‰ # iommu=pt - æ ‡è¯†ç”¨äºç›´é€šçš„è®¾å¤‡ # pcie_acs_override - ç»•è¿‡ ACS æ£€æŸ¥ï¼Œè§£å†³åˆ†ç»„é—®é¢˜ï¼ˆå¯èƒ½æœ‰å®‰å…¨é£é™©ï¼‰ # i915.enable_guc=3 - å¯ç”¨ GuC å’Œ HuC å›ºä»¶åŠ è½½ï¼ˆ0=ç¦ç”¨, 1=å¯ç”¨GuC, 2=å¯ç”¨HuC, 3=å…¨éƒ¨å¯ç”¨ï¼‰ # i915.max_vfs=7 - è®¾ç½®æœ€å¤§è™šæ‹ŸåŠŸèƒ½æ•°ä¸º7ï¼ˆæ ¹æ®å…·ä½“æ˜¾å¡è°ƒæ•´ï¼‰ 2. æ·»åŠ å¿…è¦çš„å†…æ ¸æ¨¡å— 1 2 3 4 5 6 7 8 # æ·»åŠ  VFIO ç›¸å…³æ¨¡å—åˆ°è‡ªåŠ¨åŠ è½½åˆ—è¡¨ echo -e \u0026#34;vfio\\nvfio_iommu_type1\\nvfio_pci\\nvfio_virqfd\u0026#34; | tee -a /etc/modules # ğŸ“¦ æ¨¡å—è¯´æ˜: # vfio - è™šæ‹ŸåŠŸèƒ½ I/O æ¡†æ¶ # vfio_iommu_type1 - Type1 IOMMU æ”¯æŒ # vfio_pci - PCI è®¾å¤‡ VFIO é©±åŠ¨ # vfio_virqfd - è™šæ‹Ÿä¸­æ–­å¤„ç† 3. é…ç½® VFIO æ¨¡å—é€‰é¡¹ 1 2 3 4 5 6 # åˆ›å»º VFIO é…ç½®æ–‡ä»¶ echo \u0026#34;options vfio_iommu_type1 allow_unsafe_interrupts=1\u0026#34; \u0026gt; /etc/modprobe.d/vfio.conf echo \u0026#34;options vfio-pci disable_vga=1\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/vfio.conf # ğŸ¯ å¯¹äºç‰¹å®šè®¾å¤‡IDï¼Œå¯ä»¥æ˜ç¡®æŒ‡å®š # echo \u0026#34;options vfio-pci ids=8086:4680,10de:1c03\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/vfio.conf 4. æ›´æ–°ç³»ç»Ÿé…ç½® 1 2 3 4 5 6 7 8 9 # æ›´æ–° GRUB é…ç½® update-grub # æ›´æ–° initramfs æ‰€æœ‰å†…æ ¸ update-initramfs -u -k all # é‡å¯ç³»ç»Ÿä½¿é…ç½®ç”Ÿæ•ˆ reboot # ğŸ”„ é‡å¯åé…ç½®æ‰ä¼šå®Œå…¨ç”Ÿæ•ˆ ğŸ” äºŒã€éªŒè¯ PCIe ç›´é€šçŠ¶æ€ 1. æ£€æŸ¥ PCIe è®¾å¤‡åˆ—è¡¨ 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹æ‰€æœ‰ PCIe è®¾å¤‡ lspci # æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬è®¾å¤‡IDï¼‰ lspci -nn # ğŸ“‹ ç¤ºä¾‹è¾“å‡º: # 00:00.0 Host bridge: Intel Corporation Device 461c [8086:461c] # 00:02.0 VGA compatible controller: Intel Corporation AlderLake-S GT1 [8086:4680] # 00:14.0 USB controller: Intel Corporation Device 54ed [8086:54ed] 2. æ£€æŸ¥ IOMMU åˆ†ç»„ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ IOMMU åˆ†ç»„æƒ…å†µ for d in /sys/kernel/iommu_groups/*/devices/*; do n=${d#*/iommu_groups/*}; n=${n%%/*} printf \u0026#39;IOMMU Group %s \u0026#39; \u0026#34;$n\u0026#34; lspci -nns \u0026#34;${d##*/}\u0026#34; done # ğŸ¯ ç¡®è®¤è¦ç›´é€šçš„è®¾å¤‡åœ¨ç‹¬ç«‹çš„ IOMMU ç»„ä¸­ # å¦‚æœè®¾å¤‡ä¸åœ¨ç‹¬ç«‹ç»„ä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ pcie_acs_override å‚æ•° 3. éªŒè¯ IOMMU æ˜¯å¦å¯ç”¨ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ DMA é‡æ˜ å°„æ˜¯å¦å¯ç”¨ dmesg | grep -i iommu # âœ… åº”è¯¥æ˜¾ç¤º: DMAR: IOMMU enabled # æ£€æŸ¥ Intel IOMMU çŠ¶æ€ dmesg | grep -e DMAR -e IOMMU # ğŸ” ç¡®è®¤æ²¡æœ‰é”™è¯¯ä¿¡æ¯ï¼Œå¦‚: # DMAR: DRHD: handling fault status reg 3 # DMAR: [DMA Read] Request device [00:02.0] fault addr 0xfed90000 4. æ£€æŸ¥æ ¸æ˜¾ SR-IOV çŠ¶æ€ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ Intel æ˜¾å¡ä¿¡æ¯ lspci | grep -i vga # ğŸ–¥ï¸ ç¤ºä¾‹: 00:02.0 VGA compatible controller: Intel Corporation AlderLake-S GT1 # æ£€æŸ¥è™šæ‹ŸåŠŸèƒ½æ”¯æŒ cat /sys/bus/pci/devices/0000:00:02.0/sriov_totalvfs # ğŸ“Š æ˜¾ç¤ºæ”¯æŒçš„è™šæ‹ŸåŠŸèƒ½æ•°é‡ï¼ˆå¦‚æœæ˜¯0åˆ™è¡¨ç¤ºä¸æ”¯æŒæˆ–éœ€è¦å…ˆå¯ç”¨ï¼‰ ğŸ› ï¸ ä¸‰ã€é«˜çº§é…ç½®é€‰é¡¹ 1. è®¾å¤‡é»‘åå•é…ç½® 1 2 3 4 5 6 # é˜²æ­¢å®¿ä¸»æœºå ç”¨è¦ç›´é€šçš„è®¾å¤‡ echo \u0026#34;blacklist i915\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf echo \u0026#34;blacklist nvidia\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf echo \u0026#34;blacklist nouveau\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf # ğŸš« é˜»æ­¢å®¿ä¸»æœºåŠ è½½å¯èƒ½å†²çªçš„é©±åŠ¨ 2. VFIO é©±åŠ¨ç¨‹åºç»‘å®š 1 2 3 4 5 6 7 8 9 10 # æ‰‹åŠ¨ç»‘å®šè®¾å¤‡åˆ° VFIO é©±åŠ¨ echo \u0026#34;8086 4680\u0026#34; \u0026gt; /sys/bus/pci/drivers/vfio-pci/new_id # ğŸ”§ å°†ç‰¹å®šè®¾å¤‡IDç»‘å®šåˆ° VFIOï¼ˆå°† 8086:4680 æ›¿æ¢ä¸ºæ‚¨çš„è®¾å¤‡IDï¼‰ # è§£ç»‘å½“å‰é©±åŠ¨ï¼ˆå¦‚æœéœ€è¦ï¼‰ echo \u0026#34;0000:00:02.0\u0026#34; \u0026gt; /sys/bus/pci/devices/0000:00:02.0/driver/unbind # ç»‘å®šåˆ° VFIO echo \u0026#34;0000:00:02.0\u0026#34; \u0026gt; /sys/bus/pci/drivers/vfio-pci/bind 3. SR-IOV è™šæ‹ŸåŠŸèƒ½åˆ›å»º 1 2 3 4 5 6 7 8 9 10 # å¯ç”¨ SR-IOV è™šæ‹ŸåŠŸèƒ½ echo 7 \u0026gt; /sys/bus/pci/devices/0000:00:02.0/sriov_numvfs # ğŸ¯ åˆ›å»º7ä¸ªè™šæ‹ŸåŠŸèƒ½ï¼ˆæ ¹æ®ç¡¬ä»¶æ”¯æŒè°ƒæ•´ï¼‰ # æ£€æŸ¥è™šæ‹ŸåŠŸèƒ½çŠ¶æ€ lspci | grep \u0026#34;Virtual Function\u0026#34; # æŸ¥çœ‹æ¯ä¸ªVFçš„è¯¦ç»†ä¿¡æ¯ ls /sys/bus/pci/devices/0000:00:02.0/virtfn* âš ï¸ å››ã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¦‚æœ IOMMU æ²¡æœ‰å¯ç”¨ï¼Œæ£€æŸ¥ BIOS è®¾ç½® # ç¡®ä¿ BIOS ä¸­å¯ç”¨: # - VT-d (Intel) æˆ– AMD-Vi (AMD) # - SR-IOV æ”¯æŒ # - Above 4G Decoding # - SVM Mode (AMD) # æ£€æŸ¥å†…æ ¸å‚æ•°æ˜¯å¦æ­£ç¡®åº”ç”¨ cat /proc/cmdline # ğŸ” ç¡®è®¤å‚æ•°åŒ…å«: intel_iommu=on iommu=pt # å¦‚æœè®¾å¤‡ä¸åœ¨ç‹¬ç«‹IOMMUç»„ï¼Œå°è¯•æ·»åŠ : # pcie_acs_override=downstream,multifunction 2. æ¨¡å—åŠ è½½æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥ VFIO æ¨¡å—æ˜¯å¦åŠ è½½ lsmod | grep vfio # âœ… åº”è¯¥æ˜¾ç¤º: vfio_pci, vfio_iommu_type1, vfio # æ£€æŸ¥æ¨¡å—å‚æ•° modinfo vfio-pci # æ‰‹åŠ¨åŠ è½½æ¨¡å— modprobe vfio modprobe vfio_pci modprobe vfio_iommu_type1 # æ£€æŸ¥dmesgæ˜¯å¦æœ‰é”™è¯¯ dmesg | grep -i vfio 3. è®¾å¤‡ç›´é€šéªŒè¯ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥è®¾å¤‡æ˜¯å¦ç”± VFIO é©±åŠ¨ç®¡ç† lspci -nnk | grep -i vfio # ğŸ“‹ æ˜¾ç¤ºç”± VFIO ç®¡ç†çš„è®¾å¤‡åˆ—è¡¨ # æŸ¥çœ‹å…·ä½“è®¾å¤‡çš„é©±åŠ¨ä¿¡æ¯ lspci -vvv -s 00:02.0 | grep driver # åº”è¯¥æ˜¾ç¤º: Kernel driver in use: vfio-pci 4. SR-IOV ç‰¹å®šé—®é¢˜ 1 2 3 4 5 6 7 8 # å¦‚æœæ— æ³•åˆ›å»ºVFï¼Œæ£€æŸ¥GuCå›ºä»¶çŠ¶æ€ dmesg | grep -i guc # æ£€æŸ¥i915é©±åŠ¨çŠ¶æ€ dmesg | grep -i i915 # å¯èƒ½éœ€è¦æ›´æ–°å†…æ ¸æˆ–æ·»åŠ ç‰¹å®šå‚æ•° # å¦‚: i915.enable_guc=2 i915.enable_sriov=1 ğŸ’¡ äº”ã€åº”ç”¨åœºæ™¯ç¤ºä¾‹ 1. æ ¸æ˜¾ç›´é€šç»™è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10 11 12 13 # åœ¨è™šæ‹Ÿæœºé…ç½®ä¸­æ·»åŠ ç›´é€šè®¾å¤‡ qm set 101 -hostpci0 0000:00:02.0 # ğŸ–¥ï¸ å°†æ ¸æ˜¾ç›´é€šç»™è™šæ‹ŸæœºID 101 # å¯¹äº SR-IOV è™šæ‹ŸåŠŸèƒ½ qm set 101 -hostpci0 0000:00:02.1 qm set 102 -hostpci0 0000:00:02.2 # ğŸ¯ å°†ä¸åŒçš„è™šæ‹ŸåŠŸèƒ½åˆ†é…ç»™ä¸åŒè™šæ‹Ÿæœº # åœ¨è™šæ‹Ÿæœºé…ç½®ä¸­å¯ç”¨PCIeç›´é€šé€‰é¡¹ qm set 101 -hostpci0 0000:00:02.0,pcie=1,rombar=0,x-vga=1 2. ç½‘å¡ç›´é€šé…ç½® 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ç½‘å¡è®¾å¤‡ lspci | grep -i ethernet # ğŸŒ ç¤ºä¾‹: 01:00.0 Ethernet controller: Intel Corporation I226-V [8086:125c] # ç›´é€šç½‘å¡åˆ°è™šæ‹Ÿæœº qm set 101 -hostpci1 0000:01:00.0 # å¤šé˜Ÿåˆ—ç½‘å¡ä¼˜åŒ– qm set 101 -hostpci1 0000:01:00.0,queues=4 3. NVMe å­˜å‚¨ç›´é€š 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ NVMe è®¾å¤‡ lspci | grep -i nvme # ğŸ’¾ ç¤ºä¾‹: 06:00.0 Non-Volatile memory controller: Silicon Motion SM2263EN [126f:2263] # ç›´é€š NVMe ç¡¬ç›˜ qm set 101 -hostpci2 0000:06:00.0 # å¯ç”¨PCIe ACS overrideï¼ˆå¦‚æœNVMeä¸åœ¨ç‹¬ç«‹IOMMUç»„ï¼‰ # åœ¨GRUBå‚æ•°ä¸­æ·»åŠ : pcie_acs_override=downstream 4. ç‹¬ç«‹æ˜¾å¡ç›´é€š 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹æ‰€æœ‰GPUè®¾å¤‡ lspci | grep -i vga # ğŸ® ç¤ºä¾‹: 03:00.0 VGA compatible controller: NVIDIA Corporation GP106 [10de:1c03] # ç›´é€šç‹¬ç«‹æ˜¾å¡ qm set 101 -hostpci0 0000:03:00.0 # åŒæ—¶ç›´é€šéŸ³é¢‘è®¾å¤‡ï¼ˆå¦‚æœæœ‰ï¼‰ qm set 101 -hostpci1 0000:03:00.1 ğŸ“Š å…­ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. CPU éš”ç¦»è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 # éš”ç¦» CPU æ ¸å¿ƒç”¨äºç›´é€šè®¾å¤‡ sed -i \u0026#39;s/GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;/\u0026amp;isolcpus=2-3 /\u0026#39; /etc/default/grub # ğŸ”§ éš”ç¦» CPU 2-3 ç”¨äºè™šæ‹Ÿæœºå¤„ç†ä¸­æ–­ # æ›´æ–°åéœ€è¦: update-grub \u0026amp;\u0026amp; reboot # æ£€æŸ¥éš”ç¦»çš„CPU cat /sys/devices/system/cpu/isolated # åœ¨è™šæ‹Ÿæœºé…ç½®ä¸­ç»‘å®švCPUåˆ°éš”ç¦»çš„æ ¸ qm set 101 -cores 2 -sockets 1 2. ä¸­æ–­äº²å’Œæ€§è®¾ç½® 1 2 3 4 5 6 7 8 9 # è®¾ç½®ä¸­æ–­äº²å’Œæ€§ï¼ˆå°†ä¸­æ–­ç»‘å®šåˆ°ç‰¹å®šCPUï¼‰ # é¦–å…ˆæ‰¾åˆ°è®¾å¤‡çš„ä¸­æ–­å· grep \u0026#34;I226\u0026#34; /proc/interrupts | awk \u0026#39;{print $1}\u0026#39; | cut -d: -f1 # ç„¶åè®¾ç½®äº²å’Œæ€§ï¼ˆå‡è®¾ä¸­æ–­å·ä¸º42ï¼Œç»‘å®šåˆ°CPU2ï¼‰ echo 4 \u0026gt; /proc/irq/42/smp_affinity # ğŸ¯ å°†ç½‘å¡ä¸­æ–­ç»‘å®šåˆ°ç‰¹å®š CPUï¼ˆ4 = 2^2ï¼Œè¡¨ç¤ºCPU2ï¼‰ # å¯ä»¥ä½¿ç”¨ irqbalance æœåŠ¡è‡ªåŠ¨ç®¡ç†ä¸­æ–­åˆ†é… 3. å†…å­˜å¤§é¡µé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¯ç”¨å¤§é¡µæ”¯æŒï¼ˆ2MBå¤§é¡µï¼‰ echo \u0026#34;vm.nr_hugepages = 1024\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p # ğŸš€ æé«˜å†…å­˜è®¿é—®æ€§èƒ½ï¼Œå‡å°‘TLB miss # æ£€æŸ¥å¤§é¡µçŠ¶æ€ cat /proc/meminfo | grep Huge # åœ¨è™šæ‹Ÿæœºé…ç½®ä¸­ä½¿ç”¨å¤§é¡µ qm set 101 -hugepages 1 # å¯¹äº1GBå¤§é¡µï¼ˆéœ€è¦CPUå’Œå†…æ ¸æ”¯æŒï¼‰ echo \u0026#34;vm.nr_hugepages = 8\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;vm.hugetlb_shm_group = 107\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf # kvmç»„ID 4. NUMA ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥NUMAæ‹“æ‰‘ numactl -H # ğŸ” æŸ¥çœ‹CPUå’Œå†…å­˜çš„NUMAèŠ‚ç‚¹åˆ†å¸ƒ # å°†è™šæ‹Ÿæœºç»‘å®šåˆ°ç‰¹å®šNUMAèŠ‚ç‚¹ qm set 101 -numa 1 # ç¡®ä¿ç›´é€šè®¾å¤‡ä¸è™šæ‹ŸæœºvCPUåœ¨åŒä¸€NUMAèŠ‚ç‚¹ # ä½¿ç”¨ numactl --cpunodebind=0 --membind=0 æµ‹è¯•æ€§èƒ½ ğŸ”’ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ 1. ACS è¦†ç›–è­¦å‘Š 1 2 3 4 5 6 7 # pcie_acs_override å¯èƒ½é™ä½å®‰å…¨æ€§ # ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ï¼Œå¹¶äº†è§£é£é™© # ğŸ”“ å®‰å…¨æ€§è€ƒè™‘: # - ä»…åœ¨å†…ç½‘ç¯å¢ƒä½¿ç”¨ACS override # - å®šæœŸæ£€æŸ¥ç³»ç»Ÿå®‰å…¨æ›´æ–° # - è€ƒè™‘ä½¿ç”¨æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚ç¡¬ä»¶æ”¯æŒACSï¼‰ 2. è®¾å¤‡éš”ç¦»éªŒè¯ 1 2 3 4 5 6 7 8 9 # ç¡®è®¤ç›´é€šè®¾å¤‡å®Œå…¨ä»å®¿ä¸»æœºéš”ç¦» lspci -nnk | grep -A2 \u0026#34;00:02.0\u0026#34; # âœ… åº”è¯¥æ˜¾ç¤ºç”± vfio-pci é©±åŠ¨ç®¡ç†ï¼Œè€Œä¸æ˜¯å®¿ä¸»æœºé©±åŠ¨ # æ£€æŸ¥è®¾å¤‡æ˜¯å¦åœ¨å®¿ä¸»æœºä¸­ä¸å¯è§ ls /dev/dri/ # ä¸åº”è¯¥çœ‹åˆ°ç›´é€šçš„GPUè®¾å¤‡ # ç¡®ä¿å®¿ä¸»æœºæ²¡æœ‰ä½¿ç”¨ç›´é€šè®¾å¤‡ 3. å®šæœŸå®‰å…¨æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç›´é€šè®¾å¤‡çŠ¶æ€ dmesg | grep -i \u0026#34;vfio\\|iommu\u0026#34; # ğŸ” ç›‘æ§æ˜¯å¦æœ‰é”™è¯¯æˆ–è­¦å‘Šä¿¡æ¯ # æ£€æŸ¥å®‰å…¨æ›´æ–° apt update \u0026amp;\u0026amp; apt list --upgradable # å®šæœŸå®¡æŸ¥ç›´é€šé…ç½® cat /etc/modprobe.d/vfio.conf cat /etc/default/grub 4. è™šæ‹Ÿæœºéš”ç¦» 1 2 3 4 5 6 7 # ç¡®ä¿è™šæ‹Ÿæœºä¹‹é—´çš„è®¾å¤‡éš”ç¦» # ç‰¹åˆ«æ˜¯ä½¿ç”¨SR-IOVæ—¶ï¼Œä¸åŒVFåº”è¯¥åˆ†é…ç»™ä¸åŒè™šæ‹Ÿæœº # ä½¿ç”¨ä¸åŒçš„IOMMUç»„éªŒè¯éš”ç¦» ls /sys/kernel/iommu_groups/ # æ¯ä¸ªè™šæ‹Ÿæœºåº”è¯¥ä½¿ç”¨ä¸åŒIOMMUç»„ä¸­çš„è®¾å¤‡ ğŸ¯ å…«ã€å®Œæ•´éªŒè¯æµç¨‹ 1. é‡å¯åéªŒè¯æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. æ£€æŸ¥ IOMMU çŠ¶æ€ dmesg | grep -i iommu # 2. éªŒè¯ VFIO æ¨¡å— lsmod | grep vfio # 3. æ£€æŸ¥è®¾å¤‡åˆ†ç»„ lspci -vvv # 4. ç¡®è®¤è®¾å¤‡é©±åŠ¨ lspci -nnk | grep -A2 \u0026#34;00:02.0\u0026#34; # 5. æµ‹è¯•ç›´é€šåŠŸèƒ½ # åˆ›å»ºæµ‹è¯•è™šæ‹Ÿæœºå¹¶æ·»åŠ ç›´é€šè®¾å¤‡ 2. æ€§èƒ½æµ‹è¯•å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æµ‹è¯•ç›´é€šè®¾å¤‡æ€§èƒ½ # å¯¹äºç½‘å¡: iperf3 -c target_ip -t 60 -P 4 # å¯¹äºå­˜å‚¨: fio --filename=/dev/nvme0n1 --rw=randread --bs=4k --iodepth=64 \\ --size=1G --name=test --direct=1 --output=result.txt # å¯¹äºæ˜¾å¡ï¼ˆåœ¨è™šæ‹Ÿæœºå†…ï¼‰: glxinfo -B | grep -E \u0026#34;(OpenGL|Renderer)\u0026#34; vainfo # æ£€æŸ¥VAAPIæ”¯æŒ # å¯¹äºSR-IOVè™šæ‹ŸåŠŸèƒ½: # åœ¨æ¯ä¸ªVFåˆ†é…çš„è™šæ‹Ÿæœºä¸­åŒæ—¶è¿è¡Œæ€§èƒ½æµ‹è¯• 3. ç¨³å®šæ€§æµ‹è¯• 1 2 3 4 5 6 7 8 # é•¿æ—¶é—´è¿è¡Œæµ‹è¯• stress-ng --cpu 4 --io 2 --vm 1 --vm-bytes 1G --timeout 24h # ç›‘æ§ç³»ç»ŸçŠ¶æ€ watch -n 1 \u0026#39;dmesg | tail -10; lspci -vvv -s 00:02.0 | grep -i \u0026#34;status\\|error\u0026#34;\u0026#39; # æ£€æŸ¥æ˜¯å¦æœ‰DMAé”™è¯¯æˆ–å…¶ä»–é—®é¢˜ dmesg | grep -i \u0026#34;dma.*error\\|iommu.*error\u0026#34; 4. æ¢å¤æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 # å¦‚æœé…ç½®å‡ºç°é—®é¢˜ï¼Œæ¢å¤æ­¥éª¤: # 1. ä»GRUBä¸­ç§»é™¤ç›´é€šå‚æ•° # 2. æ³¨é‡Šæˆ–åˆ é™¤/etc/modulesä¸­çš„vfioæ¨¡å— # 3. åˆ é™¤/etc/modprobe.d/ä¸­çš„vfioé…ç½®æ–‡ä»¶ # 4. æ›´æ–°grubå’Œinitramfs # 5. é‡å¯ç³»ç»Ÿ # å¤‡ä»½é‡è¦é…ç½® cp /etc/default/grub /etc/default/grub.backup cp /etc/modules /etc/modules.backup ğŸš€ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨çš„ PVE ç³»ç»Ÿåº”è¯¥èƒ½å¤ŸæˆåŠŸæ”¯æŒ PCIe è®¾å¤‡ç›´é€šï¼Œç‰¹åˆ«æ˜¯ Intel æ ¸æ˜¾çš„ SR-IOV åŠŸèƒ½ã€‚è®°å¾—åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå……åˆ†æµ‹è¯•ï¼\nğŸ“ æ›´æ–°æ—¥å¿— 2024-01-15ï¼šåˆå§‹ç‰ˆæœ¬å‘å¸ƒ 2024-01-20ï¼šå¢åŠ SR-IOVæ•…éšœæ’é™¤å†…å®¹ 2024-02-01ï¼šè¡¥å……æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨æ³¨æ„äº‹é¡¹ â“ å¸¸è§é—®é¢˜ Q: ç›´é€šåå®¿ä¸»æœºæ— æ³•æ­£å¸¸å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ\nA: è¿›å…¥æ¢å¤æ¨¡å¼ï¼Œå›æ»šé…ç½®æˆ–ç§»é™¤ç›´é€šå‚æ•°ã€‚\nQ: SR-IOV è™šæ‹ŸåŠŸèƒ½åˆ›å»ºå¤±è´¥ï¼Ÿ\nA: æ£€æŸ¥BIOSä¸­SR-IOVæ”¯æŒæ˜¯å¦å¯ç”¨ï¼Œå°è¯•ä¸åŒçš„i915.enable_gucå€¼ã€‚\nQ: ç›´é€šè®¾å¤‡åœ¨è™šæ‹Ÿæœºä¸­æ— æ³•è¯†åˆ«ï¼Ÿ\nA: ç¡®è®¤è®¾å¤‡å·²ç»‘å®šåˆ°vfio-pcié©±åŠ¨ï¼Œæ£€æŸ¥IOMMUåˆ†ç»„æ˜¯å¦æ­£ç¡®ã€‚\nğŸ”— å‚è€ƒèµ„æº Proxmox VE å®˜æ–¹æ–‡æ¡£ Intel GPU SR-IOV æŠ€æœ¯æŒ‡å— VFIO å†…æ ¸æ–‡æ¡£ å¿«ä¹ç›´é€šï¼ğŸ‰ å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚\n","date":"2024-12-07T14:17:10+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/fb0778ea/","title":"Proxmox VE è®¾å¤‡ PCIe ç›´é€šå®Œå…¨æŒ‡å— ğŸ”Œ"},{"content":"Linux è½¯é“¾æ¥ä¸å¿«æ·é”®åˆ›å»ºæŒ‡å— ğŸ”— æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Linux ä¸­åˆ›å»ºè½¯é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰å’Œè‡ªå®šä¹‰å¿«æ·é”®ï¼Œè®©æ‚¨èƒ½å¤Ÿå¿«é€Ÿè®¿é—®å¸¸ç”¨å‘½ä»¤å’Œè„šæœ¬ï¼Œæå¤§æå‡å·¥ä½œæ•ˆç‡ï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ ç‰¹ç‚¹ä¸ä¼˜åŠ¿ ğŸ“Œ è½¯é“¾æ¥åŸºæœ¬æ¦‚å¿µ ğŸ› ï¸ åˆ›å»ºè½¯é“¾æ¥å‘½ä»¤ ğŸ“ è½¯é“¾æ¥ç®¡ç†å‘½ä»¤ ğŸ¯ å¸¸ç”¨å¿«æ·é”®åˆ›å»ºç¤ºä¾‹ âš™ï¸ ç¯å¢ƒé…ç½®æœ€ä½³å®è·µ ğŸ”§ é«˜çº§ç”¨æ³•æŠ€å·§ âš ï¸ æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯ âœ¨ ç‰¹ç‚¹ä¸ä¼˜åŠ¿ ä½¿ç”¨è½¯é“¾æ¥å’Œå¿«æ·é”®å¯ä»¥ä¸ºæ‚¨å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š\nğŸš€ å¿«é€Ÿè®¿é—®ï¼šä¸€é”®æ‰§è¡Œå¸¸ç”¨å‘½ä»¤å’Œè„šæœ¬ï¼ŒèŠ‚çœæ—¶é—´ ğŸ”§ çµæ´»é…ç½®ï¼šè½»æ¾ç®¡ç†å¤šä¸ªç‰ˆæœ¬çš„å·¥å…·å’Œåº”ç”¨ç¨‹åº ğŸ“‚ ç»„ç»‡æœ‰åºï¼šä¿æŒæ–‡ä»¶ç³»ç»Ÿæ•´æ´ï¼Œé¿å…é‡å¤æ–‡ä»¶ ğŸ¯ ä¸ªæ€§åŒ–å®šåˆ¶ï¼šæ ¹æ®ä¸ªäººä¹ æƒ¯åˆ›å»ºä¸“å±å·¥ä½œæµç¨‹ ğŸ”„ æ˜“äºæ›´æ–°ï¼šåªéœ€ä¿®æ”¹é“¾æ¥ç›®æ ‡å³å¯æ›´æ–°æ‰€æœ‰å¼•ç”¨ ğŸ’¾ èŠ‚çœç©ºé—´ï¼šé¿å…å¤åˆ¶æ–‡ä»¶ï¼Œå‡å°‘ç£ç›˜å ç”¨ ğŸ“Œ è½¯é“¾æ¥åŸºæœ¬æ¦‚å¿µ ä»€ä¹ˆæ˜¯è½¯é“¾æ¥ï¼Ÿ è½¯é“¾æ¥ï¼ˆSymbolic Linkï¼Œåˆç§°ç¬¦å·é“¾æ¥ï¼‰ç±»ä¼¼äº Windows ä¸­çš„å¿«æ·æ–¹å¼ğŸ“ƒï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„ç‰¹æ®Šæ–‡ä»¶ã€‚\nè½¯é“¾æ¥ vs ç¡¬é“¾æ¥ ç‰¹æ€§ è½¯é“¾æ¥ ç¡¬é“¾æ¥ inode ä¸åŒçš„ inode ç›¸åŒçš„ inode è·¨æ–‡ä»¶ç³»ç»Ÿ âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ æŒ‡å‘ç›®å½• âœ… æ”¯æŒ âŒ ä¸æ”¯æŒ åŸæ–‡ä»¶åˆ é™¤ âŒ é“¾æ¥å¤±æ•ˆ âœ… ä»ç„¶æœ‰æ•ˆ æ–‡ä»¶å¤§å° å­˜å‚¨è·¯å¾„é•¿åº¦ ä¸åŸæ–‡ä»¶ç›¸åŒ ğŸ’¡ æç¤ºï¼šè½¯é“¾æ¥æ›´çµæ´»ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼›ç¡¬é“¾æ¥åˆ™æ›´é€‚ç”¨äºæ–‡ä»¶å¤‡ä»½å’Œé˜²æ­¢æ„å¤–åˆ é™¤ã€‚\nğŸ› ï¸ åˆ›å»ºè½¯é“¾æ¥å‘½ä»¤ åŸºæœ¬è¯­æ³• 1 ln -s \u0026lt;ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•\u0026gt; \u0026lt;é“¾æ¥åç§°\u0026gt; æ‚¨çš„ç¤ºä¾‹ï¼šåˆ›å»ºå¿«æ·é”® m 1 2 3 # åˆ›å»ºæŒ‡å‘è„šæœ¬çš„è½¯é“¾æ¥ ln -sf /etc/profile.d/mylook.sh /usr/local/bin/m # ğŸ”— åˆ›å»ºåä¸º m çš„å¿«æ·æ–¹å¼ï¼ŒæŒ‡å‘ mylook.sh è„šæœ¬ å‚æ•°è¯´æ˜ï¼š\n-s: åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰ -f: å¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœé“¾æ¥å·²å­˜åœ¨åˆ™è¦†ç›– /etc/profile.d/mylook.sh: ç›®æ ‡è„šæœ¬æ–‡ä»¶ /usr/local/bin/m: é“¾æ¥æ–‡ä»¶è·¯å¾„ ğŸš¨ æ³¨æ„ï¼šåˆ›å»ºè½¯é“¾æ¥æ—¶ï¼Œç›®æ ‡è·¯å¾„å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œä½†ä½¿ç”¨ç»å¯¹è·¯å¾„æ›´å¯é ï¼Œé¿å…é“¾æ¥ç§»åŠ¨åå¤±æ•ˆã€‚\nğŸ“ è½¯é“¾æ¥ç®¡ç†å‘½ä»¤ 1. æŸ¥çœ‹è½¯é“¾æ¥ä¿¡æ¯ 1 2 3 4 5 6 7 # æŸ¥çœ‹é“¾æ¥è¯¦ç»†ä¿¡æ¯ ls -l /usr/local/bin/m # ğŸ“‹ æ˜¾ç¤º: lrwxrwxrwx 1 root root 23 Jan 01 12:00 /usr/local/bin/m -\u0026gt; /etc/profile.d/mylook.sh # æŸ¥çœ‹é“¾æ¥æŒ‡å‘çš„å®é™…è·¯å¾„ readlink -f /usr/local/bin/m # ğŸ” è¾“å‡º: /etc/profile.d/mylook.sh 2. éªŒè¯è½¯é“¾æ¥ 1 2 3 4 5 6 7 # æ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆ file /usr/local/bin/m # âœ… è¾“å‡º: /usr/local/bin/m: symbolic link to /etc/profile.d/mylook.sh # æµ‹è¯•æ‰§è¡Œå¿«æ·é”® m # ğŸš€ æ‰§è¡Œ mylook.sh è„šæœ¬ 3. åˆ é™¤è½¯é“¾æ¥ 1 2 3 4 5 # å®‰å…¨åˆ é™¤è½¯é“¾æ¥ unlink /usr/local/bin/m # æˆ–è€… rm /usr/local/bin/m # ğŸ—‘ï¸ æ³¨æ„: è¿™åªæ˜¯åˆ é™¤é“¾æ¥ï¼Œä¸ä¼šå½±å“åŸæ–‡ä»¶ 4. ä¿®æ”¹ç°æœ‰é“¾æ¥ 1 2 3 # é‡æ–°åˆ›å»ºé“¾æ¥ï¼ˆè¦†ç›–ç°æœ‰ï¼‰ ln -sf /new/path/to/script.sh /usr/local/bin/m # ğŸ”„ æ›´æ–°é“¾æ¥æŒ‡å‘æ–°çš„ç›®æ ‡ ğŸ¯ å¸¸ç”¨å¿«æ·é”®åˆ›å»ºç¤ºä¾‹ 1. ç³»ç»Ÿç®¡ç†å¿«æ·é”® 1 2 3 4 5 6 7 # å¿«é€Ÿé‡å¯ç½‘ç»œ ln -sf /usr/sbin/systemctl /usr/local/bin/netrestart echo \u0026#39;alias netrestart=\u0026#34;systemctl restart networking\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc # å¿«é€ŸæŸ¥çœ‹æ—¥å¿— ln -sf /usr/bin/tail /usr/local/bin/lastlog echo \u0026#39;alias lastlog=\u0026#34;tail -100 /var/log/syslog\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc 2. å¼€å‘å·¥å…·å¿«æ·é”® 1 2 3 4 5 6 # Python ç¯å¢ƒå¿«æ·æ–¹å¼ ln -sf /usr/bin/python3 /usr/local/bin/py # Git å¸¸ç”¨æ“ä½œ echo \u0026#39;alias gs=\u0026#34;git status\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#39;alias gp=\u0026#34;git push\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc 3. è‡ªå®šä¹‰è„šæœ¬å¿«æ·é”® 1 2 3 4 5 6 7 8 # å¤šä¸ªè„šæœ¬å¿«æ·é”® ln -sf ~/scripts/backup.sh /usr/local/bin/backup ln -sf ~/scripts/update.sh /usr/local/bin/update ln -sf ~/scripts/monitor.sh /usr/local/bin/monitor # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x ~/scripts/*.sh chmod +x /usr/local/bin/backup /usr/local/bin/update /usr/local/bin/monitor âš™ï¸ ç¯å¢ƒé…ç½®æœ€ä½³å®è·µ 1. é€‰æ‹©é“¾æ¥ä½ç½® 1 2 3 4 5 6 7 # ç³»ç»Ÿçº§å¿«æ·é”®ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯ç”¨ï¼‰ /usr/local/bin/ # æ¨èä½ç½® /usr/bin/ # ç³»ç»Ÿå‘½ä»¤ç›®å½• # ç”¨æˆ·çº§å¿«æ·é”®ï¼ˆä»…å½“å‰ç”¨æˆ·ï¼‰ ~/bin/ # ç”¨æˆ·ä¸ªäººbinç›®å½• ~/.local/bin/ # ç”¨æˆ·æœ¬åœ°binç›®å½• 2. é…ç½® PATH ç¯å¢ƒå˜é‡ 1 2 3 4 5 6 # æ£€æŸ¥å½“å‰ PATH echo $PATH # æ·»åŠ ä¸ªäºº bin ç›®å½•åˆ° PATH echo \u0026#39;export PATH=\u0026#34;$HOME/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc 3. æƒé™ç®¡ç† 1 2 3 4 5 6 7 # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chmod 755 /usr/local/bin/m # æ‰€æœ‰äººå¯æ‰§è¡Œ chmod 700 ~/bin/private_cmd # ä»…æ‰€æœ‰è€…å¯æ‰§è¡Œ # è®¾ç½®æ­£ç¡®çš„æ‰€æœ‰æƒ chown root:root /usr/local/bin/m chown $USER:$USER ~/bin/* ğŸ”§ é«˜çº§ç”¨æ³•æŠ€å·§ 1. å‚æ•°åŒ–å¿«æ·é”® 1 2 3 4 5 6 7 # åˆ›å»ºå¸¦å‚æ•°çš„å¿«æ·æ–¹å¼ echo \u0026#39;alias search=\u0026#34;grep -rn \\$1 /path/to/search\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc # ğŸ” ä½¿ç”¨: search keyword # å‡½æ•°å¼å¿«æ·é”® echo \u0026#39;m() { /etc/profile.d/mylook.sh \u0026#34;$@\u0026#34;; }\u0026#39; \u0026gt;\u0026gt; ~/.bashrc export -f m 2. æ¡ä»¶æ‰§è¡Œé“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»ºæ™ºèƒ½é“¾æ¥è„šæœ¬ cat \u0026gt; /usr/local/bin/smart-cmd \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash if [ -f \u0026#34;/etc/profile.d/mylook.sh\u0026#34; ]; then /etc/profile.d/mylook.sh \u0026#34;$@\u0026#34; else echo \u0026#34;åŸè„šæœ¬ä¸å­˜åœ¨ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ\u0026#34; # å¤‡ç”¨å‘½ä»¤ fi EOF chmod +x /usr/local/bin/smart-cmd 3. é“¾æ¥ç»´æŠ¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # åˆ›å»ºé“¾æ¥ç®¡ç†è„šæœ¬ cat \u0026gt; ~/bin/link-manager \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash case \u0026#34;$1\u0026#34; in create) ln -sf \u0026#34;$2\u0026#34; \u0026#34;$3\u0026#34; echo \u0026#34;åˆ›å»ºé“¾æ¥: $3 -\u0026gt; $2\u0026#34; ;; list) find /usr/local/bin -type l -exec ls -la {} \\; ;; repair) for link in /usr/local/bin/*; do if [ -L \u0026#34;$link\u0026#34; ] \u0026amp;\u0026amp; [ ! -e \u0026#34;$link\u0026#34; ]; then echo \u0026#34;ä¿®å¤æŸåçš„é“¾æ¥: $link\u0026#34; rm \u0026#34;$link\u0026#34; fi done ;; *) echo \u0026#34;ç”¨æ³•: link-manager [create|list|repair]\u0026#34; ;; esac EOF chmod +x ~/bin/link-manager âš ï¸ æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 # é“¾æ¥ç›®æ ‡ä¸å­˜åœ¨ ln -s /nonexistent/path /usr/local/bin/badlink # âŒ åˆ›å»ºæ—¶ä¼šæˆåŠŸï¼Œä½†ä½¿ç”¨æ—¶æŠ¥é”™ # æƒé™é—®é¢˜ ln -s /root/secret.sh /usr/local/bin/secret # âŒ æ™®é€šç”¨æˆ·å¯èƒ½æ— æƒé™æ‰§è¡Œ # å¾ªç¯é“¾æ¥ ln -s /usr/local/bin/m /usr/local/bin/m2 ln -s /usr/local/bin/m2 /usr/local/bin/m # ğŸ” åˆ›å»ºå¾ªç¯å¼•ç”¨ 2. æ•…éšœæ’é™¤å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥é“¾æ¥çŠ¶æ€ ls -l /usr/local/bin/m # éªŒè¯ç›®æ ‡æ–‡ä»¶å­˜åœ¨ test -f /etc/profile.d/mylook.sh \u0026amp;\u0026amp; echo \u0026#34;å­˜åœ¨\u0026#34; || echo \u0026#34;ä¸å­˜åœ¨\u0026#34; # æ£€æŸ¥æ‰§è¡Œæƒé™ test -x /etc/profile.d/mylook.sh \u0026amp;\u0026amp; echo \u0026#34;å¯æ‰§è¡Œ\u0026#34; || echo \u0026#34;ä¸å¯æ‰§è¡Œ\u0026#34; # è°ƒè¯•æ‰§è¡Œ bash -x /usr/local/bin/m 3. å®‰å…¨è€ƒè™‘ 1 2 3 4 # é¿å…ä½¿ç”¨ root åˆ›å»ºç”¨æˆ·é“¾æ¥ # æ£€æŸ¥é“¾æ¥æŒ‡å‘æ˜¯å¦å®‰å…¨ # å®šæœŸå®¡æ ¸ç³»ç»Ÿé“¾æ¥ find /usr/local/bin -type l -exec ls -la {} \\; | grep -v \u0026#34;/usr/local/bin\u0026#34; ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯ 1. å¤šç‰ˆæœ¬è½¯ä»¶ç®¡ç† 1 2 3 4 5 6 7 # Python ç‰ˆæœ¬ç®¡ç† ln -sf /usr/bin/python3.9 /usr/local/bin/python ln -sf /usr/bin/pip3.9 /usr/local/bin/pip # Node.js ç‰ˆæœ¬åˆ‡æ¢ ln -sf /opt/node-v14/bin/node /usr/local/bin/node ln -sf /opt/node-v14/bin/npm /usr/local/bin/npm 2. é¡¹ç›®ç‰¹å®šå·¥å…·é“¾ 1 2 3 4 5 6 # ä¸ºç‰¹å®šé¡¹ç›®åˆ›å»ºå·¥å…·é“¾æ¥ ln -sf /projects/app1/tools/deploy.sh /usr/local/bin/deploy-app1 ln -sf /projects/app2/tools/test.sh /usr/local/bin/test-app2 # é¡¹ç›®ç¯å¢ƒåˆ‡æ¢ echo \u0026#39;alias proj1=\u0026#34;cd /projects/app1 \u0026amp;\u0026amp; source venv/bin/activate\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc 3. ç³»ç»Ÿç»´æŠ¤å¿«æ·æ–¹å¼ 1 2 3 4 5 6 7 # å¸¸ç”¨ç³»ç»Ÿå‘½ä»¤ ln -sf /usr/bin/du /usr/local/bin/diskspace echo \u0026#39;alias diskspace=\u0026#34;du -h --max-depth=1\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc # æ—¥å¿—æŸ¥çœ‹ ln -sf /usr/bin/tail /usr/local/bin/watchlog echo \u0026#39;alias watchlog=\u0026#34;tail -f /var/log/syslog\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bashrc ğŸ¯ æ€»ç»“ï¼šé€šè¿‡åˆç†ä½¿ç”¨è½¯é“¾æ¥å’Œåˆ«åï¼Œæ‚¨å¯ä»¥å¤§å¹…æå‡åœ¨ Linux ç³»ç»Ÿä¸­çš„å·¥ä½œæ•ˆç‡ã€‚è®°å¾—å®šæœŸç»´æŠ¤å’Œæ¸…ç†ä¸å†ä½¿ç”¨çš„é“¾æ¥ï¼\nğŸ“ ä½¿ç”¨æç¤ºï¼š\nåˆ›å»ºé“¾æ¥å‰ï¼Œç¡®ä¿ç›®æ ‡æ–‡ä»¶å­˜åœ¨ä¸”å¯æ‰§è¡Œ å®šæœŸæ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆï¼Œç‰¹åˆ«æ˜¯ç³»ç»Ÿå‡çº§å å¯¹äºé‡è¦æ“ä½œï¼Œå»ºè®®å…ˆæµ‹è¯•é“¾æ¥åŠŸèƒ½ ä½¿ç”¨æè¿°æ€§åç§°åˆ›å»ºé“¾æ¥ï¼Œä¾¿äºè¯†åˆ«å’Œç®¡ç† å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°åˆ©ç”¨ Linux è½¯é“¾æ¥å’Œå¿«æ·é”®åŠŸèƒ½ï¼ğŸ–¥ï¸ğŸ’¨\n","date":"2024-12-07T14:16:37+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/72d39ee8/","title":"Linux è½¯é“¾æ¥ä¸å¿«æ·é”®åˆ›å»ºæŒ‡å— ğŸ”—"},{"content":"iStoreOS Docker ç›®å½•è¿ç§»å®Œå…¨æŒ‡å— ğŸ³ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•å°† iStoreOS çš„ Docker æ•°æ®ç›®å½•è¿ç§»åˆ°æ–°çš„å­˜å‚¨ä½ç½®ï¼Œé‡Šæ”¾ç³»ç»Ÿåˆ†åŒºç©ºé—´å¹¶æé«˜å­˜å‚¨çµæ´»æ€§ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥è½»æ¾å®Œæˆ Docker æ•°æ®è¿ç§»ï¼Œç¡®ä¿æœåŠ¡æ— ç¼åˆ‡æ¢ï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ è¿ç§»ä¼˜åŠ¿ âš¡ å¿«é€Ÿå¼€å§‹ âš ï¸ è¿ç§»å‰å‡†å¤‡ ğŸš€ è¿ç§»æ­¥éª¤ ğŸ”§ é«˜çº§é…ç½®é€‰é¡¹ ğŸ› æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µå»ºè®® âœ… éªŒè¯æ¸…å• âœ¨ è¿ç§»ä¼˜åŠ¿ å°† Docker ç›®å½•è¿ç§»åˆ°ä¸“ç”¨å­˜å‚¨ä½ç½®å¯ä»¥å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š\nğŸ’¾ é‡Šæ”¾ç³»ç»Ÿç©ºé—´ï¼šé¿å… Docker å ç”¨å®è´µçš„ç³»ç»Ÿåˆ†åŒºç©ºé—´ ğŸš€ æå‡æ€§èƒ½ï¼šå°†æ•°æ®å­˜å‚¨åœ¨æ›´å¿«çš„å­˜å‚¨è®¾å¤‡ä¸Šï¼ˆå¦‚ SSDï¼‰ ğŸ“ˆ æ‰©å±•æ€§å¢å¼ºï¼šè½»æ¾æ‰©å±•å­˜å‚¨å®¹é‡è€Œä¸å½±å“ç³»ç»Ÿåˆ†åŒº ğŸ”„ å¤‡ä»½æ›´æ–¹ä¾¿ï¼šç‹¬ç«‹å­˜å‚¨ä½ç½®ä½¿å¤‡ä»½å’Œæ¢å¤æ›´ç®€å• ğŸ›¡ï¸ ç³»ç»Ÿç¨³å®šæ€§ï¼šé˜²æ­¢ Docker æ•°æ®å¢é•¿å¯¼è‡´ç³»ç»Ÿåˆ†åŒºçˆ†æ»¡ ğŸ“Š ç®¡ç†æ›´æ¸…æ™°ï¼šDocker æ•°æ®ä¸ç³»ç»Ÿæ–‡ä»¶åˆ†ç¦»ï¼Œç®¡ç†æ›´ä¾¿æ· âš¡ å¿«é€Ÿå¼€å§‹ åŸºæœ¬è¿ç§»å‘½ä»¤æ¦‚è§ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åœæ­¢ Docker æœåŠ¡ /etc/init.d/dockerd stop # åˆ›å»ºæ–°ç›®å½• mkdir -p /mnt/mydisk/docker/iStoreOS-P1/docker # å¤‡ä»½åŸæ•°æ® cp -r /overlay/upper/opt/docker /overlay/upper/opt/docker-bak # è¿ç§»æ•°æ® mv /overlay/upper/opt/docker/* /mnt/mydisk/docker/iStoreOS-P1/docker/ # é…ç½®æ–°è·¯å¾„ echo \u0026#39;{\u0026#34;data-root\u0026#34;: \u0026#34;/mnt/mydisk/docker/iStoreOS-P1/docker\u0026#34;}\u0026#39; \u0026gt; /etc/docker/daemon.json # å¯åŠ¨ Docker /etc/init.d/dockerd start âš ï¸ æ³¨æ„ï¼šä»¥ä¸Šæ˜¯ç®€åŒ–æµç¨‹ï¼Œè¯¦ç»†æ­¥éª¤è¯·å‚è€ƒä¸‹é¢çš„å®Œæ•´æŒ‡å—ã€‚\nâš ï¸ è¿ç§»å‰å‡†å¤‡ 1. æ£€æŸ¥å½“å‰ Docker ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹å½“å‰ Docker æ ¹ç›®å½• docker info | grep \u0026#39;Docker Root Dir\u0026#39; # ğŸ“ é»˜è®¤ä½ç½®: /overlay/upper/opt/docker # æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨ df -h /overlay/upper/opt/ df -h /mnt/mydisk/ # ğŸ’¾ ç¡®è®¤ç›®æ ‡åˆ†åŒºæœ‰è¶³å¤Ÿç©ºé—´ # è®¡ç®— Docker æ•°æ®å¤§å° du -sh /overlay/upper/opt/docker # ğŸ“Š äº†è§£éœ€è¦è¿ç§»çš„æ•°æ®é‡ 2. å¤‡ä»½é‡è¦æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½ Docker é…ç½®æ–‡ä»¶ cp /etc/docker/daemon.json /etc/docker/daemon.json.backup # åˆ—å‡ºæ‰€æœ‰å®¹å™¨å’Œé•œåƒ docker ps -a docker images docker volume ls # ğŸ“‹ è®°å½•å½“å‰çŠ¶æ€ä»¥ä¾¿éªŒè¯ # å¯¼å‡ºå®¹å™¨åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ docker ps -a --format \u0026#34;table {{.Names}}\\t{{.Image}}\\t{{.Status}}\u0026#34; \u0026gt; docker_containers.list 3. å‡†å¤‡ç›®æ ‡ä½ç½® 1 2 3 4 5 6 7 8 9 10 11 # ç¡®ä¿ç›®æ ‡ä½ç½®æœ‰è¶³å¤Ÿç©ºé—´ TARGET_SIZE=$(du -s /overlay/upper/opt/docker | cut -f1) AVAILABLE_SIZE=$(df /mnt/mydisk/ | awk \u0026#39;NR==2{print $4}\u0026#39;) if [ $TARGET_SIZE -gt $AVAILABLE_SIZE ]; then echo \u0026#34;âŒ é”™è¯¯: ç›®æ ‡ä½ç½®ç©ºé—´ä¸è¶³!\u0026#34; exit 1 fi # åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„ mkdir -p /mnt/mydisk/docker/iStoreOS-P1/docker ğŸš€ è¿ç§»æ­¥éª¤ 1. åœæ­¢ Docker æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # åœæ­¢ Docker æœåŠ¡ /etc/init.d/dockerd stop # ğŸ”´ ç¡®ä¿æ‰€æœ‰å®¹å™¨å·²åœæ­¢ # ç¡®è®¤æœåŠ¡çŠ¶æ€ /etc/init.d/dockerd status # âœ… åº”è¯¥æ˜¾ç¤º: stopped # ç¡®ä¿æ‰€æœ‰å®¹å™¨å·²åœæ­¢ docker ps -q | xargs -r docker stop # ğŸ›‘ åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ 2. åˆ›å»ºæ–°ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 # åˆ›å»ºæ–°çš„ Docker ç›®å½• mkdir -p /mnt/mydisk/docker/iStoreOS-P1/docker # ğŸ“ åˆ›å»ºå¤šå±‚ç›®å½•ç»“æ„ # è®¾ç½®æ­£ç¡®çš„æƒé™ chmod 755 /mnt/mydisk/docker/iStoreOS-P1/docker # è®¾ç½®æ‰€æœ‰æƒï¼ˆå¦‚æœéœ€è¦ï¼‰ chown root:root /mnt/mydisk/docker/iStoreOS-P1/docker 3. å¤‡ä»½åŸæ•°æ®ï¼ˆé‡è¦ï¼ï¼‰ 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºåŸæ•°æ®å¤‡ä»½ cp -r /overlay/upper/opt/docker /overlay/upper/opt/docker-bak # ğŸ¯ å¤‡ä»½åˆ°åŒåˆ†åŒºï¼Œé¿å…è¿ç§»å¤±è´¥æ— æ³•æ¢å¤ # éªŒè¯å¤‡ä»½å®Œæ•´æ€§ du -sh /overlay/upper/opt/docker /overlay/upper/opt/docker-bak # ğŸ“Š ä¸¤ä¸ªç›®å½•å¤§å°åº”è¯¥ç›¸åŒ # å¯é€‰ï¼šåˆ›å»ºå‹ç¼©å¤‡ä»½ tar -czf /overlay/upper/opt/docker-backup-$(date +%Y%m%d).tar.gz -C /overlay/upper/opt/docker . 4. è¿ç§»æ•°æ®åˆ°æ–°ä½ç½® 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨ rsync è¿›è¡Œæ›´å¯é çš„è¿ç§» rsync -avh --progress /overlay/upper/opt/docker/ /mnt/mydisk/docker/iStoreOS-P1/docker/ # ğŸ”„ ä½¿ç”¨ rsync å¯ä»¥æ–­ç‚¹ç»­ä¼ å¹¶éªŒè¯æ•°æ®å®Œæ•´æ€§ # æˆ–è€…ä½¿ç”¨ mv å‘½ä»¤ç§»åŠ¨æ•°æ® mv /overlay/upper/opt/docker/* /mnt/mydisk/docker/iStoreOS-P1/docker/ # ğŸšš ç§»åŠ¨æ‰€æœ‰æ•°æ®æ–‡ä»¶ # éªŒè¯ç§»åŠ¨ç»“æœ ls -la /mnt/mydisk/docker/iStoreOS-P1/docker/ # ğŸ“‹ åº”è¯¥åŒ…å« containers, images, volumes ç­‰ç›®å½• 5. åˆ›å»º Docker é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åˆ›å»ºé…ç½®ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ mkdir -p /etc/docker/ # åˆ›å»ºæ–°çš„ daemon.json é…ç½® cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt; EOF { \u0026#34;data-root\u0026#34;: \u0026#34;/mnt/mydisk/docker/iStoreOS-P1/docker\u0026#34;, \u0026#34;log-level\u0026#34;: \u0026#34;warn\u0026#34;, \u0026#34;iptables\u0026#34;: false, \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;50m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;2\u0026#34; }, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34; } EOF # éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³• jq . /etc/docker/daemon.json \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; echo \u0026#34;âœ… é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®\u0026#34; || echo \u0026#34;âŒ é…ç½®æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯\u0026#34; 6. å›¾å½¢ç•Œé¢é…ç½®ï¼ˆå¯é€‰ï¼‰ åœ¨ iStoreOS åå°ç•Œé¢ä¸­ï¼š\nè¿›å…¥\u0026quot;æœåŠ¡\u0026quot; â†’ \u0026ldquo;Docker\u0026rdquo; â†’ \u0026ldquo;é…ç½®\u0026rdquo; ä¿®æ”¹\u0026quot;æ ¹ç›®å½•\u0026quot;ä¸º: /mnt/mydisk/docker/iStoreOS-P1/docker ä¿å­˜é…ç½® 7. å¯åŠ¨ Docker æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 # å¯åŠ¨ Docker æœåŠ¡ /etc/init.d/dockerd start # ğŸŸ¢ å¯åŠ¨æœåŠ¡ # æ£€æŸ¥å¯åŠ¨çŠ¶æ€ /etc/init.d/dockerd status # âœ… åº”è¯¥æ˜¾ç¤º: running # ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ sleep 10 8. éªŒè¯è¿ç§»ç»“æœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ£€æŸ¥æ–°çš„ Docker æ ¹ç›®å½• docker info | grep \u0026#39;Docker Root Dir\u0026#39; # ğŸ“ åº”è¯¥æ˜¾ç¤º: /mnt/mydisk/docker/iStoreOS-P1/docker # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ docker ps docker ps -a # ğŸ“‹ æ‰€æœ‰å®¹å™¨åº”è¯¥æ­£å¸¸æ˜¾ç¤º # æµ‹è¯•å®¹å™¨åŠŸèƒ½ docker run --rm hello-world # ğŸ¯ æµ‹è¯• Docker åŸºæœ¬åŠŸèƒ½ # æ£€æŸ¥å·å’Œé•œåƒ docker volume ls docker images # âœ… ç¡®è®¤æ‰€æœ‰æ•°æ®éƒ½å·²è¿ç§» 9. æ¸…ç†æ—§æ•°æ® 1 2 3 4 5 6 7 8 9 # ç¡®è®¤æ–°ä½ç½®å·¥ä½œæ­£å¸¸åï¼Œåˆ é™¤å¤‡ä»½ rm -rf /overlay/upper/opt/docker-bak # åˆ é™¤æ—§æ•°æ®ç›®å½• rm -rf /overlay/upper/opt/docker # ğŸ—‘ï¸ é‡Šæ”¾ç³»ç»Ÿåˆ†åŒºç©ºé—´ # å¯é€‰ï¼šåˆ›å»ºç¬¦å·é“¾æ¥ä¿æŒå…¼å®¹æ€§ ln -sf /mnt/mydisk/docker/iStoreOS-P1/docker /overlay/upper/opt/docker 10. é‡å¯ Docker æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 # å®Œå…¨é‡å¯ Docker æœåŠ¡ /etc/init.d/dockerd restart # ğŸ”„ ç¡®ä¿æ‰€æœ‰é…ç½®ç”Ÿæ•ˆ # æœ€ç»ˆçŠ¶æ€æ£€æŸ¥ docker info | grep -E \u0026#39;Docker Root Dir|Storage Driver\u0026#39; # âœ… ç¡®è®¤ä¸€åˆ‡æ­£å¸¸ # éªŒè¯æ‰€æœ‰å®¹å™¨è¿è¡ŒçŠ¶æ€ docker ps --format \u0026#34;table {{.Names}}\\t{{.Image}}\\t{{.Status}}\u0026#34; ğŸ”§ é«˜çº§é…ç½®é€‰é¡¹ 1. ä½¿ç”¨ Overlay2 å­˜å‚¨é©±åŠ¨ 1 2 3 4 5 6 7 8 9 # åœ¨ daemon.json ä¸­æ·»åŠ å­˜å‚¨é©±åŠ¨é…ç½® { \u0026#34;data-root\u0026#34;: \u0026#34;/mnt/mydisk/docker/iStoreOS-P1/docker\u0026#34;, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;storage-opts\u0026#34;: [ \u0026#34;overlay2.override_kernel_check=true\u0026#34;, \u0026#34;overlay2.size\u0026#34;: \u0026#34;20G\u0026#34; ] } 2. é…ç½®æ—¥å¿—è½®è½¬ 1 2 3 4 5 6 7 8 9 10 # æ›´è¯¦ç»†çš„æ—¥å¿—é…ç½® { \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;100m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;3\u0026#34;, \u0026#34;compress\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;labels\u0026#34;: \u0026#34;production\u0026#34; } } 3. ç½‘ç»œé…ç½®ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # ç¦ç”¨ iptables å¹¶é…ç½®è‡ªå®šä¹‰ç½‘ç»œ { \u0026#34;iptables\u0026#34;: false, \u0026#34;bridge\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;default-address-pools\u0026#34;: [ { \u0026#34;base\u0026#34;: \u0026#34;192.168.0.0/16\u0026#34;, \u0026#34;size\u0026#34;: 24 } ], \u0026#34;dns\u0026#34;: [\u0026#34;8.8.8.8\u0026#34;, \u0026#34;8.8.4.4\u0026#34;] } 4. èµ„æºé™åˆ¶é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # è®¾ç½® Docker èµ„æºé™åˆ¶ { \u0026#34;default-ulimits\u0026#34;: { \u0026#34;nofile\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;nofile\u0026#34;, \u0026#34;Hard\u0026#34;: 64000, \u0026#34;Soft\u0026#34;: 64000 } }, \u0026#34;max-concurrent-downloads\u0026#34;: 3, \u0026#34;max-concurrent-uploads\u0026#34;: 2 } ğŸ› æ•…éšœæ’é™¤ 1. è¿ç§»åå®¹å™¨æ— æ³•å¯åŠ¨ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥å®¹å™¨æ—¥å¿— docker logs \u0026lt;container_name\u0026gt; # æ£€æŸ¥å­˜å‚¨é©±åŠ¨å…¼å®¹æ€§ docker info | grep \u0026#39;Storage Driver\u0026#39; # æ¢å¤å¤‡ä»½æ•°æ® cp -r /overlay/upper/opt/docker-bak/* /mnt/mydisk/docker/iStoreOS-P1/docker/ # æ£€æŸ¥æ–‡ä»¶æƒé™ namei -l /mnt/mydisk/docker/iStoreOS-P1/docker 2. æƒé™é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 # ä¿®å¤ç›®å½•æƒé™ chown -R root:root /mnt/mydisk/docker/iStoreOS-P1/docker chmod -R 755 /mnt/mydisk/docker/iStoreOS-P1/docker # æ£€æŸ¥ SELinux/AppArmor sestatus aa-status # å¦‚æœæ˜¯ SELinux é—®é¢˜ restorecon -Rv /mnt/mydisk/docker/iStoreOS-P1/docker 3. ç£ç›˜ç©ºé—´ä¸è¶³ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç›®æ ‡åˆ†åŒºç©ºé—´ df -h /mnt/mydisk/ # æ¸…ç†ä¸å¿…è¦çš„é•œåƒ docker system prune -a # è°ƒæ•´ Docker å­˜å‚¨ä½ç½® # é€‰æ‹©æ›´å¤§çš„åˆ†åŒºè¿›è¡Œè¿ç§» # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨è¯¦æƒ… ncdu /mnt/mydisk/docker/iStoreOS-P1/docker 4. ç½‘ç»œé—®é¢˜ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ Docker ç½‘ç»œé…ç½® docker network ls # é‡å¯ Docker ç½‘ç»œ systemctl restart docker-network # æ£€æŸ¥ iptables è§„åˆ™ iptables -L -n | grep DOCKER 5. æœåŠ¡å¯åŠ¨å¤±è´¥ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹ Docker æœåŠ¡æ—¥å¿— journalctl -u dockerd -n 50 --no-pager # è°ƒè¯•æ¨¡å¼å¯åŠ¨ Docker dockerd --debug # æ£€æŸ¥å†…æ ¸å…¼å®¹æ€§ uname -r modprobe overlay ğŸ’¡ æœ€ä½³å®è·µå»ºè®® 1. å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 7 8 # è®¾ç½®å®šæ—¶æ¸…ç†ä»»åŠ¡ echo \u0026#34;0 3 * * * docker system prune -f\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root # ç›‘æ§ç£ç›˜ä½¿ç”¨ echo \u0026#34;0 * * * * df -h /mnt/mydisk/ \u0026gt;\u0026gt; /var/log/disk-usage.log\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root # å®šæœŸæ£€æŸ¥ Docker å¥åº·çŠ¶æ€ echo \u0026#34;0 2 * * * docker ps -q | xargs -r docker inspect --format=\u0026#39;{{.State.Status}}\u0026#39; | grep -v running \u0026amp;\u0026amp; systemctl restart dockerd\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root 2. å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»º Docker æ•°æ®å¤‡ä»½è„šæœ¬ cat \u0026gt; /usr/local/bin/docker-backup \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh BACKUP_DIR=\u0026#34;/mnt/backup/docker\u0026#34; mkdir -p $BACKUP_DIR tar -czf $BACKUP_DIR/docker-$(date +%Y%m%d).tar.gz -C /mnt/mydisk/docker/iStoreOS-P1/docker . find $BACKUP_DIR -name \u0026#34;docker-*.tar.gz\u0026#34; -mtime +7 -delete EOF chmod +x /usr/local/bin/docker-backup # æ·»åŠ åˆ°è®¡åˆ’ä»»åŠ¡ echo \u0026#34;0 2 * * * /usr/local/bin/docker-backup\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root 3. ç›‘æ§å‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 # è®¾ç½®ç£ç›˜ç©ºé—´å‘Šè­¦ cat \u0026gt; /etc/docker/disk-alert.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh USAGE=$(df /mnt/mydisk/ | awk \u0026#39;NR==2{print $5}\u0026#39; | sed \u0026#34;s/%//\u0026#34;) if [ $USAGE -gt 90 ]; then echo \u0026#34;è­¦å‘Š: Docker å­˜å‚¨ç©ºé—´ä¸è¶³ ${USAGE}%\u0026#34; | logger -t docker-monitor # å‘é€é‚®ä»¶æˆ–é€šçŸ¥ fi EOF chmod +x /etc/docker/disk-alert.sh # æ·»åŠ åˆ°è®¡åˆ’ä»»åŠ¡ echo \u0026#34;*/30 * * * * /etc/docker/disk-alert.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root 4. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 # å¦‚æœä½¿ç”¨ SSDï¼Œå¯ç”¨ TRIM æ”¯æŒ cat \u0026gt;\u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt; EOF \u0026#34;storage-opts\u0026#34;: [ \u0026#34;overlay2.override_kernel_check=true\u0026#34;, \u0026#34;overlay2.size\u0026#34;: \u0026#34;20G\u0026#34; ] EOF # è°ƒæ•´ I/O è°ƒåº¦å™¨ï¼ˆå¦‚æœä½¿ç”¨ SSDï¼‰ echo \u0026#39;echo deadline \u0026gt; /sys/block/sda/queue/scheduler\u0026#39; \u0026gt;\u0026gt; /etc/rc.local âœ… éªŒè¯æ¸…å• å®Œæˆè¿ç§»åï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š\nDocker æœåŠ¡æ­£å¸¸è¿è¡Œ: systemctl status dockerd æ ¹ç›®å½•å·²æ›´æ”¹: docker info | grep 'Docker Root Dir' æ‰€æœ‰å®¹å™¨æ­£å¸¸: docker ps é•œåƒåˆ—è¡¨å®Œæ•´: docker images å·æ•°æ®å¯è®¿é—®: docker volume ls æ–°ç›®å½•æƒé™æ­£ç¡®: ls -ld /mnt/mydisk/docker/iStoreOS-P1/docker å¤‡ä»½å·²æ¸…ç†: ls /overlay/upper/opt/docker* ç³»ç»Ÿæ—¥å¿—æ— é”™è¯¯: dmesg | grep -i docker å®¹å™¨ç½‘ç»œæ­£å¸¸: docker exec \u0026lt;container\u0026gt; ping -c 1 8.8.8.8 å­˜å‚¨é©±åŠ¨æ­£å¸¸: docker info | grep 'Storage Driver' ğŸ‰ æ­å–œï¼ æ‚¨å·²æˆåŠŸå°† Docker æ•°æ®ç›®å½•è¿ç§»åˆ°æ–°çš„å­˜å‚¨ä½ç½®ã€‚ç°åœ¨ç³»ç»Ÿåˆ†åŒºæœ‰æ›´å¤šç©ºé—´ï¼Œä¸” Docker æ•°æ®å­˜å‚¨åœ¨æ›´åˆé€‚çš„å­˜å‚¨è®¾å¤‡ä¸Šã€‚\nğŸ“ åç»­ç»´æŠ¤å»ºè®®ï¼š\nå®šæœŸæ£€æŸ¥ç›®æ ‡åˆ†åŒºçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ è®¾ç½®ç›‘æ§å‘Šè­¦ï¼Œé˜²æ­¢ç£ç›˜ç©ºé—´ä¸è¶³ å®šæœŸå¤‡ä»½ Docker æ•°æ®ç›®å½• å®šæœŸæ¸…ç†ä¸å†ä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨ æ›´æ–°ç³»ç»Ÿæ—¶æ³¨æ„æ£€æŸ¥ Docker é…ç½®æ˜¯å¦ä¿æŒä¸å˜ å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©å®Œæˆ iStoreOS Docker ç›®å½•è¿ç§»ï¼ğŸ–¥ï¸ğŸ’¨\n","date":"2024-12-07T14:15:35+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/45e1ecbc/","title":"iStoreOS Docker ç›®å½•è¿ç§» ğŸ³"},{"content":"Proxmox VE LXC å®¹å™¨ç£ç›˜æŒ‚è½½ä¸ Samba å…±äº« ğŸ–¥ï¸ æœ¬æ•™ç¨‹è¯¦ç»†ä»‹ç»äº†åœ¨ Proxmox VE (PVE) ç¯å¢ƒä¸­é…ç½® LXC å®¹å™¨ç£ç›˜æŒ‚è½½å’Œ Samba å…±äº«çš„å®Œæ•´æµç¨‹ï¼Œå¸®åŠ©æ‚¨å®ç°é«˜æ•ˆçš„æ–‡ä»¶å…±äº«å’Œå­˜å‚¨ç®¡ç†ï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ§ PVE LXC å®¹å™¨ç£ç›˜æŒ‚è½½ ğŸ“‚ åˆ›å»ºä¸éªŒè¯æŒ‚è½½ ğŸ”§ é«˜çº§æŒ‚è½½é€‰é¡¹ ğŸ“ iStoreOS Samba å…±äº«é…ç½® ğŸ‘¥ ç”¨æˆ·ç®¡ç† âš™ï¸ å…±äº«é…ç½® ğŸ”’ å®‰å…¨åŠ å›º ğŸš€ å®¢æˆ·ç«¯è®¿é—®æŒ‡å— ğŸ› æ•…éšœæ’é™¤ ğŸ’¡ æœ€ä½³å®è·µ âœ¨ åŠŸèƒ½ä¸ç‰¹ç‚¹ æœ¬æ•™ç¨‹æ¶µç›–çš„å®Œæ•´åŠŸèƒ½æµç¨‹ï¼š\nğŸ“‚ ç£ç›˜æŒ‚è½½ï¼šå°†ä¸»æœºç£ç›˜æŒ‚è½½åˆ° LXC å®¹å™¨ä¸­ï¼Œå®ç°å­˜å‚¨æ‰©å±• ğŸ”„ æ•°æ®å…±äº«ï¼šé€šè¿‡ Samba å®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«ï¼Œæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿ ğŸ‘¥ ç”¨æˆ·ç®¡ç†ï¼šåˆ›å»ºå’Œç®¡ç† Samba ç”¨æˆ·è´¦æˆ·ï¼Œå®ç°ç²¾ç»†æƒé™æ§åˆ¶ ğŸ”’ æƒé™æ§åˆ¶ï¼šè®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™å’Œè®¿é—®æ§åˆ¶ï¼Œä¿éšœæ•°æ®å®‰å…¨ ğŸŒ ç½‘ç»œè®¿é—®ï¼šé…ç½®ç½‘ç»œå…±äº«ä¾›å…¶ä»–è®¾å¤‡è®¿é—®ï¼Œæå‡åä½œæ•ˆç‡ ğŸ›¡ï¸ å®‰å…¨åŠ å›ºï¼šé€šè¿‡é˜²ç«å¢™å’ŒåŠ å¯†é…ç½®å¢å¼ºå…±äº«å®‰å…¨æ€§ ğŸ“Š ç›‘æ§ç»´æŠ¤ï¼šæä¾›æ•…éšœæ’é™¤å’Œç»´æŠ¤æŒ‡å—ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œ ğŸ§ PVE LXC å®¹å™¨ç£ç›˜æŒ‚è½½ ğŸ“‚ åˆ›å»ºä¸éªŒè¯æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœ¨ PVE ä¸»æœºä¸Šåˆ›å»ºæŒ‚è½½ç›®å½• mkdir -p /mnt/mydisk # å°†ä¸»æœºç›®å½•æŒ‚è½½åˆ° LXC å®¹å™¨ (å®¹å™¨ID: 243) pct set 243 -mp0 /mnt/mydisk,mp=/mnt/mydisk # é‡å¯å®¹å™¨ä½¿æŒ‚è½½ç”Ÿæ•ˆ pct restart 243 # åœ¨å®¹å™¨å†…æŸ¥çœ‹æŒ‚è½½ç‚¹ pct exec 243 -- df -h /mnt/mydisk # æŸ¥çœ‹æŒ‚è½½è¯¦ç»†ä¿¡æ¯ pct exec 243 -- mount | grep mydisk å–æ¶ˆæŒ‚è½½æ“ä½œï¼š\n1 2 3 4 5 6 7 8 # æŸ¥çœ‹å½“å‰æŒ‚è½½ä¿¡æ¯ pct exec 243 -- df -h # å–æ¶ˆæŒ‚è½½ (åœ¨å®¹å™¨å†…æ‰§è¡Œ) pct exec 243 -- umount /mnt/mydisk # æˆ–è€…ä» PVE ç§»é™¤æŒ‚è½½ç‚¹ pct set 243 -mp0 ğŸ”§ é«˜çº§æŒ‚è½½é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨åªè¯»æ¨¡å¼æŒ‚è½½ pct set 243 -mp0 /mnt/mydisk,mp=/mnt/mydisk,ro=1 # ä½¿ç”¨ç‰¹å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹æŒ‚è½½ pct set 243 -mp0 /mnt/mydisk,mp=/mnt/mydisk,backup=1 # æŒ‚è½½å¤šä¸ªç›®å½• pct set 243 -mp0 /mnt/data1,mp=/mnt/data1 pct set 243 -mp1 /mnt/data2,mp=/mnt/data2 # ä½¿ç”¨ç»‘å®šæŒ‚è½½ pct set 243 -mp0 /mnt/mydisk,mp=/mnt/mydisk,bind=1 ğŸ’¡ æç¤ºï¼šä½¿ç”¨ backup=1 é€‰é¡¹å¯ä»¥ç¡®ä¿æŒ‚è½½ç‚¹åœ¨å¤‡ä»½æ—¶è¢«åŒ…å«ï¼Œè€Œ ro=1 åˆ™æä¾›é¢å¤–çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å®¹å™¨å†…æ„å¤–ä¿®æ”¹ä¸»æœºæ–‡ä»¶ã€‚\nğŸ“ iStoreOS Samba å…±äº«é…ç½® ğŸ‘¥ ç”¨æˆ·ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºæ–°ç”¨æˆ· useradd -m -s /bin/bash admin # ä¸ºç”¨æˆ·è®¾ç½®ç³»ç»Ÿå¯†ç  passwd admin # ä¸ºç”¨æˆ·è®¾ç½® Samba å¯†ç  smbpasswd -a admin # æŸ¥çœ‹å·²åˆ›å»ºçš„ Samba ç”¨æˆ· pdbedit -L # åˆ é™¤ Samba ç”¨æˆ· smbpasswd -x admin # å¯ç”¨/ç¦ç”¨ç”¨æˆ· smbpasswd -e admin smbpasswd -d admin âš™ï¸ å…±äº«é…ç½® é€šè¿‡ Web ç•Œé¢é…ç½®ï¼š\nç™»å½• iStoreOS ç®¡ç†ç•Œé¢ è¿›å…¥\u0026quot;æœåŠ¡\u0026quot; â†’ \u0026ldquo;ç½‘ç»œå…±äº«\u0026rdquo; ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot;æŒ‰é’®åˆ›å»ºæ–°å…±äº« é…ç½®ä»¥ä¸‹å‚æ•°ï¼š åç§°: å…±äº«æ˜¾ç¤ºåç§°ï¼ˆå¦‚ï¼šmydiskï¼‰ è·¯å¾„: /mnt/mydisk å…è®¸ç”¨æˆ·: adminï¼ˆæˆ–é€‰æ‹©ç”¨æˆ·ç»„ï¼‰ æƒé™: è¯»å†™/åªè¯» å…è®¸åŒ¿åè®¿é—®: æ ¹æ®éœ€æ±‚é€‰æ‹© å¯æµè§ˆ: æ˜¯/å¦ ç‚¹å‡»\u0026quot;ä¿å­˜å¹¶åº”ç”¨\u0026quot; é€šè¿‡é…ç½®æ–‡ä»¶ç¼–è¾‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # ç¼–è¾‘ Samba é…ç½®æ–‡ä»¶ vi /etc/samba/smb.conf # æ·»åŠ ä»¥ä¸‹å†…å®¹ [mydisk] path = /mnt/mydisk valid users = admin read only = no writable = yes browseable = yes public = no create mask = 0777 directory mask = 0777 force user = admin force group = admin # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• testparm # é‡å¯ Samba æœåŠ¡ /etc/init.d/samba restart # æˆ– systemctl restart smbd nmbd å¤šç”¨æˆ·æƒé™ç®¡ç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # åˆ›å»ºå¤šä¸ªç”¨æˆ· useradd -m user1 useradd -m user2 # è®¾ç½® Samba å¯†ç  smbpasswd -a user1 smbpasswd -a user2 # åˆ›å»ºç”¨æˆ·ç»„ groupadd smbusers # å°†ç”¨æˆ·æ·»åŠ åˆ°ç»„ usermod -aG smbusers user1 usermod -aG smbusers user2 # è®¾ç½®ç›®å½•ç»„æƒé™ chown -R admin:smbusers /mnt/mydisk chmod -R 2770 /mnt/mydisk # è®¾ç½® setgid ä½ä¿æŒç»„æƒé™ # é…ç½®ç»„å…±äº« [mydisk] path = /mnt/mydisk valid users = @smbusers read only = no writable = yes create mask = 0770 directory mask = 0770 force group = smbusers ğŸ”’ å®‰å…¨åŠ å›º é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¼€æ”¾ Samba æ‰€éœ€ç«¯å£ uci add firewall rule uci set firewall.@rule[-1].name=\u0026#39;Allow-Samba\u0026#39; uci set firewall.@rule[-1].src=\u0026#39;lan\u0026#39; uci set firewall.@rule[-1].proto=\u0026#39;tcp\u0026#39; uci set firewall.@rule[-1].dest_port=\u0026#39;139 445\u0026#39; uci set firewall.@rule[-1].target=\u0026#39;ACCEPT\u0026#39; uci commit firewall /etc/init.d/firewall restart # æˆ–è€…ç›´æ¥ä½¿ç”¨ iptables iptables -A INPUT -p tcp -m multiport --dports 139,445 -j ACCEPT iptables -A INPUT -p udp -m multiport --dports 137,138 -j ACCEPT è®¿é—®æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 # åœ¨ smb.conf ä¸­é…ç½®è®¿é—®æ§åˆ¶ [global] hosts allow = 192.168.1.0/24 127.0.0.1 hosts deny = 0.0.0.0/0 [mydisk] hosts allow = 192.168.1.50 192.168.1.100 read list = user1 write list = admin invalid users = root æ—¥å¿—ä¸ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # é…ç½®è¯¦ç»†æ—¥å¿— [global] log level = 1 log file = /var/log/samba/log.%m max log size = 1000 # åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½® cat \u0026gt; /etc/logrotate.d/samba \u0026lt;\u0026lt; EOF /var/log/samba/*.log { daily missingok rotate 7 compress delaycompress notifempty create 644 root root } EOF ğŸš€ å®¢æˆ·ç«¯è®¿é—®æŒ‡å— Windows å®¢æˆ·ç«¯ æ‰“å¼€\u0026quot;æ–‡ä»¶èµ„æºç®¡ç†å™¨\u0026quot; åœ¨åœ°å€æ è¾“å…¥: \\\\\u0026lt;iStoreOS-IP\u0026gt;\\mydisk è¾“å…¥ç”¨æˆ·åå’Œå¯†ç : admin / [ä½ çš„å¯†ç ] å‹¾é€‰\u0026quot;è®°ä½æˆ‘çš„å‡­æ®\u0026quot; å¦‚éœ€æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ï¼š å³é”®ç‚¹å‡»\u0026quot;æ­¤ç”µè„‘\u0026quot; â†’ \u0026ldquo;æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨\u0026rdquo; é€‰æ‹©é©±åŠ¨å™¨å­—æ¯ è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„: \\\\\u0026lt;iStoreOS-IP\u0026gt;\\mydisk å‹¾é€‰\u0026quot;ä½¿ç”¨å…¶ä»–å‡­æ®è¿æ¥\u0026quot; macOS å®¢æˆ·ç«¯ æ‰“å¼€\u0026quot;è®¿è¾¾\u0026quot; ç‚¹å‡»\u0026quot;å‰å¾€\u0026quot; â†’ \u0026ldquo;è¿æ¥æœåŠ¡å™¨\u0026rdquo; è¾“å…¥: smb://\u0026lt;iStoreOS-IP\u0026gt;/mydisk è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  å¦‚éœ€è‡ªåŠ¨æŒ‚è½½ï¼š ç³»ç»Ÿåå¥½è®¾ç½® â†’ ç”¨æˆ·ä¸ç¾¤ç»„ â†’ ç™»å½•é¡¹ æ·»åŠ  Samba å…±äº« Linux å®¢æˆ·ç«¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å®‰è£…å®¢æˆ·ç«¯è½¯ä»¶ sudo apt install cifs-utils # åˆ›å»ºæŒ‚è½½ç‚¹ sudo mkdir /mnt/samba-share # æ‰‹åŠ¨æŒ‚è½½ sudo mount -t cifs -o username=admin,password=ä½ çš„å¯†ç ,uid=$(id -u),gid=$(id -g) //\u0026lt;iStoreOS-IP\u0026gt;/mydisk /mnt/samba-share # ä½¿ç”¨å‡­æ®æ–‡ä»¶æ›´å®‰å…¨ echo \u0026#34;username=admin\u0026#34; \u0026gt; ~/.smbcredentials echo \u0026#34;password=ä½ çš„å¯†ç \u0026#34; \u0026gt;\u0026gt; ~/.smbcredentials chmod 600 ~/.smbcredentials # è‡ªåŠ¨æŒ‚è½½ (ç¼–è¾‘ /etc/fstab) echo \u0026#34;//\u0026lt;iStoreOS-IP\u0026gt;/mydisk /mnt/samba-share cifs credentials=/home/ç”¨æˆ·å/.smbcredentials,uid=$(id -u),gid=$(id -g),iocharset=utf8,file_mode=0777,dir_mode=0777 0 0\u0026#34; | sudo tee -a /etc/fstab # æµ‹è¯•æŒ‚è½½ sudo mount -a ç§»åŠ¨è®¾å¤‡è®¿é—® iOS:\nä½¿ç”¨\u0026quot;æ–‡ä»¶\u0026quot;åº”ç”¨ ç‚¹å‡»å³ä¸Šè§’\u0026quot;Â·Â·Â·\u0026quot; â†’ \u0026ldquo;è¿æ¥æœåŠ¡å™¨\u0026rdquo; è¾“å…¥: smb://\u0026lt;iStoreOS-IP\u0026gt; è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  Android:\nå®‰è£…\u0026quot;Solid Explorer\u0026quot;æˆ–\u0026quot;CX File Explorer\u0026quot; æ·»åŠ æ–°å­˜å‚¨ â†’ LAN/Windows Network è¾“å…¥æœåŠ¡å™¨åœ°å€å’Œå‡­æ® ğŸ› æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ£€æŸ¥ Samba æœåŠ¡çŠ¶æ€ systemctl status smbd nmbd # æŸ¥çœ‹ Samba æ—¥å¿— tail -f /var/log/samba/log.smbd tail -f /var/log/samba/log.nmbd # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• testparm -s # æ£€æŸ¥ç½‘ç»œè¿æ¥ smbclient -L //localhost -U admin # æµ‹è¯•å…±äº«è®¿é—® smbclient //\u0026lt;iStoreOS-IP\u0026gt;/mydisk -U admin # æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ netstat -tulnp | grep -E \u0026#39;(139|445)\u0026#39; nmap -p 139,445 \u0026lt;iStoreOS-IP\u0026gt; æƒé™é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # é‡ç½®ç›®å½•æƒé™ chmod -R 775 /mnt/mydisk chown -R admin:admin /mnt/mydisk # æ£€æŸ¥ ACL è®¾ç½® getfacl /mnt/mydisk # è®¾ç½® ACL æƒé™ setfacl -R -m u:admin:rwx /mnt/mydisk setfacl -R -m g:smbusers:rwx /mnt/mydisk # æ£€æŸ¥ SELinux è®¾ç½® (å¦‚æœå¯ç”¨) sestatus setsebool -P samba_enable_home_dirs on setsebool -P samba_export_all_rw on è¿æ¥é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥ä¸»æœºåè§£æ nmblookup -A \u0026lt;iStoreOS-IP\u0026gt; # æ£€æŸ¥ä¸»æµè§ˆå™¨é€‰ä¸¾ nmblookup -M WORKGROUP # é‡å¯ç½‘ç»œæœåŠ¡ /etc/init.d/network restart # é‡æ–°å¯åŠ¨ Samba æœåŠ¡ systemctl restart smbd nmbd winbind # æ¸…é™¤ Samba ç¼“å­˜ rm -f /var/lib/samba/*.tdb rm -f /var/lib/samba/*.dat ğŸ’¡ æœ€ä½³å®è·µ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœ¨ smb.conf ä¸­æ·»åŠ æ€§èƒ½ä¼˜åŒ–å‚æ•° [global] socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072 read raw = yes write raw = yes use sendfile = yes aio read size = 16384 aio write size = 16384 [mydisk] strict sync = no sync always = no fake oplocks = yes oplocks = yes level2 oplocks = yes å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»º Samba é…ç½®å¤‡ä»½è„šæœ¬ cat \u0026gt; /usr/local/bin/backup_samba.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash BACKUP_DIR=\u0026#34;/mnt/mydisk/backup/samba\u0026#34; mkdir -p $BACKUP_DIR cp /etc/samba/smb.conf \u0026#34;$BACKUP_DIR/smb.conf.$(date +%Y%m%d)\u0026#34; pdbedit -L \u0026gt; \u0026#34;$BACKUP_DIR/smbusers.$(date +%Y%m%d)\u0026#34; tar -czf \u0026#34;$BACKUP_DIR/samba_backup_$(date +%Y%m%d).tar.gz\u0026#34; /etc/samba/ find $BACKUP_DIR -name \u0026#34;*.tar.gz\u0026#34; -mtime +30 -delete EOF chmod +x /usr/local/bin/backup_samba.sh # æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ echo \u0026#34;0 2 * * * /usr/local/bin/backup_samba.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root ç›‘æ§ä¸å‘Šè­¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»º Samba çŠ¶æ€æ£€æŸ¥è„šæœ¬ cat \u0026gt; /usr/local/bin/check_samba.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash SMBD_STATUS=$(systemctl is-active smbd) NMBD_STATUS=$(systemctl is-active nmbd) if [ \u0026#34;$SMBD_STATUS\u0026#34; != \u0026#34;active\u0026#34; ] || [ \u0026#34;$NMBD_STATUS\u0026#34; != \u0026#34;active\u0026#34; ]; then echo \u0026#34;Samba æœåŠ¡å¼‚å¸¸: smbd=$SMBD_STATUS, nmbd=$NMBD_STATUS\u0026#34; | logger -t samba-monitor systemctl restart smbd nmbd fi CONNECTIONS=$(smbstatus -b | grep -c \u0026#34;Connected\u0026#34;) if [ $CONNECTIONS -gt 20 ]; then echo \u0026#34;Samba è¿æ¥æ•°è¿‡å¤š: $CONNECTIONS\u0026#34; | logger -t samba-monitor fi EOF chmod +x /usr/local/bin/check_samba.sh # æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ echo \u0026#34;*/5 * * * * /usr/local/bin/check_samba.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†åœ¨ PVE ç¯å¢ƒä¸­é…ç½® LXC å®¹å™¨ç£ç›˜æŒ‚è½½å’Œ Samba å…±äº«çš„å®Œæ•´æµç¨‹ï¼š\nâœ… ç£ç›˜æŒ‚è½½: å°†ä¸»æœºç›®å½•æŒ‚è½½åˆ° LXC å®¹å™¨ï¼Œæ‰©å±•å­˜å‚¨ç©ºé—´ âœ… ç”¨æˆ·ç®¡ç†: åˆ›å»º Samba ç”¨æˆ·å¹¶è®¾ç½®ç²¾ç»†æƒé™ âœ… å…±äº«é…ç½®: é…ç½® Samba å…±äº«æœåŠ¡ï¼Œæ”¯æŒå¤šç”¨æˆ·è®¿é—® âœ… å®‰å…¨åŠ å›º: è®¾ç½®é˜²ç«å¢™å’Œè®¿é—®æ§åˆ¶ï¼Œä¿éšœæ•°æ®å®‰å…¨ âœ… å®¢æˆ·ç«¯è®¿é—®: é…ç½®å„ç§å®¢æˆ·ç«¯è¿æ¥ï¼Œå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº« âœ… æ•…éšœæ’é™¤: è§£å†³å¸¸è§é—®é¢˜å’Œé”™è¯¯ï¼Œç¡®ä¿æœåŠ¡ç¨³å®š âœ… æœ€ä½³å®è·µ: ä¼˜åŒ–æ€§èƒ½ï¼Œå®æ–½å¤‡ä»½ç­–ç•¥ï¼Œè®¾ç½®ç›‘æ§å‘Šè­¦ ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ç½‘ç»œä¸­å…±äº«å—æ§çš„æ–‡ä»¶èµ„æºäº†ï¼ğŸŒğŸ“‚\nğŸ’¡ æç¤º: å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å’Œæ›´æ–°è½¯ä»¶åŒ…ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç å’Œå®šæœŸæ›´æ¢å¯†ç çš„ç­–ç•¥ï¼Œå¹¶è€ƒè™‘å¯ç”¨åŠ å¯†ä¼ è¾“ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚\n","date":"2024-12-07T14:14:18+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/0ff77328/","title":"Proxmox VE LXC å®¹å™¨ç£ç›˜æŒ‚è½½ä¸ Samba å…±äº« ğŸ–¥ï¸"},{"content":"iStoreOS æŒ‚è½½ç‚¹ç®¡ç†ä¸ç¡¬ç›˜æ ¼å¼åŒ– ğŸ’¾ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ iStoreOS ä¸­ä¿®æ”¹æŒ‚è½½ç‚¹å’Œæ ¼å¼åŒ–ç¡¬ç›˜ï¼ŒåŒ…æ‹¬å›¾å½¢ç•Œé¢æ“ä½œå’Œå‘½ä»¤è¡Œæ–¹æ³•ï¼Œå¸®åŠ©æ‚¨æœ‰æ•ˆç®¡ç†å­˜å‚¨ç©ºé—´ï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½æ¦‚è¿° ğŸ”§ ä¿®æ”¹æŒ‚è½½ç‚¹æ­¥éª¤ â¹ï¸ åœæ­¢ç›¸å…³æœåŠ¡ ğŸ—‘ï¸ åˆ é™¤ç°æœ‰æŒ‚è½½ç‚¹ ğŸ”„ é‡æ–°æŒ‚è½½ ğŸ’¾ æ ¼å¼åŒ–ç¡¬ç›˜æ–¹æ³• ğŸ“¦ å®‰è£…å¿…è¦å·¥å…· ğŸ“Š æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ âš™ï¸ æ‰§è¡Œæ ¼å¼åŒ– âš¡ é«˜çº§æ“ä½œæŒ‡å— ğŸ› æ•…éšœæ’é™¤ ğŸ”§ å®Œæ•´æ“ä½œç¤ºä¾‹ ğŸ’¡ æœ€ä½³å®è·µå»ºè®® âœ¨ åŠŸèƒ½æ¦‚è¿° iStoreOS æä¾›äº†çµæ´»çš„å­˜å‚¨ç®¡ç†åŠŸèƒ½ï¼Œè®©æ‚¨å¯ä»¥ï¼š\nğŸ“‚ çµæ´»æŒ‚è½½ï¼šè½»æ¾ç®¡ç†å¤šä¸ªå­˜å‚¨è®¾å¤‡å’Œåˆ†åŒº ğŸ”„ åŠ¨æ€è°ƒæ•´ï¼šæ— éœ€é‡å¯ç³»ç»Ÿå³å¯ä¿®æ”¹æŒ‚è½½ç‚¹ ğŸ’¾ å¤šç§æ ¼å¼æ”¯æŒï¼šæ”¯æŒ ext4ã€XFSã€Btrfs ç­‰å¤šç§æ–‡ä»¶ç³»ç»Ÿ ğŸ›¡ï¸ å®‰å…¨æ“ä½œï¼šæä¾›æ•°æ®ä¿æŠ¤æœºåˆ¶å’Œå¤‡ä»½é€‰é¡¹ ğŸ“Š å¯è§†åŒ–ç®¡ç†ï¼šé€šè¿‡ Web ç•Œé¢ç›´è§‚ç®¡ç†å­˜å‚¨è®¾å¤‡ âš™ï¸ é«˜çº§é…ç½®ï¼šæ”¯æŒå‘½ä»¤è¡Œæ“ä½œæ»¡è¶³é«˜çº§ç”¨æˆ·éœ€æ±‚ ğŸ”§ ä¿®æ”¹æŒ‚è½½ç‚¹æ­¥éª¤ â¹ï¸ åœæ­¢ç›¸å…³æœåŠ¡ é¦–å…ˆå…³é—­ä¾èµ–å­˜å‚¨çš„æœåŠ¡ï¼š\nè¿›å…¥ iStoreOS åå°ç®¡ç†ç•Œé¢ å¯¼èˆªåˆ°\u0026quot;æœåŠ¡\u0026quot;èœå• æ‰¾åˆ° Docker æœåŠ¡å¹¶åœæ­¢ åœæ­¢ Samba/NFS ç­‰æ–‡ä»¶å…±äº«æœåŠ¡ ç¡®ä¿æ‰€æœ‰å®¹å™¨å’Œå…±äº«æœåŠ¡å·²å®Œå…¨å…³é—­ 1 2 3 4 # é€šè¿‡å‘½ä»¤è¡Œåœæ­¢æœåŠ¡ /etc/init.d/dockerd stop /etc/init.d/samba stop /etc/init.d/nfsd stop ğŸ—‘ï¸ åˆ é™¤ç°æœ‰æŒ‚è½½ç‚¹ æ“ä½œè·¯å¾„ï¼š\nè¿›å…¥\u0026quot;ç³»ç»Ÿ\u0026quot; â†’ \u0026ldquo;æŒ‚è½½ç‚¹\u0026rdquo; æ‰¾åˆ°è¦ä¿®æ”¹çš„æŒ‚è½½ç‚¹ï¼ˆå¦‚ /mnt/mydiskï¼‰ ç‚¹å‡»\u0026quot;åˆ é™¤\u0026quot;æŒ‰é’® ç‚¹å‡»\u0026quot;å¸è½½åˆ†åŒº\u0026quot;ç¡®è®¤æ“ä½œ ä¿å­˜å¹¶åº”ç”¨é…ç½® 1 2 3 4 5 # å‘½ä»¤è¡Œå¸è½½åˆ†åŒº umount /mnt/mydisk # åˆ é™¤ fstab ä¸­çš„æŒ‚è½½é¡¹ï¼ˆå¦‚æœéœ€è¦ï¼‰ sed -i \u0026#39;/\\/mnt\\/mydisk/d\u0026#39; /etc/fstab ğŸ”„ é‡æ–°æŒ‚è½½ æ‰‹åŠ¨æŒ‚è½½æ­¥éª¤ï¼š\nè¿›å…¥\u0026quot;ç³»ç»Ÿ\u0026quot; â†’ \u0026ldquo;æŒ‚è½½ç‚¹\u0026rdquo; ç‚¹å‡»\u0026quot;æ·»åŠ \u0026quot;æˆ–\u0026quot;æ‰‹åŠ¨æŒ‚è½½\u0026quot; é€‰æ‹©è¦æŒ‚è½½çš„åˆ†åŒº ä¿®æ”¹æŒ‚è½½ç‚¹ä¸ºæ‰€éœ€è·¯å¾„ï¼ˆå¦‚ /mnt/mydiskï¼‰ é€‰æ‹©æ–‡ä»¶ç³»ç»Ÿç±»å‹ è®¾ç½®æŒ‚è½½é€‰é¡¹ ä¿å­˜é…ç½®å¹¶åº”ç”¨ 1 2 3 4 5 # å‘½ä»¤è¡Œæ‰‹åŠ¨æŒ‚è½½ mount /dev/sda1 /mnt/mydisk # æ·»åŠ åˆ° fstab å®ç°å¼€æœºè‡ªåŠ¨æŒ‚è½½ echo \u0026#34;/dev/sda1 /mnt/mydisk ext4 defaults 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab ğŸ’¾ æ ¼å¼åŒ–ç¡¬ç›˜æ–¹æ³• ğŸ“¦ å®‰è£…å¿…è¦å·¥å…· 1 2 3 4 5 6 7 # æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£…ç£ç›˜å·¥å…· opkg update opkg install fdisk e2fsprogs xfsprogs btrfs-progs # å®‰è£…å¯é€‰å·¥å…· opkg install parted lsblk # ğŸ“¦ å®‰è£…ç£ç›˜ç®¡ç†å·¥å…·é›† ğŸ“Š æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹ç£ç›˜åˆ†åŒºæƒ…å†µ fdisk -l # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰ç£ç›˜å’Œåˆ†åŒºä¿¡æ¯ # æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯ lsblk -f # ğŸ’¾ æ˜¾ç¤ºå—è®¾å¤‡åŠå…¶æ–‡ä»¶ç³»ç»Ÿ # æŸ¥çœ‹æŒ‚è½½æƒ…å†µ df -hT # ğŸ“Š æ˜¾ç¤ºå·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹å’Œä½¿ç”¨æƒ…å†µ # æŸ¥çœ‹USBè®¾å¤‡ lsusb ls /dev/sd* | grep -o \u0026#39;sd[a-z]\u0026#39; | uniq âš™ï¸ æ‰§è¡Œæ ¼å¼åŒ– é‡è¦ï¼šç¡®è®¤è®¾å¤‡è·¯å¾„ï¼\n1 2 3 4 5 6 7 8 9 10 11 # é¦–å…ˆå¸è½½åˆ†åŒº umount /dev/sda1 # æ ¼å¼åŒ–æŒ‡å®šåˆ†åŒºä¸º ext4 æ–‡ä»¶ç³»ç»Ÿ mkfs.ext4 -m 0 /dev/sda1 # ğŸ¯ å‚æ•°è¯´æ˜: # -m 0: ä¸ºrootä¿ç•™0%çš„ç©ºé—´ï¼ˆæœ€å¤§åŒ–å¯ç”¨ç©ºé—´ï¼‰ # /dev/sda1: è¦æ ¼å¼åŒ–çš„åˆ†åŒºï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ # æ·»åŠ æ ‡ç­¾ï¼ˆæ¨èï¼‰ mkfs.ext4 -L \u0026#34;mydata\u0026#34; /dev/sda1 ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ext4ï¼ˆæ¨èï¼Œå…¼å®¹æ€§å¥½ï¼‰ mkfs.ext4 -m 0 -L \u0026#34;mydata\u0026#34; /dev/sda1 # XFSï¼ˆé«˜æ€§èƒ½ï¼Œå¤§æ–‡ä»¶ä¼˜åŒ–ï¼‰ mkfs.xfs -f -L \u0026#34;mydata\u0026#34; /dev/sda1 # Btrfsï¼ˆé«˜çº§ç‰¹æ€§ï¼Œå¿«ç…§æ”¯æŒï¼‰ mkfs.btrfs -L \u0026#34;mydata\u0026#34; /dev/sda1 # ext3ï¼ˆæ—§ç³»ç»Ÿå…¼å®¹ï¼‰ mkfs.ext3 -L \u0026#34;mydata\u0026#34; /dev/sda1 # FAT32ï¼ˆè·¨å¹³å°å…¼å®¹ï¼‰ mkfs.vfat -F 32 -n \u0026#34;MYDATA\u0026#34; /dev/sda1 é«˜çº§æ ¼å¼åŒ–é€‰é¡¹ï¼š\n1 2 3 4 5 6 7 8 # è®¾ç½®å—å¤§å°ï¼ˆå½±å“æ€§èƒ½ï¼‰ mkfs.ext4 -b 4096 /dev/sda1 # è®¾ç½®inodeæ•°é‡ï¼ˆå¤§é‡å°æ–‡ä»¶æ—¶æœ‰ç”¨ï¼‰ mkfs.ext4 -N 500000 /dev/sda1 # å¼ºåˆ¶æ ¼å¼åŒ–ï¼ˆå³ä½¿è®¾å¤‡å·²æŒ‚è½½ï¼‰ mkfs.ext4 -F /dev/sda1 âš¡ é«˜çº§æ“ä½œæŒ‡å— 1. å®‰å…¨æ“ä½œæµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 1. ç¡®è®¤è®¾å¤‡è·¯å¾„ lsblk -f # 2. å¸è½½åˆ†åŒº umount /dev/sda1 # 3. æ£€æŸ¥åˆ†åŒºæ˜¯å¦åœ¨ä½¿ç”¨ lsof /dev/sda1 fuser -vm /dev/sda1 # 4. å¼ºåˆ¶å¸è½½ï¼ˆå¦‚æœå¿…è¦ï¼‰ umount -f /dev/sda1 lsof | grep /mnt/mydisk | awk \u0026#39;{print $2}\u0026#39; | xargs kill -9 # 5. æ‰§è¡Œæ ¼å¼åŒ– mkfs.ext4 -m 0 -L \u0026#34;mydata\u0026#34; /dev/sda1 2. åˆ†åŒºç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 # ä½¿ç”¨ fdisk è¿›è¡Œåˆ†åŒº fdisk /dev/sda # å¸¸ç”¨ fdisk å‘½ä»¤ï¼š # n - æ–°å»ºåˆ†åŒº # d - åˆ é™¤åˆ†åŒº # p - æ˜¾ç¤ºåˆ†åŒºè¡¨ # t - æ›´æ”¹åˆ†åŒºç±»å‹ # w - ä¿å­˜å¹¶é€€å‡º # q - ä¸ä¿å­˜é€€å‡º # ä½¿ç”¨ parted è¿›è¡Œé«˜çº§åˆ†åŒºï¼ˆæ”¯æŒå¤§äº2TBç£ç›˜ï¼‰ parted /dev/sda 3. è‡ªåŠ¨æŒ‚è½½é…ç½® 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨ UUID è€Œä¸æ˜¯è®¾å¤‡è·¯å¾„ï¼ˆæ›´ç¨³å®šï¼‰ blkid /dev/sda1 # è¾“å‡º: /dev/sda1: UUID=\u0026#34;abcd1234\u0026#34; TYPE=\u0026#34;ext4\u0026#34; # ç¼–è¾‘ fstab æ–‡ä»¶ echo \u0026#39;UUID=abcd1234 /mnt/mydisk ext4 defaults 0 0\u0026#39; \u0026gt;\u0026gt; /etc/fstab # æµ‹è¯• fstab é…ç½® mount -a # âœ… å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œé…ç½®æ­£ç¡® 4. æƒé™è®¾ç½® 1 2 3 4 5 6 7 8 9 10 # è®¾ç½®æŒ‚è½½ç‚¹æƒé™ chmod 755 /mnt/mydisk chown root:root /mnt/mydisk # åˆ›å»ºå¸¸ç”¨å­ç›®å½• mkdir -p /mnt/mydisk/{docker,downloads,backup,media,documents} # è®¾ç½®ç‰¹å®šç›®å½•æƒé™ chmod 777 /mnt/mydisk/downloads chmod 700 /mnt/mydisk/backup ğŸ› æ•…éšœæ’é™¤ 1. å¸¸è§é”™è¯¯è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è®¾å¤‡å¿™ï¼Œæ— æ³•å¸è½½ fuser -km /mnt/mydisk # ç»ˆæ­¢ä½¿ç”¨è¯¥æŒ‚è½½ç‚¹çš„è¿›ç¨‹ umount /mnt/mydisk # æ ¼å¼åŒ–å¤±è´¥ dmesg | tail -20 # æŸ¥çœ‹å†…æ ¸æ—¥å¿— badblocks -v /dev/sda1 # æ£€æŸ¥ç£ç›˜åé“ # æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ fsck /dev/sda1 fsck.ext4 -f /dev/sda1 # æŒ‚è½½å¤±è´¥ dmesg | grep sda1 # æŸ¥çœ‹è®¾å¤‡ç›¸å…³é”™è¯¯ 2. æ•°æ®æ¢å¤ï¼ˆå¦‚æœè¯¯æ“ä½œï¼‰ 1 2 3 4 5 6 7 8 9 # ç«‹å³åœæ­¢å†™å…¥æ“ä½œ # ä½¿ç”¨æ¢å¤å·¥å…·ï¼ˆå¦‚æœå®‰è£…äº†ï¼‰ opkg install testdisk photorec # å°è¯•æ¢å¤æ•°æ® testdisk /dev/sda1 # ä½¿ç”¨ photorec æ¢å¤æ–‡ä»¶ photorec /dev/sda1 3. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # è°ƒæ•´ ext4 æŒ‚è½½å‚æ•° # åœ¨ /etc/fstab ä¸­æ·»åŠ ï¼š /dev/sda1 /mnt/mydisk ext4 defaults,noatime,nodiratime,data=writeback 0 0 # è°ƒæ•´ç£ç›˜è°ƒåº¦å™¨ echo deadline \u0026gt; /sys/block/sda/queue/scheduler # å¯ç”¨ TRIMï¼ˆSSDä¸“ç”¨ï¼‰ fstrim /mnt/mydisk # æ·»åŠ  noatime æŒ‚è½½é€‰é¡¹å‡å°‘å†™å…¥ mount -o remount,noatime /mnt/mydisk 4. ç›‘æ§ç£ç›˜å¥åº· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… smartmontools opkg install smartmontools # æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ smartctl -a /dev/sda # çŸ­æœŸè‡ªæ£€ smartctl -t short /dev/sda # é•¿æœŸè‡ªæ£€ smartctl -t long /dev/sda # æŸ¥çœ‹è‡ªæ£€ç»“æœ smartctl -l selftest /dev/sda ğŸ”§ å®Œæ•´æ“ä½œç¤ºä¾‹ åœºæ™¯ï¼šé‡æ–°æ ¼å¼åŒ–å¹¶æŒ‚è½½æ•°æ®ç›˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # 1. åœæ­¢ç›¸å…³æœåŠ¡ /etc/init.d/dockerd stop /etc/init.d/samba stop /etc/init.d/nfsd stop # 2. å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰ mkdir -p /tmp/backup/ cp -r /mnt/mydisk/* /tmp/backup/ 2\u0026gt;/dev/null || true # 3. å¸è½½åˆ†åŒº umount /dev/sda1 # 4. æ£€æŸ¥åˆ†åŒºä½¿ç”¨æƒ…å†µ fuser -vm /dev/sda1 || true # 5. æ ¼å¼åŒ–åˆ†åŒº mkfs.ext4 -m 0 -L \u0026#34;mydata\u0026#34; /dev/sda1 # 6. é‡æ–°æŒ‚è½½ mount /dev/sda1 /mnt/mydisk # 7. æ¢å¤æ•°æ® cp -r /tmp/backup/* /mnt/mydisk/ 2\u0026gt;/dev/null || true # 8. é…ç½®è‡ªåŠ¨æŒ‚è½½ï¼ˆä½¿ç”¨UUIDï¼‰ UUID=$(blkid -s UUID -o value /dev/sda1) echo \u0026#34;UUID=$UUID /mnt/mydisk ext4 defaults,noatime 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab # 9. é‡å¯æœåŠ¡ /etc/init.d/dockerd start /etc/init.d/samba start /etc/init.d/nfsd start # 10. éªŒè¯æŒ‚è½½ df -h /mnt/mydisk mount | grep mydisk ğŸ’¡ æœ€ä½³å®è·µå»ºè®® 1. å®‰å…¨ç¬¬ä¸€ ğŸ”’ æ“ä½œå‰å¤‡ä»½é‡è¦æ•°æ® ğŸ“‹ è®°å½•å½“å‰åˆ†åŒºçŠ¶æ€ï¼šfdisk -l \u0026gt; /root/disk-info.txt âš ï¸ ç¡®è®¤è®¾å¤‡è·¯å¾„å†æ“ä½œï¼šlsblk -f ğŸ”„ ä½¿ç”¨ UUID è€Œä¸æ˜¯è®¾å¤‡è·¯å¾„è¿›è¡ŒæŒ‚è½½ 2. æ€§èƒ½è€ƒè™‘ ğŸš€ ä½¿ç”¨ ext4 æ–‡ä»¶ç³»ç»Ÿï¼ˆå¹³è¡¡æ€§èƒ½ä¸å…¼å®¹æ€§ï¼‰ ğŸ“Š æ ¹æ®ç”¨é€”é€‰æ‹©åˆé€‚çš„å—å¤§å°ï¼š å¤§æ–‡ä»¶ï¼šè¾ƒå¤§å—å¤§å°ï¼ˆå¦‚ 4Kï¼‰ å°æ–‡ä»¶ï¼šè¾ƒå°å—å¤§å°ï¼ˆå¦‚ 1Kï¼‰ ğŸ”§ ä¼˜åŒ–æŒ‚è½½å‚æ•°ï¼šæ·»åŠ  noatime,nodiratime é€‰é¡¹ ğŸ’¾ å®šæœŸæ•´ç†ç¢ç‰‡ï¼ˆé ext4 æ–‡ä»¶ç³»ç»Ÿï¼‰ 3. ç»´æŠ¤è®¡åˆ’ ğŸ“… å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·ï¼šsmartctl -H /dev/sda ğŸ§¹ æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶ï¼šä½¿ç”¨ ncdu åˆ†æç£ç›˜ä½¿ç”¨ ğŸ’¾ ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨ï¼šè®¾ç½®å‘Šè­¦é˜ˆå€¼ ğŸ”„ å®šæœŸå¤‡ä»½é‡è¦æ•°æ® 4. æ–‡æ¡£è®°å½• 1 2 3 4 5 6 7 8 9 # è®°å½•ç£ç›˜é…ç½® cat \u0026gt; /root/disk-info.txt \u0026lt;\u0026lt; EOF ç£ç›˜è®¾å¤‡: /dev/sda1 æ–‡ä»¶ç³»ç»Ÿ: ext4 æŒ‚è½½ç‚¹: /mnt/mydisk UUID: $(blkid -s UUID -o value /dev/sda1) æ ¼å¼åŒ–æ—¶é—´: $(date) å—å¤§å°: $(tune2fs -l /dev/sda1 | grep \u0026#39;Block size\u0026#39; | awk \u0026#39;{print $3}\u0026#39;) EOF 5. è‡ªåŠ¨åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # åˆ›å»ºæ ¼å¼åŒ–æŒ‚è½½è„šæœ¬ cat \u0026gt; /usr/local/bin/format-disk \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh # è„šæœ¬ç”¨äºå®‰å…¨æ ¼å¼åŒ–ç£ç›˜ DEVICE=$1 MOUNT_POINT=$2 if [ -z \u0026#34;$DEVICE\u0026#34; ] || [ -z \u0026#34;$MOUNT_POINT\u0026#34; ]; then echo \u0026#34;ç”¨æ³•: format-disk \u0026lt;è®¾å¤‡\u0026gt; \u0026lt;æŒ‚è½½ç‚¹\u0026gt;\u0026#34; exit 1 fi # æ£€æŸ¥è®¾å¤‡æ˜¯å¦å­˜åœ¨ if [ ! -b \u0026#34;$DEVICE\u0026#34; ]; then echo \u0026#34;é”™è¯¯: è®¾å¤‡ $DEVICE ä¸å­˜åœ¨\u0026#34; exit 1 fi echo \u0026#34;è­¦å‘Š: æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤ $DEVICE ä¸Šçš„æ‰€æœ‰æ•°æ®!\u0026#34; read -p \u0026#34;ç¡®è®¤ç»§ç»­? (y/N) \u0026#34; -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then echo \u0026#34;æ“ä½œå·²å–æ¶ˆ\u0026#34; exit 1 fi # æ‰§è¡Œæ ¼å¼åŒ–æ“ä½œ umount $DEVICE 2\u0026gt;/dev/null mkfs.ext4 -m 0 -L \u0026#34;$(basename $MOUNT_POINT)\u0026#34; $DEVICE mkdir -p $MOUNT_POINT mount $DEVICE $MOUNT_POINT # æ·»åŠ åˆ° fstab UUID=$(blkid -s UUID -o value $DEVICE) echo \u0026#34;UUID=$UUID $MOUNT_POINT ext4 defaults,noatime 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab echo \u0026#34;æ ¼å¼åŒ–å®Œæˆ: $DEVICE å·²æŒ‚è½½åˆ° $MOUNT_POINT\u0026#34; EOF chmod +x /usr/local/bin/format-disk ğŸ¯ é‡è¦æç¤ºï¼šæ ¼å¼åŒ–æ“ä½œä¼šæ°¸ä¹…åˆ é™¤ç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼è¯·ç¡®ä¿å·²ç»å¤‡ä»½é‡è¦æ–‡ä»¶ï¼Œå¹¶ç¡®è®¤æ“ä½œçš„æ˜¯æ­£ç¡®çš„ç£ç›˜è®¾å¤‡ã€‚\né€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸä¿®æ”¹ iStoreOS çš„æŒ‚è½½ç‚¹å¹¶æ ¼å¼åŒ–ç¡¬ç›˜ã€‚å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–å¯»æ±‚ç¤¾åŒºå¸®åŠ©ã€‚\n","date":"2024-12-07T14:13:16+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a2b42a3a/","title":"iStoreOS æŒ‚è½½ç‚¹ç®¡ç†ä¸ç¡¬ç›˜æ ¼å¼åŒ– ğŸ’¾"},{"content":"Proxmox VE LXC å®¹å™¨é…ç½®æŒ‡å— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 cat \u0026gt;\u0026gt;/etc/pve/lxc/242.conf \u0026lt;\u0026lt;EOF ## å…è®¸å®¹å™¨å¯¹ç‰¹å®šè®¾å¤‡ï¼ˆä¸» 226 æ¬¡ 0ï¼‰è¿›è¡Œè¯»å†™æ‰§è¡Œã€‚ lxc.cgroup2.devices.allow: c 226:0 rwm ## å…è®¸å®¹å™¨å¯¹ç‰¹å®šè®¾å¤‡ï¼ˆä¸» 226 æ¬¡ 128ï¼‰è¿›è¡Œè¯»å†™æ‰§è¡Œã€‚ lxc.cgroup2.devices.allow: c 226:128 rwm ## å…è®¸å®¹å™¨å¯¹ç‰¹å®šè®¾å¤‡ï¼ˆä¸» 29 æ¬¡ 0ï¼‰è¿›è¡Œè¯»å†™æ‰§è¡Œã€‚ lxc.cgroup2.devices.allow: c 29:0 rwm ## å°†å®¿ä¸»æœº /dev/dri ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œç»‘å®šæŒ‚è½½ï¼Œå¯é€‰ï¼Œåˆ›å»ºç›®å½•ã€‚ lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir ## å°†å®¿ä¸»æœº /dev/fb0 æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ï¼Œç»‘å®šæŒ‚è½½ï¼Œå¯é€‰ï¼Œåˆ›å»ºæ–‡ä»¶ã€‚ lxc.mount.entry: /dev/fb0 dev/fb0 none bind,optional,create=file ## å®¹å™¨ä½¿ç”¨æ— é™åˆ¶çš„ AppArmor é…ç½®ï¼Œç”¨äºå…è®¸å®¹å™¨å†…çš„è¿›ç¨‹å…·æœ‰æ›´é«˜çš„ç³»ç»Ÿæƒé™ã€‚ lxc.apparmor.profile: unconfined ## å…è®¸å®¹å™¨å†…çš„è¿›ç¨‹è®¿é—®æ‰€æœ‰çš„ cgroup è®¾å¤‡ã€‚ lxc.cgroup.devices.allow: a ## æ­¤é…ç½®é¡¹ä¸ºç©ºï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å°†ç»§æ‰¿ä¸»æœºç³»ç»Ÿçš„é»˜è®¤èƒ½åŠ›è®¾ç½®ã€‚ lxc.cap.drop: EOF lxc-stop -n 242 \u0026amp;\u0026amp; lxc-start -n 242 -d ","date":"2024-12-07T14:12:00+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/d43449ee/","title":"Proxmox VE LXC å®¹å™¨é…ç½®æŒ‡å—"},{"content":"Debian/PVE/Ubuntu/FnOS é…ç½® SSH æœåŠ¡ğŸ” SSHï¼ˆSecure Shellï¼‰æ˜¯ä¸€ç§åŠ å¯†çš„ç½‘ç»œä¼ è¾“åè®®ï¼Œç”¨äºåœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­æä¾›å®‰å…¨çš„è¿œç¨‹ç™»å½•å’Œå…¶ä»–å®‰å…¨ç½‘ç»œæœåŠ¡ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»åœ¨ Debian 12 ä¸Šé…ç½®å’Œä¼˜åŒ– SSH æœåŠ¡çš„å®Œæ•´æµç¨‹ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ“– ç®€ä»‹ ğŸ› ï¸ ä¸€ã€SSH æœåŠ¡å®‰è£…ä¸åŸºæœ¬é…ç½® âš™ï¸ äºŒã€SSH æœåŠ¡ä¼˜åŒ–é…ç½® å®¢æˆ·ç«¯è¿æ¥ SSH ğŸ”’ å››ã€é«˜çº§å®‰å…¨é…ç½® ğŸ”¥ äº”ã€é˜²ç«å¢™é…ç½® ğŸ” å…­ã€æ•…éšœæ’é™¤ä¸ç›‘æ§ ğŸš€ ä¸ƒã€æ€§èƒ½ä¼˜åŒ– ğŸ’¾ å…«ã€å¤‡ä»½ä¸æ¢å¤ ğŸ” ä¹ã€å®‰å…¨å®¡è®¡è„šæœ¬ ğŸ› åã€å¸¸è§é—®é¢˜è§£å†³ ğŸ“‹ åä¸€ã€æœ€ä½³å®è·µæ€»ç»“ ğŸ“– ç®€ä»‹ SSHï¼ˆSecure Shellï¼‰æ˜¯ä¸€ç§åŠ å¯†çš„ç½‘ç»œä¼ è¾“åè®®ï¼Œç”¨äºåœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­æä¾›å®‰å…¨çš„è¿œç¨‹ç™»å½•å’Œå…¶ä»–å®‰å…¨ç½‘ç»œæœåŠ¡ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»åœ¨ Debian 12 ä¸Šé…ç½®å’Œä¼˜åŒ– SSH æœåŠ¡çš„å®Œæ•´æµç¨‹ã€‚\nğŸ› ï¸ ä¸€ã€SSH æœåŠ¡å®‰è£…ä¸åŸºæœ¬é…ç½® 1. ğŸ“¦ å®‰è£… SSH æœåŠ¡å™¨å¹¶å¯ç”¨æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… SSH æœåŠ¡å™¨ sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install openssh-server -y # å¯åŠ¨ SSH æœåŠ¡ sudo systemctl start ssh # è®¾ç½® SSH æœåŠ¡å¼€æœºè‡ªå¯ sudo systemctl enable ssh # æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ sudo systemctl status ssh 2. ğŸ“ æŸ¥çœ‹ SSH é…ç½®æ–‡ä»¶ 1 2 3 4 5 # æŸ¥çœ‹ SSH é…ç½®æ–‡ä»¶å†…å®¹ cat /etc/ssh/sshd_config # æˆ–è€…ä½¿ç”¨åˆ†é¡µæŸ¥çœ‹ less /etc/ssh/sshd_config 3. ğŸ’¾ å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 2 # å¤‡ä»½ SSH é…ç½®æ–‡ä»¶ sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup.$(date +%Y%m%d) âš™ï¸ äºŒã€SSH æœåŠ¡ä¼˜åŒ–é…ç½® 1. âš¡ ä½¿ç”¨ sed å‘½ä»¤ä¿®æ”¹ SSH é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨ sed å‘½ä»¤ä¿®æ”¹ SSH é…ç½®å¹¶åˆ›å»ºå¤‡ä»½ sudo sed -i.bak \\ -e \u0026#39;s/^#Port 22/Port 22/\u0026#39; \\ -e \u0026#39;s/^#PermitRootLogin.*/PermitRootLogin yes/\u0026#39; \\ -e \u0026#39;s/^#GSSAPIAuthentication.*/GSSAPIAuthentication no/\u0026#39; \\ -e \u0026#39;s/^#UseDNS.*/UseDNS no/\u0026#39; \\ -e \u0026#39;s/^#Compression.*/Compression yes/\u0026#39; \\ -e \u0026#39;s/^#TCPKeepAlive.*/TCPKeepAlive yes/\u0026#39; \\ -e \u0026#39;s/^#ClientAliveInterval.*/ClientAliveInterval 10/\u0026#39; \\ -e \u0026#39;s/^#ClientAliveCountMax.*/ClientAliveCountMax 999/\u0026#39; \\ /etc/ssh/sshd_config # é‡å¯ SSH æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ sudo systemctl restart ssh 2. ğŸ“‹ é…ç½®è¯´æ˜ é…ç½®é¡¹ åŸå€¼ ä¿®æ”¹åå€¼ è¯´æ˜ Port #Port 22 Port 22 SSH æœåŠ¡ç«¯å£ PermitRootLogin #PermitRootLogin prohibit-password PermitRootLogin yes å…è®¸ root ç”¨æˆ·ç™»å½• GSSAPIAuthentication #GSSAPIAuthentication no GSSAPIAuthentication no ç¦ç”¨ GSSAPI è®¤è¯ UseDNS #UseDNS no UseDNS no ç¦ç”¨ DNS åå‘è§£æ ClientAliveInterval #ClientAliveInterval 0 ClientAliveInterval 10 å®¢æˆ·ç«¯æ´»è·ƒæ£€æŸ¥é—´éš”(ç§’) ClientAliveCountMax #ClientAliveCountMax 3 ClientAliveCountMax 999 å®¢æˆ·ç«¯æ´»è·ƒæ£€æŸ¥æœ€å¤§æ¬¡æ•° TCPKeepAlive #TCPKeepAlive yes TCPKeepAlive yes å¯ç”¨ TCP ä¿æ´»æœºåˆ¶ï¼Œæ£€æµ‹è¿æ¥çŠ¶æ€ Compression #Compression delayed Compression yes å¯ç”¨æ•°æ®å‹ç¼©ï¼ŒèŠ‚çœå¸¦å®½ä½†å¢åŠ  CPU å¼€é”€ 3. æŸ¥çœ‹ SSH ä¿®æ”¹ 1 grep -E \u0026#39;Port 22|PermitRootLogin|GSSAPIAuthentication|UseDNS|Compression|TCPKeepAlive|ClientAliveInterval|ClientAliveCountMax|PubkeyAuthentication|AuthorizedKeysFile\u0026#39; /etc/ssh/sshd_config ä¸‰ ã€å®¢æˆ·ç«¯è¿æ¥ SSH 1. æŸ¥çœ‹æœåŠ¡å™¨ IP åœ°å€ 1 hostname -I | awk \u0026#39;{print $1}\u0026#39; è¾“å‡ºç¤ºä¾‹ï¼š root@debian13 ~ # hostname -I | awk \u0026lsquo;{print $1}\u0026rsquo; 10.10.10.246\n2. å®¢æˆ·ç«¯è¿æ¥ 1 ssh -p 22 root@10.10.10.246 ğŸ”’ å››ã€é«˜çº§å®‰å…¨é…ç½® 1. ğŸ›¡ï¸ å¢å¼º SSH å®‰å…¨æ€§ 1 2 # æ‰‹åŠ¨ç¼–è¾‘ SSH é…ç½®æ–‡ä»¶æ·»åŠ æ›´å¤šå®‰å…¨é€‰é¡¹ sudo nano /etc/ssh/sshd_config åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹é€‰é¡¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æ›´æ”¹é»˜è®¤ SSH ç«¯å£ï¼ˆå¯é€‰ï¼‰ Port 2222 # é™åˆ¶æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•° MaxAuthTries 3 # è®¾ç½®ç™»å½•å®½é™æ—¶é—´ LoginGraceTime 60 # é™åˆ¶åŒæ—¶è¿æ¥çš„ä¼šè¯æ•° MaxSessions 10 # ç¦ç”¨å¯†ç è®¤è¯ï¼Œåªå…è®¸å¯†é’¥è®¤è¯ï¼ˆæ›´å®‰å…¨ï¼‰ PasswordAuthentication no PubkeyAuthentication yes # é™åˆ¶å¯ç™»å½•çš„ç”¨æˆ· AllowUsers admin root # é™åˆ¶å¯ç™»å½•çš„ç”¨æˆ·ç»„ AllowGroups ssh-users # è®¾ç½®ç©ºé—²ä¼šè¯è¶…æ—¶æ—¶é—´ ClientAliveInterval 300 ClientAliveCountMax 2 2. ğŸ”‘ åˆ›å»º SSH å¯†é’¥å¯¹ 1 2 3 4 5 6 7 # ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆåœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼‰ ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; # å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨ ssh-copy-id -p 22 user@your_server_ip # æˆ–è€…æ‰‹åŠ¨æ·»åŠ å…¬é’¥åˆ°æœåŠ¡å™¨çš„ ~/.ssh/authorized_keys æ–‡ä»¶ ğŸ”¥ äº”ã€é˜²ç«å¢™é…ç½® 1. ğŸ›¡ï¸ é…ç½® UFW é˜²ç«å¢™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… UFW é˜²ç«å¢™ sudo apt install ufw -y # å…è®¸ SSH è¿æ¥ sudo ufw allow ssh # æˆ–è€…å…è®¸ç‰¹å®šç«¯å£ sudo ufw allow 2222/tcp # å¯ç”¨é˜²ç«å¢™ sudo ufw enable # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ sudo ufw status verbose 2. ğŸ”§ ä½¿ç”¨ iptables é…ç½®é˜²ç«å¢™ 1 2 3 4 5 6 7 8 9 # å…è®¸ SSH è¿æ¥ sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT # æˆ–è€…å…è®¸ç‰¹å®šç«¯å£ sudo iptables -A INPUT -p tcp --dport 2222 -j ACCEPT # ä¿å­˜ iptables è§„åˆ™ sudo apt install iptables-persistent -y sudo netfilter-persistent save ğŸ” å…­ã€æ•…éšœæ’é™¤ä¸ç›‘æ§ 1. ğŸ“Š æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ SSH æœåŠ¡çŠ¶æ€ sudo systemctl status ssh # æŸ¥çœ‹ SSH æœåŠ¡æ—¥å¿— sudo journalctl -u ssh -f # æŸ¥çœ‹æœ€è¿‘ç™»å½•è®°å½• last # æŸ¥çœ‹å¤±è´¥çš„ç™»å½•å°è¯• sudo grep \u0026#34;Failed password\u0026#34; /var/log/auth.log 2. ğŸ§ª æµ‹è¯• SSH è¿æ¥ 1 2 3 4 5 6 7 8 # æµ‹è¯• SSH è¿æ¥ ssh -v user@your_server_ip # æµ‹è¯•ç‰¹å®šç«¯å£ ssh -p 2222 user@your_server_ip # æµ‹è¯•å¯†é’¥è®¤è¯ ssh -i ~/.ssh/your_private_key user@your_server_ip ğŸš€ ä¸ƒã€æ€§èƒ½ä¼˜åŒ– 1. âš¡ ä¼˜åŒ– SSH è¿æ¥é€Ÿåº¦ 1 2 3 4 5 6 7 8 # ç¼–è¾‘ SSH é…ç½®æ–‡ä»¶ sudo nano /etc/ssh/sshd_config # æ·»åŠ ä»¥ä¸‹æ€§èƒ½ä¼˜åŒ–é€‰é¡¹ UseDNS no GSSAPIAuthentication no Compression yes TCPKeepAlive yes 2. ğŸ”„ å¯ç”¨ SSH è¿æ¥å¤ç”¨ 1 2 3 4 5 # åœ¨å®¢æˆ·ç«¯ SSH é…ç½®ä¸­å¯ç”¨è¿æ¥å¤ç”¨ echo -e \u0026#34;Host *\\n ControlMaster auto\\n ControlPath ~/.ssh/sockets/%r@%h-%p\\n ControlPersist 600\u0026#34; \u0026gt;\u0026gt; ~/.ssh/config # åˆ›å»º sockets ç›®å½• mkdir -p ~/.ssh/sockets ğŸ’¾ å…«ã€å¤‡ä»½ä¸æ¢å¤ 1. ğŸ“¦ å¤‡ä»½ SSH é…ç½® 1 2 3 4 5 6 7 8 # åˆ›å»ºå¤‡ä»½ç›®å½• sudo mkdir -p /backup/ssh # å¤‡ä»½ SSH é…ç½®æ–‡ä»¶ sudo tar -czf /backup/ssh/ssh_backup_$(date +%Y%m%d).tar.gz /etc/ssh # å¤‡ä»½æˆæƒå¯†é’¥ sudo tar -czf /backup/ssh/authorized_keys_backup_$(date +%Y%m%d).tar.gz /home/*/.ssh/authorized_keys /root/.ssh/authorized_keys 2\u0026gt;/dev/null || true 2. ğŸ”„ æ¢å¤ SSH é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # åœæ­¢ SSH æœåŠ¡ sudo systemctl stop ssh # æ¢å¤é…ç½®æ–‡ä»¶ sudo tar -xzf /backup/ssh/ssh_backup_$(date +%Y%m%d).tar.gz -C / # æ¢å¤æˆæƒå¯†é’¥ sudo tar -xzf /backup/ssh/authorized_keys_backup_$(date +%Y%m%d).tar.gz -C / # é‡å¯ SSH æœåŠ¡ sudo systemctl start ssh ğŸ” ä¹ã€å®‰å…¨å®¡è®¡è„šæœ¬ 1. ğŸ“œ åˆ›å»º SSH å®‰å…¨å®¡è®¡è„šæœ¬ 1 2 # åˆ›å»ºå®¡è®¡è„šæœ¬ sudo nano /usr/local/bin/ssh_audit.sh æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #!/bin/bash echo \u0026#34;=== SSH å®‰å…¨å®¡è®¡ ===\u0026#34; echo \u0026#34;å®¡è®¡æ—¶é—´: $(date)\u0026#34; echo \u0026#34;==========================\u0026#34; # æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ echo \u0026#34;SSH æœåŠ¡çŠ¶æ€:\u0026#34; systemctl status ssh | grep \u0026#34;Active:\u0026#34; # æ£€æŸ¥å¼€æ”¾ç«¯å£ echo -e \u0026#34;\\nå¼€æ”¾ç«¯å£:\u0026#34; netstat -tulnp | grep ssh # æ£€æŸ¥æœ€è¿‘ç™»å½• echo -e \u0026#34;\\næœ€è¿‘ç™»å½•è®°å½•:\u0026#34; last | head -10 # æ£€æŸ¥å¤±è´¥ç™»å½•å°è¯• echo -e \u0026#34;\\nå¤±è´¥ç™»å½•å°è¯•:\u0026#34; grep \u0026#34;Failed password\u0026#34; /var/log/auth.log | tail -5 # æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™ echo -e \u0026#34;\\né…ç½®æ–‡ä»¶æƒé™:\u0026#34; ls -la /etc/ssh/sshd_config # æ£€æŸ¥ root ç™»å½•è®¾ç½® echo -e \u0026#34;\\nRoot ç™»å½•è®¾ç½®:\u0026#34; grep \u0026#34;PermitRootLogin\u0026#34; /etc/ssh/sshd_config echo -e \u0026#34;\\nå®¡è®¡å®Œæˆ!\u0026#34; 2. âš¡ è®¾ç½®è„šæœ¬æƒé™å¹¶æ‰§è¡Œ 1 2 3 4 5 6 7 8 # è®¾ç½®æ‰§è¡Œæƒé™ sudo chmod +x /usr/local/bin/ssh_audit.sh # æ‰§è¡Œå®¡è®¡è„šæœ¬ sudo /usr/local/bin/ssh_audit.sh # è®¾ç½®å®šæœŸå®¡è®¡ï¼ˆæ¯å‘¨ä¸€æ¬¡ï¼‰ echo \u0026#34;0 0 * * 0 root /usr/local/bin/ssh_audit.sh \u0026gt;\u0026gt; /var/log/ssh_audit.log\u0026#34; | sudo tee -a /etc/crontab ğŸ› åã€å¸¸è§é—®é¢˜è§£å†³ 1. ğŸ” SSH è¿æ¥é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ£€æŸ¥ SSH æœåŠ¡æ˜¯å¦è¿è¡Œ sudo systemctl status ssh # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status # æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ sudo netstat -tulnp | grep :22 # æ£€æŸ¥ SSH é…ç½®è¯­æ³• sudo sshd -t # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ sudo journalctl -u ssh -n 50 --no-pager 2. â° è¿æ¥è¶…æ—¶é—®é¢˜ 1 2 # å¢åŠ å®¢æˆ·ç«¯è¶…æ—¶è®¾ç½® echo -e \u0026#34;Host *\\n ServerAliveInterval 60\\n ServerAliveCountMax 5\u0026#34; \u0026gt;\u0026gt; ~/.ssh/config ğŸ“‹ åä¸€ã€æœ€ä½³å®è·µæ€»ç»“ ğŸ”„ æ›´æ”¹é»˜è®¤ç«¯å£ï¼šå°† SSH ç«¯å£ä» 22 æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼Œå‡å°‘è‡ªåŠ¨åŒ–æ”»å‡» ğŸš« ç¦ç”¨ root ç™»å½•ï¼šä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•åå†åˆ‡æ¢è‡³ root ğŸ”‘ ä½¿ç”¨å¯†é’¥è®¤è¯ï¼šç¦ç”¨å¯†ç è®¤è¯ï¼Œåªå…è®¸å¯†é’¥è®¤è¯ ğŸŒ é™åˆ¶è®¿é—® IPï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯è®¿é—® SSH çš„ IP èŒƒå›´ ğŸ”„ å®šæœŸæ›´æ–°ï¼šä¿æŒç³»ç»Ÿå’Œ SSH è½¯ä»¶åŒ…æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ ğŸ“Š ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥ SSH æ—¥å¿—ï¼Œç›‘æ§å¼‚å¸¸ç™»å½•å°è¯• ğŸ›¡ï¸ ä½¿ç”¨ Fail2Banï¼šå®‰è£… Fail2Ban é˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡» ğŸ’¾ å®šæœŸå¤‡ä»½ï¼šå®šæœŸå¤‡ä»½ SSH é…ç½®å’Œæˆæƒå¯†é’¥ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨å¯ä»¥åœ¨ Debian 12 ä¸Šæ­å»ºä¸€ä¸ªå®‰å…¨ã€é«˜æ•ˆçš„ SSH æœåŠ¡ï¼Œå®ç°å®‰å…¨çš„è¿œç¨‹è®¿é—®ï¼ğŸ” è®°å¾—å®šæœŸå®¡è®¡å’Œç»´æŠ¤æ‚¨çš„ SSH é…ç½®å“¦ï¼ğŸ˜Š\n","date":"2024-12-07T14:01:05+08:00","image":"https://file.meimolihan.eu.org/img/debian-01.webp","permalink":"https://blog.meimolihan.eu.org/p/34b066a6/","title":"Debian/PVE/Ubuntu/FnOS é…ç½® SSH æœåŠ¡ğŸ”"},{"content":"Alpine é…ç½® SSH æœåŠ¡æŒ‡å— ğŸ” æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Alpine Linux ä¸­å®‰è£…å’Œé…ç½® SSH æœåŠ¡ï¼Œå®ç°å®‰å…¨å¯é çš„è¿œç¨‹è®¿é—®åŠŸèƒ½ã€‚Alpine çš„è½»é‡çº§ç‰¹æ€§ä¸ SSH çš„å¼ºå¤§åŠŸèƒ½ç›¸ç»“åˆï¼Œä¸ºæ‚¨æä¾›é«˜æ•ˆçš„è¿œç¨‹ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸš€ å¿«é€Ÿå®‰è£…ä¸é…ç½® ğŸ“‹ åˆ†æ­¥é…ç½®è¯´æ˜ ğŸ”§ é…ç½®å‚æ•°è¯¦è§£ ğŸŒ è¿æ¥ç¤ºä¾‹ ğŸ›¡ï¸ å®‰å…¨å¢å¼ºå»ºè®® ğŸ” æ•…éšœæ’é™¤ ğŸ“ æ³¨æ„äº‹é¡¹ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ Alpine Linux çš„ SSH æœåŠ¡æä¾›ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸ” å®‰å…¨è¿œç¨‹è®¿é—®ï¼šé€šè¿‡ SSH åè®®åŠ å¯†æ‰€æœ‰é€šä¿¡ï¼Œç¡®ä¿è¿æ¥å®‰å…¨ âš¡ è½»é‡é«˜æ•ˆï¼šOpenSSH æœåŠ¡å™¨åŒ…å°å·§ï¼Œå ç”¨ç³»ç»Ÿèµ„æºæå°‘ ğŸ”§ çµæ´»é…ç½®ï¼šæ”¯æŒå¯†ç è®¤è¯å’Œå…¬é’¥è®¤è¯ï¼Œå¯æ ¹æ®éœ€è¦çµæ´»é…ç½® ğŸŒ è·¨å¹³å°å…¼å®¹ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµ SSH å®¢æˆ·ç«¯è¿æ¥ â° ä¼šè¯ä¿æŒï¼šå¯é…ç½®å¿ƒè·³åŒ…ä¿æŒé•¿æ—¶é—´è¿æ¥ä¸ä¸­æ–­ ğŸ›¡ï¸ å®‰å…¨åŠ å›ºï¼šæ”¯æŒå¤šç§å®‰å…¨å¢å¼ºé…ç½®ï¼Œä¿æŠ¤ç³»ç»Ÿå…å—æ”»å‡» ğŸš€ å¿«é€Ÿå®‰è£…ä¸é…ç½® ä¸€é”®é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/bin/ash # Alpine Linux SSH ä¸€é”®é…ç½®è„šæœ¬ echo \u0026#34;ğŸš€ å¼€å§‹å®‰è£…å’Œé…ç½® SSH æœåŠ¡...\u0026#34; # æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼• apk update # å®‰è£… OpenSSH æœåŠ¡å™¨ apk add --no-cache openssh-server openssh-client # å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup.$(date +%Y%m%d) # é…ç½® SSH æœåŠ¡ cat \u0026gt; /etc/ssh/sshd_config \u0026lt;\u0026lt; EOF Port 22 Protocol 2 HostKey /etc/ssh/ssh_host_rsa_key HostKey /etc/ssh/ssh_host_ecdsa_key HostKey /etc/ssh/ssh_host_ed25519_key PermitRootLogin yes PasswordAuthentication yes PermitEmptyPasswords no ChallengeResponseAuthentication no UsePAM yes PrintMotd no ClientAliveInterval 10 ClientAliveCountMax 999 Subsystem sftp /usr/lib/ssh/sftp-server EOF # ç”Ÿæˆ SSH ä¸»æœºå¯†é’¥ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ ssh-keygen -A # æ·»åŠ  SSH æœåŠ¡åˆ°å¯åŠ¨é¡¹ rc-update add sshd # å¯åŠ¨ SSH æœåŠ¡ rc-service sshd start # æ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ echo \u0026#34;ğŸ“¡ ç½‘ç»œæ¥å£ä¿¡æ¯:\u0026#34; ip addr show | grep \u0026#34;inet \u0026#34; | grep -v \u0026#34;127.0.0.1\u0026#34; echo \u0026#34;âœ… SSH æœåŠ¡é…ç½®å®Œæˆ!\u0026#34; echo \u0026#34;ğŸ”‘ ç”¨æˆ·å: root (æˆ–æ‚¨åˆ›å»ºçš„å…¶ä»–ç”¨æˆ·)\u0026#34; echo \u0026#34;ğŸŒ ä½¿ç”¨ä¸Šè¿° IP åœ°å€é€šè¿‡ SSH å®¢æˆ·ç«¯è¿æ¥\u0026#34; ä¿å­˜ä¸º setup-ssh.sh å¹¶è¿è¡Œï¼š\n1 2 chmod +x setup-ssh.sh ./setup-ssh.sh ğŸ“‹ åˆ†æ­¥é…ç½®è¯´æ˜ 1. å®‰è£… SSH æœåŠ¡ 1 2 3 4 5 6 7 8 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ apk update # å®‰è£… OpenSSH æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ apk add --no-cache openssh-server openssh-client # éªŒè¯å®‰è£… ssh -V 2. æŸ¥çœ‹é»˜è®¤é…ç½® 1 2 3 4 5 # æŸ¥çœ‹é»˜è®¤é…ç½®æ–‡ä»¶ cat /etc/ssh/sshd_config # æŸ¥çœ‹å·²å®‰è£…çš„ SSH ç›¸å…³åŒ… apk info | grep ssh 3. ä¿®æ”¹é…ç½®å¹¶é‡å¯æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å¤‡ä»½åŸå§‹é…ç½® cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup # ä½¿ç”¨ sed ä¿®æ”¹å…³é”®å‚æ•° sed -i \\ -e \u0026#39;s/^#PasswordAuthentication yes/PasswordAuthentication yes/\u0026#39; \\ -e \u0026#39;s/^#PermitRootLogin .*/PermitRootLogin yes/\u0026#39; \\ -e \u0026#39;s/^#ClientAliveInterval .*/ClientAliveInterval 10/\u0026#39; \\ -e \u0026#39;s/^#ClientAliveCountMax .*/ClientAliveCountMax 999/\u0026#39; \\ /etc/ssh/sshd_config # ç”Ÿæˆ SSH ä¸»æœºå¯†é’¥ï¼ˆå¦‚æœå°šæœªç”Ÿæˆï¼‰ ssh-keygen -A # æ·»åŠ åˆ°å¯åŠ¨é¡¹å¹¶å¯åŠ¨æœåŠ¡ rc-update add sshd rc-service sshd start # æ£€æŸ¥æœåŠ¡çŠ¶æ€ rc-service sshd status # æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯ ip addr show | grep \u0026#34;inet \u0026#34; | grep -v \u0026#34;127.0.0.1\u0026#34; ğŸ”§ é…ç½®å‚æ•°è¯¦è§£ åŸºæœ¬å®‰å…¨å‚æ•° å‚æ•° æ¨èè®¾ç½® è¯´æ˜ Port 22 æˆ–è‡ªå®šä¹‰ç«¯å£ SSH æœåŠ¡ç›‘å¬ç«¯å£ Protocol 2 åªä½¿ç”¨ SSH åè®®ç‰ˆæœ¬ 2 PermitRootLogin yes (æµ‹è¯•) / no (ç”Ÿäº§) æ˜¯å¦å…è®¸ root ç™»å½• PasswordAuthentication yes (æµ‹è¯•) / no (ç”Ÿäº§) æ˜¯å¦å…è®¸å¯†ç è®¤è¯ PermitEmptyPasswords no æ˜¯å¦å…è®¸ç©ºå¯†ç  MaxAuthTries 3 æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•° ClientAliveInterval 10 å®¢æˆ·ç«¯æ´»åŠ¨æ£€æŸ¥é—´éš”(ç§’) ClientAliveCountMax 999 å®¢æˆ·ç«¯æ´»åŠ¨æ£€æŸ¥æœ€å¤§æ¬¡æ•° é«˜çº§å®‰å…¨å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # é™åˆ¶ç”¨æˆ·è®¿é—® AllowUsers user1 user2 AllowGroups ssh-users # æ‹’ç»ç‰¹å®šç”¨æˆ·è®¿é—® DenyUsers user3 DenyGroups no-ssh # é™åˆ¶ç›‘å¬æ¥å£ ListenAddress 192.168.1.100 # ä½¿ç”¨å…¶ä»–è®¤è¯æ–¹å¼ PubkeyAuthentication yes KerberosAuthentication no GSSAPIAuthentication no ğŸŒ è¿æ¥ç¤ºä¾‹ é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½• SSH å®¢æˆ·ç«¯è¿æ¥:\nåŸºæœ¬è¿æ¥ 1 2 3 4 5 6 7 8 # ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿æ¥ ssh root@\u0026lt;alpine-ip-address\u0026gt; # ä½¿ç”¨ç‰¹å®šç«¯å£è¿æ¥ï¼ˆå¦‚æœä¿®æ”¹äº†é»˜è®¤ç«¯å£ï¼‰ ssh -p 2222 root@\u0026lt;alpine-ip-address\u0026gt; # ä½¿ç”¨å…¶ä»–ç”¨æˆ·åè¿æ¥ ssh username@\u0026lt;alpine-ip-address\u0026gt; é«˜çº§è¿æ¥é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼ï¼ˆè°ƒè¯•ç”¨ï¼‰ ssh -v username@\u0026lt;alpine-ip-address\u0026gt; # æ‰§è¡Œè¿œç¨‹å‘½ä»¤å¹¶é€€å‡º ssh username@\u0026lt;alpine-ip-address\u0026gt; \u0026#34;ls -la\u0026#34; # ä½¿ç”¨å¯†é’¥è®¤è¯è¿æ¥ ssh -i ~/.ssh/mykey username@\u0026lt;alpine-ip-address\u0026gt; # å»ºç«‹ SSH éš§é“ ssh -L 8080:localhost:80 username@\u0026lt;alpine-ip-address\u0026gt; # ä½¿ç”¨ä»£ç†è·³è½¬ ssh -J jumpuser@jumpserver username@\u0026lt;alpine-ip-address\u0026gt; ğŸ›¡ï¸ å®‰å…¨å¢å¼ºå»ºè®® 1. æ›´æ”¹é»˜è®¤ç«¯å£ 1 2 3 4 5 6 7 8 9 10 # ç¼–è¾‘é…ç½®æ–‡ä»¶ sed -i \u0026#39;s/^#Port 22/Port 2222/\u0026#39; /etc/ssh/sshd_config # æ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼ˆå¦‚æœä½¿ç”¨é˜²ç«å¢™ï¼‰ apk add ufw ufw allow 2222/tcp ufw enable # é‡å¯ SSH æœåŠ¡ rc-service sshd restart 2. ä½¿ç”¨å¯†é’¥è®¤è¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœ¨å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥ ssh-keygen -t ed25519 -C \u0026#34;æ‚¨çš„æ³¨é‡Š\u0026#34; # å°†å…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ ssh-copy-id -p 2222 username@\u0026lt;alpine-ip-address\u0026gt; # æˆ–è€…æ‰‹åŠ¨æ·»åŠ å…¬é’¥ mkdir -p ~/.ssh chmod 700 ~/.ssh echo \u0026#34;å…¬é’¥å†…å®¹\u0026#34; \u0026gt;\u0026gt; ~/.ssh/authorized_keys chmod 600 ~/.ssh/authorized_keys # ç„¶åç¦ç”¨å¯†ç è®¤è¯ sed -i \u0026#39;s/^PasswordAuthentication yes/PasswordAuthentication no/\u0026#39; /etc/ssh/sshd_config 3. é…ç½®é˜²ç«å¢™é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£…å¹¶é…ç½®é˜²ç«å¢™ apk add ufw # åªå…è®¸ç‰¹å®šIPæ®µè®¿é—®SSH ufw allow from 192.168.1.0/24 to any port 2222 # æˆ–è€…åªå…è®¸ç‰¹å®šIPè®¿é—® ufw allow from 192.168.1.100 to any port 2222 # å¯ç”¨é˜²ç«å¢™ ufw enable 4. ä½¿ç”¨ Fail2Ban é˜²æ­¢æš´åŠ›ç ´è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰è£… Fail2Ban apk add fail2ban # é…ç½® SSH ä¿æŠ¤ cat \u0026gt; /etc/fail2ban/jail.d/ssh.conf \u0026lt;\u0026lt; EOF [sshd] enabled = true port = 2222 filter = sshd logpath = /var/log/auth.log maxretry = 3 bantime = 3600 EOF # å¯åŠ¨ Fail2Ban rc-service fail2ban start rc-update add fail2ban 5. å…¶ä»–å®‰å…¨æªæ–½ 1 2 3 4 5 6 7 8 9 10 11 12 # å®šæœŸæ›´æ–°ç³»ç»Ÿ apk update \u0026amp;\u0026amp; apk upgrade # ä½¿ç”¨éæ ‡å‡†ç”¨æˆ·å adduser admin usermod -aG wheel admin # é™åˆ¶ SSH è®¿é—®æ—¶é—´ï¼ˆä½¿ç”¨é˜²ç«å¢™è§„åˆ™ï¼‰ # ä¾‹å¦‚åªå…è®¸å·¥ä½œæ—¶é—´è®¿é—® # é…ç½®æ—¥å¿—ç›‘æ§ apk add logwatch ğŸ” æ•…éšœæ’é™¤ 1. æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥æœåŠ¡çŠ¶æ€ rc-service sshd status # æŸ¥çœ‹æœåŠ¡æ—¥å¿— tail -f /var/log/messages | grep ssh # æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€ netstat -tulnp | grep :22 # æˆ–è€…ä½¿ç”¨ ss å‘½ä»¤ ss -tulnp | grep ssh 2. è¿æ¥é—®é¢˜æ’æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨è¯¦ç»†æ¨¡å¼è¯Šæ–­è¿æ¥é—®é¢˜ ssh -vvv username@\u0026lt;alpine-ip-address\u0026gt; # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® iptables -L -n # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping \u0026lt;alpine-ip-address\u0026gt; # æ£€æŸ¥ DNS è§£æ nslookup \u0026lt;alpine-hostname\u0026gt; 3. é…ç½®æ–‡ä»¶æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 # æµ‹è¯• SSH é…ç½®è¯­æ³• sshd -t # æ¯”è¾ƒå½“å‰é…ç½®ä¸å¤‡ä»½ diff /etc/ssh/sshd_config /etc/ssh/sshd_config.backup # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /etc/ssh/ ls -la ~/.ssh/ 4. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 # å¦‚æœè¿æ¥è¢«æ‹’ç»ï¼Œæ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ rc-service sshd restart # å¦‚æœè®¤è¯å¤±è´¥ï¼Œæ£€æŸ¥è®¤è¯æ—¥å¿— tail -f /var/log/auth.log # å¦‚æœæç¤ºå¯†é’¥æƒé™é—®é¢˜ chmod 600 ~/.ssh/authorized_keys chmod 700 ~/.ssh/ # å¦‚æœ SELinux å¯¼è‡´é—®é¢˜ï¼ˆAlpine é€šå¸¸ä¸ä½¿ç”¨ SELinuxï¼‰ ğŸ“ æ³¨æ„äº‹é¡¹ å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ”’ ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨ root ç›´æ¥ç™»å½•å’Œå¯†ç è®¤è¯ ğŸ“ å®šæœŸæ›´æ¢ SSH å¯†é’¥å’Œå¯†ç  ğŸ›¡ï¸ ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®æ¥æº IP ğŸ” å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å’Œè®¤è¯æ—¥å¿— âš ï¸ ä¸è¦ä½¿ç”¨é»˜è®¤ç«¯å£ 22ï¼Œæ”¹ä¸ºéæ ‡å‡†ç«¯å£ æ€§èƒ½ä¼˜åŒ– âš¡ å¯¹äºé«˜å¹¶å‘è¿æ¥ï¼Œè°ƒæ•´ MaxStartups å‚æ•° ğŸŒ ä½¿ç”¨ TCP ä¿æŒè¿æ¥é¿å…ä¼šè¯è¶…æ—¶ ğŸ’¾ å¯¹äºå†…å­˜æœ‰é™çš„ç³»ç»Ÿï¼Œè€ƒè™‘ä½¿ç”¨æ›´è½»é‡çš„ dropbear æ›¿ä»£ openssh ç»´æŠ¤å»ºè®® ğŸ“… å®šæœŸæ›´æ–° SSH è½¯ä»¶åŒ…ä»¥è·å–å®‰å…¨è¡¥ä¸ ğŸ”„ å®šæœŸå¤‡ä»½ SSH é…ç½®å’Œå¯†é’¥ ğŸ“Š ç›‘æ§ SSH è¿æ¥æ•°å’Œå¤±è´¥å°è¯• ğŸ—‘ï¸ å®šæœŸæ¸…ç†ä¸å†ä½¿ç”¨çš„æˆæƒå¯†é’¥ å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 6 # å¤‡ä»½ SSH é…ç½®å’Œå¯†é’¥ tar -czf ssh-backup-$(date +%Y%m%d).tar.gz /etc/ssh/ /root/.ssh/ # æ¢å¤ SSH é…ç½® tar -xzf ssh-backup-20230101.tar.gz -C / rc-service sshd restart ğŸ¯ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨çš„ Alpine Linux ç³»ç»Ÿå°†å…·å¤‡å®‰å…¨å¯é çš„è¿œç¨‹è®¿é—®èƒ½åŠ›ã€‚è¯·æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å®‰å…¨è®¾ç½®ï¼Œå¹¶å®šæœŸå®¡æŸ¥å’Œæ›´æ–°é…ç½®ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚\nå¦‚æœæ‚¨é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥é˜… Alpine Linux å®˜æ–¹æ–‡æ¡£ã€‚ğŸ›¡ï¸\n","date":"2024-12-07T14:00:17+08:00","image":"https://file.meimolihan.eu.org/img/alpine-01.webp","permalink":"https://blog.meimolihan.eu.org/p/19d4fa18/","title":"Alpine é…ç½® SSH æœåŠ¡æŒ‡å— ğŸ”"},{"content":"Alpine é…ç½® Samba å…±äº«æŒ‡å— ğŸ“ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ“– ç®€ä»‹ ğŸ› ï¸ ä¸€ã€Samba åŸºç¡€é…ç½® ğŸ–¥ï¸ äºŒã€Alpine ä½œä¸º Samba æœåŠ¡ç«¯é…ç½® ğŸ’» ä¸‰ã€Alpine ä½œä¸º Samba å®¢æˆ·ç«¯é…ç½® ğŸ”§ å››ã€Samba ç®¡ç†å‘½ä»¤ ğŸ› äº”ã€æ•…éšœæ’é™¤å’Œè°ƒè¯• âš™ï¸ å…­ã€é«˜çº§é…ç½®é€‰é¡¹ ğŸ”’ ä¸ƒã€å®‰å…¨åŠ å›ºå»ºè®® ğŸš€ å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ“– ç®€ä»‹ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨ Alpine Linux ç¯å¢ƒä¸­é…ç½® Samba å…±äº«æœåŠ¡çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–¹æ³•ã€‚Samba å…è®¸åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶å’Œæ‰“å°æœºï¼Œç‰¹åˆ«é€‚åˆåœ¨ Linux å’Œ Windows ç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶ã€‚\nğŸ› ï¸ ä¸€ã€Samba åŸºç¡€é…ç½® 1. ğŸ“ åˆ›å»ºå…±äº«ç›®å½•å¹¶å®‰è£… Samba 1 2 3 4 5 6 7 # åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -p /mnt/mydisk chmod -R 755 /mnt/mydisk # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… Samba apk update apk add samba shadow 2. ğŸ‘¤ åˆ›å»º Samba ç”¨æˆ·å¹¶è®¾ç½®å¯†ç  1 2 3 4 5 # åˆ›å»ºç³»ç»Ÿç”¨æˆ· useradd admin # è®¾ç½® Samba å¯†ç  smbpasswd -a admin ğŸ–¥ï¸ äºŒã€Alpine ä½œä¸º Samba æœåŠ¡ç«¯é…ç½® 1. ğŸ’¾ å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 2 3 4 5 # å¤‡ä»½åŸå§‹ Samba é…ç½®æ–‡ä»¶ cp -i /etc/samba/smb.conf /etc/samba/smb.conf.bak # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ cd /etc/samba \u0026amp;\u0026amp; ls -la 2. ğŸ¯ æ–¹æ³•ä¸€ï¼šè¦†ç›–å¼é…ç½®ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # åˆ›å»ºå®Œæ•´çš„ Samba é…ç½®æ–‡ä»¶ cat \u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [global] workgroup = WORKGROUP server string = Samba on Alpine netbios name = Alpine security = user map to guest = Bad User unix charset = UTF-8 socket options = IPTOS_LOWDELAY TCP_NODELAY server min protocol = NT1 load printers = No printing = bsd veto files = /Thumbs.db/.DS_Store/._.DS_Store/.apdisk/ delete veto files = yes [Alpine] comment = Alpine Samba Share path = /mnt browseable = yes writable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root EOF # å¯ç”¨å¹¶å¯åŠ¨ Samba æœåŠ¡ rc-update add samba rc-service samba start # æŸ¥çœ‹æœåŠ¡å™¨ IP åœ°å€ hostname -I 3. â• æ–¹æ³•äºŒï¼šè¿½åŠ å¼é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # è¿½åŠ å…±äº«é…ç½®åˆ°ç°æœ‰æ–‡ä»¶ cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Alpine] comment = Alpine Samba Share path = /mnt browseable = yes writable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root EOF # å¯ç”¨å¹¶å¯åŠ¨ Samba æœåŠ¡ rc-update add samba rc-service samba start # æŸ¥çœ‹æœåŠ¡å™¨ IP åœ°å€ hostname -I 4. âš¡ æ–¹æ³•ä¸‰ï¼šä¸€é”®é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # åˆ›å»ºä¸€é”®é…ç½®è„šæœ¬ cat \u0026gt; /root/smb.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/ash # å®‰è£… Samba apk update \u0026amp;\u0026amp; apk add samba shadow # åˆ›å»ºå…±äº«ç›®å½• mkdir -p /mnt # è¿½åŠ å…±äº«é…ç½® cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; [Alpine] comment = Alpine Samba Share path = /mnt browseable = yes writable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root MYENDMARK # åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®å¯†ç  useradd admin 2\u0026gt;/dev/null || true (echo \u0026#34;yifan0719\u0026#34;; echo \u0026#34;yifan0719\u0026#34;) | smbpasswd -a -s admin # å¯åŠ¨ Samba æœåŠ¡ rc-service samba start echo \u0026#34;Samba é…ç½®å®Œæˆ!\u0026#34; echo \u0026#34;å…±äº«å: Alpine\u0026#34; echo \u0026#34;ç”¨æˆ·å: admin\u0026#34; echo \u0026#34;å¯†ç : yifan0719\u0026#34; EOF # è®¾ç½®è„šæœ¬æƒé™å¹¶æ‰§è¡Œ chmod +x /root/smb.sh /root/smb.sh ğŸ’» ä¸‰ã€Alpine ä½œä¸º Samba å®¢æˆ·ç«¯é…ç½® 1. ğŸ“‚ é…ç½® Samba å®¢æˆ·ç«¯æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰è£… Samba å®¢æˆ·ç«¯å·¥å…· apk update \u0026amp;\u0026amp; apk add samba-client cifs-utils # åˆ›å»ºæœ¬åœ°æŒ‚è½½ç‚¹ mkdir -p /mnt/ARS2-SMB # é…ç½®è‡ªåŠ¨æŒ‚è½½ cat \u0026gt;\u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # Samba å…±äº«æŒ‚è½½é…ç½® //10.10.10.251/ARS2 /mnt/ARS2-SMB cifs username=root,password=yifan0719,uid=0,gid=0,file_mode=0777,dir_mode=0777 0 0 EOF # æµ‹è¯•æŒ‚è½½ mount -a # éªŒè¯æŒ‚è½½ç»“æœ df -hT | grep cifs ğŸ”§ å››ã€Samba ç®¡ç†å‘½ä»¤ 1. ğŸ‘¥ æŸ¥çœ‹ Samba ç”¨æˆ· 1 2 3 4 5 # åˆ—å‡ºæ‰€æœ‰ Samba ç”¨æˆ· pdbedit -L # æŸ¥çœ‹ç‰¹å®šç”¨æˆ·è¯¦ç»†ä¿¡æ¯ pdbedit -v -u admin 2. â• æ·»åŠ å’Œç®¡ç†ç”¨æˆ· 1 2 3 4 5 6 7 8 9 10 # æ·»åŠ æ–°ç”¨æˆ·åˆ° Samba useradd newuser smbpasswd -a newuser # åˆ é™¤ Samba ç”¨æˆ· smbpasswd -x username # å¯ç”¨/ç¦ç”¨ç”¨æˆ· smbpasswd -e username smbpasswd -d username 3. âš™ï¸ æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # å¯åŠ¨ Samba æœåŠ¡ rc-service samba start # åœæ­¢ Samba æœåŠ¡ rc-service samba stop # é‡å¯ Samba æœåŠ¡ rc-service samba restart # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ rc-service samba status ğŸ› äº”ã€æ•…éšœæ’é™¤å’Œè°ƒè¯• 1. ğŸ§ª æµ‹è¯• Samba é…ç½® 1 2 3 4 5 6 7 8 # æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• testparm # æŸ¥çœ‹å½“å‰å…±äº«åˆ—è¡¨ smbclient -L localhost -U% # æµ‹è¯•å…±äº«è¿æ¥ smbclient //localhost/Alpine -U admin 2. ğŸ“ æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ Samba æ—¥å¿— tail -f /var/log/samba/log.smbd # æŸ¥çœ‹è¿æ¥çŠ¶æ€ smbstatus # æŸ¥çœ‹è¯¦ç»†è¿æ¥ä¿¡æ¯ smbstatus -v 3. ğŸŒ ç½‘ç»œè¯Šæ–­ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ç«¯å£å¼€æ”¾æƒ…å†µ netstat -tulnp | grep smb # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping 10.10.10.251 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® iptables -L -n âš™ï¸ å…­ã€é«˜çº§é…ç½®é€‰é¡¹ 1. ğŸ“‚ å¤šå…±äº«é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # é…ç½®å¤šä¸ªå…±äº«ç›®å½• cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Documents] comment = Important Documents path = /mnt/documents browseable = yes writable = yes valid users = @staff [Media] comment = Media Files path = /mnt/media browseable = yes writable = yes guest ok = yes EOF 2. ğŸ‘¥ ç”¨æˆ·ç»„æƒé™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»ºç”¨æˆ·ç»„ addgroup staff # æ·»åŠ ç”¨æˆ·åˆ°ç»„ adduser admin staff # é…ç½®ç»„æƒé™ cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Staff] comment = Staff Only path = /mnt/staff browseable = yes writable = yes valid users = @staff force group = staff EOF 3. ğŸ” è®¿é—®æ§åˆ¶åˆ—è¡¨ 1 2 3 4 5 6 # è®¾ç½®ç›®å½• ACL setfacl -R -m g:staff:rwx /mnt/staff setfacl -R -d -m g:staff:rwx /mnt/staff # éªŒè¯ ACL è®¾ç½® getfacl /mnt/staff ğŸ”’ ä¸ƒã€å®‰å…¨åŠ å›ºå»ºè®® 1. ğŸŒ ç½‘ç»œå®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # é™åˆ¶è®¿é—®IPèŒƒå›´ cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; hosts allow = 127.0.0.1 10.10.10.0/24 hosts deny = 0.0.0.0/0 EOF # ç¦ç”¨ä¸éœ€è¦çš„åè®® cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server min protocol = SMB2 server max protocol = SMB3 EOF 2. ğŸ” è®¤è¯å®‰å…¨ 1 2 3 4 5 6 7 8 9 # å¯ç”¨åŠ å¯†å¯†ç  cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; encrypt passwords = yes smb passwd file = /etc/samba/private/smbpasswd EOF # åˆ›å»ºå®‰å…¨çš„å¯†ç æ–‡ä»¶ç›®å½• mkdir -p /etc/samba/private chmod 700 /etc/samba/private 3. ğŸ“Š å®šæœŸå®¡è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºå®¡è®¡è„šæœ¬ cat \u0026gt; /usr/local/bin/samba_audit.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/ash echo \u0026#34;=== Samba å®‰å…¨å®¡è®¡ ===\u0026#34; echo \u0026#34;æ—¥æœŸ: $(date)\u0026#34; echo \u0026#34;å½“å‰è¿æ¥:\u0026#34; smbstatus -b echo \u0026#34;ç”¨æˆ·åˆ—è¡¨:\u0026#34; pdbedit -L -v echo \u0026#34;å…±äº«çŠ¶æ€:\u0026#34; testparm -s --parameter-name=\u0026#34;security\u0026#34; EOF chmod +x /usr/local/bin/samba_audit.sh ğŸš€ å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. ğŸ’¾ ç¼“å­˜å’Œç¼“å†²åŒºä¼˜åŒ– 1 2 3 4 5 6 7 8 cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # æ€§èƒ½ä¼˜åŒ–è®¾ç½® socket options = TCP_NODELAY IPTOS_LOWDELAY read raw = yes write raw = yes max xmit = 65535 getwd cache = yes EOF 2. ğŸ“ æ—¥å¿—ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # é™åˆ¶æ—¥å¿—å¤§å° cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # æ—¥å¿—è®¾ç½® log level = 1 log file = /var/log/samba/log.%m max log size = 50 EOF # è®¾ç½®æ—¥å¿—è½®è½¬ cat \u0026gt; /etc/logrotate.d/samba \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /var/log/samba/*.log { missingok notifempty copytruncate size 10M rotate 5 } EOF 3. ğŸ“Š èµ„æºé™åˆ¶ 1 2 3 4 5 6 # è®¾ç½®æœ€å¤§è¿æ¥æ•° cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; max connections = 100 max disk size = 1000 max open files = 16384 EOF é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨å¯ä»¥åœ¨ Alpine Linux ç¯å¢ƒä¸­æˆåŠŸæ­å»ºå’Œç®¡ç† Samba æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«ï¼ğŸ“ è®°å¾—å®šæœŸæ£€æŸ¥ç³»ç»ŸçŠ¶æ€å’Œç»´æŠ¤å®‰å…¨è®¾ç½®å“¦ï¼ğŸ˜Š\n","date":"2024-12-07T13:59:19+08:00","image":"https://file.meimolihan.eu.org/img/alpine-01.webp","permalink":"https://blog.meimolihan.eu.org/p/fdde3f21/","title":"Alpine  é…ç½® Samba å…±äº«æŒ‡å—ğŸ“"},{"content":"Alpine é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Alpine Linux ä¸Šé…ç½® NFS æœåŠ¡ï¼ŒåŒ…æ‹¬æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è®¾ç½®ï¼Œä»¥åŠå„ç§æŒ‚è½½é€‰é¡¹å’Œæ•…éšœæ’é™¤æ–¹æ³•ã€‚\nâœ¨ ç›®å½• âœ¨ NFS ç®€ä»‹ ğŸš€ ä¸€ã€åŸºç¡€ç¯å¢ƒé…ç½® ğŸ–¥ï¸ äºŒã€NFS æœåŠ¡ç«¯é…ç½® ğŸ’» ä¸‰ã€NFS å®¢æˆ·ç«¯é…ç½® ğŸ”§ å››ã€NFS ç®¡ç†å‘½ä»¤ ğŸ“Š äº”ã€NFS å…±äº«æ£€æŸ¥è„šæœ¬ ğŸ› ï¸ å…­ã€é«˜çº§é…ç½®å’Œä¼˜åŒ– ğŸ” ä¸ƒã€æ•…éšœæ’é™¤ ğŸ’¾ å…«ã€å¤‡ä»½ä¸æ¢å¤ ğŸ¯ æ€»ç»“ ğŸ“š æ‰©å±•é˜…è¯» âœ¨ NFS ç®€ä»‹ NFSï¼ˆNetwork File Systemï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œå…è®¸å®¢æˆ·ç«¯è®¡ç®—æœºé€šè¿‡ç½‘ç»œè®¿é—®æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå°±åƒè®¿é—®æœ¬åœ°å­˜å‚¨ä¸€æ ·ã€‚Alpine Linux æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Linux å‘è¡Œç‰ˆï¼Œéå¸¸é€‚åˆç”¨ä½œ NFS æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚\nğŸŒŸ NFS ç‰¹ç‚¹ä¸ä¼˜åŠ¿ è·¨å¹³å°å…±äº« ğŸ“: æ”¯æŒä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´çš„æ–‡ä»¶å…±äº« é€æ˜è®¿é—® ğŸ‘ï¸: è¿œç¨‹æ–‡ä»¶è®¿é—®å°±åƒæœ¬åœ°æ–‡ä»¶ä¸€æ · é«˜æ€§èƒ½ ğŸš€: é€šè¿‡ä¼˜åŒ–åè®®æä¾›é«˜æ•ˆæ•°æ®ä¼ è¾“ æ˜“äºç®¡ç† ğŸ› ï¸: é›†ä¸­å¼å­˜å‚¨ç®€åŒ–äº†æ•°æ®ç®¡ç† æ‰©å±•æ€§å¼º ğŸ“ˆ: è½»æ¾æ·»åŠ æ›´å¤šå­˜å‚¨ç©ºé—´è€Œä¸ä¸­æ–­æœåŠ¡ ğŸš€ ä¸€ã€åŸºç¡€ç¯å¢ƒé…ç½® 1ï¸âƒ£ ä½¿ç”¨ä¸€é”®è„šæœ¬å·¥å…· 1 2 3 4 # ä¸‹è½½å¹¶è¿è¡Œç§‘æŠ€lionçš„ä¸€é”®é…ç½®è„šæœ¬ sudo curl -sS -O https://kejilion.pro/kejilion.sh \u0026amp;\u0026amp; \\ chmod +x kejilion.sh \u0026amp;\u0026amp; \\ ./kejilion.sh 2ï¸âƒ£ æ‰‹åŠ¨å®‰è£…å’Œé…ç½® NFS 1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•å¹¶å®‰è£… NFS å·¥å…· apk update \u0026amp;\u0026amp; \\ apk add nfs-utils # å¯åŠ¨ NFS æŒ‚è½½æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ rc-service nfsmount start \u0026amp;\u0026amp; \\ rc-update add nfsmount # å¯åŠ¨ NFS æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ rc-service nfs start \u0026amp;\u0026amp; \\ rc-update add nfs ğŸ–¥ï¸ äºŒã€NFS æœåŠ¡ç«¯é…ç½® 1ï¸âƒ£ åˆ›å»ºå…±äº«ç›®å½•å¹¶é…ç½®å¯¼å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -p /mnt/mydisk \u0026amp;\u0026amp; \\ chmod 777 /mnt/mydisk # é…ç½® NFS å¯¼å‡ºæ–‡ä»¶ cat \u0026gt; /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS å…±äº«é…ç½® # æ ¼å¼: [ç›®å½•] [å®¢æˆ·ç«¯IP/ç½‘ç»œ](é€‰é¡¹) # å…±äº« /mnt/mydisk ç»™æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œå…·æœ‰è¯»å†™æƒé™ /mnt/mydisk *(rw,fsid=0,no_subtree_check,no_root_squash,insecure,sync) # ç¤ºä¾‹: ä»…é™ç‰¹å®šç½‘ç»œè®¿é—® # /mnt/mydisk 10.10.10.0/24(rw,no_subtree_check,no_root_squash,sync) # ç¤ºä¾‹: åªè¯»å…±äº« # /mnt/mydisk *(ro,no_subtree_check,sync) EOF # ä½¿é…ç½®ç”Ÿæ•ˆ exportfs -rva 2ï¸âƒ£ é«˜çº§å¯¼å‡ºé€‰é¡¹è¯´æ˜ é€‰é¡¹ è¯´æ˜ rw è¯»å†™æƒé™ ro åªè¯»æƒé™ sync åŒæ­¥å†™å…¥ï¼Œæ›´å®‰å…¨ä½†ç¨æ…¢ async å¼‚æ­¥å†™å…¥ï¼Œæ›´å¿«ä½†é£é™©ç¨é«˜ no_subtree_check ç¦ç”¨å­æ ‘æ£€æŸ¥ï¼Œæé«˜æ€§èƒ½ no_root_squash å…è®¸ root ç”¨æˆ·ä¿æŒæƒé™ root_squash å°† root ç”¨æˆ·æ˜ å°„ä¸ºåŒ¿åç”¨æˆ· all_squash å°†æ‰€æœ‰ç”¨æˆ·æ˜ å°„ä¸ºåŒ¿åç”¨æˆ· insecure å…è®¸éç‰¹æƒç«¯å£è¿æ¥ fsid=0 è®¾ç½®æ–‡ä»¶ç³»ç»ŸIDï¼Œç”¨äºNFSv4 ğŸ’» ä¸‰ã€NFS å®¢æˆ·ç«¯é…ç½® 1ï¸âƒ£ ä¸´æ—¶æŒ‚è½½ NFS å…±äº« 1 2 3 4 5 6 7 8 9 # åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• mkdir -p /mnt/ARS2-NFS \u0026amp;\u0026amp; \\ chmod 755 /mnt/ARS2-NFS # ä¸´æ—¶æŒ‚è½½ NFS å…±äº« mount -t nfs -o rw,soft,timeo=5,retry=3 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS # éªŒè¯æŒ‚è½½ df -hT /mnt/ARS2-NFS 2ï¸âƒ£ å¤šä¸ª NFS å…±äº«æŒ‚è½½ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŒ‚è½½å¤šä¸ª NFS æœåŠ¡å™¨ mkdir -p /mnt/{ARS2-NFS,PVE-NFS,Debian-NFS,Ubuntu-NFS} # æŒ‚è½½ ARS2 NFS mount -t nfs -o rw 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS # æŒ‚è½½ PVE NFS mount -t nfs -o rw 10.10.10.254:/mnt/ntfs /mnt/PVE-NFS # æŒ‚è½½ Debian NFS mount -t nfs -o rw 10.10.10.245:/mnt/mydisk /mnt/Debian-NFS # æŒ‚è½½ Ubuntu NFS mount -t nfs -o rw 10.10.10.247:/mnt/mydisk /mnt/Ubuntu-NFS # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ df -hT /mnt/* 3ï¸âƒ£ æ°¸ä¹…æŒ‚è½½é…ç½® æ–¹æ³•ä¸€ï¼šè¦†ç›– /etc/fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # å¤‡ä»½åŸ fstab æ–‡ä»¶ cp /etc/fstab /etc/fstab.backup # åˆ›å»ºæ–°çš„ fstab é…ç½® cat \u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # /etc/fstab: static file system information # # \u0026lt;file system\u0026gt; \u0026lt;mount point\u0026gt; \u0026lt;type\u0026gt; \u0026lt;options\u0026gt; \u0026lt;dump\u0026gt; \u0026lt;pass\u0026gt; # NFS å…±äº«é…ç½® 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs rw,soft,timeo=5,retry=3,_netdev 0 0 10.10.10.254:/mnt/ntfs /mnt/PVE-NFS nfs rw,soft,timeo=5,retry=3,_netdev 0 0 10.10.10.245:/mnt/mydisk /mnt/Debian-NFS nfs rw,soft,timeo=5,retry=3,_netdev 0 0 # æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ proc /proc proc defaults 0 0 /dev/cdrom /media/cdrom iso9660 noauto,ro 0 0 EOF # é‡æ–°åŠ è½½ fstab æˆ–é‡å¯ mount -a || reboot æ–¹æ³•äºŒï¼šè¿½åŠ åˆ° /etc/fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 # è¿½åŠ æ–°çš„ NFS æŒ‚è½½é…ç½® cat \u0026gt;\u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # è¿½åŠ  Ubuntu NFS æŒ‚è½½ 10.10.10.247:/mnt/mydisk /mnt/Ubuntu-NFS nfs rw,soft,timeo=5,retry=3,_netdev 0 0 EOF # æµ‹è¯•æŒ‚è½½ mount -a ğŸ”§ å››ã€NFS ç®¡ç†å‘½ä»¤ 1ï¸âƒ£ æŸ¥çœ‹å’Œç®¡ç†æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹ df -hT # æŸ¥çœ‹ NFS ç‰¹å®šæŒ‚è½½ df -hT /mnt/* # å¸è½½ NFS å…±äº« umount /mnt/ARS2-NFS # å¼ºåˆ¶å¸è½½ï¼ˆå¦‚æœè®¾å¤‡å¿™ï¼‰ umount -f /mnt/ARS2-NFS # æ‡’å¸è½½ï¼ˆå½“è®¾å¤‡ä¸å†å¿™æ—¶å¸è½½ï¼‰ umount -l /mnt/ARS2-NFS 2ï¸âƒ£ æŸ¥çœ‹ NFS å…±äº«ä¿¡æ¯ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æœ¬æœº NFS å…±äº« showmount -e # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨ NFS å…±äº« showmount -e 10.10.10.254 # æŸ¥çœ‹æ‰€æœ‰å·²æŒ‚è½½çš„ NFS å…±äº« mount -t nfs 3ï¸âƒ£ NFS çŠ¶æ€ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ NFS æœåŠ¡å™¨çŠ¶æ€ nfsstat -s # æŸ¥çœ‹ NFS å®¢æˆ·ç«¯çŠ¶æ€ nfsstat -c # æŸ¥çœ‹ RPC æœåŠ¡çŠ¶æ€ rpcinfo -p # å®æ—¶ç›‘æ§ NFS æµé‡ nfsiostat 2 ğŸ“Š äº”ã€NFS å…±äº«æ£€æŸ¥è„šæœ¬ 1ï¸âƒ£ åˆ›å»º NFS å…±äº«æ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 # åˆ›å»ºæ£€æŸ¥è„šæœ¬ cat \u0026gt; /usr/local/bin/check_nfs_shares.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;========================================\u0026#34; echo \u0026#34; NFS å…±äº«çŠ¶æ€æ£€æŸ¥\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34;\u0026#34; # å®šä¹‰è¦æ£€æŸ¥çš„æœåŠ¡å™¨åˆ—è¡¨ servers=( \u0026#34;10.10.10.242\u0026#34; \u0026#34;10.10.10.252\u0026#34; \u0026#34;10.10.10.243\u0026#34; \u0026#34;10.10.10.254\u0026#34; \u0026#34;10.10.10.251\u0026#34; \u0026#34;10.10.10.245\u0026#34; \u0026#34;10.10.10.246\u0026#34; \u0026#34;10.10.10.247\u0026#34; ) # æ£€æŸ¥æ¯ä¸ªæœåŠ¡å™¨çš„ NFS å…±äº« for server in \u0026#34;${servers[@]}\u0026#34;; do echo \u0026#34;æ£€æŸ¥æœåŠ¡å™¨: $server\u0026#34; if ping -c 1 -W 1 \u0026#34;$server\u0026#34; \u0026amp;\u0026gt; /dev/null; then echo \u0026#34;çŠ¶æ€: âœ… åœ¨çº¿\u0026#34; echo \u0026#34;å…±äº«åˆ—è¡¨:\u0026#34; showmount -e \u0026#34;$server\u0026#34; | sed \u0026#39;s/^/ /\u0026#39; else echo \u0026#34;çŠ¶æ€: âŒ ç¦»çº¿\u0026#34; fi echo \u0026#34;----------------------------------------\u0026#34; done # æ£€æŸ¥æœ¬åœ°æŒ‚è½½çš„ NFS å…±äº« echo \u0026#34;æœ¬åœ°æŒ‚è½½çš„ NFS å…±äº«:\u0026#34; mount -t nfs,nfs4 | sed \u0026#39;s/^/ /\u0026#39; echo \u0026#34;========================================\u0026#34; EOF # è®¾ç½®è„šæœ¬æƒé™ chmod +x /usr/local/bin/check_nfs_shares.sh # è¿è¡Œæ£€æŸ¥è„šæœ¬ /usr/local/bin/check_nfs_shares.sh 2ï¸âƒ£ ç®€åŒ–ç‰ˆæ£€æŸ¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆ›å»ºç®€åŒ–æ£€æŸ¥è„šæœ¬ cat \u0026gt; /tmp/check_nfs_simple.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.242 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.252 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.243 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.254 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.251 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.245 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.246 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31m$(showmount -e 10.10.10.247 | sed \u0026#39;s/^Export list for //\u0026#39;)\\033[0m\u0026#34; echo -e \u0026#34;-----------------------\u0026#34; EOF chmod +x /tmp/check_nfs_simple.sh \u0026amp;\u0026amp; /tmp/check_nfs_simple.sh ğŸ› ï¸ å…­ã€é«˜çº§é…ç½®å’Œä¼˜åŒ– 1ï¸âƒ£ NFS æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 # åœ¨å®¢æˆ·ç«¯æŒ‚è½½æ—¶ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–é€‰é¡¹ mount -t nfs -o \\ rw,\\ hard,\\ rsize=32768,\\ wsize=32768,\\ timeo=600,\\ retrans=2,\\ noatime,\\ nodiratime \\ 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS 2ï¸âƒ£ å†…æ ¸å‚æ•°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ç¼–è¾‘ /etc/sysctl.conf æ·»åŠ ä»¥ä¸‹ä¼˜åŒ–å‚æ•° cat \u0026gt;\u0026gt; /etc/sysctl.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS æ€§èƒ½ä¼˜åŒ– net.core.rmem_max = 16777216 net.core.wmem_max = 16777216 net.core.rmem_default = 16777216 net.core.wmem_default = 16777216 net.core.optmem_max = 16777216 # SunRPC å‚æ•° sunrpc.tcp_slot_table_entries = 128 sunrpc.udp_slot_table_entries = 128 EOF # åº”ç”¨å†…æ ¸å‚æ•° sysctl -p 3ï¸âƒ£ é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¦‚æœä½¿ç”¨é˜²ç«å¢™ï¼Œéœ€è¦å¼€æ”¾ NFS ç›¸å…³ç«¯å£ apk add iptables # å¼€æ”¾ NFS ç«¯å£ iptables -A INPUT -p tcp --dport 111 -j ACCEPT iptables -A INPUT -p udp --dport 111 -j ACCEPT iptables -A INPUT -p tcp --dport 2049 -j ACCEPT iptables -A INPUT -p udp --dport 2049 -j ACCEPT iptables -A INPUT -p tcp --dport 20048 -j ACCEPT iptables -A INPUT -p udp --dport 20048 -j ACCEPT # ä¿å­˜é˜²ç«å¢™è§„åˆ™ /etc/init.d/iptables save 4ï¸âƒ£ NFS ç‰ˆæœ¬é€‰æ‹© 1 2 3 4 5 # æŒ‡å®šä½¿ç”¨ NFSv4 ç‰ˆæœ¬æŒ‚è½½ï¼ˆæ›´å®‰å…¨ï¼Œæ€§èƒ½æ›´å¥½ï¼‰ mount -t nfs4 -o rw,hard,intr 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS # æŒ‡å®šä½¿ç”¨ NFSv3 ç‰ˆæœ¬æŒ‚è½½ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰ mount -t nfs -o vers=3,rw,hard,intr 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS ğŸ” ä¸ƒã€æ•…éšœæ’é™¤ 1ï¸âƒ£ å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # 1. æ£€æŸ¥ NFS æœåŠ¡çŠ¶æ€ rc-status | grep nfs # 2. æ£€æŸ¥ RPC æœåŠ¡ rpcinfo -p # 3. æ£€æŸ¥ç½‘ç»œè¿æ¥ ping 10.10.10.251 # 4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½® iptables -L -n # 5. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— tail -f /var/log/messages # 6. æ‰‹åŠ¨æµ‹è¯• RPC æœåŠ¡ rpcdebug -m nfs -s all # 7. æ£€æŸ¥æŒ‚è½½ç‚¹æƒé™ ls -la /mnt/ARS2-NFS # 8. æ£€æŸ¥NFSç‰ˆæœ¬å…¼å®¹æ€§ cat /proc/fs/nfsd/versions 2ï¸âƒ£ NFS é”™è¯¯ä»£ç è¯´æ˜ é”™è¯¯ä»£ç  è¯´æ˜ è§£å†³æ–¹æ³• NFS3ERR_IO I/O é”™è¯¯ æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒæœåŠ¡å™¨çŠ¶æ€ NFS3ERR_STALE æ–‡ä»¶å¥æŸ„è¿‡æœŸ é‡æ–°æŒ‚è½½ NFS å…±äº« NFS3ERR_JUKEBOX æœåŠ¡å™¨å¿™ é‡è¯•æ“ä½œæˆ–æ£€æŸ¥æœåŠ¡å™¨è´Ÿè½½ NFS4ERR_DELAY æ“ä½œå»¶è¿Ÿ æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿæˆ–æœåŠ¡å™¨æ€§èƒ½ NFS4ERR_ACCESS æƒé™ä¸è¶³ æ£€æŸ¥å¯¼å‡ºé€‰é¡¹å’Œæ–‡ä»¶æƒé™ 3ï¸âƒ£ å¼ºåˆ¶æ¢å¤æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¦‚æœ NFS æŒ‚è½½å¡ä½ï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶æ¢å¤ # 1. æŸ¥çœ‹å¡ä½çš„è¿›ç¨‹ lsof /mnt/ARS2-NFS # 2. ç»ˆæ­¢ç›¸å…³è¿›ç¨‹ pkill -9 -f /mnt/ARS2-NFS # 3. å¼ºåˆ¶å¸è½½ umount -f /mnt/ARS2-NFS # 4. æ¸…ç† NFS çŠ¶æ€ /etc/init.d/nfsmount restart # 5. é‡æ–°æŒ‚è½½ mount /mnt/ARS2-NFS 4ï¸âƒ£ NFS è¿æ¥æµ‹è¯• 1 2 3 4 5 6 7 8 # æµ‹è¯•NFSæœåŠ¡å™¨å¯è¾¾æ€§ rpcinfo -t 10.10.10.251 nfs # æµ‹è¯•NFSå…±äº«å¯ç”¨æ€§ rpcinfo -u 10.10.10.251 nfs # æ£€æŸ¥NFSæœåŠ¡çŠ¶æ€ nfsstat -m ğŸ’¾ å…«ã€å¤‡ä»½ä¸æ¢å¤ 1ï¸âƒ£ NFS é…ç½®å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åˆ›å»ºå¤‡ä»½è„šæœ¬ cat \u0026gt; /usr/local/bin/backup_nfs_config.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # NFS é…ç½®å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backup/nfs-config\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) mkdir -p $BACKUP_DIR/$DATE # å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ cp -a /etc/exports $BACKUP_DIR/$DATE/ cp -a /etc/fstab $BACKUP_DIR/$DATE/ cp -a /etc/hosts $BACKUP_DIR/$DATE/ cp -a /etc/hostname $BACKUP_DIR/$DATE/ # å¤‡ä»½æœåŠ¡é…ç½® rc-status -a \u0026gt; $BACKUP_DIR/$DATE/services.txt echo \u0026#34;NFS é…ç½®å¤‡ä»½å®Œæˆ: $BACKUP_DIR/$DATE\u0026#34; EOF chmod +x /usr/local/bin/backup_nfs_config.sh 2ï¸âƒ£ é…ç½®æ¢å¤ 1 2 3 4 5 6 7 8 9 # ä»å¤‡ä»½æ¢å¤é…ç½® restore_nfs_config() { local backup_dir=\u0026#34;$1\u0026#34; cp -a \u0026#34;$backup_dir/exports\u0026#34; /etc/exports cp -a \u0026#34;$backup_dir/fstab\u0026#34; /etc/fstab exportfs -rva mount -a echo \u0026#34;NFS é…ç½®æ¢å¤å®Œæˆ\u0026#34; } 3ï¸âƒ£ è‡ªåŠ¨å¤‡ä»½è®¡åˆ’ 1 2 3 4 5 # æ·»åŠ å®šæ—¶å¤‡ä»½ä»»åŠ¡ echo \u0026#34;0 2 * * * /usr/local/bin/backup_nfs_config.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root # é‡å¯crondæœåŠ¡ rc-service crond restart ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„æŒ‡å¯¼ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†åœ¨ Alpine Linux ä¸Šé…ç½®å’Œç®¡ç† NFS æœåŠ¡ï¼š\nâœ… æŒæ¡çš„æ ¸å¿ƒæŠ€èƒ½ï¼š NFS æœåŠ¡ç«¯é…ç½®ï¼šåˆ›å»ºå…±äº«ç›®å½•å’Œé…ç½®å¯¼å‡ºè§„åˆ™ NFS å®¢æˆ·ç«¯é…ç½®ï¼šä¸´æ—¶å’Œæ°¸ä¹…æŒ‚è½½ NFS å…±äº« æ€§èƒ½ä¼˜åŒ–ï¼šè°ƒæ•´æŒ‚è½½å‚æ•°å’Œå†…æ ¸è®¾ç½® æ•…éšœæ’é™¤ï¼šè¯Šæ–­å’Œè§£å†³å¸¸è§ NFS é—®é¢˜ ç›‘æ§ç®¡ç†ï¼šä½¿ç”¨è„šæœ¬ç›‘æ§ NFS å…±äº«çŠ¶æ€ ğŸŒŸ æœ€ä½³å®è·µï¼š å®šæœŸå¤‡ä»½ NFS é…ç½®æ–‡ä»¶ ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–å‚æ•°æé«˜ä¼ è¾“æ•ˆç‡ é…ç½®é˜²ç«å¢™ç¡®ä¿ç½‘ç»œå®‰å…¨ ç›‘æ§ NFS çŠ¶æ€åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ æµ‹è¯•æ¢å¤æµç¨‹ç¡®ä¿ç¾éš¾æ¢å¤èƒ½åŠ› é€‰æ‹©åˆé€‚çš„NFSç‰ˆæœ¬å¹³è¡¡æ€§èƒ½å’Œå…¼å®¹æ€§ ğŸ”§ å¸¸ç”¨å‘½ä»¤å›é¡¾ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 # æœåŠ¡ç«¯ exportfs -rva # é‡æ–°åŠ è½½å¯¼å‡ºé…ç½® showmount -e # æŸ¥çœ‹æœ¬æœºå…±äº« # å®¢æˆ·ç«¯ mount -t nfs # æŒ‚è½½ NFS å…±äº« umount # å¸è½½ NFS å…±äº« showmount -e \u0026lt;server\u0026gt; # æŸ¥çœ‹è¿œç¨‹å…±äº« # ç›‘æ§ nfsstat # æŸ¥çœ‹ NFS ç»Ÿè®¡ rpcinfo -p # æŸ¥çœ‹ RPC æœåŠ¡ df -hT # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ ç°åœ¨æ‚¨å·²ç»èƒ½å¤Ÿç†Ÿç»ƒåœ°åœ¨ Alpine Linux ä¸Šé…ç½®å’Œç®¡ç† NFS æœåŠ¡äº†ï¼ğŸš€\nğŸ“š æ‰©å±•é˜…è¯» Alpine Linux å®˜æ–¹æ–‡æ¡£ NFS å®˜æ–¹æ–‡æ¡£ Linux NFS-HOWTO NFS æ€§èƒ½è°ƒä¼˜æŒ‡å— NFS å®‰å…¨æœ€ä½³å®è·µ Alpine Linux å­˜å‚¨ç®¡ç† äº«å—æ‚¨çš„é«˜æ•ˆæ–‡ä»¶å…±äº«ä½“éªŒï¼ğŸ‰\nğŸ’¡ æç¤º: æœ¬æ–‡åŸºäº Alpine Linux 3.16 ç¼–å†™ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£ Linux å‘è¡Œç‰ˆã€‚ä¸åŒç‰ˆæœ¬çš„ Alpine Linux å¯èƒ½ä¼šæœ‰ç»†å¾®å·®å¼‚ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é…ç½®ã€‚\nâš ï¸ æ³¨æ„: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² NFS å‰ï¼Œè¯·åŠ¡å¿…è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œå¹¶ç¡®ä¿é…ç½®äº†é€‚å½“çš„å®‰å…¨æªæ–½ï¼Œå¦‚é˜²ç«å¢™è§„åˆ™å’Œè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚\nğŸ”„ æ›´æ–°: æœ¬æ–‡ä¼šå®šæœŸæ›´æ–°ä»¥åæ˜ æœ€æ–°çš„ Alpine Linux å’Œ NFS æœ€ä½³å®è·µã€‚è¯·è®¿é—® ç§‘æŠ€lionçš„åšå®¢ è·å–æœ€æ–°ç‰ˆæœ¬ã€‚\n","date":"2024-12-07T13:57:20+08:00","image":"https://file.meimolihan.eu.org/img/alpine-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b8c6322f/","title":"Alpine é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸"},{"content":"Docker éƒ¨ç½² DPanel å®¹å™¨ç®¡ç†é¢æ¿ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² DPanel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ DPanel 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªç®¡ç†ï¼ŒæŒæ§æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ DPanel å®˜ç½‘åœ°å€ï¼š https://dpanel.cc/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/donknap/dpanel ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/dpanel/dpanel DPanel æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Docker å®¹å™¨ç®¡ç†é¢æ¿ï¼Œæä¾›ç›´è§‚çš„ Web ç•Œé¢æ¥ç®¡ç† Docker å®¹å™¨ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç¨³å®šå¯é çš„å®¹å™¨ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå®æ—¶ç›‘æ§ã€å®¹å™¨ç®¡ç†å’Œèµ„æºç»Ÿè®¡ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ–¥ï¸ å¯è§†åŒ–ç•Œé¢ æä¾›ç›´è§‚çš„ Web ç•Œé¢ç®¡ç† Docker å®¹å™¨ æ— éœ€å‘½ä»¤è¡Œæ“ä½œï¼Œç®€åŒ–å®¹å™¨ç®¡ç† âš¡ è½»é‡é«˜æ•ˆ åŸºäº Lite ç‰ˆæœ¬ï¼Œèµ„æºå ç”¨æå°‘ ä½èµ„æºæ¶ˆè€—ï¼Œé€‚åˆé•¿æœŸè¿è¡Œ ğŸ”„ å®æ—¶ç›‘æ§ å®æ—¶æŸ¥çœ‹å®¹å™¨çŠ¶æ€ã€èµ„æºä½¿ç”¨æƒ…å†µå’Œæ—¥å¿— å¿«é€Ÿå‘ç°å’Œè§£å†³é—®é¢˜ ğŸ› ï¸ å®¹å™¨ç®¡ç† æ”¯æŒå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€åˆ é™¤ç­‰æ“ä½œ å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç† ğŸ“Š èµ„æºç»Ÿè®¡ æ˜¾ç¤º CPUã€å†…å­˜ã€ç½‘ç»œå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ å…¨é¢äº†è§£ç³»ç»ŸçŠ¶æ€ ğŸ”’ å®‰å…¨è®¤è¯ æä¾›ç”¨æˆ·ç™»å½•è®¤è¯æœºåˆ¶ ä¿æŠ¤ç®¡ç†ç•Œé¢å®‰å…¨ ğŸŒ å¤šå®¹å™¨æ”¯æŒ åŒæ—¶ç®¡ç†å¤šä¸ª Docker å®¹å™¨ ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡ ğŸ“± å“åº”å¼è®¾è®¡ æ”¯æŒç”µè„‘å’Œç§»åŠ¨ç«¯è®¿é—® éšæ—¶éšåœ°ç®¡ç†å®¹å™¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² DPanel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 mkdir -p /mnt/mydisk/home/dpanel \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: dpanel: container_name: dpanel image: dpanel/dpanel:lite restart: unless-stopped network_mode: bridge ports: - \u0026#34;8807:8080\u0026#34; environment: - INSTALL_PASSWORD=admin - INSTALL_USERNAME=admin - APP_NAME=dpanel - TZ=Asia/Shanghai volumes: - ./config:/dpanel - /var/run/docker.sock:/var/run/docker.sock tty: true stdin_open: true privileged: true healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8080\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF ğŸ” é»˜è®¤ç™»å½•ä¿¡æ¯ï¼šç”¨æˆ·å adminï¼Œå¯†ç  adminã€‚é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ DPanel 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8807 å±€åŸŸç½‘è®¿é—®ï¼š http://10.10.10.245:8807 åŸŸåè®¿é—®ï¼š https://dpanel.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤å‡­è¯ç™»å½•ï¼š ç”¨æˆ·åï¼šadmin å¯†ç ï¼šadmin ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  æŸ¥çœ‹ Docker ä¸»æœºçš„åŸºæœ¬ä¿¡æ¯å’Œèµ„æºä½¿ç”¨æƒ…å†µ å¼€å§‹ç®¡ç†æ‚¨çš„å®¹å™¨å’ŒæœåŠ¡ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://dpanel.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/dpanel.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name dpanel.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name dpanel.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; location / { proxy_pass http://127.0.0.1:8807; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªç®¡ç†ï¼ŒæŒæ§æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† DPanel å®¹å™¨ç®¡ç†é¢æ¿ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ–¥ï¸ å¯è§†åŒ–ç®¡ç† é€šè¿‡ç›´è§‚çš„ Web ç•Œé¢è½»æ¾ç®¡ç†æ‰€æœ‰ Docker èµ„æºï¼Œå‘Šåˆ«å¤æ‚å‘½ä»¤è¡Œæ“ä½œ\nğŸ“Š å®æ—¶ç›‘æ§ å…¨é¢æŒæ¡å®¹å™¨çŠ¶æ€å’Œèµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°å¹¶è§£å†³é—®é¢˜\nâš¡ è½»é‡é«˜æ•ˆ åŸºäº Lite ç‰ˆæœ¬çš„ä¼˜åŒ–æ¶æ„ï¼Œä½èµ„æºæ¶ˆè€—ç¡®ä¿ç¨³å®šè¿è¡Œ\nç®¡ç†ä¹‹è·¯ï¼Œæ˜¯ä¸€åœºä¸å®¹å™¨æŠ€æœ¯ç›¸ä¼´çš„è¿ç»´è‰ºæœ¯ã€‚æ„¿ DPanel æˆä¸ºä½ å¾—åŠ›çš„è¿ç»´åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€æ¬¡å®¹å™¨ç®¡ç†å’ŒæœåŠ¡ç»´æŠ¤çš„é‡è¦æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå¯è§†åŒ–è¿ç»´ï¼Œé«˜æ•ˆç®¡ç†â€”â€”æ„å»ºä½ ç¨³å®šå¯é çš„å®¹å™¨ç¯å¢ƒå§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ DPanel å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ è¿ç»´æ„‰å¿«ï¼Œç®¡ç†æœ‰æˆï¼ğŸ‰\n","date":"2024-12-07T09:59:38+08:00","image":"https://file.meimolihan.eu.org/img/dpanel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1eee0b3d/","title":"Docker éƒ¨ç½² DPanel å®¹å™¨ç®¡ç†é¢æ¿ ğŸ³"},{"content":"Proxmox VE è™šæ‹Ÿæœºä¸å®¹å™¨ ID åç§°ä¿®æ”¹æŒ‡å— ğŸ·ï¸ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Proxmox VE (PVE) ä¸­å®‰å…¨åœ°ä¿®æ”¹è™šæ‹Ÿæœºå’Œ LXC å®¹å™¨çš„ ID åŠåç§°ï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶ä¿®æ”¹ã€ç£ç›˜æ–‡ä»¶é‡å‘½åã€æ³¨æ„äº‹é¡¹å’Œæ•…éšœæ¢å¤æ–¹æ³•ã€‚\nâœ¨ ç›®å½• âœ¨ ä¿®æ”¹å‰çš„å‡†å¤‡å·¥ä½œ ğŸ–¥ï¸ è™šæ‹Ÿæœºä¿®æ”¹ ID å’Œåç§° ğŸ“¦ LXC å®¹å™¨ä¿®æ”¹ ID å’Œåç§° âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ” éªŒè¯ä¿®æ”¹ç»“æœ ğŸ”§ é¢å¤–æ¸…ç†å·¥ä½œ ğŸ’¡ è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ†˜ æ•…éšœæ¢å¤ âœ¨ ä¿®æ”¹å‰çš„å‡†å¤‡å·¥ä½œ åœ¨å¼€å§‹ä¿®æ”¹å‰ï¼Œå¿…é¡»åšå¥½å……åˆ†å‡†å¤‡ï¼Œä»¥é¿å…æ•°æ®ä¸¢å¤±æˆ–é…ç½®é”™è¯¯ã€‚\n1ï¸âƒ£ åœæ­¢è™šæ‹Ÿæœº/å®¹å™¨ 1 2 3 4 5 # åœæ­¢è™šæ‹Ÿæœº qm stop 106 # åœæ­¢å®¹å™¨ pct stop 103 2ï¸âƒ£ å¤‡ä»½é‡è¦æ•°æ® 1 2 3 4 5 6 7 8 9 # å¤‡ä»½è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ cp -r /etc/pve/qemu-server/106.conf /root/106.conf.backup # å¤‡ä»½å®¹å™¨é…ç½®æ–‡ä»¶ cp -r /etc/pve/lxc/103.conf /root/103.conf.backup # å¤‡ä»½é•œåƒæ–‡ä»¶ cp -r /var/lib/vz/images/106 /root/106-backup cp -r /var/lib/vz/images/103 /root/103-backup 3ï¸âƒ£ æ£€æŸ¥ä¾èµ–é¡¹ 1 2 3 4 5 6 7 8 # æ£€æŸ¥æ˜¯å¦æœ‰å¤‡ä»½ä»»åŠ¡å¼•ç”¨æ—§ID grep -r \u0026#34;106\u0026#34; /etc/pve/jobs.cfg # æ£€æŸ¥ç›‘æ§ç³»ç»Ÿé…ç½® grep -r \u0026#34;106\u0026#34; /etc/pve/alerting.cfg # æ£€æŸ¥æƒé™è®¾ç½® grep -r \u0026#34;106\u0026#34; /etc/pve/user.cfg ğŸ–¥ï¸ ä¸€ã€è™šæ‹Ÿæœºä¿®æ”¹ ID å’Œåç§° 1ï¸âƒ£ ä¿®æ”¹é…ç½®æ–‡ä»¶ é‡å‘½åé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 # è¿›å…¥è™šæ‹Ÿæœºé…ç½®ç›®å½• cd /etc/pve/qemu-server # é‡å‘½åé…ç½®æ–‡ä»¶ï¼ˆ106 â†’ 253ï¼‰ mv 106.conf 253.conf # éªŒè¯ä¿®æ”¹ ls -la | grep \u0026#39;253.conf\u0026#39; # âœ… åº”è¯¥æ˜¾ç¤ºæ–°çš„é…ç½®æ–‡ä»¶ ç¼–è¾‘é…ç½®æ–‡ä»¶å†…å®¹ 1 2 # ç¼–è¾‘æ–°çš„é…ç½®æ–‡ä»¶ nano /etc/pve/qemu-server/253.conf éœ€è¦ä¿®æ”¹çš„å†…å®¹ï¼š\n1 2 3 4 5 6 7 # ä¿®æ”¹å‰ï¼š sata0: local:106/vm-106-disk-0.qcow2 name: iStoreOS-P1 # ä¿®æ”¹åï¼š sata0: local:253/vm-253-disk-0.qcow2 name: iStoreOS 2ï¸âƒ£ ä¿®æ”¹ç£ç›˜é•œåƒæ–‡ä»¶ æŸ¥çœ‹åŸé•œåƒæ–‡ä»¶ 1 2 3 # æŸ¥çœ‹åŸIDçš„é•œåƒæ–‡ä»¶ cd /var/lib/vz/images/106 \u0026amp;\u0026amp; ls -la # ğŸ“‹ è®°å½•æ‰€æœ‰éœ€è¦é‡å‘½åçš„æ–‡ä»¶ é‡å‘½åç›®å½•å’Œæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # é‡å‘½åé•œåƒç›®å½•ï¼ˆ106 â†’ 253ï¼‰ cd /var/lib/vz/images/ \u0026amp;\u0026amp; mv 106 253 # è¿›å…¥æ–°ç›®å½• cd /var/lib/vz/images/253 # é‡å‘½åç£ç›˜æ–‡ä»¶ï¼ˆ106 â†’ 253ï¼‰ mv vm-106-disk-0.qcow2 vm-253-disk-0.qcow2 # å¦‚æœæœ‰å¤šä¸ªç£ç›˜æ–‡ä»¶ï¼Œé€ä¸€é‡å‘½å mv vm-106-disk-1.qcow2 vm-253-disk-1.qcow2 # éªŒè¯ä¿®æ”¹ ls -la # âœ… åº”è¯¥æ˜¾ç¤ºé‡å‘½ååçš„æ–‡ä»¶ 3ï¸âƒ£ å¤„ç†å¿«ç…§é…ç½® å¦‚æœè™šæ‹Ÿæœºæœ‰å¿«ç…§ï¼Œéœ€è¦æ£€æŸ¥å¹¶æ›´æ–°å¿«ç…§é…ç½®ä¸­çš„æ—§ ID å¼•ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 # æ£€æŸ¥å¿«ç…§é…ç½® grep -n \u0026#34;106\u0026#34; /etc/pve/qemu-server/253.conf # å¦‚æœæœ‰å¿«ç…§é…ç½®ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰æ—§IDå¼•ç”¨ # ä¾‹å¦‚ï¼š[testsnapshot] # snapstate: prepare # snaptime: 1654789200 # vmstate: local:106/vm-106-state-snapshot # éœ€è¦æ”¹ä¸ºï¼švmstate: local:253/vm-253-state-snapshot ğŸ“¦ äºŒã€LXC å®¹å™¨ä¿®æ”¹ ID å’Œåç§° 1ï¸âƒ£ ä¿®æ”¹é…ç½®æ–‡ä»¶ é‡å‘½åé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 # è¿›å…¥LXCå®¹å™¨é…ç½®ç›®å½• cd /etc/pve/lxc # é‡å‘½åé…ç½®æ–‡ä»¶ï¼ˆ103 â†’ 245ï¼‰ mv 103.conf 245.conf # éªŒè¯ä¿®æ”¹ ls -la | grep \u0026#39;245.conf\u0026#39; ç¼–è¾‘é…ç½®æ–‡ä»¶å†…å®¹ 1 2 # ç¼–è¾‘æ–°çš„é…ç½®æ–‡ä»¶ nano /etc/pve/lxc/245.conf éœ€è¦ä¿®æ”¹çš„å†…å®¹ï¼š\n1 2 3 4 5 6 7 # ä¿®æ”¹å‰ï¼š rootfs: local:103/vm-103-disk-0.raw name: iStoreOS-P1 # ä¿®æ”¹åï¼š rootfs: local:245/vm-245-disk-0.raw name: iStoreOS 2ï¸âƒ£ ä¿®æ”¹å®¹å™¨é•œåƒæ–‡ä»¶ æŸ¥çœ‹åŸé•œåƒæ–‡ä»¶ 1 2 3 # æŸ¥çœ‹åŸIDçš„å®¹å™¨æ–‡ä»¶ cd /var/lib/vz/images/103 \u0026amp;\u0026amp; ls -la # ğŸ“‹ è®°å½•éœ€è¦é‡å‘½åçš„æ–‡ä»¶ é‡å‘½åç›®å½•å’Œæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 # é‡å‘½åå®¹å™¨ç›®å½•ï¼ˆ103 â†’ 245ï¼‰ cd /var/lib/vz/images/ \u0026amp;\u0026amp; mv 103 245 # è¿›å…¥æ–°ç›®å½• cd /var/lib/vz/images/245 # é‡å‘½åç£ç›˜æ–‡ä»¶ï¼ˆ103 â†’ 245ï¼‰ mv vm-103-disk-0.raw vm-245-disk-0.raw # éªŒè¯ä¿®æ”¹ ls -la # âœ… åº”è¯¥æ˜¾ç¤ºé‡å‘½ååçš„æ–‡ä»¶ âš ï¸ ä¸‰ã€é‡è¦æ³¨æ„äº‹é¡¹ 1ï¸âƒ£ é›†ç¾¤ç¯å¢ƒç‰¹æ®Šå¤„ç† åœ¨ PVE é›†ç¾¤ç¯å¢ƒä¸­ï¼Œä¿®æ”¹èŠ‚ç‚¹åç§°éœ€è¦é¢å¤–æ­¥éª¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 1. ä¿®æ”¹ä¸»æœºåéœ€è¦æ›´æ–°å¤šä¸ªé…ç½®æ–‡ä»¶ sed -i \u0026#39;s/old-hostname/new-hostname/g\u0026#39; /etc/hostname sed -i \u0026#39;s/old-hostname/new-hostname/g\u0026#39; /etc/hosts sed -i \u0026#39;s/old-hostname/new-hostname/g\u0026#39; /etc/postfix/main.cf # 2. ç§»åŠ¨èŠ‚ç‚¹é…ç½®æ–‡ä»¶ systemctl stop pve-cluster cp -r /etc/pve/nodes/old-hostname /etc/pve/nodes/new-hostname rm -rf /etc/pve/nodes/old-hostname systemctl start pve-cluster # 3. æ›´æ–° RRD æ•°æ® systemctl stop rrdcached cd /var/lib/rrdcached/db/pve2-node mv old-hostname new-hostname cd ../pve2-storage mv old-hostname new-hostname systemctl start rrdcached 2ï¸âƒ£ é¿å…çš„å¸¸è§é”™è¯¯ ä¸è¦åœ¨è™šæ‹Ÿæœºæˆ–å®¹å™¨è¿è¡Œæ—¶ä¿®æ”¹ ID ä¸è¦ç›´æ¥ç¼–è¾‘ /var/lib/pve-cluster/config.db æ–‡ä»¶ ç¡®ä¿æ‰€æœ‰é…ç½®æ–‡ä»¶ä¸­çš„æ—§ ID å¼•ç”¨éƒ½å·²æ›´æ–° æ£€æŸ¥æ‰€æœ‰å¿«ç…§é…ç½®ä¸­çš„ç£ç›˜è·¯å¾„å¼•ç”¨ 3ï¸âƒ£ ä¿®æ”¹é™åˆ¶ å°äº 100 çš„ VMID è¢« Proxmox VE ä¿ç•™å†…éƒ¨ä½¿ç”¨ é›†ç¾¤å†…çš„ VMID ä¸èƒ½é‡å¤ ä¿®æ”¹èŠ‚ç‚¹åç§°æˆ– IP åœ°å€å¯èƒ½å½±å“é›†ç¾¤åŠŸèƒ½ ğŸ” å››ã€éªŒè¯ä¿®æ”¹ç»“æœ 1ï¸âƒ£ é…ç½®æ–‡ä»¶éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® qm config 253 # âœ… åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„é…ç½®ä¿¡æ¯ # æ£€æŸ¥å®¹å™¨é…ç½® pct config 245 # âœ… åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„é…ç½®ä¿¡æ¯ # æ£€æŸ¥åç§°ä¿®æ”¹ grep \u0026#34;name:\u0026#34; /etc/pve/qemu-server/253.conf grep \u0026#34;name:\u0026#34; /etc/pve/lxc/245.conf 2ï¸âƒ£ ç£ç›˜æ–‡ä»¶éªŒè¯ 1 2 3 4 5 6 7 # æ£€æŸ¥è™šæ‹Ÿæœºç£ç›˜è·¯å¾„ ls -la /var/lib/vz/images/253/ # âœ… åº”è¯¥æ˜¾ç¤ºé‡å‘½ååçš„ç£ç›˜æ–‡ä»¶ # æ£€æŸ¥å®¹å™¨ç£ç›˜è·¯å¾„ ls -la /var/lib/vz/images/245/ # âœ… åº”è¯¥æ˜¾ç¤ºé‡å‘½ååçš„ç£ç›˜æ–‡ä»¶ 3ï¸âƒ£ å¯åŠ¨æµ‹è¯• 1 2 3 4 5 6 7 8 9 # å¯åŠ¨ä¿®æ”¹åçš„è™šæ‹Ÿæœº qm start 253 qm status 253 # âœ… åº”è¯¥æ­£å¸¸å¯åŠ¨å¹¶è¿è¡Œ # å¯åŠ¨ä¿®æ”¹åçš„å®¹å™¨ pct start 245 pct status 245 # âœ… åº”è¯¥æ­£å¸¸å¯åŠ¨å¹¶è¿è¡Œ 4ï¸âƒ£ åŠŸèƒ½éªŒè¯ 1 2 3 4 5 6 7 8 # æµ‹è¯•ç½‘ç»œè¿æ¥ ping -c 4 \u0026lt;è™šæ‹ŸæœºIP\u0026gt; # æµ‹è¯•æœåŠ¡è®¿é—® curl -I http://\u0026lt;è™šæ‹ŸæœºIP\u0026gt; # æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ journalctl -u pvedaemon -f ğŸ”§ äº”ã€é¢å¤–æ¸…ç†å·¥ä½œ 1ï¸âƒ£ æ¸…ç†æ—§é…ç½®å¼•ç”¨ 1 2 3 4 5 6 7 # æ£€æŸ¥å¹¶æ¸…ç†å¯èƒ½å­˜åœ¨çš„æ—§IDå¼•ç”¨ grep -r \u0026#34;106\u0026#34; /etc/pve/ grep -r \u0026#34;103\u0026#34; /etc/pve/ # æ¸…ç†å¤‡ä»½æ–‡ä»¶ï¼ˆç¡®è®¤æ­£å¸¸åï¼‰ rm -f /root/106.conf.backup /root/103.conf.backup rm -rf /root/106-backup /root/103-backup 2ï¸âƒ£ æ›´æ–°å¤‡ä»½ä»»åŠ¡ 1 2 3 # ä¿®æ”¹å¤‡ä»½ä»»åŠ¡ä¸­çš„VMID nano /etc/pve/jobs.cfg # ğŸ”§ æ›´æ–°æ‰€æœ‰å¯¹æ—§IDçš„å¼•ç”¨ 3ï¸âƒ£ æ›´æ–°ç›‘æ§é…ç½® 1 2 # æ£€æŸ¥ç›‘æ§ç³»ç»Ÿé…ç½® # æ›´æ–°Zabbixã€Prometheusç­‰ç›‘æ§ç³»ç»Ÿä¸­çš„VMID ğŸ’¡ å…­ã€è‡ªåŠ¨åŒ–è„šæœ¬ 1ï¸âƒ£ è™šæ‹Ÿæœºé‡å‘½åè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash # PVEè™šæ‹Ÿæœºé‡å‘½åè„šæœ¬ OLD_ID=$1 NEW_ID=$2 NEW_NAME=$3 # åœæ­¢è™šæ‹Ÿæœº qm stop $OLD_ID # é‡å‘½åé…ç½®æ–‡ä»¶å’Œå†…å®¹ cd /etc/pve/qemu-server mv ${OLD_ID}.conf ${NEW_ID}.conf sed -i \u0026#34;s/${OLD_ID}/${NEW_ID}/g\u0026#34; ${NEW_ID}.conf sed -i \u0026#34;s/name: .*/name: ${NEW_NAME}/\u0026#34; ${NEW_ID}.conf # é‡å‘½åç£ç›˜æ–‡ä»¶ cd /var/lib/vz/images/ mv ${OLD_ID} ${NEW_ID} cd ${NEW_ID} rename \u0026#34;s/${OLD_ID}/${NEW_ID}/\u0026#34; * echo \u0026#34;è™šæ‹Ÿæœº ${OLD_ID} å·²é‡å‘½åä¸º ${NEW_ID} (${NEW_NAME})\u0026#34; 2ï¸âƒ£ LXCå®¹å™¨é‡å‘½åè„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash # LXCå®¹å™¨é‡å‘½åè„šæœ¬ OLD_ID=$1 NEW_ID=$2 NEW_NAME=$3 # åœæ­¢å®¹å™¨ pct stop $OLD_ID # é‡å‘½åé…ç½®æ–‡ä»¶å’Œå†…å®¹ cd /etc/pve/lxc mv ${OLD_ID}.conf ${NEW_ID}.conf sed -i \u0026#34;s/${OLD_ID}/${NEW_ID}/g\u0026#34; ${NEW_ID}.conf sed -i \u0026#34;s/name: .*/name: ${NEW_NAME}/\u0026#34; ${NEW_ID}.conf # é‡å‘½åç£ç›˜æ–‡ä»¶ cd /var/lib/vz/images/ mv ${OLD_ID} ${NEW_ID} cd ${NEW_ID} rename \u0026#34;s/${OLD_ID}/${NEW_ID}/\u0026#34; * echo \u0026#34;å®¹å™¨ ${OLD_ID} å·²é‡å‘½åä¸º ${NEW_ID} (${NEW_NAME})\u0026#34; 3ï¸âƒ£ è„šæœ¬ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 # ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ chmod +x pve-rename-vm.sh chmod +x pve-rename-lxc.sh # ä½¿ç”¨è„šæœ¬é‡å‘½åè™šæ‹Ÿæœº ./pve-rename-vm.sh 106 253 iStoreOS # ä½¿ç”¨è„šæœ¬é‡å‘½åå®¹å™¨ ./pve-rename-lxc.sh 103 245 iStoreOS-CT ğŸ†˜ ä¸ƒã€æ•…éšœæ¢å¤ 1ï¸âƒ£ å¦‚æœæ“ä½œå¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 # æ¢å¤é…ç½®æ–‡ä»¶ cp /root/106.conf.backup /etc/pve/qemu-server/106.conf cp /root/103.conf.backup /etc/pve/lxc/103.conf # æ¢å¤ç£ç›˜æ–‡ä»¶ mv /root/106-backup /var/lib/vz/images/106 mv /root/103-backup /var/lib/vz/images/103 # é‡å¯æœåŠ¡ systemctl restart pvedaemon systemctl restart pveproxy 2ï¸âƒ£ å¸¸è§é—®é¢˜è§£å†³ é—®é¢˜ 1: å¯åŠ¨å¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°ç£ç›˜ è§£å†³æ–¹æ³•:\n1 2 3 4 5 # æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ç£ç›˜è·¯å¾„æ˜¯å¦æ­£ç¡® qm config 253 | grep disk # æ£€æŸ¥ç£ç›˜æ–‡ä»¶æ˜¯å¦å­˜åœ¨ ls -la /var/lib/vz/images/253/ é—®é¢˜ 2: é›†ç¾¤èŠ‚ç‚¹é—´é…ç½®ä¸åŒæ­¥ è§£å†³æ–¹æ³•:\n1 2 3 # å¼ºåˆ¶é‡æ–°åŒæ­¥é›†ç¾¤é…ç½® pvecm expected 1 systemctl restart pve-cluster é—®é¢˜ 3: Web ç•Œé¢æ˜¾ç¤ºé”™è¯¯ è§£å†³æ–¹æ³•:\n1 2 3 4 5 # æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ # æˆ–è€…é‡å¯ PVE ç®¡ç†æœåŠ¡ systemctl restart pvedaemon systemctl restart pveproxy systemctl restart pvestatd ğŸš¨ é‡è¦æç¤º: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ“ä½œå‰ï¼ŒåŠ¡å¿…è¿›è¡Œå®Œæ•´å¤‡ä»½ï¼Œå¹¶åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æ“ä½œæµç¨‹ã€‚ä¿®æ”¹ ID å¯èƒ½ä¼šå½±å“ä¾èµ– VMID çš„è‡ªåŠ¨åŒ–è„šæœ¬å’Œç›‘æ§ç³»ç»Ÿã€‚\né€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå®‰å…¨åœ°ä¿®æ”¹ PVE ä¸­è™šæ‹Ÿæœºå’Œå®¹å™¨çš„ ID åŠåç§°ã€‚å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒæ•…éšœæ¢å¤éƒ¨åˆ†å›æ»šæ“ä½œã€‚\nğŸ“š æ‰©å±•é˜…è¯» Proxmox VE å®˜æ–¹æ–‡æ¡£ - è™šæ‹Ÿæœºé…ç½® Proxmox VE å®˜æ–¹æ–‡æ¡£ - å­˜å‚¨ç®¡ç† Proxmox VE å®˜æ–¹æ–‡æ¡£ - é›†ç¾¤ç®¡ç† ğŸ’¡ æç¤º: æœ¬æ–‡åŸºäº Proxmox VE 7.x å’Œ 8.x ç¼–å†™ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£ PVE ç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬çš„ PVE å¯èƒ½ä¼šæœ‰ç»†å¾®å·®å¼‚ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é…ç½®ã€‚\nâš ï¸ æ³¨æ„: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹ VMID å‰ï¼Œè¯·åŠ¡å¿…è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œå¹¶ç¡®ä¿å·²å¤‡ä»½æ‰€æœ‰é‡è¦æ•°æ®ã€‚\nğŸ”„ æ›´æ–°: æœ¬æ–‡ä¼šå®šæœŸæ›´æ–°ä»¥åæ˜ æœ€æ–°çš„ Proxmox VE æœ€ä½³å®è·µã€‚è¯·è®¿é—® ç§‘æŠ€ lion çš„åšå®¢ è·å–æœ€æ–°ç‰ˆæœ¬ã€‚\n","date":"2024-12-07T09:58:28+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/c7f0232c/","title":"Proxmox VE è™šæ‹Ÿæœºä¸å®¹å™¨ ID åç§°ä¿®æ”¹æŒ‡å— ğŸ·ï¸"},{"content":"Docker éƒ¨ç½² Cloudreve ä¸ªäººç½‘ç›˜ ğŸ—‚ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Cloudreve 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªä¸ªäººäº‘å­˜å‚¨ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Cloudreve å®˜ç½‘åœ°å€ï¼š https://cloudreve.org ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/cloudreve/cloudreve ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/cloudreve/cloudreve Cloudreve æ˜¯ä¸€æ¬¾å¼€æºçš„ä¸ªäººç½‘ç›˜ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆæœ¬åœ°å­˜å‚¨ã€å¯¹è±¡å­˜å‚¨ç­‰ï¼‰ï¼Œæä¾›æ–‡ä»¶ç®¡ç†ã€åˆ†äº«ã€åœ¨çº¿é¢„è§ˆç­‰åŠŸèƒ½ã€‚é€šè¿‡ä¸ Aria2 é›†æˆï¼Œè¿˜å¯ä»¥å®ç°ç¦»çº¿ä¸‹è½½åŠŸèƒ½ï¼Œæ˜¯ä¸€æ¬¾åŠŸèƒ½å…¨é¢ä¸”æ˜“äºéƒ¨ç½²çš„ä¸ªäººç½‘ç›˜è§£å†³æ–¹æ¡ˆã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å¤šå­˜å‚¨æ”¯æŒ æ”¯æŒæœ¬åœ°å­˜å‚¨ã€å¯¹è±¡å­˜å‚¨ï¼ˆS3ã€OSSã€COSç­‰ï¼‰ çµæ´»çš„å­˜å‚¨æ–¹æ¡ˆé€‰æ‹© ğŸ“ æ–‡ä»¶ç®¡ç† å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€é‡å‘½åç­‰åŠŸèƒ½ å®Œå–„çš„æ–‡ä»¶æ“ä½œä½“éªŒ ğŸ”— æ–‡ä»¶åˆ†äº« ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œè®¾ç½®å¯†ç å’Œæœ‰æ•ˆæœŸ æ–¹ä¾¿çš„æ–‡ä»¶å…±äº«æ–¹å¼ ğŸ‘¥ ç”¨æˆ·ç®¡ç† æ”¯æŒå¤šç”¨æˆ·å’Œæƒé™æ§åˆ¶ é€‚åˆä¸ªäººæˆ–å›¢é˜Ÿä½¿ç”¨ â¬‡ï¸ ç¦»çº¿ä¸‹è½½ é›†æˆ Aria2 æ”¯æŒ HTTPã€BTã€ç£åŠ›é“¾ä¸‹è½½ å¼ºå¤§çš„ä¸‹è½½åŠŸèƒ½ ğŸ“± å“åº”å¼è®¾è®¡ å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ è·¨è®¾å¤‡ä¸€è‡´çš„ä½¿ç”¨ä½“éªŒ ğŸ¨ ä¸»é¢˜å®šåˆ¶ æ”¯æŒè‡ªå®šä¹‰ç•Œé¢ä¸»é¢˜ ä¸ªæ€§åŒ–ç•Œé¢è®¾ç½® ğŸ”’ å®‰å…¨å¯é  æä¾›æ–‡ä»¶åŠ å¯†ã€é˜²ç›—é“¾ç­‰å®‰å…¨åŠŸèƒ½ ä¿éšœæ•°æ®å®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Cloudreve 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 mkdir -p /mnt/mydisk/home/cloudreve \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: cloudreve: container_name: cloudreve image: cloudreve/cloudreve:latest restart: unless-stopped ports: - \u0026#34;5212:5212\u0026#34; volumes: - ./uploads:/cloudreve/uploads - ./conf.ini:/cloudreve/conf.ini - ./cloudreve.db:/cloudreve/cloudreve.db - ./avatar:/cloudreve/avatar environment: - TZ=Asia/Shanghai aria2: container_name: aria2 image: p3terx/aria2-pro:latest restart: unless-stopped ports: - \u0026#34;6800:6800\u0026#34; volumes: - ./aria2/config:/config - ./downloads:/downloads environment: - RPC_SECRET=KEJILION - RPC_PORT=6800 - TZ=Asia/Shanghai EOF ğŸ” å®‰å…¨æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:5212 IPè®¿é—®: http://æœåŠ¡å™¨IP:5212 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼š ç”¨æˆ·åï¼šadmin å¯†ç ï¼šadmin ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  è¿›å…¥ç®¡ç†é¢æ¿é…ç½®åŸºæœ¬è®¾ç½® é…ç½® Aria2 ç¦»çº¿ä¸‹è½½é›†æˆ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://cloud.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/cloudreve.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name cloud.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆç½‘ç›˜éœ€è¦è¾ƒå¤§é™åˆ¶ï¼‰ client_max_body_size 20G; location / { proxy_pass http://127.0.0.1:5212; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½®ï¼ˆå¤§æ–‡ä»¶ä¸Šä¼ éœ€è¦è¾ƒé•¿è¶…æ—¶ï¼‰ proxy_read_timeout 3600s; proxy_send_timeout 3600s; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/cloudreve # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop cloudreve aria2 docker start cloudreve aria2 docker restart cloudreve aria2 # åˆ é™¤å®¹å™¨ docker rm cloudreve aria2 docker rm -f cloudreve aria2 # è¿›å…¥å®¹å™¨Shell docker exec -it cloudreve sh docker exec -it aria2 sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect cloudreve docker stats cloudreve # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs cloudreve docker logs -f cloudreve docker logs --tail 100 cloudreve docker logs -t cloudreve 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi cloudreve/cloudreve:latest p3terx/aria2-pro:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªä¸ªäººäº‘å­˜å‚¨ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Cloudreve ä¸ªäººç½‘ç›˜ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ—‚ï¸ éšæ—¶éšåœ° è®¿é—®ä¸ªäººæ–‡ä»¶åº“ï¼Œæ— è®ºæ˜¯æ–‡æ¡£ã€ç…§ç‰‡è¿˜æ˜¯è§†é¢‘ï¼Œéƒ½èƒ½å®‰å…¨å­˜å‚¨å’Œéšæ—¶å–ç”¨\nğŸ” å®Œå…¨è‡ªä¸» æŒæ§æ•°æ®å­˜å‚¨ï¼Œå‘Šåˆ«ç¬¬ä¸‰æ–¹äº‘æœåŠ¡çš„é™åˆ¶å’Œéšç§æ‹…å¿§ï¼ŒçœŸæ­£æ‹¥æœ‰è‡ªå·±çš„æ•°å­—èµ„äº§\nğŸŒ å¤šç«¯åŒæ­¥ åœ¨ç”µè„‘ã€æ‰‹æœºã€å¹³æ¿ç­‰å„ç§è®¾å¤‡ä¸Šæ— ç¼è®¿é—®æ–‡ä»¶ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§å’Œå¯ç”¨æ€§\nâš¡ é«˜æ•ˆåˆ†äº« è½»æ¾ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œè®¾ç½®å¯†ç å’Œæœ‰æ•ˆæœŸï¼Œå®‰å…¨ä¾¿æ·åœ°ä¸ä»–äººå…±äº«æ–‡ä»¶\næ•°æ®æ˜¯æ•°å­—æ—¶ä»£çš„é‡è¦èµ„äº§ï¼Œå­˜å‚¨æ˜¯ä»·å€¼ä¿éšœçš„åŸºç¡€ã€‚æ„¿ Cloudreve æˆä¸ºä½ ä¸ªäººæ•°æ®ç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ æ„å»ºå®‰å…¨ã€å¯é ã€ä¾¿æ·çš„ä¸ªäººäº‘å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ•´ç†æ–‡ä»¶ï¼Œå®ˆæŠ¤æ•°æ®â€”â€”æ„å»ºä½ ä¸“å±çš„æ•°å­—èµ„äº§åº“å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Cloudreve é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸å®‰å…¨è¡¥ä¸ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œæ•°æ®å®‰å…¨ï¼ğŸ‰\n","date":"2024-12-07T09:47:52+08:00","image":"https://file.meimolihan.eu.org/img/docker-cloudreve-001.webp","permalink":"https://blog.meimolihan.eu.org/p/ae15bc8b/","title":"Docker éƒ¨ç½² Cloudreve ä¸ªäººç½‘ç›˜ ğŸ—‚ï¸"},{"content":"Markdown å¸¸ç”¨è¯­æ³•å¤§å…¨ ğŸ“ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº† Markdown çš„å¸¸ç”¨è¯­æ³•å’Œé«˜çº§ç”¨æ³•ï¼Œå¸®åŠ©æ‚¨åˆ›å»ºç¾è§‚ã€ç»“æ„æ¸…æ™°çš„æ–‡æ¡£ã€‚Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œæ˜“è¯»æ˜“å†™ï¼Œå¯ä»¥è½¬æ¢ä¸ºæœ‰æ•ˆçš„ HTML æ–‡æ¡£ã€‚ğŸš€\nğŸ“– å¯¼èˆªç›®å½• âœ¨ ç®€ä»‹ ğŸ”¤ åŸºç¡€æ–‡æœ¬æ ¼å¼åŒ– ğŸ“‹ æ ‡é¢˜ä¸åˆ†å‰²çº¿ ğŸ“ åˆ—è¡¨ ğŸŒ é“¾æ¥ä¸å›¾ç‰‡ ğŸ’» ä»£ç ç›¸å…³ ğŸ“Š è¡¨æ ¼ ğŸ’¬ å¼•ç”¨ä¸æ³¨é‡Š ğŸš€ é«˜çº§åŠŸèƒ½ ğŸ”§ HTML åµŒå…¥ âš¡ è½¬ä¹‰å­—ç¬¦ ğŸ’¡ å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸ› ï¸ å·¥å…·æ¨è âœ¨ ç®€ä»‹ ğŸ“– Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œç”± John Gruber äº 2004 å¹´åˆ›å»ºã€‚å®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼Œç„¶åè½¬æ¢æˆæœ‰æ•ˆçš„ HTML æ–‡æ¡£ã€‚\nä¸»è¦ç‰¹ç‚¹ï¼š\nğŸ“ è¯­æ³•ç®€å•ç›´è§‚ï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“ ğŸ”„ çº¯æ–‡æœ¬æ ¼å¼ï¼Œå…¼å®¹æ‰€æœ‰æ–‡æœ¬ç¼–è¾‘å™¨ ğŸŒ å¯è½¬æ¢ä¸º HTMLã€PDF ç­‰å¤šç§æ ¼å¼ ğŸ’¼ å¹¿æ³›åº”ç”¨äºæ–‡æ¡£ç¼–å†™ã€åšå®¢å‘å¸ƒã€ç¬”è®°è®°å½•ç­‰åœºæ™¯ ğŸ†“ å¼€æºä¸”å…è´¹ä½¿ç”¨ ğŸ”¤ åŸºç¡€æ–‡æœ¬æ ¼å¼åŒ– âœ¨ 1. ç²—ä½“æ–‡æœ¬ 1 2 **ç²—ä½“æ–‡æœ¬** __ç²—ä½“æ–‡æœ¬__ ç¤ºä¾‹æ•ˆæœï¼š ç²—ä½“æ–‡æœ¬ ç²—ä½“æ–‡æœ¬\n2. æ–œä½“æ–‡æœ¬ 1 2 *æ–œä½“æ–‡æœ¬* _æ–œä½“æ–‡æœ¬_ ç¤ºä¾‹æ•ˆæœï¼š æ–œä½“æ–‡æœ¬ æ–œä½“æ–‡æœ¬\n3. ç²—æ–œä½“æ–‡æœ¬ 1 2 ***ç²—æ–œä½“æ–‡æœ¬*** ___ç²—æ–œä½“æ–‡æœ¬___ ç¤ºä¾‹æ•ˆæœï¼š ç²—æ–œä½“æ–‡æœ¬ ç²—æ–œä½“æ–‡æœ¬\n4. åˆ é™¤çº¿ 1 ~~åˆ é™¤çº¿æ–‡æœ¬~~ ç¤ºä¾‹æ•ˆæœï¼š åˆ é™¤çº¿æ–‡æœ¬\n5. æ–‡æœ¬é«˜äº® 1 \u0026lt;mark\u0026gt;é«˜äº®æ–‡æœ¬\u0026lt;/mark\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š é«˜äº®æ–‡æœ¬\n6. ä¸‹æ ‡å’Œä¸Šæ ‡ 1 2 H\u0026lt;sub\u0026gt;2\u0026lt;/sub\u0026gt;O E = mc\u0026lt;sup\u0026gt;2\u0026lt;/sup\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š H2O E = mc2\nğŸ“‹ æ ‡é¢˜ä¸åˆ†å‰²çº¿ ğŸ“‹ 1. æ ‡é¢˜çº§åˆ« 1 2 3 4 5 6 # ä¸€çº§æ ‡é¢˜ ## äºŒçº§æ ‡é¢˜ ### ä¸‰çº§æ ‡é¢˜ #### å››çº§æ ‡é¢˜ ##### äº”çº§æ ‡é¢˜ ###### å…­çº§æ ‡é¢˜ 2. æ›¿ä»£æ ‡é¢˜è¯­æ³• 1 2 3 4 5 ä¸€çº§æ ‡é¢˜ ========= äºŒçº§æ ‡é¢˜ --------- 3. å±…ä¸­å¯¹é½æ ‡é¢˜ 1 # \u0026lt;center\u0026gt;å±…ä¸­æ ‡é¢˜\u0026lt;/center\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š\nå±…ä¸­æ ‡é¢˜ç¤ºä¾‹ 4. åˆ†å‰²çº¿ 1 2 3 --- *** ___ ç¤ºä¾‹æ•ˆæœï¼š\n5. å¸¦æ–‡æœ¬çš„åˆ†å‰²çº¿ 1 2 3 [//]: # (---) * * * - - - ğŸ“ åˆ—è¡¨ ğŸ“ 1. æœ‰åºåˆ—è¡¨ 1 2 3 4 5 1. ç¬¬ä¸€é¡¹ 2. ç¬¬äºŒé¡¹ 3. ç¬¬ä¸‰é¡¹ 1. å­é¡¹ä¸€ 2. å­é¡¹äºŒ ç¤ºä¾‹æ•ˆæœï¼š\nç¬¬ä¸€é¡¹ ç¬¬äºŒé¡¹ ç¬¬ä¸‰é¡¹ å­é¡¹ä¸€ å­é¡¹äºŒ 2. æ— åºåˆ—è¡¨ 1 2 3 4 5 6 7 8 - é¡¹ç›®ä¸€ - é¡¹ç›®äºŒ - é¡¹ç›®ä¸‰ - å­é¡¹ç›®ä¸€ - å­é¡¹ç›®äºŒ * å¦ä¸€ç§æ–¹å¼ + åˆä¸€ç§æ–¹å¼ ç¤ºä¾‹æ•ˆæœï¼š\né¡¹ç›®ä¸€ é¡¹ç›®äºŒ é¡¹ç›®ä¸‰ å­é¡¹ç›®ä¸€ å­é¡¹ç›®äºŒ 3. ä»»åŠ¡åˆ—è¡¨ 1 2 - [ ] æœªå®Œæˆä»»åŠ¡ - [x] å·²å®Œæˆä»»åŠ¡ ç¤ºä¾‹æ•ˆæœï¼š\næœªå®Œæˆä»»åŠ¡ å·²å®Œæˆä»»åŠ¡ 4. å®šä¹‰åˆ—è¡¨ 1 2 3 4 5 æœ¯è¯­ä¸€ : å®šä¹‰ä¸€ æœ¯è¯­äºŒ : å®šä¹‰äºŒ ç¤ºä¾‹æ•ˆæœï¼š æœ¯è¯­ä¸€ å®šä¹‰ä¸€ æœ¯è¯­äºŒ å®šä¹‰äºŒ ğŸŒ é“¾æ¥ä¸å›¾ç‰‡ ğŸŒ 1. æ–‡å­—é“¾æ¥ 1 [æ˜¾ç¤ºæ–‡æœ¬](é“¾æ¥åœ°å€ \u0026#34;æç¤ºæ–‡å­—\u0026#34;) ç¤ºä¾‹æ•ˆæœï¼š ç™¾åº¦æœç´¢ 2. å¼•ç”¨å¼é“¾æ¥ 1 2 3 [æ˜¾ç¤ºæ–‡æœ¬][é“¾æ¥æ ‡è¯†] [é“¾æ¥æ ‡è¯†]: https://example.com \u0026#34;å¯é€‰æ ‡é¢˜\u0026#34; 3. ç›´æ¥é“¾æ¥ 1 2 \u0026lt;https://www.example.com\u0026gt; \u0026lt;email@example.com\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š https://www.example.com email@example.com 4. å›¾ç‰‡åµŒå…¥ 1 ![å›¾ç‰‡æè¿°](å›¾ç‰‡é“¾æ¥åœ°å€ \u0026#34;å¯é€‰æ ‡é¢˜\u0026#34;) ç¤ºä¾‹æ•ˆæœï¼š 5. å¸¦é“¾æ¥çš„å›¾ç‰‡ 1 [![å›¾ç‰‡æè¿°](å›¾ç‰‡é“¾æ¥)](ç›®æ ‡é“¾æ¥) 6. å›¾ç‰‡å¤§å°è°ƒæ•´ 1 \u0026lt;img src=\u0026#34;å›¾ç‰‡é“¾æ¥\u0026#34; alt=\u0026#34;å›¾ç‰‡æè¿°\u0026#34; width=\u0026#34;200\u0026#34; height=\u0026#34;100\u0026#34;\u0026gt; ğŸ’» ä»£ç ç›¸å…³ ğŸ’» 1. è¡Œå†…ä»£ç  1 `è¡Œå†…ä»£ç ` ç¤ºä¾‹æ•ˆæœï¼š console.log(\u0026quot;Hello World\u0026quot;)\n2. ä»£ç å— 1 2 3 ```è¯­è¨€åç§° ä»£ç å†…å®¹ ``` ç¤ºä¾‹æ•ˆæœï¼š\n1 2 3 function hello() { console.log(\u0026#34;Hello Markdown!\u0026#34;); } 3. ç¼©è¿›ä»£ç å— 1 2 ç¼©è¿›çš„ä»£ç å— æ¯è¡Œè‡³å°‘å››ä¸ªç©ºæ ¼ 4. è¯­æ³•é«˜äº®æ”¯æŒçš„è¯­è¨€ javascript æˆ– js python æˆ– py html css java php sql bash æˆ– sh ç­‰ç­‰\u0026hellip; ğŸ“Š è¡¨æ ¼ ğŸ“Š 1. åŸºç¡€è¡¨æ ¼ 1 2 3 4 | åˆ—1 | åˆ—2 | åˆ—3 | |-----|-----|-----| | æ•°æ®1 | æ•°æ®2 | æ•°æ®3 | | æ•°æ®4 | æ•°æ®5 | æ•°æ®6 | ç¤ºä¾‹æ•ˆæœï¼š\nå¹´é¾„ ç­çº§ åå­— 18 äºŒç­ å‡¡å‡¡ 18 ä¸‰ç­ æ¶µæ¶µ 2. è¡¨æ ¼å¯¹é½ 1 2 3 | å·¦å¯¹é½ | å±…ä¸­å¯¹é½ | å³å¯¹é½ | |:-------|:--------:|-------:| | æ•°æ®å·¦ | æ•°æ®ä¸­ | æ•°æ®å³ | ç¤ºä¾‹æ•ˆæœï¼š\nå·¦å¯¹é½ å±…ä¸­å¯¹é½ å³å¯¹é½ å·¦ä¾§æ•°æ® ä¸­é—´æ•°æ® å³ä¾§æ•°æ® 3. å¤æ‚è¡¨æ ¼ 1 2 3 4 5 | é¡¹ç›® | ä»·æ ¼ | æ•°é‡ | |------|-----:|:----:| | è‹¹æœ | \\$1 | 5 | | é¦™è•‰ | \\$2 | 3 | | æ€»è®¡ | \\$11 | 8 | ğŸ’¬ å¼•ç”¨ä¸æ³¨é‡Š ğŸ’¬ 1. å—å¼•ç”¨ 1 2 3 \u0026gt; ä¸€çº§å¼•ç”¨ \u0026gt;\u0026gt; äºŒçº§å¼•ç”¨ \u0026gt;\u0026gt;\u0026gt; ä¸‰çº§å¼•ç”¨ ç¤ºä¾‹æ•ˆæœï¼š\nä¸€çº§å¼•ç”¨\näºŒçº§å¼•ç”¨\nä¸‰çº§å¼•ç”¨\n2. å¸¦æ¥æºçš„å¼•ç”¨ 1 2 3 \u0026gt; è¿™æ˜¯ä¸€ä¸ªç²¾å½©çš„å¼•ç”¨ã€‚ \u0026gt; \u0026gt; â€” \u0026lt;cite\u0026gt;åäººå§“å\u0026lt;/cite\u0026gt; 3. æ³¨é‡Š 1 2 [//]: # (è¿™æ˜¯æ³¨é‡Šï¼Œä¸ä¼šæ˜¾ç¤º) \u0026lt;!-- è¿™ä¹Ÿæ˜¯æ³¨é‡Š --\u0026gt; 4. è„šæ³¨ 1 2 3 è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰è„šæ³¨çš„æ–‡æœ¬[^1]ã€‚ [^1]: è¿™æ˜¯è„šæ³¨çš„å†…å®¹ã€‚ ç¤ºä¾‹æ•ˆæœï¼š è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰è„šæ³¨çš„æ–‡æœ¬1ã€‚\nğŸš€ é«˜çº§åŠŸèƒ½ ğŸš€ 1. è‡ªå®šä¹‰æ–‡æœ¬æ ·å¼ 1 \u0026lt;font face=\u0026#34;é»‘ä½“\u0026#34; color=\u0026#34;#0099ff\u0026#34; size=\u0026#34;4\u0026#34;\u0026gt;è‡ªå®šä¹‰æ–‡æœ¬\u0026lt;/font\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š è‡ªå®šä¹‰æ–‡æœ¬\n2. é¢œè‰²å’Œå¤§å°ç¤ºä¾‹ 1 2 3 \u0026lt;font color=#FF6347 size=5\u0026gt;çº¢è‰²æ–‡å­—\u0026lt;/font\u0026gt; \u0026lt;font color=#0099ff size=3\u0026gt;è“è‰²æ–‡å­—\u0026lt;/font\u0026gt; \u0026lt;font color=#9ACD32 size=6\u0026gt;ç»¿è‰²æ–‡å­—\u0026lt;/font\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š çº¢è‰²æ–‡å­— è“è‰²æ–‡å­— ç»¿è‰²æ–‡å­—\n3. å•é€‰æŒ‰é’® 1 2 [radio color=\u0026#34;blue\u0026#34; checked=\u0026#34;checked\u0026#34;]é€‰ä¸­é¡¹[/radio] [radio]æœªé€‰ä¸­é¡¹[/radio] ç¤ºä¾‹æ•ˆæœï¼š [radio color=\u0026ldquo;blue\u0026rdquo; checked=\u0026ldquo;checked\u0026rdquo;]é€‰ä¸­é¡¹[/radio] [radio]æœªé€‰ä¸­é¡¹[/radio]\n4. è¿›åº¦æ¡ 1 [progress value=\u0026#34;75\u0026#34; max=\u0026#34;100\u0026#34;]75%[/progress] ç¤ºä¾‹æ•ˆæœï¼š [progress value=\u0026ldquo;75\u0026rdquo; max=\u0026ldquo;100\u0026rdquo;]75%[/progress]\n5. æŠ˜å å†…å®¹ 1 2 3 4 5 6 7 8 9 \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;ç‚¹å‡»å±•å¼€è¯¦ç»†å†…å®¹\u0026lt;/summary\u0026gt; è¿™é‡Œæ˜¯éšè—çš„è¯¦ç»†å†…å®¹ã€‚ - é¡¹ç›®ä¸€ - é¡¹ç›®äºŒ - é¡¹ç›®ä¸‰ \u0026lt;/details\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š\nç‚¹å‡»å±•å¼€è¯¦ç»†å†…å®¹ è¿™é‡Œæ˜¯éšè—çš„è¯¦ç»†å†…å®¹ã€‚\né¡¹ç›®ä¸€ é¡¹ç›®äºŒ é¡¹ç›®ä¸‰ ğŸ”§ HTML åµŒå…¥ ğŸŒ 1. åµŒå…¥è§†é¢‘ 1 2 3 4 5 6 7 8 9 \u0026lt;iframe src=\u0026#34;//player.bilibili.com/player.html\u0026#34; width=\u0026#34;100%\u0026#34; height=\u0026#34;600\u0026#34; scrolling=\u0026#34;no\u0026#34; border=\u0026#34;0\u0026#34; frameborder=\u0026#34;no\u0026#34; framespacing=\u0026#34;0\u0026#34; allowfullscreen=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;/iframe\u0026gt; 2. åµŒå…¥éŸ³é¢‘ 1 2 3 4 \u0026lt;audio controls\u0026gt; \u0026lt;source src=\u0026#34;audio.mp3\u0026#34; type=\u0026#34;audio/mpeg\u0026#34;\u0026gt; æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚ \u0026lt;/audio\u0026gt; 3. åµŒå…¥ PDF 1 \u0026lt;embed src=\u0026#34;document.pdf\u0026#34; width=\u0026#34;100%\u0026#34; height=\u0026#34;600px\u0026#34; /\u0026gt; 4. æŒ‰é’® 1 \u0026lt;button onclick=\u0026#34;alert(\u0026#39;Hello!\u0026#39;)\u0026#34;\u0026gt;ç‚¹å‡»æˆ‘\u0026lt;/button\u0026gt; ç¤ºä¾‹æ•ˆæœï¼š ç‚¹å‡»æˆ‘\nâš¡ è½¬ä¹‰å­—ç¬¦ ğŸ”§ 1. å¸¸ç”¨è½¬ä¹‰å­—ç¬¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 \\* è½¬ä¹‰æ˜Ÿå· \\_ è½¬ä¹‰ä¸‹åˆ’çº¿ \\` è½¬ä¹‰åå¼•å· \\\\ è½¬ä¹‰åæ–œæ  \\[ è½¬ä¹‰å·¦æ–¹æ‹¬å· \\] è½¬ä¹‰å³æ–¹æ‹¬å· \\( è½¬ä¹‰å·¦åœ†æ‹¬å· \\) è½¬ä¹‰å³åœ†æ‹¬å· \\# è½¬ä¹‰äº•å· \\+ è½¬ä¹‰åŠ å· \\- è½¬ä¹‰å‡å· \\. è½¬ä¹‰å¥ç‚¹ \\! è½¬ä¹‰æ„Ÿå¹å· ç¤ºä¾‹æ•ˆæœï¼š * æ™®é€šæ˜Ÿå· _ æ™®é€šä¸‹åˆ’çº¿ ` æ™®é€šåå¼•å· \\ æ™®é€šåæ–œæ \n2. HTML å®ä½“ 1 2 3 4 5 \u0026amp;amp; \u0026amp;amp;amp; ç¬¦å· \u0026amp;lt; \u0026amp;lt; å°äºå· \u0026amp;gt; \u0026amp;gt; å¤§äºå· \u0026amp;nbsp; ä¸é—´æ–­ç©ºæ ¼ \u0026amp;copy; \u0026amp;copy; ç‰ˆæƒç¬¦å· ç¤ºä¾‹æ•ˆæœï¼š \u0026amp; \u0026amp; ç¬¦å· \u0026lt; \u0026lt; å°äºå· \u0026gt; \u0026gt; å¤§äºå·\nğŸ’¡ å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸ’¡ 1. æ–‡æ¡£ç»“æ„å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æ–‡æ¡£æ ‡é¢˜ ## ç®€ä»‹ ç®€è¦ä»‹ç»æ–‡æ¡£å†…å®¹ ## å®‰è£… ### å‰ææ¡ä»¶ - æ¡ä»¶1 - æ¡ä»¶2 ### å®‰è£…æ­¥éª¤ 1. æ­¥éª¤ä¸€ 2. æ­¥éª¤äºŒ ## ä½¿ç”¨æ–¹æ³• ### åŸºæœ¬ç”¨æ³• ```ä»£ç ç¤ºä¾‹``` ### é«˜çº§ç”¨æ³• ```é«˜çº§ä»£ç ç¤ºä¾‹``` ## å¸¸è§é—®é¢˜ ### é—®é¢˜ä¸€ è§£å†³æ–¹æ¡ˆ ## å‚è€ƒé“¾æ¥ - [ç›¸å…³æ–‡æ¡£](é“¾æ¥) 2. æ’ç‰ˆå»ºè®® åœ¨æ ‡é¢˜å‰åç©ºä¸€è¡Œ åˆ—è¡¨é¡¹å‰åç©ºä¸€è¡Œ ä»£ç å—å‰åç©ºä¸€è¡Œ ä¿æŒä¸€è‡´çš„ç¼©è¿›é£æ ¼ ä½¿ç”¨é€‚å½“çš„æ ‡é¢˜å±‚çº§ç»“æ„ 3. å¯è¯»æ€§æŠ€å·§ ä½¿ç”¨è¡¨æ ¼æ•´ç†æ•°æ® ä½¿ç”¨åˆ—è¡¨åˆ†ç‚¹è¯´æ˜ é‡è¦å†…å®¹ä½¿ç”¨åŠ ç²—æˆ–é«˜äº® ä»£ç ç¤ºä¾‹ä½¿ç”¨è¯­æ³•é«˜äº® 4. å…¼å®¹æ€§æç¤º âš ï¸ æ³¨æ„ï¼šæŸäº› Markdown æ‰©å±•è¯­æ³•ï¼ˆå¦‚é¢œè‰²æ–‡æœ¬ã€å•é€‰æŒ‰é’®ç­‰ï¼‰å¯èƒ½åœ¨æŸäº›å¹³å°ä¸Šä¸è¢«æ”¯æŒã€‚åœ¨ä½¿ç”¨å‰è¯·ç¡®è®¤ç›®æ ‡å¹³å°çš„æ”¯æŒæƒ…å†µã€‚\n5. ç‰ˆæœ¬æ§åˆ¶å‹å¥½ Markdown æ˜¯çº¯æ–‡æœ¬æ ¼å¼ï¼Œéå¸¸é€‚åˆç‰ˆæœ¬æ§åˆ¶ ä½¿ç”¨æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯ ä¿æŒè¡Œé•¿åº¦é€‚ä¸­ï¼ˆå»ºè®® 80-100 å­—ç¬¦ï¼‰ ğŸ› ï¸ å·¥å…·æ¨è ğŸ› ï¸ 1. åœ¨çº¿ç¼–è¾‘å™¨ StackEdit - åŠŸèƒ½ä¸°å¯Œçš„åœ¨çº¿ Markdown ç¼–è¾‘å™¨ Dillinger - ä¼˜é›…çš„åœ¨çº¿ Markdown ç¼–è¾‘å™¨ Markdown Live Preview - å®æ—¶é¢„è§ˆ Markdown æ•ˆæœ 2. æ¡Œé¢åº”ç”¨ Typora - ä¼˜é›…çš„ Markdown ç¼–è¾‘å™¨ï¼Œæ‰€è§å³æ‰€å¾— VS Code - å¸¦æœ‰å¼ºå¤§ Markdown æ”¯æŒçš„ä»£ç ç¼–è¾‘å™¨ Obsidian - åŸºäº Markdown çš„çŸ¥è¯†ç®¡ç†å·¥å…· MarkText - ç®€å•è€Œä¼˜é›…çš„å¼€æº Markdown ç¼–è¾‘å™¨ 3. æµè§ˆå™¨æ’ä»¶ Markdown Viewer - åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ Markdown æ–‡ä»¶ Markdown Here - åœ¨é‚®ç®±ä¸­æ¸²æŸ“ Markdown Markdown Preview Plus - å¢å¼ºçš„ Markdown é¢„è§ˆåŠŸèƒ½ 4. å‘½ä»¤è¡Œå·¥å…· Pandoc - æ–‡æ¡£æ ¼å¼è½¬æ¢å·¥å…·ï¼Œæ”¯æŒ Markdown Remark - å¼ºå¤§çš„ Markdown å¤„ç†å·¥å…· Grip - æœ¬åœ° GitHubé£æ ¼çš„ Markdown é¢„è§ˆ 5. å…¶ä»–å·¥å…· Markdown Table Generator - åœ¨çº¿è¡¨æ ¼ç”Ÿæˆå™¨ TableConvert - è¡¨æ ¼è½¬æ¢å·¥å…· Carbon - åˆ›å»ºæ¼‚äº®çš„ä»£ç æˆªå›¾ é€šè¿‡æŒæ¡è¿™äº› Markdown è¯­æ³•å’ŒæŠ€å·§ï¼Œæ‚¨å¯ä»¥è½»æ¾åˆ›å»ºç¾è§‚ã€ç»“æ„æ¸…æ™°çš„æ–‡æ¡£ï¼è®°å¾—å¤šåŠ ç»ƒä¹ ï¼Œç†Ÿèƒ½ç”Ÿå·§å“¦ï¼ğŸ˜Š\nğŸ’¡ æç¤ºï¼šä¸åŒçš„ Markdown è§£æå™¨å¯èƒ½æ”¯æŒä¸åŒçš„æ‰©å±•è¯­æ³•ï¼Œå»ºè®®åœ¨ä½¿ç”¨å‰æŸ¥çœ‹ç›®æ ‡å¹³å°çš„æ–‡æ¡£ä»¥äº†è§£å…¶æ”¯æŒçš„è¯­æ³•ç‰¹æ€§ã€‚\nè¿™æ˜¯è„šæ³¨çš„å†…å®¹ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-12-07T09:44:08+08:00","image":"https://file.meimolihan.eu.org/img/markdown-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5d509762/","title":"Markdown å¸¸ç”¨è¯­æ³•å¤§å…¨ğŸ“"},{"content":"Docker éƒ¨ç½² Nascab æ–‡ä»¶ç®¡ç†å™¨ ğŸ—‚ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nascab 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Nascab 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ—‚ï¸ å¯èˆªæ–‡ä»¶ï¼Œç®¡ç†æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Nascab å®˜ç½‘åœ°å€ï¼š https://www.nascab.cn ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/nascab/nascab-releases ğŸ± Gitee é¡¹ç›®åœ°å€ï¼š https://gitee.com/nascab/nascab-releases-gitee ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/ypptec/nascab Nascab æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œæä¾›ç›´è§‚çš„ Web ç•Œé¢æ¥ç®¡ç†æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚å®ƒæ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€ç¼–è¾‘ã€å‹ç¼©ã€è§£å‹ç¼©ç­‰å¤šç§æ“ä½œï¼Œæ˜¯æœåŠ¡å™¨æ–‡ä»¶ç®¡ç†çš„ç†æƒ³å·¥å…·ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“ æ–‡ä»¶ç®¡ç† ä¸Šä¼ ã€ä¸‹è½½ã€é‡å‘½åã€ç§»åŠ¨ã€å¤åˆ¶ã€åˆ é™¤æ–‡ä»¶ å®Œæ•´çš„æ–‡ä»¶æ“ä½œåŠŸèƒ½ï¼Œæ— éœ€å‘½ä»¤è¡Œ ğŸ“‚ ç›®å½•æ“ä½œ åˆ›å»ºã€åˆ é™¤ã€é‡å‘½åç›®å½• ç›´è§‚çš„ç›®å½•ç®¡ç†ç•Œé¢ ğŸ“ æ–‡æœ¬ç¼–è¾‘ å†…ç½®æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒä»£ç é«˜äº® ç›´æ¥åœ¨çº¿ç¼–è¾‘æ–‡ä»¶å†…å®¹ ğŸ—œï¸ å‹ç¼©è§£å‹ æ”¯æŒ ZIPã€TARã€GZIP ç­‰æ ¼å¼ æ— éœ€é¢å¤–å·¥å…·å¤„ç†å‹ç¼©æ–‡ä»¶ ğŸ” æ–‡ä»¶æœç´¢ å¿«é€Ÿæœç´¢æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ å¿«é€Ÿå®šä½æ‰€éœ€æ–‡ä»¶ ğŸ‘¥ ç”¨æˆ·ç®¡ç† å¤šç”¨æˆ·æ”¯æŒå’Œæƒé™æ§åˆ¶ å®‰å…¨çš„è®¿é—®æ§åˆ¶æœºåˆ¶ ğŸŒ è¿œç¨‹è®¿é—® é€šè¿‡ Web ç•Œé¢éšæ—¶éšåœ°è®¿é—®æ–‡ä»¶ æ–¹ä¾¿è¿œç¨‹æ–‡ä»¶ç®¡ç† ğŸ³ ä¸€ã€Docker éƒ¨ç½² Nascab 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 mkdir -p /mnt/mydisk/home/nascab \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: nascab: container_name: nascab image: ypptec/nascab:3.5.3-x64 restart: unless-stopped ports: - \u0026#34;5388:80\u0026#34; # Web ç•Œé¢ç«¯å£ - \u0026#34;5343:443\u0026#34; # HTTPS ç«¯å£ - \u0026#34;5390:90\u0026#34; # ç®¡ç†ç«¯å£ - \u0026#34;5321:21\u0026#34; # FTP ç«¯å£ volumes: - ./config:/root/.local/share/nascab # é…ç½®æ–‡ä»¶ç›®å½• - /mnt:/mnt # æŒ‚è½½ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ environment: - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® EOF ğŸ” é»˜è®¤ç™»å½•ä¿¡æ¯ï¼š\nç”¨æˆ·å: mobufan\nâš ï¸ é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ä¸ºå¼ºå¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Nascab 1. è®¿é—® Web ç•Œé¢ ğŸ’» ç®¡ç†ç•Œé¢: http://ä½ çš„æœåŠ¡å™¨IP:5388 HTTPS è®¿é—®: https://ä½ çš„æœåŠ¡å™¨IP:5343 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—® http://ä½ çš„æœåŠ¡å™¨IP:5388 ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼š ç”¨æˆ·åï¼šmobufan å¯†ç ï¼šæŒ‰ç…§æç¤ºè®¾ç½®å¼ºå¯†ç  é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç  å¼€å§‹ç®¡ç†æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/nascab # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop nascab # åœæ­¢å®¹å™¨ docker start nascab # å¯åŠ¨å®¹å™¨ docker restart nascab # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it nascab sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs nascab # æŸ¥çœ‹æ—¥å¿— docker logs -f nascab # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 nascab # æŸ¥çœ‹æœ€å100è¡Œ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi ypptec/nascab:3.5.3-x64 # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ’¡ ä½¿ç”¨æç¤ºä¸æœ€ä½³å®è·µ ğŸ” å®‰å…¨ç¬¬ä¸€: é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  ğŸ“ æƒé™ç®¡ç†: åˆç†è®¾ç½®æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼Œé¿å…å®‰å…¨é£é™© ğŸ’¾ å®šæœŸå¤‡ä»½: ç¡®ä¿å®šæœŸå¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ ğŸ”„ æ›´æ–°ç»´æŠ¤: ä¿æŒå®¹å™¨é•œåƒå’Œç³»ç»Ÿæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ ğŸ“Š ç›‘æ§ä½¿ç”¨: å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å’Œèµ„æºä½¿ç”¨æƒ…å†µ ğŸ—‚ï¸ å¯èˆªæ–‡ä»¶ï¼Œç®¡ç†æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Nascab æ–‡ä»¶ç®¡ç†å™¨ï¼ŒæŒæ¡äº†é€šè¿‡ Web ç•Œé¢é«˜æ•ˆç®¡ç†æœåŠ¡å™¨æ–‡ä»¶çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“ ç›´è§‚ç®¡ç† é€šè¿‡ç¾è§‚çš„ Web ç•Œé¢è½»æ¾ç®¡ç†æ–‡ä»¶ï¼Œå‘Šåˆ«å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œ\nğŸŒ å¤šç«¯è®¿é—® éšæ—¶éšåœ°é€šè¿‡æµè§ˆå™¨è®¿é—®å’Œç®¡ç†ä½ çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰“ç ´è®¾å¤‡é™åˆ¶\nğŸ”’ å®‰å…¨å¯æ§ æœ¬åœ°åŒ–éƒ¨ç½²ç¡®ä¿ä½ çš„æ–‡ä»¶æ•°æ®å®Œå…¨è‡ªä¸»æŒæ§ï¼Œéšç§å®‰å…¨æ— å¿§\nâš¡ é«˜æ•ˆæ“ä½œ äº«å—æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€ç¼–è¾‘ã€å‹ç¼©ç­‰ä¸€ç«™å¼æœåŠ¡ï¼Œæå‡å·¥ä½œæ•ˆç‡\næ–‡ä»¶ç®¡ç†ä¸ä»…æ˜¯æŠ€æœ¯éœ€æ±‚ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„åŸºç¡€ä¿éšœã€‚æ„¿ Nascab æˆä¸ºä½ æ–‡ä»¶ç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ï¼Œè®©æ¯ä¸€æ¬¡æ–‡ä»¶æ“ä½œéƒ½å˜å¾—ç®€å•ã€é«˜æ•ˆã€æ„‰æ‚¦ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç”¨ Nascab è½»æ¾ç®¡ç†ä½ çš„æ–‡ä»¶ä¸–ç•Œï¼Œäº«å—æ•´æ´æœ‰åºçš„æ•°å­—ç”Ÿæ´»ï¼âœ¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Nascab å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€å®˜æ–¹æ¸ é“æˆ–ç¤¾åŒºè®ºå›æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œæ–‡ä»¶ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼ğŸ‰\n","date":"2024-12-07T09:43:10+08:00","image":"https://file.meimolihan.eu.org/img/nascab-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b247e6d8/","title":"Docker éƒ¨ç½² Nascab æ–‡ä»¶ç®¡ç†å™¨ ğŸ—‚ï¸"},{"content":"Docker éƒ¨ç½² Kodbox å¯é“äº‘æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ ğŸ—‚ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Kodbox 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Kodbox 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ–‡ä»¶ï¼Œç®¡ç†æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Kodbox å®˜ç½‘åœ°å€ï¼š https://kodcloud.com/ ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/kodcloud/kodbox Kodbox æ˜¯ä¸€æ¬¾åŸºäº Web çš„ç°ä»£åŒ–æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæä¾›ç±»ä¼¼ Windows æ“ä½œç•Œé¢çš„åœ¨çº¿æ–‡ä»¶ç®¡ç†ä½“éªŒã€‚å®ƒæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼Œå…·æœ‰ä¸°å¯Œçš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼Œæ˜¯ä¼ä¸šå’Œä¸ªäººæ–‡ä»¶ç®¡ç†çš„ç†æƒ³é€‰æ‹©ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ–¥ï¸ ç›´è§‚ç•Œé¢ ç±»Windowsæ“ä½œç•Œé¢ ç”¨æˆ·å‹å¥½ï¼Œä¸Šæ‰‹ç®€å• ğŸ“ æ–‡ä»¶ç®¡ç† å®Œæ•´çš„ä¸Šä¼ ã€ä¸‹è½½ã€åˆ†äº«ã€é¢„è§ˆåŠŸèƒ½ ä¸€ç«™å¼æ–‡ä»¶ç®¡ç†è§£å†³æ–¹æ¡ˆ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ å¤šç”¨æˆ·ç³»ç»Ÿå’Œæƒé™ç®¡ç† é€‚åˆå›¢é˜Ÿåä½œä½¿ç”¨ ğŸ“„ åœ¨çº¿ç¼–è¾‘ æ”¯æŒæ–‡æ¡£åœ¨çº¿ç¼–è¾‘å’Œé¢„è§ˆ æ— éœ€ä¸‹è½½å³å¯å¤„ç†æ–‡ä»¶ ğŸ”Œ æ’ä»¶æ‰©å±• ä¸°å¯Œçš„æ’ä»¶æ‰©å±•ç³»ç»Ÿ åŠŸèƒ½å¯å®šåˆ¶å’Œæ‰©å±• ğŸ“± ç§»åŠ¨é€‚é… ç§»åŠ¨ç«¯å‹å¥½ç•Œé¢ éšæ—¶éšåœ°è®¿é—®æ–‡ä»¶ â˜ï¸ å¤šå­˜å‚¨æ”¯æŒ æ”¯æŒå¤šç§äº‘å­˜å‚¨å’Œæœ¬åœ°å­˜å‚¨ çµæ´»çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Kodbox 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/kodbox \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: kodbox: container_name: kodbox image: kodcloud/kodbox restart: always network_mode: bridge ports: - \u0026#34;5366:80\u0026#34; volumes: - ./config:/var/www/html - /mnt:/data environment: - TZ=Asia/Shanghai EOF ğŸ“ åˆå§‹ç®¡ç†å‘˜è´¦æˆ·ï¼šé¦–æ¬¡è®¿é—®æ—¶ä¼šæç¤ºè®¾ç½®ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç \n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Kodbox 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:5366 å±€åŸŸç½‘è®¿é—®ï¼š http://10.10.10.245:5366 åŸŸåè®¿é—®ï¼š https://kodbox.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŒ‰ç…§é¡µé¢æç¤ºå®Œæˆåˆå§‹è®¾ç½® è®¾ç½®ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç  é…ç½®å­˜å‚¨è·¯å¾„å’Œå…¶ä»–é€‰é¡¹ å¼€å§‹ä½¿ç”¨ Kodbox ç®¡ç†æ‚¨çš„æ–‡ä»¶ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://kodbox.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/kodbox.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name kodbox.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name kodbox.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 20G; location / { proxy_pass http://127.0.0.1:5366; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; proxy_connect_timeout 300s; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; proxy_pass http://127.0.0.1:5366; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ–‡ä»¶ï¼Œç®¡ç†æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Kodbox å¯é“äº‘æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° è®¿é—®å’Œç®¡ç†ä½ çš„æ–‡ä»¶èµ„äº§ï¼Œæ— è®ºæ˜¯ä¸ªäººæ–‡æ¡£è¿˜æ˜¯å›¢é˜Ÿèµ„æº\nğŸ” å®‰å…¨å¯é  äº«å—ä¼ä¸šçº§çš„æ•°æ®ä¿æŠ¤ï¼Œå¤šé‡å¤‡ä»½æœºåˆ¶ä¿éšœæ–‡ä»¶å®‰å…¨\nğŸ‘¥ é«˜æ•ˆåä½œ ä¸å›¢é˜Ÿæˆå‘˜å…±äº«æ–‡ä»¶ã€ååŒç¼–è¾‘ï¼Œæå‡å·¥ä½œæ•ˆç‡\nğŸ“± å¤šç«¯åŒæ­¥ åœ¨ç”µè„‘ã€æ‰‹æœºã€å¹³æ¿ä¸Šæ— ç¼åˆ‡æ¢ï¼Œç•…äº«ä¸€è‡´çš„ä½¿ç”¨ä½“éªŒ\næ–‡ä»¶ç®¡ç†ï¼Œæ˜¯ç°ä»£æ•°å­—ç”Ÿæ´»çš„åŸºç¡€ã€‚æ„¿ Kodbox æˆä¸ºä½ å¾—åŠ›çš„æ•°å­—æ–‡ä»¶ç®¡å®¶ï¼Œé™ªä¼´ä½ æ•´ç†æ¯ä¸€ä»½é‡è¦æ–‡æ¡£ï¼Œå®ˆæŠ¤æ¯ä¸€ä¸ªåˆ›æ„æˆæœã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæœ‰åºç®¡ç†ï¼Œé«˜æ•ˆåä½œâ€”â€”æ„å»ºä½ ä¸“å±çš„æ•°å­—æ–‡ä»¶åº“å§ï¼ğŸ—ƒï¸\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Kodbox å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ å®˜æ–¹è®ºå› äº¤æµè®¨è®ºã€‚\nç¥ä½ æ–‡ä»¶ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼Œåä½œæ— å¿§ï¼ğŸ‰\n","date":"2024-12-07T09:42:13+08:00","image":"https://file.meimolihan.eu.org/img/kodbox-01.webp","permalink":"https://blog.meimolihan.eu.org/p/97cb6736/","title":"Docker éƒ¨ç½² Kodbox å¯é“äº‘æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ ğŸ—‚ï¸"},{"content":"Typecho åšå®¢ç¾åŒ–ä¸åŠŸèƒ½å¢å¼º ğŸ¨ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç» Typecho åšå®¢ç³»ç»Ÿçš„ä¸»é¢˜å®‰è£…ã€åå°ç¾åŒ–ã€æ’ä»¶é…ç½®ç­‰å®Œæ•´æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨æ‰“é€ ä¸ªæ€§åŒ–ä¸”åŠŸèƒ½å¼ºå¤§çš„åšå®¢å¹³å°ã€‚\nâœ¨ ç›®å½• âœ¨ Typecho èµ„æºåº“ ğŸ­ ä¸€ã€å‰å°ä¸»é¢˜é…ç½® ğŸ–¥ï¸ äºŒã€åå°ä¸»é¢˜ç¾åŒ– ğŸ¯ ä¸‰ã€JKAdmin åå°ä¸»é¢˜ ğŸ”Œ å››ã€åŠŸèƒ½æ’ä»¶é…ç½® ğŸ› ï¸ äº”ã€å®‰è£…ä¸é…ç½®æŒ‡å— âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ ğŸ’¡ ä¸ƒã€ä¼˜åŒ–å»ºè®® âœ¨ Typecho èµ„æºåº“ å®˜æ–¹ä¸ç¬¬ä¸‰æ–¹èµ„æºç«™ ğŸŒ å®˜æ–¹ä¸»é¢˜æ’ä»¶åº“ï¼š https://typechx.com/themes ğŸ”§ ç¬¬ä¸‰æ–¹èµ„æºç«™1ï¼š https://typecho.work/index.php ğŸ¨ ç¬¬ä¸‰æ–¹èµ„æºç«™2ï¼š https://www.boke8.net/tetheme ğŸ™ GitHub æ’ä»¶åº“ï¼š https://github.com/typecho-fans/plugins ğŸ­ ä¸€ã€å‰å°ä¸»é¢˜é…ç½® ä¸»é¢˜å®‰è£…è·¯å¾„ 1 2 3 4 5 # è¿›å…¥ Typecho ä¸»é¢˜ç›®å½• cd /mnt/mydisk/home/typecho/typecho/usr/themes # æˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„ cd /www/wwwroot/your-domain.com/usr/themes æ¨èä¸»é¢˜ä¸‹è½½ ğŸ¦‹ Butterfly ä¸»é¢˜ï¼š GitHubä¸‹è½½åœ°å€ ğŸŒŸ Lanstar ä¸»é¢˜ï¼š GitHubä¸‹è½½åœ°å€ ğŸš€ Material ä¸»é¢˜ï¼š å®˜æ–¹ä¸»é¢˜åº“ ğŸŒ™ DarkMode ä¸»é¢˜ï¼š ç¬¬ä¸‰æ–¹èµ„æºç«™ å®‰è£…æ­¥éª¤ ä¸‹è½½ä¸»é¢˜å‹ç¼©åŒ… ğŸ“¦\n1 2 wget https://github.com/wehaox/Typecho-Butterfly/archive/refs/heads/main.zip unzip main.zip è§£å‹åˆ° themes ç›®å½• ğŸ“\n1 2 mv Typecho-Butterfly-main butterfly chmod -R 755 butterfly åœ¨ Typecho åå°å¯ç”¨ä¸»é¢˜ âš™ï¸\nç™»å½• Typecho åå° è¿›å…¥\u0026quot;æ§åˆ¶å°\u0026quot; â†’ \u0026ldquo;å¤–è§‚\u0026rdquo; é€‰æ‹©æ–°å®‰è£…çš„ä¸»é¢˜å¹¶ç‚¹å‡»\u0026quot;å¯ç”¨\u0026quot; é…ç½®ä¸»é¢˜é€‰é¡¹ ğŸ›ï¸\næ ¹æ®ä¸»é¢˜è¯´æ˜æ–‡æ¡£è¿›è¡Œä¸ªæ€§åŒ–é…ç½® è®¾ç½®é¢œè‰²æ–¹æ¡ˆã€å¸ƒå±€é€‰é¡¹ã€ç¤¾äº¤é“¾æ¥ç­‰ ä¸»é¢˜é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 // ä¸»é¢˜é…ç½®æ–‡ä»¶ç¤ºä¾‹ (config.php) return array( \u0026#39;title\u0026#39; =\u0026gt; \u0026#39;æˆ‘çš„åšå®¢\u0026#39;, \u0026#39;description\u0026#39; =\u0026gt; \u0026#39;è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Typechoçš„åšå®¢\u0026#39;, \u0026#39;keywords\u0026#39; =\u0026gt; \u0026#39;åšå®¢,Typecho,PHP\u0026#39;, \u0026#39;themeColor\u0026#39; =\u0026gt; \u0026#39;#3498db\u0026#39;, \u0026#39;darkMode\u0026#39; =\u0026gt; true, \u0026#39;socialLinks\u0026#39; =\u0026gt; array( \u0026#39;github\u0026#39; =\u0026gt; \u0026#39;https://github.com/yourname\u0026#39;, \u0026#39;twitter\u0026#39; =\u0026gt; \u0026#39;https://twitter.com/yourname\u0026#39; ) ); ğŸ–¥ï¸ äºŒã€åå°ä¸»é¢˜ç¾åŒ– åå°ä¸»é¢˜è·¯å¾„ 1 2 3 4 5 # è¿›å…¥ Typecho åå°ç›®å½• cd /mnt/mydisk/home/typecho/typecho/admin # å¤‡ä»½åŸadminç›®å½•ï¼ˆé‡è¦ï¼ï¼‰ cp -r admin admin-backup 1. Fresh åå°ä¸»é¢˜ ä¸‹è½½åœ°å€ï¼š è“å¥äº‘ä¸‹è½½ å®‰è£…æ–¹æ³•ï¼š\nåˆ é™¤åŸ admin æ–‡ä»¶å¤¹\n1 rm -rf admin æ–°å»º admin æ–‡ä»¶å¤¹å¹¶è§£å‹æ–‡ä»¶\n1 2 mkdir admin unzip fresh-admin.zip -d admin/ ç§»åŠ¨ Menu.php åˆ°æ­£ç¡®ä½ç½®\n1 cp admin/Menu.php ../var/Widget/ æ¸…ç†æµè§ˆå™¨ç¼“å­˜ ğŸ§¹\næŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œæ•°æ® 2. Lanstar åå°ä¸»é¢˜ ä¸‹è½½åœ°å€ï¼š GitHub Releases å®‰è£…æ–¹æ³•ï¼š\n1 2 3 4 5 # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ wget https://github.com/dyedd/lanstar/releases/download/v1.0.0/lanstar-admin.zip # è§£å‹å¹¶å®‰è£… unzip lanstar-admin.zip -d admin/ 3. Admin-dzh åå°ä¸»é¢˜ ä¸‹è½½åœ°å€ï¼š GitHubä»“åº“ å®˜æ–¹æ–‡æ¡£ï¼š ä½¿ç”¨è¯´æ˜ å®‰è£…æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 # 1. ä¸‹è½½ä¸»é¢˜ wget https://github.com/zanedeng/typecho-admin-dzh/archive/refs/heads/main.zip # 2. è§£å‹å¹¶é‡å‘½å unzip main.zip mv typecho-admin-dzh-main admin # 3. è®¾ç½®æƒé™ chmod -R 755 admin chown -R www:www admin ğŸ¯ ä¸‰ã€JKAdmin åå°ä¸»é¢˜ï¼ˆé«˜çº§ï¼‰ ä¸‹è½½ä¿¡æ¯ å®˜æ–¹åœ°å€ï¼š 3si.techå•†åº— ç½‘ç›˜ä¸‹è½½ï¼š è“å¥äº‘ä¸‹è½½ å¯†ç : cptp è´¦æˆ·ä¿¡æ¯ ç”¨æˆ·å: mobufan å¯†ç : å°å­©ååŠ ç”Ÿï¼ˆå…¨å°å†™ï¼‰ é‚®ç®±: 496338740@qq.com QQ: 496338740 å®‰è£…æ­¥éª¤ 1 2 3 4 5 # 1. è§£å‹ä¸»é¢˜åˆ°Typechoæ ¹ç›®å½• unzip jkadmin.zip -d /mnt/mydisk/home/typecho/typecho/ # 2. ä¿®æ”¹ config.inc.php é…ç½® nano /mnt/mydisk/home/typecho/typecho/config.inc.php æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š\n1 2 3 4 5 6 7 8 // å®šä¹‰åå°ç›®å½• define(\u0026#39;__TYPECHO_ADMIN_DIR__\u0026#39;, \u0026#39;/jkadmin/\u0026#39;); // ä¿®æ”¹Gravatarå¤´åƒæº define(\u0026#39;__TYPECHO_GRAVATAR_PREFIX__\u0026#39;, \u0026#39;https://cravatar.cn/avatar/\u0026#39;); // å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼ˆå¯é€‰ï¼‰ define(\u0026#39;__TYPECHO_DEBUG__\u0026#39;, true); 1 2 # 3. æ›¿æ¢ Widget ç»„ä»¶ unzip Widget.zip -d /mnt/mydisk/home/typecho/typecho/var/Typecho/ è‡ªå®šä¹‰é…ç½® 1 2 # åˆ›å»ºè‡ªå®šä¹‰CSSæ–‡ä»¶ nano /mnt/mydisk/home/typecho/typecho/jkadmin/assets/css/custom.css æ·»åŠ è‡ªå®šä¹‰æ ·å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* è‡ªå®šä¹‰åå°æ ·å¼ */ :root { --primary-color: #3498db; --secondary-color: #2ecc71; --text-color: #333; --background-color: #f8f9fa; } /* æš—è‰²æ¨¡å¼æ”¯æŒ */ [data-theme=\u0026#34;dark\u0026#34;] { --text-color: #f1f1f1; --background-color: #1a1a1a; } /* å“åº”å¼è°ƒæ•´ */ @media (max-width: 768px) { .admin-container { padding: 10px; } } ğŸ”Œ å››ã€åŠŸèƒ½æ’ä»¶é…ç½® æ’ä»¶å®‰è£…è·¯å¾„ 1 cd /mnt/mydisk/home/typecho/typecho/usr/plugins 1. CodeHighlighter ä»£ç é«˜äº® ä¸‹è½½åœ°å€ï¼š å®˜æ–¹æ’ä»¶é¡µ å®‰è£…æ–¹æ³•ï¼š\n1 2 3 wget https://typechx.com/download/CodeHighlighter.zip unzip CodeHighlighter.zip mv CodeHighlighter-master CodeHighlighter é…ç½®ç¤ºä¾‹ï¼š\n1 2 3 4 5 // åœ¨æ–‡ç« ä¸­ä½¿ç”¨ä»£ç é«˜äº® ```python def hello_world(): print(\u0026#34;Hello, World!\u0026#34;) return True 1 2 3 4 5 6 7 8 ### 2. SimpleAdmin åå°ç¾åŒ– **ä¸‹è½½åœ°å€**ï¼š[GitHubä»“åº“](https://github.com/gogobody/SimpleAdmin) **å®‰è£…æ–¹æ³•**ï¼š ```bash git clone https://github.com/gogobody/SimpleAdmin.git mv SimpleAdmin SimpleAdmin # ç¡®ä¿åç§°æ­£ç¡® è‡ªå®šä¹‰CSSé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 :root, [data-color-mode=\u0026#34;dark\u0026#34;] { color-scheme: dark !important; --background: #191919 !important; --backgroundA: #212121 !important; --text-primary: #e0e0e0 !important; --text-secondary: #a0a0a0 !important; --accent-color: #3498db !important; } /* å·¦ä¾§æ å¤´åƒè®¾ç½® */ .admin-sidebar .avatar { background-image: url(\u0026#39;https://blog.mobufan.eu.org:666/mobufan/mobufan-02.jpg\u0026#39;); } 3. AliceStyle å…¨é¢ç¾åŒ– ä¸‹è½½åœ°å€ï¼š GitHubä»“åº“ ç‰¹ç‚¹ï¼š\nğŸ“± å“åº”å¼è®¾è®¡ ğŸŒ™ æš—è‰²/äº®è‰²ä¸»é¢˜åˆ‡æ¢ âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ¨ é«˜åº¦å¯å®šåˆ¶ 4. Update æ›´æ–°æ’ä»¶ ä¸‹è½½åœ°å€ï¼š å®˜æ–¹é¡µé¢ åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸ”„ ä¸€é”®æ›´æ–°Typechoæ ¸å¿ƒ ğŸ“¦ æ’ä»¶å’Œä¸»é¢˜æ›´æ–°ç®¡ç† ğŸ“Š æ›´æ–°å†å²è®°å½• ğŸ”’ å®‰å…¨å¤‡ä»½åŠŸèƒ½ 5. TagSelector æ ‡ç­¾é€‰æ‹© ä¸‹è½½åœ°å€ï¼š å®˜æ–¹æ’ä»¶é¡µ å®‰è£…æ–¹æ³•ï¼š\n1 2 wget https://typechx.com/download/TagSelector.zip unzip TagSelector.zip åŠŸèƒ½ç‰¹ç‚¹ï¼š\nğŸ” å®æ—¶æ ‡ç­¾æœç´¢ ğŸ·ï¸ ç°æœ‰æ ‡ç­¾é€‰æ‹© ğŸ“ æ–°æ ‡ç­¾å¿«é€Ÿåˆ›å»º ğŸ¯ æ ‡ç­¾äº‘æ”¯æŒ 6. å…¶ä»–æ¨èæ’ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 # è¯„è®ºç›¸å…³æ’ä»¶ - CommentToMail: è¯„è®ºé‚®ä»¶é€šçŸ¥ - Smilies: è¡¨æƒ…åŒ…æ”¯æŒ # SEOä¼˜åŒ–æ’ä»¶ - Sitemap: ç”Ÿæˆç½‘ç«™åœ°å›¾ - SEO: æœç´¢å¼•æ“ä¼˜åŒ– # åŠŸèƒ½å¢å¼ºæ’ä»¶ - Links: å‹æƒ…é“¾æ¥ç®¡ç† - Backup: æ•°æ®å¤‡ä»½ - Stat: è®¿é—®ç»Ÿè®¡ ğŸ› ï¸ äº”ã€å®‰è£…ä¸é…ç½®æŒ‡å— é€šç”¨å®‰è£…æ­¥éª¤ ä¸‹è½½èµ„æº â¬‡ï¸\n1 2 3 4 5 # ä½¿ç”¨wgetä¸‹è½½ wget [ä¸‹è½½é“¾æ¥] # æˆ–ä½¿ç”¨curl curl -O [ä¸‹è½½é“¾æ¥] ä¸Šä¼ æ–‡ä»¶ ğŸ“¤\n1 2 3 4 5 # è§£å‹å‹ç¼©åŒ… unzip [æ–‡ä»¶å].zip # æˆ–è§£å‹tar.gz tar -zxvf [æ–‡ä»¶å].tar.gz è®¾ç½®æƒé™ ğŸ”’\n1 2 3 4 5 6 7 8 9 10 # è®¾ç½®ç›®å½•æƒé™ find /mnt/mydisk/home/typecho/ -type d -exec chmod 755 {} \\; # è®¾ç½®æ–‡ä»¶æƒé™ find /mnt/mydisk/home/typecho/ -type f -exec chmod 644 {} \\; # ç‰¹æ®Šç›®å½•æƒé™ chmod 777 /mnt/mydisk/home/typecho/typecho/usr/themes chmod 777 /mnt/mydisk/home/typecho/typecho/usr/plugins chmod 777 /mnt/mydisk/home/typecho/typecho/usr/uploads å¯ç”¨åŠŸèƒ½ âš¡\nç™»å½•Typechoåå° è¿›å…¥\u0026quot;æ§åˆ¶å°\u0026quot; â†’ \u0026ldquo;æ’ä»¶\u0026rdquo; æˆ– \u0026ldquo;å¤–è§‚\u0026rdquo; å¯ç”¨æ–°å®‰è£…çš„æ’ä»¶æˆ–ä¸»é¢˜ é…ç½®é€‰é¡¹ ğŸ›ï¸\næ ¹æ®æ–‡æ¡£è¿›è¡Œä¸ªæ€§åŒ–é…ç½® æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤ 1 2 3 4 5 # å¤‡ä»½æ•°æ®åº“ mysqldump -u [ç”¨æˆ·å] -p[å¯†ç ] [æ•°æ®åº“å] \u0026gt; backup.sql # æ¢å¤æ•°æ®åº“ mysql -u [ç”¨æˆ·å] -p[å¯†ç ] [æ•°æ®åº“å] \u0026lt; backup.sql âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ 1. å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ”’ 1 2 3 4 5 6 # å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œæ’ä»¶ cd /mnt/mydisk/home/typecho/typecho/ git pull origin master # å¦‚æœä½¿ç”¨gitå®‰è£… # ä¿®æ”¹é»˜è®¤åå°è·¯å¾„ï¼ˆå¢å¼ºå®‰å…¨æ€§ï¼‰ mv admin my-secret-admin 2. å…¼å®¹æ€§é—®é¢˜ âš ï¸ æ£€æŸ¥ä¸»é¢˜/æ’ä»¶ä¸Typechoç‰ˆæœ¬çš„å…¼å®¹æ€§ æµ‹è¯•åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„æ˜¾ç¤ºæ•ˆæœ éªŒè¯ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€ 3. æ€§èƒ½ä¼˜åŒ– ğŸš€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å¯ç”¨Gzipå‹ç¼© # åœ¨.htaccessä¸­æ·»åŠ ï¼š \u0026lt;IfModule mod_deflate.c\u0026gt; AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript \u0026lt;/IfModule\u0026gt; # è®¾ç½®ç¼“å­˜å¤´ \u0026lt;IfModule mod_expires.c\u0026gt; ExpiresActive On ExpiresByType image/jpg \u0026#34;access plus 1 month\u0026#34; ExpiresByType image/jpeg \u0026#34;access plus 1 month\u0026#34; ExpiresByType image/gif \u0026#34;access plus 1 month\u0026#34; ExpiresByType image/png \u0026#34;access plus 1 month\u0026#34; ExpiresByType text/css \u0026#34;access plus 1 month\u0026#34; ExpiresByType application/pdf \u0026#34;access plus 1 month\u0026#34; ExpiresByType text/javascript \u0026#34;access plus 1 month\u0026#34; ExpiresByType application/javascript \u0026#34;access plus 1 month\u0026#34; \u0026lt;/IfModule\u0026gt; 4. å¤‡ä»½ç­–ç•¥ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºè‡ªåŠ¨å¤‡ä»½è„šæœ¬ #!/bin/bash # backup-typecho.sh DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR=\u0026#34;/backups/typecho\u0026#34; # å¤‡ä»½æ–‡ä»¶ tar -czf $BACKUP_DIR/typecho-files-$DATE.tar.gz /mnt/mydisk/home/typecho/typecho/ # å¤‡ä»½æ•°æ®åº“ mysqldump -u root -p[password] typecho_db \u0026gt; $BACKUP_DIR/typecho-db-$DATE.sql # ä¿ç•™æœ€è¿‘7å¤©å¤‡ä»½ find $BACKUP_DIR -name \u0026#34;*.tar.gz\u0026#34; -type f -mtime +7 -delete find $BACKUP_DIR -name \u0026#34;*.sql\u0026#34; -type f -mtime +7 -delete ğŸ’¡ ä¸ƒã€ä¼˜åŒ–å»ºè®® 1. æ€§èƒ½ä¼˜åŒ– âš¡ 1 2 3 4 5 6 7 8 9 10 # å®‰è£…ç¼“å­˜æ’ä»¶ # Opcacheé…ç½®ï¼ˆphp.iniï¼‰ [opcache] opcache.enable=1 opcache.memory_consumption=128 opcache.max_accelerated_files=10000 opcache.revalidate_freq=300 # ä½¿ç”¨CDNåŠ é€Ÿ define(\u0026#39;__TYPECHO_CDN_PREFIX__\u0026#39;, \u0026#39;https://cdn.yourdomain.com/\u0026#39;); 2. SEOä¼˜åŒ– ğŸ” 1 2 3 4 5 6 7 8 9 \u0026lt;!-- åœ¨header.phpä¸­æ·»åŠ  --\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026lt;?php $this-\u0026gt;description(); ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;keywords\u0026#34; content=\u0026#34;\u0026lt;?php $this-\u0026gt;keywords(); ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;meta property=\u0026#34;og:title\u0026#34; content=\u0026#34;\u0026lt;?php $this-\u0026gt;title(); ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;meta property=\u0026#34;og:description\u0026#34; content=\u0026#34;\u0026lt;?php $this-\u0026gt;description(); ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;meta property=\u0026#34;og:image\u0026#34; content=\u0026#34;\u0026lt;?php // æ–‡ç« ç‰¹è‰²å›¾ç‰‡ ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;!-- ç”Ÿæˆsitemap --\u0026gt; # å¯ä»¥ä½¿ç”¨Sitemapæ’ä»¶è‡ªåŠ¨ç”Ÿæˆ 3. å®‰å…¨åŠ å›º ğŸ›¡ï¸ 1 2 # ä¿®æ”¹é…ç½®æ–‡ä»¶å¢å¼ºå®‰å…¨ nano /mnt/mydisk/home/typecho/typecho/config.inc.php æ·»åŠ å®‰å…¨é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 // ç¦æ­¢ç›´æ¥è®¿é—®æ•æ„Ÿæ–‡ä»¶ define(\u0026#39;__TYPECHO_DENY_ACCESS__\u0026#39;, true); // è®¾ç½®å®‰å…¨å¯†é’¥ define(\u0026#39;__TYPECHO_SECURE__\u0026#39;, true); // é™åˆ¶ç™»å½•å°è¯• define(\u0026#39;__TYPECHO_LOGIN_ATTEMPTS__\u0026#39;, 5); define(\u0026#39;__TYPECHO_LOGIN_LOCKTIME__\u0026#39;, 300); 4. ç§»åŠ¨ç«¯ä¼˜åŒ– ğŸ“± 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* å“åº”å¼è®¾è®¡è°ƒæ•´ */ @media screen and (max-width: 768px) { .container { width: 100%; padding: 10px; } .sidebar { display: none; } .menu-button { display: block; } } 5. ç¤¾äº¤åª’ä½“é›†æˆ ğŸŒ 1 2 3 4 5 6 7 8 9 // æ·»åŠ ç¤¾äº¤åˆ†äº«æŒ‰é’® function social_share_buttons($url, $title) { return \u0026#39; \u0026lt;div class=\u0026#34;social-share\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;https://twitter.com/share?url=\u0026#39;.$url.\u0026#39;\u0026amp;text=\u0026#39;.$title.\u0026#39;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Twitter\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;https://www.facebook.com/sharer/sharer.php?u=\u0026#39;.$url.\u0026#39;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Facebook\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;https://www.linkedin.com/shareArticle?url=\u0026#39;.$url.\u0026#39;\u0026amp;title=\u0026#39;.$title.\u0026#39;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;LinkedIn\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt;\u0026#39;; } ğŸ‰ å®Œæˆï¼ ç°åœ¨æ‚¨çš„ Typecho åšå®¢å·²ç»ç¾åŒ–å’ŒåŠŸèƒ½å¢å¼ºå®Œæ¯•ã€‚è®°å¾—å®šæœŸå¤‡ä»½å’Œæ›´æ–°ï¼Œä¿æŒåšå®¢çš„å®‰å…¨æ€§å’Œæœ€ä½³æ€§èƒ½ã€‚\nğŸ“š æ‰©å±•èµ„æº Typecho å®˜æ–¹æ–‡æ¡£ Typecho å¼€å‘æŒ‡å— Typecho ä¸»é¢˜å¼€å‘æ•™ç¨‹ Typecho ç¤¾åŒºè®ºå› â“ å¸¸è§é—®é¢˜è§£ç­” Q: å®‰è£…ä¸»é¢˜åç½‘ç«™å‡ºç°ç™½å±æ€ä¹ˆåŠï¼Ÿ A: æ£€æŸ¥PHPé”™è¯¯æ—¥å¿—ï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸»é¢˜æ–‡ä»¶æƒé™é—®é¢˜æˆ–PHPç‰ˆæœ¬ä¸å…¼å®¹ã€‚\nQ: å¦‚ä½•æ¢å¤é»˜è®¤ä¸»é¢˜ï¼Ÿ A: é€šè¿‡FTPå°†é»˜è®¤ä¸»é¢˜æ–‡ä»¶é‡æ–°ä¸Šä¼ ï¼Œæˆ–ä»å¤‡ä»½ä¸­æ¢å¤ã€‚\nQ: æ’ä»¶å†²çªå¦‚ä½•è§£å†³ï¼Ÿ A: ç¦ç”¨æ‰€æœ‰æ’ä»¶åé€ä¸ªå¯ç”¨ï¼Œæ‰¾åˆ°å†²çªçš„æ’ä»¶å¹¶å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚\nQ: å¦‚ä½•ä¼˜åŒ–Typechoæ•°æ®åº“ï¼Ÿ A: ä½¿ç”¨phpMyAdminä¼˜åŒ–è¡¨ï¼Œæˆ–å®‰è£…æ•°æ®åº“ä¼˜åŒ–æ’ä»¶ã€‚\nå¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ‰“é€ å‡ºæ—¢ç¾è§‚åˆåŠŸèƒ½å¼ºå¤§çš„ Typecho åšå®¢ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºäº¤æµã€‚ğŸŠ\n","date":"2024-12-07T09:41:20+08:00","image":"https://file.meimolihan.eu.org/img/typecho-02.webp","permalink":"https://blog.meimolihan.eu.org/p/5222b29b/","title":"Typecho åšå®¢ç¾åŒ–ä¸åŠŸèƒ½å¢å¼º ğŸ¨"},{"content":"Docker éƒ¨ç½² Webtop Alpine æ¡Œé¢ç¯å¢ƒ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Webtop Alpine 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè½»é‡æ¡Œé¢ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Webtop å®˜ç½‘åœ°å€ï¼š https://docs.linuxserver.io/images/docker-webtop ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/linuxserver/docker-webtop ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/linuxserver/webtop Webtop Alpine æ˜¯ä¸€ä¸ªåŸºäº Alpine Linux çš„è½»é‡çº§ Web æ¡Œé¢ç¯å¢ƒï¼Œé€šè¿‡æµè§ˆå™¨å³å¯è®¿é—®å®Œæ•´çš„æ¡Œé¢ç¯å¢ƒã€‚åŸºäº Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œèµ„æºå ç”¨ä½ï¼Œå¯åŠ¨å¿«é€Ÿï¼Œæä¾› XFCE æ¡Œé¢ç¯å¢ƒå’Œå¸¸ç”¨å·¥å…·ï¼Œé€‚åˆè¿œç¨‹åŠå…¬å’Œå¼€å‘ç¯å¢ƒã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ æµè§ˆå™¨è®¿é—® é€šè¿‡æµè§ˆå™¨å³å¯è®¿é—®å®Œæ•´çš„æ¡Œé¢ç¯å¢ƒ æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œè·¨å¹³å°ä½¿ç”¨ ğŸ§ è½»é‡é«˜æ•ˆ åŸºäº Alpine Linuxï¼Œèµ„æºå ç”¨æä½ èŠ‚çœæœåŠ¡å™¨èµ„æºï¼Œè¿è¡Œæµç•… ğŸ–¥ï¸ å®Œæ•´æ¡Œé¢ æä¾› XFCE æ¡Œé¢ç¯å¢ƒï¼Œæ”¯æŒå›¾å½¢åŒ–æ“ä½œ å®Œæ•´çš„æ¡Œé¢ä½“éªŒ ğŸ”§ å·¥å…·é½å…¨ å†…ç½®æ–‡ä»¶ç®¡ç†å™¨ã€ç»ˆç«¯ã€æµè§ˆå™¨ç­‰å¸¸ç”¨å·¥å…· å¼€ç®±å³ç”¨ï¼Œæ— éœ€é¢å¤–å®‰è£… ğŸ“ æ–‡ä»¶ç®¡ç† æ”¯æŒæœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ æ–¹ä¾¿çš„æ–‡ä»¶æ“ä½œä½“éªŒ ğŸŒ å¤šè¯­è¨€æ”¯æŒ æ”¯æŒä¸­æ–‡ç­‰å¤šå›½è¯­è¨€æ˜¾ç¤º å›½é™…åŒ–ä½¿ç”¨ä½“éªŒ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² åŸºäº Dockerï¼Œéƒ¨ç½²ç®€å•ï¼Œéš”ç¦»æ€§å¥½ å¿«é€Ÿéƒ¨ç½²ï¼Œç¯å¢ƒéš”ç¦» âš¡ å¿«é€Ÿå¯åŠ¨ ç§’çº§å¯åŠ¨ï¼Œéšæ—¶å¯ç”¨ å³æ—¶å¯ç”¨çš„æ¡Œé¢ç¯å¢ƒ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Webtop Alpine 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mkdir -p /mnt/mydisk/home/webtop \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: webtop: container_name: webtop image: lscr.io/linuxserver/webtop:alpine-xfce restart: unless-stopped ports: - \u0026#34;3000:3000\u0026#34; volumes: - ./config:/config environment: - PUID=1000 - PGID=1000 - TZ=Asia/Shanghai - TITLE=Webtop-Alpine EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:3000 IPè®¿é—®: http://æœåŠ¡å™¨IP:3000 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ åˆ›å»ºç”¨æˆ·åå’Œå¯†ç  ç™»å½•åå³å¯ä½¿ç”¨å®Œæ•´çš„ XFCE æ¡Œé¢ç¯å¢ƒ å¯æ ¹æ®éœ€è¦å®‰è£…é¢å¤–è½¯ä»¶å’Œé…ç½®æ¡Œé¢ç¯å¢ƒ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://webtop.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/webtop.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name webtop.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 2G; location / { proxy_pass http://127.0.0.1:3000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # è¶…æ—¶è®¾ç½®ï¼ˆè¿œç¨‹æ¡Œé¢éœ€è¦è¾ƒé•¿è¶…æ—¶ï¼‰ proxy_read_timeout 3600s; proxy_send_timeout 3600s; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/webtop # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop webtop docker start webtop docker restart webtop # åˆ é™¤å®¹å™¨ docker rm webtop docker rm -f webtop # è¿›å…¥å®¹å™¨Shell docker exec -it webtop sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect webtop docker stats webtop # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs webtop docker logs -f webtop docker logs --tail 100 webtop docker logs -t webtop 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi lscr.io/linuxserver/webtop:alpine-xfce docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªè½»é‡æ¡Œé¢ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Webtop Alpine æ¡Œé¢ç¯å¢ƒï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ–¥ï¸ éšæ—¶éšåœ° é€šè¿‡æµè§ˆå™¨è®¿é—®å®Œæ•´çš„æ¡Œé¢ç¯å¢ƒï¼Œæ— éœ€å®‰è£…ä»»ä½•å®¢æˆ·ç«¯ï¼Œæ‰“ç ´è®¾å¤‡å’Œåœ°ç‚¹é™åˆ¶\nâš¡ è½»é‡é«˜æ•ˆ åŸºäº Alpine Linux çš„æç®€è®¾è®¡ï¼Œèµ„æºå ç”¨æä½ï¼Œè¿è¡Œæµç•…å¿«é€Ÿ\nğŸ”§ å®Œå…¨è‡ªä¸» æŒæ§ä¸ªäººå·¥ä½œç¯å¢ƒï¼Œè‡ªå®šä¹‰è½¯ä»¶é…ç½®ï¼Œæ‰“é€ ä¸“å±çš„å¼€å‘æˆ–åŠå…¬å¹³å°\nğŸŒ è·¨å¹³å°å…¼å®¹ åœ¨ä»»ä½•æ”¯æŒæµè§ˆå™¨çš„è®¾å¤‡ä¸Šè·å¾—ä¸€è‡´çš„æ¡Œé¢ä½“éªŒï¼Œæ— ç¼åˆ‡æ¢å·¥ä½œç¯å¢ƒ\nè¿œç¨‹æ¡Œé¢æ˜¯æ•°å­—æ—¶ä»£çš„å·¥ä½œæ–°æ–¹å¼ï¼Œè½»é‡é«˜æ•ˆæ˜¯ç”Ÿäº§åŠ›æå‡çš„å…³é”®ã€‚æ„¿ Webtop Alpine æˆä¸ºä½ è¿œç¨‹å·¥ä½œå’Œå¼€å‘çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ éšæ—¶éšåœ°ä¿æŒé«˜æ•ˆå·¥ä½œçŠ¶æ€ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè¿æ¥ä¸–ç•Œï¼ŒæŒæ§æ¡Œé¢â€”â€”æ„å»ºä½ çµæ´»é«˜æ•ˆçš„è¿œç¨‹å·¥ä½œå°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Webtop é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œå·¥ä½œé«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T09:40:25+08:00","image":"https://file.meimolihan.eu.org/screenshot/docker-webtop-alpine-001.webp","permalink":"https://blog.meimolihan.eu.org/p/8466d16b/","title":"Docker éƒ¨ç½² Webtop Alpine æ¡Œé¢ç¯å¢ƒ ğŸ³"},{"content":"Typecho åšå®¢ç³»ç»Ÿå‡çº§å®Œå…¨æŒ‡å— ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº† Typecho åšå®¢ç³»ç»Ÿçš„å‡çº§æµç¨‹ï¼Œå¸®åŠ©æ‚¨å®‰å…¨ã€é¡ºåˆ©åœ°å®Œæˆç³»ç»Ÿæ›´æ–°ï¼Œè·å¾—æ›´å¥½çš„æ€§èƒ½å’Œæ–°åŠŸèƒ½ï¼âœ¨\nğŸ“– å¯¼èˆªç›®å½• âœ¨ Typecho å‡çº§ç®€ä»‹ ğŸ“‹ å‡çº§å‰å‡†å¤‡ ğŸ—‘ï¸ åˆ é™¤æ—§ç‰ˆæœ¬æ–‡ä»¶ ğŸ“¤ ä¸Šä¼ æ–°ç‰ˆæœ¬æ–‡ä»¶ âš™ï¸ å‡çº§åé…ç½® ğŸ› æ•…éšœæ’é™¤ ğŸ›¡ï¸ å®‰å…¨åŠ å›º âœ… å‡çº§æ£€æŸ¥æ¸…å• âœ¨ Typecho å‡çº§ç®€ä»‹ Typecho æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼€æºåšå®¢å¹³å°ï¼Œå‡çº§ç³»ç»Ÿå¯ä»¥å¸¦æ¥å¤šé‡å¥½å¤„ï¼š\nğŸ”’ å®‰å…¨æ€§æå‡ï¼šä¿®å¤å·²çŸ¥çš„å®‰å…¨æ¼æ´ï¼Œä¿æŠ¤åšå®¢æ•°æ® âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šæé«˜ç³»ç»Ÿè¿è¡Œæ•ˆç‡å’Œå“åº”é€Ÿåº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ†• åŠŸèƒ½å¢å¼ºï¼šè·å¾—æ–°ç‰¹æ€§å’Œæ”¹è¿›åŠŸèƒ½ï¼Œæ‰©å±•åšå®¢èƒ½åŠ› ğŸ› é—®é¢˜ä¿®å¤ï¼šè§£å†³æ—§ç‰ˆæœ¬ä¸­çš„å„ç§é—®é¢˜å’Œå…¼å®¹æ€§æ•…éšœ ğŸ“± å…¼å®¹æ€§æ”¹å–„ï¼šæ›´å¥½åœ°æ”¯æŒæ–°æµè§ˆå™¨å’Œè®¾å¤‡ï¼Œé€‚åº”ç§»åŠ¨æ—¶ä»£ ğŸŒ æ ‡å‡†éµå¾ªï¼šæ›´æ–°å¯¹æœ€æ–°Webæ ‡å‡†çš„æ”¯æŒï¼Œæé«˜å¯è®¿é—®æ€§ ğŸ“‹ å‡çº§å‰å‡†å¤‡ 1. æ£€æŸ¥å½“å‰ç¯å¢ƒ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹å½“å‰ Typecho ç‰ˆæœ¬ cat /mnt/mydisk/home/typecho/typecho/var/Typecho/Common.php | grep \u0026#39;VERSION\u0026#39; # æ£€æŸ¥ PHP ç‰ˆæœ¬ php -v # æ£€æŸ¥æœåŠ¡å™¨ç¯å¢ƒ df -h # ç£ç›˜ç©ºé—´ free -m # å†…å­˜ä½¿ç”¨ 2. å¤‡ä»½é‡è¦æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åˆ›å»ºå®Œæ•´å¤‡ä»½ BACKUP_DIR=\u0026#34;/backup/typecho/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR # å¤‡ä»½æ‰€æœ‰æ–‡ä»¶ tar -czf $BACKUP_DIR/typecho_full_backup.tar.gz /mnt/mydisk/home/typecho/typecho/ # å¤‡ä»½æ•°æ®åº“ï¼ˆæ ¹æ®æ‚¨çš„æ•°æ®åº“ç±»å‹ï¼‰ # MySQLç¤ºä¾‹ï¼š mysqldump -u [ç”¨æˆ·å] -p[å¯†ç ] [æ•°æ®åº“å] \u0026gt; $BACKUP_DIR/typecho_db.sql # SQLiteç¤ºä¾‹ï¼ˆå¦‚æœä½¿ç”¨ï¼‰ï¼š cp /mnt/mydisk/home/typecho/typecho/usr/[æ•°æ®åº“æ–‡ä»¶].db $BACKUP_DIR/ # å¤‡ä»½é…ç½®æ–‡ä»¶ cp /mnt/mydisk/home/typecho/typecho/config.inc.php $BACKUP_DIR/ # å¤‡ä»½ä¸»é¢˜å’Œæ’ä»¶ cp -r /mnt/mydisk/home/typecho/typecho/usr/themes/ $BACKUP_DIR/ cp -r /mnt/mydisk/home/typecho/typecho/usr/plugins/ $BACKUP_DIR/ 3. ä¸‹è½½æ–°ç‰ˆ Typecho 1 2 3 4 5 6 7 8 9 10 # ä»å®˜æ–¹GitHubä¸‹è½½æœ€æ–°ç‰ˆæœ¬ cd /tmp wget https://github.com/typecho/typecho/releases/latest/download/typecho.zip # éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆå¯é€‰ï¼‰ wget https://github.com/typecho/typecho/releases/latest/download/typecho.zip.md5 md5sum -c typecho.zip.md5 # è§£å‹ç¼© unzip typecho.zip -d typecho-new 4. æ£€æŸ¥å…¼å®¹æ€§ æŸ¥çœ‹æ–°ç‰ˆTypechoçš„å‘å¸ƒè¯´æ˜ï¼Œäº†è§£ç³»ç»Ÿè¦æ±‚å˜åŒ– ç¡®è®¤å½“å‰ä¸»é¢˜å’Œæ’ä»¶ä¸æ–°ç‰ˆæœ¬å…¼å®¹ å¦‚æœ‰å¿…è¦ï¼Œå…ˆæ›´æ–°ä¸»é¢˜å’Œæ’ä»¶åˆ°å…¼å®¹ç‰ˆæœ¬ ğŸ—‘ï¸ åˆ é™¤æ—§ç‰ˆæœ¬æ–‡ä»¶ 1. å®‰å…¨åˆ é™¤æ—§æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # è¿›å…¥Typechoç›®å½• cd /mnt/mydisk/home/typecho/typecho/ # å¿…é¡»åˆ é™¤çš„æ ¸å¿ƒæ–‡ä»¶å’Œç›®å½•ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ rm -rf var/ rm -f index.php rm -f install.php # å¯é€‰åˆ é™¤ï¼ˆå¦‚æœæœªè‡ªå®šä¹‰è¿‡ï¼‰ # rm -rf admin/ # åå°ç®¡ç†æ–‡ä»¶ # rm -rf usr/themes/default/ # é»˜è®¤ä¸»é¢˜ 2. é‡è¦æ³¨æ„äº‹é¡¹ âš ï¸ åƒä¸‡ä¸è¦åˆ é™¤ /usr/ ç›®å½•ï¼Œå› ä¸ºæ­¤ç›®å½•åŒ…å«ï¼š\nğŸ¨ è‡ªå®šä¹‰ä¸»é¢˜æ–‡ä»¶ ğŸ”Œ å®‰è£…çš„æ’ä»¶ ğŸ“ ä¸Šä¼ çš„é™„ä»¶å’Œåª’ä½“æ–‡ä»¶ âš™ï¸ ç”¨æˆ·è‡ªå®šä¹‰é…ç½® ğŸ“Š æ•°æ®åº“æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨SQLiteï¼‰ 3. éªŒè¯åˆ é™¤ç»“æœ 1 2 3 4 5 6 7 8 # æ£€æŸ¥æ˜¯å¦åˆ é™¤äº†æ­£ç¡®æ–‡ä»¶ ls -la | grep -E \u0026#39;var|index.php|install.php\u0026#39; # ç¡®è®¤usrç›®å½•ä»ç„¶å­˜åœ¨ ls -la usr/ # æŸ¥çœ‹å‰©ä½™æ–‡ä»¶ç»“æ„ find . -maxdepth 2 -type d | sort ğŸ“¤ ä¸Šä¼ æ–°ç‰ˆæœ¬æ–‡ä»¶ 1. ä¸Šä¼ æ–°æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨rsyncåŒæ­¥æ–°æ–‡ä»¶ï¼ˆæ¨èï¼‰ rsync -avz /tmp/typecho-new/ /mnt/mydisk/home/typecho/typecho/ # æˆ–è€…ä½¿ç”¨cpå‘½ä»¤ cp -r /tmp/typecho-new/* /mnt/mydisk/home/typecho/typecho/ # è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ chown -R www-data:www-data /mnt/mydisk/home/typecho/typecho/ find /mnt/mydisk/home/typecho/typecho/ -type d -exec chmod 755 {} \\; find /mnt/mydisk/home/typecho/typecho/ -type f -exec chmod 644 {} \\; 2. éœ€è¦ä¸Šä¼ çš„å…·ä½“æ–‡ä»¶ 1 2 3 4 5 6 7 éœ€è¦ä¸Šä¼ çš„ç›®å½•å’Œæ–‡ä»¶ï¼š â”œâ”€â”€ admin/ # åå°ç®¡ç†æ–‡ä»¶ â”œâ”€â”€ var/ # æ ¸å¿ƒç³»ç»Ÿæ–‡ä»¶ â”œâ”€â”€ index.php # å…¥å£æ–‡ä»¶ â”œâ”€â”€ install.php # å®‰è£…/å‡çº§æ–‡ä»¶ â”œâ”€â”€ LICENSE.txt # è®¸å¯è¯æ–‡ä»¶ â””â”€â”€ README.md # è¯´æ˜æ–‡æ¡£ 3. éªŒè¯ä¸Šä¼ ç»“æœ 1 2 3 4 5 6 7 8 # æ£€æŸ¥é‡è¦æ–‡ä»¶æ˜¯å¦å­˜åœ¨ ls -la var/ index.php install.php # éªŒè¯ç‰ˆæœ¬å· cat var/Typecho/Common.php | grep \u0026#39;VERSION\u0026#39; # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la | grep -E \u0026#39;var|index.php|install.php\u0026#39; âš™ï¸ å‡çº§åé…ç½® 1. è¿è¡Œå‡çº§è„šæœ¬ è®¿é—®å‡çº§é¡µé¢\n1 http://your-domain.com/install.php æŒ‰ç…§æç¤ºå®Œæˆå‡çº§\nç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹éœ€è¦å‡çº§çš„æ•°æ®åº“ ç¡®è®¤å‡çº§ä¿¡æ¯ æ‰§è¡Œå‡çº§æ“ä½œ å‡çº§å®Œæˆæç¤º\nè®°ä¸‹å¯èƒ½æ˜¾ç¤ºçš„ä»»ä½•é‡è¦ä¿¡æ¯ å¦‚æœ‰é”™è¯¯ï¼Œè¯·æŸ¥çœ‹é”™è¯¯æ—¥å¿— 2. æ£€æŸ¥å‡çº§ç»“æœ 1 2 3 4 5 6 7 8 # æ£€æŸ¥å‡çº§åç‰ˆæœ¬ cat /mnt/mydisk/home/typecho/typecho/var/Typecho/Common.php | grep \u0026#39;VERSION\u0026#39; # æŸ¥çœ‹å‡çº§æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰ tail -f /var/log/nginx/error.log # æˆ–Apacheé”™è¯¯æ—¥å¿— # æ£€æŸ¥æ•°æ®åº“æ›´æ–° # å¯ä»¥æŸ¥çœ‹æ•°æ®åº“ä¸­çš„ç‰ˆæœ¬å·è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰ 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 # åˆ é™¤å®‰è£…æ–‡ä»¶ï¼ˆå¢å¼ºå®‰å…¨æ€§ï¼‰ rm -f /mnt/mydisk/home/typecho/typecho/install.php # æ¸…ç†ç¼“å­˜æ–‡ä»¶ rm -rf /mnt/mydisk/home/typecho/typecho/usr/tmp/* # åˆ é™¤ä¸‹è½½çš„ä¸´æ—¶æ–‡ä»¶ rm -rf /tmp/typecho-new/ rm -f /tmp/typecho.zip 4. æµ‹è¯•ç½‘ç«™åŠŸèƒ½ è®¿é—®åšå®¢é¦–é¡µï¼Œæ£€æŸ¥æ˜¾ç¤ºæ˜¯å¦æ­£å¸¸ æµ‹è¯•æ–‡ç« æµè§ˆå’Œè¯„è®ºåŠŸèƒ½ ç™»å½•åå°ç®¡ç†ï¼Œæ£€æŸ¥æ‰€æœ‰åŠŸèƒ½ æµ‹è¯•ä¸»é¢˜å’Œæ’ä»¶çš„å…¼å®¹æ€§ æ£€æŸ¥RSSè®¢é˜…ç­‰åŠŸèƒ½ ğŸ› æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¦‚æœå‡ºç°æƒé™é—®é¢˜ chmod -R 755 /mnt/mydisk/home/typecho/typecho/ chown -R www-data:www-data /mnt/mydisk/home/typecho/typecho/ # å¦‚æœå‡ºç°æ•°æ®åº“è¿æ¥é”™è¯¯ # æ£€æŸ¥ config.inc.php æ–‡ä»¶é…ç½® cat /mnt/mydisk/home/typecho/typecho/config.inc.php # å¦‚æœå‡ºç°ç™½å±æˆ–500é”™è¯¯ # æŸ¥çœ‹PHPé”™è¯¯æ—¥å¿— tail -f /var/log/php/error.log # å¯ç”¨Typechoè°ƒè¯•æ¨¡å¼ # åœ¨config.inc.phpä¸­æ·»åŠ ï¼š define(\u0026#39;__TYPECHO_DEBUG__\u0026#39;, true); 2. æ•°æ®åº“é—®é¢˜ä¿®å¤ 1 2 3 4 5 6 7 8 9 10 -- å¦‚æœå‡çº§è¿‡ç¨‹ä¸­æ•°æ®åº“å‡ºé”™ -- å¯ä»¥å°è¯•æ‰‹åŠ¨æ‰§è¡ŒSQLè¯­å¥ä¿®å¤ -- æŸ¥çœ‹å½“å‰æ•°æ®åº“ç‰ˆæœ¬ SELECT * FROM typecho_options WHERE name = \u0026#39;version\u0026#39;; -- ä¿®å¤å¯èƒ½çš„é—®é¢˜è¡¨ REPAIR TABLE typecho_contents; REPAIR TABLE typecho_comments; REPAIR TABLE typecho_relationships; 3. å›æ»šæ–¹æ¡ˆ 1 2 3 4 5 6 7 8 # å¦‚æœå‡çº§å¤±è´¥ï¼Œæ¢å¤å¤‡ä»½ tar -xzf /backup/typecho/[æ—¥æœŸ]/typecho_full_backup.tar.gz -C / # æ¢å¤æ•°æ®åº“ mysql -u [ç”¨æˆ·å] -p[å¯†ç ] [æ•°æ®åº“å] \u0026lt; /backup/typecho/[æ—¥æœŸ]/typecho_db.sql # æ¢å¤åæ£€æŸ¥ ls -la /mnt/mydisk/home/typecho/typecho/ 4. å¯»æ±‚å¸®åŠ© æŸ¥çœ‹Typechoå®˜æ–¹æ–‡æ¡£ è®¿é—®Typechoå®˜æ–¹è®ºå› æŸ¥çœ‹GitHub Issuesä¸­çš„ç±»ä¼¼é—®é¢˜ åœ¨ç›¸å…³æŠ€æœ¯ç¤¾åŒºæé—® ğŸ›¡ï¸ å®‰å…¨åŠ å›º 1. å‡çº§åå®‰å…¨æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥æ–‡ä»¶æƒé™ find /mnt/mydisk/home/typecho/typecho/ -type f -exec chmod 644 {} \\; find /mnt/mydisk/home/typecho/typecho/ -type d -exec chmod 755 {} \\; # è®¾ç½®ç‰¹å®šç›®å½•å†™æƒé™ chmod -R 777 /mnt/mydisk/home/typecho/typecho/usr/uploads/ chmod -R 777 /mnt/mydisk/home/typecho/typecho/usr/themes/ # æ£€æŸ¥æ˜¯å¦æœ‰å¯ç–‘æ–‡ä»¶ find /mnt/mydisk/home/typecho/typecho/ -name \u0026#34;*.php\u0026#34; -exec grep -l \u0026#34;eval\\|base64_decode\\|system\\|shell_exec\u0026#34; {} \\; 2. å®‰å…¨é…ç½®å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # ç¦ç”¨å®‰è£…æ–‡ä»¶ chmod 000 /mnt/mydisk/home/typecho/typecho/install.php # æˆ–è€…ç›´æ¥åˆ é™¤ rm -f /mnt/mydisk/home/typecho/typecho/install.php # é…ç½® .htaccess ä¿æŠ¤ï¼ˆå¦‚æœä½¿ç”¨ Apacheï¼‰ tee /mnt/mydisk/home/typecho/typecho/.htaccess \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;Files \u0026#34;install.php\u0026#34;\u0026gt; Order Allow,Deny Deny from all \u0026lt;/Files\u0026gt; \u0026lt;Files \u0026#34;*.sql\u0026#34;\u0026gt; Order Allow,Deny Deny from all \u0026lt;/Files\u0026gt; # é˜²æ­¢ç›®å½•æµè§ˆ Options -Indexes # ä¿æŠ¤é…ç½®æ–‡ä»¶ \u0026lt;Files \u0026#34;config.inc.php\u0026#34;\u0026gt; Order Allow,Deny Deny from all \u0026lt;/Files\u0026gt; EOF # å¦‚æœæ˜¯Nginxï¼Œåœ¨é…ç½®ä¸­æ·»åŠ ï¼š location ~* /(install\\.php|config\\.inc\\.php|\\.sql$) { deny all; return 404; } 3. å®šæœŸç»´æŠ¤å»ºè®® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºå®šæœŸå¤‡ä»½è„šæœ¬ cat \u0026gt; /usr/local/bin/typecho-backup \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash BACKUP_DIR=\u0026#34;/backup/typecho/$(date +%Y%m%d)\u0026#34; mkdir -p $BACKUP_DIR tar -czf $BACKUP_DIR/typecho_backup_$(date +%Y%m%d_%H%M).tar.gz /mnt/mydisk/home/typecho/typecho/ mysqldump -u [ç”¨æˆ·å] -p[å¯†ç ] [æ•°æ®åº“å] \u0026gt; $BACKUP_DIR/typecho_db_$(date +%Y%m%d_%H%M).sql find /backup/typecho/ -name \u0026#34;*.tar.gz\u0026#34; -mtime +30 -delete find /backup/typecho/ -name \u0026#34;*.sql\u0026#34; -mtime +30 -delete EOF chmod +x /usr/local/bin/typecho-backup # æ·»åŠ åˆ°è®¡åˆ’ä»»åŠ¡ echo \u0026#34;0 2 * * * /usr/local/bin/typecho-backup\u0026#34; \u0026gt;\u0026gt; /etc/crontab âœ… å‡çº§æ£€æŸ¥æ¸…å• å‡çº§å‰å‡†å¤‡ å¤‡ä»½å®Œæ•´ç½‘ç«™æ–‡ä»¶å’Œæ•°æ®åº“ æ£€æŸ¥å½“å‰ç‰ˆæœ¬å’Œæ’ä»¶å…¼å®¹æ€§ ä¸‹è½½æ–°ç‰ˆTypechoå¹¶éªŒè¯å®Œæ•´æ€§ é€šçŸ¥ç”¨æˆ·å¯èƒ½çš„æœåŠ¡ä¸­æ–­ å‡†å¤‡å›æ»šæ–¹æ¡ˆ å‡çº§è¿‡ç¨‹ åœæ­¢ç½‘ç«™è®¿é—®ï¼ˆå¯é€‰ï¼Œå¯åœ¨ä½æµé‡æ—¶æ®µè¿›è¡Œï¼‰ åˆ é™¤æ—§ç‰ˆæ ¸å¿ƒæ–‡ä»¶ ä¸Šä¼ æ–°ç‰ˆæ–‡ä»¶ è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™ è¿è¡Œå‡çº§è„šæœ¬ éªŒè¯å‡çº§ç»“æœ å‡çº§åéªŒè¯ æ£€æŸ¥ç½‘ç«™åŠŸèƒ½æ­£å¸¸ æµ‹è¯•ä¸»é¢˜å’Œæ’ä»¶å…¼å®¹æ€§ æ›´æ–°æœç´¢å¼•æ“ç´¢å¼•ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰ æ‰§è¡Œå®‰å…¨åŠ å›ºæªæ–½ æ¸…ç†ä¸´æ—¶æ–‡ä»¶ é•¿æœŸç»´æŠ¤ è®¾ç½®å®šæœŸå¤‡ä»½è®¡åˆ’ ç›‘æ§ç³»ç»Ÿæ—¥å¿—å’Œé”™è¯¯ å®šæœŸæ£€æŸ¥Typechoå®˜æ–¹æ›´æ–° ä¿æŒä¸»é¢˜å’Œæ’ä»¶æ›´æ–° å®šæœŸå®¡æŸ¥å®‰å…¨è®¾ç½® ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»å®Œæˆäº† Typecho åšå®¢ç³»ç»Ÿçš„å®‰å…¨å‡çº§ï¼š\nâœ… å¤‡ä»½å‡†å¤‡ï¼šç¡®ä¿æ•°æ®å®‰å…¨ï¼Œåšå¥½å›æ»šå‡†å¤‡ âœ… åˆ é™¤æ—§æ–‡ä»¶ï¼šè°¨æ…ç§»é™¤éœ€è¦æ›´æ–°çš„æ ¸å¿ƒæ–‡ä»¶ âœ… ä¸Šä¼ æ–°æ–‡ä»¶ï¼šè¦†ç›–å®‰è£…æ–°ç‰ˆæœ¬æ–‡ä»¶ âœ… è¿è¡Œå‡çº§ï¼šé€šè¿‡å®‰è£…è„šæœ¬å®Œæˆæ•°æ®åº“å‡çº§ âœ… éªŒè¯æµ‹è¯•ï¼šæ£€æŸ¥æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ âœ… å®‰å…¨åŠ å›ºï¼šåŠ å¼ºç³»ç»Ÿå®‰å…¨æ€§é…ç½® ç°åœ¨æ‚¨çš„ Typecho åšå®¢å·²ç»å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œäº«å—æ–°ç‰¹æ€§å’Œæ”¹è¿›å§ï¼âœ¨\nğŸ’¡ æç¤ºï¼šå®šæœŸæ£€æŸ¥ Typecho å®˜æ–¹å‘å¸ƒçš„æ–°ç‰ˆæœ¬ï¼Œä¿æŒç³»ç»Ÿæ›´æ–°å¯ä»¥è·å¾—æ›´å¥½çš„å®‰å…¨æ€§å’ŒåŠŸèƒ½ä½“éªŒã€‚å‡çº§å‰åŠ¡å¿…åšå¥½å®Œæ•´å¤‡ä»½ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚å»ºè®®è®¢é˜… Typecho çš„å‘å¸ƒé€šçŸ¥ï¼Œä»¥ä¾¿åŠæ—¶äº†è§£æ–°ç‰ˆæœ¬ä¿¡æ¯ã€‚\n","date":"2024-12-07T09:38:55+08:00","image":"https://file.meimolihan.eu.org/img/typecho-01.webp","permalink":"https://blog.meimolihan.eu.org/p/41156c67/","title":"Typecho åšå®¢ç³»ç»Ÿå‡çº§æŒ‡å— ğŸš€"},{"content":"iStoreOS é…ç½® Samba å…±äº«æœåŠ¡æŒ‡å— ğŸ› ï¸ Samba æ˜¯å®ç° Linux/Unix ä¸ Windows ç³»ç»Ÿé—´æ–‡ä»¶å’Œæ‰“å°æœºå…±äº«çš„æ ¸å¿ƒæœåŠ¡ã€‚\nğŸ“Œ å¯¼èˆªç›®å½•\nâœ¨ ä¸€ã€åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ¯ äºŒã€æœåŠ¡ç«¯é…ç½® ğŸ–¥ï¸ ä¸‰ã€å®¢æˆ·ç«¯é…ç½® ğŸš€ å››ã€è¿›é˜¶æç¤ºä¸æ•…éšœæ’é™¤ ğŸ”§ äº”ã€å¸¸ç”¨å‘½ä»¤å‚è€ƒ ğŸ’¡ å…­ã€æœ€ä½³å®è·µ âœ¨ ä¸€ã€åŠŸèƒ½ä¸ç‰¹ç‚¹ ğŸ–¥ï¸ è·¨å¹³å°è®¿é—®ï¼šå…è®¸ Windowsã€macOSã€Linux åŠç§»åŠ¨è®¾å¤‡è®¿é—®å…±äº«æ–‡ä»¶ ğŸ” ç”¨æˆ·æƒé™æ§åˆ¶ï¼šå¯è®¾ç½®ä¸åŒç”¨æˆ·/å¯†ç ï¼Œä¿éšœå…±äº«å†…å®¹çš„å®‰å…¨ ğŸ“ ç›®å½•çµæ´»å…±äº«ï¼šæ”¯æŒå¤šä¸ªä¸åŒè·¯å¾„çš„ç›®å½•åˆ†åˆ«è®¾ç½®ç‹¬ç«‹å…±äº« âš¡ é«˜æ€§èƒ½ä¼ è¾“ï¼šé’ˆå¯¹å†…ç½‘ç¯å¢ƒä¼˜åŒ–ï¼Œä¼ è¾“é€Ÿåº¦å¿« ğŸ å…¼å®¹ macOSï¼šæ”¯æŒ Apple Time Machine å¤‡ä»½åŠ DS_Store ç­‰æ–‡ä»¶è¿‡æ»¤ ğŸ”§ é…ç½®ç®€å•ï¼šå¯é€šè¿‡ Web ç•Œé¢æˆ– SSH å‘½ä»¤è¡Œå¿«é€Ÿé…ç½® ğŸ¯ äºŒã€iStoreOS ä½œ Samba æœåŠ¡ç«¯ 1ï¸âƒ£ åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½® Samba å¯†ç  1 2 # åˆ›å»ºadminç”¨æˆ·å¹¶è®¾ç½®Sambaå¯†ç  useradd admin \u0026amp;\u0026amp; smbpasswd -a admin 2ï¸âƒ£ åˆ›å»ºå…±äº«ç›®å½•å¹¶åˆ†é…æƒé™ 1 2 # åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -pm 755 /mnt/mydisk \u0026amp;\u0026amp; chown -R admin:admin /mnt/mydisk ğŸ’¡ æç¤ºï¼š\nmkdir -pï¼šç¡®ä¿è·¯å¾„ä¸­æ‰€æœ‰ç›®å½•éƒ½è¢«åˆ›å»º chown -Rï¼šé€’å½’ä¿®æ”¹ç›®å½•æ‰€æœ‰è€… å…±äº«ç¤ºä¾‹è¯´æ˜ï¼š\nåç§°ï¼šARS2ï¼ˆç½‘ç»œä¸­æ˜¾ç¤ºçš„åç§°ï¼‰\nè·¯å¾„ï¼š/mnt/mydisk\nå…è®¸ç”¨æˆ·ï¼šroot\nåç§°ï¼šMedia\nè·¯å¾„ï¼š/mnt/mydisk/media\nå…è®¸ç”¨æˆ·ï¼šadmin\n3ï¸âƒ£ é…ç½® Samba æœåŠ¡ ğŸ”§ æ–¹æ³•ä¸€ï¼šè¦†ç›–é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 # å¤‡ä»½åŸé…ç½®æ–‡ä»¶ cp -i /etc/samba/smb.conf /etc/samba/smb.conf.bak # ç”Ÿæˆæ–°é…ç½® cat \u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [global] netbios name = ARS2 interfaces = br-lan server string = Samba on OpenWRT unix charset = UTF-8 workgroup = WORKGROUP bind interfaces only = yes deadtime = 15 enable core files = no security = user map to guest = Bad User null passwords = yes passdb backend = smbpasswd socket options = IPTOS_LOWDELAY TCP_NODELAY load printers = No printcap name = /dev/null disable spoolss = yes printing = bsd mdns name = mdns veto files = /Thumbs.db/.DS_Store/._.DS_Store/.apdisk/ delete veto files = yes socket options = IPTOS_LOWDELAY TCP_NODELAY SO_KEEPALIVE max xmit = 131072 min receivefile size = 131072 fake oplocks = Yes use sendfile = Yes aio read size = 0 aio write size = 0 server min protocol = NT1 lanman auth = yes ntlm auth = ntlmv1-permitted [ARS2] path = /mnt/mydisk force user = root force group = root valid users = root create mask = 0777 directory mask = 0777 read only = no guest ok = no fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr [media] path = /mnt/mydisk/media force user = root force group = root valid users = admin create mask = 0777 directory mask = 0777 read only = no guest ok = no fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr [TV] path = /mnt/mydisk/TV force user = root force group = root valid users = admin create mask = 0777 directory mask = 0777 read only = no guest ok = no fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no fruit:time machine = yes vfs objects = catia fruit streams_xattr EOF # é‡å¯ Samba æœåŠ¡ /etc/init.d/samba4 restart ğŸ”© æ–¹æ³•äºŒï¼šè¿½åŠ é…ç½®ï¼ˆä¿ç•™åŸæœ‰é…ç½®ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # è¿½åŠ é…ç½®åˆ°ç°æœ‰æ–‡ä»¶ tee -a /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [ARS2] path = /mnt/mydisk force user = root force group = root valid users = root create mask = 0777 directory mask = 0777 read only = no guest ok = no fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no vfs objects = catia fruit streams_xattr EOF # é‡å¯æœåŠ¡ /etc/init.d/samba4 restart ğŸ–¥ï¸ ä¸‰ã€iStoreOS ä½œ Samba å®¢æˆ·ç«¯ é…ç½® iStoreOS æŒ‚è½½è¿œç¨‹ Samba å…±äº«ç›®å½•ï¼š\nå‚æ•°è¯´æ˜ï¼š\næœåŠ¡å™¨ IPï¼š10.10.10.245ï¼ˆSamba æœåŠ¡ç«¯åœ°å€ï¼‰ å…±äº«æ–‡ä»¶å¤¹ï¼šDebianï¼ˆæœåŠ¡ç«¯å…±äº«åç§°ï¼‰ æŒ‚è½½è·¯å¾„ï¼š/mnt/mydebianï¼ˆæœ¬åœ°æŒ‚è½½ç‚¹ï¼‰ SMB ç‰ˆæœ¬ï¼šSMB V3ï¼ˆæ¨èç‰ˆæœ¬ï¼Œå…¼å®¹æ€§å¥½ï¼‰ æŒ‚è½½å‚æ•°ï¼šå¯è¯»/å†™ å­—ç¬¦é›†ï¼šUTF8ï¼ˆé¿å…ä¸­æ–‡ä¹±ç ï¼‰ ç”¨æˆ·åï¼šadminï¼ˆæœåŠ¡ç«¯æˆæƒç”¨æˆ·ï¼‰ å¯†ç ï¼šyifan0719ï¼ˆå¯¹åº”ç”¨æˆ·çš„å¯†ç ï¼‰ âœ… é…ç½®å®Œæˆåï¼Œå³å¯åœ¨ /mnt/mydebian è®¿é—®è¿œç¨‹å…±äº«æ–‡ä»¶\nğŸš€ å››ã€è¿›é˜¶æç¤ºä¸æ•…éšœæ’é™¤ ğŸ” æœåŠ¡çŠ¶æ€æ£€æŸ¥ 1 2 3 4 5 # æŸ¥çœ‹SambaæœåŠ¡çŠ¶æ€ service samba4 status # æŸ¥çœ‹è¯¦ç»†è¿è¡Œä¿¡æ¯ smbstatus ğŸŒ é˜²ç«å¢™è®¾ç½® ç¡®ä¿å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š\nTCP 139ï¼šNetBIOSä¼šè¯æœåŠ¡ TCP 445ï¼šSMB over TCP UDP 137ï¼šNetBIOSåç§°æœåŠ¡ UDP 138ï¼šNetBIOSæ•°æ®æŠ¥æœåŠ¡ ğŸ“ æ—¥å¿—æŸ¥çœ‹ 1 2 3 4 5 # æŸ¥çœ‹Sambaæ—¥å¿— tail -f /var/log/samba/log.smbd # æŸ¥çœ‹è¿æ¥æ—¥å¿— tail -f /var/log/samba/log.\u0026lt;client-ip\u0026gt; ğŸ”’ æƒé™é—®é¢˜è§£å†³ 1 2 3 4 5 6 # æ£€æŸ¥ç›®å½•æƒé™ ls -la /mnt/ # é‡æ–°è®¾ç½®æƒé™ chmod -R 755 /mnt/mydisk chown -R admin:admin /mnt/mydisk ğŸ”„ é‡æ–°åŠ è½½é…ç½® 1 2 # ä¸é‡å¯æœåŠ¡ï¼Œé‡æ–°åŠ è½½é…ç½® smbcontrol all reload-config ğŸ”§ äº”ã€å¸¸ç”¨å‘½ä»¤å‚è€ƒ ç”¨æˆ·ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 # æ·»åŠ Sambaç”¨æˆ· smbpasswd -a username # åˆ é™¤Sambaç”¨æˆ· smbpasswd -x username # å¯ç”¨/ç¦ç”¨ç”¨æˆ· smbpasswd -e username smbpasswd -d username è¿æ¥æµ‹è¯•å‘½ä»¤ 1 2 3 4 5 # æŸ¥çœ‹å¯ç”¨å…±äº« smbclient -L //server-ip -U username # æµ‹è¯•è¿æ¥å…±äº« smbclient //server-ip/sharename -U username æŒ‚è½½å‘½ä»¤ 1 2 3 4 5 # æ‰‹åŠ¨æŒ‚è½½Sambaå…±äº« mount -t cifs //server-ip/sharename /mnt/mountpoint -o username=user,password=pass # å¸è½½å…±äº« umount /mnt/mountpoint ğŸ’¡ å…­ã€æœ€ä½³å®è·µ ğŸ›¡ï¸ å®‰å…¨å»ºè®® ä½¿ç”¨å¼ºå¯†ç ï¼šä¸ºSambaç”¨æˆ·è®¾ç½®å¤æ‚å¯†ç  é™åˆ¶è®¿é—®ï¼šä»…å…è®¸å¿…è¦ç”¨æˆ·è®¿é—®å…±äº« å®šæœŸæ›´æ–°ï¼šä¿æŒç³»ç»Ÿå’ŒSambaè½¯ä»¶æœ€æ–° ç½‘ç»œéš”ç¦»ï¼šå°†SambaæœåŠ¡æ”¾åœ¨éš”ç¦»çš„ç½‘ç»œæ®µ ğŸ“Š æ€§èƒ½ä¼˜åŒ– å¯ç”¨å¤§æ–‡ä»¶ä¼ è¾“ä¼˜åŒ–ï¼š 1 2 min receivefile size = 16384 getwd cache = yes è°ƒæ•´ç¼“å­˜è®¾ç½®ï¼š 1 socket options = TCP_NODELAY IPTOS_LOWDELAY ğŸ”„ å¤‡ä»½ç­–ç•¥ å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶ï¼š 1 cp /etc/samba/smb.conf /etc/samba/smb.conf.backup.$(date +%Y%m%d) æµ‹è¯•é…ç½®æœ‰æ•ˆæ€§ï¼š 1 testparm ğŸŒ å¤šè¯­è¨€æ”¯æŒ ç¡®ä¿æ­£ç¡®è®¾ç½®å­—ç¬¦é›†é¿å…ä¹±ç ï¼š\n1 2 3 unix charset = UTF-8 dos charset = UTF-8 display charset = UTF-8 å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©ä½ å¿«é€Ÿé…ç½® iStoreOS çš„ Samba æœåŠ¡ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿æ¢è®¨ã€‚ğŸ¤\nğŸ“š æ‰©å±•é˜…è¯»ï¼š\nSamba å®˜æ–¹æ–‡æ¡£ iStoreOS å®˜æ–¹è®ºå› OpenWrt Samba é…ç½®æŒ‡å— ","date":"2024-12-07T09:37:35+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c74162eb/","title":"iStoreOS é…ç½® Samba å…±äº«æœåŠ¡æŒ‡å— ğŸ› ï¸"},{"content":"Docker éƒ¨ç½² Gopeed ä¸‹è½½å™¨ ğŸ“¥ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Gopeed 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Gopeed 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ â¬‡ï¸ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ MinDoc å®˜ç½‘åœ°å€ï¼š https://www.gopeed.com/zh-CN ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/GopeedLab/gopeed ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/liwei2633/gopeed Gopeed æ˜¯ä¸€æ¬¾å¼€æºçš„é«˜æ€§èƒ½ä¸‹è½½ç®¡ç†å™¨ï¼Œæ”¯æŒ HTTPã€HTTPSã€FTPã€BTã€ç£åŠ›é“¾æ¥ç­‰å¤šç§ä¸‹è½½åè®®ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¸‹è½½æœåŠ¡å™¨ï¼Œæ”¯æŒè¿œç¨‹ç®¡ç†å’Œå¤šè®¾å¤‡è®¿é—®ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å¤šåè®®æ”¯æŒ HTTPã€HTTPSã€FTPã€BTã€ç£åŠ›é“¾æ¥å…¨é¢æ”¯æŒ ä¸€ç«™å¼ä¸‹è½½è§£å†³æ–¹æ¡ˆ âš¡ é«˜æ€§èƒ½ä¸‹è½½ å¤šçº¿ç¨‹ä¸‹è½½ï¼Œå……åˆ†åˆ©ç”¨å¸¦å®½ æœ€å¤§åŒ–ä¸‹è½½é€Ÿåº¦ ğŸ“± Web ç•Œé¢ ç›´è§‚çš„æµè§ˆå™¨ç®¡ç†ç•Œé¢ æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œè·¨å¹³å°è®¿é—® ğŸ”„ æ–­ç‚¹ç»­ä¼  æ”¯æŒä¸‹è½½ä¸­æ–­åç»§ç»­ä¸‹è½½ èŠ‚çœæ—¶é—´å’Œæµé‡ ğŸ¯ ä»»åŠ¡ç®¡ç† æ‰¹é‡ä¸‹è½½ã€ä»»åŠ¡æ’é˜Ÿã€é€Ÿåº¦é™åˆ¶ ç²¾ç»†åŒ–ä¸‹è½½æ§åˆ¶ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² ä½¿ç”¨ Docker ç®€åŒ–å®‰è£…å’Œç»´æŠ¤ ç¯å¢ƒéš”ç¦»ï¼Œéƒ¨ç½²ç®€å• ğŸ”’ å®‰å…¨è®¿é—® å¯é€‰çš„èº«ä»½éªŒè¯ä¿æŠ¤ ä¿éšœä¸‹è½½æœåŠ¡å®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Gopeed 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/gopeed \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: gopeed: image: liwei2633/gopeed:latest container_name: gopeed restart: unless-stopped ports: - \u0026#34;6600:9999\u0026#34; # ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ volumes: - ./config:/app/storage # é…ç½®æ–‡ä»¶ç›®å½• - ./Downloads:/app/Downloads # ä¸‹è½½æ–‡ä»¶ç›®å½• environment: - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® EOF âš™ï¸ å¯é€‰ç¯å¢ƒå˜é‡ï¼š\nGOPEED_WEB_AUTH=false # æ˜¯å¦å¯ç”¨è®¤è¯ GOPEED_WEB_USERNAME=admin # ç”¨æˆ·å GOPEED_WEB_PASSWORD=password # å¯†ç  2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Gopeed 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:6600 åŸŸåè®¿é—®: https://download.yourdomain.com (é…ç½®åå‘ä»£ç†å) 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æ ¹æ®ç•Œé¢æç¤ºè¿›è¡Œåˆå§‹è®¾ç½®ï¼ˆå¦‚æœæœ‰ï¼‰ é…ç½®ä¸‹è½½ç›®å½•å’Œé»˜è®¤è®¾ç½® å¼€å§‹æ·»åŠ ä¸‹è½½ä»»åŠ¡ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/gopeed.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name download.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name download.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ï¼ˆç”¨äºå¤§æ–‡ä»¶ä¸‹è½½ï¼‰ client_max_body_size 0; location / { proxy_pass http://localhost:6600; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ä»¥é€‚åº”å¤§æ–‡ä»¶ä¸‹è½½ proxy_read_timeout 3600s; proxy_send_timeout 3600s; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/gopeed # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop gopeed # åœæ­¢å®¹å™¨ docker start gopeed # å¯åŠ¨å®¹å™¨ docker restart gopeed # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it gopeed sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs gopeed # æŸ¥çœ‹æ—¥å¿— docker logs -f gopeed # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 gopeed # æŸ¥çœ‹æœ€å100è¡Œ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi liwei2633/gopeed:latest # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ â¬‡ï¸ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Gopeed ä¸‹è½½å™¨ï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ æé€Ÿä¸‹è½½ äº«å—å¤šåè®®å¤šçº¿ç¨‹å¸¦æ¥çš„æè‡´ä¸‹è½½ä½“éªŒï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç½‘ç»œå¸¦å®½\nğŸŒ è¿œç¨‹ç®¡ç† éšæ—¶éšåœ°é€šè¿‡ Web ç•Œé¢æ·»åŠ å’Œç®¡ç†ä¸‹è½½ä»»åŠ¡ï¼Œæ‰“ç ´è®¾å¤‡é™åˆ¶\nğŸ”„ ç¨³å®šå¯é  æ”¯æŒæ–­ç‚¹ç»­ä¼ å’Œä»»åŠ¡é˜Ÿåˆ—ï¼Œç¡®ä¿é‡è¦ä¸‹è½½ä¸ä¼šä¸­æ–­\nğŸ”’ å®‰å…¨åŠ å¯† é€šè¿‡ HTTPS åŠ å¯†è¿æ¥ä¿æŠ¤ä½ çš„ä¸‹è½½éšç§å’Œä¼ è¾“å®‰å…¨\nä¸‹è½½ä¸ä»…æ˜¯è·å–èµ„æºçš„æ–¹å¼ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„é«˜æ•ˆåŠ©æ‰‹ã€‚æ„¿ Gopeed æˆä¸ºä½ å¯é çš„ä¸‹è½½ä¼™ä¼´ï¼Œè®©ä½ çš„æ¯ä¸€æ¬¡èµ„æºè·å–éƒ½å˜å¾—ç®€å•ã€å¿«é€Ÿã€ç¨³å®šã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé‡Šæ”¾ä½ çš„ç½‘ç»œæ½œèƒ½ï¼Œä½“éªŒæé€Ÿä¸‹è½½çš„ç•…å¿«æ„Ÿå—ï¼ğŸ’¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Gopeed å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¸‹è½½æ„‰å¿«ï¼Œèµ„æºæ»¡è½½ï¼ğŸ‰\n","date":"2024-12-07T09:26:06+08:00","image":"https://file.meimolihan.eu.org/img/gopeed-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e2b21f55/","title":"Docker éƒ¨ç½² Gopeed ä¸‹è½½å™¨ ğŸ“¥"},{"content":"Docker éƒ¨ç½² Pi-hole å¹¿å‘Šæ‹¦æˆªå™¨ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Pi-hole 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Pi-hole 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªçº¯å‡€ï¼Œå®ˆæŠ¤æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Pi-hole å®˜ç½‘åœ°å€ï¼š https://docs.pi-hole.net/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/pi-hole/docker-pi-hole/ ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/pihole/pihole Pi-hole æ˜¯ä¸€ä¸ªç½‘ç»œçº§çš„å¹¿å‘Šæ‹¦æˆªå™¨ï¼Œä½œä¸º DNS sinkhole è¿è¡Œï¼Œèƒ½å¤Ÿæ‹¦æˆªå¹¿å‘Šã€è·Ÿè¸ªå™¨å’Œæ¶æ„åŸŸåï¼Œä¸ºæ•´ä¸ªç½‘ç»œæä¾›ä¿æŠ¤ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å¹¿å‘Šæ‹¦æˆªç³»ç»Ÿï¼Œä¿æŠ¤æ‰€æœ‰ç½‘ç»œè®¾å¤‡çš„éšç§å’Œå®‰å…¨ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ›¡ï¸ ç½‘ç»œçº§æ‹¦æˆª ä½œä¸º DNS sinkhole è¿è¡Œï¼Œæ‹¦æˆªå¹¿å‘Šå’Œè·Ÿè¸ªå™¨ ä¿æŠ¤æ•´ä¸ªç½‘ç»œï¼Œæ— éœ€æ¯ä¸ªè®¾å¤‡å•ç‹¬é…ç½® ğŸ“Š è¯¦ç»†ç»Ÿè®¡ æä¾›è¯¦ç»†çš„æŸ¥è¯¢ç»Ÿè®¡å’Œå›¾è¡¨ å¯è§†åŒ–ç½‘ç»œæ´»åŠ¨ï¼Œäº†è§£æ‹¦æˆªæ•ˆæœ ğŸ”§ çµæ´»é…ç½® æ”¯æŒç™½åå•ã€é»‘åå•å’Œè‡ªå®šä¹‰è§„åˆ™ æ ¹æ®éœ€æ±‚å®šåˆ¶è¿‡æ»¤è§„åˆ™ ğŸ‘¥ å¤šè®¾å¤‡æ”¯æŒ ä¿æŠ¤æ‰€æœ‰è¿æ¥åˆ°ç½‘ç»œçš„è®¾å¤‡ åŒ…æ‹¬ç”µè„‘ã€æ‰‹æœºã€æ™ºèƒ½ç”µè§†ç­‰ âš¡ é«˜æ€§èƒ½ ä½èµ„æºæ¶ˆè€—ï¼Œé«˜é€Ÿ DNS è§£æ ä¸å½±å“ç½‘ç»œé€Ÿåº¦ï¼Œå“åº”è¿…é€Ÿ ğŸ”’ éšç§ä¿æŠ¤ é˜»æ­¢è·Ÿè¸ªå™¨å’Œæ¶æ„åŸŸå å¢å¼ºç½‘ç»œéšç§å’Œå®‰å…¨æ€§ ğŸŒ è¿œç¨‹ç®¡ç† æä¾› Web ç®¡ç†ç•Œé¢ éšæ—¶éšåœ°ç®¡ç†å¹¿å‘Šæ‹¦æˆªè®¾ç½® ğŸ³ ä¸€ã€Docker éƒ¨ç½² Pi-hole 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 mkdir -p /mnt/mydisk/home/pihole \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: pihole: container_name: pihole image: pihole/pihole:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;53:53/tcp\u0026#34; - \u0026#34;53:53/udp\u0026#34; - \u0026#34;67:67/udp\u0026#34; - \u0026#34;19000:80/tcp\u0026#34; volumes: - ./config/etc-pihole:/etc/pihole - ./config/etc-dnsmasq.d:/etc/dnsmasq.d environment: - TZ=Asia/Shanghai - WEBPASSWORD=yifan0719 cap_add: - NET_ADMIN EOF ğŸ” ç®¡ç†å¯†ç ï¼šå°† yifan0719 æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å¼ºå¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Pi-hole 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:19000/admin å±€åŸŸç½‘è®¿é—®ï¼š http://10.10.10.245:19000/admin åŸŸåè®¿é—®ï¼š https://pihole.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨ä»¥ä¸‹å‡­æ®ç™»å½•ï¼š ç”¨æˆ·åï¼šadmin å¯†ç ï¼šyifan0719ï¼ˆæˆ–æ‚¨åœ¨é…ç½®ä¸­è®¾ç½®çš„å¯†ç ï¼‰ é…ç½®ä¸Šæ¸¸ DNS æœåŠ¡å™¨ æ·»åŠ å¹¿å‘Šæ‹¦æˆªåˆ—è¡¨ å°†ç½‘ç»œè®¾å¤‡çš„ DNS æœåŠ¡å™¨è®¾ç½®ä¸º Pi-hole çš„ IP åœ°å€ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://pihole.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/pihole.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name pihole.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name pihole.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; location / { proxy_pass http://127.0.0.1:19000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; pihole status # æŸ¥çœ‹Pi-holeçŠ¶æ€ docker exec \u0026lt;container_name\u0026gt; pihole -g # æ›´æ–°å¹¿å‘Šåˆ—è¡¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªçº¯å‡€ï¼Œå®ˆæŠ¤æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Pi-hole å¹¿å‘Šæ‹¦æˆªå™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ å…¨ç½‘å‡€åŒ– ä¸ºæ‰€æœ‰è¿æ¥è®¾å¤‡æä¾›å¹¿å‘Šæ‹¦æˆªä¿æŠ¤ï¼Œäº«å—æ¸…çˆ½çš„ç½‘ç»œæµè§ˆä½“éªŒ\nğŸ›¡ï¸ éšç§åŠ å›º é˜»æ­¢è·Ÿè¸ªå™¨å’Œæ¶æ„åŸŸåï¼Œå¢å¼ºæ•´ä¸ªç½‘ç»œçš„éšç§å®‰å…¨æ€§\nğŸ“Š æ™ºèƒ½æ´å¯Ÿ é€šè¿‡è¯¦ç»†çš„æ•°æ®ç»Ÿè®¡ï¼Œäº†è§£ç½‘ç»œæ´»åŠ¨æ¨¡å¼å’Œæ‹¦æˆªæ•ˆæœ\nğŸ”§ çµæ´»æ§åˆ¶ è‡ªå®šä¹‰é»‘ç™½åå•ï¼Œæ ¹æ®éœ€æ±‚ç²¾ç¡®è°ƒæ•´è¿‡æ»¤è§„åˆ™\nç½‘ç»œå®‰å…¨ï¼Œæ˜¯æ•°å­—æ—¶ä»£çš„åŸºç¡€ä¿éšœã€‚æ„¿ Pi-hole æˆä¸ºä½ ç½‘ç»œçš„å¿ å®å®ˆæŠ¤è€…ï¼Œæ‹¦æˆªæ¯ä¸€ä¸ªä¸å¿…è¦çš„å¹²æ‰°ï¼Œä¿æŠ¤æ¯ä¸€æ¬¡é‡è¦çš„è¿æ¥ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå‡€åŒ–ç½‘ç»œï¼Œå®ˆæŠ¤éšç§â€”â€”æ„å»ºä½ ä¸“å±çš„æ¸…å‡€æ•°å­—ç©ºé—´å§ï¼ğŸ›¡ï¸\nğŸ“Œ æŒç»­æ›´æ–°ï¼šå»ºè®®å®šæœŸæ›´æ–°å¹¿å‘Šæ‹¦æˆªåˆ—è¡¨ï¼Œä¿æŒæœ€ä½³æ‹¦æˆªæ•ˆæœ\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯è®¿é—® Pi-hole å®˜æ–¹è®ºå› è·å–å¸®åŠ©\nç¥ä½ ç½‘ç»œç•…æ¸¸æ— å¿§ï¼Œä½“éªŒçº¯å‡€ï¼ğŸ‰\n","date":"2024-12-07T09:25:18+08:00","image":"https://file.meimolihan.eu.org/img/pi-hole-01.webp","permalink":"https://blog.meimolihan.eu.org/p/adea6050/","title":"Docker éƒ¨ç½² Pi-hole å¹¿å‘Šæ‹¦æˆªå™¨ ğŸ³"},{"content":"ğŸ³ Docker éƒ¨ç½² Dockge å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…· ğŸš¢ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Dockge 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå®¹å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Dockge å®˜ç½‘åœ°å€ï¼š https://dockge.kuma.pet/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/louislam/dockge ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/louislam/dockge Dockge æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ Docker å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…·ï¼Œæä¾›äº†ä¸€ä¸ªç›´è§‚çš„ Web ç•Œé¢æ¥ç®¡ç† Docker Compose é¡¹ç›®ã€‚å®ƒä¸“æ³¨äºç®€åŒ– Docker Compose æ–‡ä»¶çš„ç®¡ç†ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè½»æ¾éƒ¨ç½²ã€æ›´æ–°å’Œç®¡ç†å®¹å™¨å †æ ˆã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“‹ ç›´è§‚Webç•Œé¢ æä¾›ç›´è§‚çš„ Web ç•Œé¢ç®¡ç† Docker Compose é¡¹ç›® ç®€åŒ–å®¹å™¨ç®¡ç†æ“ä½œ ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§ å®æ—¶ç›‘æ§å®¹å™¨çŠ¶æ€å’ŒæŸ¥çœ‹æ—¥å¿— å…¨é¢æŒæ¡å®¹å™¨è¿è¡ŒçŠ¶æ€ ğŸ“ åœ¨çº¿æ–‡ä»¶ç¼–è¾‘ æ”¯æŒ Compose æ–‡ä»¶çš„åœ¨çº¿ç¼–è¾‘å’ŒéªŒè¯ æ–¹ä¾¿ä¿®æ”¹å’Œè°ƒè¯•é…ç½® âš¡ ä¸€é”®æ“ä½œ ä¸€é”®éƒ¨ç½²ã€æ›´æ–°å’Œé‡å¯å †æ ˆ ç®€åŒ–å®¹å™¨ç®¡ç†æµç¨‹ ğŸ”§ ç¯å¢ƒå˜é‡ç®¡ç† æ”¯æŒç¯å¢ƒå˜é‡ç®¡ç† çµæ´»é…ç½®å®¹å™¨å‚æ•° ğŸ”Œ Dockeré›†æˆ ä¸ Docker Socket ç›´æ¥é›†æˆ æ— éœ€é¢å¤–é…ç½® âš–ï¸ è½»é‡çº§ è½»é‡çº§ä¸”å“åº”è¿…é€Ÿ ä½èµ„æºå ç”¨ï¼Œå¿«é€Ÿå“åº” ğŸ³ ä¸€ã€Docker éƒ¨ç½² Dockge 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mkdir -p /mnt/mydisk/home/dockge \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: dockge: container_name: dockge image: louislam/dockge:1 restart: unless-stopped ports: - \u0026#34;5001:5001\u0026#34; volumes: - /var/run/docker.sock:/var/run/docker.sock - ./data:/app/data - /mnt/mydisk/home:/opt/stacks environment: - DOCKGE_STACKS_DIR=/opt/stacks - TZ=Asia/Shanghai EOF âš ï¸ å®‰å…¨æç¤º: æš´éœ² Docker Socket æœ‰ä¸€å®šå®‰å…¨é£é™©ï¼Œè¯·ç¡®ä¿åªåœ¨å¯ä¿¡ç½‘ç»œä¸­ä½¿ç”¨\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:5001 IPè®¿é—®: http://æœåŠ¡å™¨IP:5001 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ Dockge ä¼šè‡ªåŠ¨æ‰«æé…ç½®çš„å †æ ˆç›®å½•ä¸­çš„ Docker Compose é¡¹ç›® å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç°æœ‰çš„å †æ ˆï¼Œå¹¶å¯ä»¥å¯¹å…¶è¿›è¡Œç®¡ç† å¼€å§‹ä½¿ç”¨ Web ç•Œé¢ç®¡ç†æ‚¨çš„ Docker å®¹å™¨ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://dockge.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/dockge.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name dockge.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:5001; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/dockge # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop dockge docker start dockge docker restart dockge # åˆ é™¤å®¹å™¨ docker rm dockge docker rm -f dockge # è¿›å…¥å®¹å™¨Shell docker exec -it dockge sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect dockge docker stats dockge # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs dockge docker logs -f dockge docker logs --tail 100 dockge docker logs -t dockge 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi louislam/dockge:1 docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªå®¹å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Dockge å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…·ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸš¢ ç›´è§‚ç®¡ç† é€šè¿‡å‹å¥½çš„ Web ç•Œé¢è½»æ¾ç®¡ç† Docker Compose é¡¹ç›®ï¼Œå‘Šåˆ«å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œ\nğŸ“Š å…¨é¢ç›‘æ§ å®æ—¶æŸ¥çœ‹å®¹å™¨çŠ¶æ€å’Œæ—¥å¿—ï¼Œå…¨é¢æŒæ¡å®¹å™¨è¿è¡ŒçŠ¶å†µï¼Œå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜\nâš¡ é«˜æ•ˆæ“ä½œ ä¸€é”®éƒ¨ç½²ã€æ›´æ–°å’Œé‡å¯å®¹å™¨å †æ ˆï¼Œå¤§å¹…æå‡å®¹å™¨ç®¡ç†æ•ˆç‡å’Œä¾¿æ·æ€§\nğŸ”§ çµæ´»é…ç½® æ”¯æŒåœ¨çº¿ç¼–è¾‘ Compose æ–‡ä»¶å’Œç¯å¢ƒå˜é‡ç®¡ç†ï¼Œçµæ´»è°ƒæ•´å®¹å™¨é…ç½®å‚æ•°\nå®¹å™¨åŒ–æŠ€æœ¯æ˜¯ç°ä»£åº”ç”¨éƒ¨ç½²çš„æ ¸å¿ƒï¼Œé«˜æ•ˆç®¡ç†æ˜¯ç¨³å®šè¿è¡Œçš„ä¿éšœã€‚æ„¿ Dockge æˆä¸ºä½ å®¹å™¨ç®¡ç†æ—…ç¨‹ä¸­çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ ç®€åŒ–è¿ç»´å·¥ä½œï¼Œæå‡ç®¡ç†æ•ˆç‡ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç®€åŒ–è¿ç»´ï¼Œæå‡æ•ˆç‡â€”â€”æ„å»ºä½ ç›´è§‚é«˜æ•ˆçš„å®¹å™¨ç®¡ç†å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Dockge é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œç®¡ç†é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T09:24:39+08:00","image":"https://file.meimolihan.eu.org/img/docker-dockge-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d8c21405/","title":"Docker éƒ¨ç½² Dockge å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…· ğŸš¢"},{"content":"Windows æŒ‚è½½ NFS å…±äº«æŒ‡å— ğŸ–¥ï¸ ğŸ“‹ å¯¼èˆªç›®å½• ğŸŒŸ ç®€ä»‹ ğŸ”§ ä¸€ã€æŒ‚è½½ NFS å…±äº«åˆ°æœ¬åœ°ç£ç›˜ ğŸ”„ äºŒã€å¸è½½ NFS å…±äº« âš™ï¸ ä¸‰ã€æŒä¹…åŒ–æŒ‚è½½é…ç½® ğŸ” å››ã€æ•…éšœæ’é™¤å’Œå¸¸è§é—®é¢˜ ğŸ’¡ äº”ã€é«˜çº§ç”¨æ³•å’ŒæŠ€å·§ ğŸ“‹ å…­ã€NFS æŒ‚è½½å‘½ä»¤å‚è€ƒè¡¨ ğŸ›¡ï¸ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ Windows ç³»ç»Ÿä¸ŠæŒ‚è½½å’Œå¸è½½ NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰å…±äº«ï¼Œè®©æ‚¨èƒ½å¤Ÿåƒè®¿é—®æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚\nâœ¨ ä¸»è¦ä¼˜åŠ¿ï¼š âœ… ç›´æ¥è®¿é—®è¿œç¨‹æœåŠ¡å™¨æ–‡ä»¶ âœ… åƒæ“ä½œæœ¬åœ°ç£ç›˜ä¸€æ ·æ“ä½œè¿œç¨‹æ–‡ä»¶ âœ… æ”¯æŒå¤§æ–‡ä»¶ä¼ è¾“å’Œé«˜æ€§èƒ½è®¿é—® âœ… é€‚ç”¨äºå¤šç§ç½‘ç»œå­˜å‚¨åœºæ™¯ ğŸ”§ ä¸€ã€æŒ‚è½½ NFS å…±äº«åˆ°æœ¬åœ°ç£ç›˜ 1. ç¡®ä¿ NFS å®¢æˆ·ç«¯åŠŸèƒ½å·²å¯ç”¨ åœ¨æŒ‚è½½ NFS å…±äº«ä¹‹å‰ï¼Œè¯·ç¡®ä¿ Windows çš„ NFS å®¢æˆ·ç«¯åŠŸèƒ½å·²å¯ç”¨ï¼š\næ‰“å¼€\u0026quot;æ§åˆ¶é¢æ¿\u0026quot; â†’ \u0026ldquo;ç¨‹åº\u0026rdquo; â†’ \u0026ldquo;å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½\u0026rdquo; å‹¾é€‰\u0026quot;NFS å®¢æˆ·ç«¯\u0026quot; ç‚¹å‡»\u0026quot;ç¡®å®š\u0026quot;å¹¶ç­‰å¾…å®‰è£…å®Œæˆ 2. æŒ‚è½½ NFS å…±äº«åˆ°æœ¬åœ°é©±åŠ¨å™¨ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†è¿œç¨‹ NFS å…±äº«æŒ‚è½½åˆ°æœ¬åœ°é©±åŠ¨å™¨ï¼š\n1 2 3 4 5 6 7 8 # æŒ‚è½½æœåŠ¡å™¨ 10.10.10.242 çš„å…±äº«åˆ° G: ç›˜ mount 10.10.10.242:/mnt/mydisk G: # æŒ‚è½½æœåŠ¡å™¨ 10.10.10.251 çš„å…±äº«åˆ° H: ç›˜ mount 10.10.10.251:/mnt/mydisk H: # æŒ‚è½½æœåŠ¡å™¨ 10.10.10.246 çš„å…±äº«åˆ° I: ç›˜ mount 10.10.10.246:/mnt/mydisk I: å‚æ•°è¯´æ˜ï¼š\n10.10.10.242:/mnt/mydisk: NFS æœåŠ¡å™¨çš„ IP åœ°å€å’Œå…±äº«è·¯å¾„ G:: æœ¬åœ°é©±åŠ¨å™¨å­—æ¯ï¼ˆå¯ä»¥æ˜¯ä»»ä½•æœªä½¿ç”¨çš„é©±åŠ¨å™¨å­—æ¯ï¼‰ 3. ä½¿ç”¨é«˜çº§æŒ‚è½½é€‰é¡¹ï¼ˆå¯é€‰ï¼‰ å¦‚æœéœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é«˜çº§é€‰é¡¹ï¼š\n1 2 # ä½¿ç”¨ç‰¹å®šé€‰é¡¹æŒ‚è½½ mount -o rsize=32768,wsize=32768,nolock 10.10.10.242:/mnt/mydisk G: å¸¸ç”¨é€‰é¡¹ï¼š\nrsize=32768: è¯»å–ç¼“å†²åŒºå¤§å°ï¼ˆå­—èŠ‚ï¼‰ wsize=32768: å†™å…¥ç¼“å†²åŒºå¤§å°ï¼ˆå­—èŠ‚ï¼‰ nolock: ç¦ç”¨æ–‡ä»¶é”å®šï¼ˆé€‚ç”¨äºæŸäº› NFS æœåŠ¡å™¨ï¼‰ soft: è½¯æŒ‚è½½ï¼ˆè¶…æ—¶åæ”¾å¼ƒï¼‰ hard: ç¡¬æŒ‚è½½ï¼ˆæ— é™é‡è¯•ï¼‰ ğŸ”„ äºŒã€å¸è½½ NFS å…±äº« 1. ä½¿ç”¨ net use å‘½ä»¤å¸è½½ 1 2 3 4 5 6 7 8 # å¸è½½ G: ç›˜ net use G: /delete # å¸è½½ H: ç›˜ net use H: /delete # å¸è½½ I: ç›˜ net use I: /delete 2. ä½¿ç”¨ umount å‘½ä»¤å¸è½½ï¼ˆæ›¿ä»£æ–¹æ³•ï¼‰ 1 2 3 4 5 # å¸è½½ G: ç›˜ umount G: # æˆ–ä½¿ç”¨å®Œæ•´è·¯å¾„å¸è½½ umount \\\\10.10.10.242\\mnt\\mydisk âš™ï¸ ä¸‰ã€æŒä¹…åŒ–æŒ‚è½½é…ç½® å¦‚æœæ‚¨å¸Œæœ›æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½ NFS å…±äº«ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š\n1. ä½¿ç”¨å‘½ä»¤æŒä¹…åŒ–æŒ‚è½½ 1 2 # æ·»åŠ  /persistent:yes å‚æ•°ä½¿æŒ‚è½½æŒä¹…åŒ– mount -o rsize=32768,wsize=32768,nolock,persistent 10.10.10.242:/mnt/mydisk G: 2. ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶è‡ªåŠ¨åŒ– åˆ›å»ºä¸€ä¸ªæ‰¹å¤„ç†æ–‡ä»¶ï¼ˆå¦‚ mount_nfs.batï¼‰ï¼š\n1 2 3 4 5 6 7 @echo off echo Mounting NFS shares... mount 10.10.10.242:/mnt/mydisk G: mount 10.10.10.251:/mnt/mydisk H: mount 10.10.10.246:/mnt/mydisk I: echo NFS shares mounted successfully. pause 3. åˆ›å»ºå¸è½½æ‰¹å¤„ç†æ–‡ä»¶ åˆ›å»ºä¸€ä¸ªå¸è½½æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆå¦‚ unmount_nfs.batï¼‰ï¼š\n1 2 3 4 5 6 7 @echo off echo Unmounting NFS shares... net use G: /delete net use H: /delete net use I: /delete echo NFS shares unmounted successfully. pause ğŸ” å››ã€æ•…éšœæ’é™¤å’Œå¸¸è§é—®é¢˜ 1. æƒé™é—®é¢˜ å¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼Œå°è¯•åœ¨æŒ‚è½½æ—¶æŒ‡å®šç”¨æˆ·èº«ä»½ï¼š\n1 2 # ä½¿ç”¨ç‰¹å®šç”¨æˆ·èº«ä»½æŒ‚è½½ mount -o user=username 10.10.10.242:/mnt/mydisk G: 2. è¿æ¥é—®é¢˜ å¦‚æœæ— æ³•è¿æ¥ï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š\nç¡®ä¿ç½‘ç»œè¿é€šæ€§ï¼š\n1 ping 10.10.10.242 æ£€æŸ¥ NFS æœåŠ¡æ˜¯å¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š\n1 showmount -e 10.10.10.242 æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ NFS ç«¯å£ï¼ˆé€šå¸¸æ˜¯ 2049ï¼‰å¼€æ”¾\n3. æ€§èƒ½ä¼˜åŒ– å¦‚æœä¼ è¾“é€Ÿåº¦æ…¢ï¼Œå°è¯•è°ƒæ•´ç¼“å†²åŒºå¤§å°ï¼š\n1 2 # å¢åŠ ç¼“å†²åŒºå¤§å°ä»¥æé«˜æ€§èƒ½ mount -o rsize=65536,wsize=65536 10.10.10.242:/mnt/mydisk G: ğŸ’¡ äº”ã€é«˜çº§ç”¨æ³•å’ŒæŠ€å·§ 1. æŸ¥çœ‹å·²æŒ‚è½½çš„ NFS å…±äº« 1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œé©±åŠ¨å™¨ net use # æˆ–ä½¿ç”¨ mount å‘½ä»¤æŸ¥çœ‹ NFS ç‰¹å®šä¿¡æ¯ mount 2. ä½¿ç”¨ç¬¦å·é“¾æ¥åˆ›å»ºä¾¿æ·è®¿é—® 1 2 # åˆ›å»ºç›®å½•ç¬¦å·é“¾æ¥ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ mklink /D C:\\MyNFSShare G:\\ 3. åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­è®¿é—® æŒ‚è½½åï¼Œæ‚¨å¯ä»¥åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­ç›´æ¥è®¿é—® NFS å…±äº«ï¼Œå°±åƒè®¿é—®æœ¬åœ°é©±åŠ¨å™¨ä¸€æ ·ã€‚\nğŸ“‹ å…­ã€NFS æŒ‚è½½å‘½ä»¤å‚è€ƒè¡¨ å‘½ä»¤ è¯´æ˜ mount server:/share drive: æŒ‚è½½ NFS å…±äº« umount drive: å¸è½½ NFS å…±äº« net use drive: /delete å¸è½½ç½‘ç»œé©±åŠ¨å™¨ showmount -e server æŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„ NFS å¯¼å‡º mount æ˜¾ç¤ºå½“å‰æŒ‚è½½çš„ NFS å…±äº« ğŸ›¡ï¸ ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹ ç½‘ç»œå®‰å…¨æ€§ï¼šNFS ä¼ è¾“é»˜è®¤ä¸åŠ å¯†ï¼Œè€ƒè™‘åœ¨å®‰å…¨ç½‘ç»œä¸­ä½¿ç”¨æˆ–ä½¿ç”¨ VPN æƒé™ç®¡ç†ï¼šç¡®ä¿ NFS æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æƒé™è®¾ç½®æ­£ç¡® å®šæœŸæ£€æŸ¥ï¼šå®šæœŸéªŒè¯æŒ‚è½½çš„å…±äº«ä»ç„¶éœ€è¦ä¸”å®‰å…¨ è®¿é—®æ§åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ NFS ç«¯å£çš„è®¿é—® ğŸš€ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ Windows ç³»ç»Ÿä¸ŠæŒ‚è½½å’Œå¸è½½ NFS å…±äº«ï¼Œå®ç°ä¾¿æ·çš„è¿œç¨‹æ–‡ä»¶è®¿é—®å’Œç®¡ç†ï¼\næˆ‘å·²ä¸ºæ–‡ç« æ·»åŠ äº†å®Œæ•´çš„å¯¼èˆªç›®å½•å’Œé”šç‚¹é“¾æ¥ï¼Œç¡®ä¿æ¯ä¸ªç« èŠ‚éƒ½å¯ä»¥é€šè¿‡ç›®å½•æ­£ç¡®è·³è½¬ã€‚å¯¼èˆªç›®å½•ä½¿ç”¨äº†ç®€æ´çš„è‹±æ–‡IDï¼Œç¡®ä¿åœ¨å„ç§Markdownè§£æå™¨ä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚\n","date":"2024-12-07T09:23:48+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/5d8b7919/","title":"Windows æŒ‚è½½ NFS å…±äº«æŒ‡å— ğŸ–¥ï¸"},{"content":"CentOS é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸ ğŸ“‹ å¯¼èˆªç›®å½• âœ¨ NFS ç®€ä»‹ä¸ä¼˜åŠ¿ ğŸš€ å¿«é€Ÿå¼€å§‹ ğŸ–¥ï¸ ä¸€ã€CentOS ä½œä¸º NFS æœåŠ¡å™¨é…ç½® ğŸ’» äºŒã€CentOS ä½œä¸º NFS å®¢æˆ·ç«¯é…ç½® ğŸ”§ ä¸‰ã€NFS æŒ‚è½½ç®¡ç† ğŸ” å››ã€NFS å…±äº«æŸ¥çœ‹ä¸ç®¡ç† âš™ï¸ äº”ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– ğŸ”’ å…­ã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ› ä¸ƒã€æ•…éšœæ’é™¤ ğŸ“Š æ€»ç»“ âœ¨ NFS ç®€ä»‹ä¸ä¼˜åŠ¿ NFS (Network File System) æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œå…è®¸é€šè¿‡ç½‘ç»œåœ¨ä¸åŒä¸»æœºé—´å…±äº«æ–‡ä»¶ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nğŸŒ ç½‘ç»œå…±äº«ï¼šå®ç°å¤šå°æœåŠ¡å™¨ä¹‹é—´çš„æ–‡ä»¶å…±äº«å’Œè®¿é—® âš¡ é«˜æ€§èƒ½ï¼šæä¾›å¿«é€Ÿçš„ç½‘ç»œæ–‡ä»¶è®¿é—®é€Ÿåº¦ ğŸ”„ é€æ˜è®¿é—®ï¼šå®¢æˆ·ç«¯å¯ä»¥åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—®è¿œç¨‹æ–‡ä»¶ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒï¼šæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®å…±äº«ç›®å½• ğŸ›¡ï¸ æƒé™æ§åˆ¶ï¼šå¯ä»¥è®¾ç½®ä¸åŒçš„è®¿é—®æƒé™å’Œå®‰å…¨æ€§é€‰é¡¹ ğŸ’¾ èµ„æºé›†ä¸­ï¼šé›†ä¸­å­˜å‚¨ç®¡ç†ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ ğŸš€ å¿«é€Ÿå¼€å§‹ 1. ä½¿ç”¨ç§‘æŠ€lionä¸€é”®è„šæœ¬å·¥å…· 1 2 # ä¸‹è½½å¹¶è¿è¡Œç§‘æŠ€lionçš„ä¸€é”®é…ç½®è„šæœ¬ sudo curl -sS -O https://kejilion.pro/kejilion.sh \u0026amp;\u0026amp; chmod +x kejilion.sh \u0026amp;\u0026amp; ./kejilion.sh 2. å®‰è£… NFS ä¾èµ–åŒ…å¹¶å¯åŠ¨æœåŠ¡ 1 2 3 4 5 6 7 8 9 # æ¸…ç†ç¼“å­˜å¹¶å®‰è£… NFS ç›¸å…³è½¯ä»¶åŒ… yum clean all yum -y install nfs-utils rpcbind # å¯åŠ¨å¹¶å¯ç”¨æœåŠ¡ systemctl enable --now rpcbind nfs-server # æ£€æŸ¥æœåŠ¡çŠ¶æ€ systemctl status rpcbind nfs-server ğŸ–¥ï¸ ä¸€ã€CentOS ä½œä¸º NFS æœåŠ¡å™¨é…ç½® 1. åˆ›å»ºå¹¶é…ç½®å…±äº«ç›®å½• 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™ mkdir -pm 755 /mnt/mydisk # é…ç½® NFS å¯¼å‡ºè®¾ç½® cat \u0026gt; /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## NFS å…±äº«å°†è¢«æŒ‚è½½åˆ° /mnt/mydisk ç›®å½•ï¼Œå¹¶èµ‹äºˆç›¸å…³æƒé™ /mnt/mydisk *(rw,fsid=0,no_subtree_check,no_root_squash,insecure,sync) EOF # é‡æ–°åŠ è½½å¯¼å‡ºé…ç½®å¹¶é‡å¯ NFS æœåŠ¡ exportfs -r systemctl restart nfs-server 2. éªŒè¯ NFS æœåŠ¡å™¨é…ç½® 1 2 3 4 5 6 7 8 # æ£€æŸ¥ NFS æœåŠ¡çŠ¶æ€ systemctl status nfs-server # æŸ¥çœ‹å½“å‰å¯¼å‡ºçš„å…±äº«ç›®å½• showmount -e # æŸ¥çœ‹ NFS ç‰ˆæœ¬æ”¯æŒ cat /proc/fs/nfsd/versions 3. é˜²ç«å¢™é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ 1 2 3 4 5 # å¼€æ”¾ NFS ç›¸å…³ç«¯å£ firewall-cmd --permanent --add-service=nfs firewall-cmd --permanent --add-service=mountd firewall-cmd --permanent --add-service=rpc-bind firewall-cmd --reload ğŸ’» äºŒã€CentOS ä½œä¸º NFS å®¢æˆ·ç«¯é…ç½® 1. ä¸´æ—¶æŒ‚è½½ NFS å…±äº« 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŒ‚è½½ ARS2 æœåŠ¡å™¨çš„å…±äº«ç›®å½• mkdir -pm 755 /mnt/ARS2-NFS mount -t nfs -o rw 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS # æŒ‚è½½ PVE æœåŠ¡å™¨çš„å…±äº«ç›®å½• mkdir -pm 755 /mnt/PVE-NFS mount -t nfs -o rw 10.10.10.254:/mnt/ntfs /mnt/PVE-NFS # æŒ‚è½½ Debian æœåŠ¡å™¨çš„å…±äº«ç›®å½• mkdir -pm 755 /mnt/Debian-NFS mount -t nfs -o rw 10.10.10.247:/mnt/mydisk /mnt/Debian-NFS # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹ df -hT /mnt/* 2. æ°¸ä¹…æŒ‚è½½ NFS å…±äº« æ–¹æ³•ä¸€ï¼šè¦†ç›– /etc/fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½• mkdir -pm 755 /mnt/ARS2-NFS /mnt/PVE-NFS /mnt/Debian-NFS # é…ç½® fstab æ–‡ä»¶å®ç°æ°¸ä¹…æŒ‚è½½ cat \u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # NFS å…±äº«é…ç½® 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs nofail,x-systemd.device-timeout=15s 0 0 10.10.10.254:/mnt/ntfs /mnt/PVE-NFS nfs nofail,x-systemd.device-timeout=15s 0 0 10.10.10.245:/mnt/mydisk /mnt/Debian-NFS nfs nofail,x-systemd.device-timeout=15s 0 0 EOF # é‡å¯ç³»ç»Ÿä½¿é…ç½®ç”Ÿæ•ˆ reboot æ–¹æ³•äºŒï¼šè¿½åŠ åˆ° /etc/fstab æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»º ARS2 æœåŠ¡å™¨çš„æŒ‚è½½ç‚¹ mkdir -pm 755 /mnt/ARS2-NFS # è¿½åŠ  ARS2 æœåŠ¡å™¨çš„ NFS å…±äº«é…ç½® cat \u0026gt;\u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # è¿½åŠ  ARS2 æœåŠ¡å™¨ NFS å…±äº« 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs nofail,x-systemd.device-timeout=15s 0 0 EOF # é‡å¯ç³»ç»Ÿä½¿é…ç½®ç”Ÿæ•ˆ reboot 3. æµ‹è¯•æŒ‚è½½é…ç½® 1 2 3 4 5 # æµ‹è¯• fstab é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆä¸å®é™…æŒ‚è½½ï¼‰ mount -a # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½çš„ NFS å…±äº« mount | grep nfs ğŸ”§ ä¸‰ã€NFS æŒ‚è½½ç®¡ç† 1. æŸ¥çœ‹ NFS æŒ‚è½½çŠ¶æ€ 1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç‚¹ df -hT /mnt/* # æŸ¥çœ‹ NFS ç‰¹å®šçš„æŒ‚è½½ä¿¡æ¯ mount | grep nfs æŒ‚è½½ç›®å½•è¯¦æƒ…ç¤ºä¾‹ï¼š\næ–‡ä»¶ç³»ç»Ÿ ç±»å‹ å¤§å° å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ 10.10.10.251:/mnt/mydisk nfs 2.7T 1.8T 823G 69% /mnt/ARS2-NFS 10.10.10.254:/mnt/ntfs nfs 932G 216G 717G 24% /mnt/PVE-NFS 10.10.10.247:/mnt/mydisk nfs 16G 7.9G 6.9G 54% /mnt/Ubuntu-NFS 2. å–æ¶ˆ NFS æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 # å–æ¶ˆå•ä¸ªæŒ‚è½½ç‚¹ umount /mnt/ARS2-NFS # å–æ¶ˆæ‰€æœ‰ NFS æŒ‚è½½ umount -a -t nfs # å¼ºåˆ¶å–æ¶ˆæŒ‚è½½ï¼ˆå½“è®¾å¤‡å¿™æ—¶ï¼‰ umount -f /mnt/ARS2-NFS # å»¶è¿Ÿå–æ¶ˆæŒ‚è½½ï¼ˆå½“è®¾å¤‡å¿™æ—¶ï¼‰ umount -l /mnt/ARS2-NFS ğŸ” å››ã€NFS å…±äº«æŸ¥çœ‹ä¸ç®¡ç† 1. æŸ¥çœ‹ NFS å…±äº«ä¿¡æ¯ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨çš„ NFS å…±äº« showmount -e 10.10.10.254 # æŸ¥çœ‹æœ¬æœºçš„ NFS å…±äº« showmount -e # æŸ¥çœ‹å·²è¿æ¥æœ¬æœº NFS å…±äº«çš„å®¢æˆ·ç«¯ showmount -a 2. NFS çŠ¶æ€ç›‘æ§ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ NFS æœåŠ¡å™¨çŠ¶æ€ nfsstat -s # æŸ¥çœ‹ NFS å®¢æˆ·ç«¯çŠ¶æ€ nfsstat -c # å®æ—¶ç›‘æ§ NFS æ´»åŠ¨ nfsstat -m 3. è‡ªåŠ¨æ£€æŸ¥ NFS å…±äº«è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # åˆ›å»ºæ£€æŸ¥è„šæœ¬ cat \u0026gt; ./check_nfs_shares.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # å®šä¹‰è¦æ£€æŸ¥çš„æœåŠ¡å™¨åˆ—è¡¨ servers=( \u0026#34;10.10.10.242\u0026#34; \u0026#34;10.10.10.252\u0026#34; \u0026#34;10.10.10.243\u0026#34; \u0026#34;10.10.10.254\u0026#34; \u0026#34;10.10.10.251\u0026#34; \u0026#34;10.10.10.245\u0026#34; \u0026#34;10.10.10.246\u0026#34; \u0026#34;10.10.10.247\u0026#34; ) # å¾ªç¯æ£€æŸ¥æ¯ä¸ªæœåŠ¡å™¨çš„ NFS å…±äº« for server in \u0026#34;${servers[@]}\u0026#34;; do echo \u0026#34;-----------------------\u0026#34; echo -e \u0026#34;\\033[1;31mæ£€æŸ¥æœåŠ¡å™¨: $server\\033[0m\u0026#34; # å°è¯•è·å–å…±äº«åˆ—è¡¨ï¼Œè®¾ç½®è¶…æ—¶é˜²æ­¢é•¿æ—¶é—´ç­‰å¾… timeout 5s showmount -e $server 2\u0026gt;/dev/null \u0026amp;\u0026amp; \\ echo -e \u0026#34;\\033[1;32mâœ“ è¿æ¥æˆåŠŸ\\033[0m\u0026#34; || \\ echo -e \u0026#34;\\033[1;31mâœ— è¿æ¥å¤±è´¥æˆ–è¶…æ—¶\\033[0m\u0026#34; echo \u0026#34;-----------------------\u0026#34; done EOF # èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™å¹¶è¿è¡Œ chmod +x ./check_nfs_shares.sh ./check_nfs_shares.sh âš™ï¸ äº”ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ– 1. NFS æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç¼–è¾‘ /etc/nfs.conf æ–‡ä»¶è¿›è¡Œé«˜çº§é…ç½® cat \u0026gt;\u0026gt; /etc/nfs.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [nfsd] threads=16 [mountd] manage-gids=y [statd] state-directory-path=/var/lib/nfs/statd EOF # é‡å¯ NFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ systemctl restart nfs-server 2. è‡ªåŠ¨æŒ‚è½½ (autofs) é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰è£… autofs yum install -y autofs # é…ç½® autofs cat \u0026gt; /etc/auto.master \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /mnt/nfs /etc/auto.nfs --timeout=300 EOF # åˆ›å»º NFS è‡ªåŠ¨æŒ‚è½½é…ç½® cat \u0026gt; /etc/auto.nfs \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ars2 -fstype=nfs,rw,soft,intr 10.10.10.251:/mnt/mydisk pve -fstype=nfs,rw,soft,intr 10.10.10.254:/mnt/ntfs debian -fstype=nfs,rw,soft,intr 10.10.10.247:/mnt/mydisk EOF # é‡å¯ autofs æœåŠ¡ systemctl restart autofs 3. SELinux é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ 1 2 3 4 5 6 # æ£€æŸ¥ SELinux çŠ¶æ€ sestatus # å¦‚æœ SELinux å¯ç”¨ï¼Œè®¾ç½® NFS ç›¸å…³å¸ƒå°”å€¼ setsebool -P nfs_export_all_rw on setsebool -P nfs_export_all_ro on ğŸ”’ å…­ã€å®‰å…¨æ³¨æ„äº‹é¡¹ 1. é™åˆ¶ NFS è®¿é—®æƒé™ 1 2 3 4 5 6 7 # åªå…è®¸ç‰¹å®š IP æ®µè®¿é—® NFS å…±äº« cat \u0026gt; /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /mnt/mydisk 10.10.10.0/24(rw,sync,no_subtree_check,no_root_squash) EOF # é‡æ–°åŠ è½½é…ç½® exportfs -r 2. ä½¿ç”¨æ›´å®‰å…¨çš„ NFSv4 1 2 3 4 # åœ¨ /etc/fstab ä¸­ä½¿ç”¨ NFSv4 cat \u0026gt;\u0026gt; /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; 10.10.10.251:/mnt/mydisk /mnt/ARS2-NFS nfs4 nofail,x-systemd.device-timeout=15s,sec=sys 0 0 EOF 3. å®šæœŸæ£€æŸ¥ NFS å®‰å…¨ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ NFS å…±äº«æƒé™ showmount -e # æ£€æŸ¥è°åœ¨è®¿é—® NFS å…±äº« showmount -a # æ£€æŸ¥ NFS æ—¥å¿— tail -f /var/log/messages | grep nfs ğŸ› ä¸ƒã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 # å¦‚æœæŒ‚è½½å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping 10.10.10.251 # æ£€æŸ¥ NFS æœåŠ¡æ˜¯å¦è¿è¡Œ systemctl status nfs-server # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® firewall-cmd --list-all # æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ dmesg | grep nfs 2. å¼ºåˆ¶é‡æ–°æŒ‚è½½ 1 2 3 # å¼ºåˆ¶é‡æ–°æŒ‚è½½æ‰€æœ‰ NFS å…±äº« umount -a -t nfs mount -a 3. æ¸…é™¤ NFS ç¼“å­˜ 1 2 3 4 5 # æ¸…é™¤ NFS å®¢æˆ·ç«¯ç¼“å­˜ systemctl restart nfs-client.target # æ¸…é™¤ NFS æœåŠ¡å™¨ç¼“å­˜ systemctl restart nfs-server ğŸ“Š æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²ç»å­¦ä¼šäº†åœ¨ CentOS ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç† NFS å…±äº«çš„å®Œæ•´æµç¨‹ï¼š\nâœ… NFS æœåŠ¡å™¨é…ç½®ï¼šè®¾ç½®å…±äº«ç›®å½•å’Œè®¿é—®æƒé™ âœ… NFS å®¢æˆ·ç«¯é…ç½®ï¼šä¸´æ—¶å’Œæ°¸ä¹…æŒ‚è½½è¿œç¨‹å…±äº« âœ… æŒ‚è½½ç®¡ç†ï¼šæŸ¥çœ‹ã€å–æ¶ˆå’Œç›‘æ§ NFS æŒ‚è½½ âœ… é«˜çº§é…ç½®ï¼šæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è®¾ç½® âœ… æ•…éšœæ’é™¤ï¼šè§£å†³å¸¸è§çš„ NFS è¿æ¥é—®é¢˜ ç°åœ¨ä½ å¯ä»¥è½»æ¾åœ°åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´å…±äº«æ–‡ä»¶äº†ï¼ğŸŒğŸ“‚\nğŸ’¡ æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„ NFSv4 åè®®ï¼Œå¹¶é™åˆ¶åªæœ‰å¯ä¿¡çš„ IP åœ°å€å¯ä»¥è®¿é—® NFS å…±äº«ã€‚å®šæœŸæ£€æŸ¥ NFS æ—¥å¿—å’Œæƒé™è®¾ç½®ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚\n","date":"2024-12-07T09:22:40+08:00","image":"https://file.meimolihan.eu.org/img/centos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/aceffec4/","title":"CentOS é…ç½® NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ ğŸ–¥ï¸"},{"content":"ğŸ—‚ï¸ Docker éƒ¨ç½² FileBrowser æ–‡ä»¶ç®¡ç†å™¨ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² FileBrowser 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ FileBrowser 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ—‚ï¸ å¯èˆªæ–‡ä»¶ï¼Œç®¡ç†æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ FileBrowser æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Web æ–‡ä»¶ç®¡ç†å™¨ï¼Œé€šè¿‡æµè§ˆå™¨å³å¯ç®¡ç†æœåŠ¡å™¨æ–‡ä»¶ï¼Œæ”¯æŒé¢„è§ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šç§æ–‡ä»¶æ ¼å¼ï¼Œå¹¶æä¾›å¤šç”¨æˆ·å’Œæƒé™æ§åˆ¶åŠŸèƒ½ã€‚\nå®˜æ–¹ç½‘ç«™: https://filebrowser.org Docker Hub: https://hub.docker.com/r/filebrowser/filebrowser ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ Web ç•Œé¢ é€šè¿‡æµè§ˆå™¨ç®¡ç†æœåŠ¡å™¨æ–‡ä»¶ æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œè·¨å¹³å°è®¿é—® ğŸ“ å¤šæ ¼å¼æ”¯æŒ æ”¯æŒé¢„è§ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šç§æ–‡ä»¶æ ¼å¼ å…¨é¢çš„æ–‡ä»¶é¢„è§ˆèƒ½åŠ› ğŸ‘¥ ç”¨æˆ·ç®¡ç† æ”¯æŒå¤šç”¨æˆ·å’Œæƒé™æ§åˆ¶ ç²¾ç»†åŒ–çš„è®¿é—®æ§åˆ¶ ğŸ”’ å®‰å…¨å¯é  æä¾›èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ ä¿éšœæ–‡ä»¶å®‰å…¨ âš¡ å¿«é€Ÿè½»é‡ èµ„æºå ç”¨ä½ï¼Œå“åº”é€Ÿåº¦å¿« é«˜æ•ˆçš„æ–‡ä»¶ç®¡ç†ä½“éªŒ ğŸ–¥ï¸ åœ¨çº¿ç¼–è¾‘ æ”¯æŒåœ¨çº¿ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶ ç›´æ¥ä¿®æ”¹æ–‡ä»¶å†…å®¹ ğŸ“¤ æ–‡ä»¶åˆ†äº« å¯ä»¥ç”Ÿæˆæ–‡ä»¶åˆ†äº«é“¾æ¥ æ–¹ä¾¿æ–‡ä»¶å…±äº« ğŸ”„ ä¸Šä¼ ä¸‹è½½ æ”¯æŒæ‹–æ‹½ä¸Šä¼ å’Œæ‰¹é‡ä¸‹è½½ ä¾¿æ·çš„æ–‡ä»¶ä¼ è¾“ ğŸ³ ä¸€ã€Docker éƒ¨ç½² FileBrowser 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/filebrowser \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: filebrowser: container_name: filebrowser image: filebrowser/filebrowser:s6 restart: unless-stopped ports: - \u0026#34;8880:80\u0026#34; volumes: - /:/srv - ./config/filebrowser.db:/database/filebrowser.db - ./config:/config environment: - TZ=Asia/Shanghai EOF ğŸ” é»˜è®¤ç™»å½•ä¿¡æ¯ï¼š\nç”¨æˆ·å: admin\nå¯†ç : admin\nâš ï¸ é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ FileBrowser 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:8880 åŸŸåè®¿é—®: https://files.yourdomain.com (é…ç½®åå‘ä»£ç†å) 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤è´¦æˆ·ç™»å½•ï¼ˆadmin / adminï¼‰ ç«‹å³ä¿®æ”¹ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç  å¼€å§‹ç®¡ç†æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/filebrowser # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop filebrowser # åœæ­¢å®¹å™¨ docker start filebrowser # å¯åŠ¨å®¹å™¨ docker restart filebrowser # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it filebrowser sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs filebrowser # æŸ¥çœ‹æ—¥å¿— docker logs -f filebrowser # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 filebrowser # æŸ¥çœ‹æœ€å100è¡Œ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi filebrowser/filebrowser:s6 # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ—‚ï¸ å¯èˆªæ–‡ä»¶ï¼Œç®¡ç†æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† FileBrowser æ–‡ä»¶ç®¡ç†å™¨ï¼ŒæŒæ¡äº†é€šè¿‡ Web ç•Œé¢é«˜æ•ˆç®¡ç†æœåŠ¡å™¨æ–‡ä»¶çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ“ ç›´è§‚ç®¡ç† é€šè¿‡ç®€æ´çš„ Web ç•Œé¢è½»æ¾æµè§ˆå’Œç®¡ç†æ–‡ä»¶ï¼Œå‘Šåˆ«å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œ\nğŸŒ å¤šç«¯è®¿é—® éšæ—¶éšåœ°é€šè¿‡æµè§ˆå™¨è®¿é—®ä½ çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰“ç ´è®¾å¤‡é™åˆ¶\nğŸ”’ å®‰å…¨å¯æ§ æœ¬åœ°åŒ–éƒ¨ç½²ç¡®ä¿ä½ çš„æ–‡ä»¶æ•°æ®å®Œå…¨è‡ªä¸»æŒæ§ï¼Œéšç§å®‰å…¨æ— å¿§\nâš¡ é«˜æ•ˆæ“ä½œ äº«å—æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€ç¼–è¾‘ã€åˆ†äº«ç­‰ä¸€ç«™å¼æœåŠ¡ï¼Œæå‡å·¥ä½œæ•ˆç‡\næ–‡ä»¶ç®¡ç†ä¸ä»…æ˜¯æŠ€æœ¯éœ€æ±‚ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„åŸºç¡€ä¿éšœã€‚æ„¿ FileBrowser æˆä¸ºä½ æ–‡ä»¶ç®¡ç†çš„å¾—åŠ›åŠ©æ‰‹ï¼Œè®©æ¯ä¸€æ¬¡æ–‡ä»¶æ“ä½œéƒ½å˜å¾—ç®€å•ã€é«˜æ•ˆã€æ„‰æ‚¦ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç”¨ FileBrowser è½»æ¾ç®¡ç†ä½ çš„æ–‡ä»¶ä¸–ç•Œï¼Œäº«å—æ•´æ´æœ‰åºçš„æ•°å­—ç”Ÿæ´»ï¼âœ¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ FileBrowser å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œæ–‡ä»¶ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼ğŸ‰\n","date":"2024-12-07T09:20:56+08:00","image":"https://file.meimolihan.eu.org/img/filebrowser-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b446374c/","title":"Docker éƒ¨ç½² FileBrowser æ–‡ä»¶ç®¡ç†å™¨ ğŸ—‚ï¸"},{"content":"Docker éƒ¨ç½² ZFile v4 ä¸ªäººç½‘ç›˜ ğŸ—‚ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² ZFile 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ ZFile 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªäº‘ç«¯ï¼Œç®¡ç†æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ ZFile å®˜ç½‘åœ°å€ï¼š https://www.zfile.vip/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/zfile-dev/zfile ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/zhaojun1998/zfile ZFile æ˜¯ä¸€æ¬¾åŸºäº Java çš„åœ¨çº¿æ–‡ä»¶ç›®å½•ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼ï¼Œå¯ä»¥è®©æ‚¨å¿«é€Ÿæ­å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¸ªäººç½‘ç›˜ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç†æ‚¨çš„æ–‡ä»¶ï¼Œå¹¶æ”¯æŒåœ¨çº¿é¢„è§ˆå’Œåˆ†äº«åŠŸèƒ½ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å¤šå­˜å‚¨æ”¯æŒ æ”¯æŒæœ¬åœ°å­˜å‚¨ã€å¯¹è±¡å­˜å‚¨ã€FTPã€SFTP ç­‰å¤šç§å­˜å‚¨æ–¹å¼ çµæ´»é€‚é…å„ç§å­˜å‚¨éœ€æ±‚ ğŸ“ æ–‡ä»¶ç®¡ç† å®Œæ•´çš„æ–‡ä»¶æµè§ˆã€ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤åŠŸèƒ½ ä¸€ç«™å¼æ–‡ä»¶ç®¡ç†è§£å†³æ–¹æ¡ˆ ğŸ‘ï¸ åœ¨çº¿é¢„è§ˆ æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰å¤šç§æ ¼å¼çš„åœ¨çº¿é¢„è§ˆ æ— éœ€ä¸‹è½½å³å¯æŸ¥çœ‹æ–‡ä»¶å†…å®¹ ğŸ”— æ–‡ä»¶åˆ†äº« ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œè®¾ç½®å¯†ç å’Œæœ‰æ•ˆæœŸ æ–¹ä¾¿å®‰å…¨çš„æ–‡ä»¶å…±äº« ğŸ¨ ç¾è§‚ç•Œé¢ ç°ä»£åŒ– Material Design é£æ ¼ç•Œé¢ æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ ğŸ“± å“åº”å¼è®¾è®¡ å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ éšæ—¶éšåœ°è®¿é—®æ–‡ä»¶ ğŸ”’ å¯†ç ä¿æŠ¤ æ”¯æŒç›®å½•å¯†ç ä¿æŠ¤åŠŸèƒ½ å¢å¼ºæ–‡ä»¶å®‰å…¨æ€§ ğŸš€ é«˜æ€§èƒ½ åŸºäº Spring Bootï¼Œæ€§èƒ½ä¼˜å¼‚ å¿«é€Ÿå“åº”æ–‡ä»¶æ“ä½œ ğŸ³ ä¸€ã€Docker éƒ¨ç½² ZFile 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 mkdir -p /mnt/mydisk/home/zfile-v4 \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: zfile: container_name: zfile-v4 image: zhaojun1998/zfile:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;8000:8080\u0026#34; volumes: - ./config/db:/root/.zfile-v4/db - ./config/logs:/root/.zfile-v4/logs - ./config/data:/root/.zfile-v4/data - ./config/application.properties:/root/application.properties - /mnt:/mnt environment: - TZ=Asia/Shanghai - JAVA_OPTS=-Xmx512m -Xms256m healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:8080\u0026#34;] interval: 30s timeout: 10s retries: 3 EOF ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜ï¼šé¦–æ¬¡å¯åŠ¨å‰è¯·ç¡®ä¿åˆ›å»ºç›¸å…³ç›®å½•ï¼š\n1 2 mkdir -vp /mnt/mydisk/home/zfile-v4/config/{db,logs,data} touch /mnt/mydisk/home/zfile-v4/config/application.properties 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ ZFile 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8000 å±€åŸŸç½‘è®¿é—®ï¼š http://10.10.10.245:8000 åŸŸåè®¿é—®ï¼š https://zfile.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŒ‰ç…§åˆå§‹åŒ–å‘å¯¼å®ŒæˆåŸºæœ¬è®¾ç½® åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· é…ç½®å­˜å‚¨ç­–ç•¥ å¼€å§‹ä½¿ç”¨ ZFile ç®¡ç†æ‚¨çš„æ–‡ä»¶ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://zfile.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/zfile.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name zfile.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name zfile.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 10G; location / { proxy_pass http://127.0.0.1:8000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 300s; proxy_connect_timeout 300s; proxy_send_timeout 300s; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; proxy_pass http://127.0.0.1:8000; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªäº‘ç«¯ï¼Œç®¡ç†æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† ZFile v4 ä¸ªäººç½‘ç›˜ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ ç»Ÿä¸€ç®¡ç† æ•´åˆå¤šç§å­˜å‚¨æºï¼Œåœ¨ä¸€ä¸ªç•Œé¢ä¸­è½»æ¾ç®¡ç†æ‰€æœ‰æ–‡ä»¶èµ„æº\nğŸ“ ä¾¿æ·æ“ä½œ äº«å—å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆå’Œåˆ†äº«åŠŸèƒ½\nğŸ” å®‰å…¨å¯æ§ é€šè¿‡å¯†ç ä¿æŠ¤å’Œæƒé™è®¾ç½®ï¼Œç¡®ä¿ä½ çš„æ–‡ä»¶æ•°æ®å®‰å…¨æ— è™\nğŸ“± éšæ—¶éšåœ° åœ¨ä»»ä½•è®¾å¤‡ä¸Šè®¿é—®ä½ çš„ä¸ªäººç½‘ç›˜ï¼Œç•…äº«ä¾¿æ·çš„æ–‡ä»¶æœåŠ¡\næ–‡ä»¶ç®¡ç†ï¼Œæ˜¯æ•°å­—æ—¶ä»£çš„åŸºæœ¬éœ€æ±‚ã€‚æ„¿ ZFile æˆä¸ºä½ å¯é çš„æ•°å­—æ–‡ä»¶ç®¡å®¶ï¼Œå¸®åŠ©ä½ æœ‰åºæ•´ç†æ¯ä¸€ä»½èµ„æ–™ï¼Œé«˜æ•ˆåˆ†äº«æ¯ä¸€ä¸ªæˆæœã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæœ‰åºå­˜å‚¨ï¼Œè½»æ¾åˆ†äº«â€”â€”æ„å»ºä½ ä¸“å±çš„äº‘ç«¯æ–‡ä»¶åº“å§ï¼ğŸ—ƒï¸\nğŸ“Œ æŒç»­æ›´æ–°ï¼šå»ºè®®å…³æ³¨ ZFile å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ æ–‡ä»¶ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼Œåä½œæ— å¿§ï¼ğŸ‰\n","date":"2024-12-07T08:54:28+08:00","image":"https://file.meimolihan.eu.org/img/zfile-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4effc1de/","title":"Docker éƒ¨ç½² ZFile v4 ä¸ªäººç½‘ç›˜ ğŸ—‚ï¸"},{"content":"Docker éƒ¨ç½² 1Panel æœåŠ¡å™¨ç®¡ç†é¢æ¿ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² 1Panel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæœåŠ¡å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ 1Panel å®˜ç½‘åœ°å€ï¼š https://1panel.cn/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/okxlin/docker-1panel ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/moelin/1panel 1Panel æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ã€å¼€æºçš„ Linux æœåŠ¡å™¨è¿ç»´ç®¡ç†é¢æ¿ï¼Œé€šè¿‡ Web ç•Œé¢è½»æ¾ç®¡ç†æœåŠ¡å™¨ã€ç½‘ç«™ã€æ•°æ®åº“ã€å®¹å™¨ç­‰èµ„æºï¼Œå¤§å¤§ç®€åŒ–äº†æœåŠ¡å™¨è¿ç»´å·¥ä½œã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“Š ç³»ç»Ÿç›‘æ§ å®æ—¶ç›‘æ§ CPUã€å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œä½¿ç”¨æƒ…å†µ å…¨é¢æŒæ¡æœåŠ¡å™¨çŠ¶æ€ ğŸŒ ç½‘ç«™ç®¡ç† ç½‘ç«™åˆ›å»ºå’Œç®¡ç†ï¼ŒSSL è¯ä¹¦è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ ç®€åŒ–ç½‘ç«™è¿ç»´å·¥ä½œ ğŸ—„ï¸ æ•°æ®åº“ç®¡ç† MySQL/MariaDBã€PostgreSQLã€Redis ç®¡ç† ä¸€ç«™å¼æ•°æ®åº“ç®¡ç† ğŸ³ å®¹å™¨ç®¡ç† Docker å®¹å™¨ã€é•œåƒå’Œ Compose ç®¡ç† ä¾¿æ·çš„å®¹å™¨è¿ç»´ ğŸ“¦ åº”ç”¨å•†åº— ä¸€é”®éƒ¨ç½²å¸¸è§åº”ç”¨å’Œè‡ªå®šä¹‰åº”ç”¨ å¿«é€Ÿåº”ç”¨éƒ¨ç½² ğŸ”’ å®‰å…¨ä¸­å¿ƒ é˜²ç«å¢™ç®¡ç†ã€SSH é…ç½®ã€å®‰å…¨å®¡è®¡ å¢å¼ºæœåŠ¡å™¨å®‰å…¨æ€§ âš¡ é«˜æ€§èƒ½ ç°ä»£åŒ–æ¶æ„ï¼Œå“åº”è¿…é€Ÿ æµç•…çš„ç®¡ç†ä½“éªŒ ğŸ³ ä¸€ã€Docker éƒ¨ç½² 1Panel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/1panel \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: 1panel: container_name: 1panel image: moelin/1panel:latest restart: unless-stopped ports: - \u0026#34;10086:10086\u0026#34; volumes: - /var/run/docker.sock:/var/run/docker.sock - ./config:/opt - /mnt:/mnt environment: - TZ=Asia/Shanghai EOF ğŸ” å®‰å…¨æç¤º: é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:10086 IPè®¿é—®: http://æœåŠ¡å™¨IP:10086 å®‰å…¨å…¥å£: http://æœåŠ¡å™¨IP:10086/entrance åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼š ç”¨æˆ·åï¼š1panel å¯†ç ï¼š1panel_password ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  å¼€å§‹é…ç½®æœåŠ¡å™¨ç®¡ç†å’Œç›‘æ§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://panel.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/1panel.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name panel.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:10086; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/1panel # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop 1panel docker start 1panel docker restart 1panel # åˆ é™¤å®¹å™¨ docker rm 1panel docker rm -f 1panel # è¿›å…¥å®¹å™¨Shell docker exec -it 1panel sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect 1panel docker stats 1panel # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs 1panel docker logs -f 1panel docker logs --tail 100 1panel docker logs -t 1panel 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi moelin/1panel:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªæœåŠ¡å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† 1Panel æœåŠ¡å™¨ç®¡ç†é¢æ¿ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ–¥ï¸ ä¸€ç«™å¼ç®¡ç† é€šè¿‡ç›´è§‚çš„ Web ç•Œé¢è½»æ¾ç®¡ç†æœåŠ¡å™¨ã€ç½‘ç«™ã€æ•°æ®åº“å’Œå®¹å™¨ï¼Œå‘Šåˆ«å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œ\nğŸ“Š å…¨é¢ç›‘æ§ å®æ—¶æŒæ¡æœåŠ¡å™¨èµ„æºä½¿ç”¨çŠ¶å†µï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³æ€§èƒ½é—®é¢˜ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œ\nğŸ”’ å®‰å…¨åŠ å›º å€ŸåŠ©å†…ç½®çš„å®‰å…¨ä¸­å¿ƒåŠŸèƒ½ï¼Œå¼ºåŒ–æœåŠ¡å™¨å®‰å…¨é˜²æŠ¤ï¼Œä¿éšœä¸šåŠ¡æ•°æ®å®‰å…¨\nâš¡ é«˜æ•ˆè¿ç»´ é€šè¿‡åº”ç”¨å•†åº—å¿«é€Ÿéƒ¨ç½²å¸¸ç”¨æœåŠ¡ï¼Œå¤§å¹…æå‡è¿ç»´æ•ˆç‡å’Œå·¥ä½œä¾¿æ·æ€§\næœåŠ¡å™¨æ˜¯ç°ä»£æ•°å­—ä¸šåŠ¡çš„åŸºçŸ³ï¼Œé«˜æ•ˆç®¡ç†æ˜¯ç¨³å®šè¿è¡Œçš„ä¿éšœã€‚æ„¿ 1Panel æˆä¸ºä½ æœåŠ¡å™¨è¿ç»´æ—…ç¨‹ä¸­çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ ç®€åŒ–ç®¡ç†å·¥ä½œï¼Œæå‡è¿ç»´æ•ˆç‡ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè½»æ¾è¿ç»´ï¼Œä¸“æ³¨åˆ›æ–°â€”â€”æ„å»ºä½ é«˜æ•ˆå¯é çš„æœåŠ¡å™¨ç®¡ç†å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ 1Panel é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè¿ç»´é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T08:53:20+08:00","image":"https://file.meimolihan.eu.org/img/1panel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9f0de5d3/","title":"Docker éƒ¨ç½² 1Panel æœåŠ¡å™¨ç®¡ç†é¢æ¿ ğŸ³"},{"content":"CentOS é…ç½® Samba æœåŠ¡æŒ‡å— ğŸ–¥ï¸ ğŸ“‹ å¯¼èˆªç›®å½• ğŸŒŸ ç®€ä»‹ ğŸ”§ ä¸€ã€Samba åŸºç¡€è®¾ç½® âš™ï¸ äºŒã€CentOS Samba æœåŠ¡ç«¯é…ç½® ğŸ”— ä¸‰ã€CentOS ä½œä¸º Samba å®¢æˆ·ç«¯é…ç½® ğŸ” å››ã€éªŒè¯ Samba æœåŠ¡ ğŸ›¡ï¸ äº”ã€é˜²ç«å¢™å’Œ SELinux é…ç½® ğŸ’¡ å…­ã€æ•…éšœæ’é™¤ ğŸ”’ ä¸ƒã€å®‰å…¨å»ºè®® ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ CentOS ç³»ç»Ÿä¸Šéƒ¨ç½²å’Œé…ç½® Samba æœåŠ¡ï¼Œå®ç°æ–‡ä»¶å…±äº«åŠŸèƒ½ã€‚Samba å…è®¸ Linux/Unix ç³»ç»Ÿä¸ Windows ç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶å’Œæ‰“å°æœºã€‚\nğŸ”§ ä¸€ã€Samba åŸºç¡€è®¾ç½® 1. æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£… Samba 1 yum update -y \u0026amp;\u0026amp; yum install samba -y \u0026amp;\u0026amp; sudo systemctl enable smb \u0026amp;\u0026amp; sudo systemctl restart smb 2. åˆ›å»º admin ç”¨æˆ·å¹¶è®¾ç½®å¯†ç  1 useradd admin \u0026amp;\u0026amp; smbpasswd -a admin ç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥å¹¶ç¡®è®¤ admin ç”¨æˆ·çš„ Samba å¯†ç \nâš™ï¸ äºŒã€CentOS Samba æœåŠ¡ç«¯é…ç½® 1. å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 cp -i /etc/samba/smb.conf /etc/samba/smb.conf.bak \u0026amp;\u0026amp; cd /etc/samba \u0026amp;\u0026amp; ls 2. æ–¹æ³•ä¸€ï¼šè¦†ç›– Samba é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 mkdir -pm 755 /mnt \u0026amp;\u0026amp; chmod +x /etc/samba/smb.conf \u0026amp;\u0026amp; cat \u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ################################### ######## sambaå…¨å±€é…ç½® ######## [global] ## è®¾ç½®å·¥ä½œç»„åç§° workgroup = WORKGROUP ## è®¾ç½®éæ´»åŠ¨è¿æ¥è¢«å…³é—­çš„æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ deadtime = 99 ## æœåŠ¡å™¨æè¿°å­—ç¬¦ä¸² server string = Samba on CentOS ## è®¾ç½®ç½‘ç»œåŸºæœ¬è¾“å…¥/è¾“å‡ºç³»ç»Ÿï¼ˆNetBIOSï¼‰åç§° netbios name = CentOS ## Unixå­—ç¬¦é›†è®¾ç½®ä¸ºUTF-8 unix charset = UTF-8 ## ç¦ç”¨æ ¸å¿ƒè½¬å‚¨ enable core files = no ## è®¾ç½®å®‰å…¨æ¨¡å¼ä¸ºç”¨æˆ·çº§åˆ« security = user ## å°†æœªçŸ¥ç”¨æˆ·æ˜ å°„ä¸ºè®¿å®¢ map to guest = Bad User ## è®¾ç½®socketé€‰é¡¹ï¼Œä¼˜åŒ–ç½‘ç»œä¼ è¾“æ€§èƒ½ socket options = IPTOS_LOWDELAY TCP_NODELAY ## è®¾ç½®æœ€å¤§ä¼ è¾“å•å…ƒå¤§å° max xmit = 131072 ## è®¾ç½®æœ€å°æ¥æ”¶æ–‡ä»¶å¤§å°ï¼Œç”¨äºå¼‚æ­¥I/Oæ“ä½œ min receivefile size = 131072 ## å¯ç”¨å‡çš„æœºä¼šé” fake oplocks = Yes ## å¯ç”¨sendfileç³»ç»Ÿè°ƒç”¨ï¼Œæé«˜æ–‡ä»¶ä¼ è¾“æ•ˆç‡ use sendfile = Yes ## è®¾ç½®å¼‚æ­¥I/Oè¯»å–é˜ˆå€¼ï¼Œ0è¡¨ç¤ºç¦ç”¨ aio read size = 0 ## è®¾ç½®å¼‚æ­¥I/Oå†™å…¥é˜ˆå€¼ï¼Œ0è¡¨ç¤ºç¦ç”¨ aio write size = 0 ## è®¾ç½®æœåŠ¡å™¨æ”¯æŒçš„æœ€ä½SMBåè®®ç‰ˆæœ¬ server min protocol = NT1 ## å…è®¸ä½¿ç”¨NTLMv1è®¤è¯æ–¹å¼ ntlm auth = ntlmv1-permitted ## ç¦ç”¨è‡ªåŠ¨åŠ è½½printcapæ‰“å°æœº load printers = No ## è®¾ç½®æ‰“å°æœåŠ¡ä¸ä½¿ç”¨printcap printcap name = /dev/null ## ç¦ç”¨SPOOLSSæœåŠ¡ disable spoolss = yes ## è®¾ç½®æ‰“å°æœºçŠ¶æ€ä¿¡æ¯çš„è§£é‡Šæ–¹å¼ printing = bsd ## è®¾ç½®é€šè¿‡MDNSå¹¿å‘Šçš„æœåŠ¡å™¨åç§° mdns name = mdns ## è®¾ç½®Sambaä¸å…±äº«çš„æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨ veto files = /Thumbs.db/.DS_Store/._.DS_Store/.apdisk/ ## å…è®¸åˆ é™¤åªåŒ…å«vetoæ–‡ä»¶çš„ç›®å½• delete veto files = yes # è®¾ç½®æ— æ•ˆç”¨æˆ· # invalid users = root ## æŒ‡å®šæœåŠ¡å™¨åº”è¯¥ç›‘å¬ SMB æµé‡çš„ç«¯å£ã€‚ ## 139 æ˜¯ netbios/nmbd # smb ports = 445 139 ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [CentOS] ## è¿™æ˜¯æˆ‘çš„å…±äº«åç§° comment = mysamba ## å…±äº«ç›®å½•çš„è·¯å¾„ path = /mnt ## æŒ‡å®šå…±äº«æ˜¯å¦åº”è¯¥åœ¨ç½‘ç»œé‚»å±…ä¸­è¢«æµè§ˆåˆ°ï¼Œyesæ˜¾ç¤ºå…±äº«åç§°ï¼Œnoéšè—å…±äº«åç§°ã€‚ browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no ## è¿™äº›VFSæ¨¡å—å¯ä»¥å¢å¼ºSambaæœåŠ¡å™¨çš„åŠŸèƒ½ vfs objects = catia fruit streams_xattr EOF chown admin /mnt/ \u0026amp;\u0026amp; systemctl restart smb \u0026amp;\u0026amp; hostname -i 3. æ–¹æ³•äºŒï¼šè¿½åŠ  Samba é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -pm 755 /mnt \u0026amp;\u0026amp; chmod +x /etc/samba/smb.conf \u0026amp;\u0026amp; tee -a /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ################################### ######## æˆ‘çš„sambaå…±äº«è®¾ç½® ######## [CentOS] ## è¿™æ˜¯æˆ‘çš„å…±äº«åç§° comment = mysamba ## å…±äº«ç›®å½•çš„è·¯å¾„ path = /mnt ## æŒ‡å®šå…±äº«æ˜¯å¦åº”è¯¥åœ¨ç½‘ç»œé‚»å±…ä¸­è¢«æµè§ˆåˆ°ï¼Œyesæ˜¾ç¤ºå…±äº«åç§°ï¼Œnoéšè—å…±äº«åç§°ã€‚ browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no ## è¿™äº›VFSæ¨¡å—å¯ä»¥å¢å¼ºSambaæœåŠ¡å™¨çš„åŠŸèƒ½ vfs objects = catia fruit streams_xattr EOF chown admin /mnt/ \u0026amp;\u0026amp; systemctl restart smb \u0026amp;\u0026amp; hostname -i 4. æ–¹æ³•ä¸‰ï¼šä¸€é”®éƒ¨ç½²è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 touch ~/smb.sh \u0026amp;\u0026amp; cat \u0026gt; ~/smb.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash yum update -y \u0026amp;\u0026amp; yum install samba -y mkdir -pm 755 /mnt \u0026amp;\u0026amp; cat \u0026gt;\u0026gt;/etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; [CentOS] ## è¿™æ˜¯æˆ‘çš„å…±äº«åç§° comment = mysamba ## å…±äº«ç›®å½•çš„è·¯å¾„ path = /mnt ## æŒ‡å®šå…±äº«æ˜¯å¦åº”è¯¥åœ¨ç½‘ç»œé‚»å±…ä¸­è¢«æµè§ˆåˆ°ï¼Œyesæ˜¾ç¤ºå…±äº«åç§°ï¼Œnoéšè—å…±äº«åç§°ã€‚ browseable = yes ## æ˜¯å¦å…è®¸ç”¨æˆ·å†™å…¥æ­¤å…±äº«ï¼Œyesä¸ºå¯å†™å…¥ï¼Œnoä¸ºä¸å¯å†™å…¥ã€‚ writeable = yes ## æŒ‡å®šå…±äº«ç”¨æˆ·æ˜¯å¦å¯è¯»å†™ï¼Œyesä¸ºåªè¯»ï¼Œnoä¸ºè¯»å†™ã€‚ read only = no ## æ–°å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™æ©ç  create mask = 0777 ## æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™æ©ç  directory mask = 0777 ## å…è®¸è®¿å®¢å¦ guest ok = no ## å¼ºåˆ¶ç”¨æˆ·ä¸ºroot force user = root ## å¼ºåˆ¶ç»„ä¸ºroot force group = root ## å®šä¹‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨ admin users = admin ## å®šä¹‰å…è®¸è®¿é—®æ­¤å…±äº«çš„æœ‰æ•ˆç”¨æˆ·åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åï¼ˆä»¥ @ å¼€å¤´ï¼‰ valid users = admin,root ## è¦æ±‚å¯†ç è®¿é—® password required = yes ## å…±äº«æ˜¯å¦å¯ç”¨ï¼Œ yesä¸ºæ˜¾ç¤ºå…±äº«ï¼Œno ä¸ºéšè—å…±äº« available = yes ## å¯¹äºAppleæ–‡ä»¶è¿›è¡Œç¼–ç  fruit:encoding = native ## å¯¹äºAppleæ–‡ä»¶å…ƒæ•°æ® fruit:metadata = stream ## è®¾ç½®ä¸º no è¡¨ç¤ºSambaä¸ä¼šæ‹’ç»AppleDoubleæ–‡ä»¶ fruit:veto_appledouble = no ## è¿™äº›VFSæ¨¡å—å¯ä»¥å¢å¼ºSambaæœåŠ¡å™¨çš„åŠŸèƒ½ vfs objects = catia fruit streams_xattr MYENDMARK ## æ–°å»ºadminç”¨æˆ· \u0026amp;\u0026amp; ä¸ºadminç”¨æˆ·åˆ›å»ºä¸¤æ¬¡å¯†ç  useradd admin 2\u0026gt;/dev/null || true (echo yifan0719; echo yifan0719) | smbpasswd -a -s admin systemctl restart smb EOF chmod +x ~/smb.sh \u0026amp;\u0026amp; bash ~/smb.sh æŸ¥çœ‹è„šæœ¬å†…å®¹ï¼š\n1 cat ~/smb.sh ğŸ”— ä¸‰ã€CentOS ä½œä¸º Samba å®¢æˆ·ç«¯é…ç½® 1. å®‰è£… Samba å®¢æˆ·ç«¯å·¥å…· 1 yum update -y \u0026amp;\u0026amp; yum install samba-client cifs-utils -y 2. åˆ›å»ºæŒ‚è½½ç‚¹å¹¶é…ç½®è‡ªåŠ¨æŒ‚è½½ 1 2 3 4 5 6 7 8 mkdir -pm 755 /mnt/ARS2-SMB \u0026amp;\u0026amp; tee -a /etc/fstab \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ## CentOS 8ä¸ºsambaå®¢æˆ·ç«¯é…ç½®ï¼ˆè¿½åŠ å†…å®¹ï¼‰ ## æœåŠ¡å™¨åœ°å€å’Œå…±äº«åï¼š10.10.10.251/ARS2ï¼ŒæŒ‚è½½åˆ°æœ¬åœ°è·¯å¾„ï¼š /mnt/ARS2-SMBï¼Œè´¦æˆ·ï¼šrootï¼Œå¯†ç ï¼šyifan0719 //10.10.10.251/ARS2 /mnt/ARS2-SMB cifs username=root,password=yifan0719,uid=1000,gid=1000,file_mode=0777,dir_mode=0777 0 0 EOF # æµ‹è¯•æŒ‚è½½ mount -a æ³¨æ„ï¼šåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå»ºè®®ä½¿ç”¨å‡­æ®æ–‡ä»¶è€Œä¸æ˜¯ç›´æ¥åœ¨ fstab ä¸­å­˜å‚¨å¯†ç ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚\n3. ä½¿ç”¨å‡­æ®æ–‡ä»¶ï¼ˆæ›´å®‰å…¨çš„æ–¹æ³•ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ›å»ºå‡­æ®æ–‡ä»¶ echo \u0026#34;username=root\u0026#34; \u0026gt; /root/.smbcredentials echo \u0026#34;password=yifan0719\u0026#34; \u0026gt;\u0026gt; /root/.smbcredentials chmod 600 /root/.smbcredentials # æ›´æ–° fstab ä½¿ç”¨å‡­æ®æ–‡ä»¶ sed -i \u0026#39;/\\/\\/10.10.10.251\\/ARS2/d\u0026#39; /etc/fstab echo \u0026#34;//10.10.10.251/ARS2 /mnt/ARS2-SMB cifs credentials=/root/.smbcredentials,uid=1000,gid=1000,file_mode=0777,dir_mode=0777 0 0\u0026#34; \u0026gt;\u0026gt; /etc/fstab # é‡æ–°æŒ‚è½½ umount /mnt/ARS2-SMB 2\u0026gt;/dev/null mount -a ğŸ” å››ã€éªŒè¯ Samba æœåŠ¡ 1. å®‰è£… Samba å®¢æˆ·ç«¯å·¥å…· 1 yum update -y \u0026amp;\u0026amp; yum install samba-client -y 2. éªŒè¯ Samba æœåŠ¡ 1 smbclient //10.10.10.246/CentOS -U admin è¾“å…¥å¯†ç åï¼Œä½¿ç”¨ ls å‘½ä»¤æŸ¥çœ‹å…±äº«å†…å®¹ï¼ŒæŒ‰ Ctrl+C é€€å‡º\n3. æ£€æŸ¥ Samba å®‰è£…çŠ¶æ€ 1 rpm -qa | grep samba 4. æŸ¥çœ‹ Samba æœåŠ¡çŠ¶æ€ 1 2 systemctl status smb systemctl status nmb # NetBIOS åç§°æœåŠ¡ 5. æŸ¥çœ‹ Samba ç”¨æˆ·åˆ—è¡¨ 1 pdbedit -L 6. æ·»åŠ  root ç”¨æˆ·åˆ° Sambaï¼ˆå¯é€‰ï¼‰ 1 smbpasswd -a root ğŸ›¡ï¸ äº”ã€é˜²ç«å¢™å’Œ SELinux é…ç½® 1. é…ç½®é˜²ç«å¢™å…è®¸ Samba 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ systemctl status firewalld # å¦‚æœé˜²ç«å¢™å¼€å¯ï¼Œæ·»åŠ  Samba æœåŠ¡ firewall-cmd --permanent --add-service=samba firewall-cmd --reload # æˆ–è€…ç›´æ¥å¼€æ”¾ç«¯å£ firewall-cmd --permanent --add-port=139/tcp firewall-cmd --permanent --add-port=445/tcp firewall-cmd --permanent --add-port=137/udp firewall-cmd --permanent --add-port=138/udp firewall-cmd --reload 2. é…ç½® SELinuxï¼ˆå¦‚æœå¯ç”¨ï¼‰ 1 2 3 4 5 6 7 # æ£€æŸ¥ SELinux çŠ¶æ€ sestatus # å¦‚æœ SELinux å¯ç”¨ï¼Œè®¾ç½®æ­£ç¡®çš„ä¸Šä¸‹æ–‡ chcon -t samba_share_t /mnt setsebool -P samba_enable_home_dirs on setsebool -P samba_export_all_rw on ğŸ’¡ å…­ã€æ•…éšœæ’é™¤ 1. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• 1 testparm 2. æŸ¥çœ‹ Samba æ—¥å¿— 1 2 tail -f /var/log/samba/log.smbd tail -f /var/log/samba/log.nmbd 3. æµ‹è¯•ç½‘ç»œè¿é€šæ€§ 1 2 3 4 5 # æµ‹è¯•ä¸ Samba æœåŠ¡å™¨çš„è¿æ¥ ping 10.10.10.251 # æŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„å…±äº« smbclient -L //10.10.10.251 -U root 4. é‡æ–°å¯åŠ¨æœåŠ¡ 1 systemctl restart smb nmb ğŸ”’ ä¸ƒã€å®‰å…¨å»ºè®® ä½¿ç”¨å¼ºå¯†ç ï¼šä¸º Samba ç”¨æˆ·è®¾ç½®å¤æ‚å¯†ç  å®šæœŸæ›´æ–°ï¼šä¿æŒç³»ç»Ÿå’Œ Samba è½¯ä»¶åŒ…æœ€æ–° é™åˆ¶è®¿é—®ï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹ Samba ç«¯å£çš„è®¿é—® ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·ï¼šä¸º Samba å…±äº«åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼Œé¿å…ä½¿ç”¨ root å®šæœŸå¤‡ä»½é…ç½®ï¼šå¤‡ä»½ /etc/samba/smb.conf æ–‡ä»¶ ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥ Samba æ—¥å¿—æ–‡ä»¶ ğŸš€ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å·²ç»åœ¨ CentOS ä¸ŠæˆåŠŸéƒ¨ç½²å’Œé…ç½®äº† Samba æœåŠ¡ï¼Œå¯ä»¥å®ç°ä¸ Windows ç³»ç»Ÿå’Œå…¶ä»– Linux ç³»ç»Ÿçš„æ–‡ä»¶å…±äº«ã€‚æ— è®ºæ˜¯ä½œä¸ºæœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯ï¼ŒSamba éƒ½æä¾›äº†å¼ºå¤§çš„æ–‡ä»¶å…±äº«åŠŸèƒ½ï¼\n","date":"2024-12-07T08:52:25+08:00","image":"https://file.meimolihan.eu.org/img/centos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a35fc2ac/","title":"CentOS é…ç½® Samba æœåŠ¡æŒ‡å— ğŸ–¥ï¸"},{"content":"Proxmox VE å¤‡ä»½æ–‡ä»¶ OVA å¯¼å…¥æŒ‡å— âš¡ ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•å°† OVA æ ¼å¼çš„è™šæ‹Ÿæœºä»å…¶ä»–è™šæ‹ŸåŒ–å¹³å°è¿ç§»åˆ° Proxmox VEï¼ŒåŒ…å«ä»åŸºç¡€å‡†å¤‡åˆ°é«˜çº§æŠ€å·§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚\nğŸ“‘ å¯¼èˆªç›®å½• âœ¨ æœ¬æ–‡ç‰¹è‰² ğŸ“¦ ä¸€ã€å‡†å¤‡å·¥ä½œ ğŸ”§ äºŒã€OVA æ–‡ä»¶å¤„ç† ğŸ–¥ï¸ ä¸‰ã€è™šæ‹Ÿæœºå¯¼å…¥ âš™ï¸ å››ã€å¯¼å…¥åé…ç½® ğŸš€ äº”ã€å¯åŠ¨ä¸éªŒè¯ âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ ğŸ’¡ ä¸ƒã€é«˜çº§æŠ€å·§ âœ¨ æœ¬æ–‡ç‰¹è‰² ğŸ”„ å®Œæ•´è¿ç§»æµç¨‹ï¼šä» OVA è§£å‹åˆ°è™šæ‹Ÿæœºé…ç½®çš„å…¨è¿‡ç¨‹ ğŸ—ï¸ å¤šæ¶æ„æ”¯æŒï¼šé€‚ç”¨äº x86_64 å’Œ ARM æ¶æ„çš„ PVE âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šåŒ…å« BIOS/UEFI é…ç½®å’Œæ€§èƒ½è°ƒä¼˜å»ºè®® ğŸ”§ å®ç”¨è„šæœ¬ï¼šæä¾›æ‰¹é‡å¯¼å…¥å’Œæ ¼å¼è½¬æ¢è„šæœ¬ ğŸ›¡ï¸ å®‰å…¨å»ºè®®ï¼šåŒ…å«æ³¨æ„äº‹é¡¹å’Œå¤‡ä»½æ¢å¤æ–¹æ³• ğŸ“¦ ä¸€ã€å‡†å¤‡å·¥ä½œ ğŸ“ åˆ›å»ºå­˜å‚¨ç›®å½• 1 2 3 4 5 6 7 8 9 # åˆ›å»ºä¸“é—¨çš„é•œåƒå­˜å‚¨ç›®å½• mkdir -p /mnt/pve/ARS2-NFS/images # è®¾ç½®åˆé€‚çš„æ‰€æœ‰æƒå’Œæƒé™ chown -R root:root /mnt/pve/ARS2-NFS/images chmod -R 755 /mnt/pve/ARS2-NFS/images # éªŒè¯ç›®å½•åˆ›å»ºæˆåŠŸ ls -la /mnt/pve/ARS2-NFS/images ğŸŒ ä¸Šä¼  OVA æ–‡ä»¶ å°† OVA æ–‡ä»¶ä¸Šä¼ åˆ° PVE æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•ï¼š\n1 2 3 4 5 6 7 # ä½¿ç”¨ SCP ä¸Šä¼ ï¼ˆä»æœ¬åœ°è®¡ç®—æœºï¼‰ scp win10.ova root@pve-server-ip:/mnt/pve/ARS2-NFS/images/ # æˆ–è€…ä½¿ç”¨ PVE ç½‘é¡µç•Œé¢ä¸Šä¼  # 1. ç™»å½• PVE ç½‘é¡µç•Œé¢ # 2. é€‰æ‹©å¯¹åº”çš„å­˜å‚¨ # 3. ç‚¹å‡»\u0026#34;ä¸Šä¼ \u0026#34;æŒ‰é’®é€‰æ‹© OVA æ–‡ä»¶ âœ… éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥æ–‡ä»¶å¤§å°å’Œç±»å‹ cd /mnt/pve/ARS2-NFS/images ls -lh win10.ova # éªŒè¯æ–‡ä»¶ç±»å‹ file win10.ova # è®¡ç®—MD5æ ¡éªŒå’Œï¼ˆå¯é€‰ï¼‰ md5sum win10.ova ğŸ”§ äºŒã€OVA æ–‡ä»¶å¤„ç† ğŸ“¦ è§£å‹ OVA æ–‡ä»¶ 1 2 3 4 5 6 7 8 # åˆ‡æ¢åˆ°é•œåƒç›®å½• cd /mnt/pve/ARS2-NFS/images # è§£å‹ OVA æ–‡ä»¶ï¼ˆOVA æœ¬è´¨ä¸Šæ˜¯ tar å½’æ¡£æ–‡ä»¶ï¼‰ tar -xvf win10.ova # æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶ ls -la ğŸ” è§£å‹æ–‡ä»¶è¯´æ˜ è§£å‹åé€šå¸¸ä¼šå¾—åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š\nwin10.ovf - è™šæ‹Ÿæœºé…ç½®æè¿°æ–‡ä»¶ win10-disk1.vmdk - ä¸»ç³»ç»Ÿç£ç›˜ win10-disk2.vmdk - æ•°æ®ç£ç›˜ï¼ˆå¯é€‰ï¼‰ win10.mf - æ¸…å•æ–‡ä»¶ï¼ˆæ ¡éªŒç”¨ï¼‰ ğŸ“ æŸ¥çœ‹ OVF é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹è™šæ‹Ÿæœºé…ç½®ä¿¡æ¯ cat win10.ovf | grep -E \u0026#34;(OperatingSystem|Memory|CPU)\u0026#34; # æå–å…³é”®é…ç½®ä¿¡æ¯ MEMORY=$(grep -oP \u0026#39;Memory=\u0026#34;\\K[^\u0026#34;]*\u0026#39; win10.ovf) CPU=$(grep -oP \u0026#39;CPU=\u0026#34;\\K[^\u0026#34;]*\u0026#39; win10.ovf) OS_TYPE=$(grep -oP \u0026#39;OperatingSystem=\u0026#34;\\K[^\u0026#34;]*\u0026#39; win10.ovf) echo \u0026#34;å†…å­˜: $MEMORY MB\u0026#34; echo \u0026#34;CPU: $CPU æ ¸å¿ƒ\u0026#34; echo \u0026#34;æ“ä½œç³»ç»Ÿç±»å‹: $OS_TYPE\u0026#34; ğŸ–¥ï¸ ä¸‰ã€è™šæ‹Ÿæœºå¯¼å…¥ ğŸ†” åˆ›å»ºæˆ–é€‰æ‹©è™šæ‹Ÿæœº 1 2 3 4 5 6 # æŸ¥çœ‹ç°æœ‰è™šæ‹Ÿæœºåˆ—è¡¨ qm list # å¦‚æœè™šæ‹ŸæœºID 104ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆ›å»º # ä½¿ç”¨ä»OVFæ–‡ä»¶ä¸­æå–çš„é…ç½®ä¿¡æ¯ qm create 104 --name \u0026#34;Windows-10\u0026#34; --memory $MEMORY --cores $CPU --ostype $OS_TYPE ğŸ’¾ å¯¼å…¥ç£ç›˜é•œåƒ 1 2 3 4 5 6 7 8 9 10 # å¯¼å…¥ä¸»ç³»ç»Ÿç£ç›˜åˆ°æœ¬åœ°å­˜å‚¨ qm importdisk 104 win10-disk1.vmdk local --format qcow2 # å¦‚æœæœ‰æ•°æ®ç£ç›˜ï¼Œä¹Ÿä¸€å¹¶å¯¼å…¥ if [ -f \u0026#34;win10-disk2.vmdk\u0026#34; ]; then echo \u0026#34;å‘ç°æ•°æ®ç£ç›˜ï¼Œæ­£åœ¨å¯¼å…¥...\u0026#34; qm importdisk 104 win10-disk2.vmdk local-lvm --format qcow2 else echo \u0026#34;æœªæ‰¾åˆ°æ•°æ®ç£ç›˜ï¼Œè·³è¿‡å¯¼å…¥\u0026#34; fi ğŸ”„ é™„åŠ ç£ç›˜åˆ°è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10 11 12 13 # æŸ¥çœ‹å¯¼å…¥çš„ç£ç›˜æ–‡ä»¶ qm config 104 # ç£ç›˜ä¼šè‡ªåŠ¨é™„åŠ ä¸ºæœªä½¿ç”¨çš„ç£ç›˜ # éœ€è¦é€šè¿‡Webç•Œé¢æˆ–ä»¥ä¸‹å‘½ä»¤é™„åŠ ï¼š # é™„åŠ ä¸»ç£ç›˜ï¼ˆé€šå¸¸æ˜¯scsi0ï¼‰ qm set 104 --scsi0 local:104/vm-104-disk-0.qcow2 # å¦‚æœæœ‰æ•°æ®ç£ç›˜ï¼Œé™„åŠ ä¸ºç¬¬äºŒä¸ªç£ç›˜ if [ -f \u0026#34;win10-disk2.vmdk\u0026#34; ]; then qm set 104 --scsi1 local-lvm:104/vm-104-disk-1.qcow2 fi âš™ï¸ å››ã€å¯¼å…¥åé…ç½® ğŸ›ï¸ è°ƒæ•´è™šæ‹Ÿæœºè®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è®¾ç½®å¯åŠ¨é¡ºåºï¼ˆä¼˜å…ˆä»ç¡¬ç›˜å¯åŠ¨ï¼‰ qm set 104 --boot order=scsi0 # å¯ç”¨QEMUå®¢æˆ·æœºä»£ç†ï¼ˆå¦‚æœå®¢æˆ·æœºæ”¯æŒï¼‰ qm set 104 --agent 1 # è®¾ç½®æ˜¾å¡ç±»å‹ï¼ˆå¯¹äºWindowså»ºè®®ä½¿ç”¨stdï¼‰ qm set 104 --vga std # è°ƒæ•´CPUç±»å‹ï¼ˆæé«˜å…¼å®¹æ€§ï¼‰ qm set 104 --cpu host # è®¾ç½®ç½‘ç»œé€‚é…å™¨ qm set 104 --net0 virtio,bridge=vmbr0 ğŸ”§ BIOS/UEFI é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥å½“å‰BIOSè®¾ç½® qm config 104 | grep bios # å¦‚æœéœ€è¦UEFIå¯åŠ¨ï¼ˆç°ä»£Windowsç³»ç»Ÿï¼‰ qm set 104 --bios ovmf # å®‰è£…OVMFåŒ…ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ apt update \u0026amp;\u0026amp; apt install ovmf # æ·»åŠ EFIç£ç›˜ qm set 104 --efidisk0 local:1 ğŸ’¨ æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 # å¯ç”¨CPUåŠ é€Ÿï¼ˆå¦‚æœç¡¬ä»¶æ”¯æŒï¼‰ qm set 104 --cpu kvm64 # è®¾ç½®å†…å­˜æ°”çƒingï¼ˆåŠ¨æ€å†…å­˜ç®¡ç†ï¼‰ qm set 104 --balloon 1 # æ·»åŠ IOçº¿ç¨‹ï¼ˆæé«˜ç£ç›˜æ€§èƒ½ï¼‰ qm set 104 --iothread 1 qm set 104 --scsi0 local:104/vm-104-disk-0.qcow2,iothread=1 ğŸš€ äº”ã€å¯åŠ¨ä¸éªŒè¯ ğŸ”Œ å¯åŠ¨è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 # å¯åŠ¨è™šæ‹Ÿæœº qm start 104 # æŸ¥çœ‹å¯åŠ¨çŠ¶æ€ qm status 104 # æŸ¥çœ‹æ§åˆ¶å° qm terminal 104 ğŸ“Š ç›‘æ§å¯åŠ¨è¿‡ç¨‹ 1 2 3 4 5 6 7 8 # å®æ—¶æŸ¥çœ‹è™šæ‹Ÿæœºæ—¥å¿— tail -f /var/log/pve/tasks/active # æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ qm monitor 104 # æ£€æŸ¥QEMUè¿›ç¨‹ ps aux | grep qemu | grep 104 âœ… å¯¼å…¥éªŒè¯ 1 2 3 4 5 6 7 8 # éªŒè¯ç£ç›˜å·²æ­£ç¡®é™„åŠ  qm config 104 | grep scsi # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® qm config 104 # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼ˆå¦‚æœå®¢æˆ·æœºå·¥å…·å·²å®‰è£…ï¼‰ ping -c 4 \u0026lt;è™šæ‹ŸæœºIP\u0026gt; âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ ğŸ”´ å¸¸è§é—®é¢˜ ç£ç›˜æ ¼å¼å…¼å®¹æ€§\n1 2 3 4 5 # æ£€æŸ¥ç£ç›˜æ ¼å¼ qemu-img info win10-disk1.vmdk # å¦‚æœéœ€è¦è½¬æ¢æ ¼å¼ qemu-img convert -f vmdk -O qcow2 win10-disk1.vmdk win10-disk1.qcow2 é©±åŠ¨ç¨‹åºé—®é¢˜\nWindows è™šæ‹Ÿæœºå¯èƒ½éœ€è¦å®‰è£… VirtIO é©±åŠ¨ ä¸‹è½½åœ°å€: https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/ è®¸å¯è¯æ¿€æ´»\nå¯¼å…¥å Windows å¯èƒ½éœ€è¦é‡æ–°æ¿€æ´» ç¡®ä¿æœ‰åˆæ³•çš„äº§å“å¯†é’¥ âœ… æœ€ä½³å®è·µ å¤‡ä»½åŸå§‹æ–‡ä»¶\n1 2 3 4 5 # å¤‡ä»½åŸå§‹OVAæ–‡ä»¶ cp win10.ova win10.ova.backup # å¤‡ä»½å¯¼å…¥çš„ç£ç›˜ rsync -av /var/lib/vz/images/104/ /backup/vm-104/ æµ‹è¯•åå†ä¸Šçº¿\nå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å¯¼å…¥ç»“æœ ç¡®è®¤æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ æ–‡æ¡£è®°å½•\nè®°å½•å¯¼å…¥è¿‡ç¨‹å’Œé…ç½®å˜æ›´ è®°å½•ä»»ä½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ ğŸ’¡ ä¸ƒã€é«˜çº§æŠ€å·§ âš¡ æ‰¹é‡å¯¼å…¥è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/bash # OVAæ‰¹é‡å¯¼å…¥è„šæœ¬ OVA_DIR=\u0026#34;/mnt/pve/ARS2-NFS/images\u0026#34; TARGET_VMID=100 for ova_file in $OVA_DIR/*.ova; do if [ -f \u0026#34;$ova_file\u0026#34; ]; then echo \u0026#34;å¤„ç†æ–‡ä»¶: $(basename $ova_file)\u0026#34; # è§£å‹OVA tar -xvf \u0026#34;$ova_file\u0026#34; -C \u0026#34;$OVA_DIR\u0026#34; # æå–åŸºç¡€åç§° base_name=$(basename \u0026#34;$ova_file\u0026#34; .ova) # å¯¼å…¥ç£ç›˜ qm importdisk $TARGET_VMID \u0026#34;${base_name}-disk1.vmdk\u0026#34; local --format qcow2 # åˆ›å»ºè™šæ‹Ÿæœºé…ç½® qm set $TARGET_VMID --scsi0 local:$TARGET_VMID/vm-$TARGET_VMID-disk-0.qcow2 # å¢åŠ VMIDä»¥å¤‡ä¸‹ä¸€ä¸ª TARGET_VMID=$((TARGET_VMID+1)) fi done ğŸ”„ è½¬æ¢å…¶ä»–æ ¼å¼ 1 2 3 4 5 6 7 8 # ä»VHD/VHDXè½¬æ¢ qemu-img convert -f vpc -O qcow2 source.vhd target.qcow2 # ä»RAWè½¬æ¢ qemu-img convert -f raw -O qcow2 source.raw target.qcow2 # è°ƒæ•´ç£ç›˜å¤§å° qemu-img resize disk.qcow2 +20G ğŸ“Š æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 # ç›‘æ§ç£ç›˜IO iostat -x 1 # ç›‘æ§ç½‘ç»œæµé‡ iftop -i vmbr0 # ç›‘æ§è™šæ‹Ÿæœºæ€§èƒ½ vmstat 1 ğŸ’¡ ä¸“ä¸šæç¤º: åœ¨å¯¼å…¥ç”Ÿäº§ç¯å¢ƒçš„è™šæ‹Ÿæœºä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå®Œæ•´çš„å¯¼å…¥å’ŒéªŒè¯æµç¨‹ã€‚ç¡®ä¿å¤‡ä»½æ‰€æœ‰é‡è¦æ•°æ®ï¼Œå¹¶å‡†å¤‡å¥½å¯èƒ½éœ€è¦é‡æ–°å®‰è£…çš„é©±åŠ¨ç¨‹åºã€‚\nğŸ‰ Happy Virtualizing! ç¥æ‚¨å¯¼å…¥é¡ºåˆ©ï¼\n","date":"2024-12-07T08:51:13+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/949fa9e3/","title":"Proxmox VE å¤‡ä»½æ–‡ä»¶ OVA å¯¼å…¥æŒ‡å— âš¡"},{"content":"Docker éƒ¨ç½² Transmission BT ä¸‹è½½å™¨ ğŸ“¥ Transmission æ˜¯ä¸€ä¸ªè½»é‡çº§ã€å¿«é€Ÿä¸”é«˜æ•ˆçš„ BitTorrent å®¢æˆ·ç«¯ï¼Œå…·æœ‰ç®€æ´çš„ Web ç•Œé¢å’Œä¸°å¯Œçš„åŠŸèƒ½ã€‚å®ƒéå¸¸é€‚åˆåœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­è¿è¡Œï¼Œæ”¯æŒè¿œç¨‹ç®¡ç†å’Œå¤§è§„æ¨¡æ–‡ä»¶ä¸‹è½½ã€‚\nğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Transmission 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. å®‰è£… Web æ§åˆ¶ç•Œé¢ ğŸ–¥ï¸ 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Transmission 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ 3. æŒ‡å®šä¸‹è½½ç›®å½• ğŸ“¥ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ“¥ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Transmission å®˜ç½‘åœ°å€ï¼š https://transmissionbt.com/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/linuxserver/docker-transmission ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/linuxserver/transmission ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âš¡ è½»é‡é«˜æ•ˆ èµ„æºå ç”¨ä½ï¼Œè¿è¡Œé€Ÿåº¦å¿« é€‚åˆæœåŠ¡å™¨ç¯å¢ƒé•¿æœŸè¿è¡Œ ğŸŒ Web ç•Œé¢ æ”¯æŒè¿œç¨‹ç®¡ç†ä¸‹è½½ä»»åŠ¡ éšæ—¶éšåœ°ç®¡ç†ä¸‹è½½ ğŸ“¶ BT åè®®æ”¯æŒ å®Œæ•´çš„ BitTorrent åè®®æ”¯æŒ ç¨³å®šé«˜æ•ˆçš„ä¸‹è½½ä½“éªŒ ğŸ“¡ RSS è®¢é˜… æ”¯æŒ RSS è®¢é˜…å’Œè‡ªåŠ¨ä¸‹è½½ è‡ªåŠ¨åŒ–å†…å®¹è·å– ğŸ“Š å¸¦å®½ç®¡ç† å¸¦å®½è°ƒåº¦å’Œé™é€ŸåŠŸèƒ½ çµæ´»çš„ç½‘ç»œèµ„æºæ§åˆ¶ ğŸ“± ç§»åŠ¨ç«¯å‹å¥½ å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯é€‚é… æ‰‹æœºå¹³æ¿å‡å¯ç®¡ç† ğŸ”Œ API æ¥å£ ä¸°å¯Œçš„ API æ¥å£ æ”¯æŒç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Transmission 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 mkdir -p /mnt/mydisk/home/transmission \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: transmission: image: linuxserver/transmission:latest container_name: transmission network_mode: bridge restart: no environment: - PUID=1000 - PGID=1000 - TZ=Asia/Shanghai - TRANSMISSION_WEB_HOME=/transmission-web-control/web - USER=admin - PASS=yifan0719 - WHITELIST= - PEERPORT= - HOST_WHITELIST= ports: - 9091:9091 - 51413:51413 - 51413:51413/udp volumes: - ./transmission:/config - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº:/downloads - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº/ç”µè§†å‰§é›†:/downloads/ç”µè§†å‰§é›† - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº/åŠ¨ç”»ç”µå½±:/downloads/åŠ¨ç”»ç”µå½± - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº/åè¯­ç”µå½±:/downloads/åè¯­ç”µå½± - /vol2/1000/å…‰å½±é›†/ä¸‹è½½åŒº/å¤–è¯­ç”µå½±:/downloads/å¤–è¯­ç”µå½± - ./transmission/folder:/watch - ./transmission/transmission-web-control:/transmission-web-control # ç½‘é¡µUIæ–‡ä»¶å¤¹ EOF ğŸ” é»˜è®¤ç™»å½•ä¿¡æ¯ï¼š\nç”¨æˆ·å: admin\nå¯†ç : your_secure_password (è¯·æ›¿æ¢ä¸ºå¼ºå¯†ç )\nâš ï¸ é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼\n2. å®‰è£… Web æ§åˆ¶ç•Œé¢ ğŸ–¥ï¸ 1 2 3 4 5 # ä¸‹è½½å¹¶å®‰è£… Transmission Web Control wget -O /tmp/install-tr-control-cn.sh https://raw.githubusercontent.com/ronggang/transmission-web-control/master/release/install-tr-control-cn.sh \u0026amp;\u0026amp; \\ chmod +x /tmp/install-tr-control-cn.sh \u0026amp;\u0026amp; \\ cd /tmp \u0026amp;\u0026amp; \\ bash install-tr-control-cn.sh ğŸ“ å®‰è£…è¿‡ç¨‹ä¸­ï¼š\né€‰æ‹© 6 æŒ‡å®šå®‰è£…ç›®å½• è¾“å…¥ç›®å½•è·¯å¾„: /mnt/mydisk/home/transmission é€‰æ‹© 1 å®‰è£…æœ€æ–°çš„å‘å¸ƒç‰ˆæœ¬ 3. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Transmission 1. è®¿é—® Web ç•Œé¢ ğŸ’» ç®¡ç†ç•Œé¢: http://ä½ çš„æœåŠ¡å™¨IP:9091 åŸŸåè®¿é—®: https://transmission.example.com (é…ç½®åå‘ä»£ç†å) 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤è´¦æˆ·ç™»å½•ï¼ˆadmin / ä½ è®¾ç½®çš„å¯†ç ï¼‰ ç«‹å³ä¿®æ”¹ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç  é…ç½®ä¸‹è½½ç›®å½•ã€é€Ÿåº¦é™åˆ¶ç­‰è®¾ç½® å¼€å§‹æ·»åŠ ä¸‹è½½ä»»åŠ¡ 3. æŒ‡å®šä¸‹è½½ç›®å½• ğŸ“¥ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://transmission.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/transmission.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name transmission.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:9091; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/transmission # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop transmission # åœæ­¢å®¹å™¨ docker start transmission # å¯åŠ¨å®¹å™¨ docker restart transmission # é‡å¯å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it transmission sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs transmission # æŸ¥çœ‹æ—¥å¿— docker logs -f transmission # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 transmission # æŸ¥çœ‹æœ€å100è¡Œ 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi linuxserver/transmission:latest # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ“¥ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Transmission BT ä¸‹è½½å™¨ï¼ŒæŒæ¡äº†é«˜æ•ˆç¨³å®šçš„è¿œç¨‹ä¸‹è½½ç®¡ç†èƒ½åŠ›ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ æé€Ÿä¸‹è½½ äº«å—è½»é‡é«˜æ•ˆçš„ BitTorrent ä¸‹è½½ä½“éªŒï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç½‘ç»œå¸¦å®½\nğŸŒ è¿œç¨‹ç®¡ç† éšæ—¶éšåœ°é€šè¿‡ Web ç•Œé¢æ·»åŠ å’Œç®¡ç†ä¸‹è½½ä»»åŠ¡ï¼Œæ‰“ç ´æ—¶ç©ºé™åˆ¶\nğŸ”§ ç²¾ç»†æ§åˆ¶ é€šè¿‡ä¸°å¯Œçš„è®¾ç½®é€‰é¡¹ç²¾ç¡®æ§åˆ¶ä¸‹è½½é€Ÿåº¦å’Œè¿æ¥å‚æ•°\nğŸ“¶ ç¨³å®šå¯é  åŸºäºæˆç†Ÿçš„ BT åè®®æ ˆï¼Œç¡®ä¿ä¸‹è½½ä»»åŠ¡ç¨³å®šå®Œæˆ\nä¸‹è½½ä¸ä»…æ˜¯è·å–èµ„æºçš„æ–¹å¼ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„æ•ˆç‡å¼•æ“ã€‚æ„¿ Transmission æˆä¸ºä½ å¯é çš„ä¸‹è½½ä¼™ä¼´ï¼Œè®©ä½ çš„æ¯ä¸€æ¬¡èµ„æºè·å–éƒ½å˜å¾—ç®€å•ã€é«˜æ•ˆã€ç¨³å®šã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé‡Šæ”¾ä½ çš„ç½‘ç»œæ½œèƒ½ï¼Œä½“éªŒä¸“ä¸šçº§ BT ä¸‹è½½çš„å¼ºå¤§åŠŸèƒ½ï¼ğŸŒŠ\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Transmission å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¸‹è½½æ„‰å¿«ï¼Œèµ„æºæ»¡è½½ï¼ğŸ‰\n","date":"2024-12-07T08:50:06+08:00","image":"https://file.meimolihan.eu.org/img/transmission-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e2c01781/","title":"Docker éƒ¨ç½² Transmission BT ä¸‹è½½å™¨ ğŸ“¥"},{"content":"Docker éƒ¨ç½² Jellyfin åª’ä½“æœåŠ¡å™¨ ğŸ¬ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Jellyfin 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Jellyfin 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå½±éŸ³ï¼Œç•…äº«æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Jellyfin å®˜ç½‘åœ°å€ï¼š https://jellyfin.org/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/jellyfin/jellyfin ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/jellyfin/jellyfin Jellyfin æ˜¯ä¸€ä¸ªå¼€æºçš„åª’ä½“æœåŠ¡å™¨è½¯ä»¶ï¼Œæ”¯æŒè‡ªåŠ¨æ•´ç†ç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹å’Œç…§ç‰‡åº“ï¼Œæä¾›å¤šå¹³å°å®¢æˆ·ç«¯æ”¯æŒå’Œè¿œç¨‹è®¿é—®åŠŸèƒ½ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„åª’ä½“æœåŠ¡å™¨ï¼Œäº«å—é«˜å“è´¨çš„ä¸ªäººåª’ä½“æµåª’ä½“ä½“éªŒã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¥ åª’ä½“ç®¡ç† è‡ªåŠ¨æ•´ç†ç”µå½±ã€ç”µè§†å‰§ã€éŸ³ä¹å’Œç…§ç‰‡åº“ æ™ºèƒ½è¯†åˆ«å…ƒæ•°æ®ï¼Œç”Ÿæˆç²¾ç¾åª’ä½“åº“ ğŸŒ å¤šå¹³å°æ”¯æŒ æ”¯æŒ Webã€ç§»åŠ¨ç«¯ã€æ™ºèƒ½ç”µè§†ç­‰å¤šç§å®¢æˆ·ç«¯ éšæ—¶éšåœ°äº«å—åª’ä½“å†…å®¹ ğŸ”’ å®Œå…¨å¼€æº å®Œå…¨å…è´¹ä¸”å¼€æºï¼Œæ— è®¢é˜…è´¹ç”¨ æ— éšè—æˆæœ¬ï¼Œå®Œå…¨å¯æ§ ğŸ“± è¿œç¨‹è®¿é—® æ”¯æŒå¤–ç½‘è®¿é—®å®¶åº­åª’ä½“åº“ æ‰“ç ´åœ°åŸŸé™åˆ¶ ğŸ¨ å…ƒæ•°æ®æŠ“å– è‡ªåŠ¨è·å–å½±ç‰‡ä¿¡æ¯ã€æµ·æŠ¥å’Œå­—å¹• ä¸°å¯Œåª’ä½“åº“ä¿¡æ¯ ğŸ”„ å®æ—¶è½¬ç  æ”¯æŒå¤šç§æ ¼å¼çš„ç¡¬ä»¶åŠ é€Ÿè½¬ç  ä¼˜åŒ–æ’­æ”¾ä½“éªŒï¼ŒèŠ‚çœå¸¦å®½ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ æ”¯æŒå¤šç”¨æˆ·å’Œæƒé™æ§åˆ¶ é€‚åˆå®¶åº­å…±äº«ä½¿ç”¨ ğŸ“Š è§‚çœ‹ç»Ÿè®¡ è®°å½•è§‚çœ‹å†å²å’Œè¿›åº¦åŒæ­¥ æ–¹ä¾¿ç»­æ’­å’Œç®¡ç† ğŸ³ ä¸€ã€Docker éƒ¨ç½² Jellyfin 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 mkdir -p /mnt/mydisk/home/jellyfin \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: jellyfin: container_name: jellyfin image: nyanmisaka/jellyfin:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;8096:8096\u0026#34; volumes: - ./config:/config - ./cache:/cache - /mnt/ARS2-NFS/nas/link:/media - /mnt:/mnt:rslave privileged: true environment: - TZ=Asia/Shanghai - PUID=0 - PGID=0 - UMASK_SET=022 devices: - /dev/dri:/dev/dri EOF ğŸ’¡ é•œåƒè¯´æ˜ï¼š\nnyanmisaka/jellyfin:latestï¼šè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜çš„é•œåƒ nyanmisaka/jellyfin:latest-rockchipï¼šARM Rockchip æ¶æ„ä¸“ç”¨é•œåƒ jellyfin/jellyfin:latestï¼šå®˜æ–¹é•œåƒï¼ˆå¯èƒ½å­˜åœ¨ä¸­æ–‡ä¹±ç ï¼‰ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Jellyfin 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8096 å±€åŸŸç½‘è®¿é—®ï¼š http://10.10.10.245:8096 åŸŸåè®¿é—®ï¼š https://jellyfin.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ è®¾ç½®ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç  æ·»åŠ åª’ä½“åº“ï¼š ç”µå½±ï¼šæŒ‡å‘ /media/Movies ç”µè§†å‰§ï¼šæŒ‡å‘ /media/TV Shows éŸ³ä¹ï¼šæŒ‡å‘ /media/Musicï¼ˆå¦‚å·²æŒ‚è½½ï¼‰ ç…§ç‰‡ï¼šæŒ‡å‘ /media/Photosï¼ˆå¦‚å·²æŒ‚è½½ï¼‰ é…ç½®å…ƒæ•°æ®ä¸‹è½½å™¨ è®¾ç½®ç¡¬ä»¶åŠ é€Ÿé€‰é¡¹ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://jellyfin.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/jellyfin.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name jellyfin.yourdomain.com; # é‡å®šå‘åˆ° HTTPS return 301 https://$server_name$request_uri; } server { listen 443 ssl; server_name jellyfin.yourdomain.com; ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 20G; location / { proxy_pass http://127.0.0.1:8096; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; proxy_connect_timeout 300s; } # é™æ€èµ„æºç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; proxy_pass http://127.0.0.1:8096; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå½±éŸ³ï¼Œç•…äº«æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Jellyfin åª’ä½“æœåŠ¡å™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ¬ ç§äººå½±é™¢ éšæ—¶éšåœ°äº«å—ä¸ªäººåª’ä½“åº“ä¸­çš„ç”µå½±ã€ç”µè§†å‰§å’ŒéŸ³ä¹\nğŸŒ å¤šç«¯åŒæ­¥ åœ¨æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘å’Œæ™ºèƒ½ç”µè§†ä¸Šæ— ç¼ç»­æ’­è§‚çœ‹è¿›åº¦\nğŸ¨ æ™ºèƒ½ç®¡ç† è‡ªåŠ¨æ•´ç†åª’ä½“åº“ï¼Œè·å–ç²¾ç¾æµ·æŠ¥å’Œå®Œæ•´å…ƒæ•°æ®ä¿¡æ¯\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­å…±äº« ä¸å®¶äººæœ‹å‹å…±äº«åª’ä½“èµ„æºï¼Œè®¾ç½®ä¸ªæ€§åŒ–è§‚çœ‹æƒé™\nå½±éŸ³å¨±ä¹ï¼Œæ˜¯ç°ä»£æ•°å­—ç”Ÿæ´»çš„é‡è¦éƒ¨åˆ†ã€‚æ„¿ Jellyfin æˆä¸ºä½ ä¸“å±çš„åª’ä½“ç®¡å®¶ï¼Œä¸ºä½ å‘ˆç°æ¯ä¸€éƒ¨ç²¾å½©å½±ç‰‡ï¼Œé™ªä¼´æ¯ä¸€ä¸ªä¼‘é—²æ—¶å…‰ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ•´ç†æ”¶è—ï¼Œç•…äº«å½±éŸ³â€”â€”æ„å»ºä½ ä¸ªäººçš„æµåª’ä½“å¸å›½å§ï¼ğŸ¥\nğŸ“Œ æŒç»­ä¼˜åŒ–ï¼šå»ºè®®å®šæœŸæ£€æŸ¥ Jellyfin å®˜æ–¹æ›´æ–° ï¼Œè·å–æ€§èƒ½æå‡å’Œæ–°åŠŸèƒ½\nğŸ› äº¤æµæ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯è®¿é—® å®˜æ–¹è®ºå› è·å–ç¤¾åŒºå¸®åŠ©\nç¥ä½ è§‚å½±æ„‰å¿«ï¼Œä½“éªŒå‡çº§ï¼ğŸ‰\n","date":"2024-12-07T08:49:05+08:00","image":"https://file.meimolihan.eu.org/img/jellyfin-01.webp","permalink":"https://blog.meimolihan.eu.org/p/26bcce4a/","title":"Docker éƒ¨ç½² Jellyfin åª’ä½“æœåŠ¡å™¨ ğŸ¬"},{"content":"Docker éƒ¨ç½² Portainer å®¹å™¨ç®¡ç†å¹³å° ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Portainer 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå®¹å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Portainer å®˜ç½‘åœ°å€ï¼š https://www.portainer.io/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/outlovecn/portainer-cn ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/outlovecn/portainer-cn Portainer æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Docker ç®¡ç†ç•Œé¢ï¼Œæä¾›ç›´è§‚çš„ Web ç•Œé¢ç®¡ç† Docker ç¯å¢ƒå’Œå®¹å™¨ã€‚å®ƒæ”¯æŒ Docker å’Œ Kubernetes ç¯å¢ƒç®¡ç†ï¼Œå¯ä»¥è½»æ¾åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å’Œåˆ é™¤å®¹å™¨ï¼Œå¹¶æä¾›å®æ—¶èµ„æºç›‘æ§åŠŸèƒ½ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ–¥ï¸ å¯è§†åŒ–ç•Œé¢ æä¾›ç›´è§‚çš„ Web ç•Œé¢ç®¡ç† Docker ç¯å¢ƒå’Œå®¹å™¨ æ— éœ€å‘½ä»¤è¡Œæ“ä½œï¼Œç®€åŒ–ç®¡ç† âš¡ è½»é‡é«˜æ•ˆ èµ„æºå ç”¨å°‘ï¼Œå“åº”é€Ÿåº¦å¿« ä½èµ„æºæ¶ˆè€—ï¼Œå¿«é€Ÿå“åº” ğŸ”„ å¤šç¯å¢ƒæ”¯æŒ æ”¯æŒ Docker å’Œ Kubernetes ç¯å¢ƒç®¡ç† ç»Ÿä¸€ç®¡ç†å¤šç§å®¹å™¨ç¯å¢ƒ ğŸ› ï¸ å®¹å™¨ç®¡ç† è½»æ¾åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å’Œåˆ é™¤å®¹å™¨ å®Œæ•´çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† ğŸ“Š èµ„æºç›‘æ§ å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ å…¨é¢æŒæ¡å®¹å™¨è¿è¡ŒçŠ¶æ€ ğŸ‘¥ ç”¨æˆ·ç®¡ç† æ”¯æŒå¤šç”¨æˆ·å’Œæƒé™æ§åˆ¶ å®‰å…¨çš„å›¢é˜Ÿåä½œç®¡ç† ğŸŒ é›†ç¾¤ç®¡ç† æ”¯æŒ Docker Swarm å’Œ Kubernetes é›†ç¾¤ ä¾¿æ·çš„é›†ç¾¤ç®¡ç†åŠŸèƒ½ ğŸ”’ å®‰å…¨å¯é  æä¾›åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ ä¿éšœç³»ç»Ÿå®‰å…¨ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Portainer 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/portainer \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: portainer: container_name: portainer image: outlovecn/portainer-cn:latest restart: unless-stopped ports: - \u0026#34;9000:9000\u0026#34; volumes: - ./data:/data - /var/run/docker.sock:/var/run/docker.sock environment: - TZ=Asia/Shanghai EOF ğŸ” å®‰å…¨æç¤º: é¦–æ¬¡è®¿é—®éœ€è¦è®¾ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨æŒ‡å— 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:9000 IPè®¿é—®: http://æœåŠ¡å™¨IP:9000 åŸŸåè®¿é—®: é…ç½®åå‘ä»£ç†åå¯ä½¿ç”¨åŸŸåè®¿é—® 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼š è®¾ç½®ç”¨æˆ·åå’Œå¯†ç  ç¡®è®¤å¯†ç  è¿æ¥ Docker ç¯å¢ƒï¼š é€‰æ‹©\u0026quot;æœ¬åœ°\u0026quot;ç¯å¢ƒ ç‚¹å‡»\u0026quot;è¿æ¥\u0026quot;æŒ‰é’® å¼€å§‹ç®¡ç† Docker å®¹å™¨å’Œèµ„æº ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://portainer.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/portainer.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name portainer.example.com; # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:9000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/portainer # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop portainer docker start portainer docker restart portainer # åˆ é™¤å®¹å™¨ docker rm portainer docker rm -f portainer # è¿›å…¥å®¹å™¨Shell docker exec -it portainer sh # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect portainer docker stats portainer # å®¹å™¨æ—¥å¿—ç®¡ç† docker logs portainer docker logs -f portainer docker logs --tail 100 portainer docker logs -t portainer 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi outlovecn/portainer-cn:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªå®¹å™¨ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Portainer å®¹å™¨ç®¡ç†å¹³å°ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ³ ç›´è§‚ç®¡ç† é€šè¿‡å‹å¥½çš„ Web ç•Œé¢è½»æ¾ç®¡ç† Docker å®¹å™¨ã€é•œåƒå’Œç½‘ç»œï¼Œå‘Šåˆ«å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œ\nğŸ“Š å…¨é¢ç›‘æ§ å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µå’Œè¿è¡ŒçŠ¶æ€ï¼Œå…¨é¢æŒæ¡ Docker ç¯å¢ƒè¿è¡ŒçŠ¶å†µ\nâš¡ é«˜æ•ˆæ“ä½œ ä¸€é”®éƒ¨ç½²ã€å¯åŠ¨ã€åœæ­¢å’Œåˆ é™¤å®¹å™¨ï¼Œå¤§å¹…æå‡å®¹å™¨ç®¡ç†æ•ˆç‡å’Œä¾¿æ·æ€§\nğŸ”’ å®‰å…¨å¯é  åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¿éšœå®¹å™¨ç¯å¢ƒçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§\nå®¹å™¨åŒ–æŠ€æœ¯æ˜¯ç°ä»£åº”ç”¨éƒ¨ç½²çš„æ ¸å¿ƒï¼Œå¯è§†åŒ–ç®¡ç†æ˜¯æ•ˆç‡æå‡çš„å…³é”®ã€‚æ„¿ Portainer æˆä¸ºä½ å®¹å™¨ç®¡ç†æ—…ç¨‹ä¸­çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ ç®€åŒ–è¿ç»´å·¥ä½œï¼Œæå‡ç®¡ç†æ•ˆç‡ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç®€åŒ–è¿ç»´ï¼Œæå‡æ•ˆç‡â€”â€”æ„å»ºä½ ç›´è§‚é«˜æ•ˆçš„å®¹å™¨ç®¡ç†å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ Portainer é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œç®¡ç†é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T08:48:10+08:00","image":"https://file.meimolihan.eu.org/img/docker-portainer-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ffdadb8d/","title":"Docker éƒ¨ç½² Portainer å®¹å™¨ç®¡ç†å¹³å° ğŸ³"},{"content":"Docker éƒ¨ç½²é˜¿é‡Œäº‘ WebDAV æœåŠ¡ ğŸš€ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²é˜¿é‡Œäº‘ WebDAV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨é˜¿é‡Œäº‘ WebDAV 1. Rclone æŒ‚è½½é˜¿é‡Œäº‘ç›˜ ğŸ’» 2. ä½¿ç”¨æç¤ºä¸æ•…éšœæ’é™¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ â˜ï¸ å¯èˆªäº‘ç«¯ï¼Œå­˜å‚¨æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/messense/aliyundrive-webdav ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/messense/aliyundrive-webdav é˜¿é‡Œäº‘ WebDAV æ˜¯ä¸€ä¸ªå°†é˜¿é‡Œäº‘ç›˜è½¬æ¢ä¸º WebDAV åè®®çš„å·¥å…·ï¼Œå…è®¸ä½ é€šè¿‡æ ‡å‡†çš„ WebDAV å®¢æˆ·ç«¯è®¿é—®å’Œç®¡ç†é˜¿é‡Œäº‘ç›˜ä¸­çš„æ–‡ä»¶ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥å°†é˜¿é‡Œäº‘ç›˜æŒ‚è½½ä¸ºæœ¬åœ°ç£ç›˜ï¼Œæˆ–åœ¨å„ç§åº”ç”¨ä¸­ç›´æ¥ä½¿ç”¨äº‘ç›˜ä½œä¸ºå­˜å‚¨ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ â˜ï¸ äº‘ç›˜è½¬æ¢ å°†é˜¿é‡Œäº‘ç›˜è½¬æ¢ä¸º WebDAV æœåŠ¡ æ ‡å‡†åè®®æ”¯æŒï¼Œå¹¿æ³›å…¼å®¹å„ç§å®¢æˆ·ç«¯ ğŸ“ æ–‡ä»¶ç®¡ç† ä¿æŒæ–‡ä»¶ç»“æ„å’Œæƒé™ å®Œæ•´ä¿ç•™äº‘ç›˜æ–‡ä»¶ç»“æ„å’Œå…ƒæ•°æ® âš¡ é«˜é€Ÿä¼ è¾“ æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ ä¼˜åŒ–ä¼ è¾“æ€§èƒ½ï¼Œæ”¯æŒå¤§æ–‡ä»¶å¤„ç† ğŸ³ Docker éƒ¨ç½² å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ ç®€å•æ˜“ç”¨ï¼Œå¿«é€Ÿéƒ¨ç½²å’Œè¿ç§» ğŸ” å®‰å…¨è®¤è¯ WebDAV è®¤è¯æœºåˆ¶ æ”¯æŒç”¨æˆ·åå¯†ç è®¤è¯ï¼Œä¿éšœæ•°æ®å®‰å…¨ ğŸ”„ å®æ—¶åŒæ­¥ æ–‡ä»¶å˜æ›´å®æ—¶åŒæ­¥ äº‘ç›˜æ–‡ä»¶å˜æ›´å³æ—¶åæ˜ åˆ° WebDAV æœåŠ¡ ğŸŒ å¤šå¹³å°æ”¯æŒ è·¨å¹³å°å®¢æˆ·ç«¯æ”¯æŒ æ”¯æŒ Windowsã€macOSã€Linux ç­‰ç³»ç»Ÿ ğŸ“Š èµ„æºä¼˜åŒ– è½»é‡çº§ä½èµ„æºå ç”¨ é«˜æ•ˆèµ„æºåˆ©ç”¨ï¼Œé€‚åˆé•¿æœŸè¿è¡Œ ğŸ³ ä¸€ã€Docker éƒ¨ç½²é˜¿é‡Œäº‘ WebDAV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/aliyun-webdav \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: aliyun-webdav: container_name: aliyun-webdav image: messense/aliyundrive-webdav:latest restart: unless-stopped ports: - \u0026#34;8080:8080\u0026#34; volumes: - ./aliyundrive-webdav/:/etc/aliyundrive-webdav/ environment: - REFRESH_TOKEN=your_refresh_token_here # âš ï¸ å¡«å…¥ä½ çš„é˜¿é‡Œäº‘ç›˜ Refresh Token - WEBDAV_AUTH_USER=admin # WebDAV è®¤è¯ç”¨æˆ·å - WEBDAV_AUTH_PASSWORD=your_secure_password # âš ï¸ WebDAV è®¤è¯å¯†ç  EOF ğŸ” é‡è¦æç¤ºï¼šå°† your_refresh_token_here å’Œ your_secure_password æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å‚æ•°ï¼\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨é˜¿é‡Œäº‘ WebDAV 1. Rclone æŒ‚è½½é˜¿é‡Œäº‘ç›˜ ğŸ’» å®‰è£…å¿…è¦è½¯ä»¶ 1 2 3 opkg update \u0026amp;\u0026amp; \\ opkg install fuse3-utils \u0026amp;\u0026amp; \\ opkg install rclone åˆ›å»ºæŒ‚è½½ç›®å½• 1 mkdir -p /mnt/aliyun é…ç½® Rclone 1 rclone config æŒ‚è½½é˜¿é‡Œäº‘ç›˜ 1 2 3 4 rclone mount Aliyun: /mnt/aliyun \\ --config /root/.config/rclone/rclone.conf \\ --vfs-cache-mode full \\ --daemon 2. ä½¿ç”¨æç¤ºä¸æ•…éšœæ’é™¤ ğŸ¯ è·å– Refresh Token è®¿é—® https://alist.nn.ci/tool/aliyundrive/request.html è·å– Refresh Token\néªŒè¯æŒ‚è½½ 1 cd /mnt/aliyun \u0026amp;\u0026amp; ls å¸è½½æŒ‚è½½ 1 fusermount -uz /mnt/aliyun ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/aliyun-webdav.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name webdav.yourdomain.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦é…ç½® ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/key.pem; ssl_protocols TLSv1.2 TLSv1.3; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; # WebDAV é…ç½® client_max_body_size 0; # ä¸é™åˆ¶æ–‡ä»¶å¤§å° location / { proxy_pass http://127.0.0.1:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebDAV æ”¯æŒ proxy_http_version 1.1; proxy_buffering off; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/aliyun-webdav # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop aliyun-webdav docker start aliyun-webdav docker restart aliyun-webdav # è¿›å…¥å®¹å™¨Shell docker exec -it aliyun-webdav sh docker exec -it aliyun-webdav bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs aliyun-webdav docker logs -f aliyun-webdav docker logs --tail 100 aliyun-webdav 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi messense/aliyundrive-webdav:latest # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ â˜ï¸ å¯èˆªäº‘ç«¯ï¼Œå­˜å‚¨æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†é˜¿é‡Œäº‘ WebDAV æœåŠ¡ï¼ŒæŒæ¡äº†å°†é˜¿é‡Œäº‘ç›˜è½¬æ¢ä¸ºæ ‡å‡† WebDAV åè®®çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ æ— ç¼é›†æˆ å°†é˜¿é‡Œäº‘ç›˜æŒ‚è½½ä¸ºæœ¬åœ°ç£ç›˜ï¼Œåœ¨å„ç§åº”ç”¨ä¸­ç›´æ¥ä½¿ç”¨äº‘ç«¯å­˜å‚¨\nğŸš€ é«˜é€Ÿä¼ è¾“ äº«å—ä¼˜åŒ–çš„å¤§æ–‡ä»¶ä¼ è¾“æ€§èƒ½ï¼Œæ‰“ç ´ä¼ ç»Ÿç½‘ç›˜çš„é€Ÿåº¦é™åˆ¶\nğŸ”’ å®‰å…¨è®¿é—® é€šè¿‡ WebDAV è®¤è¯æœºåˆ¶ä¿éšœæ•°æ®å®‰å…¨ï¼Œç§æœ‰åŒ–éƒ¨ç½²ç¡®ä¿éšç§æ— å¿§\nğŸ“± å¤šç«¯å…¼å®¹ åœ¨ Windowsã€macOSã€Linux ç­‰ç³»ç»Ÿä¸Šæ— ç¼è®¿é—®å’Œç®¡ç†æ–‡ä»¶\näº‘ç«¯å­˜å‚¨ä¸ä»…æ˜¯æ•°æ®å¤‡ä»½çš„æ–¹å¼ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„æ™ºèƒ½åŸºçŸ³ã€‚æ„¿é˜¿é‡Œäº‘ WebDAV æœåŠ¡æˆä¸ºä½ è¿æ¥æœ¬åœ°ä¸äº‘ç«¯çš„æ¡¥æ¢ï¼Œè®©æ¯ä¸€æ¬¡æ–‡ä»¶è®¿é—®éƒ½å˜å¾—ç®€å•ã€å¿«é€Ÿã€å®‰å…¨ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé‡Šæ”¾ä½ çš„äº‘ç«¯å­˜å‚¨æ½œèƒ½ï¼Œä½“éªŒæœ¬åœ°åŒ–è®¿é—®çš„ä¾¿æ·ä¸é«˜æ•ˆï¼âš¡\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ é˜¿é‡Œäº‘ WebDAV å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œäº‘ç«¯å­˜å‚¨å¾—å¿ƒåº”æ‰‹ï¼ğŸ‰\n","date":"2024-12-07T08:47:19+08:00","image":"https://file.meimolihan.eu.org/img/aliyun-webdav-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ab220604/","title":"Docker éƒ¨ç½²é˜¿é‡Œäº‘ WebDAV æœåŠ¡ ğŸš€"},{"content":"iStoreOS NFS é…ç½®ä¸ç®¡ç†æŒ‡å— ğŸš€ ä¸€ä»½è¯¦ç»†ä¸”ç”ŸåŠ¨çš„æŒ‡å—ï¼Œå¸®åŠ©æ‚¨åœ¨ iStoreOS ä¸Šè½»æ¾é…ç½®å’Œç®¡ç† NFS å…±äº«ï¼\nğŸ“– å¯¼èˆªç›®å½• âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ“¦ å®‰è£… NFS è½¯ä»¶åŒ… âš™ï¸ NFS æœåŠ¡ç«¯é…ç½® ğŸ–¥ï¸ SSH å‘½ä»¤è¡Œé…ç½® ğŸŒ Web ç•Œé¢é…ç½® ğŸ”— NFS å®¢æˆ·ç«¯é…ç½® â³ ä¸´æ—¶æŒ‚è½½ ğŸ”§ æ°¸ä¹…æŒ‚è½½ ğŸ› ï¸ ç®¡ç†å‘½ä»¤ ğŸ“Š ç›‘æ§è„šæœ¬ ğŸ› æ•…éšœæ’é™¤ ğŸ”’ å®‰å…¨å»ºè®® âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ iStoreOS æä¾›äº†å¼ºå¤§ä¸”çµæ´»çš„ NFSï¼ˆNetwork File Systemï¼‰æ”¯æŒï¼Œä½¿æ‚¨èƒ½å¤Ÿï¼š\nğŸ—‚ï¸ è½»æ¾å…±äº«æ–‡ä»¶ï¼šåœ¨å±€åŸŸç½‘å†…å¤šè®¾å¤‡é—´å¿«é€Ÿå…±äº«æ–‡ä»¶å’Œç›®å½• âš¡ é«˜é€Ÿä¼ è¾“ï¼šNFS åè®®ä¸º Linux/Unix ç³»ç»Ÿæä¾›é«˜æ•ˆçš„æ–‡ä»¶è®¿é—®æ€§èƒ½ ğŸ”§ ç®€å•é…ç½®ï¼šé€šè¿‡ SSH å‘½ä»¤è¡Œæˆ–ç›´è§‚çš„ Web ç•Œé¢ä¸¤ç§æ–¹å¼é…ç½® ğŸ›¡ï¸ æƒé™æ§åˆ¶ï¼šå¯ç²¾ç»†è®¾ç½®è®¿é—®æƒé™å’Œå®¢æˆ·ç«¯é™åˆ¶ ğŸ“± å¤šè®¾å¤‡å…¼å®¹ï¼šæ”¯æŒä¸å„ç§ Linux å‘è¡Œç‰ˆã€macOS å’Œ Windowsï¼ˆéœ€å®‰è£…NFSå®¢æˆ·ç«¯ï¼‰å…±äº«æ–‡ä»¶ ğŸ”„ æŒä¹…åŒ–æŒ‚è½½ï¼šæ”¯æŒå¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼Œç¡®ä¿æœåŠ¡é•¿æœŸç¨³å®šè¿è¡Œ ğŸ“¦ å®‰è£… NFS è½¯ä»¶åŒ… é€šè¿‡ SSH ç™»å½• iStoreOSï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€è½¯ä»¶åŒ…ï¼š\n1 2 opkg update opkg install nfs-utils kmod-fs-nfs kmod-fs-nfs-common nfs-kernel-server ğŸ’¡ æç¤ºï¼šå®‰è£…å®Œæˆåå»ºè®®é‡å¯ç³»ç»Ÿä»¥ç¡®ä¿æ‰€æœ‰æ¨¡å—æ­£ç¡®åŠ è½½\nâš™ï¸ NFS æœåŠ¡ç«¯é…ç½® ğŸ–¥ï¸ SSH å‘½ä»¤è¡Œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºå…±äº«ç›®å½•ï¼ˆä»¥ /mnt/mydisk ä¸ºä¾‹ï¼‰ mkdir -p /mnt/mydisk chmod -R 755 /mnt/mydisk # ç¼–è¾‘ exports é…ç½®æ–‡ä»¶ cat \u0026gt; /etc/exports \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /mnt/mydisk *(rw,fsid=0,no_subtree_check,no_root_squash,insecure,sync) EOF # é‡æ–°åŠ è½½é…ç½®å¹¶å¯åŠ¨æœåŠ¡ exportfs -r /etc/init.d/nfsd start /etc/init.d/rpcbind start # è®¾ç½®å¼€æœºè‡ªå¯ /etc/init.d/nfsd enable /etc/init.d/rpcbind enable ğŸ” é…ç½®é€‰é¡¹è¯´æ˜ï¼š\nrwï¼šè¯»å†™æƒé™ no_root_squashï¼šå…è®¸ root ç”¨æˆ·è®¿é—® syncï¼šåŒæ­¥å†™å…¥ï¼Œæé«˜æ•°æ®å®‰å…¨æ€§ insecureï¼šå…è®¸éç‰¹æƒç«¯å£è®¿é—® ğŸŒ Web ç•Œé¢é…ç½® ç™»å½• iStoreOS ç®¡ç†ç•Œé¢\nè¿›å…¥\u0026quot;ç½‘ç»œå­˜å‚¨\u0026quot; â†’ \u0026ldquo;NFS ç®¡ç†\u0026rdquo;\nç‚¹å‡»\u0026quot;æ·»åŠ å…±äº«\u0026quot;æŒ‰é’®\nå¡«å†™å…±äº«ä¿¡æ¯ï¼š\nè·¯å¾„ï¼š/mnt/mydiskï¼ˆæ‚¨è¦å…±äº«çš„ç›®å½•ï¼‰ å®¢æˆ·ç«¯ï¼š*ï¼ˆå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯ï¼‰æˆ– 192.168.1.0/24ï¼ˆé™åˆ¶IPæ®µï¼‰ é€‰é¡¹ï¼šrw,fsid=0,no_subtree_check,no_root_squash,insecure,sync ç‚¹å‡»\u0026quot;ä¿å­˜å¹¶åº”ç”¨\u0026quot;\nğŸ”— NFS å®¢æˆ·ç«¯é…ç½® â³ ä¸´æ—¶æŒ‚è½½ åœ¨å®¢æˆ·ç«¯è®¾å¤‡ä¸Šæ‰§è¡Œï¼š\n1 2 3 4 5 # åˆ›å»ºæœ¬åœ°æŒ‚è½½ç‚¹ mkdir -p /mnt/NFS-Share # æŒ‚è½½ NFS å…±äº« mount -t nfs -o rw,noatime,nodiratime 10.10.10.251:/mnt/mydisk /mnt/NFS-Share ğŸ”§ æ°¸ä¹…æŒ‚è½½ (/etc/fstab) ç¼–è¾‘å®¢æˆ·ç«¯è®¾å¤‡çš„ /etc/fstab æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œï¼š\n1 10.10.10.251:/mnt/mydisk /mnt/NFS-Share nfs rw,nolock,noatime,nodiratime,soft,timeo=30,retry=3 0 0 ç„¶åæ‰§è¡Œï¼š\n1 2 3 4 5 # æµ‹è¯•æŒ‚è½½ mount -a # éªŒè¯æŒ‚è½½ df -hT | grep nfs ğŸ› ï¸ ç®¡ç†å‘½ä»¤ æŸ¥çœ‹å…±äº«çŠ¶æ€ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å·²æŒ‚è½½çš„ NFS å…±äº« df -hT | grep nfs # æŸ¥çœ‹è¯¦ç»†çš„æŒ‚è½½ä¿¡æ¯ mount -t nfs # æŸ¥çœ‹æœåŠ¡å™¨å¯¼å‡ºçš„å…±äº«åˆ—è¡¨ showmount -e 10.10.10.251 å¸è½½å…±äº« 1 2 3 4 5 6 7 8 # æ­£å¸¸å¸è½½ umount /mnt/NFS-Share # å¼ºåˆ¶å¸è½½ï¼ˆå½“è®¾å¤‡ç¹å¿™æ—¶ï¼‰ umount -f /mnt/NFS-Share # æ‡’å¸è½½ï¼ˆå½“ç¨‹åºä½¿ç”¨å®Œæˆåè‡ªåŠ¨å¸è½½ï¼‰ umount -l /mnt/NFS-Share ğŸ“Š ç›‘æ§è„šæœ¬ åˆ›å»ºç›‘æ§è„šæœ¬ä»¥ä¾¿å¿«é€Ÿæ£€æŸ¥ NFS çŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cat \u0026gt; /usr/bin/nfs-monitor \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;=== ğŸ–¥ï¸ NFS çŠ¶æ€æ£€æŸ¥ ===\u0026#34; echo \u0026#34;æ—¶é—´: $(date)\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“¡ æŒ‚è½½çŠ¶æ€:\u0026#34; mount -t nfs echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ“‹ å…±äº«åˆ—è¡¨:\u0026#34; showmount -e echo \u0026#34;\u0026#34; echo \u0026#34;ğŸ”„ æœåŠ¡çŠ¶æ€:\u0026#34; /etc/init.d/nfsd status /etc/init.d/rpcbind status EOF chmod +x /usr/bin/nfs-monitor ä½¿ç”¨æ–¹å¼ï¼šnfs-monitor\nğŸ› æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ âŒ æŒ‚è½½å¤±è´¥ï¼šè¿æ¥è¶…æ—¶\n1 2 3 4 5 # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping 10.10.10.251 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® iptables -L -n | grep 2049 âŒ æƒé™è¢«æ‹’ç»\n1 2 3 4 5 # æ£€æŸ¥æœåŠ¡å™¨å¯¼å‡ºæƒé™ cat /etc/exports # æ£€æŸ¥ç›®å½•æƒé™ ls -ld /mnt/mydisk âŒ è®¾å¤‡æ­£å¿™æ— æ³•å¸è½½\n1 2 3 4 5 # æŸ¥çœ‹å“ªäº›è¿›ç¨‹æ­£åœ¨ä½¿ç”¨æŒ‚è½½ç‚¹ lsof /mnt/NFS-Share # å¼ºåˆ¶å¸è½½ umount -f /mnt/NFS-Share æ—¥å¿—æ£€æŸ¥ 1 2 3 4 5 # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„ NFS ç›¸å…³æ¡ç›® logread | grep nfs # æŸ¥çœ‹å†…æ ¸æ¶ˆæ¯ dmesg | grep nfs ğŸ”’ å®‰å…¨å»ºè®® ğŸ›¡ï¸ é™åˆ¶è®¿é—®èŒƒå›´\n1 2 # åªå…è®¸ç‰¹å®šIPæ®µè®¿é—® /mnt/mydisk 192.168.1.0/24(rw,sync,no_subtree_check) ğŸ” ä½¿ç”¨ root_squashï¼ˆæ¨èï¼‰\n1 2 # å°†rootç”¨æˆ·æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·ï¼Œå¢å¼ºå®‰å…¨æ€§ /mnt/mydisk *(rw,sync,root_squash,subtree_check) ğŸŒ é˜²ç«å¢™é…ç½®\n1 2 3 # åªå…è®¸ç‰¹å®šç½‘ç»œè®¿é—®NFSç«¯å£ iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 2049 -j ACCEPT iptables -A INPUT -p tcp --dport 2049 -j DROP ğŸ“Š å®šæœŸå®¡è®¡\n1 2 # å®šæœŸæ£€æŸ¥è°è®¿é—®äº†æ‚¨çš„NFSå…±äº« showmount -a ğŸ”” ç›‘æ§å‘Šè­¦\nè®¾ç½®æ—¥å¿—ç›‘æ§ï¼Œæ£€æµ‹å¼‚å¸¸è®¿é—®æ¨¡å¼ å®šæœŸæ£€æŸ¥å…±äº«æƒé™å’Œé…ç½® ğŸ‰ æ­å–œï¼ æ‚¨ç°åœ¨å·²ç»æ˜¯ iStoreOS NFS é…ç½®çš„ä¸“å®¶äº†ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒä¸Šè¿°æ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚\nğŸ’¬ æç¤ºï¼šé…ç½®å®Œæˆåï¼Œå»ºè®®å…ˆåœ¨åŒä¸€ç½‘ç»œä¸‹çš„å…¶ä»–è®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿å…±äº«æ­£å¸¸å·¥ä½œåå†æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 è¿™ä»½æŒ‡å—å·²ç»æ ¹æ®æ‚¨çš„è¦æ±‚è¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ï¼š 1. âœ… å¢åŠ äº†ç”ŸåŠ¨çš„emojiè¡¨æƒ…ç¬¦å·ï¼Œä½¿å†…å®¹æ›´åŠ æ´»æ³¼ 2. âœ… æ·»åŠ äº†è¯¦ç»†çš„ç‰¹ç‚¹ä¸åŠŸèƒ½ä»‹ç»éƒ¨åˆ† 3. âœ… åˆ›å»ºäº†å¸¦æœ‰emojiçš„å¯¼èˆªç›®å½•ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰é”šç‚¹æ ¼å¼æ­£ç¡® 4. âœ… ä¿®æ­£å’Œå®Œå–„äº†åŸæœ‰å†…å®¹ï¼Œå¢åŠ äº†æ›´å¤šå®ç”¨ä¿¡æ¯ 5. âœ… ä¿æŒäº†æŠ€æœ¯å†…å®¹çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ æ‰€æœ‰é”šç‚¹é“¾æ¥éƒ½é‡‡ç”¨äº†ä¸€è‡´çš„æ ¼å¼ï¼Œç¡®ä¿åœ¨æ‚¨çš„åšå®¢ä¸­èƒ½å¤Ÿæ­£å¸¸è·³è½¬ã€‚ ","date":"2024-12-07T08:45:55+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/93b7ae33/","title":"iStoreOS NFS é…ç½®ä¸ç®¡ç†æŒ‡å— ğŸš€"},{"content":"Docker éƒ¨ç½² Nginx Proxy Manager ä¸­æ–‡ç‰ˆ ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² NPM 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 2. å¯åŠ¨ NPM æœåŠ¡ ğŸš€ ğŸš€ äºŒã€åˆå§‹è®¿é—®å’Œé…ç½® 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ’» 2. åŸºæœ¬é…ç½®æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åŸŸåè§£æè®¾ç½® ğŸ”§ 2. ç«¯å£è½¬å‘é…ç½® ğŸ“¡ 3. NPM ä»£ç†é…ç½® âš™ï¸ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªä»£ç†ï¼Œç®¡ç†æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Nginx Proxy Manager å®˜ç½‘åœ°å€ï¼š https://nginxproxymanager.com/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/xiaoxinpro/nginx-proxy-manager-zh ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/chishin/nginx-proxy-manager-zh Nginx Proxy Manager æ˜¯ä¸€ä¸ªåŸºäº Nginx çš„åå‘ä»£ç†ç®¡ç†å·¥å…·ï¼Œæä¾›ç¾è§‚çš„ Web ç•Œé¢æ¥è½»æ¾ç®¡ç†ä»£ç†ä¸»æœºã€SSL è¯ä¹¦å’Œè®¿é—®æ§åˆ¶ã€‚ä¸­æ–‡ç‰ˆæä¾›äº†å®Œæ•´çš„æœ¬åœ°åŒ–æ”¯æŒï¼Œä½¿ä½¿ç”¨æ›´åŠ ä¾¿æ·ã€‚ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ å¯è§†åŒ–ç®¡ç† Web ç•Œé¢ç®¡ç†åå‘ä»£ç† æ— éœ€ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œç›´è§‚æ˜“ç”¨ ğŸ”’ SSL è¯ä¹¦ è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸ Let\u0026rsquo;s Encrypt è¯ä¹¦ ä¸€é”®é…ç½® HTTPSï¼Œä¿éšœå®‰å…¨ ğŸ‘¥ è®¿é—®æ§åˆ¶ åŸºäº IP çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ çµæ´»ç®¡ç†è®¿é—®æƒé™ ğŸ”„ è´Ÿè½½å‡è¡¡ å¤šåç«¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ æé«˜æœåŠ¡å¯ç”¨æ€§å’Œæ€§èƒ½ ğŸ“Š æµé‡ç›‘æ§ å®æ—¶æŸ¥çœ‹ä»£ç†çŠ¶æ€å’Œæµé‡ ä¾¿äºç›‘æ§å’Œæ•…éšœæ’æŸ¥ ğŸŒ å¤šåŸŸåæ”¯æŒ åŒæ—¶ç®¡ç†å¤šä¸ªåŸŸåå’Œå­åŸŸå ç»Ÿä¸€ç®¡ç†æ‰€æœ‰WebæœåŠ¡ âš¡ é«˜æ€§èƒ½ åŸºäº Nginx çš„é«˜æ€§èƒ½ä»£ç† ä½å»¶è¿Ÿï¼Œé«˜å¹¶å‘å¤„ç†èƒ½åŠ› ğŸ”§ è‡ªå®šä¹‰é…ç½® æ”¯æŒè‡ªå®šä¹‰ Nginx é…ç½® æ»¡è¶³ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚ ğŸ“± å“åº”å¼ç•Œé¢ æ”¯æŒç§»åŠ¨ç«¯ç®¡ç†çš„å“åº”å¼ç•Œé¢ éšæ—¶éšåœ°ç®¡ç†æœåŠ¡ ğŸ³ ä¸€ã€Docker éƒ¨ç½² NPM 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # åˆ›å»ºéƒ¨ç½²ç›®å½• mkdir -p /mnt/mydisk/home/npm \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: app: container_name: npm image: chishin/nginx-proxy-manager-zh:latest restart: unless-stopped ports: - \u0026#34;1180:80\u0026#34; # HTTP æµé‡ç«¯å£ - \u0026#34;4443:443\u0026#34; # HTTPS æµé‡ç«¯å£ - \u0026#34;81:81\u0026#34; # ç®¡ç†ç•Œé¢ç«¯å£ environment: DB_MYSQL_HOST: db DB_MYSQL_PORT: 3306 DB_MYSQL_USER: npm DB_MYSQL_PASSWORD: npm DB_MYSQL_NAME: npm volumes: - ./config/data:/data - ./config/letsencrypt:/etc/letsencrypt depends_on: - db networks: - npm-network db: container_name: npm-db image: jc21/mariadb-aria:latest restart: unless-stopped environment: MYSQL_ROOT_PASSWORD: npm MYSQL_DATABASE: npm MYSQL_USER: npm MYSQL_PASSWORD: npm MARIADB_AUTO_UPGRADE: \u0026#34;1\u0026#34; volumes: - ./config/mysql:/var/lib/mysql networks: - npm-network networks: npm-network: driver: bridge # é»˜è®¤ç™»å½•ä¿¡æ¯ï¼ˆé¦–æ¬¡ç™»å½•åè¯·ä¿®æ”¹ï¼‰ # é‚®ç®±: admin@example.com # å¯†ç : changeme EOF 2. å¯åŠ¨ NPM æœåŠ¡ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€åˆå§‹è®¿é—®å’Œé…ç½® 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ’» æ‰“å¼€æµè§ˆå™¨è®¿é—® http://10.10.10.245:81 ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼š é‚®ç®±ï¼šadmin@example.com å¯†ç ï¼šchangeme é‡è¦ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç å’Œé‚®ç®± 2. åŸºæœ¬é…ç½®æ­¥éª¤ ğŸ¯ ä¿®æ”¹ç®¡ç†å‘˜ä¿¡æ¯ï¼š\nç™»å½•åè½¬åˆ°\u0026quot;ç”¨æˆ·\u0026quot;é¡µé¢ ä¿®æ”¹é‚®ç®±å’Œå¯†ç ä¸ºå®‰å…¨çš„å€¼ é…ç½®SSLè¯ä¹¦ï¼š\nè½¬åˆ°\u0026quot;SSLè¯ä¹¦\u0026quot;é¡µé¢ ç”³è¯·æˆ–ä¸Šä¼ SSLè¯ä¹¦ è®¾ç½®ä»£ç†ä¸»æœºï¼š\nè½¬åˆ°\u0026quot;ä»£ç†ä¸»æœº\u0026quot;é¡µé¢ æ·»åŠ éœ€è¦ä»£ç†çš„æœåŠ¡ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åŸŸåè§£æè®¾ç½® ğŸ”§ ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å° è¿›å…¥åŸŸåè§£æé¡µé¢ æ·»åŠ æ³›åŸŸåè§£æè®°å½•ï¼š è®°å½•ç±»å‹ï¼šA ä¸»æœºè®°å½•ï¼š*.yourdomain.com è®°å½•å€¼ï¼šæ‚¨çš„å…¬ç½‘IPåœ°å€ 2. ç«¯å£è½¬å‘é…ç½® ğŸ“¡ ç™»å½•çˆ±å¿«è·¯ç”±å™¨ç®¡ç†ç•Œé¢ è¿›å…¥\u0026quot;ç½‘ç»œè®¾ç½®\u0026quot; \u0026gt; \u0026ldquo;ç«¯å£æ˜ å°„\u0026rdquo; æ·»åŠ ç«¯å£è½¬å‘è§„åˆ™ï¼š å†…ç½‘IPï¼šNPMæ‰€åœ¨æœåŠ¡å™¨çš„IPï¼ˆ10.10.10.245ï¼‰ å†…ç½‘ç«¯å£ï¼š4443 å¤–ç½‘ç«¯å£ï¼š4443 åè®®ï¼šTCP 3. NPM ä»£ç†é…ç½® âš™ï¸ ç™»å½•NPMç®¡ç†ç•Œé¢ è½¬åˆ°\u0026quot;ä»£ç†ä¸»æœº\u0026quot;é¡µé¢ ç‚¹å‡»\u0026quot;æ·»åŠ ä»£ç†ä¸»æœº\u0026quot; é…ç½®ä»£ç†è§„åˆ™ï¼š åŸŸåï¼šè¦ä»£ç†çš„åŸŸåï¼ˆå¦‚service.yourdomain.comï¼‰ æ–¹æ¡ˆï¼šhttpæˆ–https è½¬å‘IPï¼šå†…ç½‘æœåŠ¡çš„IPåœ°å€ ç«¯å£ï¼šå†…ç½‘æœåŠ¡çš„ç«¯å£ SSLè¯ä¹¦ï¼šé€‰æ‹©æˆ–ç”³è¯·SSLè¯ä¹¦ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/npm # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿— docker-compose logs app # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop npm # åœæ­¢å®¹å™¨ docker start npm # å¯åŠ¨å®¹å™¨ docker restart npm # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm npm # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f npm # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it npm sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it npm bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect npm # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats npm # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs npm # æŸ¥çœ‹æ—¥å¿— docker logs -f npm # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 npm # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t npm # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªä»£ç†ï¼Œç®¡ç†æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Nginx Proxy Manager ä¸­æ–‡ç‰ˆï¼Œå¹¶å®Œæˆäº†åå‘ä»£ç†çš„å…¨é¢é…ç½®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ ç»Ÿä¸€å…¥å£ é€šè¿‡ä¸€ä¸ªåŸŸåç®¡ç†æ‰€æœ‰WebæœåŠ¡ï¼Œå‘Šåˆ«ç¹ççš„ç«¯å£è®°å¿†\nğŸ”’ å®‰å…¨åŠ å¯† ä¸€é”®é…ç½®SSLè¯ä¹¦ï¼Œä¸ºæ‰€æœ‰æœåŠ¡æä¾›HTTPSå®‰å…¨åŠ å¯†\nğŸ¯ å¯è§†ç®¡ç† é€šè¿‡å‹å¥½çš„ä¸­æ–‡ç•Œé¢è½»æ¾ç®¡ç†ä»£ç†è§„åˆ™å’Œè®¿é—®æ§åˆ¶\nâš¡ é«˜æ•ˆè½¬å‘ äº«å—é«˜æ€§èƒ½çš„åå‘ä»£ç†æœåŠ¡ï¼Œæå‡è®¿é—®ä½“éªŒ\nç½‘ç»œä»£ç†ï¼Œæ˜¯ç°ä»£WebæœåŠ¡çš„åŸºç¡€æ¶æ„ã€‚æ„¿ Nginx Proxy Manager æˆä¸ºä½ å¯é çš„ç½‘ç»œç®¡å®¶ï¼Œä¸ºä½ ç®€åŒ–æ¯ä¸€ä¸ªæœåŠ¡é…ç½®ï¼Œå®ˆæŠ¤æ¯ä¸€æ¬¡å®‰å…¨è¿æ¥ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç»Ÿä¸€ç®¡ç†ï¼Œå®‰å…¨è®¿é—®â€”â€”æ„å»ºä½ ä¸“å±çš„WebæœåŠ¡ç½‘å…³å§ï¼ğŸšª\nğŸ“Œ æŒç»­ç»´æŠ¤ï¼šå»ºè®®å®šæœŸæ£€æŸ¥ NPM å®˜æ–¹æ›´æ–° ï¼Œä¿æŒç³»ç»Ÿæœ€æ–°\nğŸ”§ æœ€ä½³å®è·µï¼šå®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’Œæ•°æ®åº“ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šè¿è¡Œ\nğŸ› äº¤æµæ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯è®¿é—® GitHub Issues è·å–å¸®åŠ©\nç¥ä½ é…ç½®é¡ºåˆ©ï¼Œç®¡ç†æ— å¿§ï¼ğŸ‰\n","date":"2024-12-07T08:44:21+08:00","image":"https://file.meimolihan.eu.org/img/nginx-pm-01.webp","permalink":"https://blog.meimolihan.eu.org/p/b40af3dd/","title":"Docker éƒ¨ç½² Nginx Proxy Manager ä¸­æ–‡ç‰ˆ ğŸ”"},{"content":"Docker éƒ¨ç½² AdGuard Home å¹¿å‘Šæ‹¦æˆªå™¨ ğŸ›¡ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² AdGuard Home 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ AdGuard Home 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ— å¹¿å‘Šç½‘ç»œï¼Œæ¢ç´¢çº¯å‡€ä½“éªŒ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ AdGuard Home å®˜ç½‘åœ°å€ï¼š https://adguard.com/zh_cn/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/AdguardTeam/AdGuardHome ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/adguard/adguardhome AdGuard Home æ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘ç»œçº§å¹¿å‘Šå’Œè·Ÿè¸ªå™¨æ‹¦æˆªè½¯ä»¶ï¼Œå¯ä»¥ä½œä¸ºæœ¬åœ° DNS æœåŠ¡å™¨è¿è¡Œï¼Œä¸ºæ•´ä¸ªç½‘ç»œæä¾›å¹¿å‘Šæ‹¦æˆªã€å®¶é•¿æ§åˆ¶å’Œéšç§ä¿æŠ¤åŠŸèƒ½ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾ä¸ºæ‰€æœ‰è¿æ¥åˆ°ç½‘ç»œçš„è®¾å¤‡æä¾›å¹¿å‘Šæ‹¦æˆªæœåŠ¡ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸš« å¹¿å‘Šæ‹¦æˆª æ‹¦æˆªç½‘é¡µã€è§†é¢‘å’Œåº”ç”¨ä¸­çš„å¹¿å‘Š å…¨ç½‘è®¾å¤‡æ— éœ€å•ç‹¬å®‰è£…å®¢æˆ·ç«¯ ğŸ›¡ï¸ éšç§ä¿æŠ¤ é˜»æ­¢è·Ÿè¸ªå™¨å’Œæ¶æ„è½¯ä»¶ ä¿æŠ¤æ‰€æœ‰è®¾å¤‡éšç§å®‰å…¨ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶é•¿æ§åˆ¶ é™åˆ¶ä¸å½“å†…å®¹è®¿é—® æ”¯æŒæ—¶é—´é™åˆ¶å’Œå†…å®¹è¿‡æ»¤ ğŸ“Š æ•°æ®ç»Ÿè®¡ è¯¦ç»†çš„æŸ¥è¯¢æ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯ å¯è§†åŒ–ç½‘ç»œä½¿ç”¨æƒ…å†µ ğŸŒ DNS over HTTPS æ”¯æŒåŠ å¯†çš„DNSæŸ¥è¯¢ å¢å¼ºDNSæŸ¥è¯¢å®‰å…¨æ€§ ğŸ”§ è‡ªå®šä¹‰è§„åˆ™ æ”¯æŒè‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ çµæ´»é…ç½®æ‹¦æˆªç­–ç•¥ ğŸ  å…¨ç½‘ä¿æŠ¤ ä¿æŠ¤ç½‘ç»œä¸­æ‰€æœ‰è®¾å¤‡ ä¸€æ¬¡æ€§éƒ¨ç½²ï¼Œå…¨ç½‘ç”Ÿæ•ˆ âš¡ é«˜æ€§èƒ½ ä¼˜åŒ–çš„DNSå¤„ç†æ€§èƒ½ ä½å»¶è¿Ÿï¼Œé«˜ååé‡ ğŸ³ ä¸€ã€Docker éƒ¨ç½² AdGuard Home 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -p /mnt/mydisk/home/adguardhome \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: adguardhome: container_name: adguardhome image: adguard/adguardhome:latest restart: unless-stopped network_mode: host # ä½¿ç”¨hostæ¨¡å¼ä»¥è·å¾—æ›´å¥½çš„ç½‘ç»œæ€§èƒ½ ports: - 53:53/tcp # DNS over TCP - 53:53/udp # DNS over UDP - 3000:3000/tcp # Webç®¡ç†ç•Œé¢ - 853:853/tcp # DNS over TLS - 784:784/udp # DNS over QUIC - 8853:8853/tcp # å¤‡ç”¨DNSç«¯å£ - 8853:8853/udp # å¤‡ç”¨DNSç«¯å£ volumes: - ./workdir:/opt/adguardhome/work - ./confdir:/opt/adguardhome/conf cap_add: - NET_ADMIN # éœ€è¦ç½‘ç»œç®¡ç†æƒé™ environment: - TZ=Asia/Shanghai logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;10m\u0026#34; max-file: \u0026#34;3\u0026#34; EOF ğŸ” å®‰å…¨æç¤ºï¼šé¦–æ¬¡è®¾ç½®åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤ç®¡ç†å¯†ç ï¼Œå»ºè®®é…ç½®åŠ å¯†DNSï¼ˆDoH/DoTï¼‰ä»¥å¢å¼ºå®‰å…¨æ€§\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ AdGuard Home 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:3000 IPè®¿é—®ï¼š http://10.10.10.245:3000 åŸŸåè®¿é—®ï¼š https://adguard.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŒ‰ç…§åˆå§‹åŒ–å‘å¯¼å®ŒæˆåŸºæœ¬è®¾ç½®ï¼š è®¾ç½®ç®¡ç†ç•Œé¢ç”¨æˆ·åå’Œå¯†ç  é…ç½®DNSæœåŠ¡å™¨è®¾ç½® é€‰æ‹©ä¸Šæ¸¸DNSæœåŠ¡å™¨ è®¾ç½®ç»Ÿè®¡æ•°æ®å’Œæ—¥å¿—ä¿ç•™æ—¶é—´ é…ç½®å®¢æˆ·ç«¯è®¾å¤‡ä½¿ç”¨AdGuard Homeä½œä¸ºDNSæœåŠ¡å™¨ æ¨èçš„ä¸Šæ¸¸DNSæœåŠ¡å™¨ï¼š\n1 2 3 4 5 6 7 8 9 # å›½å†…æ¨èï¼š - 119.29.29.29 # DNSPod - 223.5.5.5 # é˜¿é‡ŒDNS - 180.76.76.76 # ç™¾åº¦DNS # å›½å¤–æ¨èï¼ˆå¦‚éœ€ç§‘å­¦ä¸Šç½‘ï¼‰ï¼š - 1.1.1.1 # Cloudflare - 8.8.8.8 # Google DNS - 9.9.9.9 # Quad9 ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://adguard.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/adguard.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name adguard.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:3000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ— å¹¿å‘Šç½‘ç»œï¼Œæ¢ç´¢çº¯å‡€ä½“éªŒ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† AdGuard Home å¹¿å‘Šæ‹¦æˆªå™¨ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸš« å…¨ç½‘å»å¹¿å‘Š ä¸ºæ‰€æœ‰è¿æ¥è®¾å¤‡æä¾›å…¨é¢çš„å¹¿å‘Šæ‹¦æˆªæœåŠ¡ï¼Œäº«å—å¹²å‡€æ— å¹²æ‰°çš„ç½‘ç»œä½“éªŒ\nğŸ›¡ï¸ å¼ºåŒ–éšç§ä¿æŠ¤ é˜»æ­¢è·Ÿè¸ªå™¨å’Œæ¶æ„è½¯ä»¶ï¼Œä¿æŠ¤ä¸ªäººæ•°æ®å’Œéšç§å®‰å…¨\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æ™ºèƒ½å®¶é•¿æ§åˆ¶ ç®¡ç†å®¶åº­ç½‘ç»œè®¿é—®ï¼Œä¸ºå­©å­åˆ›é€ å¥åº·çš„ç½‘ç»œç¯å¢ƒ\nğŸ“Š å…¨é¢ç½‘ç»œæ´å¯Ÿ é€šè¿‡è¯¦ç»†çš„æ•°æ®ç»Ÿè®¡å’ŒæŸ¥è¯¢æ—¥å¿—ï¼Œäº†è§£ç½‘ç»œä½¿ç”¨æƒ…å†µ\nç½‘ç»œæ¸…å‡€ï¼Œç”Ÿæ´»èˆ’å¿ƒã€‚æ„¿ AdGuard Home æˆä¸ºä½ ç½‘ç»œç¯å¢ƒçš„å¿ å®å®ˆæŠ¤è€…ï¼Œä¸ºä½ è¿‡æ»¤å¹²æ‰°ï¼Œä¿ç•™çº¯ç²¹ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé˜»æ–­å¹²æ‰°ï¼Œç•™ä½çº¯ç²¹â€”â€”æ„å»ºä½ æ¸…çˆ½æ— å¿§çš„ç½‘ç»œç©ºé—´å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ AdGuard Home é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œç½‘ç»œç•…é€šï¼ğŸ‰\n","date":"2024-12-07T08:43:26+08:00","image":"https://file.meimolihan.eu.org/img/docker-adguardhome-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ac9dced3/","title":"Docker éƒ¨ç½² AdGuard Home å¹¿å‘Šæ‹¦æˆªå™¨ ğŸ›¡ï¸"},{"content":"Docker éƒ¨ç½² IT-Tools å¼€å‘è€…å·¥å…·ç®± ğŸ› ï¸ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ âœ¨ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² IT-Tools 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ IT-Tools 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. å·¥å…·åˆ†ç±»ä»‹ç» ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸ› ï¸ å¯èˆªå·¥å…·ï¼Œæ•ˆç‡æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ IT-Tools å®˜ç½‘åœ°å€ï¼š https://it-tools.tech/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/CorentinTh/it-tools ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/qingfeng2336/it-tools IT-Tools æ˜¯ä¸€ä¸ªé›†æˆäº†å¤šç§å®ç”¨å¼€å‘å·¥å…·çš„ç½‘ç»œåº”ç”¨ï¼Œä¸ºå¼€å‘è€…å’ŒITä¸“ä¸šäººå‘˜æä¾›äº†ä¸€ç«™å¼çš„å·¥å…·é›†åˆã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥è½»æ¾è®¿é—®å„ç§ç¼–ç ã€è½¬æ¢ã€è®¡ç®—å’Œç½‘ç»œå·¥å…·ï¼Œæ— éœ€å®‰è£…å¤šä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ› ï¸ å¤šå·¥å…·é›†æˆ åŒ…å« 100+ ç§å®ç”¨å¼€å‘å·¥å…· ä¸€ç«™å¼è§£å†³å¤šç§å¼€å‘éœ€æ±‚ ğŸŒ Web ç•Œé¢ é€šè¿‡æµè§ˆå™¨å³å¯è®¿é—®æ‰€æœ‰å·¥å…· æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œè·¨å¹³å°ä½¿ç”¨ ğŸ¨ ç¾è§‚ç•Œé¢ ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢è®¾è®¡ æ“ä½œç›´è§‚ï¼Œç”¨æˆ·ä½“éªŒä¼˜ç§€ ğŸ“± å“åº”å¼è®¾è®¡ å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ éšæ—¶éšåœ°ä½¿ç”¨å·¥å…· âš¡ å®æ—¶è®¡ç®— å¤§å¤šæ•°å·¥å…·æ”¯æŒå®æ—¶è®¡ç®—å’Œè½¬æ¢ å³æ—¶åé¦ˆï¼Œæé«˜å·¥ä½œæ•ˆç‡ ğŸ³ å¿«é€Ÿéƒ¨ç½² Docker å®¹å™¨åŒ–éƒ¨ç½² ç®€å•å¿«æ·ï¼Œç¯å¢ƒä¸€è‡´ ğŸ”’ æœ¬åœ°è¿è¡Œ æ‰€æœ‰æ•°æ®å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆ ä¿éšœéšç§å®‰å…¨ï¼Œæ— éœ€æ‹…å¿ƒæ•°æ®æ³„éœ² ğŸ³ ä¸€ã€Docker éƒ¨ç½² IT-Tools 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/it-tools \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: it-tools: container_name: it-tools image: qingfeng2336/it-tools:latest restart: unless-stopped ports: - \u0026#34;8088:80\u0026#34; environment: - PUID=1000 - PGID=1000 - TZ=Asia/Shanghai volumes: - ./data:/app/data # å¯é€‰ï¼šæ•°æ®æŒä¹…åŒ– EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ IT-Tools 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8088 åŸŸåè®¿é—®ï¼š https://tools.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. å·¥å…·åˆ†ç±»ä»‹ç» ğŸ¯ ç¼–ç /è§£ç å·¥å…· Base64 ç¼–ç /è§£ç  URL ç¼–ç /è§£ç  HTML å®ä½“ç¼–ç /è§£ç  JWT è§£æå’ŒéªŒè¯ åŠ å¯†/å“ˆå¸Œå·¥å…· MD5ã€SHA1ã€SHA256 å“ˆå¸Œè®¡ç®— HMAC ç”Ÿæˆå™¨ UUID ç”Ÿæˆå™¨ å¯†ç ç”Ÿæˆå™¨ ç½‘ç»œå·¥å…· IP åœ°å€æŸ¥è¯¢ å­ç½‘è®¡ç®—å™¨ HTTP çŠ¶æ€ç æŸ¥è¯¢ User-Agent åˆ†æ æ–‡æœ¬å¤„ç†å·¥å…· æ–‡æœ¬å·®å¼‚æ¯”è¾ƒ æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯• JSON æ ¼å¼åŒ–éªŒè¯ XML æ ¼å¼åŒ– ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/it-tools.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name tools.yourdomain.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/key.pem; ssl_protocols TLSv1.2 TLSv1.3; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; location / { proxy_pass http://127.0.0.1:8088; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; # WebSocket æ”¯æŒ proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/it-tools # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop it-tools docker start it-tools docker restart it-tools # è¿›å…¥å®¹å™¨Shell docker exec -it it-tools sh docker exec -it it-tools bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs it-tools docker logs -f it-tools docker logs --tail 100 it-tools 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi qingfeng2336/it-tools:latest # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸ› ï¸ å¯èˆªå·¥å…·ï¼Œæ•ˆç‡æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† IT-Tools å¼€å‘è€…å·¥å…·ç®±ï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ é«˜æ•ˆå¼€å‘ äº«å— 100+ ç§å®ç”¨å·¥å…·çš„ä¾¿æ·è®¿é—®ï¼Œå¤§å¹…æå‡å¼€å‘å’Œè¿ç»´æ•ˆç‡\nğŸ”’ éšç§å®‰å…¨ æ‰€æœ‰å·¥å…·æœ¬åœ°åŒ–è¿è¡Œï¼Œç¡®ä¿æ•æ„Ÿæ•°æ®ä¸ä¼šæ³„éœ²åˆ°ç¬¬ä¸‰æ–¹å¹³å°\nğŸŒ å¤šç«¯å¯ç”¨ é€šè¿‡æµè§ˆå™¨éšæ—¶éšåœ°è®¿é—®å·¥å…·ç®±ï¼Œæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡\nğŸ¯ ç²¾å‡†å·¥å…· ä»ç¼–ç è§£ç åˆ°ç½‘ç»œæµ‹è¯•ï¼Œä»åŠ å¯†å“ˆå¸Œåˆ°æ–‡æœ¬å¤„ç†ï¼Œè¦†ç›–å¼€å‘å…¨æµç¨‹éœ€æ±‚\nå¼€å‘å·¥å…·ä¸ä»…æ˜¯æ•ˆç‡çš„æå‡ï¼Œæ›´æ˜¯ä¸“ä¸šèƒ½åŠ›çš„å»¶ä¼¸ã€‚æ„¿ IT-Tools æˆä¸ºä½ å¼€å‘å·¥ä½œä¸­çš„ç‘å£«å†›åˆ€ï¼Œè®©æ¯ä¸€ä¸ªæŠ€æœ¯æŒ‘æˆ˜éƒ½è¿åˆƒè€Œè§£ï¼Œæ¯ä¸€æ¬¡ä»£ç åˆ›ä½œéƒ½æµç•…é«˜æ•ˆã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œç”¨ IT-Tools æ­¦è£…ä½ çš„å¼€å‘æŠ€èƒ½ï¼Œæ¢ç´¢æ•°å­—ä¸–ç•Œçš„æ— é™å¯èƒ½ï¼âœ¨\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ IT-Tools å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°å·¥å…·ä¸åŠŸèƒ½ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œå¼€å‘æ•ˆç‡å€å¢ï¼ğŸ‰\n","date":"2024-12-07T08:42:47+08:00","image":"https://file.meimolihan.eu.org/img/it-tools-01.webp","permalink":"https://blog.meimolihan.eu.org/p/dcb888eb/","title":"Docker éƒ¨ç½² IT-Tools å¼€å‘è€…å·¥å…·ç®± ğŸ› ï¸"},{"content":"Docker éƒ¨ç½² qBittorrent ä¸‹è½½å™¨ ğŸ“¥ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² qBittorrent 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 2. å¯åŠ¨ qBittorrent æœåŠ¡ ğŸš€ ğŸš€ äºŒã€åˆå§‹è®¿é—®å’Œé…ç½® 1. è·å–ç™»å½•å‡­æ® ğŸ”‘ 2. è®¿é—® Web ç•Œé¢ ğŸ’» ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªä¸‹è½½ï¼ŒæŒæ§æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ qBittorrent å®˜ç½‘åœ°å€ï¼š https://www.qbittorrent.org/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/linuxserver/docker-qbittorrent ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/linuxserver/qbittorrent qBittorrent æ˜¯ä¸€ä¸ªå¼€æºå…è´¹çš„ BitTorrent å®¢æˆ·ç«¯ï¼Œæä¾›ç®€æ´çš„ç•Œé¢å’Œå¼ºå¤§çš„åŠŸèƒ½ï¼Œæ˜¯æ›¿ä»£ Î¼Torrent çš„ä¼˜ç§€é€‰æ‹©ã€‚é€šè¿‡ Docker éƒ¨ç½²å¯ä»¥è½»æ¾ç®¡ç†å¹¶ä¿æŒç³»ç»Ÿæ•´æ´ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âš¡ é«˜é€Ÿä¸‹è½½ ä¼˜åŒ–çš„ BT åè®®å®ç° å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ ğŸŒ Web ç•Œé¢ è¿œç¨‹ç®¡ç†ç•Œé¢ éšæ—¶éšåœ°ç®¡ç†ä¸‹è½½ä»»åŠ¡ ğŸ”’ å®‰å…¨åŠ å¯† æ”¯æŒåè®®åŠ å¯† é˜²æ­¢ ISP é™åˆ¶ï¼Œä¿æŠ¤éšç§ ğŸ“Š è¯¦ç»†ç»Ÿè®¡ ä¸‹è½½/ä¸Šä¼ é€Ÿåº¦ç›‘æ§ å®æ—¶äº†è§£ç½‘ç»œä½¿ç”¨æƒ…å†µ ğŸ¯ RSS è®¢é˜… è‡ªåŠ¨ä¸‹è½½æ”¯æŒ è‡ªåŠ¨è·å–æœ€æ–°å†…å®¹ ğŸ”„ é˜Ÿåˆ—ç®¡ç† æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ åˆç†åˆ†é…å¸¦å®½èµ„æº ğŸ“ æ–‡ä»¶ç®¡ç† é€‰æ‹©æ€§ä¸‹è½½ åªä¸‹è½½éœ€è¦çš„æ–‡ä»¶ ğŸŒ™ è®¡åˆ’ä»»åŠ¡ æ—¶æ®µé™é€Ÿ åœ¨ä¸å½±å“ä½¿ç”¨æ—¶å…¨é€Ÿä¸‹è½½ ğŸ” æœç´¢é›†æˆ å†…ç½®æœç´¢æ’ä»¶ æ–¹ä¾¿æŸ¥æ‰¾ç§å­èµ„æº ğŸ“± ç§»åŠ¨æ”¯æŒ å“åº”å¼ç•Œé¢ æ‰‹æœºå¹³æ¿å‡å¯ç®¡ç† ğŸ³ ä¸€ã€Docker éƒ¨ç½² qBittorrent 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œé…ç½®æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # åˆ›å»ºéƒ¨ç½²ç›®å½• mkdir -p /mnt/mydisk/home/qbittorrent \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: qbittorrent: container_name: qbittorrent image: lscr.io/linuxserver/qbittorrent:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;6881:6881\u0026#34; # BT ä¸‹è½½ç«¯å£ (TCP) - \u0026#34;6881:6881/udp\u0026#34; # BT ä¸‹è½½ç«¯å£ (UDP) - \u0026#34;8081:8081\u0026#34; # Web ç®¡ç†ç•Œé¢ç«¯å£ volumes: - ./config:/config # é…ç½®æ–‡ä»¶ç›®å½• - /mnt/ARS2-NFS/downloads/qbittorrent:/downloads # ä¸‹è½½æ–‡ä»¶ç›®å½• environment: - PUID=1000 # ç”¨æˆ·ID - PGID=1000 # ç»„ID - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® - UMASK_SET=022 # æ–‡ä»¶æƒé™æ©ç  - WEBUI_PORT=8081 # Web ç®¡ç†ç•Œé¢ç«¯å£ - TORRENTING_PORT=6881 # BT ä¸‹è½½ç«¯å£ # ä¸‹è½½ç›®å½•: /mnt/ARS2-NFS/downloads/qbittorrent # é»˜è®¤ç”¨æˆ·å: admin # é»˜è®¤å¯†ç : æŸ¥çœ‹å®¹å™¨æ—¥å¿—è·å–æˆ–ä½¿ç”¨ä¸‹æ–¹æä¾›çš„å¯†ç  EOF 2. å¯åŠ¨ qBittorrent æœåŠ¡ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€åˆå§‹è®¿é—®å’Œé…ç½® 1. è·å–ç™»å½•å‡­æ® ğŸ”‘ é¦–æ¬¡å¯åŠ¨åï¼Œéœ€è¦æŸ¥çœ‹å®¹å™¨æ—¥å¿—è·å–éšæœºç”Ÿæˆçš„å¯†ç ï¼š\n1 docker logs qbittorrent | grep -i password 2. è®¿é—® Web ç•Œé¢ ğŸ’» æ‰“å¼€æµè§ˆå™¨è®¿é—® http://10.10.10.245:8081 ä½¿ç”¨ä»¥ä¸‹å‡­æ®ç™»å½•ï¼š ç”¨æˆ·åï¼šadmin å¯†ç ï¼šä»æ—¥å¿—ä¸­è·å–çš„å¯†ç  é‡è¦ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç  ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/qbittorrent.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 8080 ssl; listen [::]:8080 ssl; server_name qbittorrent.yourdomain.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/ssl/cert.pem; ssl_certificate_key /etc/nginx/ssl/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8081; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/qbittorrent # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿— docker-compose logs qbittorrent # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop qbittorrent # åœæ­¢å®¹å™¨ docker start qbittorrent # å¯åŠ¨å®¹å™¨ docker restart qbittorrent # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm qbittorrent # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f qbittorrent # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it qbittorrent sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it qbittorrent bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect qbittorrent # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats qbittorrent # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs qbittorrent # æŸ¥çœ‹æ—¥å¿— docker logs -f qbittorrent # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 qbittorrent # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t qbittorrent # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªä¸‹è½½ï¼ŒæŒæ§æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† qBittorrent ä¸‹è½½å™¨ï¼Œå¹¶å®Œæˆäº† Web ç•Œé¢çš„è®¿é—®é…ç½®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ æé€Ÿä¸‹è½½ äº«å—ç¨³å®šé«˜æ•ˆçš„æ–‡ä»¶ä¸‹è½½ä½“éªŒï¼Œå……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½\nğŸŒ è¿œç¨‹ç®¡ç† éšæ—¶éšåœ°é€šè¿‡ç½‘é¡µç•Œé¢æ·»åŠ å’Œç®¡ç†ä¸‹è½½ä»»åŠ¡\nğŸ”’ éšç§ä¿æŠ¤ é€šè¿‡åŠ å¯†è¿æ¥å’Œå®‰å…¨é…ç½®ä¿éšœä¸‹è½½éšç§\nğŸ“Š æ™ºèƒ½è°ƒåº¦ åˆ©ç”¨è®¡åˆ’ä»»åŠ¡å’Œé˜Ÿåˆ—ç®¡ç†ä¼˜åŒ–èµ„æºä½¿ç”¨\nä¸‹è½½ç®¡ç†ï¼Œæ˜¯æ•°å­—å†…å®¹è·å–çš„é‡è¦ç¯èŠ‚ã€‚æ„¿ qBittorrent æˆä¸ºä½ å¯é çš„ä¸‹è½½åŠ©æ‰‹ï¼Œä¸ºä½ é«˜æ•ˆè·å–æ¯ä¸€ä»½æ‰€éœ€èµ„æºï¼Œç®¡ç†æ¯ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæœ‰åºä¸‹è½½ï¼Œé«˜æ•ˆç®¡ç†â€”â€”æ„å»ºä½ ä¸“å±çš„ä¸‹è½½å·¥ä½œç«™å§ï¼â¬‡ï¸\nğŸ“Œ åˆè§„ä½¿ç”¨ï¼šè¯·éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ï¼Œä»…ä¸‹è½½æˆæƒå†…å®¹\nğŸ”§ å®šæœŸç»´æŠ¤ï¼šå»ºè®®å®šæœŸæ¸…ç†å®Œæˆçš„ä»»åŠ¡å’Œç¼“å­˜æ–‡ä»¶\nğŸŒ ç½‘ç»œä¼˜åŒ–ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´è¿æ¥æ•°å’Œå¸¦å®½é™åˆ¶\nğŸ› é—®é¢˜åé¦ˆï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯è®¿é—® GitHub Issues è·å–æ”¯æŒ\nç¥ä½ ä¸‹è½½é¡ºåˆ©ï¼Œèµ„æºä¸°å¯Œï¼ğŸ‰\n","date":"2024-12-07T08:41:54+08:00","image":"https://file.meimolihan.eu.org/img/qbittorrent-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4a7a6020/","title":"Docker éƒ¨ç½² qBittorrent ä¸‹è½½å™¨ ğŸ“¥"},{"content":"Docker éƒ¨ç½² WebSSH ç½‘é¡µç‰ˆç»ˆç«¯ ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² WebSSH 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ WebSSH 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè¿œç¨‹ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ WebSSH å®˜ç½‘åœ°å€ï¼š https://webssh.net/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Jrohy/webssh ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/jrohy/webssh WebSSH æ˜¯ä¸€ä¸ªåŸºäº Web çš„ SSH å®¢æˆ·ç«¯ï¼Œå…è®¸ä½ é€šè¿‡æµè§ˆå™¨ç›´æ¥è®¿é—®å’Œç®¡ç†æœåŠ¡å™¨çš„ç»ˆç«¯ã€‚æ— éœ€å®‰è£…é¢å¤–çš„ SSH å®¢æˆ·ç«¯è½¯ä»¶ï¼Œåªéœ€ä¸€ä¸ªæµè§ˆå™¨å³å¯éšæ—¶éšåœ°å®‰å…¨åœ°ç®¡ç†ä½ çš„æœåŠ¡å™¨ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ ç½‘é¡µç‰ˆç»ˆç«¯ çº¯ç½‘é¡µç‰ˆ SSH ç»ˆç«¯ æ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œéšæ—¶éšåœ°è®¿é—® ğŸ” å®‰å…¨è®¤è¯ æ”¯æŒæ ‡å‡† SSH åè®®å’Œè®¤è¯ ä¿éšœè¿æ¥å®‰å…¨æ€§ ğŸ“± å“åº”å¼è®¾è®¡ æ”¯æŒç§»åŠ¨è®¾å¤‡è®¿é—® åœ¨æ‰‹æœºå’Œå¹³æ¿ä¸Šä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ ğŸ’¾ ä¼šè¯ä¿æŒ æ”¯æŒæ–­çº¿é‡è¿åŠŸèƒ½ ç¡®ä¿è¿æ¥ç¨³å®šæ€§ ğŸ³ Docker éƒ¨ç½² å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ ç®€å•ä¾¿æ·ï¼Œæ˜“äºç®¡ç† ğŸ”§ å¤šæ ‡ç­¾é¡µ æ”¯æŒå¤šæ ‡ç­¾é¡µä¼šè¯ç®¡ç† åŒæ—¶ç®¡ç†å¤šä¸ªæœåŠ¡å™¨è¿æ¥ ğŸ¨ ä¸»é¢˜å®šåˆ¶ æ”¯æŒå¤šç§ç»ˆç«¯é¢œè‰²ä¸»é¢˜ ä¸ªæ€§åŒ–ä½¿ç”¨ä½“éªŒ ğŸ“‹ å¤åˆ¶ç²˜è´´ æµè§ˆå™¨ä¸ç»ˆç«¯é—´å¤åˆ¶ç²˜è´´ æé«˜æ“ä½œæ•ˆç‡ ğŸ³ ä¸€ã€Docker éƒ¨ç½² WebSSH 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mkdir -p /mnt/mydisk/home/webssh \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: webssh: container_name: webssh image: jrohy/webssh:latest restart: always ports: - \u0026#34;2222:5032\u0026#34; environment: - TZ=Asia/Shanghai - PUID=1000 - PGID=1000 volumes: - ./data:/app/data EOF ğŸ‘¥ ç”¨æˆ·æƒé™è¯´æ˜ï¼šå°† PUID å’Œ PGID æ›¿æ¢ä¸ºæ‚¨ç³»ç»Ÿçš„å®é™…ç”¨æˆ·IDå’Œç»„IDï¼ˆé€šè¿‡ id å‘½ä»¤æŸ¥çœ‹ï¼‰\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ WebSSH 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:2222 IPè®¿é—®ï¼š http://your-server-ip:2222 åŸŸåè®¿é—®ï¼š https://webssh.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ åœ¨ç™»å½•ç•Œé¢è¾“å…¥ SSH è¿æ¥ä¿¡æ¯ï¼š ä¸»æœºåœ°å€ï¼šç›®æ ‡æœåŠ¡å™¨çš„ IP æˆ–åŸŸå ç«¯å£ï¼šSSH ç«¯å£ï¼ˆé»˜è®¤ä¸º 22ï¼‰ ç”¨æˆ·åï¼šSSH ç”¨æˆ·å å¯†ç /å¯†é’¥ï¼šSSH è®¤è¯å‡­æ® ç‚¹å‡»è¿æ¥ï¼Œå¼€å§‹ä½¿ç”¨ç½‘é¡µç‰ˆç»ˆç«¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://webssh.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/webssh.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name webssh.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:2222; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªè¿œç¨‹ç®¡ç†ï¼Œæ¢ç´¢æ— é™å¯èƒ½ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† WebSSH ç½‘é¡µç‰ˆç»ˆç«¯ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° é€šè¿‡æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨ç»ˆç«¯ï¼Œæ— éœ€å®‰è£…ä»»ä½•å®¢æˆ·ç«¯ï¼Œæ‰“ç ´è®¾å¤‡å’Œåœ°ç‚¹é™åˆ¶\nğŸ” å®‰å…¨å¯é  åŸºäºæ ‡å‡† SSH åè®®ï¼Œä¿éšœè¿æ¥å®‰å…¨æ€§å’Œæ•°æ®ä¼ è¾“çš„åŠ å¯†æ€§\nğŸ“± å¤šç«¯å…¼å®¹ åœ¨ç”µè„‘ã€æ‰‹æœºã€å¹³æ¿ç­‰å„ç§è®¾å¤‡ä¸Šè·å¾—ä¸€è‡´çš„ç»ˆç«¯ä½“éªŒ\nâš¡ é«˜æ•ˆä¾¿æ· ç®€å•çš„ç½‘é¡µè®¿é—®æ–¹å¼ï¼Œå¤§å¹…æå‡æœåŠ¡å™¨ç®¡ç†æ•ˆç‡å’Œçµæ´»æ€§\nè¿œç¨‹ç®¡ç†æ˜¯è¿ç»´å·¥ä½œçš„é‡è¦ç¯èŠ‚ï¼Œä¾¿æ·è®¿é—®æ˜¯æ•ˆç‡æå‡çš„å…³é”®ã€‚æ„¿ WebSSH æˆä¸ºä½ æœåŠ¡å™¨ç®¡ç†æ—…ç¨‹ä¸­çš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ éšæ—¶éšåœ°ä¿æŒå¯¹æœåŠ¡å™¨çš„å®Œå…¨æ§åˆ¶ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè¿æ¥æ— ç•Œï¼Œç®¡ç†éšå¿ƒâ€”â€”æ„å»ºä½ çµæ´»é«˜æ•ˆçš„è¿œç¨‹è¿ç»´å¹³å°å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®ç•™æ„ WebSSH é¡¹ç›®æ›´æ–° ï¼Œè·å–æœ€æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œè¿ç»´é«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T08:41:11+08:00","image":"https://file.meimolihan.eu.org/img/ssh-01.webp","permalink":"https://blog.meimolihan.eu.org/p/227d55bb/","title":"Docker éƒ¨ç½² WebSSH ç½‘é¡µç‰ˆç»ˆç«¯ ğŸ”"},{"content":"Docker éƒ¨ç½²è¿…é›·ä¸‹è½½å™¨ ğŸ“¥ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²è¿…é›·ä¸‹è½½å™¨ 1. Debian ç³»ç»Ÿéƒ¨ç½²é…ç½® ğŸ“ 2. ARM/ARS2 ç³»ç»Ÿéƒ¨ç½²é…ç½® ğŸ“ 3. å¯åŠ¨è¿…é›·ä¸‹è½½å™¨æœåŠ¡ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨è¿…é›·ä¸‹è½½å™¨ 1. åˆå§‹è®¾ç½® ğŸ¯ 2. æ·»åŠ ä¸‹è½½ä»»åŠ¡ ğŸ“¥ 3. ä¸‹è½½ç®¡ç† âš™ï¸ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ âš¡ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/cnk3x/xunlei/tree/docker ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/cnk3x/xunlei è¿…é›·ä¸‹è½½å™¨ æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ä¸‹è½½å·¥å…·ï¼Œåˆ©ç”¨è¿…é›·å¼ºå¤§çš„P2PæŠ€æœ¯æä¾›æé€Ÿä¸‹è½½ä½“éªŒã€‚ç»“åˆ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„å¹³å°ï¼ˆLinuxã€Windowsã€macOSã€NAS ç­‰ï¼‰ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œè¿…é›·ä¸‹è½½å™¨ï¼Œå®ç°çµæ´»çš„ä¸‹è½½ç®¡ç†å’Œèµ„æºè°ƒåº¦ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ âš¡ é«˜é€Ÿä¸‹è½½ åˆ©ç”¨è¿…é›·P2PæŠ€æœ¯ æä¾›æé€Ÿä¸‹è½½ä½“éªŒï¼Œå……åˆ†åˆ©ç”¨å¸¦å®½èµ„æº ğŸŒ å¤šåè®®æ”¯æŒ HTTPã€HTTPSã€FTPã€BTã€ç£åŠ›é“¾æ¥ æ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµä¸‹è½½åè®® ğŸ“± è¿œç¨‹ç®¡ç† Webç•Œé¢ç®¡ç† éšæ—¶éšåœ°æ·»åŠ å’Œç®¡ç†ä¸‹è½½ä»»åŠ¡ ğŸ’¾ èµ„æºèŠ‚çº¦ æ™ºèƒ½èµ„æºè°ƒåº¦ ä¸‹è½½åŒæ—¶ä¸å½±å“å…¶ä»–æœåŠ¡è¿è¡Œ ğŸ”’ å®‰å…¨å¯é  å®¹å™¨åŒ–éƒ¨ç½² ä¸ä¸»æœºç³»ç»Ÿéš”ç¦»ï¼Œå®‰å…¨å¯é  ğŸ“Š ä»»åŠ¡ç®¡ç† æ‰¹é‡æ“ä½œæ”¯æŒ æ”¯æŒæš‚åœã€ç»§ç»­ã€åˆ é™¤ç­‰å¤šç§æ“ä½œ ğŸ–¥ï¸ ç•Œé¢å‹å¥½ ç®€æ´Webç•Œé¢ ç›´è§‚æ˜“ç”¨çš„ç®¡ç†ç•Œé¢ ğŸ³ è½»é‡ä¾¿æ· Dockerä¸€é”®éƒ¨ç½² å¿«é€Ÿå®‰è£…ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ ğŸ³ ä¸€ã€Docker éƒ¨ç½²è¿…é›·ä¸‹è½½å™¨ 1. Debian ç³»ç»Ÿéƒ¨ç½²é…ç½® ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 mkdir -p /mnt/mydisk/home/xunlei \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: xunlei: container_name: xunlei image: cnk3x/xunlei:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;2345:2345\u0026#34; volumes: - ./config:/xunlei/data - /vol2/1000/downloads/xunlei:/xunlei/downloads - /vol2/1000/media/movie:/xunlei/å½±è§†ä¸‹è½½ environment: - XL_DASHBOARD_USERNAME=admin - XL_DASHBOARD_PASSWORD=12345678 # âš ï¸ è¯·ä¿®æ”¹ä¸ºå¼ºå¯†ç  - TZ=Asia/Shanghai privileged: true hostname: mynas # ğŸ” é»˜è®¤ç™»å½•ä¿¡æ¯: # ç”¨æˆ·å: admin # å¯†ç : 12345678 (è¯·ç«‹å³ä¿®æ”¹) # ğŸŒ è®¿é—®åœ°å€: http://æœåŠ¡å™¨IP:2345 EOF 2. ARM/ARS2 ç³»ç»Ÿéƒ¨ç½²é…ç½® ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 mkdir -p /mnt/mydisk/home/xunlei \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: xunlei: container_name: xunlei image: cnk3x/xunlei:latest restart: unless-stopped network_mode: bridge ports: - \u0026#34;2345:2345\u0026#34; volumes: - ./config:/xunlei/data - /mnt/mydisk/downloads/xunlei:/xunlei/downloads environment: - XL_DASHBOARD_USERNAME=admin - XL_DASHBOARD_PASSWORD=12345678 # âš ï¸ è¯·ä¿®æ”¹ä¸ºå¼ºå¯†ç  - TZ=Asia/Shanghai privileged: true hostname: mynas # ğŸ—ï¸ æ­¤é…ç½®ä¸“ä¸º ARM æ¶æ„è®¾å¤‡è®¾è®¡ # ğŸ” é»˜è®¤ç™»å½•ä¿¡æ¯: # ç”¨æˆ·å: admin # å¯†ç : 12345678 (è¯·ç«‹å³ä¿®æ”¹) EOF 3. å¯åŠ¨è¿…é›·ä¸‹è½½å™¨æœåŠ¡ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨è¿…é›·ä¸‹è½½å™¨ 1. åˆå§‹è®¾ç½® ğŸ¯ è®¿é—®ç®¡ç†ç•Œé¢: æ‰“å¼€ http://10.10.10.245:2345 ç™»å½•ç³»ç»Ÿ: ç”¨æˆ·å: admin å¯†ç : 12345678 (è¯·ç«‹å³ä¿®æ”¹) ä¿®æ”¹å¯†ç : é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  é…ç½®ä¸‹è½½è·¯å¾„: ç¡®è®¤ä¸‹è½½ç›®å½•è®¾ç½®æ­£ç¡® 2. æ·»åŠ ä¸‹è½½ä»»åŠ¡ ğŸ“¥ HTTP/HTTPS ä¸‹è½½: ç›´æ¥ç²˜è´´æ–‡ä»¶é“¾æ¥ ç£åŠ›é“¾æ¥ä¸‹è½½: ç²˜è´´ magnet: å¼€å¤´çš„é“¾æ¥ BT ç§å­ä¸‹è½½: ç‚¹å‡»ä¸Šä¼ ç§å­æ–‡ä»¶ æ‰¹é‡ä¸‹è½½: æ”¯æŒåŒæ—¶æ·»åŠ å¤šä¸ªä¸‹è½½ä»»åŠ¡ 3. ä¸‹è½½ç®¡ç† âš™ï¸ â¸ï¸ æš‚åœ/ç»§ç»­: éšæ—¶æ§åˆ¶ä¸‹è½½ä»»åŠ¡ ğŸ—‘ï¸ åˆ é™¤ä»»åŠ¡: ç§»é™¤å·²å®Œæˆæˆ–ä¸éœ€è¦çš„ä»»åŠ¡ ğŸ“Š é€Ÿåº¦é™åˆ¶: è®¾ç½®ä¸Šä¼ ä¸‹è½½é€Ÿåº¦é™åˆ¶ ğŸ¯ ä¼˜å…ˆçº§è®¾ç½®: è°ƒæ•´ä»»åŠ¡ä¸‹è½½ä¼˜å…ˆçº§ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://xunlei.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/xunlei.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name xunlei.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:2345; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/xunlei # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop xunlei docker start xunlei docker restart xunlei # åˆ é™¤å®¹å™¨ docker rm xunlei # è¿›å…¥å®¹å™¨Shell docker exec -it xunlei sh docker exec -it xunlei bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs xunlei docker logs -f xunlei docker logs --tail 50 xunlei # ç›‘æ§èµ„æºä½¿ç”¨ docker stats xunlei # æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect xunlei 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi cnk3x/xunlei:latest docker image prune -f docker image prune -a -f âš¡ å¯èˆªä¸‹è½½ï¼Œæé€Ÿæ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº†è¿…é›·ä¸‹è½½å™¨ï¼Œå¹¶é€šè¿‡ Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâš¡ æé€Ÿä¸‹è½½ äº«å—è¿…é›·P2PæŠ€æœ¯å¸¦æ¥çš„æè‡´ä¸‹è½½ä½“éªŒï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç½‘ç»œå¸¦å®½\nğŸŒ è¿œç¨‹ç®¡ç† éšæ—¶éšåœ°é€šè¿‡ Web ç•Œé¢æ·»åŠ å’Œç®¡ç†ä¸‹è½½ä»»åŠ¡ï¼Œæ‰“ç ´æ—¶ç©ºé™åˆ¶\nğŸ”§ å¤šåè®®æ”¯æŒ å…¨é¢æ”¯æŒ HTTPã€BTã€ç£åŠ›é“¾æ¥ç­‰å¤šç§ä¸‹è½½åè®®ï¼Œä¸€ç«™å¼è§£å†³ä¸‹è½½éœ€æ±‚\nğŸ”’ å®‰å…¨å¯é  å®¹å™¨åŒ–éƒ¨ç½²ç¡®ä¿ç¯å¢ƒéš”ç¦»ï¼Œä¿éšœç³»ç»Ÿå®‰å…¨ç¨³å®šè¿è¡Œ\nä¸‹è½½ä¸ä»…æ˜¯è·å–èµ„æºçš„æ–¹å¼ï¼Œæ›´æ˜¯æ•°å­—ç”Ÿæ´»çš„æ•ˆç‡å¼•æ“ã€‚æ„¿è¿…é›·ä¸‹è½½å™¨æˆä¸ºä½ å¯é çš„ä¸‹è½½ä¼™ä¼´ï¼Œè®©ä½ çš„æ¯ä¸€æ¬¡èµ„æºè·å–éƒ½å˜å¾—ç®€å•ã€é«˜æ•ˆã€ç¨³å®šã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œé‡Šæ”¾ä½ çš„ç½‘ç»œæ½œèƒ½ï¼Œä½“éªŒæé€Ÿä¸‹è½½çš„ç•…å¿«æ„Ÿå—ï¼ğŸŒŠ\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ è¿…é›·ä¸‹è½½å™¨å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä¸‹è½½æ„‰å¿«ï¼Œèµ„æºæ»¡è½½ï¼ğŸ‰\n","date":"2024-12-07T08:39:56+08:00","image":"https://file.meimolihan.eu.org/img/xunlei-01.webp","permalink":"https://blog.meimolihan.eu.org/p/fb1b9b6c/","title":"Docker éƒ¨ç½² xunlei ä¸‹è½½å™¨ ğŸ“¥"},{"content":"Docker éƒ¨ç½² Verysync å¾®åŠ›åŒæ­¥ ğŸ”„ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Verysync 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Verysync 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåŒæ­¥ï¼Œè¿æ¥æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Verysync å®˜ç½‘åœ°å€ï¼š http://verysync.com ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/Jonnyan404/verysync ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/jonnyan404/verysync ** Verysyncï¼ˆå¾®åŠ›åŒæ­¥ï¼‰ **æ˜¯ä¸€æ¬¾é«˜æ•ˆçš„æ•°æ®åŒæ­¥å·¥å…·ï¼Œé‡‡ç”¨ P2P æŠ€æœ¯å®ç°å¤šè®¾å¤‡é—´çš„æ–‡ä»¶åŒæ­¥ã€‚å®ƒæ”¯æŒè·¨å¹³å°ä½¿ç”¨ï¼Œå¯ä»¥åœ¨ä¸åŒè®¾å¤‡ä¹‹é—´å®‰å…¨ã€é«˜æ•ˆåœ°åŒæ­¥æ–‡ä»¶ï¼Œæ— éœ€ä¸­å¿ƒæœåŠ¡å™¨ï¼Œä¿æŠ¤ç”¨æˆ·éšç§ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”„ P2P åŒæ­¥ ç‚¹å¯¹ç‚¹ç›´æ¥åŒæ­¥ æ— éœ€ç»è¿‡ä¸­å¿ƒæœåŠ¡å™¨ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ ğŸ”’ ç«¯åˆ°ç«¯åŠ å¯† æ‰€æœ‰æ•°æ®ä¼ è¾“å‡åŠ å¯† ä¿éšœéšç§å®‰å…¨ï¼Œé˜²æ­¢æ•°æ®æ³„éœ² ğŸŒ è·¨å¹³å°æ”¯æŒ æ”¯æŒå¤šæ“ä½œç³»ç»Ÿ Windowsã€macOSã€Linuxã€Androidã€iOS å…¨å¹³å°è¦†ç›– ğŸ“ é€‰æ‹©æ€§åŒæ­¥ å¯é€‰æ‹©åŒæ­¥ç‰¹å®šå†…å®¹ çµæ´»æ§åˆ¶åŒæ­¥èŒƒå›´ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ âš¡ å¢é‡åŒæ­¥ åªåŒæ­¥å˜åŒ–éƒ¨åˆ† èŠ‚çœå¸¦å®½å’Œæ—¶é—´ï¼Œæé«˜åŒæ­¥æ•ˆç‡ ğŸ‘¥ å¤šè®¾å¤‡åä½œ æ”¯æŒå¤šè®¾å¤‡å®æ—¶åŒæ­¥ å®ç°è®¾å¤‡é—´æ— ç¼æ•°æ®åä½œ ğŸ’¾ ç‰ˆæœ¬å†å² ä¿ç•™æ–‡ä»¶å†å²ç‰ˆæœ¬ å¯éšæ—¶æ¢å¤æ—§ç‰ˆæœ¬ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± ğŸš€ é«˜æ€§èƒ½ é‡‡ç”¨é«˜æ•ˆåŒæ­¥ç®—æ³• å¿«é€Ÿå®Œæˆæ–‡ä»¶åŒæ­¥ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Verysync 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 mkdir -p /mnt/mydisk/home/verysync \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: verysync: container_name: verysync image: jonnyan404/verysync:latest restart: unless-stopped network_mode: bridge ports: - 8886:8886 # Webç®¡ç†ç•Œé¢ - 22330:22330 # æ•°æ®ä¼ è¾“ç«¯å£ volumes: - ./config:/data # é…ç½®æ–‡ä»¶ç›®å½• - /mnt:/mnt # éœ€è¦åŒæ­¥çš„ç›®å½• environment: - PUID=1000 # å»ºè®®ä½¿ç”¨å®é™…ç”¨æˆ·ID - PGID=1000 # å»ºè®®ä½¿ç”¨å®é™…ç”¨æˆ·ç»„ID - TZ=Asia/Shanghai cap_add: - NET_ADMIN # ç½‘ç»œç®¡ç†æƒé™ logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;10m\u0026#34; max-file: \u0026#34;3\u0026#34; EOF ğŸ” å®‰å…¨æç¤ºï¼šé¦–æ¬¡ä½¿ç”¨åè¯·åŠæ—¶è®¾ç½®å¼ºå¯†ç ï¼Œå¹¶é…ç½®é˜²ç«å¢™è§„åˆ™é™åˆ¶ä¸å¿…è¦çš„ç«¯å£è®¿é—®ã€‚\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Verysync 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:8886 åŸŸåè®¿é—®ï¼š https://sync.yourdomain.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æŒ‰ç…§åˆå§‹åŒ–å‘å¯¼å®ŒæˆåŸºæœ¬è®¾ç½®ï¼š è®¾ç½®ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç  é…ç½®è®¾å¤‡åç§° è®¾ç½®åŒæ­¥ç›®å½• åˆ›å»ºæˆ–åŠ å…¥åŒæ­¥ç½‘ç»œï¼š ç”Ÿæˆæ–°çš„åŒæ­¥å¯†é’¥ æˆ–ä½¿ç”¨ç°æœ‰å¯†é’¥åŠ å…¥åŒæ­¥ç½‘ç»œ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://sync.yourdomain.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/verysync.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name sync.yourdomain.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/private.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # æé«˜ä¸Šä¼ å¤§å°é™åˆ¶ client_max_body_size 0; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; location / { proxy_pass http://127.0.0.1:8886; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; proxy_connect_timeout 300s; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /mnt/mydisk/home/verysync # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop verysync # åœæ­¢å®¹å™¨ docker start verysync # å¯åŠ¨å®¹å™¨ docker restart verysync # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm verysync # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f verysync # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it verysync sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it verysync bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it verysync sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec verysync ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect verysync # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats verysync # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs verysync # æŸ¥çœ‹æ—¥å¿— docker logs -f verysync # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 verysync # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t verysync # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªåŒæ­¥ï¼Œè¿æ¥æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Verysync å¾®åŠ›åŒæ­¥ï¼Œå¹¶å®Œæˆäº† Web ç•Œé¢çš„è®¿é—®é…ç½®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸ”„ æ— ç¼åŒæ­¥ åœ¨å¤šè®¾å¤‡é—´å®ç°æ–‡ä»¶å®æ—¶åŒæ­¥ï¼Œå‘Šåˆ«æ‰‹åŠ¨ä¼ è¾“çš„ç¹ç\nğŸ”’ å®‰å…¨åŠ å¯† é€šè¿‡ç«¯åˆ°ç«¯åŠ å¯†æŠ€æœ¯ä¿éšœæ•°æ®éšç§ï¼Œé˜²æ­¢ä¿¡æ¯æ³„éœ²\nğŸŒ è·¨å¹³å°åä½œ åœ¨ Windowsã€macOSã€Linuxã€ç§»åŠ¨ç«¯é—´è‡ªç”±åŒæ­¥\nâš¡ é«˜æ•ˆä¼ è¾“ åˆ©ç”¨ P2P æŠ€æœ¯å’Œå¢é‡åŒæ­¥æœ€å¤§åŒ–ä¼ è¾“æ•ˆç‡\næ•°æ®åŒæ­¥ï¼Œæ˜¯æ•°å­—æ—¶ä»£äº’è”äº’é€šçš„åŸºç¡€ã€‚æ„¿ Verysync æˆä¸ºä½ å¯é çš„æ•°æ®æ¡¥æ¢ï¼Œä¸ºä½ è¿æ¥æ¯ä¸€ä¸ªè®¾å¤‡ï¼ŒåŒæ­¥æ¯ä¸€ä»½é‡è¦æ–‡ä»¶ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ‰“ç ´å­¤å²›ï¼Œæ— ç¼è¿æ¥â€”â€”æ„å»ºä½ ä¸“å±çš„å¤šè®¾å¤‡åŒæ­¥ç½‘ç»œå§ï¼ğŸŒ‰\nğŸ“Œ å®šæœŸå¤‡ä»½ï¼šå»ºè®®é‡è¦æ•°æ®ä»ä¿æŒå¤šé‡å¤‡ä»½ç­–ç•¥\nğŸ”§ æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´åŒæ­¥ç­–ç•¥å’Œå¸¦å®½é™åˆ¶\nğŸŒ ç½‘ç»œé…ç½®ï¼šç¡®ä¿é˜²ç«å¢™æ­£ç¡®é…ç½®ï¼Œå…è®¸å¿…è¦çš„ç«¯å£é€šä¿¡\nğŸ› é—®é¢˜åé¦ˆï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜å¯è®¿é—® å®˜æ–¹è®ºå› è·å–æ”¯æŒ\nç¥ä½ åŒæ­¥é¡ºç•…ï¼Œæ•°æ®æ— å¿§ï¼ğŸ‰\n","date":"2024-12-07T08:39:14+08:00","image":"https://file.meimolihan.eu.org/img/verysync-01.webp","permalink":"https://blog.meimolihan.eu.org/p/984a6d96/","title":"Docker éƒ¨ç½² Verysync å¾®åŠ›åŒæ­¥ ğŸ”„"},{"content":"Docker éƒ¨ç½² Sun-Panel å¯¼èˆªé¡µ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Sun-Panel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Sun-Panel 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªå¯¼èˆªï¼Œæ¢ç´¢æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Sun-Panel å®˜ç½‘åœ°å€ï¼š https://doc.sun-panel.top/zh_cn ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/hslr-s/sun-panel ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/hslr/sun-panel Sun-Panel æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å¯¼èˆªé¡µé¢ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ•´ç†å’Œç®¡ç†å¸¸ç”¨çš„ç½‘ç«™é“¾æ¥ã€åº”ç”¨å…¥å£å’Œåœ¨çº¿å·¥å…·ã€‚å®ƒæä¾›ç¾è§‚çš„ç•Œé¢å’Œä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ˜¯æµè§ˆå™¨ä¸»é¡µçš„ç†æƒ³é€‰æ‹©ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ“Š ç½‘ç«™å¯¼èˆª æ•´ç†å’Œåˆ†ç±»å¸¸ç”¨ç½‘ç«™ å¿«é€Ÿè®¿é—®å¸¸ç”¨èµ„æºï¼Œæé«˜å·¥ä½œæ•ˆç‡ ğŸ¨ ä¸»é¢˜å®šåˆ¶ å¤šç§ä¸»é¢˜é¢œè‰²å’Œå¸ƒå±€é€‰æ‹© ä¸ªæ€§åŒ–ç•Œé¢ï¼Œæ»¡è¶³ä¸åŒå®¡ç¾éœ€æ±‚ ğŸ” æœç´¢åŠŸèƒ½ å†…ç½®æœç´¢æ¡†ï¼Œå¿«é€ŸæŸ¥æ‰¾å¯¼èˆªé¡¹ç›® ä¾¿æ·çš„å†…å®¹æ£€ç´¢ä½“éªŒ ğŸ“± å“åº”å¼è®¾è®¡ é€‚é…å„ç§è®¾å¤‡å±å¹•å°ºå¯¸ åœ¨æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ ğŸ”§ æ’ä»¶ç³»ç»Ÿ æ”¯æŒæ‰©å±•åŠŸèƒ½æ’ä»¶ å¯æ·»åŠ å¤©æ°”ã€æ—¶é’Ÿã€ç¬”è®°ç­‰å®ç”¨åŠŸèƒ½ âš¡ å¿«é€Ÿéƒ¨ç½² Docker å®¹å™¨åŒ–éƒ¨ç½² ç®€å•å¿«æ·çš„å®‰è£…å’Œå‡çº§æµç¨‹ ğŸ”’ æ•°æ®å®‰å…¨ æœ¬åœ°å­˜å‚¨ + å®šæœŸå¤‡ä»½ å®Œå…¨æŒæ¡è‡ªå·±çš„å¯¼èˆªæ•°æ® ğŸ³ ä¸€ã€Docker éƒ¨ç½² Sun-Panel 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 mkdir -p /mnt/mydisk/home/sun-panel \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: sun-panel: container_name: sun-panel image: hslr/sun-panel:latest restart: unless-stopped ports: - \u0026#34;3002:3002\u0026#34; # ç®¡ç†ç•Œé¢ç«¯å£ volumes: - ./config:/app/conf # é…ç½®æ–‡ä»¶ç›®å½• - /var/run/docker.sock:/var/run/docker.sock # Docker å¥—æ¥å­— environment: - TZ=Asia/Shanghai # æ—¶åŒºè®¾ç½® # é»˜è®¤ç™»å½•ä¿¡æ¯ # ç”¨æˆ·å: admin@sun.cc # å¯†ç : 12345678 # é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç ! EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Sun-Panel 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:3002 IP è®¿é—®ï¼š http://10.10.10.245:3002 åŸŸåè®¿é—®ï¼š https://panel.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼š ç”¨æˆ·åï¼šadmin@sun.cc å¯†ç ï¼š12345678 é‡è¦ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç  å¼€å§‹æ·»åŠ å¯¼èˆªé¡¹ç›®ã€é…ç½®ä¸»é¢˜å’Œå¸ƒå±€ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://panel.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/sun-panel.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name panel.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:3002; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªå¯¼èˆªï¼Œæ¢ç´¢æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Sun-Panel å¯¼èˆªé¡µï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ ä¸€ç«™å¼ç®¡ç† æ‰€æœ‰å¸¸ç”¨ç½‘ç«™å’Œåº”ç”¨ï¼Œæ‰“é€ ä¸“å±çš„æµè§ˆå™¨ä¸»é¡µ\nğŸ¨ ä¸ªæ€§åŒ–å®šåˆ¶ ä¸»é¢˜é¢œè‰²å’Œå¸ƒå±€ï¼Œåˆ›é€ ç‹¬ç‰¹çš„è§†è§‰ä½“éªŒ\nâš¡ é«˜æ•ˆè®¿é—® å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€èµ„æºï¼Œæå‡å·¥ä½œå’Œå­¦ä¹ æ•ˆç‡\nğŸ”’ å®Œå…¨è‡ªä¸» æŒæ§æ‰€æœ‰å¯¼èˆªæ•°æ®ï¼Œéšç§å®‰å…¨æ— å¿§\nå¯¼èˆªä¹‹è·¯ï¼Œæ˜¯é€šå¾€æ•ˆç‡ä¸ç§©åºçš„å¤§é—¨ã€‚æ„¿ Sun-Panel æˆä¸ºä½ æ•°å­—ç”Ÿæ´»çš„å¾—åŠ›åŠ©æ‰‹ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªéœ€è¦å¿«é€Ÿå®šä½èµ„æºçš„æ—¶åˆ»ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œæ•´ç†é“¾æ¥ï¼Œä¼˜åŒ–åŠ¨çº¿â€”â€”æ„å»ºä½ é«˜æ•ˆæœ‰åºçš„ä¸Šç½‘å…¥å£å§ï¼ğŸš€\nğŸ“Œ æŒç»­è¿­ä»£ï¼šå»ºè®®å…³æ³¨ Sun-Panel å®˜æ–¹æ–‡æ¡£ ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼Œå¯¼èˆªé«˜æ•ˆï¼ğŸ‰\n","date":"2024-12-07T08:38:20+08:00","image":"https://file.meimolihan.eu.org/img/docker-sun-panel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/24172f41/","title":"Docker éƒ¨ç½² Sun-Panel å¯¼èˆªé¡µ ğŸ³"},{"content":"Docker éƒ¨ç½² Halo åšå®¢ç³»ç»Ÿ-MySQL âœ¨ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Halo åšå®¢ 1. åˆ›å»ºç›®å½•å¹¶ç¼–å†™ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 3. MySQL ç‰ˆæœ¬ç®¡ç†ä¸éªŒè¯ ğŸ” ğŸš€ äºŒã€ä½¿ç”¨ Halo åšå®¢ 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ¯ 2. åŠŸèƒ½ç‰¹æ€§ âœ¨ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªåˆ›ä½œï¼Œè¿æ¥ä¸–ç•Œ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Halo å®˜ç½‘åœ°å€ï¼š https://www.halo.run/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/halo-dev ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/halohub/halo Halo æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¼€æºåšå®¢/CMS ç³»ç»Ÿï¼ŒåŸºäº Java å’Œ Spring Boot æ„å»ºã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„ä¸»é¢˜å’Œæ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œè®©ç”¨æˆ·å¯ä»¥è½»æ¾åˆ›å»ºå’Œç®¡ç†è‡ªå·±çš„ç½‘ç«™ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ ä¸°å¯Œçš„ä¸»é¢˜é€‰æ‹© æ”¯æŒè‡ªå®šä¹‰è®¾è®¡ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ ğŸ”Œ æ’ä»¶ç”Ÿæ€ åŠŸèƒ½æ‰©å±•çµæ´» ç¤¾åŒºæ’ä»¶ä¸°å¯Œï¼Œæ»¡è¶³å„ç§éœ€æ±‚ ğŸ“ ç¼–è¾‘å™¨ å¯Œæ–‡æœ¬å’ŒMarkdownæ”¯æŒ å¼ºå¤§çš„å†…å®¹ç¼–è¾‘ä½“éªŒ ğŸ‘¥ ç”¨æˆ·ç®¡ç† å¤šç”¨æˆ·æƒé™æ§åˆ¶ æ”¯æŒå›¢é˜Ÿåä½œå’Œæƒé™ç®¡ç† ğŸ“Š æ•°æ®ç»Ÿè®¡ è®¿é—®ç»Ÿè®¡å’Œåˆ†æ æä¾›è¯¦ç»†çš„æ•°æ®åˆ†ææŠ¥å‘Š ğŸ” SEO ä¼˜åŒ– å†…ç½®SEOåŠŸèƒ½ æå‡æœç´¢å¼•æ“æ’åå’Œå¯è§åº¦ ğŸŒ å“åº”å¼è®¾è®¡ å¤šç«¯é€‚é… åœ¨æ‰‹æœºã€å¹³æ¿å’Œç”µè„‘ä¸Šå‡æœ‰è‰¯å¥½ä½“éªŒ ğŸ³ Docker éƒ¨ç½² å®¹å™¨åŒ–éƒ¨ç½² ç®€å•ä¾¿æ·ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Halo åšå®¢ 1. åˆ›å»ºç›®å½•å¹¶ç¼–å†™ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 mkdir -p /mnt/mydisk/home/halo \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: halo: container_name: halo image: registry.fit2cloud.com/halo/halo:2 restart: always depends_on: halodb: condition: service_healthy networks: halo_network: null volumes: - ./config/halo2:/root/.halo2 ports: - 8090:8090 healthcheck: test: - CMD - curl - -f - http://localhost:8090/actuator/health/readiness interval: 30s timeout: 5s retries: 5 start_period: 30s command: - --spring.r2dbc.url=r2dbc:pool:mysql://halodb:3306/halo - --spring.r2dbc.username=root - --spring.r2dbc.password=o#DwN\u0026amp;JSa56 - --spring.sql.init.platform=mysql - --halo.external-url=https://www.mobufan.eu.org:666 halodb: container_name: halodb image: mysql:9.4.0 restart: always networks: halo_network: null command: - --character-set-server=utf8mb4 - --collation-server=utf8mb4_general_ci - --explicit_defaults_for_timestamp=true volumes: - ./config/mysql:/var/lib/mysql - ./config/mysqlBackup:/data/mysqlBackup ports: - 3306:3306 healthcheck: test: - CMD - mysqladmin - ping - -h - 127.0.0.1 - --silent interval: 3s retries: 5 start_period: 30s environment: - MYSQL_ROOT_PASSWORD=o#DwN\u0026amp;JSa56 - MYSQL_DATABASE=halo networks: halo_network: null # Haloåšå®¢_åå°åœ°å€ï¼šhttp://10.10.10.245:8090/console EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d 3. MySQL ç‰ˆæœ¬ç®¡ç†ä¸éªŒè¯ ğŸ” å¦‚éœ€ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„ MySQL é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢å¯ç”¨ç‰ˆæœ¬æ ‡ç­¾ï¼š 1 2 3 4 docker run --rm quay.io/skopeo/stable list-tags docker://mysql \\ | jq -r \u0026#39;.Tags[]\u0026#39; \\ | grep -E \u0026#39;^[8-9]\\.\u0026#39; \\ | sort -V éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ MySQL ç‰ˆæœ¬ï¼š 1 docker exec -it halodb mysql -uroot -p\u0026#39;o#DwN\u0026amp;JSa56\u0026#39; -e \u0026#34;SELECT @@version;\u0026#34; ğŸš€ äºŒã€ä½¿ç”¨ Halo åšå®¢ 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:8090/console æŒ‰ç…§é¡µé¢æç¤ºå®Œæˆåˆå§‹è®¾ç½®ï¼š åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· è®¾ç½®åšå®¢åŸºæœ¬ä¿¡æ¯ é€‰æ‹©åˆå§‹ä¸»é¢˜ 2. åŠŸèƒ½ç‰¹æ€§ âœ¨ ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ: ä¸°å¯Œçš„ä¸»é¢˜é€‰æ‹©ï¼Œæ”¯æŒè‡ªå®šä¹‰ ğŸ”Œ æ’ä»¶ç”Ÿæ€: æ‰©å±•åŠŸèƒ½ï¼Œæ»¡è¶³å„ç§éœ€æ±‚ ğŸ“ ç¼–è¾‘å™¨: å¼ºå¤§çš„å¯Œæ–‡æœ¬å’ŒMarkdownç¼–è¾‘å™¨ ğŸ‘¥ ç”¨æˆ·ç®¡ç†: å¤šç”¨æˆ·æ”¯æŒï¼Œæƒé™æ§åˆ¶ ğŸ“Š æ•°æ®ç»Ÿè®¡: è®¿é—®ç»Ÿè®¡å’Œå†…å®¹åˆ†æ ğŸ” SEO ä¼˜åŒ–: å†…ç½®SEOåŠŸèƒ½ï¼Œæå‡æœç´¢å¼•æ“æ’å ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://halo.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/halo.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name halo.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:8090; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/halo # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop halo halodb docker start halo halodb docker restart halo halodb # åˆ é™¤å®¹å™¨ docker rm halo halodb # è¿›å…¥å®¹å™¨Shell docker exec -it halo sh docker exec -it halo bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs halo docker logs halodb docker logs -f halo docker logs --tail 50 halodb # ç›‘æ§èµ„æºä½¿ç”¨ docker stats halo halodb # æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect halo 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi halohub/halo:2.20.12 mysql:8.3.0 docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªåˆ›ä½œï¼Œè¿æ¥ä¸–ç•Œ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Halo åšå®¢ç³»ç»Ÿï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâœï¸ è‡ªç”±è¡¨è¾¾ ä¹¦å†™æ‰€æƒ³ã€è®°å½•ç”Ÿæ´»ã€åˆ†äº«çŸ¥è¯†ï¼Œæ‰“é€ å±äºä½ è‡ªå·±çš„å†…å®¹å¤©åœ°\nğŸ¨ ä¸ªæ€§å®šåˆ¶ å€ŸåŠ©ä¸°å¯Œçš„ä¸»é¢˜ä¸æ’ä»¶ï¼Œæ„å»ºç‹¬ä¸€æ— äºŒçš„åšå®¢é£æ ¼ä¸åŠŸèƒ½\nğŸŒ å¹¿æ³›ä¼ æ’­ é€šè¿‡å¤šç«¯é€‚é…ä¸SEOä¼˜åŒ–ï¼Œè®©ä½ çš„å†…å®¹è¢«æ›´å¤šäººå‘ç°ä¸è®¤å¯\nğŸ¤ äº’åŠ¨äº¤æµ å¼€æ”¾è¯„è®ºä¸è®¢é˜…åŠŸèƒ½ï¼Œä¸è¯»è€…å»ºç«‹æ›´æ·±åº¦çš„è¿æ¥ä¸å¯¹è¯\nåšå®¢ä¸ä»…æ˜¯è®°å½•çš„å·¥å…·ï¼Œæ›´æ˜¯æ€æƒ³çš„è½½ä½“å’Œè¿æ¥çš„æ¡¥æ¢ã€‚æ„¿ Halo æˆä¸ºä½ ç•…æ‰€æ¬²è¨€ã€å±•ç¤ºè‡ªæˆ‘çš„æœ€ä½³ä¼™ä¼´ï¼Œé™ªä¼´ä½ åœ¨æ¯ä¸€ä¸ªåˆ›ä½œçš„æ—¶åˆ»å’Œåˆ†äº«çš„ç¬é—´ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œå‘å¸ƒä½ çš„ç¬¬ä¸€ç¯‡åšå®¢ï¼Œå‘ä¸–ç•Œå‘å‡ºä½ çš„å£°éŸ³å§ï¼ğŸš€\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®è®¢é˜… Halo å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¸»é¢˜æ’ä»¶ã€‚\nğŸ› åé¦ˆä¸æ”¯æŒï¼šä½¿ç”¨ä¸­å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ å†™ä½œæ„‰å¿«ï¼Œåšå®¢æœ‰æˆï¼ğŸ‰\n","date":"2024-12-07T08:36:43+08:00","image":"https://file.meimolihan.eu.org/img/halo-01.webp","permalink":"https://blog.meimolihan.eu.org/p/de33876c/","title":"Docker éƒ¨ç½² Halo åšå®¢ç³»ç»Ÿ-MySQL âœ¨"},{"content":"CentOS é…ç½® SSH æœåŠ¡æŒ‡å— ğŸ” ğŸ“‹ ç›®å½•å¯¼èˆª ğŸŒŸ ç®€ä»‹ ğŸ”§ ä¸€ã€å®‰è£…å’Œæ›´æ–° SSH æœåŠ¡ âš™ï¸ äºŒã€é…ç½® SSH æœåŠ¡å™¨ ğŸ›¡ï¸ ä¸‰ã€å¢å¼º SSH å®‰å…¨æ€§ï¼ˆæ¨èï¼‰ ğŸ” å››ã€éªŒè¯é…ç½® ğŸ’¡ äº”ã€é«˜çº§é…ç½®é€‰é¡¹ ğŸš¨ å…­ã€æ•…éšœæ’é™¤ ğŸ“Š ä¸ƒã€SSH é…ç½®å‚æ•°è¯´æ˜ ğŸ”’ å…«ã€å®‰å…¨æœ€ä½³å®è·µ ğŸŒŸ ç®€ä»‹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ CentOS ç³»ç»Ÿä¸Šé…ç½® SSH æœåŠ¡å™¨ï¼Œæé«˜å®‰å…¨æ€§å’Œè¿æ¥ç¨³å®šæ€§ã€‚\nğŸ”§ ä¸€ã€å®‰è£…å’Œæ›´æ–° SSH æœåŠ¡ 1. ğŸ“¦ æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£… OpenSSH æœåŠ¡å™¨ 1 yum -y update \u0026amp;\u0026amp; yum install -y openssl openssh-server 2. ğŸ“ æŸ¥çœ‹ SSH é…ç½®æ–‡ä»¶ 1 cat /etc/ssh/sshd_config âš™ï¸ äºŒã€é…ç½® SSH æœåŠ¡å™¨ 1. âš¡ ä¿®æ”¹ SSH é…ç½®æ–‡ä»¶å¹¶é‡å¯æœåŠ¡ 1 2 3 4 5 # å¤‡ä»½åŸé…ç½®æ–‡ä»¶å¹¶åº”ç”¨ä¿®æ”¹ sed -i.bak -e \u0026#39;/Port 22/ a Port 22\u0026#39; -e \u0026#39;/PermitRootLogin/ a PermitRootLogin yes\u0026#39; -e \u0026#39;/ClientAliveInterval/ a ClientAliveInterval 10\u0026#39; -e \u0026#39;/ClientAliveCountMax/ a ClientAliveCountMax 999\u0026#39; /etc/ssh/sshd_config # é‡å¯ SSH æœåŠ¡å¹¶æ˜¾ç¤ºæœåŠ¡å™¨ IP systemctl restart sshd \u0026amp;\u0026amp; hostname -I 2. ğŸ“‹ é…ç½®ä¿®æ”¹è¯´æ˜ é…ç½®å˜æ›´è¯´æ˜ï¼š\nåŸé…ç½® ä¿®æ”¹åé…ç½® è¯´æ˜ #Port 22 Port 22 å¯ç”¨ SSH ç«¯å£ 22 #PermitRootLogin prohibit-password PermitRootLogin yes å…è®¸ root ç”¨æˆ·ç™»å½• #ClientAliveInterval 0 ClientAliveInterval 10 æ¯10ç§’å‘é€ä¸€æ¬¡ä¿æ´»ä¿¡å· #ClientAliveCountMax 3 ClientAliveCountMax 999 å…è®¸999æ¬¡ä¿æ´»ä¿¡å·æ— å“åº” ğŸ›¡ï¸ ä¸‰ã€å¢å¼º SSH å®‰å…¨æ€§ï¼ˆæ¨èï¼‰ 1. ğŸ”’ è¿›ä¸€æ­¥å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¤‡ä»½å½“å‰é…ç½® cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup # ä½¿ç”¨æ›´å®‰å…¨çš„é…ç½® cat \u0026gt;\u0026gt; /etc/ssh/sshd_config \u0026lt;\u0026lt; EOF # å®‰å…¨å¢å¼ºé…ç½® Protocol 2 MaxAuthTries 3 MaxSessions 10 LoginGraceTime 60 PermitEmptyPasswords no X11Forwarding no EOF # é‡å¯ SSH æœåŠ¡ systemctl restart sshd 2. ğŸ”¥ é…ç½®é˜²ç«å¢™ 1 2 3 4 5 6 # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ systemctl status firewalld # å¦‚æœé˜²ç«å¢™å¯ç”¨ï¼Œç¡®ä¿ SSH ç«¯å£å¼€æ”¾ firewall-cmd --permanent --add-service=ssh firewall-cmd --reload ğŸ” å››ã€éªŒè¯é…ç½® 1. ğŸ“Š æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ 1 systemctl status sshd 2. ğŸ§ª æµ‹è¯• SSH è¿æ¥ ä»å¦ä¸€å°æœºå™¨æµ‹è¯•è¿æ¥ï¼š\n1 ssh username@your_server_ip 3. ğŸ‘€ æŸ¥çœ‹å½“å‰é…ç½® 1 2 3 4 5 # æŸ¥çœ‹ç”Ÿæ•ˆçš„ SSH é…ç½® sshd -T # æŸ¥çœ‹ç›‘å¬çš„ç«¯å£ netstat -tlnp | grep ssh ğŸ’¡ äº”ã€é«˜çº§é…ç½®é€‰é¡¹ 1. ğŸ”„ æ›´æ”¹é»˜è®¤ SSH ç«¯å£ï¼ˆå¢å¼ºå®‰å…¨æ€§ï¼‰ 1 2 3 4 5 6 7 8 9 10 # ä¿®æ”¹ SSH ç«¯å£ä¸º 2222 sed -i \u0026#39;s/^#Port 22/Port 2222/\u0026#39; /etc/ssh/sshd_config # æ›´æ–°é˜²ç«å¢™è§„åˆ™ firewall-cmd --permanent --remove-service=ssh firewall-cmd --permanent --add-port=2222/tcp firewall-cmd --reload # é‡å¯ SSH systemctl restart sshd 2. ğŸ”‘ ä½¿ç”¨å¯†é’¥è®¤è¯ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 # åœ¨å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥ ssh-keygen -t rsa -b 4096 # å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨ ssh-copy-id username@your_server_ip # åœ¨æœåŠ¡å™¨ä¸Šç¦ç”¨å¯†ç è®¤è¯ sed -i \u0026#39;s/^#PasswordAuthentication yes/PasswordAuthentication no/\u0026#39; /etc/ssh/sshd_config systemctl restart sshd 3. ğŸ‘¥ é™åˆ¶ç”¨æˆ·è®¿é—® 1 2 3 4 5 6 7 # åªå…è®¸ç‰¹å®šç”¨æˆ·è®¿é—® echo \u0026#34;AllowUsers username1 username2\u0026#34; \u0026gt;\u0026gt; /etc/ssh/sshd_config # æˆ–æ‹’ç»ç‰¹å®šç”¨æˆ·è®¿é—® echo \u0026#34;DenyUsers username3\u0026#34; \u0026gt;\u0026gt; /etc/ssh/sshd_config systemctl restart sshd ğŸš¨ å…­ã€æ•…éšœæ’é™¤ 1. âŒ å¦‚æœæ— æ³•è¿æ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ SSH æœåŠ¡æ˜¯å¦è¿è¡Œ systemctl status sshd # æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬ netstat -tlnp | grep :22 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® firewall-cmd --list-all # æŸ¥çœ‹ SSH æ—¥å¿— tail -f /var/log/secure 2. ğŸ”„ æ¢å¤é…ç½® å¦‚æœé…ç½®å‡ºé”™ï¼Œå¯ä»¥æ¢å¤å¤‡ä»½ï¼š\n1 2 cp /etc/ssh/sshd_config.bak /etc/ssh/sshd_config systemctl restart sshd ğŸ“Š ä¸ƒã€SSH é…ç½®å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ æ¨èå€¼ Port SSH ç›‘å¬ç«¯å£ 22 æˆ–è‡ªå®šä¹‰é«˜ç«¯å£ PermitRootLogin æ˜¯å¦å…è®¸ root ç™»å½• noï¼ˆæ›´å®‰å…¨ï¼‰æˆ– yes ClientAliveInterval æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¿æ´»æ¶ˆæ¯çš„æ—¶é—´é—´éš” 30-60 ClientAliveCountMax æœåŠ¡å™¨åœ¨æ–­å¼€è¿æ¥ä¹‹å‰æœªæ”¶åˆ°å®¢æˆ·ç«¯å“åº”çš„ä¿æ´»æ¶ˆæ¯æ•°é‡ 3-5 MaxAuthTries æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•° 3 PasswordAuthentication æ˜¯å¦å…è®¸å¯†ç è®¤è¯ noï¼ˆæ¨èä½¿ç”¨å¯†é’¥ï¼‰ Protocol SSH åè®®ç‰ˆæœ¬ 2 ğŸ”’ å…«ã€å®‰å…¨æœ€ä½³å®è·µ ğŸ”‘ ä½¿ç”¨å¯†é’¥è®¤è¯ï¼šç¦ç”¨å¯†ç è®¤è¯ï¼Œä½¿ç”¨ SSH å¯†é’¥å¯¹ ğŸ”„ æ›´æ”¹é»˜è®¤ç«¯å£ï¼šå‡å°‘è‡ªåŠ¨åŒ–æ”»å‡» ğŸ‘¥ é™åˆ¶ç”¨æˆ·è®¿é—®ï¼šåªå…è®¸å¿…è¦çš„ç”¨æˆ·é€šè¿‡ SSH è®¿é—® ğŸ”¥ ä½¿ç”¨é˜²ç«å¢™ï¼šé™åˆ¶ SSH ç«¯å£çš„è®¿é—®æ¥æº ğŸ”„ å®šæœŸæ›´æ–°ï¼šä¿æŒç³»ç»Ÿå’Œ SSH è½¯ä»¶åŒ…æœ€æ–° ğŸ“ ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥ SSH ç™»å½•å°è¯• ğŸ›¡ï¸ ä½¿ç”¨ Fail2banï¼šå®‰è£… Fail2ban é˜²æ­¢æš´åŠ›ç ´è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # å®‰è£… Fail2ban yum install -y epel-release yum install -y fail2ban # é…ç½® Fail2ban ä¿æŠ¤ SSH cat \u0026gt; /etc/fail2ban/jail.local \u0026lt;\u0026lt; EOF [sshd] enabled = true port = ssh logpath = /var/log/secure maxretry = 3 bantime = 3600 EOF systemctl enable fail2ban systemctl start fail2ban ğŸš€ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨çš„ CentOS SSH æœåŠ¡å™¨å°†æ›´åŠ å®‰å…¨å¯é ã€‚è®°å¾—åœ¨ä¿®æ”¹é…ç½®å‰å¤‡ä»½åŸæ–‡ä»¶ï¼Œå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…æ›´æ”¹å®‰å…¨è®¾ç½®ï¼\n","date":"2024-12-07T08:05:24+08:00","image":"https://file.meimolihan.eu.org/img/centos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/1e354bf2/","title":"CentOS é…ç½® SSH æœåŠ¡æŒ‡å— ğŸ”"},{"content":"Proxmox VE æ ¼å¼è½¬æ¢ RAW è½¬ QCOW2 æŒ‡å— ğŸ’¾ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•å°† PVE è™šæ‹Ÿæœºçš„ RAW é•œåƒæ ¼å¼è½¬æ¢ä¸º QCOW2 æ ¼å¼ï¼Œä»¥æ”¯æŒå¿«ç…§åŠŸèƒ½å¹¶ä¼˜åŒ–å­˜å‚¨æ•ˆç‡ã€‚QCOW2 æ ¼å¼æä¾›äº†æ›´å…ˆè¿›çš„å­˜å‚¨ç®¡ç†ç‰¹æ€§ï¼Œæ˜¯è™šæ‹ŸåŒ–ç¯å¢ƒä¸­æ¨èçš„ç£ç›˜æ ¼å¼é€‰æ‹©ã€‚\nâœ¨ ç‰¹ç‚¹å’ŒåŠŸèƒ½ ğŸ”¸ å¿«ç…§æ”¯æŒï¼šQCOW2 æ ¼å¼æ”¯æŒå¿«ç…§åŠŸèƒ½ï¼Œä¾¿äºç³»ç»Ÿå¤‡ä»½å’Œæ¢å¤\nğŸ”¸ åŠ¨æ€åˆ†é…ï¼šç£ç›˜ç©ºé—´æŒ‰éœ€åˆ†é…ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´\nğŸ”¸ å‹ç¼©åŠŸèƒ½ï¼šæ”¯æŒç£ç›˜é•œåƒå‹ç¼©ï¼Œè¿›ä¸€æ­¥å‡å°‘å­˜å‚¨å ç”¨\nğŸ”¸ åŠ å¯†æ”¯æŒï¼šå¯å¯¹ç£ç›˜é•œåƒè¿›è¡ŒåŠ å¯†ï¼Œå¢å¼ºæ•°æ®å®‰å…¨æ€§\nğŸ”¸ è·¨å¹³å°å…¼å®¹ï¼šQCOW2 æ ¼å¼è¢«å¤šç§è™šæ‹ŸåŒ–å¹³å°å¹¿æ³›æ”¯æŒ\nğŸ“‹ å¯¼èˆªç›®å½• âš ï¸ è½¬æ¢å‰ææ¡ä»¶ ğŸ” ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥å½“å‰ç£ç›˜çŠ¶æ€ 1. æŸ¥çœ‹è™šæ‹Ÿæœºç£ç›˜ä¿¡æ¯ 2. è¿›å…¥ç£ç›˜ç›®å½•æŸ¥çœ‹é•œåƒæ–‡ä»¶ ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šæ ¼å¼è½¬æ¢æ“ä½œ 1. æ‰§è¡Œæ ¼å¼è½¬æ¢å‘½ä»¤ 2. éªŒè¯è½¬æ¢ç»“æœ âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°è™šæ‹Ÿæœºé…ç½® 1. ä¿®æ”¹è™šæ‹Ÿæœºç£ç›˜é…ç½® 2. æ£€æŸ¥å¼•å¯¼é¡ºåº ğŸ§¹ ç¬¬å››æ­¥ï¼šæ¸…ç†æ—§æ–‡ä»¶ 1. åˆ é™¤åŸå§‹ raw æ–‡ä»¶ 2. å¯é€‰ï¼šä¿ç•™å¤‡ä»½ ğŸš€ ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯ 1. å¯åŠ¨è™šæ‹Ÿæœºæµ‹è¯• 2. æµ‹è¯•å¿«ç…§åŠŸèƒ½ âš ï¸ æ•…éšœæ’é™¤ 1. å¦‚æœæ— æ³•å¯åŠ¨ 2. å¼•å¯¼é—®é¢˜è§£å†³ 3. ç£ç›˜ç©ºé—´ä¸è¶³ ğŸ’¡ é«˜çº§æŠ€å·§ 1. æ‰¹é‡è½¬æ¢è„šæœ¬ 2. å‹ç¼© qcow2 æ–‡ä»¶ 3. è°ƒæ•´ç£ç›˜å¤§å° ğŸ“Š æ ¼å¼å¯¹æ¯”è¯´æ˜ ğŸ”’ å®‰å…¨å»ºè®® âš ï¸ è½¬æ¢å‰ææ¡ä»¶ è™šæ‹Ÿæœºå¿…é¡»å…³æœºï¼šç¡®ä¿ iStoreOS è™šæ‹Ÿæœºå®Œå…¨å…³é—­ï¼Œé¿å…æ•°æ®æŸå å¤‡ä»½é‡è¦æ•°æ®ï¼šè½¬æ¢å‰å»ºè®®å¤‡ä»½è™šæ‹Ÿæœºæ•°æ®ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤± è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼šè½¬æ¢è¿‡ç¨‹éœ€è¦é¢å¤–ç©ºé—´å­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯åŸç£ç›˜å¤§å°çš„ 1.5 å€ï¼‰ PVE Shell è®¿é—®æƒé™ï¼šéœ€è¦ç™»å½•åˆ° Proxmox VE çš„ shell ç¯å¢ƒ å®‰è£… qemu-utilsï¼šç¡®ä¿ç³»ç»Ÿå·²å®‰è£… qemu-img å·¥å…·ï¼ˆé€šå¸¸å·²é¢„è£…ï¼‰ 1 2 3 4 # æ£€æŸ¥ qemu-img å·¥å…·æ˜¯å¦å¯ç”¨ which qemu-img # å¦‚æœæœªå®‰è£…ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… apt update \u0026amp;\u0026amp; apt install qemu-utils -y ğŸ” ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥å½“å‰ç£ç›˜çŠ¶æ€ 1. æŸ¥çœ‹è™šæ‹Ÿæœºç£ç›˜ä¿¡æ¯ 1 2 3 4 5 6 7 # æŸ¥çœ‹è™šæ‹Ÿæœºåˆ—è¡¨ qm list # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰è™šæ‹ŸæœºçŠ¶æ€å’ŒID # æŸ¥çœ‹ç‰¹å®šè™šæ‹Ÿæœºé…ç½®ï¼ˆå°†101æ›¿æ¢ä¸ºä½ çš„è™šæ‹ŸæœºIDï¼‰ qm config 101 # ğŸ” æ˜¾ç¤ºè™šæ‹Ÿæœº101çš„è¯¦ç»†é…ç½®ï¼Œæ³¨æ„ç£ç›˜é…ç½®é¡¹ 2. è¿›å…¥ç£ç›˜ç›®å½•æŸ¥çœ‹é•œåƒæ–‡ä»¶ 1 2 3 4 5 6 7 # è¿›å…¥è™šæ‹Ÿæœºç£ç›˜ç›®å½•ï¼ˆå°†101æ›¿æ¢ä¸ºä½ çš„è™šæ‹ŸæœºIDï¼‰ cd /var/lib/vz/images/101/ \u0026amp;\u0026amp; ls -lh # ğŸ“ æ˜¾ç¤ºç›®å½•å†…å®¹ï¼Œç¡®è®¤rawé•œåƒæ–‡ä»¶åŠå…¶å¤§å° # æŸ¥çœ‹ç£ç›˜è¯¦ç»†ä¿¡æ¯ qemu-img info vm-101-disk-0.raw # â„¹ï¸ æ˜¾ç¤ºé•œåƒæ ¼å¼ã€è™šæ‹Ÿå¤§å°ã€å®é™…å¤§å°ç­‰ä¿¡æ¯ ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šæ ¼å¼è½¬æ¢æ“ä½œ 1. æ‰§è¡Œæ ¼å¼è½¬æ¢å‘½ä»¤ 1 2 3 4 5 6 7 # å°†rawæ ¼å¼è½¬æ¢ä¸ºqcow2æ ¼å¼ï¼ˆå°†101æ›¿æ¢ä¸ºä½ çš„è™šæ‹ŸæœºIDï¼‰ qemu-img convert -O qcow2 /var/lib/vz/images/101/vm-101-disk-0.raw /var/lib/vz/images/101/vm-101-disk-0.qcow2 # ğŸ”„ è½¬æ¢æ ¼å¼ï¼Œ-Oå‚æ•°æŒ‡å®šè¾“å‡ºæ ¼å¼ # æ˜¾ç¤ºè½¬æ¢è¿›åº¦ï¼ˆæ¨èä½¿ç”¨ï¼‰ qemu-img convert -p -O qcow2 /var/lib/vz/images/101/vm-101-disk-0.raw /var/lib/vz/images/101/vm-101-disk-0.qcow2 # â³ -på‚æ•°æ˜¾ç¤ºè½¬æ¢è¿›åº¦æ¡ï¼Œä¾¿äºä¼°è®¡å®Œæˆæ—¶é—´ 2. éªŒè¯è½¬æ¢ç»“æœ 1 2 3 4 5 6 7 # æ£€æŸ¥æ–°ç”Ÿæˆçš„qcow2æ–‡ä»¶ ls -lh /var/lib/vz/images/101/ # âœ… åº”è¯¥çœ‹åˆ°rawå’Œqcow2ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ¯”è¾ƒå®ƒä»¬çš„å¤§å° # æŸ¥çœ‹qcow2æ–‡ä»¶ä¿¡æ¯ qemu-img info vm-101-disk-0.qcow2 # â„¹ï¸ ç¡®è®¤æ ¼å¼ä¸ºqcow2ï¼Œå¹¶æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°è™šæ‹Ÿæœºé…ç½® 1. ä¿®æ”¹è™šæ‹Ÿæœºç£ç›˜é…ç½® 1 2 3 4 5 6 7 # æ›´æ–°è™šæ‹Ÿæœºç£ç›˜æŒ‡å‘æ–°çš„qcow2æ–‡ä»¶ï¼ˆå°†101æ›¿æ¢ä¸ºä½ çš„è™šæ‹ŸæœºIDï¼‰ qm set 101 --sata0 local:101/vm-101-disk-0.qcow2 # ğŸ¯ å°†sata0æ§åˆ¶å™¨æŒ‡å‘æ–°æ ¼å¼çš„ç£ç›˜ # éªŒè¯é…ç½®æ›´æ–° qm config 101 | grep sata0 # ğŸ” ç¡®è®¤ç£ç›˜è·¯å¾„å·²æ›´æ–°ä¸ºqcow2æ ¼å¼ 2. æ£€æŸ¥å¼•å¯¼é¡ºåº 1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹å½“å‰å¼•å¯¼è®¾ç½® qm config 101 | grep boot # ğŸ“‹ æ˜¾ç¤ºå¼•å¯¼é¡ºåºé…ç½® # å¦‚æœéœ€è¦ä¿®æ”¹å¼•å¯¼é¡ºåºï¼ˆç¡®ä¿sata0ä¸ºå¯åŠ¨ç›˜ï¼‰ qm set 101 --boot order=\u0026#39;sata0\u0026#39; # ğŸš€ è®¾ç½®sata0ä¸ºç¬¬ä¸€å¯åŠ¨è®¾å¤‡ # å¯¹äºUEFIå¯åŠ¨çš„è™šæ‹Ÿæœºï¼Œè¿˜éœ€è¦æ£€æŸ¥EFIç£ç›˜è®¾ç½® qm config 101 | grep efidisk0 ğŸ§¹ ç¬¬å››æ­¥ï¼šæ¸…ç†æ—§æ–‡ä»¶ 1. åˆ é™¤åŸå§‹ raw æ–‡ä»¶ 1 2 3 4 5 6 7 # ç¡®è®¤æ–°ç£ç›˜æ­£å¸¸å·¥ä½œååˆ é™¤æ—§æ–‡ä»¶ rm /var/lib/vz/images/101/vm-101-disk-0.raw # ğŸ—‘ï¸ åˆ é™¤åŸå§‹ raw æ–‡ä»¶é‡Šæ”¾ç©ºé—´ # éªŒè¯æ–‡ä»¶å·²åˆ é™¤ cd /var/lib/vz/images/101/ \u0026amp;\u0026amp; ls -lh # âœ… åº”è¯¥åªçœ‹åˆ° qcow2 æ–‡ä»¶ 2. å¯é€‰ï¼šä¿ç•™å¤‡ä»½ 1 2 3 # å¦‚æœéœ€è¦ä¿ç•™å¤‡ä»½ï¼Œå¯ä»¥ç§»åŠ¨è€Œä¸æ˜¯åˆ é™¤ mv /var/lib/vz/images/101/vm-101-disk-0.raw /var/lib/vz/images/101/vm-101-disk-0.raw.backup # ğŸ“¦ ç§»åŠ¨æ–‡ä»¶ä½œä¸ºå¤‡ä»½ï¼Œä¿ç•™7å¤© ğŸš€ ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯ 1. å¯åŠ¨è™šæ‹Ÿæœºæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 # å¯åŠ¨è™šæ‹Ÿæœº qm start 101 # ğŸ¯ å¯åŠ¨è™šæ‹Ÿæœºæµ‹è¯• # ç›‘æ§å¯åŠ¨çŠ¶æ€ qm status 101 # ğŸ“Š æŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€ # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— qm terminal 101 # ğŸ“ æŸ¥çœ‹è™šæ‹Ÿæœºæ§åˆ¶å°è¾“å‡º 2. æµ‹è¯•å¿«ç…§åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºæµ‹è¯•å¿«ç…§ qm snapshot 101 test-snapshot # ğŸ“¸ åˆ›å»ºåä¸º test-snapshot çš„å¿«ç…§ # æŸ¥çœ‹å¿«ç…§åˆ—è¡¨ qm listsnapshot 101 # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰å¿«ç…§ # æµ‹è¯•å¿«ç…§å›æ»šåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ # qm rollback 101 test-snapshot # åˆ é™¤æµ‹è¯•å¿«ç…§ qm delsnapshot 101 test-snapshot # ğŸ—‘ï¸ æ¸…ç†æµ‹è¯•å¿«ç…§ âš ï¸ æ•…éšœæ’é™¤ 1. å¦‚æœæ— æ³•å¯åŠ¨ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ç£ç›˜é…ç½® qm config 101 | grep sata # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— dmesg | grep sata # ğŸ” æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„ç£ç›˜ç›¸å…³é”™è¯¯ # æ¢å¤åŸå§‹é…ç½®ï¼ˆå¦‚æœå‡ºç°é—®é¢˜ï¼‰ qm set 101 --sata0 local:101/vm-101-disk-0.raw # â†©ï¸ ä¸´æ—¶æ¢å¤åŸå§‹é…ç½®è¿›è¡Œæ’æŸ¥ 2. å¼•å¯¼é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ BIOS è®¾ç½® qm config 101 | grep bios # å¦‚æœéœ€è¦ï¼Œä¿®æ”¹ BIOS è®¾ç½® qm set 101 --bios ovmf # æˆ–è€… qm set 101 --bios seabios # æ£€æŸ¥EFIç£ç›˜è®¾ç½®ï¼ˆå¯¹äºUEFIå¯åŠ¨çš„è™šæ‹Ÿæœºï¼‰ qm config 101 | grep efidisk0 3. ç£ç›˜ç©ºé—´ä¸è¶³ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥å­˜å‚¨ç©ºé—´ df -h /var/lib/vz/ # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -f /tmp/*.qcow2 # å¦‚æœç©ºé—´ä¸è¶³ï¼Œå¯ä»¥è€ƒè™‘åœ¨å…¶ä»–ä½ç½®è½¬æ¢åå†ç§»åŠ¨ qemu-img convert -O qcow2 /var/lib/vz/images/101/vm-101-disk-0.raw /tmp/vm-101-disk-0.qcow2 mv /tmp/vm-101-disk-0.qcow2 /var/lib/vz/images/101/ ğŸ’¡ é«˜çº§æŠ€å·§ 1. æ‰¹é‡è½¬æ¢è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 #!/bin/bash # æ‰¹é‡è½¬æ¢è„šæœ¬ VM_ID=$1 cd /var/lib/vz/images/$VM_ID/ for raw_file in *.raw; do qcow2_file=\u0026#34;${raw_file%.*}.qcow2\u0026#34; echo \u0026#34;è½¬æ¢ $raw_file åˆ° $qcow2_file\u0026#34; qemu-img convert -p -O qcow2 \u0026#34;$raw_file\u0026#34; \u0026#34;$qcow2_file\u0026#34; # æ›´æ–°è™šæ‹Ÿæœºé…ç½®ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ç£ç›˜æ§åˆ¶å™¨ç±»å‹ qm set $VM_ID --sata0 local:$VM_ID/\u0026#34;$qcow2_file\u0026#34; # rm \u0026#34;$raw_file\u0026#34; # å–æ¶ˆæ³¨é‡Šä»¥è‡ªåŠ¨åˆ é™¤åŸæ–‡ä»¶ done echo \u0026#34;âœ… è½¬æ¢å®Œæˆï¼\u0026#34; 2. å‹ç¼© qcow2 æ–‡ä»¶ 1 2 3 4 5 6 # è½¬æ¢æ—¶è¿›è¡Œå‹ç¼© qemu-img convert -O qcow2 -c /var/lib/vz/images/101/vm-101-disk-0.raw /var/lib/vz/images/101/vm-101-disk-0.qcow2 # ğŸ“¦ -c å‚æ•°è¿›è¡Œå‹ç¼©ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ # å¯¹å·²å­˜åœ¨çš„qcow2æ–‡ä»¶è¿›è¡Œå‹ç¼© qemu-img convert -O qcow2 -c /var/lib/vz/images/101/vm-101-disk-0.qcow2 /var/lib/vz/images/101/vm-101-disk-0-compressed.qcow2 3. è°ƒæ•´ç£ç›˜å¤§å° 1 2 3 4 5 6 7 # è½¬æ¢åŒæ—¶è°ƒæ•´å¤§å° qemu-img convert -O qcow2 -p --preallocation=metadata /var/lib/vz/images/101/vm-101-disk-0.raw /var/lib/vz/images/101/vm-101-disk-0.qcow2 # ğŸ“ æ·»åŠ é¢„åˆ†é…å…ƒæ•°æ®ï¼Œæé«˜æ€§èƒ½ # è°ƒæ•´ç°æœ‰qcow2ç£ç›˜å¤§å° qemu-img resize /var/lib/vz/images/101/vm-101-disk-0.qcow2 +10G # ğŸ”§ å¢åŠ 10Gç©ºé—´ï¼ˆä¹Ÿå¯ä½¿ç”¨ç»å¯¹å€¼å¦‚50Gï¼‰ ğŸ“Š æ ¼å¼å¯¹æ¯”è¯´æ˜ ç‰¹æ€§ RAW æ ¼å¼ QCOW2 æ ¼å¼ å¿«ç…§æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ å‹ç¼©åŠŸèƒ½ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ ç£ç›˜æ‰©å®¹ âŒ å›°éš¾ âœ… å®¹æ˜“ æ€§èƒ½ âš¡ ç¨å¿« ğŸ“Š ç¨æ…¢ å­˜å‚¨æ•ˆç‡ ğŸ“ å›ºå®šå¤§å° ğŸ’¾ åŠ¨æ€åˆ†é… åŠ å¯†æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ è·¨å¹³å°å…¼å®¹ âœ… å¹¿æ³›æ”¯æŒ âœ… å¹¿æ³›æ”¯æŒ ğŸ”’ å®‰å…¨å»ºè®® æ“ä½œå‰å¤‡ä»½ï¼šé‡è¦è™šæ‹Ÿæœºè½¬æ¢å‰åŠ¡å¿…å¤‡ä»½ï¼Œå¯ä½¿ç”¨ qm backup å‘½ä»¤ æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æµç¨‹ï¼Œå†åœ¨ç”Ÿäº§ç¯å¢ƒæ“ä½œ ç›‘æ§è½¬æ¢è¿‡ç¨‹ï¼šå¤§å‹ç£ç›˜è½¬æ¢å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå¯ä½¿ç”¨ -p å‚æ•°ç›‘æ§è¿›åº¦ ä¿ç•™æ¢å¤é€‰é¡¹ï¼šæš‚æ—¶ä¿ç•™åŸå§‹æ–‡ä»¶ç›´åˆ°ç¡®è®¤æ–°æ–‡ä»¶æ­£å¸¸å·¥ä½œè‡³å°‘24å°æ—¶ æƒé™æ£€æŸ¥ï¼šç¡®ä¿æ“ä½œè´¦æˆ·æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ æ—¥å¿—è®°å½•ï¼šä¿å­˜æ“ä½œæ—¥å¿—ï¼Œä¾¿äºå‡ºç°é—®é¢˜æ—¶çš„æ’æŸ¥ ğŸ¯ å®Œæˆè½¬æ¢åï¼Œæ‚¨çš„ PVE è™šæ‹Ÿæœºå°†æ”¯æŒå¿«ç…§åŠŸèƒ½ï¼Œä¾¿äºè¿›è¡Œç³»ç»Ÿå¤‡ä»½å’Œæ¢å¤æ“ä½œã€‚å¦‚æœåœ¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥éšæ—¶å›é€€åˆ°åŸå§‹é…ç½®ã€‚å»ºè®®å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·çŠ¶å†µï¼Œä½¿ç”¨ qemu-img check å‘½ä»¤éªŒè¯ç£ç›˜å®Œæ•´æ€§ã€‚\n","date":"2024-12-07T08:04:30+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/f889e690/","title":"Proxmox VE æ ¼å¼è½¬æ¢ RAW è½¬ QCOW2 æŒ‡å— ğŸ’¾"},{"content":"Proxmox VE è™šæ‹Ÿæœºæ— æ³•å…³æœºè§£å†³æ–¹æ¡ˆå¤§å…¨ ğŸ”Œ å½“ PVE è™šæ‹Ÿæœºæ— æ³•æ­£å¸¸å…³æœºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œå¼ºåˆ¶å…³é—­ã€‚æœ¬æ–‡æä¾›ä»ç®€å•åˆ°å¤æ‚çš„å¤šç§è§£å†³æ–¹æ¡ˆï¼Œä»¥å…³é—­ç¼–å·ä¸º 100 çš„è™šæ‹Ÿæœºä¸ºä¾‹ã€‚\nğŸ“‘ å¯¼èˆªç›®å½• âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ âš ï¸ æ“ä½œå‰é‡è¦æç¤º ğŸ” ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€ ğŸ¯ æ–¹æ³•ä¸€ï¼šåˆ é™¤é”æ–‡ä»¶å¹¶å…³é—­ âš¡ æ–¹æ³•äºŒï¼šç»ˆæ­¢è™šæ‹Ÿæœºè¿›ç¨‹ ğŸ”§ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ç³»ç»Ÿå·¥å…· ğŸ› ï¸ æ–¹æ³•å››ï¼šé«˜çº§æ•…éšœæ’é™¤ ğŸ“‹ æ“ä½œåæ£€æŸ¥ ğŸ’¡ é¢„é˜²æªæ–½ ğŸ†˜ å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ âœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ ğŸ”§ å¤šç§è§£å†³æ–¹æ¡ˆï¼šæä¾›ä»ç®€å•åˆ°å¤æ‚çš„å››ç§è§£å†³æ–¹æ³• âš¡ å¿«é€Ÿæ“ä½œæŒ‡å—ï¼šæ¸…æ™°çš„å‘½ä»¤å’Œæ­¥éª¤è¯´æ˜ ğŸ›¡ï¸ å®‰å…¨æç¤ºï¼šåŒ…å«é£é™©æç¤ºå’Œæ•°æ®å®‰å…¨å»ºè®® ğŸ“‹ é¢„é˜²æªæ–½ï¼šæä¾›é¿å…é—®é¢˜å†æ¬¡å‘ç”Ÿçš„å»ºè®® ğŸ” è¯¦ç»†è¯´æ˜ï¼šæ¯ä¸ªå‘½ä»¤éƒ½æœ‰è§£é‡Šå’Œé¢„æœŸè¾“å‡º ğŸ¯ å®ç”¨æŠ€å·§ï¼šåŒ…å«éªŒè¯æ­¥éª¤å’Œæ•…éšœæ’é™¤æ–¹æ³• âš ï¸ æ“ä½œå‰é‡è¦æç¤º æ•°æ®é£é™©ï¼šå¼ºåˆ¶å…³æœºä¼šå¯¼è‡´æœªä¿å­˜çš„æ•°æ®ä¸¢å¤±ï¼Œè¯·è°¨æ…æ“ä½œ æœ€åæ‰‹æ®µï¼šå…ˆå°è¯•é€šè¿‡è™šæ‹Ÿæœºå†…éƒ¨ç³»ç»Ÿæ­£å¸¸å…³æœºï¼Œæ— æ•ˆæ—¶å†ä½¿ç”¨è¿™äº›æ–¹æ³• å¤‡ä»½å»ºè®®ï¼šé‡è¦æ•°æ®è¯·æå‰å¤‡ä»½ï¼Œé¿å…ä¸å¯é€†æŸå¤± æŒ‰é¡ºåºå°è¯•ï¼šä»æ–¹æ³•ä¸€å¼€å§‹ï¼Œé€æ­¥å‡çº§ï¼Œé¿å…ä¸å¿…è¦çš„é£é™© è®°å½•æ“ä½œï¼šè®°å½•ä¸‹æ‰€æœ‰æ‰§è¡Œçš„æ“ä½œå’Œç»“æœï¼Œä¾¿äºåç»­æ’æŸ¥é—®é¢˜ ğŸ” ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€ åœ¨é‡‡å–ä»»ä½•æ“ä½œå‰ï¼Œå…ˆç¡®è®¤è™šæ‹Ÿæœºçš„å½“å‰çŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ‰€æœ‰è™šæ‹ŸæœºçŠ¶æ€ qm list # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰è™šæ‹Ÿæœºçš„IDã€åç§°ã€çŠ¶æ€ç­‰ä¿¡æ¯ # ç¤ºä¾‹è¾“å‡º: # VMID NAME STATUS MEM(MB) BOOTDISK(GB) PID # 100 my-vm running 4096 50 4872 # æŸ¥çœ‹ç‰¹å®šè™šæ‹Ÿæœºè¯¦ç»†çŠ¶æ€ qm status 100 # ğŸ” æ˜¾ç¤ºè™šæ‹Ÿæœº100çš„è¯¦ç»†è¿è¡ŒçŠ¶æ€ # ç¤ºä¾‹è¾“å‡º: status: running ğŸ¯ æ–¹æ³•ä¸€ï¼šåˆ é™¤é”æ–‡ä»¶å¹¶å…³é—­ è¿™æ˜¯æœ€å¸¸ç”¨ä¸”ç›¸å¯¹å®‰å…¨çš„æ–¹æ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼š\n1. åˆ é™¤è™šæ‹Ÿæœºé”æ–‡ä»¶ 1 2 3 4 # å®‰å…¨åšæ³•ï¼šå…ˆå¤‡ä»½å†åˆ é™¤ cp /var/lock/qemu-server/lock-100.conf /var/lock/qemu-server/lock-100.conf.backup rm /var/lock/qemu-server/lock-100.conf # ğŸ”“ è§£é™¤æ–‡ä»¶é”ï¼Œå…è®¸æ“ä½œè™šæ‹Ÿæœº 2. å°è¯•å…³é—­è™šæ‹Ÿæœº 1 2 3 4 5 6 7 # å…ˆå°è¯•æ­£å¸¸å…³é—­ï¼ˆç­‰å¾…5åˆ†é’Ÿï¼‰ qm shutdown 100 --timeout 300 # ğŸ›‘ å‘é€å…³æœºä¿¡å·ï¼Œç­‰å¾…ç³»ç»Ÿæ­£å¸¸å…³é—­ # å¦‚æœä¸Šé¢æ— æ•ˆï¼Œä½¿ç”¨å¼ºåˆ¶å…³é—­ qm stop 100 # ğŸ’¥ å¼ºåˆ¶ç«‹å³å…³é—­ï¼Œä¸ç­‰å¾…å®¢æˆ·æœºå…³æœº 3. éªŒè¯å…³é—­ç»“æœ 1 2 3 4 5 6 7 # æ£€æŸ¥è™šæ‹ŸæœºçŠ¶æ€ qm status 100 # âœ… åº”è¯¥æ˜¾ç¤º: stopped # ç¡®è®¤è¿›ç¨‹å·²ç»“æŸ ps aux | grep \u0026#34;kvm -id 100\u0026#34; | grep -v grep # ğŸ” ä¸åº”è¯¥è¿”å›ä»»ä½•ç»“æœ âš¡ æ–¹æ³•äºŒï¼šç»ˆæ­¢è™šæ‹Ÿæœºè¿›ç¨‹ å½“æ–¹æ³•ä¸€æ— æ•ˆæ—¶ï¼Œç›´æ¥ç»ˆæ­¢è™šæ‹Ÿæœºè¿›ç¨‹ï¼š\n1. æŸ¥æ‰¾è™šæ‹Ÿæœºè¿›ç¨‹ 1 2 3 4 5 6 7 # æŸ¥æ‰¾è™šæ‹Ÿæœº100çš„è¿›ç¨‹ä¿¡æ¯ ps -ef | grep \u0026#34;/usr/bin/kvm -id 100\u0026#34; | grep -v grep # ğŸ‘€ ç¤ºä¾‹è¾“å‡º: # root 4872 4858 0 10:30 ? 00:00:15 /usr/bin/kvm -id 100... # æˆ–è€…ä½¿ç”¨æ›´ç²¾ç¡®çš„æŸ¥æ‰¾ ps aux | grep \u0026#34;kvm -id 100\u0026#34; | grep -v grep 2. ç»ˆæ­¢è¿›ç¨‹ 1 2 3 4 5 6 7 8 9 10 11 # æ­£å¸¸ç»ˆæ­¢è¿›ç¨‹ï¼ˆæ¨èå…ˆå°è¯•ï¼‰ kill 4872 # ğŸ¯ å‘é€ç»ˆæ­¢ä¿¡å·ï¼Œå…è®¸è¿›ç¨‹æ¸…ç†èµ„æº sleep 10 # ç­‰å¾…10ç§’ # å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹ï¼ˆå¦‚æœä¸Šé¢æ— æ•ˆï¼‰ kill -9 4872 # ğŸ’£ å¼ºåˆ¶ç«‹å³ç»ˆæ­¢ï¼Œä¸è¿›è¡Œæ¸…ç† # ä¸€æ­¥åˆ°ä½æŸ¥æ‰¾å¹¶ç»ˆæ­¢ kill $(ps -ef | grep \u0026#34;kvm -id 100\u0026#34; | grep -v grep | awk \u0026#39;{print $2}\u0026#39;) 3. éªŒè¯è¿›ç¨‹ç»ˆæ­¢ 1 2 3 4 5 6 # ç¡®è®¤è¿›ç¨‹å·²ç»ˆæ­¢ ps -p 4872 # âŒ åº”è¯¥æ˜¾ç¤º: no process found # æˆ–è€…ä½¿ç”¨ kill -0 4872 2\u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;è¿›ç¨‹ä»åœ¨è¿è¡Œ\u0026#34; || echo \u0026#34;è¿›ç¨‹å·²ç»ˆæ­¢\u0026#34; ğŸ”§ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ç³»ç»Ÿå·¥å…· ä½¿ç”¨ç³»ç»Ÿçº§å·¥å…·ç»ˆæ­¢è¿›ç¨‹ï¼š\n1. ä½¿ç”¨ killall å‘½ä»¤ 1 2 3 # ç»ˆæ­¢æ‰€æœ‰ä¸è™šæ‹Ÿæœº100ç›¸å…³çš„è¿›ç¨‹ killall -9 -r \u0026#34;.*kvm.*id 100\u0026#34; # ğŸ¯ ä½¿ç”¨æ­£åˆ™åŒ¹é…ç»ˆæ­¢ç›¸å…³è¿›ç¨‹ 2. ä½¿ç”¨ pkill å‘½ä»¤ 1 2 3 4 5 6 # é€šè¿‡è¿›ç¨‹åç»ˆæ­¢ pkill -f \u0026#34;kvm -id 100\u0026#34; # ğŸ”§ åŒ¹é…å®Œæ•´å‘½ä»¤è¡Œå­—ç¬¦ä¸² # å¼ºåˆ¶ç»ˆæ­¢ pkill -9 -f \u0026#34;kvm -id 100\u0026#34; 3. ä½¿ç”¨ skill å‘½ä»¤ 1 2 # å¦ä¸€ç§ç»ˆæ­¢æ–¹å¼ skill -9 -c \u0026#34;kvm -id 100\u0026#34; ğŸ› ï¸ æ–¹æ³•å››ï¼šé«˜çº§æ•…éšœæ’é™¤ å½“ä»¥ä¸Šæ–¹æ³•éƒ½æ— æ•ˆæ—¶ï¼Œè¿›è¡Œæ·±å…¥æ’æŸ¥ï¼š\n1. æ£€æŸ¥è™šæ‹Ÿæœºé…ç½® 1 2 3 4 5 # æŸ¥çœ‹è™šæ‹Ÿæœºé…ç½® qm config 100 # ğŸ“‹ æ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯ # æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é…ç½®é¡¹ï¼Œç‰¹åˆ«æ˜¯ç¡¬ç›˜å’ŒUSBç›´é€šè®¾ç½® 2. æ£€æŸ¥å­˜å‚¨çŠ¶æ€ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹å­˜å‚¨çŠ¶æ€ pvesm status # ğŸ’¾ æ£€æŸ¥å­˜å‚¨æ˜¯å¦æ­£å¸¸ # æŸ¥çœ‹è™šæ‹Ÿæœºç£ç›˜ qm disk list 100 # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ df -h 3. é‡å¯ç›¸å…³æœåŠ¡ 1 2 3 4 5 6 7 8 9 # é‡å¯PVEä»£ç†æœåŠ¡ systemctl restart pveproxy systemctl restart pvedaemon # é‡å¯libvirtdæœåŠ¡ systemctl restart libvirtd # æ£€æŸ¥æœåŠ¡çŠ¶æ€ systemctl status pveproxy 4. æ£€æŸ¥å†…æ ¸æ—¥å¿— 1 2 3 # æŸ¥çœ‹å†…æ ¸æ—¥å¿—ä¸­ä¸è™šæ‹Ÿæœºç›¸å…³çš„é”™è¯¯ dmesg | grep -i kvm dmesg | grep -i \u0026#34;100\u0026#34; ğŸ“‹ æ“ä½œåæ£€æŸ¥ æ“ä½œå®Œæˆåï¼Œè¿›è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥ï¼š\n1. éªŒè¯è™šæ‹ŸæœºçŠ¶æ€ 1 2 3 4 5 6 7 # ç¡®è®¤è™šæ‹Ÿæœºå·²å…³é—­ qm list | grep \u0026#34;100\u0026#34; # âœ… çŠ¶æ€åº”ä¸º: stopped # æ£€æŸ¥æ—¥å¿— tail -20 /var/log/syslog | grep -i \u0026#34;100\u0026#34; journalctl -xe | grep -i \u0026#34;100\u0026#34; 2. é‡æ–°å¯åŠ¨æµ‹è¯• 1 2 3 4 5 6 7 8 # å°è¯•æ­£å¸¸å¯åŠ¨ qm start 100 # ç›‘æ§å¯åŠ¨è¿‡ç¨‹ qm monitor 100 # æŸ¥çœ‹å¯åŠ¨æ—¥å¿— tail -f /var/log/syslog | grep -i \u0026#34;100\u0026#34; 3. æ£€æŸ¥ç³»ç»Ÿå®Œæ•´æ€§ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥PVEé›†ç¾¤çŠ¶æ€ pvecm status # æ£€æŸ¥å­˜å‚¨å¥åº·çŠ¶æ€ pvesm status -content images # æ£€æŸ¥ç½‘ç»œçŠ¶æ€ ip a bridge link ğŸ’¡ é¢„é˜²æªæ–½ é¿å…é—®é¢˜å†æ¬¡å‘ç”Ÿï¼š\n1. å®šæœŸç»´æŠ¤ 1 2 3 4 5 6 7 8 # å®šæœŸæ£€æŸ¥è™šæ‹ŸæœºçŠ¶æ€ qm list | grep running # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ find /var/lock/qemu-server/ -name \u0026#34;*.conf\u0026#34; -mtime +7 -delete # æ›´æ–°ç³»ç»Ÿ apt update \u0026amp;\u0026amp; apt upgrade 2. ç›‘æ§è®¾ç½® 1 2 3 4 5 # è®¾ç½®ç›‘æ§å‘Šè­¦ # åœ¨PVEç•Œé¢è®¾ç½®è™šæ‹Ÿæœºç›‘æ§å’Œè‡ªåŠ¨æ¢å¤ # å®‰è£…ç›‘æ§ä»£ç† apt install sensu-client 3. å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 # å®šæœŸå¤‡ä»½é‡è¦è™šæ‹Ÿæœº vzdump 100 -compress gzip -mode snapshot -storage local # è®¾ç½®è‡ªåŠ¨å¤‡ä»½ # é€šè¿‡PVEç®¡ç†ç•Œé¢è®¾ç½®å¤‡ä»½è®¡åˆ’ 4. ä¼˜åŒ–é…ç½® 1 2 3 # æ£€æŸ¥è™šæ‹Ÿæœºé…ç½®ä¼˜åŒ– # ç¡®ä¿ç£ç›˜ç¼“å­˜è®¾ç½®æ­£ç¡® # é¿å…è¿‡åº¦åˆ†é…èµ„æº ğŸ†˜ å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ 1. é‡å¯PVEèŠ‚ç‚¹ 1 2 3 4 5 # ä½œä¸ºæœ€åæ‰‹æ®µï¼Œé‡å¯æ•´ä¸ªèŠ‚ç‚¹ shutdown -r now # æˆ–è€…ä½¿ç”¨ reboot 2. æ£€æŸ¥ç¡¬ä»¶é—®é¢˜ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥å†…å­˜çŠ¶æ€ dmesg | grep -i memory free -h # æ£€æŸ¥ç£ç›˜å¥åº· smartctl -a /dev/sda # æ£€æŸ¥CPUæ¸©åº¦ sensors 3. å¯»æ±‚ç¤¾åŒºå¸®åŠ© ğŸ“– æŸ¥çœ‹ PVE å®˜æ–¹æ–‡æ¡£ ğŸ’¬ è®¿é—® PVE è®ºå› å¯»æ±‚å¸®åŠ© ğŸ› å¦‚æœæ˜¯è½¯ä»¶bugï¼Œè€ƒè™‘ æäº¤issue 4. è€ƒè™‘é‡è£…æˆ–è¿ç§» 1 2 3 4 5 # å¤‡ä»½è™šæ‹Ÿæœºé…ç½® qm config 100 \u0026gt; vm-100-backup.conf # è€ƒè™‘å°†è™šæ‹Ÿæœºè¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ qm migrate 100 \u0026lt;target-node\u0026gt; âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ æŒ‰é¡ºåºå°è¯•ï¼šä»æœ€æ¸©å’Œçš„æ–¹æ³•å¼€å§‹ï¼Œé€æ­¥å‡çº§åˆ°å¼ºåˆ¶æ–¹æ³• è®°å½•æ“ä½œï¼šè¯¦ç»†è®°å½•ä¸‹æ‰€æœ‰æ‰§è¡Œçš„æ“ä½œå’Œç»“æœï¼Œä¾¿äºåç»­æ’æŸ¥ ç›‘æ§å½±å“ï¼šæ“ä½œåç›‘æ§ç³»ç»Ÿç¨³å®šæ€§å’Œæ€§èƒ½æŒ‡æ ‡ åŠæ—¶å¤‡ä»½ï¼šé‡è¦æ•°æ®æ“ä½œå‰åŠ¡å¿…å¤‡ä»½ï¼Œé¿å…æ•°æ®ä¸¢å¤± äº†è§£é£é™©ï¼šå¼ºåˆ¶æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®æŸåæˆ–æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šæŸäº›å‘½ä»¤å¯èƒ½å› PVEç‰ˆæœ¬ä¸åŒè€Œæœ‰å·®å¼‚ æƒé™è¦æ±‚ï¼šç¡®ä¿æ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™ ğŸ¯ é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè§£å†³å¤§å¤šæ•° PVE è™šæ‹Ÿæœºæ— æ³•å…³æœºçš„é—®é¢˜ã€‚å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œå»ºè®®æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å¯»æ±‚æ ¹æœ¬åŸå› ï¼Œæˆ–è€ƒè™‘å‡çº§PVEç‰ˆæœ¬ã€‚\nğŸ“ éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ï¼Ÿ æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œåˆ†äº«æ‚¨çš„ç»éªŒå’Œé—®é¢˜ï¼\n","date":"2024-12-07T08:03:54+08:00","image":"https://file.meimolihan.eu.org/img/pve-02.webp","permalink":"https://blog.meimolihan.eu.org/p/01f81fda/","title":"Proxmox VE è™šæ‹Ÿæœºæ— æ³•å…³æœºè§£å†³æ–¹æ¡ˆ ğŸ”Œ"},{"content":"iStoreOS æ’ä»¶å®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ ğŸ”§ iStoreOS åŸºäº OpenWRTï¼Œå› å…¶çµæ´»çš„æ’ä»¶ç³»ç»Ÿå¤‡å—é’çã€‚ä½†å®‰è£…æ’ä»¶æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å„ç§æŠ¥é”™ï¼ˆå¦‚é”™è¯¯ä»£ç  1ã€255ï¼Œæˆ–æ–‡ä»¶å†²çªï¼‰ã€‚æœ¬æ–‡æ·±å…¥åˆ†æé—®é¢˜æ ¹æºï¼Œå¹¶æä¾›ä»ç®€å•åˆ°é«˜çº§çš„å¤šç§è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ¢å¤æ’ä»¶å®‰è£…åŠŸèƒ½ã€‚\nâœ¨ æœ¬æ–‡ç‰¹è‰² ğŸ”§ å…¨é¢è§£å†³æ–¹æ¡ˆï¼šä»åŸºç¡€å‘½ä»¤ä¿®å¤åˆ°é«˜çº§ç³»ç»Ÿè°ƒæ•´ï¼Œè¦†ç›–å„ç§åœºæ™¯ã€‚ âš¡ è¯¦ç»†æ­¥éª¤è¯´æ˜ï¼šæ¯ä¸ªå‘½ä»¤å’Œæ“ä½œéƒ½é…æœ‰è§£é‡Šå’Œé¢„æœŸè¾“å‡ºã€‚ ğŸ›¡ï¸ å®‰å…¨æ“ä½œå»ºè®®ï¼šæä¾›é£é™©æç¤ºå’Œæ•°æ®å¤‡ä»½å»ºè®®ï¼Œæ“ä½œæ›´å®‰å¿ƒã€‚ ğŸ“‹ è¯Šæ–­ä¸é¢„é˜²ï¼šä¸ä»…è§£å†³é—®é¢˜ï¼Œè¿˜æ•™ä½ å¦‚ä½•æ’æŸ¥å’Œé¢„é˜²ã€‚ ğŸ¯ å®ç”¨æŠ€å·§æ±‡æ€»ï¼šæ•´ç†äº†å¸¸è§é”™è¯¯ä»£ç åˆ†æå’Œå®ç”¨æ£€æŸ¥æ¸…å•ã€‚ ğŸ“‘ å¯¼èˆªç›®å½• âš ï¸ é—®é¢˜æ ¹æºä¸å¸¸è§é”™è¯¯ ğŸ”§ è§£å†³æ–¹æ¡ˆä¸€ï¼šç»ˆç«¯å‘½ä»¤ä¿®å¤ ğŸ”„ è§£å†³æ–¹æ¡ˆäºŒï¼šç³»ç»ŸåŒ…æ¢å¤ ğŸŒ è§£å†³æ–¹æ¡ˆä¸‰ï¼šç½‘ç»œä¸ DNS ä¿®å¤ ğŸ“¦ è§£å†³æ–¹æ¡ˆå››ï¼šè½¯ä»¶æºä¸ä¾èµ–å¤„ç† ğŸ” é«˜çº§æ•…éšœè¯Šæ–­ ğŸ’¡ é¢„é˜²æªæ–½ä¸æ—¥å¸¸ç»´æŠ¤ ğŸ†˜ ç´§æ€¥æ¢å¤æ–¹æ³• ğŸ“‹ æ€»ç»“ä¸æ£€æŸ¥æ¸…å• âš ï¸ é—®é¢˜æ ¹æºä¸å¸¸è§é”™è¯¯ iStoreOS åŸºäº OpenWRTï¼Œæ’ä»¶å®‰è£…å¤±è´¥å¯èƒ½ç”±å¤šç§åŸå› é€ æˆã€‚äº†è§£æ ¹æºæœ‰åŠ©äºå¯¹ç—‡ä¸‹è¯ã€‚\nğŸ› å¸¸è§é”™è¯¯åœºæ™¯ï¼š ä¾èµ–é—®é¢˜ï¼šæœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼ŒiStoreOS å­˜åœ¨ä¸€ä¸ªå·²çŸ¥ BUGï¼Œå½“è¿è¡Œ opkg install curl æ—¶ä¼šè§¦å‘ï¼Œå¯¼è‡´åç»­æ’ä»¶å®‰è£…å¤±è´¥ã€‚é”™è¯¯å¯èƒ½è¡¨ç°ä¸ºç¼ºå°‘ libcurl æˆ–å…¶ä»–æ ¸å¿ƒåº“ï¼ˆå¦‚ libubox æˆ– luci-lib-ipkgï¼‰ã€‚ æ–‡ä»¶å†²çªï¼šæŸä¸ªæ’ä»¶å°è¯•å®‰è£…çš„æ–‡ä»¶å·²è¢«å…¶ä»–æ’ä»¶å®‰è£…ã€‚ä¾‹å¦‚ï¼Œè¯­è¨€åŒ…æ–‡ä»¶ (.lmo) å¸¸å‘ç”Ÿå†²çªã€‚ è½¯ä»¶æºæ··ä¹±ï¼šæ··åˆä½¿ç”¨äº†å¤šä¸ªä¸å…¼å®¹çš„ç¬¬ä¸‰æ–¹è½¯ä»¶æºï¼Œå¯¼è‡´åŒ…ç‰ˆæœ¬ä¸ä¸€è‡´å’Œä¾èµ–å…³ç³»æ··ä¹±ã€‚ æ¶æ„ä¸å…¼å®¹ï¼šå°è¯•å®‰è£…ä¸å½“å‰è®¾å¤‡ CPU æ¶æ„ï¼ˆå¦‚ armã€aarch64ã€x86_64ï¼‰ä¸å…¼å®¹çš„æ’ä»¶åŒ…ã€‚ ç½‘ç»œé—®é¢˜ï¼šDNS è§£æå¤±è´¥æˆ–ç½‘ç»œè¿æ¥ä¸ç•…ï¼Œå¯¼è‡´æ— æ³•ä¸‹è½½æ’ä»¶åŒ…æˆ–æ›´æ–°è½¯ä»¶æºåˆ—è¡¨ã€‚ ç©ºé—´ä¸è¶³ï¼šè®¾å¤‡å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œæ— æ³•è§£å‹å’Œå®‰è£…æ’ä»¶ã€‚ ğŸ“Š å¸¸è§é”™è¯¯ä»£ç é€ŸæŸ¥ é”™è¯¯ä»£ç  å¯èƒ½åŸå›  åˆæ­¥å»ºè®® é”™è¯¯ 1 ä¾èµ–ç¼ºå¤±ï¼ˆå¦‚ libcurlï¼‰ã€æ–‡ä»¶å†²çªã€æˆ–è½¯ä»¶æºé—®é¢˜ å°è¯•å®‰è£… libcurl æˆ– luci-lib-ipkg é”™è¯¯ 255 ä¾èµ–ç¼ºå¤±ï¼ˆå¦‚ kmod-tunï¼‰ã€æ¶æ„ä¸å…¼å®¹ æ£€æŸ¥ä¾èµ–å’Œæ¶æ„åŒ¹é…æ€§ é”™è¯¯ 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼Œå¯èƒ½ä¸ Lua æ‰§è¡Œæˆ–æƒé™æœ‰å…³ æ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤æ’ä»¶æ–‡ä»¶æ˜¯å¦å®Œæ•´ ğŸ”§ è§£å†³æ–¹æ¡ˆä¸€ï¼šç»ˆç«¯å‘½ä»¤ä¿®å¤ 1. åŸºç¡€ä¿®å¤å‘½ä»¤ iStoreOS ä¸€ä¸ªå·²çŸ¥çš„ BUG å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¿®å¤ï¼š\n1 2 3 # æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£… libcurl opkg update \u0026amp;\u0026amp; opkg install libcurl # ğŸ”„ ä¾æ¬¡æ‰§è¡Œæ›´æ–°å’Œå®‰è£…ï¼Œä¿®å¤ä¾èµ–å…³ç³» 2. å®‰è£…å…³é”®ä¾èµ– å¦‚æœåŸºç¡€ä¿®å¤æ— æ•ˆï¼Œå°è¯•å®‰è£…å…¶ä»–å¸¸è§ä¾èµ–ï¼š\n1 2 3 4 5 # å®‰è£… luci-lib-ipkgï¼ˆé’ˆå¯¹æŸäº› Web ç•Œé¢é”™è¯¯ï¼‰ opkg install luci-lib-ipkg # å®‰è£…å¸¸ç”¨åŸºç¡€åº“ opkg install libubus libubox uclient-fetch uhttpd-mod-ubus 3. å®Œæ•´ä¿®å¤æµç¨‹ 1 2 3 4 5 6 7 8 # ç¬¬ä¸€æ­¥ï¼šæ¸…ç†ç¼“å­˜ rm -rf /var/opkg-lists/ # ç¬¬äºŒæ­¥ï¼šå¼ºåˆ¶æ›´æ–°è½¯ä»¶æº opkg update --force-maintainer # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…å¿…è¦çš„åº“æ–‡ä»¶ opkg install libcurl4 curl ca-bundle ca-certificates # ç¬¬å››æ­¥ï¼šéªŒè¯ä¿®å¤ opkg list-installed | grep -E \u0026#34;(curl|libubox)\u0026#34; ğŸ”„ è§£å†³æ–¹æ¡ˆäºŒï¼šç³»ç»ŸåŒ…æ¢å¤ ä½¿ç”¨ reset_rom_pkgs å·¥å…· è¿™æ˜¯ä¸€ä¸ªæ›´å¼ºå¤§çš„ç³»ç»Ÿçº§ä¿®å¤å·¥å…·ï¼Œå¯ä»¥é‡ç½®è½¯ä»¶åŒ…çŠ¶æ€ã€‚\næ–¹æ³• Aï¼šæ‰‹åŠ¨ä¸‹è½½è¿è¡Œ ğŸ“¥ ä¸‹è½½ reset_rom_pkgs å·¥å…·ï¼ˆå¯ä»å®˜æ–¹ QQ ç¾¤æˆ–ç¤¾åŒºè·å–ï¼‰ã€‚ ğŸ–±ï¸ é€šè¿‡ iStore åº”ç”¨å•†åº—çš„\u0026quot;æ‰‹åŠ¨å®‰è£…\u0026quot;åŠŸèƒ½å®‰è£…ã€‚ ğŸ”„ å®‰è£…å®Œæˆåé‡å¯ç³»ç»Ÿã€‚ æ–¹æ³• Bï¼šä½¿ç”¨ Systools æ’ä»¶ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ åœ¨ Systools ç³»ç»Ÿå·¥å…·ç•Œé¢ä¸­ï¼Œæ‰¾åˆ°å¹¶è¿è¡Œ reset_rom_pkgs åŠŸèƒ½ã€‚ æ–¹æ³• Cï¼šå‘½ä»¤è¡Œç›´æ¥è¿è¡Œï¼ˆå¦‚æœå·¥å…·å·²å­˜åœ¨ï¼‰ 1 2 3 4 5 # å¦‚æœå·¥å…·å·²å­˜åœ¨ç³»ç»Ÿä¸­ reset_rom_pkgs # æˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„ /usr/bin/reset_rom_pkgs ğŸŒ è§£å†³æ–¹æ¡ˆä¸‰ï¼šç½‘ç»œä¸ DNS ä¿®å¤ ç½‘ç»œé—®é¢˜æ˜¯å¯¼è‡´è½¯ä»¶æºæ›´æ–°å¤±è´¥å’Œæ’ä»¶ä¸‹è½½å¤±è´¥çš„å¸¸è§åŸå› ã€‚\n1. æ£€æŸ¥å¹¶é…ç½® DNS DNS è§£æå¤±è´¥ä¼šå¯¼è‡´æ— æ³•æ‰¾åˆ°è½¯ä»¶æºæœåŠ¡å™¨ã€‚\n1 2 3 4 5 # æŸ¥çœ‹å½“å‰ DNS è®¾ç½® cat /tmp/resolv.conf.d/resolv.conf.auto # æµ‹è¯• DNS è§£æ nslookup downloads.openwrt.org æ¨èä½¿ç”¨çš„å…¬å…± DNS æœåŠ¡å™¨ï¼š\n223.5.5.5 ï¼ˆæ¨èï¼‰ ã€223.6.6.6 (é˜¿é‡Œäº‘ DNS) 114.114.114.114 (114 DNS) 8.8.8.8 (Google DNS) 1.1.1.1 (Cloudflare DNS) é…ç½®æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 # ä¸´æ—¶ä¿®æ”¹ DNSï¼ˆé‡å¯åå¤±æ•ˆï¼‰ echo \u0026#34;nameserver 223.5.5.5\u0026#34; \u0026gt; /tmp/resolv.conf echo \u0026#34;nameserver 223.6.6.6\u0026#34; \u0026gt;\u0026gt; /tmp/resolv.conf # åœ¨ç½‘ç»œè®¾ç½®ä¸­æ°¸ä¹…ä¿®æ”¹ uci set network.wan.dns=\u0026#39;223.5.5.5 223.6.6.6\u0026#39; uci commit network /etc/init.d/network restart 2. æ—è·¯ç”±é…ç½®æ£€æŸ¥ âœ… ç¡®è®¤æ—è·¯ç”±çš„\u0026quot;ä½¿ç”¨é»˜è®¤ç½‘å…³\u0026quot;é€‰é¡¹å·²å‹¾é€‰ã€‚ ğŸŒ æ£€æŸ¥æ—è·¯ç”±æœ¬èº«çš„ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ã€‚ ğŸ”§ é¿å…å±€åŸŸç½‘ä¸­å­˜åœ¨å¤šä¸ª DHCP æœåŠ¡å™¨ï¼Œè¿™ä¼šå¯¼è‡´ IP åˆ†é…æ··ä¹±ã€‚ 3. IPv6 ç›¸å…³é—®é¢˜ IPv6 é…ç½®é”™è¯¯æœ‰æ—¶ä¼šå¯¼è‡´ç½‘ç»œå›é€€ç¼“æ…¢ã€‚å¦‚æœä¸éœ€è¦ IPv6ï¼Œå¯ä»¥è€ƒè™‘å…³é—­å®ƒï¼š\né€šè¿‡ Systools ç³»ç»Ÿå·¥å…·ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ç•Œé¢ç¦ç”¨ IPv6ã€‚ æˆ–æ‰‹åŠ¨ä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶ï¼ˆæ“ä½œå‰å»ºè®®å¤‡ä»½ï¼‰ã€‚ ğŸ“¦ è§£å†³æ–¹æ¡ˆå››ï¼šè½¯ä»¶æºä¸ä¾èµ–å¤„ç† 1. æ£€æŸ¥å¹¶ä¼˜åŒ–è½¯ä»¶æº æ··ä¹±çš„è½¯ä»¶æºæ˜¯å®‰è£…å¤±è´¥çš„å¸¸è§åŸå› ã€‚\n1 2 3 4 5 6 7 # æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„è½¯ä»¶æº cat /etc/opkg/customfeeds.conf # å¤‡ä»½å½“å‰è½¯ä»¶æºé…ç½® cp /etc/opkg/customfeeds.conf /etc/opkg/customfeeds.conf.bak # å»ºè®®ä»…ä¿ç•™å®˜æ–¹ç¨³å®šè½¯ä»¶æºï¼Œæ³¨é‡Šæ‰æˆ–ç§»é™¤ä¸å¯é çš„ç¬¬ä¸‰æ–¹æº åŸåˆ™ï¼šä¼˜å…ˆä½¿ç”¨å®˜æ–¹æºï¼Œæ·»åŠ ç¬¬ä¸‰æ–¹æºå‰åŠ¡å¿…äº†è§£å…¶å…¼å®¹æ€§å’Œå¯é æ€§ã€‚\n2. å¤„ç†æ–‡ä»¶å†²çª å¦‚æœé”™è¯¯æç¤ºæ–‡ä»¶å†²çªï¼ˆFile conflictï¼‰ï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸¤ä¸ªåŒ…æä¾›äº†ç›¸åŒçš„æ–‡ä»¶ã€‚\nç­–ç•¥ 1ï¼šåœ¨å®‰è£…å‘½ä»¤åæ·»åŠ  --force-overwrite é€‰é¡¹ï¼Œå¼ºåˆ¶è¦†ç›–æ–‡ä»¶ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ã€‚ 1 opkg install \u0026lt;package-name\u0026gt; --force-overwrite ç­–ç•¥ 2ï¼šå¸è½½å†²çªçš„å¦ä¸€ä¸ªæ’ä»¶ï¼Œç„¶åå†å®‰è£…å½“å‰éœ€è¦çš„æ’ä»¶ã€‚ 3. è§£å†³ä¾èµ–ç¼ºå¤± é”™è¯¯æ˜ç¡®æç¤ºç¼ºå°‘æŸä¸ªä¾èµ–ï¼ˆå¦‚ kmod-tunï¼‰æ—¶ï¼š\n1 2 3 4 5 6 # å…ˆå°è¯•å•ç‹¬å®‰è£…ç¼ºå¤±çš„ä¾èµ– opkg update opkg install \u0026lt;missing-dependency-package-name\u0026gt; # ç„¶åå†å®‰è£…åŸæ’ä»¶ opkg install \u0026lt;original-package-name\u0026gt; 4. ç©ºé—´ä¸è¶³å¤„ç† å¦‚æœè®¾å¤‡å­˜å‚¨ç©ºé—´ä¸è¶³ï¼š\n1 2 3 # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ df -h # é‡ç‚¹æŸ¥çœ‹ /overlay åˆ†åŒºçš„ä½¿ç”¨ç‡ æ¸…ç†ç¼“å­˜ï¼šopkg clean å’Œ rm -rf /tmp/opkg-lists/ã€‚ å¸è½½ä¸ç”¨çš„æ’ä»¶ã€‚ ä½¿ç”¨ U ç›˜æ‰©å®¹ overlayï¼ˆè¿›é˜¶æ“ä½œï¼Œéœ€è°¨æ…ï¼‰ã€‚ ğŸ” é«˜çº§æ•…éšœè¯Šæ–­ å½“ä¸Šè¿°æ–¹æ³•æ•ˆæœä¸ä½³æ—¶ï¼Œéœ€è¦æ·±å…¥ç³»ç»Ÿæ’æŸ¥ã€‚\n1. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— æ—¥å¿—æ˜¯å¯»æ‰¾é—®é¢˜æ ¹æºçš„æœ€ä½³é€”å¾„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å®æ—¶ç³»ç»Ÿæ—¥å¿— logread -f # æŸ¥çœ‹å®‰è£…ç›¸å…³çš„é”™è¯¯ä¿¡æ¯ï¼ˆåœ¨æ–°ç»ˆç«¯ä¸­å°è¯•å®‰è£…æ’ä»¶ï¼Œåœ¨æ­¤ç»ˆç«¯çœ‹æ—¥å¿—ï¼‰ logread | grep opkg logread | grep \u0026#34;install\u0026#34; logread | grep \u0026#34;failed\u0026#34; logread | grep \u0026#34;error\u0026#34; # æŸ¥çœ‹ DNS ç›¸å…³é”™è¯¯ logread | grep dnsmasq # æŸ¥çœ‹ DHCP å†²çª logread | grep DHCP 2. ç½‘ç»œè¯Šæ–­ 1 2 3 4 5 6 7 8 9 # æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€ ifstatus wan # æµ‹è¯•åˆ°è½¯ä»¶æºçš„å…·ä½“è¿é€šæ€§ ping -c 4 downloads.openwrt.org traceroute downloads.openwrt.org # å°è¯•å¼ºåˆ¶æ›´æ–°è½¯ä»¶æºï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯è¾“å‡º opkg update -v 3. éªŒè¯æ’ä»¶å®Œæ•´æ€§ å¯¹äºç‰¹å®šæ’ä»¶ï¼ˆå¦‚ç½‘å¿ƒäº‘ï¼‰ï¼Œå®‰è£…ä¸å®Œæ•´ä¼šå¯¼è‡´é—®é¢˜ã€‚\n1 2 3 # ç¤ºä¾‹ï¼šæ£€æŸ¥ç½‘å¿ƒäº‘æ’ä»¶æ–‡ä»¶æ˜¯å¦å­˜åœ¨ ls -la /usr/lib/lua/luci/model/cbi/wxedge/ ls -la /usr/lib/lua/luci/controller/wxedge.lua å¦‚æœæ–‡ä»¶ç¼ºå¤±ï¼Œè¯´æ˜å®‰è£…ä¸å®Œæ•´ï¼Œéœ€è¦é‡æ–°å®‰è£…ã€‚\nğŸ’¡ é¢„é˜²æªæ–½ä¸æ—¥å¸¸ç»´æŠ¤ å…»æˆè‰¯å¥½çš„ç»´æŠ¤ä¹ æƒ¯ï¼Œèƒ½å‡å°‘é—®é¢˜å‘ç”Ÿã€‚\n1. å®šæœŸç»´æŠ¤ 1 2 3 4 5 # å®šæœŸæ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜ opkg clean # å®šæœŸæ›´æ–°ç³»ç»Ÿï¼ˆä½†å»ºè®®é‡å¤§æ›´æ–°å‰å¤‡ä»½ï¼‰ opkg update \u0026amp;\u0026amp; opkg upgrade 2. å¤‡ä»½é‡è¦é…ç½® 1 2 3 4 5 6 7 8 # å¤‡ä»½è½¯ä»¶æºåˆ—è¡¨ cp /etc/opkg/customfeeds.conf /etc/opkg/customfeeds.conf.backup # å¤‡ä»½å·²å®‰è£…è½¯ä»¶åˆ—è¡¨ opkg list-installed \u0026gt; /root/installed_packages.txt # å®šæœŸå¤‡ä»½ç³»ç»Ÿé…ç½®ï¼ˆå¯é€šè¿‡ Systools æˆ–å‘½ä»¤è¡Œï¼‰ sysupgrade -b /tmp/backup.tar.gz 3. è§„èŒƒæ“ä½œ âš ï¸ è°¨æ…æ·»åŠ ç¬¬ä¸‰æ–¹è½¯ä»¶æºï¼šä»…ä»å¯ä¿¡æ¥æºæ·»åŠ ï¼Œé¿å…æ··åˆè¿‡å¤šè½¯ä»¶æºã€‚ ğŸ”§ é¿å…éšæ„è¿è¡Œä¸æ˜ç¡®çš„å‘½ä»¤ï¼šç‰¹åˆ«æ˜¯ä¿®æ”¹ç³»ç»Ÿæ ¸å¿ƒæ–‡ä»¶çš„å‘½ä»¤ã€‚ ğŸ“‹ å®‰è£…æ’ä»¶å‰ï¼šåœ¨ç¤¾åŒºæˆ–æ–‡æ¡£ä¸­æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„åé¦ˆå’Œå…¼å®¹æ€§æŠ¥å‘Šã€‚ ğŸ†˜ ç´§æ€¥æ¢å¤æ–¹æ³• å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ï¼Œç³»ç»Ÿå¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥è€ƒè™‘ï¼š\n1. ç³»ç»Ÿé‡ç½® 1 2 3 4 5 # ä¿ç•™é…ç½®é‡ç½®ï¼ˆä¼šé‡ç½®ç³»ç»Ÿè®¾ç½®ï¼Œä½†ä¿ç•™ç½‘ç»œç­‰åŸºæœ¬é…ç½®ï¼Œè°¨æ…æ“ä½œï¼‰ firstboot -r # æˆ–è€…å®Œå…¨é‡ç½®ï¼ˆæ¸…ç©ºæ‰€æœ‰æ•°æ®å’Œé…ç½®ï¼‰ firstboot è­¦å‘Šï¼šé‡ç½®æ“ä½œä¼šä¸¢å¤±å½“å‰é…ç½®ï¼ŒåŠ¡å¿…ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®ï¼\n2. é‡æ–°å®‰è£… iStoreOS ğŸ“¥ ä»å®˜ç½‘ä¸‹è½½ä¸æ‚¨è®¾å¤‡å‹å·å®Œå…¨åŒ¹é…çš„æœ€æ–°ç‰ˆ iStoreOS é•œåƒã€‚ ğŸ”„ é‡æ–°åˆ·å†™å›ºä»¶ï¼ˆå…·ä½“æ–¹æ³•è¯·å‚ç…§è®¾å¤‡åˆ·æœºæ•™ç¨‹ï¼‰ã€‚ ğŸ’¾ æ¢å¤ä¹‹å‰å¤‡ä»½çš„é…ç½®ã€‚ ğŸ“‹ æ€»ç»“ä¸æ£€æŸ¥æ¸…å• é‡åˆ°æ’ä»¶å®‰è£…å¤±è´¥æ—¶ï¼Œä½ å¯ä»¥æŒ‰ä»¥ä¸‹æ¸…å•é€æ­¥æ’æŸ¥ï¼š\nâœ… ç¬¬ä¸€æ­¥ï¼šåŸºç¡€ä¿®å¤\nè¿è¡Œ opkg update \u0026amp;\u0026amp; opkg install libcurl è¿è¡Œ opkg install luci-lib-ipkgï¼ˆé’ˆå¯¹ Web ç•Œé¢é”™è¯¯ï¼‰ âœ… ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ç½‘ç»œä¸ DNS\næµ‹è¯• ping downloads.openwrt.org æ˜¯å¦é€šç•… æ›´æ¢ä¸ºå¯é çš„ DNSï¼ˆå¦‚ 223.5.5.5ï¼‰ æ£€æŸ¥æ—è·¯ç”±/ç½‘å…³è®¾ç½®ï¼Œé¿å… DHCP å†²çª âœ… ç¬¬ä¸‰æ­¥ï¼šå¤„ç†è½¯ä»¶æºä¸ä¾èµ–\næ£€æŸ¥ /etc/opkg/customfeeds.confï¼Œç§»é™¤æˆ–æ³¨é‡Šå¯ç–‘ç¬¬ä¸‰æ–¹æº æ ¹æ®é”™è¯¯æç¤ºï¼Œæ‰‹åŠ¨å®‰è£…ç¼ºå¤±çš„ä¾èµ–ï¼ˆå¦‚ kmod-*ï¼‰ æ£€æŸ¥å­˜å‚¨ç©ºé—´ df -h âœ… ç¬¬å››æ­¥ï¼šé«˜çº§è¯Šæ–­\næŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— logread å¯»æ‰¾å…·ä½“é”™è¯¯ ä½¿ç”¨ reset_rom_pkgs å·¥å…· è€ƒè™‘æ–‡ä»¶å†²çªï¼Œå°è¯• --force-overwriteï¼ˆè°¨æ…ï¼‰ âœ… ç¬¬äº”æ­¥ï¼šæœ€åæ‰‹æ®µ\nå¤‡ä»½é…ç½® æ‰§è¡Œ firstboot -r é‡ç½®ç³»ç»Ÿæˆ–é‡æ–°åˆ·æœº ğŸ¯ ä¿æŒè€å¿ƒï¼Œä¾æ¬¡å°è¯•ä»¥ä¸Šæ­¥éª¤ï¼Œç»å¤§å¤šæ•° iStoreOS æ’ä»¶å®‰è£…é—®é¢˜éƒ½èƒ½å¾—åˆ°è§£å†³ã€‚å¦‚æœé—®é¢˜ä¾æ—§ï¼Œè¯·å¸¦ç€è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼ˆä» logread ä¸­è·å–ï¼‰åˆ°ç¤¾åŒºæˆ–è®ºå›å¯»æ±‚å¸®åŠ©ã€‚\n","date":"2024-12-07T08:03:05+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/46d96aea/","title":"iStoreOS æ’ä»¶å®‰è£…å¤±è´¥è§£å†³æ–¹æ¡ˆ ğŸ”§"},{"content":"Windows å®ç”¨å‘½ä»¤ä¸ä¼˜åŒ–æŠ€å·§ ğŸš€ âš¡ æå‡Windowsä½¿ç”¨ä½“éªŒçš„å¿…å¤‡å‘½ä»¤å’Œä¼˜åŒ–æ–¹æ¡ˆï¼Œè®©ç³»ç»Ÿè¿è¡Œæ›´æµç•…ã€æ›´é«˜æ•ˆï¼\nâœ¨ ä¸»è¦ä¼˜åŠ¿ ğŸš€ æ€§èƒ½æå‡ï¼šé€šè¿‡ä¼˜åŒ–è®¾ç½®é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼ŒåŠ å¿«è¿è¡Œé€Ÿåº¦\nğŸ”’ éšç§ä¿æŠ¤ï¼šå‡å°‘æ•°æ®æ”¶é›†ï¼Œå¢å¼ºä¸ªäººä¿¡æ¯å®‰å…¨æ€§\nğŸ¨ ç•Œé¢å®šåˆ¶ï¼šä¸ªæ€§åŒ–Windowsç•Œé¢ï¼Œæå‡ä½¿ç”¨ä½“éªŒ\nğŸ›¡ï¸ æ§åˆ¶æƒå¢å¼ºï¼šæŒæ¡ç³»ç»Ÿæ›´æ–°å’ŒåŠŸèƒ½å®‰è£…çš„ä¸»åŠ¨æƒ\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ› ï¸ ç³»ç»Ÿå®‰è£…ä¼˜åŒ– ğŸ›¡ï¸ éšç§ä¸å®‰å…¨è®¾ç½® âš™ï¸ ç³»ç»Ÿæ›´æ–°ç®¡ç† ğŸ¨ ç•Œé¢ä¸ªæ€§åŒ– ğŸ“¦ ç³»ç»Ÿç»„ä»¶ç®¡ç† ğŸ”§ é«˜çº§å®šåˆ¶æŠ€å·§ ğŸ’¡ å®ç”¨å¿«æ·é”® âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ› ï¸ ç³»ç»Ÿå®‰è£…ä¼˜åŒ– â© å®‰è£…ç³»ç»Ÿè·³è¿‡ç½‘ç»œè¿æ¥ é€‚ç”¨åœºæ™¯: å…¨æ–°å®‰è£…Windowsæ—¶è·³è¿‡å¼ºåˆ¶è”ç½‘è¦æ±‚ï¼ŒèŠ‚çœæ—¶é—´å¹¶ä¿æŠ¤éšç§\næ“ä½œæ­¥éª¤:\nåœ¨ç³»ç»Ÿå®‰è£…ç•Œé¢çš„ç½‘ç»œè¿æ¥é¡µé¢ æŒ‰ä¸‹ SHIFT + F10 æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¹¶å›è½¦ï¼š 1 oobe\\bypassnro.cmd æ•ˆæœ: ç³»ç»Ÿå°†é‡å¯å¹¶å‡ºç°\u0026quot;æˆ‘æ²¡æœ‰Internetè¿æ¥\u0026quot;é€‰é¡¹ï¼Œå¯ä»¥è·³è¿‡å¾®è½¯è´¦æˆ·ç™»å½• âœ…\næ›¿ä»£æ–¹æ³•: åœ¨éœ€è¦è¾“å…¥å¾®è½¯è´¦æˆ·çš„ç•Œé¢ï¼Œè¾“å…¥no@thankyou.comå¹¶ä»»æ„å¯†ç ï¼Œä¹Ÿä¼šè·³è¿‡è”ç½‘è¦æ±‚\nğŸ›¡ï¸ éšç§ä¸å®‰å…¨è®¾ç½® ğŸ”’ å½»åº•å…³é—­å®æ—¶ä¿æŠ¤ æ–¹æ³•ä¸€: é€šè¿‡ç»„ç­–ç•¥ç¼–è¾‘å™¨ (Windowsä¸“ä¸šç‰ˆ/ä¼ä¸šç‰ˆ)\n1 2 # æ‰“å¼€ç»„ç­–ç•¥ç¼–è¾‘å™¨ gpedit.msc å¯¼èˆªè·¯å¾„:\nè®¡ç®—æœºé…ç½® â†’ ç®¡ç†æ¨¡æ¿ â†’ Windowsç»„ä»¶ â†’ Microsoft Defenderé˜²ç—…æ¯’ â†’ å®æ—¶ä¿æŠ¤ å¯ç”¨ å…³é—­å®æ—¶ä¿æŠ¤ æ–¹æ³•äºŒ: é€šè¿‡æ³¨å†Œè¡¨ (æ‰€æœ‰Windowsç‰ˆæœ¬)\n1 2 3 4 5 # ä¸´æ—¶ç¦ç”¨å®æ—¶ä¿æŠ¤ reg add \u0026#34;HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\u0026#34; /v \u0026#34;DisableAntiSpyware\u0026#34; /t REG_DWORD /d 1 /f # é‡å¯åç”Ÿæ•ˆ shutdown /r /t 0 ğŸ”• å…³é—­å®‰å…¨ä¸­å¿ƒé€šçŸ¥ æ“ä½œè·¯å¾„:\nç»„ç­–ç•¥ç¼–è¾‘å™¨ â†’ è®¡ç®—æœºé…ç½® â†’ ç®¡ç†æ¨¡æ¿ â†’ Windowsç»„ä»¶ â†’ Windowså®‰å…¨ä¸­å¿ƒ â†’ é€šçŸ¥ å¯ç”¨ éšè—æ‰€æœ‰é€šçŸ¥ ğŸš« ç¦ç”¨é¥æµ‹å’Œæ•°æ®æ”¶é›† 1 2 3 4 5 # ç¦ç”¨è¯Šæ–­æ•°æ®æ”¶é›† reg add \u0026#34;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\u0026#34; /v \u0026#34;AllowTelemetry\u0026#34; /t REG_DWORD /d 0 /f # ç¦ç”¨å¹¿å‘ŠID reg add \u0026#34;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\AdvertisingInfo\u0026#34; /v \u0026#34;DisabledByGroupPolicy\u0026#34; /t REG_DWORD /d 1 /f âš™ï¸ ç³»ç»Ÿæ›´æ–°ç®¡ç† â¸ï¸ ç¦ç”¨Windowsæ›´æ–° æ¨èå·¥å…·: Windows Update Blocker - å…è´¹å°å·¥å…·ï¼Œä¸€é”®ç¦ç”¨æ›´æ–°\næ‰‹åŠ¨ç¦ç”¨æ–¹æ³•:\n1 2 3 4 5 6 7 8 9 10 # åœæ­¢æ›´æ–°æœåŠ¡ net stop wuauserv net stop bits # ç¦ç”¨æœåŠ¡ sc config wuauserv start= disabled sc config bits start= disabled # é‡å‘½åæ›´æ–°æ–‡ä»¶å¤¹ï¼ˆè°¨æ…æ“ä½œï¼‰ ren C:\\Windows\\SoftwareDistribution SoftwareDistribution.old æ¢å¤æ›´æ–°:\n1 2 3 4 5 6 7 # å¯ç”¨æœåŠ¡ sc config wuauserv start= auto sc config bits start= auto # å¯åŠ¨æœåŠ¡ net start wuauserv net start bits ğŸ“… å»¶è¿ŸåŠŸèƒ½æ›´æ–° 1 2 3 # å»¶è¿ŸåŠŸèƒ½æ›´æ–°90å¤© reg add \u0026#34;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\u0026#34; /v \u0026#34;DeferFeatureUpdates\u0026#34; /t REG_DWORD /d 1 /f reg add \u0026#34;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\u0026#34; /v \u0026#34;DeferFeatureUpdatesPeriodInDays\u0026#34; /t REG_DWORD /d 90 /f ğŸ¨ ç•Œé¢ä¸ªæ€§åŒ– ğŸ“‹ è®¾ç½®æ‰˜ç›˜æ å›¾æ ‡å…¨éƒ¨æ˜¾ç¤º å¿«é€Ÿè®¿é—®æ–¹æ³•:\n1 2 # æ‰“å¼€é€šçŸ¥åŒºåŸŸå›¾æ ‡è®¾ç½® shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} æ‰‹åŠ¨è®¾ç½®è·¯å¾„:\nè®¾ç½® â†’ ä¸ªæ€§åŒ– â†’ ä»»åŠ¡æ  â†’ é€šçŸ¥åŒºåŸŸ â†’ é€‰æ‹©å“ªäº›å›¾æ ‡æ˜¾ç¤ºåœ¨ä»»åŠ¡æ ä¸Š ğŸ¯ ä»»åŠ¡æ ä¼˜åŒ–æŠ€å·§ 1 2 3 4 5 6 7 8 # éšè—æœç´¢æ¡†ï¼ˆé‡Šæ”¾ä»»åŠ¡æ ç©ºé—´ï¼‰ reg add \u0026#34;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Search\u0026#34; /v \u0026#34;SearchboxTaskbarMode\u0026#34; /t REG_DWORD /d 0 /f # éšè—ä»»åŠ¡è§†å›¾æŒ‰é’® reg add \u0026#34;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\u0026#34; /v \u0026#34;ShowTaskViewButton\u0026#34; /t REG_DWORD /d 0 /f # éšè—èŠå¤©å›¾æ ‡ï¼ˆMicrosoft Teamsï¼‰ reg add \u0026#34;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\u0026#34; /v \u0026#34;TaskbarMn\u0026#34; /t REG_DWORD /d 0 /f ğŸŒ™ ç¦ç”¨æ·±è‰²æ¨¡å¼ 1 2 3 # å¼ºåˆ¶ä½¿ç”¨æµ…è‰²æ¨¡å¼ reg add \u0026#34;HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize\u0026#34; /v \u0026#34;AppsUseLightTheme\u0026#34; /t REG_DWORD /d 1 /f reg add \u0026#34;HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize\u0026#34; /v \u0026#34;SystemUsesLightTheme\u0026#34; /t REG_DWORD /d 1 /f ğŸ“¦ ç³»ç»Ÿç»„ä»¶ç®¡ç† ğŸ—‘ï¸ å¸è½½\u0026quot;å°ç»„ä»¶\u0026quot; æ–¹æ³•ä¸€: ä½¿ç”¨WinGet (Windows 11)\n1 2 # å¸è½½Web Experience Packï¼ˆåŒ…å«å°ç»„ä»¶ï¼‰ winget uninstall MicrosoftWindows.Client.WebExperience_cw5n1h2txyewy æ–¹æ³•äºŒ: é€šè¿‡PowerShell\n1 2 3 4 5 # æŸ¥çœ‹å·²å®‰è£…çš„åº”ç”¨ Get-AppxPackage *WebExperience* # å¸è½½å°ç»„ä»¶ Get-AppxPackage MicrosoftWindows.Client.WebExperience | Remove-AppxPackage ğŸ”§ å¸è½½å…¶ä»–é¢„è£…åº”ç”¨ 1 2 3 4 5 6 7 8 # å¸è½½Cortana Get-AppxPackage -AllUsers *Cortana* | Remove-AppxPackage # å¸è½½è·å–å¸®åŠ© Get-AppxPackage *GetHelp* | Remove-AppxPackage # å¸è½½Xboxç›¸å…³åº”ç”¨ Get-AppxPackage *Xbox* | Remove-AppxPackage æ³¨æ„: å¸è½½Microsoft Edgeå’ŒOneDriveå¯èƒ½å½±å“ç³»ç»ŸåŠŸèƒ½ï¼Œå»ºè®®è°¨æ…æ“ä½œ\nğŸ“Š æŸ¥çœ‹ç³»ç»Ÿå®‰è£…çš„æ‰€æœ‰åº”ç”¨ 1 2 3 4 5 # åˆ—å‡ºæ‰€æœ‰é¢„è£…åº”ç”¨ Get-AppxPackage | Select Name, PackageFullName | Sort Name # åˆ—å‡ºæ‰€æœ‰Win32åº”ç”¨ï¼ˆä¼ ç»Ÿç¨‹åºï¼‰ Get-WmiObject -Class Win32_Product | Select Name, Version ğŸ”§ é«˜çº§å®šåˆ¶æŠ€å·§ ğŸ“Œ æ°¸ä¹…å±•å¼€å³é”®èœå• å¯ç”¨ç»å…¸å³é”®èœå•:\n1 2 # å±•å¼€å³é”®èœå•ï¼ˆæ¢å¤Win10æ ·å¼ï¼‰ reg add \u0026#34;HKCU\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\\InprocServer32\u0026#34; /f /ve æ¢å¤é»˜è®¤å³é”®èœå•:\n1 2 # æ¢å¤Win11é»˜è®¤å³é”®èœå• reg delete \u0026#34;HKCU\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\u0026#34; /f âš¡ æ€§èƒ½ä¼˜åŒ–å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç¦ç”¨è¯Šæ–­è·Ÿè¸ªï¼ˆæå‡æ€§èƒ½ï¼‰ sc stop DiagTrack sc config DiagTrack start= disabled # ç¦ç”¨å®¢æˆ·ä½“éªŒæ”¹å–„è®¡åˆ’ sc stop dmwappushservice sc config dmwappushservice start= disabled # æ¸…ç†ç³»ç»Ÿåƒåœ¾ cleanmgr /sagerun:1 # é‡ç½®ç½‘ç»œé…ç½®ï¼ˆè§£å†³ç½‘ç»œé—®é¢˜ï¼‰ netsh winsock reset netsh int ip reset ğŸ–¥ï¸ æ˜¾ç¤ºä¼˜åŒ– 1 2 3 4 5 6 7 8 # ç¦ç”¨é€æ˜æ•ˆæœï¼ˆæå‡æ€§èƒ½ï¼‰ reg add \u0026#34;HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize\u0026#34; /v \u0026#34;EnableTransparency\u0026#34; /t REG_DWORD /d 0 /f # ç¦ç”¨åŠ¨ç”»æ•ˆæœ reg add \u0026#34;HKCU\\Control Panel\\Desktop\\WindowMetrics\u0026#34; /v \u0026#34;MinAnimate\u0026#34; /t REG_SZ /d 0 /f # è°ƒæ•´è§†è§‰æ•ˆæœä¸ºæœ€ä½³æ€§èƒ½ systempropertiesperformance.exe ğŸ’¾ ç£ç›˜ä¼˜åŒ– 1 2 3 4 5 # ç¦ç”¨ä¼‘çœ ï¼ˆé‡Šæ”¾ç£ç›˜ç©ºé—´ï¼‰ powercfg /hibernate off # è°ƒæ•´è™šæ‹Ÿå†…å­˜ sysdm.cpl ğŸ’¡ å®ç”¨å¿«æ·é”® ğŸ¯ ç³»ç»Ÿå¿«æ·é”® å¿«æ·é”® åŠŸèƒ½ Win + R æ‰“å¼€è¿è¡Œå¯¹è¯æ¡† Win + E æ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨ Win + D æ˜¾ç¤ºæ¡Œé¢ Win + L é”å®šè®¡ç®—æœº Ctrl + Shift + Esc æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ Win + X â†’ U â†’ U å¿«é€Ÿå…³æœº Win + X â†’ U â†’ R å¿«é€Ÿé‡å¯ ğŸ“ æ–‡ä»¶ç®¡ç†å¿«æ·é”® 1 2 3 4 5 # åœ¨èµ„æºç®¡ç†å™¨ä¸­ Alt + D : é€‰æ‹©åœ°å€æ  F2 : é‡å‘½åé€‰ä¸­æ–‡ä»¶ Ctrl + Shift + N : æ–°å»ºæ–‡ä»¶å¤¹ Alt + Enter : æ˜¾ç¤ºæ–‡ä»¶å±æ€§ ğŸ–¥ï¸ çª—å£ç®¡ç†å¿«æ·é”® 1 2 3 4 5 6 Win + â† : å°†çª—å£é å·¦è´´è¾¹ Win + â†’ : å°†çª—å£é å³è´´è¾¹ Win + â†‘ : æœ€å¤§åŒ–çª—å£ Win + â†“ : æœ€å°åŒ–çª—å£ Win + Tab : æ‰“å¼€ä»»åŠ¡è§†å›¾ Alt + Tab : åˆ‡æ¢åº”ç”¨ç¨‹åº âŒ¨ï¸ å‘½ä»¤è¡Œå¿«æ·é”® 1 2 3 4 5 # åœ¨å‘½ä»¤æç¤ºç¬¦æˆ–PowerShellä¸­ Tab : è‡ªåŠ¨è¡¥å…¨è·¯å¾„æˆ–æ–‡ä»¶å Ctrl + C : ä¸­æ–­å½“å‰å‘½ä»¤ F7 : æ˜¾ç¤ºå‘½ä»¤å†å² â†‘/â†“ : æµè§ˆå‘½ä»¤å†å² âš ï¸ æ³¨æ„äº‹é¡¹ ğŸ”´ é‡è¦è­¦å‘Š ä¿®æ”¹é£é™©: æ³¨å†Œè¡¨ä¿®æ”¹æœ‰é£é™©ï¼Œæ“ä½œå‰è¯·å¤‡ä»½\n1 2 # å¯¼å‡ºå½“å‰æ³¨å†Œè¡¨é…ç½® reg export HKCU\\Software\\Microsoft\\Windows C:\\regbackup.reg ç³»ç»Ÿå…¼å®¹æ€§: æŸäº›å‘½ä»¤ä»…é€‚ç”¨äºç‰¹å®šWindowsç‰ˆæœ¬\ngpedit.msc ä»…é™ä¸“ä¸šç‰ˆ/ä¼ä¸šç‰ˆ winget éœ€è¦å®‰è£…App Installer å®‰å…¨è€ƒè™‘: ç¦ç”¨å®‰å…¨åŠŸèƒ½å¯èƒ½å¢åŠ ç³»ç»Ÿé£é™©\nå»ºè®®å®‰è£…ç¬¬ä¸‰æ–¹å®‰å…¨è½¯ä»¶æ›¿ä»£Windows Defender å®šæœŸæ‰‹åŠ¨æ£€æŸ¥æ›´æ–°ä»¥ç¡®ä¿å®‰å…¨ âœ… æœ€ä½³å®è·µ åˆ›å»ºè¿˜åŸç‚¹: é‡å¤§ä¿®æ”¹å‰åˆ›å»ºç³»ç»Ÿè¿˜åŸç‚¹\n1 2 # åˆ›å»ºç³»ç»Ÿè¿˜åŸç‚¹ wmic.exe /Namespace:\\\\root\\default Path SystemRestore Call CreateRestorePoint \u0026#34;Before Optimization\u0026#34;, 100, 7 é€æ­¥æµ‹è¯•: æ¯æ¬¡åªä¿®æ”¹ä¸€ä¸ªè®¾ç½®ï¼Œæµ‹è¯•ç¨³å®šæ€§åå†è¿›è¡Œä¸‹ä¸€ä¸ª\næ–‡æ¡£è®°å½•: è®°å½•æ‰€æœ‰ä¿®æ”¹ï¼Œä¾¿äºæ•…éšœæ’é™¤å’Œæ¢å¤\nğŸ”„ æ¢å¤é»˜è®¤è®¾ç½® 1 2 3 4 5 6 7 8 9 # é‡æ–°æ³¨å†Œæ‰€æœ‰Windowsåº”ç”¨ Get-AppXPackage -AllUsers | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \u0026#34;$($_.InstallLocation)\\AppXManifest.xml\u0026#34;} # é‡ç½®Windowså•†åº— wsreset.exe # æ¢å¤é»˜è®¤æ³¨å†Œè¡¨è®¾ç½®ï¼ˆè°¨æ…æ“ä½œï¼‰ # å¯ä»¥å¯¼å…¥ä¹‹å‰å¤‡ä»½çš„æ³¨å†Œè¡¨æ–‡ä»¶ regedit /s C:\\regbackup.reg ğŸ†˜ é‡åˆ°é—®é¢˜æ€ä¹ˆåŠï¼Ÿ ç³»ç»Ÿè¿˜åŸ: ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„ç³»ç»Ÿè¿˜åŸç‚¹æ¢å¤ å®‰å…¨æ¨¡å¼: åœ¨å®‰å…¨æ¨¡å¼ä¸‹æ’¤é”€æ›´æ”¹ é‡ç½®ç³»ç»Ÿ: ä½¿ç”¨ç³»ç»Ÿè®¾ç½®ä¸­çš„\u0026quot;é‡ç½®æ­¤ç”µè„‘\u0026quot;åŠŸèƒ½ ğŸ’¡ ä¸“ä¸šæç¤º: åœ¨è¿›è¡Œç³»ç»Ÿä¼˜åŒ–æ—¶ï¼Œå»ºè®®å…ˆåˆ›å»ºä¸€ä¸ªç³»ç»Ÿè¿˜åŸç‚¹ï¼Œå¹¶é€ä¸ªæµ‹è¯•ä¼˜åŒ–æ•ˆæœã€‚ä¸åŒçš„ç¡¬ä»¶é…ç½®å’Œä½¿ç”¨åœºæ™¯å¯èƒ½éœ€è¦ä¸åŒçš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œè¯·æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©é€‚åˆçš„å‘½ä»¤ã€‚\nğŸ¯ è®°ä½: ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œå®šæœŸæ£€æŸ¥å’Œè°ƒæ•´è®¾ç½®å¯ä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚\n","date":"2024-12-07T07:59:55+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/75bdbf7e/","title":"Windows å®ç”¨å‘½ä»¤ä¸ä¼˜åŒ–æŠ€å·§ ğŸš€"},{"content":"Windows éšè—ç£ç›˜æŒ‡å— ğŸ–¥ï¸ è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Windows ç³»ç»Ÿä¸­å®‰å…¨åœ°éšè—å’Œæ˜¾ç¤ºç£ç›˜é©±åŠ¨å™¨ï¼Œä¿æŠ¤éšç§æ•°æ®ä¸è¢«è½»æ˜“è®¿é—®\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ” ä¸€ã€æŸ¥çœ‹ç£ç›˜è¯¦ç»†ä¿¡æ¯ ğŸš« äºŒã€éšè—ç£ç›˜é©±åŠ¨å™¨ ğŸ”“ ä¸‰ã€æ˜¾ç¤ºå·²éšè—çš„ç£ç›˜é©±åŠ¨å™¨ âš™ï¸ å››ã€é«˜çº§é…ç½®é€‰é¡¹ ğŸ’¡ äº”ã€ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ ğŸ›¡ï¸ å…­ã€å®‰å…¨æ³¨æ„äº‹é¡¹ ğŸ”§ ä¸ƒã€æ•…éšœæ’é™¤ ğŸ“‹ å…«ã€æ‰¹å¤„ç†å‘½ä»¤è¯¦è§£ âœ¨ åŠŸèƒ½ç‰¹ç‚¹ ğŸ”’ éšç§ä¿æŠ¤ï¼šéšè—æ•æ„Ÿæ•°æ®é©±åŠ¨å™¨ï¼Œé˜²æ­¢ä»–äººéšæ„è®¿é—®\nğŸ”„ å¯é€†æ“ä½œï¼šéšè—çš„é©±åŠ¨å™¨å¯ä»¥éšæ—¶æ¢å¤æ˜¾ç¤ºï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±\nâš¡ å¿«é€Ÿæ“ä½œï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ä¸€é”®å®Œæˆéšè—/æ˜¾ç¤ºæ“ä½œ\nğŸ›¡ï¸ å®‰å…¨å¯é ï¼šæ‰€æœ‰æ“ä½œå‡é€šè¿‡Windowså®˜æ–¹å·¥å…·å®ç°ï¼Œä¸ä¼šæŸåæ•°æ®\nğŸ” ä¸€ã€æŸ¥çœ‹ç£ç›˜è¯¦ç»†ä¿¡æ¯ é€šç”¨æŸ¥çœ‹è„šæœ¬ï¼ˆé€‚ç”¨äº Win10/Win11ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @echo off :: è¯·æ±‚ç®¡ç†å‘˜æƒé™ if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) :: æŸ¥çœ‹ç£ç›˜è¯¦ç»†ä¿¡æ¯ echo list volume \u0026gt; %temp%\\diskpart_commands.txt echo exit \u0026gt;\u0026gt; %temp%\\diskpart_commands.txt diskpart /s %temp%\\diskpart_commands.txt del %temp%\\diskpart_commands.txt pause ä½¿ç”¨è¯´æ˜:\nå°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º æŸ¥çœ‹ç£ç›˜ä¿¡æ¯.bat å³é”®é€‰æ‹©\u0026quot;ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ\u0026quot; ç³»ç»Ÿä¼šæ˜¾ç¤ºæ‰€æœ‰ç£ç›˜å·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·å·ã€é©±åŠ¨å™¨å·å’Œæ ‡ç­¾ è¾“å‡ºç¤ºä¾‹:\n1 2 3 4 5 å· ### LTR æ ‡ç­¾ FS ç±»å‹ å¤§å° çŠ¶æ€ ä¿¡æ¯ ---------- --- ---------- ----- ---------- ------- --------- -------- å· 0 C System NTFS åˆ†åŒº 256 GB æ­£å¸¸ å¯åŠ¨ å· 1 D Data NTFS åˆ†åŒº 512 GB æ­£å¸¸ å· 2 R Private NTFS åˆ†åŒº 128 GB æ­£å¸¸ ğŸš« äºŒã€éšè—ç£ç›˜é©±åŠ¨å™¨ é€šç”¨éšè—è„šæœ¬ï¼ˆé€‚ç”¨äº Win10/Win11ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @echo off :: è¯·æ±‚ç®¡ç†å‘˜æƒé™ if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) :: è®¾ç½®è¦éšè—çš„å·å·å’Œé©±åŠ¨å™¨å· set VOLUME_NUMBER=2 set DRIVE_LETTER=R :: éšè—æŒ‡å®šé©±åŠ¨å™¨ echo æ­£åœ¨éšè—å· %VOLUME_NUMBER% (é©±åŠ¨å™¨ %DRIVE_LETTER%)... echo list volume \u0026gt; %temp%\\hide_script.txt echo select volume=%VOLUME_NUMBER% \u0026gt;\u0026gt; %temp%\\hide_script.txt echo remove letter=%DRIVE_LETTER% \u0026gt;\u0026gt; %temp%\\hide_script.txt echo exit \u0026gt;\u0026gt; %temp%\\hide_script.txt diskpart /s %temp%\\hide_script.txt del %temp%\\hide_script.txt echo æ“ä½œå·²å®Œæˆï¼ echo æ³¨æ„ï¼šé©±åŠ¨å™¨ %DRIVE_LETTER% å·²è¢«éšè—ï¼Œä½†æ•°æ®ä»ç„¶å­˜åœ¨ã€‚ pause ä½¿ç”¨è¯´æ˜:\nä¿®æ”¹ VOLUME_NUMBER å’Œ DRIVE_LETTER å˜é‡ä¸ºæ‚¨è¦éšè—çš„å·å·å’Œé©±åŠ¨å™¨å· ä¿å­˜ä¸º éšè—ç£ç›˜.bat å³é”®é€‰æ‹©\u0026quot;ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ\u0026quot; æ“ä½œå®Œæˆåï¼ŒæŒ‡å®šé©±åŠ¨å™¨å°†ä¸å†åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤º æ³¨æ„äº‹é¡¹:\nç¡®ä¿é€‰æ‹©æ­£ç¡®çš„å·å·ï¼Œé”™è¯¯æ“ä½œå¯èƒ½éšè—ç³»ç»Ÿå…³é”®é©±åŠ¨å™¨ éšè—åæ•°æ®ä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯ä¸å¯è§ å¯ä»¥é€šè¿‡ç£ç›˜ç®¡ç†å·¥å…·æˆ–æ˜¾ç¤ºè„šæœ¬é‡æ–°æ˜¾ç¤ºé©±åŠ¨å™¨ ğŸ”“ ä¸‰ã€æ˜¾ç¤ºå·²éšè—çš„ç£ç›˜é©±åŠ¨å™¨ é€šç”¨æ˜¾ç¤ºè„šæœ¬ï¼ˆé€‚ç”¨äº Win10/Win11ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @echo off :: è¯·æ±‚ç®¡ç†å‘˜æƒé™ if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) :: è®¾ç½®è¦æ˜¾ç¤ºçš„å·å·å’Œé©±åŠ¨å™¨å· set VOLUME_NUMBER=2 set DRIVE_LETTER=R :: æ˜¾ç¤ºæŒ‡å®šé©±åŠ¨å™¨ echo æ­£åœ¨æ˜¾ç¤ºå· %VOLUME_NUMBER% (é©±åŠ¨å™¨ %DRIVE_LETTER%)... echo list volume \u0026gt; %temp%\\show_script.txt echo select volume=%VOLUME_NUMBER% \u0026gt;\u0026gt; %temp%\\show_script.txt echo assign letter=%DRIVE_LETTER% \u0026gt;\u0026gt; %temp%\\show_script.txt echo exit \u0026gt;\u0026gt; %temp%\\show_script.txt diskpart /s %temp%\\show_script.txt del %temp%\\show_script.txt echo æ“ä½œå·²å®Œæˆï¼ echo é©±åŠ¨å™¨ %DRIVE_LETTER% å·²é‡æ–°æ˜¾ç¤ºã€‚ pause ä½¿ç”¨è¯´æ˜:\nä¿®æ”¹ VOLUME_NUMBER å’Œ DRIVE_LETTER å˜é‡ä¸ºæ‚¨è¦æ˜¾ç¤ºçš„å·å·å’Œé©±åŠ¨å™¨å· ä¿å­˜ä¸º æ˜¾ç¤ºç£ç›˜.bat å³é”®é€‰æ‹©\u0026quot;ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ\u0026quot; æ“ä½œå®Œæˆåï¼ŒæŒ‡å®šé©±åŠ¨å™¨å°†é‡æ–°åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤º æ³¨æ„äº‹é¡¹:\nå¦‚æœæŒ‡å®šçš„é©±åŠ¨å™¨å·å·²è¢«å…¶ä»–é©±åŠ¨å™¨ä½¿ç”¨ï¼Œéœ€è¦å…ˆé‡Šæ”¾è¯¥é©±åŠ¨å™¨å· æ˜¾ç¤ºåå¯èƒ½éœ€è¦åˆ·æ–°æ–‡ä»¶èµ„æºç®¡ç†å™¨æ‰èƒ½çœ‹åˆ°å˜åŒ–ï¼ˆæŒ‰F5ï¼‰ âš™ï¸ å››ã€é«˜çº§é…ç½®é€‰é¡¹ 1. æ‰¹é‡éšè—å¤šä¸ªé©±åŠ¨å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @echo off if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) :: éšè—å¤šä¸ªé©±åŠ¨å™¨ (ä¿®æ”¹è¿™é‡Œçš„å·å·å’Œé©±åŠ¨å™¨å·) echo æ­£åœ¨éšè—å¤šä¸ªé©±åŠ¨å™¨... echo list volume \u0026gt; %temp%\\multi_hide.txt echo select volume=2 \u0026gt;\u0026gt; %temp%\\multi_hide.txt echo remove letter=R \u0026gt;\u0026gt; %temp%\\multi_hide.txt echo select volume=3 \u0026gt;\u0026gt; %temp%\\multi_hide.txt echo remove letter=S \u0026gt;\u0026gt; %temp%\\multi_hide.txt echo exit \u0026gt;\u0026gt; %temp%\\multi_hide.txt diskpart /s %temp%\\multi_hide.txt del %temp%\\multi_hide.txt echo å¤šä¸ªé©±åŠ¨å™¨éšè—æ“ä½œå·²å®Œæˆï¼ pause 2. æ™ºèƒ½é©±åŠ¨å™¨éšè—ï¼ˆæ£€æŸ¥é©±åŠ¨å™¨å­˜åœ¨æ€§ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 @echo off if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) set DRIVE_LETTER=R set DRIVE_PATH=%DRIVE_LETTER%: :: æ£€æŸ¥é©±åŠ¨å™¨æ˜¯å¦å­˜åœ¨ if exist %DRIVE_PATH% ( echo æ­£åœ¨éšè—é©±åŠ¨å™¨ %DRIVE_LETTER%... echo list volume \u0026gt; %temp%\\check_hide.txt for /f \u0026#34;tokens=2\u0026#34; %%i in (\u0026#39;echo list volume ^| diskpart ^| findstr /C:\u0026#34;%DRIVE_LETTER% \u0026#34;\u0026#39;) do ( echo select volume=%%i \u0026gt;\u0026gt; %temp%\\check_hide.txt ) echo remove letter=%DRIVE_LETTER% \u0026gt;\u0026gt; %temp%\\check_hide.txt echo exit \u0026gt;\u0026gt; %temp%\\check_hide.txt diskpart /s %temp%\\check_hide.txt del %temp%\\check_hide.txt echo é©±åŠ¨å™¨ %DRIVE_LETTER% å·²æˆåŠŸéšè—ã€‚ ) else ( echo é©±åŠ¨å™¨ %DRIVE_LETTER% ä¸å­˜åœ¨æˆ–å·²æ˜¯éšè—çŠ¶æ€ã€‚ ) pause 3. è‡ªåŠ¨æ£€æµ‹å¯ç”¨é©±åŠ¨å™¨å· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 @echo off if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) :: è‡ªåŠ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨é©±åŠ¨å™¨å· for %%d in (Z Y X W V U T S R Q P O N M L K J I H G F E D C) do ( if not exist %%d:\\nul ( set AVAILABLE_DRIVE=%%d goto :FOUND ) ) echo æ²¡æœ‰å¯ç”¨çš„é©±åŠ¨å™¨å·ï¼ pause exit /b :FOUND echo æ‰¾åˆ°å¯ç”¨é©±åŠ¨å™¨å·: %AVAILABLE_DRIVE% echo æ­£åœ¨æ˜¾ç¤ºéšè—çš„é©±åŠ¨å™¨å¹¶ä½¿ç”¨é©±åŠ¨å™¨å· %AVAILABLE_DRIVE%... echo list volume \u0026gt; %temp%\\auto_show.txt echo select volume=2 \u0026gt;\u0026gt; %temp%\\auto_show.txt echo assign letter=%AVAILABLE_DRIVE% \u0026gt;\u0026gt; %temp%\\auto_show.txt echo exit \u0026gt;\u0026gt; %temp%\\auto_show.txt diskpart /s %temp%\\auto_show.txt del %temp%\\auto_show.txt echo æ“ä½œå·²å®Œæˆï¼é©±åŠ¨å™¨ç°åœ¨ä½¿ç”¨å­—æ¯ %AVAILABLE_DRIVE%ã€‚ pause ğŸ’¡ äº”ã€ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹ 1. ç¡®å®šæ­£ç¡®çš„å·å·å’Œé©±åŠ¨å™¨å· è¿è¡Œ\u0026quot;æŸ¥çœ‹ç£ç›˜ä¿¡æ¯\u0026quot;è„šæœ¬ï¼Œè®°ä¸‹è¦æ“ä½œçš„å·çš„ç¼–å·å’Œå¯¹åº”çš„é©±åŠ¨å™¨å· æ³¨æ„ï¼šå·å·æ˜¯æ•°å­—ï¼Œé©±åŠ¨å™¨å·æ˜¯å­—æ¯ ç³»ç»Ÿé©±åŠ¨å™¨ï¼ˆé€šå¸¸æ˜¯C:ï¼‰ä¸å»ºè®®éšè—ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š 2. é©±åŠ¨å™¨å·å†²çªå¤„ç† å¦‚æœè¦åˆ†é…çš„é©±åŠ¨å™¨å·å·²è¢«ä½¿ç”¨ï¼Œè„šæœ¬ä¼šå¤±è´¥ å¯ä»¥å…ˆåˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„é©±åŠ¨å™¨å·ï¼Œç„¶åå†éšè— ä½¿ç”¨\u0026quot;è‡ªåŠ¨æ£€æµ‹å¯ç”¨é©±åŠ¨å™¨å·\u0026quot;è„šæœ¬å¯ä»¥é¿å…æ­¤é—®é¢˜ 3. æ•°æ®å®‰å…¨æ€§ éšè—é©±åŠ¨å™¨ä¸ä¼šåˆ é™¤æˆ–æŸåæ•°æ® éšè—åæ•°æ®ä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯ä¸å¯è§ é€šè¿‡ç£ç›˜ç®¡ç†å·¥å…·æˆ–è¿™äº›è„šæœ¬å¯ä»¥é‡æ–°æ˜¾ç¤ºé©±åŠ¨å™¨ 4. æ›¿ä»£æ–¹æ³• é™¤äº†ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éšè—é©±åŠ¨å™¨ï¼š\nä½¿ç”¨ç£ç›˜ç®¡ç†å·¥å…· (diskmgmt.msc) ä¿®æ”¹æ³¨å†Œè¡¨: HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer ä½¿ç”¨ç»„ç­–ç•¥ç¼–è¾‘å™¨ (gpedit.msc) 5. æ¢å¤éšè—çš„ç³»ç»Ÿé©±åŠ¨å™¨ å¦‚æœæ„å¤–éšè—äº†ç³»ç»Ÿé©±åŠ¨å™¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¢å¤ï¼š\nä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦ è¾“å…¥ diskpart è¾“å…¥ list volume æŸ¥çœ‹æ‰€æœ‰å· è¾“å…¥ select volume X (Xæ˜¯ç³»ç»Ÿå·çš„ç¼–å·) è¾“å…¥ assign letter=C (æˆ–ç›¸åº”çš„é©±åŠ¨å™¨å·) ğŸ›¡ï¸ å…­ã€å®‰å…¨æ³¨æ„äº‹é¡¹ 1. ç®¡ç†å‘˜æƒé™ æ‰€æœ‰ç£ç›˜æ“ä½œéƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ è„šæœ¬ä¼šè‡ªåŠ¨è¯·æ±‚æå‡æƒé™ 2. å¤‡ä»½é‡è¦æ•°æ® åœ¨è¿›è¡Œä»»ä½•ç£ç›˜æ“ä½œå‰å¤‡ä»½é‡è¦æ•°æ® è™½ç„¶éšè—æ“ä½œä¸ä¼šåˆ é™¤æ•°æ®ï¼Œä½†è¯¯æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®ä¸å¯è®¿é—® 3. è°¨æ…æ“ä½œ ç¡®ä¿æ“ä½œçš„æ˜¯æ­£ç¡®çš„é©±åŠ¨å™¨ï¼Œé¿å…æ„å¤–éšè—ç³»ç»Ÿé©±åŠ¨å™¨ ä»”ç»†æ£€æŸ¥å·å·å’Œé©±åŠ¨å™¨å·åå†æ‰§è¡Œæ“ä½œ 4. é˜²ç—…æ¯’è½¯ä»¶ æŸäº›é˜²ç—…æ¯’è½¯ä»¶å¯èƒ½ä¼šé˜»æ­¢ç£ç›˜æ“ä½œï¼Œå¿…è¦æ—¶æš‚æ—¶ç¦ç”¨ æ“ä½œå®Œæˆåè®°å¾—é‡æ–°å¯ç”¨é˜²ç—…æ¯’è½¯ä»¶ 5. ç³»ç»Ÿæ¢å¤ç‚¹ åœ¨è¿›è¡Œé‡å¤§æ›´æ”¹å‰åˆ›å»ºç³»ç»Ÿæ¢å¤ç‚¹ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ¢å¤ç‚¹ï¼š 1 wmic.exe /Namespace:\\\\root\\default Path SystemRestore Call CreateRestorePoint \u0026#34;Before Disk Hide\u0026#34;, 100, 7 ğŸ”§ ä¸ƒã€æ•…éšœæ’é™¤ 1. è„šæœ¬æ— æ³•è¿è¡Œ ç¡®ä¿ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ æ£€æŸ¥ç³»ç»Ÿç­–ç•¥æ˜¯å¦å…è®¸è¿è¡Œæ‰¹å¤„ç†æ–‡ä»¶ å°è¯•åœ¨ PowerShell ä¸­è¿è¡Œï¼šStart-Process \u0026quot;cmd\u0026quot; -ArgumentList \u0026quot;/c è„šæœ¬è·¯å¾„.bat\u0026quot; -Verb RunAs 2. \u0026ldquo;æ‹’ç»è®¿é—®\u0026quot;é”™è¯¯ ç¡®ä¿ä½¿ç”¨ç®¡ç†å‘˜æƒé™ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å…¶ä»–ç¨‹åºé”å®š å°è¯•åœ¨å®‰å…¨æ¨¡å¼ä¸‹è¿è¡Œè„šæœ¬ 3. é©±åŠ¨å™¨å·å·²è¢«ä½¿ç”¨ é€‰æ‹©å…¶ä»–æœªä½¿ç”¨çš„é©±åŠ¨å™¨å· å…ˆå¸è½½å ç”¨è¯¥é©±åŠ¨å™¨å·çš„å· ä½¿ç”¨\u0026quot;è‡ªåŠ¨æ£€æµ‹å¯ç”¨é©±åŠ¨å™¨å·\u0026quot;è„šæœ¬ 4. éšè—åæ— æ³•è®¿é—®æ•°æ® ä½¿ç”¨æ˜¾ç¤ºè„šæœ¬é‡æ–°æ˜¾ç¤ºé©±åŠ¨å™¨ é€šè¿‡ç£ç›˜ç®¡ç†å·¥å…·é‡æ–°åˆ†é…é©±åŠ¨å™¨å· å¦‚æœé—®é¢˜æŒç»­ï¼Œæ£€æŸ¥ç£ç›˜é”™è¯¯ï¼šchkdsk /f X: (Xæ˜¯é©±åŠ¨å™¨å·) 5. ç³»ç»Ÿé©±åŠ¨å™¨è¢«éšè— ä½¿ç”¨å®‰è£…åª’ä½“å¯åŠ¨å¹¶è¿›å…¥æ¢å¤ç¯å¢ƒ ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·é‡æ–°åˆ†é…é©±åŠ¨å™¨å· å¦‚æœæ— æ³•å¯åŠ¨ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ç³»ç»Ÿä¿®å¤å·¥å…· ğŸ“‹ å…«ã€æ‰¹å¤„ç†å‘½ä»¤è¯¦è§£ 1. ç®¡ç†å‘˜æƒé™è·å– 1 2 3 4 if not \u0026#34;%1\u0026#34;==\u0026#34;admin\u0026#34; ( powershell -Command \u0026#34;Start-Process cmd -ArgumentList \u0026#39;/c %0 admin\u0026#39; -Verb RunAs\u0026#34; exit /b ) è¿™æ®µä»£ç ä½¿ç”¨ PowerShell é‡æ–°ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨å½“å‰è„šæœ¬ã€‚\n2. DiskPart å‘½ä»¤ list volumeï¼šåˆ—å‡ºæ‰€æœ‰ç£ç›˜å· select volume=Xï¼šé€‰æ‹©æŒ‡å®šå·å·çš„å· remove letter=Xï¼šç§»é™¤æŒ‡å®šé©±åŠ¨å™¨å· assign letter=Xï¼šåˆ†é…æŒ‡å®šé©±åŠ¨å™¨å· exitï¼šé€€å‡º DiskPart 3. ä¸´æ—¶æ–‡ä»¶ç®¡ç† ä½¿ç”¨ %temp% ç¯å¢ƒå˜é‡åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œæ“ä½œå®Œæˆåè‡ªåŠ¨åˆ é™¤ï¼Œé¿å…ç•™ä¸‹ä¸å¿…è¦çš„æ–‡ä»¶ã€‚\n4. å˜é‡ä½¿ç”¨ set VARIABLE=valueï¼šè®¾ç½®å˜é‡ %VARIABLE%ï¼šä½¿ç”¨å˜é‡å€¼ å˜é‡å¯ä»¥åœ¨è„šæœ¬ä¸­é‡å¤ä½¿ç”¨ï¼Œæ–¹ä¾¿ä¿®æ”¹å’Œç»´æŠ¤ 5. æ¡ä»¶åˆ¤æ–­ 1 2 3 4 5 if exist X:\\nul ( echo é©±åŠ¨å™¨å­˜åœ¨ ) else ( echo é©±åŠ¨å™¨ä¸å­˜åœ¨ ) ä½¿ç”¨ if exist æ£€æŸ¥é©±åŠ¨å™¨æ˜¯å¦å­˜åœ¨ï¼Œé¿å…æ“ä½œä¸å­˜åœ¨çš„é©±åŠ¨å™¨ã€‚\nğŸ’¡ æç¤º éšè—é©±åŠ¨å™¨æ˜¯ä¸€ç§ä¿æŠ¤éšç§æ•°æ®çš„ç®€å•æ–¹æ³•ï¼Œä½†å¯¹äºæ•æ„Ÿæ•°æ®ï¼Œå»ºè®®ä½¿ç”¨åŠ å¯†å·¥å…·ï¼ˆå¦‚ BitLockerï¼‰æä¾›æ›´é«˜çº§åˆ«çš„ä¿æŠ¤ã€‚\né‡è¦æç¤ºï¼šéšè—é©±åŠ¨å™¨å¹¶ä¸èƒ½é˜²æ­¢æœ‰ç»éªŒçš„ç”¨æˆ·è®¿é—®æ‚¨çš„æ•°æ®ï¼Œå®ƒåªæ˜¯ä¸€ç§åŸºæœ¬çš„éšç§ä¿æŠ¤æªæ–½ã€‚å¯¹äºçœŸæ­£æ•æ„Ÿçš„æ•°æ®ï¼Œè¯·ä½¿ç”¨åŠ å¯†æŠ€æœ¯ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨å®‰å…¨åœ°ç®¡ç† Windows ç³»ç»Ÿä¸­çš„ç£ç›˜é©±åŠ¨å™¨ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ Windows å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºæ”¯æŒã€‚\n","date":"2024-12-07T07:59:19+08:00","image":"https://file.meimolihan.eu.org/img/windows-02.webp","permalink":"https://blog.meimolihan.eu.org/p/ce1ab193/","title":"Windows éšè—ç£ç›˜ ğŸ–¥ï¸"},{"content":"iStoreOS æ‚Ÿç©ºæ‡’äººåŒ…ä¸€ç«™å¼è½¯è·¯ç”±ä¼˜åŒ–è§£å†³æ–¹æ¡ˆ ğŸµ ğŸ“Œ å¯¼èˆªç›®å½•\nğŸŒŸ ä¸€ã€è„šæœ¬ç®€ä»‹ âš¡ äºŒã€ä¸»è¦åŠŸèƒ½ç‰¹ç‚¹ ğŸŒ ä¸‰ã€ä½¿ç”¨å‰æ ğŸš€ å››ã€å®‰è£…æ–¹å¼ ğŸ“¦ äº”ã€ç‰ˆæœ¬ä¸‹è½½ ğŸ”§ å…­ã€å…¶ä»–ç³»ç»Ÿæ”¯æŒ ğŸ’¡ ä¸ƒã€å¸¸è§é—®é¢˜ä¸æŠ€å·§ ğŸŒŸ ä¸€ã€è„šæœ¬ç®€ä»‹ æ‚Ÿç©ºè„šæœ¬ GitHub åœ°å€ï¼šhttps://github.com/wukongdaily/allinonescript\nğŸ¯ ä¸“ä¸ºè½¯è·¯ç”± iStoreOS ç³»ç»Ÿè®¾è®¡çš„å…¨èƒ½ä¼˜åŒ–è„šæœ¬ï¼Œä¸€é”®è§£å†³å¸¸è§é…ç½®é—®é¢˜ï¼Œæå‡ä½¿ç”¨ä½“éªŒï¼\nâš¡ äºŒã€ä¸»è¦åŠŸèƒ½ç‰¹ç‚¹ âœ¨ æ ¸å¿ƒåŠŸèƒ½ï¼š\nğŸ”Œ å¿…å¤‡æ’ä»¶å®‰è£…ï¼šå¿«é€Ÿå®‰è£…å„ç±»è£…æœºå¿…å¤‡æ’ä»¶ ğŸŒ ç½‘ç»œä¼˜åŒ–ï¼šè®¾ç½®è‡ªå®šä¹‰åŸŸååŠ«æŒï¼ˆä¸»æœºåæ˜ å°„ï¼‰ï¼Œé˜²æ­¢ Android TV é¦–æ¬¡è¿æ¥ä¸åˆ° Wi-Fi ğŸ›’ å•†åº—åŠ é€Ÿï¼šè®¾ç½® Emotn Store åŸŸåä»£ç†ï¼Œè§£å†³æ‰“ä¸å¼€çš„é—®é¢˜ â° ç³»ç»Ÿå·¥å…·ï¼šå®‰è£…è½¯è·¯ç”±å…³é—­ã€å®šæ—¶è®¾ç½®ç­‰å®ç”¨æ’ä»¶ ğŸ“¦ æ‰¹é‡å®‰è£…ï¼šä¸€é”®ä¸‹è½½å®‰è£…ä¸‰å¤§æ’ä»¶ï¼ˆOPSï¼‰ ğŸ” è‡ªåŠ¨è¯†åˆ«ï¼šæ™ºèƒ½è¯†åˆ«è½¯è·¯ç”±æ¶æ„ï¼ˆx86_64ã€arm64ï¼‰ ğŸ› ï¸ ä¾¿æ·ç®¡ç†ï¼šæä¾›å¤šç§å®‰è£…æ–¹å¼ï¼Œæ»¡è¶³ä¸åŒç”¨æˆ·éœ€æ±‚ ğŸŒ ä¸‰ã€ä½¿ç”¨å‰æ âš ï¸ ç½‘ç»œè¦æ±‚ï¼š\nä½¿ç”¨æ§åˆ¶å™¨æœ¬èº«è·¯ç”±å™¨èƒ½\u0026quot;æ‰¶å¢™\u0026quot;æˆ–è€…ä¸Šä¸€çº§è·¯ç”±èƒ½\u0026quot;æ‰¶å¢™\u0026quot; ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œèƒ½å¤Ÿè®¿é—® GitHub ğŸ’» ç³»ç»Ÿè¦æ±‚ï¼š\nè½¯è·¯ç”± iStoreOS ç³»ç»Ÿï¼ˆæ”¯æŒ x86_64ã€arm64 æ¶æ„ï¼‰ å…¶ä»– OpenWrt ç³»ç»Ÿå¯ä½¿ç”¨é€šç”¨è„šæœ¬ ğŸš€ å››ã€å®‰è£…æ–¹å¼ æ–¹æ³•ä¸€ï¼šç»ˆç«¯å‘½ä»¤å®‰è£…ï¼ˆæ¨èï¼‰ 1 wget -O /tmp/all.run https://raw.githubusercontent.com/wukongdaily/allinonescript/main/all/all.run \u0026amp;\u0026amp; chmod +x /tmp/all.run \u0026amp;\u0026amp; /tmp/all.run ğŸ“Œ ç‰¹ç‚¹ï¼š\nâœ… è‡ªåŠ¨è¯†åˆ« ARM æˆ– x86 å¹³å° âœ… æ— éœ€æ‹…å¿ƒæ¶æ„é—®é¢˜ âœ… ä¸“ä¸º iStoreOS å›ºä»¶ä¼˜åŒ– æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£… ä¸‹è½½ Release ä¸­çš„ run æ–‡ä»¶ æ‰“å¼€ iStore å•†åº— æ‰‹åŠ¨å®‰è£…å³å¯ ğŸ“¦ äº”ã€ç‰ˆæœ¬ä¸‹è½½ GitHub æ‰€æœ‰ç‰ˆæœ¬ä¸‹è½½ ä¸‹è½½åœ°å€ï¼šhttps://github.com/wukongdaily/allinonescript/releases\nğŸ“Œ ç‰ˆæœ¬è¯´æ˜ï¼š\nğŸ”„ å®šæœŸæ›´æ–°ï¼Œä¿®å¤å·²çŸ¥é—®é¢˜ ğŸ“ è¯¦ç»†ç‰ˆæœ¬è¯´æ˜å’Œæ›´æ–°æ—¥å¿— â¬‡ï¸ æ”¯æŒç›´æ¥ä¸‹è½½è¿è¡Œæ–‡ä»¶ ğŸ”§ å…­ã€å…¶ä»–ç³»ç»Ÿæ”¯æŒ 1. é€šç”¨ OpenWrt ç³»ç»Ÿè„šæœ¬ ä¸‹è½½åœ°å€ï¼šhttps://github.com/wukongdaily/commonscript\n2. ä¾¿æºå¼è·¯ç”±å™¨ä¸“ç”¨è„šæœ¬ æ”¯æŒ GL-iNet MT-3000/MT2500 ç­‰è®¾å¤‡\nä¸‹è½½åœ°å€ï¼šhttps://github.com/wukongdaily/gl-inet-onescript\nğŸ’¡ ä¸ƒã€å¸¸è§é—®é¢˜ä¸æŠ€å·§ â“ å¦‚ä½•ä½¿ç”¨ SSHï¼Ÿ å‚è€ƒæ–‡æ¡£ï¼šhttps://github.com/wukongdaily/HowToUseSSH\nâš ï¸ æ³¨æ„äº‹é¡¹ é¦–æ¬¡è¿è¡Œå‰å»ºè®®å¤‡ä»½ç³»ç»Ÿé…ç½® ç¡®ä¿æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ å¦‚é‡ç½‘ç»œé—®é¢˜ï¼Œå¯å°è¯•ä½¿ç”¨ä»£ç† ğŸ”§ æ•…éšœæ’é™¤ å¦‚æœè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥ ç¡®ä¿ç³»ç»Ÿç‰ˆæœ¬å…¼å®¹ æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ ğŸŒ ç›¸å…³èµ„æº iStore ä¸»é¡¹ç›®ï¼šhttps://github.com/linkease/istore OpenWrt è½¯ä»¶åŒ…ï¼šhttps://op.dllkids.xyz/packages ğŸ“Œ æ€»ç»“ï¼šæ‚Ÿç©ºæ‡’äººåŒ…ä¸º iStoreOS ç”¨æˆ·æä¾›äº†æå¤§ä¾¿åˆ©ï¼Œé€šè¿‡ä¸€é”®è„šæœ¬è§£å†³å¸¸è§é…ç½®é—®é¢˜ï¼Œå¤§å¹…æå‡è½¯è·¯ç”±ä½¿ç”¨ä½“éªŒã€‚æ— è®ºæ˜¯æ–°æ‰‹è¿˜æ˜¯é«˜çº§ç”¨æˆ·ï¼Œéƒ½èƒ½ä»ä¸­å—ç›Šï¼\n","date":"2024-12-07T07:58:26+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/551275c7/","title":"iStoreOS æ‚Ÿç©ºæ‡’äººåŒ…ä¸€ç«™å¼è½¯è·¯ç”±ä¼˜åŒ–è§£å†³æ–¹æ¡ˆ ğŸµ"},{"content":"ESXi NTP æ—¶é—´æœåŠ¡å™¨é…ç½®æŒ‡å— â° æ­£ç¡®çš„æ—¶é—´åŒæ­¥å¯¹äºè™šæ‹ŸåŒ–ç¯å¢ƒè‡³å…³é‡è¦ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»åœ¨ ESXi ä¸­é…ç½® NTP æ—¶é—´æœåŠ¡å™¨çš„ä¸¤ç§æ–¹æ³•ï¼Œç¡®ä¿æ‰€æœ‰è™šæ‹Ÿæœºå’ŒæœåŠ¡å™¨çš„æ—¶é’ŸåŒæ­¥ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• âœ¨ æœ¬æ–‡ç‰¹è‰² ğŸ”§ æ–¹æ³•ä¸€ï¼šESXi Web ç•Œé¢é…ç½® âŒ¨ï¸ æ–¹æ³•äºŒï¼šSSH å‘½ä»¤è¡Œé…ç½® ğŸ“Š éªŒè¯é…ç½®ç»“æœ ğŸ› ï¸ é«˜çº§é…ç½®é€‰é¡¹ ğŸ” æ•…éšœæ’é™¤ âš™ï¸ æœ€ä½³å®è·µå»ºè®® âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ ğŸ’¡ é¢å¤–æŠ€å·§ âœ¨ æœ¬æ–‡ç‰¹è‰² â° åŒé…ç½®æ–¹æ³•ï¼šæä¾› Web ç•Œé¢å’Œå‘½ä»¤è¡Œä¸¤ç§é…ç½®æ–¹å¼ï¼Œé€‚åˆä¸åŒç”¨æˆ·éœ€æ±‚ ğŸŒ å›½å†…ä¼˜åŒ–ï¼šæ¨èä½¿ç”¨é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å›½å†… NTP æœåŠ¡å™¨ï¼ŒåŒæ­¥æ›´å¿«æ›´ç¨³å®š ğŸ”§ è¯¦ç»†æ•…éšœæ’é™¤ï¼šåŒ…å«å¸¸è§é—®é¢˜è§£å†³æ–¹æ³•å’Œé«˜çº§è°ƒè¯•æŠ€å·§ ğŸ“Š æœ€ä½³å®è·µï¼šæä¾›ä¼ä¸šçº§éƒ¨ç½²å»ºè®®å’Œç›‘æ§æ–¹æ¡ˆ âš¡ å®ç”¨æŠ€å·§ï¼šåŒ…å«åŠ é€ŸåŒæ­¥ã€é«˜å¯ç”¨é…ç½®ç­‰å®ç”¨æŠ€å·§ ğŸ”§ æ–¹æ³•ä¸€ï¼šESXi Web ç•Œé¢é…ç½® 1. å¯ç”¨ NTP å®¢æˆ·ç«¯ ç™»å½• ESXi Web ç®¡ç†ç•Œé¢ï¼ˆhttps://ESXI_IPï¼‰ å¯¼èˆªåˆ°\u0026quot;ä¸»æœº\u0026quot; â†’ \u0026ldquo;æ“ä½œ\u0026rdquo; â†’ \u0026ldquo;æœåŠ¡\u0026rdquo; â†’ \u0026ldquo;å¯ç”¨ NTP å®¢æˆ·ç«¯\u0026rdquo; åœ¨ NTP è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹æœåŠ¡å™¨ï¼š ntp.aliyun.com,ntp1.aliyun.com,ntp.tencent.com\n1 2 3 4 5 6 7 4. ä¿å­˜é…ç½®å¹¶å¯åŠ¨ NTP æœåŠ¡ ### 2. é‡å¯ NTP æœåŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰ ```bash # é€šè¿‡ SSH è¿æ¥åˆ° ESXi ä¸»æœº services.sh restart ntpd # ğŸ”„ é‡å¯ NTP å®ˆæŠ¤è¿›ç¨‹ 3. éªŒè¯æœåŠ¡çŠ¶æ€ 1 2 3 # æ£€æŸ¥ NTP æœåŠ¡çŠ¶æ€ services.sh status ntpd # âœ… åº”è¯¥æ˜¾ç¤º \u0026#34;running\u0026#34; âŒ¨ï¸ æ–¹æ³•äºŒï¼šSSH å‘½ä»¤è¡Œé…ç½® å‰ææ¡ä»¶ âœ… åœ¨ ESXi Web ç•Œé¢ä¸­å·²å¯ç”¨ NTP å®¢æˆ·ç«¯ ğŸ”“ å·²å¼€å¯ ESXi SSH è®¿é—®æƒé™ 1. æµ‹è¯• NTP æœåŠ¡å™¨è¿é€šæ€§ 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯•é˜¿é‡Œäº‘ NTP æœåŠ¡å™¨ ping ntp.aliyun.com # ğŸŒ åº”è¯¥è¿”å›: 203.107.6.88 # æµ‹è¯•é˜¿é‡Œäº‘å¤‡ç”¨ NTP æœåŠ¡å™¨ ping ntp1.aliyun.com # ğŸŒ åº”è¯¥è¿”å›: 120.25.115.20 # æµ‹è¯•è…¾è®¯äº‘ NTP æœåŠ¡å™¨ ping ntp.tencent.com # ğŸŒ åº”è¯¥è¿”å›: 106.55.184.199 2. ä¿®æ”¹æ–‡ä»¶æƒé™ 1 2 3 # èµ‹äºˆ ntp.conf æ–‡ä»¶ä¿®æ”¹æƒé™ chmod 0755 /etc/ntp.conf # ğŸ”“ å…è®¸ç¼–è¾‘é…ç½®æ–‡ä»¶ 3. ç¼–è¾‘ NTP é…ç½®æ–‡ä»¶ 1 2 # ä½¿ç”¨ vi ç¼–è¾‘å™¨ä¿®æ”¹é…ç½®æ–‡ä»¶ vi /etc/ntp.conf 4. é…ç½® NTP æœåŠ¡å™¨ åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é˜¿é‡Œäº‘ NTP æœåŠ¡å™¨ server ntp.aliyun.com server ntp1.aliyun.com # è…¾è®¯äº‘ NTP æœåŠ¡å™¨ server ntp.tencent.com # æœ¬åœ°æ—¶é’Ÿä½œä¸ºå¤‡ç”¨ï¼ˆ stratum 10 ï¼‰ server 127.127.1.0 fudge 127.127.1.0 stratum 10 # é™åˆ¶è®¿é—®æƒé™ restrict default kod nomodify notrap nopeer noquery restrict 127.0.0.1 5. ä¿å­˜å¹¶é‡å¯æœåŠ¡ 1 2 3 4 5 # é‡å¯ NTP æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ services.sh restart ntpd # è®¾ç½® NTP æœåŠ¡å¼€æœºè‡ªå¯ chkconfig ntpd on ğŸ“Š éªŒè¯é…ç½®ç»“æœ 1. æ£€æŸ¥ NTP åŒæ­¥çŠ¶æ€ 1 2 3 4 5 6 7 # æŸ¥çœ‹ NTP å¯¹ç­‰èŠ‚ç‚¹çŠ¶æ€ ntpq -p # ğŸ“‹ æ˜¾ç¤ºç±»ä¼¼ï¼š # remote refid st t when poll reach delay offset jitter # ============================================================================== # *ntp.aliyun.com 10.137.38.86 2 u 36 64 377 31.234 -0.043 0.348 # ntp1.aliyun.com 10.137.38.86 2 u 35 64 377 31.567 0.125 0.421 2. æŸ¥çœ‹å½“å‰æ—¶é—´çŠ¶æ€ 1 2 3 # æ˜¾ç¤ºç³»ç»Ÿæ—¶é—´å’Œ NTP çŠ¶æ€ ntpstat # â° åº”è¯¥æ˜¾ç¤º: \u0026#34;synchronised to NTP server (x.x.x.x)\u0026#34; 3. å¼ºåˆ¶ç«‹å³åŒæ­¥ 1 2 3 # å¼ºåˆ¶ NTP ç«‹å³åŒæ­¥æ—¶é—´ ntpd -gq # ğŸš€ å¼ºåˆ¶å¿«é€ŸåŒæ­¥ 4. æ£€æŸ¥æ—¶é—´å·®å¼‚ 1 2 3 # æŸ¥çœ‹å½“å‰æ—¶é—´ä¸NTPæœåŠ¡å™¨çš„æ—¶é—´å·®å¼‚ ntpdc -c loopinfo # â±ï¸ æ˜¾ç¤ºæ—¶é—´åç§»é‡å’Œé¢‘ç‡è¯¯å·® ğŸ› ï¸ é«˜çº§é…ç½®é€‰é¡¹ 1. é…ç½®å¤šä¸ª NTP æœåŠ¡å™¨æ±  1 2 3 4 5 6 7 8 # åœ¨ /etc/ntp.conf ä¸­æ·»åŠ ï¼š server 0.cn.pool.ntp.org server 1.cn.pool.ntp.org server 2.cn.pool.ntp.org server 3.cn.pool.ntp.org # æˆ–è€…ä½¿ç”¨åŒºåŸŸæ±  server pool.ntp.org 2. è°ƒæ•´åŒæ­¥å‚æ•° 1 2 3 4 5 6 7 8 9 # æ›´å¿«çš„åŒæ­¥é—´éš” minpoll 4 # 16ç§’ maxpoll 6 # 64ç§’ # åœ¨ server è¡Œåæ·»åŠ ï¼š server ntp.aliyun.com minpoll 4 maxpoll 6 # å¯ç”¨çªå‘æ¨¡å¼åŠ é€Ÿåˆå§‹åŒæ­¥ server ntp.aliyun.com burst 3. æ—¥å¿—é…ç½® 1 2 3 4 5 6 7 8 # å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½• logconfig =syncall +clockall # æŒ‡å®šæ—¥å¿—æ–‡ä»¶ logfile /var/log/ntp.log # è®¾ç½®æ—¥å¿—çº§åˆ« logconfig =all 4. å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 # å¯ç”¨è®¤è¯ï¼ˆå¦‚æœéœ€è¦ï¼‰ enable auth keys /etc/ntp.keys trustedkey 1 # é™åˆ¶æŸ¥è¯¢æƒé™ restrict default noquery restrict 127.0.0.1 ğŸ” æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 # æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ NTPï¼ˆç«¯å£ 123ï¼‰ esxcli network firewall ruleset list | grep ntp # å¦‚æœé˜²ç«å¢™é˜»æ­¢ï¼Œå¯ç”¨ NTP è§„åˆ™é›† esxcli network firewall ruleset set -e true -r ntpClient # æ£€æŸ¥DNSè§£ææ˜¯å¦æ­£å¸¸ nslookup ntp.aliyun.com 2. æ‰‹åŠ¨æ—¶é—´è®¾ç½®ï¼ˆä¸´æ—¶ï¼‰ 1 2 3 4 5 # å¦‚æœ NTP å®Œå…¨å¤±è´¥ï¼Œæ‰‹åŠ¨è®¾ç½®æ—¶é—´ esxcli system time set -y 2024 -M 01 -d 15 -H 14 -m 30 -s 00 # æˆ–è€…ä½¿ç”¨dateå‘½ä»¤ date -s \u0026#34;2024-01-15 14:30:00\u0026#34; 3. æ£€æŸ¥æ—¶é—´æ¼‚ç§» 1 2 3 4 5 6 # æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´ä¸ç¡¬ä»¶æ—¶é’Ÿçš„å·®å¼‚ esxcli system time get # â±ï¸ æ¯”è¾ƒè½¯ä»¶æ—¶é—´å’Œç¡¬ä»¶æ—¶é—´ # æŸ¥çœ‹ç¡¬ä»¶æ—¶é’Ÿ esxcli hardware clock get 4. æœåŠ¡çŠ¶æ€è¯Šæ–­ 1 2 3 4 5 6 # æ£€æŸ¥NTPæœåŠ¡æ—¥å¿— tail -f /var/log/messages | grep ntp # æŸ¥çœ‹è¯¦ç»†çš„NTPçŠ¶æ€ä¿¡æ¯ ntptrace ntpdc -c sysinfo âš™ï¸ æœ€ä½³å®è·µå»ºè®® 1. æœåŠ¡å™¨é€‰æ‹©ç­–ç•¥ ğŸŒ ä½¿ç”¨è‡³å°‘ 3 ä¸ªä¸åŒçš„ NTP æœåŠ¡å™¨ ğŸ“ ä¼˜å…ˆé€‰æ‹©åœ°ç†ä½ç½®è¿‘çš„æœåŠ¡å™¨ ğŸ”„ æ··åˆä½¿ç”¨ä¸åŒä¾›åº”å•†çš„æœåŠ¡å™¨ ğŸ¢ è€ƒè™‘ä½¿ç”¨å†…éƒ¨NTPæœåŠ¡å™¨ä½œä¸ºä¸»è¦æ—¶é—´æº 2. ç›‘æ§é…ç½® 1 2 3 4 5 6 7 8 9 # åˆ›å»ºç›‘æ§è„šæœ¬ #!/bin/sh if ! ntpstat \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;NTP sync failed!\u0026#34; | logger -t ntpmon services.sh restart ntpd fi # æ·»åŠ åˆ°cronå®šæœŸæ‰§è¡Œ echo \u0026#34;*/5 * * * * /path/to/ntpmon.sh\u0026#34; \u0026gt;\u0026gt; /var/spool/cron/crontabs/root 3. å®šæœŸç»´æŠ¤ ğŸ“… æ¯æœˆæ£€æŸ¥ä¸€æ¬¡ NTP æœåŠ¡å™¨çŠ¶æ€ ğŸ”„ å®šæœŸæ›´æ–°å¯ä¿¡çš„ NTP æœåŠ¡å™¨åˆ—è¡¨ ğŸ“Š ç›‘æ§æ—¶é—´åŒæ­¥åç§»é‡ ğŸ—‘ï¸ æ¸…ç†æ—§çš„NTPæ—¥å¿—æ–‡ä»¶ 4. é«˜å¯ç”¨æ€§é…ç½® 1 2 3 4 5 6 7 8 9 # é…ç½®å¤šä¸ªå†—ä½™æœåŠ¡å™¨ server ntp1.aliyun.com server ntp2.aliyun.com server ntp3.aliyun.com server ntp1.tencent.com server ntp2.tencent.com # è®¾ç½®ä¼˜å…ˆçº§ server ntp1.aliyun.com prefer âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ æƒé™è¦æ±‚ï¼šä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶éœ€è¦ root æƒé™ æœåŠ¡ä¾èµ–ï¼šç¡®ä¿ NTP å®¢æˆ·ç«¯æœåŠ¡å·²å¯ç”¨ ç½‘ç»œè¿é€šæ€§ï¼šç¡®è®¤ ESXi ä¸»æœºå¯ä»¥è®¿é—®äº’è”ç½‘ NTP æœåŠ¡å™¨ é˜²ç«å¢™é…ç½®ï¼šå…è®¸ UDP ç«¯å£ 123 çš„å‡ºç«™è¿æ¥ å¤‡ä»½é…ç½®ï¼šä¿®æ”¹å‰å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 cp /etc/ntp.conf /etc/ntp.conf.backup æ—¶é—´è·³å˜å½±å“ï¼šå¤§æ—¶é—´è·³å˜å¯èƒ½å½±å“è™šæ‹Ÿæœºè¿è¡Œï¼Œå»ºè®®é€æ­¥è°ƒæ•´ åˆè§„æ€§è¦æ±‚ï¼šæŸäº›è¡Œä¸šæœ‰ç‰¹å®šçš„æ—¶é—´åŒæ­¥è¦æ±‚ï¼Œè¯·ç¡®ä¿ç¬¦åˆç›¸å…³è§„å®š ğŸ’¡ é¢å¤–æŠ€å·§ 1. ä½¿ç”¨å†…éƒ¨ NTP æœåŠ¡å™¨ 1 2 3 4 5 6 # å¦‚æœæœ‰å†…éƒ¨ NTP æœåŠ¡å™¨ï¼Œä¼˜å…ˆä½¿ç”¨ server ntp.internal.company.com iburst prefer # é…ç½®å±‚çº§å…³ç³» server ntp1.internal.company.com server ntp2.internal.company.com 2. åŠ é€Ÿåˆå§‹åŒæ­¥ 1 2 3 4 5 # åœ¨ server è¡Œæ·»åŠ  iburst é€‰é¡¹åŠ é€Ÿåˆå§‹åŒæ­¥ server ntp.aliyun.com iburst # ä½¿ç”¨ burst é€‰é¡¹è¿›è¡Œæ›´æ¿€è¿›çš„åˆå§‹åŒæ­¥ server ntp.aliyun.com burst 3. é…ç½® NTP å®¢æˆ·ç«¯ç­–ç•¥ 1 2 3 4 5 6 7 8 9 # åœ¨ /etc/ntp.conf ä¸­æ·»åŠ ï¼š tinker panic 0 # å…è®¸å¤§æ—¶é—´è·³å˜ # è®¾ç½®æ­¥è¿›é˜ˆå€¼ stepthreshold 0.5 # å…è®¸0.5ç§’çš„æ­¥è¿›è°ƒæ•´ # é…ç½®æ—¶é’Ÿ Discipline setvar delay 0.3 # è®¾ç½®ç½‘ç»œå»¶è¿Ÿ setvar dispersion 0.5 # è®¾ç½® dispersion 4. è™šæ‹Ÿæœºæ—¶é—´åŒæ­¥è®¾ç½® 1 2 3 4 5 6 # ç¡®ä¿è™šæ‹Ÿæœºä¸ä¸»æœºæ—¶é—´åŒæ­¥ vim-cmd vmsvc/getallvms | awk \u0026#39;{print $1}\u0026#39; | while read vmid; do vim-cmd vmsvc/time.synchronize $vmid done # æˆ–è€…é€šè¿‡vSphere Clientè®¾ç½®è™šæ‹Ÿæœºæ—¶é—´åŒæ­¥é€‰é¡¹ 5. ä½¿ç”¨ Chrony ä½œä¸ºæ›¿ä»£ 1 2 3 4 5 6 # å¯¹äºæ›´æ–°çš„ESXiç‰ˆæœ¬ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Chrony # å®‰è£… Chrony (å¦‚æœå¯ç”¨) esxcli software vib install -n chrony # é…ç½® Chrony vi /etc/chrony.conf ğŸ¯ é€šè¿‡æ­£ç¡®é…ç½® NTP æ—¶é—´åŒæ­¥ï¼Œå¯ä»¥ç¡®ä¿ ESXi ä¸»æœºå’Œæ‰€æœ‰è™šæ‹Ÿæœºçš„æ—¶é’Ÿå‡†ç¡®æ€§ï¼Œè¿™å¯¹äºæ—¥å¿—åˆ†æã€è¯ä¹¦éªŒè¯å’Œåˆ†å¸ƒå¼ç³»ç»Ÿåè°ƒéƒ½è‡³å…³é‡è¦ã€‚å®šæœŸç›‘æ§å’Œç»´æŠ¤ NTP é…ç½®æ˜¯ä¿æŒè™šæ‹ŸåŒ–ç¯å¢ƒç¨³å®šè¿è¡Œçš„é‡è¦ç¯èŠ‚ã€‚\n","date":"2024-12-07T07:57:50+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e8029f0c/","title":"ESXi NTP æ—¶é—´æœåŠ¡å™¨é…ç½®æŒ‡å— â°"},{"content":"Typecho åšå®¢æ’ä»¶ä¸ä¸»é¢˜ï¼ˆä½¿ç”¨ä¸­ï¼‰ ğŸ¨ ğŸ“Œ å¯¼èˆªç›®å½•\nğŸ¯ ä¸€ã€JKAdmin åå°ä¸»é¢˜é…ç½® ğŸ¦‹ äºŒã€Butterfly å‰å°ä¸»é¢˜è®¾ç½® ğŸ”Œ ä¸‰ã€Typecho æ’ä»¶å®‰è£… ğŸ’¡ å››ã€ä¼˜åŒ–å»ºè®®ä¸æŠ€å·§ ğŸ¯ ä¸€ã€JKAdmin åå°ä¸»é¢˜é…ç½® 1. ä¸‹è½½ä¸å®‰è£… JKAdmin å®˜æ–¹åœ°å€ï¼šhttps://3si.tech/shop/22.html\nä¸‹è½½é“¾æ¥ï¼šhttps://ijkxs.lanzn.com/b021swg7c\nå¯†ç ï¼šcptp\nğŸ” æˆæƒä¿¡æ¯ï¼š\nç”¨æˆ·åï¼šmobufan å¯†ç ï¼šå°å­©ååŠ ç”Ÿï¼ˆå…¨å°å†™ï¼‰ é‚®ç®±ï¼š496338740@qq.com QQï¼š496338740 2. å®‰è£…æ­¥éª¤ è§£å‹ä¸»é¢˜ï¼šå°†ä¸‹è½½çš„JKAdminä¸»é¢˜è§£å‹åˆ°Typechoå®‰è£…ç›®å½•ï¼Œé‡å‘½åä¸ºjkadmin ä¿®æ”¹é…ç½®ï¼šç¼–è¾‘config.inc.phpæ–‡ä»¶ï¼Œå°†ï¼š 1 define(\u0026#39;__TYPECHO_ADMIN_DIR__\u0026#39;, \u0026#39;/admin/\u0026#39;) ä¿®æ”¹ä¸ºï¼š 1 define(\u0026#39;__TYPECHO_ADMIN_DIR__\u0026#39;, \u0026#39;/jkadmin/\u0026#39;) æ›¿æ¢ç»„ä»¶ï¼šè§£å‹Widget.zipæ›¿æ¢var/Typecho/Widgetæ–‡ä»¶å¤¹ 3. è‡ªå®šä¹‰ç™»å½•é¡µ åˆ›å»ºè‡ªå®šä¹‰CSSæ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 mkdir -p /mnt/mydisk/home/typecho/typecho/jkadmin/assets/css \u0026amp;\u0026amp; \\ touch /mnt/mydisk/home/typecho/typecho/jkadmin/assets/css/custom.css \u0026amp;\u0026amp; \\ cat \u0026gt; /mnt/mydisk/home/typecho/typecho/jkadmin/assets/css/custom.css \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; .profile-greeting { background-image: url(\u0026#34;https://pic.imgdb.cn/item/64aab0201ddac507ccc4ca0f.jpg\u0026#34;); } /* ç™»å½•é¡µé¢æ ·å¼ */ #login-img-wrapper { background-image: url(\u0026#34;https://acg.suyanw.cn/Anime\u0026#34;)!important; background-size: cover; background-repeat: no-repeat; } #login-img-wrapper .login-card { opacity: 0.88; } /* æ³¨å†Œé¡µé¢æ ·å¼ */ #register-img-wrapper { background-image: url(\u0026#34;https://acg.suyanw.cn/Anime\u0026#34;)!important; background-size: cover; background-repeat: no-repeat; } #register-img-wrapper .login-card { opacity: 0.88; } EOF 4. æ›´æ”¹Gravatarå¤´åƒæº åœ¨config.inc.phpä¸­æ·»åŠ ï¼š\n1 define(\u0026#39;__TYPECHO_GRAVATAR_PREFIX__\u0026#39;, \u0026#39;https://img1.baidu.com/it/u=184448109,1805815777\u0026amp;fm=253\u0026amp;fmt=auto?w=200\u0026amp;h=200\u0026#39;); ğŸ¦‹ äºŒã€Butterfly å‰å°ä¸»é¢˜è®¾ç½® ä¸»é¢˜ä¿¡æ¯ å­˜æ”¾è·¯å¾„ï¼š/mnt/mydisk/home/typecho/typecho/usr/themes ä¸‹è½½åœ°å€ï¼šhttps://github.com/wehaox/Typecho-Butterfly ä½¿ç”¨æ–‡æ¡£ï¼šhttps://blog.haoi.net/archives/typecho-butterfly.html å¤´åƒåœ°å€ï¼šhttps://t.mobufan.eu.org:666/usr/uploads/2024/10/111111.png âœ¨ ä¸»é¢˜ç‰¹ç‚¹ï¼š\nğŸ¨ ç°ä»£åŒ–è®¾è®¡é£æ ¼ ğŸ“± å“åº”å¼å¸ƒå±€ âš¡ æ€§èƒ½ä¼˜åŒ– ğŸ”§ é«˜åº¦å¯å®šåˆ¶ ğŸ”Œ ä¸‰ã€Typecho æ’ä»¶å®‰è£… 1. ä»£ç é«˜äº®æ’ä»¶ ä¸‹è½½åœ°å€ï¼šhttps://typechx.com/plugins/CodeHighlighter.html\nå®‰è£…è·¯å¾„ï¼š\n1 cd /mnt/mydisk/home/typecho/typecho/usr/plugins ğŸ“ åŠŸèƒ½ç‰¹ç‚¹ï¼š\næ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€é«˜äº® å¯è‡ªå®šä¹‰é¢œè‰²ä¸»é¢˜ è½»é‡çº§ï¼Œä¸å½±å“æ€§èƒ½ 2. æ¨èå…¶ä»–å®ç”¨æ’ä»¶ Comments: è¯„è®ºç®¡ç†å¢å¼º Sitemap: è‡ªåŠ¨ç”Ÿæˆç½‘ç«™åœ°å›¾ Stat: è®¿é—®ç»Ÿè®¡åŠŸèƒ½ Backup: æ•°æ®åº“å¤‡ä»½å·¥å…· ğŸ’¡ å››ã€ä¼˜åŒ–å»ºè®®ä¸æŠ€å·§ ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ– å¯ç”¨ç¼“å­˜ï¼šå®‰è£…ç¼“å­˜æ’ä»¶æå‡åŠ è½½é€Ÿåº¦ å›¾ç‰‡ä¼˜åŒ–ï¼šä½¿ç”¨WebPæ ¼å¼å›¾ç‰‡å‡å°‘å¸¦å®½ CDNåŠ é€Ÿï¼šé™æ€èµ„æºä½¿ç”¨CDNåˆ†å‘ ğŸ”’ å®‰å…¨å»ºè®® å®šæœŸæ›´æ–°ï¼šä¿æŒTypechoå’Œæ’ä»¶æœ€æ–°ç‰ˆæœ¬ ä¿®æ”¹åå°è·¯å¾„ï¼šä½¿ç”¨JKAdminæä¾›çš„è‡ªå®šä¹‰è·¯å¾„åŠŸèƒ½ å¤‡ä»½ç­–ç•¥ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“å’Œä¸»é¢˜æ–‡ä»¶ ğŸ¨ ä¸ªæ€§åŒ–å®šåˆ¶ è‡ªå®šä¹‰CSSï¼šåˆ©ç”¨JKAdminçš„custom.cssæ–‡ä»¶è¿›è¡Œä¸ªæ€§åŒ–æ ·å¼è°ƒæ•´ å›¾æ ‡ä¼˜åŒ–ï¼šä½¿ç”¨Font Awesomeæˆ–å…¶ä»–å›¾æ ‡åº“å¢å¼ºè§†è§‰æ•ˆæœ å“åº”å¼è°ƒè¯•ï¼šç¡®ä¿ä¸»é¢˜åœ¨å„ç§è®¾å¤‡ä¸Šæ˜¾ç¤ºæ­£å¸¸ âš ï¸ æ³¨æ„äº‹é¡¹ ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶å‰åŠ¡å¿…å¤‡ä»½ æµ‹è¯•æ–°ä¸»é¢˜æˆ–æ’ä»¶æ—¶å…ˆåœ¨æœ¬åœ°ç¯å¢ƒå°è¯• å…³æ³¨æ’ä»¶å…¼å®¹æ€§ï¼Œé¿å…å†²çª ğŸ“Œ æ€»ç»“ï¼šé€šè¿‡JKAdminåå°ä¸»é¢˜å’ŒButterflyå‰å°ä¸»é¢˜çš„æ­é…ï¼ŒåŠ ä¸Šå¿…è¦çš„åŠŸèƒ½æ’ä»¶ï¼Œå¯ä»¥æ‰“é€ å‡ºæ—¢ç¾è§‚åˆåŠŸèƒ½å®Œå–„çš„Typechoåšå®¢ã€‚è®°å¾—å®šæœŸç»´æŠ¤å’Œæ›´æ–°ï¼Œä¿æŒåšå®¢çš„æœ€ä½³çŠ¶æ€ï¼\n","date":"2024-12-07T07:56:30+08:00","image":"https://file.meimolihan.eu.org/img/typecho-03.webp","permalink":"https://blog.meimolihan.eu.org/p/cd8a2da4/","title":"Typecho åšå®¢æ’ä»¶ä¸ä¸»é¢˜ï¼ˆä½¿ç”¨ä¸­ï¼‰ ğŸ¨"},{"content":"iStoreOS å¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ’¾ ä½¿ç”¨æ‚Ÿç©ºå¼€å‘çš„ OpenBackRestore å·¥å…·ï¼Œè½»æ¾å¤‡ä»½å’Œæ¢å¤ iStoreOS ç³»ç»Ÿçš„è½¯ä»¶é…ç½®ï¼Œç¡®ä¿ç³»ç»Ÿé‡ç½®åå¿«é€Ÿæ¢å¤åŸæœ‰ç¯å¢ƒã€‚\nğŸ“Œ å¯¼èˆªç›®å½•\nâœ¨ ä¸€ã€å·¥å…·ç®€ä»‹ä¸åŠŸèƒ½ç‰¹è‰² ğŸš€ äºŒã€å‘½ä»¤è¡Œæ–¹å¼æ“ä½œ ğŸ–±ï¸ ä¸‰ã€å›¾å½¢ç•Œé¢æ–¹å¼ ğŸ“ å››ã€å¤‡ä»½å†…å®¹è¯¦è§£ ğŸ”§ äº”ã€é«˜çº§ä½¿ç”¨æŠ€å·§ âš ï¸ å…­ã€é‡è¦æ³¨æ„äº‹é¡¹ ğŸ” ä¸ƒã€æ•…éšœæ’é™¤ ğŸ’¡ å…«ã€æœ€ä½³å®è·µ ğŸ†˜ ä¹ã€ç´§æ€¥æ¢å¤æ­¥éª¤ âœ¨ ä¸€ã€å·¥å…·ç®€ä»‹ä¸åŠŸèƒ½ç‰¹è‰² é¡¹ç›®åœ°å€ï¼š https://github.com/wukongdaily/OpenBackRestore ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½ ğŸ’» ä¸€é”®ç”Ÿæˆå¤‡ä»½æ¡£æ¡ˆ - åŒ…å«å·²å®‰è£…è½¯ä»¶åŠå…¶é…ç½® ğŸ’» ä¸€é”®æ¢å¤å¤‡ä»½æ¡£æ¡ˆ - å¿«é€Ÿè¿˜åŸè½¯ä»¶ç¯å¢ƒ ğŸ’» å…¨é¢è½¯ä»¶æ”¯æŒ - åŒ…å«åº”ç”¨å•†åº—å’Œç¬¬ä¸‰æ–¹å®‰è£…çš„ ipk/run åŒ… ğŸ”‘ åŒé‡æ“ä½œæ–¹å¼ - æ”¯æŒç»ˆç«¯å‘½ä»¤è¡Œå’Œå›¾å½¢ç•Œé¢æ‰‹åŠ¨å®‰è£… ğŸ³ Docker æ•°æ®ä¿æŠ¤ - æ™ºèƒ½å¤„ç† Docker æ•°æ®åˆ†åŒºè¿ç§» ğŸ”„ è·¨æ¶æ„æ”¯æŒ - æ”¯æŒ x86_64 å’Œ Arm64 æ¶æ„ ğŸš€ äºŒã€å‘½ä»¤è¡Œæ–¹å¼æ“ä½œï¼ˆæ¨èï¼‰ 1. ç”Ÿæˆç³»ç»Ÿå¤‡ä»½ 1 2 3 # ä½¿ç”¨ GitHub ä¸»ä»“åº“ç”Ÿæˆå¤‡ä»½ wget -O backup.run https://raw.githubusercontent.com/wukongdaily/OpenBackRestore/master/backup/backup.run \u0026amp;\u0026amp; sh backup.run # ğŸ“¦ å¤‡ä»½æ–‡ä»¶å°†ä¿å­˜åˆ°: /tmp/upload/backup.tar.gz 1 2 3 # ä½¿ç”¨ Gitee å¤‡ç”¨ä»“åº“ï¼ˆå›½å†…è®¿é—®æ›´å¿«ï¼‰ wget -O backup.run https://gitee.com/wukongdaily/OpenBackRestore/raw/master/backup/backup.run \u0026amp;\u0026amp; sh backup.run # ğŸ‡¨ğŸ‡³ å›½å†…é•œåƒï¼Œä¸‹è½½é€Ÿåº¦æ›´å¿« ğŸ“… å¤‡ä»½å»ºè®®ï¼š\næ¯æœˆå®šæœŸå¤‡ä»½ä¸€æ¬¡ é‡å¤§é…ç½®æ›´æ”¹å‰åè¿›è¡Œå¤‡ä»½ å¤‡ä»½æ–‡ä»¶åŒ…å«å®Œæ•´ç³»ç»Ÿå’Œè½¯ä»¶é…ç½® 2. æ¢å¤ç³»ç»Ÿå¤‡ä»½ å‰ææ¡ä»¶ï¼š\nâœ… å¤‡ä»½æ–‡ä»¶å·²ä¸Šä¼ è‡³ /tmp/upload/ ç›®å½• ğŸ”„ ç³»ç»Ÿå·²é‡ç½®æˆ–éœ€è¦æ¢å¤ 1 2 3 # ä½¿ç”¨ GitHub ä¸»ä»“åº“æ¢å¤å¤‡ä»½ wget -O restore.run https://raw.githubusercontent.com/wukongdaily/OpenBackRestore/master/backup/restore.run \u0026amp;\u0026amp; sh restore.run # ğŸ”„ æ¢å¤å®Œæˆåç³»ç»Ÿå°†è‡ªåŠ¨é‡å¯ 1 2 3 # ä½¿ç”¨ Gitee å¤‡ç”¨ä»“åº“æ¢å¤å¤‡ä»½ wget -O restore.run https://gitee.com/wukongdaily/OpenBackRestore/raw/master/backup/restore.run \u0026amp;\u0026amp; sh restore.run # ğŸ‡¨ğŸ‡³ å›½å†…ç”¨æˆ·æ¨èä½¿ç”¨ ğŸ–±ï¸ ä¸‰ã€å›¾å½¢ç•Œé¢æ–¹å¼ 1. ä¸‹è½½è¿è¡Œæ–‡ä»¶ å‘å¸ƒé¡µé¢ï¼š https://github.com/wukongdaily/OpenBackRestore/releases/latest ğŸ“¥ ä¸‹è½½ backup.runï¼ˆå¤‡ä»½å·¥å…·ï¼‰ ğŸ“¥ ä¸‹è½½ restore.runï¼ˆæ¢å¤å·¥å…·ï¼‰ 2. æ‰‹åŠ¨å®‰è£…æ­¥éª¤ æ‰“å¼€ iStore åº”ç”¨å•†åº— ç‚¹å‡»\u0026quot;æ‰‹åŠ¨å®‰è£…\u0026quot;æŒ‰é’® å°†ä¸‹è½½çš„ .run æ–‡ä»¶æ‹–æ‹½åˆ°ä¸Šä¼ åŒºåŸŸ ç‚¹å‡»\u0026quot;å®‰è£…\u0026quot;æ‰§è¡Œç›¸åº”æ“ä½œ ğŸ“ å››ã€å¤‡ä»½å†…å®¹è¯¦è§£ âœ… åŒ…å«çš„é¡¹ç›®ï¼š ğŸ“¦ æ‰€æœ‰é€šè¿‡ opkg å®‰è£…çš„è½¯ä»¶åŒ… âš™ï¸ ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼ˆ/etc ç›®å½•ï¼‰ ğŸ³ Docker å®¹å™¨é…ç½®ï¼ˆå¦‚æœªè¿ç§»æ•°æ®åˆ†åŒºï¼‰ ğŸ”§ è‡ªå®šä¹‰è„šæœ¬å’Œå®šæ—¶ä»»åŠ¡ ğŸŒ ç½‘ç»œé…ç½®å’Œé˜²ç«å¢™è§„åˆ™ âŒ ä¸åŒ…å«çš„é¡¹ç›®ï¼š ğŸ—‚ï¸ ç”¨æˆ·è‡ªå»ºåˆ†åŒºçš„æ•°æ®ï¼ˆå¦‚å·²è¿ç§»çš„ Docker æ•°æ®ï¼‰ ğŸ’¾ å¤§å‹åª’ä½“æ–‡ä»¶æˆ–ä¸‹è½½å†…å®¹ ğŸ“Š æ•°æ®åº“å†…å®¹ï¼ˆéœ€å•ç‹¬å¤‡ä»½ï¼‰ ğŸ”§ äº”ã€é«˜çº§ä½¿ç”¨æŠ€å·§ 1. å®šæ—¶è‡ªåŠ¨å¤‡ä»½ 1 2 # åˆ›å»ºå®šæ—¶å¤‡ä»½ä»»åŠ¡ï¼ˆæ¯æœˆ1å·å‡Œæ™¨2ç‚¹ï¼‰ echo \u0026#34;0 2 1 * * wget -O /tmp/backup.run https://raw.githubusercontent.com/wukongdaily/OpenBackRestore/master/backup/backup.run \u0026amp;\u0026amp; sh /tmp/backup.run\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root 2. å¤‡ä»½æ–‡ä»¶ç®¡ç† 1 2 3 4 5 # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ä¿¡æ¯ ls -lh /tmp/upload/backup.tar.gz # ç§»åŠ¨å¤‡ä»½æ–‡ä»¶åˆ°å®‰å…¨ä½ç½® mv /tmp/upload/backup.tar.gz /mnt/sda1/backups/ 3. éªŒè¯å¤‡ä»½å®Œæ•´æ€§ 1 2 # æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æ˜¯å¦å®Œæ•´ tar -tzf /tmp/upload/backup.tar.gz \u0026gt; /dev/null \u0026amp;\u0026amp; echo \u0026#34;âœ… å¤‡ä»½æ–‡ä»¶å®Œæ•´\u0026#34; || echo \u0026#34;âŒ å¤‡ä»½æ–‡ä»¶æŸå\u0026#34; âš ï¸ å…­ã€é‡è¦æ³¨æ„äº‹é¡¹ 1. ç³»ç»Ÿè¦æ±‚ âœ… iStoreOS æœ€æ–°ç‰ˆæœ¬ ğŸ’¾ è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 100MB ç©ºé—²ç©ºé—´ï¼‰ ğŸŒ æ­£å¸¸çš„ç½‘ç»œè¿æ¥ 2. æ¢å¤å‰æ ğŸ”„ ç¡®ä¿å¤‡ä»½æ–‡ä»¶ä¸ç³»ç»Ÿæ¶æ„åŒ¹é… ğŸ“‹ æ¢å¤å‰å»ºè®®å¤‡ä»½å½“å‰é…ç½® âš ï¸ æ¢å¤è¿‡ç¨‹ä¼šè¦†ç›–ç°æœ‰é…ç½® 3. å®‰å…¨å»ºè®® ğŸ”’ å®šæœŸå°†å¤‡ä»½æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°è®¡ç®—æœº ğŸŒ é‡è¦ç³»ç»Ÿé…ç½®å»ºè®®å¤šé‡å¤‡ä»½ ğŸ“… å»ºç«‹å®šæœŸå¤‡ä»½è®¡åˆ’ ğŸ” ä¸ƒã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 # å¦‚æœä¸‹è½½å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥ ping github.com # å¦‚æœæƒé™ä¸è¶³ï¼Œæ·»åŠ æ‰§è¡Œæƒé™ chmod +x backup.run 2. æ—¥å¿—æŸ¥çœ‹ 1 2 # æŸ¥çœ‹å¤‡ä»½/æ¢å¤è¿‡ç¨‹çš„è¯¦ç»†æ—¥å¿— tail -f /tmp/backup.log 3. æ‰‹åŠ¨æ¸…ç† 1 2 # æ¸…ç†ä¸´æ—¶æ–‡ä»¶ rm -f /tmp/backup.run /tmp/restore.run /tmp/upload/backup.tar.gz ğŸ’¡ å…«ã€æœ€ä½³å®è·µ 1. å¤‡ä»½ç­–ç•¥ ğŸ“… æ¯æ—¥ï¼šå…³é”®é…ç½®å˜æ›´åç«‹å³å¤‡ä»½ ğŸ“… æ¯å‘¨ï¼šå®Œæ•´ç³»ç»ŸçŠ¶æ€å¤‡ä»½ ğŸ“… æ¯æœˆï¼šå½’æ¡£å¤‡ä»½åˆ°å¤–éƒ¨å­˜å‚¨ 2. æ¢å¤æµ‹è¯• âœ… å®šæœŸæµ‹è¯•å¤‡ä»½æ–‡ä»¶çš„æ¢å¤åŠŸèƒ½ ğŸ”„ ç¡®ä¿å¤‡ä»½æµç¨‹å¯é æœ‰æ•ˆ ğŸ“‹ è®°å½•æ¢å¤æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ 3. ç‰ˆæœ¬ç®¡ç† ğŸ·ï¸ åœ¨å¤‡ä»½æ–‡ä»¶åä¸­æ·»åŠ æ—¥æœŸç‰ˆæœ¬ ğŸ“ è®°å½•æ¯æ¬¡å¤‡ä»½çš„é‡è¦å˜æ›´ ğŸ”„ ä¿ç•™å¤šä¸ªå†å²ç‰ˆæœ¬å¤‡ä»½ ğŸ†˜ ä¹ã€ç´§æ€¥æ¢å¤æ­¥éª¤ å¦‚æœç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼Œä½†ä»å¯è¿›å…¥æ¢å¤æ¨¡å¼ï¼š\nğŸ”Œ é€šè¿‡ TFTP æˆ– U ç›˜å¯åŠ¨æ¢å¤ç¯å¢ƒ ğŸ“ å°†å¤‡ä»½æ–‡ä»¶æ”¾å…¥ /tmp/upload/ ç›®å½• ğŸ”„ æ‰§è¡Œæ¢å¤å‘½ä»¤ ğŸš€ é‡å¯ç³»ç»Ÿ ğŸ¯ é€šè¿‡ OpenBackRestore å·¥å…·ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç† iStoreOS çš„ç³»ç»Ÿé…ç½®ï¼Œç¡®ä¿åœ¨ç³»ç»Ÿé‡ç½®æˆ–å‡çº§åå¿«é€Ÿæ¢å¤å·¥ä½œç¯å¢ƒã€‚å»ºè®®å®šæœŸå¤‡ä»½å¹¶éªŒè¯å¤‡ä»½æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚\nğŸ’ª é™„åŠ æç¤ºï¼š\nå®šæœŸæ£€æŸ¥å·¥å…·æ›´æ–°ï¼Œè·å–æœ€æ–°åŠŸèƒ½ åŠ å…¥ iStoreOS ç”¨æˆ·ç¤¾åŒºï¼Œåˆ†äº«å¤‡ä»½æ¢å¤ç»éªŒ è€ƒè™‘ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ å»ºç«‹æ–‡æ¡£è®°å½•ç³»ç»Ÿå…³é”®é…ç½®å˜æ›´å†å² ğŸ›¡ï¸ å®‰å…¨æé†’ï¼š\nå¤‡ä»½æ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡ æ¢å¤å‰éªŒè¯å¤‡ä»½æ–‡ä»¶æ¥æºï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œ å®šæœŸæ›´æ¢å¤‡ä»½å­˜å‚¨ä½ç½®ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœ å¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æ›´å¥½åœ°ä½¿ç”¨ iStoreOS å¤‡ä»½ä¸æ¢å¤åŠŸèƒ½ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨é¡¹ç›® GitHub é¡µé¢æäº¤åé¦ˆã€‚\n","date":"2024-12-07T07:55:45+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/d6ec4e85/","title":"iStoreOS å¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ’¾"},{"content":"iStoreOS opkg è½¯ä»¶æºé…ç½®æŒ‡å— ğŸ“¦ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸º iStoreOS é…ç½®å›½å†…é•œåƒæºå’Œç¬¬ä¸‰æ–¹è½¯ä»¶æºï¼Œå¤§å¹…æå‡è½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦å’Œå®‰è£…æˆåŠŸç‡ã€‚åŒ…å«ä»åŸºç¡€é…ç½®åˆ°é«˜çº§æŠ€å·§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚\nğŸ“‘ å¯¼èˆªç›®å½• âœ¨ æœ¬æ–‡ç‰¹è‰² âš™ï¸ ä¸€ã€åŸºç¡€ opkg é…ç½® ğŸŒ äºŒã€å›½å†…é•œåƒæºé…ç½® x86_64 æ¶æ„é…ç½® aarch64 æ¶æ„é…ç½® ğŸ¯ ä¸‰ã€ç¬¬ä¸‰æ–¹è½¯ä»¶æºé…ç½® ğŸ”§ å››ã€é…ç½®éªŒè¯å’Œä¼˜åŒ– ğŸ› ï¸ äº”ã€æ•…éšœæ’é™¤ ğŸ’¡ å…­ã€é«˜çº§æŠ€å·§ âš ï¸ ä¸ƒã€é‡è¦æ³¨æ„äº‹é¡¹ ğŸ”„ å…«ã€éªŒè¯é…ç½®æ•ˆæœ âœ¨ æœ¬æ–‡ç‰¹è‰² ğŸŒ å…¨é¢è¦†ç›–ï¼šæä¾›ä¸»æµå›½å†…é•œåƒæºå’Œç¬¬ä¸‰æ–¹æºé…ç½® ğŸ—ï¸ æ¶æ„é€‚é…ï¼šåˆ†åˆ«æä¾› x86_64 å’Œ aarch64 æ¶æ„çš„é…ç½® âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šåŒ…å«è¶…æ—¶è®¾ç½®ã€curl ä¼˜åŒ–ç­‰æå‡ä¸‹è½½æˆåŠŸç‡çš„æ–¹æ³• ğŸ”§ å®ç”¨å·¥å…·ï¼šæä¾›è‡ªåŠ¨åŒ–è„šæœ¬å’Œæ•…éšœæ’é™¤æŒ‡å— ğŸ›¡ï¸ å®‰å…¨å»ºè®®ï¼šåŒ…å«æ³¨æ„äº‹é¡¹å’Œå¤‡ä»½æ¢å¤æ–¹æ³• âš™ï¸ ä¸€ã€åŸºç¡€ opkg é…ç½® é€šç”¨é…ç½®ï¼ˆé€‚ç”¨äºæ‰€æœ‰æ¶æ„ï¼‰ 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºä¼˜åŒ–çš„ opkg åŸºç¡€é…ç½® cat \u0026gt; /etc/opkg.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; dest root / dest ram /tmp lists_dir ext /var/opkg-lists option overlay_root /overlay option http_timeout 30 # å¢åŠ è¶…æ—¶æ—¶é—´ option use_curl 1 # ä½¿ç”¨ curl æé«˜ä¸‹è½½ç¨³å®šæ€§ # option check_signature # æ³¨é‡Šæ‰ç­¾åæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰ EOF é…ç½®è¯´æ˜ï¼š\nâ° http_timeout 30ï¼šå¢åŠ è¶…æ—¶æ—¶é—´é¿å…ç½‘ç»œæ³¢åŠ¨å¤±è´¥ ğŸŒ use_curl 1ï¼šä½¿ç”¨ curl æ›¿ä»£ wgetï¼Œä¸‹è½½æ›´ç¨³å®š ğŸ”“ # option check_signatureï¼šæ³¨é‡Šç­¾åæ£€æŸ¥ï¼ˆå¯é¿å…æŸäº›æºç­¾åé—®é¢˜ï¼‰ ğŸŒ äºŒã€å›½å†…é•œåƒæºé…ç½® 1. x86_64 æ¶æ„é…ç½® ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æºï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 # ä¸­ç§‘å¤§ x86_64 è½¯ä»¶æº cat \u0026gt; /etc/opkg/distfeeds.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; src/gz op_base https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/x86_64/base/ src/gz op_luci https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/x86_64/luci/ src/gz op_packages https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/x86_64/packages/ src/gz op_routing https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/x86_64/routing/ src/gz op_telephony https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/x86_64/telephony/ EOF æ¸…åå¤§å­¦æºï¼ˆå¤‡ç”¨ï¼‰ 1 2 3 4 5 6 7 8 # æ¸…åå¤§å­¦ x86_64 è½¯ä»¶æº cat \u0026gt; /etc/opkg/distfeeds.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; src/gz tuna_base https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/x86_64/base/ src/gz tuna_luci https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/x86_64/luci/ src/gz tuna_packages https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/x86_64/packages/ src/gz tuna_routing https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/x86_64/routing/ src/gz tuna_telephony https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/x86_64/telephony/ EOF 2. aarch64_cortex-a53 æ¶æ„é…ç½® ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æºï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 # ä¸­ç§‘å¤§ aarch64_cortex-a53 è½¯ä»¶æº cat \u0026gt; /etc/opkg/distfeeds.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; src/gz op_base https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/base/ src/gz op_luci https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/luci/ src/gz op_packages https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/packages/ src/gz op_routing https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/routing/ src/gz op_telephony https://mirrors.ustc.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/telephony/ EOF æ¸…åå¤§å­¦æºï¼ˆå¤‡ç”¨ï¼‰ 1 2 3 4 5 6 7 8 # æ¸…åå¤§å­¦ aarch64_cortex-a53 è½¯ä»¶æº cat \u0026gt; /etc/opkg/distfeeds.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; src/gz tuna_base https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/base/ src/gz tuna_luci https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/luci/ src/gz tuna_packages https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/packages/ src/gz tuna_routing https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/routing/ src/gz tuna_telephony https://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/23.05.3/packages/aarch64_cortex-a53/telephony/ EOF ğŸ¯ ä¸‰ã€ç¬¬ä¸‰æ–¹è½¯ä»¶æºé…ç½® 1. x86_64 æ¶æ„ç¬¬ä¸‰æ–¹æº 1 2 3 4 5 6 # x86_64 ç¬¬ä¸‰æ–¹è½¯ä»¶æº cat \u0026gt; /etc/opkg/customfeeds.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; src/gz dllkids https://op.dllkids.xyz/packages/x86_64/ src/gz kiddin9 https://dl.openwrt.ai/packages-23.05/x86_64/kiddin9/ src/gz lienol https://github.com/Lienol/openwrt-packages/trunk/x86_64/ EOF 2. aarch64_cortex-a53 æ¶æ„ç¬¬ä¸‰æ–¹æº 1 2 3 4 5 6 # aarch64_cortex-a53 ç¬¬ä¸‰æ–¹è½¯ä»¶æº cat \u0026gt; /etc/opkg/customfeeds.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; src/gz dllkids https://op.dllkids.xyz/packages/aarch64_cortex-a53/ src/gz kiddin9 https://dl.openwrt.ai/packages-23.05/aarch64_cortex-a53/kiddin9/ src/gz lienol https://github.com/Lienol/openwrt-packages/trunk/aarch64_cortex-a53/ EOF ğŸ”§ å››ã€é…ç½®éªŒè¯å’Œä¼˜åŒ– 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ 1 2 3 4 5 6 # æ¸…ç†æ—§ç¼“å­˜ rm -rf /var/opkg-lists/* # æ›´æ–°è½¯ä»¶æº opkg update # ğŸ”„ åº”è¯¥æ˜¾ç¤ºå„æºçš„æˆåŠŸæ›´æ–°ä¿¡æ¯ 2. æµ‹è¯•ä¸‹è½½é€Ÿåº¦ 1 2 3 # æµ‹è¯•è½¯ä»¶æºé€Ÿåº¦ time opkg install curl --download-only # âš¡ è§‚å¯Ÿä¸‹è½½é€Ÿåº¦æ˜¯å¦æ”¹å–„ 3. æŸ¥çœ‹å½“å‰é…ç½® 1 2 3 4 5 6 7 # æŸ¥çœ‹ç”Ÿæ•ˆçš„è½¯ä»¶æº opkg list-feeds # æŸ¥çœ‹è¯¦ç»†é…ç½® cat /etc/opkg.conf cat /etc/opkg/distfeeds.conf cat /etc/opkg/customfeeds.conf ğŸ› ï¸ äº”ã€æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 # å¦‚æœæŸä¸ªæºå¤±è´¥ï¼Œæš‚æ—¶ç¦ç”¨ sed -i \u0026#39;s/^src/# src/g\u0026#39; /etc/opkg/customfeeds.conf # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping -c 4 mirrors.ustc.edu.cn # æ¸…é™¤DNSç¼“å­˜ /etc/init.d/dnsmasq restart 2. å¤‡ä»½å’Œæ¢å¤ 1 2 3 4 5 6 7 # å¤‡ä»½å½“å‰é…ç½® cp /etc/opkg.conf /etc/opkg.conf.backup cp /etc/opkg/distfeeds.conf /etc/opkg/distfeeds.conf.backup # æ¢å¤å¤‡ä»½é…ç½® cp /etc/opkg.conf.backup /etc/opkg.conf cp /etc/opkg/distfeeds.conf.backup /etc/opkg/distfeeds.conf 3. æ‰‹åŠ¨æ·»åŠ å•ä¸ªæº 1 2 3 # ä¸´æ—¶æ·»åŠ å•ä¸ªè½¯ä»¶æº echo \u0026#34;src/gz test https://example.com/packages/\u0026#34; \u0026gt;\u0026gt; /etc/opkg/customfeeds.conf opkg update ğŸ’¡ å…­ã€é«˜çº§æŠ€å·§ 1. ä½¿ç”¨ä¼˜å…ˆçº§é…ç½® 1 2 3 4 5 6 7 8 # åˆ›å»ºä¼˜å…ˆçº§é…ç½®ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰ cat \u0026gt; /etc/opkg/priorities.conf \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; # å®˜æ–¹æºä¼˜å…ˆ package src/gz op_* 500 # ç¬¬ä¸‰æ–¹æºæ¬¡ä¹‹ package src/gz *_kids 100 package src/gz kiddin9 100 EOF 2. è‡ªåŠ¨åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 # åˆ›å»ºè‡ªåŠ¨æ›´æ–°è„šæœ¬ cat \u0026gt; /usr/bin/opkg-update-cn \u0026lt;\u0026lt; \u0026#34;EOF\u0026#34; #!/bin/sh echo \u0026#34;ğŸ”„ ä½¿ç”¨å›½å†…æºæ›´æ–°...\u0026#34; rm -rf /var/opkg-lists/* opkg update echo \u0026#34;âœ… æ›´æ–°å®Œæˆ\u0026#34; EOF chmod +x /usr/bin/opkg-update-cn 3. å®šæ—¶è‡ªåŠ¨æ›´æ–° 1 2 3 # æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ›´æ–°ï¼‰ echo \u0026#34;0 3 * * * opkg update\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root /etc/init.d/cron restart âš ï¸ ä¸ƒã€é‡è¦æ³¨æ„äº‹é¡¹ æ¶æ„åŒ¹é…ï¼šç¡®ä¿é€‰æ‹©çš„è½¯ä»¶æºä¸ä½ çš„è®¾å¤‡æ¶æ„å®Œå…¨åŒ¹é… ç‰ˆæœ¬å…¼å®¹ï¼š23.05.3 æ˜¯ç¤ºä¾‹ç‰ˆæœ¬ï¼Œè¯·æ ¹æ®å®é™…ç³»ç»Ÿç‰ˆæœ¬è°ƒæ•´ æºå¯é æ€§ï¼šç¬¬ä¸‰æ–¹æºå¯èƒ½ä¸ç¨³å®šï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨å®˜æ–¹é•œåƒæº å®‰å…¨è€ƒè™‘ï¼šè°¨æ…æ·»åŠ æœªçŸ¥ç¬¬ä¸‰æ–¹æºï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™© å¤‡ä»½é…ç½®ï¼šä¿®æ”¹å‰å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ ğŸ”„ å…«ã€éªŒè¯é…ç½®æ•ˆæœ 1. æµ‹è¯•å®‰è£…é€Ÿåº¦ 1 2 3 # æµ‹è¯•å¸¸ç”¨è½¯ä»¶åŒ…å®‰è£… time opkg install curl time opkg install luci-app-uhttpd 2. æ£€æŸ¥ä¾èµ–å…³ç³» 1 2 # æ£€æŸ¥è½¯ä»¶åŒ…ä¾èµ–è§£æ opkg install nano --no-install-recommends 3. ç›‘æ§ç½‘ç»œæµé‡ 1 2 # æŸ¥çœ‹ä¸‹è½½æµé‡ï¼ˆç¡®è®¤ä½¿ç”¨å›½å†…æºï¼‰ iftop -P -n -N -i br-lan ğŸ¯ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œä½ çš„ iStoreOS è½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦åº”è¯¥ä¼šæœ‰æ˜¾è‘—æå‡ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥éšæ—¶æ¢å¤å¤‡ä»½é…ç½®æˆ–å°è¯•ä¸åŒçš„é•œåƒæºã€‚\n","date":"2024-12-07T07:52:59+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/c25b8a24/","title":"iStoreOS opkg è½¯ä»¶æºé…ç½®æŒ‡å— ğŸ“¦"},{"content":"Docker éƒ¨ç½² Go-WebDAV æ–‡ä»¶å…±äº«æœåŠ¡ ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Go-WebDAV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Go-WebDAV 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªæ–‡ä»¶å…±äº«ï¼Œè¿æ¥æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ Go-WebDAV æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ WebDAV æœåŠ¡å™¨å®ç°ï¼ŒåŸºäº Go è¯­è¨€å¼€å‘ï¼Œå…·æœ‰é«˜æ€§èƒ½å’Œä½èµ„æºå ç”¨çš„ç‰¹ç‚¹ã€‚é€šè¿‡ Docker éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ­å»ºä¸ªäººæˆ–å›¢é˜Ÿçš„æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæ”¯æŒæ ‡å‡†çš„ WebDAV åè®®ï¼Œå…¼å®¹å„ç§å®¢æˆ·ç«¯ã€‚\nGitHub åœ°å€: https://github.com/117503445/GoWebDAV ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸŒ WebDAV åè®®æ”¯æŒ æ”¯æŒæ ‡å‡† WebDAV åè®® å…¼å®¹å„ç§å®¢æˆ·ç«¯ï¼Œå®ç°è·¨å¹³å°æ–‡ä»¶è®¿é—® âš¡ é«˜æ€§èƒ½ åŸºäº Go è¯­è¨€å¼€å‘ èµ„æºå ç”¨ä½ï¼Œå“åº”é€Ÿåº¦å¿«ï¼Œé€‚åˆèµ„æºå—é™ç¯å¢ƒ ğŸ”’ è®¤è¯å®‰å…¨ æ”¯æŒåŸºæœ¬è®¤è¯å’ŒåŒ¿åè®¿é—® çµæ´»çš„å®‰å…¨ç­–ç•¥ï¼Œä¿æŠ¤æ–‡ä»¶å®‰å…¨ ğŸ“ å¤šç›®å½•å…±äº« æ”¯æŒåŒæ—¶å…±äº«å¤šä¸ªç›®å½• å¯æŒ‰éœ€è®¾ç½®ä¸åŒç›®å½•çš„è®¿é—®æƒé™ ğŸ‘¥ æƒé™æ§åˆ¶ å¯è®¾ç½®åªè¯»æˆ–è¯»å†™æƒé™ ç²¾ç»†åŒ–çš„è®¿é—®æ§åˆ¶ï¼Œé˜²æ­¢è¯¯æ“ä½œ ğŸ–¥ï¸ Web ç•Œé¢ æä¾› Web æ–‡ä»¶ç®¡ç†ç•Œé¢ æ— éœ€å®¢æˆ·ç«¯å³å¯ç®¡ç†æ–‡ä»¶ï¼Œæ–¹ä¾¿å¿«æ· ğŸ”„ è·¨å¹³å° æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿ Windowsã€macOSã€Linux å…¨å¹³å°å…¼å®¹ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½² Docker éƒ¨ç½²ç®€å• ç¯å¢ƒéš”ç¦»æ€§å¥½ï¼Œéƒ¨ç½²å’Œç»´æŠ¤ä¾¿æ· ğŸ³ ä¸€ã€Docker éƒ¨ç½² Go-WebDAV 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mkdir -p /mnt/mydisk/home/go-webdav \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: go-webdav: container_name: go-webdav image: 117503445/go_webdav:latest restart: unless-stopped ports: - \u0026#34;8008:80\u0026#34; volumes: - /mnt:/data environment: - TZ=Asia/Shanghai - dav=/ARS2,/data/ARS2-NFS,admin,yifan0719,false;/Aliyun,/data/ARS2-NFS/é˜¿é‡Œäº‘ç›˜,null,null,false;/NAS,/data/ARS2-NFS/NAS,admin,yifan0719,true EOF ğŸ“ ç›®å½•æ˜ å°„è¯´æ˜: /mnt ç­‰äºå®¹å™¨å†…çš„ /data\nğŸ—‚ï¸ å…±äº«ç›®å½•é…ç½®æ ¼å¼: /ç½‘é¡µæ˜¾ç¤ºåç§°,/å®¹å™¨å†…è·¯å¾„,ç”¨æˆ·å,å¯†ç ,æ˜¯å¦åªè¯»\nğŸ” å®‰å…¨æç¤º: å»ºè®®ä½¿ç”¨å¼ºå¯†ç æ›¿ä»£é»˜è®¤å‡­è¯\n2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Go-WebDAV 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®: http://localhost:8008 åŸŸåè®¿é—®: https://webdav.example.com ï¼ˆé…ç½®åå‘ä»£ç†åï¼‰ 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤ ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€ æ ¹æ®éœ€è¦è®¿é—®ä¸åŒå…±äº«ç›®å½•ï¼š /ARS2: ç”¨æˆ·å admin, å¯†ç  yifan0719 (è¯»å†™æƒé™) /Aliyun: æ— éœ€è®¤è¯ (è¯»å†™æƒé™) /NAS: ç”¨æˆ·å admin, å¯†ç  yifan0719 (åªè¯»æƒé™) ä½¿ç”¨ Web ç•Œé¢ç®¡ç†æ–‡ä»¶æˆ–é…ç½®å®¢æˆ·ç«¯è¿æ¥ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://webdav.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/go-webdav.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; server_name webdav.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384; ssl_prefer_server_ciphers off; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 0; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34; always; location / { proxy_pass http://127.0.0.1:8008; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; # å¢åŠ è¶…æ—¶æ—¶é—´ proxy_read_timeout 3600s; proxy_send_timeout 3600s; proxy_connect_timeout 300s; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /mnt/mydisk/home/go-webdav # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop go-webdav # åœæ­¢å®¹å™¨ docker start go-webdav # å¯åŠ¨å®¹å™¨ docker restart go-webdav # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm go-webdav # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f go-webdav # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it go-webdav sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it go-webdav bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it go-webdav sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec go-webdav ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect go-webdav # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats go-webdav # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs go-webdav # æŸ¥çœ‹æ—¥å¿— docker logs -f go-webdav # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 go-webdav # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t go-webdav # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆªæ–‡ä»¶å…±äº«ï¼Œè¿æ¥æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Go-WebDAV æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ éšæ—¶éšåœ° è®¿é—®å’Œç®¡ç†ä½ çš„æ–‡ä»¶ï¼Œæ— è®ºæ˜¯åœ¨å®¶ä¸­ã€åŠå…¬å®¤è¿˜æ˜¯æ—…é€”ä¸­\nğŸ” å®‰å…¨å…±äº« é€šè¿‡ç²¾ç»†çš„æƒé™æ§åˆ¶ï¼Œå®‰å…¨åœ°ä¸å›¢é˜Ÿæˆå‘˜æˆ–å®¢æˆ·å…±äº«æ–‡ä»¶\nğŸ“± å¤šç«¯ååŒ æ”¯æŒå„ç§ WebDAV å®¢æˆ·ç«¯ï¼Œå®ç°è·¨è®¾å¤‡ã€è·¨å¹³å°çš„æ–‡ä»¶åŒæ­¥ä¸åä½œ\nâš¡ é«˜æ•ˆç¨³å®š äº«å—è½»é‡çº§æ¶æ„å¸¦æ¥çš„å¿«é€Ÿå“åº”å’Œç¨³å®šæœåŠ¡ä½“éªŒ\næ–‡ä»¶æ˜¯æ•°å­—æ—¶ä»£çš„è®°å¿†è½½ä½“ï¼Œé«˜æ•ˆçš„æ–‡ä»¶ç®¡ç†æ˜¯ç°ä»£å·¥ä½œå’Œç”Ÿæ´»çš„åŸºç¡€ã€‚æ„¿ Go-WebDAV æˆä¸ºä½ å¯é çš„æ•°å­—æ–‡ä»¶ç®¡å®¶ï¼Œé™ªä¼´ä½ æ•´ç†æ¯ä¸€ä¸ªé‡è¦æ–‡æ¡£ï¼Œåˆ†äº«æ¯ä¸€ä»½çè´µèµ„æ–™ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œè½»æ¾ç®¡ç†ï¼Œé«˜æ•ˆå…±äº«â€”â€”æ„å»ºä½ æ— ç¼è¿æ¥çš„æ•°å­—æ–‡ä»¶ç©ºé—´å§ï¼ğŸš€\nğŸ“Œ æŒç»­ç»´æŠ¤ï¼šå»ºè®®å®šæœŸæ›´æ–° Docker é•œåƒä»¥è·å–å®‰å…¨è¡¥ä¸å’Œæ–°åŠŸèƒ½\nğŸ› åé¦ˆä¸å»ºè®®ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–éœ€æ±‚ï¼Œå¯å‰å¾€ GitHub Issues æå‡º\nç¥ä½ æ–‡ä»¶ç®¡ç†å¾—å¿ƒåº”æ‰‹ï¼Œåä½œæ— é—´ï¼ğŸ‰\n","date":"2024-12-07T07:51:56+08:00","image":"https://file.meimolihan.eu.org/img/docker-webdav-01.webp","permalink":"https://blog.meimolihan.eu.org/p/9c03152d/","title":"Docker éƒ¨ç½² Go-WebDAV æ–‡ä»¶å…±äº«æœåŠ¡ ğŸ³"},{"content":"iStoreOS é•œåƒä¸‹è½½ä¸æ‰©å®¹æŒ‡å— ğŸš€ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸‹è½½ iStoreOS é•œåƒå¹¶å¯¹å…¶è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œç¡®ä¿ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´è¿è¡Œå„ç§åº”ç”¨å’ŒæœåŠ¡ã€‚\nğŸ“Œ å¯¼èˆªç›®å½•\nğŸŒ ä¸€ã€é•œåƒä¸‹è½½ ğŸ”§ äºŒã€å‡†å¤‡å·¥ä½œ ğŸ—œï¸ ä¸‰ã€é•œåƒè§£å‹ä¸æ‰©å®¹ ğŸ“¦ å››ã€é‡æ–°å‹ç¼©é•œåƒ ğŸ› ï¸ äº”ã€åç»­æ“ä½œå»ºè®® âš ï¸ å…­ã€é‡è¦æ³¨æ„äº‹é¡¹ ğŸ’¡ ä¸ƒã€æ‰©å®¹åŸç†è¯´æ˜ ğŸŒ ä¸€ã€é•œåƒä¸‹è½½ å®˜æ–¹ä¸‹è½½åœ°å€ iStoreOS é•œåƒä¸‹è½½ç½‘å€ï¼šhttps://fw.koolcenter.com/iStoreOS\n1. ä¸‹è½½é•œåƒæ–‡ä»¶ 1 2 3 # ä¸‹è½½é•œåƒåˆ°æŒ‡å®šç›®å½•å¹¶é‡å‘½åä¸º op.img.gz wget -O /mnt/mydisk/backup/op.img.gz https://fw0.koolcenter.com/iStoreOS/x86_64/istoreos-22.03.6-2024041213-x86-64-squashfs-combined.img.gz # â¬‡ï¸ ä¸‹è½½æœ€æ–°ç‰ˆ iStoreOS é•œåƒåˆ°å¤‡ä»½ç›®å½• 2. é‡å‘½åé•œåƒæ–‡ä»¶ï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰ 1 2 3 # å¦‚æœå·²ä¸‹è½½ä½†åç§°ä¸å¯¹ï¼Œä½¿ç”¨æ­¤å‘½ä»¤é‡å‘½å mv *.img.gz op.img.gz # ğŸ”„ å°†æ‰€æœ‰ .img.gz æ–‡ä»¶é‡å‘½åä¸º op.img.gz ğŸ”§ äºŒã€å‡†å¤‡å·¥ä½œ 1. å®‰è£…å¿…è¦çš„å·¥å…· 1 2 3 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… dd å·¥å…· opkg update \u0026amp;\u0026amp; opkg install coreutils-dd # ğŸ“¦ ç¡®ä¿ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„å·¥å…·è¿›è¡Œé•œåƒæ“ä½œ 2. è¿›å…¥å·¥ä½œç›®å½• 1 2 3 # åˆ‡æ¢åˆ°å¤‡ä»½ç›®å½•å¹¶æŸ¥çœ‹å†…å®¹ cd /mnt/mydisk/backup \u0026amp;\u0026amp; ls -la # ğŸ“‚ ç¡®è®¤é•œåƒæ–‡ä»¶å·²æ­£ç¡®ä¸‹è½½ ğŸ—œï¸ ä¸‰ã€é•œåƒè§£å‹ä¸æ‰©å®¹ 1. è§£å‹ GZ å‹ç¼©åŒ… 1 2 3 # è§£å‹é•œåƒæ–‡ä»¶ï¼Œä¿ç•™åŸå‹ç¼©åŒ… gzip -kd op.img.gz # ğŸ“¤ è§£å‹åå¾—åˆ° op.img åŸå§‹é•œåƒæ–‡ä»¶ 2. æ‰©å±•é•œåƒå¤§å° 1 2 3 # å‘é•œåƒæ–‡ä»¶æœ«å°¾è¿½åŠ  2GB çš„ç©ºæ•°æ® dd if=/dev/zero bs=1M count=2048 \u0026gt;\u0026gt; op.img status=progress # ğŸ“ˆ å¢åŠ é•œåƒå®¹é‡ï¼ˆ2GBï¼‰ï¼Œæ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ 3. ä½¿ç”¨ parted è°ƒæ•´åˆ†åŒº 1 2 # å¯åŠ¨ parted åˆ†åŒºå·¥å…·å¤„ç†é•œåƒ parted op.img åœ¨ parted äº¤äº’ç•Œé¢ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å½“å‰åˆ†åŒºä¿¡æ¯ print # å¯èƒ½éœ€è¦å…ˆä¿®å¤åˆ†åŒºè¡¨ï¼ˆå¦‚æœéœ€è¦ï¼‰ fix # å°†åˆ†åŒº2æ‰©å±•åˆ°100%å¯ç”¨ç©ºé—´ resizepart 2 100% # å†æ¬¡æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ç¡®è®¤æ›´æ”¹ print # é€€å‡º parted quit ğŸ“¦ å››ã€é‡æ–°å‹ç¼©é•œåƒ 1. å‹ç¼©æ‰©å®¹åçš„é•œåƒ 1 2 3 # å°†æ‰©å®¹åçš„é•œåƒé‡æ–°å‹ç¼©ä¸º.gzæ ¼å¼ gzip -k op.img # ğŸ—œï¸ åˆ›å»ºå‹ç¼©å‰¯æœ¬ï¼Œä¿ç•™åŸå§‹op.imgæ–‡ä»¶ ğŸ› ï¸ äº”ã€åç»­æ“ä½œå»ºè®® 1. éªŒè¯é•œåƒå®Œæ•´æ€§ 1 2 3 4 5 # æ£€æŸ¥é•œåƒæ–‡ä»¶å¤§å° ls -lh op.img* # éªŒè¯å‹ç¼©æ–‡ä»¶å®Œæ•´æ€§ gzip -t op.img.gz 2. éƒ¨ç½²æ‰©å®¹åçš„é•œåƒ 1 2 # å°†é•œåƒå†™å…¥Uç›˜æˆ–ç¡¬ç›˜ï¼ˆç¤ºä¾‹å‘½ä»¤ï¼Œè°¨æ…ä½¿ç”¨ï¼‰ # dd if=op.img of=/dev/sdX bs=4M status=progress 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ 1 2 # å¦‚éœ€èŠ‚çœç©ºé—´ï¼Œå¯åˆ é™¤æœªå‹ç¼©çš„é•œåƒæ–‡ä»¶ rm op.img âš ï¸ å…­ã€é‡è¦æ³¨æ„äº‹é¡¹ å¤‡ä»½é‡è¦æ•°æ®ï¼šæ“ä½œå‰è¯·å¤‡ä»½æ‰€æœ‰é‡è¦æ•°æ® ç¡®è®¤ç›®å½•æƒé™ï¼šç¡®ä¿æœ‰æƒé™è®¿é—® /mnt/mydisk/backup ç›®å½• å­˜å‚¨ç©ºé—´å……è¶³ï¼šç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾è§£å‹åçš„é•œåƒæ–‡ä»¶ è°¨æ…ä½¿ç”¨ ddï¼šdd å‘½ä»¤éå¸¸å¼ºå¤§ï¼Œé”™è¯¯ä½¿ç”¨å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤± åˆ†åŒºè°ƒæ•´é£é™©ï¼šè°ƒæ•´åˆ†åŒºå¤§å°æœ‰é£é™©ï¼Œå»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­å…ˆç»ƒä¹  ğŸ’¡ ä¸ƒã€æ‰©å®¹åŸç†è¯´æ˜ è¿½åŠ ç©ºæ•°æ®ï¼šä½¿ç”¨ dd å‘½ä»¤å‘é•œåƒæ–‡ä»¶æœ«å°¾æ·»åŠ ç©ºç™½æ•°æ® è°ƒæ•´åˆ†åŒºè¡¨ï¼šä½¿ç”¨ parted å·¥å…·æ‰©å±•åˆ†åŒºä»¥ä½¿ç”¨æ–°å¢çš„ç©ºé—´ æ–‡ä»¶ç³»ç»Ÿè°ƒæ•´ï¼šå¯åŠ¨åå¯èƒ½éœ€è¦ä½¿ç”¨ resize2fs æˆ–å…¶ä»–å·¥å…·è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å° ğŸ¯ å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªæ‰©å®¹åçš„ iStoreOS é•œåƒï¼Œå¯ä»¥æ”¯æŒæ›´å¤šåº”ç”¨å’ŒæœåŠ¡çš„å®‰è£…ï¼\nâœ¨ æ‰©å±•åŠŸèƒ½ï¼š\nğŸ³ å®¹å™¨æ”¯æŒï¼šæ‰©å®¹åå¯è¿è¡Œæ›´å¤š Docker å®¹å™¨ ğŸ“¦ åº”ç”¨å®‰è£…ï¼šå®‰è£…æ›´å¤š iStoreOS åº”ç”¨å•†åº—ä¸­çš„è½¯ä»¶ ğŸ’¾ æ•°æ®å­˜å‚¨ï¼šä¸ºæœ¬åœ°æ•°æ®æä¾›æ›´å¤šå­˜å‚¨ç©ºé—´ ğŸ”„ ç³»ç»Ÿæ›´æ–°ï¼šç¡®ä¿ç³»ç»Ÿæ›´æ–°æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œ ğŸ›¡ï¸ å®‰å…¨å»ºè®®ï¼š\nå®šæœŸæ£€æŸ¥é•œåƒå®Œæ•´æ€§ ä¿ç•™åŸå§‹é•œåƒå¤‡ä»½ åœ¨éç”Ÿäº§ç¯å¢ƒä¸­æµ‹è¯•æ‰©å®¹åçš„é•œåƒ ğŸ“š å­¦ä¹ èµ„æºï¼š\niStoreOS å®˜æ–¹æ–‡æ¡£ï¼šhttps://doc.linkease.com/ Linux åˆ†åŒºç®¡ç†æŒ‡å—ï¼šhttps://wiki.archlinux.org/title/Partitioning dd å‘½ä»¤è¯¦ç»†ç”¨æ³•ï¼šhttps://man7.org/linux/man-pages/man1/dd.1.html å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©å®Œæˆ iStoreOS é•œåƒçš„ä¸‹è½½ä¸æ‰©å®¹æ“ä½œï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚ğŸš€\n","date":"2024-12-07T07:51:01+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/262ce806/","title":"iStoreOS é•œåƒä¸‹è½½ä¸æ‰©å®¹æŒ‡å— ğŸš€"},{"content":"iStoreOS å¼€æœºè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤é…ç½® âš¡ ğŸš€ è½»æ¾å®ç°ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½NFSå…±äº«ï¼Œå…³æœºæ—¶è‡ªåŠ¨å¸è½½\nğŸ“– ç›®å½•å¯¼èˆª ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹ ğŸ“ åˆ›å»ºå¯åŠ¨è„šæœ¬ âš™ï¸ è„šæœ¬é…ç½®è¯¦è§£ ğŸ”§ å¯ç”¨è‡ªå¯åŠ¨æœåŠ¡ ğŸ§ª æµ‹è¯•ä¸éªŒè¯ ğŸ› æ•…éšœæ’é™¤ ğŸ’¡ é«˜çº§æŠ€å·§ ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹ æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨iStoreOSï¼ˆåŸºäºOpenWrtï¼‰ä¸­é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½NFSå…±äº«çš„åŠŸèƒ½ï¼š\nâœ… å¼€æœºè‡ªåŠ¨æŒ‚è½½: ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½è¿œç¨‹NFSå…±äº« âœ… å…³æœºè‡ªåŠ¨å¸è½½: ç³»ç»Ÿå…³é—­æ—¶å®‰å…¨å¸è½½NFSå…±äº«ï¼Œé¿å…æ•°æ®æŸå âœ… æŒä¹…åŒ–é…ç½®: é‡å¯åé…ç½®ä¾ç„¶æœ‰æ•ˆï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ âœ… çŠ¶æ€æ£€æµ‹: è‡ªåŠ¨æ£€æµ‹NFSæœåŠ¡å™¨å¯ç”¨æ€§ï¼Œæ™ºèƒ½å¤„ç†è¿æ¥é—®é¢˜ âœ… æ—¥å¿—è®°å½•: å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ âœ… çµæ´»é…ç½®: æ”¯æŒå¤šä¸ªNFSå…±äº«å’Œè‡ªå®šä¹‰æŒ‚è½½é€‰é¡¹ ğŸ“ åˆ›å»ºå¯åŠ¨è„šæœ¬ 1. åˆ›å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶è®¾ç½®å¯åŠ¨è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 # åˆ›å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶ touch /etc/init.d/mynfsmount # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x /etc/init.d/mynfsmount # éªŒè¯æ–‡ä»¶åˆ›å»ºæˆåŠŸ ls -la /etc/init.d/mynfsmount 2. æŸ¥çœ‹ç°æœ‰å¯åŠ¨è„šæœ¬ 1 2 3 4 5 # æŸ¥çœ‹/etc/init.dç›®å½•ä¸‹çš„æ‰€æœ‰å¯åŠ¨è„šæœ¬ ls -la /etc/init.d/ # æŸ¥çœ‹è„šæœ¬æƒé™ç¡®è®¤è®¾ç½®æ­£ç¡® ls -la /etc/init.d/mynfsmount âš™ï¸ è„šæœ¬é…ç½®è¯¦è§£ ç¼–è¾‘å¯åŠ¨è„šæœ¬å†…å®¹ 1 2 # ä½¿ç”¨viç¼–è¾‘å™¨ç¼–è¾‘è„šæœ¬ vi /etc/init.d/mynfsmount è„šæœ¬å†…å®¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 #!/bin/sh /etc/rc.common # OpenWrtåˆå§‹åŒ–è„šæœ¬æ ‡å‡†å¼€å¤´ START=99 STOP=15 # å¯åŠ¨ä¼˜å…ˆçº§ï¼šæ•°å­—è¶Šå¤§è¶Šæ™šå¯åŠ¨ï¼Œæ•°å­—è¶Šå°è¶Šæ™šåœæ­¢ USE_PROCD=1 # ä½¿ç”¨procdè¿›ç¨‹ç®¡ç†ï¼ˆOpenWrtæ¨èæ–¹å¼ï¼‰ start_service() { echo \u0026#34;ğŸ”„ å¼€å§‹æŒ‚è½½NFSå…±äº«...\u0026#34; # åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ mkdir -p /mnt/nfs # æ£€æŸ¥NFSæœåŠ¡å™¨æ˜¯å¦å¯è®¿é—® if ping -c 1 -W 2 10.10.10.251 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ… NFSæœåŠ¡å™¨å¯è¾¾ï¼Œå¼€å§‹æŒ‚è½½...\u0026#34; # æŒ‚è½½NFSå…±äº«ï¼ˆæ¨èä½¿ç”¨NFSv3æˆ–v4æŒ‡å®šç‰ˆæœ¬ï¼‰ mount -t nfs -o vers=3,nolock 10.10.10.251:/mnt/sata1-1 /mnt/nfs # æ£€æŸ¥æŒ‚è½½æ˜¯å¦æˆåŠŸ if mountpoint -q /mnt/nfs; then echo \u0026#34;âœ… NFSæŒ‚è½½æˆåŠŸ: /mnt/nfs\u0026#34; echo \u0026#34;ğŸ“ å…±äº«å†…å®¹é¢„è§ˆ:\u0026#34; ls -la /mnt/nfs/ | head -5 else echo \u0026#34;âŒ NFSæŒ‚è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™å’Œç½‘ç»œè¿æ¥\u0026#34; logger -t mynfsmount \u0026#34;NFS mount failed\u0026#34; fi else echo \u0026#34;âŒ NFSæœåŠ¡å™¨ä¸å¯è¾¾: 10.10.10.251\u0026#34; logger -t mynfsmount \u0026#34;NFS server unreachable\u0026#34; fi } stop_service() { echo \u0026#34;ğŸ”„ å¼€å§‹å¸è½½NFSå…±äº«...\u0026#34; # æ£€æŸ¥æ˜¯å¦å·²æŒ‚è½½ if mountpoint -q /mnt/nfs; then # å°è¯•æ­£å¸¸å¸è½½ï¼Œå¤±è´¥æ—¶ä½¿ç”¨å¼ºåˆ¶å¸è½½ if ! umount /mnt/nfs 2\u0026gt;/dev/null; then echo \u0026#34;âš ï¸ æ­£å¸¸å¸è½½å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶å¸è½½...\u0026#34; umount -f /mnt/nfs fi echo \u0026#34;âœ… NFSå¸è½½å®Œæˆ\u0026#34; logger -t mynfsmount \u0026#34;NFS unmounted successfully\u0026#34; else echo \u0026#34;â„¹ï¸ NFSæœªæŒ‚è½½ï¼Œæ— éœ€å¸è½½\u0026#34; fi } # é‡å¯å‘½ä»¤ï¼ˆå¯é€‰ï¼‰ restart() { stop_service sleep 2 start_service } ğŸ”§ è„šæœ¬å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ å»ºè®®å€¼ START=99 å¯åŠ¨ä¼˜å…ˆçº§ 99ï¼ˆæœ€åå¯åŠ¨ï¼‰ STOP=15 åœæ­¢ä¼˜å…ˆçº§ 15ï¼ˆè¾ƒæ—©åœæ­¢ï¼‰ USE_PROCD=1 ä½¿ç”¨procdè¿›ç¨‹ç®¡ç† 1ï¼ˆå¯ç”¨ï¼‰ mount -t nfs NFSæŒ‚è½½å‘½ä»¤ æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ -o vers=3,nolock NFSç‰ˆæœ¬å’Œé€‰é¡¹ æ¨èæŒ‡å®šç‰ˆæœ¬ ğŸ”§ å¯ç”¨è‡ªå¯åŠ¨æœåŠ¡ å¯ç”¨å¼€æœºè‡ªå¯åŠ¨ 1 2 3 4 5 6 7 8 9 # å¯ç”¨è‡ªå¯åŠ¨æœåŠ¡ /etc/init.d/mynfsmount enable # æ£€æŸ¥æ˜¯å¦å¯ç”¨æˆåŠŸ ls -la /etc/rc.d/ | grep mynfsmount # é¢„æœŸè¾“å‡ºç¤ºä¾‹ï¼š # S99mynfsmount -\u0026gt; ../init.d/mynfsmount # K15mynfsmount -\u0026gt; ../init.d/mynfsmount æœåŠ¡ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ /etc/init.d/mynfsmount start # æ‰‹åŠ¨åœæ­¢æœåŠ¡ /etc/init.d/mynfsmount stop # é‡å¯æœåŠ¡ /etc/init.d/mynfsmount restart # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ /etc/init.d/mynfsmount status # ç¦ç”¨è‡ªå¯åŠ¨ï¼ˆéœ€è¦æ—¶ï¼‰ /etc/init.d/mynfsmount disable ğŸ§ª æµ‹è¯•ä¸éªŒè¯ ç«‹å³æµ‹è¯•è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # é¦–å…ˆåœæ­¢æœåŠ¡ï¼ˆå¦‚æœå·²è¿è¡Œï¼‰ /etc/init.d/mynfsmount stop # å¯åŠ¨æœåŠ¡æµ‹è¯• /etc/init.d/mynfsmount start # æ£€æŸ¥æŒ‚è½½ç»“æœ df -h | grep nfs mount | grep nfs # æŸ¥çœ‹æŒ‚è½½ç‚¹å†…å®¹ ls -la /mnt/nfs/ # æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— logread | tail -20 éªŒè¯è‡ªå¯åŠ¨åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 # é‡å¯ç³»ç»Ÿæµ‹è¯• reboot # é‡å¯åæ£€æŸ¥æŒ‚è½½ df -h | grep nfs cat /proc/mounts | grep nfs # æ£€æŸ¥å¯åŠ¨æ—¥å¿— logread | grep mynfsmount logread | grep nfs # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ /etc/init.d/mynfsmount status ç³»ç»Ÿæ—¥å¿—ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 # å®æ—¶æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— logread -f # è¿‡æ»¤NFSç›¸å…³æ—¥å¿— logread | grep -i nfs # æŸ¥çœ‹è„šæœ¬æ‰§è¡Œæ—¥å¿— logread | grep mynfsmount # æŸ¥çœ‹è¯¦ç»†æŒ‚è½½ä¿¡æ¯ dmesg | grep nfs ğŸ› æ•…éšœæ’é™¤ å¸¸è§é—®é¢˜è§£å†³ âŒ NFSæœåŠ¡å™¨ä¸å¯è¾¾\n1 2 3 4 5 6 7 8 # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping -c 3 10.10.10.251 # æ£€æŸ¥NFSæœåŠ¡ç«¯å£ nc -zv 10.10.10.251 2049 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® iptables -L -n | grep 2049 âŒ æŒ‚è½½æƒé™é”™è¯¯\n1 2 3 4 5 6 7 8 # æ£€æŸ¥NFSå¯¼å‡ºæƒé™ showmount -e 10.10.10.251 # å°è¯•ä½¿ç”¨ä¸åŒæŒ‚è½½é€‰é¡¹ mount -t nfs -o vers=3,ro 10.10.10.251:/mnt/sata1-1 /mnt/nfs # æ£€æŸ¥å®¢æˆ·ç«¯NFSæ”¯æŒ cat /proc/filesystems | grep nfs âŒ æŒ‚è½½ç‚¹å¿™æ— æ³•å¸è½½\n1 2 3 4 5 6 # æŸ¥æ‰¾ä½¿ç”¨æŒ‚è½½ç‚¹çš„è¿›ç¨‹ lsof /mnt/nfs fuser -m /mnt/nfs # å¼ºåˆ¶å¸è½½ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ umount -l /mnt/nfs # å»¶è¿Ÿå¸è½½ è°ƒè¯•è„šæœ¬ 1 2 3 4 5 6 7 8 # å¯ç”¨è¯¦ç»†è°ƒè¯•æ¨¡å¼ sh -x /etc/init.d/mynfsmount start # æ£€æŸ¥è„šæœ¬è¯­æ³• sh -n /etc/init.d/mynfsmount # æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¥å¿— logread | grep \u0026#34;mynfsmount\u0026#34; NFSè¿æ¥æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ£€æŸ¥NFSæœåŠ¡å™¨å¯¼å‡ºåˆ—è¡¨ showmount -e 10.10.10.251 # æ‰‹åŠ¨æµ‹è¯•æŒ‚è½½ mkdir -p /tmp/test_nfs mount -t nfs -o vers=3 10.10.10.251:/mnt/sata1-1 /tmp/test_nfs # æµ‹è¯•è¯»å†™æƒé™ touch /tmp/test_nfs/test_file echo \u0026#34;test\u0026#34; \u0026gt; /tmp/test_nfs/test_file cat /tmp/test_nfs/test_file # å¸è½½æµ‹è¯•ç›®å½• umount /tmp/test_nfs rmdir /tmp/test_nfs ğŸ’¡ é«˜çº§æŠ€å·§ å¤šä¸ªNFSå…±äº«æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åœ¨è„šæœ¬ä¸­æ·»åŠ å¤šä¸ªæŒ‚è½½ç‚¹ start_service() { # åˆ›å»ºå¤šä¸ªæŒ‚è½½ç‚¹ mkdir -p /mnt/nfs/{data,backup,media} # æŒ‚è½½å¤šä¸ªNFSå…±äº« mount -t nfs -o vers=3 10.10.10.251:/data /mnt/nfs/data mount -t nfs -o vers=3 10.10.10.251:/backup /mnt/nfs/backup mount -t nfs -o vers=3 10.10.10.252:/media /mnt/nfs/media } stop_service() { # å¸è½½æ‰€æœ‰NFSå…±äº« umount -f /mnt/nfs/data 2\u0026gt;/dev/null umount -f /mnt/nfs/backup 2\u0026gt;/dev/null umount -f /mnt/nfs/media 2\u0026gt;/dev/null } ä¼˜åŒ–æŒ‚è½½é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨ä¼˜åŒ–çš„æŒ‚è½½é€‰é¡¹ mount -t nfs -o \\ vers=3,\\ rw,\\ hard,\\ timeo=600,\\ retrans=2,\\ nolock,\\ noacl,\\ async \\ 10.10.10.251:/mnt/sata1-1 /mnt/nfs å¸¸ç”¨æŒ‚è½½é€‰é¡¹è¯´æ˜:\nvers=3: æŒ‡å®šNFSv3åè®®ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰ rw/ro: è¯»å†™/åªè¯»æ¨¡å¼ hard/soft: ç¡¬æŒ‚è½½/è½¯æŒ‚è½½ï¼ˆç¡¬æŒ‚è½½æ›´å¯é ï¼‰ timeo=n: è¶…æ—¶æ—¶é—´ï¼ˆååˆ†ä¹‹ä¸€ç§’ï¼‰ retrans=n: é‡è¯•æ¬¡æ•° nolock: ç¦ç”¨æ–‡ä»¶é”ï¼ˆæé«˜æ€§èƒ½ï¼‰ noacl: ç¦ç”¨ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ async: å¼‚æ­¥å†™å…¥ï¼ˆæ€§èƒ½æ›´å¥½ä½†é£é™©ç•¥é«˜ï¼‰ å¼€æœºå»¶è¿ŸæŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åœ¨å¯åŠ¨è„šæœ¬ä¸­æ·»åŠ ç½‘ç»œæ£€æµ‹å»¶è¿Ÿ start_service() { # ç­‰å¾…ç½‘ç»œæ¥å£å°±ç»ª while ! ping -c 1 -W 1 8.8.8.8 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; do echo \u0026#34;â³ ç­‰å¾…ç½‘ç»œè¿æ¥...\u0026#34; sleep 2 done # ç­‰å¾…NFSæœåŠ¡å°±ç»ª local retry_count=0 while ! ping -c 1 -W 1 10.10.10.251 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; do retry_count=$((retry_count+1)) if [ $retry_count -ge 10 ]; then echo \u0026#34;âŒ NFSæœåŠ¡å™¨è¿æ¥è¶…æ—¶\u0026#34; return 1 fi echo \u0026#34;â³ ç­‰å¾…NFSæœåŠ¡å™¨å“åº”... ($retry_count/10)\u0026#34; sleep 3 done # æ‰§è¡ŒæŒ‚è½½ mount -t nfs 10.10.10.251:/mnt/sata1-1 /mnt/nfs } çŠ¶æ€æ£€æŸ¥ä¸ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # åˆ›å»ºçŠ¶æ€æ£€æŸ¥è„šæœ¬ cat \u0026gt; /usr/bin/check_nfs_status \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh # æ£€æŸ¥NFSæŒ‚è½½çŠ¶æ€ if mountpoint -q /mnt/nfs; then echo \u0026#34;âœ… NFSæŒ‚è½½æ­£å¸¸\u0026#34; # æ£€æŸ¥è¯»å†™æƒé™ if touch /mnt/nfs/.test_write 2\u0026gt;/dev/null; then rm -f /mnt/nfs/.test_write echo \u0026#34;âœ… è¯»å†™æƒé™æ­£å¸¸\u0026#34; else echo \u0026#34;âš ï¸ å†™æƒé™å—é™\u0026#34; fi else echo \u0026#34;âŒ NFSæœªæŒ‚è½½\u0026#34; # å°è¯•é‡æ–°æŒ‚è½½ /etc/init.d/mynfsmount start fi EOF chmod +x /usr/bin/check_nfs_status # æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼‰ echo \u0026#34;0 * * * * /usr/bin/check_nfs_status\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root /etc/init.d/cron restart å¤‡ä»½ä¸æ¢å¤é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # å¤‡ä»½å¯åŠ¨è„šæœ¬å’Œé…ç½® BACKUP_DIR=\u0026#34;/root/nfs_mount_backup\u0026#34; mkdir -p $BACKUP_DIR cp /etc/init.d/mynfsmount $BACKUP_DIR/ cp /etc/rc.d/S*mynfsmount $BACKUP_DIR/ 2\u0026gt;/dev/null || true ls -la $BACKUP_DIR/ # æ¢å¤é…ç½® cp $BACKUP_DIR/mynfsmount /etc/init.d/ chmod +x /etc/init.d/mynfsmount /etc/init.d/mynfsmount enable ğŸ’¡ ä¸“ä¸šæç¤º:\nå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰å……åˆ†æµ‹è¯•è„šæœ¬åŠŸèƒ½ ä½¿ç”¨ mount -t nfs -o vers=3 æŒ‡å®šNFSç‰ˆæœ¬æé«˜å…¼å®¹æ€§ å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ç¡®ä¿æŒ‚è½½æ­£å¸¸è¿ä½œ è€ƒè™‘æ·»åŠ ç›‘æ§è„šæœ¬å®šæœŸæ£€æŸ¥NFSè¿æ¥çŠ¶æ€ é‡è¦æ•°æ®å»ºè®®ä½¿ç”¨ç¡¬æŒ‚è½½(hard)æ¨¡å¼ç¡®ä¿æ•°æ®å®Œæ•´æ€§ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨iStoreOSä¸­æˆåŠŸé…ç½®NFSå…±äº«çš„è‡ªåŠ¨æŒ‚è½½åŠŸèƒ½ã€‚å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯ã€‚ğŸ‰\n","date":"2024-12-07T07:49:50+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/cea7c2a0/","title":"iStoreOS å¼€æœºè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤é…ç½® âš¡"},{"content":"ESXi Ubuntu VMware Tools å®‰è£…ä¸å¸è½½æŒ‡å— ğŸ–¥ï¸ ğŸ“Œ å¯¼èˆªç›®å½•\nğŸ“¦ ä¸€ã€å®‰è£… open-vm-tools-desktop ğŸ—‘ï¸ äºŒã€å¸è½½ open-vm-tools-desktop ğŸ” ä¸‰ã€éªŒè¯å®‰è£…çŠ¶æ€ âš ï¸ å››ã€æ³¨æ„äº‹é¡¹ ğŸ’¡ äº”ã€å¸¸è§é—®é¢˜è§£å†³ ğŸ“¦ ä¸€ã€å®‰è£… open-vm-tools-desktop 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ 1 2 sudo apt update # ğŸ”„ åˆ·æ–°è½¯ä»¶åŒ…ä¿¡æ¯ï¼Œç¡®ä¿è·å–æœ€æ–°ç‰ˆæœ¬ 2. å®‰è£… open-vm-tools-desktop 1 2 sudo apt install open-vm-tools-desktop # ğŸ“¦ å®‰è£…VMwareè™šæ‹ŸåŒ–å¹³å°é›†æˆå·¥å…· 3. é‡å¯Ubuntuè™šæ‹Ÿæœº 1 2 sudo reboot # ğŸ” é‡å¯ç³»ç»Ÿä½¿æ›´æ”¹ç”Ÿæ•ˆ âœ¨ å®‰è£…å®Œæˆåæä¾›çš„åŠŸèƒ½ï¼š\nğŸ–±ï¸ æ›´å¥½çš„é¼ æ ‡é›†æˆå’Œæ”¯æŒ ğŸ–¥ï¸ è‡ªåŠ¨è°ƒæ•´å±å¹•åˆ†è¾¨ç‡ ğŸ“ å…±äº«æ–‡ä»¶å¤¹åŠŸèƒ½ ğŸ“‹ å‰ªè´´æ¿å…±äº« â° æ—¶é—´åŒæ­¥ ğŸ—‘ï¸ äºŒã€å¸è½½ open-vm-tools-desktop 1. åœæ­¢ open-vm-tools æœåŠ¡ 1 2 sudo systemctl stop open-vm-tools # ğŸ›‘ åœæ­¢VMwareå·¥å…·æœåŠ¡ 2. å¸è½½è½¯ä»¶åŒ…åŠé…ç½®æ–‡ä»¶ 1 2 sudo apt remove --purge open-vm-tools-desktop # ğŸ—‘ï¸ å½»åº•ç§»é™¤è½¯ä»¶åŒ…å’Œé…ç½®æ–‡ä»¶ 3. æ¸…ç†ä¸å†éœ€è¦çš„ä¾èµ–é¡¹ 1 2 sudo apt autoremove # ğŸ§¹ è‡ªåŠ¨ç§»é™¤ä¸å†éœ€è¦çš„ä¾èµ–åŒ… 4. é‡å¯Ubuntuè™šæ‹Ÿæœº 1 2 sudo reboot # ğŸ” é‡å¯ç³»ç»Ÿå®Œæˆå¸è½½è¿‡ç¨‹ ğŸ” ä¸‰ã€éªŒè¯å®‰è£…çŠ¶æ€ æ£€æŸ¥æœåŠ¡çŠ¶æ€ 1 2 systemctl status open-vm-tools # âœ… æŸ¥çœ‹VMwareå·¥å…·æœåŠ¡è¿è¡ŒçŠ¶æ€ æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶åŒ… 1 2 dpkg -l | grep open-vm-tools # ğŸ“‹ åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„VMwareç›¸å…³åŒ… æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ 1 2 vmware-toolbox-cmd -v # ğŸ”§ æ£€æŸ¥å·¥å…·ç‰ˆæœ¬ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ âš ï¸ å››ã€æ³¨æ„äº‹é¡¹ æƒé™è¦æ±‚ï¼šæ‰€æœ‰å‘½ä»¤éœ€è¦sudoæƒé™æ‰§è¡Œ ç½‘ç»œè¿æ¥ï¼šç¡®ä¿è™šæ‹Ÿæœºå¯ä»¥è®¿é—®äº’è”ç½‘ä»¥ä¸‹è½½è½¯ä»¶åŒ… å¤‡ä»½æ•°æ®ï¼šåœ¨è¿›è¡Œç³»ç»Ÿæ›´æ”¹å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ® ç‰ˆæœ¬å…¼å®¹æ€§ï¼šç¡®ä¿å®‰è£…çš„open-vm-toolsç‰ˆæœ¬ä¸ESXiç‰ˆæœ¬å…¼å®¹ æ›¿ä»£æ–¹æ¡ˆï¼šopen-vm-toolsæ˜¯VMwareå®˜æ–¹æ¨èçš„æ›¿ä»£VMware Toolsçš„å¼€æºæ–¹æ¡ˆ ğŸ’¡ äº”ã€å¸¸è§é—®é¢˜è§£å†³ é—®é¢˜1: å®‰è£…åé¼ æ ‡ä»ç„¶ä¸æµç•… 1 2 # å°è¯•é‡æ–°å¯åŠ¨Xçª—å£ç³»ç»Ÿ sudo systemctl restart display-manager é—®é¢˜2: å…±äº«æ–‡ä»¶å¤¹æ— æ³•è®¿é—® 1 2 3 4 # æ£€æŸ¥VMwareå…±äº«æ–‡ä»¶å¤¹è®¾ç½® vmware-hgfsclient # æ‰‹åŠ¨æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹ sudo mount -t fuse.vmhgfs-fuse .host:/ /mnt/hgfs -o allow_other é—®é¢˜3: å±å¹•åˆ†è¾¨ç‡é—®é¢˜ 1 2 # é‡æ–°é…ç½®æ˜¾ç¤ºè®¾ç½® sudo dpkg-reconfigure open-vm-tools-desktop é—®é¢˜4: æ—¶é—´ä¸åŒæ­¥ 1 2 # å¼ºåˆ¶æ—¶é—´åŒæ­¥ sudo vmware-toolbox-cmd timesync sync now è·å–æ›´å¤šå¸®åŠ© 1 2 3 4 # æŸ¥çœ‹å·¥å…·å¸®åŠ©ä¿¡æ¯ vmware-toolbox-cmd help # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„VMwareç›¸å…³æ¶ˆæ¯ journalctl -u open-vm-tools ğŸ¯ æ€»ç»“ï¼šopen-vm-tools-desktop æä¾›äº†ESXiç¯å¢ƒä¸‹Ubuntuè™šæ‹Ÿæœºçš„æœ€ä½³é›†æˆä½“éªŒã€‚å®‰è£…ç®€å•ï¼Œå¸è½½å½»åº•ï¼Œæ˜¯VMwareç¯å¢ƒä¸­çš„å¿…å¤‡å·¥å…·ã€‚å¦‚é‡é—®é¢˜ï¼Œå¯é€šè¿‡ä¸Šè¿° troubleshooting æ­¥éª¤è¿›è¡Œè¯Šæ–­å’Œä¿®å¤ã€‚\n","date":"2024-12-07T07:48:34+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/5d83819c/","title":"ESXi Ubuntu VMware Tools å®‰è£…ä¸å¸è½½æŒ‡å— ğŸ–¥ï¸"},{"content":"ESXi 8.0 å‘½ä»¤è¡Œå‡çº§æŒ‡å— ğŸš€ ğŸ“‹ å‡çº§å‰å‡†å¤‡ å¤‡ä»½é‡è¦æ•°æ®ï¼šå‡çº§å‰åŠ¡å¿…å¤‡ä»½ESXiä¸»æœºé…ç½®å’Œæ‰€æœ‰è™šæ‹Ÿæœºï¼Œä»¥é˜²å‡çº§å¤±è´¥å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ ç¡®è®¤è½¯ä»¶å…¼å®¹æ€§ï¼šç¡®ä¿ä½ ç°æœ‰çš„è™šæ‹Ÿæœºç¡¬ä»¶ç‰ˆæœ¬ã€VMware ToolsåŠå…¶ä»–ç›¸å…³è½¯ä»¶ä¸ç›®æ ‡ESXi 8.0ç‰ˆæœ¬å…¼å®¹ã€‚ å‡†å¤‡å®‰è£…ä»‹è´¨ï¼šä»VMwareå®˜ç½‘ä¸‹è½½æ­£ç¡®çš„ESXi 8.0ç¦»çº¿è¡¥ä¸åŒ…ï¼ˆZIPæ ¼å¼çš„depotæ–‡ä»¶ï¼‰ã€‚ æ£€æŸ¥ç¡¬ä»¶å…¼å®¹æ€§ï¼šç¡®ä¿æœåŠ¡å™¨ç¡¬ä»¶åœ¨VMwareçš„å…¼å®¹æ€§åˆ—è¡¨ï¼ˆVMware Compatibility Guideï¼‰ä¸­æ”¯æŒESXi 8.0ã€‚ ğŸ”„ å‡çº§æ­¥éª¤ 1. è·å–å½“å‰ESXiç‰ˆæœ¬ä¿¡æ¯ 1 2 3 vmware -v # æˆ–è·å–æ›´è¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯ esxcli system version get 2. ä¸‹è½½å¹¶ä¸Šä¼ è¡¥ä¸åŒ… ä¸‹è½½åœ°å€ï¼š VMware Patch Download æ–‡ä»¶åæ ¼å¼ï¼šVMware-ESXi-8.0U1d-23299997-depot.zip ä¸Šä¼ ä½ç½®ï¼šä½¿ç”¨ESXiçš„æ•°æ®å­˜å‚¨æµè§ˆå™¨å°†ZIPæ–‡ä»¶ä¸Šä¼ è‡³/vmfs/volumes/datastore1ç›®å½•ä¸‹ï¼ˆæ³¨æ„ï¼šè¯·å‹¿è§£å‹ZIPæ–‡ä»¶ï¼‰ 3. å…³é—­è™šæ‹Ÿæœºå¹¶è¿›å…¥ç»´æŠ¤æ¨¡å¼ åœ¨ESXi Webç®¡ç†ç•Œé¢ä¸­å…³é—­æ‰€æœ‰è™šæ‹Ÿæœºçš„ç”µæºã€‚ å°†ä¸»æœºè¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼š 1 2 3 esxcli system maintenanceMode set --enable true # éªŒè¯ç»´æŠ¤æ¨¡å¼çŠ¶æ€ esxcli system maintenanceMode get 4. æ£€æŸ¥åŒ…å†…é•œåƒç‰ˆæœ¬ 1 esxcli software sources profile list -d /vmfs/volumes/datastore1/VMware-ESXi-8.0U2b-23305546-depot.zip é€šå¸¸é€‰æ‹©standardæ ‡å‡†ç‰ˆæœ¬è¿›è¡Œå‡çº§ã€‚ 5. æ‰§è¡Œå‡çº§å‘½ä»¤ ä½¿ç”¨æŸ¥çœ‹åˆ°çš„Profileåç§°æ‰§è¡Œå‡çº§å‘½ä»¤ï¼ˆè¯·å°†\u0026lt;Profile_Name\u0026gt;æ›¿æ¢ä¸ºå®é™…çš„Profileåç§°ï¼Œä¾‹å¦‚ESXi-8.0U2b-23305546-standardï¼‰ï¼š\n1 esxcli software profile update -d /vmfs/volumes/datastore1/VMware-ESXi-8.0U2b-23305546-depot.zip -p \u0026lt;Profile_Name\u0026gt; å¦‚æœå‡çº§è¿‡ç¨‹å› ç¡¬ä»¶è­¦å‘Šæˆ–CPUå…¼å®¹æ€§é—®é¢˜è€Œä¸­æ–­ï¼Œå¯ä»¥æ·»åŠ --no-hardware-warningå‚æ•°å¿½ç•¥è­¦å‘Šå¼ºåˆ¶å‡çº§ï¼ˆè¯·è°¨æ…ä½¿ç”¨ï¼‰ï¼š 1 esxcli software profile update -d /vmfs/volumes/datastore1/VMware-ESXi-8.0U2b-23305546-depot.zip -p \u0026lt;Profile_Name\u0026gt; --no-hardware-warning å‡çº§è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°åå‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…å‘½ä»¤è¡Œæ‰§è¡Œå®Œæ¯•ï¼Œä¸è¦ä¸­æ–­æ“ä½œã€‚ 6. é‡å¯ä¸»æœºå¹¶éªŒè¯å‡çº§ å‡çº§å®Œæˆåï¼Œé‡å¯ESXiä¸»æœºï¼š 1 reboot ä¸»æœºé‡å¯åï¼Œé€€å‡ºç»´æŠ¤æ¨¡å¼ï¼š 1 esxcli system maintenanceMode set --enable false å†æ¬¡éªŒè¯å‡çº§åçš„ç‰ˆæœ¬å·ï¼Œç¡®è®¤å‡çº§æˆåŠŸï¼š 1 2 vmware -v esxcli system version get âš ï¸ æ³¨æ„äº‹é¡¹ SSHè®¿é—®ï¼šå‡çº§è¿‡ç¨‹ä¸­éœ€è¦å¼€å¯ESXiçš„SSHæœåŠ¡ã€‚å‡çº§å®Œæˆåï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå»ºè®®å…³é—­SSHæœåŠ¡ã€‚ å‡çº§åŒ…è·¯å¾„å’Œæ–‡ä»¶åï¼šç¡®ä¿åœ¨å‘½ä»¤ä¸­æŒ‡å®šçš„å‡çº§ZIPæ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åæ­£ç¡®ã€‚ è€å¿ƒç­‰å¾…ï¼šå‡çº§è¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼ŒæœŸé—´ä¸è¦ä¸­æ–­æ“ä½œæˆ–é‡å¯ä¸»æœºã€‚ ç¡¬ä»¶å…¼å®¹æ€§ï¼šè™½ç„¶å¯ä»¥ä½¿ç”¨--no-hardware-warningå‚æ•°ç»•è¿‡æŸäº›ç¡¬ä»¶è­¦å‘Šï¼Œä½†éœ€çŸ¥æ‚‰è¿™äº›ç¡¬ä»¶æœªæ¥å¯èƒ½ä¸å†å—æ”¯æŒã€‚ ä¸è¦è¶Šçº§å‡çº§ï¼šé¿å…è·¨å¤§ç‰ˆæœ¬å‡çº§ï¼ˆä¾‹å¦‚ä»7.0ç›´æ¥å‡çº§åˆ°8.0ï¼‰ã€‚ ğŸ†˜ å¸¸è§é—®é¢˜å¤„ç† å‡çº§å¤±è´¥ï¼šå¦‚æœå‡çº§å¤±è´¥ï¼Œæ£€æŸ¥å‡çº§åŒ…æ˜¯å¦å®Œæ•´ã€è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œå¹¶æŸ¥çœ‹å‘½ä»¤è¡Œè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯ã€‚ è™šæ‹Ÿæœºæ— æ³•å¯åŠ¨ï¼šå‡çº§åå¦‚æœè™šæ‹Ÿæœºæ— æ³•å¯åŠ¨ï¼Œæ£€æŸ¥å…¶ç¡¬ä»¶ç‰ˆæœ¬å’ŒVMware Toolsæ˜¯å¦å…¼å®¹ESXi 8.0ã€‚ ç½‘ç»œé—®é¢˜ï¼šå‡çº§åå¦‚æœå‡ºç°ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ£€æŸ¥è™šæ‹Ÿäº¤æ¢æœºå’Œç‰©ç†ç½‘å¡çš„é…ç½®ã€‚ âš ï¸ é‡è¦æé†’ï¼šåœ¨æ‰§è¡Œä»»ä½•å‡çº§æ“ä½œä¹‹å‰ï¼ŒåŠ¡å¿…ç¡®ä¿ä½ å·²ç»æœ‰äº†å¯é çš„å¤‡ä»½ï¼Œå¹¶ä¸”å·²ç»åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯è¿‡å‡çº§æµç¨‹ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®åœ¨ç»´æŠ¤çª—å£è¿›è¡Œæ“ä½œã€‚\nå¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ é¡ºåˆ©å®ŒæˆESXi 8.0çš„å‡çº§ï¼å¦‚æœä½ åœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶æé—®ã€‚\n","date":"2024-12-07T07:41:16+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/6136b531/","title":"ESXi 8.0 å‘½ä»¤è¡Œå‡çº§æŒ‡å— ğŸš€"},{"content":"Docker éƒ¨ç½² Caddy Web æœåŠ¡å™¨å®Œå…¨æŒ‡å— ğŸ³ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Caddy 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Caddy 1. è®¿é—® Web ç•Œé¢ ğŸ’» 2. åŸºæœ¬é…ç½®æ­¥éª¤ ğŸ¯ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆª Web æœåŠ¡ï¼Œæ¢ç´¢æ— é™ ğŸ¯ é¡¹ç›®ç®€ä»‹ Caddy æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¼€æº Web æœåŠ¡å™¨ï¼Œä»¥å…¶ç®€å•çš„é…ç½®ã€è‡ªåŠ¨ HTTPS å’Œå‡ºè‰²çš„æ€§èƒ½è€Œé—»åã€‚é€šè¿‡ Docker éƒ¨ç½² Caddyï¼Œæ‚¨å¯ä»¥è½»æ¾æ­å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Web æœåŠ¡å™¨ï¼Œæ”¯æŒé™æ€ç½‘ç«™ã€åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰å¤šç§åŠŸèƒ½ã€‚\nCaddy é‡‡ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå¯ç”¨äºé™æ€èµ„æºæ‰˜ç®¡å’Œåå‘ä»£ç†ï¼Œé»˜è®¤å¯ç”¨ HTTPSï¼Œå¹¶ä¸”é…ç½®æ–¹å¼éå¸¸ä¼˜é›…ç®€å•ã€‚\nç›¸å…³èµ„æºï¼š\nCaddy å®˜æ–¹æ–‡æ¡£ Caddy Docker Hub é¡µé¢ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ ğŸ”’ è‡ªåŠ¨ HTTPS è‡ªåŠ¨ç”³è¯·å’Œæ›´æ–° SSL è¯ä¹¦ ä¸ºæ¯ä¸ªæ‰˜ç®¡ç«™ç‚¹è‡ªåŠ¨å¯ç”¨ HTTPSï¼Œæ— éœ€é¢å¤–æ“ä½œ âš¡ é«˜æ€§èƒ½ åŸºäº Go è¯­è¨€å¼€å‘ æä¾›æ›´é«˜çš„å†…å­˜å®‰å…¨æ€§å’Œå¯é æ€§ ğŸ“ ç®€å•é…ç½® ä½¿ç”¨ç›´è§‚çš„ Caddyfile æ ¼å¼ æä¾›ç®€å•ã€æ˜“äºç†è§£çš„é…ç½®æ–‡ä»¶æ ¼å¼ ğŸŒ ç°ä»£åè®®æ”¯æŒ åŸç”Ÿæ”¯æŒ HTTP/1.1ã€HTTP/2 å’Œ HTTP/3 æä¾›æ›´å¿«çš„ç½‘ç»œä¼ è¾“é€Ÿåº¦ ğŸ”„ åå‘ä»£ç† è½»æ¾é…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ çµæ´»çš„è·¯ç”±å’Œè´Ÿè½½åˆ†é…èƒ½åŠ› ğŸ› ï¸ æ¨¡å—åŒ–è®¾è®¡ æ”¯æŒå¤šç§æ‰©å±•å’Œæ’ä»¶ é«˜æ‰©å±•æ€§èƒ½å¤Ÿæ”¯æŒæ•°åä¸‡ç«™ç‚¹ ğŸ³ å®¹å™¨å‹å¥½ å®Œç¾æ”¯æŒ Docker éƒ¨ç½² æ— å¤–éƒ¨ä¾èµ–ï¼Œåœ¨ä»»ä½•å¹³å°ä¸Šéƒ½èƒ½ç¨³å®šè¿è¡Œ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Caddy 1. åˆ›å»ºéƒ¨ç½²ç›®å½•å’Œ docker-compose.yml æ–‡ä»¶ ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 mkdir -p /mnt/mydisk/home/caddy/{html,ssl,caddy} \u0026amp;\u0026amp; cd /mnt/mydisk/home/caddy \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: caddy: image: caddy:latest restart: unless-stopped container_name: caddy ports: - 80:80 # HTTP ç«¯å£ - 443:443 # HTTPS ç«¯å£ - 6663:443 # è‡ªå®šä¹‰ HTTPS ç«¯å£ volumes: - ./html:/usr/share/caddy - ./caddy:/data - ./Caddyfile:/etc/caddy/Caddyfile - ./ssl:/etc/live # SSL è¯ä¹¦ç›®å½• environment: - TZ=Asia/Shanghai EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Caddy 1. è®¿é—® Web ç•Œé¢ ğŸ’» æœ¬åœ°è®¿é—®ï¼š http://localhost:80 HTTPS è®¿é—®ï¼š https://localhost:443 è‡ªå®šä¹‰ç«¯å£è®¿é—®ï¼š https://localhost:6663 åŸŸåè®¿é—®ï¼š https://your-domain.com ï¼ˆé…ç½®åŸŸåå’Œ DNS åï¼‰ 2. åŸºæœ¬é…ç½®æ­¥éª¤ ğŸ¯ åˆ›å»ºåŸºæœ¬çš„ Caddyfile é…ç½®æ–‡ä»¶ï¼š 1 2 3 4 5 6 7 cat \u0026gt; /mnt/mydisk/home/caddy/Caddyfile \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; http:// { root * /usr/share/caddy encode gzip file_server } EOF åˆ›å»ºç¤ºä¾‹é¦–é¡µï¼š 1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026gt; /mnt/mydisk/home/caddy/html/index.html \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Welcome to Caddy\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello from Caddy Web Server!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Caddy is running successfully in Docker.\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; EOF é‡å¯ Caddy å®¹å™¨åº”ç”¨é…ç½®ï¼š 1 docker-compose restart ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://caddy.example.com 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/caddy.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 443 ssl; listen [::]:443 ssl; server_name caddy.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /path/to/your/cert.pem; ssl_certificate_key /path/to/your/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:80; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®å½•ï¼‰ cd /path/to/your/project # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # ä»…å¯åŠ¨æŒ‡å®šæœåŠ¡ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose up -d \u0026lt;service_name\u0026gt; # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—ï¼ˆè¯·æ›¿æ¢ \u0026lt;service_name\u0026gt; ä¸ºå®é™…æœåŠ¡åï¼‰ docker-compose logs \u0026lt;service_name\u0026gt; # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åç§° docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ï¼ˆè¯·æ›¿æ¢ \u0026lt;container_name\u0026gt; ä¸ºå®é™…å®¹å™¨åï¼‰ docker stop \u0026lt;container_name\u0026gt; # åœæ­¢å®¹å™¨ docker start \u0026lt;container_name\u0026gt; # å¯åŠ¨å®¹å™¨ docker restart \u0026lt;container_name\u0026gt; # é‡å¯å®¹å™¨ # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_name\u0026gt; # åˆ é™¤å·²åœæ­¢å®¹å™¨ docker rm -f \u0026lt;container_name\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ # è¿›å…¥å®¹å™¨Shell docker exec -it \u0026lt;container_name\u0026gt; sh # ä½¿ç”¨shè¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_name\u0026gt; bash # ä½¿ç”¨bashè¿›å…¥å®¹å™¨ # ä»¥rootèº«ä»½è¿›å…¥å®¹å™¨ docker exec -u 0 -it \u0026lt;container_name\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_name\u0026gt; ls -la # æŸ¥çœ‹å®¹å™¨è¯¦æƒ…å’Œèµ„æºä½¿ç”¨ docker inspect \u0026lt;container_name\u0026gt; # æŸ¥çœ‹è¯¦ç»†é…ç½® docker stats \u0026lt;container_name\u0026gt; # å®æ—¶èµ„æºç›‘æ§ ## å®¹å™¨æ—¥å¿—ç®¡ç† docker logs \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_name\u0026gt; # å®æ—¶è·Ÿè¸ªæ—¥å¿— docker logs --tail 100 \u0026lt;container_name\u0026gt; # æŸ¥çœ‹æœ€å100è¡Œ docker logs -t \u0026lt;container_name\u0026gt; # å¸¦æ—¶é—´æˆ³çš„æ—¥å¿— 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images # åˆ—å‡ºæ‰€æœ‰é•œåƒ docker rmi \u0026lt;image_name:tag\u0026gt; # åˆ é™¤æŒ‡å®šé•œåƒï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…é•œåƒåå’Œæ ‡ç­¾ï¼‰ docker image prune -f # æ¸…ç†æ‚¬ç©ºé•œåƒ docker image prune -a -f # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨é•œåƒ ğŸŒŸ å¯èˆª Web æœåŠ¡ï¼Œæ¢ç´¢æ— é™ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Caddy Web æœåŠ¡å™¨ï¼Œå¹¶æŒæ¡äº†åŸºæœ¬çš„é…ç½®å’Œä½¿ç”¨æ–¹æ³•ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nğŸŒ è½»æ¾æ­å»º ç°ä»£åŒ–çš„ç½‘ç«™å’Œåº”ç”¨ï¼Œäº«å—è‡ªåŠ¨ HTTPS çš„ä¾¿æ·\nâš¡ é«˜æ•ˆè¿è¡Œ é™æ€èµ„æºå’ŒåŠ¨æ€åº”ç”¨ï¼Œä½“éªŒå“è¶Šçš„æ€§èƒ½è¡¨ç°\nğŸ”’ å®‰å…¨å¯é  çš„ Web æœåŠ¡ï¼Œå†…ç½®å®‰å…¨ç‰¹æ€§å’Œè‡ªåŠ¨è¯ä¹¦ç®¡ç†\nğŸ› ï¸ çµæ´»é…ç½® åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼Œæ»¡è¶³å„ç§å¤æ‚åœºæ™¯éœ€æ±‚\nWeb æœåŠ¡ä¹‹è·¯ï¼Œæ˜¯è¿æ¥æ•°å­—ä¸–ç•Œä¸ç”¨æˆ·çš„æ¡¥æ¢ã€‚æ„¿ Caddy æˆä¸ºä½ å¯é çš„ Web æœåŠ¡ä¼™ä¼´ï¼Œä¸ºä½ çš„æ¯ä¸€ä¸ªé¡¹ç›®æä¾›ç¨³å®šé«˜æ•ˆçš„è¿è¡Œç¯å¢ƒã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéƒ¨ç½²åº”ç”¨ï¼ŒæœåŠ¡ç”¨æˆ·â€”â€”æ„å»ºä½ å¼ºå¤§å¯é çš„ Web åŸºç¡€è®¾æ–½å§ï¼ğŸš€\nğŸ“Œ æŒç»­å­¦ä¹ ï¼šå»ºè®®é˜…è¯» Caddy å®˜æ–¹æ–‡æ¡£ ï¼Œæ¢ç´¢æ›´å¤šé«˜çº§åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ Caddy ç¤¾åŒºè®ºå› äº¤æµè®¨è®ºã€‚\nç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼ŒæœåŠ¡ç¨³å®šï¼ğŸ‰\n","date":"2024-12-07T07:40:26+08:00","image":"https://file.meimolihan.eu.org/img/caddy-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4ecdfeb1/","title":"Docker éƒ¨ç½² Caddy Web æœåŠ¡å™¨ ğŸ³"},{"content":"Debian/Ubuntu æ‰‹åŠ¨é…ç½® Samba å…±äº«å®Œå…¨æŒ‡å— ğŸ“ ç›®å½• ğŸ“š âœ¨ Samba ç®€ä»‹ä¸ä¼˜åŠ¿ ğŸš€ ä¸€ã€Samba åŸºç¡€é…ç½® ğŸ–¥ï¸ äºŒã€Debian ä½œä¸º Samba æœåŠ¡ç«¯é…ç½® ğŸ’» ä¸‰ã€Debian ä½œä¸º Samba å®¢æˆ·ç«¯é…ç½® ğŸ” å››ã€Samba æœåŠ¡éªŒè¯å’Œæµ‹è¯• ğŸ”§ äº”ã€Samba æœåŠ¡ç®¡ç† ğŸ› å…­ã€æ•…éšœæ’é™¤å’Œè°ƒè¯• âš™ï¸ ä¸ƒã€é«˜çº§é…ç½®é€‰é¡¹ ğŸ”’ å…«ã€å®‰å…¨åŠ å›ºå»ºè®® ğŸš€ ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ’¾ åã€å¤‡ä»½å’Œæ¢å¤ ğŸ“Š æ€»ç»“ âœ¨ Samba ç®€ä»‹ä¸ä¼˜åŠ¿ Samba æ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶å¥—ä»¶ï¼Œæä¾›äº†åœ¨ Linux/Unix ç³»ç»Ÿä¸Šä¸ Windows ç³»ç»Ÿè¿›è¡Œæ–‡ä»¶å’Œæ‰“å°æœºå…±äº«çš„æœåŠ¡ã€‚åœ¨ Debian ç³»ç»Ÿä¸Šé…ç½® Samba å¯ä»¥è®©æ‚¨è½»æ¾å®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«ï¼Œç‰¹åˆ«é€‚åˆåœ¨æ··åˆæ“ä½œç³»ç»Ÿç¯å¢ƒä¸­ä½¿ç”¨ã€‚\nä¸»è¦ä¼˜åŠ¿ï¼š\nğŸŒ è·¨å¹³å°å…¼å®¹ï¼šå®Œç¾æ”¯æŒ Linux ä¸ Windows ç³»ç»Ÿé—´çš„æ–‡ä»¶å…±äº« ğŸ”’ å®‰å…¨è®¤è¯ï¼šæ”¯æŒç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶ï¼Œä¿éšœæ•°æ®å®‰å…¨ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒï¼šæ”¯æŒå¤šä¸ªç”¨æˆ·å’Œç»„æƒé™ç®¡ç† ğŸ“Š é«˜æ€§èƒ½ä¼ è¾“ï¼šæä¾›é«˜æ•ˆç¨³å®šçš„æ–‡ä»¶ä¼ è¾“æœåŠ¡ ğŸ›¡ï¸ åè®®å…¼å®¹ï¼šå®Œå…¨å…¼å®¹ SMB/CIFS åè®® âš¡ é…ç½®çµæ´»ï¼šæ”¯æŒä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œè‡ªå®šä¹‰è®¾ç½® ğŸš€ ä¸€ã€Samba åŸºç¡€é…ç½® 1. å®‰è£… Samba å¹¶è®¾ç½®å¼€æœºè‡ªå¯ 1 2 3 4 5 6 7 8 9 10 11 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… Samba sudo apt-get update \u0026amp;\u0026amp; sudo apt install samba -y # è®¾ç½® Samba æœåŠ¡å¼€æœºè‡ªå¯ sudo systemctl enable smbd # å¯åŠ¨ Samba æœåŠ¡ sudo systemctl restart smbd # æ£€æŸ¥æœåŠ¡çŠ¶æ€ sudo systemctl status smbd 2. åˆ›å»º Samba ç”¨æˆ·å¹¶è®¾ç½®å¯†ç  1 2 3 4 5 6 7 8 # åˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼ˆå¦‚æœå°šæœªå­˜åœ¨ï¼‰ sudo useradd -m admin # è®¾ç½® Samba å¯†ç ï¼ˆä¸ç³»ç»Ÿå¯†ç åˆ†å¼€ç®¡ç†ï¼‰ sudo smbpasswd -a admin # æŸ¥çœ‹å·²åˆ›å»ºçš„ Samba ç”¨æˆ· sudo pdbedit -L ğŸ–¥ï¸ äºŒã€Debian/Ubuntu ä½œä¸º Samba æœåŠ¡ç«¯é…ç½® 1. å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶ 1 2 3 4 5 # å¤‡ä»½åŸå§‹ Samba é…ç½®æ–‡ä»¶ sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak # æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ ls -la /etc/samba/smb.conf* 2. æ–¹æ³•ä¸€ï¼šè¦†ç›–å¼é…ç½®ï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # åˆ›å»ºå…±äº«ç›®å½•å’Œ Samba é…ç½®æ–‡ä»¶ sudo mkdir -pm 755 /mnt \u0026amp;\u0026amp; \\ sudo tee /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [global] workgroup = WORKGROUP server string = Samba on Debian netbios name = Debian security = user map to guest = Bad User unix charset = UTF-8 socket options = IPTOS_LOWDELAY TCP_NODELAY server min protocol = NT1 load printers = No printing = bsd veto files = /Thumbs.db/.DS_Store/._.DS_Store/.apdisk/ delete veto files = yes [Debian] comment = Debian Samba Share path = /mnt browseable = yes writable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root EOF # é‡å¯ Samba æœåŠ¡ sudo systemctl restart smbd # æŸ¥çœ‹æœåŠ¡å™¨ IP åœ°å€ hostname -I 3. æ–¹æ³•äºŒï¼šè¿½åŠ å¼é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # åˆ›å»ºå…±äº«ç›®å½• sudo mkdir -pm 755 /mnt \u0026amp;\u0026amp; \\ sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Debian] comment = Debian Samba Share path = /mnt browseable = yes writable = yes read only = no create mask = 0777 directory mask = 0777 guest ok = no force user = root force group = root admin users = admin valid users = admin,root EOF # è®¾ç½®ç›®å½•æ‰€æœ‰æƒ sudo chown admin:admin /mnt/ # é‡å¯ Samba æœåŠ¡ sudo systemctl restart smbd # æŸ¥çœ‹æœåŠ¡å™¨ IP åœ°å€ ip -o -4 addr show scope global | awk \u0026#39;{print $4}\u0026#39; | cut -d\u0026#39;/\u0026#39; -f1 | head -n1 4. æ–¹æ³•ä¸‰ï¼šä¸€é”®é…ç½®è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 # åˆ›å»ºä¸€é”®é…ç½®è„šæœ¬ sudo tee /root/smb.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # å®‰è£… Samba apt update \u0026amp;\u0026amp; apt install samba -y # åˆ›å»ºå…±äº«ç›®å½• mkdir -pm 777 /mnt # è¿½åŠ å…±äº«é…ç½® cat \u0026gt;\u0026gt; /etc/samba/smb.conf \u0026lt;\u0026lt;\u0026#39;MYENDMARK\u0026#39; [Debian] comment = Samba Share path = /mnt guest ok = no read only = no writable = yes available = yes browseable = yes force user = root force group = root create mask = 0777 directory mask = 0777 fruit:encoding = native fruit:metadata = stream fruit:veto_appledouble = no password required = yes vfs objects = catia fruit streams_xattr force user = admin,root force group = admin,root valid users = admin,root MYENDMARK # åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®å¯†ç  useradd admin 2\u0026gt;/dev/null || true (echo \u0026#34;your_password\u0026#34;; echo \u0026#34;your_password\u0026#34;) | smbpasswd -a -s admin # é‡å¯ Samba æœåŠ¡ systemctl restart smbd echo \u0026#34;Samba é…ç½®å®Œæˆ!\u0026#34; echo \u0026#34;å…±äº«å: Debian\u0026#34; echo \u0026#34;ç”¨æˆ·å: admin\u0026#34; echo \u0026#34;å¯†ç : your_password\u0026#34; EOF # è®¾ç½®è„šæœ¬æƒé™å¹¶æ‰§è¡Œ sudo chmod +x /root/smb.sh sudo bash /root/smb.sh ğŸ’» ä¸‰ã€Debian/Ubuntu ä½œä¸º Samba å®¢æˆ·ç«¯é…ç½® 1. é…ç½® Samba å®¢æˆ·ç«¯æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®‰è£… Samba å®¢æˆ·ç«¯å·¥å…· sudo apt update \u0026amp;\u0026amp; sudo apt install samba-client cifs-utils -y # åˆ›å»ºæœ¬åœ°æŒ‚è½½ç‚¹ sudo mkdir -p /mnt/ARS2-SMB # é…ç½®è‡ªåŠ¨æŒ‚è½½ echo \u0026#34;//10.10.10.251/ARS2 /mnt/ARS2-SMB cifs username=root,password=your_password,uid=0,gid=0,file_mode=0777,dir_mode=0777 0 0\u0026#34; | sudo tee -a /etc/fstab # æµ‹è¯•æŒ‚è½½ sudo mount -a # éªŒè¯æŒ‚è½½ç»“æœ df -hT | grep cifs 2. æ‰‹åŠ¨æŒ‚è½½ Samba å…±äº« 1 2 3 4 5 # æ‰‹åŠ¨æŒ‚è½½ Samba å…±äº« sudo mount -t cifs -o username=root,password=yifan0719 //10.10.10.251/ARS2 /mnt/ARS2-SMB # æŸ¥çœ‹æŒ‚è½½å†…å®¹ ls -la /mnt/ARS2-SMB/ ğŸ” å››ã€Samba æœåŠ¡éªŒè¯å’Œæµ‹è¯• 1. å®‰è£… Samba å®¢æˆ·ç«¯å·¥å…· 1 2 # å®‰è£… smbclient sudo apt update \u0026amp;\u0026amp; sudo apt install smbclient -y 2. æµ‹è¯• Samba è¿æ¥ 1 2 3 4 5 6 7 8 9 10 11 # æµ‹è¯• Samba å…±äº«è¿æ¥ smbclient //10.10.10.245/Debian -U admin # åŒ¿åæŸ¥çœ‹ Samba å…±äº«ä¿¡æ¯ smbclient -L //10.10.10.246 -N # åœ¨ smbclient ä¸­æ‰§è¡Œå‘½ä»¤ç¤ºä¾‹ # ls - åˆ—å‡ºå…±äº«æ–‡ä»¶ # get filename - ä¸‹è½½æ–‡ä»¶ # put filename - ä¸Šä¼ æ–‡ä»¶ # exit - é€€å‡º 3. æŸ¥çœ‹å’Œç®¡ç† Samba ç”¨æˆ· 1 2 3 4 5 6 7 8 9 10 11 12 # åˆ—å‡ºæ‰€æœ‰ Samba ç”¨æˆ· sudo pdbedit -L # æ·»åŠ  root ç”¨æˆ·åˆ° Samba sudo smbpasswd -a root # åˆ é™¤ Samba ç”¨æˆ· sudo smbpasswd -x username # å¯ç”¨/ç¦ç”¨ç”¨æˆ· sudo smbpasswd -e username # å¯ç”¨ sudo smbpasswd -d username # ç¦ç”¨ ğŸ”§ äº”ã€Samba æœåŠ¡ç®¡ç† 1. æœåŠ¡ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¯åŠ¨ Samba æœåŠ¡ sudo systemctl start smbd # åœæ­¢ Samba æœåŠ¡ sudo systemctl stop smbd # é‡å¯ Samba æœåŠ¡ sudo systemctl restart smbd # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ sudo systemctl status smbd # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable smbd 2. é…ç½®é‡æ–°åŠ è½½ 1 2 3 4 5 6 7 8 # æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³• testparm # é‡æ–°åŠ è½½é…ç½®è€Œä¸é‡å¯æœåŠ¡ sudo systemctl reload smbd # æ£€æŸ¥é…ç½®è¯­æ³• sudo testparm -s ğŸ› å…­ã€æ•…éšœæ’é™¤å’Œè°ƒè¯• 1. æ—¥å¿—æŸ¥çœ‹ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ Samba æ—¥å¿— sudo tail -f /var/log/samba/log.smbd # æŸ¥çœ‹æœ€è¿‘è¿æ¥ sudo smbstatus # æŸ¥çœ‹è¯¦ç»†è¿æ¥ä¿¡æ¯ sudo smbstatus -v 2. ç½‘ç»œè¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç«¯å£å¼€æ”¾æƒ…å†µ sudo netstat -tulnp | grep smb # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping 10.10.10.251 # æ£€æŸ¥é˜²ç«å¢™è®¾ç½® sudo ufw status # æ£€æŸ¥ç«¯å£è®¿é—® telnet 10.10.10.251 445 3. æƒé™æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ç›®å½•æƒé™ ls -la /mnt/ # æ£€æŸ¥ SELinux çŠ¶æ€ï¼ˆå¦‚æœå¯ç”¨ï¼‰ getenforce # æ£€æŸ¥ AppArmor çŠ¶æ€ sudo aa-status # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæƒé™ sudo namei -l /mnt/ âš™ï¸ ä¸ƒã€é«˜çº§é…ç½®é€‰é¡¹ 1. å¤šå…±äº«é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # é…ç½®å¤šä¸ªå…±äº«ç›®å½• sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Documents] comment = Important Documents path = /mnt/documents browseable = yes writable = yes valid users = @staff [Media] comment = Media Files path = /mnt/media browseable = yes writable = yes guest ok = yes EOF # åˆ›å»ºå¯¹åº”çš„ç›®å½• sudo mkdir -p /mnt/documents /mnt/media sudo chmod 755 /mnt/documents /mnt/media 2. ç”¨æˆ·ç»„æƒé™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åˆ›å»ºç”¨æˆ·ç»„ sudo addgroup staff # æ·»åŠ ç”¨æˆ·åˆ°ç»„ sudo usermod -aG staff admin # é…ç½®ç»„æƒé™ sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; [Staff] comment = Staff Only path = /mnt/staff browseable = yes writable = yes valid users = @staff force group = staff EOF # åˆ›å»ºç›®å½•å¹¶è®¾ç½®æƒé™ sudo mkdir -p /mnt/staff sudo chgrp staff /mnt/staff sudo chmod 775 /mnt/staff 3. è®¿é—®æ§åˆ¶åˆ—è¡¨ 1 2 3 4 5 6 7 8 9 # å®‰è£… ACL å·¥å…· sudo apt install acl -y # è®¾ç½®ç›®å½• ACL sudo setfacl -R -m g:staff:rwx /mnt/staff sudo setfacl -R -d -m g:staff:rwx /mnt/staff # éªŒè¯ ACL è®¾ç½® getfacl /mnt/staff ğŸ”’ å…«ã€å®‰å…¨åŠ å›ºå»ºè®® 1. ç½‘ç»œå®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # é™åˆ¶è®¿é—®IPèŒƒå›´ sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; hosts allow = 127.0.0.1 10.10.10.0/24 hosts deny = 0.0.0.0/0 EOF # ç¦ç”¨ä¸éœ€è¦çš„åè®® sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server min protocol = SMB2 server max protocol = SMB3 EOF 2. è®¤è¯å®‰å…¨ 1 2 3 4 5 6 7 8 9 # å¯ç”¨åŠ å¯†å¯†ç  sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; encrypt passwords = yes smb passwd file = /etc/samba/private/smbpasswd EOF # åˆ›å»ºå®‰å…¨çš„å¯†ç æ–‡ä»¶ç›®å½• sudo mkdir -p /etc/samba/private sudo chmod 700 /etc/samba/private 3. å®šæœŸå®¡è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºå®¡è®¡è„šæœ¬ sudo tee /usr/local/bin/samba_audit.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash echo \u0026#34;=== Samba å®‰å…¨å®¡è®¡ ===\u0026#34; echo \u0026#34;æ—¥æœŸ: $(date)\u0026#34; echo \u0026#34;å½“å‰è¿æ¥:\u0026#34; smbstatus -b echo \u0026#34;ç”¨æˆ·åˆ—è¡¨:\u0026#34; pdbedit -L -v echo \u0026#34;å…±äº«çŠ¶æ€:\u0026#34; testparm -s --parameter-name=\u0026#34;security\u0026#34; EOF sudo chmod +x /usr/local/bin/samba_audit.sh ğŸš€ ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. ç¼“å­˜å’Œç¼“å†²åŒºä¼˜åŒ– 1 2 3 4 5 6 7 8 # æ€§èƒ½ä¼˜åŒ–è®¾ç½® sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; socket options = TCP_NODELAY IPTOS_LOWDELAY read raw = yes write raw = yes max xmit = 65535 getwd cache = yes EOF 2. æ—¥å¿—ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # é™åˆ¶æ—¥å¿—å¤§å° sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; log level = 1 log file = /var/log/samba/log.%m max log size = 50 EOF # è®¾ç½®æ—¥å¿—è½®è½¬ sudo tee /etc/logrotate.d/samba \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /var/log/samba/*.log { missingok notifempty copytruncate size 10M rotate 5 } EOF 3. èµ„æºé™åˆ¶ 1 2 3 4 5 6 # è®¾ç½®æœ€å¤§è¿æ¥æ•° sudo tee -a /etc/samba/smb.conf \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; max connections = 100 max disk size = 1000 max open files = 16384 EOF ğŸ’¾ åã€å¤‡ä»½å’Œæ¢å¤ 1. é…ç½®å¤‡ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºå¤‡ä»½ç›®å½• sudo mkdir -p /backup/samba # å¤‡ä»½ Samba é…ç½®æ–‡ä»¶ sudo tar -czf /backup/samba/samba_config_$(date +%Y%m%d).tar.gz \\ /etc/samba/smb.conf \\ /etc/samba/smb.conf.bak # å¤‡ä»½ç”¨æˆ·æ•°æ®åº“ sudo tar -czf /backup/samba/samba_users_$(date +%Y%m%d).tar.gz \\ /var/lib/samba/private/passdb.tdb # åˆ›å»ºå®šæœŸå¤‡ä»½ä»»åŠ¡ echo \u0026#34;0 2 * * * root tar -czf /backup/samba/samba_config_$(date +\\%Y\\%m\\%d).tar.gz /etc/samba/smb.conf /etc/samba/smb.conf.bak\u0026#34; | sudo tee -a /etc/crontab 2. å¿«é€Ÿæ¢å¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºæ¢å¤è„šæœ¬ sudo tee /usr/local/bin/samba_recovery.sh \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash # æ¢å¤é…ç½®æ–‡ä»¶ tar -xzf /backup/samba/samba_config_$(date +%Y%m%d).tar.gz -C / # é‡å¯ Samba æœåŠ¡ systemctl restart smbd # éªŒè¯æœåŠ¡çŠ¶æ€ systemctl status smbd EOF sudo chmod +x /usr/local/bin/samba_recovery.sh ğŸ“Š æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†åœ¨ Debian ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç† Samba å…±äº«çš„å®Œæ•´æµç¨‹ï¼š\nâœ… Samba å®‰è£…ï¼šå®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…å’Œåˆ›å»ºå…±äº«ç›®å½• âœ… ç”¨æˆ·ç®¡ç†ï¼šåˆ›å»ºå’Œç®¡ç† Samba ç”¨æˆ·è´¦æˆ· âœ… æœåŠ¡å™¨é…ç½®ï¼šé…ç½® Samba æœåŠ¡å™¨å…±äº«é€‰é¡¹ âœ… å®¢æˆ·ç«¯é…ç½®ï¼šæŒ‚è½½è¿œç¨‹ Samba å…±äº« âœ… éªŒè¯æµ‹è¯•ï¼šæµ‹è¯• Samba æœåŠ¡è¿æ¥å’ŒåŠŸèƒ½ âœ… æœåŠ¡ç®¡ç†ï¼šå¯åŠ¨ã€åœæ­¢å’Œç›‘æ§ Samba æœåŠ¡ âœ… æ•…éšœæ’é™¤ï¼šè§£å†³å¸¸è§çš„è¿æ¥å’Œæƒé™é—®é¢˜ âœ… é«˜çº§é…ç½®ï¼šå¤šå…±äº«ã€ç”¨æˆ·ç»„å’Œ ACL é…ç½® âœ… å®‰å…¨åŠ å›ºï¼šå¢å¼º Samba æœåŠ¡çš„å®‰å…¨æ€§ âœ… æ€§èƒ½ä¼˜åŒ–ï¼šä¼˜åŒ– Samba æœåŠ¡æ€§èƒ½ âœ… å¤‡ä»½æ¢å¤ï¼šé…ç½®å¤‡ä»½å’Œæ¢å¤ç­–ç•¥ ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ Debian ç³»ç»Ÿä¸­æ­å»ºå’Œç®¡ç† Samba æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«ï¼ğŸ“\nğŸ’¡ æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„å¯†ç ç­–ç•¥ï¼Œå®šæœŸæ›´æ–°å¯†ç ï¼Œå¹¶é™åˆ¶åªæœ‰å¿…è¦çš„ç”¨æˆ·å’ŒIPåœ°å€å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚åŒæ—¶å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼Œç›‘æ§å¼‚å¸¸è®¿é—®è¡Œä¸ºã€‚\n","date":"2024-12-07T07:38:50+08:00","image":"https://file.meimolihan.eu.org/img/debian-01.webp","permalink":"https://blog.meimolihan.eu.org/p/85c7724d/","title":"Debian/Ubuntu æ‰‹åŠ¨é…ç½® Samba å…±äº«æŒ‡å— ğŸ“"},{"content":"ESXi è™šæ‹Ÿæœºç®¡ç†å‘½ä»¤å¤§å…¨ âš¡ ğŸ–¥ï¸ æŒæ¡ESXiå‘½ä»¤è¡Œç®¡ç†ï¼Œè½»æ¾æŒæ§è™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸ\nç›®å½• ğŸ“š ğŸ” ä¸€ã€è™šæ‹Ÿæœºä¿¡æ¯æŸ¥è¯¢ âš¡ äºŒã€ç”µæºç®¡ç†æ“ä½œ ğŸ“Š ä¸‰ã€çŠ¶æ€ç›‘æ§ä¸è¯Šæ–­ ğŸ”§ å››ã€é«˜çº§ç®¡ç†å‘½ä»¤ ğŸ› ï¸ äº”ã€é…ç½®ä¸ç»´æŠ¤ âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ ğŸ¯ å…«ã€æ‰¹é‡æ“ä½œè„šæœ¬ ğŸš€ ä¹ã€æ€§èƒ½ä¼˜åŒ– ğŸ” ä¸€ã€è™šæ‹Ÿæœºä¿¡æ¯æŸ¥è¯¢ ğŸ“‹ è·å–æ‰€æœ‰è™šæ‹Ÿæœºåˆ—è¡¨ ç”¨é€”: æ˜¾ç¤ºESXiä¸»æœºä¸Šæ‰€æœ‰è™šæ‹Ÿæœºçš„è¯¦ç»†ä¿¡æ¯\n1 2 3 4 5 6 7 8 # è·å–å®Œæ•´è™šæ‹Ÿæœºåˆ—è¡¨ vim-cmd vmsvc/getallvms # æ ¼å¼åŒ–è¾“å‡ºï¼ˆæ›´æ˜“è¯»ï¼‰ vim-cmd vmsvc/getallvms | awk \u0026#39;{printf \u0026#34;%-4s %-30s %-20s %-15s %-10s\\n\u0026#34;, $1, $2, $3, $4, $5}\u0026#39; # ä»…æ˜¾ç¤ºè™šæ‹ŸæœºIDå’Œåç§° vim-cmd vmsvc/getallvms | awk \u0026#39;{print $1 \u0026#34; \u0026#34; $2}\u0026#39; | grep -v \u0026#34;Vmid\u0026#34; è¾“å‡ºè¯´æ˜:\nvmid: è™šæ‹Ÿæœºå”¯ä¸€æ ‡è¯†ç¬¦ name: è™šæ‹Ÿæœºåç§° file: é…ç½®æ–‡ä»¶è·¯å¾„ guest OS: å®¢æˆ·æœºæ“ä½œç³»ç»Ÿ version: è™šæ‹Ÿæœºç¡¬ä»¶ç‰ˆæœ¬ ğŸ“ æŸ¥çœ‹è™šæ‹Ÿæœºè¯¦ç»†ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ç‰¹å®šè™šæ‹Ÿæœºé…ç½® vim-cmd vmsvc/get.config [vmid] # æŸ¥çœ‹è™šæ‹Ÿæœºè¿è¡Œæ—¶ä¿¡æ¯ vim-cmd vmsvc/get.summary [vmid] # æŸ¥çœ‹è™šæ‹Ÿæœºèµ„æºåˆ†é… vim-cmd vmsvc/get.resourceconfig [vmid] # æŸ¥çœ‹è™šæ‹Ÿæœºå®¢æˆ·æœºä¿¡æ¯ï¼ˆéœ€è¦VMware Toolsï¼‰ vim-cmd vmsvc/get.guest [vmid] âš¡ äºŒã€ç”µæºç®¡ç†æ“ä½œ ğŸ”Œ å¼€å¯è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¼€å¯æŒ‡å®šè™šæ‹Ÿæœº vim-cmd vmsvc/power.on [vmid] # ç¤ºä¾‹ï¼šå¼€å¯vmidä¸º20çš„è™šæ‹Ÿæœº vim-cmd vmsvc/power.on 20 # æ‰¹é‡å¼€å¯æ‰€æœ‰å·²å…³é—­çš„è™šæ‹Ÿæœº for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34; \u0026amp;\u0026amp; $0 !~ /\\[/){print $1}}\u0026#39;); do state=$(vim-cmd vmsvc/power.getstate $vmid | grep -o \u0026#34;Powered off\u0026#34;) if [ \u0026#34;$state\u0026#34; = \u0026#34;Powered off\u0026#34; ]; then echo \u0026#34;Starting VM ID: $vmid\u0026#34; vim-cmd vmsvc/power.on $vmid fi done ğŸ”´ å…³é—­è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ­£å¸¸å…³æœºï¼ˆéœ€è¦VMware Toolsï¼‰ vim-cmd vmsvc/power.shutdown [vmid] # å¼ºåˆ¶å…³æœºï¼ˆç«‹å³æ–­ç”µï¼‰ vim-cmd vmsvc/power.off [vmid] # ç¤ºä¾‹ï¼šæ­£å¸¸å…³é—­vmidä¸º20çš„è™šæ‹Ÿæœº vim-cmd vmsvc/power.shutdown 20 # å¼ºåˆ¶å…³é—­æ‰€æœ‰è™šæ‹Ÿæœºï¼ˆç´§æ€¥æƒ…å†µä½¿ç”¨ï¼‰ for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34;) print $1}\u0026#39;); do echo \u0026#34;å¼ºåˆ¶å…³é—­è™šæ‹Ÿæœº: $vmid\u0026#34; vim-cmd vmsvc/power.off $vmid done ğŸ”„ é‡å¯è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 # æ­£å¸¸é‡å¯ï¼ˆéœ€è¦VMware Toolsï¼‰ vim-cmd vmsvc/power.reboot [vmid] # å¼ºåˆ¶é‡å¯ vim-cmd vmsvc/power.reset [vmid] # ç¤ºä¾‹ï¼šé‡å¯vmidä¸º20çš„è™šæ‹Ÿæœº vim-cmd vmsvc/power.reboot 20 â¯ï¸ æš‚åœä¸æ¢å¤ 1 2 3 4 5 6 7 8 # æš‚åœè™šæ‹Ÿæœº vim-cmd vmsvc/power.suspend [vmid] # ä»æš‚åœçŠ¶æ€æ¢å¤ vim-cmd vmsvc/power.resume [vmid] # æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦æ”¯æŒæš‚åœ vim-cmd vmsvc/get.capability [vmid] | grep suspend ğŸ“Š ä¸‰ã€çŠ¶æ€ç›‘æ§ä¸è¯Šæ–­ ğŸ” è·å–è™šæ‹Ÿæœºç”µæºçŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹è™šæ‹Ÿæœºå½“å‰çŠ¶æ€ vim-cmd vmsvc/power.getstate [vmid] # ç¤ºä¾‹ï¼šæŸ¥çœ‹vmidä¸º20çš„è™šæ‹ŸæœºçŠ¶æ€ vim-cmd vmsvc/power.getstate 20 # æ‰¹é‡æ£€æŸ¥æ‰€æœ‰è™šæ‹ŸæœºçŠ¶æ€ for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34;) print $1}\u0026#39;); do echo -n \u0026#34;VM $vmid: \u0026#34; vim-cmd vmsvc/power.getstate $vmid | grep -o \u0026#34;Powered on\\|Powered off\\|Suspended\u0026#34; done # å¯èƒ½çš„è¿”å›çŠ¶æ€ï¼š # - Powered on ğŸŸ¢ å·²å¼€æœº # - Powered off ğŸ”´ å·²å…³æœº # - Suspended â¸ï¸ å·²æš‚åœ ğŸ“ˆ åˆ—å‡ºå½“å‰è¿è¡Œçš„è™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10 11 # æ˜¾ç¤ºæ‰€æœ‰è¿è¡Œä¸­çš„è™šæ‹Ÿæœº esxcli vm process list # è¯¦ç»†æ ¼å¼æ˜¾ç¤º esxcli vm process list | grep -E \u0026#34;^(World|Process|Name|UUID)\u0026#34; # ç»Ÿè®¡è¿è¡Œä¸­çš„è™šæ‹Ÿæœºæ•°é‡ esxcli vm process list | grep \u0026#34;World ID\u0026#34; | wc -l # æ˜¾ç¤ºè™šæ‹Ÿæœºèµ„æºä½¿ç”¨æƒ…å†µ esxcli vm process list | awk \u0026#39;/Name:/ {name=$2} /CPU:/ {cpu=$2} /Mem:/ {mem=$2} /World ID:/ {print \u0026#34;VM:\u0026#34;, name, \u0026#34;CPU:\u0026#34;, cpu, \u0026#34;Memory:\u0026#34;, mem}\u0026#39; ğŸ–¥ï¸ èµ„æºä½¿ç”¨ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ esxtop # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ esxcli hardware memory get # æŸ¥çœ‹å­˜å‚¨æ€§èƒ½ esxcli storage core device stats get # æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯ esxcli network nic stats get # æŸ¥çœ‹è™šæ‹Ÿæœºèµ„æºé™åˆ¶ esxcli vm process list | grep -E \u0026#34;(World ID|CPU|Memory)\u0026#34; ğŸ”§ å››ã€é«˜çº§ç®¡ç†å‘½ä»¤ ğŸ”„ è™šæ‹Ÿæœºå¿«ç…§ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºå¿«ç…§ vim-cmd vmsvc/snapshot.create [vmid] \u0026#34;Snapshot Name\u0026#34; \u0026#34;Description\u0026#34; includeMemory suppressPowerOff # åˆ—å‡ºå¿«ç…§ vim-cmd vmsvc/snapshot.get [vmid] # æ¢å¤åˆ°å¿«ç…§ vim-cmd vmsvc/snapshot.revert [vmid] snapshotId suppressPowerOff # åˆ é™¤å¿«ç…§ vim-cmd vmsvc/snapshot.remove [vmid] snapshotId # åˆ é™¤æ‰€æœ‰å¿«ç…§ vim-cmd vmsvc/snapshot.removeall [vmid] # ç¤ºä¾‹ï¼šåˆ›å»ºåä¸º\u0026#34;Backup\u0026#34;çš„å¿«ç…§ vim-cmd vmsvc/snapshot.create 123 \u0026#34;Backup\u0026#34; \u0026#34;Pre-update snapshot\u0026#34; 0 0 ğŸ“ æ–‡ä»¶æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹è™šæ‹Ÿæœºæ–‡ä»¶ ls -la /vmfs/volumes/ # æŸ¥æ‰¾ç‰¹å®šè™šæ‹Ÿæœºæ–‡ä»¶ find /vmfs/volumes -name \u0026#34;*.vmx\u0026#34; | grep [vm-name] # æ£€æŸ¥è™šæ‹Ÿæœºç£ç›˜æ–‡ä»¶ vmkfstools -i [source.vmdk] [destination.vmdk] # æ‰©å±•è™šæ‹Ÿç£ç›˜ vmkfstools -X [new-size]G [disk.vmdk] # å…‹éš†è™šæ‹Ÿæœºç£ç›˜ vmkfstools -i source.vmdk destination.vmdk -d thin # æ£€æŸ¥ç£ç›˜ä¸€è‡´æ€§ vmkfstools -e [disk.vmdk] ğŸŒ ç½‘ç»œç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹è™šæ‹Ÿäº¤æ¢æœº esxcli network vswitch standard list # æŸ¥çœ‹ç«¯å£ç»„ esxcli network vswitch standard portgroup list # æŸ¥çœ‹è™šæ‹Ÿæœºç½‘ç»œé€‚é…å™¨ esxcli network vm list # æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯ esxcli network nic stats get # æŸ¥çœ‹VMkernelç½‘ç»œæ¥å£ esxcli network ip interface list # é…ç½®è™šæ‹Ÿæœºç½‘ç»œ esxcli network vm portgroup set -p \u0026#34;Portgroup Name\u0026#34; -v [vmid] ğŸ› ï¸ äº”ã€é…ç½®ä¸ç»´æŠ¤ âš™ï¸ ESXiä¸»æœºé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æŸ¥çœ‹ä¸»æœºä¿¡æ¯ esxcli system version get # æŸ¥çœ‹ä¸»æœºæ—¶é—´ esxcli system time get # æŸ¥çœ‹ä¸»æœºçŠ¶æ€ esxcli system status get # æŸ¥çœ‹ä¸»æœºç¡¬ä»¶ä¿¡æ¯ esxcli hardware platform get # æŸ¥çœ‹CPUä¿¡æ¯ esxcli hardware cpu list # æŸ¥çœ‹å†…å­˜ä¿¡æ¯ esxcli hardware memory get # æŸ¥çœ‹PCIè®¾å¤‡ esxcli hardware pci list ğŸ”§ æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ—å‡ºæ‰€æœ‰æœåŠ¡ esxcli system service list # å¯åŠ¨æœåŠ¡ esxcli system service start --service=[service-name] # åœæ­¢æœåŠ¡ esxcli system service stop --service=[service-name] # é‡å¯ç®¡ç†ä»£ç†ï¼ˆå¸¸ç”¨æ•…éšœæ’é™¤ï¼‰ /etc/init.d/hostd restart /etc/init.d/vpxa restart # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ esxcli system service status --service=[service-name] # è®¾ç½®æœåŠ¡å¼€æœºè‡ªå¯ esxcli system service set --service=[service-name] --enabled=true ğŸ’¾ å­˜å‚¨ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹å­˜å‚¨é€‚é…å™¨ esxcli storage core adapter list # æŸ¥çœ‹å­˜å‚¨è®¾å¤‡ esxcli storage core device list # æŸ¥çœ‹æ•°æ®å­˜å‚¨ esxcli storage filesystem list # æŸ¥çœ‹NFSå­˜å‚¨ esxcli storage nfs list # æŸ¥çœ‹VMFSæ•°æ®å­˜å‚¨ esxcli storage vmfs extent list # é‡æ–°æ‰«æå­˜å‚¨é€‚é…å™¨ esxcli storage core adapter rescan --adapter=[adapter-name] âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹ ğŸ”´ é‡è¦è­¦å‘Š æƒé™è¦æ±‚: éœ€è¦SSHç™»å½•ESXiä¸»æœºå¹¶å…·æœ‰ç®¡ç†å‘˜æƒé™\n1 2 3 4 5 # å¯ç”¨ESXi SSHï¼ˆä¸´æ—¶ï¼‰ esxcli system ssh set --enabled=true # è®¾ç½®SSHå¼€æœºè‡ªå¯ esxcli system ssh set --enabled=true --start-auto=true æ“ä½œé£é™©: å¼ºåˆ¶å…³æœºå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±\n1 2 3 4 5 6 7 8 # ä¼˜å…ˆä½¿ç”¨æ­£å¸¸å…³æœº vim-cmd vmsvc/power.shutdown [vmid] # ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å¼ºåˆ¶å…³æœº vim-cmd vmsvc/power.off [vmid] # æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦æœ‰æœªä¿å­˜æ•°æ® vim-cmd vmsvc/get.summary [vmid] | grep -E \u0026#34;(guestHeartbeatStatus|guestState)\u0026#34; å¤‡ä»½é‡è¦: å…³é”®æ“ä½œå‰å»ºè®®åˆ›å»ºå¿«ç…§\n1 2 3 4 5 # åˆ›å»ºä¿æŠ¤æ€§å¿«ç…§ vim-cmd vmsvc/snapshot.create [vmid] \u0026#34;Pre-Maintenance\u0026#34; \u0026#34;Snapshot before maintenance\u0026#34; 0 0 # è®¾ç½®å¿«ç…§ä¿ç•™ç­–ç•¥ vim-cmd vmsvc/snapshot.setoption [vmid] 90 7 âœ… æœ€ä½³å®è·µ è®°å½•æ“ä½œ: è®°å½•æ‰€æœ‰å‘½ä»¤è¡Œæ“ä½œ\n1 2 3 # å¯ç”¨ESXi Shellå‘½ä»¤å†å²è®°å½• export HISTFILE=~/.esh_history export HISTSIZE=1000 æµ‹è¯•ç¯å¢ƒ: åœ¨ç”Ÿäº§ç¯å¢ƒæ“ä½œå‰å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯\n1 2 # åˆ›å»ºæµ‹è¯•è™šæ‹Ÿæœºå…‹éš† vim-cmd vmsvc/clone [vmid] [new-vmid] [new-name] ç»´æŠ¤çª—å£: åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œç»´æŠ¤æ“ä½œ\n1 2 # æ£€æŸ¥å½“å‰è´Ÿè½½ esxcli system stats load get ç›‘æ§éªŒè¯: æ“ä½œåéªŒè¯è™šæ‹ŸæœºçŠ¶æ€\n1 2 3 # æ“ä½œåéªŒè¯ vim-cmd vmsvc/power.getstate [vmid] esxcli vm process list | grep [vmid] ğŸ’¡ ä¸ƒã€å®ç”¨æŠ€å·§ ğŸ¯ å¿«é€ŸæŸ¥æ‰¾è™šæ‹ŸæœºID 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æ ¹æ®è™šæ‹Ÿæœºåç§°æŸ¥æ‰¾vmid vim-cmd vmsvc/getallvms | grep -i \u0026#34;[vm-name]\u0026#34; # åˆ›å»ºæŸ¥æ‰¾å‡½æ•°ï¼ˆæ·»åŠ åˆ°~/.profileï¼‰ findvm() { vim-cmd vmsvc/getallvms | grep -i \u0026#34;$1\u0026#34; } # æ ¹æ®IPåœ°å€æŸ¥æ‰¾è™šæ‹Ÿæœº findvmbyip() { for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34;) print $1}\u0026#39;); do ip=$(vim-cmd vmsvc/get.guest $vmid | grep ipAddress | sed -n \u0026#39;1p\u0026#39; | cut -d \u0026#39;\u0026#34;\u0026#39; -f 2) if [ \u0026#34;$ip\u0026#34; = \u0026#34;$1\u0026#34; ]; then echo \u0026#34;VMID: $vmid\u0026#34; vim-cmd vmsvc/get.summary $vmid | grep \u0026#34;name\u0026#34; fi done } ğŸ“Š èµ„æºä½¿ç”¨æŠ¥å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ç”Ÿæˆè™šæ‹Ÿæœºèµ„æºæŠ¥å‘Š echo \u0026#34;VM Resource Usage Report - $(date)\u0026#34; echo \u0026#34;===================================\u0026#34; vim-cmd vmsvc/getallvms | awk \u0026#39;NR\u0026gt;1 {print $1}\u0026#39; | while read vmid; do echo \u0026#34;VMID: $vmid\u0026#34; vim-cmd vmsvc/get.summary $vmid | grep -E \u0026#34;(memory|cpu|powerState)\u0026#34; echo \u0026#34;---\u0026#34; done # å¯¼å‡ºä¸ºCSVæ ¼å¼ echo \u0026#34;VMID,Name,PowerState,CPU,Memory\u0026#34; \u0026gt; vm_report.csv vim-cmd vmsvc/getallvms | awk \u0026#39;NR\u0026gt;1 {print $1}\u0026#39; | while read vmid; do name=$(vim-cmd vmsvc/get.summary $vmid | grep \u0026#34;name\u0026#34; | cut -d \u0026#39;\u0026#34;\u0026#39; -f 2) power=$(vim-cmd vmsvc/power.getstate $vmid | grep -o \u0026#34;Powered on\\|Powered off\\|Suspended\u0026#34;) cpu=$(vim-cmd vmsvc/get.summary $vmid | grep \u0026#34;cpu\u0026#34; | cut -d \u0026#39;\u0026#34;\u0026#39; -f 2) memory=$(vim-cmd vmsvc/get.summary $vmid | grep \u0026#34;memory\u0026#34; | cut -d \u0026#39;\u0026#34;\u0026#39; -f 2) echo \u0026#34;$vmid,$name,$power,$cpu,$memory\u0026#34; \u0026gt;\u0026gt; vm_report.csv done ğŸ¯ å…«ã€æ‰¹é‡æ“ä½œè„šæœ¬ ğŸ”„ æ‰¹é‡ç”µæºç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash # æ‰¹é‡å¯åŠ¨æ‰€æœ‰å·²å…³é—­çš„è™šæ‹Ÿæœº echo \u0026#34;Starting all powered-off VMs...\u0026#34; for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34; \u0026amp;\u0026amp; $0 !~ /\\[/){print $1}}\u0026#39;); do state=$(vim-cmd vmsvc/power.getstate $vmid | grep -o \u0026#34;Powered off\u0026#34;) if [ \u0026#34;$state\u0026#34; = \u0026#34;Powered off\u0026#34; ]; then echo \u0026#34;Starting VM ID: $vmid\u0026#34; vim-cmd vmsvc/power.on $vmid sleep 2 fi done echo \u0026#34;Done.\u0026#34; #!/bin/bash # æ‰¹é‡æ­£å¸¸å…³é—­æ‰€æœ‰è™šæ‹Ÿæœº echo \u0026#34;Shutting down all VMs gracefully...\u0026#34; for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34;) print $1}\u0026#39;); do state=$(vim-cmd vmsvc/power.getstate $vmid | grep -o \u0026#34;Powered on\u0026#34;) if [ \u0026#34;$state\u0026#34; = \u0026#34;Powered on\u0026#34; ]; then echo \u0026#34;Shutting down VM ID: $vmid\u0026#34; vim-cmd vmsvc/power.shutdown $vmid sleep 5 fi done echo \u0026#34;Done.\u0026#34; ğŸ“¸ æ‰¹é‡å¿«ç…§ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/bash # ä¸ºæ‰€æœ‰è¿è¡Œä¸­çš„è™šæ‹Ÿæœºåˆ›å»ºå¿«ç…§ SNAPSHOT_NAME=\u0026#34;Pre-Maintenance-$(date +%Y%m%d)\u0026#34; echo \u0026#34;Creating snapshot \u0026#39;$SNAPSHOT_NAME\u0026#39; for all running VMs...\u0026#34; for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34;) print $1}\u0026#39;); do state=$(vim-cmd vmsvc/power.getstate $vmid | grep -o \u0026#34;Powered on\u0026#34;) if [ \u0026#34;$state\u0026#34; = \u0026#34;Powered on\u0026#34; ]; then echo \u0026#34;Creating snapshot for VM ID: $vmid\u0026#34; vim-cmd vmsvc/snapshot.create $vmid \u0026#34;$SNAPSHOT_NAME\u0026#34; \u0026#34;Automated snapshot before maintenance\u0026#34; 0 0 sleep 1 fi done echo \u0026#34;Done.\u0026#34; #!/bin/bash # åˆ é™¤æ‰€æœ‰è™šæ‹Ÿæœºçš„æ‰€æœ‰å¿«ç…§ echo \u0026#34;Removing all snapshots from all VMs...\u0026#34; for vmid in $(vim-cmd vmsvc/getallvms | awk \u0026#39;{if($1 != \u0026#34;Vmid\u0026#34;) print $1}\u0026#39;); do echo \u0026#34;Removing snapshots from VM ID: $vmid\u0026#34; vim-cmd vmsvc/snapshot.removeall $vmid sleep 1 done echo \u0026#34;Done.\u0026#34; ğŸš€ ä¹ã€æ€§èƒ½ä¼˜åŒ– âš¡ æ€§èƒ½ç›‘æ§å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹CPUå°±ç»ªæ—¶é—´ esxcli perf metric get --metric-id=cpu.ready.summation # æŸ¥çœ‹å†…å­˜äº¤æ¢ esxcli perf metric get --metric-id=mem.swapped.summation # æŸ¥çœ‹å­˜å‚¨å»¶è¿Ÿ esxcli perf metric get --metric-id=disk.totalLatency.average # æŸ¥çœ‹ç½‘ç»œä¸¢åŒ…ç‡ esxcli perf metric get --metric-id=net.droppedRx.summation # æŸ¥çœ‹å†…å­˜ ballooning esxcli perf metric get --metric-id=mem.vmmemctl.average ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è°ƒæ•´è™šæ‹Ÿæœºå†…å­˜åˆ†é… vim-cmd vmsvc/reconfigure [vmid] mem=[new-memory-size] # è°ƒæ•´è™šæ‹ŸæœºCPUæ•°é‡ vim-cmd vmsvc/reconfigure [vmid] numCPUs=[new-cpu-count] # å¯ç”¨CPUçƒ­æ·»åŠ  vim-cmd vmsvc/reconfigure [vmid] cpuHotAddEnabled=true # å¯ç”¨å†…å­˜çƒ­æ·»åŠ  vim-cmd vmsvc/reconfigure [vmid] memoryHotAddEnabled=true # è°ƒæ•´è™šæ‹Ÿæœºèµ„æºä»½é¢ vim-cmd vmsvc/reconfigure [vmid] cpuShares=[shares] memShares=[shares] ğŸ“ˆ èµ„æºä½¿ç”¨åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ†æCPUä½¿ç”¨æƒ…å†µ esxcli system stats load get # åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ esxcli system stats memory get # åˆ†æå­˜å‚¨æ€§èƒ½ esxcli storage core device stats get # åˆ†æç½‘ç»œæ€§èƒ½ esxcli network nic stats get # ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š esxcli system stats list | grep -E \u0026#34;(cpu|mem|net|disk)\u0026#34; ğŸ’¡ ä¸“ä¸šæç¤º: åœ¨ä½¿ç”¨ESXiå‘½ä»¤è¡Œç®¡ç†è™šæ‹Ÿæœºæ—¶ï¼Œå»ºè®®å…ˆä½¿ç”¨ vim-cmd vmsvc/getallvms ç¡®è®¤æ­£ç¡®çš„è™šæ‹ŸæœºIDï¼Œç„¶åå†æ‰§è¡Œç”µæºæ“ä½œã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒçš„é‡è¦è™šæ‹Ÿæœºï¼ŒåŠ¡å¿…åœ¨æ“ä½œå‰åˆ›å»ºå¿«ç…§å¤‡ä»½ã€‚\n","date":"2024-12-07T07:37:59+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/6ec3be5f/","title":"ESXi è™šæ‹Ÿæœºç®¡ç†å‘½ä»¤å¤§å…¨ âš¡"},{"content":"Docker å®‰è£…ä¸å¸è½½æŒ‡å— ğŸ³ æœ¬æ–‡å…¨é¢æ¶µç›– Docker çš„å®‰è£…ã€ä½¿ç”¨ã€ç»´æŠ¤å’Œå½»åº•å¸è½½ï¼Œä¸ºæ‚¨æä¾›ä¸€ç«™å¼å®¹å™¨åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚\nğŸ“‘ ç›®å½•å¯¼èˆª ğŸŒŸ æ¦‚è¿° ğŸ§ Debian å®‰è£… Docker ğŸ”´ CentOS å®‰è£… Docker ğŸ¦¬ Ubuntu å®‰è£… Docker âš™ï¸ é€šç”¨é…ç½®ä¸ä¼˜åŒ– ğŸ“Š Docker å¸¸ç”¨å‘½ä»¤ ğŸ”’ å®‰å…¨å»ºè®® ğŸ—‘ï¸ Docker å®Œå…¨å¸è½½æŒ‡å— ğŸ¯ å¸è½½å‰å‡†å¤‡ ğŸ”§ Debian ç³»å¸è½½ ğŸ”´ RedHat ç³»å¸è½½ ğŸ§¹ æ•°æ®æ¸…ç† ğŸ” éªŒè¯å¸è½½ ğŸ’¡ æ³¨æ„äº‹é¡¹ ğŸ†˜ å¸¸è§é—®é¢˜ ğŸŒŸ æ¦‚è¿° Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œå…è®¸å¼€å‘è€…å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹æ‰“åŒ…åˆ°æ ‡å‡†åŒ–å•å…ƒä¸­ï¼Œä»è€Œå®ç°å¿«é€Ÿéƒ¨ç½²ã€å¯æ‰©å±•æ€§å’Œèµ„æºéš”ç¦»ã€‚æœ¬æŒ‡å—æä¾›åœ¨ä¸»æµ Linux å‘è¡Œç‰ˆä¸Šå®‰è£…ã€ä½¿ç”¨å’Œå¸è½½ Docker çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚\nğŸ§ Debian å®‰è£… Docker 1. å®‰è£… Docker 1 2 # æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£… Docker sudo apt-get update \u0026amp;\u0026amp; sudo apt install docker.io -y 2. ä½¿ç”¨è„šæœ¬å®‰è£…ï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰ 1 2 3 4 # ä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬ curl -sS -O https://raw.gitmirror.com/kejilion/sh/main/cn/kejilion.sh \u0026amp;\u0026amp; \\ chmod +x kejilion.sh \u0026amp;\u0026amp; \\ ./kejilion.sh 3. é…ç½®å›½å†…é•œåƒæº 1 2 3 4 5 6 7 8 9 10 11 # åˆ›å»º Docker é•œåƒæºé…ç½®æ–‡ä»¶ sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; deb https://mirrors.aliyun.com/debian/ bookworm main non-free non-free-firmware contrib deb-src https://mirrors.aliyun.com/debian/ bookworm main non-free non-free-firmware contrib deb https://mirrors.aliyun.com/debian-security/ bookworm-security main deb-src https://mirrors.aliyun.com/debian-security/ bookworm-security main deb https://mirrors.aliyun.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb-src https://mirrors.aliyun.com/debian/ bookworm-updates main non-free non-free-firmware contrib deb https://mirrors.aliyun.com/debian/ bookworm-backports main non-free non-free-firmware contrib deb-src https://mirrors.aliyun.com/debian/ bookworm-backports main non-free non-free-firmware contrib EOF 4. é…ç½® Docker å¼€æœºè‡ªå¯åŠ¨ 1 2 3 4 5 # é‡æ–°åŠ è½½ systemd é…ç½® sudo systemctl daemon-reload # å¯ç”¨å¹¶å¯åŠ¨ Docker æœåŠ¡ sudo systemctl enable docker \u0026amp;\u0026amp; sudo systemctl start docker ğŸ”´ CentOS å®‰è£… Docker 1. å®‰è£… Docker 1 2 # ä½¿ç”¨ dnf å®‰è£… Docker sudo dnf install docker -y 2. ä½¿ç”¨è„šæœ¬å®‰è£…ï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰ 1 2 3 4 # ä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬ curl -sS -O https://raw.gitmirror.com/kejilion/sh/main/cn/kejilion.sh \u0026amp;\u0026amp; \\ chmod +x kejilion.sh \u0026amp;\u0026amp; \\ ./kejilion.sh 3. å¯åŠ¨ Docker æœåŠ¡ 1 2 # å¯åŠ¨ Docker æœåŠ¡ sudo systemctl start docker 4. è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ 1 2 # è®¾ç½® Docker å¼€æœºè‡ªå¯åŠ¨ sudo systemctl enable docker 5. éªŒè¯å®‰è£… 1 2 # æ£€æŸ¥ Docker çŠ¶æ€ sudo systemctl status docker å¦‚æœè¾“å‡ºæ˜¾ç¤º Active: active (running)ï¼Œè¡¨ç¤º Docker å·²æˆåŠŸå¯åŠ¨ã€‚\nğŸ¦¬ Ubuntu å®‰è£… Docker 1. å¸è½½æ—§ç‰ˆæœ¬ï¼ˆå¦‚å·²å®‰è£…ï¼‰ 1 2 # å¸è½½æ—§ç‰ˆæœ¬ Docker sudo apt-get remove docker docker-engine docker.io containerd runc -y 2. å®‰è£…ä¾èµ–åŒ… 1 2 3 # æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£…å¿…è¦ä¾èµ– sudo apt-get update \u0026amp;\u0026amp; \\ sudo apt-get install apt-transport-https ca-certificates curl software-properties-common -y 3. æ·»åŠ  Docker GPG å¯†é’¥ 1 2 # ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºæ·»åŠ  GPG å¯†é’¥ curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - 4. æ·»åŠ  Docker è½¯ä»¶æº 1 2 # æ·»åŠ  Docker å®˜æ–¹è½¯ä»¶æºï¼ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼‰ sudo add-apt-repository \u0026#34;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\u0026#34; 5. å®‰è£… Docker Engine 1 2 3 # æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£… Docker sudo apt-get update \u0026amp;\u0026amp; \\ sudo apt-get install docker-ce docker-ce-cli containerd.io -y 6. å¯åŠ¨å¹¶å¯ç”¨ Docker æœåŠ¡ 1 2 3 # å¯åŠ¨ Docker å¹¶è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl start docker \u0026amp;\u0026amp; \\ sudo systemctl enable docker 7. éªŒè¯å®‰è£… 1 2 # è¿è¡Œæµ‹è¯•å®¹å™¨ docker run hello-world âš™ï¸ é€šç”¨é…ç½®ä¸ä¼˜åŒ– 1. é…ç½® Docker é•œåƒåŠ é€Ÿå™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºæˆ–ä¿®æ”¹ Docker daemon é…ç½® sudo tee /etc/docker/daemon.json \u0026gt; /dev/null \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34;, \u0026#34;https://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://mirror.baidubce.com\u0026#34; ] } EOF # é‡å¯ Docker æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ sudo systemctl restart docker 2. å°†ç”¨æˆ·æ·»åŠ åˆ° Docker ç»„ 1 2 3 4 5 # å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ sudo usermod -aG docker $USER # åº”ç”¨ç»„æ›´æ”¹ï¼ˆéœ€è¦é‡æ–°ç™»å½•ç”Ÿæ•ˆï¼‰ newgrp docker 3. éªŒè¯ Docker å®‰è£… 1 2 3 4 5 6 7 8 # æ£€æŸ¥ Docker ç‰ˆæœ¬ docker --version # æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€ docker info # è¿è¡Œæµ‹è¯•å®¹å™¨ docker run --rm hello-world ğŸ“Š Docker å¸¸ç”¨å‘½ä»¤ å®¹å™¨ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ—å‡ºè¿è¡Œä¸­çš„å®¹å™¨ docker ps # åˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰ docker ps -a # å¯åŠ¨/åœæ­¢å®¹å™¨ docker start \u0026lt;container_id\u0026gt; docker stop \u0026lt;container_id\u0026gt; # åˆ é™¤å®¹å™¨ docker rm \u0026lt;container_id\u0026gt; # å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ docker rm -f \u0026lt;container_id\u0026gt; é•œåƒç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # åˆ—å‡ºæœ¬åœ°é•œåƒ docker images # æ‹‰å–é•œåƒ docker pull \u0026lt;image_name\u0026gt; # åˆ é™¤é•œåƒ docker rmi \u0026lt;image_id\u0026gt; # æ„å»ºé•œåƒ docker build -t \u0026lt;image_name\u0026gt; . æ—¥å¿—æŸ¥çœ‹ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs \u0026lt;container_id\u0026gt; # å®æ—¶æŸ¥çœ‹æ—¥å¿— docker logs -f \u0026lt;container_id\u0026gt; # æŸ¥çœ‹æœ€è¿‘æ—¥å¿— docker logs --tail 100 \u0026lt;container_id\u0026gt; å®¹å™¨æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 # è¿›å…¥å®¹å™¨ docker exec -it \u0026lt;container_id\u0026gt; /bin/bash # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ docker exec \u0026lt;container_id\u0026gt; \u0026lt;command\u0026gt; # å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨ docker cp local_file.txt \u0026lt;container_id\u0026gt;:/path/in/container/ # ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶ docker cp \u0026lt;container_id\u0026gt;:/path/in/container/file.txt local_file.txt ğŸ”’ å®‰å…¨å»ºè®® 1. å®šæœŸæ›´æ–° Docker 1 2 3 4 5 # æ›´æ–° Docker åˆ°æœ€æ–°ç‰ˆæœ¬ sudo apt-get update \u0026amp;\u0026amp; sudo apt-get upgrade docker-ce -y # æˆ–è€…ä½¿ç”¨ dnf (CentOS) sudo dnf update docker -y 2. é…ç½®é˜²ç«å¢™ 1 2 3 # å¦‚æœä½¿ç”¨é˜²ç«å¢™ï¼Œç¡®ä¿å¼€æ”¾å¿…è¦ç«¯å£ sudo ufw allow 2375/tcp # Docker API ç«¯å£ sudo ufw allow 2376/tcp # Docker TLS ç«¯å£ 3. å¯ç”¨å†…å®¹ä¿¡ä»» 1 2 3 4 5 # å¯ç”¨ Docker å†…å®¹ä¿¡ä»» export DOCKER_CONTENT_TRUST=1 # æ°¸ä¹…å¯ç”¨å†…å®¹ä¿¡ä»» echo \u0026#34;export DOCKER_CONTENT_TRUST=1\u0026#34; \u0026gt;\u0026gt; ~/.bashrc 4. ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨ 1 2 3 4 5 # åœ¨ Dockerfile ä¸­æŒ‡å®šé root ç”¨æˆ· USER 1000:1000 # æˆ–è€…åœ¨è¿è¡Œå®¹å™¨æ—¶æŒ‡å®šç”¨æˆ· docker run -u 1000:1000 \u0026lt;image_name\u0026gt; ğŸ—‘ï¸ Docker å®Œå…¨å¸è½½æŒ‡å— å½»åº•æ¸…ç† Docker åŠç›¸å…³ç»„ä»¶ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æº\nğŸ¯ å¸è½½å‰å‡†å¤‡ å¸è½½ Docker å‰ï¼ŒåŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ï¼Œå› ä¸ºå¸è½½è¿‡ç¨‹ä¼šåˆ é™¤æ‰€æœ‰ Docker ç›¸å…³çš„æ•°æ®ã€‚\nğŸ“Š å¤‡ä»½é‡è¦æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 # 1. å¤‡ä»½å®¹å™¨æ•°æ®ï¼ˆé‡è¦ï¼ï¼‰ docker ps -aq | xargs -I {} docker export {} \u0026gt; /tmp/container_backup.tar # 2. å¤‡ä»½é•œåƒåˆ—è¡¨ docker images --format \u0026#34;{{.Repository}}:{{.Tag}}\u0026#34; \u0026gt; /tmp/docker_images.list # 3. å¤‡ä»½å·æ•°æ®ï¼ˆå¦‚æœæœ‰é‡è¦æ•°æ®ï¼‰ tar -czvf /tmp/docker_volumes_backup.tar.gz /var/lib/docker/volumes/ # 4. å¤‡ä»½ Docker é…ç½® cp -r /etc/docker /tmp/docker_config_backup ğŸ”§ Debian ç³»å¸è½½ é€‚ç”¨äº Debianã€Ubuntuã€Kali Linux ç­‰ç³»ç»Ÿï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # 1. åœæ­¢ Docker æœåŠ¡ sudo systemctl stop docker sudo systemctl stop docker.socket sudo systemctl stop containerd # 2. å¸è½½ Docker åŠç›¸å…³ç»„ä»¶ sudo apt-get remove -y \\ docker \\ docker.io \\ docker-ce \\ docker-ce-cli \\ docker-ce-rootless-extras \\ docker-buildx-plugin \\ docker-compose-plugin \\ containerd.io \\ runc # 3. æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–åŒ… sudo apt-get autoremove -y sudo apt-get autoclean -y # 4. æ¸…é™¤é…ç½®æ–‡ä»¶å’Œæ®‹ç•™æ•°æ® sudo apt-get purge -y docker* containerd* runc ğŸ”´ RedHat ç³»å¸è½½ é€‚ç”¨äº CentOSã€RHELã€Rocky Linux ç­‰ç³»ç»Ÿï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # 1. åœæ­¢ Docker æœåŠ¡ sudo systemctl stop docker sudo systemctl stop docker.socket sudo systemctl stop containerd # 2. å¸è½½ Docker åŠç›¸å…³ç»„ä»¶ sudo yum remove -y \\ docker \\ docker-ce \\ docker-ce-cli \\ docker-ce-rootless-extras \\ docker-buildx-plugin \\ docker-compose-plugin \\ containerd.io \\ podman \\ podman-docker \\ runc # 3. æ¸…ç†ä¾èµ–åŒ… sudo yum autoremove -y sudo yum clean all # 4. åˆ é™¤ Docker ç»„ sudo groupdel docker ğŸ§¹ æ•°æ®æ¸…ç† âš ï¸ é‡è¦è­¦å‘Šï¼šä»¥ä¸‹æ“ä½œä¼šåˆ é™¤æ‰€æœ‰ Docker æ•°æ®ï¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. åˆ é™¤ Docker æ•°æ®ç›®å½•ï¼ˆé•œåƒã€å®¹å™¨ã€å·ç­‰ï¼‰ sudo rm -rf /var/lib/docker sudo rm -rf /var/lib/containerd # 2. åˆ é™¤ Docker é…ç½®ç›®å½• sudo rm -rf /etc/docker sudo rm -rf /etc/containerd # 3. åˆ é™¤ Docker æ—¥å¿—æ–‡ä»¶ sudo rm -rf /var/log/docker sudo rm -rf /var/log/containerd # 4. åˆ é™¤ Docker è¿è¡Œæ—¶æ–‡ä»¶ sudo rm -rf /run/docker sudo rm -rf /run/containerd ğŸ” éªŒè¯å¸è½½ âœ… æ£€æŸ¥å¸è½½æ˜¯å¦å½»åº• 1 2 3 4 5 6 7 8 9 10 11 # 1. æ£€æŸ¥ Docker å‘½ä»¤æ˜¯å¦è¿˜å­˜åœ¨ which docker || echo \u0026#34;âœ… Docker å‘½ä»¤å·²ç§»é™¤\u0026#34; docker --version 2\u0026gt;/dev/null || echo \u0026#34;âœ… Docker å·²å®Œå…¨å¸è½½\u0026#34; # 2. æ£€æŸ¥ç›¸å…³è¿›ç¨‹æ˜¯å¦è¿˜åœ¨è¿è¡Œ ps aux | grep -i docker | grep -v grep ps aux | grep -i containerd | grep -v grep # 3. æ£€æŸ¥ç›¸å…³æ–‡ä»¶æ˜¯å¦å·²åˆ é™¤ ls -la /var/lib/docker 2\u0026gt;/dev/null || echo \u0026#34;âœ… /var/lib/docker å·²åˆ é™¤\u0026#34; ls -la /etc/docker 2\u0026gt;/dev/null || echo \u0026#34;âœ… /etc/docker å·²åˆ é™¤\u0026#34; ğŸ’¡ æ³¨æ„äº‹é¡¹ âš ï¸ é‡è¦æé†’ ğŸ“¦ æ•°æ®å¤‡ä»½ï¼šå¸è½½å‰åŠ¡å¿…å¤‡ä»½é‡è¦å®¹å™¨å’Œæ•°æ®ï¼Œå¸è½½è¿‡ç¨‹ä¼šåˆ é™¤æ‰€æœ‰ Docker ç›¸å…³çš„æ•°æ®ã€‚ ğŸ”’ æƒé™æ£€æŸ¥ï¼šç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œå¸è½½æ“ä½œã€‚ ğŸ”„ æœåŠ¡çŠ¶æ€ï¼šç¡®è®¤æ‰€æœ‰ç›¸å…³æœåŠ¡å·²åœæ­¢ã€‚ ğŸ“‹ ä¾èµ–å…³ç³»ï¼šæ³¨æ„å¸è½½å¯èƒ½å½±å“ä¾èµ– Docker çš„å…¶ä»–æœåŠ¡ã€‚ ğŸ”§ å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 # å¦‚æœå¸è½½é‡åˆ°ä¾èµ–é—®é¢˜ sudo apt --fix-broken install # Debian/Ubuntu sudo yum-complete-transaction # RedHat/CentOS # å¦‚æœé…ç½®æ–‡ä»¶æ— æ³•åˆ é™¤ sudo rm -rf /etc/docker /etc/containerd ğŸš€ é‡è£… Dockerï¼ˆå¦‚æœéœ€è¦ï¼‰ 1 2 3 # å¦‚æœéœ€è¦é‡æ–°å®‰è£… Docker curl -fsSL https://get.docker.com -o get-docker.sh sudo sh get-docker.sh ğŸ†˜ å¸¸è§é—®é¢˜ Q: å¸è½½ Docker åï¼Œæˆ‘çš„æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ A: æ˜¯çš„ï¼Œå¦‚æœä½ æ²¡æœ‰æå‰å¤‡ä»½æ•°æ®ï¼Œå¸è½½è¿‡ç¨‹ä¼šåˆ é™¤æ‰€æœ‰ Docker ç›¸å…³çš„æ•°æ®ï¼ŒåŒ…æ‹¬å®¹å™¨ã€é•œåƒå’Œæ•°æ®å·ã€‚å› æ­¤å¸è½½å‰åŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ã€‚\nQ: å¦‚ä½•ç¡®ä¿ Docker å·²å®Œå…¨å¸è½½ï¼Ÿ A: ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š\n1 2 docker --version # åº”è¯¥æç¤ºå‘½ä»¤æœªæ‰¾åˆ° ps aux | grep docker # ä¸åº”è¯¥æœ‰ Docker ç›¸å…³è¿›ç¨‹ Q: å¸è½½è¿‡ç¨‹ä¸­é‡åˆ°æƒé™é—®é¢˜æ€ä¹ˆåŠï¼Ÿ A: ç¡®ä¿ä½ ä½¿ç”¨äº† sudo å‘½ä»¤æˆ–å…·æœ‰ root æƒé™ã€‚å¯¹äºä¸€äº›æ®‹ç•™æ–‡ä»¶ï¼Œå¯èƒ½éœ€è¦ç›´æ¥ä»¥ root èº«ä»½åˆ é™¤ã€‚\nQ: å¸è½½åå¦‚ä½•é‡æ–°å®‰è£… Dockerï¼Ÿ A: ä½ å¯ä»¥å‚è€ƒ Docker å®˜æ–¹æ–‡æ¡£é‡æ–°å®‰è£…ï¼Œæˆ–è€…ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬ï¼š\n1 2 curl -fsSL https://get.docker.com -o get-docker.sh sudo sh get-docker.sh Q: å¦‚ä½•åˆ é™¤ Docker ç›¸å…³çš„ç”¨æˆ·å’Œç»„ï¼Ÿ A: å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤ Docker ç”¨æˆ·ç»„ï¼š\n1 sudo groupdel docker ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š\nğŸ“¥ é¡ºåˆ©å®‰è£… Docker - åœ¨ Debianã€CentOS æˆ– Ubuntu ç³»ç»Ÿä¸Šå®Œæˆå®‰è£… âš™ï¸ æ­£ç¡®é…ç½®ä¼˜åŒ– - è®¾ç½®é•œåƒåŠ é€Ÿå’Œæƒé™é…ç½® ğŸ› ï¸ æŒæ¡å¸¸ç”¨å‘½ä»¤ - å®¹å™¨ã€é•œåƒç®¡ç†å’Œæ—¥å¸¸æ“ä½œ ğŸ”’ å®æ–½å®‰å…¨æªæ–½ - ä¿éšœ Docker ç¯å¢ƒå®‰å…¨ ğŸ—‘ï¸ å½»åº•å¸è½½æ¸…ç† - å®Œå…¨ç§»é™¤ Docker åŠç›¸å…³æ•°æ® æœ¬æŒ‡å—æ¶µç›–äº† Docker çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»å®‰è£…åˆ°å¸è½½ï¼Œä¸ºæ‚¨æä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå»ºè®®æŸ¥é˜… Docker å®˜æ–¹æ–‡æ¡£ æˆ–å¯»æ±‚ç¤¾åŒºå¸®åŠ©ã€‚\nç°åœ¨å¼€å§‹äº«å—å®¹å™¨åŒ–å¸¦æ¥çš„ä¾¿åˆ©å§ï¼ğŸ³ğŸš€\n","date":"2024-12-07T07:36:56+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/57856685/","title":"Docker å®‰è£…ä¸å¸è½½æŒ‡å— ğŸ³"},{"content":"Linux é˜²ç«å¢™å‘½ä»¤ ğŸ›¡ï¸ æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†åœ¨ Ubuntu/Debian å’Œ RedHat/CentOS ç³»ç»Ÿä¸Šé…ç½®å’Œç®¡ç†é˜²ç«å¢™çš„å‘½ä»¤ï¼Œç¡®ä¿æœåŠ¡å™¨å®‰å…¨çš„åŒæ—¶ä¿æŒå¿…è¦çš„æœåŠ¡å¯è®¿é—®ã€‚\nğŸ“‘ ç›®å½•å¯¼èˆª ğŸ§ ä¸€ã€Ubuntu / Debian ç³»ç»Ÿ (UFW) ğŸ‚ äºŒã€RedHat / CentOS ç³»ç»Ÿ (FirewallD) ğŸ”„ ä¸‰ã€å¸¸ç”¨æœåŠ¡ç«¯å£å‚è€ƒ âš ï¸ å››ã€é‡è¦å®‰å…¨å»ºè®® ğŸ” äº”ã€æ•…éšœæ’é™¤å‘½ä»¤ ğŸ’¡ å…­ã€å®ç”¨æŠ€å·§ ğŸ¯ ä¸ƒã€æ€»ç»“ ğŸ§ ä¸€ã€Ubuntu / Debian ç³»ç»Ÿ (UFW) 1. ç³»ç»Ÿæ›´æ–°ä¸ UFW å®‰è£… 1 2 3 4 5 6 # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo apt update # å®‰è£… UFW (Uncomplicated Firewall) sudo apt install ufw -y # ğŸ“¦ å®‰è£…ç®€æ˜“é˜²ç«å¢™å·¥å…· 2. åŸºæœ¬é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # å…è®¸ SSH è¿æ¥ï¼ˆé‡è¦ï¼å…ˆé…ç½®å†å¯ç”¨ï¼‰ sudo ufw allow 22/tcp # ğŸ” å¦‚æœ SSH ä½¿ç”¨å…¶ä»–ç«¯å£ï¼Œæ›¿æ¢ 22 ä¸ºå®é™…ç«¯å£ # å…è®¸ 1Panel æ§åˆ¶é¢æ¿ç«¯å£ sudo ufw allow 8090/tcp # ğŸ–¥ï¸ æ›¿æ¢ 8090 ä¸ºæ‚¨çš„ 1Panel å®é™…ç«¯å£ # å¯ç”¨ UFW é˜²ç«å¢™ sudo ufw enable # ğŸš€ å¯ç”¨é˜²ç«å¢™åŠŸèƒ½ 3. é˜²ç«å¢™ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€å’Œè§„åˆ™ sudo ufw status # ğŸ“‹ æ˜¾ç¤ºå½“å‰é˜²ç«å¢™è§„åˆ™ # é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½® sudo ufw reload # ğŸ”„ åº”ç”¨é…ç½®æ›´æ”¹ # ç¦ç”¨é˜²ç«å¢™ sudo ufw disable # ğŸ›‘ ä¸´æ—¶å…³é—­é˜²ç«å¢™ # å®Œå…¨ç¦ç”¨é˜²ç«å¢™å¼€æœºè‡ªå¯ sudo systemctl disable ufw # âš ï¸ ç¦æ­¢é˜²ç«å¢™å¼€æœºè‡ªåŠ¨å¯åŠ¨ 4. é«˜çº§è§„åˆ™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 # å…è®¸ç‰¹å®šç«¯å£ sudo ufw allow 80/tcp # HTTP sudo ufw allow 443/tcp # HTTPS sudo ufw allow 3306/tcp # MySQL # å…è®¸ç‰¹å®šIPè®¿é—® sudo ufw allow from 192.168.1.100 # åˆ é™¤è§„åˆ™ sudo ufw delete allow 8090/tcp # æ‹’ç»è¿æ¥ sudo ufw deny 23/tcp # æ‹’ç»Telnet 5. åº”ç”¨é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 # é…ç½®åŸºæœ¬çš„WebæœåŠ¡å™¨é˜²ç«å¢™ sudo ufw allow 22/tcp # SSH sudo ufw allow 80/tcp # HTTP sudo ufw allow 443/tcp # HTTPS sudo ufw allow 3306/tcp # MySQL (å¦‚æœåœ¨æœ¬æœº) sudo ufw enable ğŸ‚ äºŒã€RedHat / CentOS ç³»ç»Ÿ (FirewallD) 1. ç³»ç»Ÿæ›´æ–°ä¸ FirewallD å®‰è£… 1 2 3 4 5 6 # æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ… sudo yum update -y # å®‰è£… FirewallD sudo yum install firewalld -y # ğŸ“¦ å®‰è£…é˜²ç«å¢™å®ˆæŠ¤è¿›ç¨‹ 2. é˜²ç«å¢™æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 # å¯åŠ¨ FirewallD æœåŠ¡ sudo systemctl start firewalld # è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl enable firewalld # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ sudo systemctl status firewalld 3. ç«¯å£é…ç½® 1 2 3 4 5 6 7 8 9 10 11 # å…è®¸ SSH è¿æ¥ï¼ˆé‡è¦ï¼ï¼‰ sudo firewall-cmd --zone=public --add-port=22/tcp --permanent # ğŸ” æ›¿æ¢ 22 ä¸ºæ‚¨çš„ SSH ç«¯å£ # å…è®¸ 1Panel ç«¯å£ sudo firewall-cmd --zone=public --add-port=8090/tcp --permanent # ğŸ–¥ï¸ æ›¿æ¢ 8090 ä¸ºå®é™…ç«¯å£ # é‡æ–°åŠ è½½é˜²ç«å¢™è§„åˆ™ sudo firewall-cmd --reload # ğŸ”„ ä½¿æ›´æ”¹ç”Ÿæ•ˆ 4. é˜²ç«å¢™ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹æ‰€æœ‰è§„åˆ™ sudo firewall-cmd --list-all # ğŸ“‹ æ˜¾ç¤ºå®Œæ•´é˜²ç«å¢™é…ç½® # æŸ¥çœ‹å¼€æ”¾ç«¯å£ sudo firewall-cmd --list-ports # ç«‹å³åœæ­¢é˜²ç«å¢™ sudo systemctl stop firewalld # ğŸ›‘ ä¸´æ—¶å…³é—­é˜²ç«å¢™ # ç¦ç”¨å¼€æœºè‡ªå¯ sudo systemctl disable firewalld # âš ï¸ ç¦æ­¢é˜²ç«å¢™è‡ªåŠ¨å¯åŠ¨ 5. é«˜çº§é…ç½® 1 2 3 4 5 6 7 8 9 # æ·»åŠ æœåŠ¡ï¼ˆè€Œä¸ä»…ä»…æ˜¯ç«¯å£ï¼‰ sudo firewall-cmd --zone=public --add-service=http --permanent sudo firewall-cmd --zone=public --add-service=https --permanent # é™åˆ¶ç‰¹å®šIPè®¿é—® sudo firewall-cmd --zone=public --add-rich-rule=\u0026#39;rule family=\u0026#34;ipv4\u0026#34; source address=\u0026#34;192.168.1.0/24\u0026#34; port protocol=\u0026#34;tcp\u0026#34; port=\u0026#34;22\u0026#34; accept\u0026#39; --permanent # ç§»é™¤è§„åˆ™ sudo firewall-cmd --zone=public --remove-port=8090/tcp --permanent 6. åŒºåŸŸç®¡ç† 1 2 3 4 5 6 7 8 # æŸ¥çœ‹æ‰€æœ‰å¯ç”¨åŒºåŸŸ sudo firewall-cmd --get-zones # æŸ¥çœ‹é»˜è®¤åŒºåŸŸ sudo firewall-cmd --get-default-zone # æ›´æ”¹é»˜è®¤åŒºåŸŸ sudo firewall-cmd --set-default-zone=internal ğŸ”„ ä¸‰ã€å¸¸ç”¨æœåŠ¡ç«¯å£å‚è€ƒ Web æœåŠ¡ç›¸å…³ 1 2 3 4 5 6 7 # HTTP å’Œ HTTPS sudo ufw allow 80/tcp sudo ufw allow 443/tcp # æˆ–è€…ä½¿ç”¨ FirewallD sudo firewall-cmd --add-service=http --permanent sudo firewall-cmd --add-service=https --permanent æ•°æ®åº“æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 # MySQL sudo ufw allow 3306/tcp # PostgreSQL sudo ufw allow 5432/tcp # Redis sudo ufw allow 6379/tcp # MongoDB sudo ufw allow 27017/tcp å…¶ä»–å¸¸è§æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # FTP sudo ufw allow 21/tcp # DNS sudo ufw allow 53/tcp sudo ufw allow 53/udp # SMTP sudo ufw allow 25/tcp # IMAP/POP3 sudo ufw allow 143/tcp # IMAP sudo ufw allow 993/tcp # IMAPS sudo ufw allow 110/tcp # POP3 sudo ufw allow 995/tcp # POP3S å¼€å‘ç›¸å…³ç«¯å£ 1 2 3 4 5 6 7 8 9 10 11 12 # Node.js å¼€å‘ sudo ufw allow 3000/tcp # React/Vue å¼€å‘ sudo ufw allow 8080/tcp # Django/Flask sudo ufw allow 8000/tcp # Docker sudo ufw allow 2375/tcp # Docker API sudo ufw allow 2376/tcp # Docker TLS âš ï¸ å››ã€é‡è¦å®‰å…¨å»ºè®® 1. è¿œç¨‹è¿æ¥å‰çš„å‡†å¤‡ 1 2 3 4 5 6 # åœ¨å¯ç”¨é˜²ç«å¢™å‰ï¼ŒåŠ¡å¿…å…ˆå…è®¸SSHï¼ # å¦åˆ™å¯èƒ½ä¼šè¢«é”å®šåœ¨æœåŠ¡å™¨å¤– # å¯¹äºç”Ÿäº§æœåŠ¡å™¨ï¼Œå»ºè®®ä½¿ç”¨ fail2ban å¢å¼ºå®‰å…¨ sudo apt install fail2ban # Ubuntu/Debian sudo yum install fail2ban # CentOS/RHEL 2. æœ€å°æƒé™åŸåˆ™ 1 2 3 4 5 6 7 # åªå¼€æ”¾å¿…è¦çš„ç«¯å£ # å®šæœŸå®¡æŸ¥é˜²ç«å¢™è§„åˆ™ sudo ufw status numbered # æŸ¥çœ‹å¸¦ç¼–å·çš„è§„åˆ™ sudo ufw delete [ç¼–å·] # åˆ é™¤ä¸éœ€è¦çš„è§„åˆ™ # FirewallD æŸ¥çœ‹è¯¦ç»†è§„åˆ™ sudo firewall-cmd --list-all --zone=public 3. å¤‡ä»½é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 7 # Ubuntu/Debian sudo cp /etc/ufw/user.rules /etc/ufw/user.rules.backup sudo cp /etc/ufw/before.rules /etc/ufw/before.rules.backup # CentOS/RHEL sudo firewall-cmd --runtime-to-permanent sudo cp /etc/firewalld/zones/public.xml /etc/firewalld/zones/public.xml.backup 4. å®šæœŸå®‰å…¨å®¡è®¡ 1 2 3 4 5 6 7 8 # æ£€æŸ¥ä¸å¿…è¦çš„å¼€æ”¾ç«¯å£ sudo ufw status verbose # æŸ¥çœ‹é˜²ç«å¢™æ—¥å¿— sudo tail -n 50 /var/log/ufw.log # æ£€æŸ¥å¼‚å¸¸è¿æ¥å°è¯• sudo grep -i \u0026#34;denied\u0026#34; /var/log/ufw.log ğŸ” äº”ã€æ•…éšœæ’é™¤å‘½ä»¤ 1. æ£€æŸ¥ç«¯å£çŠ¶æ€ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ç«¯å£ç›‘å¬çŠ¶æ€ sudo netstat -tulnp # æˆ–è€…ä½¿ç”¨ ss å‘½ä»¤ sudo ss -tulnp # æ£€æŸ¥ç‰¹å®šç«¯å£ sudo netstat -tulnp | grep :80 2. æµ‹è¯•è¿æ¥ 1 2 3 4 5 6 7 8 # ä»æœ¬åœ°æµ‹è¯•ç«¯å£è¿é€šæ€§ telnet your-server-ip 22 # æˆ–è€…ä½¿ç”¨ nc nc -zv your-server-ip 8090 # ä½¿ç”¨ curl æµ‹è¯• HTTP æœåŠ¡ curl -I http://your-server-ip:80 3. æŸ¥çœ‹æ—¥å¿— 1 2 3 4 5 6 # æŸ¥çœ‹é˜²ç«å¢™æ—¥å¿— sudo tail -f /var/log/ufw.log # Ubuntu/Debian sudo journalctl -u firewalld -f # CentOS/RHEL # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„é˜²ç«å¢™ç›¸å…³æ¶ˆæ¯ sudo dmesg | grep -i firewall 4. é‡ç½®é˜²ç«å¢™é…ç½® 1 2 3 4 5 6 # UFW é‡ç½®åˆ°é»˜è®¤çŠ¶æ€ sudo ufw reset # FirewallD é‡ç½®é…ç½® sudo firewall-cmd --reset-to-defaults sudo systemctl restart firewalld ğŸ’¡ å…­ã€å®ç”¨æŠ€å·§ 1. æ‰¹é‡å¼€æ”¾ç«¯å£èŒƒå›´ 1 2 3 4 5 # UFW sudo ufw allow 8000:8010/tcp # FirewallD sudo firewall-cmd --add-port=8000-8010/tcp --permanent 2. é™åˆ¶è®¿é—®é¢‘ç‡ 1 2 3 4 5 # UFW é€Ÿç‡é™åˆ¶ï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰ sudo ufw limit ssh # FirewallD ä½¿ç”¨ rich rules sudo firewall-cmd --add-rich-rule=\u0026#39;rule service name=\u0026#34;ssh\u0026#34; limit value=\u0026#34;5/m\u0026#34; accept\u0026#39; --permanent 3. åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 # å¤‡ä»½å½“å‰é…ç½® sudo ufw export backup.rules # å¯¼å…¥é…ç½® sudo ufw import backup.rules # FirewallD å¯¼å‡ºé…ç½® sudo firewall-cmd --list-all --permanent \u0026gt; firewall-backup.xml 4. ä½¿ç”¨ IP é›†ç®¡ç†å¤šä¸ª IP 1 2 3 4 5 # åˆ›å»º IP é›†ï¼ˆFirewallDï¼‰ sudo firewall-cmd --permanent --new-ipset=trusted --type=hash:ip sudo firewall-cmd --permanent --ipset=trusted --add-entry=192.168.1.100 sudo firewall-cmd --permanent --ipset=trusted --add-entry=192.168.1.101 sudo firewall-cmd --permanent --add-rich-rule=\u0026#39;rule source ipset=trusted accept\u0026#39; 5. å®šæ—¶å¼€æ”¾ç«¯å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä½¿ç”¨ cron å®šæ—¶ä»»åŠ¡ç®¡ç†é˜²ç«å¢™ # ä¾‹å¦‚ï¼šåªåœ¨å·¥ä½œæ—¶é—´å¼€æ”¾æŸäº›ç«¯å£ # åˆ›å»ºå¼€æ”¾ç«¯å£çš„è„šæœ¬ echo \u0026#39;sudo ufw allow 3389/tcp\u0026#39; \u0026gt; /usr/local/bin/open-rdp chmod +x /usr/local/bin/open-rdp # åˆ›å»ºå…³é—­ç«¯å£çš„è„šæœ¬ echo \u0026#39;sudo ufw delete allow 3389/tcp\u0026#39; \u0026gt; /usr/local/bin/close-rdp chmod +x /usr/local/bin/close-rdp # è®¾ç½®å®šæ—¶ä»»åŠ¡ crontab -e # æ·»åŠ ä»¥ä¸‹è¡Œï¼š # 0 8 * * 1-5 /usr/local/bin/open-rdp # 0 18 * * 1-5 /usr/local/bin/close-rdp ğŸ¯ ä¸ƒã€æ€»ç»“ å…³é”®è¦ç‚¹å›é¡¾ ç³»ç»Ÿé€‰æ‹©ï¼š\nUbuntu/Debian: ä½¿ç”¨ UFW (Uncomplicated Firewall) CentOS/RHEL: ä½¿ç”¨ FirewallD åŸºæœ¬æµç¨‹ï¼š\nå®‰è£…é˜²ç«å¢™è½¯ä»¶ å…ˆå…è®¸ SSH è¿æ¥ é…ç½®å¿…è¦çš„æœåŠ¡ç«¯å£ å¯ç”¨é˜²ç«å¢™ å®šæœŸå®¡æŸ¥è§„åˆ™ å®‰å…¨æœ€ä½³å®è·µï¼š\néµå¾ªæœ€å°æƒé™åŸåˆ™ å®šæœŸå¤‡ä»½é…ç½® ç›‘æ§é˜²ç«å¢™æ—¥å¿— ä½¿ç”¨ fail2ban ç­‰å·¥å…·å¢å¼ºå®‰å…¨ æ•…éšœæ’é™¤ï¼š\næ£€æŸ¥ç«¯å£çŠ¶æ€ æµ‹è¯•è¿æ¥ æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ å¿…è¦æ—¶é‡ç½®é…ç½® ä¸‹ä¸€æ­¥å»ºè®® æ·±å…¥å­¦ä¹ ï¼š\nç ”ç©¶ iptables (UFW å’Œ FirewallD çš„åº•å±‚å·¥å…·) å­¦ä¹ ç½‘ç»œåˆ†æ®µå’Œ VLAN é…ç½® äº†è§£å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ (IDS) è‡ªåŠ¨åŒ–ç®¡ç†ï¼š\nç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–é˜²ç«å¢™é…ç½® ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…· (Ansible, Puppet, Chef) å®ç°åŸºç¡€è®¾æ–½å³ä»£ç  (IaC) ç›‘æ§å’Œå‘Šè­¦ï¼š\nè®¾ç½®é˜²ç«å¢™äº‹ä»¶ç›‘æ§ é…ç½®å¼‚å¸¸è¿æ¥å‘Šè­¦ å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡ ğŸ›¡ï¸ é‡è¦æé†’: é€šè¿‡åˆç†é…ç½®é˜²ç«å¢™ï¼Œæ‚¨å¯ä»¥æ˜¾è‘—æå‡æœåŠ¡å™¨å®‰å…¨æ€§ã€‚è®°å¾—å§‹ç»ˆå…ˆå…è®¸SSHè¿æ¥å†å¯ç”¨é˜²ç«å¢™ï¼Œé¿å…è¢«é”å®šåœ¨æœåŠ¡å™¨å¤–ï¼\nç°åœ¨æ‚¨å·²ç»æŒæ¡äº† Linux é˜²ç«å¢™çš„å…¨é¢çŸ¥è¯†ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚çµæ´»é…ç½®å®‰å…¨ç­–ç•¥äº†ã€‚è®°å¾—å®šæœŸå®¡æŸ¥å’Œæ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼Œç¡®ä¿æœåŠ¡å™¨å®‰å…¨çš„åŒæ—¶ä¿æŒæœåŠ¡çš„å¯è®¿é—®æ€§ã€‚\n","date":"2024-12-07T07:31:27+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e5fa7edb/","title":"Linux é˜²ç«å¢™å‘½ä»¤ ğŸ›¡ï¸"},{"content":"Docker Compose å®‰è£…æŒ‡å— ğŸ³ æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ä¸åŒæ¶æ„çš„ Linux ç³»ç»Ÿä¸Šå®‰è£… Docker Composeï¼ŒåŒ…æ‹¬ x86_64 å’Œ ARM æ¶æ„ï¼Œå¹¶æä¾›å›½å†…å¤–é•œåƒæºçš„é€‰æ‹©ã€‚\nç›®å½• ğŸ“š âœ¨ Docker Compose ç®€ä»‹ ğŸš€ ä¸€ã€Linux x86_64 æ¶æ„å®‰è£… ğŸ“ äºŒã€iStoreOS (ARM æ¶æ„) å®‰è£… ğŸ” ä¸‰ã€éªŒè¯å®‰è£… âš™ï¸ å››ã€é«˜çº§é…ç½®å’Œä¼˜åŒ– ğŸ”§ äº”ã€æ•…éšœæ’é™¤ ğŸ“Š å…­ã€ç‰ˆæœ¬ç®¡ç† ğŸ¯ æ€»ç»“ ğŸŒŸ æ¸©é¦¨æç¤º âœ¨ Docker Compose ç®€ä»‹ Docker Compose æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡ä¸€ä¸ª YAML æ–‡ä»¶é…ç½®åº”ç”¨æœåŠ¡ï¼Œå°±å¯ä»¥ä½¿ç”¨å•ä¸ªå‘½ä»¤åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚\nğŸŒŸ ä¸»è¦ç‰¹æ€§ ğŸš€ ç®€åŒ–å¤šå®¹å™¨åº”ç”¨éƒ¨ç½²ï¼šä½¿ç”¨ç®€å•çš„ YAML æ–‡ä»¶å®šä¹‰å¤æ‚çš„å¤šå®¹å™¨åº”ç”¨ ğŸ”„ ç¯å¢ƒéš”ç¦»ï¼šæ”¯æŒä¸ºä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰åˆ›å»ºç‹¬ç«‹çš„é…ç½® ğŸ“¦ æœåŠ¡ä¾èµ–ç®¡ç†ï¼šè‡ªåŠ¨å¤„ç†æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œå¯åŠ¨é¡ºåº âš¡ å¿«é€Ÿæ‰©å±•ï¼šè½»æ¾æ‰©å±•æœåŠ¡çš„å®ä¾‹æ•°é‡ ğŸ”§ å¼€å‘æ•ˆç‡ï¼šæä¾›çƒ­é‡è½½ã€æ—¥å¿—èšåˆç­‰å¼€å‘å‹å¥½åŠŸèƒ½ ğŸŒ è·¨å¹³å°å…¼å®¹ï¼šæ”¯æŒ Linuxã€Windows å’Œ macOS å¹³å° å®˜æ–¹èµ„æºï¼š\nGitHub åœ°å€ï¼šhttps://github.com/docker/compose/releases å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.docker.com/compose/ å›½å†…é•œåƒåœ°å€ï¼šhttps://mirror.azure.cn/docker-toolbox/linux/compose ğŸš€ ä¸€ã€Linux x86_64 æ¶æ„å®‰è£… 1. FnOS GitHub å®˜æ–¹æºå®‰è£… 1 2 3 4 # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Docker Compose sudo curl -L \u0026#34;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose \u0026amp;\u0026amp; \\ sudo chmod +x /usr/local/bin/docker-compose \u0026amp;\u0026amp; \\ docker-compose version 2. FnOS å›½å†…é•œåƒæºå®‰è£… 1 2 3 4 # ä½¿ç”¨å›½å†…é•œåƒä¸‹è½½ Docker Compose sudo curl -L \u0026#34;https://mirror.azure.cn/docker-toolbox/linux/compose/v2.29.2/docker-compose-linux-x86_64\u0026#34; -o /usr/local/bin/docker-compose \u0026amp;\u0026amp; \\ sudo chmod +x /usr/local/bin/docker-compose \u0026amp;\u0026amp; \\ docker-compose version éªŒè¯å®‰è£… 1 ls -la /usr/local/bin/docker-compose 3. Debian GitHub å®˜æ–¹æºå®‰è£… 1 2 3 4 # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Docker Compose sudo curl -L \u0026#34;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/bin/docker-compose \u0026amp;\u0026amp; \\ sudo chmod +x /usr/bin/docker-compose \u0026amp;\u0026amp; \\ docker-compose version 4. Debian å›½å†…é•œåƒæºå®‰è£… 1 2 3 4 # ä½¿ç”¨å›½å†…é•œåƒä¸‹è½½ Docker Compose sudo curl -L \u0026#34;https://mirror.azure.cn/docker-toolbox/linux/compose/v2.29.2/docker-compose-linux-x86_64\u0026#34; -o /usr/bin/docker-compose \u0026amp;\u0026amp; \\ sudo chmod +x /usr/bin/docker-compose \u0026amp;\u0026amp; \\ docker-compose version éªŒè¯å®‰è£… 1 ls -la /usr/bin/docker-compose 5. å¸è½½æ—§ç‰ˆæœ¬ 1 2 3 4 5 6 7 8 9 # åˆ é™¤ç°æœ‰ Docker Compose sudo rm -rf /usr/local/bin/docker-compose sudo rm -rf /usr/bin/docker-compose # ç¡®è®¤å·²åˆ é™¤ which docker-compose || echo \u0026#34;Docker Compose å·²æˆåŠŸç§»é™¤\u0026#34; # åŒæ—¶åˆ é™¤è‡ªåŠ¨è¡¥å…¨æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ sudo rm -f /etc/bash_completion.d/docker-compose ğŸ“ äºŒã€iStoreOS (ARM æ¶æ„) å®‰è£… 1ï¸âƒ£ ç¡®å®šç³»ç»Ÿæ¶æ„ åœ¨å®‰è£…å‰ï¼Œè¯·å…ˆç¡®å®šæ‚¨çš„ç³»ç»Ÿæ¶æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 # æŸ¥çœ‹ç³»ç»Ÿæ¶æ„ uname -m # å¯èƒ½çš„è¾“å‡ºï¼š # - x86_64: Intel/AMD 64ä½æ¶æ„ # - aarch64: ARM 64ä½æ¶æ„ # - armv7l: ARM 32ä½æ¶æ„ # æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯ cat /etc/os-release 2ï¸âƒ£ ARM64 (aarch64) æ¶æ„å®‰è£… ä» GitHub å®˜æ–¹æºå®‰è£… 1 2 3 4 5 6 7 8 9 # ä¸‹è½½ ARM64 ç‰ˆæœ¬çš„ Docker Compose COMPOSE_VERSION=\u0026#34;v2.29.2\u0026#34; sudo wget -O /usr/local/bin/docker-compose \u0026#34;https://github.com/docker/compose/releases/download/${COMPOSE_VERSION}/docker-compose-linux-aarch64\u0026#34; # æ·»åŠ æ‰§è¡Œæƒé™ sudo chmod +x /usr/local/bin/docker-compose # éªŒè¯å®‰è£… ls -la /usr/local/bin/docker-compose ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå®‰è£… 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨å›½å†…é•œåƒä¸‹è½½ ARM64 ç‰ˆæœ¬ COMPOSE_VERSION=\u0026#34;v2.29.2\u0026#34; sudo wget -O /usr/local/bin/docker-compose \u0026#34;https://mirror.azure.cn/docker-toolbox/linux/compose/${COMPOSE_VERSION}/docker-compose-linux-aarch64\u0026#34; # æ·»åŠ æ‰§è¡Œæƒé™ sudo chmod +x /usr/local/bin/docker-compose # éªŒè¯æ–‡ä»¶ file /usr/local/bin/docker-compose 3ï¸âƒ£ ARMv7 (armv7l) æ¶æ„å®‰è£… 1 2 3 4 5 6 7 8 9 # å¯¹äº ARMv7 æ¶æ„ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶ COMPOSE_VERSION=\u0026#34;v2.29.2\u0026#34; sudo wget -O /usr/local/bin/docker-compose \u0026#34;https://github.com/docker/compose/releases/download/${COMPOSE_VERSION}/docker-compose-linux-armv7\u0026#34; # æ·»åŠ æ‰§è¡Œæƒé™ sudo chmod +x /usr/local/bin/docker-compose # éªŒè¯å®‰è£… docker-compose --version 4ï¸âƒ£ å¸è½½æ—§ç‰ˆæœ¬ 1 2 3 4 5 6 # åˆ é™¤ç°æœ‰ Docker Compose sudo rm -rf /usr/local/bin/docker-compose sudo rm -rf /usr/bin/docker-compose # ç¡®è®¤å·²åˆ é™¤ which docker-compose || echo \u0026#34;Docker Compose å·²æˆåŠŸç§»é™¤\u0026#34; ğŸ” ä¸‰ã€éªŒè¯å®‰è£… 1ï¸âƒ£ æ£€æŸ¥ Docker Compose ç‰ˆæœ¬ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹ Docker Compose ç‰ˆæœ¬ docker-compose --version # æˆ–è€…ä½¿ç”¨æ›´è¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯ docker-compose version # æ£€æŸ¥ Docker Compose æ˜¯å¦æ­£å¸¸å·¥ä½œ docker-compose --help | head -10 2ï¸âƒ£ æµ‹è¯• Docker Compose åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•é…ç½® mkdir -p /tmp/test-compose \u0026amp;\u0026amp; cd /tmp/test-compose cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; version: \u0026#39;3.8\u0026#39; services: hello-world: image: hello-world container_name: test-hello-world EOF # è¿è¡Œæµ‹è¯• docker-compose up # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ docker-compose ps # åœæ­¢å¹¶ç§»é™¤å®¹å™¨ docker-compose down # æ¸…ç†æµ‹è¯•æ–‡ä»¶ cd ~ \u0026amp;\u0026amp; rm -rf /tmp/test-compose 3ï¸âƒ£ éªŒè¯æ¶æ„å…¼å®¹æ€§ 1 2 3 4 5 6 # æ£€æŸ¥ Docker Compose äºŒè¿›åˆ¶æ–‡ä»¶çš„æ¶æ„ file $(which docker-compose) # æ£€æŸ¥ç³»ç»Ÿæ¶æ„ä¸ Docker Compose æ˜¯å¦åŒ¹é… echo \u0026#34;ç³»ç»Ÿæ¶æ„: $(uname -m)\u0026#34; echo \u0026#34;Docker Compose æ¶æ„: $(file $(which docker-compose) | grep -o \u0026#39;ELF [^,]*\u0026#39; | cut -d\u0026#39; \u0026#39; -f2)\u0026#34; âš™ï¸ å››ã€é«˜çº§é…ç½®å’Œä¼˜åŒ– 1ï¸âƒ£ è®¾ç½®å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ 1 2 3 4 5 6 7 8 9 10 11 # ä¸º Docker Compose è®¾ç½® Bash è‡ªåŠ¨è¡¥å…¨ COMPOSE_VERSION=$(docker-compose version --short) sudo curl -L \u0026#34;https://raw.githubusercontent.com/docker/compose/${COMPOSE_VERSION}/contrib/completion/bash/docker-compose\u0026#34; -o /etc/bash_completion.d/docker-compose # é‡æ–°åŠ è½½ Bash é…ç½® source /etc/bash_completion.d/docker-compose # å¯¹äºå½“å‰ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥å®‰è£…åˆ°ç”¨æˆ·ç›®å½• curl -L \u0026#34;https://raw.githubusercontent.com/docker/compose/${COMPOSE_VERSION}/contrib/completion/bash/docker-compose\u0026#34; -o ~/.docker-compose-completion.bash echo \u0026#34;source ~/.docker-compose-completion.bash\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc 2ï¸âƒ£ åˆ›å»ºåˆ«åç®€åŒ–å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨ ~/.bashrc æˆ– ~/.zshrc ä¸­æ·»åŠ åˆ«å echo \u0026#34;alias dc=\u0026#39;docker-compose\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dcup=\u0026#39;docker-compose up -d\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dcdown=\u0026#39;docker-compose down\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dclogs=\u0026#39;docker-compose logs -f\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dcpull=\u0026#39;docker-compose pull\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dcbuild=\u0026#39;docker-compose build\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dcrestart=\u0026#39;docker-compose restart\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;alias dcps=\u0026#39;docker-compose ps\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.bashrc # é‡æ–°åŠ è½½é…ç½® source ~/.bashrc 3ï¸âƒ£ ä½¿ç”¨ Docker Compose V2 Docker Compose V2 æ˜¯ä½œä¸º Docker CLI æ’ä»¶æä¾›çš„ï¼Œå®‰è£…æ–¹æ³•ç•¥æœ‰ä¸åŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åˆ›å»º Docker CLI æ’ä»¶ç›®å½• mkdir -p ~/.docker/cli-plugins # ä¸‹è½½ Docker Compose V2 COMPOSE_VERSION=\u0026#34;v2.29.2\u0026#34; curl -SL \u0026#34;https://github.com/docker/compose/releases/download/${COMPOSE_VERSION}/docker-compose-linux-$(uname -m)\u0026#34; -o ~/.docker/cli-plugins/docker-compose # æ·»åŠ æ‰§è¡Œæƒé™ chmod +x ~/.docker/cli-plugins/docker-compose # éªŒè¯å®‰è£… docker compose version # è®¾ç½®ç³»ç»Ÿçº§å®‰è£…ï¼ˆå¯é€‰ï¼‰ sudo mkdir -p /usr/local/lib/docker/cli-plugins sudo cp ~/.docker/cli-plugins/docker-compose /usr/local/lib/docker/cli-plugins/ 4ï¸âƒ£ é…ç½® Docker Compose ç¯å¢ƒ 1 2 3 4 5 6 7 8 # è®¾ç½® Docker Compose ç¯å¢ƒå˜é‡ echo \u0026#34;export COMPOSE_HTTP_TIMEOUT=120\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;export COMPOSE_PARALLEL_LIMIT=10\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;export COMPOSE_FILE=docker-compose.yml:docker-compose.override.yml\u0026#34; \u0026gt;\u0026gt; ~/.bashrc echo \u0026#34;export COMPOSE_PROJECT_NAME=myproject\u0026#34; \u0026gt;\u0026gt; ~/.bashrc # é‡æ–°åŠ è½½é…ç½® source ~/.bashrc ğŸ”§ äº”ã€æ•…éšœæ’é™¤ â“ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ æƒé™ä¸è¶³é”™è¯¯ï¼š\n1 2 3 4 5 6 # ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œå‘½ä»¤ sudo chmod +x /usr/local/bin/docker-compose # æˆ–è€…å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ sudo usermod -aG docker $USER newgrp docker æ¶æ„ä¸åŒ¹é…é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥ç³»ç»Ÿæ¶æ„ uname -m # æ ¹æ®æ¶æ„ä¸‹è½½æ­£ç¡®çš„ç‰ˆæœ¬ ARCH=$(uname -m) if [ \u0026#34;$ARCH\u0026#34; = \u0026#34;x86_64\u0026#34; ]; then # ä¸‹è½½ x86_64 ç‰ˆæœ¬ elif [ \u0026#34;$ARCH\u0026#34; = \u0026#34;aarch64\u0026#34; ]; then # ä¸‹è½½ ARM64 ç‰ˆæœ¬ elif [ \u0026#34;$ARCH\u0026#34; = \u0026#34;armv7l\u0026#34; ]; then # ä¸‹è½½ ARMv7 ç‰ˆæœ¬ fi å‘½ä»¤æœªæ‰¾åˆ°é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥æ˜¯å¦åœ¨ PATH ä¸­ echo $PATH # æˆ–è€…åˆ›å»ºç¬¦å·é“¾æ¥ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ ls -la /usr/local/bin/docker-compose ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥ Docker Engine ç‰ˆæœ¬ docker version # æ£€æŸ¥ Docker Compose ç‰ˆæœ¬ docker-compose version # ç¡®ä¿ Docker Compose ç‰ˆæœ¬ä¸ Docker Engine å…¼å®¹ # é€šå¸¸æœ€æ–°ç‰ˆæœ¬çš„ Docker Compose ä¸è¾ƒæ–°ç‰ˆæœ¬çš„ Docker Engine å…¼å®¹ è¯ä¹¦é—®é¢˜ï¼š\n1 2 3 4 5 # å¦‚æœé‡åˆ° SSL è¯ä¹¦é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶è·³è¿‡éªŒè¯ sudo curl -k -L \u0026#34;https://github.com/docker/compose/releases/download/v2.29.2/docker-compose-linux-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose # æˆ–è€…ä½¿ç”¨ HTTP æ›¿ä»£ HTTPS sudo curl -L \u0026#34;http://github.com/docker/compose/releases/download/v2.29.2/docker-compose-linux-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose ğŸ› è¯Šæ–­å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # æ£€æŸ¥ Docker Compose å®‰è£…è·¯å¾„ which docker-compose # æ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œæ¶æ„ file $(which docker-compose) # æ£€æŸ¥æ‰§è¡Œæƒé™ ls -la $(which docker-compose) # æ£€æŸ¥ä¾èµ–åº“ ldd $(which docker-compose) # æ£€æŸ¥ç³»ç»Ÿæ¶æ„ uname -m # æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€ systemctl status docker # æ£€æŸ¥ç”¨æˆ·ç»„ membership groups $USER # æ£€æŸ¥ Docker Compose ç‰ˆæœ¬å…¼å®¹æ€§ docker-compose version docker version ğŸ“Š å…­ã€ç‰ˆæœ¬ç®¡ç† 1ï¸âƒ£ å®‰è£…ç‰¹å®šç‰ˆæœ¬ 1 2 3 4 5 6 7 8 # å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ Docker Compose VERSION=\u0026#34;2.29.2\u0026#34; ARCH=$(uname -m) sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/v${VERSION}/docker-compose-linux-${ARCH}\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose # éªŒè¯ç‰ˆæœ¬ docker-compose --version 2ï¸âƒ£ å¤šç‰ˆæœ¬ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # åˆ›å»ºç‰ˆæœ¬ç®¡ç†ç›®å½• mkdir -p ~/bin/docker-compose # ä¸‹è½½å¤šä¸ªç‰ˆæœ¬ curl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.29.2/docker-compose-linux-$(uname -m)\u0026#34; -o ~/bin/docker-compose/docker-compose-2.29.2 curl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.28.1/docker-compose-linux-$(uname -m)\u0026#34; -o ~/bin/docker-compose/docker-compose-2.28.1 curl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.27.0/docker-compose-linux-$(uname -m)\u0026#34; -o ~/bin/docker-compose/docker-compose-2.27.0 # æ·»åŠ æ‰§è¡Œæƒé™ chmod +x ~/bin/docker-compose/* # è®¾ç½®å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ ln -sf ~/bin/docker-compose/docker-compose-2.29.2 /usr/local/bin/docker-compose # åˆ›å»ºåˆ‡æ¢ç‰ˆæœ¬çš„è„šæœ¬ cat \u0026gt; /usr/local/bin/dc-version \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash if [ $# -eq 0 ]; then echo \u0026#34;å¯ç”¨ç‰ˆæœ¬:\u0026#34; ls ~/bin/docker-compose/ | sed \u0026#39;s/docker-compose-//g\u0026#39; exit 0 fi VERSION=$1 if [ -f ~/bin/docker-compose/docker-compose-${VERSION} ]; then ln -sf ~/bin/docker-compose/docker-compose-${VERSION} /usr/local/bin/docker-compose echo \u0026#34;å·²åˆ‡æ¢åˆ° Docker Compose ç‰ˆæœ¬: ${VERSION}\u0026#34; docker-compose --version else echo \u0026#34;é”™è¯¯: ç‰ˆæœ¬ ${VERSION} ä¸å­˜åœ¨\u0026#34; exit 1 fi EOF chmod +x /usr/local/bin/dc-version 3ï¸âƒ£ ç‰ˆæœ¬å‡çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ£€æŸ¥å½“å‰ç‰ˆæœ¬ docker-compose --version # å¤‡ä»½å½“å‰ç‰ˆæœ¬ cp $(which docker-compose) $(which docker-compose).bak # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ LATEST_VERSION=$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep \u0026#39;\u0026#34;tag_name\u0026#34;:\u0026#39; | sed -E \u0026#39;s/.*\u0026#34;([^\u0026#34;]+)\u0026#34;.*/\\1/\u0026#39;) sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/${LATEST_VERSION}/docker-compose-linux-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose # éªŒè¯æ–°ç‰ˆæœ¬ docker-compose --version ğŸ¯ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„æŒ‡å¯¼ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š\nâœ… å¤šç§æ¶æ„æ”¯æŒï¼šx86_64ã€ARM64 (aarch64) å’Œ ARMv7 æ¶æ„çš„å®‰è£…æ–¹æ³• âœ… å¤šæºé€‰æ‹©ï¼šå›½å†…å¤–é•œåƒæºçš„å®‰è£…æ–¹å¼ï¼ŒåŒ…æ‹¬å®˜æ–¹ GitHub å’Œå›½å†…é•œåƒ âœ… ç‰ˆæœ¬ç®¡ç†ï¼šå®‰è£…ç‰¹å®šç‰ˆæœ¬ã€ç®¡ç†å¤šç‰ˆæœ¬å’Œå‡çº§ç‰ˆæœ¬çš„æ–¹æ³• âœ… æ•…éšœæ’é™¤ï¼šå¸¸è§é—®é¢˜çš„è¯Šæ–­å’Œè§£å†³æ–¹æ³• âœ… é«˜çº§é…ç½®ï¼šè‡ªåŠ¨è¡¥å…¨ã€åˆ«åè®¾ç½®ã€ç¯å¢ƒå˜é‡ç­‰ä¼˜åŒ–é…ç½® âœ… éªŒè¯æ–¹æ³•ï¼šå®‰è£…åçš„éªŒè¯å’Œæµ‹è¯•æ–¹æ³• ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨ Docker Compose æ¥ç®¡ç†å¤šå®¹å™¨åº”ç”¨äº†ï¼ğŸ³ğŸš€\nğŸŒŸ æ¸©é¦¨æç¤º ç‰ˆæœ¬å…¼å®¹æ€§ï¼šç¡®ä¿ Docker Compose ç‰ˆæœ¬ä¸ Docker Engine å…¼å®¹ï¼Œå»ºè®®ä½¿ç”¨ç›¸åŒçš„ä¸»è¦ç‰ˆæœ¬ å®šæœŸæ›´æ–°ï¼šå®šæœŸæ£€æŸ¥å¹¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ä»¥è·å¾—æ–°åŠŸèƒ½å’Œå®‰å…¨è¡¥ä¸ å¤‡ä»½é…ç½®ï¼šé‡è¦çš„ docker-compose.yml æ–‡ä»¶åº”çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰ å®‰å…¨è€ƒè™‘ï¼šä»å®˜æ–¹æºæˆ–å¯ä¿¡é•œåƒä¸‹è½½ï¼Œé¿å…ä½¿ç”¨æœªç»éªŒè¯çš„äºŒè¿›åˆ¶æ–‡ä»¶ æ–‡æ¡£å‚è€ƒï¼šæŸ¥é˜…å®˜æ–¹æ–‡æ¡£äº†è§£æœ€æ–°åŠŸèƒ½å’Œæœ€ä½³å®è·µ æ€§èƒ½ä¼˜åŒ–ï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œè°ƒæ•´ COMPOSE_HTTP_TIMEOUT å’Œ COMPOSE_PARALLEL_LIMIT ç¯å¢ƒå˜é‡ ç½‘ç»œè€ƒè™‘ï¼šåœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥è®¾ç½®æœ¬åœ°é•œåƒä»“åº“åŠ é€Ÿä¸‹è½½ ç›‘æ§æ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥ Docker Compose æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ å¼€å§‹ä½¿ç”¨ Docker Compose ç®€åŒ–æ‚¨çš„å®¹å™¨ç¼–æ’å·¥ä½œå§ï¼ğŸ‰\n","date":"2024-12-07T07:24:58+08:00","image":"https://file.meimolihan.eu.org/img/docker-compose-01.webp","permalink":"https://blog.meimolihan.eu.org/p/67856874/","title":"Docker Compose å®‰è£…æŒ‡å— ğŸ³"},{"content":"iStoreOS ç«¯å£è½¬å‘ iptables è§„åˆ™é…ç½® ğŸ› ï¸ ä¸€ä»½è¯¦å°½çš„ iStoreOS (åŸºäº OpenWrt) iptables ç«¯å£è½¬å‘é…ç½®æŒ‡å—ï¼Œå¸®åŠ©æ‚¨å®ç°å†…ç½‘æœåŠ¡çš„è¿œç¨‹è®¿é—®\nç›®å½• ğŸ“š ğŸŒ ç½‘ç»œç¯å¢ƒæ¦‚è¿° ğŸ“‹ é…ç½®å‰å‡†å¤‡ ğŸ¯ æ–¹æ¡ˆä¸€ï¼šç½‘å…³æŒ‡å‘ä¸»è·¯ç”±æ—¶çš„é…ç½® ğŸ”„ æ–¹æ¡ˆäºŒï¼šç½‘å…³æŒ‡å‘æ—è·¯ç”±æ—¶çš„é…ç½® ğŸ“ æ–¹æ¡ˆä¸‰ï¼šè¿½åŠ é…ç½®ï¼ˆä¸è¦†ç›–åŸæœ‰è§„åˆ™ï¼‰ ğŸ› ï¸ é«˜çº§é…ç½®æŠ€å·§ ğŸ” éªŒè¯å’Œè°ƒè¯• âš ï¸ å¸¸è§é—®é¢˜è§£å†³ ğŸ“Š é…ç½®ç®¡ç†å»ºè®® ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸ’¡ æ ¸å¿ƒåŸç†ä¸æ³¨æ„äº‹é¡¹ ğŸŒ ç½‘ç»œç¯å¢ƒæ¦‚è¿° è®¾å¤‡ IPåœ°å€ è§’è‰² å¤‡æ³¨ ä¸»è·¯ç”± OpenWrt 10.10.10.253 ç½‘å…³/NAT ä¸»è¦ç½‘ç»œå…¥å£ æ—è·¯ç”± OpenWrt 10.10.10.252 è¾…åŠ©è·¯ç”± ç‰¹æ®ŠæœåŠ¡å¤„ç† Windows æ¡Œé¢ 10.10.10.249:3389 ç›®æ ‡æœåŠ¡ è¿œç¨‹æ¡Œé¢æœåŠ¡ Sun-panel æœåŠ¡ 10.10.10.251:3002 WebæœåŠ¡ å†…éƒ¨Webåº”ç”¨ ğŸ“‹ é…ç½®å‰å‡†å¤‡ 1. å¯ç”¨ IP è½¬å‘åŠŸèƒ½ åœ¨é…ç½®ç«¯å£è½¬å‘å‰ï¼Œéœ€è¦ç¡®ä¿ç³»ç»Ÿå·²å¯ç”¨ IP è½¬å‘åŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 # ç¼–è¾‘ sysctl.conf æ–‡ä»¶ vi /etc/sysctl.conf # æ‰¾åˆ°å¹¶å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼ˆæˆ–æ·»åŠ å®ƒï¼‰ net.ipv4.ip_forward = 1 # ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆ sysctl -p 2. æ£€æŸ¥å½“å‰é˜²ç«å¢™è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹ç°æœ‰ NAT è§„åˆ™ iptables -t nat -L -n -v # æŸ¥çœ‹ PREROUTING é“¾ iptables -t nat -L PREROUTING -n -v # æŸ¥çœ‹ POSTROUTING é“¾ iptables -t nat -L POSTROUTING -n -v # æŸ¥çœ‹ Filter è¡¨ä¸­çš„ FORWARD è§„åˆ™ï¼ˆç¡®ä¿è½¬å‘ä¸è¢«é˜»æ­¢ï¼‰ iptables -L FORWARD -n -v 3. å¤‡ä»½åŸé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 # å¤‡ä»½é˜²ç«å¢™é…ç½® cp /etc/firewall.user /etc/firewall.user.backup.$(date +%Y%m%d) # å¤‡ä»½ç½‘ç»œé…ç½® cp /etc/config/network /etc/config/network.backup.$(date +%Y%m%d) # å¦‚æœéœ€è¦ï¼Œå¤‡ä»½å½“å‰çš„ iptables è§„åˆ™ iptables-save \u0026gt; /root/iptables.backup.$(date +%Y%m%d).rules ğŸ¯ æ–¹æ¡ˆä¸€ï¼šç½‘å…³æŒ‡å‘ä¸»è·¯ç”±æ—¶çš„é…ç½® ç›´æ¥ç«¯å£è½¬å‘é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åˆ›å»ºæˆ–è¦†ç›–é˜²ç«å¢™é…ç½® cat \u0026gt; /etc/firewall.user \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ### iStoreOS ç«¯å£è½¬å‘é…ç½® ### ### ç”Ÿæˆæ—¶é—´: $(date) ### ### PVE-Win11æ¡Œé¢-ä¸»è·¯ç”±ç›´æ¥è½¬å‘ ### # å¤–éƒ¨3366ç«¯å£ -\u0026gt; å†…éƒ¨3389ç«¯å£ iptables -t nat -A PREROUTING -p tcp --dport 3366 -j DNAT --to-destination 10.10.10.249:3389 iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.249 --dport 3389 -j MASQUERADE # ç¡®ä¿ FORWARD é“¾å…è®¸è½¬å‘çš„æµé‡ iptables -A FORWARD -p tcp -d 10.10.10.249 --dport 3389 -j ACCEPT ### é…ç½®ç»“æŸ ### EOF # é‡å¯é˜²ç«å¢™ä½¿é…ç½®ç”Ÿæ•ˆ /etc/init.d/firewall restart å‚æ•°è¯´æ˜ï¼š\n--dport 3366ï¼šå¤–éƒ¨è®¿é—®ç«¯å£ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ --to-destination 10.10.10.249:3389ï¼šå†…éƒ¨æœåŠ¡åœ°å€å’Œç«¯å£ MASQUERADEï¼šIPä¼ªè£…ï¼Œç¡®ä¿è¿”å›æµé‡æ­£ç¡®è·¯ç”± FORWARD è§„åˆ™ï¼šç¡®ä¿æ•°æ®åŒ…èƒ½è¢«è½¬å‘åˆ°ç›®æ ‡åœ°å€ ğŸ”„ æ–¹æ¡ˆäºŒï¼šç½‘å…³æŒ‡å‘æ—è·¯ç”±æ—¶çš„é…ç½® æ­¥éª¤1ï¼šæ—è·¯ç”±ç«¯å£è½¬å‘é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åœ¨æ—è·¯ç”± (10.10.10.252) ä¸Šæ‰§è¡Œ cat \u0026gt; /etc/firewall.user \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ### æ—è·¯ç”±ç«¯å£è½¬å‘é…ç½® ### ### PVE-Win11æ¡Œé¢-æ—è·¯ç”±è½¬å‘ ### # å¤–éƒ¨3389ç«¯å£ -\u0026gt; å†…éƒ¨3389ç«¯å£ iptables -t nat -A PREROUTING -p tcp --dport 3389 -j DNAT --to-destination 10.10.10.249:3389 iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.249 --dport 3389 -j MASQUERADE # å…è®¸æµé‡è½¬å‘ iptables -A FORWARD -p tcp -d 10.10.10.249 --dport 3389 -j ACCEPT EOF # é‡å¯æ—è·¯ç”±é˜²ç«å¢™ /etc/init.d/firewall restart æ­¥éª¤2ï¼šä¸»è·¯ç”±ç«¯å£è½¬å‘é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åœ¨ä¸»è·¯ç”± (10.10.10.253) ä¸Šæ‰§è¡Œ cat \u0026gt; /etc/firewall.user \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ### ä¸»è·¯ç”±ç«¯å£è½¬å‘é…ç½® ### ### PVE-Win11æ¡Œé¢-ä¸»è·¯ç”±äºŒæ¬¡è½¬å‘ ### # å¤–éƒ¨3377ç«¯å£ -\u0026gt; æ—è·¯ç”±3389ç«¯å£ iptables -t nat -A PREROUTING -p tcp --dport 3377 -j DNAT --to-destination 10.10.10.252:3389 iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.252 --dport 3389 -j MASQUERADE # å…è®¸æµé‡è½¬å‘ iptables -A FORWARD -p tcp -d 10.10.10.252 --dport 3389 -j ACCEPT EOF # é‡å¯ä¸»è·¯ç”±é˜²ç«å¢™ /etc/init.d/firewall restart æµé‡è·¯å¾„ï¼š å…¬ç½‘IP:3377 â†’ ä¸»è·¯ç”±:3377 â†’ æ—è·¯ç”±:3389 â†’ Winæ¡Œé¢:3389\nğŸ“ æ–¹æ¡ˆä¸‰ï¼šè¿½åŠ é…ç½®ï¼ˆä¸è¦†ç›–åŸæœ‰è§„åˆ™ï¼‰ åœ¨ç°æœ‰é…ç½®åŸºç¡€ä¸Šè¿½åŠ è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ·»åŠ åˆ†éš”çº¿å’Œæ³¨é‡Š echo \u0026#34;\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;### æ–°å¢ç«¯å£è½¬å‘è§„åˆ™ ###\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;### æ·»åŠ æ—¶é—´: $(date) ###\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user # æ·»åŠ  Sun-panel è½¬å‘è§„åˆ™ echo \u0026#34;### Sun-panel æœåŠ¡è½¬å‘ ###\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;iptables -t nat -A PREROUTING -p tcp --dport 3002 -j DNAT --to-destination 10.10.10.251:3002\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.251 --dport 3002 -j MASQUERADE\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;iptables -A FORWARD -p tcp -d 10.10.10.251 --dport 3002 -j ACCEPT\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user # æ·»åŠ å…¶ä»–æœåŠ¡è§„åˆ™ç¤ºä¾‹ echo \u0026#34;### å…¶ä»–æœåŠ¡ç¤ºä¾‹ ###\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;# iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination 10.10.10.250:80\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;# iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.250 --dport 80 -j MASQUERADE\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user echo \u0026#34;# iptables -A FORWARD -p tcp -d 10.10.10.250 --dport 80 -j ACCEPT\u0026#34; \u0026gt;\u0026gt; /etc/firewall.user # é‡å¯é˜²ç«å¢™ /etc/init.d/firewall restart ğŸ› ï¸ é«˜çº§é…ç½®æŠ€å·§ 1. å¤šç«¯å£èŒƒå›´è½¬å‘ 1 2 3 4 # è½¬å‘ç«¯å£èŒƒå›´ 5000-5010 iptables -t nat -A PREROUTING -p tcp --dport 5000:5010 -j DNAT --to-destination 10.10.10.249:5000-5010 iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.249 --dport 5000:5010 -j MASQUERADE iptables -A FORWARD -p tcp -d 10.10.10.249 --dport 5000:5010 -j ACCEPT 2. æŒ‡å®šæºIPé™åˆ¶ 1 2 3 4 # åªå…è®¸ç‰¹å®šIPè®¿é—® iptables -t nat -A PREROUTING -p tcp -s 192.168.1.100 --dport 3366 -j DNAT --to-destination 10.10.10.249:3389 iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.249 --dport 3389 -j MASQUERADE iptables -A FORWARD -p tcp -s 192.168.1.100 -d 10.10.10.249 --dport 3389 -j ACCEPT 3. UDPåè®®è½¬å‘ 1 2 3 4 # è½¬å‘UDPæµé‡ï¼ˆå¦‚VPNï¼‰ iptables -t nat -A PREROUTING -p udp --dport 1194 -j DNAT --to-destination 10.10.10.249:1194 iptables -t nat -A POSTROUTING -p udp -d 10.10.10.249 --dport 1194 -j MASQUERADE iptables -A FORWARD -p udp -d 10.10.10.249 --dport 1194 -j ACCEPT 4. åˆ é™¤ç°æœ‰è§„åˆ™ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹è§„åˆ™ç¼–å· iptables -t nat -L PREROUTING -n --line-numbers iptables -t nat -L POSTROUTING -n --line-numbers iptables -L FORWARD -n --line-numbers # åˆ é™¤æŒ‡å®šè§„åˆ™ iptables -t nat -D PREROUTING [è§„åˆ™ç¼–å·] iptables -t nat -D POSTROUTING [è§„åˆ™ç¼–å·] iptables -D FORWARD [è§„åˆ™ç¼–å·] ğŸ” éªŒè¯å’Œè°ƒè¯• 1. æ£€æŸ¥è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹NATè¡¨çš„æ‰€æœ‰è§„åˆ™ iptables -t nat -L -n -v # æŸ¥çœ‹å…·ä½“çš„PREROUTINGè§„åˆ™ iptables -t nat -L PREROUTING -n -v # æŸ¥çœ‹å…·ä½“çš„POSTROUTINGè§„åˆ™ iptables -t nat -L POSTROUTING -n -v # æŸ¥çœ‹FORWARDè§„åˆ™ iptables -L FORWARD -n -v 2. æµ‹è¯•ç«¯å£è¿é€šæ€§ 1 2 3 4 5 6 7 8 9 # å†…éƒ¨æµ‹è¯•ï¼ˆåœ¨åŒç½‘ç»œå†…ï¼‰ telnet 10.10.10.253 3366 nc -zv 10.10.10.253 3366 # æ£€æŸ¥æœåŠ¡æ˜¯å¦åœ¨ç›®æ ‡æœºå™¨ä¸Šç›‘å¬ netstat -tln | grep 3389 # å¤–éƒ¨æµ‹è¯•ï¼ˆä»å…¬ç½‘æµ‹è¯•ï¼‰ # å¯ä»¥ä½¿ç”¨åœ¨çº¿ç«¯å£æ£€æµ‹å·¥å…·æˆ–å¦ä¸€ç½‘ç»œè®¾å¤‡æµ‹è¯• 3. æŸ¥çœ‹è¿æ¥è·Ÿè¸ª 1 2 3 4 5 # æŸ¥çœ‹å½“å‰çš„NATè¿æ¥ cat /proc/net/ip_conntrack | grep 3389 # æˆ–è€…ä½¿ç”¨conntrackå·¥å…· conntrack -L | grep 3389 âš ï¸ å¸¸è§é—®é¢˜è§£å†³ âŒ é—®é¢˜1: è§„åˆ™ä¸ç”Ÿæ•ˆ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦è¿è¡Œ /etc/init.d/firewall status # é‡æ–°åŠ è½½é…ç½® /etc/init.d/firewall reload # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å†²çªè§„åˆ™ iptables -t nat -L -n # ç¡®è®¤IPè½¬å‘å·²å¼€å¯ sysctl net.ipv4.ip_forward âŒ é—®é¢˜2: èƒ½è¿æ¥ä½†æ— æ³•é€šä¿¡ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 # æ£€æŸ¥ç›®æ ‡æœåŠ¡æ˜¯å¦è¿è¡Œ netstat -tlnp | grep 3389 # æ£€æŸ¥ç›®æ ‡é˜²ç«å¢™è®¾ç½® # åœ¨Windowsä¸Šæ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…è®¸3389ç«¯å£ # æ£€æŸ¥FORWARDé“¾æ˜¯å¦å…è®¸æµé‡é€šè¿‡ iptables -L FORWARD -n -v âŒ é—®é¢˜3: é‡å¯åè§„åˆ™ä¸¢å¤± è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 # ç¡®ä¿è§„åˆ™ä¿å­˜åœ¨ /etc/firewall.user # æ£€æŸ¥æ–‡ä»¶æƒé™ chmod 644 /etc/firewall.user # ç¡®è®¤é˜²ç«å¢™å¯åŠ¨è„šæœ¬ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ grep firewall.user /etc/init.d/firewall # ä¿å­˜å½“å‰iptablesè§„åˆ™ iptables-save \u0026gt; /etc/iptables.rules âŒ é—®é¢˜4: ç«¯å£å†²çª è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 # æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ netstat -tlnp | grep 3366 # ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£ # å°† --dport 3366 æ”¹ä¸ºå…¶ä»–æœªä½¿ç”¨ç«¯å£ ğŸ“Š é…ç½®ç®¡ç†å»ºè®® 1. ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 # å¤‡ä»½é…ç½®æ–‡ä»¶ cp /etc/firewall.user /etc/firewall.user.$(date +%Y%m%d_%H%M%S) # ä½¿ç”¨gitç®¡ç†é…ç½®ï¼ˆå¦‚æœå®‰è£…äº†gitï¼‰ cd /etc \u0026amp;\u0026amp; git init git add firewall.user git commit -m \u0026#34;æ›´æ–°é˜²ç«å¢™é…ç½®\u0026#34; 2. æ·»åŠ é…ç½®è¯´æ˜å¤´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # åœ¨é…ç½®æ–‡ä»¶å¼€å¤´æ·»åŠ è¯¦ç»†è¯´æ˜ cat \u0026gt; /etc/firewall.user \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; ############################################## # iStoreOS é˜²ç«å¢™è‡ªå®šä¹‰è§„åˆ™ # ç”Ÿæˆæ—¶é—´: $(date) # ä½œè€…: ä½ çš„åå­— # å¤‡æ³¨: è‡ªå®šä¹‰ç«¯å£è½¬å‘è§„åˆ™ ############################################## ### è§„åˆ™è¯´æ˜ ### # ç«¯å£3366 -\u0026gt; Winè¿œç¨‹æ¡Œé¢(10.10.10.249:3389) # ç«¯å£3002 -\u0026gt; Sun-panelé¢æ¿(10.10.10.251:3002) ### å®é™…è§„åˆ™ ### iptables -t nat -A PREROUTING -p tcp --dport 3366 -j DNAT --to-destination 10.10.10.249:3389 iptables -t nat -A POSTROUTING -p tcp -d 10.10.10.249 --dport 3389 -j MASQUERADE iptables -A FORWARD -p tcp -d 10.10.10.249 --dport 3389 -j ACCEPT EOF 3. å®šæœŸæ£€æŸ¥è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ›å»ºæ£€æŸ¥è„šæœ¬ cat \u0026gt; /usr/local/bin/check-firewall.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/sh echo \u0026#34;=== é˜²ç«å¢™è§„åˆ™æ£€æŸ¥ ===\u0026#34; echo \u0026#34;æ—¶é—´: $(date)\u0026#34; echo \u0026#34;NAT è§„åˆ™:\u0026#34; iptables -t nat -L -n echo \u0026#34;\u0026#34; echo \u0026#34;è¿æ¥è·Ÿè¸ª:\u0026#34; conntrack -L | head -20 EOF chmod +x /usr/local/bin/check-firewall.sh ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®® å‡å°‘è§„åˆ™æ•°é‡ï¼šåˆå¹¶ç±»ä¼¼è§„åˆ™ï¼Œä½¿ç”¨ç«¯å£èŒƒå›´ ä¼˜åŒ–è§„åˆ™é¡ºåºï¼šå°†å¸¸ç”¨è§„åˆ™æ”¾åœ¨å‰é¢ ä½¿ç”¨è¿æ¥è·Ÿè¸ªï¼šåˆ©ç”¨ conntrack æé«˜æ€§èƒ½ å®šæœŸæ¸…ç†ï¼šç§»é™¤ä¸å†éœ€è¦çš„è§„åˆ™ ç›‘æ§æ€§èƒ½ï¼šä½¿ç”¨ top æˆ– htop ç›‘æ§ç³»ç»Ÿè´Ÿè½½ ğŸ’¡ æ ¸å¿ƒåŸç†ä¸æ³¨æ„äº‹é¡¹ ğŸ”§ iptables ç«¯å£è½¬å‘åŸç† PREROUTING é“¾ (DNAT)ï¼šä¿®æ”¹ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œå°†å‘å¾€æœ¬æœºç‰¹å®šç«¯å£çš„æ•°æ®åŒ…è½¬å‘åˆ°å†…ç½‘æœºå™¨ã€‚ FORWARD é“¾ï¼šå…è®¸æ•°æ®åŒ…åœ¨æ¥å£ä¹‹é—´è½¬å‘ã€‚ POSTROUTING é“¾ (SNAT/MASQUERADE)ï¼šä¿®æ”¹æºåœ°å€ï¼Œç¡®ä¿è¿”å›åŒ…èƒ½æ­£ç¡®è·¯ç”±ã€‚ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ å®‰å…¨é£é™©ï¼šç«¯å£è½¬å‘ä¼šå°†å†…éƒ¨æœåŠ¡æš´éœ²åˆ°å¤–éƒ¨ç½‘ç»œï¼Œè¯·ç¡®ä¿åªè½¬å‘å¿…è¦çš„æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼ºå¯†ç ã€‚ ç½‘ç»œæ‹“æ‰‘ï¼šç¡®ä¿è½¬å‘è®¾å¤‡æ˜¯æµé‡çš„å¿…ç»ä¹‹è·¯ã€‚ æœåŠ¡çŠ¶æ€ï¼šç¡®ä¿ç›®æ ‡æœåŠ¡æ­£åœ¨è¿è¡Œä¸”ç›‘å¬æ­£ç¡®ç«¯å£ã€‚ é˜²ç«å¢™å¹²æ‰°ï¼šæ£€æŸ¥ç›®æ ‡ä¸»æœºçš„é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ä¸ä¼šé˜»æ­¢è½¬å‘çš„æµé‡ã€‚ è§„åˆ™æŒä¹…åŒ–ï¼šè®°å¾—ä¿å­˜ iptables è§„åˆ™ï¼Œä»¥å…é‡å¯åä¸¢å¤±ã€‚ ğŸ’¡ æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯é…ç½®ï¼Œç¡®ä¿æ‰€æœ‰è§„åˆ™æŒ‰é¢„æœŸå·¥ä½œåå†åº”ç”¨åˆ°ä¸»ç½‘ç»œã€‚åŒæ—¶ï¼Œè®°å¾—é…ç½®é€‚å½“çš„å®‰å…¨æªæ–½ï¼Œå¦‚é™åˆ¶æºIPåœ°å€ï¼Œé¿å…ä¸å¿…è¦çš„ç«¯å£æš´éœ²ã€‚\nå¸Œæœ›æœ¬æŒ‡å—å¸®åŠ©æ‚¨æˆåŠŸé…ç½® iStoreOS çš„ç«¯å£è½¬å‘åŠŸèƒ½ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ OpenWrt å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›ã€‚\n","date":"2024-12-07T07:22:29+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/ed0e11a4/","title":"iStoreOS ç«¯å£è½¬å‘ iptables è§„åˆ™é…ç½® ğŸ› ï¸"},{"content":"Docker éƒ¨ç½² Qinglong é¢æ¿å®Œå…¨æŒ‡å— ğŸ‰ ğŸ“‹ ç›®å½•å¯¼èˆª ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Qinglong é¢æ¿ 1. ä½¿ç”¨ Docker Compose éƒ¨ç½² ğŸ“ 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ ğŸš€ äºŒã€ä½¿ç”¨ Qinglong é¢æ¿ 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ¯ 2. åŠŸèƒ½ç‰¹æ€§ âœ¨ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ ğŸ”§ ä¸‰ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 3. Docker é•œåƒç®¡ç† ğŸ“€ ğŸŒŸ å¯èˆªè‡ªåŠ¨åŒ–ï¼Œé«˜æ•ˆéšå¿ƒ ğŸ¯ é¡¹ç›®ç®€ä»‹ ğŸŒ Qinglong å®˜ç½‘åœ°å€ï¼š https://qinglong.apifox.cn/ ğŸ± GitHub é¡¹ç›®åœ°å€ï¼š https://github.com/whyour/qinglong ğŸ‹ Docker é•œåƒåœ°å€ï¼š https://hub.docker.com/r/whyour/qinglong Qinglongï¼ˆé’é¾™é¢æ¿ï¼‰ æ˜¯ä¸€ä¸ªæ”¯æŒ Python3ã€JavaScriptã€Shellã€TypeScript çš„å®šæ—¶ä»»åŠ¡ç®¡ç†å¹³å°ï¼Œä¸»è¦ç”¨äºç®¡ç†å„ç§è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå¦‚äº¬ä¸œè–…ç¾Šæ¯›è„šæœ¬ã€ç­¾åˆ°è„šæœ¬ç­‰ã€‚å®ƒæä¾›äº†å¼ºå¤§çš„ä»»åŠ¡è°ƒåº¦ã€æ—¥å¿—ç®¡ç†å’Œä¾èµ–ç®¡ç†åŠŸèƒ½ã€‚\nğŸ› ï¸ æ ¸å¿ƒç‰¹æ€§ ç‰¹æ€§ç±»åˆ« åŠŸèƒ½æè¿° ä¼˜åŠ¿ â° å®šæ—¶ä»»åŠ¡ç®¡ç† æ”¯æŒ cron è¡¨è¾¾å¼ çµæ´»é…ç½®æ‰§è¡Œæ—¶é—´ï¼Œç²¾ç¡®æ§åˆ¶ä»»åŠ¡è°ƒåº¦ ğŸŒ å¤šè¯­è¨€æ”¯æŒ Python3ã€JavaScriptã€Shellã€TypeScript å¹¿æ³›å…¼å®¹å„ç§è„šæœ¬è¯­è¨€ï¼Œæ‰©å±•æ€§å¼º ğŸ“Š å¯è§†åŒ–ç•Œé¢ Web ç•Œé¢ç®¡ç† ç›´è§‚æ˜“ç”¨çš„ä»»åŠ¡ç®¡ç†å’Œç›‘æ§ç•Œé¢ ğŸ”§ ä¾èµ–ç®¡ç† è‡ªåŠ¨å®‰è£…å’Œç®¡ç†ä¾èµ– ç®€åŒ–è„šæœ¬ç¯å¢ƒé…ç½®ï¼Œæé«˜å…¼å®¹æ€§ ğŸ“± é€šçŸ¥æé†’ å¤šç§é€šçŸ¥æ–¹å¼ æ”¯æŒå¾®ä¿¡ã€Telegramã€é‚®ä»¶ç­‰é€šçŸ¥æ¸ é“ ğŸ‘¥ å¤šç”¨æˆ·æ”¯æŒ æƒé™ç®¡ç†å’Œç”¨æˆ·æ§åˆ¶ æ”¯æŒå›¢é˜Ÿåä½œå’Œæƒé™åˆ†é… ğŸ”„ è„šæœ¬å¸‚åœº å†…ç½®è„šæœ¬åº“ ä¸€é”®æ·»åŠ å¸¸ç”¨è„šæœ¬ï¼Œå¿«é€Ÿä¸Šæ‰‹ ğŸ³ ä¸€ã€Docker éƒ¨ç½² Qinglong é¢æ¿ 1. ä½¿ç”¨ Docker Compose éƒ¨ç½² ğŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mkdir -p /mnt/mydisk/home/qinglong \u0026amp;\u0026amp; cd $_ \u0026amp;\u0026amp; \\ cat \u0026gt; docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: qinglong: image: whyour/qinglong:latest container_name: qinglong restart: unless-stopped ports: - \u0026#34;5700:5700\u0026#34; volumes: - ./config:/ql/config - ./log:/ql/log - ./db:/ql/db - ./scripts:/ql/scripts - ./repo:/ql/repo environment: - ENABLE_HANGUP=true - ENABLE_WEB_PANEL=true tty: true stdin_open: true EOF 2. æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨ ğŸš€ 1 docker-compose up -d ğŸš€ äºŒã€ä½¿ç”¨ Qinglong é¢æ¿ 1. é¦–æ¬¡è®¿é—®è®¾ç½® ğŸ¯ æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:5700 æŸ¥çœ‹åˆå§‹å¯†ç : 1 docker exec -it qinglong cat /ql/config/auth.json ä½¿ç”¨è·å–çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½• é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç  æ ¹æ®éœ€è¦é…ç½®é€šçŸ¥æ–¹å¼ï¼ˆé‚®ä»¶ã€Telegramã€å¾®ä¿¡ç­‰ï¼‰ å¼€å§‹æ·»åŠ æˆ–å¯¼å…¥å®šæ—¶ä»»åŠ¡ 2. åŠŸèƒ½ç‰¹æ€§ âœ¨ â° å®šæ—¶ä»»åŠ¡: æ”¯æŒ cron è¡¨è¾¾å¼ï¼Œçµæ´»é…ç½®æ‰§è¡Œæ—¶é—´ ğŸ“Š ä»»åŠ¡ç®¡ç†: å¯è§†åŒ–æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤å’Œè¿è¡Œä»»åŠ¡ ğŸ”§ ä¾èµ–ç®¡ç†: è‡ªåŠ¨å®‰è£…å’Œç®¡ç†è„šæœ¬æ‰€éœ€çš„ä¾èµ– ğŸ“± é€šçŸ¥æé†’: æ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼ˆå¾®ä¿¡ã€Telegramã€é‚®ä»¶ç­‰ï¼‰ ğŸ‘¥ å¤šç”¨æˆ·: æ”¯æŒå¤šç”¨æˆ·ç®¡ç†å’Œæƒé™æ§åˆ¶ ğŸ”„ è„šæœ¬å¸‚åœº: å†…ç½®è„šæœ¬å¸‚åœºï¼Œä¸€é”®æ·»åŠ å¸¸ç”¨è„šæœ¬ ğŸŒ ä¸‰ã€Nginx åå‘ä»£ç†é…ç½® è®¿é—®åœ°å€ç¤ºä¾‹ï¼š https://qinglong.example.com:666 1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ ğŸ”§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 mkdir -p /etc/nginx/conf.d \u0026amp;\u0026amp; \\ cat \u0026gt; /etc/nginx/conf.d/qinglong.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 666 ssl; listen [::]:666 ssl; server_name qinglong.example.com; # æ›¿æ¢ä¸ºä½ çš„åŸŸå # SSL è¯ä¹¦ ssl_certificate /etc/nginx/keyfile/cert.pem; ssl_certificate_key /etc/nginx/keyfile/key.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers off; ssl_ciphers ECDHE+AESGCM:ECDHE+CHACHA20:!aNULL:!MD5; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # æ–‡ä»¶å¤§å°é™åˆ¶ client_max_body_size 100M; location / { proxy_pass http://127.0.0.1:5700; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_buffering off; # WebSocket æ”¯æŒ proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } # é”™è¯¯é¡µ error_page 404 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } EOF 2. æµ‹è¯•å¹¶é‡è½½ Nginx ğŸ”„ 1 sudo nginx -t \u0026amp;\u0026amp; sudo systemctl reload nginx ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. Docker Compose å‘½ä»¤ ğŸ³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/qinglong # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ docker-compose down # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # è·Ÿè¸ªæœåŠ¡æ—¥å¿— docker-compose logs -f # å®Œæ•´å‡çº§æµç¨‹ docker-compose down \u0026amp;\u0026amp; \\ docker-compose pull \u0026amp;\u0026amp; \\ docker-compose up -d \u0026amp;\u0026amp; \\ docker image prune -f 2. Docker å®¹å™¨å‘½ä»¤ ğŸ“¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨ docker ps # åœæ­¢/å¯åŠ¨/é‡å¯å®¹å™¨ docker stop qinglong docker start qinglong docker restart qinglong # åˆ é™¤å®¹å™¨ docker rm qinglong # è¿›å…¥å®¹å™¨Shell docker exec -it qinglong sh docker exec -it qinglong bash # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs qinglong docker logs -f qinglong docker logs --tail 100 qinglong # ç›‘æ§èµ„æºä½¿ç”¨ docker stats qinglong # æŸ¥çœ‹å®¹å™¨è¯¦æƒ… docker inspect qinglong 3. Docker é•œåƒç®¡ç† ğŸ“€ 1 2 3 4 docker images docker rmi whyour/qinglong:latest docker image prune -f docker image prune -a -f ğŸŒŸ å¯èˆªè‡ªåŠ¨åŒ–ï¼Œé«˜æ•ˆéšå¿ƒ é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å·²ç»æˆåŠŸä½¿ç”¨ Docker éƒ¨ç½²äº† Qinglong é¢æ¿ï¼Œå¹¶å€ŸåŠ© Nginx åå‘ä»£ç†å®ç°äº†å®‰å…¨ä¾¿æ·çš„è¿œç¨‹è®¿é—®ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ï¼š\nâ° è½»æ¾ç®¡ç† å„ç±»å®šæ—¶ä»»åŠ¡ï¼Œä»ç­¾åˆ°è„šæœ¬åˆ°è‡ªåŠ¨åŒ–æµç¨‹ï¼Œä¸€åˆ‡å°½åœ¨æŒæ¡\nğŸ¤– è§£æ”¾åŒæ‰‹ è‡ªåŠ¨åŒ–æ‰§è¡Œé‡å¤æ€§å·¥ä½œï¼Œè®©ç”Ÿæ´»ä¸å·¥ä½œæ›´åŠ é«˜æ•ˆä»å®¹\nğŸ“Š æ¸…æ™°æŒæ§ é€šè¿‡å¯è§†åŒ–ç•Œé¢å®æ—¶ç›‘æ§ä»»åŠ¡çŠ¶æ€ä¸æ‰§è¡Œæ—¥å¿—\nğŸ”” åŠæ—¶çŸ¥æ™“ å¤šæ¸ é“æ¥æ”¶ä»»åŠ¡é€šçŸ¥ï¼Œéšæ—¶æŒæ¡è¿è¡ŒçŠ¶æ€ä¸ç»“æœ\nè‡ªåŠ¨åŒ–ä¸ä»…æ˜¯æŠ€æœ¯çš„å®ç°ï¼Œæ›´æ˜¯ç”Ÿæ´»ä¸å·¥ä½œæ–¹å¼çš„å‡çº§ã€‚æ„¿ Qinglong æˆä¸ºä½ å¯é çš„è‡ªåŠ¨åŒ–ä¼™ä¼´ï¼Œå¸®åŠ©ä½ èŠ‚çœå®è´µæ—¶é—´ï¼Œèšç„¦äºçœŸæ­£é‡è¦çš„äº‹åŠ¡ã€‚\nä»ç°åœ¨å¼€å§‹ï¼Œéƒ¨ç½²ä½ çš„ç¬¬ä¸€ä¸ªè„šæœ¬ï¼Œå¼€å¯é«˜æ•ˆè‡ªåŠ¨åŒ–ä¹‹æ—…å§ï¼âš¡\nğŸ“Œ æŒç»­å…³æ³¨ï¼šå»ºè®®å…³æ³¨ Qinglong å®˜æ–¹æ›´æ–° ï¼ŒåŠæ—¶è·å–æ–°åŠŸèƒ½ä¸ä¼˜åŒ–ã€‚\nğŸ› åé¦ˆä¸äº’åŠ©ï¼šä½¿ç”¨ä¸­å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯å‰å¾€ GitHub Issues æå‡ºã€‚\nç¥ä½ é…ç½®é¡ºåˆ©ï¼Œè‡ªåŠ¨åŒ–æœ‰æˆï¼ğŸ‰\n","date":"2024-12-07T07:21:50+08:00","image":"https://file.meimolihan.eu.org/img/qinglong-01.webp","permalink":"https://blog.meimolihan.eu.org/p/bad14fb8/","title":"Docker éƒ¨ç½² Qinglong é¢æ¿ ğŸ‰"},{"content":"Linux å‘½ä»¤å¤§å…¨ ğŸ§ ç®€æ´é«˜æ•ˆçš„ Linux å‘½ä»¤æ‰‹å†Œï¼Œæ¶µç›–æ—¥å¸¸æ“ä½œã€ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿç›‘æ§å’Œç½‘ç»œé…ç½®ï¼ŒåŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ç»ˆç«¯æ“ä½œï¼\nâœ¨ ç‰¹ç‚¹ä¸åŠŸèƒ½ä»‹ç» Linux æ˜¯ä¸€ç§è‡ªç”±å¼€æºçš„ç±» Unix æ“ä½œç³»ç»Ÿï¼Œå¹¿æ³›åº”ç”¨äºæœåŠ¡å™¨ã€åµŒå…¥å¼è®¾å¤‡åŠå¼€å‘ç¯å¢ƒä¸­ã€‚å…¶å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ä¸ºç”¨æˆ·æä¾›äº†é«˜æ•ˆã€çµæ´»çš„æ“ä½œæ–¹å¼ã€‚æœ¬æ–‡æ•´ç†äº†å¸¸ç”¨çš„ Linux å‘½ä»¤ï¼Œæ¶µç›–æ–‡ä»¶æ“ä½œã€ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿç›‘æ§å’Œç½‘ç»œé…ç½®ç­‰æ–¹é¢ï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ä¸€å®šç»éªŒçš„ç”¨æˆ·æŸ¥é˜…ä½¿ç”¨ã€‚\nğŸ§­ ä¸€ã€é€šç”¨å‘½ä»¤ 1. æ‰“å°æˆ–è®¾ç½®ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´ ğŸ“… 1 date 2. æŸ¥çœ‹æˆ–è®¾ç½®ç»ˆç«¯æ§åˆ¶å­—ç¬¦ï¼ˆå¦‚ Ctrl-C, Ctrl-D, Ctrl-Z ç­‰ï¼‰âŒ¨ï¸ 1 stty -a 3. ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç  ğŸ”’ 1 passwd 4. ç”¨æˆ·ç™»å½•ä¸æ³¨é”€ ğŸ” 1 2 login # ç™»å½• logout # æ³¨é”€ï¼ˆæ³¨æ„ï¼šåŸæ–‡ä¸­çš„ \u0026#34;1ogout\u0026#34; åº”ä¸º \u0026#34;logout\u0026#34;ï¼‰ 5. æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• ğŸ“‚ 1 pwd 6. æŸ¥çœ‹æ–‡ä»¶å†…å®¹ ğŸ“„ 1 2 3 4 more # åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ less # æ›´é«˜æ•ˆçš„åˆ†é¡µæŸ¥çœ‹ï¼ˆæ”¯æŒä¸Šä¸‹æ»šåŠ¨ï¼‰ head # æ˜¾ç¤ºæ–‡ä»¶å¼€å¤´éƒ¨åˆ† tail # æ˜¾ç¤ºæ–‡ä»¶æœ«å°¾éƒ¨åˆ† 7. ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•æƒé™ ğŸ›¡ï¸ 1 chmod u+rwx filename # ç¤ºä¾‹ï¼šç»™ç”¨æˆ·å¢åŠ è¯»ã€å†™ã€æ‰§è¡Œæƒé™ 8. å¼ºåˆ¶åˆ é™¤éç©ºç›®å½•ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰ğŸ—‘ï¸ 1 rm -fr dirname 9. é€’å½’æ‹·è´ç›®å½•ï¼ˆåŒ…æ‹¬å­ç›®å½•å’Œæ–‡ä»¶ï¼‰ğŸ“¦ 1 cp -R dirname new_dir ğŸ‘¥ äºŒã€ç”¨æˆ·å‘½ä»¤ 1. åˆ›å»ºæ–°ç”¨æˆ· 1 useradd admin # åˆ›å»ºåä¸º admin çš„ç”¨æˆ· 2. è®¾ç½®ç”¨æˆ·å¯†ç  1 passwd admin # ä¸º admin ç”¨æˆ·è®¾ç½®å¯†ç  3. æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ 1 id admin # éªŒè¯ admin ç”¨æˆ·æ˜¯å¦å­˜åœ¨å¹¶æ˜¾ç¤ºå…¶ä¿¡æ¯ 4. åˆ‡æ¢ç”¨æˆ·èº«ä»½ 1 2 su - root # åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼ˆéœ€è¦å¯†ç ï¼‰ su username # åˆ‡æ¢åˆ°å…¶ä»–ç”¨æˆ·ï¼ˆå¯èƒ½ä¸éœ€è¦å¯†ç ï¼‰ ğŸ–¥ï¸ ä¸‰ã€ç³»ç»Ÿå‘½ä»¤ 1. æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ 1 uname -a 2. æŸ¥çœ‹ Ubuntu å‘è¡Œç‰ˆä¿¡æ¯ 1 cat /etc/issue 3. æŸ¥çœ‹ç½‘å¡çŠ¶æ€ä¸ä¿¡æ¯ 1 ethtool eth0 # æŸ¥çœ‹ç¬¬ä¸€å—ç½‘å¡çš„çŠ¶æ€ 4. æŸ¥çœ‹å†…å­˜ä¸ CPU ä¿¡æ¯ 1 2 cat /proc/meminfo # æŸ¥çœ‹å†…å­˜ä¿¡æ¯ cat /proc/cpuinfo # æŸ¥çœ‹ CPU ä¿¡æ¯ 5. æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ 1 df -h # ä»¥äººç±»å¯è¯»æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µ 6. æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒºä¿¡æ¯ 1 fdisk -l # åˆ—å‡ºæ‰€æœ‰ç£ç›˜åˆ†åŒºï¼ˆæ³¨æ„ï¼šåŸæ–‡ä¸­çš„ \u0026#34;fdisk -1\u0026#34; åº”ä¸º \u0026#34;fdisk -l\u0026#34;ï¼‰ 7. æŸ¥çœ‹æ–‡ä»¶å¤§å° 1 du -h filename # æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„å¤§å° 8. æŸ¥çœ‹ç›®å½•å¤§å° 1 2 du -hs dirname # æ˜¾ç¤ºç›®å½•æ€»å¤§å° du -h dirname # æ˜¾ç¤ºç›®å½•ä¸‹æ¯ä¸ªæ–‡ä»¶çš„å¤§å° 9. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ 1 2 3 free -m # ä»¥ MB ä¸ºå•ä½æ˜¾ç¤º free -g # ä»¥ GB ä¸ºå•ä½æ˜¾ç¤º free -k # ä»¥ KB ä¸ºå•ä½æ˜¾ç¤º 10. æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹ 1 2 ps -e # æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ ps -aux # æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬è¯¦ç»†ä¿¡æ¯ï¼‰ 11. ç»ˆæ­¢è¿›ç¨‹ 1 kill pid # é€šè¿‡è¿›ç¨‹IDç»ˆæ­¢è¿›ç¨‹ 12. å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰åŒåè¿›ç¨‹ 1 killall -9 processname # å¼ºåˆ¶ç»ˆæ­¢æŒ‡å®šåç§°çš„æ‰€æœ‰è¿›ç¨‹ ğŸŒ å››ã€ç½‘ç»œç›¸å…³ 1. é…ç½® ADSL è¿æ¥ 1 pppoeconf # å¯åŠ¨ ADSL é…ç½®å‘å¯¼ 2. æ‰‹åŠ¨å¯åŠ¨ ADSL è¿æ¥ 1 pon dsl-provider # ä½¿ç”¨é…ç½®å¥½çš„åç§°å¯åŠ¨è¿æ¥ 3. å¼€æœºè‡ªåŠ¨æ¿€æ´» ADSLï¼ˆéœ€é…ç½®ï¼‰ 1 /etc/ppp/pppoe_on_boot # é€šå¸¸éœ€è¦åœ¨ç³»ç»Ÿå¯åŠ¨è„šæœ¬ä¸­è®¾ç½® 4. æ–­å¼€ ADSL è¿æ¥ 1 poff # æ–­å¼€å½“å‰æ´»åŠ¨çš„ ADSL è¿æ¥ ğŸ’¡ è¡¥å……å¸¸ç”¨å‘½ä»¤ æ–‡ä»¶ä¸ç›®å½•æ“ä½œ 1 2 3 4 ls -la # åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰åŠè¯¦ç»†ä¿¡æ¯ mkdir dirname # åˆ›å»ºæ–°ç›®å½• rmdir dirname # åˆ é™¤ç©ºç›®å½• mv old new # ç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶/ç›®å½• æ–‡æœ¬å¤„ç† 1 2 grep pattern file # åœ¨æ–‡ä»¶ä¸­æœç´¢æŒ‡å®šæ¨¡å¼ cat file1 file2 \u0026gt; combined.txt # åˆå¹¶æ–‡ä»¶ å‹ç¼©ä¸è§£å‹ 1 2 tar -czvf archive.tar.gz dirname # åˆ›å»ºå‹ç¼©åŒ… tar -xzvf archive.tar.gz # è§£å‹å‹ç¼©åŒ… ç³»ç»Ÿç›‘æ§ 1 2 top # åŠ¨æ€æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€å’Œç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ htop # top çš„å¢å¼ºç‰ˆï¼ˆéœ€å®‰è£…ï¼‰ æç¤ºï¼šä½¿ç”¨ man [å‘½ä»¤] å¯ä»¥æŸ¥çœ‹ä»»ä½•å‘½ä»¤çš„è¯¦ç»†æ‰‹å†Œï¼Œä¾‹å¦‚ man lsã€‚ğŸš€\nå¸Œæœ›è¿™ä»½æ•´ç†åçš„æŒ‡å—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿è¡¥å……å’ŒæŒ‡æ­£ã€‚\n","date":"2024-12-07T07:20:54+08:00","image":"https://file.meimolihan.eu.org/img/linux-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a762a03d/","title":"Linux å‘½ä»¤å¤§å…¨ ğŸ§"},{"content":"Sun-Panel å¯¼èˆªé¡µè‡ªå®šä¹‰é¡µè„šâ€‹ v1.3.0æ–°å¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ åº”ç”¨å¯åŠ¨å™¨ -\u0026gt; åŸºç¡€è®¾ç½® -\u0026gt; è‡ªå®šä¹‰footer æ¥è‡ªå®šä¹‰é¡µè„šä»£ç ï¼Œæ­¤åŠŸèƒ½éœ€è¦æœ‰åŸºæœ¬çš„HTMLçš„ç¼–ç èƒ½åŠ›ï¼Œå¦‚æœæ‚¨ä¸äº†è§£ä¸è¦å¡«å†™æ¥æºä¸æ˜çš„ä»£ç ï¼Œå¦‚æœå¡«å†™ä»£ç åå¯¼è‡´é¡µé¢é”™ä¹±ï¼Œå¯ä»¥ç‚¹å‡»è¾“å…¥æ¡†å³è¾¹çš„æ¸…é™¤æŒ‰é’®æˆ–è€…é‡ç½®ã€‚å¦‚æœæ‚¨æœ‰å¾ˆæ£’çš„ç©æ³•å¹¶ä¸”æœ‰è´¡çŒ®çš„ç²¾ç¥ï¼Œå¯ä»¥åœ¨Githubç¤¾åŒºæ·»åŠ ä½ çš„ç©æ³•ã€‚æ­¤é¡µè„šä»…é’ˆå¯¹è´¦å·ç”Ÿæ•ˆå¹¶éå…¨å±€ï¼Œå¦‚æœæƒ³å…¨å±€ç”Ÿæ•ˆå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰js/cssã€‚\n1 ã€å¤‡æ¡ˆå·â€‹ å°†ä»£ç ä¸­çš„äº¬æ¢æˆä½ åŸŸåå¤‡æ¡ˆåœ°çš„ç®€å†™ï¼Œxxxx\u0026hellip;æ¢æˆå¤‡æ¡ˆå· 1 2 3 \u0026lt;div style=\u0026#34;text-align: center;color:#fff\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;https://beian.miit.gov.cn\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;äº¬ICPå¤‡ xxxxxxxxxxå·\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; 2 ã€åŠ¨æ€æ¸å˜èƒŒæ™¯â€‹ æ­¤é…ç½®åŒæ—¶å¯ä»¥ç›´æ¥åœ¨è‡ªå®šä¹‰cssä¸­ä½¿ç”¨ï¼Œå¦‚æœåœ¨cssä¸­ä½¿ç”¨è¯·åˆ é™¤ä»£ç ä¸­çš„æ ‡ç­¾ï¼Œè¯·æ³¨æ„ä½¿ç”¨æ­¤ä»£ç ï¼Œé»˜è®¤è‡ªå¸¦èƒŒæ™¯éƒ¨åˆ†è®¾ç½®å°†ä¼šå¤±æ•ˆï¼Œå¦‚æœä½¿ç”¨å¯¼è‡´å¡é¡¿è¯·åœæ­¢ä½¿ç”¨ gifå°ºå¯¸å¤ªå¤§äº†ä¸æ”¾å›¾äº†ï¼Œé‡ç‚¹è¡Œä»£ç æœ€åä¸‰ä¸ªå‚æ•°å¯ä»¥ä¿®æ”¹ä½ æƒ³è¦çš„é¢œè‰²\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;style\u0026gt; @keyframes hueRotate { 100% { filter: hue-rotate(360deg); } } .sun-main .cover { width: 100vw; height: 100vh; margin: auto; } .sun-main .cover::before { content: \u0026#34;\u0026#34;; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(30deg, #ffcc00, deeppink, #9c27b0); -webkit-animation: hueRotate 5s infinite alternate; animation: hueRotate 5s infinite alternate; } .sun-main .cover[style*=\u0026#34;filter\u0026#34;]::before { filter: none; } \u0026lt;/style\u0026gt; ","date":"2024-12-07T07:17:24+08:00","image":"https://file.meimolihan.eu.org/img/docker-sun-panel-01.webp","permalink":"https://blog.meimolihan.eu.org/p/e8799b98/","title":"Sun-Panel å¯¼èˆªé¡µè‡ªå®šä¹‰é¡µè„šâ€‹"},{"content":"éšæœºå£çº¸ API åˆé›† ğŸ–¼ï¸ æœ¬æ–‡æ•´ç†äº†ä¸°å¯Œçš„éšæœºå£çº¸ API èµ„æºï¼Œæ¶µç›–é£æ™¯ã€åŠ¨æ¼«ã€æ¸¸æˆã€ç¾å¥³ç­‰å¤šç§ç±»åˆ«ï¼Œå¹¶æä¾›è‡ªé€‚åº”åŠç§»åŠ¨ç«¯ä¸“ç”¨é“¾æ¥ã€‚æ¯ä¸ª API å‡æ”¯æŒç›´æ¥è·å–éšæœºå£çº¸ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿè°ƒç”¨ï¼Œå¢å¼ºé¡¹ç›®è§†è§‰æ•ˆæœã€‚\nğŸ“š å¯¼èˆªç›®å½• ğŸï¸ ä¸€ã€é£æ™¯éšæœºå£çº¸ ğŸ“± äºŒã€è‡ªé€‚åº”éšæœºå£çº¸ ğŸ‘© ä¸‰ã€ç¾å¥³éšæœºå£çº¸ ğŸ¾ å››ã€èŒå® éšæœºå£çº¸ ğŸ® äº”ã€æ¸¸æˆéšæœºå£çº¸ ğŸ’¥ å…­ã€åŠ¨æ¼«éšæœºå£çº¸ ğŸ” ä¸ƒã€å…¶ä»–éšæœºå£çº¸ ğŸŒ… å…«ã€é«˜è´¨é‡æ¯æ—¥å£çº¸ ğŸ–¼ï¸ ä¹ã€åŠ¨æ¼«éšæœºå£çº¸ ğŸ’¾ åã€ç‚¹å‡»ä¸‹è½½å£çº¸ ğŸ“± åä¸€ã€æ‰‹æœºéšæœºå£çº¸ ğŸï¸ ä¸€ã€é£æ™¯éšæœºå£çº¸ 1. éšæœºå¿…åº”å£çº¸ é“¾æ¥ï¼šhttps://api.timelessq.com/bing/random\nç‰¹ç‚¹ï¼šæ¯æ—¥æ›´æ–°çš„é«˜è´¨é‡å¿…åº”å£çº¸ï¼Œæ¶µç›–å…¨çƒè‡ªç„¶é£å…‰ä¸åŸå¸‚æ™¯è§‚ã€‚\nç¤ºä¾‹ï¼š\n2. 4K é£æ™¯å£çº¸å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/landscape\nç‰¹ç‚¹ï¼šä¸“ä¸ºé£æ™¯çˆ±å¥½è€…æä¾›çš„4Kè¶…æ¸…å£çº¸ï¼Œé€‚åˆæ¡Œé¢åŠç§»åŠ¨ç«¯ã€‚\nç¤ºä¾‹ï¼š\n3. é£æ™¯å¤§ç‰‡ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=fj\nç‰¹ç‚¹ï¼šç²¾é€‰é«˜æ¸…é£æ™¯å¤§ç‰‡ï¼Œæ”¯æŒå¤šç§åˆ†è¾¨ç‡åˆ‡æ¢ã€‚\nç¤ºä¾‹ï¼š\n4. éšæœºé«˜æ¸…é£æ™¯å£çº¸ é“¾æ¥ï¼šhttps://acg.suyanw.cn/gqbz/random.php\nç‰¹ç‚¹ï¼šéšæœºè¿”å›é«˜æ¸…é£æ™¯å£çº¸ï¼Œæ¶µç›–è‡ªç„¶ã€åŸå¸‚ç­‰å¤šç§ä¸»é¢˜ã€‚\nç¤ºä¾‹ï¼š\n5. éšæœºäºŒæ¬¡å…ƒé£æ™¯å›¾ é“¾æ¥ï¼šhttps://acg.suyanw.cn/scenery/random.php\nç‰¹ç‚¹ï¼šäºŒæ¬¡å…ƒé£æ ¼çš„å”¯ç¾é£æ™¯ï¼Œé€‚åˆåŠ¨æ¼«çˆ±å¥½è€…ã€‚\nç¤ºä¾‹ï¼š\n6. éšæœºäºŒæ¬¡å…ƒé£æ™¯å›¾ï¼ˆå¤‡ç”¨ï¼‰ é“¾æ¥ï¼šhttps://api.asxe.vip/scenery.php\nç‰¹ç‚¹ï¼šæä¾›å¦ä¸€ç§é£æ ¼çš„äºŒæ¬¡å…ƒé£æ™¯å£çº¸ï¼Œç”»é¢ç»†è…»ã€‚\nç¤ºä¾‹ï¼š\n7. éšæœºäºŒæ¬¡å…ƒå£çº¸ é“¾æ¥ï¼šhttps://api.luvying.com/acgimg\nç‰¹ç‚¹ï¼šæ¯æ—¥æ›´æ–°çš„äºŒæ¬¡å…ƒå£çº¸ï¼Œæ¶µç›–å¤šç§åŠ¨æ¼«é£æ ¼ã€‚\nç¤ºä¾‹ï¼š\n8. éšæœºäºŒæ¬¡å…ƒå£çº¸ï¼ˆå¤‡ç”¨ï¼‰ é“¾æ¥ï¼šhttps://acg.suyanw.cn/Anime\nç‰¹ç‚¹ï¼šæä¾›æ›´å¤šäºŒæ¬¡å…ƒé£æ ¼å£çº¸ï¼Œç”»é¢ç²¾ç¾ã€‚\nç¤ºä¾‹ï¼š\n9. éšæœº PC å£çº¸ é“¾æ¥ï¼šhttps://t.mwm.moe/pc\nç‰¹ç‚¹ï¼šä¸“ä¸ºPCç«¯è®¾è®¡çš„é«˜æ¸…æ¨ªå±å£çº¸ï¼Œé€‚é…å¤§å¤šæ•°æ˜¾ç¤ºå™¨ã€‚\nç¤ºä¾‹ï¼š\n10. äºŒæ¬¡å…ƒé£æ™¯å£çº¸ é“¾æ¥ï¼šhttps://t.mwm.moe/fj\nç‰¹ç‚¹ï¼šèåˆäºŒæ¬¡å…ƒä¸è‡ªç„¶é£å…‰çš„å£çº¸ï¼Œè§†è§‰å†²å‡»åŠ›å¼ºã€‚\nç¤ºä¾‹ï¼š\n11. ç™½åº•äºŒæ¬¡å…ƒå›¾ç‰‡ é“¾æ¥ï¼šhttps://api.paugram.com/wallpaper/\nç‰¹ç‚¹ï¼šä»¥ç™½è‰²ä¸ºèƒŒæ™¯çš„äºŒæ¬¡å…ƒå›¾ç‰‡ï¼Œç®€æ´æ¸…æ–°ã€‚\nç¤ºä¾‹ï¼š\nğŸ“± äºŒã€è‡ªé€‚åº”éšæœºå£çº¸ 1. äºŒæ¬¡å…ƒè‡ªé€‚åº” é“¾æ¥ï¼šhttps://t.alcy.cc/ycy\nç‰¹ç‚¹ï¼šè‡ªåŠ¨é€‚é…è®¾å¤‡å±å¹•çš„äºŒæ¬¡å…ƒå£çº¸ï¼Œæ”¯æŒPCä¸ç§»åŠ¨ç«¯ã€‚\nç¤ºä¾‹ï¼š\n2. èŒç‰ˆè‡ªé€‚åº” é“¾æ¥ï¼šhttps://t.alcy.cc/moez\nç‰¹ç‚¹ï¼šå¯çˆ±é£æ ¼çš„èŒç³»å£çº¸ï¼Œè‡ªé€‚åº”å¤šç§å±å¹•åˆ†è¾¨ç‡ã€‚\nç¤ºä¾‹ï¼š\n3. AI è‡ªé€‚åº” é“¾æ¥ï¼šhttps://t.alcy.cc/ai\nç‰¹ç‚¹ï¼šç”±AIç”Ÿæˆçš„è‰ºæœ¯é£æ ¼å£çº¸ï¼Œæ¯å¼ éƒ½ç‹¬ä¸€æ— äºŒã€‚\nç¤ºä¾‹ï¼š\n4. åŸç¥è‡ªé€‚åº” é“¾æ¥ï¼šhttps://t.alcy.cc/ysz\nç‰¹ç‚¹ï¼šåŸºäºã€ŠåŸç¥ã€‹æ¸¸æˆç”»é¢çš„è‡ªé€‚åº”å£çº¸ï¼Œæ·±å—ç©å®¶å–œçˆ±ã€‚\nç¤ºä¾‹ï¼š\n5. äºŒæ¬¡å…ƒè‡ªé€‚åº”å£çº¸ é“¾æ¥ï¼šhttps://www.loliapi.com/acg/\nç‰¹ç‚¹ï¼šæä¾›ä¸°å¯Œçš„äºŒæ¬¡å…ƒè‡ªé€‚åº”å£çº¸ï¼Œæ›´æ–°é¢‘ç¹ã€‚\nç¤ºä¾‹ï¼š\n6. äºŒæ¬¡å…ƒè‡ªé€‚åº”å£çº¸ï¼ˆå¤‡ç”¨ï¼‰ é“¾æ¥ï¼šhttps://api.suyanw.cn/api/comic/api.php\nç‰¹ç‚¹ï¼šå¦ä¸€æ¥æºçš„äºŒæ¬¡å…ƒè‡ªé€‚åº”å£çº¸ï¼Œé£æ ¼å¤šæ ·ã€‚\nç¤ºä¾‹ï¼š\nğŸ‘© ä¸‰ã€ç¾å¥³éšæœºå£çº¸ 1. ç¾å¥³æ¨¡ç‰¹ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=mnmt\nç‰¹ç‚¹ï¼šé«˜è´¨é‡ç¾å¥³æ¨¡ç‰¹å£çº¸ï¼Œé€‚åˆè‰ºæœ¯æ¬£èµã€‚\nç¤ºä¾‹ï¼š\n2. 4K ç¾å¥³å£çº¸å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/beauty\nç‰¹ç‚¹ï¼š4Kè¶…æ¸…ç¾å¥³å£çº¸ï¼Œç”»é¢ç»†è…»ã€‚\nç¤ºä¾‹ï¼š\n3. ç”µè„‘ç¾å¥³å›¾ç‰‡ é“¾æ¥ï¼šhttp://api.btstu.cn/sjbz/?lx=meizi\nç‰¹ç‚¹ï¼šä¸“ä¸ºç”µè„‘ç«¯è®¾è®¡çš„ç¾å¥³å£çº¸ï¼Œæ”¯æŒå¤šç§åˆ†è¾¨ç‡ã€‚\nç¤ºä¾‹ï¼š\nğŸ¾ å››ã€èŒå® éšæœºå£çº¸ 1. 4K èŒå® å£çº¸å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/cutepet\nç‰¹ç‚¹ï¼šè¶…èŒå® ç‰©å£çº¸ï¼ŒåŒ…å«çŒ«ã€ç‹—ç­‰å¤šç§åŠ¨ç‰©ã€‚\nç¤ºä¾‹ï¼š\n2. èŒå® åŠ¨ç‰© é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=dw\nç‰¹ç‚¹ï¼šå„ç±»å¯çˆ±åŠ¨ç‰©å£çº¸ï¼Œç”»é¢ç”ŸåŠ¨æœ‰è¶£ã€‚\nç¤ºä¾‹ï¼š\nğŸ® äº”ã€æ¸¸æˆéšæœºå£çº¸ 1. ç‹è€…è£è€€åŸç”»å£çº¸ é“¾æ¥ï¼šhttps://acg.suyanw.cn/wzry\nç‰¹ç‚¹ï¼šç²¾é€‰ã€Šç‹è€…è£è€€ã€‹æ¸¸æˆåŸç”»ï¼Œé«˜æ¸…æ— æ°´å°ã€‚\nç¤ºä¾‹ï¼š\n2. æ¸¸æˆå£çº¸ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=yx\nç‰¹ç‚¹ï¼šæ¶µç›–å¤šæ¬¾çƒ­é—¨æ¸¸æˆçš„å£çº¸ï¼Œæ›´æ–°åŠæ—¶ã€‚\nç¤ºä¾‹ï¼š\n3. 4K æ¸¸æˆå£çº¸å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/Game\nç‰¹ç‚¹ï¼š4Kåˆ†è¾¨ç‡æ¸¸æˆå£çº¸ï¼Œç»†èŠ‚ä¸°å¯Œã€‚\nç¤ºä¾‹ï¼š\nğŸ’¥ å…­ã€åŠ¨æ¼«éšæœºå£çº¸ 1. 4K åŠ¨æ¼«å£çº¸å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/Anime\nç‰¹ç‚¹ï¼šé«˜è´¨é‡åŠ¨æ¼«å£çº¸ï¼ŒåŒ…å«å¤šç§çƒ­é—¨ä½œå“ã€‚\nç¤ºä¾‹ï¼š\n2. åŠ¨æ¼«å£çº¸ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=dm\nç‰¹ç‚¹ï¼šæ¯æ—¥æ›´æ–°çš„åŠ¨æ¼«å£çº¸ï¼Œé£æ ¼å¤šæ ·ã€‚\nç¤ºä¾‹ï¼š\nğŸ” ä¸ƒã€å…¶ä»–éšæœºå£çº¸ 1. 4K å£çº¸ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=4k\nç‰¹ç‚¹ï¼šé€šç”¨4Kè¶…æ¸…å£çº¸ï¼Œæ¶µç›–å¤šç§ç±»åˆ«ã€‚\nç¤ºä¾‹ï¼š\n2. éšæœºç±»å‹å£çº¸ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper\nç‰¹ç‚¹ï¼šéšæœºè¿”å›å¤šç§ç±»å‹çš„å£çº¸ï¼Œæ¯æ¬¡éƒ½æœ‰æƒŠå–œã€‚\nç¤ºä¾‹ï¼š\n3. çˆ±æƒ…ç¾å›¾ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=aqmt\nç‰¹ç‚¹ï¼šæµªæ¼«é£æ ¼çš„çˆ±æƒ…ä¸»é¢˜å£çº¸ï¼Œé€‚åˆæƒ…ä¾£ä½¿ç”¨ã€‚\nç¤ºä¾‹ï¼š\n4. æ˜æ˜Ÿå£çº¸ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=mx\nç‰¹ç‚¹ï¼šå›½å†…å¤–æ˜æ˜Ÿå£çº¸ï¼Œæ›´æ–°é¢‘ç¹ã€‚\nç¤ºä¾‹ï¼š\n5. æ±½è½¦å£çº¸ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=qc\nç‰¹ç‚¹ï¼šè±ªåè·‘è½¦ä¸ç»å…¸è½¦å‹å£çº¸ï¼Œé€‚åˆè½¦è¿·ã€‚\nç¤ºä¾‹ï¼š\n6. ç‚«é…·æ—¶å°š é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=ss\nç‰¹ç‚¹ï¼šæ½®æµä¸æ—¶å°šç»“åˆçš„å£çº¸ï¼Œè§†è§‰å†²å‡»åŠ›å¼ºã€‚\nç¤ºä¾‹ï¼š\n7. å½±è§†å‰§ç…§ é“¾æ¥ï¼šhttps://api.zylearning.top/api/wallpaper?lx=ysjz\nç‰¹ç‚¹ï¼šçƒ­é—¨ç”µå½±ä¸ç”µè§†å‰§ç…§å£çº¸ï¼Œæ¶µç›–å¤šç§ä½œå“ã€‚\nç¤ºä¾‹ï¼š\nğŸŒ… å…«ã€é«˜è´¨é‡æ¯æ—¥å£çº¸ 1. å¿…åº”æ¯æ—¥å£çº¸ é“¾æ¥ï¼šhttps://api.dujin.org/bing/1920.php\nç‰¹ç‚¹ï¼šæ¯æ—¥æ›´æ–°çš„å¿…åº”ç²¾é€‰å£çº¸ï¼Œæ”¯æŒ1920x1080åˆ†è¾¨ç‡ã€‚\nç¤ºä¾‹ï¼š\n2. å¿…åº”æ¯æ—¥å£çº¸ï¼ˆå¤‡ç”¨ï¼‰ é“¾æ¥ï¼šhttps://bingw.jasonzeng.dev\nç‰¹ç‚¹ï¼šå¦ä¸€æ¥æºçš„å¿…åº”æ¯æ—¥å£çº¸ï¼Œç¡®ä¿ç¨³å®šè®¿é—®ã€‚\nç¤ºä¾‹ï¼š\n3. äºŒæ¬¡å…ƒæ¯æ—¥å£çº¸ é“¾æ¥ï¼šhttps://api.paugram.com/wallpaper/?source=sm\nç‰¹ç‚¹ï¼šæ¯æ—¥æ›´æ–°çš„äºŒæ¬¡å…ƒå£çº¸ï¼Œæ¥æºå¯é ã€‚\nç¤ºä¾‹ï¼š\nğŸ–¼ï¸ ä¹ã€åŠ¨æ¼«éšæœºå£çº¸ 1. åŠ¨æ¼«éšæœºå£çº¸ é“¾æ¥ï¼šhttps://api.asxe.vip/random.php\nç‰¹ç‚¹ï¼šéšæœºè¿”å›åŠ¨æ¼«é£æ ¼å£çº¸ï¼ŒåŒ…å«å¤šç§ä½œå“ã€‚\nç¤ºä¾‹ï¼š\n2. mc é…±åŠ¨æ¼« é“¾æ¥ï¼šhttps://acg.suyanw.cn/mcapi/random.php\nç‰¹ç‚¹ï¼šä»¥â€œmcé…±â€ä¸ºä¸»é¢˜çš„åŠ¨æ¼«å£çº¸ï¼Œé£æ ¼ç‹¬ç‰¹ã€‚\nç¤ºä¾‹ï¼š\n3. éšæœºä½ çš„åå­—å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/Yourname/random.php\nç‰¹ç‚¹ï¼šåŸºäºã€Šä½ çš„åå­—ã€‹åŠ¨ç”»ç”µå½±çš„å£çº¸ï¼Œå”¯ç¾æµªæ¼«ã€‚\nç¤ºä¾‹ï¼š\nğŸ’¾ åã€ç‚¹å‡»ä¸‹è½½å£çº¸ 1. éšæœºç¾å¥³ PC å£çº¸ é“¾æ¥ï¼šhttps://acg.suyanw.cn/pcmv\nç‰¹ç‚¹ï¼šä¸“ä¸ºPCç«¯è®¾è®¡çš„ç¾å¥³å£çº¸ï¼Œæ”¯æŒä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n2. éšæœºäºŒæ¬¡å…ƒåœ°å€ é“¾æ¥ï¼šhttps://api.suyanw.cn/api/comic/api.php\nç‰¹ç‚¹ï¼šæä¾›äºŒæ¬¡å…ƒå£çº¸çš„ç›´æ¥ä¸‹è½½é“¾æ¥ã€‚\nç¤ºä¾‹ï¼š\n3. PC éšæœºäºŒæ¬¡å…ƒåœ°å€ é“¾æ¥ï¼šhttps://acg.suyanw.cn/random.php\nç‰¹ç‚¹ï¼šPCç«¯ä¸“ç”¨çš„äºŒæ¬¡å…ƒå£çº¸ä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n4. äºŒæ¬¡å…ƒéšæœºå›¾åœ°å€ é“¾æ¥ï¼šhttps://api.suyanw.cn/api/comic\nç‰¹ç‚¹ï¼šéšæœºè¿”å›äºŒæ¬¡å…ƒå›¾ç‰‡ï¼Œæ”¯æŒä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n5. äºŒæ¬¡å…ƒéšæœºå›¾åœ°å€ï¼ˆåŸç¥ï¼‰ é“¾æ¥ï¼šhttps://api.dujin.org/pic/yuanshen\nç‰¹ç‚¹ï¼šä¸“æ³¨äºã€ŠåŸç¥ã€‹æ¸¸æˆçš„äºŒæ¬¡å…ƒå£çº¸ä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n6. äºŒæ¬¡å…ƒéšæœºå›¾åœ°å€ é“¾æ¥ï¼šhttps://acg.suyanw.cn/api.php\nç‰¹ç‚¹ï¼šé€šç”¨äºŒæ¬¡å…ƒå£çº¸ä¸‹è½½ï¼Œæ¥æºä¸°å¯Œã€‚\nç¤ºä¾‹ï¼š\n7. äºŒæ¬¡å…ƒéšæœºå›¾åœ°å€ é“¾æ¥ï¼šhttps://www.dmoe.cc/random.php\nç‰¹ç‚¹ï¼šæä¾›å¤šç§é£æ ¼çš„äºŒæ¬¡å…ƒå£çº¸ä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n8. äºŒæ¬¡å…ƒéšæœºå›¾åœ°å€ é“¾æ¥ï¼šhttps://acg.suyanw.cn/random.php\nç‰¹ç‚¹ï¼šéšæœºäºŒæ¬¡å…ƒå£çº¸ä¸‹è½½ï¼Œæ›´æ–°é¢‘ç¹ã€‚\nç¤ºä¾‹ï¼š\n9. å‘“å–µé…±API é“¾æ¥ï¼šhttps://api.yimian.xyz/img\nç‰¹ç‚¹ï¼šç”±å‘“å–µé…±æä¾›çš„éšæœºå›¾ç‰‡APIï¼Œæ”¯æŒå¤šç§ç±»å‹ã€‚\nç¤ºä¾‹ï¼š\n10. åŸç¥è‡ªé€‚åº” é“¾æ¥ï¼šhttps://t.alcy.cc/ysz\nç‰¹ç‚¹ï¼šã€ŠåŸç¥ã€‹ä¸»é¢˜çš„è‡ªé€‚åº”å£çº¸ï¼Œæ”¯æŒä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n11. PC æ¨ªå± é“¾æ¥ï¼šhttps://t.alcy.cc/pc\nç‰¹ç‚¹ï¼šPCç«¯æ¨ªå±å£çº¸ä¸‹è½½ï¼Œåˆ†è¾¨ç‡ä¸°å¯Œã€‚\nç¤ºä¾‹ï¼š\n12. èŒç‰ˆæ¨ªå± é“¾æ¥ï¼šhttps://t.alcy.cc/moe\nç‰¹ç‚¹ï¼šèŒç³»é£æ ¼çš„æ¨ªå±å£çº¸ä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n13. é£æ™¯æ¨ªå± é“¾æ¥ï¼šhttps://t.alcy.cc/fj\nç‰¹ç‚¹ï¼šé£æ™¯ä¸»é¢˜çš„æ¨ªå±å£çº¸ä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\n14. ç™½åº•æ¨ªå± é“¾æ¥ï¼šhttps://t.alcy.cc/bd\nç‰¹ç‚¹ï¼šç™½è‰²èƒŒæ™¯çš„æ¨ªå±å£çº¸ï¼Œç®€æ´æ¸…æ–°ã€‚\nç¤ºä¾‹ï¼š\n15. åŸç¥æ¨ªå± é“¾æ¥ï¼šhttps://t.alcy.cc/ys\nç‰¹ç‚¹ï¼šã€ŠåŸç¥ã€‹æ¸¸æˆçš„æ¨ªå±å£çº¸ä¸‹è½½ã€‚\nç¤ºä¾‹ï¼š\nğŸ“± åä¸€ã€æ‰‹æœºéšæœºå£çº¸ 1. æ·˜å®ä¹°å®¶ç§€ é“¾æ¥ï¼šhttps://acg.suyanw.cn/tbmjx/random.php\nç‰¹ç‚¹ï¼šåŸºäºæ·˜å®ä¹°å®¶ç§€çš„å®æ‹å£çº¸ï¼ŒçœŸå®æœ‰è¶£ã€‚\nç¤ºä¾‹ï¼š\n2. éšæœºæ‰‹æœºç¾å¥³ é“¾æ¥ï¼šhttps://acg.suyanw.cn/sjmv/random.php\nç‰¹ç‚¹ï¼šä¸“ä¸ºæ‰‹æœºç«¯è®¾è®¡çš„ç¾å¥³å£çº¸ï¼Œç«–å±é€‚é…ã€‚\nç¤ºä¾‹ï¼š\n3. éšæœºæ‰‹æœºåŠ¨æ¼« é“¾æ¥ï¼šhttps://acg.suyanw.cn/sjdm/random.php\nç‰¹ç‚¹ï¼šæ‰‹æœºä¸“ç”¨çš„åŠ¨æ¼«å£çº¸ï¼Œç”»é¢ç²¾ç¾ã€‚\nç¤ºä¾‹ï¼š\n4. éšæœºå¤´åƒ é“¾æ¥ï¼šhttps://acg.suyanw.cn/sjtx/random.php\nç‰¹ç‚¹ï¼šéšæœºè¿”å›å„ç±»å¤´åƒï¼Œé€‚åˆç¤¾äº¤è´¦å·ä½¿ç”¨ã€‚\nç¤ºä¾‹ï¼š\n5. éšæœºå°å§å§ç¾å¥³å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/ksxjj/random.php\nç‰¹ç‚¹ï¼šä»¥å°å§å§ä¸ºä¸»é¢˜çš„ç¾å¥³å›¾ç‰‡ï¼Œé£æ ¼å¤šæ ·ã€‚\nç¤ºä¾‹ï¼š\n6. éšæœº jk åˆ¶æœå›¾ é“¾æ¥ï¼šhttps://acg.suyanw.cn/jk/random.php\nç‰¹ç‚¹ï¼šJKåˆ¶æœé£æ ¼çš„å£çº¸ï¼Œæ·±å—å–œçˆ±ã€‚\nç¤ºä¾‹ï¼š\n7. éšæœºé»‘ä¸å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/hs/random.php\nç‰¹ç‚¹ï¼šé»‘ä¸ä¸»é¢˜çš„å£çº¸ï¼Œé€‚åˆç‰¹å®šç¾¤ä½“ã€‚\nç¤ºä¾‹ï¼š\n8. éšæœºä¸‰æ¬¡å…ƒç™½ä¸ API é“¾æ¥ï¼šhttps://acg.suyanw.cn/whitesilk/random.php\nç‰¹ç‚¹ï¼šç™½ä¸é£æ ¼çš„ä¸‰æ¬¡å…ƒå£çº¸ï¼Œç”»é¢å”¯ç¾ã€‚\nç¤ºä¾‹ï¼š\n9. éšæœºäºŒæ¬¡å…ƒè‰²å›¾ é“¾æ¥ï¼šhttps://acg.suyanw.cn/sex/random.php\nç‰¹ç‚¹ï¼šäºŒæ¬¡å…ƒé£æ ¼çš„è‰²å›¾å£çº¸ï¼Œè¯·æ³¨æ„ä½¿ç”¨åœºæ™¯ã€‚\nç¤ºä¾‹ï¼š\n10. éšæœºçŒ«ç¾½é›«å›¾ç‰‡ é“¾æ¥ï¼šhttps://acg.suyanw.cn/mao/random.php\nç‰¹ç‚¹ï¼šä»¥â€œçŒ«ç¾½é›«â€ä¸ºä¸»é¢˜çš„äºŒæ¬¡å…ƒå£çº¸ï¼Œé£æ ¼å¯çˆ±ã€‚\nç¤ºä¾‹ï¼š\n11. éšæœº COS ç¾å›¾ é“¾æ¥ï¼šhttps://acg.suyanw.cn/cos/random.php\nç‰¹ç‚¹ï¼šCOSPLAYä¸»é¢˜çš„ç¾å›¾ï¼Œè¿˜åŸåº¦æé«˜ã€‚\nç¤ºä¾‹ï¼š\n12. åŸç¥éšæœºå›¾ é“¾æ¥ï¼šhttps://api.suyanw.cn/api/ys\nç‰¹ç‚¹ï¼šã€ŠåŸç¥ã€‹æ¸¸æˆçš„éšæœºå£çº¸ï¼Œæ›´æ–°é¢‘ç¹ã€‚\nç¤ºä¾‹ï¼š\n13. äºŒæ¬¡å…ƒéšæœºå›¾ é“¾æ¥ï¼šhttps://api.anosu.top/img/\nç‰¹ç‚¹ï¼šé«˜è´¨é‡çš„äºŒæ¬¡å…ƒéšæœºå›¾ç‰‡ï¼Œæ”¯æŒå¤šç§é£æ ¼ã€‚\nç¤ºä¾‹ï¼š\n14. ç§»åŠ¨ç«–å± é“¾æ¥ï¼šhttps://t.alcy.cc/mp\nç‰¹ç‚¹ï¼šä¸“ä¸ºç§»åŠ¨ç«¯è®¾è®¡çš„ç«–å±å£çº¸ï¼Œé€‚é…å¤§å¤šæ•°æ‰‹æœºã€‚\nç¤ºä¾‹ï¼š\n15. èŒç‰ˆç«–å± é“¾æ¥ï¼šhttps://t.alcy.cc/moemp\nç‰¹ç‚¹ï¼šèŒç³»é£æ ¼çš„ç«–å±å£çº¸ï¼Œå¯çˆ±æ¸…æ–°ã€‚\nç¤ºä¾‹ï¼š\n16. åŸç¥ç«–å± é“¾æ¥ï¼šhttps://t.alcy.cc/ysmp\nç‰¹ç‚¹ï¼šã€ŠåŸç¥ã€‹ä¸»é¢˜çš„ç«–å±å£çº¸ï¼Œæ·±å—ç©å®¶å–œçˆ±ã€‚\nç¤ºä¾‹ï¼š\n17. AI ç«–å± é“¾æ¥ï¼šhttps://t.alcy.cc/aimp\nç‰¹ç‚¹ï¼šAIç”Ÿæˆçš„ç«–å±è‰ºæœ¯å£çº¸ï¼Œæ¯å¼ éƒ½ç‹¬ä¸€æ— äºŒã€‚\nç¤ºä¾‹ï¼š\n18. ç«–å±å£çº¸ é“¾æ¥ï¼šhttps://t.mwm.moe/mp\nç‰¹ç‚¹ï¼šé€šç”¨ç«–å±å£çº¸ï¼Œæ¶µç›–å¤šç§ä¸»é¢˜ã€‚\nç¤ºä¾‹ï¼š\nå¤‡æ³¨ï¼šéƒ¨åˆ†APIå¯èƒ½éœ€è¦ç½‘ç»œä»£ç†æˆ–ç‰¹å®šè®¿é—®æƒé™ï¼Œå¦‚é‡æ— æ³•è®¿é—®ï¼Œè¯·å°è¯•å…¶ä»–é“¾æ¥ã€‚\n","date":"2024-12-07T07:15:51+08:00","image":"https://api.timelessq.com/bing/random","permalink":"https://blog.meimolihan.eu.org/p/cb79b856/","title":"éšæœºå£çº¸ API åˆé›† ğŸ–¼ï¸"},{"content":"Docker å‘½ä»¤å¤§å…¨ ğŸ³ ç›®å½• ğŸ“š âœ¨ Docker ç®€ä»‹ ğŸ“¦ ä¸€ã€å®‰è£…ä¸å¸è½½ ğŸ” äºŒã€åŸºæœ¬ä¿¡æ¯ä¸ç‰ˆæœ¬ ğŸ‹ ä¸‰ã€å®¹å™¨ç®¡ç† ğŸ–¥ï¸ å››ã€å®¹å™¨æ“ä½œ ğŸï¸ äº”ã€é•œåƒç®¡ç† ğŸŒ å…­ã€ç½‘ç»œç®¡ç† ğŸ’¾ ä¸ƒã€æ•°æ®å·ç®¡ç† ğŸ› ï¸ å…«ã€Docker Compose å‘½ä»¤ ğŸ§¹ ä¹ã€æ¸…ç†ä¸ç»´æŠ¤ ğŸ” åã€å®‰å…¨ç›¸å…³ ğŸ’¡ åä¸€ã€å®ç”¨æŠ€å·§ä¸ç¤ºä¾‹ ğŸš¨ åäºŒã€æ³¨æ„äº‹é¡¹ ğŸ“š åä¸‰ã€å­¦ä¹ èµ„æº âœ¨ Docker ç®€ä»‹ Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œå…è®¸å¼€å‘è€…å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–æ‰“åŒ…åˆ°è½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ã€‚è¿™äº›å®¹å™¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„ç³»ç»Ÿä¸­è¿è¡Œï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§å¹¶ç®€åŒ–éƒ¨ç½²æµç¨‹ã€‚\nğŸ¯ Docker çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š ç¯å¢ƒä¸€è‡´æ€§ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´ å¿«é€Ÿéƒ¨ç½²ï¼šç§’çº§å¯åŠ¨å’Œåœæ­¢å®¹å™¨ èµ„æºéš”ç¦»ï¼šæ¯ä¸ªå®¹å™¨æ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒ æ˜“äºæ‰©å±•ï¼šå¿«é€Ÿå¤åˆ¶å’Œæ‰©å±•å®¹å™¨å®ä¾‹ ç‰ˆæœ¬æ§åˆ¶ï¼šé•œåƒç‰ˆæœ¬ç®¡ç†ï¼Œè½»æ¾å›æ»š ğŸ”§ Docker æ ¸å¿ƒç»„ä»¶ï¼š Docker Engineï¼šæ ¸å¿ƒå®¹å™¨è¿è¡Œæ—¶ Docker Imagesï¼šåªè¯»æ¨¡æ¿ï¼Œç”¨äºåˆ›å»ºå®¹å™¨ Docker Containersï¼šé•œåƒçš„è¿è¡Œå®ä¾‹ Docker Registryï¼šé•œåƒå­˜å‚¨å’Œåˆ†å‘æœåŠ¡ Docker Composeï¼šå¤šå®¹å™¨åº”ç”¨å®šä¹‰å’Œç®¡ç†å·¥å…· ğŸ“¦ ä¸€ã€å®‰è£…ä¸å¸è½½ 1ï¸âƒ£ å¸è½½ Docker 1 2 3 4 5 6 7 8 9 10 11 # Ubuntu/Debian ç³»ç»Ÿå¸è½½ sudo apt-get remove docker docker-engine docker.io containerd runc sudo apt-get purge docker-ce docker-ce-cli containerd.io # CentOS/RHEL ç³»ç»Ÿå¸è½½ sudo yum remove docker-ce docker-ce-cli containerd.io # æ¸…é™¤ Docker ç›¸å…³æ–‡ä»¶å’Œé…ç½® sudo rm -rf /var/lib/docker sudo rm -rf /var/lib/containerd sudo rm -rf /etc/docker 2ï¸âƒ£ å®‰è£… Docker (Ubuntu/Debian) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼• sudo apt-get update # å®‰è£…ä¾èµ–åŒ… sudo apt-get install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg \\ lsb-release # æ·»åŠ  Docker å®˜æ–¹ GPG å¯†é’¥ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg # è®¾ç½®ç¨³å®šç‰ˆä»“åº“ echo \\ \u0026#34;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\u0026#34; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null # å®‰è£… Docker Engine sudo apt-get update sudo apt-get install docker-ce docker-ce-cli containerd.io # å¯åŠ¨ Docker å¹¶è®¾ç½®å¼€æœºè‡ªå¯ sudo systemctl start docker sudo systemctl enable docker # éªŒè¯å®‰è£… sudo docker run hello-world 3ï¸âƒ£ å®‰è£… Docker (CentOS/RHEL) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # å¸è½½æ—§ç‰ˆæœ¬ sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine # å®‰è£…ä¾èµ–åŒ… sudo yum install -y yum-utils # è®¾ç½®ç¨³å®šçš„ä»“åº“ sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo # å®‰è£… Docker Engine sudo yum install docker-ce docker-ce-cli containerd.io # å¯åŠ¨ Docker sudo systemctl start docker sudo systemctl enable docker # éªŒè¯å®‰è£… sudo docker run hello-world 4ï¸âƒ£ å®‰è£… Docker Compose 1 2 3 4 5 6 7 8 # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Docker Compose sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep \u0026#39;\u0026#34;tag_name\u0026#34;:\u0026#39; | sed -E \u0026#39;s/.*\u0026#34;([^\u0026#34;]+)\u0026#34;.*/\\1/)/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose # æ·»åŠ æ‰§è¡Œæƒé™ sudo chmod +x /usr/local/bin/docker-compose # éªŒè¯å®‰è£… docker-compose --version ğŸ” äºŒã€åŸºæœ¬ä¿¡æ¯ä¸ç‰ˆæœ¬ 1ï¸âƒ£ ç‰ˆæœ¬ä¿¡æ¯æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ Docker ç‰ˆæœ¬ä¿¡æ¯ docker --version # æŸ¥çœ‹è¯¦ç»†çš„ Docker ç‰ˆæœ¬ä¿¡æ¯ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰ docker version # æŸ¥çœ‹ Docker ç³»ç»Ÿä¿¡æ¯ docker info # æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨æƒ…å†µ docker system df # æŸ¥çœ‹è¯¦ç»†çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ docker system df -v 2ï¸âƒ£ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€ sudo systemctl status docker # æŸ¥çœ‹ Docker è¿è¡Œæ—¶ä¿¡æ¯ docker info | grep -E \u0026#34;(Server Version|Storage Driver|Total Memory)\u0026#34; # æŸ¥çœ‹ Docker å®¹å™¨è¿è¡ŒçŠ¶æ€ docker stats --no-stream # æŸ¥çœ‹ Docker äº‹ä»¶æµ docker events ğŸ‹ ä¸‰ã€å®¹å™¨ç®¡ç† 1ï¸âƒ£ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ docker run [OPTIONS] IMAGE [COMMAND] [ARG...] # ç¤ºä¾‹ï¼šè¿è¡Œä¸€ä¸ªäº¤äº’å¼çš„ Ubuntu å®¹å™¨ docker run -it --name my-ubuntu ubuntu:20.04 /bin/bash # ç¤ºä¾‹ï¼šåœ¨åå°è¿è¡Œä¸€ä¸ª Nginx å®¹å™¨ docker run -d --name my-nginx -p 8080:80 nginx:latest # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ docker ps # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰ docker ps -a # æŸ¥çœ‹æœ€è¿‘åˆ›å»ºçš„å®¹å™¨ docker ps -l # æŸ¥çœ‹å®¹å™¨å¤§å° docker ps -s # æ ¼å¼åŒ–è¾“å‡ºå®¹å™¨ä¿¡æ¯ docker ps --format \u0026#34;table {{.ID}}\\t{{.Names}}\\t{{.Status}}\\t{{.Ports}}\u0026#34; 2ï¸âƒ£ å®¹å™¨å¯åœç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # åœæ­¢å®¹å™¨ docker stop \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # å¼ºåˆ¶åœæ­¢å®¹å™¨ï¼ˆå‘é€ SIGKILLï¼‰ docker kill \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ docker start \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # é‡å¯å®¹å™¨ docker restart \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æš‚åœå®¹å™¨ docker pause \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æ¢å¤æš‚åœçš„å®¹å™¨ docker unpause \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ docker stop $(docker ps -q) # æ‰¹é‡æ“ä½œç¤ºä¾‹ docker stop $(docker ps -aq) # åœæ­¢æ‰€æœ‰å®¹å™¨ docker start $(docker ps -aq) # å¯åŠ¨æ‰€æœ‰å®¹å™¨ 3ï¸âƒ£ å®¹å™¨åˆ é™¤ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ é™¤å·²åœæ­¢çš„å®¹å™¨ docker rm \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # å¼ºåˆ¶åˆ é™¤å®¹å™¨ï¼ˆåŒ…æ‹¬è¿è¡Œä¸­çš„ï¼‰ docker rm -f \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ docker container prune # åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬è¿è¡Œä¸­çš„ï¼‰ docker rm -f $(docker ps -aq) # åˆ é™¤å®¹å™¨æ—¶åŒæ—¶åˆ é™¤å…³è”çš„åŒ¿åå· docker rm -v \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; 4ï¸âƒ£ å®¹å™¨ç›‘æ§ä¸æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆè·Ÿéšè¾“å‡ºï¼‰ docker logs -f \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹æœ€å N è¡Œæ—¥å¿— docker logs --tail 100 \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹æŒ‡å®šæ—¶é—´åçš„æ—¥å¿— docker logs --since 2023-01-01T00:00:00 \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker stats \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨èµ„æºä½¿ç”¨ï¼ˆå®æ—¶æ›´æ–°ï¼‰ docker stats --all # åªæŸ¥çœ‹ä¸€æ¬¡èµ„æºä½¿ç”¨æƒ…å†µ docker stats --no-stream # æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ä¿¡æ¯ docker top \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; ğŸ–¥ï¸ å››ã€å®¹å™¨æ“ä½œ 1ï¸âƒ£ å®¹å™¨äº¤äº’ä¸æ‰§è¡Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆä½¿ç”¨ bashï¼‰ docker exec -it \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; bash # è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆä½¿ç”¨ shï¼‰ docker exec -it \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; sh # åœ¨å®¹å™¨ä¸­æ‰§è¡Œå•æ¡å‘½ä»¤ docker exec \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; \u0026lt;å‘½ä»¤\u0026gt; # ç¤ºä¾‹ï¼šåœ¨å®¹å™¨ä¸­æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ docker exec \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; ls -la # ç¤ºä¾‹ï¼šåœ¨å®¹å™¨ä¸­æŸ¥çœ‹è¿›ç¨‹ docker exec \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; ps aux # ä»¥ç‰¹æƒæ¨¡å¼è¿›å…¥å®¹å™¨ï¼ˆæœ‰ç³»ç»Ÿæƒé™ï¼‰ docker exec -it --privileged \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; bash 2ï¸âƒ£ æ–‡ä»¶æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ° docker cp \u0026lt;å®¹å™¨åæˆ–ID\u0026gt;:\u0026lt;å®¹å™¨å†…è·¯å¾„\u0026gt; \u0026lt;æœ¬åœ°è·¯å¾„\u0026gt; # ä»æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨ docker cp \u0026lt;æœ¬åœ°è·¯å¾„\u0026gt; \u0026lt;å®¹å™¨åæˆ–ID\u0026gt;:\u0026lt;å®¹å™¨å†…è·¯å¾„\u0026gt; # ç¤ºä¾‹ï¼šå¤åˆ¶å®¹å™¨ä¸­çš„æ—¥å¿—æ–‡ä»¶ docker cp my-nginx:/var/log/nginx/access.log ./nginx-access.log # ç¤ºä¾‹ï¼šå¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å®¹å™¨ docker cp nginx.conf my-nginx:/etc/nginx/nginx.conf # å¤åˆ¶ç›®å½•ï¼ˆé€’å½’å¤åˆ¶ï¼‰ docker cp ./config/ my-nginx:/etc/nginx/conf.d/ 3ï¸âƒ£ å®¹å™¨é…ç½®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # é‡å‘½åå®¹å™¨ docker rename \u0026lt;æ—§å®¹å™¨å\u0026gt; \u0026lt;æ–°å®¹å™¨å\u0026gt; # æ›´æ–°å®¹å™¨é…ç½® docker update --memory 512m \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; docker update --cpus 2 \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹å®¹å™¨ç‰¹å®šä¿¡æ¯ï¼ˆå¦‚IPåœ°å€ï¼‰ docker inspect -f \u0026#39;{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}\u0026#39; \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # æŸ¥çœ‹å®¹å™¨æ—¥å¿—è·¯å¾„ docker inspect --format=\u0026#39;{{.LogPath}}\u0026#39; \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; # å¯¼å‡ºå®¹å™¨ä¸ºtaråŒ… docker export \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; \u0026gt; container.tar # ä»taråŒ…å¯¼å…¥ä¸ºé•œåƒ docker import container.tar my-image:latest ğŸï¸ äº”ã€é•œåƒç®¡ç† 1ï¸âƒ£ é•œåƒåŸºæœ¬æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ docker images # æŸ¥çœ‹æ‰€æœ‰é•œåƒï¼ˆåŒ…æ‹¬ä¸­é—´å±‚é•œåƒï¼‰ docker images -a # æ˜¾ç¤ºé•œåƒID docker images -q # æ‹‰å–é•œåƒ docker pull \u0026lt;é•œåƒå\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt; # ç¤ºä¾‹ï¼šæ‹‰å–ç‰¹å®šç‰ˆæœ¬çš„ Ubuntu docker pull ubuntu:20.04 # æœç´¢ Docker Hub ä¸Šçš„é•œåƒ docker search \u0026lt;å…³é”®è¯\u0026gt; # ç¤ºä¾‹ï¼šæœç´¢ Nginx ç›¸å…³é•œåƒ docker search nginx # åˆ é™¤é•œåƒ docker rmi \u0026lt;é•œåƒåæˆ–ID\u0026gt; # å¼ºåˆ¶åˆ é™¤é•œåƒ docker rmi -f \u0026lt;é•œåƒåæˆ–ID\u0026gt; # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ docker image prune -a # åˆ é™¤æ‚¬ç©ºé•œåƒï¼ˆæ— æ ‡ç­¾é•œåƒï¼‰ docker image prune 2ï¸âƒ£ é•œåƒæ„å»ºä¸å¯¼å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æ„å»ºé•œåƒ docker build -t \u0026lt;é•œåƒå\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt; \u0026lt;Dockerfileè·¯å¾„\u0026gt; # ç¤ºä¾‹ï¼šæ„å»ºå¹¶æ ‡ç­¾é•œåƒ docker build -t my-app:1.0.0 . # ä» Dockerfile æ„å»ºï¼ˆæŒ‡å®šæ–‡ä»¶ï¼‰ docker build -f Dockerfile.prod -t my-app:prod . # æŸ¥çœ‹é•œåƒæ„å»ºå†å² docker history \u0026lt;é•œåƒåæˆ–ID\u0026gt; # ä¿å­˜é•œåƒä¸º tar æ–‡ä»¶ docker save -o \u0026lt;æ–‡ä»¶å\u0026gt;.tar \u0026lt;é•œåƒå\u0026gt; # ä» tar æ–‡ä»¶åŠ è½½é•œåƒ docker load -i \u0026lt;æ–‡ä»¶å\u0026gt;.tar # å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿ docker export \u0026lt;å®¹å™¨åæˆ–ID\u0026gt; \u0026gt; container.tar # å¯¼å…¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸ºé•œåƒ docker import container.tar my-imported-image:latest 3ï¸âƒ£ é•œåƒæ ‡ç­¾ä¸æ¨é€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ç»™é•œåƒæ‰“æ ‡ç­¾ docker tag \u0026lt;æºé•œåƒå\u0026gt; \u0026lt;æ–°é•œåƒå\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt; # ç¤ºä¾‹ï¼šä¸ºé•œåƒæ·»åŠ ç‰ˆæœ¬æ ‡ç­¾ docker tag my-app:latest my-app:1.0.0 # ç™»å½•åˆ° Docker Registry docker login # ç™»å‡º Docker Registry docker logout # æ¨é€é•œåƒåˆ° Registry docker push \u0026lt;ç”¨æˆ·å\u0026gt;/\u0026lt;é•œåƒå\u0026gt;:\u0026lt;æ ‡ç­¾\u0026gt; # ç¤ºä¾‹ï¼šæ¨é€é•œåƒåˆ° Docker Hub docker push myusername/my-app:1.0.0 ğŸŒ å…­ã€ç½‘ç»œç®¡ç† 1ï¸âƒ£ ç½‘ç»œåŸºæœ¬æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨ docker network ls # æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯ docker network inspect \u0026lt;ç½‘ç»œå\u0026gt; # åˆ›å»ºç½‘ç»œ docker network create \u0026lt;ç½‘ç»œå\u0026gt; # åˆ›å»ºå¸¦è‡ªå®šä¹‰å­ç½‘çš„ç½‘ç»œ docker network create --subnet=192.168.100.0/24 my-network # åˆ é™¤ç½‘ç»œ docker network rm \u0026lt;ç½‘ç»œå\u0026gt; # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ docker network prune # æŸ¥çœ‹ç½‘ç»œé©±åŠ¨ä¿¡æ¯ docker network ls --filter driver=bridge 2ï¸âƒ£ å®¹å™¨ç½‘ç»œè¿æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ docker network connect \u0026lt;ç½‘ç»œå\u0026gt; \u0026lt;å®¹å™¨å\u0026gt; # æ–­å¼€å®¹å™¨ä¸ç½‘ç»œçš„è¿æ¥ docker network disconnect \u0026lt;ç½‘ç»œå\u0026gt; \u0026lt;å®¹å™¨å\u0026gt; # åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šç½‘ç»œ docker run -d --name my-app --network my-network nginx:latest # æŸ¥çœ‹å®¹å™¨ç½‘ç»œä¿¡æ¯ docker inspect -f \u0026#39;{{json .NetworkSettings.Networks}}\u0026#39; \u0026lt;å®¹å™¨å\u0026gt; # ä¸ºå®¹å™¨æŒ‡å®šé™æ€IP docker network create --subnet=172.20.0.0/16 my-net docker run --network my-net --ip 172.20.0.10 -d nginx:latest 3ï¸âƒ£ ç½‘ç»œç±»å‹ä¸é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œç±»å‹ docker network ls # åˆ›å»ºä¸åŒé©±åŠ¨ç±»å‹çš„ç½‘ç»œ docker network create -d bridge my-bridge-network docker network create -d overlay my-overlay-network # æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…ï¼ˆåŒ…æ‹¬è¿æ¥çš„å®¹å™¨ï¼‰ docker network inspect \u0026lt;ç½‘ç»œå\u0026gt; --format=\u0026#39;{{json .Containers}}\u0026#39; # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ docker exec \u0026lt;å®¹å™¨å\u0026gt; ping \u0026lt;ç›®æ ‡å®¹å™¨å\u0026gt; ğŸ’¾ ä¸ƒã€æ•°æ®å·ç®¡ç† 1ï¸âƒ£ æ•°æ®å·åŸºæœ¬æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹æ•°æ®å·åˆ—è¡¨ docker volume ls # åˆ›å»ºæ•°æ®å· docker volume create \u0026lt;å·å\u0026gt; # æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯ docker volume inspect \u0026lt;å·å\u0026gt; # åˆ é™¤æ•°æ®å· docker volume rm \u0026lt;å·å\u0026gt; # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å· docker volume prune # æŸ¥çœ‹æ•°æ®å·ä½¿ç”¨æƒ…å†µ docker system df -v 2ï¸âƒ£ æ•°æ®å·æŒ‚è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # è¿è¡Œå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å· docker run -v \u0026lt;å·å\u0026gt;:\u0026lt;å®¹å™¨å†…è·¯å¾„\u0026gt; \u0026lt;é•œåƒå\u0026gt; # ç¤ºä¾‹ï¼šæŒ‚è½½æ•°æ®å·åˆ° Nginx docker run -d -v nginx-data:/usr/share/nginx/html nginx:latest # æŒ‚è½½ä¸»æœºç›®å½•åˆ°å®¹å™¨ docker run -v \u0026lt;ä¸»æœºè·¯å¾„\u0026gt;:\u0026lt;å®¹å™¨å†…è·¯å¾„\u0026gt; \u0026lt;é•œåƒå\u0026gt; # ç¤ºä¾‹ï¼šæŒ‚è½½ä¸»æœºç›®å½• docker run -v /host/data:/container/data nginx:latest # åªè¯»æŒ‚è½½ docker run -v \u0026lt;å·å\u0026gt;:\u0026lt;å®¹å™¨å†…è·¯å¾„\u0026gt;:ro \u0026lt;é•œåƒå\u0026gt; # åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šå¤šä¸ªå· docker run -v vol1:/data1 -v vol2:/data2 nginx:latest 3ï¸âƒ£ æ•°æ®å·é«˜çº§ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä½¿ç”¨ --mount è¯­æ³•ï¼ˆæ›´è¯¦ç»†çš„é€‰é¡¹ï¼‰ docker run --mount source=\u0026lt;å·å\u0026gt;,target=\u0026lt;å®¹å™¨å†…è·¯å¾„\u0026gt; \u0026lt;é•œåƒå\u0026gt; # ç¤ºä¾‹ï¼šä½¿ç”¨ --mount è¯­æ³• docker run --mount source=my-volume,target=/app/data nginx:latest # åˆ›å»ºå¸¦æœ‰æ ‡ç­¾çš„å· docker volume create --label env=prod app-data # æ ¹æ®æ ‡ç­¾è¿‡æ»¤å· docker volume ls --filter label=env=prod # å¤‡ä»½æ•°æ®å· docker run --rm -v \u0026lt;å·å\u0026gt;:/volume -v $(pwd):/backup alpine \\ tar -czf /backup/backup.tar.gz -C /volume ./ # æ¢å¤æ•°æ®å· docker run --rm -v \u0026lt;å·å\u0026gt;:/volume -v $(pwd):/backup alpine \\ tar -xzf /backup/backup.tar.gz -C /volume ğŸ› ï¸ å…«ã€Docker Compose å‘½ä»¤ 1ï¸âƒ£ Compose åŸºæœ¬æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆå‰å°è¿è¡Œï¼‰ docker-compose up # å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰ docker-compose up -d # ä½¿ç”¨ç‰¹å®šçš„ compose æ–‡ä»¶ docker-compose -f docker-compose.prod.yml up -d # åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æœåŠ¡ docker-compose down # æŸ¥çœ‹æœåŠ¡çŠ¶æ€ docker-compose ps # æŸ¥çœ‹æœåŠ¡æ—¥å¿— docker-compose logs # æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿— docker-compose logs \u0026lt;æœåŠ¡å\u0026gt; # å®æ—¶æŸ¥çœ‹æ—¥å¿— docker-compose logs -f 2ï¸âƒ£ Compose æœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¯åŠ¨ç‰¹å®šæœåŠ¡ docker-compose start \u0026lt;æœåŠ¡å\u0026gt; # åœæ­¢ç‰¹å®šæœåŠ¡ docker-compose stop \u0026lt;æœåŠ¡å\u0026gt; # é‡å¯ç‰¹å®šæœåŠ¡ docker-compose restart \u0026lt;æœåŠ¡å\u0026gt; # æš‚åœç‰¹å®šæœåŠ¡ docker-compose pause \u0026lt;æœåŠ¡å\u0026gt; # æ¢å¤ç‰¹å®šæœåŠ¡ docker-compose unpause \u0026lt;æœåŠ¡å\u0026gt; # é‡å»ºå¹¶å¯åŠ¨æœåŠ¡ docker-compose up --build \u0026lt;æœåŠ¡å\u0026gt; # å¼ºåˆ¶é‡å»ºæœåŠ¡ docker-compose build --no-cache \u0026lt;æœåŠ¡å\u0026gt; 3ï¸âƒ£ Compose é«˜çº§æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åœ¨æœåŠ¡ä¸­æ‰§è¡Œå‘½ä»¤ docker-compose exec \u0026lt;æœåŠ¡å\u0026gt; \u0026lt;å‘½ä»¤\u0026gt; # ç¤ºä¾‹ï¼šåœ¨ web æœåŠ¡ä¸­æ‰§è¡Œ bash docker-compose exec web bash # æŸ¥çœ‹æœåŠ¡é…ç½® docker-compose config # éªŒè¯ compose æ–‡ä»¶è¯­æ³• docker-compose config --no-interpolate # æ‹‰å–æœåŠ¡é•œåƒ docker-compose pull # æ¨é€æœåŠ¡é•œåƒ docker-compose push # æ‰©å±•æœåŠ¡å®ä¾‹æ•°é‡ docker-compose up --scale \u0026lt;æœåŠ¡å\u0026gt;=3 -d ğŸ§¹ ä¹ã€æ¸…ç†ä¸ç»´æŠ¤ 1ï¸âƒ£ ç³»ç»Ÿæ¸…ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº docker system prune # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æºï¼ˆåŒ…æ‹¬æœªä½¿ç”¨çš„é•œåƒï¼‰ docker system prune -a # åˆ é™¤æ‚¬ç©ºé•œåƒ docker image prune # åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ docker container prune # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ docker network prune # åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å· docker volume prune # åˆ é™¤æ„å»ºç¼“å­˜ docker builder prune 2ï¸âƒ£ ç³»ç»Ÿä¿¡æ¯ä¸ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨è¯¦æƒ… docker system df -v # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡ docker stats # æŸ¥çœ‹äº‹ä»¶æµ docker events # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ docker version # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ docker info # æ£€æŸ¥ Docker å®‰è£… docker info | grep -E \u0026#34;(Server Version|Containers|Images|Storage Driver)\u0026#34; ğŸ” åã€å®‰å…¨ç›¸å…³ 1ï¸âƒ£ å®¹å™¨å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä»¥é root ç”¨æˆ·è¿è¡Œå®¹å™¨ docker run -u 1000:1000 \u0026lt;é•œåƒå\u0026gt; # è®¾ç½®å®¹å™¨ç”¨æˆ· docker run --user \u0026lt;ç”¨æˆ·å\u0026gt; \u0026lt;é•œåƒå\u0026gt; # é™åˆ¶å®¹å™¨æƒé™ docker run --cap-drop ALL --cap-add NET_BIND_SERVICE \u0026lt;é•œåƒå\u0026gt; # è®¾ç½®å®¹å™¨å®‰å…¨é€‰é¡¹ docker run --security-opt no-new-privileges \u0026lt;é•œåƒå\u0026gt; # åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ docker run --read-only \u0026lt;é•œåƒå\u0026gt; # ä¸´æ—¶æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ docker run --tmpfs /tmp:rw,size=64m \u0026lt;é•œåƒå\u0026gt; 2ï¸âƒ£ é•œåƒå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰«æé•œåƒæ¼æ´ docker scan \u0026lt;é•œåƒå\u0026gt; # æŸ¥çœ‹é•œåƒå†å² docker history \u0026lt;é•œåƒå\u0026gt; # æ£€æŸ¥é•œåƒç­¾å docker trust inspect \u0026lt;é•œåƒå\u0026gt; # ä½¿ç”¨å†…å®¹ä¿¡ä»» export DOCKER_CONTENT_TRUST=1 # æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯ docker inspect \u0026lt;é•œåƒå\u0026gt; 3ï¸âƒ£ ç½‘ç»œä¸èµ„æºå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é™åˆ¶å®¹å™¨èµ„æº docker run --memory=512m --cpus=1.5 \u0026lt;é•œåƒå\u0026gt; # è®¾ç½®å®¹å™¨é‡å¯ç­–ç•¥ docker run --restart unless-stopped \u0026lt;é•œåƒå\u0026gt; # è®¾ç½®å®¹å™¨èµ„æºé™åˆ¶ docker run --memory-swap=1g \u0026lt;é•œåƒå\u0026gt; # è®¾ç½®å®¹å™¨ OOM ä¼˜å…ˆçº§ docker run --oom-score-adj=500 \u0026lt;é•œåƒå\u0026gt; # ç”Ÿæˆéšæœºå¯†é’¥ openssl rand -base64 32 ğŸ’¡ åä¸€ã€å®ç”¨æŠ€å·§ä¸ç¤ºä¾‹ 1ï¸âƒ£ æ‰¹é‡æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ docker stop $(docker ps -q) # åˆ é™¤æ‰€æœ‰å®¹å™¨ docker rm $(docker ps -aq) # åˆ é™¤æ‰€æœ‰é•œåƒ docker rmi $(docker images -q) # æ¸…ç†æ‰€æœ‰ Docker èµ„æº docker system prune -af # æ‰¹é‡æ‰“æ ‡ç­¾ for image in $(docker images -q); do docker tag $image myregistry/$image; done # æ‰¹é‡æ¨é€é•œåƒ docker images | grep myregistry | awk \u0026#39;{print $1\u0026#34;:\u0026#34;$2}\u0026#39; | xargs -I {} docker push {} 2ï¸âƒ£ å®ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # è¿è¡Œä¸€ä¸ªä¸´æ—¶çš„è°ƒè¯•å®¹å™¨ docker run -it --rm alpine:latest sh # ç«¯å£æ˜ å°„ç¤ºä¾‹ docker run -p 8080:80 -p 8443:443 nginx:latest # ç¯å¢ƒå˜é‡è®¾ç½® docker run -e \u0026#34;ENV=production\u0026#34; -e \u0026#34;DEBUG=false\u0026#34; my-app:latest # æ•°æ®å·æŒ‚è½½ç¤ºä¾‹ docker run -v /host/data:/container/data -v config:/app/config nginx:latest # èµ„æºé™åˆ¶ç¤ºä¾‹ docker run --memory=1g --cpus=2 --cpu-shares=512 my-app:latest # ç½‘ç»œé…ç½®ç¤ºä¾‹ docker run --network=host --dns=8.8.8.8 nginx:latest # å¥åº·æ£€æŸ¥ç¤ºä¾‹ docker run --health-cmd=\u0026#34;curl -f http://localhost/ || exit 1\u0026#34; \\ --health-interval=30s \\ --health-timeout=10s \\ --health-retries=3 \\ nginx:latest 3ï¸âƒ£ ç›‘æ§ä¸è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å®æ—¶ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨ docker stats --format \u0026#34;table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\\t{{.NetIO}}\u0026#34; # æŸ¥çœ‹å®¹å™¨æ—¥å¿—å¹¶è¿‡æ»¤ docker logs \u0026lt;å®¹å™¨å\u0026gt; 2\u0026gt;\u0026amp;1 | grep -i error # æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€ docker inspect --format=\u0026#39;{{json .State.Health}}\u0026#39; \u0026lt;å®¹å™¨å\u0026gt; # æ€§èƒ½åˆ†æ docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \\ docker.io/docker/docker-bench-security # ç½‘ç»œè¯Šæ–­ docker run --rm -it --network container:\u0026lt;å®¹å™¨å\u0026gt; nicolaka/netshoot ğŸš¨ åäºŒã€æ³¨æ„äº‹é¡¹ 1ï¸âƒ£ å®‰å…¨æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 1. ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ç‰¹æƒå®¹å™¨ # é”™è¯¯ç¤ºä¾‹ï¼š docker run --privileged my-app:latest # 2. é¿å…ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œå®¹å™¨ # æ­£ç¡®åšæ³•ï¼š docker run -u 1000:1000 my-app:latest # 3. å®šæœŸæ›´æ–°åŸºç¡€é•œåƒä»¥è·å–å®‰å…¨è¡¥ä¸ docker pull ubuntu:20.04 # 4. ä½¿ç”¨å†…å®¹ä¿¡ä»»éªŒè¯é•œåƒ export DOCKER_CONTENT_TRUST=1 # 5. é™åˆ¶å®¹å™¨èµ„æºä½¿ç”¨ docker run --memory=512m --cpus=1.0 my-app:latest 2ï¸âƒ£ æ•°æ®æŒä¹…åŒ–æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 # 1. é‡è¦æ•°æ®è¦ä½¿ç”¨æ•°æ®å·æŒä¹…åŒ– docker run -v important-data:/app/data my-app:latest # 2. å®šæœŸå¤‡ä»½æ•°æ®å· docker run --rm -v important-data:/volume -v $(pwd):/backup alpine \\ tar -czf /backup/backup-$(date +%Y%m%d).tar.gz -C /volume ./ # 3. é¿å…åœ¨å®¹å™¨å†…å­˜å‚¨é‡è¦æ•°æ® # å®¹å™¨åœæ­¢åï¼Œå†™å…¥å®¹å™¨å±‚çš„æ•°æ®ä¼šä¸¢å¤± 3ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 # 1. ä½¿ç”¨ .dockerignore æ–‡ä»¶å‡å°‘æ„å»ºä¸Šä¸‹æ–‡ echo \u0026#34;node_modules\u0026#34; \u0026gt;\u0026gt; .dockerignore echo \u0026#34;.git\u0026#34; \u0026gt;\u0026gt; .dockerignore # 2. ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å° # åœ¨ Dockerfile ä¸­ä½¿ç”¨å¤šé˜¶æ®µæ„å»º # 3. åˆç†ä½¿ç”¨ç¼“å­˜åŠ é€Ÿæ„å»º # å°†ä¸ç»å¸¸å˜åŒ–çš„æŒ‡ä»¤æ”¾åœ¨ Dockerfile å‰é¢ # 4. é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ # ä½¿ç”¨ alpine ç­‰è½»é‡çº§åŸºç¡€é•œåƒ ğŸ“š åä¸‰ã€å­¦ä¹ èµ„æº 1ï¸âƒ£ å®˜æ–¹èµ„æº Docker å®˜æ–¹æ–‡æ¡£: https://docs.docker.com/ Docker Hub: https://hub.docker.com/ Docker å®˜æ–¹åšå®¢: https://www.docker.com/blog/ Docker GitHub: https://github.com/docker 2ï¸âƒ£ æ•™ç¨‹ä¸æŒ‡å— Docker å…¥é—¨æ•™ç¨‹: https://docs.docker.com/get-started/ Dockerfile æœ€ä½³å®è·µ: https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ Docker å®‰å…¨æœ€ä½³å®è·µ: https://docs.docker.com/engine/security/ 3ï¸âƒ£ ç¤¾åŒºä¸è®ºå› Docker ç¤¾åŒºè®ºå›: https://forums.docker.com/ Stack Overflow Docker æ ‡ç­¾: https://stackoverflow.com/questions/tagged/docker Reddit r/docker: https://www.reddit.com/r/docker/ 4ï¸âƒ£ å·¥å…·ä¸æ‰©å±• Docker Compose: https://docs.docker.com/compose/ Docker Desktop: https://www.docker.com/products/docker-desktop Portainer (Docker ç®¡ç†UI): https://www.portainer.io/ Watchtower (è‡ªåŠ¨æ›´æ–°å®¹å™¨): https://github.com/containrrr/watchtower 5ï¸âƒ£ è®¤è¯ä¸åŸ¹è®­ Docker è®¤è¯åŠ©ç† (DCA): https://www.docker.com/certification/ Docker å®˜æ–¹åŸ¹è®­: https://www.docker.com/docker-certified-associate/training/ ğŸ’¡ æç¤º: Docker å‘½ä»¤å’ŒåŠŸèƒ½ä¼šéšç€ç‰ˆæœ¬æ›´æ–°è€Œå˜åŒ–ï¼Œå»ºè®®å®šæœŸæŸ¥é˜…å®˜æ–¹æ–‡æ¡£è·å–æœ€æ–°ä¿¡æ¯ã€‚åŒæ—¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ Docker æ—¶ï¼ŒåŠ¡å¿…éµå¾ªå®‰å…¨æœ€ä½³å®è·µï¼Œå®šæœŸæ›´æ–°é•œåƒå’Œå®¹å™¨ï¼Œå¹¶åšå¥½æ•°æ®å¤‡ä»½å·¥ä½œã€‚\nå¸Œæœ›è¿™ä»½å®Œæ•´çš„ Docker å‘½ä»¤å¤§å…¨èƒ½å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ä½¿ç”¨å’Œç®¡ç† Docker å®¹å™¨ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒ Docker å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºèµ„æºã€‚ğŸ³\n","date":"2024-12-07T07:15:10+08:00","image":"https://file.meimolihan.eu.org/img/docker-01.webp","permalink":"https://blog.meimolihan.eu.org/p/194b5e6b/","title":"Docker å‘½ä»¤å¤§å…¨ ğŸ³"},{"content":"iStoreOS SSH å‘½ä»¤å¤§å…¨ ğŸ–¥ï¸ æœ¬æŒ‡å—æ•´ç†äº† iStoreOSï¼ˆåŸºäº OpenWrtï¼‰çš„å¸¸ç”¨ SSH å‘½ä»¤ï¼Œæ¶µç›–ç³»ç»Ÿç®¡ç†ã€è½¯ä»¶åŒ…æ“ä½œã€æ–‡ä»¶ç®¡ç†ã€ç½‘ç»œé…ç½®ã€æ•…éšœæ’é™¤ç­‰å¤šä¸ªæ–¹é¢ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆç®¡ç†è·¯ç”±å™¨ç³»ç»Ÿã€‚\nğŸ“‘ ç›®å½•å¯¼èˆª âš¡ ä¸€ã€ç³»ç»Ÿæ§åˆ¶å‘½ä»¤ ğŸ“¦ äºŒã€è½¯ä»¶åŒ…ç®¡ç† ğŸ–¥ï¸ ä¸‰ã€ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢ ğŸŒ å››ã€ç½‘ç»œç®¡ç†å‘½ä»¤ ğŸ“ äº”ã€æ–‡ä»¶ç®¡ç†å‘½ä»¤ ğŸ“ å…­ã€æ–‡ä»¶ç¼–è¾‘ä¸æ“ä½œ ğŸ“‚ ä¸ƒã€ç›®å½•æ“ä½œå‘½ä»¤ ğŸ” å…«ã€æƒé™ç®¡ç†å‘½ä»¤ ğŸ—œï¸ ä¹ã€å‹ç¼©ä¸è§£å‹å‘½ä»¤ ğŸ› ï¸ åã€è¿›ç¨‹ç®¡ç†å‘½ä»¤ ğŸ” åä¸€ã€æ—¥å¿—æŸ¥çœ‹å‘½ä»¤ âš™ï¸ åäºŒã€ç½‘ç»œé…ç½®ç®¡ç† ğŸ³ åä¸‰ã€Docker å®¹å™¨ç®¡ç† ğŸ”§ åå››ã€æ•…éšœæ’é™¤å‘½ä»¤ âš ï¸ åäº”ã€é‡è¦æ³¨æ„äº‹é¡¹ âš¡ ä¸€ã€ç³»ç»Ÿæ§åˆ¶å‘½ä»¤ 1. ç«‹å³å…³æœº 1 2 halt # ğŸ›‘ ç«‹å³å…³é—­ç³»ç»Ÿ 2. é‡å¯ç³»ç»Ÿ 1 2 reboot # ğŸ”„ ç«‹å³é‡å¯ç³»ç»Ÿ 3. æ¸…ç©ºç»ˆç«¯å±å¹• 1 2 clear # ğŸ§¹ æ¸…ç©ºå½“å‰ç»ˆç«¯çª—å£å†…å®¹ 4. æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´ 1 2 uptime # â° æ˜¾ç¤ºç³»ç»Ÿè¿è¡Œæ—¶é—´å’Œè´Ÿè½½ 5. æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ 1 2 cat /etc/openwrt_release # ğŸ·ï¸ æ˜¾ç¤º OpenWrt ç‰ˆæœ¬ä¿¡æ¯ ğŸ“¦ äºŒã€è½¯ä»¶åŒ…ç®¡ç† 1. æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼• 1 2 opkg update # ğŸ”„ æ›´æ–°å¯ç”¨è½¯ä»¶åŒ…åˆ—è¡¨ 2. å®‰è£…è½¯ä»¶åŒ… 1 2 3 opkg install [è½¯ä»¶åŒ…å] # ğŸ“¦ å®‰è£…æŒ‡å®šè½¯ä»¶åŒ… # ç¤ºä¾‹ï¼šopkg install nano 3. å¸è½½è½¯ä»¶åŒ… 1 2 opkg remove [è½¯ä»¶åŒ…å] # ğŸ—‘ï¸ å¸è½½æŒ‡å®šè½¯ä»¶åŒ… 4. åˆ—å‡ºæ‰€æœ‰å¯ç”¨è½¯ä»¶åŒ… 1 2 opkg list # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰å¯å®‰è£…çš„è½¯ä»¶åŒ… 5. æœç´¢è½¯ä»¶åŒ… 1 2 opkg list | grep [å…³é”®è¯] # ğŸ” æŒ‰å…³é”®è¯æœç´¢è½¯ä»¶åŒ… 6. æŸ¥çœ‹å·²å®‰è£…è½¯ä»¶åŒ… 1 2 opkg list-installed # ğŸ“Š æ˜¾ç¤ºæ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ… 7. å®‰è£…Cpolarå†…ç½‘ç©¿é€è½¯ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 # ä¸‹è½½å…¬é’¥ wget -O cpolar-public.key http://openwrt.cpolar.com/releases/public.key # æ·»åŠ å…¬é’¥ opkg-key add cpolar-public.key # æ·»åŠ Cpolarçš„opkgä»“åº“æº echo \u0026#34;src/gz cpolar_packages http://openwrt.cpolar.com/releases/packages/$(. /etc/openwrt_release ; echo $DISTRIB_ARCH)\u0026#34; \u0026gt;\u0026gt; /etc/opkg/customfeeds.conf # æ›´æ–°ä»“åº“ opkg update # å®‰è£…Cpolar opkg install cpolar opkg install luci-app-cpolar opkg install luci-i18n-cpolar-zh-cn é€‚ç”¨äºé…ç½®å…¬ç½‘è¿œç¨‹è®¿é—®iStoreOS\nğŸ–¥ï¸ ä¸‰ã€ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢ 1. æŸ¥çœ‹ç³»ç»Ÿé…ç½® 1 2 uci show # âš™ï¸ æ˜¾ç¤ºæ‰€æœ‰ UCI é…ç½® 2. æŸ¥è¯¢ CPU æ¶æ„ 1 2 3 4 uname -m # æˆ–è€… cat /etc/os-release | grep ARCH # ğŸ”§ æ˜¾ç¤ºç³»ç»Ÿæ¶æ„ä¿¡æ¯ 3. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ 1 2 free -h # ğŸ’¾ ä»¥äººç±»å¯è¯»æ ¼å¼æ˜¾ç¤ºå†…å­˜ä½¿ç”¨ 4. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ 1 2 df -h # ğŸ’½ æ˜¾ç¤ºç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ 5. æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ 1 2 uname -a # ğŸ” æ˜¾ç¤ºç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬å’Œæ¶æ„ä¿¡æ¯ ğŸŒ å››ã€ç½‘ç»œç®¡ç†å‘½ä»¤ 1. æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯ 1 2 ifconfig # ğŸŒ æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£çŠ¶æ€ 2. æµ‹è¯•ç½‘ç»œè¿é€šæ€§ 1 2 ping -c 4 google.com # ğŸ“¡ æµ‹è¯•åˆ° Google çš„ç½‘ç»œè¿æ¥ 3. æŸ¥çœ‹è·¯ç”±è¡¨ 1 2 route -n # ğŸ—ºï¸ æ˜¾ç¤ºç³»ç»Ÿè·¯ç”±è¡¨ 4. æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€ 1 2 netstat -tuln # ğŸ”Œ æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œè¿æ¥å’Œç›‘å¬ç«¯å£ 5. é‡å¯ç½‘ç»œæœåŠ¡ 1 2 /etc/init.d/network restart # ğŸ”„ é‡å¯ç½‘ç»œé…ç½® 6. æŸ¥çœ‹ç½‘ç»œæ¥å£è¯¦ç»†é…ç½® 1 2 ip addr show # ğŸ”§ æ˜¾ç¤ºç½‘ç»œæ¥å£çš„è¯¦ç»†é…ç½®ä¿¡æ¯ ğŸ“ äº”ã€æ–‡ä»¶ç®¡ç†å‘½ä»¤ 1. ä¸‹è½½æ–‡ä»¶ 1 2 wget https://example.com/file.img.gz # ğŸ“¥ ä»ç½‘ç»œä¸‹è½½æ–‡ä»¶ 2. æŸ¥çœ‹ç›®å½•ç»“æ„ 1 2 ls / # ğŸ“‚ æŸ¥çœ‹æ ¹ç›®å½•å†…å®¹ 3. æŸ¥çœ‹è¯¦ç»†ç›®å½•åˆ—è¡¨ 1 2 ls -la # ğŸ“‹ æ˜¾ç¤ºè¯¦ç»†æ–‡ä»¶åˆ—è¡¨ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰ 4. æŸ¥çœ‹ç£ç›˜åˆ†åŒº 1 2 fdisk -l # ğŸ’¾ æ˜¾ç¤ºç£ç›˜åˆ†åŒºä¿¡æ¯ 5. åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• 1 2 rm -rf /mnt/sata1-1/test11 # ğŸ—‘ï¸ å¼ºåˆ¶åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰ 6. å®‰å…¨åˆ é™¤ï¼ˆç¡®è®¤æç¤ºï¼‰ 1 2 rm -i filename # â“ åˆ é™¤å‰ç¡®è®¤ 7. æŸ¥çœ‹æ–‡ä»¶å¤§å° 1 2 du -sh filename # ğŸ“Š æ˜¾ç¤ºæ–‡ä»¶æˆ–ç›®å½•çš„å¤§å° ğŸ“ å…­ã€æ–‡ä»¶ç¼–è¾‘ä¸æ“ä½œ 1. ä½¿ç”¨ vi ç¼–è¾‘æ–‡ä»¶ 1 2 vi /mnt/sata1-1/test.txt # âœï¸ ä½¿ç”¨ vi ç¼–è¾‘å™¨ä¿®æ”¹æ–‡ä»¶ 2. ä½¿ç”¨ nano ç¼–è¾‘æ–‡ä»¶ï¼ˆå¦‚å·²å®‰è£…ï¼‰ 1 2 nano /mnt/sata1-1/test.txt # âœï¸ ä½¿ç”¨ nano ç¼–è¾‘å™¨ï¼ˆæ›´å‹å¥½ï¼‰ 3. æ–‡ä»¶é‡å‘½å 1 2 mv test1 test2 # ğŸ”„ å°† test1 é‡å‘½åä¸º test2 4. ç§»åŠ¨æ–‡ä»¶ 1 2 mv file.txt /new/location/ # ğŸšš ç§»åŠ¨æ–‡ä»¶åˆ°æ–°ä½ç½® 5. å¤åˆ¶æ–‡ä»¶ 1 2 cp file.txt backup.txt # ğŸ“‹ åˆ›å»ºæ–‡ä»¶å‰¯æœ¬ 6. æŸ¥çœ‹æ–‡ä»¶å†…å®¹ 1 2 cat filename # ğŸ‘€ æ˜¾ç¤ºæ–‡ä»¶å…¨éƒ¨å†…å®¹ 7. åˆ†é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ 1 2 less filename # ğŸ“„ åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ ğŸ“‚ ä¸ƒã€ç›®å½•æ“ä½œå‘½ä»¤ 1. åˆ›å»ºå•ä¸ªç›®å½• 1 2 mkdir -v test1 # ğŸ“ åˆ›å»ºç›®å½•å¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯ 2. åˆ›å»ºå¤šçº§ç›®å½• 1 2 mkdir -p /overlay/home/web/web03 # ğŸŒ³ é€’å½’åˆ›å»ºå¤šçº§ç›®å½•ç»“æ„ 3. åŒæ—¶åˆ›å»ºå¤šä¸ªç›®å½• 1 2 mkdir -v /mnt/-1/123 /mnt/-1/abc # ğŸ“‚ ä¸€æ¬¡æ€§åˆ›å»ºå¤šä¸ªç›®å½• 4. åˆ‡æ¢å·¥ä½œç›®å½• 1 2 cd /mnt/-1 # ğŸ“ åˆ‡æ¢åˆ°æŒ‡å®šç›®å½• 5. è¿”å›ä¸Šçº§ç›®å½• 1 2 cd .. # â†©ï¸ è¿”å›ä¸Šä¸€çº§ç›®å½• 6. è¿”å›å®¶ç›®å½• 1 2 cd ~ # ğŸ  è¿”å›å½“å‰ç”¨æˆ·çš„å®¶ç›®å½• 7. æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• 1 2 pwd # ğŸ“ æ˜¾ç¤ºå½“å‰æ‰€åœ¨ç›®å½•çš„å®Œæ•´è·¯å¾„ ğŸ” å…«ã€æƒé™ç®¡ç†å‘½ä»¤ 1. ä¿®æ”¹æ–‡ä»¶æƒé™ 1 2 chmod 0755 test.txt # ğŸ”§ è®¾ç½®æ–‡ä»¶æƒé™ä¸º 0755 (rwxr-xr-x) 2. ä¿®æ”¹ç›®å½•æƒé™ï¼ˆé€’å½’ï¼‰ 1 2 chmod -R 755 directory/ # ğŸ”„ é€’å½’ä¿®æ”¹ç›®å½•å†…æ‰€æœ‰æ–‡ä»¶æƒé™ 3. ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€… 1 2 chown root:root file.txt # ğŸ‘¤ ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…å’Œç»„ 4. æŸ¥çœ‹æ–‡ä»¶æƒé™ 1 2 ls -l file.txt # ğŸ‘€ æ˜¾ç¤ºæ–‡ä»¶è¯¦ç»†æƒé™ä¿¡æ¯ 5. ä¿®æ”¹ç›®å½•æ‰€æœ‰è€…ï¼ˆé€’å½’ï¼‰ 1 2 chown -R user:group directory/ # ğŸ”„ é€’å½’ä¿®æ”¹ç›®å½•å†…æ‰€æœ‰æ–‡ä»¶çš„æ‰€æœ‰è€… ğŸ—œï¸ ä¹ã€å‹ç¼©ä¸è§£å‹å‘½ä»¤ 1. æ‰¹é‡å‹ç¼©ç›®å½• 1 2 3 # å‹ç¼©å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤¹åˆ°æŒ‡å®šä½ç½® for dir in */; do tar -czvf \u0026#34;/mnt/-1/Backup/${dir%/}.tar.gz\u0026#34; \u0026#34;$dir\u0026#34;; done # ğŸ“¦ æ¯ä¸ªæ–‡ä»¶å¤¹å•ç‹¬å‹ç¼©ä¸º .tar.gz æ–‡ä»¶ 2. æ‰¹é‡è§£å‹æ–‡ä»¶ 1 2 3 # è§£å‹æ‰€æœ‰ .tar.gz æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• for file in *.tar.gz; do tar -xzvf \u0026#34;$file\u0026#34; -C /mnt/-1/Home; done # ğŸ“¤ æ‰¹é‡è§£å‹åˆ°ç›®æ ‡ç›®å½• 3. å•ä¸ªæ–‡ä»¶å‹ç¼© 1 2 tar -czvf backup.tar.gz /path/to/directory # ğŸ“¦ å‹ç¼©æŒ‡å®šç›®å½• 4. å•ä¸ªæ–‡ä»¶è§£å‹ 1 2 tar -xzvf backup.tar.gz -C /target/directory # ğŸ“¤ è§£å‹åˆ°æŒ‡å®šç›®å½• 5. åˆ›å»ºzipå‹ç¼©åŒ… 1 2 zip -r backup.zip directory/ # ğŸ“¦ åˆ›å»ºzipæ ¼å¼å‹ç¼©åŒ… 6. è§£å‹zipæ–‡ä»¶ 1 2 unzip backup.zip # ğŸ“¤ è§£å‹zipæ ¼å¼å‹ç¼©åŒ… ğŸ› ï¸ åã€è¿›ç¨‹ç®¡ç†å‘½ä»¤ 1. æŸ¥çœ‹è¿è¡Œä¸­çš„è¿›ç¨‹ 1 2 ps aux # ğŸ“Š æ˜¾ç¤ºæ‰€æœ‰è¿è¡Œä¸­çš„è¿›ç¨‹ 2. å®æ—¶ç›‘æ§è¿›ç¨‹ 1 2 top # ğŸ“ˆ å®æ—¶æ˜¾ç¤ºç³»ç»Ÿè¿›ç¨‹å’Œèµ„æºä½¿ç”¨ 3. ç»“æŸè¿›ç¨‹ 1 2 kill [PID] # ğŸ›‘ ç»“æŸæŒ‡å®šè¿›ç¨‹IDçš„è¿›ç¨‹ 4. å¼ºåˆ¶ç»“æŸè¿›ç¨‹ 1 2 kill -9 [PID] # ğŸ’¥ å¼ºåˆ¶ç»“æŸé¡½å›ºè¿›ç¨‹ 5. æ ¹æ®è¿›ç¨‹åç»“æŸè¿›ç¨‹ 1 2 pkill process_name # ğŸ” æ ¹æ®è¿›ç¨‹åç§°ç»“æŸè¿›ç¨‹ 6. æŸ¥çœ‹è¿›ç¨‹æ ‘ 1 2 pstree # ğŸŒ³ ä»¥æ ‘çŠ¶å›¾æ˜¾ç¤ºè¿›ç¨‹å…³ç³» ğŸ” åä¸€ã€æ—¥å¿—æŸ¥çœ‹å‘½ä»¤ 1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— 1 2 logread # ğŸ“ æ˜¾ç¤ºç³»ç»Ÿæ—¥å¿— 2. å®æ—¶ç›‘æ§æ—¥å¿— 1 2 logread -f # ğŸ” å®æ—¶è·Ÿè¸ªç³»ç»Ÿæ—¥å¿— 3. æŸ¥çœ‹å†…æ ¸æ—¥å¿— 1 2 dmesg # âš™ï¸ æ˜¾ç¤ºå†…æ ¸ç¯å½¢ç¼“å†²åŒºæ¶ˆæ¯ 4. æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿— 1 2 logread | grep service_name # ğŸ” ç­›é€‰ç‰¹å®šæœåŠ¡çš„æ—¥å¿— 5. æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¥å¿— 1 2 dmesg | grep \u0026#34;Starting\u0026#34; # ğŸ”§ æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­çš„æ—¥å¿— âš™ï¸ åäºŒã€ç½‘ç»œé…ç½®ç®¡ç† 1. ä¿®æ”¹ç½‘ç»œé…ç½® 1 2 vi /etc/config/network # âœï¸ ç¼–è¾‘ç½‘ç»œé…ç½®æ–‡ä»¶ 2. é‡å¯ç½‘ç»œæ¥å£ 1 2 ifdown lan \u0026amp;\u0026amp; ifup lan # ğŸ”„ é‡å¯LANæ¥å£ 3. æŸ¥çœ‹é˜²ç«å¢™é…ç½® 1 2 uci show firewall # ğŸ”¥ æ˜¾ç¤ºé˜²ç«å¢™é…ç½® 4. é‡å¯é˜²ç«å¢™ 1 2 /etc/init.d/firewall restart # ğŸ”„ é‡å¯é˜²ç«å¢™æœåŠ¡ 5. æŸ¥çœ‹DNSé…ç½® 1 2 cat /etc/resolv.conf # ğŸŒ æ˜¾ç¤ºDNSè§£æé…ç½® 6. ç½‘ç»œæµ‹è¯• 1 2 traceroute google.com # ğŸ—ºï¸ è·Ÿè¸ªåˆ°ç›®æ ‡åœ°å€çš„ç½‘ç»œè·¯å¾„ ğŸ³ åä¸‰ã€Docker å®¹å™¨ç®¡ç† 1. æŸ¥çœ‹Dockerç‰ˆæœ¬ 1 2 docker version # ğŸ” æ˜¾ç¤ºDockerç‰ˆæœ¬ä¿¡æ¯ 2. æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ 1 2 docker ps # ğŸ“Š æ˜¾ç¤ºè¿è¡Œä¸­çš„å®¹å™¨ 3. æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ 1 2 docker ps -a # ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰ 4. å¯åŠ¨å®¹å™¨ 1 2 docker start [å®¹å™¨å] # ğŸš€ å¯åŠ¨æŒ‡å®šå®¹å™¨ 5. åœæ­¢å®¹å™¨ 1 2 docker stop [å®¹å™¨å] # ğŸ›‘ åœæ­¢æŒ‡å®šå®¹å™¨ 6. æŸ¥çœ‹å®¹å™¨æ—¥å¿— 1 2 docker logs [å®¹å™¨å] # ğŸ“ æŸ¥çœ‹å®¹å™¨æ—¥å¿— 7. è¿›å…¥å®¹å™¨ç»ˆç«¯ 1 2 docker exec -it [å®¹å™¨å] /bin/bash # ğŸ” è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ ğŸ”§ åå››ã€æ•…éšœæ’é™¤å‘½ä»¤ 1. æŸ¥çœ‹ç³»ç»ŸæœåŠ¡çŠ¶æ€ 1 2 /etc/init.d/[æœåŠ¡å] status # ğŸ” æ£€æŸ¥ç‰¹å®šæœåŠ¡çŠ¶æ€ 2. æµ‹è¯•ç«¯å£è¿é€šæ€§ 1 2 nc -zv localhost 80 # ğŸ§ª æµ‹è¯•æœ¬åœ°ç«¯å£æ˜¯å¦å¼€æ”¾ 3. æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ 1 2 w # ğŸ“ˆ æ˜¾ç¤ºç³»ç»Ÿè´Ÿè½½å’Œç™»å½•ç”¨æˆ· 4. æ£€æŸ¥ç£ç›˜é”™è¯¯ 1 2 fsck /dev/sda1 # ğŸ”§ æ£€æŸ¥å¹¶ä¿®å¤æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ 5. æŸ¥çœ‹ç¡¬ä»¶ä¿¡æ¯ 1 2 lspci # ğŸ” æ˜¾ç¤ºPCIè®¾å¤‡ä¿¡æ¯ 6. æŸ¥çœ‹USBè®¾å¤‡ 1 2 lsusb # ğŸ”Œ æ˜¾ç¤ºè¿æ¥çš„USBè®¾å¤‡ 7. å†…å­˜æ£€æµ‹ 1 2 cat /proc/meminfo # ğŸ’¾ æ˜¾ç¤ºè¯¦ç»†å†…å­˜ä¿¡æ¯ âš ï¸ åäº”ã€é‡è¦æ³¨æ„äº‹é¡¹ è°¨æ…ä½¿ç”¨ rm -rfï¼šè¿™ä¸ªå‘½ä»¤ä¼šæ°¸ä¹…åˆ é™¤æ–‡ä»¶ï¼Œæ— æ³•æ¢å¤ å¤‡ä»½é‡è¦é…ç½®ï¼šä¿®æ”¹é‡è¦æ–‡ä»¶å‰å…ˆå¤‡ä»½ äº†è§£å‘½ä»¤ä½œç”¨ï¼šä¸ç¡®å®šçš„å‘½ä»¤å…ˆæŸ¥è¯¢æ–‡æ¡£å†æ‰§è¡Œ ä½¿ç”¨ Tab è¡¥å…¨ï¼šå‡å°‘è¾“å…¥é”™è¯¯ï¼Œæé«˜æ•ˆç‡ å®šæœŸæ›´æ–°ç³»ç»Ÿï¼šä¿æŒç³»ç»Ÿå®‰å…¨å’Œç¨³å®š ä¿®æ”¹ç½‘ç»œé…ç½®å‰å¤‡ä»½ï¼šé¿å…ç½‘ç»œè¿æ¥ä¸­æ–­ æ³¨æ„æƒé™ç®¡ç†ï¼šè°¨æ…ä½¿ç”¨ chmod å’Œ chown å‘½ä»¤ å…³æ³¨ç³»ç»Ÿæ—¥å¿—ï¼šå®šæœŸæ£€æŸ¥æ—¥å¿—å‘ç°æ½œåœ¨é—®é¢˜ 1 2 3 4 5 # ç³»ç»Ÿæ›´æ–°ç¤ºä¾‹ opkg update \u0026amp;\u0026amp; opkg upgrade # é…ç½®æ–‡ä»¶å¤‡ä»½ç¤ºä¾‹ cp /etc/config/network /etc/config/network.backup ğŸ¯ æŒæ¡è¿™äº›å‘½ä»¤å°†è®©æ‚¨èƒ½å¤Ÿé«˜æ•ˆåœ°ç®¡ç†å’Œç»´æŠ¤ iStoreOS ç³»ç»Ÿã€‚å»ºè®®å…ˆåœ¨ä¸é‡è¦çš„ç¯å¢ƒä¸­ç»ƒä¹ ï¼Œç†Ÿæ‚‰åå†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚è®°å¾—å®šæœŸå¤‡ä»½é‡è¦é…ç½®ï¼Œè°¨æ…æ‰§è¡Œå¯èƒ½å½±å“ç³»ç»Ÿç¨³å®šæ€§çš„å‘½ä»¤ã€‚\nğŸ’¡ å®ç”¨æŠ€å·§ ä½¿ç”¨å‘½ä»¤å†å²\n1 2 history # ğŸ“š æŸ¥çœ‹ä¹‹å‰æ‰§è¡Œè¿‡çš„å‘½ä»¤ å‘½ä»¤åˆ«åè®¾ç½®\n1 2 alias ll=\u0026#39;ls -la\u0026#39; # ğŸ”§ åˆ›å»ºå‘½ä»¤åˆ«åç®€åŒ–æ“ä½œ åå°è¿è¡Œå‘½ä»¤\n1 2 nohup command \u0026amp; # ğŸ“» åœ¨åå°è¿è¡Œå‘½ä»¤å³ä½¿é€€å‡ºç»ˆç«¯ä¹Ÿä¸ä¸­æ–­ å®šæ—¶ä»»åŠ¡ç®¡ç†\n1 2 crontab -e # â° ç¼–è¾‘å®šæ—¶ä»»åŠ¡ ç³»ç»Ÿèµ„æºç›‘æ§\n1 2 htop # ğŸ“Š æ›´ç›´è§‚çš„ç³»ç»Ÿç›‘æ§å·¥å…·ï¼ˆå¦‚å·²å®‰è£…ï¼‰ å¸Œæœ›è¿™ä»½å…¨é¢çš„ iStoreOS SSH å‘½ä»¤æŒ‡å—èƒ½å¸®åŠ©æ‚¨æ›´æœ‰æ•ˆåœ°ç®¡ç†ç³»ç»Ÿï¼ğŸ–¥ï¸ğŸš€\n","date":"2024-12-07T07:12:19+08:00","image":"https://file.meimolihan.eu.org/img/istoreos-01.webp","permalink":"https://blog.meimolihan.eu.org/p/f02d9bad/","title":"iStoreOS SSH å‘½ä»¤å¤§å…¨ ğŸ–¥ï¸"},{"content":"ESXi ç¡¬ç›˜ç›´é€šé…ç½®å®Œå…¨æŒ‡å— ğŸ–¥ï¸ é€šè¿‡ ESXi çš„ç¡¬ç›˜ç›´é€šï¼ˆPassthroughï¼‰åŠŸèƒ½ï¼Œè™šæ‹Ÿæœºå¯ä»¥ç›´æ¥è®¿é—®ç‰©ç†ç¡¬ç›˜ï¼Œæ—¢èƒ½æ˜¾è‘—æå‡å­˜å‚¨æ€§èƒ½ï¼Œåˆèƒ½ç¡®ä¿æ›´å¥½çš„å…¼å®¹æ€§ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»ä¸¤ç§ä¸»æµé…ç½®æ–¹æ³•ï¼šPCIe æ§åˆ¶å™¨ç›´é€šå’Œ RDM ç›´é€šï¼ŒåŠ©ä½ é«˜æ•ˆã€å®‰å…¨åœ°å®Œæˆè®¾ç½®ã€‚\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ§° å‰æœŸå‡†å¤‡ ğŸ”§ é…ç½® PCIe æ§åˆ¶å™¨ç›´é€š ğŸ’½ é…ç½® RDM ç›´é€š âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹© ğŸ’ æ€»ç»“ä¸å»ºè®® ğŸ§° å‰æœŸå‡†å¤‡ åœ¨å¼€å§‹é…ç½®å‰ï¼Œè¯·åŠ¡å¿…å®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼Œä»¥ç¡®ä¿è¿‡ç¨‹é¡ºåˆ©ä¸”å®‰å…¨ï¼š\nå¯ç”¨ BIOS ä¸­çš„è™šæ‹ŸåŒ–æ”¯æŒ ğŸ“Ÿ\nè¿›å…¥ä¸»æ¿ BIOS è®¾ç½®ï¼Œå¼€å¯ VT-dï¼ˆIntel å¹³å°ï¼‰æˆ– AMD-Vï¼ˆAMD å¹³å°ï¼‰åŠŸèƒ½ï¼Œè¿™æ˜¯ç¡¬ä»¶ç›´é€šçš„åŸºç¡€ã€‚ å¤‡ä»½é‡è¦æ•°æ® ğŸ’¾\nç›´é€šæ“ä½œæ¶‰åŠåº•å±‚ç¡¬ä»¶è®¿é—®ï¼Œé…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·æå‰å¤‡ä»½æ‰€æœ‰å…³é”®æ•°æ®ã€‚ ç¡®è®¤ç¡¬ä»¶å…¼å®¹æ€§ âœ…\nå¹¶éæ‰€æœ‰ç¡¬ä»¶éƒ½æ”¯æŒç›´é€šï¼Œå»ºè®®æŸ¥é˜… VMware å®˜æ–¹å…¼å®¹æ€§æŒ‡å— ç¡®è®¤ä½ çš„è®¾å¤‡æ˜¯å¦å…¼å®¹ã€‚ è§„åˆ’ç³»ç»Ÿå®‰è£…ä½ç½® ğŸ—‚ï¸\nå¦‚æœæ‰“ç®—ç›´é€šä¸»æ¿ä¸Šçš„ SATA æ§åˆ¶å™¨ï¼ŒESXi ç³»ç»Ÿå¿…é¡»å®‰è£…åœ¨ç‹¬ç«‹çš„è®¾å¤‡ä¸Šï¼Œå¦‚ U ç›˜ã€SD å¡æˆ– NVMe ç¡¬ç›˜ï¼Œé¿å…å†²çªã€‚ ğŸ”§ é…ç½® PCIe æ§åˆ¶å™¨ç›´é€š è¿™ç§æ–¹æ³•å°†æ•´ä¸ª SATA/AHCI æˆ– SAS æ§åˆ¶å™¨ç›´æ¥ä¼ é€’ç»™è™šæ‹Ÿæœºï¼Œé€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½å’Œå®Œæ•´å…¼å®¹æ€§çš„åœºæ™¯ã€‚\næŸ¥çœ‹è®¾å¤‡ä¿¡æ¯ ğŸ”\nåœ¨ ESXi Web ç•Œé¢ä¸­ï¼Œå¯¼èˆªåˆ°\u0026quot;ä¸»æœº\u0026quot; â†’ \u0026ldquo;ç®¡ç†\u0026rdquo; â†’ \u0026ldquo;ç¡¬ä»¶\u0026rdquo; â†’ PCI è®¾å¤‡ï¼ŒæŸ¥æ‰¾ SATA/AHCI æ§åˆ¶å™¨ï¼Œè®°å½•å…¶ä¾›åº”å•† ID å’Œè®¾å¤‡ IDã€‚ æˆ–é€šè¿‡ SSH æ‰§è¡Œå‘½ä»¤ lspci -v | grep \u0026quot;Class 0106\u0026quot; -B 1 æˆ– esxcli hardware pci list | grep -i \u0026quot;SATA\\|AHCI\u0026quot; è·å–æ§åˆ¶å™¨ä¿¡æ¯ã€‚ å¯ç”¨ç›´é€šå¹¶é‡å¯ ğŸ”„\nåœ¨ PCI è®¾å¤‡åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡æ§åˆ¶å™¨ï¼Œç‚¹å‡»åˆ‡æ¢ç›´é€šå¯ç”¨ï¼Œå®Œæˆåå¿…é¡»é‡å¯ ESXi ä¸»æœºä½¿é…ç½®ç”Ÿæ•ˆã€‚ ç¼–è¾‘ç›´é€šæ˜ å°„é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ âš™ï¸\nå¦‚æœæ§åˆ¶å™¨çŠ¶æ€ä¸ºâ€œä¸æ”¯æŒâ€ï¼Œå¯èƒ½éœ€è¦é€šè¿‡ SSH ç¼–è¾‘ /etc/vmware/passthru.map æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®è¡Œï¼ˆä¾‹å¦‚ï¼š8086 a102 d3d0 falseï¼‰ï¼Œç„¶åé‡å¯ä¸»æœºã€‚ å°†ç›´é€šè®¾å¤‡æ·»åŠ åˆ°è™šæ‹Ÿæœº â•\nå…³é—­ç›®æ ‡è™šæ‹Ÿæœºï¼Œç¼–è¾‘è®¾ç½®ï¼Œæ·»åŠ  PCI è®¾å¤‡ï¼Œé€‰æ‹©å·²ç›´é€šçš„æ§åˆ¶å™¨ï¼Œä¿å­˜åå¯åŠ¨è™šæ‹Ÿæœºï¼Œåœ¨ç³»ç»Ÿä¸­ç›´æ¥è¯†åˆ«ç¡¬ç›˜ã€‚ ğŸ’½ é…ç½® RDM (Raw Device Mapping) ç›´é€š RDM é€šè¿‡æ˜ å°„æ–‡ä»¶çš„æ–¹å¼è®©è™šæ‹Ÿæœºè®¿é—®ç‰©ç†ç¡¬ç›˜ï¼Œå…¼é¡¾æ€§èƒ½å’Œç®¡ç†çµæ´»æ€§ï¼Œé€‚åˆå•å—ç¡¬ç›˜ç›´é€šéœ€æ±‚ã€‚\nè·å–ç¡¬ç›˜æ ‡è¯†ç¬¦å’Œå­˜å‚¨è·¯å¾„ ğŸ“\nåœ¨ ESXi Web ç•Œé¢ä¸­ï¼Œè¿›å…¥\u0026quot;å­˜å‚¨\u0026quot; â†’ \u0026ldquo;è®¾å¤‡\u0026rdquo;ï¼Œæ‰¾åˆ°ç›®æ ‡ç¡¬ç›˜ï¼Œè®°å½•å…¶æ ‡è¯†ç¬¦ï¼ˆå¦‚ t10.ATA_____...ï¼‰ã€‚ è¿›å…¥\u0026quot;å­˜å‚¨\u0026quot; â†’ \u0026ldquo;æ•°æ®å­˜å‚¨\u0026rdquo;ï¼Œé€‰æ‹©ç”¨äºå­˜æ”¾æ˜ å°„æ–‡ä»¶çš„æ•°æ®å­˜å‚¨ï¼Œè®°å½•å…¶è·¯å¾„ã€‚ åˆ›å»º RDM æ˜ å°„æ–‡ä»¶ ğŸ”¨\né€šè¿‡ SSH è¿æ¥åˆ° ESXi ä¸»æœºï¼Œæ‰§è¡Œå‘½ä»¤ï¼švmkfstools -z /vmfs/devices/disks/\u0026lt;ç¡¬ç›˜æ ‡è¯†ç¬¦\u0026gt; /vmfs/volumes/\u0026lt;æ•°æ®å­˜å‚¨è·¯å¾„\u0026gt;/\u0026lt;è‡ªå®šä¹‰æ–‡ä»¶å\u0026gt;.vmdkï¼Œç”Ÿæˆçº¦ 1MB çš„æ˜ å°„æ–‡ä»¶ã€‚ å°† RDM ç£ç›˜æ·»åŠ åˆ°è™šæ‹Ÿæœº ğŸ–¥ï¸\nç¼–è¾‘è™šæ‹Ÿæœºè®¾ç½®ï¼Œæ·»åŠ ç°æœ‰ç¡¬ç›˜ï¼Œé€‰æ‹©ä¸Šä¸€æ­¥åˆ›å»ºçš„ .vmdk æ–‡ä»¶ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©æ§åˆ¶å™¨ç±»å‹ï¼ˆå¦‚ SATAï¼‰ï¼Œä¿å­˜åå¯åŠ¨è™šæ‹Ÿæœºã€‚ âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹ä¸æ•…éšœæ’é™¤ ğŸ“Œ é‡è¦æé†’ å…¼å®¹æ€§ç¬¬ä¸€ï¼šåŠ¡å¿…ç¡®è®¤ç¡¬ä»¶æ”¯æŒç›´é€šï¼Œé¿å…ä¸å…¼å®¹å¯¼è‡´çš„é—®é¢˜ã€‚ å‹¿ç›´é€šç®¡ç†ç½‘å¡ï¼šç›´é€šæ‰€æœ‰ç½‘å¡ä¼šå¯¼è‡´ ESXi ç®¡ç†ä¸­æ–­ï¼Œè‡³å°‘ä¿ç•™ä¸€ä¸ªç½‘å¡ç”¨äºç®¡ç†ã€‚ åŠŸèƒ½æƒè¡¡ï¼šç›´é€šä¼šå¤±å»å¿«ç…§ã€å­˜å‚¨è¿ç§»ï¼ˆvMotionï¼‰ç­‰è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œéœ€æƒè¡¡åˆ©å¼Šã€‚ å¤‡ä»½æ•°æ®ï¼šç›´é€šæ“ä½œé£é™©è¾ƒé«˜ï¼ŒåŠ¡å¿…æå‰å¤‡ä»½é‡è¦æ•°æ®ï¼Œé˜²æ­¢æ„å¤–ä¸¢å¤±ã€‚ ğŸ” å¸¸è§é—®é¢˜ PCI è®¾å¤‡ç›´é€šé€‰é¡¹ä¸ºç°è‰²/æ— æ³•å¯ç”¨ï¼šç¡®è®¤ BIOS ä¸­ VT-d/AMD-V å·²å¼€å¯ï¼Œæˆ–è®¾å¤‡æ­£è¢« ESXi ä½¿ç”¨ã€‚ è™šæ‹Ÿæœºæ— æ³•å¯åŠ¨ï¼šæ£€æŸ¥ç›´é€šé…ç½®æ˜¯å¦æ­£ç¡®ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— /var/log/vmkernel.log è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚ æ€§èƒ½é—®é¢˜ï¼šæ£€æŸ¥ç¡¬ä»¶æ˜¯å¦å­˜åœ¨ç“¶é¢ˆï¼Œæ›´æ–°é©±åŠ¨å’Œå›ºä»¶ï¼Œä¼˜åŒ–é…ç½®ã€‚ ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹© ç‰¹æ€§ PCIe æ§åˆ¶å™¨ç›´é€š RDM (Raw Device Mapping) æ€§èƒ½ â­â­â­â­â­ æ›´ä½³ (æ›´æ¥è¿‘ç‰©ç†ç¡¬ä»¶) â­â­â­â­ è‰¯å¥½ (ç•¥ä½äºå®Œå…¨ç›´é€š) å…¼å®¹æ€§ å–å†³äºç¡¬ä»¶å’Œé©±åŠ¨ æ›´å¹¿æ³› ç®¡ç†çµæ´»æ€§ ä½ (æ— æ³•ä½¿ç”¨å¿«ç…§ç­‰) ä¸­ (éƒ¨åˆ†è™šæ‹ŸåŒ–åŠŸèƒ½å¯ç”¨) é…ç½®å¤æ‚åº¦ ä¸­é«˜ (å¯èƒ½éœ€ç¼–è¾‘é…ç½®æ–‡ä»¶å¹¶é‡å¯ä¸»æœº) ä¸­ (å‘½ä»¤è¡Œæ“ä½œï¼Œæ— éœ€é‡å¯ä¸»æœº) è¿ç§»æ€§ å·® (ä¸ç¡¬ä»¶ç»‘å®š) è¾ƒå¥½ (æ˜ å°„æ–‡ä»¶å¯éšè™šæ‹Ÿæœºè¿ç§») å¿«ç…§æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒ (ä½†ä»…é’ˆå¯¹æ˜ å°„æ–‡ä»¶æœ¬èº«) é€‚ç”¨åœºæ™¯ éœ€è¦æè‡´æ€§èƒ½å’Œé«˜å…¼å®¹æ€§ï¼ˆå¦‚ZFSã€ç¡¬ä»¶RAIDå¡ï¼‰ å•å—ç¡¬ç›˜ç›´é€šï¼Œéœ€å…¼é¡¾æ€§èƒ½å’Œéƒ¨åˆ†ç®¡ç†åŠŸèƒ½ ğŸ’ æ€»ç»“ä¸å»ºè®® æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼š\nè¿½æ±‚æè‡´æ€§èƒ½å’Œæ— æŸå…¼å®¹æ€§ï¼Œä¸”ä¸éœ€è¦å¿«ç…§ç­‰åŠŸèƒ½ â†’ PCIe æ§åˆ¶å™¨ç›´é€šã€‚ å¸Œæœ›å…¼é¡¾æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½å’Œä¸€å®šçš„è™šæ‹ŸåŒ–ç®¡ç†åŠŸèƒ½ï¼Œæˆ–è€…åªéœ€ç›´é€šå•å—ç¡¬ç›˜ â†’ RDMã€‚ å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¼ºçƒˆå»ºè®®ï¼š\nå…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­å……åˆ†éªŒè¯é…ç½®çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ åˆ¶å®šè¯¦ç»†çš„å¤‡ä»½å’Œæ¢å¤è®¡åˆ’ã€‚ ä»”ç»†é˜…è¯» VMware å®˜æ–¹æ–‡æ¡£ã€‚ å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®ä½ æˆåŠŸé…ç½®ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­è¯¢é—®ã€‚\n","date":"2024-12-07T07:11:43+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/a616aee7/","title":"ESXi ç¡¬ç›˜ç›´é€šé…ç½®æŒ‡å— ğŸ–¥ï¸"},{"content":"ESXi è™šæ‹Ÿä¸»æœºå¤‡ä»½ä¸æ¢å¤å®Œå…¨æŒ‡å— ğŸ’¾ å¯¼èˆªç›®å½• ğŸ“š ğŸ“¥ ä¸€ã€å‡†å¤‡å·¥ä½œ ğŸ” äºŒã€å¤‡ä»½å‰å‡†å¤‡ ğŸ“¦ ä¸‰ã€å¤‡ä»½æ‰¹å¤„ç†è„šæœ¬ âš™ï¸ å››ã€è„šæœ¬é…ç½®è¯´æ˜ ğŸ”„ äº”ã€æ¢å¤è™šæ‹Ÿæœº ğŸ“Š å…­ã€é«˜çº§å¤‡ä»½é€‰é¡¹ ğŸ› ï¸ ä¸ƒã€å¸¸è§é—®é¢˜è§£å†³ ğŸ”’ å…«ã€å¤‡ä»½ç­–ç•¥å»ºè®® ğŸ’¡ ä¹ã€è‡ªåŠ¨åŒ–éƒ¨ç½² âš ï¸ åã€é‡è¦æ³¨æ„äº‹é¡¹ ğŸ”§ åä¸€ã€æ›¿ä»£æ–¹æ¡ˆ ğŸ“¥ ä¸€ã€å‡†å¤‡å·¥ä½œ 1. ä¸‹è½½ OVF Tool å®˜æ–¹ä¸‹è½½åœ°å€ï¼š https://developer.vmware.com/web/tool/ovf-tool/ ğŸ“¦ ä¸‹è½½æ–‡ä»¶ï¼šVMware-ovftool-4.3.0-12320924-win.x86_64.msi ğŸ”’ å»ºè®®éªŒè¯æ–‡ä»¶å“ˆå¸Œå€¼ç¡®ä¿å®Œæ•´æ€§ ğŸŒ ç¡®ä¿ä¸‹è½½ç‰ˆæœ¬ä¸æ‚¨çš„æ“ä½œç³»ç»Ÿæ¶æ„åŒ¹é… 2. å®‰è£… OVF Tool 1 2 3 4 5 # 1. åŒå‡»å®‰è£…æ–‡ä»¶è¿è¡Œå®‰è£…å‘å¯¼ # 2. æ¥å—è®¸å¯åè®® # 3. ä½¿ç”¨é»˜è®¤å®‰è£…è·¯å¾„ï¼š # C:\\Program Files\\VMware\\VMware OVF Tool\\ # 4. å®Œæˆå®‰è£… 3. éªŒè¯å®‰è£… 1 2 3 4 5 6 7 :: æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œæµ‹è¯•å®‰è£… cd \u0026#34;C:\\Program Files\\VMware\\VMware OVF Tool\u0026#34; ovftool --version :: åº”è¯¥æ˜¾ç¤ºç±»ä¼¼ä¿¡æ¯ï¼š :: OVF Tool version 4.3.0.12320924 :: Build-12320924 4. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå¯é€‰ï¼‰ 1 2 3 4 :: å°† OVF Tool æ·»åŠ åˆ°ç³»ç»Ÿ PATHï¼Œæ–¹ä¾¿åœ¨ä»»ä½•ä½ç½®ä½¿ç”¨ setx PATH \u0026#34;%PATH%;C:\\Program Files\\VMware\\VMware OVF Tool\\\u0026#34; :: é‡å¯å‘½ä»¤æç¤ºç¬¦ä½¿æ›´æ”¹ç”Ÿæ•ˆ ğŸ” äºŒã€å¤‡ä»½å‰å‡†å¤‡ 1. æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯ ç™»å½• ESXi Web ç®¡ç†ç•Œé¢ (é€šå¸¸ä¸º https://æ‚¨çš„ESXiIP/ui) å¯¼èˆªåˆ°\u0026quot;è™šæ‹Ÿæœº\u0026quot;é€‰é¡¹å¡ ç¡®è®¤è¦å¤‡ä»½çš„è™šæ‹Ÿæœºåç§°ï¼ˆä¾‹å¦‚ï¼šiKuaiï¼‰ è®°å½•è™šæ‹Ÿæœºçš„å­˜å‚¨ä½ç½®å’Œé…ç½®ä¿¡æ¯ æ£€æŸ¥è™šæ‹Ÿæœºå½“å‰çŠ¶æ€ 2. å…³é—­è™šæ‹Ÿæœº é‡è¦ï¼šå¤‡ä»½å‰å¿…é¡»å…³é—­è™šæ‹Ÿæœºä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼\n1 2 3 4 5 6 7 8 9 # æ­£å¸¸å…³æœºæ­¥éª¤ï¼š 1. åœ¨ ESXi Web ç•Œé¢ä¸­é€‰æ‹©ç›®æ ‡è™šæ‹Ÿæœº 2. ç‚¹å‡»\u0026#34;å…³æœº\u0026#34;æŒ‰é’®ï¼ˆä¸æ˜¯å¼ºåˆ¶å…³é—­ï¼‰ 3. ç­‰å¾…è™šæ‹Ÿæœºå®Œå…¨å…³é—­ï¼ŒçŠ¶æ€æ˜¾ç¤ºä¸º\u0026#34;å·²å…³é—­\u0026#34; 4. ç¡®è®¤æ‰€æœ‰æœåŠ¡å·²æ­£å¸¸åœæ­¢ # å¦‚æœæ­£å¸¸å…³æœºå¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨å¼ºåˆ¶å…³é—­ï¼ˆä¸æ¨èï¼‰ï¼š 1. é€‰æ‹©è™šæ‹Ÿæœº 2. ç‚¹å‡»\u0026#34;ç”µæº\u0026#34; â†’ \u0026#34;å¼ºåˆ¶å…³æœº\u0026#34; 3. æ£€æŸ¥å­˜å‚¨ç©ºé—´ 1 2 3 # ä¼°ç®—å¤‡ä»½æ‰€éœ€ç©ºé—´ï¼š # å¤‡ä»½æ–‡ä»¶å¤§å° â‰ˆ è™šæ‹Ÿæœºå®é™…ä½¿ç”¨ç©ºé—´ + å…ƒæ•°æ® # å»ºè®®ç›®æ ‡å­˜å‚¨ç©ºé—´è‡³å°‘æ˜¯è™šæ‹Ÿæœºé…ç½®å¤§å°çš„ 1.5 å€ ğŸ“¦ ä¸‰ã€å¤‡ä»½æ‰¹å¤„ç†è„šæœ¬ å®Œæ•´å¤‡ä»½è„šæœ¬ (esxi_backup.bat) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 @echo off chcp 65001 \u0026gt;nul echo ======================================== echo ESXi è™šæ‹Ÿæœºå¤‡ä»½å·¥å…· echo ======================================== echo. :: è®¾ç½®å˜é‡ set OVF_TOOL_PATH=\u0026#34;C:\\Program Files\\VMware\\VMware OVF Tool\\ovftool.exe\u0026#34; set ESXI_URL=\u0026#34;https://192.168.1.100:443\u0026#34; set ESXI_USERNAME=\u0026#34;root\u0026#34; set ESXI_PASSWORD=\u0026#34;your_password\u0026#34; set VM_NAME=\u0026#34;iKuai\u0026#34; set BACKUP_DIR=%USERPROFILE%\\Desktop\\ESXi_Backups :: åˆ›å»ºå¤‡ä»½ç›®å½• if not exist \u0026#34;%BACKUP_DIR%\u0026#34; ( mkdir \u0026#34;%BACKUP_DIR%\u0026#34; echo âœ… åˆ›å»ºå¤‡ä»½ç›®å½•: %BACKUP_DIR% ) :: ç”Ÿæˆå¸¦æ—¥æœŸçš„å¤‡ä»½æ–‡ä»¶å for /f \u0026#34;tokens=1-3 delims=/ \u0026#34; %%a in (\u0026#39;date /t\u0026#39;) do ( set CURRENT_DATE=%%a-%%b-%%c ) for /f \u0026#34;tokens=1-3 delims=: \u0026#34; %%a in (\u0026#39;time /t\u0026#39;) do ( set CURRENT_TIME=%%a-%%b-%%c ) set BACKUP_FILENAME=ESXI_%VM_NAME%_%CURRENT_DATE%_%CURRENT_TIME%.ova echo ğŸ“… å¤‡ä»½æ—¥æœŸ: %CURRENT_DATE% echo â° å¤‡ä»½æ—¶é—´: %CURRENT_TIME% echo ğŸ–¥ï¸ è™šæ‹Ÿæœº: %VM_NAME% echo ğŸ’¾ å¤‡ä»½æ–‡ä»¶: %BACKUP_FILENAME% echo. :: æ£€æŸ¥ OVF Tool æ˜¯å¦å­˜åœ¨ if not exist %OVF_TOOL_PATH% ( echo âŒ é”™è¯¯: æœªæ‰¾åˆ° OVF Toolï¼Œè¯·æ£€æŸ¥å®‰è£…è·¯å¾„ pause exit /b 1 ) :: æ‰§è¡Œå¤‡ä»½å‘½ä»¤ echo â³ æ­£åœ¨å¤‡ä»½è™šæ‹Ÿæœºï¼Œè¯·ç¨å€™... echo ğŸ“‹ æ‰§è¡Œå‘½ä»¤: %OVF_TOOL_PATH% --noSSLVerify --acceptAllEulas --powerOffSource %ESXI_URL%/sfc-cgi-bin/sfcgi.cgi?sid=%VM_NAME% \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; echo. %OVF_TOOL_PATH% --noSSLVerify --acceptAllEulas --powerOffSource %ESXI_URL%/sfc-cgi-bin/sfcgi.cgi?sid=%VM_NAME% \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; :: æ£€æŸ¥å¤‡ä»½ç»“æœ if %errorlevel% equ 0 ( echo âœ… å¤‡ä»½æˆåŠŸå®Œæˆï¼ echo ğŸ“ å¤‡ä»½ä½ç½®: %BACKUP_DIR%\\%BACKUP_FILENAME% :: æ˜¾ç¤ºå¤‡ä»½æ–‡ä»¶ä¿¡æ¯ for %%I in (\u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34;) do ( echo ğŸ“Š æ–‡ä»¶å¤§å°: %%~zI bytes ) ) else ( echo âŒ å¤‡ä»½å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %errorlevel% echo ğŸ” è¯·æ£€æŸ¥ä»¥ä¸‹å¯èƒ½çš„é—®é¢˜ï¼š echo 1. ESXi ä¸»æœºè¿æ¥æ˜¯å¦æ­£å¸¸ echo 2. è™šæ‹Ÿæœºåç§°æ˜¯å¦æ­£ç¡® echo 3. ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡® echo 4. è™šæ‹Ÿæœºæ˜¯å¦å·²å…³é—­ ) echo. echo ======================================== pause ç®€åŒ–ç‰ˆå¤‡ä»½è„šæœ¬ (quick_backup.bat) 1 2 3 4 5 6 7 8 9 10 11 12 @echo off set OVF_TOOL_PATH=\u0026#34;C:\\Program Files\\VMware\\VMware OVF Tool\\ovftool.exe\u0026#34; set ESXI_URL=\u0026#34;https://192.168.1.100:443\u0026#34; set ESXI_USERNAME=\u0026#34;root\u0026#34; set ESXI_PASSWORD=\u0026#34;your_password\u0026#34; set VM_NAME=\u0026#34;iKuai\u0026#34; set BACKUP_DIR=%USERPROFILE%\\Desktop\\ESXi_Backups if not exist \u0026#34;%BACKUP_DIR%\u0026#34; mkdir \u0026#34;%BACKUP_DIR%\u0026#34; for /f \u0026#34;tokens=1-3 delims=/ \u0026#34; %%a in (\u0026#39;date /t\u0026#39;) do set CURRENT_DATE=%%a-%%b-%%c %OVF_TOOL_PATH% --noSSLVerify --acceptAllEulas --powerOffSource %ESXI_URL%/sfc-cgi-bin/sfcgi.cgi?sid=%VM_NAME% \u0026#34;%BACKUP_DIR%\\ESXI_%VM_NAME%_%CURRENT_DATE%.ova\u0026#34; âš™ï¸ å››ã€è„šæœ¬é…ç½®è¯´æ˜ å¿…é¡»ä¿®æ”¹çš„å‚æ•°ï¼š 1 2 3 4 set ESXI_URL=\u0026#34;https://192.168.1.100:443\u0026#34; :: æ›¿æ¢ä¸ºæ‚¨çš„ ESXi ä¸»æœº IP åœ°å€ set ESXI_USERNAME=\u0026#34;root\u0026#34; :: ESXi ç™»å½•ç”¨æˆ·å set ESXI_PASSWORD=\u0026#34;your_password\u0026#34; :: ESXi ç™»å½•å¯†ç  set VM_NAME=\u0026#34;iKuai\u0026#34; :: è¦å¤‡ä»½çš„è™šæ‹Ÿæœºåç§° å¯é€‰é…ç½®å‚æ•°ï¼š 1 2 set BACKUP_DIR=\u0026#34;D:\\ESXi_Backups\u0026#34; :: æ›´æ”¹å¤‡ä»½å­˜å‚¨ä½ç½® set OVF_TOOL_PATH=\u0026#34;D:\\Tools\\VMware OVF Tool\\ovftool.exe\u0026#34; :: è‡ªå®šä¹‰ OVF Tool è·¯å¾„ å®‰å…¨å»ºè®®ï¼š ğŸ”’ ä¸è¦ç¡¬ç¼–ç å¯†ç ï¼šä½¿ç”¨ä»¥ä¸‹æ›´å®‰å…¨çš„æ–¹æ³• ğŸ“ ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š 1 2 :: è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆåœ¨ç³»ç»Ÿå±æ€§ä¸­é…ç½®ï¼‰ set ESXI_PASSWORD=%ESXI_BACKUP_PASSWORD% ğŸ”‘ ä½¿ç”¨åŠ å¯†é…ç½®æ–‡ä»¶ï¼š 1 2 3 :: åˆ›å»ºåŠ å¯†çš„é…ç½®æ–‡ä»¶ echo %ESXI_PASSWORD% \u0026gt; config.enc cipher /e config.enc ğŸ›¡ï¸ ä½¿ç”¨æœ€å°æƒé™è´¦æˆ·ï¼šåˆ›å»ºä¸“é—¨ç”¨äºå¤‡ä»½çš„ ESXi ç”¨æˆ·è´¦æˆ· ğŸ”„ äº”ã€æ¢å¤è™šæ‹Ÿæœº 1. åŸºæœ¬æ¢å¤å‘½ä»¤ 1 2 3 4 5 :: æ¢å¤è™šæ‹Ÿæœºåˆ° ESXi \u0026#34;%OVF_TOOL_PATH%\u0026#34; --noSSLVerify --acceptAllEulas --powerOn \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; %ESXI_URL%/ :: æŒ‡å®šè™šæ‹Ÿæœºåç§°æ¢å¤ \u0026#34;%OVF_TOOL_PATH%\u0026#34; --noSSLVerify --name=\u0026#34;Restored_%VM_NAME%\u0026#34; \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; %ESXI_URL%/ 2. é«˜çº§æ¢å¤é€‰é¡¹ 1 2 3 4 5 6 7 8 :: æŒ‡å®šæ•°æ®å­˜å‚¨æ¢å¤ \u0026#34;%OVF_TOOL_PATH%\u0026#34; --noSSLVerify --datastore=datastore1 \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; %ESXI_URL%/ :: æŒ‡å®šç½‘ç»œé…ç½®æ¢å¤ \u0026#34;%OVF_TOOL_PATH%\u0026#34; --noSSLVerify --network=\u0026#34;VM Network\u0026#34; \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; %ESXI_URL%/ :: æŒ‡å®šç£ç›˜æ ¼å¼æ¢å¤ \u0026#34;%OVF_TOOL_PATH%\u0026#34; --noSSLVerify --diskFormat=thin \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; %ESXI_URL%/ 3. å®Œæ•´æ¢å¤è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @echo off chcp 65001 \u0026gt;nul echo ======================================== echo ESXi è™šæ‹Ÿæœºæ¢å¤å·¥å…· echo ======================================== echo. set OVF_TOOL_PATH=\u0026#34;C:\\Program Files\\VMware\\VMware OVF Tool\\ovftool.exe\u0026#34; set ESXI_URL=\u0026#34;https://192.168.1.100:443\u0026#34; set BACKUP_DIR=%USERPROFILE%\\Desktop\\ESXi_Backups echo ğŸ“ å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶ï¼š dir /b \u0026#34;%BACKUP_DIR%\\*.ova\u0026#34; echo. set /p BACKUP_FILENAME=\u0026#34;è¯·è¾“å…¥è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶å: \u0026#34; set /p VM_NAME=\u0026#34;è¯·è¾“å…¥æ¢å¤åçš„è™šæ‹Ÿæœºåç§°: \u0026#34; echo â³ æ­£åœ¨æ¢å¤è™šæ‹Ÿæœº... %OVF_TOOL_PATH% --noSSLVerify --acceptAllEulas --name=\u0026#34;%VM_NAME%\u0026#34; \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; %ESXI_URL%/ if %errorlevel% equ 0 ( echo âœ… æ¢å¤æˆåŠŸå®Œæˆï¼ ) else ( echo âŒ æ¢å¤å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %errorlevel% ) pause 4. æ¢å¤éªŒè¯æ­¥éª¤ ğŸ“‹ æ£€æŸ¥æ¢å¤ç»“æœï¼šåœ¨ ESXi Web ç•Œé¢ç¡®è®¤è™šæ‹Ÿæœºå·²åˆ›å»º âš™ï¸ éªŒè¯é…ç½®ï¼šæ£€æŸ¥ CPUã€å†…å­˜ã€ç£ç›˜ç­‰é…ç½®æ˜¯å¦æ­£ç¡® ğŸ”Œ ç½‘ç»œæµ‹è¯•ï¼šå¯åŠ¨è™šæ‹Ÿæœºå¹¶æµ‹è¯•ç½‘ç»œè¿æ¥ ğŸ’¾ æ•°æ®å®Œæ•´æ€§ï¼šéªŒè¯é‡è¦æ•°æ®å’Œåº”ç”¨ç¨‹åºçŠ¶æ€ ğŸ“ æ–‡æ¡£æ›´æ–°ï¼šæ›´æ–°è™šæ‹Ÿæœºæ¸…å•å’Œé…ç½®æ–‡æ¡£ ğŸ“Š å…­ã€é«˜çº§å¤‡ä»½é€‰é¡¹ 1. å¤šè™šæ‹Ÿæœºå¤‡ä»½è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @echo off set OVF_TOOL_PATH=\u0026#34;C:\\Program Files\\VMware\\VMware OVF Tool\\ovftool.exe\u0026#34; set ESXI_URL=\u0026#34;https://192.168.1.100:443\u0026#34; set ESXI_USERNAME=\u0026#34;root\u0026#34; set ESXI_PASSWORD=\u0026#34;your_password\u0026#34; set BACKUP_DIR=%USERPROFILE%\\Desktop\\ESXi_Backups set VM_LIST=\u0026#34;iKuai OpenWRT Windows10 Ubuntu-Server\u0026#34; if not exist \u0026#34;%BACKUP_DIR%\u0026#34; mkdir \u0026#34;%BACKUP_DIR%\u0026#34; for /f \u0026#34;tokens=1-3 delims=/ \u0026#34; %%a in (\u0026#39;date /t\u0026#39;) do set CURRENT_DATE=%%a-%%b-%%c for %%V in (%VM_LIST%) do ( echo ğŸ“‹ æ­£åœ¨å¤‡ä»½è™šæ‹Ÿæœº: %%V %OVF_TOOL_PATH% --noSSLVerify --acceptAllEulas --powerOffSource %ESXI_URL%/sfc-cgi-bin/sfcgi.cgi?sid=%%V \u0026#34;%BACKUP_DIR%\\ESXI_%%V_%CURRENT_DATE%.ova\u0026#34; if !errorlevel! equ 0 ( echo âœ… %%V å¤‡ä»½æˆåŠŸ ) else ( echo âŒ %%V å¤‡ä»½å¤±è´¥ ) ) echo ğŸ“Š å¤‡ä»½å®Œæˆæ‘˜è¦ dir \u0026#34;%BACKUP_DIR%\\*%CURRENT_DATE%.ova\u0026#34; /s pause 2. å¢é‡å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 :: åŸºäºæ—¶é—´æˆ³çš„å¢é‡å¤‡ä»½ for /f \u0026#34;tokens=1-3 delims=/ \u0026#34; %%a in (\u0026#39;date /t\u0026#39;) do set CURRENT_DATE=%%a-%%b-%%c for /f \u0026#34;tokens=1-2 delims=: \u0026#34; %%a in (\u0026#39;time /t\u0026#39;) do set CURRENT_TIME=%%a%%b set BACKUP_FILENAME=ESXI_%VM_NAME%_%CURRENT_DATE%_%CURRENT_TIME%.ova :: åªå¤‡ä»½å½“å¤©ä¿®æ”¹è¿‡çš„è™šæ‹Ÿæœº %OVF_TOOL_PATH% --noSSLVerify --acceptAllEulas %ESXI_URL%/sfc-cgi-bin/sfcgi.cgi?sid=%VM_NAME% \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; 3. å‹ç¼©å’ŒåŠ å¯†é€‰é¡¹ 1 2 3 4 5 :: å¯ç”¨å‹ç¼©ï¼ˆå‡å°‘å¤‡ä»½æ–‡ä»¶å¤§å°ï¼‰ %OVF_TOOL_PATH% --compress=9 %ESXI_URL%/sfc-cgi-bin/sfcgi.cgi?sid=%VM_NAME% \u0026#34;%BACKUP_DIR%\\%BACKUP_FILENAME%\u0026#34; :: åŠ å¯†å¤‡ä»½æ–‡ä»¶ï¼ˆéœ€è¦é¢å¤–å·¥å…·ï¼‰ :: å»ºè®®ä½¿ç”¨ 7-Zip æˆ– WinRAR è¿›è¡ŒåŠ å¯†å‹ç¼© ğŸ› ï¸ ä¸ƒã€å¸¸è§é—®é¢˜è§£å†³ 1. SSL è¯ä¹¦é”™è¯¯ 1 2 3 4 5 :: æ·»åŠ è·³è¿‡ SSL éªŒè¯å‚æ•° --noSSLVerify :: æˆ–è€…å¯¼å…¥ ESXi è¯ä¹¦ :: é¦–å…ˆå¯¼å‡º ESXi è¯ä¹¦ï¼Œç„¶åå¯¼å…¥åˆ° Windows è¯ä¹¦å­˜å‚¨ 2. è®¤è¯å¤±è´¥é—®é¢˜ 1 2 3 4 5 6 7 8 :: æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ ping 192.168.1.100 :: éªŒè¯å‡­æ® :: å°è¯•ä½¿ç”¨ ESXi Shell ç™»å½•éªŒè¯ç”¨æˆ·åå¯†ç  :: æ£€æŸ¥è´¦æˆ·æƒé™ :: ç¡®ä¿å¤‡ä»½è´¦æˆ·æœ‰è¶³å¤Ÿæƒé™ 3. è™šæ‹ŸæœºçŠ¶æ€é—®é¢˜ 1 2 3 4 5 6 7 :: æ£€æŸ¥è™šæ‹ŸæœºçŠ¶æ€ :: åœ¨ ESXi Web ç•Œé¢ç¡®è®¤è™šæ‹Ÿæœºå·²å…³é—­ :: å¦‚æœè™šæ‹Ÿæœºæ— æ³•æ­£å¸¸å…³é—­ï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶å…³é—­ --powerOffSource :: æˆ–è€…å…ˆæ‰‹åŠ¨å…³é—­è™šæ‹Ÿæœºå†æ‰§è¡Œå¤‡ä»½ 4. å­˜å‚¨ç©ºé—´é—®é¢˜ 1 2 3 4 5 6 7 8 :: æ£€æŸ¥ç£ç›˜ç©ºé—´ dir /s \u0026#34;%BACKUP_DIR%\u0026#34; :: è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ forfiles /p \u0026#34;%BACKUP_DIR%\u0026#34; /m *.ova /d -30 /c \u0026#34;cmd /c echo Deleting @file \u0026amp;\u0026amp; del @file\u0026#34; :: ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ set BACKUP_DIR=\u0026#34;F:\\Backups\\ESXi\u0026#34; 5. ç½‘ç»œè¿æ¥é—®é¢˜ 1 2 3 4 5 6 7 8 :: æ£€æŸ¥é˜²ç«å¢™è®¾ç½® :: ç¡®ä¿ 443 ç«¯å£å¼€æ”¾ :: ä½¿ç”¨ IP åœ°å€è€Œä¸æ˜¯ä¸»æœºå set ESXI_URL=\u0026#34;https://192.168.1.100:443\u0026#34; :: å°è¯•ä½¿ç”¨ HTTPï¼ˆä¸æ¨èï¼‰ set ESXI_URL=\u0026#34;http://192.168.1.100\u0026#34; ğŸ”’ å…«ã€å¤‡ä»½ç­–ç•¥å»ºè®® 1. å¤‡ä»½é¢‘ç‡ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 # ğŸ“… æ¯æ—¥å¤‡ä»½ï¼ˆå…³é”®ç³»ç»Ÿï¼‰ - ä¿ç•™æœ€è¿‘ 7 å¤©çš„æ¯æ—¥å¤‡ä»½ - æ¯å‘¨è¿›è¡Œä¸€æ¬¡å®Œæ•´éªŒè¯ # ğŸ“Š æ¯å‘¨å¤‡ä»½ï¼ˆé‡è¦ç³»ç»Ÿï¼‰ - ä¿ç•™æœ€è¿‘ 4 å‘¨çš„å¤‡ä»½ - æ¯æœˆè¿›è¡Œä¸€æ¬¡æ¢å¤æµ‹è¯• # ğŸ—ƒï¸ æ¯æœˆå¤‡ä»½ï¼ˆä¸€èˆ¬ç³»ç»Ÿï¼‰ - ä¿ç•™æœ€è¿‘ 12 ä¸ªæœˆçš„å¤‡ä»½ - æ¯å­£åº¦è¿›è¡Œä¸€æ¬¡å…¨é¢éªŒè¯ 2. å­˜å‚¨ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 # ğŸ’¾ æœ¬åœ°å­˜å‚¨ - å¿«é€Ÿè®¿é—®ï¼Œé€‚åˆé¢‘ç¹å¤‡ä»½ - é£é™©ï¼šå•ç‚¹æ•…éšœ # ğŸŒ ç½‘ç»œå­˜å‚¨ - NAS æˆ– SAN å­˜å‚¨ - æ›´å¥½çš„å¯é æ€§å’Œæ‰©å±•æ€§ # â˜ï¸ äº‘å­˜å‚¨ - AWS S3ã€Azure Blob Storage ç­‰ - å¼‚åœ°å®¹ç¾ï¼Œæœ€é«˜çº§åˆ«çš„ä¿æŠ¤ 3. éªŒè¯ç­–ç•¥ 1 2 3 4 5 6 7 # âœ… å®šæœŸéªŒè¯å¤‡ä»½å®Œæ•´æ€§ - æ¯æœˆæ£€æŸ¥å¤‡ä»½æ–‡ä»¶å“ˆå¸Œå€¼ - æ¯å­£åº¦è¿›è¡Œå®é™…æ¢å¤æµ‹è¯• # ğŸ“ è®°å½•å¤‡ä»½æ—¥å¿— - è®°å½•æ¯æ¬¡å¤‡ä»½çš„æ—¶é—´ã€å¤§å°ã€çŠ¶æ€ - è®°å½•éªŒè¯å’Œæ¢å¤æµ‹è¯•ç»“æœ ğŸ’¡ ä¹ã€è‡ªåŠ¨åŒ–éƒ¨ç½² 1. Windows è®¡åˆ’ä»»åŠ¡ 1 2 3 4 5 6 7 8 :: åˆ›å»ºæ¯æ—¥å¤‡ä»½ä»»åŠ¡ schtasks /create /tn \u0026#34;ESXiæ¯æ—¥å¤‡ä»½\u0026#34; /tr \u0026#34;C:\\Backup\\esxi_backup.bat\u0026#34; /sc daily /st 02:00 /ru SYSTEM :: åˆ›å»ºæ¯å‘¨æ¸…ç†ä»»åŠ¡ schtasks /create /tn \u0026#34;æ¸…ç†æ—§å¤‡ä»½\u0026#34; /tr \u0026#34;C:\\Backup\\cleanup.bat\u0026#34; /sc weekly /st 03:00 :: æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨ schtasks /query /tn \u0026#34;ESXiæ¯æ—¥å¤‡ä»½\u0026#34; 2. é‚®ä»¶é€šçŸ¥é›†æˆ 1 2 3 4 5 6 :: ä½¿ç”¨ PowerShell å‘é€é‚®ä»¶é€šçŸ¥ powershell -Command \u0026#34;Send-MailMessage -From \u0026#39;backup@company.com\u0026#39; -To \u0026#39;admin@company.com\u0026#39; -Subject \u0026#39;ESXiå¤‡ä»½å®Œæˆ\u0026#39; -Body \u0026#39;å¤‡ä»½å·²æˆåŠŸå®Œæˆ\u0026#39; -SmtpServer \u0026#39;smtp.company.com\u0026#39;\u0026#34; :: æˆ–è€…åœ¨è„šæœ¬ä¸­æ·»åŠ é‚®ä»¶é€šçŸ¥ echo ğŸ“§ å‘é€é‚®ä»¶é€šçŸ¥... blat \u0026#34;%BACKUP_DIR%\\backup_log.txt\u0026#34; -to \u0026#34;admin@example.com\u0026#34; -subject \u0026#34;ESXiå¤‡ä»½çŠ¶æ€\u0026#34; -body \u0026#34;å¤‡ä»½ä½œä¸šå·²å®Œæˆ\u0026#34; 3. æ—¥å¿—è®°å½•å’Œç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 :: è¯¦ç»†çš„æ—¥å¿—è®°å½• echo %DATE% %TIME% - å¼€å§‹å¤‡ä»½ \u0026gt;\u0026gt; \u0026#34;%BACKUP_DIR%\\backup_log.txt\u0026#34; %OVF_TOOL_PATH% ... \u0026gt;\u0026gt; \u0026#34;%BACKUP_DIR%\\backup_log.txt\u0026#34; 2\u0026gt;\u0026amp;1 echo %DATE% %TIME% - å¤‡ä»½å®Œæˆï¼ŒçŠ¶æ€: %errorlevel% \u0026gt;\u0026gt; \u0026#34;%BACKUP_DIR%\\backup_log.txt\u0026#34; :: ç›‘æ§ç£ç›˜ç©ºé—´ for /f \u0026#34;usebackq\u0026#34; %%I in (`dir /s \u0026#34;%BACKUP_DIR%\u0026#34; ^| find \u0026#34;bytes free\u0026#34;`) do ( if %%I LSS 1073741824 ( echo âš ï¸ ç£ç›˜ç©ºé—´ä¸è¶³: ä»…å‰© %%I bytes \u0026gt;\u0026gt; \u0026#34;%BACKUP_DIR%\\backup_log.txt\u0026#34; ) ) âš ï¸ åã€é‡è¦æ³¨æ„äº‹é¡¹ 1. å®‰å…¨æ€§æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 # ğŸ”’ å¯†ç å®‰å…¨ - ä¸è¦åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç  - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–åŠ å¯†é…ç½®æ–‡ä»¶ - å®šæœŸæ›´æ¢å¤‡ä»½è´¦æˆ·å¯†ç  # ğŸ›¡ï¸ å¤‡ä»½æ–‡ä»¶å®‰å…¨ - åŠ å¯†å­˜å‚¨åŒ…å«æ•æ„Ÿæ•°æ®çš„å¤‡ä»½ - æ§åˆ¶å¤‡ä»½æ–‡ä»¶çš„è®¿é—®æƒé™ - å®šæœŸå®¡è®¡å¤‡ä»½è®¿é—®æ—¥å¿— 2. æ“ä½œæ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 # âš ï¸ åœæœºæ—¶é—´ - å¤‡ä»½éœ€è¦å…³é—­è™šæ‹Ÿæœºï¼Œå®‰æ’åˆé€‚çš„ç»´æŠ¤çª—å£ - æå‰é€šçŸ¥ç›¸å…³ç”¨æˆ·å’ŒæœåŠ¡ # ğŸ“‹ æ–‡æ¡£å®Œæ•´æ€§ - è®°å½•æ‰€æœ‰å¤‡ä»½å’Œæ¢å¤æ“ä½œ - ç»´æŠ¤å‡†ç¡®çš„è™šæ‹Ÿæœºæ¸…å• - æ›´æ–°æ¢å¤æµç¨‹æ–‡æ¡£ 3. æŠ€æœ¯é™åˆ¶ 1 2 3 4 5 6 7 8 9 # ğŸ”§ OVF Tool é™åˆ¶ - å¤‡ä»½æœŸé—´è™šæ‹Ÿæœºå¿…é¡»å…³é—­ - å¤§å‹è™šæ‹Ÿæœºå¤‡ä»½æ—¶é—´è¾ƒé•¿ - æŸäº›ç‰¹æ®Šç¡¬ä»¶é…ç½®å¯èƒ½ä¸æ”¯æŒ # ğŸ’¾ å­˜å‚¨è€ƒè™‘ - ç¡®ä¿ç›®æ ‡å­˜å‚¨æœ‰è¶³å¤Ÿç©ºé—´ - è€ƒè™‘ç½‘ç»œå¸¦å®½å¯¹å¤‡ä»½é€Ÿåº¦çš„å½±å“ - è§„åˆ’å¤‡ä»½æ–‡ä»¶çš„å¢é•¿ç©ºé—´ ğŸ”§ åä¸€ã€æ›¿ä»£æ–¹æ¡ˆ 1. ä½¿ç”¨ VMware vSphere Client 1 2 3 4 5 6 7 8 # å›¾å½¢ç•Œé¢å¤‡ä»½ - ä½¿ç”¨ vSphere Client æ‰‹åŠ¨å¯¼å‡º OVF - é€‚åˆå¶å°”å¤‡ä»½ï¼Œä¸é€‚åˆè‡ªåŠ¨åŒ– # æ­¥éª¤ï¼š 1. å³é”®ç‚¹å‡»è™šæ‹Ÿæœº â†’ å¯¼å‡º â†’ å¯¼å‡º OVF æ¨¡æ¿ 2. é€‰æ‹©ç›®æ ‡ä½ç½®å’Œæ ¼å¼ 3. ç­‰å¾…å¯¼å‡ºå®Œæˆ 2. ä½¿ç”¨ ghettoVCB 1 2 3 4 5 6 7 8 9 # åŸºäºè„šæœ¬çš„å¤‡ä»½æ–¹æ¡ˆ - åœ¨ ESXi ä¸»æœºä¸Šç›´æ¥è¿è¡Œ - æ”¯æŒå¢é‡å¤‡ä»½ - éœ€è¦ ESXi Shell è®¿é—® # å®‰è£…å’Œä½¿ç”¨ï¼š wget https://github.com/lamw/ghettoVCB/raw/master/ghettoVCB.sh chmod +x ghettoVCB.sh ./ghettoVCB.sh -a -g mybackup.conf 3. ä½¿ç”¨ä¸“ä¸šå¤‡ä»½å·¥å…· 1 2 3 4 5 6 7 8 9 10 # ğŸ¢ ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ - Veeam Backup \u0026amp; Replication - VMware vSphere Data Protection - Nakivo Backup \u0026amp; Replication # ğŸ’¡ ä¼˜åŠ¿ï¼š - å¢é‡å¤‡ä»½å’Œæ°¸ä¹…å¢é‡ - åº”ç”¨ä¸€è‡´æ€§å¤‡ä»½ - é«˜çº§å‹ç¼©å’Œå»é‡ - é›†ä¸­ç®¡ç†å’Œç›‘æ§ 4. åŸºäºå­˜å‚¨çš„å¿«ç…§ 1 2 3 4 5 6 7 8 9 10 # ğŸ“¸ å­˜å‚¨çº§å¿«ç…§ - åˆ©ç”¨å­˜å‚¨é˜µåˆ—çš„å¿«ç…§åŠŸèƒ½ - å‡ ä¹é›¶åœæœºæ—¶é—´ - éœ€è¦å…¼å®¹çš„å­˜å‚¨ç¡¬ä»¶ # å…¸å‹æµç¨‹ï¼š 1. åˆ›å»ºå­˜å‚¨å¿«ç…§ 2. æŒ‚è½½å¿«ç…§åˆ°å¤‡ä»½æœåŠ¡å™¨ 3. ä»å¿«ç…§ä¸­æå–è™šæ‹Ÿæœºæ•°æ® 4. å¸è½½å¿«ç…§ ğŸ’ æ€»ç»“ é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š\nâœ… æ­£ç¡®å®‰è£…å’Œé…ç½® OVF Tool âœ… åˆ›å»ºè‡ªåŠ¨åŒ–çš„å¤‡ä»½è„šæœ¬ âœ… å®æ–½æœ‰æ•ˆçš„å¤‡ä»½ç­–ç•¥ âœ… å¤„ç†å¸¸è§çš„å¤‡ä»½å’Œæ¢å¤é—®é¢˜ âœ… é€‰æ‹©é€‚åˆçš„å¤‡ä»½è§£å†³æ–¹æ¡ˆ å»ºè®®æ“ä½œæµç¨‹ï¼š\nğŸ§ª å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æ‰€æœ‰é…ç½® ğŸ“‹ åˆ¶å®šè¯¦ç»†çš„å¤‡ä»½å’Œæ¢å¤è®¡åˆ’ ğŸ”„ å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹ ğŸ“Š ç›‘æ§å¤‡ä»½ä½œä¸šçš„æ‰§è¡Œæƒ…å†µ ğŸ”§ æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´å¤‡ä»½ç­–ç•¥ ğŸš¨ æœ€åæé†’ï¼šå¤‡ä»½åªæ˜¯æ‰‹æ®µï¼Œèƒ½å¤ŸæˆåŠŸæ¢å¤æ‰æ˜¯ç›®çš„ã€‚è¯·åŠ¡å¿…å®šæœŸéªŒè¯æ‚¨çš„å¤‡ä»½å¯ç”¨æ€§ï¼\nå¸Œæœ›è¿™ä»½å®Œæ•´çš„æŒ‡å—èƒ½å¸®åŠ©æ‚¨å»ºç«‹å¯é çš„ ESXi è™šæ‹Ÿæœºå¤‡ä»½å’Œæ¢å¤ä½“ç³»ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œå»ºè®®æŸ¥é˜… VMware å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒºè®ºå›è·å–æ›´å¤šå¸®åŠ©ã€‚\n","date":"2024-12-07T07:10:56+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4fa899f7/","title":"ESXi è™šæ‹Ÿä¸»æœºå¤‡ä»½ä¸æ¢å¤æŒ‡å— ğŸ’¾"},{"content":"ESXi ä¸»æœºç®¡ç†æŒ‡å—ï¼šå¯†ç é‡ç½®ä¸ç½‘ç»œé…ç½® ğŸ–¥ï¸ âš¡ é€šè¿‡å‘½ä»¤è¡Œå’ŒDCUIç•Œé¢ç®¡ç†ESXiä¸»æœºçš„å®ç”¨æŠ€å·§ï¼Œæ¶µç›–SSHè®¿é—®ã€å¯†ç é‡ç½®ã€ç½‘ç»œé…ç½®ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŠ©ä½ è½»æ¾ç»´æŠ¤è™šæ‹ŸåŒ–ç¯å¢ƒ\nğŸ“‹ å¯¼èˆªç›®å½• ğŸ” å¯ç”¨SSHè®¿é—® ğŸŒ é€šè¿‡Webç•Œé¢å¯ç”¨SSH âš¡ é€šè¿‡å‘½ä»¤è¡Œå¯ç”¨SSH ğŸ”§ ä½¿ç”¨ESXCLIå‘½ä»¤ ğŸ–¥ï¸ ä½¿ç”¨DCUIç•Œé¢ ğŸš€ å¯åŠ¨DCUIç•Œé¢ ğŸ“‹ DCUIä¸»ç•Œé¢é€‰é¡¹ ğŸ”§ å¯†ç é‡ç½®æ–¹æ³• ğŸ”„ é€šè¿‡DCUIé‡ç½®å¯†ç  âš¡ å‘½ä»¤è¡Œå¯†ç é‡ç½® ğŸ› ï¸ é‡ç½®ç³»ç»Ÿé…ç½® ğŸŒ ç½‘ç»œé…ç½®æŒ‡å— âš™ï¸ é«˜çº§ç®¡ç†æŠ€å·§ âš ï¸ æ³¨æ„äº‹é¡¹ ğŸš€ æ•…éšœæ’é™¤ ğŸ” å¯ç”¨SSHè®¿é—® SSHï¼ˆSecure Shellï¼‰è®¿é—®æ˜¯ç®¡ç†ESXiä¸»æœºçš„é‡è¦æ–¹å¼ï¼Œå®ƒæä¾›äº†åŠ å¯†çš„å‘½ä»¤è¡Œè¿æ¥ï¼Œå…è®¸ç®¡ç†å‘˜è¿œç¨‹æ‰§è¡Œç³»ç»Ÿç®¡ç†ä»»åŠ¡ã€‚ESXié»˜è®¤å…³é—­SSHæœåŠ¡ï¼Œéœ€è¦æ‰‹åŠ¨å¯ç”¨ã€‚\nğŸŒ é€šè¿‡Webç•Œé¢å¯ç”¨SSH ç™»å½•ESXi Webç®¡ç†ç•Œé¢ï¼ˆé€šå¸¸é€šè¿‡https://ESXi-IP-address/uiï¼‰ å¯¼èˆªè‡³: ä¸»æœº â†’ æœåŠ¡ â†’ å¯ç”¨å®‰å…¨Shell(SSH) ç‚¹å‡»å¯ç”¨æŒ‰é’® âœ… å¯ç”¨åï¼Œå¯é€šè¿‡SSHå®¢æˆ·ç«¯ï¼ˆå¦‚PuTTYã€OpenSSHï¼‰è¿æ¥ESXiä¸»æœº âš¡ é€šè¿‡å‘½ä»¤è¡Œå¯ç”¨SSH é€šè¿‡ESXiçš„DCUIç•Œé¢æˆ–æœ¬åœ°æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # å¯ç”¨SSHæœåŠ¡ /etc/init.d/SSH start # è®¾ç½®SSHæœåŠ¡å¼€æœºè‡ªå¯ chkconfig SSH on # æ£€æŸ¥SSHæœåŠ¡çŠ¶æ€ /etc/init.d/SSH status # åœæ­¢SSHæœåŠ¡ï¼ˆå®‰å…¨è€ƒè™‘ï¼Œä¸ä½¿ç”¨æ—¶å»ºè®®å…³é—­ï¼‰ /etc/init.d/SSH stop ğŸ”§ ä½¿ç”¨ESXCLIå‘½ä»¤ ESXCLIæ˜¯ESXiæä¾›çš„å¼ºå¤§å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œæä¾›æ›´ç²¾ç»†çš„æœåŠ¡æ§åˆ¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹SSHæœåŠ¡çŠ¶æ€ esxcli system ssh server get # å¯ç”¨SSHæœåŠ¡ esxcli system ssh server set --enabled=true # ç¦ç”¨SSHæœåŠ¡ esxcli system ssh server set --enabled=false # é‡å¯SSHæœåŠ¡ esxcli system ssh server restart # æŸ¥çœ‹SSHå¯†é’¥æŒ‡çº¹ï¼ˆç”¨äºéªŒè¯è¿æ¥å®‰å…¨æ€§ï¼‰ esxcli system ssh server fingerprint get ğŸ–¥ï¸ ä½¿ç”¨DCUIç•Œé¢ DCUI (Direct Console User Interface) æ˜¯ESXiä¸»æœºæä¾›çš„ç›´æ¥æ§åˆ¶å°ç”¨æˆ·ç•Œé¢ï¼Œç‰¹åˆ«é€‚ç”¨äºæ— æ˜¾ç¤ºå™¨ç¯å¢ƒä¸‹çš„æœ¬åœ°ç®¡ç†ã€‚âœ¨ å®ƒæä¾›äº†åŸºæœ¬çš„ç³»ç»Ÿé…ç½®åŠŸèƒ½ï¼Œæ— éœ€å¤æ‚çš„Webç•Œé¢æˆ–å‘½ä»¤è¡ŒçŸ¥è¯†ã€‚\nğŸš€ å¯åŠ¨DCUIç•Œé¢ 1 2 3 4 5 # é€šè¿‡SSHè¿æ¥åå¯åŠ¨DCUI dcui # æˆ–è€…é€šè¿‡æœ¬åœ°æ§åˆ¶å°ç›´æ¥è®¿é—® # åœ¨ESXiä¸»æœºç‰©ç†æ§åˆ¶å°ä¸ŠæŒ‰F2é”® ğŸ“‹ DCUIä¸»ç•Œé¢é€‰é¡¹ Configure Password ğŸ” - é…ç½®ç”¨æˆ·å¯†ç ï¼ˆåŒ…æ‹¬rootè´¦æˆ·ï¼‰ Configure Management Network ğŸŒ - é…ç½®ç®¡ç†ç½‘ç»œè®¾ç½® Restart Management Network ğŸ”„ - é‡å¯ç®¡ç†ç½‘ç»œæœåŠ¡ Test Management Network ğŸ§ª - æµ‹è¯•ç½‘ç»œè¿æ¥å’ŒDNSè§£æ Network Restore Options ğŸ’¾ - ç½‘ç»œé…ç½®æ¢å¤é€‰é¡¹ Configure Keyboard âŒ¨ï¸ - é…ç½®é”®ç›˜å¸ƒå±€å’Œè¯­è¨€è®¾ç½® Troubleshooting Options ğŸ› ï¸ - æ•…éšœæ’é™¤å’Œè¯Šæ–­é€‰é¡¹ View System Logs ğŸ“Š - æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å’Œäº‹ä»¶è®°å½• Reset System Configuration âš ï¸ - é‡ç½®ç³»ç»Ÿé…ç½®åˆ°é»˜è®¤çŠ¶æ€ ğŸ”§ å¯†ç é‡ç½®æ–¹æ³• ESXiæä¾›äº†å¤šç§å¯†ç é‡ç½®æ–¹å¼ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ã€‚ğŸ’¡ å®šæœŸæ›´æ–°å¯†ç æ˜¯ä¿æŒç³»ç»Ÿå®‰å…¨çš„é‡è¦æªæ–½ã€‚\nğŸ”„ é€šè¿‡DCUIé‡ç½®å¯†ç  é€šè¿‡SSHè¿æ¥ESXiä¸»æœºæˆ–ç›´æ¥è®¿é—®ç‰©ç†æ§åˆ¶å° è¿è¡Œ dcui å‘½ä»¤æˆ–æŒ‰ F2 é”® è¾“å…¥å½“å‰ç”¨æˆ·åå’Œå¯†ç ï¼ˆå¦‚å·²çŸ¥ï¼‰ é€‰æ‹© Configure Password é€‰é¡¹ æŒ‰ç…§æç¤ºè¾“å…¥å½“å‰å¯†ç å’Œæ–°å¯†ç  ç¡®è®¤æ–°å¯†ç å¹¶åº”ç”¨æ›´æ”¹ âœ… å¯†ç ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯ç³»ç»Ÿ âš¡ å‘½ä»¤è¡Œå¯†ç é‡ç½® 1 2 3 4 5 6 7 8 9 10 11 # ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼ˆéœ€è¦å½“å‰å¯†ç ï¼‰ passwd root # ä½¿ç”¨simplepasswdå·¥å…·ï¼ˆESXiä¸“ç”¨ï¼‰ /bin/simplepasswd # æ‰¹é‡ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼ˆé€‚ç”¨äºå¤šç”¨æˆ·ç¯å¢ƒï¼‰ vim-users add -u username -p password # æŸ¥çœ‹ç”¨æˆ·è´¦æˆ·åˆ—è¡¨ esxcli system account list ğŸ› ï¸ é‡ç½®ç³»ç»Ÿé…ç½® âš ï¸ æ³¨æ„ï¼šæ­¤æ“ä½œå°†æ¢å¤ç³»ç»Ÿé»˜è®¤è®¾ç½®ï¼ŒåŒ…æ‹¬ç½‘ç»œé…ç½®ã€ç”¨æˆ·æƒé™ç­‰ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼\nåœ¨DCUIç•Œé¢ä¸­é€‰æ‹© Reset System Configuration ä»”ç»†é˜…è¯»è­¦å‘Šä¿¡æ¯ï¼Œç¡®è®¤äº†è§£åæœ é€‰æ‹© Confirm ç¡®è®¤é‡ç½®æ“ä½œ ç³»ç»Ÿå°†è‡ªåŠ¨é‡å¯å¹¶æ¢å¤å‡ºå‚è®¾ç½® ğŸ”„ é»˜è®¤ç®¡ç†IPå°†å˜ä¸ºDHCPè·å–æ¨¡å¼ ğŸ“ æ‰€æœ‰è‡ªå®šä¹‰é…ç½®ï¼ˆå­˜å‚¨ã€ç½‘ç»œã€ç”¨æˆ·ç­‰ï¼‰å°†è¢«æ¸…é™¤ ğŸŒ ç½‘ç»œé…ç½®æŒ‡å— æ­£ç¡®çš„ç½‘ç»œé…ç½®æ˜¯ESXiç¨³å®šè¿è¡Œçš„åŸºç¡€ã€‚ğŸŒ æœ¬èŠ‚ä»‹ç»å¦‚ä½•é€šè¿‡DCUIç•Œé¢é…ç½®ç®¡ç†ç½‘ç»œã€‚\nğŸ“¡ é…ç½®ç®¡ç†ç½‘ç»œ åœ¨DCUIç•Œé¢ä¸­é€‰æ‹© Configure Management Network é€‰æ‹© Network Adapters - æŸ¥çœ‹å’Œé€‰æ‹©ç‰©ç†ç½‘ç»œé€‚é…å™¨ é€‰æ‹© VLAN - è®¾ç½®VLAN IDï¼ˆå¯é€‰ï¼Œç”¨äºç½‘ç»œåˆ†æ®µï¼‰ é€‰æ‹© IPv4 Configuration - é…ç½®IPv4åœ°å€å’Œå­ç½‘è®¾ç½® é€‰æ‹© IPv6 Configuration - é…ç½®IPv6è®¾ç½®ï¼ˆå¯é€‰ï¼‰ é€‰æ‹© DNS Configuration - é…ç½®DNSæœåŠ¡å™¨å’Œä¸»æœºå é€‰æ‹© Custom DNS Suffixes - è®¾ç½®è‡ªå®šä¹‰DNSåç¼€ ğŸ”Œ é…ç½®é™æ€IPåœ°å€ é™æ€IPç¡®ä¿ESXiä¸»æœºå§‹ç»ˆä½¿ç”¨å›ºå®šçš„ç½‘ç»œåœ°å€ï¼Œä¾¿äºç®¡ç†å’Œè®¿é—®ï¼š\nåœ¨ IPv4 Configuration ä¸­é€‰æ‹© Static IPv4 è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼š IP Address: é™æ€IPåœ°å€ (å¦‚: 192.168.1.100) Subnet Mask: å­ç½‘æ©ç  (å¦‚: 255.255.255.0) Default Gateway: é»˜è®¤ç½‘å…³ (å¦‚: 192.168.1.1) âœ… ä½¿ç”¨TABé”®åœ¨ä¸åŒå­—æ®µé—´åˆ‡æ¢ ğŸ“ ç¡®ä¿IPåœ°å€åœ¨å±€åŸŸç½‘å†…å”¯ä¸€ä¸”æœªè¢«å ç”¨ ğŸŒ é…ç½®DNSè®¾ç½® æ­£ç¡®çš„DNSé…ç½®ç¡®ä¿ä¸»æœºåè§£æå’Œç½‘ç»œæœåŠ¡æ­£å¸¸è¿è¡Œï¼š\nåœ¨ DNS Configuration ä¸­è®¾ç½®ï¼š Primary DNS Server: ä¸»DNSæœåŠ¡å™¨ (å¦‚: 114.114.114.114) Secondary DNS Server: å¤‡ç”¨DNSæœåŠ¡å™¨ (å¦‚: 8.8.8.8) Hostname: ä¸»æœºå (å¦‚: esxi-host) Domain Name: åŸŸå (å¦‚: local) ğŸ” ä½¿ç”¨ Test Management Network éªŒè¯DNSè§£æ ğŸ’¡ å»ºè®®åŒæ—¶é…ç½®ä¸»å¤‡DNSæœåŠ¡å™¨æé«˜å¯é æ€§ ğŸ’¾ åº”ç”¨ç½‘ç»œæ›´æ”¹ å®Œæˆç½‘ç»œé…ç½®åï¼Œéœ€è¦æ­£ç¡®åº”ç”¨æ›´æ”¹ï¼š\næŒ‰ ESC é”®è¿”å›ä¸Šä¸€çº§èœå• é€‰æ‹© Yes åº”ç”¨æ›´æ”¹å¹¶é‡å¯ç®¡ç†ç½‘ç»œ ç­‰å¾…ç½‘ç»œæœåŠ¡é‡å¯å®Œæˆï¼ˆé€šå¸¸éœ€è¦10-30ç§’ï¼‰ ğŸ§ª ä½¿ç”¨pingå‘½ä»¤æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ğŸ“Š å¦‚æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—æ’æŸ¥æ•…éšœ âš™ï¸ é«˜çº§ç®¡ç†æŠ€å·§ å¯¹äºç†Ÿç»ƒçš„ç®¡ç†å‘˜ï¼Œå‘½ä»¤è¡Œæä¾›äº†æ›´çµæ´»å’Œå¼ºå¤§çš„ç®¡ç†æ–¹å¼ã€‚\nğŸ“Š å‘½ä»¤è¡Œç½‘ç»œé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æŸ¥çœ‹å½“å‰ç½‘ç»œé…ç½® esxcli network ip interface ipv4 get # è®¾ç½®é™æ€IP esxcli network ip interface ipv4 set -i vmk0 -I 192.168.1.100 -N 255.255.255.0 -t static # è®¾ç½®DHCPè·å–IP esxcli network ip interface ipv4 set -i vmk0 -t dhcp # è®¾ç½®é»˜è®¤ç½‘å…³ esxcli network ip route ipv4 add -g 192.168.1.1 -n default # é…ç½®DNSæœåŠ¡å™¨ esxcli network ip dns server add --server=114.114.114.114 esxcli network ip dns server add --server=8.8.8.8 # æŸ¥çœ‹å½“å‰DNSé…ç½® esxcli network ip dns server list # è®¾ç½®ä¸»æœºåå’ŒåŸŸå esxcli system hostname set --host=esxi-host esxcli system hostname set --domain=local # æŸ¥çœ‹å®Œæ•´ä¸»æœºå esxcli system hostname get ğŸ”„ ç½‘ç»œæœåŠ¡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # é‡å¯ç®¡ç†ç½‘ç»œ /etc/init.d/network restart # ä¼˜é›…é‡å¯ç½‘ç»œæ¥å£ esxcli network ip interface set -e false -i vmk0 esxcli network ip interface set -e true -i vmk0 # æŸ¥çœ‹ç½‘ç»œæœåŠ¡çŠ¶æ€ /etc/init.d/network status # æŸ¥çœ‹ç½‘ç»œæ¥å£ç»Ÿè®¡ä¿¡æ¯ esxcli network ip interface ipv4 get # æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€ esxcli network nic list ğŸ“ é…ç½®æ–‡ä»¶ç›´æ¥ç¼–è¾‘ âš ï¸ é«˜çº§æ“ä½œï¼šç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶å¯èƒ½é€ æˆç³»ç»Ÿä¸ç¨³å®šï¼Œå»ºè®®å…ˆå¤‡ä»½ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶ cp /etc/sysconfig/network /etc/sysconfig/network.backup cp /etc/resolv.conf /etc/resolv.conf.backup # ç¼–è¾‘ç½‘ç»œé…ç½® vi /etc/sysconfig/network # ç¼–è¾‘DNSé…ç½® vi /etc/resolv.conf # ç¼–è¾‘ä¸»æœºåé…ç½® vi /etc/hostname # ç¼–è¾‘é™æ€ä¸»æœºåè§£æ vi /etc/hosts # é‡å¯æœåŠ¡åº”ç”¨æ›´æ”¹ /etc/init.d/network restart âš ï¸ æ³¨æ„äº‹é¡¹ æ­£ç¡®çš„æ“ä½œä¹ æƒ¯å¯ä»¥é¿å…è®¸å¤šå¸¸è§é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚\nğŸ”´ é‡è¦è­¦å‘Š ğŸ’¾ é…ç½®å¤‡ä»½: åœ¨è¿›è¡Œé‡å¤§æ›´æ”¹å‰åŠ¡å¿…å¤‡ä»½é…ç½®æ–‡ä»¶\n1 2 3 4 # å¤‡ä»½é‡è¦é…ç½® cp /etc/sysconfig/network /root/network.backup.$(date +%Y%m%d) cp /etc/resolv.conf /root/resolv.conf.backup.$(date +%Y%m%d) cp /etc/hosts /root/hosts.backup.$(date +%Y%m%d) ğŸ“¶ è¿æ¥é£é™©: ä¿®æ”¹ç½‘ç»œé…ç½®å¯èƒ½å¯¼è‡´è¿æ¥ä¸­æ–­\nç¡®ä¿æœ‰ç‰©ç†è®¿é—®æƒé™æˆ–ILO/IPMIç­‰å¸¦å¤–ç®¡ç†æ–¹å¼ å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œæ“ä½œ å‡†å¤‡å›æ»šæ–¹æ¡ˆå’Œåº”æ€¥å¤„ç†æµç¨‹ ğŸ”„ æœåŠ¡å½±å“: ç½‘ç»œé‡å¯ä¼šçŸ­æš‚ä¸­æ–­æ‰€æœ‰ç½‘ç»œè¿æ¥\né€šçŸ¥ç›¸å…³ç”¨æˆ·å’Œç»´æŠ¤å›¢é˜Ÿ ç¡®ä¿è™šæ‹Ÿæœºè¿ç§»æˆ–é«˜å¯ç”¨é…ç½®å·²å°±ç»ª ç›‘æ§æœåŠ¡æ¢å¤çŠ¶æ€ âœ… æœ€ä½³å®è·µ ğŸ“ è®°å½•é…ç½®: è¯¦ç»†è®°å½•æ‰€æœ‰ç½‘ç»œé…ç½®æ›´æ”¹\nç»´æŠ¤å˜æ›´æ—¥å¿—å’Œé…ç½®æ–‡æ¡£ è®°å½•ä¿®æ”¹æ—¶é—´ã€æ“ä½œäººå‘˜å’Œä¿®æ”¹å†…å®¹ ä¿å­˜é…ç½®å¤‡ä»½å’Œæ¢å¤æ­¥éª¤ ğŸ§ª æµ‹è¯•éªŒè¯: æ›´æ”¹åå…¨é¢æµ‹è¯•ç½‘ç»œåŠŸèƒ½\n1 2 3 4 5 6 7 8 9 10 # æµ‹è¯•ç½‘ç»œè¿é€šæ€§ ping -c 4 192.168.1.1 ping -c 4 8.8.8.8 # æµ‹è¯•DNSè§£æ nslookup google.com nslookup esxi-host.local # æµ‹è¯•ç«¯å£è¿é€šæ€§ nc -z 192.168.1.100 902 # VMwareç®¡ç†ç«¯å£ â° ç»´æŠ¤çª—å£: åœ¨è®¡åˆ’ç»´æŠ¤æ—¶æ®µè¿›è¡Œé…ç½®æ›´æ”¹\nåˆ¶å®šè¯¦ç»†çš„æ“ä½œè®¡åˆ’å’Œæ—¶é—´è¡¨ å‡†å¤‡å›æ»šæ–¹æ¡ˆå’Œåº”æ€¥é¢„æ¡ˆ ç¡®ä¿å…³é”®äººå‘˜åœ¨åœºæˆ–å¯åŠæ—¶å“åº” ğŸš€ æ•…éšœæ’é™¤ é‡åˆ°ç½‘ç»œé—®é¢˜æ—¶ï¼Œç³»ç»ŸåŒ–çš„æ’æŸ¥æ–¹æ³•å¯ä»¥å¸®åŠ©å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚\nğŸ”§ ç½‘ç»œé—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€å’Œé€Ÿåº¦ esxcli network nic list # æŸ¥çœ‹IPé…ç½®å’ŒVLANè®¾ç½® esxcli network ip interface list # æ£€æŸ¥è·¯ç”±è¡¨ä¿¡æ¯ esxcli network ip route ipv4 list # æµ‹è¯•DNSè§£æåŠŸèƒ½ nslookup google.com nslookup esxi-host.local # æŸ¥çœ‹ARPç¼“å­˜è¡¨ esxcli network ip neighbor list # æ£€æŸ¥ç½‘ç»œç»Ÿè®¡ä¿¡æ¯å’Œé”™è¯¯è®¡æ•° esxcli network ip interface ipv4 get # æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä¸­çš„ç½‘ç»œç›¸å…³äº‹ä»¶ tail -f /var/log/messages | grep network grep -i error /var/log/messages | grep network # ä½¿ç”¨vmkpingæµ‹è¯•VMkernelç½‘ç»œè¿é€šæ€§ vmkping 192.168.1.1 ğŸš‘ ç½‘ç»œæ¢å¤æ–¹æ³• å½“ç½‘ç»œé…ç½®å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ¢å¤æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # é‡å¯æ‰€æœ‰ç½‘ç»œæœåŠ¡ï¼ˆæ¸©å’Œæ–¹å¼ï¼‰ /etc/init.d/network restart # å¼ºåˆ¶é‡å¯ç½‘ç»œå †æ ˆï¼ˆæ¿€è¿›æ–¹å¼ï¼‰ /etc/init.d/netd restart # æ¢å¤å¤‡ä»½é…ç½® cp /etc/sysconfig/network.backup /etc/sysconfig/network cp /etc/resolv.conf.backup /etc/resolv.conf cp /etc/hosts.backup /etc/hosts # åº”ç”¨é…ç½®æ›´æ”¹ /etc/init.d/network restart # é‡ç½®å•ä¸ªç½‘ç»œé€‚é…å™¨ esxcli network nic down -n vmnic0 esxcli network nic up -n vmnic0 # ä½¿ç”¨DCUIæ¢å¤ç½‘ç»œé»˜è®¤è®¾ç½® # é€šè¿‡DCUIé€‰æ‹©\u0026#34;Network Restore Options\u0026#34; ğŸ“± è¿œç¨‹ç®¡ç†æŠ€å·§ å³ä½¿ç½‘ç»œå‡ºç°é—®é¢˜ï¼Œä»æœ‰å¤šç§æ–¹å¼å¯ä»¥ç®¡ç†ESXiä¸»æœºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¯ç”¨ESXi Shellï¼ˆæ›¿ä»£SSHï¼‰ /etc/init.d/shell start # è®¾ç½®ESXi Shellå¼€æœºè‡ªå¯ chkconfig shell on # é€šè¿‡ä¸»æœºå®¢æˆ·ç«¯ç›´æ¥ç®¡ç† # ä½¿ç”¨VMware Host Clientè¿æ¥ESXiä¸»æœºï¼ˆhttps://ESXi-IP-address/uiï¼‰ # ä½¿ç”¨vSphere Clientç®¡ç† # é€‚ç”¨äºvCenterç®¡ç†çš„ESXiä¸»æœº # é€šè¿‡ILO/IPMIå¸¦å¤–ç®¡ç† # éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œæä¾›ä¸ä¾èµ–æ“ä½œç³»ç»Ÿçš„ç®¡ç†æ–¹å¼ # ä½¿ç”¨ESXi Embedded Host Client # ç°ä»£ESXiç‰ˆæœ¬å†…ç½®çš„HTML5ç®¡ç†ç•Œé¢ ğŸ’¡ ä¸“ä¸šæç¤º: å¯¹äºç”Ÿäº§ç¯å¢ƒçš„ESXiä¸»æœºï¼Œå»ºè®®é…ç½®é™æ€IPåœ°å€å¹¶è®°å½•æ‰€æœ‰ç½‘ç»œè®¾ç½®ã€‚å®šæœŸæ£€æŸ¥ç½‘ç»œé…ç½®å¤‡ä»½ï¼Œç¡®ä¿åœ¨å‡ºç°é—®é¢˜æ—¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ã€‚åŒæ—¶ï¼Œå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³ç½‘ç»œé—®é¢˜ã€‚\nğŸ“Š ç‰ˆæœ¬è®°å½•:\n2024-01-20: åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«åŸºç¡€SSHå’Œç½‘ç»œé…ç½® 2024-03-15: å¢åŠ é«˜çº§æ•…éšœæ’é™¤æŠ€å·§å’Œæœ€ä½³å®è·µ 2024-06-01: è¡¥å……DCUIè¯¦ç»†æ“ä½œå’Œé…ç½®æ–‡ä»¶è¯´æ˜ ğŸ‘¨â€ğŸ’» ä½œè€…: ç³»ç»Ÿæ¶æ„å¸ˆå›¢é˜Ÿ\nğŸ·ï¸ æ ‡ç­¾: #ESXi #VMware #ç³»ç»Ÿç®¡ç† #ç½‘ç»œé…ç½® #æ•…éšœæ’é™¤\n","date":"2024-12-07T07:10:03+08:00","image":"https://file.meimolihan.eu.org/img/esxi-01.webp","permalink":"https://blog.meimolihan.eu.org/p/838acdae/","title":"ESXi ä¸»æœºç®¡ç†æŒ‡å—ï¼šå¯†ç é‡ç½®ä¸ç½‘ç»œé…ç½® ğŸ–¥ï¸"},{"content":"Docker éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿï¼ˆæ—§ç‰ˆï¼‰ ğŸ³ Typecho æ˜¯ä¸€æ¬¾è½»é‡çº§çš„å¼€æºåšå®¢ç³»ç»Ÿï¼Œå…·æœ‰ç®€æ´ã€é«˜æ•ˆçš„ç‰¹ç‚¹ã€‚æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Docker å’Œ Docker Compose éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿã€‚\nâœ¨ ç›®å½• âœ¨ Typecho ç®€ä»‹ ğŸš€ ä¸€ã€åˆ›å»ºå¿…è¦çš„æ–‡ä»¶ ğŸ“¦ äºŒã€ä¸‹è½½ Typecho æºç  ğŸ³ ä¸‰ã€åˆ›å»º Docker Compose æ–‡ä»¶ ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ âš™ï¸ äº”ã€åˆ›å»ºé…ç½®æ–‡ä»¶ ğŸ—„ï¸ å…­ã€åå°é…ç½®æ•°æ®åº“ ğŸ”’ ä¸ƒã€ä¿®æ”¹é»˜è®¤åå°ç™»å½•åœ°å€ ğŸ”„ å…«ã€å¯ç”¨åœ°å€é‡å†™åŠŸèƒ½ ğŸ’¡ ä¹ã€é¢å¤–æç¤ºå’Œä¼˜åŒ– ğŸ†˜ åã€å¸¸è§é—®é¢˜è§£å†³ âœ¨ Typecho ç®€ä»‹ Typecho æ˜¯ä¸€æ¬¾åŸºäº PHP å¼€å‘çš„è½»é‡çº§å¼€æºåšå®¢ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nâš¡ è½»é‡é«˜æ•ˆ: æ ¸å¿ƒæ–‡ä»¶ä»…çº¦ 500KBï¼Œèµ„æºå ç”¨ä½ ğŸ¨ ä¸»é¢˜ä¸°å¯Œ: æ”¯æŒå¤šç§ä¸»é¢˜å’Œæ¨¡æ¿ ğŸ”Œ æ’ä»¶ç”Ÿæ€: ä¸°å¯Œçš„æ’ä»¶æ‰©å±•åŠŸèƒ½ ğŸ“± å“åº”å¼è®¾è®¡: æ”¯æŒç§»åŠ¨è®¾å¤‡è®¿é—® ğŸ”§ ç®€å•æ˜“ç”¨: åå°ç®¡ç†ç•Œé¢ç®€æ´ç›´è§‚ æ•™ç¨‹æ–‡æ¡£ï¼š https://blog.laoda.de/archives/docker-compose-install-typecho åšå®¢å‰å°åœ°å€ï¼š http://ä½ çš„æœåŠ¡å™¨IP:8223\nåšå®¢åå°åœ°å€ï¼š http://ä½ çš„æœåŠ¡å™¨IP:8223/admin/ æˆ– http://ä½ çš„æœåŠ¡å™¨IP:8223/jkadmin/\nğŸš€ ä¸€ã€åˆ›å»ºå¿…è¦çš„æ–‡ä»¶ 1. åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 # åˆ›å»ºä¸»é¡¹ç›®ç›®å½• sudo mkdir -p /mnt/mydisk/home/typecho # åˆ›å»ºå­ç›®å½• sudo mkdir -p /mnt/mydisk/home/typecho/{php,nginx,mysql/{data,logs,conf},logs,typecho} # è®¾ç½®ç›®å½•æƒé™ sudo chown -R $USER:$USER /mnt/mydisk/home/typecho sudo chmod -R 755 /mnt/mydisk/home/typecho 2. åˆ›å»º MySQL ç¯å¢ƒå˜é‡æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026gt; /mnt/mydisk/home/typecho/mysql.env \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; # MySQL æ•°æ®åº“é…ç½® MYSQL_ROOT_PASSWORD=root_password_123 MYSQL_DATABASE=typecho MYSQL_USER=typecho_user MYSQL_PASSWORD=typecho_password_123 MYSQL_CHARSET=utf8mb4 MYSQL_COLLATION=utf8mb4_unicode_ci # æ—¶åŒºè®¾ç½® TZ=Asia/Shanghai EOF 3. åˆ›å»º PHP Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 cat \u0026gt; /mnt/mydisk/home/typecho/php/Dockerfile \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; FROM php:7.4-fpm # è®¾ç½®æ—¶åŒº ENV TZ=Asia/Shanghai # å®‰è£…ç³»ç»Ÿä¾èµ–å’ŒPHPæ‰©å±• RUN apt-get update \u0026amp;\u0026amp; apt-get install -y \\ libfreetype6-dev \\ libjpeg62-turbo-dev \\ libpng-dev \\ libzip-dev \\ zip \\ unzip \\ \u0026amp;\u0026amp; docker-php-ext-configure gd --with-freetype --with-jpeg \\ \u0026amp;\u0026amp; docker-php-ext-install -j$(nproc) gd \\ \u0026amp;\u0026amp; docker-php-ext-install pdo_mysql \\ \u0026amp;\u0026amp; docker-php-ext-install zip \\ \u0026amp;\u0026amp; docker-php-ext-install opcache # é…ç½®PHP RUN echo \u0026#34;output_buffering = 4096\u0026#34; \u0026gt; /usr/local/etc/php/conf.d/php.ini \\ \u0026amp;\u0026amp; echo \u0026#34;date.timezone = Asia/Shanghai\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/php.ini \\ \u0026amp;\u0026amp; echo \u0026#34;upload_max_filesize = 20M\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/php.ini \\ \u0026amp;\u0026amp; echo \u0026#34;post_max_size = 20M\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/php.ini \\ \u0026amp;\u0026amp; echo \u0026#34;memory_limit = 128M\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/php.ini # å®‰è£…Composer RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer # æ¸…ç†ç¼“å­˜ RUN apt-get clean \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* EOF 4. åˆ›å»º Nginx é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 cat \u0026gt; /mnt/mydisk/home/typecho/nginx/default.conf \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; server { listen 80; server_name localhost; root /var/www/html; index index.php index.html index.htm; access_log /var/log/nginx/typecho_access.log; error_log /var/log/nginx/typecho_error.log; # å®‰å…¨å¤´éƒ¨ add_header X-Frame-Options SAMEORIGIN; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; # é™æ€æ–‡ä»¶ç¼“å­˜ location ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ { expires 30d; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } # Typecho URLé‡å†™è§„åˆ™ if (!-e $request_filename) { rewrite ^(.*)$ /index.php$1 last; } location / { try_files $uri $uri/ /index.php?$args; } # PHPå¤„ç† location ~ \\.php$ { try_files $uri =404; fastcgi_split_path_info ^(.+\\.php)(/.+)$; fastcgi_pass php:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; # å¢åŠ è¶…æ—¶æ—¶é—´ fastcgi_read_timeout 300; fastcgi_send_timeout 300; } # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶ location ~ /\\. { deny all; access_log off; log_not_found off; } location ~ /(config|usr/themes|usr/plugins)/.*\\.(php|php5|txt|html|htm)$ { deny all; access_log off; log_not_found off; } } EOF ğŸ“¦ äºŒã€ä¸‹è½½ Typecho æºç  1. ä¸‹è½½å¹¶è§£å‹ Typecho 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # è¿›å…¥Typechoç›®å½• cd /mnt/mydisk/home/typecho/typecho # ä¸‹è½½Typechoæœ€æ–°ç‰ˆ echo \u0026#34;æ­£åœ¨ä¸‹è½½Typecho...\u0026#34; wget https://github.com/typecho/typecho/releases/download/v1.2.1/typecho.zip -O typecho.zip # å¦‚æœç›´æ¥ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä»£ç†æˆ–å¤‡ç”¨é“¾æ¥ if [ ! -f \u0026#34;typecho.zip\u0026#34; ]; then echo \u0026#34;ç›´æ¥ä¸‹è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨é“¾æ¥...\u0026#34; wget https://typecho.org/download.php -O typecho.zip fi # è§£å‹Typecho if [ -f \u0026#34;typecho.zip\u0026#34; ]; then unzip -q typecho.zip rm -f typecho.zip echo \u0026#34;Typechoè§£å‹æˆåŠŸ!\u0026#34; else echo \u0026#34;ä¸‹è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¸‹è½½Typechoå¹¶è§£å‹åˆ°/mnt/mydisk/home/typecho/typechoç›®å½•\u0026#34; echo \u0026#34;ä¸‹è½½åœ°å€: https://github.com/typecho/typecho/releases\u0026#34; exit 1 fi 2. è®¾ç½®æ–‡ä»¶æƒé™ 1 2 3 4 5 6 7 8 9 10 11 # è®¾ç½®ä¸Šä¼ ç›®å½•æƒé™ chmod -R 777 /mnt/mydisk/home/typecho/typecho/usr/uploads # è®¾ç½®é…ç½®æ–‡ä»¶æƒé™ chmod 755 /mnt/mydisk/home/typecho/typecho chmod 644 /mnt/mydisk/home/typecho/typecho/*.php chmod 644 /mnt/mydisk/home/typecho/typecho/usr/*.php # åˆ›å»ºå®‰è£…é”æ–‡ä»¶ï¼ˆé˜²æ­¢é‡å¤å®‰è£…ï¼‰ touch /mnt/mydisk/home/typecho/typecho/install.lock chmod 644 /mnt/mydisk/home/typecho/typecho/install.lock ğŸ³ ä¸‰ã€åˆ›å»º Docker Compose æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 cat \u0026gt; /mnt/mydisk/home/typecho/docker-compose.yml \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; services: nginx: image: nginx:alpine container_name: typecho-nginx ports: - \u0026#34;8223:80\u0026#34; # å·¦ä¾§å¯ä»¥æ”¹æˆä»»æ„æœªä½¿ç”¨çš„ç«¯å£ restart: unless-stopped environment: - TZ=Asia/Shanghai volumes: - ./typecho:/var/www/html:ro - ./nginx:/etc/nginx/conf.d:ro - ./logs/nginx:/var/log/nginx depends_on: - php networks: - typecho-network healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost\u0026#34;] interval: 30s timeout: 10s retries: 3 php: build: ./php container_name: typecho-php restart: unless-stopped expose: - \u0026#34;9000\u0026#34; volumes: - ./typecho:/var/www/html - ./logs/php:/var/log/php environment: - TZ=Asia/Shanghai depends_on: - mysql networks: - typecho-network healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;php\u0026#34;, \u0026#34;-v\u0026#34;] interval: 30s timeout: 10s retries: 3 mysql: image: mysql:5.7 container_name: typecho-mysql restart: unless-stopped environment: - TZ=Asia/Shanghai expose: - \u0026#34;3306\u0026#34; volumes: - ./mysql/data:/var/lib/mysql - ./mysql/logs:/var/log/mysql - ./mysql/conf:/etc/mysql/conf.d - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql env_file: - mysql.env networks: - typecho-network healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;mysqladmin\u0026#34;, \u0026#34;ping\u0026#34;, \u0026#34;-h\u0026#34;, \u0026#34;localhost\u0026#34;, \u0026#34;-u\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;-p$$MYSQL_ROOT_PASSWORD\u0026#34;] interval: 30s timeout: 10s retries: 3 networks: typecho-network: driver: bridge name: typecho-network EOF 1. åˆ›å»º MySQL åˆå§‹åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 cat \u0026gt; /mnt/mydisk/home/typecho/mysql/init.sql \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; -- åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ CREATE DATABASE IF NOT EXISTS typecho CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; -- åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ GRANT ALL PRIVILEGES ON typecho.* TO \u0026#39;typecho_user\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;typecho_password_123\u0026#39;; -- åˆ·æ–°æƒé™ FLUSH PRIVILEGES; EOF 2. å¯åŠ¨å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 # è¿›å…¥é¡¹ç›®ç›®å½• cd /mnt/mydisk/home/typecho # æ„å»ºå¹¶å¯åŠ¨å®¹å™¨ docker-compose up -d # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ docker-compose ps # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker-compose logs -f 3. åœæ­¢å¹¶åˆ é™¤å®¹å™¨ 1 2 3 4 5 # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ cd /mnt/mydisk/home/typecho \u0026amp;\u0026amp; docker-compose down # åˆ é™¤å®¹å™¨å¹¶ç§»é™¤æ•°æ®å·ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰ cd /mnt/mydisk/home/typecho \u0026amp;\u0026amp; docker-compose down -v 4. æ‹‰å–é•œåƒ 1 2 3 4 5 6 7 # æ‹‰å–æœ€æ–°é•œåƒ docker pull nginx:alpine docker pull mysql:5.7 docker pull php:7.4-fpm # é‡æ–°æ„å»ºPHPé•œåƒ cd /mnt/mydisk/home/typecho \u0026amp;\u0026amp; docker-compose build php ğŸ”§ å››ã€å®¹å™¨ç»´æŠ¤å‘½ä»¤ 1. æŸ¥çœ‹æ‰€æœ‰è¿è¡Œå®¹å™¨çš„åç§° 1 2 3 4 docker ps -a --format \u0026#34;{{.Names}}\u0026#34; # æˆ–è€…ä½¿ç”¨docker-compose docker-compose ps --services 2. å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # åœæ­¢Typechoå®¹å™¨ docker-compose stop # å¯åŠ¨Typechoå®¹å™¨ docker-compose start # é‡å¯Typechoå®¹å™¨ docker-compose restart # å¼ºåˆ¶é‡å¯å®¹å™¨ docker-compose restart -t 0 3. è¿›å…¥å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 # è¿›å…¥Nginxå®¹å™¨ docker-compose exec nginx sh # è¿›å…¥PHPå®¹å™¨ docker-compose exec php bash # è¿›å…¥MySQLå®¹å™¨ docker-compose exec mysql bash # ä½¿ç”¨rootç”¨æˆ·è¿›å…¥MySQL docker-compose exec mysql mysql -uroot -p # è¾“å…¥å¯†ç ï¼šroot_password_123 4. æŸ¥çœ‹å®¹å™¨æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨æ—¥å¿— docker-compose logs # å®æ—¶æŸ¥çœ‹æ—¥å¿— docker-compose logs -f # æŸ¥çœ‹ç‰¹å®šå®¹å™¨æ—¥å¿— docker-compose logs nginx docker-compose logs php docker-compose logs mysql # æŸ¥çœ‹æœ€åNè¡Œæ—¥å¿— docker-compose logs --tail 100 5. å®¹å™¨èµ„æºç›‘æ§ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker stats # æŸ¥çœ‹ç‰¹å®šå®¹å™¨èµ„æºä½¿ç”¨ docker stats typecho-nginx typecho-php typecho-mysql # æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ docker top typecho-php âš™ï¸ äº”ã€åˆ›å»ºé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 cat \u0026gt; /mnt/mydisk/home/typecho/typecho/config.inc.php \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026lt;?php /** * Typecho é…ç½®æ–‡ä»¶ * è‡ªåŠ¨ç”Ÿæˆäº \u0026lt;?php echo date(\u0026#39;Y-m-d H:i:s\u0026#39;); ?\u0026gt; */ // æ•°æ®åº“è®¾ç½® $db = new Typecho_Db(\u0026#39;Pdo_Mysql\u0026#39;, \u0026#39;typecho_\u0026#39;); $db-\u0026gt;addServer(array ( \u0026#39;host\u0026#39; =\u0026gt; \u0026#39;mysql\u0026#39;, \u0026#39;port\u0026#39; =\u0026gt; 3306, \u0026#39;user\u0026#39; =\u0026gt; \u0026#39;typecho_user\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;typecho_password_123\u0026#39;, \u0026#39;charset\u0026#39; =\u0026gt; \u0026#39;utf8mb4\u0026#39;, \u0026#39;database\u0026#39; =\u0026gt; \u0026#39;typecho\u0026#39;, \u0026#39;engine\u0026#39; =\u0026gt; \u0026#39;InnoDB\u0026#39;, ), Typecho_Db::READ | Typecho_Db::WRITE); Typecho_Db::set($db); // ç«™ç‚¹è®¾ç½® define(\u0026#39;__TYPECHO_ROOT_DIR__\u0026#39;, dirname(__FILE__)); define(\u0026#39;__TYPECHO_PLUGIN_DIR__\u0026#39;, \u0026#39;/usr/plugins\u0026#39;); define(\u0026#39;__TYPECHO_THEME_DIR__\u0026#39;, \u0026#39;/usr/themes\u0026#39;); define(\u0026#39;__TYPECHO_ADMIN_DIR__\u0026#39;, \u0026#39;/admin/\u0026#39;); // å®‰å…¨è®¾ç½® define(\u0026#39;__TYPECHO_SITE_URL__\u0026#39;, \u0026#39;\u0026#39;); define(\u0026#39;__TYPECHO_SECURE__\u0026#39;, true); define(\u0026#39;__TYPECHO_COOKIE_PATH__\u0026#39;, \u0026#39;/\u0026#39;); // Gravatar å¤´åƒæœåŠ¡å™¨ define(\u0026#39;__TYPECHO_GRAVATAR_PREFIX__\u0026#39;, \u0026#39;https://cravatar.cn/avatar/\u0026#39;); // è°ƒè¯•æ¨¡å¼ define(\u0026#39;__TYPECHO_DEBUG__\u0026#39;, false); define(\u0026#39;__TYPECHO_ENABLE_CORS__\u0026#39;, false); // æ³¨å†Œåˆå§‹åŒ–å‡½æ•° Typecho_Plugin::init(); // è¾“å‡ºç¼“å†² ob_start(); ?\u0026gt; EOF ğŸ—„ï¸ å…­ã€åå°é…ç½®æ•°æ®åº“ è®¿é—®åå°åœ°å€ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:8223\nåˆå§‹åŒ–é…ç½®æ­¥éª¤ æ‰“å¼€å®‰è£…é¡µé¢: è®¿é—® http://ä½ çš„æœåŠ¡å™¨IP:8223/install.php\nå¡«å†™æ•°æ®åº“ä¿¡æ¯:\næ•°æ®åº“é€‚é…å™¨: Pdo_Mysql æ•°æ®åº“åœ°å€: mysql (Dockerå®¹å™¨åç§°) æ•°æ®åº“ç«¯å£: 3306 æ•°æ®åº“ç”¨æˆ·å: typecho_user æ•°æ®åº“å¯†ç : typecho_password_123 æ•°æ®åº“å: typecho æ•°æ®åº“å‰ç¼€: typecho_ (å¯é€‰) è®¾ç½®ç®¡ç†å‘˜è´¦æˆ·:\nå¡«å†™ç®¡ç†å‘˜ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®± å»ºè®®ä½¿ç”¨å¼ºå¯†ç  å®Œæˆå®‰è£…:\nç‚¹å‡»\u0026quot;ç¡®è®¤å®‰è£…\u0026quot;æŒ‰é’® å®‰è£…å®Œæˆåå»ºè®®åˆ é™¤ install.php æ–‡ä»¶ å®‰è£…åæ£€æŸ¥ 1 2 3 4 5 6 7 8 # æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»ºæˆåŠŸ docker-compose exec mysql mysql -utypecho_user -ptypecho_password_123 -e \u0026#34;SHOW TABLES FROM typecho;\u0026#34; # æ£€æŸ¥å®‰è£…é”æ–‡ä»¶ ls -la /mnt/mydisk/home/typecho/typecho/install.lock # åˆ é™¤å®‰è£…æ–‡ä»¶ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰ rm -f /mnt/mydisk/home/typecho/typecho/install.php ğŸ”’ ä¸ƒã€ä¿®æ”¹é»˜è®¤åå°ç™»å½•åœ°å€ ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œå»ºè®®ä¿®æ”¹é»˜è®¤çš„åå°ç™»å½•åœ°å€ï¼š\næ–¹æ³•ä¸€ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ 1 2 3 4 5 # ç¼–è¾‘ config.inc.php nano /mnt/mydisk/home/typecho/typecho/config.inc.php # æ‰¾åˆ°ä»¥ä¸‹è¡Œå¹¶ä¿®æ”¹ï¼š define(\u0026#39;__TYPECHO_ADMIN_DIR__\u0026#39;, \u0026#39;/my-secret-admin/\u0026#39;); æ–¹æ³•äºŒï¼šä½¿ç”¨ Nginx é‡å†™è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 # åœ¨ nginx/default.conf ä¸­æ·»åŠ ä»¥ä¸‹è§„åˆ™ location /wp-admin { return 404; } location /administrator { return 404; } location ~* ^/(admin|login|wp-login) { return 404; } æ–¹æ³•ä¸‰ï¼šä½¿ç”¨èº«ä»½éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£… htpasswd å·¥å…· sudo apt-get install apache2-utils # åˆ›å»ºè®¤è¯æ–‡ä»¶ htpasswd -c /mnt/mydisk/home/typecho/nginx/.htpasswd admin # åœ¨ nginx é…ç½®ä¸­æ·»åŠ è®¤è¯ location /admin { auth_basic \u0026#34;Admin Area\u0026#34;; auth_basic_user_file /etc/nginx/conf.d/.htpasswd; } ğŸ”„ å…«ã€å¯ç”¨åœ°å€é‡å†™åŠŸèƒ½ åœ¨ Typecho åå°å¯ç”¨åœ°å€é‡å†™åŠŸèƒ½ï¼Œä½¿ URL æ›´åŠ å‹å¥½ï¼š\nç™»å½• Typecho åå° è¿›å…¥\u0026quot;è®¾ç½®\u0026quot; â†’ \u0026ldquo;æ°¸ä¹…é“¾æ¥\u0026rdquo; é€‰æ‹©\u0026quot;å¯ç”¨åœ°å€é‡å†™åŠŸèƒ½\u0026quot; é€‰æ‹©å–œæ¬¢çš„é“¾æ¥æ ¼å¼ ç‚¹å‡»\u0026quot;ä¿å­˜è®¾ç½®\u0026quot; å¦‚æœé‡å†™ä¸å·¥ä½œï¼Œæ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥Nginxé…ç½® docker-compose exec nginx nginx -t # é‡æ–°åŠ è½½Nginxé…ç½® docker-compose exec nginx nginx -s reload # æ£€æŸ¥æ–‡ä»¶æƒé™ ls -la /mnt/mydisk/home/typecho/typecho # ç¡®ä¿.htaccessæ–‡ä»¶å­˜åœ¨ cat /mnt/mydisk/home/typecho/typecho/.htaccess ğŸ’¡ ä¹ã€é¢å¤–æç¤ºå’Œä¼˜åŒ– 1. å¤‡ä»½å’Œæ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # å¤‡ä»½æ•°æ®åº“ docker-compose exec mysql mysqldump -u typecho_user -ptypecho_password_123 typecho \u0026gt; typecho_backup_$(date +%Y%m%d).sql # æ¢å¤æ•°æ®åº“ docker-compose exec -T mysql mysql -u typecho_user -ptypecho_password_123 typecho \u0026lt; typecho_backup.sql # å¤‡ä»½æ•´ä¸ªé¡¹ç›® tar -czpf typecho_backup_$(date +%Y%m%d).tar.gz /mnt/mydisk/home/typecho/ # åˆ›å»ºè‡ªåŠ¨å¤‡ä»½è„šæœ¬ cat \u0026gt; /mnt/mydisk/home/typecho/backup.sh \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #!/bin/bash DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR=\u0026#34;/mnt/mydisk/backups/typecho\u0026#34; mkdir -p $BACKUP_DIR # å¤‡ä»½æ•°æ®åº“ docker-compose exec mysql mysqldump -u typecho_user -ptypecho_password_123 typecho \u0026gt; $BACKUP_DIR/typecho_db_$DATE.sql # å¤‡ä»½æ–‡ä»¶ tar -czf $BACKUP_DIR/typecho_files_$DATE.tar.gz /mnt/mydisk/home/typecho/typecho # åˆ é™¤7å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -name \u0026#34;*.sql\u0026#34; -mtime +7 -delete find $BACKUP_DIR -name \u0026#34;*.tar.gz\u0026#34; -mtime +7 -delete echo \u0026#34;å¤‡ä»½å®Œæˆ: $BACKUP_DIR/typecho_$DATE\u0026#34; EOF chmod +x /mnt/mydisk/home/typecho/backup.sh 2. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åœ¨php/Dockerfileä¸­æ·»åŠ OPcacheä¼˜åŒ– echo \u0026#34;opcache.enable=1\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/opcache.ini echo \u0026#34;opcache.memory_consumption=128\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/opcache.ini echo \u0026#34;opcache.max_accelerated_files=4000\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/opcache.ini echo \u0026#34;opcache.revalidate_freq=60\u0026#34; \u0026gt;\u0026gt; /usr/local/etc/php/conf.d/opcache.ini # åœ¨nginx/default.confä¸­æ·»åŠ Gzipå‹ç¼© gzip on; gzip_vary on; gzip_min_length 1024; gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json; # å¯ç”¨æµè§ˆå™¨ç¼“å­˜ location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg)$ { expires 1y; add_header Cache-Control \u0026#34;public, immutable\u0026#34;; } 3. å®‰å…¨åŠ å›º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # åœ¨nginx/default.confä¸­æ·»åŠ å®‰å…¨å¤´ add_header X-Frame-Options SAMEORIGIN; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \u0026#34;1; mode=block\u0026#34;; add_header Referrer-Policy \u0026#34;strict-origin-when-cross-origin\u0026#34;; # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶ location ~ /\\. { deny all; access_log off; log_not_found off; } location ~ /(\\.env|config\\.php|composer\\.json|composer\\.lock)$ { deny all; access_log off; log_not_found off; } 4. ç›‘æ§å’Œæ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å®‰è£…æ—¥å¿—è½®è½¬å·¥å…· sudo apt-get install logrotate # åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½® cat \u0026gt; /etc/logrotate.d/typecho \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; /mnt/mydisk/home/typecho/logs/*/*.log { daily missingok rotate 14 compress delaycompress notifempty create 0640 www-data www-data sharedscripts postrotate docker-compose -f /mnt/mydisk/home/typecho/docker-compose.yml restart nginx \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 endscript } EOF ğŸ†˜ åã€å¸¸è§é—®é¢˜è§£å†³ 1. æƒé™é—®é¢˜ 1 2 3 4 5 6 7 # ç¡®ä¿æ‰€æœ‰æ–‡ä»¶æƒé™æ­£ç¡® sudo chown -R $USER:$USER /mnt/mydisk/home/typecho sudo chmod -R 755 /mnt/mydisk/home/typecho/typecho sudo chmod -R 777 /mnt/mydisk/home/typecho/typecho/usr/uploads # å¦‚æœä½¿ç”¨SELinux sudo chcon -Rt httpd_sys_content_t /mnt/mydisk/home/typecho/typecho 2. æ•°æ®åº“è¿æ¥é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥MySQLå®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ docker-compose ps mysql # æ£€æŸ¥MySQLæ—¥å¿— docker-compose logs mysql # è¿›å…¥MySQLå®¹å™¨æ£€æŸ¥è¿æ¥ docker-compose exec mysql mysql -utypecho_user -ptypecho_password_123 -e \u0026#34;SHOW DATABASES;\u0026#34; # å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥ç”¨æˆ·æƒé™ docker-compose exec mysql mysql -uroot -proot_password_123 -e \u0026#34;SELECT user, host FROM mysql.user;\u0026#34; 3. ç«¯å£å†²çª 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ç«¯å£å ç”¨ netstat -tulnp | grep :8223 ss -tulnp | grep :8223 # å¦‚æœç«¯å£å·²è¢«å ç”¨ï¼Œä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„ # å°† \u0026#34;8223:80\u0026#34; æ”¹ä¸º \u0026#34;8224:80\u0026#34; æˆ–å…¶ä»–ç«¯å£ # é‡å¯å®¹å™¨ docker-compose down docker-compose up -d 4. å®¹å™¨å¯åŠ¨å¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ docker-compose logs # æ£€æŸ¥Docker Composeæ–‡ä»¶è¯­æ³• docker-compose config # å°è¯•å¼ºåˆ¶é‡å»ºå®¹å™¨ docker-compose up -d --force-recreate # æ£€æŸ¥ç³»ç»Ÿèµ„æº docker system df docker system prune -a # è°¨æ…æ“ä½œï¼ 5. æ€§èƒ½é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ docker stats # æ£€æŸ¥PHPè¿›ç¨‹ docker-compose exec php ps aux # æ£€æŸ¥Nginxè®¿é—®æ—¥å¿— tail -f /mnt/mydisk/home/typecho/logs/nginx/access.log # å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆMySQLï¼‰ # åœ¨mysql/confç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ echo \u0026#34;[mysqld] slow_query_log = 1 slow_query_log_file = /var/log/mysql/mysql-slow.log long_query_time = 2\u0026#34; \u0026gt; /mnt/mydisk/home/typecho/mysql/conf/slow-query.cnf 6. ä¸»é¢˜å’Œæ’ä»¶é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 # æ£€æŸ¥ä¸»é¢˜å’Œæ’ä»¶ç›®å½•æƒé™ ls -la /mnt/mydisk/home/typecho/typecho/usr/themes/ ls -la /mnt/mydisk/home/typecho/typecho/usr/plugins/ # é‡ç½®æƒé™ chmod -R 755 /mnt/mydisk/home/typecho/typecho/usr/themes/ chmod -R 755 /mnt/mydisk/home/typecho/typecho/usr/plugins/ # æ£€æŸ¥PHPé”™è¯¯æ—¥å¿— docker-compose exec php tail -f /var/log/php/error.log é€šè¿‡ä»¥ä¸Šå®Œæ•´çš„æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸéƒ¨ç½²å’Œç®¡ç†åŸºäº Docker çš„ Typecho åšå®¢ç³»ç»Ÿã€‚å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸åº”ç« èŠ‚çš„æ•…éšœæ’é™¤éƒ¨åˆ†ï¼Œæˆ–æŸ¥é˜… Typecho å®˜æ–¹æ–‡æ¡£ã€‚\n","date":"2024-12-07T07:06:20+08:00","image":"https://file.meimolihan.eu.org/img/typecho-01.webp","permalink":"https://blog.meimolihan.eu.org/p/4b242701/","title":"Docker éƒ¨ç½² Typecho åšå®¢ç³»ç»Ÿï¼ˆæ—§ç‰ˆï¼‰ ğŸ³"}]